<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5557887">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5557943">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5557997">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5558048">package</span>&nbsp;<span class="ident" id="5558056">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5558064">import</span>&nbsp;<span class="op" id="5558071">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5558074">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5558082">&#34;strings&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5558093">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5558104">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="5558119">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5558122">//&nbsp;An&nbsp;Error&nbsp;describes&nbsp;a&nbsp;failure&nbsp;to&nbsp;parse&nbsp;a&nbsp;regular&nbsp;expression</span><br>
<span class="lineno">15</span><span class="comment" id="5558184">//&nbsp;and&nbsp;gives&nbsp;the&nbsp;offending&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="5558223">type</span>&nbsp;<span class="ident" id="5558228">Error</span>&nbsp;<span class="keyword" id="5558234">struct</span>&nbsp;<span class="op" id="5558241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558244">Code</span>&nbsp;<span class="ident" id="5558249">ErrorCode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558260">Expr</span>&nbsp;<span class="builtintype" id="5558265">string</span><br>
<span class="lineno"></span><span class="op" id="5558272">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5558275">func</span>&nbsp;<span class="op" id="5558280">(</span><span class="ident" id="5558281">e</span>&nbsp;<span class="op" id="5558283">*</span><span class="ident" id="5558284">Error</span><span class="op" id="5558289">)</span>&nbsp;<span class="ident" id="5558291">Error</span><span class="op" id="5558296">(</span><span class="op" id="5558297">)</span>&nbsp;<span class="builtintype" id="5558299">string</span>&nbsp;<span class="op" id="5558306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5558309">return</span>&nbsp;<span class="string" id="5558316">&#34;error&nbsp;parsing&nbsp;regexp:&nbsp;&#34;</span>&nbsp;<span class="op" id="5558341">+</span>&nbsp;<span class="ident" id="5558343">e</span><span class="op" id="5558344">.</span><span class="ident" id="5558345">Code</span><span class="op" id="5558349">.</span><span class="ident" id="5558350">String</span><span class="op" id="5558356">(</span><span class="op" id="5558357">)</span>&nbsp;<span class="op" id="5558359">+</span>&nbsp;<span class="string" id="5558361">&#34;:&nbsp;`&#34;</span>&nbsp;<span class="op" id="5558367">+</span>&nbsp;<span class="ident" id="5558369">e</span><span class="op" id="5558370">.</span><span class="ident" id="5558371">Expr</span>&nbsp;<span class="op" id="5558376">+</span>&nbsp;<span class="string" id="5558378">&#34;`&#34;</span><br>
<span class="lineno"></span><span class="op" id="5558382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5558385">//&nbsp;An&nbsp;ErrorCode&nbsp;describes&nbsp;a&nbsp;failure&nbsp;to&nbsp;parse&nbsp;a&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="5558452">type</span>&nbsp;<span class="ident" id="5558457">ErrorCode</span>&nbsp;<span class="builtintype" id="5558467">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5558475">const</span>&nbsp;<span class="op" id="5558481">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5558484">//&nbsp;Unexpected&nbsp;error</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558505">ErrInternalError</span>&nbsp;<span class="ident" id="5558522">ErrorCode</span>&nbsp;<span class="op" id="5558532">=</span>&nbsp;<span class="string" id="5558534">&#34;regexp/syntax:&nbsp;internal&nbsp;error&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5558568">//&nbsp;Parse&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558585">ErrInvalidCharClass</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558610">ErrorCode</span>&nbsp;<span class="op" id="5558620">=</span>&nbsp;<span class="string" id="5558622">&#34;invalid&nbsp;character&nbsp;class&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558649">ErrInvalidCharRange</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558674">ErrorCode</span>&nbsp;<span class="op" id="5558684">=</span>&nbsp;<span class="string" id="5558686">&#34;invalid&nbsp;character&nbsp;class&nbsp;range&#34;</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558719">ErrInvalidEscape</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558744">ErrorCode</span>&nbsp;<span class="op" id="5558754">=</span>&nbsp;<span class="string" id="5558756">&#34;invalid&nbsp;escape&nbsp;sequence&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558783">ErrInvalidNamedCapture</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5558808">ErrorCode</span>&nbsp;<span class="op" id="5558818">=</span>&nbsp;<span class="string" id="5558820">&#34;invalid&nbsp;named&nbsp;capture&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558845">ErrInvalidPerlOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558870">ErrorCode</span>&nbsp;<span class="op" id="5558880">=</span>&nbsp;<span class="string" id="5558882">&#34;invalid&nbsp;or&nbsp;unsupported&nbsp;Perl&nbsp;syntax&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558920">ErrInvalidRepeatOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5558945">ErrorCode</span>&nbsp;<span class="op" id="5558955">=</span>&nbsp;<span class="string" id="5558957">&#34;invalid&nbsp;nested&nbsp;repetition&nbsp;operator&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5558995">ErrInvalidRepeatSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559020">ErrorCode</span>&nbsp;<span class="op" id="5559030">=</span>&nbsp;<span class="string" id="5559032">&#34;invalid&nbsp;repeat&nbsp;count&#34;</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5559056">ErrInvalidUTF8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559081">ErrorCode</span>&nbsp;<span class="op" id="5559091">=</span>&nbsp;<span class="string" id="5559093">&#34;invalid&nbsp;UTF-8&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5559110">ErrMissingBracket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559135">ErrorCode</span>&nbsp;<span class="op" id="5559145">=</span>&nbsp;<span class="string" id="5559147">&#34;missing&nbsp;closing&nbsp;]&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5559168">ErrMissingParen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559193">ErrorCode</span>&nbsp;<span class="op" id="5559203">=</span>&nbsp;<span class="string" id="5559205">&#34;missing&nbsp;closing&nbsp;)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5559226">ErrMissingRepeatArgument</span>&nbsp;<span class="ident" id="5559251">ErrorCode</span>&nbsp;<span class="op" id="5559261">=</span>&nbsp;<span class="string" id="5559263">&#34;missing&nbsp;argument&nbsp;to&nbsp;repetition&nbsp;operator&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5559306">ErrTrailingBackslash</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559331">ErrorCode</span>&nbsp;<span class="op" id="5559341">=</span>&nbsp;<span class="string" id="5559343">&#34;trailing&nbsp;backslash&nbsp;at&nbsp;end&nbsp;of&nbsp;expression&#34;</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5559386">ErrUnexpectedParen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559411">ErrorCode</span>&nbsp;<span class="op" id="5559421">=</span>&nbsp;<span class="string" id="5559423">&#34;unexpected&nbsp;)&#34;</span><br>
<span class="lineno"></span><span class="op" id="5559438">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5559441">func</span>&nbsp;<span class="op" id="5559446">(</span><span class="ident" id="5559447">e</span>&nbsp;<span class="ident" id="5559449">ErrorCode</span><span class="op" id="5559458">)</span>&nbsp;<span class="ident" id="5559460">String</span><span class="op" id="5559466">(</span><span class="op" id="5559467">)</span>&nbsp;<span class="builtintype" id="5559469">string</span>&nbsp;<span class="op" id="5559476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5559479">return</span>&nbsp;<span class="builtintype" id="5559486">string</span><span class="op" id="5559492">(</span><span class="ident" id="5559493">e</span><span class="op" id="5559494">)</span><br>
<span class="lineno">50</span><span class="op" id="5559496">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5559499">//&nbsp;Flags&nbsp;control&nbsp;the&nbsp;behavior&nbsp;of&nbsp;the&nbsp;parser&nbsp;and&nbsp;record&nbsp;information&nbsp;about&nbsp;regexp&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="5559588">type</span>&nbsp;<span class="ident" id="5559593">Flags</span>&nbsp;<span class="builtintype" id="5559599">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="5559607">const</span>&nbsp;<span class="op" id="5559613">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5559616">FoldCase</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5559630">Flags</span>&nbsp;<span class="op" id="5559636">=</span>&nbsp;<span class="num" id="5559638">1</span>&nbsp;<span class="op" id="5559640">&lt;&lt;</span>&nbsp;<span class="ident" id="5559643">iota</span>&nbsp;<span class="comment" id="5559648">//&nbsp;case-insensitive&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5559675">Literal</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5559707">//&nbsp;treat&nbsp;pattern&nbsp;as&nbsp;literal&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5559743">ClassNL</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5559775">//&nbsp;allow&nbsp;character&nbsp;classes&nbsp;like&nbsp;[^a-z]&nbsp;and&nbsp;[[:space:]]&nbsp;to&nbsp;match&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5559848">DotNL</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5559880">//&nbsp;allow&nbsp;.&nbsp;to&nbsp;match&nbsp;newline</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5559909">OneLine</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5559941">//&nbsp;treat&nbsp;^&nbsp;and&nbsp;$&nbsp;as&nbsp;only&nbsp;matching&nbsp;at&nbsp;beginning&nbsp;and&nbsp;end&nbsp;of&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560005">NonGreedy</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5560037">//&nbsp;make&nbsp;repetition&nbsp;operators&nbsp;default&nbsp;to&nbsp;non-greedy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560089">PerlX</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5560121">//&nbsp;allow&nbsp;Perl&nbsp;extensions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560147">UnicodeGroups</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5560179">//&nbsp;allow&nbsp;\p{Han},&nbsp;\P{Han}&nbsp;for&nbsp;Unicode&nbsp;group&nbsp;and&nbsp;negation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560237">WasDollar</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5560269">//&nbsp;regexp&nbsp;OpEndText&nbsp;was&nbsp;$,&nbsp;not&nbsp;\z</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560304">Simple</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5560336">//&nbsp;regexp&nbsp;contains&nbsp;no&nbsp;counted&nbsp;repetition</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560379">MatchNL</span>&nbsp;<span class="op" id="5560387">=</span>&nbsp;<span class="ident" id="5560389">ClassNL</span>&nbsp;<span class="op" id="5560397">|</span>&nbsp;<span class="ident" id="5560399">DotNL</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560407">Perl</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5560419">=</span>&nbsp;<span class="ident" id="5560421">ClassNL</span>&nbsp;<span class="op" id="5560429">|</span>&nbsp;<span class="ident" id="5560431">OneLine</span>&nbsp;<span class="op" id="5560439">|</span>&nbsp;<span class="ident" id="5560441">PerlX</span>&nbsp;<span class="op" id="5560447">|</span>&nbsp;<span class="ident" id="5560449">UnicodeGroups</span>&nbsp;<span class="comment" id="5560463">//&nbsp;as&nbsp;close&nbsp;to&nbsp;Perl&nbsp;as&nbsp;possible</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560496">POSIX</span>&nbsp;<span class="ident" id="5560502">Flags</span>&nbsp;<span class="op" id="5560508">=</span>&nbsp;<span class="num" id="5560510">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5560552">//&nbsp;POSIX&nbsp;syntax</span><br>
<span class="lineno"></span><span class="op" id="5560568">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5560571">//&nbsp;Pseudo-ops&nbsp;for&nbsp;parsing&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="5560604">const</span>&nbsp;<span class="op" id="5560610">(</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560613">opLeftParen</span>&nbsp;<span class="op" id="5560625">=</span>&nbsp;<span class="ident" id="5560627">opPseudo</span>&nbsp;<span class="op" id="5560636">+</span>&nbsp;<span class="ident" id="5560638">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560644">opVerticalBar</span><br>
<span class="lineno"></span><span class="op" id="5560658">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5560661">type</span>&nbsp;<span class="ident" id="5560666">parser</span>&nbsp;<span class="keyword" id="5560673">struct</span>&nbsp;<span class="op" id="5560680">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560683">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5560695">Flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5560705">//&nbsp;parse&nbsp;mode&nbsp;flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560726">stack</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5560738">[</span><span class="op" id="5560739">]</span><span class="op" id="5560740">*</span><span class="ident" id="5560741">Regexp</span>&nbsp;<span class="comment" id="5560748">//&nbsp;stack&nbsp;of&nbsp;parsed&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560780">free</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5560792">*</span><span class="ident" id="5560793">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560801">numCap</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5560813">int</span>&nbsp;<span class="comment" id="5560817">//&nbsp;number&nbsp;of&nbsp;capturing&nbsp;groups&nbsp;seen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560853">wholeRegexp</span>&nbsp;<span class="builtintype" id="5560865">string</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560873">tmpClass</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5560885">[</span><span class="op" id="5560886">]</span><span class="builtintype" id="5560887">rune</span>&nbsp;<span class="comment" id="5560892">//&nbsp;temporary&nbsp;char&nbsp;class&nbsp;work&nbsp;space</span><br>
<span class="lineno"></span><span class="op" id="5560927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5560930">func</span>&nbsp;<span class="op" id="5560935">(</span><span class="ident" id="5560936">p</span>&nbsp;<span class="op" id="5560938">*</span><span class="ident" id="5560939">parser</span><span class="op" id="5560945">)</span>&nbsp;<span class="ident" id="5560947">newRegexp</span><span class="op" id="5560956">(</span><span class="ident" id="5560957">op</span>&nbsp;<span class="ident" id="5560960">Op</span><span class="op" id="5560962">)</span>&nbsp;<span class="op" id="5560964">*</span><span class="ident" id="5560965">Regexp</span>&nbsp;<span class="op" id="5560972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5560975">re</span>&nbsp;<span class="op" id="5560978">:=</span>&nbsp;<span class="ident" id="5560981">p</span><span class="op" id="5560982">.</span><span class="ident" id="5560983">free</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5560989">if</span>&nbsp;<span class="ident" id="5560992">re</span>&nbsp;<span class="op" id="5560995">!=</span>&nbsp;<span class="ident" id="5560998">nil</span>&nbsp;<span class="op" id="5561002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561006">p</span><span class="op" id="5561007">.</span><span class="ident" id="5561008">free</span>&nbsp;<span class="op" id="5561013">=</span>&nbsp;<span class="ident" id="5561015">re</span><span class="op" id="5561017">.</span><span class="ident" id="5561018">Sub0</span><span class="op" id="5561022">[</span><span class="num" id="5561023">0</span><span class="op" id="5561024">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5561028">*</span><span class="ident" id="5561029">re</span>&nbsp;<span class="op" id="5561032">=</span>&nbsp;<span class="ident" id="5561034">Regexp</span><span class="op" id="5561040">{</span><span class="op" id="5561041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5561044">}</span>&nbsp;<span class="keyword" id="5561046">else</span>&nbsp;<span class="op" id="5561051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561055">re</span>&nbsp;<span class="op" id="5561058">=</span>&nbsp;<span class="builtinfunc" id="5561060">new</span><span class="op" id="5561063">(</span><span class="ident" id="5561064">Regexp</span><span class="op" id="5561070">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5561073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561076">re</span><span class="op" id="5561078">.</span><span class="ident" id="5561079">Op</span>&nbsp;<span class="op" id="5561082">=</span>&nbsp;<span class="ident" id="5561084">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5561088">return</span>&nbsp;<span class="ident" id="5561095">re</span><br>
<span class="lineno"></span><span class="op" id="5561098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="5561101">func</span>&nbsp;<span class="op" id="5561106">(</span><span class="ident" id="5561107">p</span>&nbsp;<span class="op" id="5561109">*</span><span class="ident" id="5561110">parser</span><span class="op" id="5561116">)</span>&nbsp;<span class="ident" id="5561118">reuse</span><span class="op" id="5561123">(</span><span class="ident" id="5561124">re</span>&nbsp;<span class="op" id="5561127">*</span><span class="ident" id="5561128">Regexp</span><span class="op" id="5561134">)</span>&nbsp;<span class="op" id="5561136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561139">re</span><span class="op" id="5561141">.</span><span class="ident" id="5561142">Sub0</span><span class="op" id="5561146">[</span><span class="num" id="5561147">0</span><span class="op" id="5561148">]</span>&nbsp;<span class="op" id="5561150">=</span>&nbsp;<span class="ident" id="5561152">p</span><span class="op" id="5561153">.</span><span class="ident" id="5561154">free</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561160">p</span><span class="op" id="5561161">.</span><span class="ident" id="5561162">free</span>&nbsp;<span class="op" id="5561167">=</span>&nbsp;<span class="ident" id="5561169">re</span><br>
<span class="lineno"></span><span class="op" id="5561172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="5561175">//&nbsp;Parse&nbsp;stack&nbsp;manipulation.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5561205">//&nbsp;push&nbsp;pushes&nbsp;the&nbsp;regexp&nbsp;re&nbsp;onto&nbsp;the&nbsp;parse&nbsp;stack&nbsp;and&nbsp;returns&nbsp;the&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="keyword" id="5561279">func</span>&nbsp;<span class="op" id="5561284">(</span><span class="ident" id="5561285">p</span>&nbsp;<span class="op" id="5561287">*</span><span class="ident" id="5561288">parser</span><span class="op" id="5561294">)</span>&nbsp;<span class="ident" id="5561296">push</span><span class="op" id="5561300">(</span><span class="ident" id="5561301">re</span>&nbsp;<span class="op" id="5561304">*</span><span class="ident" id="5561305">Regexp</span><span class="op" id="5561311">)</span>&nbsp;<span class="op" id="5561313">*</span><span class="ident" id="5561314">Regexp</span>&nbsp;<span class="op" id="5561321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5561324">if</span>&nbsp;<span class="ident" id="5561327">re</span><span class="op" id="5561329">.</span><span class="ident" id="5561330">Op</span>&nbsp;<span class="op" id="5561333">==</span>&nbsp;<span class="ident" id="5561336">OpCharClass</span>&nbsp;<span class="op" id="5561348">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5561351">len</span><span class="op" id="5561354">(</span><span class="ident" id="5561355">re</span><span class="op" id="5561357">.</span><span class="ident" id="5561358">Rune</span><span class="op" id="5561362">)</span>&nbsp;<span class="op" id="5561364">==</span>&nbsp;<span class="num" id="5561367">2</span>&nbsp;<span class="op" id="5561369">&amp;&amp;</span>&nbsp;<span class="ident" id="5561372">re</span><span class="op" id="5561374">.</span><span class="ident" id="5561375">Rune</span><span class="op" id="5561379">[</span><span class="num" id="5561380">0</span><span class="op" id="5561381">]</span>&nbsp;<span class="op" id="5561383">==</span>&nbsp;<span class="ident" id="5561386">re</span><span class="op" id="5561388">.</span><span class="ident" id="5561389">Rune</span><span class="op" id="5561393">[</span><span class="num" id="5561394">1</span><span class="op" id="5561395">]</span>&nbsp;<span class="op" id="5561397">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5561401">//&nbsp;Single&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5561419">if</span>&nbsp;<span class="ident" id="5561422">p</span><span class="op" id="5561423">.</span><span class="ident" id="5561424">maybeConcat</span><span class="op" id="5561435">(</span><span class="ident" id="5561436">re</span><span class="op" id="5561438">.</span><span class="ident" id="5561439">Rune</span><span class="op" id="5561443">[</span><span class="num" id="5561444">0</span><span class="op" id="5561445">]</span><span class="op" id="5561446">,</span>&nbsp;<span class="ident" id="5561448">p</span><span class="op" id="5561449">.</span><span class="ident" id="5561450">flags</span><span class="op" id="5561455">&amp;^</span><span class="ident" id="5561457">FoldCase</span><span class="op" id="5561465">)</span>&nbsp;<span class="op" id="5561467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5561472">return</span>&nbsp;<span class="ident" id="5561479">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5561485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561489">re</span><span class="op" id="5561491">.</span><span class="ident" id="5561492">Op</span>&nbsp;<span class="op" id="5561495">=</span>&nbsp;<span class="ident" id="5561497">OpLiteral</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561509">re</span><span class="op" id="5561511">.</span><span class="ident" id="5561512">Rune</span>&nbsp;<span class="op" id="5561517">=</span>&nbsp;<span class="ident" id="5561519">re</span><span class="op" id="5561521">.</span><span class="ident" id="5561522">Rune</span><span class="op" id="5561526">[</span><span class="op" id="5561527">:</span><span class="num" id="5561528">1</span><span class="op" id="5561529">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561533">re</span><span class="op" id="5561535">.</span><span class="ident" id="5561536">Flags</span>&nbsp;<span class="op" id="5561542">=</span>&nbsp;<span class="ident" id="5561544">p</span><span class="op" id="5561545">.</span><span class="ident" id="5561546">flags</span>&nbsp;<span class="op" id="5561552">&amp;^</span>&nbsp;<span class="ident" id="5561555">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5561565">}</span>&nbsp;<span class="keyword" id="5561567">else</span>&nbsp;<span class="keyword" id="5561572">if</span>&nbsp;<span class="ident" id="5561575">re</span><span class="op" id="5561577">.</span><span class="ident" id="5561578">Op</span>&nbsp;<span class="op" id="5561581">==</span>&nbsp;<span class="ident" id="5561584">OpCharClass</span>&nbsp;<span class="op" id="5561596">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5561599">len</span><span class="op" id="5561602">(</span><span class="ident" id="5561603">re</span><span class="op" id="5561605">.</span><span class="ident" id="5561606">Rune</span><span class="op" id="5561610">)</span>&nbsp;<span class="op" id="5561612">==</span>&nbsp;<span class="num" id="5561615">4</span>&nbsp;<span class="op" id="5561617">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561622">re</span><span class="op" id="5561624">.</span><span class="ident" id="5561625">Rune</span><span class="op" id="5561629">[</span><span class="num" id="5561630">0</span><span class="op" id="5561631">]</span>&nbsp;<span class="op" id="5561633">==</span>&nbsp;<span class="ident" id="5561636">re</span><span class="op" id="5561638">.</span><span class="ident" id="5561639">Rune</span><span class="op" id="5561643">[</span><span class="num" id="5561644">1</span><span class="op" id="5561645">]</span>&nbsp;<span class="op" id="5561647">&amp;&amp;</span>&nbsp;<span class="ident" id="5561650">re</span><span class="op" id="5561652">.</span><span class="ident" id="5561653">Rune</span><span class="op" id="5561657">[</span><span class="num" id="5561658">2</span><span class="op" id="5561659">]</span>&nbsp;<span class="op" id="5561661">==</span>&nbsp;<span class="ident" id="5561664">re</span><span class="op" id="5561666">.</span><span class="ident" id="5561667">Rune</span><span class="op" id="5561671">[</span><span class="num" id="5561672">3</span><span class="op" id="5561673">]</span>&nbsp;<span class="op" id="5561675">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561680">unicode</span><span class="op" id="5561687">.</span><span class="ident" id="5561688">SimpleFold</span><span class="op" id="5561698">(</span><span class="ident" id="5561699">re</span><span class="op" id="5561701">.</span><span class="ident" id="5561702">Rune</span><span class="op" id="5561706">[</span><span class="num" id="5561707">0</span><span class="op" id="5561708">]</span><span class="op" id="5561709">)</span>&nbsp;<span class="op" id="5561711">==</span>&nbsp;<span class="ident" id="5561714">re</span><span class="op" id="5561716">.</span><span class="ident" id="5561717">Rune</span><span class="op" id="5561721">[</span><span class="num" id="5561722">2</span><span class="op" id="5561723">]</span>&nbsp;<span class="op" id="5561725">&amp;&amp;</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561730">unicode</span><span class="op" id="5561737">.</span><span class="ident" id="5561738">SimpleFold</span><span class="op" id="5561748">(</span><span class="ident" id="5561749">re</span><span class="op" id="5561751">.</span><span class="ident" id="5561752">Rune</span><span class="op" id="5561756">[</span><span class="num" id="5561757">2</span><span class="op" id="5561758">]</span><span class="op" id="5561759">)</span>&nbsp;<span class="op" id="5561761">==</span>&nbsp;<span class="ident" id="5561764">re</span><span class="op" id="5561766">.</span><span class="ident" id="5561767">Rune</span><span class="op" id="5561771">[</span><span class="num" id="5561772">0</span><span class="op" id="5561773">]</span>&nbsp;<span class="op" id="5561775">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561780">re</span><span class="op" id="5561782">.</span><span class="ident" id="5561783">Op</span>&nbsp;<span class="op" id="5561786">==</span>&nbsp;<span class="ident" id="5561789">OpCharClass</span>&nbsp;<span class="op" id="5561801">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5561804">len</span><span class="op" id="5561807">(</span><span class="ident" id="5561808">re</span><span class="op" id="5561810">.</span><span class="ident" id="5561811">Rune</span><span class="op" id="5561815">)</span>&nbsp;<span class="op" id="5561817">==</span>&nbsp;<span class="num" id="5561820">2</span>&nbsp;<span class="op" id="5561822">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561828">re</span><span class="op" id="5561830">.</span><span class="ident" id="5561831">Rune</span><span class="op" id="5561835">[</span><span class="num" id="5561836">0</span><span class="op" id="5561837">]</span><span class="op" id="5561838">+</span><span class="num" id="5561839">1</span>&nbsp;<span class="op" id="5561841">==</span>&nbsp;<span class="ident" id="5561844">re</span><span class="op" id="5561846">.</span><span class="ident" id="5561847">Rune</span><span class="op" id="5561851">[</span><span class="num" id="5561852">1</span><span class="op" id="5561853">]</span>&nbsp;<span class="op" id="5561855">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561861">unicode</span><span class="op" id="5561868">.</span><span class="ident" id="5561869">SimpleFold</span><span class="op" id="5561879">(</span><span class="ident" id="5561880">re</span><span class="op" id="5561882">.</span><span class="ident" id="5561883">Rune</span><span class="op" id="5561887">[</span><span class="num" id="5561888">0</span><span class="op" id="5561889">]</span><span class="op" id="5561890">)</span>&nbsp;<span class="op" id="5561892">==</span>&nbsp;<span class="ident" id="5561895">re</span><span class="op" id="5561897">.</span><span class="ident" id="5561898">Rune</span><span class="op" id="5561902">[</span><span class="num" id="5561903">1</span><span class="op" id="5561904">]</span>&nbsp;<span class="op" id="5561906">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5561912">unicode</span><span class="op" id="5561919">.</span><span class="ident" id="5561920">SimpleFold</span><span class="op" id="5561930">(</span><span class="ident" id="5561931">re</span><span class="op" id="5561933">.</span><span class="ident" id="5561934">Rune</span><span class="op" id="5561938">[</span><span class="num" id="5561939">1</span><span class="op" id="5561940">]</span><span class="op" id="5561941">)</span>&nbsp;<span class="op" id="5561943">==</span>&nbsp;<span class="ident" id="5561946">re</span><span class="op" id="5561948">.</span><span class="ident" id="5561949">Rune</span><span class="op" id="5561953">[</span><span class="num" id="5561954">0</span><span class="op" id="5561955">]</span>&nbsp;<span class="op" id="5561957">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5561961">//&nbsp;Case-insensitive&nbsp;rune&nbsp;like&nbsp;[Aa]&nbsp;or&nbsp;[Δδ].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562009">if</span>&nbsp;<span class="ident" id="5562012">p</span><span class="op" id="5562013">.</span><span class="ident" id="5562014">maybeConcat</span><span class="op" id="5562025">(</span><span class="ident" id="5562026">re</span><span class="op" id="5562028">.</span><span class="ident" id="5562029">Rune</span><span class="op" id="5562033">[</span><span class="num" id="5562034">0</span><span class="op" id="5562035">]</span><span class="op" id="5562036">,</span>&nbsp;<span class="ident" id="5562038">p</span><span class="op" id="5562039">.</span><span class="ident" id="5562040">flags</span><span class="op" id="5562045">|</span><span class="ident" id="5562046">FoldCase</span><span class="op" id="5562054">)</span>&nbsp;<span class="op" id="5562056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562061">return</span>&nbsp;<span class="ident" id="5562068">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5562074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5562079">//&nbsp;Rewrite&nbsp;as&nbsp;(case-insensitive)&nbsp;literal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5562123">re</span><span class="op" id="5562125">.</span><span class="ident" id="5562126">Op</span>&nbsp;<span class="op" id="5562129">=</span>&nbsp;<span class="ident" id="5562131">OpLiteral</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5562143">re</span><span class="op" id="5562145">.</span><span class="ident" id="5562146">Rune</span>&nbsp;<span class="op" id="5562151">=</span>&nbsp;<span class="ident" id="5562153">re</span><span class="op" id="5562155">.</span><span class="ident" id="5562156">Rune</span><span class="op" id="5562160">[</span><span class="op" id="5562161">:</span><span class="num" id="5562162">1</span><span class="op" id="5562163">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5562167">re</span><span class="op" id="5562169">.</span><span class="ident" id="5562170">Flags</span>&nbsp;<span class="op" id="5562176">=</span>&nbsp;<span class="ident" id="5562178">p</span><span class="op" id="5562179">.</span><span class="ident" id="5562180">flags</span>&nbsp;<span class="op" id="5562186">|</span>&nbsp;<span class="ident" id="5562188">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5562198">}</span>&nbsp;<span class="keyword" id="5562200">else</span>&nbsp;<span class="op" id="5562205">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5562209">//&nbsp;Incremental&nbsp;concatenation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5562241">p</span><span class="op" id="5562242">.</span><span class="ident" id="5562243">maybeConcat</span><span class="op" id="5562254">(</span><span class="op" id="5562255">-</span><span class="num" id="5562256">1</span><span class="op" id="5562257">,</span>&nbsp;<span class="num" id="5562259">0</span><span class="op" id="5562260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5562263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5562267">p</span><span class="op" id="5562268">.</span><span class="ident" id="5562269">stack</span>&nbsp;<span class="op" id="5562275">=</span>&nbsp;<span class="builtinfunc" id="5562277">append</span><span class="op" id="5562283">(</span><span class="ident" id="5562284">p</span><span class="op" id="5562285">.</span><span class="ident" id="5562286">stack</span><span class="op" id="5562291">,</span>&nbsp;<span class="ident" id="5562293">re</span><span class="op" id="5562295">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562298">return</span>&nbsp;<span class="ident" id="5562305">re</span><br>
<span class="lineno"></span><span class="op" id="5562308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5562311">//&nbsp;maybeConcat&nbsp;implements&nbsp;incremental&nbsp;concatenation</span><br>
<span class="lineno"></span><span class="comment" id="5562363">//&nbsp;of&nbsp;literal&nbsp;runes&nbsp;into&nbsp;string&nbsp;nodes.&nbsp;&nbsp;The&nbsp;parser&nbsp;calls&nbsp;this</span><br>
<span class="lineno">145</span><span class="comment" id="5562425">//&nbsp;before&nbsp;each&nbsp;push,&nbsp;so&nbsp;only&nbsp;the&nbsp;top&nbsp;fragment&nbsp;of&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="5562484">//&nbsp;might&nbsp;need&nbsp;processing.&nbsp;&nbsp;Since&nbsp;this&nbsp;is&nbsp;called&nbsp;before&nbsp;a&nbsp;push,</span><br>
<span class="lineno"></span><span class="comment" id="5562547">//&nbsp;the&nbsp;topmost&nbsp;literal&nbsp;is&nbsp;no&nbsp;longer&nbsp;subject&nbsp;to&nbsp;operators&nbsp;like&nbsp;*</span><br>
<span class="lineno"></span><span class="comment" id="5562611">//&nbsp;(Otherwise&nbsp;ab*&nbsp;would&nbsp;turn&nbsp;into&nbsp;(ab)*.)</span><br>
<span class="lineno"></span><span class="comment" id="5562653">//&nbsp;If&nbsp;r&nbsp;&gt;=&nbsp;0&nbsp;and&nbsp;there&#39;s&nbsp;a&nbsp;node&nbsp;left&nbsp;over,&nbsp;maybeConcat&nbsp;uses&nbsp;it</span><br>
<span class="lineno">150</span><span class="comment" id="5562716">//&nbsp;to&nbsp;push&nbsp;r&nbsp;with&nbsp;the&nbsp;given&nbsp;flags.</span><br>
<span class="lineno"></span><span class="comment" id="5562751">//&nbsp;maybeConcat&nbsp;reports&nbsp;whether&nbsp;r&nbsp;was&nbsp;pushed.</span><br>
<span class="lineno"></span><span class="keyword" id="5562796">func</span>&nbsp;<span class="op" id="5562801">(</span><span class="ident" id="5562802">p</span>&nbsp;<span class="op" id="5562804">*</span><span class="ident" id="5562805">parser</span><span class="op" id="5562811">)</span>&nbsp;<span class="ident" id="5562813">maybeConcat</span><span class="op" id="5562824">(</span><span class="ident" id="5562825">r</span>&nbsp;<span class="builtintype" id="5562827">rune</span><span class="op" id="5562831">,</span>&nbsp;<span class="ident" id="5562833">flags</span>&nbsp;<span class="ident" id="5562839">Flags</span><span class="op" id="5562844">)</span>&nbsp;<span class="builtintype" id="5562846">bool</span>&nbsp;<span class="op" id="5562851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5562854">n</span>&nbsp;<span class="op" id="5562856">:=</span>&nbsp;<span class="builtinfunc" id="5562859">len</span><span class="op" id="5562862">(</span><span class="ident" id="5562863">p</span><span class="op" id="5562864">.</span><span class="ident" id="5562865">stack</span><span class="op" id="5562870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562873">if</span>&nbsp;<span class="ident" id="5562876">n</span>&nbsp;<span class="op" id="5562878">&lt;</span>&nbsp;<span class="num" id="5562880">2</span>&nbsp;<span class="op" id="5562882">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562886">return</span>&nbsp;<span class="builtintype" id="5562893">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5562900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5562904">re1</span>&nbsp;<span class="op" id="5562908">:=</span>&nbsp;<span class="ident" id="5562911">p</span><span class="op" id="5562912">.</span><span class="ident" id="5562913">stack</span><span class="op" id="5562918">[</span><span class="ident" id="5562919">n</span><span class="op" id="5562920">-</span><span class="num" id="5562921">1</span><span class="op" id="5562922">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5562925">re2</span>&nbsp;<span class="op" id="5562929">:=</span>&nbsp;<span class="ident" id="5562932">p</span><span class="op" id="5562933">.</span><span class="ident" id="5562934">stack</span><span class="op" id="5562939">[</span><span class="ident" id="5562940">n</span><span class="op" id="5562941">-</span><span class="num" id="5562942">2</span><span class="op" id="5562943">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5562946">if</span>&nbsp;<span class="ident" id="5562949">re1</span><span class="op" id="5562952">.</span><span class="ident" id="5562953">Op</span>&nbsp;<span class="op" id="5562956">!=</span>&nbsp;<span class="ident" id="5562959">OpLiteral</span>&nbsp;<span class="op" id="5562969">||</span>&nbsp;<span class="ident" id="5562972">re2</span><span class="op" id="5562975">.</span><span class="ident" id="5562976">Op</span>&nbsp;<span class="op" id="5562979">!=</span>&nbsp;<span class="ident" id="5562982">OpLiteral</span>&nbsp;<span class="op" id="5562992">||</span>&nbsp;<span class="ident" id="5562995">re1</span><span class="op" id="5562998">.</span><span class="ident" id="5562999">Flags</span><span class="op" id="5563004">&amp;</span><span class="ident" id="5563005">FoldCase</span>&nbsp;<span class="op" id="5563014">!=</span>&nbsp;<span class="ident" id="5563017">re2</span><span class="op" id="5563020">.</span><span class="ident" id="5563021">Flags</span><span class="op" id="5563026">&amp;</span><span class="ident" id="5563027">FoldCase</span>&nbsp;<span class="op" id="5563036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563040">return</span>&nbsp;<span class="builtintype" id="5563047">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5563054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5563058">//&nbsp;Push&nbsp;re1&nbsp;into&nbsp;re2.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5563081">re2</span><span class="op" id="5563084">.</span><span class="ident" id="5563085">Rune</span>&nbsp;<span class="op" id="5563090">=</span>&nbsp;<span class="builtinfunc" id="5563092">append</span><span class="op" id="5563098">(</span><span class="ident" id="5563099">re2</span><span class="op" id="5563102">.</span><span class="ident" id="5563103">Rune</span><span class="op" id="5563107">,</span>&nbsp;<span class="ident" id="5563109">re1</span><span class="op" id="5563112">.</span><span class="ident" id="5563113">Rune</span><span class="op" id="5563117">...</span><span class="op" id="5563120">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5563124">//&nbsp;Reuse&nbsp;re1&nbsp;if&nbsp;possible.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563151">if</span>&nbsp;<span class="ident" id="5563154">r</span>&nbsp;<span class="op" id="5563156">&gt;=</span>&nbsp;<span class="num" id="5563159">0</span>&nbsp;<span class="op" id="5563161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5563165">re1</span><span class="op" id="5563168">.</span><span class="ident" id="5563169">Rune</span>&nbsp;<span class="op" id="5563174">=</span>&nbsp;<span class="ident" id="5563176">re1</span><span class="op" id="5563179">.</span><span class="ident" id="5563180">Rune0</span><span class="op" id="5563185">[</span><span class="op" id="5563186">:</span><span class="num" id="5563187">1</span><span class="op" id="5563188">]</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5563192">re1</span><span class="op" id="5563195">.</span><span class="ident" id="5563196">Rune</span><span class="op" id="5563200">[</span><span class="num" id="5563201">0</span><span class="op" id="5563202">]</span>&nbsp;<span class="op" id="5563204">=</span>&nbsp;<span class="ident" id="5563206">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5563210">re1</span><span class="op" id="5563213">.</span><span class="ident" id="5563214">Flags</span>&nbsp;<span class="op" id="5563220">=</span>&nbsp;<span class="ident" id="5563222">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563230">return</span>&nbsp;<span class="builtintype" id="5563237">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5563243">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5563247">p</span><span class="op" id="5563248">.</span><span class="ident" id="5563249">stack</span>&nbsp;<span class="op" id="5563255">=</span>&nbsp;<span class="ident" id="5563257">p</span><span class="op" id="5563258">.</span><span class="ident" id="5563259">stack</span><span class="op" id="5563264">[</span><span class="op" id="5563265">:</span><span class="ident" id="5563266">n</span><span class="op" id="5563267">-</span><span class="num" id="5563268">1</span><span class="op" id="5563269">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5563272">p</span><span class="op" id="5563273">.</span><span class="ident" id="5563274">reuse</span><span class="op" id="5563279">(</span><span class="ident" id="5563280">re1</span><span class="op" id="5563283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563286">return</span>&nbsp;<span class="builtintype" id="5563293">false</span>&nbsp;<span class="comment" id="5563299">//&nbsp;did&nbsp;not&nbsp;push&nbsp;r</span><br>
<span class="lineno"></span><span class="op" id="5563317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="5563320">//&nbsp;newLiteral&nbsp;returns&nbsp;a&nbsp;new&nbsp;OpLiteral&nbsp;Regexp&nbsp;with&nbsp;the&nbsp;given&nbsp;flags</span><br>
<span class="lineno"></span><span class="keyword" id="5563386">func</span>&nbsp;<span class="op" id="5563391">(</span><span class="ident" id="5563392">p</span>&nbsp;<span class="op" id="5563394">*</span><span class="ident" id="5563395">parser</span><span class="op" id="5563401">)</span>&nbsp;<span class="ident" id="5563403">newLiteral</span><span class="op" id="5563413">(</span><span class="ident" id="5563414">r</span>&nbsp;<span class="builtintype" id="5563416">rune</span><span class="op" id="5563420">,</span>&nbsp;<span class="ident" id="5563422">flags</span>&nbsp;<span class="ident" id="5563428">Flags</span><span class="op" id="5563433">)</span>&nbsp;<span class="op" id="5563435">*</span><span class="ident" id="5563436">Regexp</span>&nbsp;<span class="op" id="5563443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5563446">re</span>&nbsp;<span class="op" id="5563449">:=</span>&nbsp;<span class="ident" id="5563452">p</span><span class="op" id="5563453">.</span><span class="ident" id="5563454">newRegexp</span><span class="op" id="5563463">(</span><span class="ident" id="5563464">OpLiteral</span><span class="op" id="5563473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5563476">re</span><span class="op" id="5563478">.</span><span class="ident" id="5563479">Flags</span>&nbsp;<span class="op" id="5563485">=</span>&nbsp;<span class="ident" id="5563487">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563494">if</span>&nbsp;<span class="ident" id="5563497">flags</span><span class="op" id="5563502">&amp;</span><span class="ident" id="5563503">FoldCase</span>&nbsp;<span class="op" id="5563512">!=</span>&nbsp;<span class="num" id="5563515">0</span>&nbsp;<span class="op" id="5563517">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5563521">r</span>&nbsp;<span class="op" id="5563523">=</span>&nbsp;<span class="ident" id="5563525">minFoldRune</span><span class="op" id="5563536">(</span><span class="ident" id="5563537">r</span><span class="op" id="5563538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5563541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5563544">re</span><span class="op" id="5563546">.</span><span class="ident" id="5563547">Rune0</span><span class="op" id="5563552">[</span><span class="num" id="5563553">0</span><span class="op" id="5563554">]</span>&nbsp;<span class="op" id="5563556">=</span>&nbsp;<span class="ident" id="5563558">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5563561">re</span><span class="op" id="5563563">.</span><span class="ident" id="5563564">Rune</span>&nbsp;<span class="op" id="5563569">=</span>&nbsp;<span class="ident" id="5563571">re</span><span class="op" id="5563573">.</span><span class="ident" id="5563574">Rune0</span><span class="op" id="5563579">[</span><span class="op" id="5563580">:</span><span class="num" id="5563581">1</span><span class="op" id="5563582">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563585">return</span>&nbsp;<span class="ident" id="5563592">re</span><br>
<span class="lineno">190</span><span class="op" id="5563595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5563598">//&nbsp;minFoldRune&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;rune&nbsp;fold-equivalent&nbsp;to&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5563660">func</span>&nbsp;<span class="ident" id="5563665">minFoldRune</span><span class="op" id="5563676">(</span><span class="ident" id="5563677">r</span>&nbsp;<span class="builtintype" id="5563679">rune</span><span class="op" id="5563683">)</span>&nbsp;<span class="builtintype" id="5563685">rune</span>&nbsp;<span class="op" id="5563690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563693">if</span>&nbsp;<span class="ident" id="5563696">r</span>&nbsp;<span class="op" id="5563698">&lt;</span>&nbsp;<span class="ident" id="5563700">minFold</span>&nbsp;<span class="op" id="5563708">||</span>&nbsp;<span class="ident" id="5563711">r</span>&nbsp;<span class="op" id="5563713">&gt;</span>&nbsp;<span class="ident" id="5563715">maxFold</span>&nbsp;<span class="op" id="5563723">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563727">return</span>&nbsp;<span class="ident" id="5563734">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5563737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5563740">min</span>&nbsp;<span class="op" id="5563744">:=</span>&nbsp;<span class="ident" id="5563747">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5563750">r0</span>&nbsp;<span class="op" id="5563753">:=</span>&nbsp;<span class="ident" id="5563756">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563759">for</span>&nbsp;<span class="ident" id="5563763">r</span>&nbsp;<span class="op" id="5563765">=</span>&nbsp;<span class="ident" id="5563767">unicode</span><span class="op" id="5563774">.</span><span class="ident" id="5563775">SimpleFold</span><span class="op" id="5563785">(</span><span class="ident" id="5563786">r</span><span class="op" id="5563787">)</span><span class="op" id="5563788">;</span>&nbsp;<span class="ident" id="5563790">r</span>&nbsp;<span class="op" id="5563792">!=</span>&nbsp;<span class="ident" id="5563795">r0</span><span class="op" id="5563797">;</span>&nbsp;<span class="ident" id="5563799">r</span>&nbsp;<span class="op" id="5563801">=</span>&nbsp;<span class="ident" id="5563803">unicode</span><span class="op" id="5563810">.</span><span class="ident" id="5563811">SimpleFold</span><span class="op" id="5563821">(</span><span class="ident" id="5563822">r</span><span class="op" id="5563823">)</span>&nbsp;<span class="op" id="5563825">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563829">if</span>&nbsp;<span class="ident" id="5563832">min</span>&nbsp;<span class="op" id="5563836">&gt;</span>&nbsp;<span class="ident" id="5563838">r</span>&nbsp;<span class="op" id="5563840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5563845">min</span>&nbsp;<span class="op" id="5563849">=</span>&nbsp;<span class="ident" id="5563851">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5563855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5563858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5563861">return</span>&nbsp;<span class="ident" id="5563868">min</span><br>
<span class="lineno">205</span><span class="op" id="5563872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5563875">//&nbsp;literal&nbsp;pushes&nbsp;a&nbsp;literal&nbsp;regexp&nbsp;for&nbsp;the&nbsp;rune&nbsp;r&nbsp;on&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="5563938">//&nbsp;and&nbsp;returns&nbsp;that&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="keyword" id="5563966">func</span>&nbsp;<span class="op" id="5563971">(</span><span class="ident" id="5563972">p</span>&nbsp;<span class="op" id="5563974">*</span><span class="ident" id="5563975">parser</span><span class="op" id="5563981">)</span>&nbsp;<span class="ident" id="5563983">literal</span><span class="op" id="5563990">(</span><span class="ident" id="5563991">r</span>&nbsp;<span class="builtintype" id="5563993">rune</span><span class="op" id="5563997">)</span>&nbsp;<span class="op" id="5563999">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5564002">p</span><span class="op" id="5564003">.</span><span class="ident" id="5564004">push</span><span class="op" id="5564008">(</span><span class="ident" id="5564009">p</span><span class="op" id="5564010">.</span><span class="ident" id="5564011">newLiteral</span><span class="op" id="5564021">(</span><span class="ident" id="5564022">r</span><span class="op" id="5564023">,</span>&nbsp;<span class="ident" id="5564025">p</span><span class="op" id="5564026">.</span><span class="ident" id="5564027">flags</span><span class="op" id="5564032">)</span><span class="op" id="5564033">)</span><br>
<span class="lineno"></span><span class="op" id="5564035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5564038">//&nbsp;op&nbsp;pushes&nbsp;a&nbsp;regexp&nbsp;with&nbsp;the&nbsp;given&nbsp;op&nbsp;onto&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="5564093">//&nbsp;and&nbsp;returns&nbsp;that&nbsp;regexp.</span><br>
<span class="lineno">215</span><span class="keyword" id="5564121">func</span>&nbsp;<span class="op" id="5564126">(</span><span class="ident" id="5564127">p</span>&nbsp;<span class="op" id="5564129">*</span><span class="ident" id="5564130">parser</span><span class="op" id="5564136">)</span>&nbsp;<span class="ident" id="5564138">op</span><span class="op" id="5564140">(</span><span class="ident" id="5564141">op</span>&nbsp;<span class="ident" id="5564144">Op</span><span class="op" id="5564146">)</span>&nbsp;<span class="op" id="5564148">*</span><span class="ident" id="5564149">Regexp</span>&nbsp;<span class="op" id="5564156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5564159">re</span>&nbsp;<span class="op" id="5564162">:=</span>&nbsp;<span class="ident" id="5564165">p</span><span class="op" id="5564166">.</span><span class="ident" id="5564167">newRegexp</span><span class="op" id="5564176">(</span><span class="ident" id="5564177">op</span><span class="op" id="5564179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5564182">re</span><span class="op" id="5564184">.</span><span class="ident" id="5564185">Flags</span>&nbsp;<span class="op" id="5564191">=</span>&nbsp;<span class="ident" id="5564193">p</span><span class="op" id="5564194">.</span><span class="ident" id="5564195">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564202">return</span>&nbsp;<span class="ident" id="5564209">p</span><span class="op" id="5564210">.</span><span class="ident" id="5564211">push</span><span class="op" id="5564215">(</span><span class="ident" id="5564216">re</span><span class="op" id="5564218">)</span><br>
<span class="lineno"></span><span class="op" id="5564220">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="5564223">//&nbsp;repeat&nbsp;replaces&nbsp;the&nbsp;top&nbsp;stack&nbsp;element&nbsp;with&nbsp;itself&nbsp;repeated&nbsp;according&nbsp;to&nbsp;op,&nbsp;min,&nbsp;max.</span><br>
<span class="lineno"></span><span class="comment" id="5564312">//&nbsp;before&nbsp;is&nbsp;the&nbsp;regexp&nbsp;suffix&nbsp;starting&nbsp;at&nbsp;the&nbsp;repetition&nbsp;operator.</span><br>
<span class="lineno"></span><span class="comment" id="5564380">//&nbsp;after&nbsp;is&nbsp;the&nbsp;regexp&nbsp;suffix&nbsp;following&nbsp;after&nbsp;the&nbsp;repetition&nbsp;operator.</span><br>
<span class="lineno"></span><span class="comment" id="5564451">//&nbsp;repeat&nbsp;returns&nbsp;an&nbsp;updated&nbsp;&#39;after&#39;&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">225</span><span class="keyword" id="5564510">func</span>&nbsp;<span class="op" id="5564515">(</span><span class="ident" id="5564516">p</span>&nbsp;<span class="op" id="5564518">*</span><span class="ident" id="5564519">parser</span><span class="op" id="5564525">)</span>&nbsp;<span class="ident" id="5564527">repeat</span><span class="op" id="5564533">(</span><span class="ident" id="5564534">op</span>&nbsp;<span class="ident" id="5564537">Op</span><span class="op" id="5564539">,</span>&nbsp;<span class="ident" id="5564541">min</span><span class="op" id="5564544">,</span>&nbsp;<span class="ident" id="5564546">max</span>&nbsp;<span class="builtintype" id="5564550">int</span><span class="op" id="5564553">,</span>&nbsp;<span class="ident" id="5564555">before</span><span class="op" id="5564561">,</span>&nbsp;<span class="ident" id="5564563">after</span><span class="op" id="5564568">,</span>&nbsp;<span class="ident" id="5564570">lastRepeat</span>&nbsp;<span class="builtintype" id="5564581">string</span><span class="op" id="5564587">)</span>&nbsp;<span class="op" id="5564589">(</span><span class="builtintype" id="5564590">string</span><span class="op" id="5564596">,</span>&nbsp;<span class="builtintype" id="5564598">error</span><span class="op" id="5564603">)</span>&nbsp;<span class="op" id="5564605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5564608">flags</span>&nbsp;<span class="op" id="5564614">:=</span>&nbsp;<span class="ident" id="5564617">p</span><span class="op" id="5564618">.</span><span class="ident" id="5564619">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564626">if</span>&nbsp;<span class="ident" id="5564629">p</span><span class="op" id="5564630">.</span><span class="ident" id="5564631">flags</span><span class="op" id="5564636">&amp;</span><span class="ident" id="5564637">PerlX</span>&nbsp;<span class="op" id="5564643">!=</span>&nbsp;<span class="num" id="5564646">0</span>&nbsp;<span class="op" id="5564648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564652">if</span>&nbsp;<span class="builtinfunc" id="5564655">len</span><span class="op" id="5564658">(</span><span class="ident" id="5564659">after</span><span class="op" id="5564664">)</span>&nbsp;<span class="op" id="5564666">&gt;</span>&nbsp;<span class="num" id="5564668">0</span>&nbsp;<span class="op" id="5564670">&amp;&amp;</span>&nbsp;<span class="ident" id="5564673">after</span><span class="op" id="5564678">[</span><span class="num" id="5564679">0</span><span class="op" id="5564680">]</span>&nbsp;<span class="op" id="5564682">==</span>&nbsp;<span class="string" id="5564685">&#39;?&#39;</span>&nbsp;<span class="op" id="5564689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5564694">after</span>&nbsp;<span class="op" id="5564700">=</span>&nbsp;<span class="ident" id="5564702">after</span><span class="op" id="5564707">[</span><span class="num" id="5564708">1</span><span class="op" id="5564709">:</span><span class="op" id="5564710">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5564715">flags</span>&nbsp;<span class="op" id="5564721">^=</span>&nbsp;<span class="ident" id="5564724">NonGreedy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5564736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564740">if</span>&nbsp;<span class="ident" id="5564743">lastRepeat</span>&nbsp;<span class="op" id="5564754">!=</span>&nbsp;<span class="string" id="5564757">&#34;&#34;</span>&nbsp;<span class="op" id="5564760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5564765">//&nbsp;In&nbsp;Perl&nbsp;it&nbsp;is&nbsp;not&nbsp;allowed&nbsp;to&nbsp;stack&nbsp;repetition&nbsp;operators:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5564828">//&nbsp;a**&nbsp;is&nbsp;a&nbsp;syntax&nbsp;error,&nbsp;not&nbsp;a&nbsp;doubled&nbsp;star,&nbsp;and&nbsp;a++&nbsp;means</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5564891">//&nbsp;something&nbsp;else&nbsp;entirely,&nbsp;which&nbsp;we&nbsp;don&#39;t&nbsp;support!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5564946">return</span>&nbsp;<span class="string" id="5564953">&#34;&#34;</span><span class="op" id="5564955">,</span>&nbsp;<span class="op" id="5564957">&amp;</span><span class="ident" id="5564958">Error</span><span class="op" id="5564963">{</span><span class="ident" id="5564964">ErrInvalidRepeatOp</span><span class="op" id="5564982">,</span>&nbsp;<span class="ident" id="5564984">lastRepeat</span><span class="op" id="5564994">[</span><span class="op" id="5564995">:</span><span class="builtinfunc" id="5564996">len</span><span class="op" id="5564999">(</span><span class="ident" id="5565000">lastRepeat</span><span class="op" id="5565010">)</span><span class="op" id="5565011">-</span><span class="builtinfunc" id="5565012">len</span><span class="op" id="5565015">(</span><span class="ident" id="5565016">after</span><span class="op" id="5565021">)</span><span class="op" id="5565022">]</span><span class="op" id="5565023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5565027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5565030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565033">n</span>&nbsp;<span class="op" id="5565035">:=</span>&nbsp;<span class="builtinfunc" id="5565038">len</span><span class="op" id="5565041">(</span><span class="ident" id="5565042">p</span><span class="op" id="5565043">.</span><span class="ident" id="5565044">stack</span><span class="op" id="5565049">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565052">if</span>&nbsp;<span class="ident" id="5565055">n</span>&nbsp;<span class="op" id="5565057">==</span>&nbsp;<span class="num" id="5565060">0</span>&nbsp;<span class="op" id="5565062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565066">return</span>&nbsp;<span class="string" id="5565073">&#34;&#34;</span><span class="op" id="5565075">,</span>&nbsp;<span class="op" id="5565077">&amp;</span><span class="ident" id="5565078">Error</span><span class="op" id="5565083">{</span><span class="ident" id="5565084">ErrMissingRepeatArgument</span><span class="op" id="5565108">,</span>&nbsp;<span class="ident" id="5565110">before</span><span class="op" id="5565116">[</span><span class="op" id="5565117">:</span><span class="builtinfunc" id="5565118">len</span><span class="op" id="5565121">(</span><span class="ident" id="5565122">before</span><span class="op" id="5565128">)</span><span class="op" id="5565129">-</span><span class="builtinfunc" id="5565130">len</span><span class="op" id="5565133">(</span><span class="ident" id="5565134">after</span><span class="op" id="5565139">)</span><span class="op" id="5565140">]</span><span class="op" id="5565141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5565144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565147">sub</span>&nbsp;<span class="op" id="5565151">:=</span>&nbsp;<span class="ident" id="5565154">p</span><span class="op" id="5565155">.</span><span class="ident" id="5565156">stack</span><span class="op" id="5565161">[</span><span class="ident" id="5565162">n</span><span class="op" id="5565163">-</span><span class="num" id="5565164">1</span><span class="op" id="5565165">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565168">if</span>&nbsp;<span class="ident" id="5565171">sub</span><span class="op" id="5565174">.</span><span class="ident" id="5565175">Op</span>&nbsp;<span class="op" id="5565178">&gt;=</span>&nbsp;<span class="ident" id="5565181">opPseudo</span>&nbsp;<span class="op" id="5565190">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565194">return</span>&nbsp;<span class="string" id="5565201">&#34;&#34;</span><span class="op" id="5565203">,</span>&nbsp;<span class="op" id="5565205">&amp;</span><span class="ident" id="5565206">Error</span><span class="op" id="5565211">{</span><span class="ident" id="5565212">ErrMissingRepeatArgument</span><span class="op" id="5565236">,</span>&nbsp;<span class="ident" id="5565238">before</span><span class="op" id="5565244">[</span><span class="op" id="5565245">:</span><span class="builtinfunc" id="5565246">len</span><span class="op" id="5565249">(</span><span class="ident" id="5565250">before</span><span class="op" id="5565256">)</span><span class="op" id="5565257">-</span><span class="builtinfunc" id="5565258">len</span><span class="op" id="5565261">(</span><span class="ident" id="5565262">after</span><span class="op" id="5565267">)</span><span class="op" id="5565268">]</span><span class="op" id="5565269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5565272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565276">re</span>&nbsp;<span class="op" id="5565279">:=</span>&nbsp;<span class="ident" id="5565282">p</span><span class="op" id="5565283">.</span><span class="ident" id="5565284">newRegexp</span><span class="op" id="5565293">(</span><span class="ident" id="5565294">op</span><span class="op" id="5565296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565299">re</span><span class="op" id="5565301">.</span><span class="ident" id="5565302">Min</span>&nbsp;<span class="op" id="5565306">=</span>&nbsp;<span class="ident" id="5565308">min</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565313">re</span><span class="op" id="5565315">.</span><span class="ident" id="5565316">Max</span>&nbsp;<span class="op" id="5565320">=</span>&nbsp;<span class="ident" id="5565322">max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565327">re</span><span class="op" id="5565329">.</span><span class="ident" id="5565330">Flags</span>&nbsp;<span class="op" id="5565336">=</span>&nbsp;<span class="ident" id="5565338">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565345">re</span><span class="op" id="5565347">.</span><span class="ident" id="5565348">Sub</span>&nbsp;<span class="op" id="5565352">=</span>&nbsp;<span class="ident" id="5565354">re</span><span class="op" id="5565356">.</span><span class="ident" id="5565357">Sub0</span><span class="op" id="5565361">[</span><span class="op" id="5565362">:</span><span class="num" id="5565363">1</span><span class="op" id="5565364">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565367">re</span><span class="op" id="5565369">.</span><span class="ident" id="5565370">Sub</span><span class="op" id="5565373">[</span><span class="num" id="5565374">0</span><span class="op" id="5565375">]</span>&nbsp;<span class="op" id="5565377">=</span>&nbsp;<span class="ident" id="5565379">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5565384">p</span><span class="op" id="5565385">.</span><span class="ident" id="5565386">stack</span><span class="op" id="5565391">[</span><span class="ident" id="5565392">n</span><span class="op" id="5565393">-</span><span class="num" id="5565394">1</span><span class="op" id="5565395">]</span>&nbsp;<span class="op" id="5565397">=</span>&nbsp;<span class="ident" id="5565399">re</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565404">if</span>&nbsp;<span class="ident" id="5565407">op</span>&nbsp;<span class="op" id="5565410">==</span>&nbsp;<span class="ident" id="5565413">OpRepeat</span>&nbsp;<span class="op" id="5565422">&amp;&amp;</span>&nbsp;<span class="op" id="5565425">(</span><span class="ident" id="5565426">min</span>&nbsp;<span class="op" id="5565430">&gt;=</span>&nbsp;<span class="num" id="5565433">2</span>&nbsp;<span class="op" id="5565435">||</span>&nbsp;<span class="ident" id="5565438">max</span>&nbsp;<span class="op" id="5565442">&gt;=</span>&nbsp;<span class="num" id="5565445">2</span><span class="op" id="5565446">)</span>&nbsp;<span class="op" id="5565448">&amp;&amp;</span>&nbsp;<span class="op" id="5565451">!</span><span class="ident" id="5565452">repeatIsValid</span><span class="op" id="5565465">(</span><span class="ident" id="5565466">re</span><span class="op" id="5565468">,</span>&nbsp;<span class="num" id="5565470">1000</span><span class="op" id="5565474">)</span>&nbsp;<span class="op" id="5565476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565480">return</span>&nbsp;<span class="string" id="5565487">&#34;&#34;</span><span class="op" id="5565489">,</span>&nbsp;<span class="op" id="5565491">&amp;</span><span class="ident" id="5565492">Error</span><span class="op" id="5565497">{</span><span class="ident" id="5565498">ErrInvalidRepeatSize</span><span class="op" id="5565518">,</span>&nbsp;<span class="ident" id="5565520">before</span><span class="op" id="5565526">[</span><span class="op" id="5565527">:</span><span class="builtinfunc" id="5565528">len</span><span class="op" id="5565531">(</span><span class="ident" id="5565532">before</span><span class="op" id="5565538">)</span><span class="op" id="5565539">-</span><span class="builtinfunc" id="5565540">len</span><span class="op" id="5565543">(</span><span class="ident" id="5565544">after</span><span class="op" id="5565549">)</span><span class="op" id="5565550">]</span><span class="op" id="5565551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5565554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5565558">return</span>&nbsp;<span class="ident" id="5565565">after</span><span class="op" id="5565570">,</span>&nbsp;<span class="ident" id="5565572">nil</span><br>
<span class="lineno"></span><span class="op" id="5565576">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5565579">//&nbsp;repeatIsValid&nbsp;reports&nbsp;whether&nbsp;the&nbsp;repetition&nbsp;re&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="comment" id="5565640">//&nbsp;Valid&nbsp;means&nbsp;that&nbsp;the&nbsp;combination&nbsp;of&nbsp;the&nbsp;top-level&nbsp;repetition</span><br>
<span class="lineno">265</span><span class="comment" id="5565704">//&nbsp;and&nbsp;any&nbsp;inner&nbsp;repetitions&nbsp;does&nbsp;not&nbsp;exceed&nbsp;n&nbsp;copies&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5565765">//&nbsp;innermost&nbsp;thing.</span><br>
<span class="lineno"></span><span class="comment" id="5565785">//&nbsp;This&nbsp;function&nbsp;rewalks&nbsp;the&nbsp;regexp&nbsp;tree&nbsp;and&nbsp;is&nbsp;called&nbsp;for&nbsp;every&nbsp;repetition,</span><br>
<span class="lineno"></span><span class="comment" id="5565862">//&nbsp;so&nbsp;we&nbsp;have&nbsp;to&nbsp;worry&nbsp;about&nbsp;inducing&nbsp;quadratic&nbsp;behavior&nbsp;in&nbsp;the&nbsp;parser.</span><br>
<span class="lineno"></span><span class="comment" id="5565934">//&nbsp;We&nbsp;avoid&nbsp;this&nbsp;by&nbsp;only&nbsp;calling&nbsp;repeatIsValid&nbsp;when&nbsp;min&nbsp;or&nbsp;max&nbsp;&gt;=&nbsp;2.</span><br>
<span class="lineno">270</span><span class="comment" id="5566003">//&nbsp;In&nbsp;that&nbsp;case&nbsp;the&nbsp;depth&nbsp;of&nbsp;any&nbsp;&gt;=&nbsp;2&nbsp;nesting&nbsp;can&nbsp;only&nbsp;get&nbsp;to&nbsp;9&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="5566075">//&nbsp;triggering&nbsp;a&nbsp;parse&nbsp;error,&nbsp;so&nbsp;each&nbsp;subtree&nbsp;can&nbsp;only&nbsp;be&nbsp;rewalked&nbsp;9&nbsp;times.</span><br>
<span class="lineno"></span><span class="keyword" id="5566150">func</span>&nbsp;<span class="ident" id="5566155">repeatIsValid</span><span class="op" id="5566168">(</span><span class="ident" id="5566169">re</span>&nbsp;<span class="op" id="5566172">*</span><span class="ident" id="5566173">Regexp</span><span class="op" id="5566179">,</span>&nbsp;<span class="ident" id="5566181">n</span>&nbsp;<span class="builtintype" id="5566183">int</span><span class="op" id="5566186">)</span>&nbsp;<span class="builtintype" id="5566188">bool</span>&nbsp;<span class="op" id="5566193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566196">if</span>&nbsp;<span class="ident" id="5566199">re</span><span class="op" id="5566201">.</span><span class="ident" id="5566202">Op</span>&nbsp;<span class="op" id="5566205">==</span>&nbsp;<span class="ident" id="5566208">OpRepeat</span>&nbsp;<span class="op" id="5566217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566221">m</span>&nbsp;<span class="op" id="5566223">:=</span>&nbsp;<span class="ident" id="5566226">re</span><span class="op" id="5566228">.</span><span class="ident" id="5566229">Max</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566235">if</span>&nbsp;<span class="ident" id="5566238">m</span>&nbsp;<span class="op" id="5566240">==</span>&nbsp;<span class="num" id="5566243">0</span>&nbsp;<span class="op" id="5566245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566250">return</span>&nbsp;<span class="builtintype" id="5566257">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5566264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566268">if</span>&nbsp;<span class="ident" id="5566271">m</span>&nbsp;<span class="op" id="5566273">&lt;</span>&nbsp;<span class="num" id="5566275">0</span>&nbsp;<span class="op" id="5566277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566282">m</span>&nbsp;<span class="op" id="5566284">=</span>&nbsp;<span class="ident" id="5566286">re</span><span class="op" id="5566288">.</span><span class="ident" id="5566289">Min</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5566295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566299">if</span>&nbsp;<span class="ident" id="5566302">m</span>&nbsp;<span class="op" id="5566304">&gt;</span>&nbsp;<span class="ident" id="5566306">n</span>&nbsp;<span class="op" id="5566308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566313">return</span>&nbsp;<span class="builtintype" id="5566320">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5566328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566332">if</span>&nbsp;<span class="ident" id="5566335">m</span>&nbsp;<span class="op" id="5566337">&gt;</span>&nbsp;<span class="num" id="5566339">0</span>&nbsp;<span class="op" id="5566341">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566346">n</span>&nbsp;<span class="op" id="5566348">/=</span>&nbsp;<span class="ident" id="5566351">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5566355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5566358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566361">for</span>&nbsp;<span class="ident" id="5566365">_</span><span class="op" id="5566366">,</span>&nbsp;<span class="ident" id="5566368">sub</span>&nbsp;<span class="op" id="5566372">:=</span>&nbsp;<span class="keyword" id="5566375">range</span>&nbsp;<span class="ident" id="5566381">re</span><span class="op" id="5566383">.</span><span class="ident" id="5566384">Sub</span>&nbsp;<span class="op" id="5566388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566392">if</span>&nbsp;<span class="op" id="5566395">!</span><span class="ident" id="5566396">repeatIsValid</span><span class="op" id="5566409">(</span><span class="ident" id="5566410">sub</span><span class="op" id="5566413">,</span>&nbsp;<span class="ident" id="5566415">n</span><span class="op" id="5566416">)</span>&nbsp;<span class="op" id="5566418">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566423">return</span>&nbsp;<span class="builtintype" id="5566430">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5566438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5566441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566444">return</span>&nbsp;<span class="builtintype" id="5566451">true</span><br>
<span class="lineno"></span><span class="op" id="5566456">}</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span><span class="comment" id="5566459">//&nbsp;concat&nbsp;replaces&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;(above&nbsp;the&nbsp;topmost&nbsp;&#39;|&#39;&nbsp;or&nbsp;&#39;(&#39;)&nbsp;with&nbsp;its&nbsp;concatenation.</span><br>
<span class="lineno"></span><span class="keyword" id="5566554">func</span>&nbsp;<span class="op" id="5566559">(</span><span class="ident" id="5566560">p</span>&nbsp;<span class="op" id="5566562">*</span><span class="ident" id="5566563">parser</span><span class="op" id="5566569">)</span>&nbsp;<span class="ident" id="5566571">concat</span><span class="op" id="5566577">(</span><span class="op" id="5566578">)</span>&nbsp;<span class="op" id="5566580">*</span><span class="ident" id="5566581">Regexp</span>&nbsp;<span class="op" id="5566588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566591">p</span><span class="op" id="5566592">.</span><span class="ident" id="5566593">maybeConcat</span><span class="op" id="5566604">(</span><span class="op" id="5566605">-</span><span class="num" id="5566606">1</span><span class="op" id="5566607">,</span>&nbsp;<span class="num" id="5566609">0</span><span class="op" id="5566610">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5566614">//&nbsp;Scan&nbsp;down&nbsp;to&nbsp;find&nbsp;pseudo-operator&nbsp;|&nbsp;or&nbsp;(.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566660">i</span>&nbsp;<span class="op" id="5566662">:=</span>&nbsp;<span class="builtinfunc" id="5566665">len</span><span class="op" id="5566668">(</span><span class="ident" id="5566669">p</span><span class="op" id="5566670">.</span><span class="ident" id="5566671">stack</span><span class="op" id="5566676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566679">for</span>&nbsp;<span class="ident" id="5566683">i</span>&nbsp;<span class="op" id="5566685">&gt;</span>&nbsp;<span class="num" id="5566687">0</span>&nbsp;<span class="op" id="5566689">&amp;&amp;</span>&nbsp;<span class="ident" id="5566692">p</span><span class="op" id="5566693">.</span><span class="ident" id="5566694">stack</span><span class="op" id="5566699">[</span><span class="ident" id="5566700">i</span><span class="op" id="5566701">-</span><span class="num" id="5566702">1</span><span class="op" id="5566703">]</span><span class="op" id="5566704">.</span><span class="ident" id="5566705">Op</span>&nbsp;<span class="op" id="5566708">&lt;</span>&nbsp;<span class="ident" id="5566710">opPseudo</span>&nbsp;<span class="op" id="5566719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566723">i</span><span class="op" id="5566724">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5566728">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566731">subs</span>&nbsp;<span class="op" id="5566736">:=</span>&nbsp;<span class="ident" id="5566739">p</span><span class="op" id="5566740">.</span><span class="ident" id="5566741">stack</span><span class="op" id="5566746">[</span><span class="ident" id="5566747">i</span><span class="op" id="5566748">:</span><span class="op" id="5566749">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5566752">p</span><span class="op" id="5566753">.</span><span class="ident" id="5566754">stack</span>&nbsp;<span class="op" id="5566760">=</span>&nbsp;<span class="ident" id="5566762">p</span><span class="op" id="5566763">.</span><span class="ident" id="5566764">stack</span><span class="op" id="5566769">[</span><span class="op" id="5566770">:</span><span class="ident" id="5566771">i</span><span class="op" id="5566772">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5566776">//&nbsp;Empty&nbsp;concatenation&nbsp;is&nbsp;special&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566817">if</span>&nbsp;<span class="builtinfunc" id="5566820">len</span><span class="op" id="5566823">(</span><span class="ident" id="5566824">subs</span><span class="op" id="5566828">)</span>&nbsp;<span class="op" id="5566830">==</span>&nbsp;<span class="num" id="5566833">0</span>&nbsp;<span class="op" id="5566835">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566839">return</span>&nbsp;<span class="ident" id="5566846">p</span><span class="op" id="5566847">.</span><span class="ident" id="5566848">push</span><span class="op" id="5566852">(</span><span class="ident" id="5566853">p</span><span class="op" id="5566854">.</span><span class="ident" id="5566855">newRegexp</span><span class="op" id="5566864">(</span><span class="ident" id="5566865">OpEmptyMatch</span><span class="op" id="5566877">)</span><span class="op" id="5566878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5566881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5566885">return</span>&nbsp;<span class="ident" id="5566892">p</span><span class="op" id="5566893">.</span><span class="ident" id="5566894">push</span><span class="op" id="5566898">(</span><span class="ident" id="5566899">p</span><span class="op" id="5566900">.</span><span class="ident" id="5566901">collapse</span><span class="op" id="5566909">(</span><span class="ident" id="5566910">subs</span><span class="op" id="5566914">,</span>&nbsp;<span class="ident" id="5566916">OpConcat</span><span class="op" id="5566924">)</span><span class="op" id="5566925">)</span><br>
<span class="lineno"></span><span class="op" id="5566927">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="comment" id="5566930">//&nbsp;alternate&nbsp;replaces&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;(above&nbsp;the&nbsp;topmost&nbsp;&#39;(&#39;)&nbsp;with&nbsp;its&nbsp;alternation.</span><br>
<span class="lineno"></span><span class="keyword" id="5567019">func</span>&nbsp;<span class="op" id="5567024">(</span><span class="ident" id="5567025">p</span>&nbsp;<span class="op" id="5567027">*</span><span class="ident" id="5567028">parser</span><span class="op" id="5567034">)</span>&nbsp;<span class="ident" id="5567036">alternate</span><span class="op" id="5567045">(</span><span class="op" id="5567046">)</span>&nbsp;<span class="op" id="5567048">*</span><span class="ident" id="5567049">Regexp</span>&nbsp;<span class="op" id="5567056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5567059">//&nbsp;Scan&nbsp;down&nbsp;to&nbsp;find&nbsp;pseudo-operator&nbsp;(.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5567100">//&nbsp;There&nbsp;are&nbsp;no&nbsp;|&nbsp;above&nbsp;(.</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5567128">i</span>&nbsp;<span class="op" id="5567130">:=</span>&nbsp;<span class="builtinfunc" id="5567133">len</span><span class="op" id="5567136">(</span><span class="ident" id="5567137">p</span><span class="op" id="5567138">.</span><span class="ident" id="5567139">stack</span><span class="op" id="5567144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567147">for</span>&nbsp;<span class="ident" id="5567151">i</span>&nbsp;<span class="op" id="5567153">&gt;</span>&nbsp;<span class="num" id="5567155">0</span>&nbsp;<span class="op" id="5567157">&amp;&amp;</span>&nbsp;<span class="ident" id="5567160">p</span><span class="op" id="5567161">.</span><span class="ident" id="5567162">stack</span><span class="op" id="5567167">[</span><span class="ident" id="5567168">i</span><span class="op" id="5567169">-</span><span class="num" id="5567170">1</span><span class="op" id="5567171">]</span><span class="op" id="5567172">.</span><span class="ident" id="5567173">Op</span>&nbsp;<span class="op" id="5567176">&lt;</span>&nbsp;<span class="ident" id="5567178">opPseudo</span>&nbsp;<span class="op" id="5567187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5567191">i</span><span class="op" id="5567192">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5567196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5567199">subs</span>&nbsp;<span class="op" id="5567204">:=</span>&nbsp;<span class="ident" id="5567207">p</span><span class="op" id="5567208">.</span><span class="ident" id="5567209">stack</span><span class="op" id="5567214">[</span><span class="ident" id="5567215">i</span><span class="op" id="5567216">:</span><span class="op" id="5567217">]</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5567220">p</span><span class="op" id="5567221">.</span><span class="ident" id="5567222">stack</span>&nbsp;<span class="op" id="5567228">=</span>&nbsp;<span class="ident" id="5567230">p</span><span class="op" id="5567231">.</span><span class="ident" id="5567232">stack</span><span class="op" id="5567237">[</span><span class="op" id="5567238">:</span><span class="ident" id="5567239">i</span><span class="op" id="5567240">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5567244">//&nbsp;Make&nbsp;sure&nbsp;top&nbsp;class&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5567278">//&nbsp;All&nbsp;the&nbsp;others&nbsp;already&nbsp;are&nbsp;(see&nbsp;swapVerticalBar).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567332">if</span>&nbsp;<span class="builtinfunc" id="5567335">len</span><span class="op" id="5567338">(</span><span class="ident" id="5567339">subs</span><span class="op" id="5567343">)</span>&nbsp;<span class="op" id="5567345">&gt;</span>&nbsp;<span class="num" id="5567347">0</span>&nbsp;<span class="op" id="5567349">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5567353">cleanAlt</span><span class="op" id="5567361">(</span><span class="ident" id="5567362">subs</span><span class="op" id="5567366">[</span><span class="builtinfunc" id="5567367">len</span><span class="op" id="5567370">(</span><span class="ident" id="5567371">subs</span><span class="op" id="5567375">)</span><span class="op" id="5567376">-</span><span class="num" id="5567377">1</span><span class="op" id="5567378">]</span><span class="op" id="5567379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5567382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5567386">//&nbsp;Empty&nbsp;alternate&nbsp;is&nbsp;special&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5567422">//&nbsp;(shouldn&#39;t&nbsp;happen&nbsp;but&nbsp;easy&nbsp;to&nbsp;handle).</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567465">if</span>&nbsp;<span class="builtinfunc" id="5567468">len</span><span class="op" id="5567471">(</span><span class="ident" id="5567472">subs</span><span class="op" id="5567476">)</span>&nbsp;<span class="op" id="5567478">==</span>&nbsp;<span class="num" id="5567481">0</span>&nbsp;<span class="op" id="5567483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567487">return</span>&nbsp;<span class="ident" id="5567494">p</span><span class="op" id="5567495">.</span><span class="ident" id="5567496">push</span><span class="op" id="5567500">(</span><span class="ident" id="5567501">p</span><span class="op" id="5567502">.</span><span class="ident" id="5567503">newRegexp</span><span class="op" id="5567512">(</span><span class="ident" id="5567513">OpNoMatch</span><span class="op" id="5567522">)</span><span class="op" id="5567523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5567526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567530">return</span>&nbsp;<span class="ident" id="5567537">p</span><span class="op" id="5567538">.</span><span class="ident" id="5567539">push</span><span class="op" id="5567543">(</span><span class="ident" id="5567544">p</span><span class="op" id="5567545">.</span><span class="ident" id="5567546">collapse</span><span class="op" id="5567554">(</span><span class="ident" id="5567555">subs</span><span class="op" id="5567559">,</span>&nbsp;<span class="ident" id="5567561">OpAlternate</span><span class="op" id="5567572">)</span><span class="op" id="5567573">)</span><br>
<span class="lineno">340</span><span class="op" id="5567575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5567578">//&nbsp;cleanAlt&nbsp;cleans&nbsp;re&nbsp;for&nbsp;eventual&nbsp;inclusion&nbsp;in&nbsp;an&nbsp;alternation.</span><br>
<span class="lineno"></span><span class="keyword" id="5567642">func</span>&nbsp;<span class="ident" id="5567647">cleanAlt</span><span class="op" id="5567655">(</span><span class="ident" id="5567656">re</span>&nbsp;<span class="op" id="5567659">*</span><span class="ident" id="5567660">Regexp</span><span class="op" id="5567666">)</span>&nbsp;<span class="op" id="5567668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567671">switch</span>&nbsp;<span class="ident" id="5567678">re</span><span class="op" id="5567680">.</span><span class="ident" id="5567681">Op</span>&nbsp;<span class="op" id="5567684">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567687">case</span>&nbsp;<span class="ident" id="5567692">OpCharClass</span><span class="op" id="5567703">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5567707">re</span><span class="op" id="5567709">.</span><span class="ident" id="5567710">Rune</span>&nbsp;<span class="op" id="5567715">=</span>&nbsp;<span class="ident" id="5567717">cleanClass</span><span class="op" id="5567727">(</span><span class="op" id="5567728">&amp;</span><span class="ident" id="5567729">re</span><span class="op" id="5567731">.</span><span class="ident" id="5567732">Rune</span><span class="op" id="5567736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567740">if</span>&nbsp;<span class="builtinfunc" id="5567743">len</span><span class="op" id="5567746">(</span><span class="ident" id="5567747">re</span><span class="op" id="5567749">.</span><span class="ident" id="5567750">Rune</span><span class="op" id="5567754">)</span>&nbsp;<span class="op" id="5567756">==</span>&nbsp;<span class="num" id="5567759">2</span>&nbsp;<span class="op" id="5567761">&amp;&amp;</span>&nbsp;<span class="ident" id="5567764">re</span><span class="op" id="5567766">.</span><span class="ident" id="5567767">Rune</span><span class="op" id="5567771">[</span><span class="num" id="5567772">0</span><span class="op" id="5567773">]</span>&nbsp;<span class="op" id="5567775">==</span>&nbsp;<span class="num" id="5567778">0</span>&nbsp;<span class="op" id="5567780">&amp;&amp;</span>&nbsp;<span class="ident" id="5567783">re</span><span class="op" id="5567785">.</span><span class="ident" id="5567786">Rune</span><span class="op" id="5567790">[</span><span class="num" id="5567791">1</span><span class="op" id="5567792">]</span>&nbsp;<span class="op" id="5567794">==</span>&nbsp;<span class="ident" id="5567797">unicode</span><span class="op" id="5567804">.</span><span class="ident" id="5567805">MaxRune</span>&nbsp;<span class="op" id="5567813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5567818">re</span><span class="op" id="5567820">.</span><span class="ident" id="5567821">Rune</span>&nbsp;<span class="op" id="5567826">=</span>&nbsp;<span class="ident" id="5567828">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5567835">re</span><span class="op" id="5567837">.</span><span class="ident" id="5567838">Op</span>&nbsp;<span class="op" id="5567841">=</span>&nbsp;<span class="ident" id="5567843">OpAnyChar</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567856">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5567865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5567869">if</span>&nbsp;<span class="builtinfunc" id="5567872">len</span><span class="op" id="5567875">(</span><span class="ident" id="5567876">re</span><span class="op" id="5567878">.</span><span class="ident" id="5567879">Rune</span><span class="op" id="5567883">)</span>&nbsp;<span class="op" id="5567885">==</span>&nbsp;<span class="num" id="5567888">4</span>&nbsp;<span class="op" id="5567890">&amp;&amp;</span>&nbsp;<span class="ident" id="5567893">re</span><span class="op" id="5567895">.</span><span class="ident" id="5567896">Rune</span><span class="op" id="5567900">[</span><span class="num" id="5567901">0</span><span class="op" id="5567902">]</span>&nbsp;<span class="op" id="5567904">==</span>&nbsp;<span class="num" id="5567907">0</span>&nbsp;<span class="op" id="5567909">&amp;&amp;</span>&nbsp;<span class="ident" id="5567912">re</span><span class="op" id="5567914">.</span><span class="ident" id="5567915">Rune</span><span class="op" id="5567919">[</span><span class="num" id="5567920">1</span><span class="op" id="5567921">]</span>&nbsp;<span class="op" id="5567923">==</span>&nbsp;<span class="string" id="5567926">&#39;\n&#39;</span><span class="op" id="5567930">-</span><span class="num" id="5567931">1</span>&nbsp;<span class="op" id="5567933">&amp;&amp;</span>&nbsp;<span class="ident" id="5567936">re</span><span class="op" id="5567938">.</span><span class="ident" id="5567939">Rune</span><span class="op" id="5567943">[</span><span class="num" id="5567944">2</span><span class="op" id="5567945">]</span>&nbsp;<span class="op" id="5567947">==</span>&nbsp;<span class="string" id="5567950">&#39;\n&#39;</span><span class="op" id="5567954">+</span><span class="num" id="5567955">1</span>&nbsp;<span class="op" id="5567957">&amp;&amp;</span>&nbsp;<span class="ident" id="5567960">re</span><span class="op" id="5567962">.</span><span class="ident" id="5567963">Rune</span><span class="op" id="5567967">[</span><span class="num" id="5567968">3</span><span class="op" id="5567969">]</span>&nbsp;<span class="op" id="5567971">==</span>&nbsp;<span class="ident" id="5567974">unicode</span><span class="op" id="5567981">.</span><span class="ident" id="5567982">MaxRune</span>&nbsp;<span class="op" id="5567990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5567995">re</span><span class="op" id="5567997">.</span><span class="ident" id="5567998">Rune</span>&nbsp;<span class="op" id="5568003">=</span>&nbsp;<span class="ident" id="5568005">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568012">re</span><span class="op" id="5568014">.</span><span class="ident" id="5568015">Op</span>&nbsp;<span class="op" id="5568018">=</span>&nbsp;<span class="ident" id="5568020">OpAnyCharNotNL</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568038">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5568047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568051">if</span>&nbsp;<span class="builtinfunc" id="5568054">cap</span><span class="op" id="5568057">(</span><span class="ident" id="5568058">re</span><span class="op" id="5568060">.</span><span class="ident" id="5568061">Rune</span><span class="op" id="5568065">)</span><span class="op" id="5568066">-</span><span class="builtinfunc" id="5568067">len</span><span class="op" id="5568070">(</span><span class="ident" id="5568071">re</span><span class="op" id="5568073">.</span><span class="ident" id="5568074">Rune</span><span class="op" id="5568078">)</span>&nbsp;<span class="op" id="5568080">&gt;</span>&nbsp;<span class="num" id="5568082">100</span>&nbsp;<span class="op" id="5568086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5568091">//&nbsp;re.Rune&nbsp;will&nbsp;not&nbsp;grow&nbsp;any&nbsp;more.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5568129">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;or&nbsp;inline&nbsp;to&nbsp;reclaim&nbsp;storage.</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568177">re</span><span class="op" id="5568179">.</span><span class="ident" id="5568180">Rune</span>&nbsp;<span class="op" id="5568185">=</span>&nbsp;<span class="builtinfunc" id="5568187">append</span><span class="op" id="5568193">(</span><span class="ident" id="5568194">re</span><span class="op" id="5568196">.</span><span class="ident" id="5568197">Rune0</span><span class="op" id="5568202">[</span><span class="op" id="5568203">:</span><span class="num" id="5568204">0</span><span class="op" id="5568205">]</span><span class="op" id="5568206">,</span>&nbsp;<span class="ident" id="5568208">re</span><span class="op" id="5568210">.</span><span class="ident" id="5568211">Rune</span><span class="op" id="5568215">...</span><span class="op" id="5568218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5568222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5568225">}</span><br>
<span class="lineno"></span><span class="op" id="5568227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="5568230">//&nbsp;collapse&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;applying&nbsp;op&nbsp;to&nbsp;sub.</span><br>
<span class="lineno"></span><span class="comment" id="5568284">//&nbsp;If&nbsp;sub&nbsp;contains&nbsp;op&nbsp;nodes,&nbsp;they&nbsp;all&nbsp;get&nbsp;hoisted&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="5568337">//&nbsp;so&nbsp;that&nbsp;there&nbsp;is&nbsp;never&nbsp;a&nbsp;concat&nbsp;of&nbsp;a&nbsp;concat&nbsp;or&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5568390">//&nbsp;alternate&nbsp;of&nbsp;an&nbsp;alternate.</span><br>
<span class="lineno"></span><span class="keyword" id="5568420">func</span>&nbsp;<span class="op" id="5568425">(</span><span class="ident" id="5568426">p</span>&nbsp;<span class="op" id="5568428">*</span><span class="ident" id="5568429">parser</span><span class="op" id="5568435">)</span>&nbsp;<span class="ident" id="5568437">collapse</span><span class="op" id="5568445">(</span><span class="ident" id="5568446">subs</span>&nbsp;<span class="op" id="5568451">[</span><span class="op" id="5568452">]</span><span class="op" id="5568453">*</span><span class="ident" id="5568454">Regexp</span><span class="op" id="5568460">,</span>&nbsp;<span class="ident" id="5568462">op</span>&nbsp;<span class="ident" id="5568465">Op</span><span class="op" id="5568467">)</span>&nbsp;<span class="op" id="5568469">*</span><span class="ident" id="5568470">Regexp</span>&nbsp;<span class="op" id="5568477">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568480">if</span>&nbsp;<span class="builtinfunc" id="5568483">len</span><span class="op" id="5568486">(</span><span class="ident" id="5568487">subs</span><span class="op" id="5568491">)</span>&nbsp;<span class="op" id="5568493">==</span>&nbsp;<span class="num" id="5568496">1</span>&nbsp;<span class="op" id="5568498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568502">return</span>&nbsp;<span class="ident" id="5568509">subs</span><span class="op" id="5568513">[</span><span class="num" id="5568514">0</span><span class="op" id="5568515">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5568518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568521">re</span>&nbsp;<span class="op" id="5568524">:=</span>&nbsp;<span class="ident" id="5568527">p</span><span class="op" id="5568528">.</span><span class="ident" id="5568529">newRegexp</span><span class="op" id="5568538">(</span><span class="ident" id="5568539">op</span><span class="op" id="5568541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568544">re</span><span class="op" id="5568546">.</span><span class="ident" id="5568547">Sub</span>&nbsp;<span class="op" id="5568551">=</span>&nbsp;<span class="ident" id="5568553">re</span><span class="op" id="5568555">.</span><span class="ident" id="5568556">Sub0</span><span class="op" id="5568560">[</span><span class="op" id="5568561">:</span><span class="num" id="5568562">0</span><span class="op" id="5568563">]</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568566">for</span>&nbsp;<span class="ident" id="5568570">_</span><span class="op" id="5568571">,</span>&nbsp;<span class="ident" id="5568573">sub</span>&nbsp;<span class="op" id="5568577">:=</span>&nbsp;<span class="keyword" id="5568580">range</span>&nbsp;<span class="ident" id="5568586">subs</span>&nbsp;<span class="op" id="5568591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568595">if</span>&nbsp;<span class="ident" id="5568598">sub</span><span class="op" id="5568601">.</span><span class="ident" id="5568602">Op</span>&nbsp;<span class="op" id="5568605">==</span>&nbsp;<span class="ident" id="5568608">op</span>&nbsp;<span class="op" id="5568611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568616">re</span><span class="op" id="5568618">.</span><span class="ident" id="5568619">Sub</span>&nbsp;<span class="op" id="5568623">=</span>&nbsp;<span class="builtinfunc" id="5568625">append</span><span class="op" id="5568631">(</span><span class="ident" id="5568632">re</span><span class="op" id="5568634">.</span><span class="ident" id="5568635">Sub</span><span class="op" id="5568638">,</span>&nbsp;<span class="ident" id="5568640">sub</span><span class="op" id="5568643">.</span><span class="ident" id="5568644">Sub</span><span class="op" id="5568647">...</span><span class="op" id="5568650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568655">p</span><span class="op" id="5568656">.</span><span class="ident" id="5568657">reuse</span><span class="op" id="5568662">(</span><span class="ident" id="5568663">sub</span><span class="op" id="5568666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5568670">}</span>&nbsp;<span class="keyword" id="5568672">else</span>&nbsp;<span class="op" id="5568677">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568682">re</span><span class="op" id="5568684">.</span><span class="ident" id="5568685">Sub</span>&nbsp;<span class="op" id="5568689">=</span>&nbsp;<span class="builtinfunc" id="5568691">append</span><span class="op" id="5568697">(</span><span class="ident" id="5568698">re</span><span class="op" id="5568700">.</span><span class="ident" id="5568701">Sub</span><span class="op" id="5568704">,</span>&nbsp;<span class="ident" id="5568706">sub</span><span class="op" id="5568709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5568713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5568716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568719">if</span>&nbsp;<span class="ident" id="5568722">op</span>&nbsp;<span class="op" id="5568725">==</span>&nbsp;<span class="ident" id="5568728">OpAlternate</span>&nbsp;<span class="op" id="5568740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568744">re</span><span class="op" id="5568746">.</span><span class="ident" id="5568747">Sub</span>&nbsp;<span class="op" id="5568751">=</span>&nbsp;<span class="ident" id="5568753">p</span><span class="op" id="5568754">.</span><span class="ident" id="5568755">factor</span><span class="op" id="5568761">(</span><span class="ident" id="5568762">re</span><span class="op" id="5568764">.</span><span class="ident" id="5568765">Sub</span><span class="op" id="5568768">,</span>&nbsp;<span class="ident" id="5568770">re</span><span class="op" id="5568772">.</span><span class="ident" id="5568773">Flags</span><span class="op" id="5568778">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568782">if</span>&nbsp;<span class="builtinfunc" id="5568785">len</span><span class="op" id="5568788">(</span><span class="ident" id="5568789">re</span><span class="op" id="5568791">.</span><span class="ident" id="5568792">Sub</span><span class="op" id="5568795">)</span>&nbsp;<span class="op" id="5568797">==</span>&nbsp;<span class="num" id="5568800">1</span>&nbsp;<span class="op" id="5568802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568807">old</span>&nbsp;<span class="op" id="5568811">:=</span>&nbsp;<span class="ident" id="5568814">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568820">re</span>&nbsp;<span class="op" id="5568823">=</span>&nbsp;<span class="ident" id="5568825">re</span><span class="op" id="5568827">.</span><span class="ident" id="5568828">Sub</span><span class="op" id="5568831">[</span><span class="num" id="5568832">0</span><span class="op" id="5568833">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5568838">p</span><span class="op" id="5568839">.</span><span class="ident" id="5568840">reuse</span><span class="op" id="5568845">(</span><span class="ident" id="5568846">old</span><span class="op" id="5568849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5568853">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5568856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5568859">return</span>&nbsp;<span class="ident" id="5568866">re</span><br>
<span class="lineno"></span><span class="op" id="5568869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5568872">//&nbsp;factor&nbsp;factors&nbsp;common&nbsp;prefixes&nbsp;from&nbsp;the&nbsp;alternation&nbsp;list&nbsp;sub.</span><br>
<span class="lineno">395</span><span class="comment" id="5568937">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;replacement&nbsp;list&nbsp;that&nbsp;reuses&nbsp;the&nbsp;same&nbsp;storage&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5569003">//&nbsp;frees&nbsp;(passes&nbsp;to&nbsp;p.reuse)&nbsp;any&nbsp;removed&nbsp;*Regexps.</span><br>
<span class="lineno"></span><span class="comment" id="5569054">//</span><br>
<span class="lineno"></span><span class="comment" id="5569057">//&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span><span class="comment" id="5569073">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ABC|ABD|AEF|BCX|BCY</span><br>
<span class="lineno">400</span><span class="comment" id="5569100">//&nbsp;simplifies&nbsp;by&nbsp;literal&nbsp;prefix&nbsp;extraction&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5569146">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A(B(C|D)|EF)|BC(X|Y)</span><br>
<span class="lineno"></span><span class="comment" id="5569174">//&nbsp;which&nbsp;simplifies&nbsp;by&nbsp;character&nbsp;class&nbsp;introduction&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5569229">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A(B[CD]|EF)|BC[XY]</span><br>
<span class="lineno"></span><span class="comment" id="5569255">//</span><br>
<span class="lineno">405</span><span class="keyword" id="5569258">func</span>&nbsp;<span class="op" id="5569263">(</span><span class="ident" id="5569264">p</span>&nbsp;<span class="op" id="5569266">*</span><span class="ident" id="5569267">parser</span><span class="op" id="5569273">)</span>&nbsp;<span class="ident" id="5569275">factor</span><span class="op" id="5569281">(</span><span class="ident" id="5569282">sub</span>&nbsp;<span class="op" id="5569286">[</span><span class="op" id="5569287">]</span><span class="op" id="5569288">*</span><span class="ident" id="5569289">Regexp</span><span class="op" id="5569295">,</span>&nbsp;<span class="ident" id="5569297">flags</span>&nbsp;<span class="ident" id="5569303">Flags</span><span class="op" id="5569308">)</span>&nbsp;<span class="op" id="5569310">[</span><span class="op" id="5569311">]</span><span class="op" id="5569312">*</span><span class="ident" id="5569313">Regexp</span>&nbsp;<span class="op" id="5569320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569323">if</span>&nbsp;<span class="builtinfunc" id="5569326">len</span><span class="op" id="5569329">(</span><span class="ident" id="5569330">sub</span><span class="op" id="5569333">)</span>&nbsp;<span class="op" id="5569335">&lt;</span>&nbsp;<span class="num" id="5569337">2</span>&nbsp;<span class="op" id="5569339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569343">return</span>&nbsp;<span class="ident" id="5569350">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5569355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5569359">//&nbsp;Round&nbsp;1:&nbsp;Factor&nbsp;out&nbsp;common&nbsp;literal&nbsp;prefixes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569408">var</span>&nbsp;<span class="ident" id="5569412">str</span>&nbsp;<span class="op" id="5569416">[</span><span class="op" id="5569417">]</span><span class="builtintype" id="5569418">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569424">var</span>&nbsp;<span class="ident" id="5569428">strflags</span>&nbsp;<span class="ident" id="5569437">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569444">start</span>&nbsp;<span class="op" id="5569450">:=</span>&nbsp;<span class="num" id="5569453">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569456">out</span>&nbsp;<span class="op" id="5569460">:=</span>&nbsp;<span class="ident" id="5569463">sub</span><span class="op" id="5569466">[</span><span class="op" id="5569467">:</span><span class="num" id="5569468">0</span><span class="op" id="5569469">]</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569472">for</span>&nbsp;<span class="ident" id="5569476">i</span>&nbsp;<span class="op" id="5569478">:=</span>&nbsp;<span class="num" id="5569481">0</span><span class="op" id="5569482">;</span>&nbsp;<span class="ident" id="5569484">i</span>&nbsp;<span class="op" id="5569486">&lt;=</span>&nbsp;<span class="builtinfunc" id="5569489">len</span><span class="op" id="5569492">(</span><span class="ident" id="5569493">sub</span><span class="op" id="5569496">)</span><span class="op" id="5569497">;</span>&nbsp;<span class="ident" id="5569499">i</span><span class="op" id="5569500">++</span>&nbsp;<span class="op" id="5569503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5569507">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5569571">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5569638">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5569672">//</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5569677">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;all&nbsp;begin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5569741">//&nbsp;with&nbsp;str&nbsp;as&nbsp;modified&nbsp;by&nbsp;strflags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569780">var</span>&nbsp;<span class="ident" id="5569784">istr</span>&nbsp;<span class="op" id="5569789">[</span><span class="op" id="5569790">]</span><span class="builtintype" id="5569791">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569798">var</span>&nbsp;<span class="ident" id="5569802">iflags</span>&nbsp;<span class="ident" id="5569809">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569817">if</span>&nbsp;<span class="ident" id="5569820">i</span>&nbsp;<span class="op" id="5569822">&lt;</span>&nbsp;<span class="builtinfunc" id="5569824">len</span><span class="op" id="5569827">(</span><span class="ident" id="5569828">sub</span><span class="op" id="5569831">)</span>&nbsp;<span class="op" id="5569833">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569838">istr</span><span class="op" id="5569842">,</span>&nbsp;<span class="ident" id="5569844">iflags</span>&nbsp;<span class="op" id="5569851">=</span>&nbsp;<span class="ident" id="5569853">p</span><span class="op" id="5569854">.</span><span class="ident" id="5569855">leadingString</span><span class="op" id="5569868">(</span><span class="ident" id="5569869">sub</span><span class="op" id="5569872">[</span><span class="ident" id="5569873">i</span><span class="op" id="5569874">]</span><span class="op" id="5569875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569880">if</span>&nbsp;<span class="ident" id="5569883">iflags</span>&nbsp;<span class="op" id="5569890">==</span>&nbsp;<span class="ident" id="5569893">strflags</span>&nbsp;<span class="op" id="5569902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569908">same</span>&nbsp;<span class="op" id="5569913">:=</span>&nbsp;<span class="num" id="5569916">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5569922">for</span>&nbsp;<span class="ident" id="5569926">same</span>&nbsp;<span class="op" id="5569931">&lt;</span>&nbsp;<span class="builtinfunc" id="5569933">len</span><span class="op" id="5569936">(</span><span class="ident" id="5569937">str</span><span class="op" id="5569940">)</span>&nbsp;<span class="op" id="5569942">&amp;&amp;</span>&nbsp;<span class="ident" id="5569945">same</span>&nbsp;<span class="op" id="5569950">&lt;</span>&nbsp;<span class="builtinfunc" id="5569952">len</span><span class="op" id="5569955">(</span><span class="ident" id="5569956">istr</span><span class="op" id="5569960">)</span>&nbsp;<span class="op" id="5569962">&amp;&amp;</span>&nbsp;<span class="ident" id="5569965">str</span><span class="op" id="5569968">[</span><span class="ident" id="5569969">same</span><span class="op" id="5569973">]</span>&nbsp;<span class="op" id="5569975">==</span>&nbsp;<span class="ident" id="5569978">istr</span><span class="op" id="5569982">[</span><span class="ident" id="5569983">same</span><span class="op" id="5569987">]</span>&nbsp;<span class="op" id="5569989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5569996">same</span><span class="op" id="5570000">++</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5570007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5570013">if</span>&nbsp;<span class="ident" id="5570016">same</span>&nbsp;<span class="op" id="5570021">&gt;</span>&nbsp;<span class="num" id="5570023">0</span>&nbsp;<span class="op" id="5570025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5570032">//&nbsp;Matches&nbsp;at&nbsp;least&nbsp;one&nbsp;rune&nbsp;in&nbsp;current&nbsp;range.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5570084">//&nbsp;Keep&nbsp;going&nbsp;around.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570111">str</span>&nbsp;<span class="op" id="5570115">=</span>&nbsp;<span class="ident" id="5570117">str</span><span class="op" id="5570120">[</span><span class="op" id="5570121">:</span><span class="ident" id="5570122">same</span><span class="op" id="5570126">]</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5570133">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5570146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5570151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5570155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5570160">//&nbsp;Found&nbsp;end&nbsp;of&nbsp;a&nbsp;run&nbsp;with&nbsp;common&nbsp;leading&nbsp;literal&nbsp;string:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5570220">//&nbsp;sub[start:i]&nbsp;all&nbsp;begin&nbsp;with&nbsp;str[0:len(str)],&nbsp;but&nbsp;sub[i]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5570281">//&nbsp;does&nbsp;not&nbsp;even&nbsp;begin&nbsp;with&nbsp;str[0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5570319">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5570324">//&nbsp;Factor&nbsp;out&nbsp;common&nbsp;string&nbsp;and&nbsp;append&nbsp;factored&nbsp;expression&nbsp;to&nbsp;out.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5570393">if</span>&nbsp;<span class="ident" id="5570396">i</span>&nbsp;<span class="op" id="5570398">==</span>&nbsp;<span class="ident" id="5570401">start</span>&nbsp;<span class="op" id="5570407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5570412">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5570450">}</span>&nbsp;<span class="keyword" id="5570452">else</span>&nbsp;<span class="keyword" id="5570457">if</span>&nbsp;<span class="ident" id="5570460">i</span>&nbsp;<span class="op" id="5570462">==</span>&nbsp;<span class="ident" id="5570465">start</span><span class="op" id="5570470">+</span><span class="num" id="5570471">1</span>&nbsp;<span class="op" id="5570473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5570478">//&nbsp;Just&nbsp;one:&nbsp;don&#39;t&nbsp;bother&nbsp;factoring.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570518">out</span>&nbsp;<span class="op" id="5570522">=</span>&nbsp;<span class="builtinfunc" id="5570524">append</span><span class="op" id="5570530">(</span><span class="ident" id="5570531">out</span><span class="op" id="5570534">,</span>&nbsp;<span class="ident" id="5570536">sub</span><span class="op" id="5570539">[</span><span class="ident" id="5570540">start</span><span class="op" id="5570545">]</span><span class="op" id="5570546">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5570550">}</span>&nbsp;<span class="keyword" id="5570552">else</span>&nbsp;<span class="op" id="5570557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5570562">//&nbsp;Construct&nbsp;factored&nbsp;form:&nbsp;prefix(suffix1|suffix2|...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570621">prefix</span>&nbsp;<span class="op" id="5570628">:=</span>&nbsp;<span class="ident" id="5570631">p</span><span class="op" id="5570632">.</span><span class="ident" id="5570633">newRegexp</span><span class="op" id="5570642">(</span><span class="ident" id="5570643">OpLiteral</span><span class="op" id="5570652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570657">prefix</span><span class="op" id="5570663">.</span><span class="ident" id="5570664">Flags</span>&nbsp;<span class="op" id="5570670">=</span>&nbsp;<span class="ident" id="5570672">strflags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570684">prefix</span><span class="op" id="5570690">.</span><span class="ident" id="5570691">Rune</span>&nbsp;<span class="op" id="5570696">=</span>&nbsp;<span class="builtinfunc" id="5570698">append</span><span class="op" id="5570704">(</span><span class="ident" id="5570705">prefix</span><span class="op" id="5570711">.</span><span class="ident" id="5570712">Rune</span><span class="op" id="5570716">[</span><span class="op" id="5570717">:</span><span class="num" id="5570718">0</span><span class="op" id="5570719">]</span><span class="op" id="5570720">,</span>&nbsp;<span class="ident" id="5570722">str</span><span class="op" id="5570725">...</span><span class="op" id="5570728">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5570734">for</span>&nbsp;<span class="ident" id="5570738">j</span>&nbsp;<span class="op" id="5570740">:=</span>&nbsp;<span class="ident" id="5570743">start</span><span class="op" id="5570748">;</span>&nbsp;<span class="ident" id="5570750">j</span>&nbsp;<span class="op" id="5570752">&lt;</span>&nbsp;<span class="ident" id="5570754">i</span><span class="op" id="5570755">;</span>&nbsp;<span class="ident" id="5570757">j</span><span class="op" id="5570758">++</span>&nbsp;<span class="op" id="5570761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570767">sub</span><span class="op" id="5570770">[</span><span class="ident" id="5570771">j</span><span class="op" id="5570772">]</span>&nbsp;<span class="op" id="5570774">=</span>&nbsp;<span class="ident" id="5570776">p</span><span class="op" id="5570777">.</span><span class="ident" id="5570778">removeLeadingString</span><span class="op" id="5570797">(</span><span class="ident" id="5570798">sub</span><span class="op" id="5570801">[</span><span class="ident" id="5570802">j</span><span class="op" id="5570803">]</span><span class="op" id="5570804">,</span>&nbsp;<span class="builtinfunc" id="5570806">len</span><span class="op" id="5570809">(</span><span class="ident" id="5570810">str</span><span class="op" id="5570813">)</span><span class="op" id="5570814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5570819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570824">suffix</span>&nbsp;<span class="op" id="5570831">:=</span>&nbsp;<span class="ident" id="5570834">p</span><span class="op" id="5570835">.</span><span class="ident" id="5570836">collapse</span><span class="op" id="5570844">(</span><span class="ident" id="5570845">sub</span><span class="op" id="5570848">[</span><span class="ident" id="5570849">start</span><span class="op" id="5570854">:</span><span class="ident" id="5570855">i</span><span class="op" id="5570856">]</span><span class="op" id="5570857">,</span>&nbsp;<span class="ident" id="5570859">OpAlternate</span><span class="op" id="5570870">)</span>&nbsp;<span class="comment" id="5570872">//&nbsp;recurse</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570887">re</span>&nbsp;<span class="op" id="5570890">:=</span>&nbsp;<span class="ident" id="5570893">p</span><span class="op" id="5570894">.</span><span class="ident" id="5570895">newRegexp</span><span class="op" id="5570904">(</span><span class="ident" id="5570905">OpConcat</span><span class="op" id="5570913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570918">re</span><span class="op" id="5570920">.</span><span class="ident" id="5570921">Sub</span>&nbsp;<span class="op" id="5570925">=</span>&nbsp;<span class="builtinfunc" id="5570927">append</span><span class="op" id="5570933">(</span><span class="ident" id="5570934">re</span><span class="op" id="5570936">.</span><span class="ident" id="5570937">Sub</span><span class="op" id="5570940">[</span><span class="op" id="5570941">:</span><span class="num" id="5570942">0</span><span class="op" id="5570943">]</span><span class="op" id="5570944">,</span>&nbsp;<span class="ident" id="5570946">prefix</span><span class="op" id="5570952">,</span>&nbsp;<span class="ident" id="5570954">suffix</span><span class="op" id="5570960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5570965">out</span>&nbsp;<span class="op" id="5570969">=</span>&nbsp;<span class="builtinfunc" id="5570971">append</span><span class="op" id="5570977">(</span><span class="ident" id="5570978">out</span><span class="op" id="5570981">,</span>&nbsp;<span class="ident" id="5570983">re</span><span class="op" id="5570985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5570989">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5570994">//&nbsp;Prepare&nbsp;for&nbsp;next&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571027">start</span>&nbsp;<span class="op" id="5571033">=</span>&nbsp;<span class="ident" id="5571035">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571039">str</span>&nbsp;<span class="op" id="5571043">=</span>&nbsp;<span class="ident" id="5571045">istr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571052">strflags</span>&nbsp;<span class="op" id="5571061">=</span>&nbsp;<span class="ident" id="5571063">iflags</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5571071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571074">sub</span>&nbsp;<span class="op" id="5571078">=</span>&nbsp;<span class="ident" id="5571080">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571086">//&nbsp;Round&nbsp;2:&nbsp;Factor&nbsp;out&nbsp;common&nbsp;complex&nbsp;prefixes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571135">//&nbsp;just&nbsp;the&nbsp;first&nbsp;piece&nbsp;of&nbsp;each&nbsp;concatenation,</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571183">//&nbsp;whatever&nbsp;it&nbsp;is.&nbsp;&nbsp;This&nbsp;is&nbsp;good&nbsp;enough&nbsp;a&nbsp;lot&nbsp;of&nbsp;the&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571243">start</span>&nbsp;<span class="op" id="5571249">=</span>&nbsp;<span class="num" id="5571251">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571254">out</span>&nbsp;<span class="op" id="5571258">=</span>&nbsp;<span class="ident" id="5571260">sub</span><span class="op" id="5571263">[</span><span class="op" id="5571264">:</span><span class="num" id="5571265">0</span><span class="op" id="5571266">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5571269">var</span>&nbsp;<span class="ident" id="5571273">first</span>&nbsp;<span class="op" id="5571279">*</span><span class="ident" id="5571280">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5571288">for</span>&nbsp;<span class="ident" id="5571292">i</span>&nbsp;<span class="op" id="5571294">:=</span>&nbsp;<span class="num" id="5571297">0</span><span class="op" id="5571298">;</span>&nbsp;<span class="ident" id="5571300">i</span>&nbsp;<span class="op" id="5571302">&lt;=</span>&nbsp;<span class="builtinfunc" id="5571305">len</span><span class="op" id="5571308">(</span><span class="ident" id="5571309">sub</span><span class="op" id="5571312">)</span><span class="op" id="5571313">;</span>&nbsp;<span class="ident" id="5571315">i</span><span class="op" id="5571316">++</span>&nbsp;<span class="op" id="5571319">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571323">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571387">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571454">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571488">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571493">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;all&nbsp;begin&nbsp;with&nbsp;ifirst.</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5571570">var</span>&nbsp;<span class="ident" id="5571574">ifirst</span>&nbsp;<span class="op" id="5571581">*</span><span class="ident" id="5571582">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5571591">if</span>&nbsp;<span class="ident" id="5571594">i</span>&nbsp;<span class="op" id="5571596">&lt;</span>&nbsp;<span class="builtinfunc" id="5571598">len</span><span class="op" id="5571601">(</span><span class="ident" id="5571602">sub</span><span class="op" id="5571605">)</span>&nbsp;<span class="op" id="5571607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5571612">ifirst</span>&nbsp;<span class="op" id="5571619">=</span>&nbsp;<span class="ident" id="5571621">p</span><span class="op" id="5571622">.</span><span class="ident" id="5571623">leadingRegexp</span><span class="op" id="5571636">(</span><span class="ident" id="5571637">sub</span><span class="op" id="5571640">[</span><span class="ident" id="5571641">i</span><span class="op" id="5571642">]</span><span class="op" id="5571643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5571648">if</span>&nbsp;<span class="ident" id="5571651">first</span>&nbsp;<span class="op" id="5571657">!=</span>&nbsp;<span class="ident" id="5571660">nil</span>&nbsp;<span class="op" id="5571664">&amp;&amp;</span>&nbsp;<span class="ident" id="5571667">first</span><span class="op" id="5571672">.</span><span class="ident" id="5571673">Equal</span><span class="op" id="5571678">(</span><span class="ident" id="5571679">ifirst</span><span class="op" id="5571685">)</span>&nbsp;<span class="op" id="5571687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5571693">continue</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5571705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5571709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571714">//&nbsp;Found&nbsp;end&nbsp;of&nbsp;a&nbsp;run&nbsp;with&nbsp;common&nbsp;leading&nbsp;regexp:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571766">//&nbsp;sub[start:i]&nbsp;all&nbsp;begin&nbsp;with&nbsp;first&nbsp;but&nbsp;sub[i]&nbsp;does&nbsp;not.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571826">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571831">//&nbsp;Factor&nbsp;out&nbsp;common&nbsp;regexp&nbsp;and&nbsp;append&nbsp;factored&nbsp;expression&nbsp;to&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5571900">if</span>&nbsp;<span class="ident" id="5571903">i</span>&nbsp;<span class="op" id="5571905">==</span>&nbsp;<span class="ident" id="5571908">start</span>&nbsp;<span class="op" id="5571914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571919">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5571957">}</span>&nbsp;<span class="keyword" id="5571959">else</span>&nbsp;<span class="keyword" id="5571964">if</span>&nbsp;<span class="ident" id="5571967">i</span>&nbsp;<span class="op" id="5571969">==</span>&nbsp;<span class="ident" id="5571972">start</span><span class="op" id="5571977">+</span><span class="num" id="5571978">1</span>&nbsp;<span class="op" id="5571980">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5571985">//&nbsp;Just&nbsp;one:&nbsp;don&#39;t&nbsp;bother&nbsp;factoring.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572025">out</span>&nbsp;<span class="op" id="5572029">=</span>&nbsp;<span class="builtinfunc" id="5572031">append</span><span class="op" id="5572037">(</span><span class="ident" id="5572038">out</span><span class="op" id="5572041">,</span>&nbsp;<span class="ident" id="5572043">sub</span><span class="op" id="5572046">[</span><span class="ident" id="5572047">start</span><span class="op" id="5572052">]</span><span class="op" id="5572053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5572057">}</span>&nbsp;<span class="keyword" id="5572059">else</span>&nbsp;<span class="op" id="5572064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5572069">//&nbsp;Construct&nbsp;factored&nbsp;form:&nbsp;prefix(suffix1|suffix2|...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572128">prefix</span>&nbsp;<span class="op" id="5572135">:=</span>&nbsp;<span class="ident" id="5572138">first</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572147">for</span>&nbsp;<span class="ident" id="5572151">j</span>&nbsp;<span class="op" id="5572153">:=</span>&nbsp;<span class="ident" id="5572156">start</span><span class="op" id="5572161">;</span>&nbsp;<span class="ident" id="5572163">j</span>&nbsp;<span class="op" id="5572165">&lt;</span>&nbsp;<span class="ident" id="5572167">i</span><span class="op" id="5572168">;</span>&nbsp;<span class="ident" id="5572170">j</span><span class="op" id="5572171">++</span>&nbsp;<span class="op" id="5572174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572180">reuse</span>&nbsp;<span class="op" id="5572186">:=</span>&nbsp;<span class="ident" id="5572189">j</span>&nbsp;<span class="op" id="5572191">!=</span>&nbsp;<span class="ident" id="5572194">start</span>&nbsp;<span class="comment" id="5572200">//&nbsp;prefix&nbsp;came&nbsp;from&nbsp;sub[start]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572235">sub</span><span class="op" id="5572238">[</span><span class="ident" id="5572239">j</span><span class="op" id="5572240">]</span>&nbsp;<span class="op" id="5572242">=</span>&nbsp;<span class="ident" id="5572244">p</span><span class="op" id="5572245">.</span><span class="ident" id="5572246">removeLeadingRegexp</span><span class="op" id="5572265">(</span><span class="ident" id="5572266">sub</span><span class="op" id="5572269">[</span><span class="ident" id="5572270">j</span><span class="op" id="5572271">]</span><span class="op" id="5572272">,</span>&nbsp;<span class="ident" id="5572274">reuse</span><span class="op" id="5572279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5572284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572289">suffix</span>&nbsp;<span class="op" id="5572296">:=</span>&nbsp;<span class="ident" id="5572299">p</span><span class="op" id="5572300">.</span><span class="ident" id="5572301">collapse</span><span class="op" id="5572309">(</span><span class="ident" id="5572310">sub</span><span class="op" id="5572313">[</span><span class="ident" id="5572314">start</span><span class="op" id="5572319">:</span><span class="ident" id="5572320">i</span><span class="op" id="5572321">]</span><span class="op" id="5572322">,</span>&nbsp;<span class="ident" id="5572324">OpAlternate</span><span class="op" id="5572335">)</span>&nbsp;<span class="comment" id="5572337">//&nbsp;recurse</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572352">re</span>&nbsp;<span class="op" id="5572355">:=</span>&nbsp;<span class="ident" id="5572358">p</span><span class="op" id="5572359">.</span><span class="ident" id="5572360">newRegexp</span><span class="op" id="5572369">(</span><span class="ident" id="5572370">OpConcat</span><span class="op" id="5572378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572383">re</span><span class="op" id="5572385">.</span><span class="ident" id="5572386">Sub</span>&nbsp;<span class="op" id="5572390">=</span>&nbsp;<span class="builtinfunc" id="5572392">append</span><span class="op" id="5572398">(</span><span class="ident" id="5572399">re</span><span class="op" id="5572401">.</span><span class="ident" id="5572402">Sub</span><span class="op" id="5572405">[</span><span class="op" id="5572406">:</span><span class="num" id="5572407">0</span><span class="op" id="5572408">]</span><span class="op" id="5572409">,</span>&nbsp;<span class="ident" id="5572411">prefix</span><span class="op" id="5572417">,</span>&nbsp;<span class="ident" id="5572419">suffix</span><span class="op" id="5572425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572430">out</span>&nbsp;<span class="op" id="5572434">=</span>&nbsp;<span class="builtinfunc" id="5572436">append</span><span class="op" id="5572442">(</span><span class="ident" id="5572443">out</span><span class="op" id="5572446">,</span>&nbsp;<span class="ident" id="5572448">re</span><span class="op" id="5572450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5572454">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5572459">//&nbsp;Prepare&nbsp;for&nbsp;next&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572492">start</span>&nbsp;<span class="op" id="5572498">=</span>&nbsp;<span class="ident" id="5572500">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572504">first</span>&nbsp;<span class="op" id="5572510">=</span>&nbsp;<span class="ident" id="5572512">ifirst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5572520">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572523">sub</span>&nbsp;<span class="op" id="5572527">=</span>&nbsp;<span class="ident" id="5572529">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5572535">//&nbsp;Round&nbsp;3:&nbsp;Collapse&nbsp;runs&nbsp;of&nbsp;single&nbsp;literals&nbsp;into&nbsp;character&nbsp;classes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572605">start</span>&nbsp;<span class="op" id="5572611">=</span>&nbsp;<span class="num" id="5572613">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5572616">out</span>&nbsp;<span class="op" id="5572620">=</span>&nbsp;<span class="ident" id="5572622">sub</span><span class="op" id="5572625">[</span><span class="op" id="5572626">:</span><span class="num" id="5572627">0</span><span class="op" id="5572628">]</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572631">for</span>&nbsp;<span class="ident" id="5572635">i</span>&nbsp;<span class="op" id="5572637">:=</span>&nbsp;<span class="num" id="5572640">0</span><span class="op" id="5572641">;</span>&nbsp;<span class="ident" id="5572643">i</span>&nbsp;<span class="op" id="5572645">&lt;=</span>&nbsp;<span class="builtinfunc" id="5572648">len</span><span class="op" id="5572651">(</span><span class="ident" id="5572652">sub</span><span class="op" id="5572655">)</span><span class="op" id="5572656">;</span>&nbsp;<span class="ident" id="5572658">i</span><span class="op" id="5572659">++</span>&nbsp;<span class="op" id="5572662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5572666">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5572730">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5572797">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5572831">//</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5572836">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;are&nbsp;either</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5572901">//&nbsp;literal&nbsp;runes&nbsp;or&nbsp;character&nbsp;classes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572942">if</span>&nbsp;<span class="ident" id="5572945">i</span>&nbsp;<span class="op" id="5572947">&lt;</span>&nbsp;<span class="builtinfunc" id="5572949">len</span><span class="op" id="5572952">(</span><span class="ident" id="5572953">sub</span><span class="op" id="5572956">)</span>&nbsp;<span class="op" id="5572958">&amp;&amp;</span>&nbsp;<span class="ident" id="5572961">isCharClass</span><span class="op" id="5572972">(</span><span class="ident" id="5572973">sub</span><span class="op" id="5572976">[</span><span class="ident" id="5572977">i</span><span class="op" id="5572978">]</span><span class="op" id="5572979">)</span>&nbsp;<span class="op" id="5572981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5572986">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5572997">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5573002">//&nbsp;sub[i]&nbsp;is&nbsp;not&nbsp;a&nbsp;char&nbsp;or&nbsp;char&nbsp;class;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5573043">//&nbsp;emit&nbsp;char&nbsp;class&nbsp;for&nbsp;sub[start:i]...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5573084">if</span>&nbsp;<span class="ident" id="5573087">i</span>&nbsp;<span class="op" id="5573089">==</span>&nbsp;<span class="ident" id="5573092">start</span>&nbsp;<span class="op" id="5573098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5573103">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5573141">}</span>&nbsp;<span class="keyword" id="5573143">else</span>&nbsp;<span class="keyword" id="5573148">if</span>&nbsp;<span class="ident" id="5573151">i</span>&nbsp;<span class="op" id="5573153">==</span>&nbsp;<span class="ident" id="5573156">start</span><span class="op" id="5573161">+</span><span class="num" id="5573162">1</span>&nbsp;<span class="op" id="5573164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573169">out</span>&nbsp;<span class="op" id="5573173">=</span>&nbsp;<span class="builtinfunc" id="5573175">append</span><span class="op" id="5573181">(</span><span class="ident" id="5573182">out</span><span class="op" id="5573185">,</span>&nbsp;<span class="ident" id="5573187">sub</span><span class="op" id="5573190">[</span><span class="ident" id="5573191">start</span><span class="op" id="5573196">]</span><span class="op" id="5573197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5573201">}</span>&nbsp;<span class="keyword" id="5573203">else</span>&nbsp;<span class="op" id="5573208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5573213">//&nbsp;Make&nbsp;new&nbsp;char&nbsp;class.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5573240">//&nbsp;Start&nbsp;with&nbsp;most&nbsp;complex&nbsp;regexp&nbsp;in&nbsp;sub[start].</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573292">max</span>&nbsp;<span class="op" id="5573296">:=</span>&nbsp;<span class="ident" id="5573299">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5573308">for</span>&nbsp;<span class="ident" id="5573312">j</span>&nbsp;<span class="op" id="5573314">:=</span>&nbsp;<span class="ident" id="5573317">start</span>&nbsp;<span class="op" id="5573323">+</span>&nbsp;<span class="num" id="5573325">1</span><span class="op" id="5573326">;</span>&nbsp;<span class="ident" id="5573328">j</span>&nbsp;<span class="op" id="5573330">&lt;</span>&nbsp;<span class="ident" id="5573332">i</span><span class="op" id="5573333">;</span>&nbsp;<span class="ident" id="5573335">j</span><span class="op" id="5573336">++</span>&nbsp;<span class="op" id="5573339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5573345">if</span>&nbsp;<span class="ident" id="5573348">sub</span><span class="op" id="5573351">[</span><span class="ident" id="5573352">max</span><span class="op" id="5573355">]</span><span class="op" id="5573356">.</span><span class="ident" id="5573357">Op</span>&nbsp;<span class="op" id="5573360">&lt;</span>&nbsp;<span class="ident" id="5573362">sub</span><span class="op" id="5573365">[</span><span class="ident" id="5573366">j</span><span class="op" id="5573367">]</span><span class="op" id="5573368">.</span><span class="ident" id="5573369">Op</span>&nbsp;<span class="op" id="5573372">||</span>&nbsp;<span class="ident" id="5573375">sub</span><span class="op" id="5573378">[</span><span class="ident" id="5573379">max</span><span class="op" id="5573382">]</span><span class="op" id="5573383">.</span><span class="ident" id="5573384">Op</span>&nbsp;<span class="op" id="5573387">==</span>&nbsp;<span class="ident" id="5573390">sub</span><span class="op" id="5573393">[</span><span class="ident" id="5573394">j</span><span class="op" id="5573395">]</span><span class="op" id="5573396">.</span><span class="ident" id="5573397">Op</span>&nbsp;<span class="op" id="5573400">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5573403">len</span><span class="op" id="5573406">(</span><span class="ident" id="5573407">sub</span><span class="op" id="5573410">[</span><span class="ident" id="5573411">max</span><span class="op" id="5573414">]</span><span class="op" id="5573415">.</span><span class="ident" id="5573416">Rune</span><span class="op" id="5573420">)</span>&nbsp;<span class="op" id="5573422">&lt;</span>&nbsp;<span class="builtinfunc" id="5573424">len</span><span class="op" id="5573427">(</span><span class="ident" id="5573428">sub</span><span class="op" id="5573431">[</span><span class="ident" id="5573432">j</span><span class="op" id="5573433">]</span><span class="op" id="5573434">.</span><span class="ident" id="5573435">Rune</span><span class="op" id="5573439">)</span>&nbsp;<span class="op" id="5573441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573448">max</span>&nbsp;<span class="op" id="5573452">=</span>&nbsp;<span class="ident" id="5573454">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5573460">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5573465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573470">sub</span><span class="op" id="5573473">[</span><span class="ident" id="5573474">start</span><span class="op" id="5573479">]</span><span class="op" id="5573480">,</span>&nbsp;<span class="ident" id="5573482">sub</span><span class="op" id="5573485">[</span><span class="ident" id="5573486">max</span><span class="op" id="5573489">]</span>&nbsp;<span class="op" id="5573491">=</span>&nbsp;<span class="ident" id="5573493">sub</span><span class="op" id="5573496">[</span><span class="ident" id="5573497">max</span><span class="op" id="5573500">]</span><span class="op" id="5573501">,</span>&nbsp;<span class="ident" id="5573503">sub</span><span class="op" id="5573506">[</span><span class="ident" id="5573507">start</span><span class="op" id="5573512">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5573518">for</span>&nbsp;<span class="ident" id="5573522">j</span>&nbsp;<span class="op" id="5573524">:=</span>&nbsp;<span class="ident" id="5573527">start</span>&nbsp;<span class="op" id="5573533">+</span>&nbsp;<span class="num" id="5573535">1</span><span class="op" id="5573536">;</span>&nbsp;<span class="ident" id="5573538">j</span>&nbsp;<span class="op" id="5573540">&lt;</span>&nbsp;<span class="ident" id="5573542">i</span><span class="op" id="5573543">;</span>&nbsp;<span class="ident" id="5573545">j</span><span class="op" id="5573546">++</span>&nbsp;<span class="op" id="5573549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573555">mergeCharClass</span><span class="op" id="5573569">(</span><span class="ident" id="5573570">sub</span><span class="op" id="5573573">[</span><span class="ident" id="5573574">start</span><span class="op" id="5573579">]</span><span class="op" id="5573580">,</span>&nbsp;<span class="ident" id="5573582">sub</span><span class="op" id="5573585">[</span><span class="ident" id="5573586">j</span><span class="op" id="5573587">]</span><span class="op" id="5573588">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573594">p</span><span class="op" id="5573595">.</span><span class="ident" id="5573596">reuse</span><span class="op" id="5573601">(</span><span class="ident" id="5573602">sub</span><span class="op" id="5573605">[</span><span class="ident" id="5573606">j</span><span class="op" id="5573607">]</span><span class="op" id="5573608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5573613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573618">cleanAlt</span><span class="op" id="5573626">(</span><span class="ident" id="5573627">sub</span><span class="op" id="5573630">[</span><span class="ident" id="5573631">start</span><span class="op" id="5573636">]</span><span class="op" id="5573637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573642">out</span>&nbsp;<span class="op" id="5573646">=</span>&nbsp;<span class="builtinfunc" id="5573648">append</span><span class="op" id="5573654">(</span><span class="ident" id="5573655">out</span><span class="op" id="5573658">,</span>&nbsp;<span class="ident" id="5573660">sub</span><span class="op" id="5573663">[</span><span class="ident" id="5573664">start</span><span class="op" id="5573669">]</span><span class="op" id="5573670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5573674">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5573679">//&nbsp;...&nbsp;and&nbsp;then&nbsp;emit&nbsp;sub[i].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5573710">if</span>&nbsp;<span class="ident" id="5573713">i</span>&nbsp;<span class="op" id="5573715">&lt;</span>&nbsp;<span class="builtinfunc" id="5573717">len</span><span class="op" id="5573720">(</span><span class="ident" id="5573721">sub</span><span class="op" id="5573724">)</span>&nbsp;<span class="op" id="5573726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573731">out</span>&nbsp;<span class="op" id="5573735">=</span>&nbsp;<span class="builtinfunc" id="5573737">append</span><span class="op" id="5573743">(</span><span class="ident" id="5573744">out</span><span class="op" id="5573747">,</span>&nbsp;<span class="ident" id="5573749">sub</span><span class="op" id="5573752">[</span><span class="ident" id="5573753">i</span><span class="op" id="5573754">]</span><span class="op" id="5573755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5573759">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573763">start</span>&nbsp;<span class="op" id="5573769">=</span>&nbsp;<span class="ident" id="5573771">i</span>&nbsp;<span class="op" id="5573773">+</span>&nbsp;<span class="num" id="5573775">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5573778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573781">sub</span>&nbsp;<span class="op" id="5573785">=</span>&nbsp;<span class="ident" id="5573787">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5573793">//&nbsp;Round&nbsp;4:&nbsp;Collapse&nbsp;runs&nbsp;of&nbsp;empty&nbsp;matches&nbsp;into&nbsp;a&nbsp;single&nbsp;empty&nbsp;match.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573864">start</span>&nbsp;<span class="op" id="5573870">=</span>&nbsp;<span class="num" id="5573872">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5573875">out</span>&nbsp;<span class="op" id="5573879">=</span>&nbsp;<span class="ident" id="5573881">sub</span><span class="op" id="5573884">[</span><span class="op" id="5573885">:</span><span class="num" id="5573886">0</span><span class="op" id="5573887">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5573890">for</span>&nbsp;<span class="ident" id="5573894">i</span>&nbsp;<span class="op" id="5573896">:=</span>&nbsp;<span class="keyword" id="5573899">range</span>&nbsp;<span class="ident" id="5573905">sub</span>&nbsp;<span class="op" id="5573909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5573913">if</span>&nbsp;<span class="ident" id="5573916">i</span><span class="op" id="5573917">+</span><span class="num" id="5573918">1</span>&nbsp;<span class="op" id="5573920">&lt;</span>&nbsp;<span class="builtinfunc" id="5573922">len</span><span class="op" id="5573925">(</span><span class="ident" id="5573926">sub</span><span class="op" id="5573929">)</span>&nbsp;<span class="op" id="5573931">&amp;&amp;</span>&nbsp;<span class="ident" id="5573934">sub</span><span class="op" id="5573937">[</span><span class="ident" id="5573938">i</span><span class="op" id="5573939">]</span><span class="op" id="5573940">.</span><span class="ident" id="5573941">Op</span>&nbsp;<span class="op" id="5573944">==</span>&nbsp;<span class="ident" id="5573947">OpEmptyMatch</span>&nbsp;<span class="op" id="5573960">&amp;&amp;</span>&nbsp;<span class="ident" id="5573963">sub</span><span class="op" id="5573966">[</span><span class="ident" id="5573967">i</span><span class="op" id="5573968">+</span><span class="num" id="5573969">1</span><span class="op" id="5573970">]</span><span class="op" id="5573971">.</span><span class="ident" id="5573972">Op</span>&nbsp;<span class="op" id="5573975">==</span>&nbsp;<span class="ident" id="5573978">OpEmptyMatch</span>&nbsp;<span class="op" id="5573991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5573996">continue</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5574007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5574011">out</span>&nbsp;<span class="op" id="5574015">=</span>&nbsp;<span class="builtinfunc" id="5574017">append</span><span class="op" id="5574023">(</span><span class="ident" id="5574024">out</span><span class="op" id="5574027">,</span>&nbsp;<span class="ident" id="5574029">sub</span><span class="op" id="5574032">[</span><span class="ident" id="5574033">i</span><span class="op" id="5574034">]</span><span class="op" id="5574035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5574038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5574041">sub</span>&nbsp;<span class="op" id="5574045">=</span>&nbsp;<span class="ident" id="5574047">out</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574053">return</span>&nbsp;<span class="ident" id="5574060">sub</span><br>
<span class="lineno"></span><span class="op" id="5574064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5574067">//&nbsp;leadingString&nbsp;returns&nbsp;the&nbsp;leading&nbsp;literal&nbsp;string&nbsp;that&nbsp;re&nbsp;begins&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="5574140">//&nbsp;The&nbsp;string&nbsp;refers&nbsp;to&nbsp;storage&nbsp;in&nbsp;re&nbsp;or&nbsp;its&nbsp;children.</span><br>
<span class="lineno">585</span><span class="keyword" id="5574195">func</span>&nbsp;<span class="op" id="5574200">(</span><span class="ident" id="5574201">p</span>&nbsp;<span class="op" id="5574203">*</span><span class="ident" id="5574204">parser</span><span class="op" id="5574210">)</span>&nbsp;<span class="ident" id="5574212">leadingString</span><span class="op" id="5574225">(</span><span class="ident" id="5574226">re</span>&nbsp;<span class="op" id="5574229">*</span><span class="ident" id="5574230">Regexp</span><span class="op" id="5574236">)</span>&nbsp;<span class="op" id="5574238">(</span><span class="op" id="5574239">[</span><span class="op" id="5574240">]</span><span class="builtintype" id="5574241">rune</span><span class="op" id="5574245">,</span>&nbsp;<span class="ident" id="5574247">Flags</span><span class="op" id="5574252">)</span>&nbsp;<span class="op" id="5574254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574257">if</span>&nbsp;<span class="ident" id="5574260">re</span><span class="op" id="5574262">.</span><span class="ident" id="5574263">Op</span>&nbsp;<span class="op" id="5574266">==</span>&nbsp;<span class="ident" id="5574269">OpConcat</span>&nbsp;<span class="op" id="5574278">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5574281">len</span><span class="op" id="5574284">(</span><span class="ident" id="5574285">re</span><span class="op" id="5574287">.</span><span class="ident" id="5574288">Sub</span><span class="op" id="5574291">)</span>&nbsp;<span class="op" id="5574293">&gt;</span>&nbsp;<span class="num" id="5574295">0</span>&nbsp;<span class="op" id="5574297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5574301">re</span>&nbsp;<span class="op" id="5574304">=</span>&nbsp;<span class="ident" id="5574306">re</span><span class="op" id="5574308">.</span><span class="ident" id="5574309">Sub</span><span class="op" id="5574312">[</span><span class="num" id="5574313">0</span><span class="op" id="5574314">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5574317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574320">if</span>&nbsp;<span class="ident" id="5574323">re</span><span class="op" id="5574325">.</span><span class="ident" id="5574326">Op</span>&nbsp;<span class="op" id="5574329">!=</span>&nbsp;<span class="ident" id="5574332">OpLiteral</span>&nbsp;<span class="op" id="5574342">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574346">return</span>&nbsp;<span class="ident" id="5574353">nil</span><span class="op" id="5574356">,</span>&nbsp;<span class="num" id="5574358">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5574361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574364">return</span>&nbsp;<span class="ident" id="5574371">re</span><span class="op" id="5574373">.</span><span class="ident" id="5574374">Rune</span><span class="op" id="5574378">,</span>&nbsp;<span class="ident" id="5574380">re</span><span class="op" id="5574382">.</span><span class="ident" id="5574383">Flags</span>&nbsp;<span class="op" id="5574389">&amp;</span>&nbsp;<span class="ident" id="5574391">FoldCase</span><br>
<span class="lineno"></span><span class="op" id="5574400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="comment" id="5574403">//&nbsp;removeLeadingString&nbsp;removes&nbsp;the&nbsp;first&nbsp;n&nbsp;leading&nbsp;runes</span><br>
<span class="lineno"></span><span class="comment" id="5574460">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;re.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;replacement&nbsp;for&nbsp;re.</span><br>
<span class="lineno"></span><span class="keyword" id="5574525">func</span>&nbsp;<span class="op" id="5574530">(</span><span class="ident" id="5574531">p</span>&nbsp;<span class="op" id="5574533">*</span><span class="ident" id="5574534">parser</span><span class="op" id="5574540">)</span>&nbsp;<span class="ident" id="5574542">removeLeadingString</span><span class="op" id="5574561">(</span><span class="ident" id="5574562">re</span>&nbsp;<span class="op" id="5574565">*</span><span class="ident" id="5574566">Regexp</span><span class="op" id="5574572">,</span>&nbsp;<span class="ident" id="5574574">n</span>&nbsp;<span class="builtintype" id="5574576">int</span><span class="op" id="5574579">)</span>&nbsp;<span class="op" id="5574581">*</span><span class="ident" id="5574582">Regexp</span>&nbsp;<span class="op" id="5574589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574592">if</span>&nbsp;<span class="ident" id="5574595">re</span><span class="op" id="5574597">.</span><span class="ident" id="5574598">Op</span>&nbsp;<span class="op" id="5574601">==</span>&nbsp;<span class="ident" id="5574604">OpConcat</span>&nbsp;<span class="op" id="5574613">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5574616">len</span><span class="op" id="5574619">(</span><span class="ident" id="5574620">re</span><span class="op" id="5574622">.</span><span class="ident" id="5574623">Sub</span><span class="op" id="5574626">)</span>&nbsp;<span class="op" id="5574628">&gt;</span>&nbsp;<span class="num" id="5574630">0</span>&nbsp;<span class="op" id="5574632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5574636">//&nbsp;Removing&nbsp;a&nbsp;leading&nbsp;string&nbsp;in&nbsp;a&nbsp;concatenation</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5574686">//&nbsp;might&nbsp;simplify&nbsp;the&nbsp;concatenation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5574725">sub</span>&nbsp;<span class="op" id="5574729">:=</span>&nbsp;<span class="ident" id="5574732">re</span><span class="op" id="5574734">.</span><span class="ident" id="5574735">Sub</span><span class="op" id="5574738">[</span><span class="num" id="5574739">0</span><span class="op" id="5574740">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5574744">sub</span>&nbsp;<span class="op" id="5574748">=</span>&nbsp;<span class="ident" id="5574750">p</span><span class="op" id="5574751">.</span><span class="ident" id="5574752">removeLeadingString</span><span class="op" id="5574771">(</span><span class="ident" id="5574772">sub</span><span class="op" id="5574775">,</span>&nbsp;<span class="ident" id="5574777">n</span><span class="op" id="5574778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5574782">re</span><span class="op" id="5574784">.</span><span class="ident" id="5574785">Sub</span><span class="op" id="5574788">[</span><span class="num" id="5574789">0</span><span class="op" id="5574790">]</span>&nbsp;<span class="op" id="5574792">=</span>&nbsp;<span class="ident" id="5574794">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574800">if</span>&nbsp;<span class="ident" id="5574803">sub</span><span class="op" id="5574806">.</span><span class="ident" id="5574807">Op</span>&nbsp;<span class="op" id="5574810">==</span>&nbsp;<span class="ident" id="5574813">OpEmptyMatch</span>&nbsp;<span class="op" id="5574826">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5574831">p</span><span class="op" id="5574832">.</span><span class="ident" id="5574833">reuse</span><span class="op" id="5574838">(</span><span class="ident" id="5574839">sub</span><span class="op" id="5574842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574847">switch</span>&nbsp;<span class="builtinfunc" id="5574854">len</span><span class="op" id="5574857">(</span><span class="ident" id="5574858">re</span><span class="op" id="5574860">.</span><span class="ident" id="5574861">Sub</span><span class="op" id="5574864">)</span>&nbsp;<span class="op" id="5574866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574871">case</span>&nbsp;<span class="num" id="5574876">0</span><span class="op" id="5574877">,</span>&nbsp;<span class="num" id="5574879">1</span><span class="op" id="5574880">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5574886">//&nbsp;Impossible&nbsp;but&nbsp;handle.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5574916">re</span><span class="op" id="5574918">.</span><span class="ident" id="5574919">Op</span>&nbsp;<span class="op" id="5574922">=</span>&nbsp;<span class="ident" id="5574924">OpEmptyMatch</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5574941">re</span><span class="op" id="5574943">.</span><span class="ident" id="5574944">Sub</span>&nbsp;<span class="op" id="5574948">=</span>&nbsp;<span class="ident" id="5574950">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5574957">case</span>&nbsp;<span class="num" id="5574962">2</span><span class="op" id="5574963">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5574969">old</span>&nbsp;<span class="op" id="5574973">:=</span>&nbsp;<span class="ident" id="5574976">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5574983">re</span>&nbsp;<span class="op" id="5574986">=</span>&nbsp;<span class="ident" id="5574988">re</span><span class="op" id="5574990">.</span><span class="ident" id="5574991">Sub</span><span class="op" id="5574994">[</span><span class="num" id="5574995">1</span><span class="op" id="5574996">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5575002">p</span><span class="op" id="5575003">.</span><span class="ident" id="5575004">reuse</span><span class="op" id="5575009">(</span><span class="ident" id="5575010">old</span><span class="op" id="5575013">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575018">default</span><span class="op" id="5575025">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5575031">copy</span><span class="op" id="5575035">(</span><span class="ident" id="5575036">re</span><span class="op" id="5575038">.</span><span class="ident" id="5575039">Sub</span><span class="op" id="5575042">,</span>&nbsp;<span class="ident" id="5575044">re</span><span class="op" id="5575046">.</span><span class="ident" id="5575047">Sub</span><span class="op" id="5575050">[</span><span class="num" id="5575051">1</span><span class="op" id="5575052">:</span><span class="op" id="5575053">]</span><span class="op" id="5575054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5575060">re</span><span class="op" id="5575062">.</span><span class="ident" id="5575063">Sub</span>&nbsp;<span class="op" id="5575067">=</span>&nbsp;<span class="ident" id="5575069">re</span><span class="op" id="5575071">.</span><span class="ident" id="5575072">Sub</span><span class="op" id="5575075">[</span><span class="op" id="5575076">:</span><span class="builtinfunc" id="5575077">len</span><span class="op" id="5575080">(</span><span class="ident" id="5575081">re</span><span class="op" id="5575083">.</span><span class="ident" id="5575084">Sub</span><span class="op" id="5575087">)</span><span class="op" id="5575088">-</span><span class="num" id="5575089">1</span><span class="op" id="5575090">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5575095">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5575099">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575103">return</span>&nbsp;<span class="ident" id="5575110">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5575114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575118">if</span>&nbsp;<span class="ident" id="5575121">re</span><span class="op" id="5575123">.</span><span class="ident" id="5575124">Op</span>&nbsp;<span class="op" id="5575127">==</span>&nbsp;<span class="ident" id="5575130">OpLiteral</span>&nbsp;<span class="op" id="5575140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5575144">re</span><span class="op" id="5575146">.</span><span class="ident" id="5575147">Rune</span>&nbsp;<span class="op" id="5575152">=</span>&nbsp;<span class="ident" id="5575154">re</span><span class="op" id="5575156">.</span><span class="ident" id="5575157">Rune</span><span class="op" id="5575161">[</span><span class="op" id="5575162">:</span><span class="builtinfunc" id="5575163">copy</span><span class="op" id="5575167">(</span><span class="ident" id="5575168">re</span><span class="op" id="5575170">.</span><span class="ident" id="5575171">Rune</span><span class="op" id="5575175">,</span>&nbsp;<span class="ident" id="5575177">re</span><span class="op" id="5575179">.</span><span class="ident" id="5575180">Rune</span><span class="op" id="5575184">[</span><span class="ident" id="5575185">n</span><span class="op" id="5575186">:</span><span class="op" id="5575187">]</span><span class="op" id="5575188">)</span><span class="op" id="5575189">]</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575193">if</span>&nbsp;<span class="builtinfunc" id="5575196">len</span><span class="op" id="5575199">(</span><span class="ident" id="5575200">re</span><span class="op" id="5575202">.</span><span class="ident" id="5575203">Rune</span><span class="op" id="5575207">)</span>&nbsp;<span class="op" id="5575209">==</span>&nbsp;<span class="num" id="5575212">0</span>&nbsp;<span class="op" id="5575214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5575219">re</span><span class="op" id="5575221">.</span><span class="ident" id="5575222">Op</span>&nbsp;<span class="op" id="5575225">=</span>&nbsp;<span class="ident" id="5575227">OpEmptyMatch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5575242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5575245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575248">return</span>&nbsp;<span class="ident" id="5575255">re</span><br>
<span class="lineno">630</span><span class="op" id="5575258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5575261">//&nbsp;leadingRegexp&nbsp;returns&nbsp;the&nbsp;leading&nbsp;regexp&nbsp;that&nbsp;re&nbsp;begins&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="5575326">//&nbsp;The&nbsp;regexp&nbsp;refers&nbsp;to&nbsp;storage&nbsp;in&nbsp;re&nbsp;or&nbsp;its&nbsp;children.</span><br>
<span class="lineno"></span><span class="keyword" id="5575381">func</span>&nbsp;<span class="op" id="5575386">(</span><span class="ident" id="5575387">p</span>&nbsp;<span class="op" id="5575389">*</span><span class="ident" id="5575390">parser</span><span class="op" id="5575396">)</span>&nbsp;<span class="ident" id="5575398">leadingRegexp</span><span class="op" id="5575411">(</span><span class="ident" id="5575412">re</span>&nbsp;<span class="op" id="5575415">*</span><span class="ident" id="5575416">Regexp</span><span class="op" id="5575422">)</span>&nbsp;<span class="op" id="5575424">*</span><span class="ident" id="5575425">Regexp</span>&nbsp;<span class="op" id="5575432">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575435">if</span>&nbsp;<span class="ident" id="5575438">re</span><span class="op" id="5575440">.</span><span class="ident" id="5575441">Op</span>&nbsp;<span class="op" id="5575444">==</span>&nbsp;<span class="ident" id="5575447">OpEmptyMatch</span>&nbsp;<span class="op" id="5575460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575464">return</span>&nbsp;<span class="ident" id="5575471">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5575476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575479">if</span>&nbsp;<span class="ident" id="5575482">re</span><span class="op" id="5575484">.</span><span class="ident" id="5575485">Op</span>&nbsp;<span class="op" id="5575488">==</span>&nbsp;<span class="ident" id="5575491">OpConcat</span>&nbsp;<span class="op" id="5575500">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5575503">len</span><span class="op" id="5575506">(</span><span class="ident" id="5575507">re</span><span class="op" id="5575509">.</span><span class="ident" id="5575510">Sub</span><span class="op" id="5575513">)</span>&nbsp;<span class="op" id="5575515">&gt;</span>&nbsp;<span class="num" id="5575517">0</span>&nbsp;<span class="op" id="5575519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5575523">sub</span>&nbsp;<span class="op" id="5575527">:=</span>&nbsp;<span class="ident" id="5575530">re</span><span class="op" id="5575532">.</span><span class="ident" id="5575533">Sub</span><span class="op" id="5575536">[</span><span class="num" id="5575537">0</span><span class="op" id="5575538">]</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575542">if</span>&nbsp;<span class="ident" id="5575545">sub</span><span class="op" id="5575548">.</span><span class="ident" id="5575549">Op</span>&nbsp;<span class="op" id="5575552">==</span>&nbsp;<span class="ident" id="5575555">OpEmptyMatch</span>&nbsp;<span class="op" id="5575568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575573">return</span>&nbsp;<span class="ident" id="5575580">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5575586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575590">return</span>&nbsp;<span class="ident" id="5575597">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5575602">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575605">return</span>&nbsp;<span class="ident" id="5575612">re</span><br>
<span class="lineno"></span><span class="op" id="5575615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5575618">//&nbsp;removeLeadingRegexp&nbsp;removes&nbsp;the&nbsp;leading&nbsp;regexp&nbsp;in&nbsp;re.</span><br>
<span class="lineno"></span><span class="comment" id="5575675">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;replacement&nbsp;for&nbsp;re.</span><br>
<span class="lineno">650</span><span class="comment" id="5575713">//&nbsp;If&nbsp;reuse&nbsp;is&nbsp;true,&nbsp;it&nbsp;passes&nbsp;the&nbsp;removed&nbsp;regexp&nbsp;(if&nbsp;no&nbsp;longer&nbsp;needed)&nbsp;to&nbsp;p.reuse.</span><br>
<span class="lineno"></span><span class="keyword" id="5575797">func</span>&nbsp;<span class="op" id="5575802">(</span><span class="ident" id="5575803">p</span>&nbsp;<span class="op" id="5575805">*</span><span class="ident" id="5575806">parser</span><span class="op" id="5575812">)</span>&nbsp;<span class="ident" id="5575814">removeLeadingRegexp</span><span class="op" id="5575833">(</span><span class="ident" id="5575834">re</span>&nbsp;<span class="op" id="5575837">*</span><span class="ident" id="5575838">Regexp</span><span class="op" id="5575844">,</span>&nbsp;<span class="ident" id="5575846">reuse</span>&nbsp;<span class="builtintype" id="5575852">bool</span><span class="op" id="5575856">)</span>&nbsp;<span class="op" id="5575858">*</span><span class="ident" id="5575859">Regexp</span>&nbsp;<span class="op" id="5575866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575869">if</span>&nbsp;<span class="ident" id="5575872">re</span><span class="op" id="5575874">.</span><span class="ident" id="5575875">Op</span>&nbsp;<span class="op" id="5575878">==</span>&nbsp;<span class="ident" id="5575881">OpConcat</span>&nbsp;<span class="op" id="5575890">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5575893">len</span><span class="op" id="5575896">(</span><span class="ident" id="5575897">re</span><span class="op" id="5575899">.</span><span class="ident" id="5575900">Sub</span><span class="op" id="5575903">)</span>&nbsp;<span class="op" id="5575905">&gt;</span>&nbsp;<span class="num" id="5575907">0</span>&nbsp;<span class="op" id="5575909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575913">if</span>&nbsp;<span class="ident" id="5575916">reuse</span>&nbsp;<span class="op" id="5575922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5575927">p</span><span class="op" id="5575928">.</span><span class="ident" id="5575929">reuse</span><span class="op" id="5575934">(</span><span class="ident" id="5575935">re</span><span class="op" id="5575937">.</span><span class="ident" id="5575938">Sub</span><span class="op" id="5575941">[</span><span class="num" id="5575942">0</span><span class="op" id="5575943">]</span><span class="op" id="5575944">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5575948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5575952">re</span><span class="op" id="5575954">.</span><span class="ident" id="5575955">Sub</span>&nbsp;<span class="op" id="5575959">=</span>&nbsp;<span class="ident" id="5575961">re</span><span class="op" id="5575963">.</span><span class="ident" id="5575964">Sub</span><span class="op" id="5575967">[</span><span class="op" id="5575968">:</span><span class="builtinfunc" id="5575969">copy</span><span class="op" id="5575973">(</span><span class="ident" id="5575974">re</span><span class="op" id="5575976">.</span><span class="ident" id="5575977">Sub</span><span class="op" id="5575980">,</span>&nbsp;<span class="ident" id="5575982">re</span><span class="op" id="5575984">.</span><span class="ident" id="5575985">Sub</span><span class="op" id="5575988">[</span><span class="num" id="5575989">1</span><span class="op" id="5575990">:</span><span class="op" id="5575991">]</span><span class="op" id="5575992">)</span><span class="op" id="5575993">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5575997">switch</span>&nbsp;<span class="builtinfunc" id="5576004">len</span><span class="op" id="5576007">(</span><span class="ident" id="5576008">re</span><span class="op" id="5576010">.</span><span class="ident" id="5576011">Sub</span><span class="op" id="5576014">)</span>&nbsp;<span class="op" id="5576016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576020">case</span>&nbsp;<span class="num" id="5576025">0</span><span class="op" id="5576026">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576031">re</span><span class="op" id="5576033">.</span><span class="ident" id="5576034">Op</span>&nbsp;<span class="op" id="5576037">=</span>&nbsp;<span class="ident" id="5576039">OpEmptyMatch</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576055">re</span><span class="op" id="5576057">.</span><span class="ident" id="5576058">Sub</span>&nbsp;<span class="op" id="5576062">=</span>&nbsp;<span class="ident" id="5576064">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576070">case</span>&nbsp;<span class="num" id="5576075">1</span><span class="op" id="5576076">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576081">old</span>&nbsp;<span class="op" id="5576085">:=</span>&nbsp;<span class="ident" id="5576088">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576094">re</span>&nbsp;<span class="op" id="5576097">=</span>&nbsp;<span class="ident" id="5576099">re</span><span class="op" id="5576101">.</span><span class="ident" id="5576102">Sub</span><span class="op" id="5576105">[</span><span class="num" id="5576106">0</span><span class="op" id="5576107">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576112">p</span><span class="op" id="5576113">.</span><span class="ident" id="5576114">reuse</span><span class="op" id="5576119">(</span><span class="ident" id="5576120">old</span><span class="op" id="5576123">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5576127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576131">return</span>&nbsp;<span class="ident" id="5576138">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5576142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576145">if</span>&nbsp;<span class="ident" id="5576148">reuse</span>&nbsp;<span class="op" id="5576154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576158">p</span><span class="op" id="5576159">.</span><span class="ident" id="5576160">reuse</span><span class="op" id="5576165">(</span><span class="ident" id="5576166">re</span><span class="op" id="5576168">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5576171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576174">return</span>&nbsp;<span class="ident" id="5576181">p</span><span class="op" id="5576182">.</span><span class="ident" id="5576183">newRegexp</span><span class="op" id="5576192">(</span><span class="ident" id="5576193">OpEmptyMatch</span><span class="op" id="5576205">)</span><br>
<span class="lineno"></span><span class="op" id="5576207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5576210">func</span>&nbsp;<span class="ident" id="5576215">literalRegexp</span><span class="op" id="5576228">(</span><span class="ident" id="5576229">s</span>&nbsp;<span class="builtintype" id="5576231">string</span><span class="op" id="5576237">,</span>&nbsp;<span class="ident" id="5576239">flags</span>&nbsp;<span class="ident" id="5576245">Flags</span><span class="op" id="5576250">)</span>&nbsp;<span class="op" id="5576252">*</span><span class="ident" id="5576253">Regexp</span>&nbsp;<span class="op" id="5576260">{</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576263">re</span>&nbsp;<span class="op" id="5576266">:=</span>&nbsp;<span class="op" id="5576269">&amp;</span><span class="ident" id="5576270">Regexp</span><span class="op" id="5576276">{</span><span class="ident" id="5576277">Op</span><span class="op" id="5576279">:</span>&nbsp;<span class="ident" id="5576281">OpLiteral</span><span class="op" id="5576290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576293">re</span><span class="op" id="5576295">.</span><span class="ident" id="5576296">Flags</span>&nbsp;<span class="op" id="5576302">=</span>&nbsp;<span class="ident" id="5576304">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576311">re</span><span class="op" id="5576313">.</span><span class="ident" id="5576314">Rune</span>&nbsp;<span class="op" id="5576319">=</span>&nbsp;<span class="ident" id="5576321">re</span><span class="op" id="5576323">.</span><span class="ident" id="5576324">Rune0</span><span class="op" id="5576329">[</span><span class="op" id="5576330">:</span><span class="num" id="5576331">0</span><span class="op" id="5576332">]</span>&nbsp;<span class="comment" id="5576334">//&nbsp;use&nbsp;local&nbsp;storage&nbsp;for&nbsp;small&nbsp;strings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576374">for</span>&nbsp;<span class="ident" id="5576378">_</span><span class="op" id="5576379">,</span>&nbsp;<span class="ident" id="5576381">c</span>&nbsp;<span class="op" id="5576383">:=</span>&nbsp;<span class="keyword" id="5576386">range</span>&nbsp;<span class="ident" id="5576392">s</span>&nbsp;<span class="op" id="5576394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576398">if</span>&nbsp;<span class="builtinfunc" id="5576401">len</span><span class="op" id="5576404">(</span><span class="ident" id="5576405">re</span><span class="op" id="5576407">.</span><span class="ident" id="5576408">Rune</span><span class="op" id="5576412">)</span>&nbsp;<span class="op" id="5576414">&gt;=</span>&nbsp;<span class="builtinfunc" id="5576417">cap</span><span class="op" id="5576420">(</span><span class="ident" id="5576421">re</span><span class="op" id="5576423">.</span><span class="ident" id="5576424">Rune</span><span class="op" id="5576428">)</span>&nbsp;<span class="op" id="5576430">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5576435">//&nbsp;string&nbsp;is&nbsp;too&nbsp;long&nbsp;to&nbsp;fit&nbsp;in&nbsp;Rune0.&nbsp;&nbsp;let&nbsp;Go&nbsp;handle&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576495">re</span><span class="op" id="5576497">.</span><span class="ident" id="5576498">Rune</span>&nbsp;<span class="op" id="5576503">=</span>&nbsp;<span class="op" id="5576505">[</span><span class="op" id="5576506">]</span><span class="builtintype" id="5576507">rune</span><span class="op" id="5576511">(</span><span class="ident" id="5576512">s</span><span class="op" id="5576513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576518">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5576526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5576530">re</span><span class="op" id="5576532">.</span><span class="ident" id="5576533">Rune</span>&nbsp;<span class="op" id="5576538">=</span>&nbsp;<span class="builtinfunc" id="5576540">append</span><span class="op" id="5576546">(</span><span class="ident" id="5576547">re</span><span class="op" id="5576549">.</span><span class="ident" id="5576550">Rune</span><span class="op" id="5576554">,</span>&nbsp;<span class="ident" id="5576556">c</span><span class="op" id="5576557">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5576560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576563">return</span>&nbsp;<span class="ident" id="5576570">re</span><br>
<span class="lineno"></span><span class="op" id="5576573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5576576">//&nbsp;Parsing.</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="comment" id="5576589">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;regular&nbsp;expression&nbsp;string&nbsp;s,&nbsp;controlled&nbsp;by&nbsp;the&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="5576664">//&nbsp;Flags,&nbsp;and&nbsp;returns&nbsp;a&nbsp;regular&nbsp;expression&nbsp;parse&nbsp;tree.&nbsp;The&nbsp;syntax&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5576733">//&nbsp;described&nbsp;in&nbsp;the&nbsp;top-level&nbsp;comment.</span><br>
<span class="lineno"></span><span class="keyword" id="5576772">func</span>&nbsp;<span class="ident" id="5576777">Parse</span><span class="op" id="5576782">(</span><span class="ident" id="5576783">s</span>&nbsp;<span class="builtintype" id="5576785">string</span><span class="op" id="5576791">,</span>&nbsp;<span class="ident" id="5576793">flags</span>&nbsp;<span class="ident" id="5576799">Flags</span><span class="op" id="5576804">)</span>&nbsp;<span class="op" id="5576806">(</span><span class="op" id="5576807">*</span><span class="ident" id="5576808">Regexp</span><span class="op" id="5576814">,</span>&nbsp;<span class="builtintype" id="5576816">error</span><span class="op" id="5576821">)</span>&nbsp;<span class="op" id="5576823">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576826">if</span>&nbsp;<span class="ident" id="5576829">flags</span><span class="op" id="5576834">&amp;</span><span class="ident" id="5576835">Literal</span>&nbsp;<span class="op" id="5576843">!=</span>&nbsp;<span class="num" id="5576846">0</span>&nbsp;<span class="op" id="5576848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5576852">//&nbsp;Trivial&nbsp;parser&nbsp;for&nbsp;literal&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576892">if</span>&nbsp;<span class="ident" id="5576895">err</span>&nbsp;<span class="op" id="5576899">:=</span>&nbsp;<span class="ident" id="5576902">checkUTF8</span><span class="op" id="5576911">(</span><span class="ident" id="5576912">s</span><span class="op" id="5576913">)</span><span class="op" id="5576914">;</span>&nbsp;<span class="ident" id="5576916">err</span>&nbsp;<span class="op" id="5576920">!=</span>&nbsp;<span class="ident" id="5576923">nil</span>&nbsp;<span class="op" id="5576927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576932">return</span>&nbsp;<span class="ident" id="5576939">nil</span><span class="op" id="5576942">,</span>&nbsp;<span class="ident" id="5576944">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5576950">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5576954">return</span>&nbsp;<span class="ident" id="5576961">literalRegexp</span><span class="op" id="5576974">(</span><span class="ident" id="5576975">s</span><span class="op" id="5576976">,</span>&nbsp;<span class="ident" id="5576978">flags</span><span class="op" id="5576983">)</span><span class="op" id="5576984">,</span>&nbsp;<span class="ident" id="5576986">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5576991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5576995">//&nbsp;Otherwise,&nbsp;must&nbsp;do&nbsp;real&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5577029">var</span>&nbsp;<span class="op" id="5577033">(</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5577037">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577048">parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5577057">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5577068">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5577076">c</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5577087">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5577094">op</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5577105">Op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5577110">lastRepeat</span>&nbsp;<span class="builtintype" id="5577121">string</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5577129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5577132">p</span><span class="op" id="5577133">.</span><span class="ident" id="5577134">flags</span>&nbsp;<span class="op" id="5577140">=</span>&nbsp;<span class="ident" id="5577142">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5577149">p</span><span class="op" id="5577150">.</span><span class="ident" id="5577151">wholeRegexp</span>&nbsp;<span class="op" id="5577163">=</span>&nbsp;<span class="ident" id="5577165">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5577168">t</span>&nbsp;<span class="op" id="5577170">:=</span>&nbsp;<span class="ident" id="5577173">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5577176">for</span>&nbsp;<span class="ident" id="5577180">t</span>&nbsp;<span class="op" id="5577182">!=</span>&nbsp;<span class="string" id="5577185">&#34;&#34;</span>&nbsp;<span class="op" id="5577188">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5577192">repeat</span>&nbsp;<span class="op" id="5577199">:=</span>&nbsp;<span class="string" id="5577202">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5577206">BigSwitch</span><span class="op" id="5577215">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5577219">switch</span>&nbsp;<span class="ident" id="5577226">t</span><span class="op" id="5577227">[</span><span class="num" id="5577228">0</span><span class="op" id="5577229">]</span>&nbsp;<span class="op" id="5577231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5577235">default</span><span class="op" id="5577242">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5577247">if</span>&nbsp;<span class="ident" id="5577250">c</span><span class="op" id="5577251">,</span>&nbsp;<span class="ident" id="5577253">t</span><span class="op" id="5577254">,</span>&nbsp;<span class="ident" id="5577256">err</span>&nbsp;<span class="op" id="5577260">=</span>&nbsp;<span class="ident" id="5577262">nextRune</span><span class="op" id="5577270">(</span><span class="ident" id="5577271">t</span><span class="op" id="5577272">)</span><span class="op" id="5577273">;</span>&nbsp;<span class="ident" id="5577275">err</span>&nbsp;<span class="op" id="5577279">!=</span>&nbsp;<span class="ident" id="5577282">nil</span>&nbsp;<span class="op" id="5577286">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5577292">return</span>&nbsp;<span class="ident" id="5577299">nil</span><span class="op" id="5577302">,</span>&nbsp;<span class="ident" id="5577304">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5577311">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5577316">p</span><span class="op" id="5577317">.</span><span class="ident" id="5577318">literal</span><span class="op" id="5577325">(</span><span class="ident" id="5577326">c</span><span class="op" id="5577327">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5577332">case</span>&nbsp;<span class="string" id="5577337">&#39;(&#39;</span><span class="op" id="5577340">:</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5577345">if</span>&nbsp;<span class="ident" id="5577348">p</span><span class="op" id="5577349">.</span><span class="ident" id="5577350">flags</span><span class="op" id="5577355">&amp;</span><span class="ident" id="5577356">PerlX</span>&nbsp;<span class="op" id="5577362">!=</span>&nbsp;<span class="num" id="5577365">0</span>&nbsp;<span class="op" id="5577367">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5577370">len</span><span class="op" id="5577373">(</span><span class="ident" id="5577374">t</span><span class="op" id="5577375">)</span>&nbsp;<span class="op" id="5577377">&gt;=</span>&nbsp;<span class="num" id="5577380">2</span>&nbsp;<span class="op" id="5577382">&amp;&amp;</span>&nbsp;<span class="ident" id="5577385">t</span><span class="op" id="5577386">[</span><span class="num" id="5577387">1</span><span class="op" id="5577388">]</span>&nbsp;<span class="op" id="5577390">==</span>&nbsp;<span class="string" id="5577393">&#39;?&#39;</span>&nbsp;<span class="op" id="5577397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5577403">//&nbsp;Flag&nbsp;changes&nbsp;and&nbsp;non-capturing&nbsp;groups.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5577449">if</span>&nbsp;<span class="ident" id="5577452">t</span><span class="op" id="5577453">,</span>&nbsp;<span class="ident" id="5577455">err</span>&nbsp;<span class="op" id="5577459">=</span>&nbsp;<span class="ident" id="5577461">p</span><span class="op" id="5577462">.</span><span class="ident" id="5577463">parsePerlFlags</span><span class="op" id="5577477">(</span><span class="ident" id="5577478">t</span><span class="op" id="5577479">)</span><span class="op" id="5577480">;</span>&nbsp;<span class="ident" id="5577482">err</span>&nbsp;<span class="op" id="5577486">!=</span>&nbsp;<span class="ident" id="5577489">nil</span>&nbsp;<span class="op" id="5577493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5577500">return</span>&nbsp;<span class="ident" id="5577507">nil</span><span class="op" id="5577510">,</span>&nbsp;<span class="ident" id="5577512">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5577520">}</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5577526">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5577535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5577540">p</span><span class="op" id="5577541">.</span><span class="ident" id="5577542">numCap</span><span class="op" id="5577548">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5577554">p</span><span class="op" id="5577555">.</span><span class="ident" id="5577556">op</span><span class="op" id="5577558">(</span><span class="ident" id="5577559">opLeftParen</span><span class="op" id="5577570">)</span><span class="op" id="5577571">.</span><span class="ident" id="5577572">Cap</span>&nbsp;<span class="op" id="5577576">=</span>&nbsp;<span class="ident" id="5577578">p</span><span class="op" id="5577579">.</span><span class="ident" id="5577580">numCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5577590">t</span>&nbsp;<span class="op" id="5577592">=</span>&nbsp;<span class="ident" id="5577594">t</span><span class="op" id="5577595">[</span><span class="num" id="5577596">1</span><span class="op" id="5577597">:</span><span class="op" id="5577598">]</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5577602">case</span>&nbsp;<span class="string" id="5577607">&#39;|&#39;</span><span class="op" id="5577610">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5577615">if</span>&nbsp;<span class="ident" id="5577618">err</span>&nbsp;<span class="op" id="5577622">=</span>&nbsp;<span class="ident" id="5577624">p</span><span class="op" id="5577625">.</span><span class="ident" id="5577626">parseVerticalBar</span><span class="op" id="5577642">(</span><span class="op" id="5577643">)</span><span class="op" id="5577644">;</span>&nbsp;<span class="ident" id="5577646">err</span>&nbsp;<span class="op" id="5577650">!=</span>&nbsp;<span class="ident" id="5577653">nil</span>&nbsp;<span class="op" id="5577657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5577663">return</span>&nbsp;<span class="ident" id="5577670">nil</span><span class="op" id="5577673">,</span>&nbsp;<span class="ident" id="5577675">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5577682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5577687">t</span>&nbsp;<span class="op" id="5577689">=</span>&nbsp;<span class="ident" id="5577691">t</span><span class="op" id="5577692">[</span><span class="num" id="5577693">1</span><span class="op" id="5577694">:</span><span class="op" id="5577695">]</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5577699">case</span>&nbsp;<span class="string" id="5577704">&#39;)&#39;</span><span class="op" id="5577707">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5577712">if</span>&nbsp;<span class="ident" id="5577715">err</span>&nbsp;<span class="op" id="5577719">=</span>&nbsp;<span class="ident" id="5577721">p</span><span class="op" id="5577722">.</span><span class="ident" id="5577723">parseRightParen</span><span class="op" id="5577738">(</span><span class="op" id="5577739">)</span><span class="op" id="5577740">;</span>&nbsp;<span class="ident" id="5577742">err</span>&nbsp;<span class="op" id="5577746">!=</span>&nbsp;<span class="ident" id="5577749">nil</span>&nbsp;<span class="op" id="5577753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5577759">return</span>&nbsp;<span class="ident" id="5577766">nil</span><span class="op" id="5577769">,</span>&nbsp;<span class="ident" id="5577771">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5577778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5577783">t</span>&nbsp;<span class="op" id="5577785">=</span>&nbsp;<span class="ident" id="5577787">t</span><span class="op" id="5577788">[</span><span class="num" id="5577789">1</span><span class="op" id="5577790">:</span><span class="op" id="5577791">]</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5577795">case</span>&nbsp;<span class="string" id="5577800">&#39;^&#39;</span><span class="op" id="5577803">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5577808">if</span>&nbsp;<span class="ident" id="5577811">p</span><span class="op" id="5577812">.</span><span class="ident" id="5577813">flags</span><span class="op" id="5577818">&amp;</span><span class="ident" id="5577819">OneLine</span>&nbsp;<span class="op" id="5577827">!=</span>&nbsp;<span class="num" id="5577830">0</span>&nbsp;<span class="op" id="5577832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5577838">p</span><span class="op" id="5577839">.</span><span class="ident" id="5577840">op</span><span class="op" id="5577842">(</span><span class="ident" id="5577843">OpBeginText</span><span class="op" id="5577854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5577859">}</span>&nbsp;<span class="keyword" id="5577861">else</span>&nbsp;<span class="op" id="5577866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5577872">p</span><span class="op" id="5577873">.</span><span class="ident" id="5577874">op</span><span class="op" id="5577876">(</span><span class="ident" id="5577877">OpBeginLine</span><span class="op" id="5577888">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5577893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5577898">t</span>&nbsp;<span class="op" id="5577900">=</span>&nbsp;<span class="ident" id="5577902">t</span><span class="op" id="5577903">[</span><span class="num" id="5577904">1</span><span class="op" id="5577905">:</span><span class="op" id="5577906">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5577910">case</span>&nbsp;<span class="string" id="5577915">&#39;$&#39;</span><span class="op" id="5577918">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5577923">if</span>&nbsp;<span class="ident" id="5577926">p</span><span class="op" id="5577927">.</span><span class="ident" id="5577928">flags</span><span class="op" id="5577933">&amp;</span><span class="ident" id="5577934">OneLine</span>&nbsp;<span class="op" id="5577942">!=</span>&nbsp;<span class="num" id="5577945">0</span>&nbsp;<span class="op" id="5577947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5577953">p</span><span class="op" id="5577954">.</span><span class="ident" id="5577955">op</span><span class="op" id="5577957">(</span><span class="ident" id="5577958">OpEndText</span><span class="op" id="5577967">)</span><span class="op" id="5577968">.</span><span class="ident" id="5577969">Flags</span>&nbsp;<span class="op" id="5577975">|=</span>&nbsp;<span class="ident" id="5577978">WasDollar</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5577991">}</span>&nbsp;<span class="keyword" id="5577993">else</span>&nbsp;<span class="op" id="5577998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578004">p</span><span class="op" id="5578005">.</span><span class="ident" id="5578006">op</span><span class="op" id="5578008">(</span><span class="ident" id="5578009">OpEndLine</span><span class="op" id="5578018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5578023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578028">t</span>&nbsp;<span class="op" id="5578030">=</span>&nbsp;<span class="ident" id="5578032">t</span><span class="op" id="5578033">[</span><span class="num" id="5578034">1</span><span class="op" id="5578035">:</span><span class="op" id="5578036">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5578040">case</span>&nbsp;<span class="string" id="5578045">&#39;.&#39;</span><span class="op" id="5578048">:</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5578053">if</span>&nbsp;<span class="ident" id="5578056">p</span><span class="op" id="5578057">.</span><span class="ident" id="5578058">flags</span><span class="op" id="5578063">&amp;</span><span class="ident" id="5578064">DotNL</span>&nbsp;<span class="op" id="5578070">!=</span>&nbsp;<span class="num" id="5578073">0</span>&nbsp;<span class="op" id="5578075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578081">p</span><span class="op" id="5578082">.</span><span class="ident" id="5578083">op</span><span class="op" id="5578085">(</span><span class="ident" id="5578086">OpAnyChar</span><span class="op" id="5578095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5578100">}</span>&nbsp;<span class="keyword" id="5578102">else</span>&nbsp;<span class="op" id="5578107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578113">p</span><span class="op" id="5578114">.</span><span class="ident" id="5578115">op</span><span class="op" id="5578117">(</span><span class="ident" id="5578118">OpAnyCharNotNL</span><span class="op" id="5578132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5578137">}</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578142">t</span>&nbsp;<span class="op" id="5578144">=</span>&nbsp;<span class="ident" id="5578146">t</span><span class="op" id="5578147">[</span><span class="num" id="5578148">1</span><span class="op" id="5578149">:</span><span class="op" id="5578150">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5578154">case</span>&nbsp;<span class="string" id="5578159">&#39;[&#39;</span><span class="op" id="5578162">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5578167">if</span>&nbsp;<span class="ident" id="5578170">t</span><span class="op" id="5578171">,</span>&nbsp;<span class="ident" id="5578173">err</span>&nbsp;<span class="op" id="5578177">=</span>&nbsp;<span class="ident" id="5578179">p</span><span class="op" id="5578180">.</span><span class="ident" id="5578181">parseClass</span><span class="op" id="5578191">(</span><span class="ident" id="5578192">t</span><span class="op" id="5578193">)</span><span class="op" id="5578194">;</span>&nbsp;<span class="ident" id="5578196">err</span>&nbsp;<span class="op" id="5578200">!=</span>&nbsp;<span class="ident" id="5578203">nil</span>&nbsp;<span class="op" id="5578207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5578213">return</span>&nbsp;<span class="ident" id="5578220">nil</span><span class="op" id="5578223">,</span>&nbsp;<span class="ident" id="5578225">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5578232">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5578236">case</span>&nbsp;<span class="string" id="5578241">&#39;*&#39;</span><span class="op" id="5578244">,</span>&nbsp;<span class="string" id="5578246">&#39;+&#39;</span><span class="op" id="5578249">,</span>&nbsp;<span class="string" id="5578251">&#39;?&#39;</span><span class="op" id="5578254">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578259">before</span>&nbsp;<span class="op" id="5578266">:=</span>&nbsp;<span class="ident" id="5578269">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5578274">switch</span>&nbsp;<span class="ident" id="5578281">t</span><span class="op" id="5578282">[</span><span class="num" id="5578283">0</span><span class="op" id="5578284">]</span>&nbsp;<span class="op" id="5578286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5578291">case</span>&nbsp;<span class="string" id="5578296">&#39;*&#39;</span><span class="op" id="5578299">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578305">op</span>&nbsp;<span class="op" id="5578308">=</span>&nbsp;<span class="ident" id="5578310">OpStar</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5578320">case</span>&nbsp;<span class="string" id="5578325">&#39;+&#39;</span><span class="op" id="5578328">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578334">op</span>&nbsp;<span class="op" id="5578337">=</span>&nbsp;<span class="ident" id="5578339">OpPlus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5578349">case</span>&nbsp;<span class="string" id="5578354">&#39;?&#39;</span><span class="op" id="5578357">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578363">op</span>&nbsp;<span class="op" id="5578366">=</span>&nbsp;<span class="ident" id="5578368">OpQuest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5578379">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578384">after</span>&nbsp;<span class="op" id="5578390">:=</span>&nbsp;<span class="ident" id="5578393">t</span><span class="op" id="5578394">[</span><span class="num" id="5578395">1</span><span class="op" id="5578396">:</span><span class="op" id="5578397">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5578402">if</span>&nbsp;<span class="ident" id="5578405">after</span><span class="op" id="5578410">,</span>&nbsp;<span class="ident" id="5578412">err</span>&nbsp;<span class="op" id="5578416">=</span>&nbsp;<span class="ident" id="5578418">p</span><span class="op" id="5578419">.</span><span class="ident" id="5578420">repeat</span><span class="op" id="5578426">(</span><span class="ident" id="5578427">op</span><span class="op" id="5578429">,</span>&nbsp;<span class="num" id="5578431">0</span><span class="op" id="5578432">,</span>&nbsp;<span class="num" id="5578434">0</span><span class="op" id="5578435">,</span>&nbsp;<span class="ident" id="5578437">before</span><span class="op" id="5578443">,</span>&nbsp;<span class="ident" id="5578445">after</span><span class="op" id="5578450">,</span>&nbsp;<span class="ident" id="5578452">lastRepeat</span><span class="op" id="5578462">)</span><span class="op" id="5578463">;</span>&nbsp;<span class="ident" id="5578465">err</span>&nbsp;<span class="op" id="5578469">!=</span>&nbsp;<span class="ident" id="5578472">nil</span>&nbsp;<span class="op" id="5578476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5578482">return</span>&nbsp;<span class="ident" id="5578489">nil</span><span class="op" id="5578492">,</span>&nbsp;<span class="ident" id="5578494">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5578501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578506">repeat</span>&nbsp;<span class="op" id="5578513">=</span>&nbsp;<span class="ident" id="5578515">before</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578525">t</span>&nbsp;<span class="op" id="5578527">=</span>&nbsp;<span class="ident" id="5578529">after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5578537">case</span>&nbsp;<span class="string" id="5578542">&#39;{&#39;</span><span class="op" id="5578545">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578550">op</span>&nbsp;<span class="op" id="5578553">=</span>&nbsp;<span class="ident" id="5578555">OpRepeat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578567">before</span>&nbsp;<span class="op" id="5578574">:=</span>&nbsp;<span class="ident" id="5578577">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578582">min</span><span class="op" id="5578585">,</span>&nbsp;<span class="ident" id="5578587">max</span><span class="op" id="5578590">,</span>&nbsp;<span class="ident" id="5578592">after</span><span class="op" id="5578597">,</span>&nbsp;<span class="ident" id="5578599">ok</span>&nbsp;<span class="op" id="5578602">:=</span>&nbsp;<span class="ident" id="5578605">p</span><span class="op" id="5578606">.</span><span class="ident" id="5578607">parseRepeat</span><span class="op" id="5578618">(</span><span class="ident" id="5578619">t</span><span class="op" id="5578620">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5578625">if</span>&nbsp;<span class="op" id="5578628">!</span><span class="ident" id="5578629">ok</span>&nbsp;<span class="op" id="5578632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5578638">//&nbsp;If&nbsp;the&nbsp;repeat&nbsp;cannot&nbsp;be&nbsp;parsed,&nbsp;{&nbsp;is&nbsp;a&nbsp;literal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578693">p</span><span class="op" id="5578694">.</span><span class="ident" id="5578695">literal</span><span class="op" id="5578702">(</span><span class="string" id="5578703">&#39;{&#39;</span><span class="op" id="5578706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5578712">t</span>&nbsp;<span class="op" id="5578714">=</span>&nbsp;<span class="ident" id="5578716">t</span><span class="op" id="5578717">[</span><span class="num" id="5578718">1</span><span class="op" id="5578719">:</span><span class="op" id="5578720">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5578726">break</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5578735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5578740">if</span>&nbsp;<span class="ident" id="5578743">min</span>&nbsp;<span class="op" id="5578747">&lt;</span>&nbsp;<span class="num" id="5578749">0</span>&nbsp;<span class="op" id="5578751">||</span>&nbsp;<span class="ident" id="5578754">min</span>&nbsp;<span class="op" id="5578758">&gt;</span>&nbsp;<span class="num" id="5578760">1000</span>&nbsp;<span class="op" id="5578765">||</span>&nbsp;<span class="ident" id="5578768">max</span>&nbsp;<span class="op" id="5578772">&gt;</span>&nbsp;<span class="num" id="5578774">1000</span>&nbsp;<span class="op" id="5578779">||</span>&nbsp;<span class="ident" id="5578782">max</span>&nbsp;<span class="op" id="5578786">&gt;=</span>&nbsp;<span class="num" id="5578789">0</span>&nbsp;<span class="op" id="5578791">&amp;&amp;</span>&nbsp;<span class="ident" id="5578794">min</span>&nbsp;<span class="op" id="5578798">&gt;</span>&nbsp;<span class="ident" id="5578800">max</span>&nbsp;<span class="op" id="5578804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5578810">//&nbsp;Numbers&nbsp;were&nbsp;too&nbsp;big,&nbsp;or&nbsp;max&nbsp;is&nbsp;present&nbsp;and&nbsp;min&nbsp;&gt;&nbsp;max.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5578872">return</span>&nbsp;<span class="ident" id="5578879">nil</span><span class="op" id="5578882">,</span>&nbsp;<span class="op" id="5578884">&amp;</span><span class="ident" id="5578885">Error</span><span class="op" id="5578890">{</span><span class="ident" id="5578891">ErrInvalidRepeatSize</span><span class="op" id="5578911">,</span>&nbsp;<span class="ident" id="5578913">before</span><span class="op" id="5578919">[</span><span class="op" id="5578920">:</span><span class="builtinfunc" id="5578921">len</span><span class="op" id="5578924">(</span><span class="ident" id="5578925">before</span><span class="op" id="5578931">)</span><span class="op" id="5578932">-</span><span class="builtinfunc" id="5578933">len</span><span class="op" id="5578936">(</span><span class="ident" id="5578937">after</span><span class="op" id="5578942">)</span><span class="op" id="5578943">]</span><span class="op" id="5578944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5578949">}</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5578954">if</span>&nbsp;<span class="ident" id="5578957">after</span><span class="op" id="5578962">,</span>&nbsp;<span class="ident" id="5578964">err</span>&nbsp;<span class="op" id="5578968">=</span>&nbsp;<span class="ident" id="5578970">p</span><span class="op" id="5578971">.</span><span class="ident" id="5578972">repeat</span><span class="op" id="5578978">(</span><span class="ident" id="5578979">op</span><span class="op" id="5578981">,</span>&nbsp;<span class="ident" id="5578983">min</span><span class="op" id="5578986">,</span>&nbsp;<span class="ident" id="5578988">max</span><span class="op" id="5578991">,</span>&nbsp;<span class="ident" id="5578993">before</span><span class="op" id="5578999">,</span>&nbsp;<span class="ident" id="5579001">after</span><span class="op" id="5579006">,</span>&nbsp;<span class="ident" id="5579008">lastRepeat</span><span class="op" id="5579018">)</span><span class="op" id="5579019">;</span>&nbsp;<span class="ident" id="5579021">err</span>&nbsp;<span class="op" id="5579025">!=</span>&nbsp;<span class="ident" id="5579028">nil</span>&nbsp;<span class="op" id="5579032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5579038">return</span>&nbsp;<span class="ident" id="5579045">nil</span><span class="op" id="5579048">,</span>&nbsp;<span class="ident" id="5579050">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5579057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579062">repeat</span>&nbsp;<span class="op" id="5579069">=</span>&nbsp;<span class="ident" id="5579071">before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579081">t</span>&nbsp;<span class="op" id="5579083">=</span>&nbsp;<span class="ident" id="5579085">after</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5579093">case</span>&nbsp;<span class="string" id="5579098">&#39;\\&#39;</span><span class="op" id="5579102">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5579107">if</span>&nbsp;<span class="ident" id="5579110">p</span><span class="op" id="5579111">.</span><span class="ident" id="5579112">flags</span><span class="op" id="5579117">&amp;</span><span class="ident" id="5579118">PerlX</span>&nbsp;<span class="op" id="5579124">!=</span>&nbsp;<span class="num" id="5579127">0</span>&nbsp;<span class="op" id="5579129">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5579132">len</span><span class="op" id="5579135">(</span><span class="ident" id="5579136">t</span><span class="op" id="5579137">)</span>&nbsp;<span class="op" id="5579139">&gt;=</span>&nbsp;<span class="num" id="5579142">2</span>&nbsp;<span class="op" id="5579144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5579150">switch</span>&nbsp;<span class="ident" id="5579157">t</span><span class="op" id="5579158">[</span><span class="num" id="5579159">1</span><span class="op" id="5579160">]</span>&nbsp;<span class="op" id="5579162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5579168">case</span>&nbsp;<span class="string" id="5579173">&#39;A&#39;</span><span class="op" id="5579176">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579183">p</span><span class="op" id="5579184">.</span><span class="ident" id="5579185">op</span><span class="op" id="5579187">(</span><span class="ident" id="5579188">OpBeginText</span><span class="op" id="5579199">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579206">t</span>&nbsp;<span class="op" id="5579208">=</span>&nbsp;<span class="ident" id="5579210">t</span><span class="op" id="5579211">[</span><span class="num" id="5579212">2</span><span class="op" id="5579213">:</span><span class="op" id="5579214">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5579221">break</span>&nbsp;<span class="ident" id="5579227">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5579241">case</span>&nbsp;<span class="string" id="5579246">&#39;b&#39;</span><span class="op" id="5579249">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579256">p</span><span class="op" id="5579257">.</span><span class="ident" id="5579258">op</span><span class="op" id="5579260">(</span><span class="ident" id="5579261">OpWordBoundary</span><span class="op" id="5579275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579282">t</span>&nbsp;<span class="op" id="5579284">=</span>&nbsp;<span class="ident" id="5579286">t</span><span class="op" id="5579287">[</span><span class="num" id="5579288">2</span><span class="op" id="5579289">:</span><span class="op" id="5579290">]</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5579297">break</span>&nbsp;<span class="ident" id="5579303">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5579317">case</span>&nbsp;<span class="string" id="5579322">&#39;B&#39;</span><span class="op" id="5579325">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579332">p</span><span class="op" id="5579333">.</span><span class="ident" id="5579334">op</span><span class="op" id="5579336">(</span><span class="ident" id="5579337">OpNoWordBoundary</span><span class="op" id="5579353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579360">t</span>&nbsp;<span class="op" id="5579362">=</span>&nbsp;<span class="ident" id="5579364">t</span><span class="op" id="5579365">[</span><span class="num" id="5579366">2</span><span class="op" id="5579367">:</span><span class="op" id="5579368">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5579375">break</span>&nbsp;<span class="ident" id="5579381">BigSwitch</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5579395">case</span>&nbsp;<span class="string" id="5579400">&#39;C&#39;</span><span class="op" id="5579403">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5579410">//&nbsp;any&nbsp;byte;&nbsp;not&nbsp;supported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5579442">return</span>&nbsp;<span class="ident" id="5579449">nil</span><span class="op" id="5579452">,</span>&nbsp;<span class="op" id="5579454">&amp;</span><span class="ident" id="5579455">Error</span><span class="op" id="5579460">{</span><span class="ident" id="5579461">ErrInvalidEscape</span><span class="op" id="5579477">,</span>&nbsp;<span class="ident" id="5579479">t</span><span class="op" id="5579480">[</span><span class="op" id="5579481">:</span><span class="num" id="5579482">2</span><span class="op" id="5579483">]</span><span class="op" id="5579484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5579490">case</span>&nbsp;<span class="string" id="5579495">&#39;Q&#39;</span><span class="op" id="5579498">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5579505">//&nbsp;\Q&nbsp;...&nbsp;\E:&nbsp;the&nbsp;...&nbsp;is&nbsp;always&nbsp;literals</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5579551">var</span>&nbsp;<span class="ident" id="5579555">lit</span>&nbsp;<span class="builtintype" id="5579559">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5579571">if</span>&nbsp;<span class="ident" id="5579574">i</span>&nbsp;<span class="op" id="5579576">:=</span>&nbsp;<span class="ident" id="5579579">strings</span><span class="op" id="5579586">.</span><span class="ident" id="5579587">Index</span><span class="op" id="5579592">(</span><span class="ident" id="5579593">t</span><span class="op" id="5579594">,</span>&nbsp;<span class="string" id="5579596">`\E`</span><span class="op" id="5579600">)</span><span class="op" id="5579601">;</span>&nbsp;<span class="ident" id="5579603">i</span>&nbsp;<span class="op" id="5579605">&lt;</span>&nbsp;<span class="num" id="5579607">0</span>&nbsp;<span class="op" id="5579609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579617">lit</span>&nbsp;<span class="op" id="5579621">=</span>&nbsp;<span class="ident" id="5579623">t</span><span class="op" id="5579624">[</span><span class="num" id="5579625">2</span><span class="op" id="5579626">:</span><span class="op" id="5579627">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579635">t</span>&nbsp;<span class="op" id="5579637">=</span>&nbsp;<span class="string" id="5579639">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5579647">}</span>&nbsp;<span class="keyword" id="5579649">else</span>&nbsp;<span class="op" id="5579654">{</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579662">lit</span>&nbsp;<span class="op" id="5579666">=</span>&nbsp;<span class="ident" id="5579668">t</span><span class="op" id="5579669">[</span><span class="num" id="5579670">2</span><span class="op" id="5579671">:</span><span class="ident" id="5579672">i</span><span class="op" id="5579673">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579681">t</span>&nbsp;<span class="op" id="5579683">=</span>&nbsp;<span class="ident" id="5579685">t</span><span class="op" id="5579686">[</span><span class="ident" id="5579687">i</span><span class="op" id="5579688">+</span><span class="num" id="5579689">2</span><span class="op" id="5579690">:</span><span class="op" id="5579691">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5579698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579705">p</span><span class="op" id="5579706">.</span><span class="ident" id="5579707">push</span><span class="op" id="5579711">(</span><span class="ident" id="5579712">literalRegexp</span><span class="op" id="5579725">(</span><span class="ident" id="5579726">lit</span><span class="op" id="5579729">,</span>&nbsp;<span class="ident" id="5579731">p</span><span class="op" id="5579732">.</span><span class="ident" id="5579733">flags</span><span class="op" id="5579738">)</span><span class="op" id="5579739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5579746">break</span>&nbsp;<span class="ident" id="5579752">BigSwitch</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5579766">case</span>&nbsp;<span class="string" id="5579771">&#39;z&#39;</span><span class="op" id="5579774">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579781">p</span><span class="op" id="5579782">.</span><span class="ident" id="5579783">op</span><span class="op" id="5579785">(</span><span class="ident" id="5579786">OpEndText</span><span class="op" id="5579795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579802">t</span>&nbsp;<span class="op" id="5579804">=</span>&nbsp;<span class="ident" id="5579806">t</span><span class="op" id="5579807">[</span><span class="num" id="5579808">2</span><span class="op" id="5579809">:</span><span class="op" id="5579810">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5579817">break</span>&nbsp;<span class="ident" id="5579823">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5579837">}</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5579842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579848">re</span>&nbsp;<span class="op" id="5579851">:=</span>&nbsp;<span class="ident" id="5579854">p</span><span class="op" id="5579855">.</span><span class="ident" id="5579856">newRegexp</span><span class="op" id="5579865">(</span><span class="ident" id="5579866">OpCharClass</span><span class="op" id="5579877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5579882">re</span><span class="op" id="5579884">.</span><span class="ident" id="5579885">Flags</span>&nbsp;<span class="op" id="5579891">=</span>&nbsp;<span class="ident" id="5579893">p</span><span class="op" id="5579894">.</span><span class="ident" id="5579895">flags</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5579905">//&nbsp;Look&nbsp;for&nbsp;Unicode&nbsp;character&nbsp;group&nbsp;like&nbsp;\p{Han}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5579957">if</span>&nbsp;<span class="builtinfunc" id="5579960">len</span><span class="op" id="5579963">(</span><span class="ident" id="5579964">t</span><span class="op" id="5579965">)</span>&nbsp;<span class="op" id="5579967">&gt;=</span>&nbsp;<span class="num" id="5579970">2</span>&nbsp;<span class="op" id="5579972">&amp;&amp;</span>&nbsp;<span class="op" id="5579975">(</span><span class="ident" id="5579976">t</span><span class="op" id="5579977">[</span><span class="num" id="5579978">1</span><span class="op" id="5579979">]</span>&nbsp;<span class="op" id="5579981">==</span>&nbsp;<span class="string" id="5579984">&#39;p&#39;</span>&nbsp;<span class="op" id="5579988">||</span>&nbsp;<span class="ident" id="5579991">t</span><span class="op" id="5579992">[</span><span class="num" id="5579993">1</span><span class="op" id="5579994">]</span>&nbsp;<span class="op" id="5579996">==</span>&nbsp;<span class="string" id="5579999">&#39;P&#39;</span><span class="op" id="5580002">)</span>&nbsp;<span class="op" id="5580004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5580010">r</span><span class="op" id="5580011">,</span>&nbsp;<span class="ident" id="5580013">rest</span><span class="op" id="5580017">,</span>&nbsp;<span class="ident" id="5580019">err</span>&nbsp;<span class="op" id="5580023">:=</span>&nbsp;<span class="ident" id="5580026">p</span><span class="op" id="5580027">.</span><span class="ident" id="5580028">parseUnicodeClass</span><span class="op" id="5580045">(</span><span class="ident" id="5580046">t</span><span class="op" id="5580047">,</span>&nbsp;<span class="ident" id="5580049">re</span><span class="op" id="5580051">.</span><span class="ident" id="5580052">Rune0</span><span class="op" id="5580057">[</span><span class="op" id="5580058">:</span><span class="num" id="5580059">0</span><span class="op" id="5580060">]</span><span class="op" id="5580061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580067">if</span>&nbsp;<span class="ident" id="5580070">err</span>&nbsp;<span class="op" id="5580074">!=</span>&nbsp;<span class="ident" id="5580077">nil</span>&nbsp;<span class="op" id="5580081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580088">return</span>&nbsp;<span class="ident" id="5580095">nil</span><span class="op" id="5580098">,</span>&nbsp;<span class="ident" id="5580100">err</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5580108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580114">if</span>&nbsp;<span class="ident" id="5580117">r</span>&nbsp;<span class="op" id="5580119">!=</span>&nbsp;<span class="ident" id="5580122">nil</span>&nbsp;<span class="op" id="5580126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5580133">re</span><span class="op" id="5580135">.</span><span class="ident" id="5580136">Rune</span>&nbsp;<span class="op" id="5580141">=</span>&nbsp;<span class="ident" id="5580143">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5580150">t</span>&nbsp;<span class="op" id="5580152">=</span>&nbsp;<span class="ident" id="5580154">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5580164">p</span><span class="op" id="5580165">.</span><span class="ident" id="5580166">push</span><span class="op" id="5580170">(</span><span class="ident" id="5580171">re</span><span class="op" id="5580173">)</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580180">break</span>&nbsp;<span class="ident" id="5580186">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5580200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5580205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5580211">//&nbsp;Perl&nbsp;character&nbsp;class&nbsp;escape.</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580246">if</span>&nbsp;<span class="ident" id="5580249">r</span><span class="op" id="5580250">,</span>&nbsp;<span class="ident" id="5580252">rest</span>&nbsp;<span class="op" id="5580257">:=</span>&nbsp;<span class="ident" id="5580260">p</span><span class="op" id="5580261">.</span><span class="ident" id="5580262">parsePerlClassEscape</span><span class="op" id="5580282">(</span><span class="ident" id="5580283">t</span><span class="op" id="5580284">,</span>&nbsp;<span class="ident" id="5580286">re</span><span class="op" id="5580288">.</span><span class="ident" id="5580289">Rune0</span><span class="op" id="5580294">[</span><span class="op" id="5580295">:</span><span class="num" id="5580296">0</span><span class="op" id="5580297">]</span><span class="op" id="5580298">)</span><span class="op" id="5580299">;</span>&nbsp;<span class="ident" id="5580301">r</span>&nbsp;<span class="op" id="5580303">!=</span>&nbsp;<span class="ident" id="5580306">nil</span>&nbsp;<span class="op" id="5580310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5580316">re</span><span class="op" id="5580318">.</span><span class="ident" id="5580319">Rune</span>&nbsp;<span class="op" id="5580324">=</span>&nbsp;<span class="ident" id="5580326">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5580332">t</span>&nbsp;<span class="op" id="5580334">=</span>&nbsp;<span class="ident" id="5580336">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5580345">p</span><span class="op" id="5580346">.</span><span class="ident" id="5580347">push</span><span class="op" id="5580351">(</span><span class="ident" id="5580352">re</span><span class="op" id="5580354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580360">break</span>&nbsp;<span class="ident" id="5580366">BigSwitch</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5580379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5580384">p</span><span class="op" id="5580385">.</span><span class="ident" id="5580386">reuse</span><span class="op" id="5580391">(</span><span class="ident" id="5580392">re</span><span class="op" id="5580394">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5580400">//&nbsp;Ordinary&nbsp;single-character&nbsp;escape.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580440">if</span>&nbsp;<span class="ident" id="5580443">c</span><span class="op" id="5580444">,</span>&nbsp;<span class="ident" id="5580446">t</span><span class="op" id="5580447">,</span>&nbsp;<span class="ident" id="5580449">err</span>&nbsp;<span class="op" id="5580453">=</span>&nbsp;<span class="ident" id="5580455">p</span><span class="op" id="5580456">.</span><span class="ident" id="5580457">parseEscape</span><span class="op" id="5580468">(</span><span class="ident" id="5580469">t</span><span class="op" id="5580470">)</span><span class="op" id="5580471">;</span>&nbsp;<span class="ident" id="5580473">err</span>&nbsp;<span class="op" id="5580477">!=</span>&nbsp;<span class="ident" id="5580480">nil</span>&nbsp;<span class="op" id="5580484">{</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580490">return</span>&nbsp;<span class="ident" id="5580497">nil</span><span class="op" id="5580500">,</span>&nbsp;<span class="ident" id="5580502">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5580509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5580514">p</span><span class="op" id="5580515">.</span><span class="ident" id="5580516">literal</span><span class="op" id="5580523">(</span><span class="ident" id="5580524">c</span><span class="op" id="5580525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5580529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5580533">lastRepeat</span>&nbsp;<span class="op" id="5580544">=</span>&nbsp;<span class="ident" id="5580546">repeat</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5580554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5580558">p</span><span class="op" id="5580559">.</span><span class="ident" id="5580560">concat</span><span class="op" id="5580566">(</span><span class="op" id="5580567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580570">if</span>&nbsp;<span class="ident" id="5580573">p</span><span class="op" id="5580574">.</span><span class="ident" id="5580575">swapVerticalBar</span><span class="op" id="5580590">(</span><span class="op" id="5580591">)</span>&nbsp;<span class="op" id="5580593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5580597">//&nbsp;pop&nbsp;vertical&nbsp;bar</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5580619">p</span><span class="op" id="5580620">.</span><span class="ident" id="5580621">stack</span>&nbsp;<span class="op" id="5580627">=</span>&nbsp;<span class="ident" id="5580629">p</span><span class="op" id="5580630">.</span><span class="ident" id="5580631">stack</span><span class="op" id="5580636">[</span><span class="op" id="5580637">:</span><span class="builtinfunc" id="5580638">len</span><span class="op" id="5580641">(</span><span class="ident" id="5580642">p</span><span class="op" id="5580643">.</span><span class="ident" id="5580644">stack</span><span class="op" id="5580649">)</span><span class="op" id="5580650">-</span><span class="num" id="5580651">1</span><span class="op" id="5580652">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5580655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5580658">p</span><span class="op" id="5580659">.</span><span class="ident" id="5580660">alternate</span><span class="op" id="5580669">(</span><span class="op" id="5580670">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5580674">n</span>&nbsp;<span class="op" id="5580676">:=</span>&nbsp;<span class="builtinfunc" id="5580679">len</span><span class="op" id="5580682">(</span><span class="ident" id="5580683">p</span><span class="op" id="5580684">.</span><span class="ident" id="5580685">stack</span><span class="op" id="5580690">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580693">if</span>&nbsp;<span class="ident" id="5580696">n</span>&nbsp;<span class="op" id="5580698">!=</span>&nbsp;<span class="num" id="5580701">1</span>&nbsp;<span class="op" id="5580703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580707">return</span>&nbsp;<span class="ident" id="5580714">nil</span><span class="op" id="5580717">,</span>&nbsp;<span class="op" id="5580719">&amp;</span><span class="ident" id="5580720">Error</span><span class="op" id="5580725">{</span><span class="ident" id="5580726">ErrMissingParen</span><span class="op" id="5580741">,</span>&nbsp;<span class="ident" id="5580743">s</span><span class="op" id="5580744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5580747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5580750">return</span>&nbsp;<span class="ident" id="5580757">p</span><span class="op" id="5580758">.</span><span class="ident" id="5580759">stack</span><span class="op" id="5580764">[</span><span class="num" id="5580765">0</span><span class="op" id="5580766">]</span><span class="op" id="5580767">,</span>&nbsp;<span class="ident" id="5580769">nil</span><br>
<span class="lineno"></span><span class="op" id="5580773">}</span><br>
<span class="lineno">890</span><br>
<span class="lineno"></span><span class="comment" id="5580776">//&nbsp;parseRepeat&nbsp;parses&nbsp;{min}&nbsp;(max=min)&nbsp;or&nbsp;{min,}&nbsp;(max=-1)&nbsp;or&nbsp;{min,max}.</span><br>
<span class="lineno"></span><span class="comment" id="5580847">//&nbsp;If&nbsp;s&nbsp;is&nbsp;not&nbsp;of&nbsp;that&nbsp;form,&nbsp;it&nbsp;returns&nbsp;ok&nbsp;==&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="5580900">//&nbsp;If&nbsp;s&nbsp;has&nbsp;the&nbsp;right&nbsp;form&nbsp;but&nbsp;the&nbsp;values&nbsp;are&nbsp;too&nbsp;big,&nbsp;it&nbsp;returns&nbsp;min&nbsp;==&nbsp;-1,&nbsp;ok&nbsp;==&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="5580989">func</span>&nbsp;<span class="op" id="5580994">(</span><span class="ident" id="5580995">p</span>&nbsp;<span class="op" id="5580997">*</span><span class="ident" id="5580998">parser</span><span class="op" id="5581004">)</span>&nbsp;<span class="ident" id="5581006">parseRepeat</span><span class="op" id="5581017">(</span><span class="ident" id="5581018">s</span>&nbsp;<span class="builtintype" id="5581020">string</span><span class="op" id="5581026">)</span>&nbsp;<span class="op" id="5581028">(</span><span class="ident" id="5581029">min</span><span class="op" id="5581032">,</span>&nbsp;<span class="ident" id="5581034">max</span>&nbsp;<span class="builtintype" id="5581038">int</span><span class="op" id="5581041">,</span>&nbsp;<span class="ident" id="5581043">rest</span>&nbsp;<span class="builtintype" id="5581048">string</span><span class="op" id="5581054">,</span>&nbsp;<span class="ident" id="5581056">ok</span>&nbsp;<span class="builtintype" id="5581059">bool</span><span class="op" id="5581063">)</span>&nbsp;<span class="op" id="5581065">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581068">if</span>&nbsp;<span class="ident" id="5581071">s</span>&nbsp;<span class="op" id="5581073">==</span>&nbsp;<span class="string" id="5581076">&#34;&#34;</span>&nbsp;<span class="op" id="5581079">||</span>&nbsp;<span class="ident" id="5581082">s</span><span class="op" id="5581083">[</span><span class="num" id="5581084">0</span><span class="op" id="5581085">]</span>&nbsp;<span class="op" id="5581087">!=</span>&nbsp;<span class="string" id="5581090">&#39;{&#39;</span>&nbsp;<span class="op" id="5581094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581098">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5581106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5581109">s</span>&nbsp;<span class="op" id="5581111">=</span>&nbsp;<span class="ident" id="5581113">s</span><span class="op" id="5581114">[</span><span class="num" id="5581115">1</span><span class="op" id="5581116">:</span><span class="op" id="5581117">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581120">var</span>&nbsp;<span class="ident" id="5581124">ok1</span>&nbsp;<span class="builtintype" id="5581128">bool</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581134">if</span>&nbsp;<span class="ident" id="5581137">min</span><span class="op" id="5581140">,</span>&nbsp;<span class="ident" id="5581142">s</span><span class="op" id="5581143">,</span>&nbsp;<span class="ident" id="5581145">ok1</span>&nbsp;<span class="op" id="5581149">=</span>&nbsp;<span class="ident" id="5581151">p</span><span class="op" id="5581152">.</span><span class="ident" id="5581153">parseInt</span><span class="op" id="5581161">(</span><span class="ident" id="5581162">s</span><span class="op" id="5581163">)</span><span class="op" id="5581164">;</span>&nbsp;<span class="op" id="5581166">!</span><span class="ident" id="5581167">ok1</span>&nbsp;<span class="op" id="5581171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581175">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5581183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581186">if</span>&nbsp;<span class="ident" id="5581189">s</span>&nbsp;<span class="op" id="5581191">==</span>&nbsp;<span class="string" id="5581194">&#34;&#34;</span>&nbsp;<span class="op" id="5581197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581201">return</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5581209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581212">if</span>&nbsp;<span class="ident" id="5581215">s</span><span class="op" id="5581216">[</span><span class="num" id="5581217">0</span><span class="op" id="5581218">]</span>&nbsp;<span class="op" id="5581220">!=</span>&nbsp;<span class="string" id="5581223">&#39;,&#39;</span>&nbsp;<span class="op" id="5581227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5581231">max</span>&nbsp;<span class="op" id="5581235">=</span>&nbsp;<span class="ident" id="5581237">min</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5581242">}</span>&nbsp;<span class="keyword" id="5581244">else</span>&nbsp;<span class="op" id="5581249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5581253">s</span>&nbsp;<span class="op" id="5581255">=</span>&nbsp;<span class="ident" id="5581257">s</span><span class="op" id="5581258">[</span><span class="num" id="5581259">1</span><span class="op" id="5581260">:</span><span class="op" id="5581261">]</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581265">if</span>&nbsp;<span class="ident" id="5581268">s</span>&nbsp;<span class="op" id="5581270">==</span>&nbsp;<span class="string" id="5581273">&#34;&#34;</span>&nbsp;<span class="op" id="5581276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581281">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5581290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581294">if</span>&nbsp;<span class="ident" id="5581297">s</span><span class="op" id="5581298">[</span><span class="num" id="5581299">0</span><span class="op" id="5581300">]</span>&nbsp;<span class="op" id="5581302">==</span>&nbsp;<span class="string" id="5581305">&#39;}&#39;</span>&nbsp;<span class="op" id="5581309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5581314">max</span>&nbsp;<span class="op" id="5581318">=</span>&nbsp;<span class="op" id="5581320">-</span><span class="num" id="5581321">1</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5581325">}</span>&nbsp;<span class="keyword" id="5581327">else</span>&nbsp;<span class="keyword" id="5581332">if</span>&nbsp;<span class="ident" id="5581335">max</span><span class="op" id="5581338">,</span>&nbsp;<span class="ident" id="5581340">s</span><span class="op" id="5581341">,</span>&nbsp;<span class="ident" id="5581343">ok1</span>&nbsp;<span class="op" id="5581347">=</span>&nbsp;<span class="ident" id="5581349">p</span><span class="op" id="5581350">.</span><span class="ident" id="5581351">parseInt</span><span class="op" id="5581359">(</span><span class="ident" id="5581360">s</span><span class="op" id="5581361">)</span><span class="op" id="5581362">;</span>&nbsp;<span class="op" id="5581364">!</span><span class="ident" id="5581365">ok1</span>&nbsp;<span class="op" id="5581369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581374">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5581383">}</span>&nbsp;<span class="keyword" id="5581385">else</span>&nbsp;<span class="keyword" id="5581390">if</span>&nbsp;<span class="ident" id="5581393">max</span>&nbsp;<span class="op" id="5581397">&lt;</span>&nbsp;<span class="num" id="5581399">0</span>&nbsp;<span class="op" id="5581401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5581406">//&nbsp;parseInt&nbsp;found&nbsp;too&nbsp;big&nbsp;a&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5581444">min</span>&nbsp;<span class="op" id="5581448">=</span>&nbsp;<span class="op" id="5581450">-</span><span class="num" id="5581451">1</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5581455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5581458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581461">if</span>&nbsp;<span class="ident" id="5581464">s</span>&nbsp;<span class="op" id="5581466">==</span>&nbsp;<span class="string" id="5581469">&#34;&#34;</span>&nbsp;<span class="op" id="5581472">||</span>&nbsp;<span class="ident" id="5581475">s</span><span class="op" id="5581476">[</span><span class="num" id="5581477">0</span><span class="op" id="5581478">]</span>&nbsp;<span class="op" id="5581480">!=</span>&nbsp;<span class="string" id="5581483">&#39;}&#39;</span>&nbsp;<span class="op" id="5581487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581491">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5581499">}</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5581502">rest</span>&nbsp;<span class="op" id="5581507">=</span>&nbsp;<span class="ident" id="5581509">s</span><span class="op" id="5581510">[</span><span class="num" id="5581511">1</span><span class="op" id="5581512">:</span><span class="op" id="5581513">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5581516">ok</span>&nbsp;<span class="op" id="5581519">=</span>&nbsp;<span class="builtintype" id="5581521">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5581527">return</span><br>
<span class="lineno"></span><span class="op" id="5581534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">930</span><span class="comment" id="5581537">//&nbsp;parsePerlFlags&nbsp;parses&nbsp;a&nbsp;Perl&nbsp;flag&nbsp;setting&nbsp;or&nbsp;non-capturing&nbsp;group&nbsp;or&nbsp;both,</span><br>
<span class="lineno"></span><span class="comment" id="5581614">//&nbsp;like&nbsp;(?i)&nbsp;or&nbsp;(?:&nbsp;or&nbsp;(?i:.&nbsp;&nbsp;It&nbsp;removes&nbsp;the&nbsp;prefix&nbsp;from&nbsp;s&nbsp;and&nbsp;updates&nbsp;the&nbsp;parse&nbsp;state.</span><br>
<span class="lineno"></span><span class="comment" id="5581702">//&nbsp;The&nbsp;caller&nbsp;must&nbsp;have&nbsp;ensured&nbsp;that&nbsp;s&nbsp;begins&nbsp;with&nbsp;&#34;(?&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5581759">func</span>&nbsp;<span class="op" id="5581764">(</span><span class="ident" id="5581765">p</span>&nbsp;<span class="op" id="5581767">*</span><span class="ident" id="5581768">parser</span><span class="op" id="5581774">)</span>&nbsp;<span class="ident" id="5581776">parsePerlFlags</span><span class="op" id="5581790">(</span><span class="ident" id="5581791">s</span>&nbsp;<span class="builtintype" id="5581793">string</span><span class="op" id="5581799">)</span>&nbsp;<span class="op" id="5581801">(</span><span class="ident" id="5581802">rest</span>&nbsp;<span class="builtintype" id="5581807">string</span><span class="op" id="5581813">,</span>&nbsp;<span class="ident" id="5581815">err</span>&nbsp;<span class="builtintype" id="5581819">error</span><span class="op" id="5581824">)</span>&nbsp;<span class="op" id="5581826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5581829">t</span>&nbsp;<span class="op" id="5581831">:=</span>&nbsp;<span class="ident" id="5581834">s</span><br>
<span class="lineno">935</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5581838">//&nbsp;Check&nbsp;for&nbsp;named&nbsp;captures,&nbsp;first&nbsp;introduced&nbsp;in&nbsp;Python&#39;s&nbsp;regexp&nbsp;library.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5581913">//&nbsp;As&nbsp;usual,&nbsp;there&nbsp;are&nbsp;three&nbsp;slightly&nbsp;different&nbsp;syntaxes:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5581972">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5581976">//&nbsp;&nbsp;&nbsp;(?P&lt;name&gt;expr)&nbsp;&nbsp;&nbsp;the&nbsp;original,&nbsp;introduced&nbsp;by&nbsp;Python</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5582034">//&nbsp;&nbsp;&nbsp;(?&lt;name&gt;expr)&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;.NET&nbsp;alteration,&nbsp;adopted&nbsp;by&nbsp;Perl&nbsp;5.10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5582099">//&nbsp;&nbsp;&nbsp;(?&#39;name&#39;expr)&nbsp;&nbsp;&nbsp;&nbsp;another&nbsp;.NET&nbsp;alteration,&nbsp;adopted&nbsp;by&nbsp;Perl&nbsp;5.10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5582168">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5582172">//&nbsp;Perl&nbsp;5.10&nbsp;gave&nbsp;in&nbsp;and&nbsp;implemented&nbsp;the&nbsp;Python&nbsp;version&nbsp;too,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5582234">//&nbsp;but&nbsp;they&nbsp;claim&nbsp;that&nbsp;the&nbsp;last&nbsp;two&nbsp;are&nbsp;the&nbsp;preferred&nbsp;forms.</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5582296">//&nbsp;PCRE&nbsp;and&nbsp;languages&nbsp;based&nbsp;on&nbsp;it&nbsp;(specifically,&nbsp;PHP&nbsp;and&nbsp;Ruby)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5582360">//&nbsp;support&nbsp;all&nbsp;three&nbsp;as&nbsp;well.&nbsp;&nbsp;EcmaScript&nbsp;4&nbsp;uses&nbsp;only&nbsp;the&nbsp;Python&nbsp;form.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5582432">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5582436">//&nbsp;In&nbsp;both&nbsp;the&nbsp;open&nbsp;source&nbsp;world&nbsp;(via&nbsp;Code&nbsp;Search)&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5582496">//&nbsp;Google&nbsp;source&nbsp;tree,&nbsp;(?P&lt;expr&gt;name)&nbsp;is&nbsp;the&nbsp;dominant&nbsp;form,</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5582557">//&nbsp;so&nbsp;that&#39;s&nbsp;the&nbsp;one&nbsp;we&nbsp;implement.&nbsp;&nbsp;One&nbsp;is&nbsp;enough.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5582609">if</span>&nbsp;<span class="builtinfunc" id="5582612">len</span><span class="op" id="5582615">(</span><span class="ident" id="5582616">t</span><span class="op" id="5582617">)</span>&nbsp;<span class="op" id="5582619">&gt;</span>&nbsp;<span class="num" id="5582621">4</span>&nbsp;<span class="op" id="5582623">&amp;&amp;</span>&nbsp;<span class="ident" id="5582626">t</span><span class="op" id="5582627">[</span><span class="num" id="5582628">2</span><span class="op" id="5582629">]</span>&nbsp;<span class="op" id="5582631">==</span>&nbsp;<span class="string" id="5582634">&#39;P&#39;</span>&nbsp;<span class="op" id="5582638">&amp;&amp;</span>&nbsp;<span class="ident" id="5582641">t</span><span class="op" id="5582642">[</span><span class="num" id="5582643">3</span><span class="op" id="5582644">]</span>&nbsp;<span class="op" id="5582646">==</span>&nbsp;<span class="string" id="5582649">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="5582653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5582657">//&nbsp;Pull&nbsp;out&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5582677">end</span>&nbsp;<span class="op" id="5582681">:=</span>&nbsp;<span class="ident" id="5582684">strings</span><span class="op" id="5582691">.</span><span class="ident" id="5582692">IndexRune</span><span class="op" id="5582701">(</span><span class="ident" id="5582702">t</span><span class="op" id="5582703">,</span>&nbsp;<span class="string" id="5582705">&#39;&gt;&#39;</span><span class="op" id="5582708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5582712">if</span>&nbsp;<span class="ident" id="5582715">end</span>&nbsp;<span class="op" id="5582719">&lt;</span>&nbsp;<span class="num" id="5582721">0</span>&nbsp;<span class="op" id="5582723">{</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5582728">if</span>&nbsp;<span class="ident" id="5582731">err</span>&nbsp;<span class="op" id="5582735">=</span>&nbsp;<span class="ident" id="5582737">checkUTF8</span><span class="op" id="5582746">(</span><span class="ident" id="5582747">t</span><span class="op" id="5582748">)</span><span class="op" id="5582749">;</span>&nbsp;<span class="ident" id="5582751">err</span>&nbsp;<span class="op" id="5582755">!=</span>&nbsp;<span class="ident" id="5582758">nil</span>&nbsp;<span class="op" id="5582762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5582768">return</span>&nbsp;<span class="string" id="5582775">&#34;&#34;</span><span class="op" id="5582777">,</span>&nbsp;<span class="ident" id="5582779">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5582786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5582791">return</span>&nbsp;<span class="string" id="5582798">&#34;&#34;</span><span class="op" id="5582800">,</span>&nbsp;<span class="op" id="5582802">&amp;</span><span class="ident" id="5582803">Error</span><span class="op" id="5582808">{</span><span class="ident" id="5582809">ErrInvalidNamedCapture</span><span class="op" id="5582831">,</span>&nbsp;<span class="ident" id="5582833">s</span><span class="op" id="5582834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5582838">}</span><br>
<span class="lineno">960</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5582843">capture</span>&nbsp;<span class="op" id="5582851">:=</span>&nbsp;<span class="ident" id="5582854">t</span><span class="op" id="5582855">[</span><span class="op" id="5582856">:</span><span class="ident" id="5582857">end</span><span class="op" id="5582860">+</span><span class="num" id="5582861">1</span><span class="op" id="5582862">]</span>&nbsp;<span class="comment" id="5582864">//&nbsp;&#34;(?P&lt;name&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5582881">name</span>&nbsp;<span class="op" id="5582886">:=</span>&nbsp;<span class="ident" id="5582889">t</span><span class="op" id="5582890">[</span><span class="num" id="5582891">4</span><span class="op" id="5582892">:</span><span class="ident" id="5582893">end</span><span class="op" id="5582896">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5582902">//&nbsp;&#34;name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5582914">if</span>&nbsp;<span class="ident" id="5582917">err</span>&nbsp;<span class="op" id="5582921">=</span>&nbsp;<span class="ident" id="5582923">checkUTF8</span><span class="op" id="5582932">(</span><span class="ident" id="5582933">name</span><span class="op" id="5582937">)</span><span class="op" id="5582938">;</span>&nbsp;<span class="ident" id="5582940">err</span>&nbsp;<span class="op" id="5582944">!=</span>&nbsp;<span class="ident" id="5582947">nil</span>&nbsp;<span class="op" id="5582951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5582956">return</span>&nbsp;<span class="string" id="5582963">&#34;&#34;</span><span class="op" id="5582965">,</span>&nbsp;<span class="ident" id="5582967">err</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5582973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5582977">if</span>&nbsp;<span class="op" id="5582980">!</span><span class="ident" id="5582981">isValidCaptureName</span><span class="op" id="5582999">(</span><span class="ident" id="5583000">name</span><span class="op" id="5583004">)</span>&nbsp;<span class="op" id="5583006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583011">return</span>&nbsp;<span class="string" id="5583018">&#34;&#34;</span><span class="op" id="5583020">,</span>&nbsp;<span class="op" id="5583022">&amp;</span><span class="ident" id="5583023">Error</span><span class="op" id="5583028">{</span><span class="ident" id="5583029">ErrInvalidNamedCapture</span><span class="op" id="5583051">,</span>&nbsp;<span class="ident" id="5583053">capture</span><span class="op" id="5583060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5583064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5583069">//&nbsp;Like&nbsp;ordinary&nbsp;capture,&nbsp;but&nbsp;named.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5583108">p</span><span class="op" id="5583109">.</span><span class="ident" id="5583110">numCap</span><span class="op" id="5583116">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5583121">re</span>&nbsp;<span class="op" id="5583124">:=</span>&nbsp;<span class="ident" id="5583127">p</span><span class="op" id="5583128">.</span><span class="ident" id="5583129">op</span><span class="op" id="5583131">(</span><span class="ident" id="5583132">opLeftParen</span><span class="op" id="5583143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5583147">re</span><span class="op" id="5583149">.</span><span class="ident" id="5583150">Cap</span>&nbsp;<span class="op" id="5583154">=</span>&nbsp;<span class="ident" id="5583156">p</span><span class="op" id="5583157">.</span><span class="ident" id="5583158">numCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5583167">re</span><span class="op" id="5583169">.</span><span class="ident" id="5583170">Name</span>&nbsp;<span class="op" id="5583175">=</span>&nbsp;<span class="ident" id="5583177">name</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583184">return</span>&nbsp;<span class="ident" id="5583191">t</span><span class="op" id="5583192">[</span><span class="ident" id="5583193">end</span><span class="op" id="5583196">+</span><span class="num" id="5583197">1</span><span class="op" id="5583198">:</span><span class="op" id="5583199">]</span><span class="op" id="5583200">,</span>&nbsp;<span class="ident" id="5583202">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5583207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5583211">//&nbsp;Non-capturing&nbsp;group.&nbsp;&nbsp;Might&nbsp;also&nbsp;twiddle&nbsp;Perl&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583268">var</span>&nbsp;<span class="ident" id="5583272">c</span>&nbsp;<span class="builtintype" id="5583274">rune</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5583280">t</span>&nbsp;<span class="op" id="5583282">=</span>&nbsp;<span class="ident" id="5583284">t</span><span class="op" id="5583285">[</span><span class="num" id="5583286">2</span><span class="op" id="5583287">:</span><span class="op" id="5583288">]</span>&nbsp;<span class="comment" id="5583290">//&nbsp;skip&nbsp;(?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5583302">flags</span>&nbsp;<span class="op" id="5583308">:=</span>&nbsp;<span class="ident" id="5583311">p</span><span class="op" id="5583312">.</span><span class="ident" id="5583313">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5583320">sign</span>&nbsp;<span class="op" id="5583325">:=</span>&nbsp;<span class="op" id="5583328">+</span><span class="num" id="5583329">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5583332">sawFlag</span>&nbsp;<span class="op" id="5583340">:=</span>&nbsp;<span class="builtintype" id="5583343">false</span><br>
<span class="lineno"></span><span class="ident" id="5583349">Loop</span><span class="op" id="5583353">:</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583356">for</span>&nbsp;<span class="ident" id="5583360">t</span>&nbsp;<span class="op" id="5583362">!=</span>&nbsp;<span class="string" id="5583365">&#34;&#34;</span>&nbsp;<span class="op" id="5583368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583372">if</span>&nbsp;<span class="ident" id="5583375">c</span><span class="op" id="5583376">,</span>&nbsp;<span class="ident" id="5583378">t</span><span class="op" id="5583379">,</span>&nbsp;<span class="ident" id="5583381">err</span>&nbsp;<span class="op" id="5583385">=</span>&nbsp;<span class="ident" id="5583387">nextRune</span><span class="op" id="5583395">(</span><span class="ident" id="5583396">t</span><span class="op" id="5583397">)</span><span class="op" id="5583398">;</span>&nbsp;<span class="ident" id="5583400">err</span>&nbsp;<span class="op" id="5583404">!=</span>&nbsp;<span class="ident" id="5583407">nil</span>&nbsp;<span class="op" id="5583411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583416">return</span>&nbsp;<span class="string" id="5583423">&#34;&#34;</span><span class="op" id="5583425">,</span>&nbsp;<span class="ident" id="5583427">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5583433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583437">switch</span>&nbsp;<span class="ident" id="5583444">c</span>&nbsp;<span class="op" id="5583446">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583450">default</span><span class="op" id="5583457">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583462">break</span>&nbsp;<span class="ident" id="5583468">Loop</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5583476">//&nbsp;Flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583488">case</span>&nbsp;<span class="string" id="5583493">&#39;i&#39;</span><span class="op" id="5583496">:</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5583501">flags</span>&nbsp;<span class="op" id="5583507">|=</span>&nbsp;<span class="ident" id="5583510">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5583522">sawFlag</span>&nbsp;<span class="op" id="5583530">=</span>&nbsp;<span class="builtintype" id="5583532">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583539">case</span>&nbsp;<span class="string" id="5583544">&#39;m&#39;</span><span class="op" id="5583547">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5583552">flags</span>&nbsp;<span class="op" id="5583558">&amp;^=</span>&nbsp;<span class="ident" id="5583562">OneLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5583573">sawFlag</span>&nbsp;<span class="op" id="5583581">=</span>&nbsp;<span class="builtintype" id="5583583">true</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583590">case</span>&nbsp;<span class="string" id="5583595">&#39;s&#39;</span><span class="op" id="5583598">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5583603">flags</span>&nbsp;<span class="op" id="5583609">|=</span>&nbsp;<span class="ident" id="5583612">DotNL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5583621">sawFlag</span>&nbsp;<span class="op" id="5583629">=</span>&nbsp;<span class="builtintype" id="5583631">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583638">case</span>&nbsp;<span class="string" id="5583643">&#39;U&#39;</span><span class="op" id="5583646">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5583651">flags</span>&nbsp;<span class="op" id="5583657">|=</span>&nbsp;<span class="ident" id="5583660">NonGreedy</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5583673">sawFlag</span>&nbsp;<span class="op" id="5583681">=</span>&nbsp;<span class="builtintype" id="5583683">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5583691">//&nbsp;Switch&nbsp;to&nbsp;negation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583716">case</span>&nbsp;<span class="string" id="5583721">&#39;-&#39;</span><span class="op" id="5583724">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583729">if</span>&nbsp;<span class="ident" id="5583732">sign</span>&nbsp;<span class="op" id="5583737">&lt;</span>&nbsp;<span class="num" id="5583739">0</span>&nbsp;<span class="op" id="5583741">{</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583747">break</span>&nbsp;<span class="ident" id="5583753">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5583761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5583766">sign</span>&nbsp;<span class="op" id="5583771">=</span>&nbsp;<span class="op" id="5583773">-</span><span class="num" id="5583774">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5583779">//&nbsp;Invert&nbsp;flags&nbsp;so&nbsp;that&nbsp;|&nbsp;above&nbsp;turn&nbsp;into&nbsp;&amp;^&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5583843">//&nbsp;We&#39;ll&nbsp;invert&nbsp;flags&nbsp;again&nbsp;before&nbsp;using&nbsp;it&nbsp;below.</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5583897">flags</span>&nbsp;<span class="op" id="5583903">=</span>&nbsp;<span class="op" id="5583905">^</span><span class="ident" id="5583906">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5583915">sawFlag</span>&nbsp;<span class="op" id="5583923">=</span>&nbsp;<span class="builtintype" id="5583925">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5583934">//&nbsp;End&nbsp;of&nbsp;flags,&nbsp;starting&nbsp;group&nbsp;or&nbsp;not.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583976">case</span>&nbsp;<span class="string" id="5583981">&#39;:&#39;</span><span class="op" id="5583984">,</span>&nbsp;<span class="string" id="5583986">&#39;)&#39;</span><span class="op" id="5583989">:</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5583994">if</span>&nbsp;<span class="ident" id="5583997">sign</span>&nbsp;<span class="op" id="5584002">&lt;</span>&nbsp;<span class="num" id="5584004">0</span>&nbsp;<span class="op" id="5584006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5584012">if</span>&nbsp;<span class="op" id="5584015">!</span><span class="ident" id="5584016">sawFlag</span>&nbsp;<span class="op" id="5584024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5584031">break</span>&nbsp;<span class="ident" id="5584037">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5584046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5584052">flags</span>&nbsp;<span class="op" id="5584058">=</span>&nbsp;<span class="op" id="5584060">^</span><span class="ident" id="5584061">flags</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5584070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5584075">if</span>&nbsp;<span class="ident" id="5584078">c</span>&nbsp;<span class="op" id="5584080">==</span>&nbsp;<span class="string" id="5584083">&#39;:&#39;</span>&nbsp;<span class="op" id="5584087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5584093">//&nbsp;Open&nbsp;new&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5584115">p</span><span class="op" id="5584116">.</span><span class="ident" id="5584117">op</span><span class="op" id="5584119">(</span><span class="ident" id="5584120">opLeftParen</span><span class="op" id="5584131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5584136">}</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5584141">p</span><span class="op" id="5584142">.</span><span class="ident" id="5584143">flags</span>&nbsp;<span class="op" id="5584149">=</span>&nbsp;<span class="ident" id="5584151">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5584160">return</span>&nbsp;<span class="ident" id="5584167">t</span><span class="op" id="5584168">,</span>&nbsp;<span class="ident" id="5584170">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5584176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5584179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5584183">return</span>&nbsp;<span class="string" id="5584190">&#34;&#34;</span><span class="op" id="5584192">,</span>&nbsp;<span class="op" id="5584194">&amp;</span><span class="ident" id="5584195">Error</span><span class="op" id="5584200">{</span><span class="ident" id="5584201">ErrInvalidPerlOp</span><span class="op" id="5584217">,</span>&nbsp;<span class="ident" id="5584219">s</span><span class="op" id="5584220">[</span><span class="op" id="5584221">:</span><span class="builtinfunc" id="5584222">len</span><span class="op" id="5584225">(</span><span class="ident" id="5584226">s</span><span class="op" id="5584227">)</span><span class="op" id="5584228">-</span><span class="builtinfunc" id="5584229">len</span><span class="op" id="5584232">(</span><span class="ident" id="5584233">t</span><span class="op" id="5584234">)</span><span class="op" id="5584235">]</span><span class="op" id="5584236">}</span><br>
<span class="lineno"></span><span class="op" id="5584238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5584241">//&nbsp;isValidCaptureName&nbsp;reports&nbsp;whether&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5584284">//&nbsp;is&nbsp;a&nbsp;valid&nbsp;capture&nbsp;name:&nbsp;[A-Za-z0-9_]+.</span><br>
<span class="lineno">1040</span><span class="comment" id="5584327">//&nbsp;PCRE&nbsp;limits&nbsp;names&nbsp;to&nbsp;32&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="5584361">//&nbsp;Python&nbsp;rejects&nbsp;names&nbsp;starting&nbsp;with&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="5584407">//&nbsp;We&nbsp;don&#39;t&nbsp;enforce&nbsp;either&nbsp;of&nbsp;those.</span><br>
<span class="lineno"></span><span class="keyword" id="5584444">func</span>&nbsp;<span class="ident" id="5584449">isValidCaptureName</span><span class="op" id="5584467">(</span><span class="ident" id="5584468">name</span>&nbsp;<span class="builtintype" id="5584473">string</span><span class="op" id="5584479">)</span>&nbsp;<span class="builtintype" id="5584481">bool</span>&nbsp;<span class="op" id="5584486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5584489">if</span>&nbsp;<span class="ident" id="5584492">name</span>&nbsp;<span class="op" id="5584497">==</span>&nbsp;<span class="string" id="5584500">&#34;&#34;</span>&nbsp;<span class="op" id="5584503">{</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5584507">return</span>&nbsp;<span class="builtintype" id="5584514">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5584521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5584524">for</span>&nbsp;<span class="ident" id="5584528">_</span><span class="op" id="5584529">,</span>&nbsp;<span class="ident" id="5584531">c</span>&nbsp;<span class="op" id="5584533">:=</span>&nbsp;<span class="keyword" id="5584536">range</span>&nbsp;<span class="ident" id="5584542">name</span>&nbsp;<span class="op" id="5584547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5584551">if</span>&nbsp;<span class="ident" id="5584554">c</span>&nbsp;<span class="op" id="5584556">!=</span>&nbsp;<span class="string" id="5584559">&#39;_&#39;</span>&nbsp;<span class="op" id="5584563">&amp;&amp;</span>&nbsp;<span class="op" id="5584566">!</span><span class="ident" id="5584567">isalnum</span><span class="op" id="5584574">(</span><span class="ident" id="5584575">c</span><span class="op" id="5584576">)</span>&nbsp;<span class="op" id="5584578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5584583">return</span>&nbsp;<span class="builtintype" id="5584590">false</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5584598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5584601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5584604">return</span>&nbsp;<span class="builtintype" id="5584611">true</span><br>
<span class="lineno"></span><span class="op" id="5584616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1055</span><span class="comment" id="5584619">//&nbsp;parseInt&nbsp;parses&nbsp;a&nbsp;decimal&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="5584657">func</span>&nbsp;<span class="op" id="5584662">(</span><span class="ident" id="5584663">p</span>&nbsp;<span class="op" id="5584665">*</span><span class="ident" id="5584666">parser</span><span class="op" id="5584672">)</span>&nbsp;<span class="ident" id="5584674">parseInt</span><span class="op" id="5584682">(</span><span class="ident" id="5584683">s</span>&nbsp;<span class="builtintype" id="5584685">string</span><span class="op" id="5584691">)</span>&nbsp;<span class="op" id="5584693">(</span><span class="ident" id="5584694">n</span>&nbsp;<span class="builtintype" id="5584696">int</span><span class="op" id="5584699">,</span>&nbsp;<span class="ident" id="5584701">rest</span>&nbsp;<span class="builtintype" id="5584706">string</span><span class="op" id="5584712">,</span>&nbsp;<span class="ident" id="5584714">ok</span>&nbsp;<span class="builtintype" id="5584717">bool</span><span class="op" id="5584721">)</span>&nbsp;<span class="op" id="5584723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5584726">if</span>&nbsp;<span class="ident" id="5584729">s</span>&nbsp;<span class="op" id="5584731">==</span>&nbsp;<span class="string" id="5584734">&#34;&#34;</span>&nbsp;<span class="op" id="5584737">||</span>&nbsp;<span class="ident" id="5584740">s</span><span class="op" id="5584741">[</span><span class="num" id="5584742">0</span><span class="op" id="5584743">]</span>&nbsp;<span class="op" id="5584745">&lt;</span>&nbsp;<span class="string" id="5584747">&#39;0&#39;</span>&nbsp;<span class="op" id="5584751">||</span>&nbsp;<span class="string" id="5584754">&#39;9&#39;</span>&nbsp;<span class="op" id="5584758">&lt;</span>&nbsp;<span class="ident" id="5584760">s</span><span class="op" id="5584761">[</span><span class="num" id="5584762">0</span><span class="op" id="5584763">]</span>&nbsp;<span class="op" id="5584765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5584769">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5584777">}</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5584780">//&nbsp;Disallow&nbsp;leading&nbsp;zeros.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5584808">if</span>&nbsp;<span class="builtinfunc" id="5584811">len</span><span class="op" id="5584814">(</span><span class="ident" id="5584815">s</span><span class="op" id="5584816">)</span>&nbsp;<span class="op" id="5584818">&gt;=</span>&nbsp;<span class="num" id="5584821">2</span>&nbsp;<span class="op" id="5584823">&amp;&amp;</span>&nbsp;<span class="ident" id="5584826">s</span><span class="op" id="5584827">[</span><span class="num" id="5584828">0</span><span class="op" id="5584829">]</span>&nbsp;<span class="op" id="5584831">==</span>&nbsp;<span class="string" id="5584834">&#39;0&#39;</span>&nbsp;<span class="op" id="5584838">&amp;&amp;</span>&nbsp;<span class="string" id="5584841">&#39;0&#39;</span>&nbsp;<span class="op" id="5584845">&lt;=</span>&nbsp;<span class="ident" id="5584848">s</span><span class="op" id="5584849">[</span><span class="num" id="5584850">1</span><span class="op" id="5584851">]</span>&nbsp;<span class="op" id="5584853">&amp;&amp;</span>&nbsp;<span class="ident" id="5584856">s</span><span class="op" id="5584857">[</span><span class="num" id="5584858">1</span><span class="op" id="5584859">]</span>&nbsp;<span class="op" id="5584861">&lt;=</span>&nbsp;<span class="string" id="5584864">&#39;9&#39;</span>&nbsp;<span class="op" id="5584868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5584872">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5584880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5584883">t</span>&nbsp;<span class="op" id="5584885">:=</span>&nbsp;<span class="ident" id="5584888">s</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5584891">for</span>&nbsp;<span class="ident" id="5584895">s</span>&nbsp;<span class="op" id="5584897">!=</span>&nbsp;<span class="string" id="5584900">&#34;&#34;</span>&nbsp;<span class="op" id="5584903">&amp;&amp;</span>&nbsp;<span class="string" id="5584906">&#39;0&#39;</span>&nbsp;<span class="op" id="5584910">&lt;=</span>&nbsp;<span class="ident" id="5584913">s</span><span class="op" id="5584914">[</span><span class="num" id="5584915">0</span><span class="op" id="5584916">]</span>&nbsp;<span class="op" id="5584918">&amp;&amp;</span>&nbsp;<span class="ident" id="5584921">s</span><span class="op" id="5584922">[</span><span class="num" id="5584923">0</span><span class="op" id="5584924">]</span>&nbsp;<span class="op" id="5584926">&lt;=</span>&nbsp;<span class="string" id="5584929">&#39;9&#39;</span>&nbsp;<span class="op" id="5584933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5584937">s</span>&nbsp;<span class="op" id="5584939">=</span>&nbsp;<span class="ident" id="5584941">s</span><span class="op" id="5584942">[</span><span class="num" id="5584943">1</span><span class="op" id="5584944">:</span><span class="op" id="5584945">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5584948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5584951">rest</span>&nbsp;<span class="op" id="5584956">=</span>&nbsp;<span class="ident" id="5584958">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5584961">ok</span>&nbsp;<span class="op" id="5584964">=</span>&nbsp;<span class="builtintype" id="5584966">true</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5584972">//&nbsp;Have&nbsp;digits,&nbsp;compute&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5585004">t</span>&nbsp;<span class="op" id="5585006">=</span>&nbsp;<span class="ident" id="5585008">t</span><span class="op" id="5585009">[</span><span class="op" id="5585010">:</span><span class="builtinfunc" id="5585011">len</span><span class="op" id="5585014">(</span><span class="ident" id="5585015">t</span><span class="op" id="5585016">)</span><span class="op" id="5585017">-</span><span class="builtinfunc" id="5585018">len</span><span class="op" id="5585021">(</span><span class="ident" id="5585022">s</span><span class="op" id="5585023">)</span><span class="op" id="5585024">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585027">for</span>&nbsp;<span class="ident" id="5585031">i</span>&nbsp;<span class="op" id="5585033">:=</span>&nbsp;<span class="num" id="5585036">0</span><span class="op" id="5585037">;</span>&nbsp;<span class="ident" id="5585039">i</span>&nbsp;<span class="op" id="5585041">&lt;</span>&nbsp;<span class="builtinfunc" id="5585043">len</span><span class="op" id="5585046">(</span><span class="ident" id="5585047">t</span><span class="op" id="5585048">)</span><span class="op" id="5585049">;</span>&nbsp;<span class="ident" id="5585051">i</span><span class="op" id="5585052">++</span>&nbsp;<span class="op" id="5585055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5585059">//&nbsp;Avoid&nbsp;overflow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585080">if</span>&nbsp;<span class="ident" id="5585083">n</span>&nbsp;<span class="op" id="5585085">&gt;=</span>&nbsp;<span class="num" id="5585088">1e8</span>&nbsp;<span class="op" id="5585092">{</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5585097">n</span>&nbsp;<span class="op" id="5585099">=</span>&nbsp;<span class="op" id="5585101">-</span><span class="num" id="5585102">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585107">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5585115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5585119">n</span>&nbsp;<span class="op" id="5585121">=</span>&nbsp;<span class="ident" id="5585123">n</span><span class="op" id="5585124">*</span><span class="num" id="5585125">10</span>&nbsp;<span class="op" id="5585128">+</span>&nbsp;<span class="builtintype" id="5585130">int</span><span class="op" id="5585133">(</span><span class="ident" id="5585134">t</span><span class="op" id="5585135">[</span><span class="ident" id="5585136">i</span><span class="op" id="5585137">]</span><span class="op" id="5585138">)</span>&nbsp;<span class="op" id="5585140">-</span>&nbsp;<span class="string" id="5585142">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5585147">}</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585150">return</span><br>
<span class="lineno"></span><span class="op" id="5585157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5585160">//&nbsp;can&nbsp;this&nbsp;be&nbsp;represented&nbsp;as&nbsp;a&nbsp;character&nbsp;class?</span><br>
<span class="lineno"></span><span class="comment" id="5585209">//&nbsp;single-rune&nbsp;literal&nbsp;string,&nbsp;char&nbsp;class,&nbsp;.,&nbsp;and&nbsp;.|\n.</span><br>
<span class="lineno">1085</span><span class="keyword" id="5585265">func</span>&nbsp;<span class="ident" id="5585270">isCharClass</span><span class="op" id="5585281">(</span><span class="ident" id="5585282">re</span>&nbsp;<span class="op" id="5585285">*</span><span class="ident" id="5585286">Regexp</span><span class="op" id="5585292">)</span>&nbsp;<span class="builtintype" id="5585294">bool</span>&nbsp;<span class="op" id="5585299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585302">return</span>&nbsp;<span class="ident" id="5585309">re</span><span class="op" id="5585311">.</span><span class="ident" id="5585312">Op</span>&nbsp;<span class="op" id="5585315">==</span>&nbsp;<span class="ident" id="5585318">OpLiteral</span>&nbsp;<span class="op" id="5585328">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5585331">len</span><span class="op" id="5585334">(</span><span class="ident" id="5585335">re</span><span class="op" id="5585337">.</span><span class="ident" id="5585338">Rune</span><span class="op" id="5585342">)</span>&nbsp;<span class="op" id="5585344">==</span>&nbsp;<span class="num" id="5585347">1</span>&nbsp;<span class="op" id="5585349">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5585354">re</span><span class="op" id="5585356">.</span><span class="ident" id="5585357">Op</span>&nbsp;<span class="op" id="5585360">==</span>&nbsp;<span class="ident" id="5585363">OpCharClass</span>&nbsp;<span class="op" id="5585375">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5585380">re</span><span class="op" id="5585382">.</span><span class="ident" id="5585383">Op</span>&nbsp;<span class="op" id="5585386">==</span>&nbsp;<span class="ident" id="5585389">OpAnyCharNotNL</span>&nbsp;<span class="op" id="5585404">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5585409">re</span><span class="op" id="5585411">.</span><span class="ident" id="5585412">Op</span>&nbsp;<span class="op" id="5585415">==</span>&nbsp;<span class="ident" id="5585418">OpAnyChar</span><br>
<span class="lineno">1090</span><span class="op" id="5585428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5585431">//&nbsp;does&nbsp;re&nbsp;match&nbsp;r?</span><br>
<span class="lineno"></span><span class="keyword" id="5585451">func</span>&nbsp;<span class="ident" id="5585456">matchRune</span><span class="op" id="5585465">(</span><span class="ident" id="5585466">re</span>&nbsp;<span class="op" id="5585469">*</span><span class="ident" id="5585470">Regexp</span><span class="op" id="5585476">,</span>&nbsp;<span class="ident" id="5585478">r</span>&nbsp;<span class="builtintype" id="5585480">rune</span><span class="op" id="5585484">)</span>&nbsp;<span class="builtintype" id="5585486">bool</span>&nbsp;<span class="op" id="5585491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585494">switch</span>&nbsp;<span class="ident" id="5585501">re</span><span class="op" id="5585503">.</span><span class="ident" id="5585504">Op</span>&nbsp;<span class="op" id="5585507">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585510">case</span>&nbsp;<span class="ident" id="5585515">OpLiteral</span><span class="op" id="5585524">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585528">return</span>&nbsp;<span class="builtinfunc" id="5585535">len</span><span class="op" id="5585538">(</span><span class="ident" id="5585539">re</span><span class="op" id="5585541">.</span><span class="ident" id="5585542">Rune</span><span class="op" id="5585546">)</span>&nbsp;<span class="op" id="5585548">==</span>&nbsp;<span class="num" id="5585551">1</span>&nbsp;<span class="op" id="5585553">&amp;&amp;</span>&nbsp;<span class="ident" id="5585556">re</span><span class="op" id="5585558">.</span><span class="ident" id="5585559">Rune</span><span class="op" id="5585563">[</span><span class="num" id="5585564">0</span><span class="op" id="5585565">]</span>&nbsp;<span class="op" id="5585567">==</span>&nbsp;<span class="ident" id="5585570">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585573">case</span>&nbsp;<span class="ident" id="5585578">OpCharClass</span><span class="op" id="5585589">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585593">for</span>&nbsp;<span class="ident" id="5585597">i</span>&nbsp;<span class="op" id="5585599">:=</span>&nbsp;<span class="num" id="5585602">0</span><span class="op" id="5585603">;</span>&nbsp;<span class="ident" id="5585605">i</span>&nbsp;<span class="op" id="5585607">&lt;</span>&nbsp;<span class="builtinfunc" id="5585609">len</span><span class="op" id="5585612">(</span><span class="ident" id="5585613">re</span><span class="op" id="5585615">.</span><span class="ident" id="5585616">Rune</span><span class="op" id="5585620">)</span><span class="op" id="5585621">;</span>&nbsp;<span class="ident" id="5585623">i</span>&nbsp;<span class="op" id="5585625">+=</span>&nbsp;<span class="num" id="5585628">2</span>&nbsp;<span class="op" id="5585630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585635">if</span>&nbsp;<span class="ident" id="5585638">re</span><span class="op" id="5585640">.</span><span class="ident" id="5585641">Rune</span><span class="op" id="5585645">[</span><span class="ident" id="5585646">i</span><span class="op" id="5585647">]</span>&nbsp;<span class="op" id="5585649">&lt;=</span>&nbsp;<span class="ident" id="5585652">r</span>&nbsp;<span class="op" id="5585654">&amp;&amp;</span>&nbsp;<span class="ident" id="5585657">r</span>&nbsp;<span class="op" id="5585659">&lt;=</span>&nbsp;<span class="ident" id="5585662">re</span><span class="op" id="5585664">.</span><span class="ident" id="5585665">Rune</span><span class="op" id="5585669">[</span><span class="ident" id="5585670">i</span><span class="op" id="5585671">+</span><span class="num" id="5585672">1</span><span class="op" id="5585673">]</span>&nbsp;<span class="op" id="5585675">{</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585681">return</span>&nbsp;<span class="builtintype" id="5585688">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5585696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5585700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585704">return</span>&nbsp;<span class="builtintype" id="5585711">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585718">case</span>&nbsp;<span class="ident" id="5585723">OpAnyCharNotNL</span><span class="op" id="5585737">:</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585741">return</span>&nbsp;<span class="ident" id="5585748">r</span>&nbsp;<span class="op" id="5585750">!=</span>&nbsp;<span class="string" id="5585753">&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585759">case</span>&nbsp;<span class="ident" id="5585764">OpAnyChar</span><span class="op" id="5585773">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585777">return</span>&nbsp;<span class="builtintype" id="5585784">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5585790">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5585793">return</span>&nbsp;<span class="builtintype" id="5585800">false</span><br>
<span class="lineno">1110</span><span class="op" id="5585806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5585809">//&nbsp;parseVerticalBar&nbsp;handles&nbsp;a&nbsp;|&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="5585855">func</span>&nbsp;<span class="op" id="5585860">(</span><span class="ident" id="5585861">p</span>&nbsp;<span class="op" id="5585863">*</span><span class="ident" id="5585864">parser</span><span class="op" id="5585870">)</span>&nbsp;<span class="ident" id="5585872">parseVerticalBar</span><span class="op" id="5585888">(</span><span class="op" id="5585889">)</span>&nbsp;<span class="builtintype" id="5585891">error</span>&nbsp;<span class="op" id="5585897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5585900">p</span><span class="op" id="5585901">.</span><span class="ident" id="5585902">concat</span><span class="op" id="5585908">(</span><span class="op" id="5585909">)</span><br>
<span class="lineno">1115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5585913">//&nbsp;The&nbsp;concatenation&nbsp;we&nbsp;just&nbsp;parsed&nbsp;is&nbsp;on&nbsp;top&nbsp;of&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5585974">//&nbsp;If&nbsp;it&nbsp;sits&nbsp;above&nbsp;an&nbsp;opVerticalBar,&nbsp;swap&nbsp;it&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5586027">//&nbsp;(things&nbsp;below&nbsp;an&nbsp;opVerticalBar&nbsp;become&nbsp;an&nbsp;alternation).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5586086">//&nbsp;Otherwise,&nbsp;push&nbsp;a&nbsp;new&nbsp;vertical&nbsp;bar.</span><br>
<span class="lineno">1120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5586126">if</span>&nbsp;<span class="op" id="5586129">!</span><span class="ident" id="5586130">p</span><span class="op" id="5586131">.</span><span class="ident" id="5586132">swapVerticalBar</span><span class="op" id="5586147">(</span><span class="op" id="5586148">)</span>&nbsp;<span class="op" id="5586150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5586154">p</span><span class="op" id="5586155">.</span><span class="ident" id="5586156">op</span><span class="op" id="5586158">(</span><span class="ident" id="5586159">opVerticalBar</span><span class="op" id="5586172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5586175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5586179">return</span>&nbsp;<span class="ident" id="5586186">nil</span><br>
<span class="lineno">1125</span><span class="op" id="5586190">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5586193">//&nbsp;mergeCharClass&nbsp;makes&nbsp;dst&nbsp;=&nbsp;dst|src.</span><br>
<span class="lineno"></span><span class="comment" id="5586232">//&nbsp;The&nbsp;caller&nbsp;must&nbsp;ensure&nbsp;that&nbsp;dst.Op&nbsp;&gt;=&nbsp;src.Op,</span><br>
<span class="lineno"></span><span class="comment" id="5586281">//&nbsp;to&nbsp;reduce&nbsp;the&nbsp;amount&nbsp;of&nbsp;copying.</span><br>
<span class="lineno">1130</span><span class="keyword" id="5586317">func</span>&nbsp;<span class="ident" id="5586322">mergeCharClass</span><span class="op" id="5586336">(</span><span class="ident" id="5586337">dst</span><span class="op" id="5586340">,</span>&nbsp;<span class="ident" id="5586342">src</span>&nbsp;<span class="op" id="5586346">*</span><span class="ident" id="5586347">Regexp</span><span class="op" id="5586353">)</span>&nbsp;<span class="op" id="5586355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5586358">switch</span>&nbsp;<span class="ident" id="5586365">dst</span><span class="op" id="5586368">.</span><span class="ident" id="5586369">Op</span>&nbsp;<span class="op" id="5586372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5586375">case</span>&nbsp;<span class="ident" id="5586380">OpAnyChar</span><span class="op" id="5586389">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5586393">//&nbsp;src&nbsp;doesn&#39;t&nbsp;add&nbsp;anything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5586423">case</span>&nbsp;<span class="ident" id="5586428">OpAnyCharNotNL</span><span class="op" id="5586442">:</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5586446">//&nbsp;src&nbsp;might&nbsp;add&nbsp;\n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5586468">if</span>&nbsp;<span class="ident" id="5586471">matchRune</span><span class="op" id="5586480">(</span><span class="ident" id="5586481">src</span><span class="op" id="5586484">,</span>&nbsp;<span class="string" id="5586486">&#39;\n&#39;</span><span class="op" id="5586490">)</span>&nbsp;<span class="op" id="5586492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5586497">dst</span><span class="op" id="5586500">.</span><span class="ident" id="5586501">Op</span>&nbsp;<span class="op" id="5586504">=</span>&nbsp;<span class="ident" id="5586506">OpAnyChar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5586518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5586521">case</span>&nbsp;<span class="ident" id="5586526">OpCharClass</span><span class="op" id="5586537">:</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5586541">//&nbsp;src&nbsp;is&nbsp;simpler,&nbsp;so&nbsp;either&nbsp;literal&nbsp;or&nbsp;char&nbsp;class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5586594">if</span>&nbsp;<span class="ident" id="5586597">src</span><span class="op" id="5586600">.</span><span class="ident" id="5586601">Op</span>&nbsp;<span class="op" id="5586604">==</span>&nbsp;<span class="ident" id="5586607">OpLiteral</span>&nbsp;<span class="op" id="5586617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5586622">dst</span><span class="op" id="5586625">.</span><span class="ident" id="5586626">Rune</span>&nbsp;<span class="op" id="5586631">=</span>&nbsp;<span class="ident" id="5586633">appendLiteral</span><span class="op" id="5586646">(</span><span class="ident" id="5586647">dst</span><span class="op" id="5586650">.</span><span class="ident" id="5586651">Rune</span><span class="op" id="5586655">,</span>&nbsp;<span class="ident" id="5586657">src</span><span class="op" id="5586660">.</span><span class="ident" id="5586661">Rune</span><span class="op" id="5586665">[</span><span class="num" id="5586666">0</span><span class="op" id="5586667">]</span><span class="op" id="5586668">,</span>&nbsp;<span class="ident" id="5586670">src</span><span class="op" id="5586673">.</span><span class="ident" id="5586674">Flags</span><span class="op" id="5586679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5586683">}</span>&nbsp;<span class="keyword" id="5586685">else</span>&nbsp;<span class="op" id="5586690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5586695">dst</span><span class="op" id="5586698">.</span><span class="ident" id="5586699">Rune</span>&nbsp;<span class="op" id="5586704">=</span>&nbsp;<span class="ident" id="5586706">appendClass</span><span class="op" id="5586717">(</span><span class="ident" id="5586718">dst</span><span class="op" id="5586721">.</span><span class="ident" id="5586722">Rune</span><span class="op" id="5586726">,</span>&nbsp;<span class="ident" id="5586728">src</span><span class="op" id="5586731">.</span><span class="ident" id="5586732">Rune</span><span class="op" id="5586736">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5586740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5586743">case</span>&nbsp;<span class="ident" id="5586748">OpLiteral</span><span class="op" id="5586757">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5586761">//&nbsp;both&nbsp;literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5586779">if</span>&nbsp;<span class="ident" id="5586782">src</span><span class="op" id="5586785">.</span><span class="ident" id="5586786">Rune</span><span class="op" id="5586790">[</span><span class="num" id="5586791">0</span><span class="op" id="5586792">]</span>&nbsp;<span class="op" id="5586794">==</span>&nbsp;<span class="ident" id="5586797">dst</span><span class="op" id="5586800">.</span><span class="ident" id="5586801">Rune</span><span class="op" id="5586805">[</span><span class="num" id="5586806">0</span><span class="op" id="5586807">]</span>&nbsp;<span class="op" id="5586809">&amp;&amp;</span>&nbsp;<span class="ident" id="5586812">src</span><span class="op" id="5586815">.</span><span class="ident" id="5586816">Flags</span>&nbsp;<span class="op" id="5586822">==</span>&nbsp;<span class="ident" id="5586825">dst</span><span class="op" id="5586828">.</span><span class="ident" id="5586829">Flags</span>&nbsp;<span class="op" id="5586835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5586840">break</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5586848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5586852">dst</span><span class="op" id="5586855">.</span><span class="ident" id="5586856">Op</span>&nbsp;<span class="op" id="5586859">=</span>&nbsp;<span class="ident" id="5586861">OpCharClass</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5586875">dst</span><span class="op" id="5586878">.</span><span class="ident" id="5586879">Rune</span>&nbsp;<span class="op" id="5586884">=</span>&nbsp;<span class="ident" id="5586886">appendLiteral</span><span class="op" id="5586899">(</span><span class="ident" id="5586900">dst</span><span class="op" id="5586903">.</span><span class="ident" id="5586904">Rune</span><span class="op" id="5586908">[</span><span class="op" id="5586909">:</span><span class="num" id="5586910">0</span><span class="op" id="5586911">]</span><span class="op" id="5586912">,</span>&nbsp;<span class="ident" id="5586914">dst</span><span class="op" id="5586917">.</span><span class="ident" id="5586918">Rune</span><span class="op" id="5586922">[</span><span class="num" id="5586923">0</span><span class="op" id="5586924">]</span><span class="op" id="5586925">,</span>&nbsp;<span class="ident" id="5586927">dst</span><span class="op" id="5586930">.</span><span class="ident" id="5586931">Flags</span><span class="op" id="5586936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5586940">dst</span><span class="op" id="5586943">.</span><span class="ident" id="5586944">Rune</span>&nbsp;<span class="op" id="5586949">=</span>&nbsp;<span class="ident" id="5586951">appendLiteral</span><span class="op" id="5586964">(</span><span class="ident" id="5586965">dst</span><span class="op" id="5586968">.</span><span class="ident" id="5586969">Rune</span><span class="op" id="5586973">,</span>&nbsp;<span class="ident" id="5586975">src</span><span class="op" id="5586978">.</span><span class="ident" id="5586979">Rune</span><span class="op" id="5586983">[</span><span class="num" id="5586984">0</span><span class="op" id="5586985">]</span><span class="op" id="5586986">,</span>&nbsp;<span class="ident" id="5586988">src</span><span class="op" id="5586991">.</span><span class="ident" id="5586992">Flags</span><span class="op" id="5586997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5587000">}</span><br>
<span class="lineno">1155</span><span class="op" id="5587002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5587005">//&nbsp;If&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;is&nbsp;an&nbsp;element&nbsp;followed&nbsp;by&nbsp;an&nbsp;opVerticalBar</span><br>
<span class="lineno"></span><span class="comment" id="5587075">//&nbsp;swapVerticalBar&nbsp;swaps&nbsp;the&nbsp;two&nbsp;and&nbsp;returns&nbsp;true.</span><br>
<span class="lineno"></span><span class="comment" id="5587126">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;false.</span><br>
<span class="lineno">1160</span><span class="keyword" id="5587157">func</span>&nbsp;<span class="op" id="5587162">(</span><span class="ident" id="5587163">p</span>&nbsp;<span class="op" id="5587165">*</span><span class="ident" id="5587166">parser</span><span class="op" id="5587172">)</span>&nbsp;<span class="ident" id="5587174">swapVerticalBar</span><span class="op" id="5587189">(</span><span class="op" id="5587190">)</span>&nbsp;<span class="builtintype" id="5587192">bool</span>&nbsp;<span class="op" id="5587197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5587200">//&nbsp;If&nbsp;above&nbsp;and&nbsp;below&nbsp;vertical&nbsp;bar&nbsp;are&nbsp;literal&nbsp;or&nbsp;char&nbsp;class,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5587263">//&nbsp;can&nbsp;merge&nbsp;into&nbsp;a&nbsp;single&nbsp;char&nbsp;class.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587303">n</span>&nbsp;<span class="op" id="5587305">:=</span>&nbsp;<span class="builtinfunc" id="5587308">len</span><span class="op" id="5587311">(</span><span class="ident" id="5587312">p</span><span class="op" id="5587313">.</span><span class="ident" id="5587314">stack</span><span class="op" id="5587319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5587322">if</span>&nbsp;<span class="ident" id="5587325">n</span>&nbsp;<span class="op" id="5587327">&gt;=</span>&nbsp;<span class="num" id="5587330">3</span>&nbsp;<span class="op" id="5587332">&amp;&amp;</span>&nbsp;<span class="ident" id="5587335">p</span><span class="op" id="5587336">.</span><span class="ident" id="5587337">stack</span><span class="op" id="5587342">[</span><span class="ident" id="5587343">n</span><span class="op" id="5587344">-</span><span class="num" id="5587345">2</span><span class="op" id="5587346">]</span><span class="op" id="5587347">.</span><span class="ident" id="5587348">Op</span>&nbsp;<span class="op" id="5587351">==</span>&nbsp;<span class="ident" id="5587354">opVerticalBar</span>&nbsp;<span class="op" id="5587368">&amp;&amp;</span>&nbsp;<span class="ident" id="5587371">isCharClass</span><span class="op" id="5587382">(</span><span class="ident" id="5587383">p</span><span class="op" id="5587384">.</span><span class="ident" id="5587385">stack</span><span class="op" id="5587390">[</span><span class="ident" id="5587391">n</span><span class="op" id="5587392">-</span><span class="num" id="5587393">1</span><span class="op" id="5587394">]</span><span class="op" id="5587395">)</span>&nbsp;<span class="op" id="5587397">&amp;&amp;</span>&nbsp;<span class="ident" id="5587400">isCharClass</span><span class="op" id="5587411">(</span><span class="ident" id="5587412">p</span><span class="op" id="5587413">.</span><span class="ident" id="5587414">stack</span><span class="op" id="5587419">[</span><span class="ident" id="5587420">n</span><span class="op" id="5587421">-</span><span class="num" id="5587422">3</span><span class="op" id="5587423">]</span><span class="op" id="5587424">)</span>&nbsp;<span class="op" id="5587426">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587430">re1</span>&nbsp;<span class="op" id="5587434">:=</span>&nbsp;<span class="ident" id="5587437">p</span><span class="op" id="5587438">.</span><span class="ident" id="5587439">stack</span><span class="op" id="5587444">[</span><span class="ident" id="5587445">n</span><span class="op" id="5587446">-</span><span class="num" id="5587447">1</span><span class="op" id="5587448">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587452">re3</span>&nbsp;<span class="op" id="5587456">:=</span>&nbsp;<span class="ident" id="5587459">p</span><span class="op" id="5587460">.</span><span class="ident" id="5587461">stack</span><span class="op" id="5587466">[</span><span class="ident" id="5587467">n</span><span class="op" id="5587468">-</span><span class="num" id="5587469">3</span><span class="op" id="5587470">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5587474">//&nbsp;Make&nbsp;re3&nbsp;the&nbsp;more&nbsp;complex&nbsp;of&nbsp;the&nbsp;two.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5587517">if</span>&nbsp;<span class="ident" id="5587520">re1</span><span class="op" id="5587523">.</span><span class="ident" id="5587524">Op</span>&nbsp;<span class="op" id="5587527">&gt;</span>&nbsp;<span class="ident" id="5587529">re3</span><span class="op" id="5587532">.</span><span class="ident" id="5587533">Op</span>&nbsp;<span class="op" id="5587536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587541">re1</span><span class="op" id="5587544">,</span>&nbsp;<span class="ident" id="5587546">re3</span>&nbsp;<span class="op" id="5587550">=</span>&nbsp;<span class="ident" id="5587552">re3</span><span class="op" id="5587555">,</span>&nbsp;<span class="ident" id="5587557">re1</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587564">p</span><span class="op" id="5587565">.</span><span class="ident" id="5587566">stack</span><span class="op" id="5587571">[</span><span class="ident" id="5587572">n</span><span class="op" id="5587573">-</span><span class="num" id="5587574">3</span><span class="op" id="5587575">]</span>&nbsp;<span class="op" id="5587577">=</span>&nbsp;<span class="ident" id="5587579">re3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5587585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587589">mergeCharClass</span><span class="op" id="5587603">(</span><span class="ident" id="5587604">re3</span><span class="op" id="5587607">,</span>&nbsp;<span class="ident" id="5587609">re1</span><span class="op" id="5587612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587616">p</span><span class="op" id="5587617">.</span><span class="ident" id="5587618">reuse</span><span class="op" id="5587623">(</span><span class="ident" id="5587624">re1</span><span class="op" id="5587627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587631">p</span><span class="op" id="5587632">.</span><span class="ident" id="5587633">stack</span>&nbsp;<span class="op" id="5587639">=</span>&nbsp;<span class="ident" id="5587641">p</span><span class="op" id="5587642">.</span><span class="ident" id="5587643">stack</span><span class="op" id="5587648">[</span><span class="op" id="5587649">:</span><span class="ident" id="5587650">n</span><span class="op" id="5587651">-</span><span class="num" id="5587652">1</span><span class="op" id="5587653">]</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5587657">return</span>&nbsp;<span class="builtintype" id="5587664">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5587670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5587674">if</span>&nbsp;<span class="ident" id="5587677">n</span>&nbsp;<span class="op" id="5587679">&gt;=</span>&nbsp;<span class="num" id="5587682">2</span>&nbsp;<span class="op" id="5587684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587688">re1</span>&nbsp;<span class="op" id="5587692">:=</span>&nbsp;<span class="ident" id="5587695">p</span><span class="op" id="5587696">.</span><span class="ident" id="5587697">stack</span><span class="op" id="5587702">[</span><span class="ident" id="5587703">n</span><span class="op" id="5587704">-</span><span class="num" id="5587705">1</span><span class="op" id="5587706">]</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587710">re2</span>&nbsp;<span class="op" id="5587714">:=</span>&nbsp;<span class="ident" id="5587717">p</span><span class="op" id="5587718">.</span><span class="ident" id="5587719">stack</span><span class="op" id="5587724">[</span><span class="ident" id="5587725">n</span><span class="op" id="5587726">-</span><span class="num" id="5587727">2</span><span class="op" id="5587728">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5587732">if</span>&nbsp;<span class="ident" id="5587735">re2</span><span class="op" id="5587738">.</span><span class="ident" id="5587739">Op</span>&nbsp;<span class="op" id="5587742">==</span>&nbsp;<span class="ident" id="5587745">opVerticalBar</span>&nbsp;<span class="op" id="5587759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5587764">if</span>&nbsp;<span class="ident" id="5587767">n</span>&nbsp;<span class="op" id="5587769">&gt;=</span>&nbsp;<span class="num" id="5587772">3</span>&nbsp;<span class="op" id="5587774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5587780">//&nbsp;Now&nbsp;out&nbsp;of&nbsp;reach.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5587805">//&nbsp;Clean&nbsp;opportunistically.</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587837">cleanAlt</span><span class="op" id="5587845">(</span><span class="ident" id="5587846">p</span><span class="op" id="5587847">.</span><span class="ident" id="5587848">stack</span><span class="op" id="5587853">[</span><span class="ident" id="5587854">n</span><span class="op" id="5587855">-</span><span class="num" id="5587856">3</span><span class="op" id="5587857">]</span><span class="op" id="5587858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5587863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587868">p</span><span class="op" id="5587869">.</span><span class="ident" id="5587870">stack</span><span class="op" id="5587875">[</span><span class="ident" id="5587876">n</span><span class="op" id="5587877">-</span><span class="num" id="5587878">2</span><span class="op" id="5587879">]</span>&nbsp;<span class="op" id="5587881">=</span>&nbsp;<span class="ident" id="5587883">re1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5587890">p</span><span class="op" id="5587891">.</span><span class="ident" id="5587892">stack</span><span class="op" id="5587897">[</span><span class="ident" id="5587898">n</span><span class="op" id="5587899">-</span><span class="num" id="5587900">1</span><span class="op" id="5587901">]</span>&nbsp;<span class="op" id="5587903">=</span>&nbsp;<span class="ident" id="5587905">re2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5587912">return</span>&nbsp;<span class="builtintype" id="5587919">true</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5587926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5587929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5587932">return</span>&nbsp;<span class="builtintype" id="5587939">false</span><br>
<span class="lineno"></span><span class="op" id="5587945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1195</span><span class="comment" id="5587948">//&nbsp;parseRightParen&nbsp;handles&nbsp;a&nbsp;)&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="5587993">func</span>&nbsp;<span class="op" id="5587998">(</span><span class="ident" id="5587999">p</span>&nbsp;<span class="op" id="5588001">*</span><span class="ident" id="5588002">parser</span><span class="op" id="5588008">)</span>&nbsp;<span class="ident" id="5588010">parseRightParen</span><span class="op" id="5588025">(</span><span class="op" id="5588026">)</span>&nbsp;<span class="builtintype" id="5588028">error</span>&nbsp;<span class="op" id="5588034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588037">p</span><span class="op" id="5588038">.</span><span class="ident" id="5588039">concat</span><span class="op" id="5588045">(</span><span class="op" id="5588046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588049">if</span>&nbsp;<span class="ident" id="5588052">p</span><span class="op" id="5588053">.</span><span class="ident" id="5588054">swapVerticalBar</span><span class="op" id="5588069">(</span><span class="op" id="5588070">)</span>&nbsp;<span class="op" id="5588072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5588076">//&nbsp;pop&nbsp;vertical&nbsp;bar</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588098">p</span><span class="op" id="5588099">.</span><span class="ident" id="5588100">stack</span>&nbsp;<span class="op" id="5588106">=</span>&nbsp;<span class="ident" id="5588108">p</span><span class="op" id="5588109">.</span><span class="ident" id="5588110">stack</span><span class="op" id="5588115">[</span><span class="op" id="5588116">:</span><span class="builtinfunc" id="5588117">len</span><span class="op" id="5588120">(</span><span class="ident" id="5588121">p</span><span class="op" id="5588122">.</span><span class="ident" id="5588123">stack</span><span class="op" id="5588128">)</span><span class="op" id="5588129">-</span><span class="num" id="5588130">1</span><span class="op" id="5588131">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5588134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588137">p</span><span class="op" id="5588138">.</span><span class="ident" id="5588139">alternate</span><span class="op" id="5588148">(</span><span class="op" id="5588149">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588153">n</span>&nbsp;<span class="op" id="5588155">:=</span>&nbsp;<span class="builtinfunc" id="5588158">len</span><span class="op" id="5588161">(</span><span class="ident" id="5588162">p</span><span class="op" id="5588163">.</span><span class="ident" id="5588164">stack</span><span class="op" id="5588169">)</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588172">if</span>&nbsp;<span class="ident" id="5588175">n</span>&nbsp;<span class="op" id="5588177">&lt;</span>&nbsp;<span class="num" id="5588179">2</span>&nbsp;<span class="op" id="5588181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588185">return</span>&nbsp;<span class="op" id="5588192">&amp;</span><span class="ident" id="5588193">Error</span><span class="op" id="5588198">{</span><span class="ident" id="5588199">ErrUnexpectedParen</span><span class="op" id="5588217">,</span>&nbsp;<span class="ident" id="5588219">p</span><span class="op" id="5588220">.</span><span class="ident" id="5588221">wholeRegexp</span><span class="op" id="5588232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5588235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588238">re1</span>&nbsp;<span class="op" id="5588242">:=</span>&nbsp;<span class="ident" id="5588245">p</span><span class="op" id="5588246">.</span><span class="ident" id="5588247">stack</span><span class="op" id="5588252">[</span><span class="ident" id="5588253">n</span><span class="op" id="5588254">-</span><span class="num" id="5588255">1</span><span class="op" id="5588256">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588259">re2</span>&nbsp;<span class="op" id="5588263">:=</span>&nbsp;<span class="ident" id="5588266">p</span><span class="op" id="5588267">.</span><span class="ident" id="5588268">stack</span><span class="op" id="5588273">[</span><span class="ident" id="5588274">n</span><span class="op" id="5588275">-</span><span class="num" id="5588276">2</span><span class="op" id="5588277">]</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588280">p</span><span class="op" id="5588281">.</span><span class="ident" id="5588282">stack</span>&nbsp;<span class="op" id="5588288">=</span>&nbsp;<span class="ident" id="5588290">p</span><span class="op" id="5588291">.</span><span class="ident" id="5588292">stack</span><span class="op" id="5588297">[</span><span class="op" id="5588298">:</span><span class="ident" id="5588299">n</span><span class="op" id="5588300">-</span><span class="num" id="5588301">2</span><span class="op" id="5588302">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588305">if</span>&nbsp;<span class="ident" id="5588308">re2</span><span class="op" id="5588311">.</span><span class="ident" id="5588312">Op</span>&nbsp;<span class="op" id="5588315">!=</span>&nbsp;<span class="ident" id="5588318">opLeftParen</span>&nbsp;<span class="op" id="5588330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588334">return</span>&nbsp;<span class="op" id="5588341">&amp;</span><span class="ident" id="5588342">Error</span><span class="op" id="5588347">{</span><span class="ident" id="5588348">ErrUnexpectedParen</span><span class="op" id="5588366">,</span>&nbsp;<span class="ident" id="5588368">p</span><span class="op" id="5588369">.</span><span class="ident" id="5588370">wholeRegexp</span><span class="op" id="5588381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5588384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5588387">//&nbsp;Restore&nbsp;flags&nbsp;at&nbsp;time&nbsp;of&nbsp;paren.</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588423">p</span><span class="op" id="5588424">.</span><span class="ident" id="5588425">flags</span>&nbsp;<span class="op" id="5588431">=</span>&nbsp;<span class="ident" id="5588433">re2</span><span class="op" id="5588436">.</span><span class="ident" id="5588437">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588444">if</span>&nbsp;<span class="ident" id="5588447">re2</span><span class="op" id="5588450">.</span><span class="ident" id="5588451">Cap</span>&nbsp;<span class="op" id="5588455">==</span>&nbsp;<span class="num" id="5588458">0</span>&nbsp;<span class="op" id="5588460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5588464">//&nbsp;Just&nbsp;for&nbsp;grouping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588488">p</span><span class="op" id="5588489">.</span><span class="ident" id="5588490">push</span><span class="op" id="5588494">(</span><span class="ident" id="5588495">re1</span><span class="op" id="5588498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5588501">}</span>&nbsp;<span class="keyword" id="5588503">else</span>&nbsp;<span class="op" id="5588508">{</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588512">re2</span><span class="op" id="5588515">.</span><span class="ident" id="5588516">Op</span>&nbsp;<span class="op" id="5588519">=</span>&nbsp;<span class="ident" id="5588521">OpCapture</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588533">re2</span><span class="op" id="5588536">.</span><span class="ident" id="5588537">Sub</span>&nbsp;<span class="op" id="5588541">=</span>&nbsp;<span class="ident" id="5588543">re2</span><span class="op" id="5588546">.</span><span class="ident" id="5588547">Sub0</span><span class="op" id="5588551">[</span><span class="op" id="5588552">:</span><span class="num" id="5588553">1</span><span class="op" id="5588554">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588558">re2</span><span class="op" id="5588561">.</span><span class="ident" id="5588562">Sub</span><span class="op" id="5588565">[</span><span class="num" id="5588566">0</span><span class="op" id="5588567">]</span>&nbsp;<span class="op" id="5588569">=</span>&nbsp;<span class="ident" id="5588571">re1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588577">p</span><span class="op" id="5588578">.</span><span class="ident" id="5588579">push</span><span class="op" id="5588583">(</span><span class="ident" id="5588584">re2</span><span class="op" id="5588587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5588590">}</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588593">return</span>&nbsp;<span class="ident" id="5588600">nil</span><br>
<span class="lineno"></span><span class="op" id="5588604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5588607">//&nbsp;parseEscape&nbsp;parses&nbsp;an&nbsp;escape&nbsp;sequence&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="5588670">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune.</span><br>
<span class="lineno">1230</span><span class="keyword" id="5588695">func</span>&nbsp;<span class="op" id="5588700">(</span><span class="ident" id="5588701">p</span>&nbsp;<span class="op" id="5588703">*</span><span class="ident" id="5588704">parser</span><span class="op" id="5588710">)</span>&nbsp;<span class="ident" id="5588712">parseEscape</span><span class="op" id="5588723">(</span><span class="ident" id="5588724">s</span>&nbsp;<span class="builtintype" id="5588726">string</span><span class="op" id="5588732">)</span>&nbsp;<span class="op" id="5588734">(</span><span class="ident" id="5588735">r</span>&nbsp;<span class="builtintype" id="5588737">rune</span><span class="op" id="5588741">,</span>&nbsp;<span class="ident" id="5588743">rest</span>&nbsp;<span class="builtintype" id="5588748">string</span><span class="op" id="5588754">,</span>&nbsp;<span class="ident" id="5588756">err</span>&nbsp;<span class="builtintype" id="5588760">error</span><span class="op" id="5588765">)</span>&nbsp;<span class="op" id="5588767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588770">t</span>&nbsp;<span class="op" id="5588772">:=</span>&nbsp;<span class="ident" id="5588775">s</span><span class="op" id="5588776">[</span><span class="num" id="5588777">1</span><span class="op" id="5588778">:</span><span class="op" id="5588779">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588782">if</span>&nbsp;<span class="ident" id="5588785">t</span>&nbsp;<span class="op" id="5588787">==</span>&nbsp;<span class="string" id="5588790">&#34;&#34;</span>&nbsp;<span class="op" id="5588793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588797">return</span>&nbsp;<span class="num" id="5588804">0</span><span class="op" id="5588805">,</span>&nbsp;<span class="string" id="5588807">&#34;&#34;</span><span class="op" id="5588809">,</span>&nbsp;<span class="op" id="5588811">&amp;</span><span class="ident" id="5588812">Error</span><span class="op" id="5588817">{</span><span class="ident" id="5588818">ErrTrailingBackslash</span><span class="op" id="5588838">,</span>&nbsp;<span class="string" id="5588840">&#34;&#34;</span><span class="op" id="5588842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5588845">}</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5588848">c</span><span class="op" id="5588849">,</span>&nbsp;<span class="ident" id="5588851">t</span><span class="op" id="5588852">,</span>&nbsp;<span class="ident" id="5588854">err</span>&nbsp;<span class="op" id="5588858">:=</span>&nbsp;<span class="ident" id="5588861">nextRune</span><span class="op" id="5588869">(</span><span class="ident" id="5588870">t</span><span class="op" id="5588871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588874">if</span>&nbsp;<span class="ident" id="5588877">err</span>&nbsp;<span class="op" id="5588881">!=</span>&nbsp;<span class="ident" id="5588884">nil</span>&nbsp;<span class="op" id="5588888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588892">return</span>&nbsp;<span class="num" id="5588899">0</span><span class="op" id="5588900">,</span>&nbsp;<span class="string" id="5588902">&#34;&#34;</span><span class="op" id="5588904">,</span>&nbsp;<span class="ident" id="5588906">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5588911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1240</span><span class="ident" id="5588914">Switch</span><span class="op" id="5588920">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588923">switch</span>&nbsp;<span class="ident" id="5588930">c</span>&nbsp;<span class="op" id="5588932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588935">default</span><span class="op" id="5588942">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5588946">if</span>&nbsp;<span class="ident" id="5588949">c</span>&nbsp;<span class="op" id="5588951">&lt;</span>&nbsp;<span class="ident" id="5588953">utf8</span><span class="op" id="5588957">.</span><span class="ident" id="5588958">RuneSelf</span>&nbsp;<span class="op" id="5588967">&amp;&amp;</span>&nbsp;<span class="op" id="5588970">!</span><span class="ident" id="5588971">isalnum</span><span class="op" id="5588978">(</span><span class="ident" id="5588979">c</span><span class="op" id="5588980">)</span>&nbsp;<span class="op" id="5588982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5588987">//&nbsp;Escaped&nbsp;non-word&nbsp;characters&nbsp;are&nbsp;always&nbsp;themselves.</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5589044">//&nbsp;PCRE&nbsp;is&nbsp;not&nbsp;quite&nbsp;so&nbsp;rigorous:&nbsp;it&nbsp;accepts&nbsp;things&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5589104">//&nbsp;\q,&nbsp;but&nbsp;we&nbsp;don&#39;t.&nbsp;&nbsp;We&nbsp;once&nbsp;rejected&nbsp;\_,&nbsp;but&nbsp;too&nbsp;many</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5589163">//&nbsp;programs&nbsp;and&nbsp;people&nbsp;insist&nbsp;on&nbsp;using&nbsp;it,&nbsp;so&nbsp;allow&nbsp;\_.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589222">return</span>&nbsp;<span class="ident" id="5589229">c</span><span class="op" id="5589230">,</span>&nbsp;<span class="ident" id="5589232">t</span><span class="op" id="5589233">,</span>&nbsp;<span class="ident" id="5589235">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5589241">}</span><br>
<span class="lineno">1250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5589245">//&nbsp;Octal&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589264">case</span>&nbsp;<span class="string" id="5589269">&#39;1&#39;</span><span class="op" id="5589272">,</span>&nbsp;<span class="string" id="5589274">&#39;2&#39;</span><span class="op" id="5589277">,</span>&nbsp;<span class="string" id="5589279">&#39;3&#39;</span><span class="op" id="5589282">,</span>&nbsp;<span class="string" id="5589284">&#39;4&#39;</span><span class="op" id="5589287">,</span>&nbsp;<span class="string" id="5589289">&#39;5&#39;</span><span class="op" id="5589292">,</span>&nbsp;<span class="string" id="5589294">&#39;6&#39;</span><span class="op" id="5589297">,</span>&nbsp;<span class="string" id="5589299">&#39;7&#39;</span><span class="op" id="5589302">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5589306">//&nbsp;Single&nbsp;non-zero&nbsp;digit&nbsp;is&nbsp;a&nbsp;backreference;&nbsp;not&nbsp;supported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589367">if</span>&nbsp;<span class="ident" id="5589370">t</span>&nbsp;<span class="op" id="5589372">==</span>&nbsp;<span class="string" id="5589375">&#34;&#34;</span>&nbsp;<span class="op" id="5589378">||</span>&nbsp;<span class="ident" id="5589381">t</span><span class="op" id="5589382">[</span><span class="num" id="5589383">0</span><span class="op" id="5589384">]</span>&nbsp;<span class="op" id="5589386">&lt;</span>&nbsp;<span class="string" id="5589388">&#39;0&#39;</span>&nbsp;<span class="op" id="5589392">||</span>&nbsp;<span class="ident" id="5589395">t</span><span class="op" id="5589396">[</span><span class="num" id="5589397">0</span><span class="op" id="5589398">]</span>&nbsp;<span class="op" id="5589400">&gt;</span>&nbsp;<span class="string" id="5589402">&#39;7&#39;</span>&nbsp;<span class="op" id="5589406">{</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589411">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5589419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589423">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589436">case</span>&nbsp;<span class="string" id="5589441">&#39;0&#39;</span><span class="op" id="5589444">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5589448">//&nbsp;Consume&nbsp;up&nbsp;to&nbsp;three&nbsp;octal&nbsp;digits;&nbsp;already&nbsp;have&nbsp;one.</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5589505">r</span>&nbsp;<span class="op" id="5589507">=</span>&nbsp;<span class="ident" id="5589509">c</span>&nbsp;<span class="op" id="5589511">-</span>&nbsp;<span class="string" id="5589513">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589519">for</span>&nbsp;<span class="ident" id="5589523">i</span>&nbsp;<span class="op" id="5589525">:=</span>&nbsp;<span class="num" id="5589528">1</span><span class="op" id="5589529">;</span>&nbsp;<span class="ident" id="5589531">i</span>&nbsp;<span class="op" id="5589533">&lt;</span>&nbsp;<span class="num" id="5589535">3</span><span class="op" id="5589536">;</span>&nbsp;<span class="ident" id="5589538">i</span><span class="op" id="5589539">++</span>&nbsp;<span class="op" id="5589542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589547">if</span>&nbsp;<span class="ident" id="5589550">t</span>&nbsp;<span class="op" id="5589552">==</span>&nbsp;<span class="string" id="5589555">&#34;&#34;</span>&nbsp;<span class="op" id="5589558">||</span>&nbsp;<span class="ident" id="5589561">t</span><span class="op" id="5589562">[</span><span class="num" id="5589563">0</span><span class="op" id="5589564">]</span>&nbsp;<span class="op" id="5589566">&lt;</span>&nbsp;<span class="string" id="5589568">&#39;0&#39;</span>&nbsp;<span class="op" id="5589572">||</span>&nbsp;<span class="ident" id="5589575">t</span><span class="op" id="5589576">[</span><span class="num" id="5589577">0</span><span class="op" id="5589578">]</span>&nbsp;<span class="op" id="5589580">&gt;</span>&nbsp;<span class="string" id="5589582">&#39;7&#39;</span>&nbsp;<span class="op" id="5589586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589592">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5589601">}</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5589606">r</span>&nbsp;<span class="op" id="5589608">=</span>&nbsp;<span class="ident" id="5589610">r</span><span class="op" id="5589611">*</span><span class="num" id="5589612">8</span>&nbsp;<span class="op" id="5589614">+</span>&nbsp;<span class="builtintype" id="5589616">rune</span><span class="op" id="5589620">(</span><span class="ident" id="5589621">t</span><span class="op" id="5589622">[</span><span class="num" id="5589623">0</span><span class="op" id="5589624">]</span><span class="op" id="5589625">)</span>&nbsp;<span class="op" id="5589627">-</span>&nbsp;<span class="string" id="5589629">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5589636">t</span>&nbsp;<span class="op" id="5589638">=</span>&nbsp;<span class="ident" id="5589640">t</span><span class="op" id="5589641">[</span><span class="num" id="5589642">1</span><span class="op" id="5589643">:</span><span class="op" id="5589644">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5589648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589652">return</span>&nbsp;<span class="ident" id="5589659">r</span><span class="op" id="5589660">,</span>&nbsp;<span class="ident" id="5589662">t</span><span class="op" id="5589663">,</span>&nbsp;<span class="ident" id="5589665">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5589671">//&nbsp;Hexadecimal&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589696">case</span>&nbsp;<span class="string" id="5589701">&#39;x&#39;</span><span class="op" id="5589704">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589708">if</span>&nbsp;<span class="ident" id="5589711">t</span>&nbsp;<span class="op" id="5589713">==</span>&nbsp;<span class="string" id="5589716">&#34;&#34;</span>&nbsp;<span class="op" id="5589719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589724">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5589732">}</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589736">if</span>&nbsp;<span class="ident" id="5589739">c</span><span class="op" id="5589740">,</span>&nbsp;<span class="ident" id="5589742">t</span><span class="op" id="5589743">,</span>&nbsp;<span class="ident" id="5589745">err</span>&nbsp;<span class="op" id="5589749">=</span>&nbsp;<span class="ident" id="5589751">nextRune</span><span class="op" id="5589759">(</span><span class="ident" id="5589760">t</span><span class="op" id="5589761">)</span><span class="op" id="5589762">;</span>&nbsp;<span class="ident" id="5589764">err</span>&nbsp;<span class="op" id="5589768">!=</span>&nbsp;<span class="ident" id="5589771">nil</span>&nbsp;<span class="op" id="5589775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589780">return</span>&nbsp;<span class="num" id="5589787">0</span><span class="op" id="5589788">,</span>&nbsp;<span class="string" id="5589790">&#34;&#34;</span><span class="op" id="5589792">,</span>&nbsp;<span class="ident" id="5589794">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5589800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5589804">if</span>&nbsp;<span class="ident" id="5589807">c</span>&nbsp;<span class="op" id="5589809">==</span>&nbsp;<span class="string" id="5589812">&#39;{&#39;</span>&nbsp;<span class="op" id="5589816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5589821">//&nbsp;Any&nbsp;number&nbsp;of&nbsp;digits&nbsp;in&nbsp;braces.</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5589859">//&nbsp;Perl&nbsp;accepts&nbsp;any&nbsp;text&nbsp;at&nbsp;all;&nbsp;it&nbsp;ignores&nbsp;all&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5589915">//&nbsp;after&nbsp;the&nbsp;first&nbsp;non-hex&nbsp;digit.&nbsp;&nbsp;We&nbsp;require&nbsp;only&nbsp;hex&nbsp;digits,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5589981">//&nbsp;and&nbsp;at&nbsp;least&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5590005">nhex</span>&nbsp;<span class="op" id="5590010">:=</span>&nbsp;<span class="num" id="5590013">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5590018">r</span>&nbsp;<span class="op" id="5590020">=</span>&nbsp;<span class="num" id="5590022">0</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590027">for</span>&nbsp;<span class="op" id="5590031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590037">if</span>&nbsp;<span class="ident" id="5590040">t</span>&nbsp;<span class="op" id="5590042">==</span>&nbsp;<span class="string" id="5590045">&#34;&#34;</span>&nbsp;<span class="op" id="5590048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590055">break</span>&nbsp;<span class="ident" id="5590061">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5590072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590078">if</span>&nbsp;<span class="ident" id="5590081">c</span><span class="op" id="5590082">,</span>&nbsp;<span class="ident" id="5590084">t</span><span class="op" id="5590085">,</span>&nbsp;<span class="ident" id="5590087">err</span>&nbsp;<span class="op" id="5590091">=</span>&nbsp;<span class="ident" id="5590093">nextRune</span><span class="op" id="5590101">(</span><span class="ident" id="5590102">t</span><span class="op" id="5590103">)</span><span class="op" id="5590104">;</span>&nbsp;<span class="ident" id="5590106">err</span>&nbsp;<span class="op" id="5590110">!=</span>&nbsp;<span class="ident" id="5590113">nil</span>&nbsp;<span class="op" id="5590117">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590124">return</span>&nbsp;<span class="num" id="5590131">0</span><span class="op" id="5590132">,</span>&nbsp;<span class="string" id="5590134">&#34;&#34;</span><span class="op" id="5590136">,</span>&nbsp;<span class="ident" id="5590138">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5590146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590152">if</span>&nbsp;<span class="ident" id="5590155">c</span>&nbsp;<span class="op" id="5590157">==</span>&nbsp;<span class="string" id="5590160">&#39;}&#39;</span>&nbsp;<span class="op" id="5590164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590171">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5590181">}</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5590187">v</span>&nbsp;<span class="op" id="5590189">:=</span>&nbsp;<span class="ident" id="5590192">unhex</span><span class="op" id="5590197">(</span><span class="ident" id="5590198">c</span><span class="op" id="5590199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590205">if</span>&nbsp;<span class="ident" id="5590208">v</span>&nbsp;<span class="op" id="5590210">&lt;</span>&nbsp;<span class="num" id="5590212">0</span>&nbsp;<span class="op" id="5590214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590221">break</span>&nbsp;<span class="ident" id="5590227">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5590238">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5590244">r</span>&nbsp;<span class="op" id="5590246">=</span>&nbsp;<span class="ident" id="5590248">r</span><span class="op" id="5590249">*</span><span class="num" id="5590250">16</span>&nbsp;<span class="op" id="5590253">+</span>&nbsp;<span class="ident" id="5590255">v</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590261">if</span>&nbsp;<span class="ident" id="5590264">r</span>&nbsp;<span class="op" id="5590266">&gt;</span>&nbsp;<span class="ident" id="5590268">unicode</span><span class="op" id="5590275">.</span><span class="ident" id="5590276">MaxRune</span>&nbsp;<span class="op" id="5590284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590291">break</span>&nbsp;<span class="ident" id="5590297">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5590308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5590314">nhex</span><span class="op" id="5590318">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5590324">}</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590329">if</span>&nbsp;<span class="ident" id="5590332">nhex</span>&nbsp;<span class="op" id="5590337">==</span>&nbsp;<span class="num" id="5590340">0</span>&nbsp;<span class="op" id="5590342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590348">break</span>&nbsp;<span class="ident" id="5590354">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5590364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590369">return</span>&nbsp;<span class="ident" id="5590376">r</span><span class="op" id="5590377">,</span>&nbsp;<span class="ident" id="5590379">t</span><span class="op" id="5590380">,</span>&nbsp;<span class="ident" id="5590382">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5590388">}</span><br>
<span class="lineno">1310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5590393">//&nbsp;Easy&nbsp;case:&nbsp;two&nbsp;hex&nbsp;digits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5590425">x</span>&nbsp;<span class="op" id="5590427">:=</span>&nbsp;<span class="ident" id="5590430">unhex</span><span class="op" id="5590435">(</span><span class="ident" id="5590436">c</span><span class="op" id="5590437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590441">if</span>&nbsp;<span class="ident" id="5590444">c</span><span class="op" id="5590445">,</span>&nbsp;<span class="ident" id="5590447">t</span><span class="op" id="5590448">,</span>&nbsp;<span class="ident" id="5590450">err</span>&nbsp;<span class="op" id="5590454">=</span>&nbsp;<span class="ident" id="5590456">nextRune</span><span class="op" id="5590464">(</span><span class="ident" id="5590465">t</span><span class="op" id="5590466">)</span><span class="op" id="5590467">;</span>&nbsp;<span class="ident" id="5590469">err</span>&nbsp;<span class="op" id="5590473">!=</span>&nbsp;<span class="ident" id="5590476">nil</span>&nbsp;<span class="op" id="5590480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590485">return</span>&nbsp;<span class="num" id="5590492">0</span><span class="op" id="5590493">,</span>&nbsp;<span class="string" id="5590495">&#34;&#34;</span><span class="op" id="5590497">,</span>&nbsp;<span class="ident" id="5590499">err</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5590505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5590509">y</span>&nbsp;<span class="op" id="5590511">:=</span>&nbsp;<span class="ident" id="5590514">unhex</span><span class="op" id="5590519">(</span><span class="ident" id="5590520">c</span><span class="op" id="5590521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590525">if</span>&nbsp;<span class="ident" id="5590528">x</span>&nbsp;<span class="op" id="5590530">&lt;</span>&nbsp;<span class="num" id="5590532">0</span>&nbsp;<span class="op" id="5590534">||</span>&nbsp;<span class="ident" id="5590537">y</span>&nbsp;<span class="op" id="5590539">&lt;</span>&nbsp;<span class="num" id="5590541">0</span>&nbsp;<span class="op" id="5590543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590548">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5590556">}</span><br>
<span class="lineno">1320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590560">return</span>&nbsp;<span class="ident" id="5590567">x</span><span class="op" id="5590568">*</span><span class="num" id="5590569">16</span>&nbsp;<span class="op" id="5590572">+</span>&nbsp;<span class="ident" id="5590574">y</span><span class="op" id="5590575">,</span>&nbsp;<span class="ident" id="5590577">t</span><span class="op" id="5590578">,</span>&nbsp;<span class="ident" id="5590580">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5590586">//&nbsp;C&nbsp;escapes.&nbsp;&nbsp;There&nbsp;is&nbsp;no&nbsp;case&nbsp;&#39;b&#39;,&nbsp;to&nbsp;avoid&nbsp;misparsing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5590644">//&nbsp;the&nbsp;Perl&nbsp;word-boundary&nbsp;\b&nbsp;as&nbsp;the&nbsp;C&nbsp;backspace&nbsp;\b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5590696">//&nbsp;when&nbsp;in&nbsp;POSIX&nbsp;mode.&nbsp;&nbsp;In&nbsp;Perl,&nbsp;/\b/&nbsp;means&nbsp;word-boundary</span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5590755">//&nbsp;but&nbsp;/[\b]/&nbsp;means&nbsp;backspace.&nbsp;&nbsp;We&nbsp;don&#39;t&nbsp;support&nbsp;that.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5590811">//&nbsp;If&nbsp;you&nbsp;want&nbsp;a&nbsp;backspace,&nbsp;embed&nbsp;a&nbsp;literal&nbsp;backspace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5590866">//&nbsp;character&nbsp;or&nbsp;use&nbsp;\x08.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590893">case</span>&nbsp;<span class="string" id="5590898">&#39;a&#39;</span><span class="op" id="5590901">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590905">return</span>&nbsp;<span class="string" id="5590912">&#39;\a&#39;</span><span class="op" id="5590916">,</span>&nbsp;<span class="ident" id="5590918">t</span><span class="op" id="5590919">,</span>&nbsp;<span class="ident" id="5590921">err</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590926">case</span>&nbsp;<span class="string" id="5590931">&#39;f&#39;</span><span class="op" id="5590934">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590938">return</span>&nbsp;<span class="string" id="5590945">&#39;\f&#39;</span><span class="op" id="5590949">,</span>&nbsp;<span class="ident" id="5590951">t</span><span class="op" id="5590952">,</span>&nbsp;<span class="ident" id="5590954">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590959">case</span>&nbsp;<span class="string" id="5590964">&#39;n&#39;</span><span class="op" id="5590967">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590971">return</span>&nbsp;<span class="string" id="5590978">&#39;\n&#39;</span><span class="op" id="5590982">,</span>&nbsp;<span class="ident" id="5590984">t</span><span class="op" id="5590985">,</span>&nbsp;<span class="ident" id="5590987">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5590992">case</span>&nbsp;<span class="string" id="5590997">&#39;r&#39;</span><span class="op" id="5591000">:</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5591004">return</span>&nbsp;<span class="string" id="5591011">&#39;\r&#39;</span><span class="op" id="5591015">,</span>&nbsp;<span class="ident" id="5591017">t</span><span class="op" id="5591018">,</span>&nbsp;<span class="ident" id="5591020">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5591025">case</span>&nbsp;<span class="string" id="5591030">&#39;t&#39;</span><span class="op" id="5591033">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5591037">return</span>&nbsp;<span class="string" id="5591044">&#39;\t&#39;</span><span class="op" id="5591048">,</span>&nbsp;<span class="ident" id="5591050">t</span><span class="op" id="5591051">,</span>&nbsp;<span class="ident" id="5591053">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5591058">case</span>&nbsp;<span class="string" id="5591063">&#39;v&#39;</span><span class="op" id="5591066">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5591070">return</span>&nbsp;<span class="string" id="5591077">&#39;\v&#39;</span><span class="op" id="5591081">,</span>&nbsp;<span class="ident" id="5591083">t</span><span class="op" id="5591084">,</span>&nbsp;<span class="ident" id="5591086">err</span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5591091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5591094">return</span>&nbsp;<span class="num" id="5591101">0</span><span class="op" id="5591102">,</span>&nbsp;<span class="string" id="5591104">&#34;&#34;</span><span class="op" id="5591106">,</span>&nbsp;<span class="op" id="5591108">&amp;</span><span class="ident" id="5591109">Error</span><span class="op" id="5591114">{</span><span class="ident" id="5591115">ErrInvalidEscape</span><span class="op" id="5591131">,</span>&nbsp;<span class="ident" id="5591133">s</span><span class="op" id="5591134">[</span><span class="op" id="5591135">:</span><span class="builtinfunc" id="5591136">len</span><span class="op" id="5591139">(</span><span class="ident" id="5591140">s</span><span class="op" id="5591141">)</span><span class="op" id="5591142">-</span><span class="builtinfunc" id="5591143">len</span><span class="op" id="5591146">(</span><span class="ident" id="5591147">t</span><span class="op" id="5591148">)</span><span class="op" id="5591149">]</span><span class="op" id="5591150">}</span><br>
<span class="lineno"></span><span class="op" id="5591152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5591155">//&nbsp;parseClassChar&nbsp;parses&nbsp;a&nbsp;character&nbsp;class&nbsp;character&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno">1345</span><span class="comment" id="5591230">//&nbsp;and&nbsp;returns&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="5591249">func</span>&nbsp;<span class="op" id="5591254">(</span><span class="ident" id="5591255">p</span>&nbsp;<span class="op" id="5591257">*</span><span class="ident" id="5591258">parser</span><span class="op" id="5591264">)</span>&nbsp;<span class="ident" id="5591266">parseClassChar</span><span class="op" id="5591280">(</span><span class="ident" id="5591281">s</span><span class="op" id="5591282">,</span>&nbsp;<span class="ident" id="5591284">wholeClass</span>&nbsp;<span class="builtintype" id="5591295">string</span><span class="op" id="5591301">)</span>&nbsp;<span class="op" id="5591303">(</span><span class="ident" id="5591304">r</span>&nbsp;<span class="builtintype" id="5591306">rune</span><span class="op" id="5591310">,</span>&nbsp;<span class="ident" id="5591312">rest</span>&nbsp;<span class="builtintype" id="5591317">string</span><span class="op" id="5591323">,</span>&nbsp;<span class="ident" id="5591325">err</span>&nbsp;<span class="builtintype" id="5591329">error</span><span class="op" id="5591334">)</span>&nbsp;<span class="op" id="5591336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5591339">if</span>&nbsp;<span class="ident" id="5591342">s</span>&nbsp;<span class="op" id="5591344">==</span>&nbsp;<span class="string" id="5591347">&#34;&#34;</span>&nbsp;<span class="op" id="5591350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5591354">return</span>&nbsp;<span class="num" id="5591361">0</span><span class="op" id="5591362">,</span>&nbsp;<span class="string" id="5591364">&#34;&#34;</span><span class="op" id="5591366">,</span>&nbsp;<span class="op" id="5591368">&amp;</span><span class="ident" id="5591369">Error</span><span class="op" id="5591374">{</span><span class="ident" id="5591375">Code</span><span class="op" id="5591379">:</span>&nbsp;<span class="ident" id="5591381">ErrMissingBracket</span><span class="op" id="5591398">,</span>&nbsp;<span class="ident" id="5591400">Expr</span><span class="op" id="5591404">:</span>&nbsp;<span class="ident" id="5591406">wholeClass</span><span class="op" id="5591416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5591419">}</span><br>
<span class="lineno">1350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5591423">//&nbsp;Allow&nbsp;regular&nbsp;escape&nbsp;sequences&nbsp;even&nbsp;though</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5591470">//&nbsp;many&nbsp;need&nbsp;not&nbsp;be&nbsp;escaped&nbsp;in&nbsp;this&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5591516">if</span>&nbsp;<span class="ident" id="5591519">s</span><span class="op" id="5591520">[</span><span class="num" id="5591521">0</span><span class="op" id="5591522">]</span>&nbsp;<span class="op" id="5591524">==</span>&nbsp;<span class="string" id="5591527">&#39;\\&#39;</span>&nbsp;<span class="op" id="5591532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5591536">return</span>&nbsp;<span class="ident" id="5591543">p</span><span class="op" id="5591544">.</span><span class="ident" id="5591545">parseEscape</span><span class="op" id="5591556">(</span><span class="ident" id="5591557">s</span><span class="op" id="5591558">)</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5591561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5591565">return</span>&nbsp;<span class="ident" id="5591572">nextRune</span><span class="op" id="5591580">(</span><span class="ident" id="5591581">s</span><span class="op" id="5591582">)</span><br>
<span class="lineno"></span><span class="op" id="5591584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1360</span><span class="keyword" id="5591587">type</span>&nbsp;<span class="ident" id="5591592">charGroup</span>&nbsp;<span class="keyword" id="5591602">struct</span>&nbsp;<span class="op" id="5591609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5591612">sign</span>&nbsp;&nbsp;<span class="builtintype" id="5591618">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5591623">class</span>&nbsp;<span class="op" id="5591629">[</span><span class="op" id="5591630">]</span><span class="builtintype" id="5591631">rune</span><br>
<span class="lineno"></span><span class="op" id="5591636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1365</span><span class="comment" id="5591639">//&nbsp;parsePerlClassEscape&nbsp;parses&nbsp;a&nbsp;leading&nbsp;Perl&nbsp;character&nbsp;class&nbsp;escape&nbsp;like&nbsp;\d</span><br>
<span class="lineno"></span><span class="comment" id="5591716">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="5591795">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5591859">func</span>&nbsp;<span class="op" id="5591864">(</span><span class="ident" id="5591865">p</span>&nbsp;<span class="op" id="5591867">*</span><span class="ident" id="5591868">parser</span><span class="op" id="5591874">)</span>&nbsp;<span class="ident" id="5591876">parsePerlClassEscape</span><span class="op" id="5591896">(</span><span class="ident" id="5591897">s</span>&nbsp;<span class="builtintype" id="5591899">string</span><span class="op" id="5591905">,</span>&nbsp;<span class="ident" id="5591907">r</span>&nbsp;<span class="op" id="5591909">[</span><span class="op" id="5591910">]</span><span class="builtintype" id="5591911">rune</span><span class="op" id="5591915">)</span>&nbsp;<span class="op" id="5591917">(</span><span class="ident" id="5591918">out</span>&nbsp;<span class="op" id="5591922">[</span><span class="op" id="5591923">]</span><span class="builtintype" id="5591924">rune</span><span class="op" id="5591928">,</span>&nbsp;<span class="ident" id="5591930">rest</span>&nbsp;<span class="builtintype" id="5591935">string</span><span class="op" id="5591941">)</span>&nbsp;<span class="op" id="5591943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5591946">if</span>&nbsp;<span class="ident" id="5591949">p</span><span class="op" id="5591950">.</span><span class="ident" id="5591951">flags</span><span class="op" id="5591956">&amp;</span><span class="ident" id="5591957">PerlX</span>&nbsp;<span class="op" id="5591963">==</span>&nbsp;<span class="num" id="5591966">0</span>&nbsp;<span class="op" id="5591968">||</span>&nbsp;<span class="builtinfunc" id="5591971">len</span><span class="op" id="5591974">(</span><span class="ident" id="5591975">s</span><span class="op" id="5591976">)</span>&nbsp;<span class="op" id="5591978">&lt;</span>&nbsp;<span class="num" id="5591980">2</span>&nbsp;<span class="op" id="5591982">||</span>&nbsp;<span class="ident" id="5591985">s</span><span class="op" id="5591986">[</span><span class="num" id="5591987">0</span><span class="op" id="5591988">]</span>&nbsp;<span class="op" id="5591990">!=</span>&nbsp;<span class="string" id="5591993">&#39;\\&#39;</span>&nbsp;<span class="op" id="5591998">{</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5592002">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5592010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5592013">g</span>&nbsp;<span class="op" id="5592015">:=</span>&nbsp;<span class="ident" id="5592018">perlGroup</span><span class="op" id="5592027">[</span><span class="ident" id="5592028">s</span><span class="op" id="5592029">[</span><span class="num" id="5592030">0</span><span class="op" id="5592031">:</span><span class="num" id="5592032">2</span><span class="op" id="5592033">]</span><span class="op" id="5592034">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5592037">if</span>&nbsp;<span class="ident" id="5592040">g</span><span class="op" id="5592041">.</span><span class="ident" id="5592042">sign</span>&nbsp;<span class="op" id="5592047">==</span>&nbsp;<span class="num" id="5592050">0</span>&nbsp;<span class="op" id="5592052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5592056">return</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5592064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5592067">return</span>&nbsp;<span class="ident" id="5592074">p</span><span class="op" id="5592075">.</span><span class="ident" id="5592076">appendGroup</span><span class="op" id="5592087">(</span><span class="ident" id="5592088">r</span><span class="op" id="5592089">,</span>&nbsp;<span class="ident" id="5592091">g</span><span class="op" id="5592092">)</span><span class="op" id="5592093">,</span>&nbsp;<span class="ident" id="5592095">s</span><span class="op" id="5592096">[</span><span class="num" id="5592097">2</span><span class="op" id="5592098">:</span><span class="op" id="5592099">]</span><br>
<span class="lineno"></span><span class="op" id="5592101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5592104">//&nbsp;parseNamedClass&nbsp;parses&nbsp;a&nbsp;leading&nbsp;POSIX&nbsp;named&nbsp;character&nbsp;class&nbsp;like&nbsp;[:alnum:]</span><br>
<span class="lineno">1380</span><span class="comment" id="5592183">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="5592262">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5592326">func</span>&nbsp;<span class="op" id="5592331">(</span><span class="ident" id="5592332">p</span>&nbsp;<span class="op" id="5592334">*</span><span class="ident" id="5592335">parser</span><span class="op" id="5592341">)</span>&nbsp;<span class="ident" id="5592343">parseNamedClass</span><span class="op" id="5592358">(</span><span class="ident" id="5592359">s</span>&nbsp;<span class="builtintype" id="5592361">string</span><span class="op" id="5592367">,</span>&nbsp;<span class="ident" id="5592369">r</span>&nbsp;<span class="op" id="5592371">[</span><span class="op" id="5592372">]</span><span class="builtintype" id="5592373">rune</span><span class="op" id="5592377">)</span>&nbsp;<span class="op" id="5592379">(</span><span class="ident" id="5592380">out</span>&nbsp;<span class="op" id="5592384">[</span><span class="op" id="5592385">]</span><span class="builtintype" id="5592386">rune</span><span class="op" id="5592390">,</span>&nbsp;<span class="ident" id="5592392">rest</span>&nbsp;<span class="builtintype" id="5592397">string</span><span class="op" id="5592403">,</span>&nbsp;<span class="ident" id="5592405">err</span>&nbsp;<span class="builtintype" id="5592409">error</span><span class="op" id="5592414">)</span>&nbsp;<span class="op" id="5592416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5592419">if</span>&nbsp;<span class="builtinfunc" id="5592422">len</span><span class="op" id="5592425">(</span><span class="ident" id="5592426">s</span><span class="op" id="5592427">)</span>&nbsp;<span class="op" id="5592429">&lt;</span>&nbsp;<span class="num" id="5592431">2</span>&nbsp;<span class="op" id="5592433">||</span>&nbsp;<span class="ident" id="5592436">s</span><span class="op" id="5592437">[</span><span class="num" id="5592438">0</span><span class="op" id="5592439">]</span>&nbsp;<span class="op" id="5592441">!=</span>&nbsp;<span class="string" id="5592444">&#39;[&#39;</span>&nbsp;<span class="op" id="5592448">||</span>&nbsp;<span class="ident" id="5592451">s</span><span class="op" id="5592452">[</span><span class="num" id="5592453">1</span><span class="op" id="5592454">]</span>&nbsp;<span class="op" id="5592456">!=</span>&nbsp;<span class="string" id="5592459">&#39;:&#39;</span>&nbsp;<span class="op" id="5592463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5592467">return</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5592475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5592479">i</span>&nbsp;<span class="op" id="5592481">:=</span>&nbsp;<span class="ident" id="5592484">strings</span><span class="op" id="5592491">.</span><span class="ident" id="5592492">Index</span><span class="op" id="5592497">(</span><span class="ident" id="5592498">s</span><span class="op" id="5592499">[</span><span class="num" id="5592500">2</span><span class="op" id="5592501">:</span><span class="op" id="5592502">]</span><span class="op" id="5592503">,</span>&nbsp;<span class="string" id="5592505">&#34;:]&#34;</span><span class="op" id="5592509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5592512">if</span>&nbsp;<span class="ident" id="5592515">i</span>&nbsp;<span class="op" id="5592517">&lt;</span>&nbsp;<span class="num" id="5592519">0</span>&nbsp;<span class="op" id="5592521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5592525">return</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5592533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5592536">i</span>&nbsp;<span class="op" id="5592538">+=</span>&nbsp;<span class="num" id="5592541">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5592544">name</span><span class="op" id="5592548">,</span>&nbsp;<span class="ident" id="5592550">s</span>&nbsp;<span class="op" id="5592552">:=</span>&nbsp;<span class="ident" id="5592555">s</span><span class="op" id="5592556">[</span><span class="num" id="5592557">0</span><span class="op" id="5592558">:</span><span class="ident" id="5592559">i</span><span class="op" id="5592560">+</span><span class="num" id="5592561">2</span><span class="op" id="5592562">]</span><span class="op" id="5592563">,</span>&nbsp;<span class="ident" id="5592565">s</span><span class="op" id="5592566">[</span><span class="ident" id="5592567">i</span><span class="op" id="5592568">+</span><span class="num" id="5592569">2</span><span class="op" id="5592570">:</span><span class="op" id="5592571">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5592574">g</span>&nbsp;<span class="op" id="5592576">:=</span>&nbsp;<span class="ident" id="5592579">posixGroup</span><span class="op" id="5592589">[</span><span class="ident" id="5592590">name</span><span class="op" id="5592594">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5592597">if</span>&nbsp;<span class="ident" id="5592600">g</span><span class="op" id="5592601">.</span><span class="ident" id="5592602">sign</span>&nbsp;<span class="op" id="5592607">==</span>&nbsp;<span class="num" id="5592610">0</span>&nbsp;<span class="op" id="5592612">{</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5592616">return</span>&nbsp;<span class="ident" id="5592623">nil</span><span class="op" id="5592626">,</span>&nbsp;<span class="string" id="5592628">&#34;&#34;</span><span class="op" id="5592630">,</span>&nbsp;<span class="op" id="5592632">&amp;</span><span class="ident" id="5592633">Error</span><span class="op" id="5592638">{</span><span class="ident" id="5592639">ErrInvalidCharRange</span><span class="op" id="5592658">,</span>&nbsp;<span class="ident" id="5592660">name</span><span class="op" id="5592664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5592667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5592670">return</span>&nbsp;<span class="ident" id="5592677">p</span><span class="op" id="5592678">.</span><span class="ident" id="5592679">appendGroup</span><span class="op" id="5592690">(</span><span class="ident" id="5592691">r</span><span class="op" id="5592692">,</span>&nbsp;<span class="ident" id="5592694">g</span><span class="op" id="5592695">)</span><span class="op" id="5592696">,</span>&nbsp;<span class="ident" id="5592698">s</span><span class="op" id="5592699">,</span>&nbsp;<span class="ident" id="5592701">nil</span><br>
<span class="lineno"></span><span class="op" id="5592705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1400</span><span class="keyword" id="5592708">func</span>&nbsp;<span class="op" id="5592713">(</span><span class="ident" id="5592714">p</span>&nbsp;<span class="op" id="5592716">*</span><span class="ident" id="5592717">parser</span><span class="op" id="5592723">)</span>&nbsp;<span class="ident" id="5592725">appendGroup</span><span class="op" id="5592736">(</span><span class="ident" id="5592737">r</span>&nbsp;<span class="op" id="5592739">[</span><span class="op" id="5592740">]</span><span class="builtintype" id="5592741">rune</span><span class="op" id="5592745">,</span>&nbsp;<span class="ident" id="5592747">g</span>&nbsp;<span class="ident" id="5592749">charGroup</span><span class="op" id="5592758">)</span>&nbsp;<span class="op" id="5592760">[</span><span class="op" id="5592761">]</span><span class="builtintype" id="5592762">rune</span>&nbsp;<span class="op" id="5592767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5592770">if</span>&nbsp;<span class="ident" id="5592773">p</span><span class="op" id="5592774">.</span><span class="ident" id="5592775">flags</span><span class="op" id="5592780">&amp;</span><span class="ident" id="5592781">FoldCase</span>&nbsp;<span class="op" id="5592790">==</span>&nbsp;<span class="num" id="5592793">0</span>&nbsp;<span class="op" id="5592795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5592799">if</span>&nbsp;<span class="ident" id="5592802">g</span><span class="op" id="5592803">.</span><span class="ident" id="5592804">sign</span>&nbsp;<span class="op" id="5592809">&lt;</span>&nbsp;<span class="num" id="5592811">0</span>&nbsp;<span class="op" id="5592813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5592818">r</span>&nbsp;<span class="op" id="5592820">=</span>&nbsp;<span class="ident" id="5592822">appendNegatedClass</span><span class="op" id="5592840">(</span><span class="ident" id="5592841">r</span><span class="op" id="5592842">,</span>&nbsp;<span class="ident" id="5592844">g</span><span class="op" id="5592845">.</span><span class="ident" id="5592846">class</span><span class="op" id="5592851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5592855">}</span>&nbsp;<span class="keyword" id="5592857">else</span>&nbsp;<span class="op" id="5592862">{</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5592867">r</span>&nbsp;<span class="op" id="5592869">=</span>&nbsp;<span class="ident" id="5592871">appendClass</span><span class="op" id="5592882">(</span><span class="ident" id="5592883">r</span><span class="op" id="5592884">,</span>&nbsp;<span class="ident" id="5592886">g</span><span class="op" id="5592887">.</span><span class="ident" id="5592888">class</span><span class="op" id="5592893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5592897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5592900">}</span>&nbsp;<span class="keyword" id="5592902">else</span>&nbsp;<span class="op" id="5592907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5592911">tmp</span>&nbsp;<span class="op" id="5592915">:=</span>&nbsp;<span class="ident" id="5592918">p</span><span class="op" id="5592919">.</span><span class="ident" id="5592920">tmpClass</span><span class="op" id="5592928">[</span><span class="op" id="5592929">:</span><span class="num" id="5592930">0</span><span class="op" id="5592931">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5592935">tmp</span>&nbsp;<span class="op" id="5592939">=</span>&nbsp;<span class="ident" id="5592941">appendFoldedClass</span><span class="op" id="5592958">(</span><span class="ident" id="5592959">tmp</span><span class="op" id="5592962">,</span>&nbsp;<span class="ident" id="5592964">g</span><span class="op" id="5592965">.</span><span class="ident" id="5592966">class</span><span class="op" id="5592971">)</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5592975">p</span><span class="op" id="5592976">.</span><span class="ident" id="5592977">tmpClass</span>&nbsp;<span class="op" id="5592986">=</span>&nbsp;<span class="ident" id="5592988">tmp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5592994">tmp</span>&nbsp;<span class="op" id="5592998">=</span>&nbsp;<span class="ident" id="5593000">cleanClass</span><span class="op" id="5593010">(</span><span class="op" id="5593011">&amp;</span><span class="ident" id="5593012">p</span><span class="op" id="5593013">.</span><span class="ident" id="5593014">tmpClass</span><span class="op" id="5593022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5593026">if</span>&nbsp;<span class="ident" id="5593029">g</span><span class="op" id="5593030">.</span><span class="ident" id="5593031">sign</span>&nbsp;<span class="op" id="5593036">&lt;</span>&nbsp;<span class="num" id="5593038">0</span>&nbsp;<span class="op" id="5593040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5593045">r</span>&nbsp;<span class="op" id="5593047">=</span>&nbsp;<span class="ident" id="5593049">appendNegatedClass</span><span class="op" id="5593067">(</span><span class="ident" id="5593068">r</span><span class="op" id="5593069">,</span>&nbsp;<span class="ident" id="5593071">tmp</span><span class="op" id="5593074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5593078">}</span>&nbsp;<span class="keyword" id="5593080">else</span>&nbsp;<span class="op" id="5593085">{</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5593090">r</span>&nbsp;<span class="op" id="5593092">=</span>&nbsp;<span class="ident" id="5593094">appendClass</span><span class="op" id="5593105">(</span><span class="ident" id="5593106">r</span><span class="op" id="5593107">,</span>&nbsp;<span class="ident" id="5593109">tmp</span><span class="op" id="5593112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5593116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5593119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5593122">return</span>&nbsp;<span class="ident" id="5593129">r</span><br>
<span class="lineno"></span><span class="op" id="5593131">}</span><br>
<span class="lineno">1420</span><br>
<span class="lineno"></span><span class="keyword" id="5593134">var</span>&nbsp;<span class="ident" id="5593138">anyTable</span>&nbsp;<span class="op" id="5593147">=</span>&nbsp;<span class="op" id="5593149">&amp;</span><span class="ident" id="5593150">unicode</span><span class="op" id="5593157">.</span><span class="ident" id="5593158">RangeTable</span><span class="op" id="5593168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5593171">R16</span><span class="op" id="5593174">:</span>&nbsp;<span class="op" id="5593176">[</span><span class="op" id="5593177">]</span><span class="ident" id="5593178">unicode</span><span class="op" id="5593185">.</span><span class="ident" id="5593186">Range16</span><span class="op" id="5593193">{</span><span class="op" id="5593194">{</span><span class="ident" id="5593195">Lo</span><span class="op" id="5593197">:</span>&nbsp;<span class="num" id="5593199">0</span><span class="op" id="5593200">,</span>&nbsp;<span class="ident" id="5593202">Hi</span><span class="op" id="5593204">:</span>&nbsp;<span class="num" id="5593206">1</span><span class="op" id="5593207">&lt;&lt;</span><span class="num" id="5593209">16</span>&nbsp;<span class="op" id="5593212">-</span>&nbsp;<span class="num" id="5593214">1</span><span class="op" id="5593215">,</span>&nbsp;<span class="ident" id="5593217">Stride</span><span class="op" id="5593223">:</span>&nbsp;<span class="num" id="5593225">1</span><span class="op" id="5593226">}</span><span class="op" id="5593227">}</span><span class="op" id="5593228">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5593231">R32</span><span class="op" id="5593234">:</span>&nbsp;<span class="op" id="5593236">[</span><span class="op" id="5593237">]</span><span class="ident" id="5593238">unicode</span><span class="op" id="5593245">.</span><span class="ident" id="5593246">Range32</span><span class="op" id="5593253">{</span><span class="op" id="5593254">{</span><span class="ident" id="5593255">Lo</span><span class="op" id="5593257">:</span>&nbsp;<span class="num" id="5593259">1</span>&nbsp;<span class="op" id="5593261">&lt;&lt;</span>&nbsp;<span class="num" id="5593264">16</span><span class="op" id="5593266">,</span>&nbsp;<span class="ident" id="5593268">Hi</span><span class="op" id="5593270">:</span>&nbsp;<span class="ident" id="5593272">unicode</span><span class="op" id="5593279">.</span><span class="ident" id="5593280">MaxRune</span><span class="op" id="5593287">,</span>&nbsp;<span class="ident" id="5593289">Stride</span><span class="op" id="5593295">:</span>&nbsp;<span class="num" id="5593297">1</span><span class="op" id="5593298">}</span><span class="op" id="5593299">}</span><span class="op" id="5593300">,</span><br>
<span class="lineno"></span><span class="op" id="5593302">}</span><br>
<span class="lineno">1425</span><br>
<span class="lineno"></span><span class="comment" id="5593305">//&nbsp;unicodeTable&nbsp;returns&nbsp;the&nbsp;unicode.RangeTable&nbsp;identified&nbsp;by&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5593371">//&nbsp;and&nbsp;the&nbsp;table&nbsp;of&nbsp;additional&nbsp;fold-equivalent&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="keyword" id="5593431">func</span>&nbsp;<span class="ident" id="5593436">unicodeTable</span><span class="op" id="5593448">(</span><span class="ident" id="5593449">name</span>&nbsp;<span class="builtintype" id="5593454">string</span><span class="op" id="5593460">)</span>&nbsp;<span class="op" id="5593462">(</span><span class="op" id="5593463">*</span><span class="ident" id="5593464">unicode</span><span class="op" id="5593471">.</span><span class="ident" id="5593472">RangeTable</span><span class="op" id="5593482">,</span>&nbsp;<span class="op" id="5593484">*</span><span class="ident" id="5593485">unicode</span><span class="op" id="5593492">.</span><span class="ident" id="5593493">RangeTable</span><span class="op" id="5593503">)</span>&nbsp;<span class="op" id="5593505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5593508">//&nbsp;Special&nbsp;case:&nbsp;&#34;Any&#34;&nbsp;means&nbsp;any.</span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5593543">if</span>&nbsp;<span class="ident" id="5593546">name</span>&nbsp;<span class="op" id="5593551">==</span>&nbsp;<span class="string" id="5593554">&#34;Any&#34;</span>&nbsp;<span class="op" id="5593560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5593564">return</span>&nbsp;<span class="ident" id="5593571">anyTable</span><span class="op" id="5593579">,</span>&nbsp;<span class="ident" id="5593581">anyTable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5593591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5593594">if</span>&nbsp;<span class="ident" id="5593597">t</span>&nbsp;<span class="op" id="5593599">:=</span>&nbsp;<span class="ident" id="5593602">unicode</span><span class="op" id="5593609">.</span><span class="ident" id="5593610">Categories</span><span class="op" id="5593620">[</span><span class="ident" id="5593621">name</span><span class="op" id="5593625">]</span><span class="op" id="5593626">;</span>&nbsp;<span class="ident" id="5593628">t</span>&nbsp;<span class="op" id="5593630">!=</span>&nbsp;<span class="ident" id="5593633">nil</span>&nbsp;<span class="op" id="5593637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5593641">return</span>&nbsp;<span class="ident" id="5593648">t</span><span class="op" id="5593649">,</span>&nbsp;<span class="ident" id="5593651">unicode</span><span class="op" id="5593658">.</span><span class="ident" id="5593659">FoldCategory</span><span class="op" id="5593671">[</span><span class="ident" id="5593672">name</span><span class="op" id="5593676">]</span><br>
<span class="lineno">1435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5593679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5593682">if</span>&nbsp;<span class="ident" id="5593685">t</span>&nbsp;<span class="op" id="5593687">:=</span>&nbsp;<span class="ident" id="5593690">unicode</span><span class="op" id="5593697">.</span><span class="ident" id="5593698">Scripts</span><span class="op" id="5593705">[</span><span class="ident" id="5593706">name</span><span class="op" id="5593710">]</span><span class="op" id="5593711">;</span>&nbsp;<span class="ident" id="5593713">t</span>&nbsp;<span class="op" id="5593715">!=</span>&nbsp;<span class="ident" id="5593718">nil</span>&nbsp;<span class="op" id="5593722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5593726">return</span>&nbsp;<span class="ident" id="5593733">t</span><span class="op" id="5593734">,</span>&nbsp;<span class="ident" id="5593736">unicode</span><span class="op" id="5593743">.</span><span class="ident" id="5593744">FoldScript</span><span class="op" id="5593754">[</span><span class="ident" id="5593755">name</span><span class="op" id="5593759">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5593762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5593765">return</span>&nbsp;<span class="ident" id="5593772">nil</span><span class="op" id="5593775">,</span>&nbsp;<span class="ident" id="5593777">nil</span><br>
<span class="lineno">1440</span><span class="op" id="5593781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5593784">//&nbsp;parseUnicodeClass&nbsp;parses&nbsp;a&nbsp;leading&nbsp;Unicode&nbsp;character&nbsp;class&nbsp;like&nbsp;\p{Han}</span><br>
<span class="lineno"></span><span class="comment" id="5593859">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="5593938">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno">1445</span><span class="keyword" id="5594002">func</span>&nbsp;<span class="op" id="5594007">(</span><span class="ident" id="5594008">p</span>&nbsp;<span class="op" id="5594010">*</span><span class="ident" id="5594011">parser</span><span class="op" id="5594017">)</span>&nbsp;<span class="ident" id="5594019">parseUnicodeClass</span><span class="op" id="5594036">(</span><span class="ident" id="5594037">s</span>&nbsp;<span class="builtintype" id="5594039">string</span><span class="op" id="5594045">,</span>&nbsp;<span class="ident" id="5594047">r</span>&nbsp;<span class="op" id="5594049">[</span><span class="op" id="5594050">]</span><span class="builtintype" id="5594051">rune</span><span class="op" id="5594055">)</span>&nbsp;<span class="op" id="5594057">(</span><span class="ident" id="5594058">out</span>&nbsp;<span class="op" id="5594062">[</span><span class="op" id="5594063">]</span><span class="builtintype" id="5594064">rune</span><span class="op" id="5594068">,</span>&nbsp;<span class="ident" id="5594070">rest</span>&nbsp;<span class="builtintype" id="5594075">string</span><span class="op" id="5594081">,</span>&nbsp;<span class="ident" id="5594083">err</span>&nbsp;<span class="builtintype" id="5594087">error</span><span class="op" id="5594092">)</span>&nbsp;<span class="op" id="5594094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5594097">if</span>&nbsp;<span class="ident" id="5594100">p</span><span class="op" id="5594101">.</span><span class="ident" id="5594102">flags</span><span class="op" id="5594107">&amp;</span><span class="ident" id="5594108">UnicodeGroups</span>&nbsp;<span class="op" id="5594122">==</span>&nbsp;<span class="num" id="5594125">0</span>&nbsp;<span class="op" id="5594127">||</span>&nbsp;<span class="builtinfunc" id="5594130">len</span><span class="op" id="5594133">(</span><span class="ident" id="5594134">s</span><span class="op" id="5594135">)</span>&nbsp;<span class="op" id="5594137">&lt;</span>&nbsp;<span class="num" id="5594139">2</span>&nbsp;<span class="op" id="5594141">||</span>&nbsp;<span class="ident" id="5594144">s</span><span class="op" id="5594145">[</span><span class="num" id="5594146">0</span><span class="op" id="5594147">]</span>&nbsp;<span class="op" id="5594149">!=</span>&nbsp;<span class="string" id="5594152">&#39;\\&#39;</span>&nbsp;<span class="op" id="5594157">||</span>&nbsp;<span class="ident" id="5594160">s</span><span class="op" id="5594161">[</span><span class="num" id="5594162">1</span><span class="op" id="5594163">]</span>&nbsp;<span class="op" id="5594165">!=</span>&nbsp;<span class="string" id="5594168">&#39;p&#39;</span>&nbsp;<span class="op" id="5594172">&amp;&amp;</span>&nbsp;<span class="ident" id="5594175">s</span><span class="op" id="5594176">[</span><span class="num" id="5594177">1</span><span class="op" id="5594178">]</span>&nbsp;<span class="op" id="5594180">!=</span>&nbsp;<span class="string" id="5594183">&#39;P&#39;</span>&nbsp;<span class="op" id="5594187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5594191">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5594199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5594203">//&nbsp;Committed&nbsp;to&nbsp;parse&nbsp;or&nbsp;return&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5594243">sign</span>&nbsp;<span class="op" id="5594248">:=</span>&nbsp;<span class="op" id="5594251">+</span><span class="num" id="5594252">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5594255">if</span>&nbsp;<span class="ident" id="5594258">s</span><span class="op" id="5594259">[</span><span class="num" id="5594260">1</span><span class="op" id="5594261">]</span>&nbsp;<span class="op" id="5594263">==</span>&nbsp;<span class="string" id="5594266">&#39;P&#39;</span>&nbsp;<span class="op" id="5594270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5594274">sign</span>&nbsp;<span class="op" id="5594279">=</span>&nbsp;<span class="op" id="5594281">-</span><span class="num" id="5594282">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5594285">}</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5594288">t</span>&nbsp;<span class="op" id="5594290">:=</span>&nbsp;<span class="ident" id="5594293">s</span><span class="op" id="5594294">[</span><span class="num" id="5594295">2</span><span class="op" id="5594296">:</span><span class="op" id="5594297">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5594300">c</span><span class="op" id="5594301">,</span>&nbsp;<span class="ident" id="5594303">t</span><span class="op" id="5594304">,</span>&nbsp;<span class="ident" id="5594306">err</span>&nbsp;<span class="op" id="5594310">:=</span>&nbsp;<span class="ident" id="5594313">nextRune</span><span class="op" id="5594321">(</span><span class="ident" id="5594322">t</span><span class="op" id="5594323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5594326">if</span>&nbsp;<span class="ident" id="5594329">err</span>&nbsp;<span class="op" id="5594333">!=</span>&nbsp;<span class="ident" id="5594336">nil</span>&nbsp;<span class="op" id="5594340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5594344">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5594352">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5594355">var</span>&nbsp;<span class="ident" id="5594359">seq</span><span class="op" id="5594362">,</span>&nbsp;<span class="ident" id="5594364">name</span>&nbsp;<span class="builtintype" id="5594369">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5594377">if</span>&nbsp;<span class="ident" id="5594380">c</span>&nbsp;<span class="op" id="5594382">!=</span>&nbsp;<span class="string" id="5594385">&#39;{&#39;</span>&nbsp;<span class="op" id="5594389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5594393">//&nbsp;Single-letter&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5594418">seq</span>&nbsp;<span class="op" id="5594422">=</span>&nbsp;<span class="ident" id="5594424">s</span><span class="op" id="5594425">[</span><span class="op" id="5594426">:</span><span class="builtinfunc" id="5594427">len</span><span class="op" id="5594430">(</span><span class="ident" id="5594431">s</span><span class="op" id="5594432">)</span><span class="op" id="5594433">-</span><span class="builtinfunc" id="5594434">len</span><span class="op" id="5594437">(</span><span class="ident" id="5594438">t</span><span class="op" id="5594439">)</span><span class="op" id="5594440">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5594444">name</span>&nbsp;<span class="op" id="5594449">=</span>&nbsp;<span class="ident" id="5594451">seq</span><span class="op" id="5594454">[</span><span class="num" id="5594455">2</span><span class="op" id="5594456">:</span><span class="op" id="5594457">]</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5594460">}</span>&nbsp;<span class="keyword" id="5594462">else</span>&nbsp;<span class="op" id="5594467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5594471">//&nbsp;Name&nbsp;is&nbsp;in&nbsp;braces.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5594495">end</span>&nbsp;<span class="op" id="5594499">:=</span>&nbsp;<span class="ident" id="5594502">strings</span><span class="op" id="5594509">.</span><span class="ident" id="5594510">IndexRune</span><span class="op" id="5594519">(</span><span class="ident" id="5594520">s</span><span class="op" id="5594521">,</span>&nbsp;<span class="string" id="5594523">&#39;}&#39;</span><span class="op" id="5594526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5594530">if</span>&nbsp;<span class="ident" id="5594533">end</span>&nbsp;<span class="op" id="5594537">&lt;</span>&nbsp;<span class="num" id="5594539">0</span>&nbsp;<span class="op" id="5594541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5594546">if</span>&nbsp;<span class="ident" id="5594549">err</span>&nbsp;<span class="op" id="5594553">=</span>&nbsp;<span class="ident" id="5594555">checkUTF8</span><span class="op" id="5594564">(</span><span class="ident" id="5594565">s</span><span class="op" id="5594566">)</span><span class="op" id="5594567">;</span>&nbsp;<span class="ident" id="5594569">err</span>&nbsp;<span class="op" id="5594573">!=</span>&nbsp;<span class="ident" id="5594576">nil</span>&nbsp;<span class="op" id="5594580">{</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5594586">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5594596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5594601">return</span>&nbsp;<span class="ident" id="5594608">nil</span><span class="op" id="5594611">,</span>&nbsp;<span class="string" id="5594613">&#34;&#34;</span><span class="op" id="5594615">,</span>&nbsp;<span class="op" id="5594617">&amp;</span><span class="ident" id="5594618">Error</span><span class="op" id="5594623">{</span><span class="ident" id="5594624">ErrInvalidCharRange</span><span class="op" id="5594643">,</span>&nbsp;<span class="ident" id="5594645">s</span><span class="op" id="5594646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5594650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5594654">seq</span><span class="op" id="5594657">,</span>&nbsp;<span class="ident" id="5594659">t</span>&nbsp;<span class="op" id="5594661">=</span>&nbsp;<span class="ident" id="5594663">s</span><span class="op" id="5594664">[</span><span class="op" id="5594665">:</span><span class="ident" id="5594666">end</span><span class="op" id="5594669">+</span><span class="num" id="5594670">1</span><span class="op" id="5594671">]</span><span class="op" id="5594672">,</span>&nbsp;<span class="ident" id="5594674">s</span><span class="op" id="5594675">[</span><span class="ident" id="5594676">end</span><span class="op" id="5594679">+</span><span class="num" id="5594680">1</span><span class="op" id="5594681">:</span><span class="op" id="5594682">]</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5594686">name</span>&nbsp;<span class="op" id="5594691">=</span>&nbsp;<span class="ident" id="5594693">s</span><span class="op" id="5594694">[</span><span class="num" id="5594695">3</span><span class="op" id="5594696">:</span><span class="ident" id="5594697">end</span><span class="op" id="5594700">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5594704">if</span>&nbsp;<span class="ident" id="5594707">err</span>&nbsp;<span class="op" id="5594711">=</span>&nbsp;<span class="ident" id="5594713">checkUTF8</span><span class="op" id="5594722">(</span><span class="ident" id="5594723">name</span><span class="op" id="5594727">)</span><span class="op" id="5594728">;</span>&nbsp;<span class="ident" id="5594730">err</span>&nbsp;<span class="op" id="5594734">!=</span>&nbsp;<span class="ident" id="5594737">nil</span>&nbsp;<span class="op" id="5594741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5594746">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5594755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5594758">}</span><br>
<span class="lineno">1480</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5594762">//&nbsp;Group&nbsp;can&nbsp;have&nbsp;leading&nbsp;negation&nbsp;too.&nbsp;&nbsp;\p{^Han}&nbsp;==&nbsp;\P{Han},&nbsp;\P{^Han}&nbsp;==&nbsp;\p{Han}.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5594846">if</span>&nbsp;<span class="ident" id="5594849">name</span>&nbsp;<span class="op" id="5594854">!=</span>&nbsp;<span class="string" id="5594857">&#34;&#34;</span>&nbsp;<span class="op" id="5594860">&amp;&amp;</span>&nbsp;<span class="ident" id="5594863">name</span><span class="op" id="5594867">[</span><span class="num" id="5594868">0</span><span class="op" id="5594869">]</span>&nbsp;<span class="op" id="5594871">==</span>&nbsp;<span class="string" id="5594874">&#39;^&#39;</span>&nbsp;<span class="op" id="5594878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5594882">sign</span>&nbsp;<span class="op" id="5594887">=</span>&nbsp;<span class="op" id="5594889">-</span><span class="ident" id="5594890">sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5594897">name</span>&nbsp;<span class="op" id="5594902">=</span>&nbsp;<span class="ident" id="5594904">name</span><span class="op" id="5594908">[</span><span class="num" id="5594909">1</span><span class="op" id="5594910">:</span><span class="op" id="5594911">]</span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5594914">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5594918">tab</span><span class="op" id="5594921">,</span>&nbsp;<span class="ident" id="5594923">fold</span>&nbsp;<span class="op" id="5594928">:=</span>&nbsp;<span class="ident" id="5594931">unicodeTable</span><span class="op" id="5594943">(</span><span class="ident" id="5594944">name</span><span class="op" id="5594948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5594951">if</span>&nbsp;<span class="ident" id="5594954">tab</span>&nbsp;<span class="op" id="5594958">==</span>&nbsp;<span class="ident" id="5594961">nil</span>&nbsp;<span class="op" id="5594965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5594969">return</span>&nbsp;<span class="ident" id="5594976">nil</span><span class="op" id="5594979">,</span>&nbsp;<span class="string" id="5594981">&#34;&#34;</span><span class="op" id="5594983">,</span>&nbsp;<span class="op" id="5594985">&amp;</span><span class="ident" id="5594986">Error</span><span class="op" id="5594991">{</span><span class="ident" id="5594992">ErrInvalidCharRange</span><span class="op" id="5595011">,</span>&nbsp;<span class="ident" id="5595013">seq</span><span class="op" id="5595016">}</span><br>
<span class="lineno">1490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5595019">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595023">if</span>&nbsp;<span class="ident" id="5595026">p</span><span class="op" id="5595027">.</span><span class="ident" id="5595028">flags</span><span class="op" id="5595033">&amp;</span><span class="ident" id="5595034">FoldCase</span>&nbsp;<span class="op" id="5595043">==</span>&nbsp;<span class="num" id="5595046">0</span>&nbsp;<span class="op" id="5595048">||</span>&nbsp;<span class="ident" id="5595051">fold</span>&nbsp;<span class="op" id="5595056">==</span>&nbsp;<span class="ident" id="5595059">nil</span>&nbsp;<span class="op" id="5595063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595067">if</span>&nbsp;<span class="ident" id="5595070">sign</span>&nbsp;<span class="op" id="5595075">&gt;</span>&nbsp;<span class="num" id="5595077">0</span>&nbsp;<span class="op" id="5595079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595084">r</span>&nbsp;<span class="op" id="5595086">=</span>&nbsp;<span class="ident" id="5595088">appendTable</span><span class="op" id="5595099">(</span><span class="ident" id="5595100">r</span><span class="op" id="5595101">,</span>&nbsp;<span class="ident" id="5595103">tab</span><span class="op" id="5595106">)</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5595110">}</span>&nbsp;<span class="keyword" id="5595112">else</span>&nbsp;<span class="op" id="5595117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595122">r</span>&nbsp;<span class="op" id="5595124">=</span>&nbsp;<span class="ident" id="5595126">appendNegatedTable</span><span class="op" id="5595144">(</span><span class="ident" id="5595145">r</span><span class="op" id="5595146">,</span>&nbsp;<span class="ident" id="5595148">tab</span><span class="op" id="5595151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5595155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5595158">}</span>&nbsp;<span class="keyword" id="5595160">else</span>&nbsp;<span class="op" id="5595165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5595169">//&nbsp;Merge&nbsp;and&nbsp;clean&nbsp;tab&nbsp;and&nbsp;fold&nbsp;in&nbsp;a&nbsp;temporary&nbsp;buffer.</span><br>
<span class="lineno">1500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5595226">//&nbsp;This&nbsp;is&nbsp;necessary&nbsp;for&nbsp;the&nbsp;negative&nbsp;case&nbsp;and&nbsp;just&nbsp;tidy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5595285">//&nbsp;for&nbsp;the&nbsp;positive&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595313">tmp</span>&nbsp;<span class="op" id="5595317">:=</span>&nbsp;<span class="ident" id="5595320">p</span><span class="op" id="5595321">.</span><span class="ident" id="5595322">tmpClass</span><span class="op" id="5595330">[</span><span class="op" id="5595331">:</span><span class="num" id="5595332">0</span><span class="op" id="5595333">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595337">tmp</span>&nbsp;<span class="op" id="5595341">=</span>&nbsp;<span class="ident" id="5595343">appendTable</span><span class="op" id="5595354">(</span><span class="ident" id="5595355">tmp</span><span class="op" id="5595358">,</span>&nbsp;<span class="ident" id="5595360">tab</span><span class="op" id="5595363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595367">tmp</span>&nbsp;<span class="op" id="5595371">=</span>&nbsp;<span class="ident" id="5595373">appendTable</span><span class="op" id="5595384">(</span><span class="ident" id="5595385">tmp</span><span class="op" id="5595388">,</span>&nbsp;<span class="ident" id="5595390">fold</span><span class="op" id="5595394">)</span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595398">p</span><span class="op" id="5595399">.</span><span class="ident" id="5595400">tmpClass</span>&nbsp;<span class="op" id="5595409">=</span>&nbsp;<span class="ident" id="5595411">tmp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595417">tmp</span>&nbsp;<span class="op" id="5595421">=</span>&nbsp;<span class="ident" id="5595423">cleanClass</span><span class="op" id="5595433">(</span><span class="op" id="5595434">&amp;</span><span class="ident" id="5595435">p</span><span class="op" id="5595436">.</span><span class="ident" id="5595437">tmpClass</span><span class="op" id="5595445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595449">if</span>&nbsp;<span class="ident" id="5595452">sign</span>&nbsp;<span class="op" id="5595457">&gt;</span>&nbsp;<span class="num" id="5595459">0</span>&nbsp;<span class="op" id="5595461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595466">r</span>&nbsp;<span class="op" id="5595468">=</span>&nbsp;<span class="ident" id="5595470">appendClass</span><span class="op" id="5595481">(</span><span class="ident" id="5595482">r</span><span class="op" id="5595483">,</span>&nbsp;<span class="ident" id="5595485">tmp</span><span class="op" id="5595488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5595492">}</span>&nbsp;<span class="keyword" id="5595494">else</span>&nbsp;<span class="op" id="5595499">{</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595504">r</span>&nbsp;<span class="op" id="5595506">=</span>&nbsp;<span class="ident" id="5595508">appendNegatedClass</span><span class="op" id="5595526">(</span><span class="ident" id="5595527">r</span><span class="op" id="5595528">,</span>&nbsp;<span class="ident" id="5595530">tmp</span><span class="op" id="5595533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5595537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5595540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595543">return</span>&nbsp;<span class="ident" id="5595550">r</span><span class="op" id="5595551">,</span>&nbsp;<span class="ident" id="5595553">t</span><span class="op" id="5595554">,</span>&nbsp;<span class="ident" id="5595556">nil</span><br>
<span class="lineno"></span><span class="op" id="5595560">}</span><br>
<span class="lineno">1515</span><br>
<span class="lineno"></span><span class="comment" id="5595563">//&nbsp;parseClass&nbsp;parses&nbsp;a&nbsp;character&nbsp;class&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="5595624">//&nbsp;and&nbsp;pushes&nbsp;it&nbsp;onto&nbsp;the&nbsp;parse&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="5595663">func</span>&nbsp;<span class="op" id="5595668">(</span><span class="ident" id="5595669">p</span>&nbsp;<span class="op" id="5595671">*</span><span class="ident" id="5595672">parser</span><span class="op" id="5595678">)</span>&nbsp;<span class="ident" id="5595680">parseClass</span><span class="op" id="5595690">(</span><span class="ident" id="5595691">s</span>&nbsp;<span class="builtintype" id="5595693">string</span><span class="op" id="5595699">)</span>&nbsp;<span class="op" id="5595701">(</span><span class="ident" id="5595702">rest</span>&nbsp;<span class="builtintype" id="5595707">string</span><span class="op" id="5595713">,</span>&nbsp;<span class="ident" id="5595715">err</span>&nbsp;<span class="builtintype" id="5595719">error</span><span class="op" id="5595724">)</span>&nbsp;<span class="op" id="5595726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595729">t</span>&nbsp;<span class="op" id="5595731">:=</span>&nbsp;<span class="ident" id="5595734">s</span><span class="op" id="5595735">[</span><span class="num" id="5595736">1</span><span class="op" id="5595737">:</span><span class="op" id="5595738">]</span>&nbsp;<span class="comment" id="5595740">//&nbsp;chop&nbsp;[</span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595751">re</span>&nbsp;<span class="op" id="5595754">:=</span>&nbsp;<span class="ident" id="5595757">p</span><span class="op" id="5595758">.</span><span class="ident" id="5595759">newRegexp</span><span class="op" id="5595768">(</span><span class="ident" id="5595769">OpCharClass</span><span class="op" id="5595780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595783">re</span><span class="op" id="5595785">.</span><span class="ident" id="5595786">Flags</span>&nbsp;<span class="op" id="5595792">=</span>&nbsp;<span class="ident" id="5595794">p</span><span class="op" id="5595795">.</span><span class="ident" id="5595796">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595803">re</span><span class="op" id="5595805">.</span><span class="ident" id="5595806">Rune</span>&nbsp;<span class="op" id="5595811">=</span>&nbsp;<span class="ident" id="5595813">re</span><span class="op" id="5595815">.</span><span class="ident" id="5595816">Rune0</span><span class="op" id="5595821">[</span><span class="op" id="5595822">:</span><span class="num" id="5595823">0</span><span class="op" id="5595824">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595828">sign</span>&nbsp;<span class="op" id="5595833">:=</span>&nbsp;<span class="op" id="5595836">+</span><span class="num" id="5595837">1</span><br>
<span class="lineno">1525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5595840">if</span>&nbsp;<span class="ident" id="5595843">t</span>&nbsp;<span class="op" id="5595845">!=</span>&nbsp;<span class="string" id="5595848">&#34;&#34;</span>&nbsp;<span class="op" id="5595851">&amp;&amp;</span>&nbsp;<span class="ident" id="5595854">t</span><span class="op" id="5595855">[</span><span class="num" id="5595856">0</span><span class="op" id="5595857">]</span>&nbsp;<span class="op" id="5595859">==</span>&nbsp;<span class="string" id="5595862">&#39;^&#39;</span>&nbsp;<span class="op" id="5595866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595870">sign</span>&nbsp;<span class="op" id="5595875">=</span>&nbsp;<span class="op" id="5595877">-</span><span class="num" id="5595878">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5595882">t</span>&nbsp;<span class="op" id="5595884">=</span>&nbsp;<span class="ident" id="5595886">t</span><span class="op" id="5595887">[</span><span class="num" id="5595888">1</span><span class="op" id="5595889">:</span><span class="op" id="5595890">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5595895">//&nbsp;If&nbsp;character&nbsp;class&nbsp;does&nbsp;not&nbsp;match&nbsp;\n,&nbsp;add&nbsp;it&nbsp;here,</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5595951">//&nbsp;so&nbsp;that&nbsp;negation&nbsp;later&nbsp;will&nbsp;do&nbsp;the&nbsp;right&nbsp;thing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596004">if</span>&nbsp;<span class="ident" id="5596007">p</span><span class="op" id="5596008">.</span><span class="ident" id="5596009">flags</span><span class="op" id="5596014">&amp;</span><span class="ident" id="5596015">ClassNL</span>&nbsp;<span class="op" id="5596023">==</span>&nbsp;<span class="num" id="5596026">0</span>&nbsp;<span class="op" id="5596028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5596033">re</span><span class="op" id="5596035">.</span><span class="ident" id="5596036">Rune</span>&nbsp;<span class="op" id="5596041">=</span>&nbsp;<span class="builtinfunc" id="5596043">append</span><span class="op" id="5596049">(</span><span class="ident" id="5596050">re</span><span class="op" id="5596052">.</span><span class="ident" id="5596053">Rune</span><span class="op" id="5596057">,</span>&nbsp;<span class="string" id="5596059">&#39;\n&#39;</span><span class="op" id="5596063">,</span>&nbsp;<span class="string" id="5596065">&#39;\n&#39;</span><span class="op" id="5596069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5596073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5596076">}</span><br>
<span class="lineno">1535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5596080">class</span>&nbsp;<span class="op" id="5596086">:=</span>&nbsp;<span class="ident" id="5596089">re</span><span class="op" id="5596091">.</span><span class="ident" id="5596092">Rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5596098">first</span>&nbsp;<span class="op" id="5596104">:=</span>&nbsp;<span class="builtintype" id="5596107">true</span>&nbsp;<span class="comment" id="5596112">//&nbsp;]&nbsp;and&nbsp;-&nbsp;are&nbsp;okay&nbsp;as&nbsp;first&nbsp;char&nbsp;in&nbsp;class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596156">for</span>&nbsp;<span class="ident" id="5596160">t</span>&nbsp;<span class="op" id="5596162">==</span>&nbsp;<span class="string" id="5596165">&#34;&#34;</span>&nbsp;<span class="op" id="5596168">||</span>&nbsp;<span class="ident" id="5596171">t</span><span class="op" id="5596172">[</span><span class="num" id="5596173">0</span><span class="op" id="5596174">]</span>&nbsp;<span class="op" id="5596176">!=</span>&nbsp;<span class="string" id="5596179">&#39;]&#39;</span>&nbsp;<span class="op" id="5596183">||</span>&nbsp;<span class="ident" id="5596186">first</span>&nbsp;<span class="op" id="5596192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5596196">//&nbsp;POSIX:&nbsp;-&nbsp;is&nbsp;only&nbsp;okay&nbsp;unescaped&nbsp;as&nbsp;first&nbsp;or&nbsp;last&nbsp;in&nbsp;class.</span><br>
<span class="lineno">1540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5596260">//&nbsp;Perl:&nbsp;-&nbsp;is&nbsp;okay&nbsp;anywhere.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596291">if</span>&nbsp;<span class="ident" id="5596294">t</span>&nbsp;<span class="op" id="5596296">!=</span>&nbsp;<span class="string" id="5596299">&#34;&#34;</span>&nbsp;<span class="op" id="5596302">&amp;&amp;</span>&nbsp;<span class="ident" id="5596305">t</span><span class="op" id="5596306">[</span><span class="num" id="5596307">0</span><span class="op" id="5596308">]</span>&nbsp;<span class="op" id="5596310">==</span>&nbsp;<span class="string" id="5596313">&#39;-&#39;</span>&nbsp;<span class="op" id="5596317">&amp;&amp;</span>&nbsp;<span class="ident" id="5596320">p</span><span class="op" id="5596321">.</span><span class="ident" id="5596322">flags</span><span class="op" id="5596327">&amp;</span><span class="ident" id="5596328">PerlX</span>&nbsp;<span class="op" id="5596334">==</span>&nbsp;<span class="num" id="5596337">0</span>&nbsp;<span class="op" id="5596339">&amp;&amp;</span>&nbsp;<span class="op" id="5596342">!</span><span class="ident" id="5596343">first</span>&nbsp;<span class="op" id="5596349">&amp;&amp;</span>&nbsp;<span class="op" id="5596352">(</span><span class="builtinfunc" id="5596353">len</span><span class="op" id="5596356">(</span><span class="ident" id="5596357">t</span><span class="op" id="5596358">)</span>&nbsp;<span class="op" id="5596360">==</span>&nbsp;<span class="num" id="5596363">1</span>&nbsp;<span class="op" id="5596365">||</span>&nbsp;<span class="ident" id="5596368">t</span><span class="op" id="5596369">[</span><span class="num" id="5596370">1</span><span class="op" id="5596371">]</span>&nbsp;<span class="op" id="5596373">!=</span>&nbsp;<span class="string" id="5596376">&#39;]&#39;</span><span class="op" id="5596379">)</span>&nbsp;<span class="op" id="5596381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5596386">_</span><span class="op" id="5596387">,</span>&nbsp;<span class="ident" id="5596389">size</span>&nbsp;<span class="op" id="5596394">:=</span>&nbsp;<span class="ident" id="5596397">utf8</span><span class="op" id="5596401">.</span><span class="ident" id="5596402">DecodeRuneInString</span><span class="op" id="5596420">(</span><span class="ident" id="5596421">t</span><span class="op" id="5596422">[</span><span class="num" id="5596423">1</span><span class="op" id="5596424">:</span><span class="op" id="5596425">]</span><span class="op" id="5596426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596431">return</span>&nbsp;<span class="string" id="5596438">&#34;&#34;</span><span class="op" id="5596440">,</span>&nbsp;<span class="op" id="5596442">&amp;</span><span class="ident" id="5596443">Error</span><span class="op" id="5596448">{</span><span class="ident" id="5596449">Code</span><span class="op" id="5596453">:</span>&nbsp;<span class="ident" id="5596455">ErrInvalidCharRange</span><span class="op" id="5596474">,</span>&nbsp;<span class="ident" id="5596476">Expr</span><span class="op" id="5596480">:</span>&nbsp;<span class="ident" id="5596482">t</span><span class="op" id="5596483">[</span><span class="op" id="5596484">:</span><span class="num" id="5596485">1</span><span class="op" id="5596486">+</span><span class="ident" id="5596487">size</span><span class="op" id="5596491">]</span><span class="op" id="5596492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5596496">}</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5596500">first</span>&nbsp;<span class="op" id="5596506">=</span>&nbsp;<span class="builtintype" id="5596508">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5596517">//&nbsp;Look&nbsp;for&nbsp;POSIX&nbsp;[:alnum:]&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596552">if</span>&nbsp;<span class="builtinfunc" id="5596555">len</span><span class="op" id="5596558">(</span><span class="ident" id="5596559">t</span><span class="op" id="5596560">)</span>&nbsp;<span class="op" id="5596562">&gt;</span>&nbsp;<span class="num" id="5596564">2</span>&nbsp;<span class="op" id="5596566">&amp;&amp;</span>&nbsp;<span class="ident" id="5596569">t</span><span class="op" id="5596570">[</span><span class="num" id="5596571">0</span><span class="op" id="5596572">]</span>&nbsp;<span class="op" id="5596574">==</span>&nbsp;<span class="string" id="5596577">&#39;[&#39;</span>&nbsp;<span class="op" id="5596581">&amp;&amp;</span>&nbsp;<span class="ident" id="5596584">t</span><span class="op" id="5596585">[</span><span class="num" id="5596586">1</span><span class="op" id="5596587">]</span>&nbsp;<span class="op" id="5596589">==</span>&nbsp;<span class="string" id="5596592">&#39;:&#39;</span>&nbsp;<span class="op" id="5596596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5596601">nclass</span><span class="op" id="5596607">,</span>&nbsp;<span class="ident" id="5596609">nt</span><span class="op" id="5596611">,</span>&nbsp;<span class="ident" id="5596613">err</span>&nbsp;<span class="op" id="5596617">:=</span>&nbsp;<span class="ident" id="5596620">p</span><span class="op" id="5596621">.</span><span class="ident" id="5596622">parseNamedClass</span><span class="op" id="5596637">(</span><span class="ident" id="5596638">t</span><span class="op" id="5596639">,</span>&nbsp;<span class="ident" id="5596641">class</span><span class="op" id="5596646">)</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596651">if</span>&nbsp;<span class="ident" id="5596654">err</span>&nbsp;<span class="op" id="5596658">!=</span>&nbsp;<span class="ident" id="5596661">nil</span>&nbsp;<span class="op" id="5596665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596671">return</span>&nbsp;<span class="string" id="5596678">&#34;&#34;</span><span class="op" id="5596680">,</span>&nbsp;<span class="ident" id="5596682">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5596689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596694">if</span>&nbsp;<span class="ident" id="5596697">nclass</span>&nbsp;<span class="op" id="5596704">!=</span>&nbsp;<span class="ident" id="5596707">nil</span>&nbsp;<span class="op" id="5596711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5596717">class</span><span class="op" id="5596722">,</span>&nbsp;<span class="ident" id="5596724">t</span>&nbsp;<span class="op" id="5596726">=</span>&nbsp;<span class="ident" id="5596728">nclass</span><span class="op" id="5596734">,</span>&nbsp;<span class="ident" id="5596736">nt</span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596743">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5596755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5596759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5596764">//&nbsp;Look&nbsp;for&nbsp;Unicode&nbsp;character&nbsp;group&nbsp;like&nbsp;\p{Han}.</span><br>
<span class="lineno">1560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5596816">nclass</span><span class="op" id="5596822">,</span>&nbsp;<span class="ident" id="5596824">nt</span><span class="op" id="5596826">,</span>&nbsp;<span class="ident" id="5596828">err</span>&nbsp;<span class="op" id="5596832">:=</span>&nbsp;<span class="ident" id="5596835">p</span><span class="op" id="5596836">.</span><span class="ident" id="5596837">parseUnicodeClass</span><span class="op" id="5596854">(</span><span class="ident" id="5596855">t</span><span class="op" id="5596856">,</span>&nbsp;<span class="ident" id="5596858">class</span><span class="op" id="5596863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596867">if</span>&nbsp;<span class="ident" id="5596870">err</span>&nbsp;<span class="op" id="5596874">!=</span>&nbsp;<span class="ident" id="5596877">nil</span>&nbsp;<span class="op" id="5596881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596886">return</span>&nbsp;<span class="string" id="5596893">&#34;&#34;</span><span class="op" id="5596895">,</span>&nbsp;<span class="ident" id="5596897">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5596903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596907">if</span>&nbsp;<span class="ident" id="5596910">nclass</span>&nbsp;<span class="op" id="5596917">!=</span>&nbsp;<span class="ident" id="5596920">nil</span>&nbsp;<span class="op" id="5596924">{</span><br>
<span class="lineno">1565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5596929">class</span><span class="op" id="5596934">,</span>&nbsp;<span class="ident" id="5596936">t</span>&nbsp;<span class="op" id="5596938">=</span>&nbsp;<span class="ident" id="5596940">nclass</span><span class="op" id="5596946">,</span>&nbsp;<span class="ident" id="5596948">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5596954">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5596965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5596970">//&nbsp;Look&nbsp;for&nbsp;Perl&nbsp;character&nbsp;class&nbsp;symbols&nbsp;(extension).</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597026">if</span>&nbsp;<span class="ident" id="5597029">nclass</span><span class="op" id="5597035">,</span>&nbsp;<span class="ident" id="5597037">nt</span>&nbsp;<span class="op" id="5597040">:=</span>&nbsp;<span class="ident" id="5597043">p</span><span class="op" id="5597044">.</span><span class="ident" id="5597045">parsePerlClassEscape</span><span class="op" id="5597065">(</span><span class="ident" id="5597066">t</span><span class="op" id="5597067">,</span>&nbsp;<span class="ident" id="5597069">class</span><span class="op" id="5597074">)</span><span class="op" id="5597075">;</span>&nbsp;<span class="ident" id="5597077">nclass</span>&nbsp;<span class="op" id="5597084">!=</span>&nbsp;<span class="ident" id="5597087">nil</span>&nbsp;<span class="op" id="5597091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597096">class</span><span class="op" id="5597101">,</span>&nbsp;<span class="ident" id="5597103">t</span>&nbsp;<span class="op" id="5597105">=</span>&nbsp;<span class="ident" id="5597107">nclass</span><span class="op" id="5597113">,</span>&nbsp;<span class="ident" id="5597115">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597121">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5597132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5597137">//&nbsp;Single&nbsp;character&nbsp;or&nbsp;simple&nbsp;range.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597176">rng</span>&nbsp;<span class="op" id="5597180">:=</span>&nbsp;<span class="ident" id="5597183">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597187">var</span>&nbsp;<span class="ident" id="5597191">lo</span><span class="op" id="5597193">,</span>&nbsp;<span class="ident" id="5597195">hi</span>&nbsp;<span class="builtintype" id="5597198">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597205">if</span>&nbsp;<span class="ident" id="5597208">lo</span><span class="op" id="5597210">,</span>&nbsp;<span class="ident" id="5597212">t</span><span class="op" id="5597213">,</span>&nbsp;<span class="ident" id="5597215">err</span>&nbsp;<span class="op" id="5597219">=</span>&nbsp;<span class="ident" id="5597221">p</span><span class="op" id="5597222">.</span><span class="ident" id="5597223">parseClassChar</span><span class="op" id="5597237">(</span><span class="ident" id="5597238">t</span><span class="op" id="5597239">,</span>&nbsp;<span class="ident" id="5597241">s</span><span class="op" id="5597242">)</span><span class="op" id="5597243">;</span>&nbsp;<span class="ident" id="5597245">err</span>&nbsp;<span class="op" id="5597249">!=</span>&nbsp;<span class="ident" id="5597252">nil</span>&nbsp;<span class="op" id="5597256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597261">return</span>&nbsp;<span class="string" id="5597268">&#34;&#34;</span><span class="op" id="5597270">,</span>&nbsp;<span class="ident" id="5597272">err</span><br>
<span class="lineno">1580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5597278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597282">hi</span>&nbsp;<span class="op" id="5597285">=</span>&nbsp;<span class="ident" id="5597287">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5597292">//&nbsp;[a-]&nbsp;means&nbsp;(a|-)&nbsp;so&nbsp;check&nbsp;for&nbsp;final&nbsp;].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597336">if</span>&nbsp;<span class="builtinfunc" id="5597339">len</span><span class="op" id="5597342">(</span><span class="ident" id="5597343">t</span><span class="op" id="5597344">)</span>&nbsp;<span class="op" id="5597346">&gt;=</span>&nbsp;<span class="num" id="5597349">2</span>&nbsp;<span class="op" id="5597351">&amp;&amp;</span>&nbsp;<span class="ident" id="5597354">t</span><span class="op" id="5597355">[</span><span class="num" id="5597356">0</span><span class="op" id="5597357">]</span>&nbsp;<span class="op" id="5597359">==</span>&nbsp;<span class="string" id="5597362">&#39;-&#39;</span>&nbsp;<span class="op" id="5597366">&amp;&amp;</span>&nbsp;<span class="ident" id="5597369">t</span><span class="op" id="5597370">[</span><span class="num" id="5597371">1</span><span class="op" id="5597372">]</span>&nbsp;<span class="op" id="5597374">!=</span>&nbsp;<span class="string" id="5597377">&#39;]&#39;</span>&nbsp;<span class="op" id="5597381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597386">t</span>&nbsp;<span class="op" id="5597388">=</span>&nbsp;<span class="ident" id="5597390">t</span><span class="op" id="5597391">[</span><span class="num" id="5597392">1</span><span class="op" id="5597393">:</span><span class="op" id="5597394">]</span><br>
<span class="lineno">1585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597399">if</span>&nbsp;<span class="ident" id="5597402">hi</span><span class="op" id="5597404">,</span>&nbsp;<span class="ident" id="5597406">t</span><span class="op" id="5597407">,</span>&nbsp;<span class="ident" id="5597409">err</span>&nbsp;<span class="op" id="5597413">=</span>&nbsp;<span class="ident" id="5597415">p</span><span class="op" id="5597416">.</span><span class="ident" id="5597417">parseClassChar</span><span class="op" id="5597431">(</span><span class="ident" id="5597432">t</span><span class="op" id="5597433">,</span>&nbsp;<span class="ident" id="5597435">s</span><span class="op" id="5597436">)</span><span class="op" id="5597437">;</span>&nbsp;<span class="ident" id="5597439">err</span>&nbsp;<span class="op" id="5597443">!=</span>&nbsp;<span class="ident" id="5597446">nil</span>&nbsp;<span class="op" id="5597450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597456">return</span>&nbsp;<span class="string" id="5597463">&#34;&#34;</span><span class="op" id="5597465">,</span>&nbsp;<span class="ident" id="5597467">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5597474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597479">if</span>&nbsp;<span class="ident" id="5597482">hi</span>&nbsp;<span class="op" id="5597485">&lt;</span>&nbsp;<span class="ident" id="5597487">lo</span>&nbsp;<span class="op" id="5597490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597496">rng</span>&nbsp;<span class="op" id="5597500">=</span>&nbsp;<span class="ident" id="5597502">rng</span><span class="op" id="5597505">[</span><span class="op" id="5597506">:</span><span class="builtinfunc" id="5597507">len</span><span class="op" id="5597510">(</span><span class="ident" id="5597511">rng</span><span class="op" id="5597514">)</span><span class="op" id="5597515">-</span><span class="builtinfunc" id="5597516">len</span><span class="op" id="5597519">(</span><span class="ident" id="5597520">t</span><span class="op" id="5597521">)</span><span class="op" id="5597522">]</span><br>
<span class="lineno">1590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597528">return</span>&nbsp;<span class="string" id="5597535">&#34;&#34;</span><span class="op" id="5597537">,</span>&nbsp;<span class="op" id="5597539">&amp;</span><span class="ident" id="5597540">Error</span><span class="op" id="5597545">{</span><span class="ident" id="5597546">Code</span><span class="op" id="5597550">:</span>&nbsp;<span class="ident" id="5597552">ErrInvalidCharRange</span><span class="op" id="5597571">,</span>&nbsp;<span class="ident" id="5597573">Expr</span><span class="op" id="5597577">:</span>&nbsp;<span class="ident" id="5597579">rng</span><span class="op" id="5597582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5597587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5597591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597595">if</span>&nbsp;<span class="ident" id="5597598">p</span><span class="op" id="5597599">.</span><span class="ident" id="5597600">flags</span><span class="op" id="5597605">&amp;</span><span class="ident" id="5597606">FoldCase</span>&nbsp;<span class="op" id="5597615">==</span>&nbsp;<span class="num" id="5597618">0</span>&nbsp;<span class="op" id="5597620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597625">class</span>&nbsp;<span class="op" id="5597631">=</span>&nbsp;<span class="ident" id="5597633">appendRange</span><span class="op" id="5597644">(</span><span class="ident" id="5597645">class</span><span class="op" id="5597650">,</span>&nbsp;<span class="ident" id="5597652">lo</span><span class="op" id="5597654">,</span>&nbsp;<span class="ident" id="5597656">hi</span><span class="op" id="5597658">)</span><br>
<span class="lineno">1595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5597662">}</span>&nbsp;<span class="keyword" id="5597664">else</span>&nbsp;<span class="op" id="5597669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597674">class</span>&nbsp;<span class="op" id="5597680">=</span>&nbsp;<span class="ident" id="5597682">appendFoldedRange</span><span class="op" id="5597699">(</span><span class="ident" id="5597700">class</span><span class="op" id="5597705">,</span>&nbsp;<span class="ident" id="5597707">lo</span><span class="op" id="5597709">,</span>&nbsp;<span class="ident" id="5597711">hi</span><span class="op" id="5597713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5597717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5597720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597723">t</span>&nbsp;<span class="op" id="5597725">=</span>&nbsp;<span class="ident" id="5597727">t</span><span class="op" id="5597728">[</span><span class="num" id="5597729">1</span><span class="op" id="5597730">:</span><span class="op" id="5597731">]</span>&nbsp;<span class="comment" id="5597733">//&nbsp;chop&nbsp;]</span><br>
<span class="lineno">1600</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5597745">//&nbsp;Use&nbsp;&amp;re.Rune&nbsp;instead&nbsp;of&nbsp;&amp;class&nbsp;to&nbsp;avoid&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597801">re</span><span class="op" id="5597803">.</span><span class="ident" id="5597804">Rune</span>&nbsp;<span class="op" id="5597809">=</span>&nbsp;<span class="ident" id="5597811">class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597818">class</span>&nbsp;<span class="op" id="5597824">=</span>&nbsp;<span class="ident" id="5597826">cleanClass</span><span class="op" id="5597836">(</span><span class="op" id="5597837">&amp;</span><span class="ident" id="5597838">re</span><span class="op" id="5597840">.</span><span class="ident" id="5597841">Rune</span><span class="op" id="5597845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597848">if</span>&nbsp;<span class="ident" id="5597851">sign</span>&nbsp;<span class="op" id="5597856">&lt;</span>&nbsp;<span class="num" id="5597858">0</span>&nbsp;<span class="op" id="5597860">{</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597864">class</span>&nbsp;<span class="op" id="5597870">=</span>&nbsp;<span class="ident" id="5597872">negateClass</span><span class="op" id="5597883">(</span><span class="ident" id="5597884">class</span><span class="op" id="5597889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5597892">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597895">re</span><span class="op" id="5597897">.</span><span class="ident" id="5597898">Rune</span>&nbsp;<span class="op" id="5597903">=</span>&nbsp;<span class="ident" id="5597905">class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5597912">p</span><span class="op" id="5597913">.</span><span class="ident" id="5597914">push</span><span class="op" id="5597918">(</span><span class="ident" id="5597919">re</span><span class="op" id="5597921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5597924">return</span>&nbsp;<span class="ident" id="5597931">t</span><span class="op" id="5597932">,</span>&nbsp;<span class="ident" id="5597934">nil</span><br>
<span class="lineno">1610</span><span class="op" id="5597938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5597941">//&nbsp;cleanClass&nbsp;sorts&nbsp;the&nbsp;ranges&nbsp;(pairs&nbsp;of&nbsp;elements&nbsp;of&nbsp;r),</span><br>
<span class="lineno"></span><span class="comment" id="5597998">//&nbsp;merges&nbsp;them,&nbsp;and&nbsp;eliminates&nbsp;duplicates.</span><br>
<span class="lineno"></span><span class="keyword" id="5598041">func</span>&nbsp;<span class="ident" id="5598046">cleanClass</span><span class="op" id="5598056">(</span><span class="ident" id="5598057">rp</span>&nbsp;<span class="op" id="5598060">*</span><span class="op" id="5598061">[</span><span class="op" id="5598062">]</span><span class="builtintype" id="5598063">rune</span><span class="op" id="5598067">)</span>&nbsp;<span class="op" id="5598069">[</span><span class="op" id="5598070">]</span><span class="builtintype" id="5598071">rune</span>&nbsp;<span class="op" id="5598076">{</span><br>
<span class="lineno">1615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5598080">//&nbsp;Sort&nbsp;by&nbsp;lo&nbsp;increasing,&nbsp;hi&nbsp;decreasing&nbsp;to&nbsp;break&nbsp;ties.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598136">sort</span><span class="op" id="5598140">.</span><span class="ident" id="5598141">Sort</span><span class="op" id="5598145">(</span><span class="ident" id="5598146">ranges</span><span class="op" id="5598152">{</span><span class="ident" id="5598153">rp</span><span class="op" id="5598155">}</span><span class="op" id="5598156">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598160">r</span>&nbsp;<span class="op" id="5598162">:=</span>&nbsp;<span class="op" id="5598165">*</span><span class="ident" id="5598166">rp</span><br>
<span class="lineno">1620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5598170">if</span>&nbsp;<span class="builtinfunc" id="5598173">len</span><span class="op" id="5598176">(</span><span class="ident" id="5598177">r</span><span class="op" id="5598178">)</span>&nbsp;<span class="op" id="5598180">&lt;</span>&nbsp;<span class="num" id="5598182">2</span>&nbsp;<span class="op" id="5598184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5598188">return</span>&nbsp;<span class="ident" id="5598195">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5598198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5598202">//&nbsp;Merge&nbsp;abutting,&nbsp;overlapping.</span><br>
<span class="lineno">1625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598235">w</span>&nbsp;<span class="op" id="5598237">:=</span>&nbsp;<span class="num" id="5598240">2</span>&nbsp;<span class="comment" id="5598242">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5598258">for</span>&nbsp;<span class="ident" id="5598262">i</span>&nbsp;<span class="op" id="5598264">:=</span>&nbsp;<span class="num" id="5598267">2</span><span class="op" id="5598268">;</span>&nbsp;<span class="ident" id="5598270">i</span>&nbsp;<span class="op" id="5598272">&lt;</span>&nbsp;<span class="builtinfunc" id="5598274">len</span><span class="op" id="5598277">(</span><span class="ident" id="5598278">r</span><span class="op" id="5598279">)</span><span class="op" id="5598280">;</span>&nbsp;<span class="ident" id="5598282">i</span>&nbsp;<span class="op" id="5598284">+=</span>&nbsp;<span class="num" id="5598287">2</span>&nbsp;<span class="op" id="5598289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598293">lo</span><span class="op" id="5598295">,</span>&nbsp;<span class="ident" id="5598297">hi</span>&nbsp;<span class="op" id="5598300">:=</span>&nbsp;<span class="ident" id="5598303">r</span><span class="op" id="5598304">[</span><span class="ident" id="5598305">i</span><span class="op" id="5598306">]</span><span class="op" id="5598307">,</span>&nbsp;<span class="ident" id="5598309">r</span><span class="op" id="5598310">[</span><span class="ident" id="5598311">i</span><span class="op" id="5598312">+</span><span class="num" id="5598313">1</span><span class="op" id="5598314">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5598318">if</span>&nbsp;<span class="ident" id="5598321">lo</span>&nbsp;<span class="op" id="5598324">&lt;=</span>&nbsp;<span class="ident" id="5598327">r</span><span class="op" id="5598328">[</span><span class="ident" id="5598329">w</span><span class="op" id="5598330">-</span><span class="num" id="5598331">1</span><span class="op" id="5598332">]</span><span class="op" id="5598333">+</span><span class="num" id="5598334">1</span>&nbsp;<span class="op" id="5598336">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5598341">//&nbsp;merge&nbsp;with&nbsp;previous&nbsp;range</span><br>
<span class="lineno">1630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5598373">if</span>&nbsp;<span class="ident" id="5598376">hi</span>&nbsp;<span class="op" id="5598379">&gt;</span>&nbsp;<span class="ident" id="5598381">r</span><span class="op" id="5598382">[</span><span class="ident" id="5598383">w</span><span class="op" id="5598384">-</span><span class="num" id="5598385">1</span><span class="op" id="5598386">]</span>&nbsp;<span class="op" id="5598388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598394">r</span><span class="op" id="5598395">[</span><span class="ident" id="5598396">w</span><span class="op" id="5598397">-</span><span class="num" id="5598398">1</span><span class="op" id="5598399">]</span>&nbsp;<span class="op" id="5598401">=</span>&nbsp;<span class="ident" id="5598403">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5598409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5598414">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5598425">}</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5598429">//&nbsp;new&nbsp;disjoint&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598453">r</span><span class="op" id="5598454">[</span><span class="ident" id="5598455">w</span><span class="op" id="5598456">]</span>&nbsp;<span class="op" id="5598458">=</span>&nbsp;<span class="ident" id="5598460">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598465">r</span><span class="op" id="5598466">[</span><span class="ident" id="5598467">w</span><span class="op" id="5598468">+</span><span class="num" id="5598469">1</span><span class="op" id="5598470">]</span>&nbsp;<span class="op" id="5598472">=</span>&nbsp;<span class="ident" id="5598474">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5598479">w</span>&nbsp;<span class="op" id="5598481">+=</span>&nbsp;<span class="num" id="5598484">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5598487">}</span><br>
<span class="lineno">1640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5598491">return</span>&nbsp;<span class="ident" id="5598498">r</span><span class="op" id="5598499">[</span><span class="op" id="5598500">:</span><span class="ident" id="5598501">w</span><span class="op" id="5598502">]</span><br>
<span class="lineno"></span><span class="op" id="5598504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5598507">//&nbsp;appendLiteral&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;literal&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno">1645</span><span class="keyword" id="5598586">func</span>&nbsp;<span class="ident" id="5598591">appendLiteral</span><span class="op" id="5598604">(</span><span class="ident" id="5598605">r</span>&nbsp;<span class="op" id="5598607">[</span><span class="op" id="5598608">]</span><span class="builtintype" id="5598609">rune</span><span class="op" id="5598613">,</span>&nbsp;<span class="ident" id="5598615">x</span>&nbsp;<span class="builtintype" id="5598617">rune</span><span class="op" id="5598621">,</span>&nbsp;<span class="ident" id="5598623">flags</span>&nbsp;<span class="ident" id="5598629">Flags</span><span class="op" id="5598634">)</span>&nbsp;<span class="op" id="5598636">[</span><span class="op" id="5598637">]</span><span class="builtintype" id="5598638">rune</span>&nbsp;<span class="op" id="5598643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5598646">if</span>&nbsp;<span class="ident" id="5598649">flags</span><span class="op" id="5598654">&amp;</span><span class="ident" id="5598655">FoldCase</span>&nbsp;<span class="op" id="5598664">!=</span>&nbsp;<span class="num" id="5598667">0</span>&nbsp;<span class="op" id="5598669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5598673">return</span>&nbsp;<span class="ident" id="5598680">appendFoldedRange</span><span class="op" id="5598697">(</span><span class="ident" id="5598698">r</span><span class="op" id="5598699">,</span>&nbsp;<span class="ident" id="5598701">x</span><span class="op" id="5598702">,</span>&nbsp;<span class="ident" id="5598704">x</span><span class="op" id="5598705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5598708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5598711">return</span>&nbsp;<span class="ident" id="5598718">appendRange</span><span class="op" id="5598729">(</span><span class="ident" id="5598730">r</span><span class="op" id="5598731">,</span>&nbsp;<span class="ident" id="5598733">x</span><span class="op" id="5598734">,</span>&nbsp;<span class="ident" id="5598736">x</span><span class="op" id="5598737">)</span><br>
<span class="lineno">1650</span><span class="op" id="5598739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5598742">//&nbsp;appendRange&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;range&nbsp;lo-hi&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5598821">func</span>&nbsp;<span class="ident" id="5598826">appendRange</span><span class="op" id="5598837">(</span><span class="ident" id="5598838">r</span>&nbsp;<span class="op" id="5598840">[</span><span class="op" id="5598841">]</span><span class="builtintype" id="5598842">rune</span><span class="op" id="5598846">,</span>&nbsp;<span class="ident" id="5598848">lo</span><span class="op" id="5598850">,</span>&nbsp;<span class="ident" id="5598852">hi</span>&nbsp;<span class="builtintype" id="5598855">rune</span><span class="op" id="5598859">)</span>&nbsp;<span class="op" id="5598861">[</span><span class="op" id="5598862">]</span><span class="builtintype" id="5598863">rune</span>&nbsp;<span class="op" id="5598868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5598871">//&nbsp;Expand&nbsp;last&nbsp;range&nbsp;or&nbsp;next&nbsp;to&nbsp;last&nbsp;range&nbsp;if&nbsp;it&nbsp;overlaps&nbsp;or&nbsp;abuts.</span><br>
<span class="lineno">1655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5598940">//&nbsp;Checking&nbsp;two&nbsp;ranges&nbsp;helps&nbsp;when&nbsp;appending&nbsp;case-folded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5598997">//&nbsp;alphabets,&nbsp;so&nbsp;that&nbsp;one&nbsp;range&nbsp;can&nbsp;be&nbsp;expanding&nbsp;A-Z&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5599059">//&nbsp;other&nbsp;expanding&nbsp;a-z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5599084">n</span>&nbsp;<span class="op" id="5599086">:=</span>&nbsp;<span class="builtinfunc" id="5599089">len</span><span class="op" id="5599092">(</span><span class="ident" id="5599093">r</span><span class="op" id="5599094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599097">for</span>&nbsp;<span class="ident" id="5599101">i</span>&nbsp;<span class="op" id="5599103">:=</span>&nbsp;<span class="num" id="5599106">2</span><span class="op" id="5599107">;</span>&nbsp;<span class="ident" id="5599109">i</span>&nbsp;<span class="op" id="5599111">&lt;=</span>&nbsp;<span class="num" id="5599114">4</span><span class="op" id="5599115">;</span>&nbsp;<span class="ident" id="5599117">i</span>&nbsp;<span class="op" id="5599119">+=</span>&nbsp;<span class="num" id="5599122">2</span>&nbsp;<span class="op" id="5599124">{</span>&nbsp;<span class="comment" id="5599126">//&nbsp;twice,&nbsp;using&nbsp;i=2,&nbsp;i=4</span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599153">if</span>&nbsp;<span class="ident" id="5599156">n</span>&nbsp;<span class="op" id="5599158">&gt;=</span>&nbsp;<span class="ident" id="5599161">i</span>&nbsp;<span class="op" id="5599163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5599168">rlo</span><span class="op" id="5599171">,</span>&nbsp;<span class="ident" id="5599173">rhi</span>&nbsp;<span class="op" id="5599177">:=</span>&nbsp;<span class="ident" id="5599180">r</span><span class="op" id="5599181">[</span><span class="ident" id="5599182">n</span><span class="op" id="5599183">-</span><span class="ident" id="5599184">i</span><span class="op" id="5599185">]</span><span class="op" id="5599186">,</span>&nbsp;<span class="ident" id="5599188">r</span><span class="op" id="5599189">[</span><span class="ident" id="5599190">n</span><span class="op" id="5599191">-</span><span class="ident" id="5599192">i</span><span class="op" id="5599193">+</span><span class="num" id="5599194">1</span><span class="op" id="5599195">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599200">if</span>&nbsp;<span class="ident" id="5599203">lo</span>&nbsp;<span class="op" id="5599206">&lt;=</span>&nbsp;<span class="ident" id="5599209">rhi</span><span class="op" id="5599212">+</span><span class="num" id="5599213">1</span>&nbsp;<span class="op" id="5599215">&amp;&amp;</span>&nbsp;<span class="ident" id="5599218">rlo</span>&nbsp;<span class="op" id="5599222">&lt;=</span>&nbsp;<span class="ident" id="5599225">hi</span><span class="op" id="5599227">+</span><span class="num" id="5599228">1</span>&nbsp;<span class="op" id="5599230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599236">if</span>&nbsp;<span class="ident" id="5599239">lo</span>&nbsp;<span class="op" id="5599242">&lt;</span>&nbsp;<span class="ident" id="5599244">rlo</span>&nbsp;<span class="op" id="5599248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5599255">r</span><span class="op" id="5599256">[</span><span class="ident" id="5599257">n</span><span class="op" id="5599258">-</span><span class="ident" id="5599259">i</span><span class="op" id="5599260">]</span>&nbsp;<span class="op" id="5599262">=</span>&nbsp;<span class="ident" id="5599264">lo</span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5599271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599277">if</span>&nbsp;<span class="ident" id="5599280">hi</span>&nbsp;<span class="op" id="5599283">&gt;</span>&nbsp;<span class="ident" id="5599285">rhi</span>&nbsp;<span class="op" id="5599289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5599296">r</span><span class="op" id="5599297">[</span><span class="ident" id="5599298">n</span><span class="op" id="5599299">-</span><span class="ident" id="5599300">i</span><span class="op" id="5599301">+</span><span class="num" id="5599302">1</span><span class="op" id="5599303">]</span>&nbsp;<span class="op" id="5599305">=</span>&nbsp;<span class="ident" id="5599307">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5599314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599320">return</span>&nbsp;<span class="ident" id="5599327">r</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5599332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5599336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5599339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599343">return</span>&nbsp;<span class="builtinfunc" id="5599350">append</span><span class="op" id="5599356">(</span><span class="ident" id="5599357">r</span><span class="op" id="5599358">,</span>&nbsp;<span class="ident" id="5599360">lo</span><span class="op" id="5599362">,</span>&nbsp;<span class="ident" id="5599364">hi</span><span class="op" id="5599366">)</span><br>
<span class="lineno">1675</span><span class="op" id="5599368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5599371">const</span>&nbsp;<span class="op" id="5599377">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5599380">//&nbsp;minimum&nbsp;and&nbsp;maximum&nbsp;runes&nbsp;involved&nbsp;in&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5599431">//&nbsp;checked&nbsp;during&nbsp;test.</span><br>
<span class="lineno">1680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5599456">minFold</span>&nbsp;<span class="op" id="5599464">=</span>&nbsp;<span class="num" id="5599466">0x0041</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5599474">maxFold</span>&nbsp;<span class="op" id="5599482">=</span>&nbsp;<span class="num" id="5599484">0x118df</span><br>
<span class="lineno"></span><span class="op" id="5599492">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5599495">//&nbsp;appendFoldedRange&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;range&nbsp;lo-hi</span><br>
<span class="lineno">1685</span><span class="comment" id="5599564">//&nbsp;and&nbsp;its&nbsp;case&nbsp;folding-equivalent&nbsp;runes&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5599621">func</span>&nbsp;<span class="ident" id="5599626">appendFoldedRange</span><span class="op" id="5599643">(</span><span class="ident" id="5599644">r</span>&nbsp;<span class="op" id="5599646">[</span><span class="op" id="5599647">]</span><span class="builtintype" id="5599648">rune</span><span class="op" id="5599652">,</span>&nbsp;<span class="ident" id="5599654">lo</span><span class="op" id="5599656">,</span>&nbsp;<span class="ident" id="5599658">hi</span>&nbsp;<span class="builtintype" id="5599661">rune</span><span class="op" id="5599665">)</span>&nbsp;<span class="op" id="5599667">[</span><span class="op" id="5599668">]</span><span class="builtintype" id="5599669">rune</span>&nbsp;<span class="op" id="5599674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5599677">//&nbsp;Optimizations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599696">if</span>&nbsp;<span class="ident" id="5599699">lo</span>&nbsp;<span class="op" id="5599702">&lt;=</span>&nbsp;<span class="ident" id="5599705">minFold</span>&nbsp;<span class="op" id="5599713">&amp;&amp;</span>&nbsp;<span class="ident" id="5599716">hi</span>&nbsp;<span class="op" id="5599719">&gt;=</span>&nbsp;<span class="ident" id="5599722">maxFold</span>&nbsp;<span class="op" id="5599730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5599734">//&nbsp;Range&nbsp;is&nbsp;full:&nbsp;folding&nbsp;can&#39;t&nbsp;add&nbsp;more.</span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599778">return</span>&nbsp;<span class="ident" id="5599785">appendRange</span><span class="op" id="5599796">(</span><span class="ident" id="5599797">r</span><span class="op" id="5599798">,</span>&nbsp;<span class="ident" id="5599800">lo</span><span class="op" id="5599802">,</span>&nbsp;<span class="ident" id="5599804">hi</span><span class="op" id="5599806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5599809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599812">if</span>&nbsp;<span class="ident" id="5599815">hi</span>&nbsp;<span class="op" id="5599818">&lt;</span>&nbsp;<span class="ident" id="5599820">minFold</span>&nbsp;<span class="op" id="5599828">||</span>&nbsp;<span class="ident" id="5599831">lo</span>&nbsp;<span class="op" id="5599834">&gt;</span>&nbsp;<span class="ident" id="5599836">maxFold</span>&nbsp;<span class="op" id="5599844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5599848">//&nbsp;Range&nbsp;is&nbsp;outside&nbsp;folding&nbsp;possibilities.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599893">return</span>&nbsp;<span class="ident" id="5599900">appendRange</span><span class="op" id="5599911">(</span><span class="ident" id="5599912">r</span><span class="op" id="5599913">,</span>&nbsp;<span class="ident" id="5599915">lo</span><span class="op" id="5599917">,</span>&nbsp;<span class="ident" id="5599919">hi</span><span class="op" id="5599921">)</span><br>
<span class="lineno">1695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5599924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5599927">if</span>&nbsp;<span class="ident" id="5599930">lo</span>&nbsp;<span class="op" id="5599933">&lt;</span>&nbsp;<span class="ident" id="5599935">minFold</span>&nbsp;<span class="op" id="5599943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5599947">//&nbsp;[lo,&nbsp;minFold-1]&nbsp;needs&nbsp;no&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5599986">r</span>&nbsp;<span class="op" id="5599988">=</span>&nbsp;<span class="ident" id="5599990">appendRange</span><span class="op" id="5600001">(</span><span class="ident" id="5600002">r</span><span class="op" id="5600003">,</span>&nbsp;<span class="ident" id="5600005">lo</span><span class="op" id="5600007">,</span>&nbsp;<span class="ident" id="5600009">minFold</span><span class="op" id="5600016">-</span><span class="num" id="5600017">1</span><span class="op" id="5600018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600022">lo</span>&nbsp;<span class="op" id="5600025">=</span>&nbsp;<span class="ident" id="5600027">minFold</span><br>
<span class="lineno">1700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5600036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600039">if</span>&nbsp;<span class="ident" id="5600042">hi</span>&nbsp;<span class="op" id="5600045">&gt;</span>&nbsp;<span class="ident" id="5600047">maxFold</span>&nbsp;<span class="op" id="5600055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5600059">//&nbsp;[maxFold+1,&nbsp;hi]&nbsp;needs&nbsp;no&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600098">r</span>&nbsp;<span class="op" id="5600100">=</span>&nbsp;<span class="ident" id="5600102">appendRange</span><span class="op" id="5600113">(</span><span class="ident" id="5600114">r</span><span class="op" id="5600115">,</span>&nbsp;<span class="ident" id="5600117">maxFold</span><span class="op" id="5600124">+</span><span class="num" id="5600125">1</span><span class="op" id="5600126">,</span>&nbsp;<span class="ident" id="5600128">hi</span><span class="op" id="5600130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600134">hi</span>&nbsp;<span class="op" id="5600137">=</span>&nbsp;<span class="ident" id="5600139">maxFold</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5600148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5600152">//&nbsp;Brute&nbsp;force.&nbsp;&nbsp;Depend&nbsp;on&nbsp;appendRange&nbsp;to&nbsp;coalesce&nbsp;ranges&nbsp;on&nbsp;the&nbsp;fly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600223">for</span>&nbsp;<span class="ident" id="5600227">c</span>&nbsp;<span class="op" id="5600229">:=</span>&nbsp;<span class="ident" id="5600232">lo</span><span class="op" id="5600234">;</span>&nbsp;<span class="ident" id="5600236">c</span>&nbsp;<span class="op" id="5600238">&lt;=</span>&nbsp;<span class="ident" id="5600241">hi</span><span class="op" id="5600243">;</span>&nbsp;<span class="ident" id="5600245">c</span><span class="op" id="5600246">++</span>&nbsp;<span class="op" id="5600249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600253">r</span>&nbsp;<span class="op" id="5600255">=</span>&nbsp;<span class="ident" id="5600257">appendRange</span><span class="op" id="5600268">(</span><span class="ident" id="5600269">r</span><span class="op" id="5600270">,</span>&nbsp;<span class="ident" id="5600272">c</span><span class="op" id="5600273">,</span>&nbsp;<span class="ident" id="5600275">c</span><span class="op" id="5600276">)</span><br>
<span class="lineno">1710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600280">f</span>&nbsp;<span class="op" id="5600282">:=</span>&nbsp;<span class="ident" id="5600285">unicode</span><span class="op" id="5600292">.</span><span class="ident" id="5600293">SimpleFold</span><span class="op" id="5600303">(</span><span class="ident" id="5600304">c</span><span class="op" id="5600305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600309">for</span>&nbsp;<span class="ident" id="5600313">f</span>&nbsp;<span class="op" id="5600315">!=</span>&nbsp;<span class="ident" id="5600318">c</span>&nbsp;<span class="op" id="5600320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600325">r</span>&nbsp;<span class="op" id="5600327">=</span>&nbsp;<span class="ident" id="5600329">appendRange</span><span class="op" id="5600340">(</span><span class="ident" id="5600341">r</span><span class="op" id="5600342">,</span>&nbsp;<span class="ident" id="5600344">f</span><span class="op" id="5600345">,</span>&nbsp;<span class="ident" id="5600347">f</span><span class="op" id="5600348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600353">f</span>&nbsp;<span class="op" id="5600355">=</span>&nbsp;<span class="ident" id="5600357">unicode</span><span class="op" id="5600364">.</span><span class="ident" id="5600365">SimpleFold</span><span class="op" id="5600375">(</span><span class="ident" id="5600376">f</span><span class="op" id="5600377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5600381">}</span><br>
<span class="lineno">1715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5600384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600387">return</span>&nbsp;<span class="ident" id="5600394">r</span><br>
<span class="lineno"></span><span class="op" id="5600396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5600399">//&nbsp;appendClass&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno">1720</span><span class="comment" id="5600474">//&nbsp;It&nbsp;assume&nbsp;x&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="5600499">func</span>&nbsp;<span class="ident" id="5600504">appendClass</span><span class="op" id="5600515">(</span><span class="ident" id="5600516">r</span>&nbsp;<span class="op" id="5600518">[</span><span class="op" id="5600519">]</span><span class="builtintype" id="5600520">rune</span><span class="op" id="5600524">,</span>&nbsp;<span class="ident" id="5600526">x</span>&nbsp;<span class="op" id="5600528">[</span><span class="op" id="5600529">]</span><span class="builtintype" id="5600530">rune</span><span class="op" id="5600534">)</span>&nbsp;<span class="op" id="5600536">[</span><span class="op" id="5600537">]</span><span class="builtintype" id="5600538">rune</span>&nbsp;<span class="op" id="5600543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600546">for</span>&nbsp;<span class="ident" id="5600550">i</span>&nbsp;<span class="op" id="5600552">:=</span>&nbsp;<span class="num" id="5600555">0</span><span class="op" id="5600556">;</span>&nbsp;<span class="ident" id="5600558">i</span>&nbsp;<span class="op" id="5600560">&lt;</span>&nbsp;<span class="builtinfunc" id="5600562">len</span><span class="op" id="5600565">(</span><span class="ident" id="5600566">x</span><span class="op" id="5600567">)</span><span class="op" id="5600568">;</span>&nbsp;<span class="ident" id="5600570">i</span>&nbsp;<span class="op" id="5600572">+=</span>&nbsp;<span class="num" id="5600575">2</span>&nbsp;<span class="op" id="5600577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600581">r</span>&nbsp;<span class="op" id="5600583">=</span>&nbsp;<span class="ident" id="5600585">appendRange</span><span class="op" id="5600596">(</span><span class="ident" id="5600597">r</span><span class="op" id="5600598">,</span>&nbsp;<span class="ident" id="5600600">x</span><span class="op" id="5600601">[</span><span class="ident" id="5600602">i</span><span class="op" id="5600603">]</span><span class="op" id="5600604">,</span>&nbsp;<span class="ident" id="5600606">x</span><span class="op" id="5600607">[</span><span class="ident" id="5600608">i</span><span class="op" id="5600609">+</span><span class="num" id="5600610">1</span><span class="op" id="5600611">]</span><span class="op" id="5600612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5600615">}</span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600618">return</span>&nbsp;<span class="ident" id="5600625">r</span><br>
<span class="lineno"></span><span class="op" id="5600627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5600630">//&nbsp;appendFolded&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;case&nbsp;folding&nbsp;of&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5600726">func</span>&nbsp;<span class="ident" id="5600731">appendFoldedClass</span><span class="op" id="5600748">(</span><span class="ident" id="5600749">r</span>&nbsp;<span class="op" id="5600751">[</span><span class="op" id="5600752">]</span><span class="builtintype" id="5600753">rune</span><span class="op" id="5600757">,</span>&nbsp;<span class="ident" id="5600759">x</span>&nbsp;<span class="op" id="5600761">[</span><span class="op" id="5600762">]</span><span class="builtintype" id="5600763">rune</span><span class="op" id="5600767">)</span>&nbsp;<span class="op" id="5600769">[</span><span class="op" id="5600770">]</span><span class="builtintype" id="5600771">rune</span>&nbsp;<span class="op" id="5600776">{</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600779">for</span>&nbsp;<span class="ident" id="5600783">i</span>&nbsp;<span class="op" id="5600785">:=</span>&nbsp;<span class="num" id="5600788">0</span><span class="op" id="5600789">;</span>&nbsp;<span class="ident" id="5600791">i</span>&nbsp;<span class="op" id="5600793">&lt;</span>&nbsp;<span class="builtinfunc" id="5600795">len</span><span class="op" id="5600798">(</span><span class="ident" id="5600799">x</span><span class="op" id="5600800">)</span><span class="op" id="5600801">;</span>&nbsp;<span class="ident" id="5600803">i</span>&nbsp;<span class="op" id="5600805">+=</span>&nbsp;<span class="num" id="5600808">2</span>&nbsp;<span class="op" id="5600810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5600814">r</span>&nbsp;<span class="op" id="5600816">=</span>&nbsp;<span class="ident" id="5600818">appendFoldedRange</span><span class="op" id="5600835">(</span><span class="ident" id="5600836">r</span><span class="op" id="5600837">,</span>&nbsp;<span class="ident" id="5600839">x</span><span class="op" id="5600840">[</span><span class="ident" id="5600841">i</span><span class="op" id="5600842">]</span><span class="op" id="5600843">,</span>&nbsp;<span class="ident" id="5600845">x</span><span class="op" id="5600846">[</span><span class="ident" id="5600847">i</span><span class="op" id="5600848">+</span><span class="num" id="5600849">1</span><span class="op" id="5600850">]</span><span class="op" id="5600851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5600854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5600857">return</span>&nbsp;<span class="ident" id="5600864">r</span><br>
<span class="lineno"></span><span class="op" id="5600866">}</span><br>
<span class="lineno">1735</span><br>
<span class="lineno"></span><span class="comment" id="5600869">//&nbsp;appendNegatedClass&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;negation&nbsp;of&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5600967">//&nbsp;It&nbsp;assumes&nbsp;x&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="5600993">func</span>&nbsp;<span class="ident" id="5600998">appendNegatedClass</span><span class="op" id="5601016">(</span><span class="ident" id="5601017">r</span>&nbsp;<span class="op" id="5601019">[</span><span class="op" id="5601020">]</span><span class="builtintype" id="5601021">rune</span><span class="op" id="5601025">,</span>&nbsp;<span class="ident" id="5601027">x</span>&nbsp;<span class="op" id="5601029">[</span><span class="op" id="5601030">]</span><span class="builtintype" id="5601031">rune</span><span class="op" id="5601035">)</span>&nbsp;<span class="op" id="5601037">[</span><span class="op" id="5601038">]</span><span class="builtintype" id="5601039">rune</span>&nbsp;<span class="op" id="5601044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601047">nextLo</span>&nbsp;<span class="op" id="5601054">:=</span>&nbsp;<span class="string" id="5601057">&#39;\u0000&#39;</span><br>
<span class="lineno">1740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601067">for</span>&nbsp;<span class="ident" id="5601071">i</span>&nbsp;<span class="op" id="5601073">:=</span>&nbsp;<span class="num" id="5601076">0</span><span class="op" id="5601077">;</span>&nbsp;<span class="ident" id="5601079">i</span>&nbsp;<span class="op" id="5601081">&lt;</span>&nbsp;<span class="builtinfunc" id="5601083">len</span><span class="op" id="5601086">(</span><span class="ident" id="5601087">x</span><span class="op" id="5601088">)</span><span class="op" id="5601089">;</span>&nbsp;<span class="ident" id="5601091">i</span>&nbsp;<span class="op" id="5601093">+=</span>&nbsp;<span class="num" id="5601096">2</span>&nbsp;<span class="op" id="5601098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601102">lo</span><span class="op" id="5601104">,</span>&nbsp;<span class="ident" id="5601106">hi</span>&nbsp;<span class="op" id="5601109">:=</span>&nbsp;<span class="ident" id="5601112">x</span><span class="op" id="5601113">[</span><span class="ident" id="5601114">i</span><span class="op" id="5601115">]</span><span class="op" id="5601116">,</span>&nbsp;<span class="ident" id="5601118">x</span><span class="op" id="5601119">[</span><span class="ident" id="5601120">i</span><span class="op" id="5601121">+</span><span class="num" id="5601122">1</span><span class="op" id="5601123">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601127">if</span>&nbsp;<span class="ident" id="5601130">nextLo</span>&nbsp;<span class="op" id="5601137">&lt;=</span>&nbsp;<span class="ident" id="5601140">lo</span><span class="op" id="5601142">-</span><span class="num" id="5601143">1</span>&nbsp;<span class="op" id="5601145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601150">r</span>&nbsp;<span class="op" id="5601152">=</span>&nbsp;<span class="ident" id="5601154">appendRange</span><span class="op" id="5601165">(</span><span class="ident" id="5601166">r</span><span class="op" id="5601167">,</span>&nbsp;<span class="ident" id="5601169">nextLo</span><span class="op" id="5601175">,</span>&nbsp;<span class="ident" id="5601177">lo</span><span class="op" id="5601179">-</span><span class="num" id="5601180">1</span><span class="op" id="5601181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5601185">}</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601189">nextLo</span>&nbsp;<span class="op" id="5601196">=</span>&nbsp;<span class="ident" id="5601198">hi</span>&nbsp;<span class="op" id="5601201">+</span>&nbsp;<span class="num" id="5601203">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5601206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601209">if</span>&nbsp;<span class="ident" id="5601212">nextLo</span>&nbsp;<span class="op" id="5601219">&lt;=</span>&nbsp;<span class="ident" id="5601222">unicode</span><span class="op" id="5601229">.</span><span class="ident" id="5601230">MaxRune</span>&nbsp;<span class="op" id="5601238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601242">r</span>&nbsp;<span class="op" id="5601244">=</span>&nbsp;<span class="ident" id="5601246">appendRange</span><span class="op" id="5601257">(</span><span class="ident" id="5601258">r</span><span class="op" id="5601259">,</span>&nbsp;<span class="ident" id="5601261">nextLo</span><span class="op" id="5601267">,</span>&nbsp;<span class="ident" id="5601269">unicode</span><span class="op" id="5601276">.</span><span class="ident" id="5601277">MaxRune</span><span class="op" id="5601284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5601287">}</span><br>
<span class="lineno">1750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601290">return</span>&nbsp;<span class="ident" id="5601297">r</span><br>
<span class="lineno"></span><span class="op" id="5601299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5601302">//&nbsp;appendTable&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5601367">func</span>&nbsp;<span class="ident" id="5601372">appendTable</span><span class="op" id="5601383">(</span><span class="ident" id="5601384">r</span>&nbsp;<span class="op" id="5601386">[</span><span class="op" id="5601387">]</span><span class="builtintype" id="5601388">rune</span><span class="op" id="5601392">,</span>&nbsp;<span class="ident" id="5601394">x</span>&nbsp;<span class="op" id="5601396">*</span><span class="ident" id="5601397">unicode</span><span class="op" id="5601404">.</span><span class="ident" id="5601405">RangeTable</span><span class="op" id="5601415">)</span>&nbsp;<span class="op" id="5601417">[</span><span class="op" id="5601418">]</span><span class="builtintype" id="5601419">rune</span>&nbsp;<span class="op" id="5601424">{</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601427">for</span>&nbsp;<span class="ident" id="5601431">_</span><span class="op" id="5601432">,</span>&nbsp;<span class="ident" id="5601434">xr</span>&nbsp;<span class="op" id="5601437">:=</span>&nbsp;<span class="keyword" id="5601440">range</span>&nbsp;<span class="ident" id="5601446">x</span><span class="op" id="5601447">.</span><span class="ident" id="5601448">R16</span>&nbsp;<span class="op" id="5601452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601456">lo</span><span class="op" id="5601458">,</span>&nbsp;<span class="ident" id="5601460">hi</span><span class="op" id="5601462">,</span>&nbsp;<span class="ident" id="5601464">stride</span>&nbsp;<span class="op" id="5601471">:=</span>&nbsp;<span class="builtintype" id="5601474">rune</span><span class="op" id="5601478">(</span><span class="ident" id="5601479">xr</span><span class="op" id="5601481">.</span><span class="ident" id="5601482">Lo</span><span class="op" id="5601484">)</span><span class="op" id="5601485">,</span>&nbsp;<span class="builtintype" id="5601487">rune</span><span class="op" id="5601491">(</span><span class="ident" id="5601492">xr</span><span class="op" id="5601494">.</span><span class="ident" id="5601495">Hi</span><span class="op" id="5601497">)</span><span class="op" id="5601498">,</span>&nbsp;<span class="builtintype" id="5601500">rune</span><span class="op" id="5601504">(</span><span class="ident" id="5601505">xr</span><span class="op" id="5601507">.</span><span class="ident" id="5601508">Stride</span><span class="op" id="5601514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601518">if</span>&nbsp;<span class="ident" id="5601521">stride</span>&nbsp;<span class="op" id="5601528">==</span>&nbsp;<span class="num" id="5601531">1</span>&nbsp;<span class="op" id="5601533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601538">r</span>&nbsp;<span class="op" id="5601540">=</span>&nbsp;<span class="ident" id="5601542">appendRange</span><span class="op" id="5601553">(</span><span class="ident" id="5601554">r</span><span class="op" id="5601555">,</span>&nbsp;<span class="ident" id="5601557">lo</span><span class="op" id="5601559">,</span>&nbsp;<span class="ident" id="5601561">hi</span><span class="op" id="5601563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601568">continue</span><br>
<span class="lineno">1760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5601579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601583">for</span>&nbsp;<span class="ident" id="5601587">c</span>&nbsp;<span class="op" id="5601589">:=</span>&nbsp;<span class="ident" id="5601592">lo</span><span class="op" id="5601594">;</span>&nbsp;<span class="ident" id="5601596">c</span>&nbsp;<span class="op" id="5601598">&lt;=</span>&nbsp;<span class="ident" id="5601601">hi</span><span class="op" id="5601603">;</span>&nbsp;<span class="ident" id="5601605">c</span>&nbsp;<span class="op" id="5601607">+=</span>&nbsp;<span class="ident" id="5601610">stride</span>&nbsp;<span class="op" id="5601617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601622">r</span>&nbsp;<span class="op" id="5601624">=</span>&nbsp;<span class="ident" id="5601626">appendRange</span><span class="op" id="5601637">(</span><span class="ident" id="5601638">r</span><span class="op" id="5601639">,</span>&nbsp;<span class="ident" id="5601641">c</span><span class="op" id="5601642">,</span>&nbsp;<span class="ident" id="5601644">c</span><span class="op" id="5601645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5601649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5601652">}</span><br>
<span class="lineno">1765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601655">for</span>&nbsp;<span class="ident" id="5601659">_</span><span class="op" id="5601660">,</span>&nbsp;<span class="ident" id="5601662">xr</span>&nbsp;<span class="op" id="5601665">:=</span>&nbsp;<span class="keyword" id="5601668">range</span>&nbsp;<span class="ident" id="5601674">x</span><span class="op" id="5601675">.</span><span class="ident" id="5601676">R32</span>&nbsp;<span class="op" id="5601680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601684">lo</span><span class="op" id="5601686">,</span>&nbsp;<span class="ident" id="5601688">hi</span><span class="op" id="5601690">,</span>&nbsp;<span class="ident" id="5601692">stride</span>&nbsp;<span class="op" id="5601699">:=</span>&nbsp;<span class="builtintype" id="5601702">rune</span><span class="op" id="5601706">(</span><span class="ident" id="5601707">xr</span><span class="op" id="5601709">.</span><span class="ident" id="5601710">Lo</span><span class="op" id="5601712">)</span><span class="op" id="5601713">,</span>&nbsp;<span class="builtintype" id="5601715">rune</span><span class="op" id="5601719">(</span><span class="ident" id="5601720">xr</span><span class="op" id="5601722">.</span><span class="ident" id="5601723">Hi</span><span class="op" id="5601725">)</span><span class="op" id="5601726">,</span>&nbsp;<span class="builtintype" id="5601728">rune</span><span class="op" id="5601732">(</span><span class="ident" id="5601733">xr</span><span class="op" id="5601735">.</span><span class="ident" id="5601736">Stride</span><span class="op" id="5601742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601746">if</span>&nbsp;<span class="ident" id="5601749">stride</span>&nbsp;<span class="op" id="5601756">==</span>&nbsp;<span class="num" id="5601759">1</span>&nbsp;<span class="op" id="5601761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601766">r</span>&nbsp;<span class="op" id="5601768">=</span>&nbsp;<span class="ident" id="5601770">appendRange</span><span class="op" id="5601781">(</span><span class="ident" id="5601782">r</span><span class="op" id="5601783">,</span>&nbsp;<span class="ident" id="5601785">lo</span><span class="op" id="5601787">,</span>&nbsp;<span class="ident" id="5601789">hi</span><span class="op" id="5601791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601796">continue</span><br>
<span class="lineno">1770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5601807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601811">for</span>&nbsp;<span class="ident" id="5601815">c</span>&nbsp;<span class="op" id="5601817">:=</span>&nbsp;<span class="ident" id="5601820">lo</span><span class="op" id="5601822">;</span>&nbsp;<span class="ident" id="5601824">c</span>&nbsp;<span class="op" id="5601826">&lt;=</span>&nbsp;<span class="ident" id="5601829">hi</span><span class="op" id="5601831">;</span>&nbsp;<span class="ident" id="5601833">c</span>&nbsp;<span class="op" id="5601835">+=</span>&nbsp;<span class="ident" id="5601838">stride</span>&nbsp;<span class="op" id="5601845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5601850">r</span>&nbsp;<span class="op" id="5601852">=</span>&nbsp;<span class="ident" id="5601854">appendRange</span><span class="op" id="5601865">(</span><span class="ident" id="5601866">r</span><span class="op" id="5601867">,</span>&nbsp;<span class="ident" id="5601869">c</span><span class="op" id="5601870">,</span>&nbsp;<span class="ident" id="5601872">c</span><span class="op" id="5601873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5601877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5601880">}</span><br>
<span class="lineno">1775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5601883">return</span>&nbsp;<span class="ident" id="5601890">r</span><br>
<span class="lineno"></span><span class="op" id="5601892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5601895">//&nbsp;appendNegatedTable&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;negation&nbsp;of&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="5601983">func</span>&nbsp;<span class="ident" id="5601988">appendNegatedTable</span><span class="op" id="5602006">(</span><span class="ident" id="5602007">r</span>&nbsp;<span class="op" id="5602009">[</span><span class="op" id="5602010">]</span><span class="builtintype" id="5602011">rune</span><span class="op" id="5602015">,</span>&nbsp;<span class="ident" id="5602017">x</span>&nbsp;<span class="op" id="5602019">*</span><span class="ident" id="5602020">unicode</span><span class="op" id="5602027">.</span><span class="ident" id="5602028">RangeTable</span><span class="op" id="5602038">)</span>&nbsp;<span class="op" id="5602040">[</span><span class="op" id="5602041">]</span><span class="builtintype" id="5602042">rune</span>&nbsp;<span class="op" id="5602047">{</span><br>
<span class="lineno">1780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602050">nextLo</span>&nbsp;<span class="op" id="5602057">:=</span>&nbsp;<span class="string" id="5602060">&#39;\u0000&#39;</span>&nbsp;<span class="comment" id="5602069">//&nbsp;lo&nbsp;end&nbsp;of&nbsp;next&nbsp;class&nbsp;to&nbsp;add</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5602101">for</span>&nbsp;<span class="ident" id="5602105">_</span><span class="op" id="5602106">,</span>&nbsp;<span class="ident" id="5602108">xr</span>&nbsp;<span class="op" id="5602111">:=</span>&nbsp;<span class="keyword" id="5602114">range</span>&nbsp;<span class="ident" id="5602120">x</span><span class="op" id="5602121">.</span><span class="ident" id="5602122">R16</span>&nbsp;<span class="op" id="5602126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602130">lo</span><span class="op" id="5602132">,</span>&nbsp;<span class="ident" id="5602134">hi</span><span class="op" id="5602136">,</span>&nbsp;<span class="ident" id="5602138">stride</span>&nbsp;<span class="op" id="5602145">:=</span>&nbsp;<span class="builtintype" id="5602148">rune</span><span class="op" id="5602152">(</span><span class="ident" id="5602153">xr</span><span class="op" id="5602155">.</span><span class="ident" id="5602156">Lo</span><span class="op" id="5602158">)</span><span class="op" id="5602159">,</span>&nbsp;<span class="builtintype" id="5602161">rune</span><span class="op" id="5602165">(</span><span class="ident" id="5602166">xr</span><span class="op" id="5602168">.</span><span class="ident" id="5602169">Hi</span><span class="op" id="5602171">)</span><span class="op" id="5602172">,</span>&nbsp;<span class="builtintype" id="5602174">rune</span><span class="op" id="5602178">(</span><span class="ident" id="5602179">xr</span><span class="op" id="5602181">.</span><span class="ident" id="5602182">Stride</span><span class="op" id="5602188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5602192">if</span>&nbsp;<span class="ident" id="5602195">stride</span>&nbsp;<span class="op" id="5602202">==</span>&nbsp;<span class="num" id="5602205">1</span>&nbsp;<span class="op" id="5602207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5602212">if</span>&nbsp;<span class="ident" id="5602215">nextLo</span>&nbsp;<span class="op" id="5602222">&lt;=</span>&nbsp;<span class="ident" id="5602225">lo</span><span class="op" id="5602227">-</span><span class="num" id="5602228">1</span>&nbsp;<span class="op" id="5602230">{</span><br>
<span class="lineno">1785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602236">r</span>&nbsp;<span class="op" id="5602238">=</span>&nbsp;<span class="ident" id="5602240">appendRange</span><span class="op" id="5602251">(</span><span class="ident" id="5602252">r</span><span class="op" id="5602253">,</span>&nbsp;<span class="ident" id="5602255">nextLo</span><span class="op" id="5602261">,</span>&nbsp;<span class="ident" id="5602263">lo</span><span class="op" id="5602265">-</span><span class="num" id="5602266">1</span><span class="op" id="5602267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5602272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602277">nextLo</span>&nbsp;<span class="op" id="5602284">=</span>&nbsp;<span class="ident" id="5602286">hi</span>&nbsp;<span class="op" id="5602289">+</span>&nbsp;<span class="num" id="5602291">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5602296">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5602307">}</span><br>
<span class="lineno">1790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5602311">for</span>&nbsp;<span class="ident" id="5602315">c</span>&nbsp;<span class="op" id="5602317">:=</span>&nbsp;<span class="ident" id="5602320">lo</span><span class="op" id="5602322">;</span>&nbsp;<span class="ident" id="5602324">c</span>&nbsp;<span class="op" id="5602326">&lt;=</span>&nbsp;<span class="ident" id="5602329">hi</span><span class="op" id="5602331">;</span>&nbsp;<span class="ident" id="5602333">c</span>&nbsp;<span class="op" id="5602335">+=</span>&nbsp;<span class="ident" id="5602338">stride</span>&nbsp;<span class="op" id="5602345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5602350">if</span>&nbsp;<span class="ident" id="5602353">nextLo</span>&nbsp;<span class="op" id="5602360">&lt;=</span>&nbsp;<span class="ident" id="5602363">c</span><span class="op" id="5602364">-</span><span class="num" id="5602365">1</span>&nbsp;<span class="op" id="5602367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602373">r</span>&nbsp;<span class="op" id="5602375">=</span>&nbsp;<span class="ident" id="5602377">appendRange</span><span class="op" id="5602388">(</span><span class="ident" id="5602389">r</span><span class="op" id="5602390">,</span>&nbsp;<span class="ident" id="5602392">nextLo</span><span class="op" id="5602398">,</span>&nbsp;<span class="ident" id="5602400">c</span><span class="op" id="5602401">-</span><span class="num" id="5602402">1</span><span class="op" id="5602403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5602408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602413">nextLo</span>&nbsp;<span class="op" id="5602420">=</span>&nbsp;<span class="ident" id="5602422">c</span>&nbsp;<span class="op" id="5602424">+</span>&nbsp;<span class="num" id="5602426">1</span><br>
<span class="lineno">1795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5602430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5602433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5602436">for</span>&nbsp;<span class="ident" id="5602440">_</span><span class="op" id="5602441">,</span>&nbsp;<span class="ident" id="5602443">xr</span>&nbsp;<span class="op" id="5602446">:=</span>&nbsp;<span class="keyword" id="5602449">range</span>&nbsp;<span class="ident" id="5602455">x</span><span class="op" id="5602456">.</span><span class="ident" id="5602457">R32</span>&nbsp;<span class="op" id="5602461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602465">lo</span><span class="op" id="5602467">,</span>&nbsp;<span class="ident" id="5602469">hi</span><span class="op" id="5602471">,</span>&nbsp;<span class="ident" id="5602473">stride</span>&nbsp;<span class="op" id="5602480">:=</span>&nbsp;<span class="builtintype" id="5602483">rune</span><span class="op" id="5602487">(</span><span class="ident" id="5602488">xr</span><span class="op" id="5602490">.</span><span class="ident" id="5602491">Lo</span><span class="op" id="5602493">)</span><span class="op" id="5602494">,</span>&nbsp;<span class="builtintype" id="5602496">rune</span><span class="op" id="5602500">(</span><span class="ident" id="5602501">xr</span><span class="op" id="5602503">.</span><span class="ident" id="5602504">Hi</span><span class="op" id="5602506">)</span><span class="op" id="5602507">,</span>&nbsp;<span class="builtintype" id="5602509">rune</span><span class="op" id="5602513">(</span><span class="ident" id="5602514">xr</span><span class="op" id="5602516">.</span><span class="ident" id="5602517">Stride</span><span class="op" id="5602523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5602527">if</span>&nbsp;<span class="ident" id="5602530">stride</span>&nbsp;<span class="op" id="5602537">==</span>&nbsp;<span class="num" id="5602540">1</span>&nbsp;<span class="op" id="5602542">{</span><br>
<span class="lineno">1800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5602547">if</span>&nbsp;<span class="ident" id="5602550">nextLo</span>&nbsp;<span class="op" id="5602557">&lt;=</span>&nbsp;<span class="ident" id="5602560">lo</span><span class="op" id="5602562">-</span><span class="num" id="5602563">1</span>&nbsp;<span class="op" id="5602565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602571">r</span>&nbsp;<span class="op" id="5602573">=</span>&nbsp;<span class="ident" id="5602575">appendRange</span><span class="op" id="5602586">(</span><span class="ident" id="5602587">r</span><span class="op" id="5602588">,</span>&nbsp;<span class="ident" id="5602590">nextLo</span><span class="op" id="5602596">,</span>&nbsp;<span class="ident" id="5602598">lo</span><span class="op" id="5602600">-</span><span class="num" id="5602601">1</span><span class="op" id="5602602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5602607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602612">nextLo</span>&nbsp;<span class="op" id="5602619">=</span>&nbsp;<span class="ident" id="5602621">hi</span>&nbsp;<span class="op" id="5602624">+</span>&nbsp;<span class="num" id="5602626">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5602631">continue</span><br>
<span class="lineno">1805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5602642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5602646">for</span>&nbsp;<span class="ident" id="5602650">c</span>&nbsp;<span class="op" id="5602652">:=</span>&nbsp;<span class="ident" id="5602655">lo</span><span class="op" id="5602657">;</span>&nbsp;<span class="ident" id="5602659">c</span>&nbsp;<span class="op" id="5602661">&lt;=</span>&nbsp;<span class="ident" id="5602664">hi</span><span class="op" id="5602666">;</span>&nbsp;<span class="ident" id="5602668">c</span>&nbsp;<span class="op" id="5602670">+=</span>&nbsp;<span class="ident" id="5602673">stride</span>&nbsp;<span class="op" id="5602680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5602685">if</span>&nbsp;<span class="ident" id="5602688">nextLo</span>&nbsp;<span class="op" id="5602695">&lt;=</span>&nbsp;<span class="ident" id="5602698">c</span><span class="op" id="5602699">-</span><span class="num" id="5602700">1</span>&nbsp;<span class="op" id="5602702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602708">r</span>&nbsp;<span class="op" id="5602710">=</span>&nbsp;<span class="ident" id="5602712">appendRange</span><span class="op" id="5602723">(</span><span class="ident" id="5602724">r</span><span class="op" id="5602725">,</span>&nbsp;<span class="ident" id="5602727">nextLo</span><span class="op" id="5602733">,</span>&nbsp;<span class="ident" id="5602735">c</span><span class="op" id="5602736">-</span><span class="num" id="5602737">1</span><span class="op" id="5602738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5602743">}</span><br>
<span class="lineno">1810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602748">nextLo</span>&nbsp;<span class="op" id="5602755">=</span>&nbsp;<span class="ident" id="5602757">c</span>&nbsp;<span class="op" id="5602759">+</span>&nbsp;<span class="num" id="5602761">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5602765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5602768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5602771">if</span>&nbsp;<span class="ident" id="5602774">nextLo</span>&nbsp;<span class="op" id="5602781">&lt;=</span>&nbsp;<span class="ident" id="5602784">unicode</span><span class="op" id="5602791">.</span><span class="ident" id="5602792">MaxRune</span>&nbsp;<span class="op" id="5602800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602804">r</span>&nbsp;<span class="op" id="5602806">=</span>&nbsp;<span class="ident" id="5602808">appendRange</span><span class="op" id="5602819">(</span><span class="ident" id="5602820">r</span><span class="op" id="5602821">,</span>&nbsp;<span class="ident" id="5602823">nextLo</span><span class="op" id="5602829">,</span>&nbsp;<span class="ident" id="5602831">unicode</span><span class="op" id="5602838">.</span><span class="ident" id="5602839">MaxRune</span><span class="op" id="5602846">)</span><br>
<span class="lineno">1815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5602849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5602852">return</span>&nbsp;<span class="ident" id="5602859">r</span><br>
<span class="lineno"></span><span class="op" id="5602861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5602864">//&nbsp;negateClass&nbsp;overwrites&nbsp;r&nbsp;and&nbsp;returns&nbsp;r&#39;s&nbsp;negation.</span><br>
<span class="lineno">1820</span><span class="comment" id="5602918">//&nbsp;It&nbsp;assumes&nbsp;the&nbsp;class&nbsp;r&nbsp;is&nbsp;already&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="5602962">func</span>&nbsp;<span class="ident" id="5602967">negateClass</span><span class="op" id="5602978">(</span><span class="ident" id="5602979">r</span>&nbsp;<span class="op" id="5602981">[</span><span class="op" id="5602982">]</span><span class="builtintype" id="5602983">rune</span><span class="op" id="5602987">)</span>&nbsp;<span class="op" id="5602989">[</span><span class="op" id="5602990">]</span><span class="builtintype" id="5602991">rune</span>&nbsp;<span class="op" id="5602996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5602999">nextLo</span>&nbsp;<span class="op" id="5603006">:=</span>&nbsp;<span class="string" id="5603009">&#39;\u0000&#39;</span>&nbsp;<span class="comment" id="5603018">//&nbsp;lo&nbsp;end&nbsp;of&nbsp;next&nbsp;class&nbsp;to&nbsp;add</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603050">w</span>&nbsp;<span class="op" id="5603052">:=</span>&nbsp;<span class="num" id="5603055">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5603069">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603085">for</span>&nbsp;<span class="ident" id="5603089">i</span>&nbsp;<span class="op" id="5603091">:=</span>&nbsp;<span class="num" id="5603094">0</span><span class="op" id="5603095">;</span>&nbsp;<span class="ident" id="5603097">i</span>&nbsp;<span class="op" id="5603099">&lt;</span>&nbsp;<span class="builtinfunc" id="5603101">len</span><span class="op" id="5603104">(</span><span class="ident" id="5603105">r</span><span class="op" id="5603106">)</span><span class="op" id="5603107">;</span>&nbsp;<span class="ident" id="5603109">i</span>&nbsp;<span class="op" id="5603111">+=</span>&nbsp;<span class="num" id="5603114">2</span>&nbsp;<span class="op" id="5603116">{</span><br>
<span class="lineno">1825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603120">lo</span><span class="op" id="5603122">,</span>&nbsp;<span class="ident" id="5603124">hi</span>&nbsp;<span class="op" id="5603127">:=</span>&nbsp;<span class="ident" id="5603130">r</span><span class="op" id="5603131">[</span><span class="ident" id="5603132">i</span><span class="op" id="5603133">]</span><span class="op" id="5603134">,</span>&nbsp;<span class="ident" id="5603136">r</span><span class="op" id="5603137">[</span><span class="ident" id="5603138">i</span><span class="op" id="5603139">+</span><span class="num" id="5603140">1</span><span class="op" id="5603141">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603145">if</span>&nbsp;<span class="ident" id="5603148">nextLo</span>&nbsp;<span class="op" id="5603155">&lt;=</span>&nbsp;<span class="ident" id="5603158">lo</span><span class="op" id="5603160">-</span><span class="num" id="5603161">1</span>&nbsp;<span class="op" id="5603163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603168">r</span><span class="op" id="5603169">[</span><span class="ident" id="5603170">w</span><span class="op" id="5603171">]</span>&nbsp;<span class="op" id="5603173">=</span>&nbsp;<span class="ident" id="5603175">nextLo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603185">r</span><span class="op" id="5603186">[</span><span class="ident" id="5603187">w</span><span class="op" id="5603188">+</span><span class="num" id="5603189">1</span><span class="op" id="5603190">]</span>&nbsp;<span class="op" id="5603192">=</span>&nbsp;<span class="ident" id="5603194">lo</span>&nbsp;<span class="op" id="5603197">-</span>&nbsp;<span class="num" id="5603199">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603204">w</span>&nbsp;<span class="op" id="5603206">+=</span>&nbsp;<span class="num" id="5603209">2</span><br>
<span class="lineno">1830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5603213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603217">nextLo</span>&nbsp;<span class="op" id="5603224">=</span>&nbsp;<span class="ident" id="5603226">hi</span>&nbsp;<span class="op" id="5603229">+</span>&nbsp;<span class="num" id="5603231">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5603234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603237">r</span>&nbsp;<span class="op" id="5603239">=</span>&nbsp;<span class="ident" id="5603241">r</span><span class="op" id="5603242">[</span><span class="op" id="5603243">:</span><span class="ident" id="5603244">w</span><span class="op" id="5603245">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603248">if</span>&nbsp;<span class="ident" id="5603251">nextLo</span>&nbsp;<span class="op" id="5603258">&lt;=</span>&nbsp;<span class="ident" id="5603261">unicode</span><span class="op" id="5603268">.</span><span class="ident" id="5603269">MaxRune</span>&nbsp;<span class="op" id="5603277">{</span><br>
<span class="lineno">1835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5603281">//&nbsp;It&#39;s&nbsp;possible&nbsp;for&nbsp;the&nbsp;negation&nbsp;to&nbsp;have&nbsp;one&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5603334">//&nbsp;range&nbsp;-&nbsp;this&nbsp;one&nbsp;-&nbsp;than&nbsp;the&nbsp;original&nbsp;class,&nbsp;so&nbsp;use&nbsp;append.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603398">r</span>&nbsp;<span class="op" id="5603400">=</span>&nbsp;<span class="builtinfunc" id="5603402">append</span><span class="op" id="5603408">(</span><span class="ident" id="5603409">r</span><span class="op" id="5603410">,</span>&nbsp;<span class="ident" id="5603412">nextLo</span><span class="op" id="5603418">,</span>&nbsp;<span class="ident" id="5603420">unicode</span><span class="op" id="5603427">.</span><span class="ident" id="5603428">MaxRune</span><span class="op" id="5603435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5603438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603441">return</span>&nbsp;<span class="ident" id="5603448">r</span><br>
<span class="lineno">1840</span><span class="op" id="5603450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5603453">//&nbsp;ranges&nbsp;implements&nbsp;sort.Interface&nbsp;on&nbsp;a&nbsp;[]rune.</span><br>
<span class="lineno"></span><span class="comment" id="5603502">//&nbsp;The&nbsp;choice&nbsp;of&nbsp;receiver&nbsp;type&nbsp;definition&nbsp;is&nbsp;strange</span><br>
<span class="lineno"></span><span class="comment" id="5603555">//&nbsp;but&nbsp;avoids&nbsp;an&nbsp;allocation&nbsp;since&nbsp;we&nbsp;already&nbsp;have</span><br>
<span class="lineno">1845</span><span class="comment" id="5603605">//&nbsp;a&nbsp;*[]rune.</span><br>
<span class="lineno"></span><span class="keyword" id="5603619">type</span>&nbsp;<span class="ident" id="5603624">ranges</span>&nbsp;<span class="keyword" id="5603631">struct</span>&nbsp;<span class="op" id="5603638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603641">p</span>&nbsp;<span class="op" id="5603643">*</span><span class="op" id="5603644">[</span><span class="op" id="5603645">]</span><span class="builtintype" id="5603646">rune</span><br>
<span class="lineno"></span><span class="op" id="5603651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1850</span><span class="keyword" id="5603654">func</span>&nbsp;<span class="op" id="5603659">(</span><span class="ident" id="5603660">ra</span>&nbsp;<span class="ident" id="5603663">ranges</span><span class="op" id="5603669">)</span>&nbsp;<span class="ident" id="5603671">Less</span><span class="op" id="5603675">(</span><span class="ident" id="5603676">i</span><span class="op" id="5603677">,</span>&nbsp;<span class="ident" id="5603679">j</span>&nbsp;<span class="builtintype" id="5603681">int</span><span class="op" id="5603684">)</span>&nbsp;<span class="builtintype" id="5603686">bool</span>&nbsp;<span class="op" id="5603691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603694">p</span>&nbsp;<span class="op" id="5603696">:=</span>&nbsp;<span class="op" id="5603699">*</span><span class="ident" id="5603700">ra</span><span class="op" id="5603702">.</span><span class="ident" id="5603703">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603706">i</span>&nbsp;<span class="op" id="5603708">*=</span>&nbsp;<span class="num" id="5603711">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603714">j</span>&nbsp;<span class="op" id="5603716">*=</span>&nbsp;<span class="num" id="5603719">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603722">return</span>&nbsp;<span class="ident" id="5603729">p</span><span class="op" id="5603730">[</span><span class="ident" id="5603731">i</span><span class="op" id="5603732">]</span>&nbsp;<span class="op" id="5603734">&lt;</span>&nbsp;<span class="ident" id="5603736">p</span><span class="op" id="5603737">[</span><span class="ident" id="5603738">j</span><span class="op" id="5603739">]</span>&nbsp;<span class="op" id="5603741">||</span>&nbsp;<span class="ident" id="5603744">p</span><span class="op" id="5603745">[</span><span class="ident" id="5603746">i</span><span class="op" id="5603747">]</span>&nbsp;<span class="op" id="5603749">==</span>&nbsp;<span class="ident" id="5603752">p</span><span class="op" id="5603753">[</span><span class="ident" id="5603754">j</span><span class="op" id="5603755">]</span>&nbsp;<span class="op" id="5603757">&amp;&amp;</span>&nbsp;<span class="ident" id="5603760">p</span><span class="op" id="5603761">[</span><span class="ident" id="5603762">i</span><span class="op" id="5603763">+</span><span class="num" id="5603764">1</span><span class="op" id="5603765">]</span>&nbsp;<span class="op" id="5603767">&gt;</span>&nbsp;<span class="ident" id="5603769">p</span><span class="op" id="5603770">[</span><span class="ident" id="5603771">j</span><span class="op" id="5603772">+</span><span class="num" id="5603773">1</span><span class="op" id="5603774">]</span><br>
<span class="lineno">1855</span><span class="op" id="5603776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5603779">func</span>&nbsp;<span class="op" id="5603784">(</span><span class="ident" id="5603785">ra</span>&nbsp;<span class="ident" id="5603788">ranges</span><span class="op" id="5603794">)</span>&nbsp;<span class="ident" id="5603796">Len</span><span class="op" id="5603799">(</span><span class="op" id="5603800">)</span>&nbsp;<span class="builtintype" id="5603802">int</span>&nbsp;<span class="op" id="5603806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603809">return</span>&nbsp;<span class="builtinfunc" id="5603816">len</span><span class="op" id="5603819">(</span><span class="op" id="5603820">*</span><span class="ident" id="5603821">ra</span><span class="op" id="5603823">.</span><span class="ident" id="5603824">p</span><span class="op" id="5603825">)</span>&nbsp;<span class="op" id="5603827">/</span>&nbsp;<span class="num" id="5603829">2</span><br>
<span class="lineno"></span><span class="op" id="5603831">}</span><br>
<span class="lineno">1860</span><br>
<span class="lineno"></span><span class="keyword" id="5603834">func</span>&nbsp;<span class="op" id="5603839">(</span><span class="ident" id="5603840">ra</span>&nbsp;<span class="ident" id="5603843">ranges</span><span class="op" id="5603849">)</span>&nbsp;<span class="ident" id="5603851">Swap</span><span class="op" id="5603855">(</span><span class="ident" id="5603856">i</span><span class="op" id="5603857">,</span>&nbsp;<span class="ident" id="5603859">j</span>&nbsp;<span class="builtintype" id="5603861">int</span><span class="op" id="5603864">)</span>&nbsp;<span class="op" id="5603866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603869">p</span>&nbsp;<span class="op" id="5603871">:=</span>&nbsp;<span class="op" id="5603874">*</span><span class="ident" id="5603875">ra</span><span class="op" id="5603877">.</span><span class="ident" id="5603878">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603881">i</span>&nbsp;<span class="op" id="5603883">*=</span>&nbsp;<span class="num" id="5603886">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603889">j</span>&nbsp;<span class="op" id="5603891">*=</span>&nbsp;<span class="num" id="5603894">2</span><br>
<span class="lineno">1865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5603897">p</span><span class="op" id="5603898">[</span><span class="ident" id="5603899">i</span><span class="op" id="5603900">]</span><span class="op" id="5603901">,</span>&nbsp;<span class="ident" id="5603903">p</span><span class="op" id="5603904">[</span><span class="ident" id="5603905">i</span><span class="op" id="5603906">+</span><span class="num" id="5603907">1</span><span class="op" id="5603908">]</span><span class="op" id="5603909">,</span>&nbsp;<span class="ident" id="5603911">p</span><span class="op" id="5603912">[</span><span class="ident" id="5603913">j</span><span class="op" id="5603914">]</span><span class="op" id="5603915">,</span>&nbsp;<span class="ident" id="5603917">p</span><span class="op" id="5603918">[</span><span class="ident" id="5603919">j</span><span class="op" id="5603920">+</span><span class="num" id="5603921">1</span><span class="op" id="5603922">]</span>&nbsp;<span class="op" id="5603924">=</span>&nbsp;<span class="ident" id="5603926">p</span><span class="op" id="5603927">[</span><span class="ident" id="5603928">j</span><span class="op" id="5603929">]</span><span class="op" id="5603930">,</span>&nbsp;<span class="ident" id="5603932">p</span><span class="op" id="5603933">[</span><span class="ident" id="5603934">j</span><span class="op" id="5603935">+</span><span class="num" id="5603936">1</span><span class="op" id="5603937">]</span><span class="op" id="5603938">,</span>&nbsp;<span class="ident" id="5603940">p</span><span class="op" id="5603941">[</span><span class="ident" id="5603942">i</span><span class="op" id="5603943">]</span><span class="op" id="5603944">,</span>&nbsp;<span class="ident" id="5603946">p</span><span class="op" id="5603947">[</span><span class="ident" id="5603948">i</span><span class="op" id="5603949">+</span><span class="num" id="5603950">1</span><span class="op" id="5603951">]</span><br>
<span class="lineno"></span><span class="op" id="5603953">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5603956">func</span>&nbsp;<span class="ident" id="5603961">checkUTF8</span><span class="op" id="5603970">(</span><span class="ident" id="5603971">s</span>&nbsp;<span class="builtintype" id="5603973">string</span><span class="op" id="5603979">)</span>&nbsp;<span class="builtintype" id="5603981">error</span>&nbsp;<span class="op" id="5603987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5603990">for</span>&nbsp;<span class="ident" id="5603994">s</span>&nbsp;<span class="op" id="5603996">!=</span>&nbsp;<span class="string" id="5603999">&#34;&#34;</span>&nbsp;<span class="op" id="5604002">{</span><br>
<span class="lineno">1870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="5604006">rune</span><span class="op" id="5604010">,</span>&nbsp;<span class="ident" id="5604012">size</span>&nbsp;<span class="op" id="5604017">:=</span>&nbsp;<span class="ident" id="5604020">utf8</span><span class="op" id="5604024">.</span><span class="ident" id="5604025">DecodeRuneInString</span><span class="op" id="5604043">(</span><span class="ident" id="5604044">s</span><span class="op" id="5604045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604049">if</span>&nbsp;<span class="builtintype" id="5604052">rune</span>&nbsp;<span class="op" id="5604057">==</span>&nbsp;<span class="ident" id="5604060">utf8</span><span class="op" id="5604064">.</span><span class="ident" id="5604065">RuneError</span>&nbsp;<span class="op" id="5604075">&amp;&amp;</span>&nbsp;<span class="ident" id="5604078">size</span>&nbsp;<span class="op" id="5604083">==</span>&nbsp;<span class="num" id="5604086">1</span>&nbsp;<span class="op" id="5604088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604093">return</span>&nbsp;<span class="op" id="5604100">&amp;</span><span class="ident" id="5604101">Error</span><span class="op" id="5604106">{</span><span class="ident" id="5604107">Code</span><span class="op" id="5604111">:</span>&nbsp;<span class="ident" id="5604113">ErrInvalidUTF8</span><span class="op" id="5604127">,</span>&nbsp;<span class="ident" id="5604129">Expr</span><span class="op" id="5604133">:</span>&nbsp;<span class="ident" id="5604135">s</span><span class="op" id="5604136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5604140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604144">s</span>&nbsp;<span class="op" id="5604146">=</span>&nbsp;<span class="ident" id="5604148">s</span><span class="op" id="5604149">[</span><span class="ident" id="5604150">size</span><span class="op" id="5604154">:</span><span class="op" id="5604155">]</span><br>
<span class="lineno">1875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5604158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604161">return</span>&nbsp;<span class="ident" id="5604168">nil</span><br>
<span class="lineno"></span><span class="op" id="5604172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5604175">func</span>&nbsp;<span class="ident" id="5604180">nextRune</span><span class="op" id="5604188">(</span><span class="ident" id="5604189">s</span>&nbsp;<span class="builtintype" id="5604191">string</span><span class="op" id="5604197">)</span>&nbsp;<span class="op" id="5604199">(</span><span class="ident" id="5604200">c</span>&nbsp;<span class="builtintype" id="5604202">rune</span><span class="op" id="5604206">,</span>&nbsp;<span class="ident" id="5604208">t</span>&nbsp;<span class="builtintype" id="5604210">string</span><span class="op" id="5604216">,</span>&nbsp;<span class="ident" id="5604218">err</span>&nbsp;<span class="builtintype" id="5604222">error</span><span class="op" id="5604227">)</span>&nbsp;<span class="op" id="5604229">{</span><br>
<span class="lineno">1880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5604232">c</span><span class="op" id="5604233">,</span>&nbsp;<span class="ident" id="5604235">size</span>&nbsp;<span class="op" id="5604240">:=</span>&nbsp;<span class="ident" id="5604243">utf8</span><span class="op" id="5604247">.</span><span class="ident" id="5604248">DecodeRuneInString</span><span class="op" id="5604266">(</span><span class="ident" id="5604267">s</span><span class="op" id="5604268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604271">if</span>&nbsp;<span class="ident" id="5604274">c</span>&nbsp;<span class="op" id="5604276">==</span>&nbsp;<span class="ident" id="5604279">utf8</span><span class="op" id="5604283">.</span><span class="ident" id="5604284">RuneError</span>&nbsp;<span class="op" id="5604294">&amp;&amp;</span>&nbsp;<span class="ident" id="5604297">size</span>&nbsp;<span class="op" id="5604302">==</span>&nbsp;<span class="num" id="5604305">1</span>&nbsp;<span class="op" id="5604307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604311">return</span>&nbsp;<span class="num" id="5604318">0</span><span class="op" id="5604319">,</span>&nbsp;<span class="string" id="5604321">&#34;&#34;</span><span class="op" id="5604323">,</span>&nbsp;<span class="op" id="5604325">&amp;</span><span class="ident" id="5604326">Error</span><span class="op" id="5604331">{</span><span class="ident" id="5604332">Code</span><span class="op" id="5604336">:</span>&nbsp;<span class="ident" id="5604338">ErrInvalidUTF8</span><span class="op" id="5604352">,</span>&nbsp;<span class="ident" id="5604354">Expr</span><span class="op" id="5604358">:</span>&nbsp;<span class="ident" id="5604360">s</span><span class="op" id="5604361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5604364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604367">return</span>&nbsp;<span class="ident" id="5604374">c</span><span class="op" id="5604375">,</span>&nbsp;<span class="ident" id="5604377">s</span><span class="op" id="5604378">[</span><span class="ident" id="5604379">size</span><span class="op" id="5604383">:</span><span class="op" id="5604384">]</span><span class="op" id="5604385">,</span>&nbsp;<span class="ident" id="5604387">nil</span><br>
<span class="lineno">1885</span><span class="op" id="5604391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5604394">func</span>&nbsp;<span class="ident" id="5604399">isalnum</span><span class="op" id="5604406">(</span><span class="ident" id="5604407">c</span>&nbsp;<span class="builtintype" id="5604409">rune</span><span class="op" id="5604413">)</span>&nbsp;<span class="builtintype" id="5604415">bool</span>&nbsp;<span class="op" id="5604420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604423">return</span>&nbsp;<span class="string" id="5604430">&#39;0&#39;</span>&nbsp;<span class="op" id="5604434">&lt;=</span>&nbsp;<span class="ident" id="5604437">c</span>&nbsp;<span class="op" id="5604439">&amp;&amp;</span>&nbsp;<span class="ident" id="5604442">c</span>&nbsp;<span class="op" id="5604444">&lt;=</span>&nbsp;<span class="string" id="5604447">&#39;9&#39;</span>&nbsp;<span class="op" id="5604451">||</span>&nbsp;<span class="string" id="5604454">&#39;A&#39;</span>&nbsp;<span class="op" id="5604458">&lt;=</span>&nbsp;<span class="ident" id="5604461">c</span>&nbsp;<span class="op" id="5604463">&amp;&amp;</span>&nbsp;<span class="ident" id="5604466">c</span>&nbsp;<span class="op" id="5604468">&lt;=</span>&nbsp;<span class="string" id="5604471">&#39;Z&#39;</span>&nbsp;<span class="op" id="5604475">||</span>&nbsp;<span class="string" id="5604478">&#39;a&#39;</span>&nbsp;<span class="op" id="5604482">&lt;=</span>&nbsp;<span class="ident" id="5604485">c</span>&nbsp;<span class="op" id="5604487">&amp;&amp;</span>&nbsp;<span class="ident" id="5604490">c</span>&nbsp;<span class="op" id="5604492">&lt;=</span>&nbsp;<span class="string" id="5604495">&#39;z&#39;</span><br>
<span class="lineno"></span><span class="op" id="5604499">}</span><br>
<span class="lineno">1890</span><br>
<span class="lineno"></span><span class="keyword" id="5604502">func</span>&nbsp;<span class="ident" id="5604507">unhex</span><span class="op" id="5604512">(</span><span class="ident" id="5604513">c</span>&nbsp;<span class="builtintype" id="5604515">rune</span><span class="op" id="5604519">)</span>&nbsp;<span class="builtintype" id="5604521">rune</span>&nbsp;<span class="op" id="5604526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604529">if</span>&nbsp;<span class="string" id="5604532">&#39;0&#39;</span>&nbsp;<span class="op" id="5604536">&lt;=</span>&nbsp;<span class="ident" id="5604539">c</span>&nbsp;<span class="op" id="5604541">&amp;&amp;</span>&nbsp;<span class="ident" id="5604544">c</span>&nbsp;<span class="op" id="5604546">&lt;=</span>&nbsp;<span class="string" id="5604549">&#39;9&#39;</span>&nbsp;<span class="op" id="5604553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604557">return</span>&nbsp;<span class="ident" id="5604564">c</span>&nbsp;<span class="op" id="5604566">-</span>&nbsp;<span class="string" id="5604568">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5604573">}</span><br>
<span class="lineno">1895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604576">if</span>&nbsp;<span class="string" id="5604579">&#39;a&#39;</span>&nbsp;<span class="op" id="5604583">&lt;=</span>&nbsp;<span class="ident" id="5604586">c</span>&nbsp;<span class="op" id="5604588">&amp;&amp;</span>&nbsp;<span class="ident" id="5604591">c</span>&nbsp;<span class="op" id="5604593">&lt;=</span>&nbsp;<span class="string" id="5604596">&#39;f&#39;</span>&nbsp;<span class="op" id="5604600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604604">return</span>&nbsp;<span class="ident" id="5604611">c</span>&nbsp;<span class="op" id="5604613">-</span>&nbsp;<span class="string" id="5604615">&#39;a&#39;</span>&nbsp;<span class="op" id="5604619">+</span>&nbsp;<span class="num" id="5604621">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5604625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604628">if</span>&nbsp;<span class="string" id="5604631">&#39;A&#39;</span>&nbsp;<span class="op" id="5604635">&lt;=</span>&nbsp;<span class="ident" id="5604638">c</span>&nbsp;<span class="op" id="5604640">&amp;&amp;</span>&nbsp;<span class="ident" id="5604643">c</span>&nbsp;<span class="op" id="5604645">&lt;=</span>&nbsp;<span class="string" id="5604648">&#39;F&#39;</span>&nbsp;<span class="op" id="5604652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604656">return</span>&nbsp;<span class="ident" id="5604663">c</span>&nbsp;<span class="op" id="5604665">-</span>&nbsp;<span class="string" id="5604667">&#39;A&#39;</span>&nbsp;<span class="op" id="5604671">+</span>&nbsp;<span class="num" id="5604673">10</span><br>
<span class="lineno">1900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5604677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5604680">return</span>&nbsp;<span class="op" id="5604687">-</span><span class="num" id="5604688">1</span><br>
<span class="lineno"></span><span class="op" id="5604690">}</span>
</div>
</body>
</html>
