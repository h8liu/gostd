<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing</h2>
<ul>
<li><a href="/gostd/testing/allocs.go.html">allocs.go</a></li>
<li><a href="/gostd/testing/allocs_test.go.html">allocs_test.go</a></li>
<li><a href="/gostd/testing/benchmark.go.html">benchmark.go</a></li>
<li><a href="/gostd/testing/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/testing/cover.go.html">cover.go</a></li>
<li><a href="/gostd/testing/example.go.html">example.go</a></li>
<li><a href="/gostd/testing/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/testing/testing.go.html">testing.go</a></li>
<li><a href="/gostd/testing/testing_test.go.html">testing_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6413911">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6413966">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6414020">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6414071">package</span>&nbsp;<span class="ident" id="6414079">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6414088">import</span>&nbsp;<span class="op" id="6414095">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6414098">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6414106">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6414113">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6414119">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6414130">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6414138">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6414153">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6414160">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6414163">var</span>&nbsp;<span class="ident" id="6414167">matchBenchmarks</span>&nbsp;<span class="op" id="6414183">=</span>&nbsp;<span class="ident" id="6414185">flag</span><span class="op" id="6414189">.</span><span class="ident" id="6414190">String</span><span class="op" id="6414196">(</span><span class="string" id="6414197">&#34;test.bench&#34;</span><span class="op" id="6414209">,</span>&nbsp;<span class="string" id="6414211">&#34;&#34;</span><span class="op" id="6414213">,</span>&nbsp;<span class="string" id="6414215">&#34;regular&nbsp;expression&nbsp;to&nbsp;select&nbsp;benchmarks&nbsp;to&nbsp;run&#34;</span><span class="op" id="6414263">)</span><br>
<span class="lineno"></span><span class="keyword" id="6414265">var</span>&nbsp;<span class="ident" id="6414269">benchTime</span>&nbsp;<span class="op" id="6414279">=</span>&nbsp;<span class="ident" id="6414281">flag</span><span class="op" id="6414285">.</span><span class="ident" id="6414286">Duration</span><span class="op" id="6414294">(</span><span class="string" id="6414295">&#34;test.benchtime&#34;</span><span class="op" id="6414311">,</span>&nbsp;<span class="num" id="6414313">1</span><span class="op" id="6414314">*</span><span class="ident" id="6414315">time</span><span class="op" id="6414319">.</span><span class="ident" id="6414320">Second</span><span class="op" id="6414326">,</span>&nbsp;<span class="string" id="6414328">&#34;approximate&nbsp;run&nbsp;time&nbsp;for&nbsp;each&nbsp;benchmark&#34;</span><span class="op" id="6414369">)</span><br>
<span class="lineno"></span><span class="keyword" id="6414371">var</span>&nbsp;<span class="ident" id="6414375">benchmarkMemory</span>&nbsp;<span class="op" id="6414391">=</span>&nbsp;<span class="ident" id="6414393">flag</span><span class="op" id="6414397">.</span><span class="ident" id="6414398">Bool</span><span class="op" id="6414402">(</span><span class="string" id="6414403">&#34;test.benchmem&#34;</span><span class="op" id="6414418">,</span>&nbsp;<span class="builtintype" id="6414420">false</span><span class="op" id="6414425">,</span>&nbsp;<span class="string" id="6414427">&#34;print&nbsp;memory&nbsp;allocations&nbsp;for&nbsp;benchmarks&#34;</span><span class="op" id="6414468">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="6414471">//&nbsp;Global&nbsp;lock&nbsp;to&nbsp;ensure&nbsp;only&nbsp;one&nbsp;benchmark&nbsp;runs&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="6414531">var</span>&nbsp;<span class="ident" id="6414535">benchmarkLock</span>&nbsp;<span class="ident" id="6414549">sync</span><span class="op" id="6414553">.</span><span class="ident" id="6414554">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6414561">//&nbsp;Used&nbsp;for&nbsp;every&nbsp;benchmark&nbsp;for&nbsp;measuring&nbsp;memory.</span><br>
<span class="lineno">25</span><span class="keyword" id="6414611">var</span>&nbsp;<span class="ident" id="6414615">memStats</span>&nbsp;<span class="ident" id="6414624">runtime</span><span class="op" id="6414631">.</span><span class="ident" id="6414632">MemStats</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6414642">//&nbsp;An&nbsp;internal&nbsp;type&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6414731">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6414760">type</span>&nbsp;<span class="ident" id="6414765">InternalBenchmark</span>&nbsp;<span class="keyword" id="6414783">struct</span>&nbsp;<span class="op" id="6414790">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414793">Name</span>&nbsp;<span class="builtintype" id="6414798">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414806">F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6414811">func</span><span class="op" id="6414815">(</span><span class="ident" id="6414816">b</span>&nbsp;<span class="op" id="6414818">*</span><span class="ident" id="6414819">B</span><span class="op" id="6414820">)</span><br>
<span class="lineno"></span><span class="op" id="6414822">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6414825">//&nbsp;B&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;Benchmark&nbsp;functions&nbsp;to&nbsp;manage&nbsp;benchmark</span><br>
<span class="lineno">35</span><span class="comment" id="6414890">//&nbsp;timing&nbsp;and&nbsp;to&nbsp;specify&nbsp;the&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="6414948">type</span>&nbsp;<span class="ident" id="6414953">B</span>&nbsp;<span class="keyword" id="6414955">struct</span>&nbsp;<span class="op" id="6414962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414965">common</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414973">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6414990">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6414995">previousN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6415012">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6415026">//&nbsp;number&nbsp;of&nbsp;iterations&nbsp;in&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415071">previousDuration</span>&nbsp;<span class="ident" id="6415088">time</span><span class="op" id="6415092">.</span><span class="ident" id="6415093">Duration</span>&nbsp;<span class="comment" id="6415102">//&nbsp;total&nbsp;duration&nbsp;of&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415141">benchmark</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6415158">InternalBenchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415177">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6415194">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415201">timerOn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6415218">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415224">showAllocResult</span>&nbsp;&nbsp;<span class="builtintype" id="6415241">bool</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415247">result</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6415264">BenchmarkResult</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415281">parallelism</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6415298">int</span>&nbsp;<span class="comment" id="6415302">//&nbsp;RunParallel&nbsp;creates&nbsp;parallelism*GOMAXPROCS&nbsp;goroutines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6415360">//&nbsp;The&nbsp;initial&nbsp;states&nbsp;of&nbsp;memStats.Mallocs&nbsp;and&nbsp;memStats.TotalAlloc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415428">startAllocs</span>&nbsp;<span class="ident" id="6415440">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415448">startBytes</span>&nbsp;&nbsp;<span class="ident" id="6415460">uint64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6415468">//&nbsp;The&nbsp;net&nbsp;total&nbsp;of&nbsp;this&nbsp;test&nbsp;after&nbsp;being&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415516">netAllocs</span>&nbsp;<span class="ident" id="6415526">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415534">netBytes</span>&nbsp;&nbsp;<span class="ident" id="6415544">uint64</span><br>
<span class="lineno"></span><span class="op" id="6415551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="6415554">//&nbsp;StartTimer&nbsp;starts&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;function&nbsp;is&nbsp;called&nbsp;automatically</span><br>
<span class="lineno"></span><span class="comment" id="6415629">//&nbsp;before&nbsp;a&nbsp;benchmark&nbsp;starts,&nbsp;but&nbsp;it&nbsp;can&nbsp;also&nbsp;used&nbsp;to&nbsp;resume&nbsp;timing&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="6415703">//&nbsp;a&nbsp;call&nbsp;to&nbsp;StopTimer.</span><br>
<span class="lineno"></span><span class="keyword" id="6415727">func</span>&nbsp;<span class="op" id="6415732">(</span><span class="ident" id="6415733">b</span>&nbsp;<span class="op" id="6415735">*</span><span class="ident" id="6415736">B</span><span class="op" id="6415737">)</span>&nbsp;<span class="ident" id="6415739">StartTimer</span><span class="op" id="6415749">(</span><span class="op" id="6415750">)</span>&nbsp;<span class="op" id="6415752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6415755">if</span>&nbsp;<span class="op" id="6415758">!</span><span class="ident" id="6415759">b</span><span class="op" id="6415760">.</span><span class="ident" id="6415761">timerOn</span>&nbsp;<span class="op" id="6415769">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415773">runtime</span><span class="op" id="6415780">.</span><span class="ident" id="6415781">ReadMemStats</span><span class="op" id="6415793">(</span><span class="op" id="6415794">&amp;</span><span class="ident" id="6415795">memStats</span><span class="op" id="6415803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415807">b</span><span class="op" id="6415808">.</span><span class="ident" id="6415809">startAllocs</span>&nbsp;<span class="op" id="6415821">=</span>&nbsp;<span class="ident" id="6415823">memStats</span><span class="op" id="6415831">.</span><span class="ident" id="6415832">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415842">b</span><span class="op" id="6415843">.</span><span class="ident" id="6415844">startBytes</span>&nbsp;<span class="op" id="6415855">=</span>&nbsp;<span class="ident" id="6415857">memStats</span><span class="op" id="6415865">.</span><span class="ident" id="6415866">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415879">b</span><span class="op" id="6415880">.</span><span class="ident" id="6415881">start</span>&nbsp;<span class="op" id="6415887">=</span>&nbsp;<span class="ident" id="6415889">time</span><span class="op" id="6415893">.</span><span class="ident" id="6415894">Now</span><span class="op" id="6415897">(</span><span class="op" id="6415898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6415902">b</span><span class="op" id="6415903">.</span><span class="ident" id="6415904">timerOn</span>&nbsp;<span class="op" id="6415912">=</span>&nbsp;<span class="builtintype" id="6415914">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6415920">}</span><br>
<span class="lineno"></span><span class="op" id="6415922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6415925">//&nbsp;StopTimer&nbsp;stops&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;pause&nbsp;the&nbsp;timer</span><br>
<span class="lineno"></span><span class="comment" id="6415996">//&nbsp;while&nbsp;performing&nbsp;complex&nbsp;initialization&nbsp;that&nbsp;you&nbsp;don&#39;t</span><br>
<span class="lineno">70</span><span class="comment" id="6416054">//&nbsp;want&nbsp;to&nbsp;measure.</span><br>
<span class="lineno"></span><span class="keyword" id="6416074">func</span>&nbsp;<span class="op" id="6416079">(</span><span class="ident" id="6416080">b</span>&nbsp;<span class="op" id="6416082">*</span><span class="ident" id="6416083">B</span><span class="op" id="6416084">)</span>&nbsp;<span class="ident" id="6416086">StopTimer</span><span class="op" id="6416095">(</span><span class="op" id="6416096">)</span>&nbsp;<span class="op" id="6416098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6416101">if</span>&nbsp;<span class="ident" id="6416104">b</span><span class="op" id="6416105">.</span><span class="ident" id="6416106">timerOn</span>&nbsp;<span class="op" id="6416114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416118">b</span><span class="op" id="6416119">.</span><span class="ident" id="6416120">duration</span>&nbsp;<span class="op" id="6416129">+=</span>&nbsp;<span class="ident" id="6416132">time</span><span class="op" id="6416136">.</span><span class="ident" id="6416137">Now</span><span class="op" id="6416140">(</span><span class="op" id="6416141">)</span><span class="op" id="6416142">.</span><span class="ident" id="6416143">Sub</span><span class="op" id="6416146">(</span><span class="ident" id="6416147">b</span><span class="op" id="6416148">.</span><span class="ident" id="6416149">start</span><span class="op" id="6416154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416158">runtime</span><span class="op" id="6416165">.</span><span class="ident" id="6416166">ReadMemStats</span><span class="op" id="6416178">(</span><span class="op" id="6416179">&amp;</span><span class="ident" id="6416180">memStats</span><span class="op" id="6416188">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416192">b</span><span class="op" id="6416193">.</span><span class="ident" id="6416194">netAllocs</span>&nbsp;<span class="op" id="6416204">+=</span>&nbsp;<span class="ident" id="6416207">memStats</span><span class="op" id="6416215">.</span><span class="ident" id="6416216">Mallocs</span>&nbsp;<span class="op" id="6416224">-</span>&nbsp;<span class="ident" id="6416226">b</span><span class="op" id="6416227">.</span><span class="ident" id="6416228">startAllocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416242">b</span><span class="op" id="6416243">.</span><span class="ident" id="6416244">netBytes</span>&nbsp;<span class="op" id="6416253">+=</span>&nbsp;<span class="ident" id="6416256">memStats</span><span class="op" id="6416264">.</span><span class="ident" id="6416265">TotalAlloc</span>&nbsp;<span class="op" id="6416276">-</span>&nbsp;<span class="ident" id="6416278">b</span><span class="op" id="6416279">.</span><span class="ident" id="6416280">startBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416293">b</span><span class="op" id="6416294">.</span><span class="ident" id="6416295">timerOn</span>&nbsp;<span class="op" id="6416303">=</span>&nbsp;<span class="builtintype" id="6416305">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6416312">}</span><br>
<span class="lineno"></span><span class="op" id="6416314">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="6416317">//&nbsp;ResetTimer&nbsp;zeros&nbsp;the&nbsp;elapsed&nbsp;benchmark&nbsp;time&nbsp;and&nbsp;memory&nbsp;allocation&nbsp;counters.</span><br>
<span class="lineno"></span><span class="comment" id="6416396">//&nbsp;It&nbsp;does&nbsp;not&nbsp;affect&nbsp;whether&nbsp;the&nbsp;timer&nbsp;is&nbsp;running.</span><br>
<span class="lineno"></span><span class="keyword" id="6416448">func</span>&nbsp;<span class="op" id="6416453">(</span><span class="ident" id="6416454">b</span>&nbsp;<span class="op" id="6416456">*</span><span class="ident" id="6416457">B</span><span class="op" id="6416458">)</span>&nbsp;<span class="ident" id="6416460">ResetTimer</span><span class="op" id="6416470">(</span><span class="op" id="6416471">)</span>&nbsp;<span class="op" id="6416473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6416476">if</span>&nbsp;<span class="ident" id="6416479">b</span><span class="op" id="6416480">.</span><span class="ident" id="6416481">timerOn</span>&nbsp;<span class="op" id="6416489">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416493">runtime</span><span class="op" id="6416500">.</span><span class="ident" id="6416501">ReadMemStats</span><span class="op" id="6416513">(</span><span class="op" id="6416514">&amp;</span><span class="ident" id="6416515">memStats</span><span class="op" id="6416523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416527">b</span><span class="op" id="6416528">.</span><span class="ident" id="6416529">startAllocs</span>&nbsp;<span class="op" id="6416541">=</span>&nbsp;<span class="ident" id="6416543">memStats</span><span class="op" id="6416551">.</span><span class="ident" id="6416552">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416562">b</span><span class="op" id="6416563">.</span><span class="ident" id="6416564">startBytes</span>&nbsp;<span class="op" id="6416575">=</span>&nbsp;<span class="ident" id="6416577">memStats</span><span class="op" id="6416585">.</span><span class="ident" id="6416586">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416599">b</span><span class="op" id="6416600">.</span><span class="ident" id="6416601">start</span>&nbsp;<span class="op" id="6416607">=</span>&nbsp;<span class="ident" id="6416609">time</span><span class="op" id="6416613">.</span><span class="ident" id="6416614">Now</span><span class="op" id="6416617">(</span><span class="op" id="6416618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6416621">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416624">b</span><span class="op" id="6416625">.</span><span class="ident" id="6416626">duration</span>&nbsp;<span class="op" id="6416635">=</span>&nbsp;<span class="num" id="6416637">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416640">b</span><span class="op" id="6416641">.</span><span class="ident" id="6416642">netAllocs</span>&nbsp;<span class="op" id="6416652">=</span>&nbsp;<span class="num" id="6416654">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6416657">b</span><span class="op" id="6416658">.</span><span class="ident" id="6416659">netBytes</span>&nbsp;<span class="op" id="6416668">=</span>&nbsp;<span class="num" id="6416670">0</span><br>
<span class="lineno"></span><span class="op" id="6416672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="6416675">//&nbsp;SetBytes&nbsp;records&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;processed&nbsp;in&nbsp;a&nbsp;single&nbsp;operation.</span><br>
<span class="lineno"></span><span class="comment" id="6416748">//&nbsp;If&nbsp;this&nbsp;is&nbsp;called,&nbsp;the&nbsp;benchmark&nbsp;will&nbsp;report&nbsp;ns/op&nbsp;and&nbsp;MB/s.</span><br>
<span class="lineno"></span><span class="keyword" id="6416812">func</span>&nbsp;<span class="op" id="6416817">(</span><span class="ident" id="6416818">b</span>&nbsp;<span class="op" id="6416820">*</span><span class="ident" id="6416821">B</span><span class="op" id="6416822">)</span>&nbsp;<span class="ident" id="6416824">SetBytes</span><span class="op" id="6416832">(</span><span class="ident" id="6416833">n</span>&nbsp;<span class="ident" id="6416835">int64</span><span class="op" id="6416840">)</span>&nbsp;<span class="op" id="6416842">{</span>&nbsp;<span class="ident" id="6416844">b</span><span class="op" id="6416845">.</span><span class="ident" id="6416846">bytes</span>&nbsp;<span class="op" id="6416852">=</span>&nbsp;<span class="ident" id="6416854">n</span>&nbsp;<span class="op" id="6416856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6416859">//&nbsp;ReportAllocs&nbsp;enables&nbsp;malloc&nbsp;statistics&nbsp;for&nbsp;this&nbsp;benchmark.</span><br>
<span class="lineno">100</span><span class="comment" id="6416921">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;setting&nbsp;-test.benchmem,&nbsp;but&nbsp;it&nbsp;only&nbsp;affects&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6416992">//&nbsp;benchmark&nbsp;function&nbsp;that&nbsp;calls&nbsp;ReportAllocs.</span><br>
<span class="lineno"></span><span class="keyword" id="6417039">func</span>&nbsp;<span class="op" id="6417044">(</span><span class="ident" id="6417045">b</span>&nbsp;<span class="op" id="6417047">*</span><span class="ident" id="6417048">B</span><span class="op" id="6417049">)</span>&nbsp;<span class="ident" id="6417051">ReportAllocs</span><span class="op" id="6417063">(</span><span class="op" id="6417064">)</span>&nbsp;<span class="op" id="6417066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417069">b</span><span class="op" id="6417070">.</span><span class="ident" id="6417071">showAllocResult</span>&nbsp;<span class="op" id="6417087">=</span>&nbsp;<span class="builtintype" id="6417089">true</span><br>
<span class="lineno"></span><span class="op" id="6417094">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6417097">func</span>&nbsp;<span class="op" id="6417102">(</span><span class="ident" id="6417103">b</span>&nbsp;<span class="op" id="6417105">*</span><span class="ident" id="6417106">B</span><span class="op" id="6417107">)</span>&nbsp;<span class="ident" id="6417109">nsPerOp</span><span class="op" id="6417116">(</span><span class="op" id="6417117">)</span>&nbsp;<span class="ident" id="6417119">int64</span>&nbsp;<span class="op" id="6417125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417128">if</span>&nbsp;<span class="ident" id="6417131">b</span><span class="op" id="6417132">.</span><span class="ident" id="6417133">N</span>&nbsp;<span class="op" id="6417135">&lt;=</span>&nbsp;<span class="num" id="6417138">0</span>&nbsp;<span class="op" id="6417140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417144">return</span>&nbsp;<span class="num" id="6417151">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6417154">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417157">return</span>&nbsp;<span class="ident" id="6417164">b</span><span class="op" id="6417165">.</span><span class="ident" id="6417166">duration</span><span class="op" id="6417174">.</span><span class="ident" id="6417175">Nanoseconds</span><span class="op" id="6417186">(</span><span class="op" id="6417187">)</span>&nbsp;<span class="op" id="6417189">/</span>&nbsp;<span class="ident" id="6417191">int64</span><span class="op" id="6417196">(</span><span class="ident" id="6417197">b</span><span class="op" id="6417198">.</span><span class="ident" id="6417199">N</span><span class="op" id="6417200">)</span><br>
<span class="lineno"></span><span class="op" id="6417202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6417205">//&nbsp;runN&nbsp;runs&nbsp;a&nbsp;single&nbsp;benchmark&nbsp;for&nbsp;the&nbsp;specified&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span><span class="keyword" id="6417277">func</span>&nbsp;<span class="op" id="6417282">(</span><span class="ident" id="6417283">b</span>&nbsp;<span class="op" id="6417285">*</span><span class="ident" id="6417286">B</span><span class="op" id="6417287">)</span>&nbsp;<span class="ident" id="6417289">runN</span><span class="op" id="6417293">(</span><span class="ident" id="6417294">n</span>&nbsp;<span class="builtintype" id="6417296">int</span><span class="op" id="6417299">)</span>&nbsp;<span class="op" id="6417301">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417304">benchmarkLock</span><span class="op" id="6417317">.</span><span class="ident" id="6417318">Lock</span><span class="op" id="6417322">(</span><span class="op" id="6417323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417326">defer</span>&nbsp;<span class="ident" id="6417332">benchmarkLock</span><span class="op" id="6417345">.</span><span class="ident" id="6417346">Unlock</span><span class="op" id="6417352">(</span><span class="op" id="6417353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6417356">//&nbsp;Try&nbsp;to&nbsp;get&nbsp;a&nbsp;comparable&nbsp;environment&nbsp;for&nbsp;each&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6417409">//&nbsp;by&nbsp;clearing&nbsp;garbage&nbsp;from&nbsp;previous&nbsp;runs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417453">runtime</span><span class="op" id="6417460">.</span><span class="ident" id="6417461">GC</span><span class="op" id="6417463">(</span><span class="op" id="6417464">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417467">b</span><span class="op" id="6417468">.</span><span class="ident" id="6417469">N</span>&nbsp;<span class="op" id="6417471">=</span>&nbsp;<span class="ident" id="6417473">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417476">b</span><span class="op" id="6417477">.</span><span class="ident" id="6417478">parallelism</span>&nbsp;<span class="op" id="6417490">=</span>&nbsp;<span class="num" id="6417492">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417495">b</span><span class="op" id="6417496">.</span><span class="ident" id="6417497">ResetTimer</span><span class="op" id="6417507">(</span><span class="op" id="6417508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417511">b</span><span class="op" id="6417512">.</span><span class="ident" id="6417513">StartTimer</span><span class="op" id="6417523">(</span><span class="op" id="6417524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417527">b</span><span class="op" id="6417528">.</span><span class="ident" id="6417529">benchmark</span><span class="op" id="6417538">.</span><span class="ident" id="6417539">F</span><span class="op" id="6417540">(</span><span class="ident" id="6417541">b</span><span class="op" id="6417542">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417545">b</span><span class="op" id="6417546">.</span><span class="ident" id="6417547">StopTimer</span><span class="op" id="6417556">(</span><span class="op" id="6417557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417560">b</span><span class="op" id="6417561">.</span><span class="ident" id="6417562">previousN</span>&nbsp;<span class="op" id="6417572">=</span>&nbsp;<span class="ident" id="6417574">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417577">b</span><span class="op" id="6417578">.</span><span class="ident" id="6417579">previousDuration</span>&nbsp;<span class="op" id="6417596">=</span>&nbsp;<span class="ident" id="6417598">b</span><span class="op" id="6417599">.</span><span class="ident" id="6417600">duration</span><br>
<span class="lineno"></span><span class="op" id="6417609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="6417612">func</span>&nbsp;<span class="ident" id="6417617">min</span><span class="op" id="6417620">(</span><span class="ident" id="6417621">x</span><span class="op" id="6417622">,</span>&nbsp;<span class="ident" id="6417624">y</span>&nbsp;<span class="builtintype" id="6417626">int</span><span class="op" id="6417629">)</span>&nbsp;<span class="builtintype" id="6417631">int</span>&nbsp;<span class="op" id="6417635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417638">if</span>&nbsp;<span class="ident" id="6417641">x</span>&nbsp;<span class="op" id="6417643">&gt;</span>&nbsp;<span class="ident" id="6417645">y</span>&nbsp;<span class="op" id="6417647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417651">return</span>&nbsp;<span class="ident" id="6417658">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6417661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417664">return</span>&nbsp;<span class="ident" id="6417671">x</span><br>
<span class="lineno">135</span><span class="op" id="6417673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6417676">func</span>&nbsp;<span class="ident" id="6417681">max</span><span class="op" id="6417684">(</span><span class="ident" id="6417685">x</span><span class="op" id="6417686">,</span>&nbsp;<span class="ident" id="6417688">y</span>&nbsp;<span class="builtintype" id="6417690">int</span><span class="op" id="6417693">)</span>&nbsp;<span class="builtintype" id="6417695">int</span>&nbsp;<span class="op" id="6417699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417702">if</span>&nbsp;<span class="ident" id="6417705">x</span>&nbsp;<span class="op" id="6417707">&lt;</span>&nbsp;<span class="ident" id="6417709">y</span>&nbsp;<span class="op" id="6417711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417715">return</span>&nbsp;<span class="ident" id="6417722">y</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6417725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417728">return</span>&nbsp;<span class="ident" id="6417735">x</span><br>
<span class="lineno"></span><span class="op" id="6417737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6417740">//&nbsp;roundDown10&nbsp;rounds&nbsp;a&nbsp;number&nbsp;down&nbsp;to&nbsp;the&nbsp;nearest&nbsp;power&nbsp;of&nbsp;10.</span><br>
<span class="lineno">145</span><span class="keyword" id="6417804">func</span>&nbsp;<span class="ident" id="6417809">roundDown10</span><span class="op" id="6417820">(</span><span class="ident" id="6417821">n</span>&nbsp;<span class="builtintype" id="6417823">int</span><span class="op" id="6417826">)</span>&nbsp;<span class="builtintype" id="6417828">int</span>&nbsp;<span class="op" id="6417832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417835">var</span>&nbsp;<span class="ident" id="6417839">tens</span>&nbsp;<span class="op" id="6417844">=</span>&nbsp;<span class="num" id="6417846">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6417849">//&nbsp;tens&nbsp;=&nbsp;floor(log_10(n))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417877">for</span>&nbsp;<span class="ident" id="6417881">n</span>&nbsp;<span class="op" id="6417883">&gt;=</span>&nbsp;<span class="num" id="6417886">10</span>&nbsp;<span class="op" id="6417889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417893">n</span>&nbsp;<span class="op" id="6417895">=</span>&nbsp;<span class="ident" id="6417897">n</span>&nbsp;<span class="op" id="6417899">/</span>&nbsp;<span class="num" id="6417901">10</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417906">tens</span><span class="op" id="6417910">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6417914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6417917">//&nbsp;result&nbsp;=&nbsp;10^tens</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417938">result</span>&nbsp;<span class="op" id="6417945">:=</span>&nbsp;<span class="num" id="6417948">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417951">for</span>&nbsp;<span class="ident" id="6417955">i</span>&nbsp;<span class="op" id="6417957">:=</span>&nbsp;<span class="num" id="6417960">0</span><span class="op" id="6417961">;</span>&nbsp;<span class="ident" id="6417963">i</span>&nbsp;<span class="op" id="6417965">&lt;</span>&nbsp;<span class="ident" id="6417967">tens</span><span class="op" id="6417971">;</span>&nbsp;<span class="ident" id="6417973">i</span><span class="op" id="6417974">++</span>&nbsp;<span class="op" id="6417977">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6417981">result</span>&nbsp;<span class="op" id="6417988">*=</span>&nbsp;<span class="num" id="6417991">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6417995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6417998">return</span>&nbsp;<span class="ident" id="6418005">result</span><br>
<span class="lineno"></span><span class="op" id="6418012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="6418015">//&nbsp;roundUp&nbsp;rounds&nbsp;x&nbsp;up&nbsp;to&nbsp;a&nbsp;number&nbsp;of&nbsp;the&nbsp;form&nbsp;[1eX,&nbsp;2eX,&nbsp;3eX,&nbsp;5eX].</span><br>
<span class="lineno"></span><span class="keyword" id="6418084">func</span>&nbsp;<span class="ident" id="6418089">roundUp</span><span class="op" id="6418096">(</span><span class="ident" id="6418097">n</span>&nbsp;<span class="builtintype" id="6418099">int</span><span class="op" id="6418102">)</span>&nbsp;<span class="builtintype" id="6418104">int</span>&nbsp;<span class="op" id="6418108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6418111">base</span>&nbsp;<span class="op" id="6418116">:=</span>&nbsp;<span class="ident" id="6418119">roundDown10</span><span class="op" id="6418130">(</span><span class="ident" id="6418131">n</span><span class="op" id="6418132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418135">switch</span>&nbsp;<span class="op" id="6418142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418145">case</span>&nbsp;<span class="ident" id="6418150">n</span>&nbsp;<span class="op" id="6418152">&lt;=</span>&nbsp;<span class="ident" id="6418155">base</span><span class="op" id="6418159">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418163">return</span>&nbsp;<span class="ident" id="6418170">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418176">case</span>&nbsp;<span class="ident" id="6418181">n</span>&nbsp;<span class="op" id="6418183">&lt;=</span>&nbsp;<span class="op" id="6418186">(</span><span class="num" id="6418187">2</span>&nbsp;<span class="op" id="6418189">*</span>&nbsp;<span class="ident" id="6418191">base</span><span class="op" id="6418195">)</span><span class="op" id="6418196">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418200">return</span>&nbsp;<span class="num" id="6418207">2</span>&nbsp;<span class="op" id="6418209">*</span>&nbsp;<span class="ident" id="6418211">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418217">case</span>&nbsp;<span class="ident" id="6418222">n</span>&nbsp;<span class="op" id="6418224">&lt;=</span>&nbsp;<span class="op" id="6418227">(</span><span class="num" id="6418228">3</span>&nbsp;<span class="op" id="6418230">*</span>&nbsp;<span class="ident" id="6418232">base</span><span class="op" id="6418236">)</span><span class="op" id="6418237">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418241">return</span>&nbsp;<span class="num" id="6418248">3</span>&nbsp;<span class="op" id="6418250">*</span>&nbsp;<span class="ident" id="6418252">base</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418258">case</span>&nbsp;<span class="ident" id="6418263">n</span>&nbsp;<span class="op" id="6418265">&lt;=</span>&nbsp;<span class="op" id="6418268">(</span><span class="num" id="6418269">5</span>&nbsp;<span class="op" id="6418271">*</span>&nbsp;<span class="ident" id="6418273">base</span><span class="op" id="6418277">)</span><span class="op" id="6418278">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418282">return</span>&nbsp;<span class="num" id="6418289">5</span>&nbsp;<span class="op" id="6418291">*</span>&nbsp;<span class="ident" id="6418293">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418299">default</span><span class="op" id="6418306">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418310">return</span>&nbsp;<span class="num" id="6418317">10</span>&nbsp;<span class="op" id="6418320">*</span>&nbsp;<span class="ident" id="6418322">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6418328">}</span><br>
<span class="lineno">175</span><span class="op" id="6418330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6418333">//&nbsp;run&nbsp;times&nbsp;the&nbsp;benchmark&nbsp;function&nbsp;in&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="6418394">func</span>&nbsp;<span class="op" id="6418399">(</span><span class="ident" id="6418400">b</span>&nbsp;<span class="op" id="6418402">*</span><span class="ident" id="6418403">B</span><span class="op" id="6418404">)</span>&nbsp;<span class="ident" id="6418406">run</span><span class="op" id="6418409">(</span><span class="op" id="6418410">)</span>&nbsp;<span class="ident" id="6418412">BenchmarkResult</span>&nbsp;<span class="op" id="6418428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418431">go</span>&nbsp;<span class="ident" id="6418434">b</span><span class="op" id="6418435">.</span><span class="ident" id="6418436">launch</span><span class="op" id="6418442">(</span><span class="op" id="6418443">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6418446">&lt;-</span><span class="ident" id="6418448">b</span><span class="op" id="6418449">.</span><span class="ident" id="6418450">signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418458">return</span>&nbsp;<span class="ident" id="6418465">b</span><span class="op" id="6418466">.</span><span class="ident" id="6418467">result</span><br>
<span class="lineno"></span><span class="op" id="6418474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6418477">//&nbsp;launch&nbsp;launches&nbsp;the&nbsp;benchmark&nbsp;function.&nbsp;&nbsp;It&nbsp;gradually&nbsp;increases&nbsp;the&nbsp;number</span><br>
<span class="lineno">185</span><span class="comment" id="6418555">//&nbsp;of&nbsp;benchmark&nbsp;iterations&nbsp;until&nbsp;the&nbsp;benchmark&nbsp;runs&nbsp;for&nbsp;the&nbsp;requested&nbsp;benchtime.</span><br>
<span class="lineno"></span><span class="comment" id="6418636">//&nbsp;It&nbsp;prints&nbsp;timing&nbsp;information&nbsp;in&nbsp;this&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="6418681">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptesting.BenchmarkHello&nbsp;&nbsp;&nbsp;&nbsp100000&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp19&nbsp;ns/op</span><br>
<span class="lineno"></span><span class="comment" id="6418725">//&nbsp;launch&nbsp;is&nbsp;run&nbsp;by&nbsp;the&nbsp;run&nbsp;function&nbsp;as&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="6418787">func</span>&nbsp;<span class="op" id="6418792">(</span><span class="ident" id="6418793">b</span>&nbsp;<span class="op" id="6418795">*</span><span class="ident" id="6418796">B</span><span class="op" id="6418797">)</span>&nbsp;<span class="ident" id="6418799">launch</span><span class="op" id="6418805">(</span><span class="op" id="6418806">)</span>&nbsp;<span class="op" id="6418808">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6418811">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;a&nbsp;single&nbsp;iteration&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;expensive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6418880">n</span>&nbsp;<span class="op" id="6418882">:=</span>&nbsp;<span class="num" id="6418885">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6418889">//&nbsp;Signal&nbsp;that&nbsp;we&#39;re&nbsp;done&nbsp;whether&nbsp;we&nbsp;return&nbsp;normally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6418943">//&nbsp;or&nbsp;by&nbsp;FailNow&#39;s&nbsp;runtime.Goexit.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6418979">defer</span>&nbsp;<span class="keyword" id="6418985">func</span><span class="op" id="6418989">(</span><span class="op" id="6418990">)</span>&nbsp;<span class="op" id="6418992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6418996">b</span><span class="op" id="6418997">.</span><span class="ident" id="6418998">signal</span>&nbsp;<span class="op" id="6419005">&lt;-</span>&nbsp;<span class="ident" id="6419008">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6419011">}</span><span class="op" id="6419012">(</span><span class="op" id="6419013">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419017">b</span><span class="op" id="6419018">.</span><span class="ident" id="6419019">runN</span><span class="op" id="6419023">(</span><span class="ident" id="6419024">n</span><span class="op" id="6419025">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6419028">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;at&nbsp;least&nbsp;the&nbsp;specified&nbsp;amount&nbsp;of&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419093">d</span>&nbsp;<span class="op" id="6419095">:=</span>&nbsp;<span class="op" id="6419098">*</span><span class="ident" id="6419099">benchTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6419110">for</span>&nbsp;<span class="op" id="6419114">!</span><span class="ident" id="6419115">b</span><span class="op" id="6419116">.</span><span class="ident" id="6419117">failed</span>&nbsp;<span class="op" id="6419124">&amp;&amp;</span>&nbsp;<span class="ident" id="6419127">b</span><span class="op" id="6419128">.</span><span class="ident" id="6419129">duration</span>&nbsp;<span class="op" id="6419138">&lt;</span>&nbsp;<span class="ident" id="6419140">d</span>&nbsp;<span class="op" id="6419142">&amp;&amp;</span>&nbsp;<span class="ident" id="6419145">n</span>&nbsp;<span class="op" id="6419147">&lt;</span>&nbsp;<span class="num" id="6419149">1e9</span>&nbsp;<span class="op" id="6419153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419157">last</span>&nbsp;<span class="op" id="6419162">:=</span>&nbsp;<span class="ident" id="6419165">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6419169">//&nbsp;Predict&nbsp;required&nbsp;iterations.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6419203">if</span>&nbsp;<span class="ident" id="6419206">b</span><span class="op" id="6419207">.</span><span class="ident" id="6419208">nsPerOp</span><span class="op" id="6419215">(</span><span class="op" id="6419216">)</span>&nbsp;<span class="op" id="6419218">==</span>&nbsp;<span class="num" id="6419221">0</span>&nbsp;<span class="op" id="6419223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419228">n</span>&nbsp;<span class="op" id="6419230">=</span>&nbsp;<span class="num" id="6419232">1e9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6419238">}</span>&nbsp;<span class="keyword" id="6419240">else</span>&nbsp;<span class="op" id="6419245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419250">n</span>&nbsp;<span class="op" id="6419252">=</span>&nbsp;<span class="builtintype" id="6419254">int</span><span class="op" id="6419257">(</span><span class="ident" id="6419258">d</span><span class="op" id="6419259">.</span><span class="ident" id="6419260">Nanoseconds</span><span class="op" id="6419271">(</span><span class="op" id="6419272">)</span>&nbsp;<span class="op" id="6419274">/</span>&nbsp;<span class="ident" id="6419276">b</span><span class="op" id="6419277">.</span><span class="ident" id="6419278">nsPerOp</span><span class="op" id="6419285">(</span><span class="op" id="6419286">)</span><span class="op" id="6419287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6419291">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6419295">//&nbsp;Run&nbsp;more&nbsp;iterations&nbsp;than&nbsp;we&nbsp;think&nbsp;we&#39;ll&nbsp;need&nbsp;(1.2x).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6419353">//&nbsp;Don&#39;t&nbsp;grow&nbsp;too&nbsp;fast&nbsp;in&nbsp;case&nbsp;we&nbsp;had&nbsp;timing&nbsp;errors&nbsp;previously.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6419419">//&nbsp;Be&nbsp;sure&nbsp;to&nbsp;run&nbsp;at&nbsp;least&nbsp;one&nbsp;more&nbsp;than&nbsp;last&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419473">n</span>&nbsp;<span class="op" id="6419475">=</span>&nbsp;<span class="ident" id="6419477">max</span><span class="op" id="6419480">(</span><span class="ident" id="6419481">min</span><span class="op" id="6419484">(</span><span class="ident" id="6419485">n</span><span class="op" id="6419486">+</span><span class="ident" id="6419487">n</span><span class="op" id="6419488">/</span><span class="num" id="6419489">5</span><span class="op" id="6419490">,</span>&nbsp;<span class="num" id="6419492">100</span><span class="op" id="6419495">*</span><span class="ident" id="6419496">last</span><span class="op" id="6419500">)</span><span class="op" id="6419501">,</span>&nbsp;<span class="ident" id="6419503">last</span><span class="op" id="6419507">+</span><span class="num" id="6419508">1</span><span class="op" id="6419509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6419513">//&nbsp;Round&nbsp;up&nbsp;to&nbsp;something&nbsp;easy&nbsp;to&nbsp;read.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419554">n</span>&nbsp;<span class="op" id="6419556">=</span>&nbsp;<span class="ident" id="6419558">roundUp</span><span class="op" id="6419565">(</span><span class="ident" id="6419566">n</span><span class="op" id="6419567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419571">b</span><span class="op" id="6419572">.</span><span class="ident" id="6419573">runN</span><span class="op" id="6419577">(</span><span class="ident" id="6419578">n</span><span class="op" id="6419579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6419582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419585">b</span><span class="op" id="6419586">.</span><span class="ident" id="6419587">result</span>&nbsp;<span class="op" id="6419594">=</span>&nbsp;<span class="ident" id="6419596">BenchmarkResult</span><span class="op" id="6419611">{</span><span class="ident" id="6419612">b</span><span class="op" id="6419613">.</span><span class="ident" id="6419614">N</span><span class="op" id="6419615">,</span>&nbsp;<span class="ident" id="6419617">b</span><span class="op" id="6419618">.</span><span class="ident" id="6419619">duration</span><span class="op" id="6419627">,</span>&nbsp;<span class="ident" id="6419629">b</span><span class="op" id="6419630">.</span><span class="ident" id="6419631">bytes</span><span class="op" id="6419636">,</span>&nbsp;<span class="ident" id="6419638">b</span><span class="op" id="6419639">.</span><span class="ident" id="6419640">netAllocs</span><span class="op" id="6419649">,</span>&nbsp;<span class="ident" id="6419651">b</span><span class="op" id="6419652">.</span><span class="ident" id="6419653">netBytes</span><span class="op" id="6419661">}</span><br>
<span class="lineno"></span><span class="op" id="6419663">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="6419666">//&nbsp;The&nbsp;results&nbsp;of&nbsp;a&nbsp;benchmark&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="6419701">type</span>&nbsp;<span class="ident" id="6419706">BenchmarkResult</span>&nbsp;<span class="keyword" id="6419722">struct</span>&nbsp;<span class="op" id="6419729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419732">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6419742">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6419756">//&nbsp;The&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419786">T</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6419796">time</span><span class="op" id="6419800">.</span><span class="ident" id="6419801">Duration</span>&nbsp;<span class="comment" id="6419810">//&nbsp;The&nbsp;total&nbsp;time&nbsp;taken.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419836">Bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6419846">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6419860">//&nbsp;Bytes&nbsp;processed&nbsp;in&nbsp;one&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419898">MemAllocs</span>&nbsp;<span class="ident" id="6419908">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6419922">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;memory&nbsp;allocations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6419966">MemBytes</span>&nbsp;&nbsp;<span class="ident" id="6419976">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6419990">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;bytes&nbsp;allocated.</span><br>
<span class="lineno"></span><span class="op" id="6420030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="6420033">func</span>&nbsp;<span class="op" id="6420038">(</span><span class="ident" id="6420039">r</span>&nbsp;<span class="ident" id="6420041">BenchmarkResult</span><span class="op" id="6420056">)</span>&nbsp;<span class="ident" id="6420058">NsPerOp</span><span class="op" id="6420065">(</span><span class="op" id="6420066">)</span>&nbsp;<span class="ident" id="6420068">int64</span>&nbsp;<span class="op" id="6420074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420077">if</span>&nbsp;<span class="ident" id="6420080">r</span><span class="op" id="6420081">.</span><span class="ident" id="6420082">N</span>&nbsp;<span class="op" id="6420084">&lt;=</span>&nbsp;<span class="num" id="6420087">0</span>&nbsp;<span class="op" id="6420089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420093">return</span>&nbsp;<span class="num" id="6420100">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6420103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420106">return</span>&nbsp;<span class="ident" id="6420113">r</span><span class="op" id="6420114">.</span><span class="ident" id="6420115">T</span><span class="op" id="6420116">.</span><span class="ident" id="6420117">Nanoseconds</span><span class="op" id="6420128">(</span><span class="op" id="6420129">)</span>&nbsp;<span class="op" id="6420131">/</span>&nbsp;<span class="ident" id="6420133">int64</span><span class="op" id="6420138">(</span><span class="ident" id="6420139">r</span><span class="op" id="6420140">.</span><span class="ident" id="6420141">N</span><span class="op" id="6420142">)</span><br>
<span class="lineno">235</span><span class="op" id="6420144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6420147">func</span>&nbsp;<span class="op" id="6420152">(</span><span class="ident" id="6420153">r</span>&nbsp;<span class="ident" id="6420155">BenchmarkResult</span><span class="op" id="6420170">)</span>&nbsp;<span class="ident" id="6420172">mbPerSec</span><span class="op" id="6420180">(</span><span class="op" id="6420181">)</span>&nbsp;<span class="builtintype" id="6420183">float64</span>&nbsp;<span class="op" id="6420191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420194">if</span>&nbsp;<span class="ident" id="6420197">r</span><span class="op" id="6420198">.</span><span class="ident" id="6420199">Bytes</span>&nbsp;<span class="op" id="6420205">&lt;=</span>&nbsp;<span class="num" id="6420208">0</span>&nbsp;<span class="op" id="6420210">||</span>&nbsp;<span class="ident" id="6420213">r</span><span class="op" id="6420214">.</span><span class="ident" id="6420215">T</span>&nbsp;<span class="op" id="6420217">&lt;=</span>&nbsp;<span class="num" id="6420220">0</span>&nbsp;<span class="op" id="6420222">||</span>&nbsp;<span class="ident" id="6420225">r</span><span class="op" id="6420226">.</span><span class="ident" id="6420227">N</span>&nbsp;<span class="op" id="6420229">&lt;=</span>&nbsp;<span class="num" id="6420232">0</span>&nbsp;<span class="op" id="6420234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420238">return</span>&nbsp;<span class="num" id="6420245">0</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6420248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420251">return</span>&nbsp;<span class="op" id="6420258">(</span><span class="builtintype" id="6420259">float64</span><span class="op" id="6420266">(</span><span class="ident" id="6420267">r</span><span class="op" id="6420268">.</span><span class="ident" id="6420269">Bytes</span><span class="op" id="6420274">)</span>&nbsp;<span class="op" id="6420276">*</span>&nbsp;<span class="builtintype" id="6420278">float64</span><span class="op" id="6420285">(</span><span class="ident" id="6420286">r</span><span class="op" id="6420287">.</span><span class="ident" id="6420288">N</span><span class="op" id="6420289">)</span>&nbsp;<span class="op" id="6420291">/</span>&nbsp;<span class="num" id="6420293">1e6</span><span class="op" id="6420296">)</span>&nbsp;<span class="op" id="6420298">/</span>&nbsp;<span class="ident" id="6420300">r</span><span class="op" id="6420301">.</span><span class="ident" id="6420302">T</span><span class="op" id="6420303">.</span><span class="ident" id="6420304">Seconds</span><span class="op" id="6420311">(</span><span class="op" id="6420312">)</span><br>
<span class="lineno"></span><span class="op" id="6420314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6420317">func</span>&nbsp;<span class="op" id="6420322">(</span><span class="ident" id="6420323">r</span>&nbsp;<span class="ident" id="6420325">BenchmarkResult</span><span class="op" id="6420340">)</span>&nbsp;<span class="ident" id="6420342">AllocsPerOp</span><span class="op" id="6420353">(</span><span class="op" id="6420354">)</span>&nbsp;<span class="ident" id="6420356">int64</span>&nbsp;<span class="op" id="6420362">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420365">if</span>&nbsp;<span class="ident" id="6420368">r</span><span class="op" id="6420369">.</span><span class="ident" id="6420370">N</span>&nbsp;<span class="op" id="6420372">&lt;=</span>&nbsp;<span class="num" id="6420375">0</span>&nbsp;<span class="op" id="6420377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420381">return</span>&nbsp;<span class="num" id="6420388">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6420391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420394">return</span>&nbsp;<span class="ident" id="6420401">int64</span><span class="op" id="6420406">(</span><span class="ident" id="6420407">r</span><span class="op" id="6420408">.</span><span class="ident" id="6420409">MemAllocs</span><span class="op" id="6420418">)</span>&nbsp;<span class="op" id="6420420">/</span>&nbsp;<span class="ident" id="6420422">int64</span><span class="op" id="6420427">(</span><span class="ident" id="6420428">r</span><span class="op" id="6420429">.</span><span class="ident" id="6420430">N</span><span class="op" id="6420431">)</span><br>
<span class="lineno"></span><span class="op" id="6420433">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="6420436">func</span>&nbsp;<span class="op" id="6420441">(</span><span class="ident" id="6420442">r</span>&nbsp;<span class="ident" id="6420444">BenchmarkResult</span><span class="op" id="6420459">)</span>&nbsp;<span class="ident" id="6420461">AllocedBytesPerOp</span><span class="op" id="6420478">(</span><span class="op" id="6420479">)</span>&nbsp;<span class="ident" id="6420481">int64</span>&nbsp;<span class="op" id="6420487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420490">if</span>&nbsp;<span class="ident" id="6420493">r</span><span class="op" id="6420494">.</span><span class="ident" id="6420495">N</span>&nbsp;<span class="op" id="6420497">&lt;=</span>&nbsp;<span class="num" id="6420500">0</span>&nbsp;<span class="op" id="6420502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420506">return</span>&nbsp;<span class="num" id="6420513">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6420516">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420519">return</span>&nbsp;<span class="ident" id="6420526">int64</span><span class="op" id="6420531">(</span><span class="ident" id="6420532">r</span><span class="op" id="6420533">.</span><span class="ident" id="6420534">MemBytes</span><span class="op" id="6420542">)</span>&nbsp;<span class="op" id="6420544">/</span>&nbsp;<span class="ident" id="6420546">int64</span><span class="op" id="6420551">(</span><span class="ident" id="6420552">r</span><span class="op" id="6420553">.</span><span class="ident" id="6420554">N</span><span class="op" id="6420555">)</span><br>
<span class="lineno"></span><span class="op" id="6420557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6420560">func</span>&nbsp;<span class="op" id="6420565">(</span><span class="ident" id="6420566">r</span>&nbsp;<span class="ident" id="6420568">BenchmarkResult</span><span class="op" id="6420583">)</span>&nbsp;<span class="ident" id="6420585">String</span><span class="op" id="6420591">(</span><span class="op" id="6420592">)</span>&nbsp;<span class="builtintype" id="6420594">string</span>&nbsp;<span class="op" id="6420601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420604">mbs</span>&nbsp;<span class="op" id="6420608">:=</span>&nbsp;<span class="ident" id="6420611">r</span><span class="op" id="6420612">.</span><span class="ident" id="6420613">mbPerSec</span><span class="op" id="6420621">(</span><span class="op" id="6420622">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420625">mb</span>&nbsp;<span class="op" id="6420628">:=</span>&nbsp;<span class="string" id="6420631">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420635">if</span>&nbsp;<span class="ident" id="6420638">mbs</span>&nbsp;<span class="op" id="6420642">!=</span>&nbsp;<span class="num" id="6420645">0</span>&nbsp;<span class="op" id="6420647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420651">mb</span>&nbsp;<span class="op" id="6420654">=</span>&nbsp;<span class="ident" id="6420656">fmt</span><span class="op" id="6420659">.</span><span class="ident" id="6420660">Sprintf</span><span class="op" id="6420667">(</span><span class="string" id="6420668">&#34;\t%7.2f&nbsp;MB/s&#34;</span><span class="op" id="6420682">,</span>&nbsp;<span class="ident" id="6420684">mbs</span><span class="op" id="6420687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6420690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420693">nsop</span>&nbsp;<span class="op" id="6420698">:=</span>&nbsp;<span class="ident" id="6420701">r</span><span class="op" id="6420702">.</span><span class="ident" id="6420703">NsPerOp</span><span class="op" id="6420710">(</span><span class="op" id="6420711">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420714">ns</span>&nbsp;<span class="op" id="6420717">:=</span>&nbsp;<span class="ident" id="6420720">fmt</span><span class="op" id="6420723">.</span><span class="ident" id="6420724">Sprintf</span><span class="op" id="6420731">(</span><span class="string" id="6420732">&#34;%10d&nbsp;ns/op&#34;</span><span class="op" id="6420744">,</span>&nbsp;<span class="ident" id="6420746">nsop</span><span class="op" id="6420750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420753">if</span>&nbsp;<span class="ident" id="6420756">r</span><span class="op" id="6420757">.</span><span class="ident" id="6420758">N</span>&nbsp;<span class="op" id="6420760">&gt;</span>&nbsp;<span class="num" id="6420762">0</span>&nbsp;<span class="op" id="6420764">&amp;&amp;</span>&nbsp;<span class="ident" id="6420767">nsop</span>&nbsp;<span class="op" id="6420772">&lt;</span>&nbsp;<span class="num" id="6420774">100</span>&nbsp;<span class="op" id="6420778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6420782">//&nbsp;The&nbsp;format&nbsp;specifiers&nbsp;here&nbsp;make&nbsp;sure&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6420829">//&nbsp;the&nbsp;ones&nbsp;digits&nbsp;line&nbsp;up&nbsp;for&nbsp;all&nbsp;three&nbsp;possible&nbsp;formats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6420890">if</span>&nbsp;<span class="ident" id="6420893">nsop</span>&nbsp;<span class="op" id="6420898">&lt;</span>&nbsp;<span class="num" id="6420900">10</span>&nbsp;<span class="op" id="6420903">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420908">ns</span>&nbsp;<span class="op" id="6420911">=</span>&nbsp;<span class="ident" id="6420913">fmt</span><span class="op" id="6420916">.</span><span class="ident" id="6420917">Sprintf</span><span class="op" id="6420924">(</span><span class="string" id="6420925">&#34;%13.2f&nbsp;ns/op&#34;</span><span class="op" id="6420939">,</span>&nbsp;<span class="builtintype" id="6420941">float64</span><span class="op" id="6420948">(</span><span class="ident" id="6420949">r</span><span class="op" id="6420950">.</span><span class="ident" id="6420951">T</span><span class="op" id="6420952">.</span><span class="ident" id="6420953">Nanoseconds</span><span class="op" id="6420964">(</span><span class="op" id="6420965">)</span><span class="op" id="6420966">)</span><span class="op" id="6420967">/</span><span class="builtintype" id="6420968">float64</span><span class="op" id="6420975">(</span><span class="ident" id="6420976">r</span><span class="op" id="6420977">.</span><span class="ident" id="6420978">N</span><span class="op" id="6420979">)</span><span class="op" id="6420980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6420984">}</span>&nbsp;<span class="keyword" id="6420986">else</span>&nbsp;<span class="op" id="6420991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6420996">ns</span>&nbsp;<span class="op" id="6420999">=</span>&nbsp;<span class="ident" id="6421001">fmt</span><span class="op" id="6421004">.</span><span class="ident" id="6421005">Sprintf</span><span class="op" id="6421012">(</span><span class="string" id="6421013">&#34;%12.1f&nbsp;ns/op&#34;</span><span class="op" id="6421027">,</span>&nbsp;<span class="builtintype" id="6421029">float64</span><span class="op" id="6421036">(</span><span class="ident" id="6421037">r</span><span class="op" id="6421038">.</span><span class="ident" id="6421039">T</span><span class="op" id="6421040">.</span><span class="ident" id="6421041">Nanoseconds</span><span class="op" id="6421052">(</span><span class="op" id="6421053">)</span><span class="op" id="6421054">)</span><span class="op" id="6421055">/</span><span class="builtintype" id="6421056">float64</span><span class="op" id="6421063">(</span><span class="ident" id="6421064">r</span><span class="op" id="6421065">.</span><span class="ident" id="6421066">N</span><span class="op" id="6421067">)</span><span class="op" id="6421068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421075">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421078">return</span>&nbsp;<span class="ident" id="6421085">fmt</span><span class="op" id="6421088">.</span><span class="ident" id="6421089">Sprintf</span><span class="op" id="6421096">(</span><span class="string" id="6421097">&#34;%8d\t%s%s&#34;</span><span class="op" id="6421108">,</span>&nbsp;<span class="ident" id="6421110">r</span><span class="op" id="6421111">.</span><span class="ident" id="6421112">N</span><span class="op" id="6421113">,</span>&nbsp;<span class="ident" id="6421115">ns</span><span class="op" id="6421117">,</span>&nbsp;<span class="ident" id="6421119">mb</span><span class="op" id="6421121">)</span><br>
<span class="lineno"></span><span class="op" id="6421123">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6421126">func</span>&nbsp;<span class="op" id="6421131">(</span><span class="ident" id="6421132">r</span>&nbsp;<span class="ident" id="6421134">BenchmarkResult</span><span class="op" id="6421149">)</span>&nbsp;<span class="ident" id="6421151">MemString</span><span class="op" id="6421160">(</span><span class="op" id="6421161">)</span>&nbsp;<span class="builtintype" id="6421163">string</span>&nbsp;<span class="op" id="6421170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421173">return</span>&nbsp;<span class="ident" id="6421180">fmt</span><span class="op" id="6421183">.</span><span class="ident" id="6421184">Sprintf</span><span class="op" id="6421191">(</span><span class="string" id="6421192">&#34;%8d&nbsp;B/op\t%8d&nbsp;allocs/op&#34;</span><span class="op" id="6421217">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421221">r</span><span class="op" id="6421222">.</span><span class="ident" id="6421223">AllocedBytesPerOp</span><span class="op" id="6421240">(</span><span class="op" id="6421241">)</span><span class="op" id="6421242">,</span>&nbsp;<span class="ident" id="6421244">r</span><span class="op" id="6421245">.</span><span class="ident" id="6421246">AllocsPerOp</span><span class="op" id="6421257">(</span><span class="op" id="6421258">)</span><span class="op" id="6421259">)</span><br>
<span class="lineno"></span><span class="op" id="6421261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6421264">//&nbsp;An&nbsp;internal&nbsp;function&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6421357">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno">285</span><span class="keyword" id="6421386">func</span>&nbsp;<span class="ident" id="6421391">RunBenchmarks</span><span class="op" id="6421404">(</span><span class="ident" id="6421405">matchString</span>&nbsp;<span class="keyword" id="6421417">func</span><span class="op" id="6421421">(</span><span class="ident" id="6421422">pat</span><span class="op" id="6421425">,</span>&nbsp;<span class="ident" id="6421427">str</span>&nbsp;<span class="builtintype" id="6421431">string</span><span class="op" id="6421437">)</span>&nbsp;<span class="op" id="6421439">(</span><span class="builtintype" id="6421440">bool</span><span class="op" id="6421444">,</span>&nbsp;<span class="builtintype" id="6421446">error</span><span class="op" id="6421451">)</span><span class="op" id="6421452">,</span>&nbsp;<span class="ident" id="6421454">benchmarks</span>&nbsp;<span class="op" id="6421465">[</span><span class="op" id="6421466">]</span><span class="ident" id="6421467">InternalBenchmark</span><span class="op" id="6421484">)</span>&nbsp;<span class="op" id="6421486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6421489">//&nbsp;If&nbsp;no&nbsp;flag&nbsp;was&nbsp;specified,&nbsp;don&#39;t&nbsp;run&nbsp;benchmarks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421541">if</span>&nbsp;<span class="builtinfunc" id="6421544">len</span><span class="op" id="6421547">(</span><span class="op" id="6421548">*</span><span class="ident" id="6421549">matchBenchmarks</span><span class="op" id="6421564">)</span>&nbsp;<span class="op" id="6421566">==</span>&nbsp;<span class="num" id="6421569">0</span>&nbsp;<span class="op" id="6421571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421575">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421583">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421586">for</span>&nbsp;<span class="ident" id="6421590">_</span><span class="op" id="6421591">,</span>&nbsp;<span class="ident" id="6421593">Benchmark</span>&nbsp;<span class="op" id="6421603">:=</span>&nbsp;<span class="keyword" id="6421606">range</span>&nbsp;<span class="ident" id="6421612">benchmarks</span>&nbsp;<span class="op" id="6421623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421627">matched</span><span class="op" id="6421634">,</span>&nbsp;<span class="ident" id="6421636">err</span>&nbsp;<span class="op" id="6421640">:=</span>&nbsp;<span class="ident" id="6421643">matchString</span><span class="op" id="6421654">(</span><span class="op" id="6421655">*</span><span class="ident" id="6421656">matchBenchmarks</span><span class="op" id="6421671">,</span>&nbsp;<span class="ident" id="6421673">Benchmark</span><span class="op" id="6421682">.</span><span class="ident" id="6421683">Name</span><span class="op" id="6421687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421691">if</span>&nbsp;<span class="ident" id="6421694">err</span>&nbsp;<span class="op" id="6421698">!=</span>&nbsp;<span class="ident" id="6421701">nil</span>&nbsp;<span class="op" id="6421705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421710">fmt</span><span class="op" id="6421713">.</span><span class="ident" id="6421714">Fprintf</span><span class="op" id="6421721">(</span><span class="ident" id="6421722">os</span><span class="op" id="6421724">.</span><span class="ident" id="6421725">Stderr</span><span class="op" id="6421731">,</span>&nbsp;<span class="string" id="6421733">&#34;testing:&nbsp;invalid&nbsp;regexp&nbsp;for&nbsp;-test.bench:&nbsp;%s\n&#34;</span><span class="op" id="6421780">,</span>&nbsp;<span class="ident" id="6421782">err</span><span class="op" id="6421785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421790">os</span><span class="op" id="6421792">.</span><span class="ident" id="6421793">Exit</span><span class="op" id="6421797">(</span><span class="num" id="6421798">1</span><span class="op" id="6421799">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421807">if</span>&nbsp;<span class="op" id="6421810">!</span><span class="ident" id="6421811">matched</span>&nbsp;<span class="op" id="6421819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421824">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6421839">for</span>&nbsp;<span class="ident" id="6421843">_</span><span class="op" id="6421844">,</span>&nbsp;<span class="ident" id="6421846">procs</span>&nbsp;<span class="op" id="6421852">:=</span>&nbsp;<span class="keyword" id="6421855">range</span>&nbsp;<span class="ident" id="6421861">cpuList</span>&nbsp;<span class="op" id="6421869">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421874">runtime</span><span class="op" id="6421881">.</span><span class="ident" id="6421882">GOMAXPROCS</span><span class="op" id="6421892">(</span><span class="ident" id="6421893">procs</span><span class="op" id="6421898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421903">b</span>&nbsp;<span class="op" id="6421905">:=</span>&nbsp;<span class="op" id="6421908">&amp;</span><span class="ident" id="6421909">B</span><span class="op" id="6421910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421916">common</span><span class="op" id="6421922">:</span>&nbsp;<span class="ident" id="6421924">common</span><span class="op" id="6421930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421937">signal</span><span class="op" id="6421943">:</span>&nbsp;<span class="builtinfunc" id="6421945">make</span><span class="op" id="6421949">(</span><span class="keyword" id="6421950">chan</span>&nbsp;<span class="keyword" id="6421955">interface</span><span class="op" id="6421964">{</span><span class="op" id="6421965">}</span><span class="op" id="6421966">)</span><span class="op" id="6421967">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6421973">}</span><span class="op" id="6421974">,</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6421980">benchmark</span><span class="op" id="6421989">:</span>&nbsp;<span class="ident" id="6421991">Benchmark</span><span class="op" id="6422000">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6422005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6422010">benchName</span>&nbsp;<span class="op" id="6422020">:=</span>&nbsp;<span class="ident" id="6422023">Benchmark</span><span class="op" id="6422032">.</span><span class="ident" id="6422033">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6422041">if</span>&nbsp;<span class="ident" id="6422044">procs</span>&nbsp;<span class="op" id="6422050">!=</span>&nbsp;<span class="num" id="6422053">1</span>&nbsp;<span class="op" id="6422055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6422061">benchName</span>&nbsp;<span class="op" id="6422071">=</span>&nbsp;<span class="ident" id="6422073">fmt</span><span class="op" id="6422076">.</span><span class="ident" id="6422077">Sprintf</span><span class="op" id="6422084">(</span><span class="string" id="6422085">&#34;%s-%d&#34;</span><span class="op" id="6422092">,</span>&nbsp;<span class="ident" id="6422094">Benchmark</span><span class="op" id="6422103">.</span><span class="ident" id="6422104">Name</span><span class="op" id="6422108">,</span>&nbsp;<span class="ident" id="6422110">procs</span><span class="op" id="6422115">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6422120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6422125">fmt</span><span class="op" id="6422128">.</span><span class="ident" id="6422129">Printf</span><span class="op" id="6422135">(</span><span class="string" id="6422136">&#34;%s\t&#34;</span><span class="op" id="6422142">,</span>&nbsp;<span class="ident" id="6422144">benchName</span><span class="op" id="6422153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6422158">r</span>&nbsp;<span class="op" id="6422160">:=</span>&nbsp;<span class="ident" id="6422163">b</span><span class="op" id="6422164">.</span><span class="ident" id="6422165">run</span><span class="op" id="6422168">(</span><span class="op" id="6422169">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6422174">if</span>&nbsp;<span class="ident" id="6422177">b</span><span class="op" id="6422178">.</span><span class="ident" id="6422179">failed</span>&nbsp;<span class="op" id="6422186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6422192">//&nbsp;The&nbsp;output&nbsp;could&nbsp;be&nbsp;very&nbsp;long&nbsp;here,&nbsp;but&nbsp;probably&nbsp;isn&#39;t.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6422255">//&nbsp;We&nbsp;print&nbsp;it&nbsp;all,&nbsp;regardless,&nbsp;because&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;trim&nbsp;the&nbsp;reason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6422332">//&nbsp;the&nbsp;benchmark&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6422361">fmt</span><span class="op" id="6422364">.</span><span class="ident" id="6422365">Printf</span><span class="op" id="6422371">(</span><span class="string" id="6422372">&#34;---&nbsp;FAIL:&nbsp;%s\n%s&#34;</span><span class="op" id="6422390">,</span>&nbsp;<span class="ident" id="6422392">benchName</span><span class="op" id="6422401">,</span>&nbsp;<span class="ident" id="6422403">b</span><span class="op" id="6422404">.</span><span class="ident" id="6422405">output</span><span class="op" id="6422411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6422417">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6422429">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6422434">results</span>&nbsp;<span class="op" id="6422442">:=</span>&nbsp;<span class="ident" id="6422445">r</span><span class="op" id="6422446">.</span><span class="ident" id="6422447">String</span><span class="op" id="6422453">(</span><span class="op" id="6422454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6422459">if</span>&nbsp;<span class="op" id="6422462">*</span><span class="ident" id="6422463">benchmarkMemory</span>&nbsp;<span class="op" id="6422479">||</span>&nbsp;<span class="ident" id="6422482">b</span><span class="op" id="6422483">.</span><span class="ident" id="6422484">showAllocResult</span>&nbsp;<span class="op" id="6422500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6422506">results</span>&nbsp;<span class="op" id="6422514">+=</span>&nbsp;<span class="string" id="6422517">&#34;\t&#34;</span>&nbsp;<span class="op" id="6422522">+</span>&nbsp;<span class="ident" id="6422524">r</span><span class="op" id="6422525">.</span><span class="ident" id="6422526">MemString</span><span class="op" id="6422535">(</span><span class="op" id="6422536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6422541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6422546">fmt</span><span class="op" id="6422549">.</span><span class="ident" id="6422550">Println</span><span class="op" id="6422557">(</span><span class="ident" id="6422558">results</span><span class="op" id="6422565">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6422570">//&nbsp;Unlike&nbsp;with&nbsp;tests,&nbsp;we&nbsp;ignore&nbsp;the&nbsp;-chatty&nbsp;flag&nbsp;and&nbsp;always&nbsp;print&nbsp;output&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6422650">//&nbsp;benchmarks&nbsp;since&nbsp;the&nbsp;output&nbsp;generation&nbsp;time&nbsp;will&nbsp;skew&nbsp;the&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6422723">if</span>&nbsp;<span class="builtinfunc" id="6422726">len</span><span class="op" id="6422729">(</span><span class="ident" id="6422730">b</span><span class="op" id="6422731">.</span><span class="ident" id="6422732">output</span><span class="op" id="6422738">)</span>&nbsp;<span class="op" id="6422740">&gt;</span>&nbsp;<span class="num" id="6422742">0</span>&nbsp;<span class="op" id="6422744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6422750">b</span><span class="op" id="6422751">.</span><span class="ident" id="6422752">trimOutput</span><span class="op" id="6422762">(</span><span class="op" id="6422763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6422769">fmt</span><span class="op" id="6422772">.</span><span class="ident" id="6422773">Printf</span><span class="op" id="6422779">(</span><span class="string" id="6422780">&#34;---&nbsp;BENCH:&nbsp;%s\n%s&#34;</span><span class="op" id="6422799">,</span>&nbsp;<span class="ident" id="6422801">benchName</span><span class="op" id="6422810">,</span>&nbsp;<span class="ident" id="6422812">b</span><span class="op" id="6422813">.</span><span class="ident" id="6422814">output</span><span class="op" id="6422820">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6422825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6422830">if</span>&nbsp;<span class="ident" id="6422833">p</span>&nbsp;<span class="op" id="6422835">:=</span>&nbsp;<span class="ident" id="6422838">runtime</span><span class="op" id="6422845">.</span><span class="ident" id="6422846">GOMAXPROCS</span><span class="op" id="6422856">(</span><span class="op" id="6422857">-</span><span class="num" id="6422858">1</span><span class="op" id="6422859">)</span><span class="op" id="6422860">;</span>&nbsp;<span class="ident" id="6422862">p</span>&nbsp;<span class="op" id="6422864">!=</span>&nbsp;<span class="ident" id="6422867">procs</span>&nbsp;<span class="op" id="6422873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6422879">fmt</span><span class="op" id="6422882">.</span><span class="ident" id="6422883">Fprintf</span><span class="op" id="6422890">(</span><span class="ident" id="6422891">os</span><span class="op" id="6422893">.</span><span class="ident" id="6422894">Stderr</span><span class="op" id="6422900">,</span>&nbsp;<span class="string" id="6422902">&#34;testing:&nbsp;%s&nbsp;left&nbsp;GOMAXPROCS&nbsp;set&nbsp;to&nbsp;%d\n&#34;</span><span class="op" id="6422943">,</span>&nbsp;<span class="ident" id="6422945">benchName</span><span class="op" id="6422954">,</span>&nbsp;<span class="ident" id="6422956">p</span><span class="op" id="6422957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6422962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6422966">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6422969">}</span><br>
<span class="lineno"></span><span class="op" id="6422971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6422974">//&nbsp;trimOutput&nbsp;shortens&nbsp;the&nbsp;output&nbsp;from&nbsp;a&nbsp;benchmark,&nbsp;which&nbsp;can&nbsp;be&nbsp;very&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="6423050">func</span>&nbsp;<span class="op" id="6423055">(</span><span class="ident" id="6423056">b</span>&nbsp;<span class="op" id="6423058">*</span><span class="ident" id="6423059">B</span><span class="op" id="6423060">)</span>&nbsp;<span class="ident" id="6423062">trimOutput</span><span class="op" id="6423072">(</span><span class="op" id="6423073">)</span>&nbsp;<span class="op" id="6423075">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6423078">//&nbsp;The&nbsp;output&nbsp;is&nbsp;likely&nbsp;to&nbsp;appear&nbsp;multiple&nbsp;times&nbsp;because&nbsp;the&nbsp;benchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6423150">//&nbsp;is&nbsp;run&nbsp;multiple&nbsp;times,&nbsp;but&nbsp;at&nbsp;least&nbsp;it&nbsp;will&nbsp;be&nbsp;seen.&nbsp;This&nbsp;is&nbsp;not&nbsp;a&nbsp;big&nbsp;deal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6423230">//&nbsp;because&nbsp;benchmarks&nbsp;rarely&nbsp;print,&nbsp;but&nbsp;just&nbsp;in&nbsp;case,&nbsp;we&nbsp;trim&nbsp;it&nbsp;if&nbsp;it&#39;s&nbsp;too&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6423314">const</span>&nbsp;<span class="ident" id="6423320">maxNewlines</span>&nbsp;<span class="op" id="6423332">=</span>&nbsp;<span class="num" id="6423334">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6423338">for</span>&nbsp;<span class="ident" id="6423342">nlCount</span><span class="op" id="6423349">,</span>&nbsp;<span class="ident" id="6423351">j</span>&nbsp;<span class="op" id="6423353">:=</span>&nbsp;<span class="num" id="6423356">0</span><span class="op" id="6423357">,</span>&nbsp;<span class="num" id="6423359">0</span><span class="op" id="6423360">;</span>&nbsp;<span class="ident" id="6423362">j</span>&nbsp;<span class="op" id="6423364">&lt;</span>&nbsp;<span class="builtinfunc" id="6423366">len</span><span class="op" id="6423369">(</span><span class="ident" id="6423370">b</span><span class="op" id="6423371">.</span><span class="ident" id="6423372">output</span><span class="op" id="6423378">)</span><span class="op" id="6423379">;</span>&nbsp;<span class="ident" id="6423381">j</span><span class="op" id="6423382">++</span>&nbsp;<span class="op" id="6423385">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6423389">if</span>&nbsp;<span class="ident" id="6423392">b</span><span class="op" id="6423393">.</span><span class="ident" id="6423394">output</span><span class="op" id="6423400">[</span><span class="ident" id="6423401">j</span><span class="op" id="6423402">]</span>&nbsp;<span class="op" id="6423404">==</span>&nbsp;<span class="string" id="6423407">&#39;\n&#39;</span>&nbsp;<span class="op" id="6423412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423417">nlCount</span><span class="op" id="6423424">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6423430">if</span>&nbsp;<span class="ident" id="6423433">nlCount</span>&nbsp;<span class="op" id="6423441">&gt;=</span>&nbsp;<span class="ident" id="6423444">maxNewlines</span>&nbsp;<span class="op" id="6423456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423462">b</span><span class="op" id="6423463">.</span><span class="ident" id="6423464">output</span>&nbsp;<span class="op" id="6423471">=</span>&nbsp;<span class="builtinfunc" id="6423473">append</span><span class="op" id="6423479">(</span><span class="ident" id="6423480">b</span><span class="op" id="6423481">.</span><span class="ident" id="6423482">output</span><span class="op" id="6423488">[</span><span class="op" id="6423489">:</span><span class="ident" id="6423490">j</span><span class="op" id="6423491">]</span><span class="op" id="6423492">,</span>&nbsp;<span class="string" id="6423494">&#34;\n\t...&nbsp;[output&nbsp;truncated]\n&#34;</span><span class="op" id="6423524">...</span><span class="op" id="6423527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6423533">break</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6423542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6423546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6423549">}</span><br>
<span class="lineno"></span><span class="op" id="6423551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="6423554">//&nbsp;A&nbsp;PB&nbsp;is&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;for&nbsp;running&nbsp;parallel&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="keyword" id="6423618">type</span>&nbsp;<span class="ident" id="6423623">PB</span>&nbsp;<span class="keyword" id="6423626">struct</span>&nbsp;<span class="op" id="6423633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423636">globalN</span>&nbsp;<span class="op" id="6423644">*</span><span class="ident" id="6423645">uint64</span>&nbsp;<span class="comment" id="6423652">//&nbsp;shared&nbsp;between&nbsp;all&nbsp;worker&nbsp;goroutines&nbsp;iteration&nbsp;counter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423711">grain</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6423719">uint64</span>&nbsp;&nbsp;<span class="comment" id="6423727">//&nbsp;acquire&nbsp;that&nbsp;many&nbsp;iterations&nbsp;from&nbsp;globalN&nbsp;at&nbsp;once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423781">cache</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6423789">uint64</span>&nbsp;&nbsp;<span class="comment" id="6423797">//&nbsp;local&nbsp;cache&nbsp;of&nbsp;acquired&nbsp;iterations</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6423836">bN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6423844">uint64</span>&nbsp;&nbsp;<span class="comment" id="6423852">//&nbsp;total&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;execute&nbsp;(b.N)</span><br>
<span class="lineno"></span><span class="op" id="6423899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6423902">//&nbsp;Next&nbsp;reports&nbsp;whether&nbsp;there&nbsp;are&nbsp;more&nbsp;iterations&nbsp;to&nbsp;execute.</span><br>
<span class="lineno"></span><span class="keyword" id="6423964">func</span>&nbsp;<span class="op" id="6423969">(</span><span class="ident" id="6423970">pb</span>&nbsp;<span class="op" id="6423973">*</span><span class="ident" id="6423974">PB</span><span class="op" id="6423976">)</span>&nbsp;<span class="ident" id="6423978">Next</span><span class="op" id="6423982">(</span><span class="op" id="6423983">)</span>&nbsp;<span class="builtintype" id="6423985">bool</span>&nbsp;<span class="op" id="6423990">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6423993">if</span>&nbsp;<span class="ident" id="6423996">pb</span><span class="op" id="6423998">.</span><span class="ident" id="6423999">cache</span>&nbsp;<span class="op" id="6424005">==</span>&nbsp;<span class="num" id="6424008">0</span>&nbsp;<span class="op" id="6424010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424014">n</span>&nbsp;<span class="op" id="6424016">:=</span>&nbsp;<span class="ident" id="6424019">atomic</span><span class="op" id="6424025">.</span><span class="ident" id="6424026">AddUint64</span><span class="op" id="6424035">(</span><span class="ident" id="6424036">pb</span><span class="op" id="6424038">.</span><span class="ident" id="6424039">globalN</span><span class="op" id="6424046">,</span>&nbsp;<span class="ident" id="6424048">pb</span><span class="op" id="6424050">.</span><span class="ident" id="6424051">grain</span><span class="op" id="6424056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424060">if</span>&nbsp;<span class="ident" id="6424063">n</span>&nbsp;<span class="op" id="6424065">&lt;=</span>&nbsp;<span class="ident" id="6424068">pb</span><span class="op" id="6424070">.</span><span class="ident" id="6424071">bN</span>&nbsp;<span class="op" id="6424074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424079">pb</span><span class="op" id="6424081">.</span><span class="ident" id="6424082">cache</span>&nbsp;<span class="op" id="6424088">=</span>&nbsp;<span class="ident" id="6424090">pb</span><span class="op" id="6424092">.</span><span class="ident" id="6424093">grain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6424101">}</span>&nbsp;<span class="keyword" id="6424103">else</span>&nbsp;<span class="keyword" id="6424108">if</span>&nbsp;<span class="ident" id="6424111">n</span>&nbsp;<span class="op" id="6424113">&lt;</span>&nbsp;<span class="ident" id="6424115">pb</span><span class="op" id="6424117">.</span><span class="ident" id="6424118">bN</span><span class="op" id="6424120">+</span><span class="ident" id="6424121">pb</span><span class="op" id="6424123">.</span><span class="ident" id="6424124">grain</span>&nbsp;<span class="op" id="6424130">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424135">pb</span><span class="op" id="6424137">.</span><span class="ident" id="6424138">cache</span>&nbsp;<span class="op" id="6424144">=</span>&nbsp;<span class="ident" id="6424146">pb</span><span class="op" id="6424148">.</span><span class="ident" id="6424149">bN</span>&nbsp;<span class="op" id="6424152">+</span>&nbsp;<span class="ident" id="6424154">pb</span><span class="op" id="6424156">.</span><span class="ident" id="6424157">grain</span>&nbsp;<span class="op" id="6424163">-</span>&nbsp;<span class="ident" id="6424165">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6424169">}</span>&nbsp;<span class="keyword" id="6424171">else</span>&nbsp;<span class="op" id="6424176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424181">return</span>&nbsp;<span class="builtintype" id="6424188">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6424196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6424199">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6424202">pb</span><span class="op" id="6424204">.</span><span class="ident" id="6424205">cache</span><span class="op" id="6424210">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6424214">return</span>&nbsp;<span class="builtintype" id="6424221">true</span><br>
<span class="lineno"></span><span class="op" id="6424226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6424229">//&nbsp;RunParallel&nbsp;runs&nbsp;a&nbsp;benchmark&nbsp;in&nbsp;parallel.</span><br>
<span class="lineno">380</span><span class="comment" id="6424274">//&nbsp;It&nbsp;creates&nbsp;multiple&nbsp;goroutines&nbsp;and&nbsp;distributes&nbsp;b.N&nbsp;iterations&nbsp;among&nbsp;them.</span><br>
<span class="lineno"></span><span class="comment" id="6424351">//&nbsp;The&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;defaults&nbsp;to&nbsp;GOMAXPROCS.&nbsp;To&nbsp;increase&nbsp;parallelism&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6424431">//&nbsp;non-CPU-bound&nbsp;benchmarks,&nbsp;call&nbsp;SetParallelism&nbsp;before&nbsp;RunParallel.</span><br>
<span class="lineno"></span><span class="comment" id="6424500">//&nbsp;RunParallel&nbsp;is&nbsp;usually&nbsp;used&nbsp;with&nbsp;the&nbsp;go&nbsp;test&nbsp;-cpu&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="6424559">//</span><br>
<span class="lineno">385</span><span class="comment" id="6424562">//&nbsp;The&nbsp;body&nbsp;function&nbsp;will&nbsp;be&nbsp;run&nbsp;in&nbsp;each&nbsp;goroutine.&nbsp;It&nbsp;should&nbsp;set&nbsp;up&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="6424635">//&nbsp;goroutine-local&nbsp;state&nbsp;and&nbsp;then&nbsp;iterate&nbsp;until&nbsp;pb.Next&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="6424706">//&nbsp;It&nbsp;should&nbsp;not&nbsp;use&nbsp;the&nbsp;StartTimer,&nbsp;StopTimer,&nbsp;or&nbsp;ResetTimer&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="6424779">//&nbsp;because&nbsp;they&nbsp;have&nbsp;global&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="6424815">func</span>&nbsp;<span class="op" id="6424820">(</span><span class="ident" id="6424821">b</span>&nbsp;<span class="op" id="6424823">*</span><span class="ident" id="6424824">B</span><span class="op" id="6424825">)</span>&nbsp;<span class="ident" id="6424827">RunParallel</span><span class="op" id="6424838">(</span><span class="ident" id="6424839">body</span>&nbsp;<span class="keyword" id="6424844">func</span><span class="op" id="6424848">(</span><span class="op" id="6424849">*</span><span class="ident" id="6424850">PB</span><span class="op" id="6424852">)</span><span class="op" id="6424853">)</span>&nbsp;<span class="op" id="6424855">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6424858">//&nbsp;Calculate&nbsp;grain&nbsp;size&nbsp;as&nbsp;number&nbsp;of&nbsp;iterations&nbsp;that&nbsp;take&nbsp;~100s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6424926">//&nbsp;100s&nbsp;is&nbsp;enough&nbsp;to&nbsp;amortize&nbsp;the&nbsp;overhead&nbsp;and&nbsp;provide&nbsp;sufficient</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6424995">//&nbsp;dynamic&nbsp;load&nbsp;balancing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425023">grain</span>&nbsp;<span class="op" id="6425029">:=</span>&nbsp;<span class="ident" id="6425032">uint64</span><span class="op" id="6425038">(</span><span class="num" id="6425039">0</span><span class="op" id="6425040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425043">if</span>&nbsp;<span class="ident" id="6425046">b</span><span class="op" id="6425047">.</span><span class="ident" id="6425048">previousN</span>&nbsp;<span class="op" id="6425058">&gt;</span>&nbsp;<span class="num" id="6425060">0</span>&nbsp;<span class="op" id="6425062">&amp;&amp;</span>&nbsp;<span class="ident" id="6425065">b</span><span class="op" id="6425066">.</span><span class="ident" id="6425067">previousDuration</span>&nbsp;<span class="op" id="6425084">&gt;</span>&nbsp;<span class="num" id="6425086">0</span>&nbsp;<span class="op" id="6425088">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425092">grain</span>&nbsp;<span class="op" id="6425098">=</span>&nbsp;<span class="num" id="6425100">1e5</span>&nbsp;<span class="op" id="6425104">*</span>&nbsp;<span class="ident" id="6425106">uint64</span><span class="op" id="6425112">(</span><span class="ident" id="6425113">b</span><span class="op" id="6425114">.</span><span class="ident" id="6425115">previousN</span><span class="op" id="6425124">)</span>&nbsp;<span class="op" id="6425126">/</span>&nbsp;<span class="ident" id="6425128">uint64</span><span class="op" id="6425134">(</span><span class="ident" id="6425135">b</span><span class="op" id="6425136">.</span><span class="ident" id="6425137">previousDuration</span><span class="op" id="6425153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6425156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425159">if</span>&nbsp;<span class="ident" id="6425162">grain</span>&nbsp;<span class="op" id="6425168">&lt;</span>&nbsp;<span class="num" id="6425170">1</span>&nbsp;<span class="op" id="6425172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425176">grain</span>&nbsp;<span class="op" id="6425182">=</span>&nbsp;<span class="num" id="6425184">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6425187">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6425190">//&nbsp;We&nbsp;expect&nbsp;the&nbsp;inner&nbsp;loop&nbsp;and&nbsp;function&nbsp;call&nbsp;to&nbsp;take&nbsp;at&nbsp;least&nbsp;10ns,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6425260">//&nbsp;so&nbsp;do&nbsp;not&nbsp;do&nbsp;more&nbsp;than&nbsp;100s/10ns=1e4&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425315">if</span>&nbsp;<span class="ident" id="6425318">grain</span>&nbsp;<span class="op" id="6425324">&gt;</span>&nbsp;<span class="num" id="6425326">1e4</span>&nbsp;<span class="op" id="6425330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425334">grain</span>&nbsp;<span class="op" id="6425340">=</span>&nbsp;<span class="num" id="6425342">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6425347">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425351">n</span>&nbsp;<span class="op" id="6425353">:=</span>&nbsp;<span class="ident" id="6425356">uint64</span><span class="op" id="6425362">(</span><span class="num" id="6425363">0</span><span class="op" id="6425364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425367">numProcs</span>&nbsp;<span class="op" id="6425376">:=</span>&nbsp;<span class="ident" id="6425379">b</span><span class="op" id="6425380">.</span><span class="ident" id="6425381">parallelism</span>&nbsp;<span class="op" id="6425393">*</span>&nbsp;<span class="ident" id="6425395">runtime</span><span class="op" id="6425402">.</span><span class="ident" id="6425403">GOMAXPROCS</span><span class="op" id="6425413">(</span><span class="num" id="6425414">0</span><span class="op" id="6425415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425418">var</span>&nbsp;<span class="ident" id="6425422">wg</span>&nbsp;<span class="ident" id="6425425">sync</span><span class="op" id="6425429">.</span><span class="ident" id="6425430">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425441">wg</span><span class="op" id="6425443">.</span><span class="ident" id="6425444">Add</span><span class="op" id="6425447">(</span><span class="ident" id="6425448">numProcs</span><span class="op" id="6425456">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425459">for</span>&nbsp;<span class="ident" id="6425463">p</span>&nbsp;<span class="op" id="6425465">:=</span>&nbsp;<span class="num" id="6425468">0</span><span class="op" id="6425469">;</span>&nbsp;<span class="ident" id="6425471">p</span>&nbsp;<span class="op" id="6425473">&lt;</span>&nbsp;<span class="ident" id="6425475">numProcs</span><span class="op" id="6425483">;</span>&nbsp;<span class="ident" id="6425485">p</span><span class="op" id="6425486">++</span>&nbsp;<span class="op" id="6425489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425493">go</span>&nbsp;<span class="keyword" id="6425496">func</span><span class="op" id="6425500">(</span><span class="op" id="6425501">)</span>&nbsp;<span class="op" id="6425503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425508">defer</span>&nbsp;<span class="ident" id="6425514">wg</span><span class="op" id="6425516">.</span><span class="ident" id="6425517">Done</span><span class="op" id="6425521">(</span><span class="op" id="6425522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425527">pb</span>&nbsp;<span class="op" id="6425530">:=</span>&nbsp;<span class="op" id="6425533">&amp;</span><span class="ident" id="6425534">PB</span><span class="op" id="6425536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425542">globalN</span><span class="op" id="6425549">:</span>&nbsp;<span class="op" id="6425551">&amp;</span><span class="ident" id="6425552">n</span><span class="op" id="6425553">,</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425559">grain</span><span class="op" id="6425564">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6425568">grain</span><span class="op" id="6425573">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425579">bN</span><span class="op" id="6425581">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6425588">uint64</span><span class="op" id="6425594">(</span><span class="ident" id="6425595">b</span><span class="op" id="6425596">.</span><span class="ident" id="6425597">N</span><span class="op" id="6425598">)</span><span class="op" id="6425599">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6425604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425609">body</span><span class="op" id="6425613">(</span><span class="ident" id="6425614">pb</span><span class="op" id="6425616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6425620">}</span><span class="op" id="6425621">(</span><span class="op" id="6425622">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6425625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425628">wg</span><span class="op" id="6425630">.</span><span class="ident" id="6425631">Wait</span><span class="op" id="6425635">(</span><span class="op" id="6425636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6425639">if</span>&nbsp;<span class="ident" id="6425642">n</span>&nbsp;<span class="op" id="6425644">&lt;=</span>&nbsp;<span class="ident" id="6425647">uint64</span><span class="op" id="6425653">(</span><span class="ident" id="6425654">b</span><span class="op" id="6425655">.</span><span class="ident" id="6425656">N</span><span class="op" id="6425657">)</span>&nbsp;<span class="op" id="6425659">&amp;&amp;</span>&nbsp;<span class="op" id="6425662">!</span><span class="ident" id="6425663">b</span><span class="op" id="6425664">.</span><span class="ident" id="6425665">Failed</span><span class="op" id="6425671">(</span><span class="op" id="6425672">)</span>&nbsp;<span class="op" id="6425674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6425678">b</span><span class="op" id="6425679">.</span><span class="ident" id="6425680">Fatal</span><span class="op" id="6425685">(</span><span class="string" id="6425686">&#34;RunParallel:&nbsp;body&nbsp;exited&nbsp;without&nbsp;pb.Next()&nbsp;==&nbsp;false&#34;</span><span class="op" id="6425739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6425742">}</span><br>
<span class="lineno">425</span><span class="op" id="6425744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6425747">//&nbsp;SetParallelism&nbsp;sets&nbsp;the&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;to&nbsp;p*GOMAXPROCS.</span><br>
<span class="lineno"></span><span class="comment" id="6425832">//&nbsp;There&nbsp;is&nbsp;usually&nbsp;no&nbsp;need&nbsp;to&nbsp;call&nbsp;SetParallelism&nbsp;for&nbsp;CPU-bound&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="comment" id="6425909">//&nbsp;If&nbsp;p&nbsp;is&nbsp;less&nbsp;than&nbsp;1,&nbsp;this&nbsp;call&nbsp;will&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">430</span><span class="keyword" id="6425964">func</span>&nbsp;<span class="op" id="6425969">(</span><span class="ident" id="6425970">b</span>&nbsp;<span class="op" id="6425972">*</span><span class="ident" id="6425973">B</span><span class="op" id="6425974">)</span>&nbsp;<span class="ident" id="6425976">SetParallelism</span><span class="op" id="6425990">(</span><span class="ident" id="6425991">p</span>&nbsp;<span class="builtintype" id="6425993">int</span><span class="op" id="6425996">)</span>&nbsp;<span class="op" id="6425998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426001">if</span>&nbsp;<span class="ident" id="6426004">p</span>&nbsp;<span class="op" id="6426006">&gt;=</span>&nbsp;<span class="num" id="6426009">1</span>&nbsp;<span class="op" id="6426011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6426015">b</span><span class="op" id="6426016">.</span><span class="ident" id="6426017">parallelism</span>&nbsp;<span class="op" id="6426029">=</span>&nbsp;<span class="ident" id="6426031">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6426034">}</span><br>
<span class="lineno"></span><span class="op" id="6426036">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="6426039">//&nbsp;Benchmark&nbsp;benchmarks&nbsp;a&nbsp;single&nbsp;function.&nbsp;Useful&nbsp;for&nbsp;creating</span><br>
<span class="lineno"></span><span class="comment" id="6426102">//&nbsp;custom&nbsp;benchmarks&nbsp;that&nbsp;do&nbsp;not&nbsp;use&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6426162">func</span>&nbsp;<span class="ident" id="6426167">Benchmark</span><span class="op" id="6426176">(</span><span class="ident" id="6426177">f</span>&nbsp;<span class="keyword" id="6426179">func</span><span class="op" id="6426183">(</span><span class="ident" id="6426184">b</span>&nbsp;<span class="op" id="6426186">*</span><span class="ident" id="6426187">B</span><span class="op" id="6426188">)</span><span class="op" id="6426189">)</span>&nbsp;<span class="ident" id="6426191">BenchmarkResult</span>&nbsp;<span class="op" id="6426207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6426210">b</span>&nbsp;<span class="op" id="6426212">:=</span>&nbsp;<span class="op" id="6426215">&amp;</span><span class="ident" id="6426216">B</span><span class="op" id="6426217">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6426221">common</span><span class="op" id="6426227">:</span>&nbsp;<span class="ident" id="6426229">common</span><span class="op" id="6426235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6426240">signal</span><span class="op" id="6426246">:</span>&nbsp;<span class="builtinfunc" id="6426248">make</span><span class="op" id="6426252">(</span><span class="keyword" id="6426253">chan</span>&nbsp;<span class="keyword" id="6426258">interface</span><span class="op" id="6426267">{</span><span class="op" id="6426268">}</span><span class="op" id="6426269">)</span><span class="op" id="6426270">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6426274">}</span><span class="op" id="6426275">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6426279">benchmark</span><span class="op" id="6426288">:</span>&nbsp;<span class="ident" id="6426290">InternalBenchmark</span><span class="op" id="6426307">{</span><span class="string" id="6426308">&#34;&#34;</span><span class="op" id="6426310">,</span>&nbsp;<span class="ident" id="6426312">f</span><span class="op" id="6426313">}</span><span class="op" id="6426314">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6426317">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6426320">return</span>&nbsp;<span class="ident" id="6426327">b</span><span class="op" id="6426328">.</span><span class="ident" id="6426329">run</span><span class="op" id="6426332">(</span><span class="op" id="6426333">)</span><br>
<span class="lineno"></span><span class="op" id="6426335">}</span>
</div>
</body>
</html>
