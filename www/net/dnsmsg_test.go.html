<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7421225">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7421280">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7421334">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7421385">package</span>&nbsp;<span class="ident" id="7421393">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7421398">import</span>&nbsp;<span class="op" id="7421405">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7421408">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7421424">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7421435">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7421445">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7421448">func</span>&nbsp;<span class="ident" id="7421453">TestDNSParseSRVReply</span><span class="op" id="7421473">(</span><span class="ident" id="7421474">t</span>&nbsp;<span class="op" id="7421476">*</span><span class="ident" id="7421477">testing</span><span class="op" id="7421484">.</span><span class="ident" id="7421485">T</span><span class="op" id="7421486">)</span>&nbsp;<span class="op" id="7421488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7421491">data</span><span class="op" id="7421495">,</span>&nbsp;<span class="ident" id="7421497">err</span>&nbsp;<span class="op" id="7421501">:=</span>&nbsp;<span class="ident" id="7421504">hex</span><span class="op" id="7421507">.</span><span class="ident" id="7421508">DecodeString</span><span class="op" id="7421520">(</span><span class="ident" id="7421521">dnsSRVReply</span><span class="op" id="7421532">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7421535">if</span>&nbsp;<span class="ident" id="7421538">err</span>&nbsp;<span class="op" id="7421542">!=</span>&nbsp;<span class="ident" id="7421545">nil</span>&nbsp;<span class="op" id="7421549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7421553">t</span><span class="op" id="7421554">.</span><span class="ident" id="7421555">Fatal</span><span class="op" id="7421560">(</span><span class="ident" id="7421561">err</span><span class="op" id="7421564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7421567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7421570">msg</span>&nbsp;<span class="op" id="7421574">:=</span>&nbsp;<span class="builtinfunc" id="7421577">new</span><span class="op" id="7421580">(</span><span class="ident" id="7421581">dnsMsg</span><span class="op" id="7421587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7421590">ok</span>&nbsp;<span class="op" id="7421593">:=</span>&nbsp;<span class="ident" id="7421596">msg</span><span class="op" id="7421599">.</span><span class="ident" id="7421600">Unpack</span><span class="op" id="7421606">(</span><span class="ident" id="7421607">data</span><span class="op" id="7421611">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7421614">if</span>&nbsp;<span class="op" id="7421617">!</span><span class="ident" id="7421618">ok</span>&nbsp;<span class="op" id="7421621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7421625">t</span><span class="op" id="7421626">.</span><span class="ident" id="7421627">Fatalf</span><span class="op" id="7421633">(</span><span class="string" id="7421634">&#34;unpacking&nbsp;packet&nbsp;failed&#34;</span><span class="op" id="7421659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7421662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7421665">msg</span><span class="op" id="7421668">.</span><span class="ident" id="7421669">String</span><span class="op" id="7421675">(</span><span class="op" id="7421676">)</span>&nbsp;<span class="comment" id="7421678">//&nbsp;exercise&nbsp;this&nbsp;code&nbsp;path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7421706">if</span>&nbsp;<span class="ident" id="7421709">g</span><span class="op" id="7421710">,</span>&nbsp;<span class="ident" id="7421712">e</span>&nbsp;<span class="op" id="7421714">:=</span>&nbsp;<span class="builtinfunc" id="7421717">len</span><span class="op" id="7421720">(</span><span class="ident" id="7421721">msg</span><span class="op" id="7421724">.</span><span class="ident" id="7421725">answer</span><span class="op" id="7421731">)</span><span class="op" id="7421732">,</span>&nbsp;<span class="num" id="7421734">5</span><span class="op" id="7421735">;</span>&nbsp;<span class="ident" id="7421737">g</span>&nbsp;<span class="op" id="7421739">!=</span>&nbsp;<span class="ident" id="7421742">e</span>&nbsp;<span class="op" id="7421744">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7421748">t</span><span class="op" id="7421749">.</span><span class="ident" id="7421750">Errorf</span><span class="op" id="7421756">(</span><span class="string" id="7421757">&#34;len(msg.answer)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7421788">,</span>&nbsp;<span class="ident" id="7421790">g</span><span class="op" id="7421791">,</span>&nbsp;<span class="ident" id="7421793">e</span><span class="op" id="7421794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7421797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7421800">for</span>&nbsp;<span class="ident" id="7421804">idx</span><span class="op" id="7421807">,</span>&nbsp;<span class="ident" id="7421809">rr</span>&nbsp;<span class="op" id="7421812">:=</span>&nbsp;<span class="keyword" id="7421815">range</span>&nbsp;<span class="ident" id="7421821">msg</span><span class="op" id="7421824">.</span><span class="ident" id="7421825">answer</span>&nbsp;<span class="op" id="7421832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7421836">if</span>&nbsp;<span class="ident" id="7421839">g</span><span class="op" id="7421840">,</span>&nbsp;<span class="ident" id="7421842">e</span>&nbsp;<span class="op" id="7421844">:=</span>&nbsp;<span class="ident" id="7421847">rr</span><span class="op" id="7421849">.</span><span class="ident" id="7421850">Header</span><span class="op" id="7421856">(</span><span class="op" id="7421857">)</span><span class="op" id="7421858">.</span><span class="ident" id="7421859">Rrtype</span><span class="op" id="7421865">,</span>&nbsp;<span class="builtintype" id="7421867">uint16</span><span class="op" id="7421873">(</span><span class="ident" id="7421874">dnsTypeSRV</span><span class="op" id="7421884">)</span><span class="op" id="7421885">;</span>&nbsp;<span class="ident" id="7421887">g</span>&nbsp;<span class="op" id="7421889">!=</span>&nbsp;<span class="ident" id="7421892">e</span>&nbsp;<span class="op" id="7421894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7421899">t</span><span class="op" id="7421900">.</span><span class="ident" id="7421901">Errorf</span><span class="op" id="7421907">(</span><span class="string" id="7421908">&#34;rr[%d].Header().Rrtype&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7421946">,</span>&nbsp;<span class="ident" id="7421948">idx</span><span class="op" id="7421951">,</span>&nbsp;<span class="ident" id="7421953">g</span><span class="op" id="7421954">,</span>&nbsp;<span class="ident" id="7421956">e</span><span class="op" id="7421957">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7421961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7421965">if</span>&nbsp;<span class="ident" id="7421968">_</span><span class="op" id="7421969">,</span>&nbsp;<span class="ident" id="7421971">ok</span>&nbsp;<span class="op" id="7421974">:=</span>&nbsp;<span class="ident" id="7421977">rr</span><span class="op" id="7421979">.</span><span class="op" id="7421980">(</span><span class="op" id="7421981">*</span><span class="ident" id="7421982">dnsRR_SRV</span><span class="op" id="7421991">)</span><span class="op" id="7421992">;</span>&nbsp;<span class="op" id="7421994">!</span><span class="ident" id="7421995">ok</span>&nbsp;<span class="op" id="7421998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7422003">t</span><span class="op" id="7422004">.</span><span class="ident" id="7422005">Errorf</span><span class="op" id="7422011">(</span><span class="string" id="7422012">&#34;answer[%d]&nbsp;=&nbsp;%T;&nbsp;want&nbsp;*dnsRR_SRV&#34;</span><span class="op" id="7422046">,</span>&nbsp;<span class="ident" id="7422048">idx</span><span class="op" id="7422051">,</span>&nbsp;<span class="ident" id="7422053">rr</span><span class="op" id="7422055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7422059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7422062">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7422065">_</span><span class="op" id="7422066">,</span>&nbsp;<span class="ident" id="7422068">addrs</span><span class="op" id="7422073">,</span>&nbsp;<span class="ident" id="7422075">err</span>&nbsp;<span class="op" id="7422079">:=</span>&nbsp;<span class="ident" id="7422082">answer</span><span class="op" id="7422088">(</span><span class="string" id="7422089">&#34;_xmpp-server._tcp.google.com.&#34;</span><span class="op" id="7422120">,</span>&nbsp;<span class="string" id="7422122">&#34;foo:53&#34;</span><span class="op" id="7422130">,</span>&nbsp;<span class="ident" id="7422132">msg</span><span class="op" id="7422135">,</span>&nbsp;<span class="builtintype" id="7422137">uint16</span><span class="op" id="7422143">(</span><span class="ident" id="7422144">dnsTypeSRV</span><span class="op" id="7422154">)</span><span class="op" id="7422155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7422158">if</span>&nbsp;<span class="ident" id="7422161">err</span>&nbsp;<span class="op" id="7422165">!=</span>&nbsp;<span class="ident" id="7422168">nil</span>&nbsp;<span class="op" id="7422172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7422176">t</span><span class="op" id="7422177">.</span><span class="ident" id="7422178">Fatalf</span><span class="op" id="7422184">(</span><span class="string" id="7422185">&#34;answer:&nbsp;%v&#34;</span><span class="op" id="7422197">,</span>&nbsp;<span class="ident" id="7422199">err</span><span class="op" id="7422202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7422205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7422208">if</span>&nbsp;<span class="ident" id="7422211">g</span><span class="op" id="7422212">,</span>&nbsp;<span class="ident" id="7422214">e</span>&nbsp;<span class="op" id="7422216">:=</span>&nbsp;<span class="builtinfunc" id="7422219">len</span><span class="op" id="7422222">(</span><span class="ident" id="7422223">addrs</span><span class="op" id="7422228">)</span><span class="op" id="7422229">,</span>&nbsp;<span class="num" id="7422231">5</span><span class="op" id="7422232">;</span>&nbsp;<span class="ident" id="7422234">g</span>&nbsp;<span class="op" id="7422236">!=</span>&nbsp;<span class="ident" id="7422239">e</span>&nbsp;<span class="op" id="7422241">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7422245">t</span><span class="op" id="7422246">.</span><span class="ident" id="7422247">Errorf</span><span class="op" id="7422253">(</span><span class="string" id="7422254">&#34;len(addrs)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7422280">,</span>&nbsp;<span class="ident" id="7422282">g</span><span class="op" id="7422283">,</span>&nbsp;<span class="ident" id="7422285">e</span><span class="op" id="7422286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7422290">t</span><span class="op" id="7422291">.</span><span class="ident" id="7422292">Logf</span><span class="op" id="7422296">(</span><span class="string" id="7422297">&#34;addrs&nbsp;=&nbsp;%#v&#34;</span><span class="op" id="7422310">,</span>&nbsp;<span class="ident" id="7422312">addrs</span><span class="op" id="7422317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7422320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7422323">//&nbsp;repack&nbsp;and&nbsp;unpack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7422346">data2</span><span class="op" id="7422351">,</span>&nbsp;<span class="ident" id="7422353">ok</span>&nbsp;<span class="op" id="7422356">:=</span>&nbsp;<span class="ident" id="7422359">msg</span><span class="op" id="7422362">.</span><span class="ident" id="7422363">Pack</span><span class="op" id="7422367">(</span><span class="op" id="7422368">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7422371">msg2</span>&nbsp;<span class="op" id="7422376">:=</span>&nbsp;<span class="builtinfunc" id="7422379">new</span><span class="op" id="7422382">(</span><span class="ident" id="7422383">dnsMsg</span><span class="op" id="7422389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7422392">msg2</span><span class="op" id="7422396">.</span><span class="ident" id="7422397">Unpack</span><span class="op" id="7422403">(</span><span class="ident" id="7422404">data2</span><span class="op" id="7422409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7422412">switch</span>&nbsp;<span class="op" id="7422419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7422422">case</span>&nbsp;<span class="op" id="7422427">!</span><span class="ident" id="7422428">ok</span><span class="op" id="7422430">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7422434">t</span><span class="op" id="7422435">.</span><span class="ident" id="7422436">Errorf</span><span class="op" id="7422442">(</span><span class="string" id="7422443">&#34;failed&nbsp;to&nbsp;repack&nbsp;message&#34;</span><span class="op" id="7422469">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7422472">case</span>&nbsp;<span class="op" id="7422477">!</span><span class="ident" id="7422478">reflect</span><span class="op" id="7422485">.</span><span class="ident" id="7422486">DeepEqual</span><span class="op" id="7422495">(</span><span class="ident" id="7422496">msg</span><span class="op" id="7422499">,</span>&nbsp;<span class="ident" id="7422501">msg2</span><span class="op" id="7422505">)</span><span class="op" id="7422506">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7422510">t</span><span class="op" id="7422511">.</span><span class="ident" id="7422512">Errorf</span><span class="op" id="7422518">(</span><span class="string" id="7422519">&#34;repacked&nbsp;message&nbsp;differs&nbsp;from&nbsp;original&#34;</span><span class="op" id="7422559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7422562">}</span><br>
<span class="lineno"></span><span class="op" id="7422564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="7422567">func</span>&nbsp;<span class="ident" id="7422572">TestDNSParseCorruptSRVReply</span><span class="op" id="7422599">(</span><span class="ident" id="7422600">t</span>&nbsp;<span class="op" id="7422602">*</span><span class="ident" id="7422603">testing</span><span class="op" id="7422610">.</span><span class="ident" id="7422611">T</span><span class="op" id="7422612">)</span>&nbsp;<span class="op" id="7422614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7422617">data</span><span class="op" id="7422621">,</span>&nbsp;<span class="ident" id="7422623">err</span>&nbsp;<span class="op" id="7422627">:=</span>&nbsp;<span class="ident" id="7422630">hex</span><span class="op" id="7422633">.</span><span class="ident" id="7422634">DecodeString</span><span class="op" id="7422646">(</span><span class="ident" id="7422647">dnsSRVCorruptReply</span><span class="op" id="7422665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7422668">if</span>&nbsp;<span class="ident" id="7422671">err</span>&nbsp;<span class="op" id="7422675">!=</span>&nbsp;<span class="ident" id="7422678">nil</span>&nbsp;<span class="op" id="7422682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7422686">t</span><span class="op" id="7422687">.</span><span class="ident" id="7422688">Fatal</span><span class="op" id="7422693">(</span><span class="ident" id="7422694">err</span><span class="op" id="7422697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7422700">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7422703">msg</span>&nbsp;<span class="op" id="7422707">:=</span>&nbsp;<span class="builtinfunc" id="7422710">new</span><span class="op" id="7422713">(</span><span class="ident" id="7422714">dnsMsg</span><span class="op" id="7422720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7422723">ok</span>&nbsp;<span class="op" id="7422726">:=</span>&nbsp;<span class="ident" id="7422729">msg</span><span class="op" id="7422732">.</span><span class="ident" id="7422733">Unpack</span><span class="op" id="7422739">(</span><span class="ident" id="7422740">data</span><span class="op" id="7422744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7422747">if</span>&nbsp;<span class="op" id="7422750">!</span><span class="ident" id="7422751">ok</span>&nbsp;<span class="op" id="7422754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7422758">t</span><span class="op" id="7422759">.</span><span class="ident" id="7422760">Fatalf</span><span class="op" id="7422766">(</span><span class="string" id="7422767">&#34;unpacking&nbsp;packet&nbsp;failed&#34;</span><span class="op" id="7422792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7422795">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7422798">msg</span><span class="op" id="7422801">.</span><span class="ident" id="7422802">String</span><span class="op" id="7422808">(</span><span class="op" id="7422809">)</span>&nbsp;<span class="comment" id="7422811">//&nbsp;exercise&nbsp;this&nbsp;code&nbsp;path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7422839">if</span>&nbsp;<span class="ident" id="7422842">g</span><span class="op" id="7422843">,</span>&nbsp;<span class="ident" id="7422845">e</span>&nbsp;<span class="op" id="7422847">:=</span>&nbsp;<span class="builtinfunc" id="7422850">len</span><span class="op" id="7422853">(</span><span class="ident" id="7422854">msg</span><span class="op" id="7422857">.</span><span class="ident" id="7422858">answer</span><span class="op" id="7422864">)</span><span class="op" id="7422865">,</span>&nbsp;<span class="num" id="7422867">5</span><span class="op" id="7422868">;</span>&nbsp;<span class="ident" id="7422870">g</span>&nbsp;<span class="op" id="7422872">!=</span>&nbsp;<span class="ident" id="7422875">e</span>&nbsp;<span class="op" id="7422877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7422881">t</span><span class="op" id="7422882">.</span><span class="ident" id="7422883">Errorf</span><span class="op" id="7422889">(</span><span class="string" id="7422890">&#34;len(msg.answer)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7422921">,</span>&nbsp;<span class="ident" id="7422923">g</span><span class="op" id="7422924">,</span>&nbsp;<span class="ident" id="7422926">e</span><span class="op" id="7422927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7422930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7422933">for</span>&nbsp;<span class="ident" id="7422937">idx</span><span class="op" id="7422940">,</span>&nbsp;<span class="ident" id="7422942">rr</span>&nbsp;<span class="op" id="7422945">:=</span>&nbsp;<span class="keyword" id="7422948">range</span>&nbsp;<span class="ident" id="7422954">msg</span><span class="op" id="7422957">.</span><span class="ident" id="7422958">answer</span>&nbsp;<span class="op" id="7422965">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7422969">if</span>&nbsp;<span class="ident" id="7422972">g</span><span class="op" id="7422973">,</span>&nbsp;<span class="ident" id="7422975">e</span>&nbsp;<span class="op" id="7422977">:=</span>&nbsp;<span class="ident" id="7422980">rr</span><span class="op" id="7422982">.</span><span class="ident" id="7422983">Header</span><span class="op" id="7422989">(</span><span class="op" id="7422990">)</span><span class="op" id="7422991">.</span><span class="ident" id="7422992">Rrtype</span><span class="op" id="7422998">,</span>&nbsp;<span class="builtintype" id="7423000">uint16</span><span class="op" id="7423006">(</span><span class="ident" id="7423007">dnsTypeSRV</span><span class="op" id="7423017">)</span><span class="op" id="7423018">;</span>&nbsp;<span class="ident" id="7423020">g</span>&nbsp;<span class="op" id="7423022">!=</span>&nbsp;<span class="ident" id="7423025">e</span>&nbsp;<span class="op" id="7423027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7423032">t</span><span class="op" id="7423033">.</span><span class="ident" id="7423034">Errorf</span><span class="op" id="7423040">(</span><span class="string" id="7423041">&#34;rr[%d].Header().Rrtype&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7423079">,</span>&nbsp;<span class="ident" id="7423081">idx</span><span class="op" id="7423084">,</span>&nbsp;<span class="ident" id="7423086">g</span><span class="op" id="7423087">,</span>&nbsp;<span class="ident" id="7423089">e</span><span class="op" id="7423090">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7423094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7423098">if</span>&nbsp;<span class="ident" id="7423101">idx</span>&nbsp;<span class="op" id="7423105">==</span>&nbsp;<span class="num" id="7423108">4</span>&nbsp;<span class="op" id="7423110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7423115">if</span>&nbsp;<span class="ident" id="7423118">_</span><span class="op" id="7423119">,</span>&nbsp;<span class="ident" id="7423121">ok</span>&nbsp;<span class="op" id="7423124">:=</span>&nbsp;<span class="ident" id="7423127">rr</span><span class="op" id="7423129">.</span><span class="op" id="7423130">(</span><span class="op" id="7423131">*</span><span class="ident" id="7423132">dnsRR_Header</span><span class="op" id="7423144">)</span><span class="op" id="7423145">;</span>&nbsp;<span class="op" id="7423147">!</span><span class="ident" id="7423148">ok</span>&nbsp;<span class="op" id="7423151">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7423157">t</span><span class="op" id="7423158">.</span><span class="ident" id="7423159">Errorf</span><span class="op" id="7423165">(</span><span class="string" id="7423166">&#34;answer[%d]&nbsp;=&nbsp;%T;&nbsp;want&nbsp;*dnsRR_Header&#34;</span><span class="op" id="7423203">,</span>&nbsp;<span class="ident" id="7423205">idx</span><span class="op" id="7423208">,</span>&nbsp;<span class="ident" id="7423210">rr</span><span class="op" id="7423212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7423217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7423221">}</span>&nbsp;<span class="keyword" id="7423223">else</span>&nbsp;<span class="op" id="7423228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7423233">if</span>&nbsp;<span class="ident" id="7423236">_</span><span class="op" id="7423237">,</span>&nbsp;<span class="ident" id="7423239">ok</span>&nbsp;<span class="op" id="7423242">:=</span>&nbsp;<span class="ident" id="7423245">rr</span><span class="op" id="7423247">.</span><span class="op" id="7423248">(</span><span class="op" id="7423249">*</span><span class="ident" id="7423250">dnsRR_SRV</span><span class="op" id="7423259">)</span><span class="op" id="7423260">;</span>&nbsp;<span class="op" id="7423262">!</span><span class="ident" id="7423263">ok</span>&nbsp;<span class="op" id="7423266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7423272">t</span><span class="op" id="7423273">.</span><span class="ident" id="7423274">Errorf</span><span class="op" id="7423280">(</span><span class="string" id="7423281">&#34;answer[%d]&nbsp;=&nbsp;%T;&nbsp;want&nbsp;*dnsRR_SRV&#34;</span><span class="op" id="7423315">,</span>&nbsp;<span class="ident" id="7423317">idx</span><span class="op" id="7423320">,</span>&nbsp;<span class="ident" id="7423322">rr</span><span class="op" id="7423324">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7423329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7423333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7423336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7423339">_</span><span class="op" id="7423340">,</span>&nbsp;<span class="ident" id="7423342">addrs</span><span class="op" id="7423347">,</span>&nbsp;<span class="ident" id="7423349">err</span>&nbsp;<span class="op" id="7423353">:=</span>&nbsp;<span class="ident" id="7423356">answer</span><span class="op" id="7423362">(</span><span class="string" id="7423363">&#34;_xmpp-server._tcp.google.com.&#34;</span><span class="op" id="7423394">,</span>&nbsp;<span class="string" id="7423396">&#34;foo:53&#34;</span><span class="op" id="7423404">,</span>&nbsp;<span class="ident" id="7423406">msg</span><span class="op" id="7423409">,</span>&nbsp;<span class="builtintype" id="7423411">uint16</span><span class="op" id="7423417">(</span><span class="ident" id="7423418">dnsTypeSRV</span><span class="op" id="7423428">)</span><span class="op" id="7423429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7423432">if</span>&nbsp;<span class="ident" id="7423435">err</span>&nbsp;<span class="op" id="7423439">!=</span>&nbsp;<span class="ident" id="7423442">nil</span>&nbsp;<span class="op" id="7423446">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7423450">t</span><span class="op" id="7423451">.</span><span class="ident" id="7423452">Fatalf</span><span class="op" id="7423458">(</span><span class="string" id="7423459">&#34;answer:&nbsp;%v&#34;</span><span class="op" id="7423471">,</span>&nbsp;<span class="ident" id="7423473">err</span><span class="op" id="7423476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7423479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7423482">if</span>&nbsp;<span class="ident" id="7423485">g</span><span class="op" id="7423486">,</span>&nbsp;<span class="ident" id="7423488">e</span>&nbsp;<span class="op" id="7423490">:=</span>&nbsp;<span class="builtinfunc" id="7423493">len</span><span class="op" id="7423496">(</span><span class="ident" id="7423497">addrs</span><span class="op" id="7423502">)</span><span class="op" id="7423503">,</span>&nbsp;<span class="num" id="7423505">4</span><span class="op" id="7423506">;</span>&nbsp;<span class="ident" id="7423508">g</span>&nbsp;<span class="op" id="7423510">!=</span>&nbsp;<span class="ident" id="7423513">e</span>&nbsp;<span class="op" id="7423515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7423519">t</span><span class="op" id="7423520">.</span><span class="ident" id="7423521">Errorf</span><span class="op" id="7423527">(</span><span class="string" id="7423528">&#34;len(addrs)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7423554">,</span>&nbsp;<span class="ident" id="7423556">g</span><span class="op" id="7423557">,</span>&nbsp;<span class="ident" id="7423559">e</span><span class="op" id="7423560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7423564">t</span><span class="op" id="7423565">.</span><span class="ident" id="7423566">Logf</span><span class="op" id="7423570">(</span><span class="string" id="7423571">&#34;addrs&nbsp;=&nbsp;%#v&#34;</span><span class="op" id="7423584">,</span>&nbsp;<span class="ident" id="7423586">addrs</span><span class="op" id="7423591">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7423594">}</span><br>
<span class="lineno"></span><span class="op" id="7423596">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7423599">//&nbsp;Valid&nbsp;DNS&nbsp;SRV&nbsp;reply</span><br>
<span class="lineno"></span><span class="keyword" id="7423622">const</span>&nbsp;<span class="ident" id="7423628">dnsSRVReply</span>&nbsp;<span class="op" id="7423640">=</span>&nbsp;<span class="string" id="7423642">&#34;0901818000010005000000000c5f786d70702d736572766572045f74637006676f6f67&#34;</span>&nbsp;<span class="op" id="7423715">+</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7423718">&#34;6c6503636f6d0000210001c00c002100010000012c00210014000014950c786d70702d&#34;</span>&nbsp;<span class="op" id="7423791">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7423794">&#34;73657276657234016c06676f6f676c6503636f6d00c00c002100010000012c00210014&#34;</span>&nbsp;<span class="op" id="7423867">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7423870">&#34;000014950c786d70702d73657276657232016c06676f6f676c6503636f6d00c00c0021&#34;</span>&nbsp;<span class="op" id="7423943">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7423946">&#34;00010000012c00210014000014950c786d70702d73657276657233016c06676f6f676c&#34;</span>&nbsp;<span class="op" id="7424019">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7424022">&#34;6503636f6d00c00c002100010000012c00200005000014950b786d70702d7365727665&#34;</span>&nbsp;<span class="op" id="7424095">+</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7424098">&#34;72016c06676f6f676c6503636f6d00c00c002100010000012c00210014000014950c78&#34;</span>&nbsp;<span class="op" id="7424171">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7424174">&#34;6d70702d73657276657231016c06676f6f676c6503636f6d00&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7424228">//&nbsp;Corrupt&nbsp;DNS&nbsp;SRV&nbsp;reply,&nbsp;with&nbsp;its&nbsp;final&nbsp;RR&nbsp;having&nbsp;a&nbsp;bogus&nbsp;length</span><br>
<span class="lineno"></span><span class="comment" id="7424294">//&nbsp;(perhaps&nbsp;it&nbsp;was&nbsp;truncated,&nbsp;or&nbsp;it&#39;s&nbsp;malicious)&nbsp;The&nbsp;mutation&nbsp;is&nbsp;the</span><br>
<span class="lineno">105</span><span class="comment" id="7424363">//&nbsp;capital&nbsp;&#34;FF&#34;&nbsp;below,&nbsp;instead&nbsp;of&nbsp;the&nbsp;proper&nbsp;&#34;21&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="7424414">const</span>&nbsp;<span class="ident" id="7424420">dnsSRVCorruptReply</span>&nbsp;<span class="op" id="7424439">=</span>&nbsp;<span class="string" id="7424441">&#34;0901818000010005000000000c5f786d70702d736572766572045f74637006676f6f67&#34;</span>&nbsp;<span class="op" id="7424514">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7424517">&#34;6c6503636f6d0000210001c00c002100010000012c00210014000014950c786d70702d&#34;</span>&nbsp;<span class="op" id="7424590">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7424593">&#34;73657276657234016c06676f6f676c6503636f6d00c00c002100010000012c00210014&#34;</span>&nbsp;<span class="op" id="7424666">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7424669">&#34;000014950c786d70702d73657276657232016c06676f6f676c6503636f6d00c00c0021&#34;</span>&nbsp;<span class="op" id="7424742">+</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7424745">&#34;00010000012c00210014000014950c786d70702d73657276657233016c06676f6f676c&#34;</span>&nbsp;<span class="op" id="7424818">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7424821">&#34;6503636f6d00c00c002100010000012c00200005000014950b786d70702d7365727665&#34;</span>&nbsp;<span class="op" id="7424894">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7424897">&#34;72016c06676f6f676c6503636f6d00c00c002100010000012c00FF0014000014950c78&#34;</span>&nbsp;<span class="op" id="7424970">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7424973">&#34;6d70702d73657276657231016c06676f6f676c6503636f6d00&#34;</span>
</div>
</body>
</html>
