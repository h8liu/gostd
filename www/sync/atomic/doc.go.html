<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1450578">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1450634">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1450688">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1450739">//&nbsp;Package&nbsp;atomic&nbsp;provides&nbsp;low-level&nbsp;atomic&nbsp;memory&nbsp;primitives</span><br>
<span class="lineno"></span><span class="comment" id="1450801">//&nbsp;useful&nbsp;for&nbsp;implementing&nbsp;synchronization&nbsp;algorithms.</span><br>
<span class="lineno"></span><span class="comment" id="1450856">//</span><br>
<span class="lineno"></span><span class="comment" id="1450859">//&nbsp;These&nbsp;functions&nbsp;require&nbsp;great&nbsp;care&nbsp;to&nbsp;be&nbsp;used&nbsp;correctly.</span><br>
<span class="lineno"></span><span class="comment" id="1450919">//&nbsp;Except&nbsp;for&nbsp;special,&nbsp;low-level&nbsp;applications,&nbsp;synchronization&nbsp;is&nbsp;better</span><br>
<span class="lineno">10</span><span class="comment" id="1450992">//&nbsp;done&nbsp;with&nbsp;channels&nbsp;or&nbsp;the&nbsp;facilities&nbsp;of&nbsp;the&nbsp;sync&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="1451053">//&nbsp;Share&nbsp;memory&nbsp;by&nbsp;communicating;</span><br>
<span class="lineno"></span><span class="comment" id="1451087">//&nbsp;don&#39;t&nbsp;communicate&nbsp;by&nbsp;sharing&nbsp;memory.</span><br>
<span class="lineno"></span><span class="comment" id="1451127">//</span><br>
<span class="lineno"></span><span class="comment" id="1451130">//&nbsp;The&nbsp;swap&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;SwapT&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic</span><br>
<span class="lineno">15</span><span class="comment" id="1451203">//&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1451221">//</span><br>
<span class="lineno"></span><span class="comment" id="1451224">//&nbsp;&nbsp;&nbsp;&nbspold&nbsp;=&nbsp;*addr</span><br>
<span class="lineno"></span><span class="comment" id="1451239">//&nbsp;&nbsp;&nbsp;&nbsp*addr&nbsp;=&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="1451254">//&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;old</span><br>
<span class="lineno">20</span><span class="comment" id="1451268">//</span><br>
<span class="lineno"></span><span class="comment" id="1451271">//&nbsp;The&nbsp;compare-and-swap&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;CompareAndSwapT</span><br>
<span class="lineno"></span><span class="comment" id="1451341">//&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1451384">//</span><br>
<span class="lineno"></span><span class="comment" id="1451387">//&nbsp;&nbsp;&nbsp;&nbspif&nbsp;*addr&nbsp;==&nbsp;old&nbsp;{</span><br>
<span class="lineno">25</span><span class="comment" id="1451408">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp*addr&nbsp;=&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="1451424">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;true</span><br>
<span class="lineno"></span><span class="comment" id="1451440">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span><span class="comment" id="1451445">//&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;false</span><br>
<span class="lineno"></span><span class="comment" id="1451461">//</span><br>
<span class="lineno">30</span><span class="comment" id="1451464">//&nbsp;The&nbsp;add&nbsp;operation,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;AddT&nbsp;functions,&nbsp;is&nbsp;the&nbsp;atomic</span><br>
<span class="lineno"></span><span class="comment" id="1451535">//&nbsp;equivalent&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1451553">//</span><br>
<span class="lineno"></span><span class="comment" id="1451556">//&nbsp;&nbsp;&nbsp;&nbsp*addr&nbsp;+=&nbsp;delta</span><br>
<span class="lineno"></span><span class="comment" id="1451574">//&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;*addr</span><br>
<span class="lineno">35</span><span class="comment" id="1451590">//</span><br>
<span class="lineno"></span><span class="comment" id="1451593">//&nbsp;The&nbsp;load&nbsp;and&nbsp;store&nbsp;operations,&nbsp;implemented&nbsp;by&nbsp;the&nbsp;LoadT&nbsp;and&nbsp;StoreT</span><br>
<span class="lineno"></span><span class="comment" id="1451663">//&nbsp;functions,&nbsp;are&nbsp;the&nbsp;atomic&nbsp;equivalents&nbsp;of&nbsp;&#34;return&nbsp;*addr&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1451726">//&nbsp;&#34;*addr&nbsp;=&nbsp;val&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="1451744">//</span><br>
<span class="lineno">40</span><span class="keyword" id="1451747">package</span>&nbsp;<span class="ident" id="1451755">atomic</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1451763">import</span>&nbsp;<span class="op" id="1451770">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1451773">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1451782">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="1451785">//&nbsp;BUG(rsc):&nbsp;On&nbsp;x86-32,&nbsp;the&nbsp;64-bit&nbsp;functions&nbsp;use&nbsp;instructions&nbsp;unavailable&nbsp;before&nbsp;the&nbsp;Pentium&nbsp;MMX.</span><br>
<span class="lineno"></span><span class="comment" id="1451883">//</span><br>
<span class="lineno"></span><span class="comment" id="1451886">//&nbsp;On&nbsp;non-Linux&nbsp;ARM,&nbsp;the&nbsp;64-bit&nbsp;functions&nbsp;use&nbsp;instructions&nbsp;unavailable&nbsp;before&nbsp;the&nbsp;ARMv6k&nbsp;core.</span><br>
<span class="lineno"></span><span class="comment" id="1451981">//</span><br>
<span class="lineno">50</span><span class="comment" id="1451984">//&nbsp;On&nbsp;both&nbsp;ARM&nbsp;and&nbsp;x86-32,&nbsp;it&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;arrange&nbsp;for&nbsp;64-bit</span><br>
<span class="lineno"></span><span class="comment" id="1452067">//&nbsp;alignment&nbsp;of&nbsp;64-bit&nbsp;words&nbsp;accessed&nbsp;atomically.&nbsp;The&nbsp;first&nbsp;word&nbsp;in&nbsp;a&nbsp;global</span><br>
<span class="lineno"></span><span class="comment" id="1452144">//&nbsp;variable&nbsp;or&nbsp;in&nbsp;an&nbsp;allocated&nbsp;struct&nbsp;or&nbsp;slice&nbsp;can&nbsp;be&nbsp;relied&nbsp;upon&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="1452216">//&nbsp;64-bit&nbsp;aligned.</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="1452236">//&nbsp;SwapInt32&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1452320">func</span>&nbsp;<span class="ident" id="1452325">SwapInt32</span><span class="op" id="1452334">(</span><span class="ident" id="1452335">addr</span>&nbsp;<span class="op" id="1452340">*</span><span class="builtintype" id="1452341">int32</span><span class="op" id="1452346">,</span>&nbsp;<span class="builtinfunc" id="1452348">new</span>&nbsp;<span class="builtintype" id="1452352">int32</span><span class="op" id="1452357">)</span>&nbsp;<span class="op" id="1452359">(</span><span class="ident" id="1452360">old</span>&nbsp;<span class="builtintype" id="1452364">int32</span><span class="op" id="1452369">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1452372">//&nbsp;SwapInt64&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1452456">func</span>&nbsp;<span class="ident" id="1452461">SwapInt64</span><span class="op" id="1452470">(</span><span class="ident" id="1452471">addr</span>&nbsp;<span class="op" id="1452476">*</span><span class="ident" id="1452477">int64</span><span class="op" id="1452482">,</span>&nbsp;<span class="builtinfunc" id="1452484">new</span>&nbsp;<span class="ident" id="1452488">int64</span><span class="op" id="1452493">)</span>&nbsp;<span class="op" id="1452495">(</span><span class="ident" id="1452496">old</span>&nbsp;<span class="ident" id="1452500">int64</span><span class="op" id="1452505">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="1452508">//&nbsp;SwapUint32&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1452593">func</span>&nbsp;<span class="ident" id="1452598">SwapUint32</span><span class="op" id="1452608">(</span><span class="ident" id="1452609">addr</span>&nbsp;<span class="op" id="1452614">*</span><span class="builtintype" id="1452615">uint32</span><span class="op" id="1452621">,</span>&nbsp;<span class="builtinfunc" id="1452623">new</span>&nbsp;<span class="builtintype" id="1452627">uint32</span><span class="op" id="1452633">)</span>&nbsp;<span class="op" id="1452635">(</span><span class="ident" id="1452636">old</span>&nbsp;<span class="builtintype" id="1452640">uint32</span><span class="op" id="1452646">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1452649">//&nbsp;SwapUint64&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno">65</span><span class="keyword" id="1452734">func</span>&nbsp;<span class="ident" id="1452739">SwapUint64</span><span class="op" id="1452749">(</span><span class="ident" id="1452750">addr</span>&nbsp;<span class="op" id="1452755">*</span><span class="ident" id="1452756">uint64</span><span class="op" id="1452762">,</span>&nbsp;<span class="builtinfunc" id="1452764">new</span>&nbsp;<span class="ident" id="1452768">uint64</span><span class="op" id="1452774">)</span>&nbsp;<span class="op" id="1452776">(</span><span class="ident" id="1452777">old</span>&nbsp;<span class="ident" id="1452781">uint64</span><span class="op" id="1452787">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1452790">//&nbsp;SwapUintptr&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1452876">func</span>&nbsp;<span class="ident" id="1452881">SwapUintptr</span><span class="op" id="1452892">(</span><span class="ident" id="1452893">addr</span>&nbsp;<span class="op" id="1452898">*</span><span class="builtintype" id="1452899">uintptr</span><span class="op" id="1452906">,</span>&nbsp;<span class="builtinfunc" id="1452908">new</span>&nbsp;<span class="builtintype" id="1452912">uintptr</span><span class="op" id="1452919">)</span>&nbsp;<span class="op" id="1452921">(</span><span class="ident" id="1452922">old</span>&nbsp;<span class="builtintype" id="1452926">uintptr</span><span class="op" id="1452933">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="1452936">//&nbsp;SwapPointer&nbsp;atomically&nbsp;stores&nbsp;new&nbsp;into&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;previous&nbsp;*addr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1453022">func</span>&nbsp;<span class="ident" id="1453027">SwapPointer</span><span class="op" id="1453038">(</span><span class="ident" id="1453039">addr</span>&nbsp;<span class="op" id="1453044">*</span><span class="ident" id="1453045">unsafe</span><span class="op" id="1453051">.</span><span class="ident" id="1453052">Pointer</span><span class="op" id="1453059">,</span>&nbsp;<span class="builtinfunc" id="1453061">new</span>&nbsp;<span class="ident" id="1453065">unsafe</span><span class="op" id="1453071">.</span><span class="ident" id="1453072">Pointer</span><span class="op" id="1453079">)</span>&nbsp;<span class="op" id="1453081">(</span><span class="ident" id="1453082">old</span>&nbsp;<span class="ident" id="1453086">unsafe</span><span class="op" id="1453092">.</span><span class="ident" id="1453093">Pointer</span><span class="op" id="1453100">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1453103">//&nbsp;CompareAndSwapInt32&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;an&nbsp;int32&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1453186">func</span>&nbsp;<span class="ident" id="1453191">CompareAndSwapInt32</span><span class="op" id="1453210">(</span><span class="ident" id="1453211">addr</span>&nbsp;<span class="op" id="1453216">*</span><span class="builtintype" id="1453217">int32</span><span class="op" id="1453222">,</span>&nbsp;<span class="ident" id="1453224">old</span><span class="op" id="1453227">,</span>&nbsp;<span class="builtinfunc" id="1453229">new</span>&nbsp;<span class="builtintype" id="1453233">int32</span><span class="op" id="1453238">)</span>&nbsp;<span class="op" id="1453240">(</span><span class="ident" id="1453241">swapped</span>&nbsp;<span class="builtintype" id="1453249">bool</span><span class="op" id="1453253">)</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="comment" id="1453256">//&nbsp;CompareAndSwapInt64&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;an&nbsp;int64&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1453339">func</span>&nbsp;<span class="ident" id="1453344">CompareAndSwapInt64</span><span class="op" id="1453363">(</span><span class="ident" id="1453364">addr</span>&nbsp;<span class="op" id="1453369">*</span><span class="ident" id="1453370">int64</span><span class="op" id="1453375">,</span>&nbsp;<span class="ident" id="1453377">old</span><span class="op" id="1453380">,</span>&nbsp;<span class="builtinfunc" id="1453382">new</span>&nbsp;<span class="ident" id="1453386">int64</span><span class="op" id="1453391">)</span>&nbsp;<span class="op" id="1453393">(</span><span class="ident" id="1453394">swapped</span>&nbsp;<span class="builtintype" id="1453402">bool</span><span class="op" id="1453406">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1453409">//&nbsp;CompareAndSwapUint32&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uint32&nbsp;value.</span><br>
<span class="lineno">80</span><span class="keyword" id="1453493">func</span>&nbsp;<span class="ident" id="1453498">CompareAndSwapUint32</span><span class="op" id="1453518">(</span><span class="ident" id="1453519">addr</span>&nbsp;<span class="op" id="1453524">*</span><span class="builtintype" id="1453525">uint32</span><span class="op" id="1453531">,</span>&nbsp;<span class="ident" id="1453533">old</span><span class="op" id="1453536">,</span>&nbsp;<span class="builtinfunc" id="1453538">new</span>&nbsp;<span class="builtintype" id="1453542">uint32</span><span class="op" id="1453548">)</span>&nbsp;<span class="op" id="1453550">(</span><span class="ident" id="1453551">swapped</span>&nbsp;<span class="builtintype" id="1453559">bool</span><span class="op" id="1453563">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1453566">//&nbsp;CompareAndSwapUint64&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uint64&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1453650">func</span>&nbsp;<span class="ident" id="1453655">CompareAndSwapUint64</span><span class="op" id="1453675">(</span><span class="ident" id="1453676">addr</span>&nbsp;<span class="op" id="1453681">*</span><span class="ident" id="1453682">uint64</span><span class="op" id="1453688">,</span>&nbsp;<span class="ident" id="1453690">old</span><span class="op" id="1453693">,</span>&nbsp;<span class="builtinfunc" id="1453695">new</span>&nbsp;<span class="ident" id="1453699">uint64</span><span class="op" id="1453705">)</span>&nbsp;<span class="op" id="1453707">(</span><span class="ident" id="1453708">swapped</span>&nbsp;<span class="builtintype" id="1453716">bool</span><span class="op" id="1453720">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1453723">//&nbsp;CompareAndSwapUintptr&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;uintptr&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1453809">func</span>&nbsp;<span class="ident" id="1453814">CompareAndSwapUintptr</span><span class="op" id="1453835">(</span><span class="ident" id="1453836">addr</span>&nbsp;<span class="op" id="1453841">*</span><span class="builtintype" id="1453842">uintptr</span><span class="op" id="1453849">,</span>&nbsp;<span class="ident" id="1453851">old</span><span class="op" id="1453854">,</span>&nbsp;<span class="builtinfunc" id="1453856">new</span>&nbsp;<span class="builtintype" id="1453860">uintptr</span><span class="op" id="1453867">)</span>&nbsp;<span class="op" id="1453869">(</span><span class="ident" id="1453870">swapped</span>&nbsp;<span class="builtintype" id="1453878">bool</span><span class="op" id="1453882">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1453885">//&nbsp;CompareAndSwapPointer&nbsp;executes&nbsp;the&nbsp;compare-and-swap&nbsp;operation&nbsp;for&nbsp;a&nbsp;unsafe.Pointer&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1453978">func</span>&nbsp;<span class="ident" id="1453983">CompareAndSwapPointer</span><span class="op" id="1454004">(</span><span class="ident" id="1454005">addr</span>&nbsp;<span class="op" id="1454010">*</span><span class="ident" id="1454011">unsafe</span><span class="op" id="1454017">.</span><span class="ident" id="1454018">Pointer</span><span class="op" id="1454025">,</span>&nbsp;<span class="ident" id="1454027">old</span><span class="op" id="1454030">,</span>&nbsp;<span class="builtinfunc" id="1454032">new</span>&nbsp;<span class="ident" id="1454036">unsafe</span><span class="op" id="1454042">.</span><span class="ident" id="1454043">Pointer</span><span class="op" id="1454050">)</span>&nbsp;<span class="op" id="1454052">(</span><span class="ident" id="1454053">swapped</span>&nbsp;<span class="builtintype" id="1454061">bool</span><span class="op" id="1454065">)</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="comment" id="1454068">//&nbsp;AddInt32&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1454138">func</span>&nbsp;<span class="ident" id="1454143">AddInt32</span><span class="op" id="1454151">(</span><span class="ident" id="1454152">addr</span>&nbsp;<span class="op" id="1454157">*</span><span class="builtintype" id="1454158">int32</span><span class="op" id="1454163">,</span>&nbsp;<span class="ident" id="1454165">delta</span>&nbsp;<span class="builtintype" id="1454171">int32</span><span class="op" id="1454176">)</span>&nbsp;<span class="op" id="1454178">(</span><span class="builtinfunc" id="1454179">new</span>&nbsp;<span class="builtintype" id="1454183">int32</span><span class="op" id="1454188">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1454191">//&nbsp;AddUint32&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno">95</span><span class="comment" id="1454262">//&nbsp;To&nbsp;subtract&nbsp;a&nbsp;signed&nbsp;positive&nbsp;constant&nbsp;value&nbsp;c&nbsp;from&nbsp;x,&nbsp;do&nbsp;AddUint32(&amp;x,&nbsp;^uint32(c-1)).</span><br>
<span class="lineno"></span><span class="comment" id="1454352">//&nbsp;In&nbsp;particular,&nbsp;to&nbsp;decrement&nbsp;x,&nbsp;do&nbsp;AddUint32(&amp;x,&nbsp;^uint32(0)).</span><br>
<span class="lineno"></span><span class="keyword" id="1454416">func</span>&nbsp;<span class="ident" id="1454421">AddUint32</span><span class="op" id="1454430">(</span><span class="ident" id="1454431">addr</span>&nbsp;<span class="op" id="1454436">*</span><span class="builtintype" id="1454437">uint32</span><span class="op" id="1454443">,</span>&nbsp;<span class="ident" id="1454445">delta</span>&nbsp;<span class="builtintype" id="1454451">uint32</span><span class="op" id="1454457">)</span>&nbsp;<span class="op" id="1454459">(</span><span class="builtinfunc" id="1454460">new</span>&nbsp;<span class="builtintype" id="1454464">uint32</span><span class="op" id="1454470">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1454473">//&nbsp;AddInt64&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno">100</span><span class="keyword" id="1454543">func</span>&nbsp;<span class="ident" id="1454548">AddInt64</span><span class="op" id="1454556">(</span><span class="ident" id="1454557">addr</span>&nbsp;<span class="op" id="1454562">*</span><span class="ident" id="1454563">int64</span><span class="op" id="1454568">,</span>&nbsp;<span class="ident" id="1454570">delta</span>&nbsp;<span class="ident" id="1454576">int64</span><span class="op" id="1454581">)</span>&nbsp;<span class="op" id="1454583">(</span><span class="builtinfunc" id="1454584">new</span>&nbsp;<span class="ident" id="1454588">int64</span><span class="op" id="1454593">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1454596">//&nbsp;AddUint64&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="1454667">//&nbsp;To&nbsp;subtract&nbsp;a&nbsp;signed&nbsp;positive&nbsp;constant&nbsp;value&nbsp;c&nbsp;from&nbsp;x,&nbsp;do&nbsp;AddUint64(&amp;x,&nbsp;^uint64(c-1)).</span><br>
<span class="lineno"></span><span class="comment" id="1454757">//&nbsp;In&nbsp;particular,&nbsp;to&nbsp;decrement&nbsp;x,&nbsp;do&nbsp;AddUint64(&amp;x,&nbsp;^uint64(0)).</span><br>
<span class="lineno">105</span><span class="keyword" id="1454821">func</span>&nbsp;<span class="ident" id="1454826">AddUint64</span><span class="op" id="1454835">(</span><span class="ident" id="1454836">addr</span>&nbsp;<span class="op" id="1454841">*</span><span class="ident" id="1454842">uint64</span><span class="op" id="1454848">,</span>&nbsp;<span class="ident" id="1454850">delta</span>&nbsp;<span class="ident" id="1454856">uint64</span><span class="op" id="1454862">)</span>&nbsp;<span class="op" id="1454864">(</span><span class="builtinfunc" id="1454865">new</span>&nbsp;<span class="ident" id="1454869">uint64</span><span class="op" id="1454875">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1454878">//&nbsp;AddUintptr&nbsp;atomically&nbsp;adds&nbsp;delta&nbsp;to&nbsp;*addr&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="1454950">func</span>&nbsp;<span class="ident" id="1454955">AddUintptr</span><span class="op" id="1454965">(</span><span class="ident" id="1454966">addr</span>&nbsp;<span class="op" id="1454971">*</span><span class="builtintype" id="1454972">uintptr</span><span class="op" id="1454979">,</span>&nbsp;<span class="ident" id="1454981">delta</span>&nbsp;<span class="builtintype" id="1454987">uintptr</span><span class="op" id="1454994">)</span>&nbsp;<span class="op" id="1454996">(</span><span class="builtinfunc" id="1454997">new</span>&nbsp;<span class="builtintype" id="1455001">uintptr</span><span class="op" id="1455008">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="1455011">//&nbsp;LoadInt32&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1455048">func</span>&nbsp;<span class="ident" id="1455053">LoadInt32</span><span class="op" id="1455062">(</span><span class="ident" id="1455063">addr</span>&nbsp;<span class="op" id="1455068">*</span><span class="builtintype" id="1455069">int32</span><span class="op" id="1455074">)</span>&nbsp;<span class="op" id="1455076">(</span><span class="ident" id="1455077">val</span>&nbsp;<span class="builtintype" id="1455081">int32</span><span class="op" id="1455086">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1455089">//&nbsp;LoadInt64&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1455126">func</span>&nbsp;<span class="ident" id="1455131">LoadInt64</span><span class="op" id="1455140">(</span><span class="ident" id="1455141">addr</span>&nbsp;<span class="op" id="1455146">*</span><span class="ident" id="1455147">int64</span><span class="op" id="1455152">)</span>&nbsp;<span class="op" id="1455154">(</span><span class="ident" id="1455155">val</span>&nbsp;<span class="ident" id="1455159">int64</span><span class="op" id="1455164">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="1455167">//&nbsp;LoadUint32&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1455205">func</span>&nbsp;<span class="ident" id="1455210">LoadUint32</span><span class="op" id="1455220">(</span><span class="ident" id="1455221">addr</span>&nbsp;<span class="op" id="1455226">*</span><span class="builtintype" id="1455227">uint32</span><span class="op" id="1455233">)</span>&nbsp;<span class="op" id="1455235">(</span><span class="ident" id="1455236">val</span>&nbsp;<span class="builtintype" id="1455240">uint32</span><span class="op" id="1455246">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1455249">//&nbsp;LoadUint64&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno">120</span><span class="keyword" id="1455287">func</span>&nbsp;<span class="ident" id="1455292">LoadUint64</span><span class="op" id="1455302">(</span><span class="ident" id="1455303">addr</span>&nbsp;<span class="op" id="1455308">*</span><span class="ident" id="1455309">uint64</span><span class="op" id="1455315">)</span>&nbsp;<span class="op" id="1455317">(</span><span class="ident" id="1455318">val</span>&nbsp;<span class="ident" id="1455322">uint64</span><span class="op" id="1455328">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1455331">//&nbsp;LoadUintptr&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1455370">func</span>&nbsp;<span class="ident" id="1455375">LoadUintptr</span><span class="op" id="1455386">(</span><span class="ident" id="1455387">addr</span>&nbsp;<span class="op" id="1455392">*</span><span class="builtintype" id="1455393">uintptr</span><span class="op" id="1455400">)</span>&nbsp;<span class="op" id="1455402">(</span><span class="ident" id="1455403">val</span>&nbsp;<span class="builtintype" id="1455407">uintptr</span><span class="op" id="1455414">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="1455417">//&nbsp;LoadPointer&nbsp;atomically&nbsp;loads&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1455456">func</span>&nbsp;<span class="ident" id="1455461">LoadPointer</span><span class="op" id="1455472">(</span><span class="ident" id="1455473">addr</span>&nbsp;<span class="op" id="1455478">*</span><span class="ident" id="1455479">unsafe</span><span class="op" id="1455485">.</span><span class="ident" id="1455486">Pointer</span><span class="op" id="1455493">)</span>&nbsp;<span class="op" id="1455495">(</span><span class="ident" id="1455496">val</span>&nbsp;<span class="ident" id="1455500">unsafe</span><span class="op" id="1455506">.</span><span class="ident" id="1455507">Pointer</span><span class="op" id="1455514">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1455517">//&nbsp;StoreInt32&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1455565">func</span>&nbsp;<span class="ident" id="1455570">StoreInt32</span><span class="op" id="1455580">(</span><span class="ident" id="1455581">addr</span>&nbsp;<span class="op" id="1455586">*</span><span class="builtintype" id="1455587">int32</span><span class="op" id="1455592">,</span>&nbsp;<span class="ident" id="1455594">val</span>&nbsp;<span class="builtintype" id="1455598">int32</span><span class="op" id="1455603">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="1455606">//&nbsp;StoreInt64&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1455654">func</span>&nbsp;<span class="ident" id="1455659">StoreInt64</span><span class="op" id="1455669">(</span><span class="ident" id="1455670">addr</span>&nbsp;<span class="op" id="1455675">*</span><span class="ident" id="1455676">int64</span><span class="op" id="1455681">,</span>&nbsp;<span class="ident" id="1455683">val</span>&nbsp;<span class="ident" id="1455687">int64</span><span class="op" id="1455692">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1455695">//&nbsp;StoreUint32&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno">135</span><span class="keyword" id="1455744">func</span>&nbsp;<span class="ident" id="1455749">StoreUint32</span><span class="op" id="1455760">(</span><span class="ident" id="1455761">addr</span>&nbsp;<span class="op" id="1455766">*</span><span class="builtintype" id="1455767">uint32</span><span class="op" id="1455773">,</span>&nbsp;<span class="ident" id="1455775">val</span>&nbsp;<span class="builtintype" id="1455779">uint32</span><span class="op" id="1455785">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1455788">//&nbsp;StoreUint64&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1455837">func</span>&nbsp;<span class="ident" id="1455842">StoreUint64</span><span class="op" id="1455853">(</span><span class="ident" id="1455854">addr</span>&nbsp;<span class="op" id="1455859">*</span><span class="ident" id="1455860">uint64</span><span class="op" id="1455866">,</span>&nbsp;<span class="ident" id="1455868">val</span>&nbsp;<span class="ident" id="1455872">uint64</span><span class="op" id="1455878">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="1455881">//&nbsp;StoreUintptr&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1455931">func</span>&nbsp;<span class="ident" id="1455936">StoreUintptr</span><span class="op" id="1455948">(</span><span class="ident" id="1455949">addr</span>&nbsp;<span class="op" id="1455954">*</span><span class="builtintype" id="1455955">uintptr</span><span class="op" id="1455962">,</span>&nbsp;<span class="ident" id="1455964">val</span>&nbsp;<span class="builtintype" id="1455968">uintptr</span><span class="op" id="1455975">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1455978">//&nbsp;StorePointer&nbsp;atomically&nbsp;stores&nbsp;val&nbsp;into&nbsp;*addr.</span><br>
<span class="lineno"></span><span class="keyword" id="1456028">func</span>&nbsp;<span class="ident" id="1456033">StorePointer</span><span class="op" id="1456045">(</span><span class="ident" id="1456046">addr</span>&nbsp;<span class="op" id="1456051">*</span><span class="ident" id="1456052">unsafe</span><span class="op" id="1456058">.</span><span class="ident" id="1456059">Pointer</span><span class="op" id="1456066">,</span>&nbsp;<span class="ident" id="1456068">val</span>&nbsp;<span class="ident" id="1456072">unsafe</span><span class="op" id="1456078">.</span><span class="ident" id="1456079">Pointer</span><span class="op" id="1456086">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1456089">//&nbsp;Helper&nbsp;for&nbsp;ARM.&nbsp;&nbsp;Linker&nbsp;will&nbsp;discard&nbsp;on&nbsp;other&nbsp;systems</span><br>
<span class="lineno"></span><span class="keyword" id="1456146">func</span>&nbsp;<span class="ident" id="1456151">panic64</span><span class="op" id="1456158">(</span><span class="op" id="1456159">)</span>&nbsp;<span class="op" id="1456161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1456164">panic</span><span class="op" id="1456169">(</span><span class="string" id="1456170">&#34;sync/atomic:&nbsp;broken&nbsp;64-bit&nbsp;atomic&nbsp;operations&nbsp;(buggy&nbsp;QEMU)&#34;</span><span class="op" id="1456229">)</span><br>
<span class="lineno"></span><span class="op" id="1456231">}</span>
</div>
</body>
</html>
