<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html" class="current">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3005035">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3005090">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3005144">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3005195">//&nbsp;HTTP&nbsp;Response&nbsp;reading&nbsp;and&nbsp;parsing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3005234">package</span>&nbsp;<span class="ident" id="3005242">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3005248">import</span>&nbsp;<span class="op" id="3005255">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3005258">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3005267">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3005276">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3005290">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3005300">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3005306">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3005323">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3005334">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3005345">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3005355">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3005358">var</span>&nbsp;<span class="ident" id="3005362">respExcludeHeader</span>&nbsp;<span class="op" id="3005380">=</span>&nbsp;<span class="keyword" id="3005382">map</span><span class="op" id="3005385">[</span><span class="builtintype" id="3005386">string</span><span class="op" id="3005392">]</span><span class="builtintype" id="3005393">bool</span><span class="op" id="3005397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3005400">&#34;Content-Length&#34;</span><span class="op" id="3005416">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3005421">true</span><span class="op" id="3005425">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3005428">&#34;Transfer-Encoding&#34;</span><span class="op" id="3005447">:</span>&nbsp;<span class="builtintype" id="3005449">true</span><span class="op" id="3005453">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3005456">&#34;Trailer&#34;</span><span class="op" id="3005465">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3005477">true</span><span class="op" id="3005481">,</span><br>
<span class="lineno">25</span><span class="op" id="3005483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3005486">//&nbsp;Response&nbsp;represents&nbsp;the&nbsp;response&nbsp;from&nbsp;an&nbsp;HTTP&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="3005544">//</span><br>
<span class="lineno"></span><span class="keyword" id="3005547">type</span>&nbsp;<span class="ident" id="3005552">Response</span>&nbsp;<span class="keyword" id="3005561">struct</span>&nbsp;<span class="op" id="3005568">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3005571">Status</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3005582">string</span>&nbsp;<span class="comment" id="3005589">//&nbsp;e.g.&nbsp;&#34;200&nbsp;OK&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3005607">StatusCode</span>&nbsp;<span class="builtintype" id="3005618">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3005625">//&nbsp;e.g.&nbsp;200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3005638">Proto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3005649">string</span>&nbsp;<span class="comment" id="3005656">//&nbsp;e.g.&nbsp;&#34;HTTP/1.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3005676">ProtoMajor</span>&nbsp;<span class="builtintype" id="3005687">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3005694">//&nbsp;e.g.&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3005705">ProtoMinor</span>&nbsp;<span class="builtintype" id="3005716">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3005723">//&nbsp;e.g.&nbsp;0</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3005735">//&nbsp;Header&nbsp;maps&nbsp;header&nbsp;keys&nbsp;to&nbsp;values.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;had&nbsp;multiple</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3005804">//&nbsp;headers&nbsp;with&nbsp;the&nbsp;same&nbsp;key,&nbsp;they&nbsp;may&nbsp;be&nbsp;concatenated,&nbsp;with&nbsp;comma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3005872">//&nbsp;delimiters.&nbsp;&nbsp;(Section&nbsp;4.2&nbsp;of&nbsp;RFC&nbsp;2616&nbsp;requires&nbsp;that&nbsp;multiple&nbsp;headers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3005945">//&nbsp;be&nbsp;semantically&nbsp;equivalent&nbsp;to&nbsp;a&nbsp;comma-delimited&nbsp;sequence.)&nbsp;Values</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006015">//&nbsp;duplicated&nbsp;by&nbsp;other&nbsp;fields&nbsp;in&nbsp;this&nbsp;struct&nbsp;(e.g.,&nbsp;ContentLength)&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006087">//&nbsp;omitted&nbsp;from&nbsp;Header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006112">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006116">//&nbsp;Keys&nbsp;in&nbsp;the&nbsp;map&nbsp;are&nbsp;canonicalized&nbsp;(see&nbsp;CanonicalHeaderKey).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3006180">Header</span>&nbsp;<span class="ident" id="3006187">Header</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006196">//&nbsp;Body&nbsp;represents&nbsp;the&nbsp;response&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006235">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006239">//&nbsp;The&nbsp;http&nbsp;Client&nbsp;and&nbsp;Transport&nbsp;guarantee&nbsp;that&nbsp;Body&nbsp;is&nbsp;always</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006303">//&nbsp;non-nil,&nbsp;even&nbsp;on&nbsp;responses&nbsp;without&nbsp;a&nbsp;body&nbsp;or&nbsp;responses&nbsp;with</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006367">//&nbsp;a&nbsp;zero-length&nbsp;body.&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006428">//&nbsp;close&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006444">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006448">//&nbsp;The&nbsp;Body&nbsp;is&nbsp;automatically&nbsp;dechunked&nbsp;if&nbsp;the&nbsp;server&nbsp;replied</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006510">//&nbsp;with&nbsp;a&nbsp;&#34;chunked&#34;&nbsp;Transfer-Encoding.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3006550">Body</span>&nbsp;<span class="ident" id="3006555">io</span><span class="op" id="3006557">.</span><span class="ident" id="3006558">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006571">//&nbsp;ContentLength&nbsp;records&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;associated&nbsp;content.&nbsp;&nbsp;The</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006640">//&nbsp;value&nbsp;-1&nbsp;indicates&nbsp;that&nbsp;the&nbsp;length&nbsp;is&nbsp;unknown.&nbsp;&nbsp;Unless&nbsp;Request.Method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006714">//&nbsp;is&nbsp;&#34;HEAD&#34;,&nbsp;values&nbsp;&gt;=&nbsp;0&nbsp;indicate&nbsp;that&nbsp;the&nbsp;given&nbsp;number&nbsp;of&nbsp;bytes&nbsp;may</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006785">//&nbsp;be&nbsp;read&nbsp;from&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3006808">ContentLength</span>&nbsp;<span class="ident" id="3006822">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006830">//&nbsp;Contains&nbsp;transfer&nbsp;encodings&nbsp;from&nbsp;outer-most&nbsp;to&nbsp;inner-most.&nbsp;Value&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006902">//&nbsp;nil,&nbsp;means&nbsp;that&nbsp;&#34;identity&#34;&nbsp;encoding&nbsp;is&nbsp;used.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3006951">TransferEncoding</span>&nbsp;<span class="op" id="3006968">[</span><span class="op" id="3006969">]</span><span class="builtintype" id="3006970">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3006979">//&nbsp;Close&nbsp;records&nbsp;whether&nbsp;the&nbsp;header&nbsp;directed&nbsp;that&nbsp;the&nbsp;connection&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3007048">//&nbsp;closed&nbsp;after&nbsp;reading&nbsp;Body.&nbsp;&nbsp;The&nbsp;value&nbsp;is&nbsp;advice&nbsp;for&nbsp;clients:&nbsp;neither</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3007121">//&nbsp;ReadResponse&nbsp;nor&nbsp;Response.Write&nbsp;ever&nbsp;closes&nbsp;a&nbsp;connection.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3007183">Close</span>&nbsp;<span class="builtintype" id="3007189">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3007196">//&nbsp;Trailer&nbsp;maps&nbsp;trailer&nbsp;keys&nbsp;to&nbsp;values,&nbsp;in&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3007249">//&nbsp;format&nbsp;as&nbsp;the&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3007275">Trailer</span>&nbsp;<span class="ident" id="3007283">Header</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3007292">//&nbsp;The&nbsp;Request&nbsp;that&nbsp;was&nbsp;sent&nbsp;to&nbsp;obtain&nbsp;this&nbsp;Response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3007347">//&nbsp;Request&#39;s&nbsp;Body&nbsp;is&nbsp;nil&nbsp;(having&nbsp;already&nbsp;been&nbsp;consumed).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3007405">//&nbsp;This&nbsp;is&nbsp;only&nbsp;populated&nbsp;for&nbsp;Client&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3007453">Request</span>&nbsp;<span class="op" id="3007461">*</span><span class="ident" id="3007462">Request</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3007472">//&nbsp;TLS&nbsp;contains&nbsp;information&nbsp;about&nbsp;the&nbsp;TLS&nbsp;connection&nbsp;on&nbsp;which&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3007539">//&nbsp;response&nbsp;was&nbsp;received.&nbsp;It&nbsp;is&nbsp;nil&nbsp;for&nbsp;unencrypted&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3007603">//&nbsp;The&nbsp;pointer&nbsp;is&nbsp;shared&nbsp;between&nbsp;responses&nbsp;and&nbsp;should&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3007665">//&nbsp;modified.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3007679">TLS</span>&nbsp;<span class="op" id="3007683">*</span><span class="ident" id="3007684">tls</span><span class="op" id="3007687">.</span><span class="ident" id="3007688">ConnectionState</span><br>
<span class="lineno"></span><span class="op" id="3007704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3007707">//&nbsp;Cookies&nbsp;parses&nbsp;and&nbsp;returns&nbsp;the&nbsp;cookies&nbsp;set&nbsp;in&nbsp;the&nbsp;Set-Cookie&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="3007780">func</span>&nbsp;<span class="op" id="3007785">(</span><span class="ident" id="3007786">r</span>&nbsp;<span class="op" id="3007788">*</span><span class="ident" id="3007789">Response</span><span class="op" id="3007797">)</span>&nbsp;<span class="ident" id="3007799">Cookies</span><span class="op" id="3007806">(</span><span class="op" id="3007807">)</span>&nbsp;<span class="op" id="3007809">[</span><span class="op" id="3007810">]</span><span class="op" id="3007811">*</span><span class="ident" id="3007812">Cookie</span>&nbsp;<span class="op" id="3007819">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3007822">return</span>&nbsp;<span class="ident" id="3007829">readSetCookies</span><span class="op" id="3007843">(</span><span class="ident" id="3007844">r</span><span class="op" id="3007845">.</span><span class="ident" id="3007846">Header</span><span class="op" id="3007852">)</span><br>
<span class="lineno"></span><span class="op" id="3007854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3007857">var</span>&nbsp;<span class="ident" id="3007861">ErrNoLocation</span>&nbsp;<span class="op" id="3007875">=</span>&nbsp;<span class="ident" id="3007877">errors</span><span class="op" id="3007883">.</span><span class="ident" id="3007884">New</span><span class="op" id="3007887">(</span><span class="string" id="3007888">&#34;http:&nbsp;no&nbsp;Location&nbsp;header&nbsp;in&nbsp;response&#34;</span><span class="op" id="3007926">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="3007929">//&nbsp;Location&nbsp;returns&nbsp;the&nbsp;URL&nbsp;of&nbsp;the&nbsp;response&#39;s&nbsp;&#34;Location&#34;&nbsp;header,</span><br>
<span class="lineno"></span><span class="comment" id="3007994">//&nbsp;if&nbsp;present.&nbsp;&nbsp;Relative&nbsp;redirects&nbsp;are&nbsp;resolved&nbsp;relative&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3008054">//&nbsp;the&nbsp;Response&#39;s&nbsp;Request.&nbsp;&nbsp;ErrNoLocation&nbsp;is&nbsp;returned&nbsp;if&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="3008114">//&nbsp;Location&nbsp;header&nbsp;is&nbsp;present.</span><br>
<span class="lineno"></span><span class="keyword" id="3008145">func</span>&nbsp;<span class="op" id="3008150">(</span><span class="ident" id="3008151">r</span>&nbsp;<span class="op" id="3008153">*</span><span class="ident" id="3008154">Response</span><span class="op" id="3008162">)</span>&nbsp;<span class="ident" id="3008164">Location</span><span class="op" id="3008172">(</span><span class="op" id="3008173">)</span>&nbsp;<span class="op" id="3008175">(</span><span class="op" id="3008176">*</span><span class="ident" id="3008177">url</span><span class="op" id="3008180">.</span><span class="ident" id="3008181">URL</span><span class="op" id="3008184">,</span>&nbsp;<span class="builtintype" id="3008186">error</span><span class="op" id="3008191">)</span>&nbsp;<span class="op" id="3008193">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3008196">lv</span>&nbsp;<span class="op" id="3008199">:=</span>&nbsp;<span class="ident" id="3008202">r</span><span class="op" id="3008203">.</span><span class="ident" id="3008204">Header</span><span class="op" id="3008210">.</span><span class="ident" id="3008211">Get</span><span class="op" id="3008214">(</span><span class="string" id="3008215">&#34;Location&#34;</span><span class="op" id="3008225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3008228">if</span>&nbsp;<span class="ident" id="3008231">lv</span>&nbsp;<span class="op" id="3008234">==</span>&nbsp;<span class="string" id="3008237">&#34;&#34;</span>&nbsp;<span class="op" id="3008240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3008244">return</span>&nbsp;<span class="builtintype" id="3008251">nil</span><span class="op" id="3008254">,</span>&nbsp;<span class="ident" id="3008256">ErrNoLocation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3008271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3008274">if</span>&nbsp;<span class="ident" id="3008277">r</span><span class="op" id="3008278">.</span><span class="ident" id="3008279">Request</span>&nbsp;<span class="op" id="3008287">!=</span>&nbsp;<span class="builtintype" id="3008290">nil</span>&nbsp;<span class="op" id="3008294">&amp;&amp;</span>&nbsp;<span class="ident" id="3008297">r</span><span class="op" id="3008298">.</span><span class="ident" id="3008299">Request</span><span class="op" id="3008306">.</span><span class="ident" id="3008307">URL</span>&nbsp;<span class="op" id="3008311">!=</span>&nbsp;<span class="builtintype" id="3008314">nil</span>&nbsp;<span class="op" id="3008318">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3008322">return</span>&nbsp;<span class="ident" id="3008329">r</span><span class="op" id="3008330">.</span><span class="ident" id="3008331">Request</span><span class="op" id="3008338">.</span><span class="ident" id="3008339">URL</span><span class="op" id="3008342">.</span><span class="ident" id="3008343">Parse</span><span class="op" id="3008348">(</span><span class="ident" id="3008349">lv</span><span class="op" id="3008351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3008354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3008357">return</span>&nbsp;<span class="ident" id="3008364">url</span><span class="op" id="3008367">.</span><span class="ident" id="3008368">Parse</span><span class="op" id="3008373">(</span><span class="ident" id="3008374">lv</span><span class="op" id="3008376">)</span><br>
<span class="lineno"></span><span class="op" id="3008378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="3008381">//&nbsp;ReadResponse&nbsp;reads&nbsp;and&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;response&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3008440">//&nbsp;The&nbsp;req&nbsp;parameter&nbsp;optionally&nbsp;specifies&nbsp;the&nbsp;Request&nbsp;that&nbsp;corresponds</span><br>
<span class="lineno"></span><span class="comment" id="3008511">//&nbsp;to&nbsp;this&nbsp;Response.&nbsp;If&nbsp;nil,&nbsp;a&nbsp;GET&nbsp;request&nbsp;is&nbsp;assumed.</span><br>
<span class="lineno"></span><span class="comment" id="3008566">//&nbsp;Clients&nbsp;must&nbsp;call&nbsp;resp.Body.Close&nbsp;when&nbsp;finished&nbsp;reading&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3008636">//&nbsp;After&nbsp;that&nbsp;call,&nbsp;clients&nbsp;can&nbsp;inspect&nbsp;resp.Trailer&nbsp;to&nbsp;find&nbsp;key/value</span><br>
<span class="lineno">115</span><span class="comment" id="3008707">//&nbsp;pairs&nbsp;included&nbsp;in&nbsp;the&nbsp;response&nbsp;trailer.</span><br>
<span class="lineno"></span><span class="keyword" id="3008750">func</span>&nbsp;<span class="ident" id="3008755">ReadResponse</span><span class="op" id="3008767">(</span><span class="ident" id="3008768">r</span>&nbsp;<span class="op" id="3008770">*</span><span class="ident" id="3008771">bufio</span><span class="op" id="3008776">.</span><span class="ident" id="3008777">Reader</span><span class="op" id="3008783">,</span>&nbsp;<span class="ident" id="3008785">req</span>&nbsp;<span class="op" id="3008789">*</span><span class="ident" id="3008790">Request</span><span class="op" id="3008797">)</span>&nbsp;<span class="op" id="3008799">(</span><span class="op" id="3008800">*</span><span class="ident" id="3008801">Response</span><span class="op" id="3008809">,</span>&nbsp;<span class="builtintype" id="3008811">error</span><span class="op" id="3008816">)</span>&nbsp;<span class="op" id="3008818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3008821">tp</span>&nbsp;<span class="op" id="3008824">:=</span>&nbsp;<span class="ident" id="3008827">textproto</span><span class="op" id="3008836">.</span><span class="ident" id="3008837">NewReader</span><span class="op" id="3008846">(</span><span class="ident" id="3008847">r</span><span class="op" id="3008848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3008851">resp</span>&nbsp;<span class="op" id="3008856">:=</span>&nbsp;<span class="op" id="3008859">&amp;</span><span class="ident" id="3008860">Response</span><span class="op" id="3008868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3008872">Request</span><span class="op" id="3008879">:</span>&nbsp;<span class="ident" id="3008881">req</span><span class="op" id="3008884">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3008887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3008891">//&nbsp;Parse&nbsp;the&nbsp;first&nbsp;line&nbsp;of&nbsp;the&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3008933">line</span><span class="op" id="3008937">,</span>&nbsp;<span class="ident" id="3008939">err</span>&nbsp;<span class="op" id="3008943">:=</span>&nbsp;<span class="ident" id="3008946">tp</span><span class="op" id="3008948">.</span><span class="ident" id="3008949">ReadLine</span><span class="op" id="3008957">(</span><span class="op" id="3008958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3008961">if</span>&nbsp;<span class="ident" id="3008964">err</span>&nbsp;<span class="op" id="3008968">!=</span>&nbsp;<span class="builtintype" id="3008971">nil</span>&nbsp;<span class="op" id="3008975">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3008979">if</span>&nbsp;<span class="ident" id="3008982">err</span>&nbsp;<span class="op" id="3008986">==</span>&nbsp;<span class="ident" id="3008989">io</span><span class="op" id="3008991">.</span><span class="ident" id="3008992">EOF</span>&nbsp;<span class="op" id="3008996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3009001">err</span>&nbsp;<span class="op" id="3009005">=</span>&nbsp;<span class="ident" id="3009007">io</span><span class="op" id="3009009">.</span><span class="ident" id="3009010">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3009029">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009033">return</span>&nbsp;<span class="builtintype" id="3009040">nil</span><span class="op" id="3009043">,</span>&nbsp;<span class="ident" id="3009045">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3009050">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3009053">f</span>&nbsp;<span class="op" id="3009055">:=</span>&nbsp;<span class="ident" id="3009058">strings</span><span class="op" id="3009065">.</span><span class="ident" id="3009066">SplitN</span><span class="op" id="3009072">(</span><span class="ident" id="3009073">line</span><span class="op" id="3009077">,</span>&nbsp;<span class="string" id="3009079">&#34;&nbsp;&#34;</span><span class="op" id="3009082">,</span>&nbsp;<span class="num" id="3009084">3</span><span class="op" id="3009085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009088">if</span>&nbsp;<span class="builtinfunc" id="3009091">len</span><span class="op" id="3009094">(</span><span class="ident" id="3009095">f</span><span class="op" id="3009096">)</span>&nbsp;<span class="op" id="3009098">&lt;</span>&nbsp;<span class="num" id="3009100">2</span>&nbsp;<span class="op" id="3009102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009106">return</span>&nbsp;<span class="builtintype" id="3009113">nil</span><span class="op" id="3009116">,</span>&nbsp;<span class="op" id="3009118">&amp;</span><span class="ident" id="3009119">badStringError</span><span class="op" id="3009133">{</span><span class="string" id="3009134">&#34;malformed&nbsp;HTTP&nbsp;response&#34;</span><span class="op" id="3009159">,</span>&nbsp;<span class="ident" id="3009161">line</span><span class="op" id="3009165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3009168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3009171">reasonPhrase</span>&nbsp;<span class="op" id="3009184">:=</span>&nbsp;<span class="string" id="3009187">&#34;&#34;</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009191">if</span>&nbsp;<span class="builtinfunc" id="3009194">len</span><span class="op" id="3009197">(</span><span class="ident" id="3009198">f</span><span class="op" id="3009199">)</span>&nbsp;<span class="op" id="3009201">&gt;</span>&nbsp;<span class="num" id="3009203">2</span>&nbsp;<span class="op" id="3009205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3009209">reasonPhrase</span>&nbsp;<span class="op" id="3009222">=</span>&nbsp;<span class="ident" id="3009224">f</span><span class="op" id="3009225">[</span><span class="num" id="3009226">2</span><span class="op" id="3009227">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3009230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3009233">resp</span><span class="op" id="3009237">.</span><span class="ident" id="3009238">Status</span>&nbsp;<span class="op" id="3009245">=</span>&nbsp;<span class="ident" id="3009247">f</span><span class="op" id="3009248">[</span><span class="num" id="3009249">1</span><span class="op" id="3009250">]</span>&nbsp;<span class="op" id="3009252">+</span>&nbsp;<span class="string" id="3009254">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="3009258">+</span>&nbsp;<span class="ident" id="3009260">reasonPhrase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3009274">resp</span><span class="op" id="3009278">.</span><span class="ident" id="3009279">StatusCode</span><span class="op" id="3009289">,</span>&nbsp;<span class="ident" id="3009291">err</span>&nbsp;<span class="op" id="3009295">=</span>&nbsp;<span class="ident" id="3009297">strconv</span><span class="op" id="3009304">.</span><span class="ident" id="3009305">Atoi</span><span class="op" id="3009309">(</span><span class="ident" id="3009310">f</span><span class="op" id="3009311">[</span><span class="num" id="3009312">1</span><span class="op" id="3009313">]</span><span class="op" id="3009314">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009317">if</span>&nbsp;<span class="ident" id="3009320">err</span>&nbsp;<span class="op" id="3009324">!=</span>&nbsp;<span class="builtintype" id="3009327">nil</span>&nbsp;<span class="op" id="3009331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009335">return</span>&nbsp;<span class="builtintype" id="3009342">nil</span><span class="op" id="3009345">,</span>&nbsp;<span class="op" id="3009347">&amp;</span><span class="ident" id="3009348">badStringError</span><span class="op" id="3009362">{</span><span class="string" id="3009363">&#34;malformed&nbsp;HTTP&nbsp;status&nbsp;code&#34;</span><span class="op" id="3009391">,</span>&nbsp;<span class="ident" id="3009393">f</span><span class="op" id="3009394">[</span><span class="num" id="3009395">1</span><span class="op" id="3009396">]</span><span class="op" id="3009397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3009400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3009404">resp</span><span class="op" id="3009408">.</span><span class="ident" id="3009409">Proto</span>&nbsp;<span class="op" id="3009415">=</span>&nbsp;<span class="ident" id="3009417">f</span><span class="op" id="3009418">[</span><span class="num" id="3009419">0</span><span class="op" id="3009420">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009423">var</span>&nbsp;<span class="ident" id="3009427">ok</span>&nbsp;<span class="builtintype" id="3009430">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009436">if</span>&nbsp;<span class="ident" id="3009439">resp</span><span class="op" id="3009443">.</span><span class="ident" id="3009444">ProtoMajor</span><span class="op" id="3009454">,</span>&nbsp;<span class="ident" id="3009456">resp</span><span class="op" id="3009460">.</span><span class="ident" id="3009461">ProtoMinor</span><span class="op" id="3009471">,</span>&nbsp;<span class="ident" id="3009473">ok</span>&nbsp;<span class="op" id="3009476">=</span>&nbsp;<span class="ident" id="3009478">ParseHTTPVersion</span><span class="op" id="3009494">(</span><span class="ident" id="3009495">resp</span><span class="op" id="3009499">.</span><span class="ident" id="3009500">Proto</span><span class="op" id="3009505">)</span><span class="op" id="3009506">;</span>&nbsp;<span class="op" id="3009508">!</span><span class="ident" id="3009509">ok</span>&nbsp;<span class="op" id="3009512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009516">return</span>&nbsp;<span class="builtintype" id="3009523">nil</span><span class="op" id="3009526">,</span>&nbsp;<span class="op" id="3009528">&amp;</span><span class="ident" id="3009529">badStringError</span><span class="op" id="3009543">{</span><span class="string" id="3009544">&#34;malformed&nbsp;HTTP&nbsp;version&#34;</span><span class="op" id="3009568">,</span>&nbsp;<span class="ident" id="3009570">resp</span><span class="op" id="3009574">.</span><span class="ident" id="3009575">Proto</span><span class="op" id="3009580">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3009583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3009587">//&nbsp;Parse&nbsp;the&nbsp;response&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3009619">mimeHeader</span><span class="op" id="3009629">,</span>&nbsp;<span class="ident" id="3009631">err</span>&nbsp;<span class="op" id="3009635">:=</span>&nbsp;<span class="ident" id="3009638">tp</span><span class="op" id="3009640">.</span><span class="ident" id="3009641">ReadMIMEHeader</span><span class="op" id="3009655">(</span><span class="op" id="3009656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009659">if</span>&nbsp;<span class="ident" id="3009662">err</span>&nbsp;<span class="op" id="3009666">!=</span>&nbsp;<span class="builtintype" id="3009669">nil</span>&nbsp;<span class="op" id="3009673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009677">if</span>&nbsp;<span class="ident" id="3009680">err</span>&nbsp;<span class="op" id="3009684">==</span>&nbsp;<span class="ident" id="3009687">io</span><span class="op" id="3009689">.</span><span class="ident" id="3009690">EOF</span>&nbsp;<span class="op" id="3009694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3009699">err</span>&nbsp;<span class="op" id="3009703">=</span>&nbsp;<span class="ident" id="3009705">io</span><span class="op" id="3009707">.</span><span class="ident" id="3009708">ErrUnexpectedEOF</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3009727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009731">return</span>&nbsp;<span class="builtintype" id="3009738">nil</span><span class="op" id="3009741">,</span>&nbsp;<span class="ident" id="3009743">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3009748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3009751">resp</span><span class="op" id="3009755">.</span><span class="ident" id="3009756">Header</span>&nbsp;<span class="op" id="3009763">=</span>&nbsp;<span class="ident" id="3009765">Header</span><span class="op" id="3009771">(</span><span class="ident" id="3009772">mimeHeader</span><span class="op" id="3009782">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3009786">fixPragmaCacheControl</span><span class="op" id="3009807">(</span><span class="ident" id="3009808">resp</span><span class="op" id="3009812">.</span><span class="ident" id="3009813">Header</span><span class="op" id="3009819">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3009823">err</span>&nbsp;<span class="op" id="3009827">=</span>&nbsp;<span class="ident" id="3009829">readTransfer</span><span class="op" id="3009841">(</span><span class="ident" id="3009842">resp</span><span class="op" id="3009846">,</span>&nbsp;<span class="ident" id="3009848">r</span><span class="op" id="3009849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009852">if</span>&nbsp;<span class="ident" id="3009855">err</span>&nbsp;<span class="op" id="3009859">!=</span>&nbsp;<span class="builtintype" id="3009862">nil</span>&nbsp;<span class="op" id="3009866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009870">return</span>&nbsp;<span class="builtintype" id="3009877">nil</span><span class="op" id="3009880">,</span>&nbsp;<span class="ident" id="3009882">err</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3009887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3009891">return</span>&nbsp;<span class="ident" id="3009898">resp</span><span class="op" id="3009902">,</span>&nbsp;<span class="builtintype" id="3009904">nil</span><br>
<span class="lineno"></span><span class="op" id="3009908">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="3009911">//&nbsp;RFC2616:&nbsp;Should&nbsp;treat</span><br>
<span class="lineno"></span><span class="comment" id="3009936">//&nbsp;&nbsp;&nbsp;&nbsp;Pragma:&nbsp;no-cache</span><br>
<span class="lineno"></span><span class="comment" id="3009956">//&nbsp;like</span><br>
<span class="lineno"></span><span class="comment" id="3009964">//&nbsp;&nbsp;&nbsp;&nbsp;Cache-Control:&nbsp;no-cache</span><br>
<span class="lineno"></span><span class="keyword" id="3009991">func</span>&nbsp;<span class="ident" id="3009996">fixPragmaCacheControl</span><span class="op" id="3010017">(</span><span class="ident" id="3010018">header</span>&nbsp;<span class="ident" id="3010025">Header</span><span class="op" id="3010031">)</span>&nbsp;<span class="op" id="3010033">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010036">if</span>&nbsp;<span class="ident" id="3010039">hp</span><span class="op" id="3010041">,</span>&nbsp;<span class="ident" id="3010043">ok</span>&nbsp;<span class="op" id="3010046">:=</span>&nbsp;<span class="ident" id="3010049">header</span><span class="op" id="3010055">[</span><span class="string" id="3010056">&#34;Pragma&#34;</span><span class="op" id="3010064">]</span><span class="op" id="3010065">;</span>&nbsp;<span class="ident" id="3010067">ok</span>&nbsp;<span class="op" id="3010070">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3010073">len</span><span class="op" id="3010076">(</span><span class="ident" id="3010077">hp</span><span class="op" id="3010079">)</span>&nbsp;<span class="op" id="3010081">&gt;</span>&nbsp;<span class="num" id="3010083">0</span>&nbsp;<span class="op" id="3010085">&amp;&amp;</span>&nbsp;<span class="ident" id="3010088">hp</span><span class="op" id="3010090">[</span><span class="num" id="3010091">0</span><span class="op" id="3010092">]</span>&nbsp;<span class="op" id="3010094">==</span>&nbsp;<span class="string" id="3010097">&#34;no-cache&#34;</span>&nbsp;<span class="op" id="3010108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010112">if</span>&nbsp;<span class="ident" id="3010115">_</span><span class="op" id="3010116">,</span>&nbsp;<span class="ident" id="3010118">presentcc</span>&nbsp;<span class="op" id="3010128">:=</span>&nbsp;<span class="ident" id="3010131">header</span><span class="op" id="3010137">[</span><span class="string" id="3010138">&#34;Cache-Control&#34;</span><span class="op" id="3010153">]</span><span class="op" id="3010154">;</span>&nbsp;<span class="op" id="3010156">!</span><span class="ident" id="3010157">presentcc</span>&nbsp;<span class="op" id="3010167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3010172">header</span><span class="op" id="3010178">[</span><span class="string" id="3010179">&#34;Cache-Control&#34;</span><span class="op" id="3010194">]</span>&nbsp;<span class="op" id="3010196">=</span>&nbsp;<span class="op" id="3010198">[</span><span class="op" id="3010199">]</span><span class="builtintype" id="3010200">string</span><span class="op" id="3010206">{</span><span class="string" id="3010207">&#34;no-cache&#34;</span><span class="op" id="3010217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3010221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3010224">}</span><br>
<span class="lineno">180</span><span class="op" id="3010226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3010229">//&nbsp;ProtoAtLeast&nbsp;reports&nbsp;whether&nbsp;the&nbsp;HTTP&nbsp;protocol&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3010284">//&nbsp;in&nbsp;the&nbsp;response&nbsp;is&nbsp;at&nbsp;least&nbsp;major.minor.</span><br>
<span class="lineno"></span><span class="keyword" id="3010328">func</span>&nbsp;<span class="op" id="3010333">(</span><span class="ident" id="3010334">r</span>&nbsp;<span class="op" id="3010336">*</span><span class="ident" id="3010337">Response</span><span class="op" id="3010345">)</span>&nbsp;<span class="ident" id="3010347">ProtoAtLeast</span><span class="op" id="3010359">(</span><span class="ident" id="3010360">major</span><span class="op" id="3010365">,</span>&nbsp;<span class="ident" id="3010367">minor</span>&nbsp;<span class="builtintype" id="3010373">int</span><span class="op" id="3010376">)</span>&nbsp;<span class="builtintype" id="3010378">bool</span>&nbsp;<span class="op" id="3010383">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010386">return</span>&nbsp;<span class="ident" id="3010393">r</span><span class="op" id="3010394">.</span><span class="ident" id="3010395">ProtoMajor</span>&nbsp;<span class="op" id="3010406">&gt;</span>&nbsp;<span class="ident" id="3010408">major</span>&nbsp;<span class="op" id="3010414">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3010419">r</span><span class="op" id="3010420">.</span><span class="ident" id="3010421">ProtoMajor</span>&nbsp;<span class="op" id="3010432">==</span>&nbsp;<span class="ident" id="3010435">major</span>&nbsp;<span class="op" id="3010441">&amp;&amp;</span>&nbsp;<span class="ident" id="3010444">r</span><span class="op" id="3010445">.</span><span class="ident" id="3010446">ProtoMinor</span>&nbsp;<span class="op" id="3010457">&gt;=</span>&nbsp;<span class="ident" id="3010460">minor</span><br>
<span class="lineno"></span><span class="op" id="3010466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3010469">//&nbsp;Writes&nbsp;the&nbsp;response&nbsp;(header,&nbsp;body&nbsp;and&nbsp;trailer)&nbsp;in&nbsp;wire&nbsp;format.&nbsp;This&nbsp;method</span><br>
<span class="lineno">190</span><span class="comment" id="3010547">//&nbsp;consults&nbsp;the&nbsp;following&nbsp;fields&nbsp;of&nbsp;the&nbsp;response:</span><br>
<span class="lineno"></span><span class="comment" id="3010597">//</span><br>
<span class="lineno"></span><span class="comment" id="3010600">//&nbsp;&nbsp;StatusCode</span><br>
<span class="lineno"></span><span class="comment" id="3010615">//&nbsp;&nbsp;ProtoMajor</span><br>
<span class="lineno"></span><span class="comment" id="3010630">//&nbsp;&nbsp;ProtoMinor</span><br>
<span class="lineno">195</span><span class="comment" id="3010645">//&nbsp;&nbsp;Request.Method</span><br>
<span class="lineno"></span><span class="comment" id="3010664">//&nbsp;&nbsp;TransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="3010685">//&nbsp;&nbsp;Trailer</span><br>
<span class="lineno"></span><span class="comment" id="3010697">//&nbsp;&nbsp;Body</span><br>
<span class="lineno"></span><span class="comment" id="3010706">//&nbsp;&nbsp;ContentLength</span><br>
<span class="lineno">200</span><span class="comment" id="3010724">//&nbsp;&nbsp;Header,&nbsp;values&nbsp;for&nbsp;non-canonical&nbsp;keys&nbsp;will&nbsp;have&nbsp;unpredictable&nbsp;behavior</span><br>
<span class="lineno"></span><span class="comment" id="3010799">//</span><br>
<span class="lineno"></span><span class="comment" id="3010802">//&nbsp;Body&nbsp;is&nbsp;closed&nbsp;after&nbsp;it&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="3010838">func</span>&nbsp;<span class="op" id="3010843">(</span><span class="ident" id="3010844">r</span>&nbsp;<span class="op" id="3010846">*</span><span class="ident" id="3010847">Response</span><span class="op" id="3010855">)</span>&nbsp;<span class="ident" id="3010857">Write</span><span class="op" id="3010862">(</span><span class="ident" id="3010863">w</span>&nbsp;<span class="ident" id="3010865">io</span><span class="op" id="3010867">.</span><span class="ident" id="3010868">Writer</span><span class="op" id="3010874">)</span>&nbsp;<span class="builtintype" id="3010876">error</span>&nbsp;<span class="op" id="3010882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3010885">//&nbsp;Status&nbsp;line</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3010901">text</span>&nbsp;<span class="op" id="3010906">:=</span>&nbsp;<span class="ident" id="3010909">r</span><span class="op" id="3010910">.</span><span class="ident" id="3010911">Status</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010919">if</span>&nbsp;<span class="ident" id="3010922">text</span>&nbsp;<span class="op" id="3010927">==</span>&nbsp;<span class="string" id="3010930">&#34;&#34;</span>&nbsp;<span class="op" id="3010933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010937">var</span>&nbsp;<span class="ident" id="3010941">ok</span>&nbsp;<span class="builtintype" id="3010944">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3010951">text</span><span class="op" id="3010955">,</span>&nbsp;<span class="ident" id="3010957">ok</span>&nbsp;<span class="op" id="3010960">=</span>&nbsp;<span class="ident" id="3010962">statusText</span><span class="op" id="3010972">[</span><span class="ident" id="3010973">r</span><span class="op" id="3010974">.</span><span class="ident" id="3010975">StatusCode</span><span class="op" id="3010985">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3010989">if</span>&nbsp;<span class="op" id="3010992">!</span><span class="ident" id="3010993">ok</span>&nbsp;<span class="op" id="3010996">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011001">text</span>&nbsp;<span class="op" id="3011006">=</span>&nbsp;<span class="string" id="3011008">&#34;status&nbsp;code&nbsp;&#34;</span>&nbsp;<span class="op" id="3011023">+</span>&nbsp;<span class="ident" id="3011025">strconv</span><span class="op" id="3011032">.</span><span class="ident" id="3011033">Itoa</span><span class="op" id="3011037">(</span><span class="ident" id="3011038">r</span><span class="op" id="3011039">.</span><span class="ident" id="3011040">StatusCode</span><span class="op" id="3011050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3011054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3011057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011060">protoMajor</span><span class="op" id="3011070">,</span>&nbsp;<span class="ident" id="3011072">protoMinor</span>&nbsp;<span class="op" id="3011083">:=</span>&nbsp;<span class="ident" id="3011086">strconv</span><span class="op" id="3011093">.</span><span class="ident" id="3011094">Itoa</span><span class="op" id="3011098">(</span><span class="ident" id="3011099">r</span><span class="op" id="3011100">.</span><span class="ident" id="3011101">ProtoMajor</span><span class="op" id="3011111">)</span><span class="op" id="3011112">,</span>&nbsp;<span class="ident" id="3011114">strconv</span><span class="op" id="3011121">.</span><span class="ident" id="3011122">Itoa</span><span class="op" id="3011126">(</span><span class="ident" id="3011127">r</span><span class="op" id="3011128">.</span><span class="ident" id="3011129">ProtoMinor</span><span class="op" id="3011139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011142">statusCode</span>&nbsp;<span class="op" id="3011153">:=</span>&nbsp;<span class="ident" id="3011156">strconv</span><span class="op" id="3011163">.</span><span class="ident" id="3011164">Itoa</span><span class="op" id="3011168">(</span><span class="ident" id="3011169">r</span><span class="op" id="3011170">.</span><span class="ident" id="3011171">StatusCode</span><span class="op" id="3011181">)</span>&nbsp;<span class="op" id="3011183">+</span>&nbsp;<span class="string" id="3011185">&#34;&nbsp;&#34;</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011190">text</span>&nbsp;<span class="op" id="3011195">=</span>&nbsp;<span class="ident" id="3011197">strings</span><span class="op" id="3011204">.</span><span class="ident" id="3011205">TrimPrefix</span><span class="op" id="3011215">(</span><span class="ident" id="3011216">text</span><span class="op" id="3011220">,</span>&nbsp;<span class="ident" id="3011222">statusCode</span><span class="op" id="3011232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3011235">if</span>&nbsp;<span class="ident" id="3011238">_</span><span class="op" id="3011239">,</span>&nbsp;<span class="ident" id="3011241">err</span>&nbsp;<span class="op" id="3011245">:=</span>&nbsp;<span class="ident" id="3011248">io</span><span class="op" id="3011250">.</span><span class="ident" id="3011251">WriteString</span><span class="op" id="3011262">(</span><span class="ident" id="3011263">w</span><span class="op" id="3011264">,</span>&nbsp;<span class="string" id="3011266">&#34;HTTP/&#34;</span><span class="op" id="3011273">+</span><span class="ident" id="3011274">protoMajor</span><span class="op" id="3011284">+</span><span class="string" id="3011285">&#34;.&#34;</span><span class="op" id="3011288">+</span><span class="ident" id="3011289">protoMinor</span><span class="op" id="3011299">+</span><span class="string" id="3011300">&#34;&nbsp;&#34;</span><span class="op" id="3011303">+</span><span class="ident" id="3011304">statusCode</span><span class="op" id="3011314">+</span><span class="ident" id="3011315">text</span><span class="op" id="3011319">+</span><span class="string" id="3011320">&#34;\r\n&#34;</span><span class="op" id="3011326">)</span><span class="op" id="3011327">;</span>&nbsp;<span class="ident" id="3011329">err</span>&nbsp;<span class="op" id="3011333">!=</span>&nbsp;<span class="builtintype" id="3011336">nil</span>&nbsp;<span class="op" id="3011340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3011344">return</span>&nbsp;<span class="ident" id="3011351">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3011356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3011360">//&nbsp;Clone&nbsp;it,&nbsp;so&nbsp;we&nbsp;can&nbsp;modify&nbsp;r1&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011405">r1</span>&nbsp;<span class="op" id="3011408">:=</span>&nbsp;<span class="builtinfunc" id="3011411">new</span><span class="op" id="3011414">(</span><span class="ident" id="3011415">Response</span><span class="op" id="3011423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3011426">*</span><span class="ident" id="3011427">r1</span>&nbsp;<span class="op" id="3011430">=</span>&nbsp;<span class="op" id="3011432">*</span><span class="ident" id="3011433">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3011436">if</span>&nbsp;<span class="ident" id="3011439">r1</span><span class="op" id="3011441">.</span><span class="ident" id="3011442">ContentLength</span>&nbsp;<span class="op" id="3011456">==</span>&nbsp;<span class="num" id="3011459">0</span>&nbsp;<span class="op" id="3011461">&amp;&amp;</span>&nbsp;<span class="ident" id="3011464">r1</span><span class="op" id="3011466">.</span><span class="ident" id="3011467">Body</span>&nbsp;<span class="op" id="3011472">!=</span>&nbsp;<span class="builtintype" id="3011475">nil</span>&nbsp;<span class="op" id="3011479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3011483">//&nbsp;Is&nbsp;it&nbsp;actually&nbsp;0&nbsp;length?&nbsp;Or&nbsp;just&nbsp;unknown?</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3011530">var</span>&nbsp;<span class="ident" id="3011534">buf</span>&nbsp;<span class="op" id="3011538">[</span><span class="num" id="3011539">1</span><span class="op" id="3011540">]</span><span class="builtintype" id="3011541">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011548">n</span><span class="op" id="3011549">,</span>&nbsp;<span class="ident" id="3011551">err</span>&nbsp;<span class="op" id="3011555">:=</span>&nbsp;<span class="ident" id="3011558">r1</span><span class="op" id="3011560">.</span><span class="ident" id="3011561">Body</span><span class="op" id="3011565">.</span><span class="ident" id="3011566">Read</span><span class="op" id="3011570">(</span><span class="ident" id="3011571">buf</span><span class="op" id="3011574">[</span><span class="op" id="3011575">:</span><span class="op" id="3011576">]</span><span class="op" id="3011577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3011581">if</span>&nbsp;<span class="ident" id="3011584">err</span>&nbsp;<span class="op" id="3011588">!=</span>&nbsp;<span class="builtintype" id="3011591">nil</span>&nbsp;<span class="op" id="3011595">&amp;&amp;</span>&nbsp;<span class="ident" id="3011598">err</span>&nbsp;<span class="op" id="3011602">!=</span>&nbsp;<span class="ident" id="3011605">io</span><span class="op" id="3011607">.</span><span class="ident" id="3011608">EOF</span>&nbsp;<span class="op" id="3011612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3011617">return</span>&nbsp;<span class="ident" id="3011624">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3011630">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3011634">if</span>&nbsp;<span class="ident" id="3011637">n</span>&nbsp;<span class="op" id="3011639">==</span>&nbsp;<span class="num" id="3011642">0</span>&nbsp;<span class="op" id="3011644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3011649">//&nbsp;Reset&nbsp;it&nbsp;to&nbsp;a&nbsp;known&nbsp;zero&nbsp;reader,&nbsp;in&nbsp;case&nbsp;underlying&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3011711">//&nbsp;is&nbsp;unhappy&nbsp;being&nbsp;read&nbsp;repeatedly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011751">r1</span><span class="op" id="3011753">.</span><span class="ident" id="3011754">Body</span>&nbsp;<span class="op" id="3011759">=</span>&nbsp;<span class="ident" id="3011761">eofReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3011773">}</span>&nbsp;<span class="keyword" id="3011775">else</span>&nbsp;<span class="op" id="3011780">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011785">r1</span><span class="op" id="3011787">.</span><span class="ident" id="3011788">ContentLength</span>&nbsp;<span class="op" id="3011802">=</span>&nbsp;<span class="op" id="3011804">-</span><span class="num" id="3011805">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011810">r1</span><span class="op" id="3011812">.</span><span class="ident" id="3011813">Body</span>&nbsp;<span class="op" id="3011818">=</span>&nbsp;<span class="keyword" id="3011820">struct</span>&nbsp;<span class="op" id="3011827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011833">io</span><span class="op" id="3011835">.</span><span class="ident" id="3011836">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011847">io</span><span class="op" id="3011849">.</span><span class="ident" id="3011850">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3011860">}</span><span class="op" id="3011861">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011867">io</span><span class="op" id="3011869">.</span><span class="ident" id="3011870">MultiReader</span><span class="op" id="3011881">(</span><span class="ident" id="3011882">bytes</span><span class="op" id="3011887">.</span><span class="ident" id="3011888">NewReader</span><span class="op" id="3011897">(</span><span class="ident" id="3011898">buf</span><span class="op" id="3011901">[</span><span class="op" id="3011902">:</span><span class="num" id="3011903">1</span><span class="op" id="3011904">]</span><span class="op" id="3011905">)</span><span class="op" id="3011906">,</span>&nbsp;<span class="ident" id="3011908">r</span><span class="op" id="3011909">.</span><span class="ident" id="3011910">Body</span><span class="op" id="3011914">)</span><span class="op" id="3011915">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3011921">r</span><span class="op" id="3011922">.</span><span class="ident" id="3011923">Body</span><span class="op" id="3011927">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3011932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3011936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3011939">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3011942">//&nbsp;If&nbsp;we&#39;re&nbsp;sending&nbsp;a&nbsp;non-chunked&nbsp;HTTP/1.1&nbsp;response&nbsp;without&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3012005">//&nbsp;content-length,&nbsp;the&nbsp;only&nbsp;way&nbsp;to&nbsp;do&nbsp;that&nbsp;is&nbsp;the&nbsp;old&nbsp;HTTP/1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3012069">//&nbsp;way,&nbsp;by&nbsp;noting&nbsp;the&nbsp;EOF&nbsp;with&nbsp;a&nbsp;connection&nbsp;close,&nbsp;so&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3012132">//&nbsp;to&nbsp;set&nbsp;Close.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012150">if</span>&nbsp;<span class="ident" id="3012153">r1</span><span class="op" id="3012155">.</span><span class="ident" id="3012156">ContentLength</span>&nbsp;<span class="op" id="3012170">==</span>&nbsp;<span class="op" id="3012173">-</span><span class="num" id="3012174">1</span>&nbsp;<span class="op" id="3012176">&amp;&amp;</span>&nbsp;<span class="op" id="3012179">!</span><span class="ident" id="3012180">r1</span><span class="op" id="3012182">.</span><span class="ident" id="3012183">Close</span>&nbsp;<span class="op" id="3012189">&amp;&amp;</span>&nbsp;<span class="ident" id="3012192">r1</span><span class="op" id="3012194">.</span><span class="ident" id="3012195">ProtoAtLeast</span><span class="op" id="3012207">(</span><span class="num" id="3012208">1</span><span class="op" id="3012209">,</span>&nbsp;<span class="num" id="3012211">1</span><span class="op" id="3012212">)</span>&nbsp;<span class="op" id="3012214">&amp;&amp;</span>&nbsp;<span class="op" id="3012217">!</span><span class="ident" id="3012218">chunked</span><span class="op" id="3012225">(</span><span class="ident" id="3012226">r1</span><span class="op" id="3012228">.</span><span class="ident" id="3012229">TransferEncoding</span><span class="op" id="3012245">)</span>&nbsp;<span class="op" id="3012247">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012251">r1</span><span class="op" id="3012253">.</span><span class="ident" id="3012254">Close</span>&nbsp;<span class="op" id="3012260">=</span>&nbsp;<span class="builtintype" id="3012262">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3012268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3012272">//&nbsp;Process&nbsp;Body,ContentLength,Close,Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012317">tw</span><span class="op" id="3012319">,</span>&nbsp;<span class="ident" id="3012321">err</span>&nbsp;<span class="op" id="3012325">:=</span>&nbsp;<span class="ident" id="3012328">newTransferWriter</span><span class="op" id="3012345">(</span><span class="ident" id="3012346">r1</span><span class="op" id="3012348">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012351">if</span>&nbsp;<span class="ident" id="3012354">err</span>&nbsp;<span class="op" id="3012358">!=</span>&nbsp;<span class="builtintype" id="3012361">nil</span>&nbsp;<span class="op" id="3012365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012369">return</span>&nbsp;<span class="ident" id="3012376">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3012381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012384">err</span>&nbsp;<span class="op" id="3012388">=</span>&nbsp;<span class="ident" id="3012390">tw</span><span class="op" id="3012392">.</span><span class="ident" id="3012393">WriteHeader</span><span class="op" id="3012404">(</span><span class="ident" id="3012405">w</span><span class="op" id="3012406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012409">if</span>&nbsp;<span class="ident" id="3012412">err</span>&nbsp;<span class="op" id="3012416">!=</span>&nbsp;<span class="builtintype" id="3012419">nil</span>&nbsp;<span class="op" id="3012423">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012427">return</span>&nbsp;<span class="ident" id="3012434">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3012439">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3012443">//&nbsp;Rest&nbsp;of&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012462">err</span>&nbsp;<span class="op" id="3012466">=</span>&nbsp;<span class="ident" id="3012468">r</span><span class="op" id="3012469">.</span><span class="ident" id="3012470">Header</span><span class="op" id="3012476">.</span><span class="ident" id="3012477">WriteSubset</span><span class="op" id="3012488">(</span><span class="ident" id="3012489">w</span><span class="op" id="3012490">,</span>&nbsp;<span class="ident" id="3012492">respExcludeHeader</span><span class="op" id="3012509">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012512">if</span>&nbsp;<span class="ident" id="3012515">err</span>&nbsp;<span class="op" id="3012519">!=</span>&nbsp;<span class="builtintype" id="3012522">nil</span>&nbsp;<span class="op" id="3012526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012530">return</span>&nbsp;<span class="ident" id="3012537">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3012542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3012546">//&nbsp;contentLengthAlreadySent&nbsp;may&nbsp;have&nbsp;been&nbsp;already&nbsp;sent&nbsp;for</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3012606">//&nbsp;POST/PUT&nbsp;requests,&nbsp;even&nbsp;if&nbsp;zero&nbsp;length.&nbsp;See&nbsp;Issue&nbsp;8180.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3012666">contentLengthAlreadySent</span>&nbsp;<span class="op" id="3012691">:=</span>&nbsp;<span class="ident" id="3012694">tw</span><span class="op" id="3012696">.</span><span class="ident" id="3012697">shouldSendContentLength</span><span class="op" id="3012720">(</span><span class="op" id="3012721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012724">if</span>&nbsp;<span class="ident" id="3012727">r1</span><span class="op" id="3012729">.</span><span class="ident" id="3012730">ContentLength</span>&nbsp;<span class="op" id="3012744">==</span>&nbsp;<span class="num" id="3012747">0</span>&nbsp;<span class="op" id="3012749">&amp;&amp;</span>&nbsp;<span class="op" id="3012752">!</span><span class="ident" id="3012753">chunked</span><span class="op" id="3012760">(</span><span class="ident" id="3012761">r1</span><span class="op" id="3012763">.</span><span class="ident" id="3012764">TransferEncoding</span><span class="op" id="3012780">)</span>&nbsp;<span class="op" id="3012782">&amp;&amp;</span>&nbsp;<span class="op" id="3012785">!</span><span class="ident" id="3012786">contentLengthAlreadySent</span>&nbsp;<span class="op" id="3012811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012815">if</span>&nbsp;<span class="ident" id="3012818">_</span><span class="op" id="3012819">,</span>&nbsp;<span class="ident" id="3012821">err</span>&nbsp;<span class="op" id="3012825">:=</span>&nbsp;<span class="ident" id="3012828">io</span><span class="op" id="3012830">.</span><span class="ident" id="3012831">WriteString</span><span class="op" id="3012842">(</span><span class="ident" id="3012843">w</span><span class="op" id="3012844">,</span>&nbsp;<span class="string" id="3012846">&#34;Content-Length:&nbsp;0\r\n&#34;</span><span class="op" id="3012869">)</span><span class="op" id="3012870">;</span>&nbsp;<span class="ident" id="3012872">err</span>&nbsp;<span class="op" id="3012876">!=</span>&nbsp;<span class="builtintype" id="3012879">nil</span>&nbsp;<span class="op" id="3012883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012888">return</span>&nbsp;<span class="ident" id="3012895">err</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3012901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3012904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3012908">//&nbsp;End-of-header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012926">if</span>&nbsp;<span class="ident" id="3012929">_</span><span class="op" id="3012930">,</span>&nbsp;<span class="ident" id="3012932">err</span>&nbsp;<span class="op" id="3012936">:=</span>&nbsp;<span class="ident" id="3012939">io</span><span class="op" id="3012941">.</span><span class="ident" id="3012942">WriteString</span><span class="op" id="3012953">(</span><span class="ident" id="3012954">w</span><span class="op" id="3012955">,</span>&nbsp;<span class="string" id="3012957">&#34;\r\n&#34;</span><span class="op" id="3012963">)</span><span class="op" id="3012964">;</span>&nbsp;<span class="ident" id="3012966">err</span>&nbsp;<span class="op" id="3012970">!=</span>&nbsp;<span class="builtintype" id="3012973">nil</span>&nbsp;<span class="op" id="3012977">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3012981">return</span>&nbsp;<span class="ident" id="3012988">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3012993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3012997">//&nbsp;Write&nbsp;body&nbsp;and&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3013024">err</span>&nbsp;<span class="op" id="3013028">=</span>&nbsp;<span class="ident" id="3013030">tw</span><span class="op" id="3013032">.</span><span class="ident" id="3013033">WriteBody</span><span class="op" id="3013042">(</span><span class="ident" id="3013043">w</span><span class="op" id="3013044">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3013047">if</span>&nbsp;<span class="ident" id="3013050">err</span>&nbsp;<span class="op" id="3013054">!=</span>&nbsp;<span class="builtintype" id="3013057">nil</span>&nbsp;<span class="op" id="3013061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3013065">return</span>&nbsp;<span class="ident" id="3013072">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3013077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3013081">//&nbsp;Success</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3013093">return</span>&nbsp;<span class="builtintype" id="3013100">nil</span><br>
<span class="lineno"></span><span class="op" id="3013104">}</span>
</div>
</body>
</html>
