<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html" class="current">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6647937">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6647992">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6648046">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6648097">package</span>&nbsp;<span class="ident" id="6648105">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6648112">import</span>&nbsp;<span class="op" id="6648119">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6648122">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6648131">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6648138">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6648144">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6648157">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6648168">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6648176">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6648186">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6648189">type</span>&nbsp;<span class="ident" id="6648194">deflateTest</span>&nbsp;<span class="keyword" id="6648206">struct</span>&nbsp;<span class="op" id="6648213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6648216">in</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6648222">[</span><span class="op" id="6648223">]</span><span class="builtintype" id="6648224">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6648230">level</span>&nbsp;<span class="builtintype" id="6648236">int</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6648241">out</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6648247">[</span><span class="op" id="6648248">]</span><span class="builtintype" id="6648249">byte</span><br>
<span class="lineno"></span><span class="op" id="6648254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6648257">type</span>&nbsp;<span class="ident" id="6648262">deflateInflateTest</span>&nbsp;<span class="keyword" id="6648281">struct</span>&nbsp;<span class="op" id="6648288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6648291">in</span>&nbsp;<span class="op" id="6648294">[</span><span class="op" id="6648295">]</span><span class="builtintype" id="6648296">byte</span><br>
<span class="lineno">25</span><span class="op" id="6648301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6648304">type</span>&nbsp;<span class="ident" id="6648309">reverseBitsTest</span>&nbsp;<span class="keyword" id="6648325">struct</span>&nbsp;<span class="op" id="6648332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6648335">in</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6648344">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6648352">bitCount</span>&nbsp;<span class="builtintype" id="6648361">uint8</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6648368">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6648377">uint16</span><br>
<span class="lineno"></span><span class="op" id="6648384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6648387">var</span>&nbsp;<span class="ident" id="6648391">deflateTests</span>&nbsp;<span class="op" id="6648404">=</span>&nbsp;<span class="op" id="6648406">[</span><span class="op" id="6648407">]</span><span class="op" id="6648408">*</span><span class="ident" id="6648409">deflateTest</span><span class="op" id="6648420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6648423">{</span><span class="op" id="6648424">[</span><span class="op" id="6648425">]</span><span class="builtintype" id="6648426">byte</span><span class="op" id="6648430">{</span><span class="op" id="6648431">}</span><span class="op" id="6648432">,</span>&nbsp;<span class="num" id="6648434">0</span><span class="op" id="6648435">,</span>&nbsp;<span class="op" id="6648437">[</span><span class="op" id="6648438">]</span><span class="builtintype" id="6648439">byte</span><span class="op" id="6648443">{</span><span class="num" id="6648444">1</span><span class="op" id="6648445">,</span>&nbsp;<span class="num" id="6648447">0</span><span class="op" id="6648448">,</span>&nbsp;<span class="num" id="6648450">0</span><span class="op" id="6648451">,</span>&nbsp;<span class="num" id="6648453">255</span><span class="op" id="6648456">,</span>&nbsp;<span class="num" id="6648458">255</span><span class="op" id="6648461">}</span><span class="op" id="6648462">}</span><span class="op" id="6648463">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6648466">{</span><span class="op" id="6648467">[</span><span class="op" id="6648468">]</span><span class="builtintype" id="6648469">byte</span><span class="op" id="6648473">{</span><span class="num" id="6648474">0x11</span><span class="op" id="6648478">}</span><span class="op" id="6648479">,</span>&nbsp;<span class="op" id="6648481">-</span><span class="num" id="6648482">1</span><span class="op" id="6648483">,</span>&nbsp;<span class="op" id="6648485">[</span><span class="op" id="6648486">]</span><span class="builtintype" id="6648487">byte</span><span class="op" id="6648491">{</span><span class="num" id="6648492">18</span><span class="op" id="6648494">,</span>&nbsp;<span class="num" id="6648496">4</span><span class="op" id="6648497">,</span>&nbsp;<span class="num" id="6648499">4</span><span class="op" id="6648500">,</span>&nbsp;<span class="num" id="6648502">0</span><span class="op" id="6648503">,</span>&nbsp;<span class="num" id="6648505">0</span><span class="op" id="6648506">,</span>&nbsp;<span class="num" id="6648508">255</span><span class="op" id="6648511">,</span>&nbsp;<span class="num" id="6648513">255</span><span class="op" id="6648516">}</span><span class="op" id="6648517">}</span><span class="op" id="6648518">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6648521">{</span><span class="op" id="6648522">[</span><span class="op" id="6648523">]</span><span class="builtintype" id="6648524">byte</span><span class="op" id="6648528">{</span><span class="num" id="6648529">0x11</span><span class="op" id="6648533">}</span><span class="op" id="6648534">,</span>&nbsp;<span class="ident" id="6648536">DefaultCompression</span><span class="op" id="6648554">,</span>&nbsp;<span class="op" id="6648556">[</span><span class="op" id="6648557">]</span><span class="builtintype" id="6648558">byte</span><span class="op" id="6648562">{</span><span class="num" id="6648563">18</span><span class="op" id="6648565">,</span>&nbsp;<span class="num" id="6648567">4</span><span class="op" id="6648568">,</span>&nbsp;<span class="num" id="6648570">4</span><span class="op" id="6648571">,</span>&nbsp;<span class="num" id="6648573">0</span><span class="op" id="6648574">,</span>&nbsp;<span class="num" id="6648576">0</span><span class="op" id="6648577">,</span>&nbsp;<span class="num" id="6648579">255</span><span class="op" id="6648582">,</span>&nbsp;<span class="num" id="6648584">255</span><span class="op" id="6648587">}</span><span class="op" id="6648588">}</span><span class="op" id="6648589">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6648592">{</span><span class="op" id="6648593">[</span><span class="op" id="6648594">]</span><span class="builtintype" id="6648595">byte</span><span class="op" id="6648599">{</span><span class="num" id="6648600">0x11</span><span class="op" id="6648604">}</span><span class="op" id="6648605">,</span>&nbsp;<span class="num" id="6648607">4</span><span class="op" id="6648608">,</span>&nbsp;<span class="op" id="6648610">[</span><span class="op" id="6648611">]</span><span class="builtintype" id="6648612">byte</span><span class="op" id="6648616">{</span><span class="num" id="6648617">18</span><span class="op" id="6648619">,</span>&nbsp;<span class="num" id="6648621">4</span><span class="op" id="6648622">,</span>&nbsp;<span class="num" id="6648624">4</span><span class="op" id="6648625">,</span>&nbsp;<span class="num" id="6648627">0</span><span class="op" id="6648628">,</span>&nbsp;<span class="num" id="6648630">0</span><span class="op" id="6648631">,</span>&nbsp;<span class="num" id="6648633">255</span><span class="op" id="6648636">,</span>&nbsp;<span class="num" id="6648638">255</span><span class="op" id="6648641">}</span><span class="op" id="6648642">}</span><span class="op" id="6648643">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6648647">{</span><span class="op" id="6648648">[</span><span class="op" id="6648649">]</span><span class="builtintype" id="6648650">byte</span><span class="op" id="6648654">{</span><span class="num" id="6648655">0x11</span><span class="op" id="6648659">}</span><span class="op" id="6648660">,</span>&nbsp;<span class="num" id="6648662">0</span><span class="op" id="6648663">,</span>&nbsp;<span class="op" id="6648665">[</span><span class="op" id="6648666">]</span><span class="builtintype" id="6648667">byte</span><span class="op" id="6648671">{</span><span class="num" id="6648672">0</span><span class="op" id="6648673">,</span>&nbsp;<span class="num" id="6648675">1</span><span class="op" id="6648676">,</span>&nbsp;<span class="num" id="6648678">0</span><span class="op" id="6648679">,</span>&nbsp;<span class="num" id="6648681">254</span><span class="op" id="6648684">,</span>&nbsp;<span class="num" id="6648686">255</span><span class="op" id="6648689">,</span>&nbsp;<span class="num" id="6648691">17</span><span class="op" id="6648693">,</span>&nbsp;<span class="num" id="6648695">1</span><span class="op" id="6648696">,</span>&nbsp;<span class="num" id="6648698">0</span><span class="op" id="6648699">,</span>&nbsp;<span class="num" id="6648701">0</span><span class="op" id="6648702">,</span>&nbsp;<span class="num" id="6648704">255</span><span class="op" id="6648707">,</span>&nbsp;<span class="num" id="6648709">255</span><span class="op" id="6648712">}</span><span class="op" id="6648713">}</span><span class="op" id="6648714">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6648717">{</span><span class="op" id="6648718">[</span><span class="op" id="6648719">]</span><span class="builtintype" id="6648720">byte</span><span class="op" id="6648724">{</span><span class="num" id="6648725">0x11</span><span class="op" id="6648729">,</span>&nbsp;<span class="num" id="6648731">0x12</span><span class="op" id="6648735">}</span><span class="op" id="6648736">,</span>&nbsp;<span class="num" id="6648738">0</span><span class="op" id="6648739">,</span>&nbsp;<span class="op" id="6648741">[</span><span class="op" id="6648742">]</span><span class="builtintype" id="6648743">byte</span><span class="op" id="6648747">{</span><span class="num" id="6648748">0</span><span class="op" id="6648749">,</span>&nbsp;<span class="num" id="6648751">2</span><span class="op" id="6648752">,</span>&nbsp;<span class="num" id="6648754">0</span><span class="op" id="6648755">,</span>&nbsp;<span class="num" id="6648757">253</span><span class="op" id="6648760">,</span>&nbsp;<span class="num" id="6648762">255</span><span class="op" id="6648765">,</span>&nbsp;<span class="num" id="6648767">17</span><span class="op" id="6648769">,</span>&nbsp;<span class="num" id="6648771">18</span><span class="op" id="6648773">,</span>&nbsp;<span class="num" id="6648775">1</span><span class="op" id="6648776">,</span>&nbsp;<span class="num" id="6648778">0</span><span class="op" id="6648779">,</span>&nbsp;<span class="num" id="6648781">0</span><span class="op" id="6648782">,</span>&nbsp;<span class="num" id="6648784">255</span><span class="op" id="6648787">,</span>&nbsp;<span class="num" id="6648789">255</span><span class="op" id="6648792">}</span><span class="op" id="6648793">}</span><span class="op" id="6648794">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6648797">{</span><span class="op" id="6648798">[</span><span class="op" id="6648799">]</span><span class="builtintype" id="6648800">byte</span><span class="op" id="6648804">{</span><span class="num" id="6648805">0x11</span><span class="op" id="6648809">,</span>&nbsp;<span class="num" id="6648811">0x11</span><span class="op" id="6648815">,</span>&nbsp;<span class="num" id="6648817">0x11</span><span class="op" id="6648821">,</span>&nbsp;<span class="num" id="6648823">0x11</span><span class="op" id="6648827">,</span>&nbsp;<span class="num" id="6648829">0x11</span><span class="op" id="6648833">,</span>&nbsp;<span class="num" id="6648835">0x11</span><span class="op" id="6648839">,</span>&nbsp;<span class="num" id="6648841">0x11</span><span class="op" id="6648845">,</span>&nbsp;<span class="num" id="6648847">0x11</span><span class="op" id="6648851">}</span><span class="op" id="6648852">,</span>&nbsp;<span class="num" id="6648854">0</span><span class="op" id="6648855">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6648859">[</span><span class="op" id="6648860">]</span><span class="builtintype" id="6648861">byte</span><span class="op" id="6648865">{</span><span class="num" id="6648866">0</span><span class="op" id="6648867">,</span>&nbsp;<span class="num" id="6648869">8</span><span class="op" id="6648870">,</span>&nbsp;<span class="num" id="6648872">0</span><span class="op" id="6648873">,</span>&nbsp;<span class="num" id="6648875">247</span><span class="op" id="6648878">,</span>&nbsp;<span class="num" id="6648880">255</span><span class="op" id="6648883">,</span>&nbsp;<span class="num" id="6648885">17</span><span class="op" id="6648887">,</span>&nbsp;<span class="num" id="6648889">17</span><span class="op" id="6648891">,</span>&nbsp;<span class="num" id="6648893">17</span><span class="op" id="6648895">,</span>&nbsp;<span class="num" id="6648897">17</span><span class="op" id="6648899">,</span>&nbsp;<span class="num" id="6648901">17</span><span class="op" id="6648903">,</span>&nbsp;<span class="num" id="6648905">17</span><span class="op" id="6648907">,</span>&nbsp;<span class="num" id="6648909">17</span><span class="op" id="6648911">,</span>&nbsp;<span class="num" id="6648913">17</span><span class="op" id="6648915">,</span>&nbsp;<span class="num" id="6648917">1</span><span class="op" id="6648918">,</span>&nbsp;<span class="num" id="6648920">0</span><span class="op" id="6648921">,</span>&nbsp;<span class="num" id="6648923">0</span><span class="op" id="6648924">,</span>&nbsp;<span class="num" id="6648926">255</span><span class="op" id="6648929">,</span>&nbsp;<span class="num" id="6648931">255</span><span class="op" id="6648934">}</span><span class="op" id="6648935">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6648938">}</span><span class="op" id="6648939">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6648942">{</span><span class="op" id="6648943">[</span><span class="op" id="6648944">]</span><span class="builtintype" id="6648945">byte</span><span class="op" id="6648949">{</span><span class="op" id="6648950">}</span><span class="op" id="6648951">,</span>&nbsp;<span class="num" id="6648953">1</span><span class="op" id="6648954">,</span>&nbsp;<span class="op" id="6648956">[</span><span class="op" id="6648957">]</span><span class="builtintype" id="6648958">byte</span><span class="op" id="6648962">{</span><span class="num" id="6648963">1</span><span class="op" id="6648964">,</span>&nbsp;<span class="num" id="6648966">0</span><span class="op" id="6648967">,</span>&nbsp;<span class="num" id="6648969">0</span><span class="op" id="6648970">,</span>&nbsp;<span class="num" id="6648972">255</span><span class="op" id="6648975">,</span>&nbsp;<span class="num" id="6648977">255</span><span class="op" id="6648980">}</span><span class="op" id="6648981">}</span><span class="op" id="6648982">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6648985">{</span><span class="op" id="6648986">[</span><span class="op" id="6648987">]</span><span class="builtintype" id="6648988">byte</span><span class="op" id="6648992">{</span><span class="num" id="6648993">0x11</span><span class="op" id="6648997">}</span><span class="op" id="6648998">,</span>&nbsp;<span class="num" id="6649000">1</span><span class="op" id="6649001">,</span>&nbsp;<span class="op" id="6649003">[</span><span class="op" id="6649004">]</span><span class="builtintype" id="6649005">byte</span><span class="op" id="6649009">{</span><span class="num" id="6649010">18</span><span class="op" id="6649012">,</span>&nbsp;<span class="num" id="6649014">4</span><span class="op" id="6649015">,</span>&nbsp;<span class="num" id="6649017">4</span><span class="op" id="6649018">,</span>&nbsp;<span class="num" id="6649020">0</span><span class="op" id="6649021">,</span>&nbsp;<span class="num" id="6649023">0</span><span class="op" id="6649024">,</span>&nbsp;<span class="num" id="6649026">255</span><span class="op" id="6649029">,</span>&nbsp;<span class="num" id="6649031">255</span><span class="op" id="6649034">}</span><span class="op" id="6649035">}</span><span class="op" id="6649036">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6649039">{</span><span class="op" id="6649040">[</span><span class="op" id="6649041">]</span><span class="builtintype" id="6649042">byte</span><span class="op" id="6649046">{</span><span class="num" id="6649047">0x11</span><span class="op" id="6649051">,</span>&nbsp;<span class="num" id="6649053">0x12</span><span class="op" id="6649057">}</span><span class="op" id="6649058">,</span>&nbsp;<span class="num" id="6649060">1</span><span class="op" id="6649061">,</span>&nbsp;<span class="op" id="6649063">[</span><span class="op" id="6649064">]</span><span class="builtintype" id="6649065">byte</span><span class="op" id="6649069">{</span><span class="num" id="6649070">18</span><span class="op" id="6649072">,</span>&nbsp;<span class="num" id="6649074">20</span><span class="op" id="6649076">,</span>&nbsp;<span class="num" id="6649078">2</span><span class="op" id="6649079">,</span>&nbsp;<span class="num" id="6649081">4</span><span class="op" id="6649082">,</span>&nbsp;<span class="num" id="6649084">0</span><span class="op" id="6649085">,</span>&nbsp;<span class="num" id="6649087">0</span><span class="op" id="6649088">,</span>&nbsp;<span class="num" id="6649090">255</span><span class="op" id="6649093">,</span>&nbsp;<span class="num" id="6649095">255</span><span class="op" id="6649098">}</span><span class="op" id="6649099">}</span><span class="op" id="6649100">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6649103">{</span><span class="op" id="6649104">[</span><span class="op" id="6649105">]</span><span class="builtintype" id="6649106">byte</span><span class="op" id="6649110">{</span><span class="num" id="6649111">0x11</span><span class="op" id="6649115">,</span>&nbsp;<span class="num" id="6649117">0x11</span><span class="op" id="6649121">,</span>&nbsp;<span class="num" id="6649123">0x11</span><span class="op" id="6649127">,</span>&nbsp;<span class="num" id="6649129">0x11</span><span class="op" id="6649133">,</span>&nbsp;<span class="num" id="6649135">0x11</span><span class="op" id="6649139">,</span>&nbsp;<span class="num" id="6649141">0x11</span><span class="op" id="6649145">,</span>&nbsp;<span class="num" id="6649147">0x11</span><span class="op" id="6649151">,</span>&nbsp;<span class="num" id="6649153">0x11</span><span class="op" id="6649157">}</span><span class="op" id="6649158">,</span>&nbsp;<span class="num" id="6649160">1</span><span class="op" id="6649161">,</span>&nbsp;<span class="op" id="6649163">[</span><span class="op" id="6649164">]</span><span class="builtintype" id="6649165">byte</span><span class="op" id="6649169">{</span><span class="num" id="6649170">18</span><span class="op" id="6649172">,</span>&nbsp;<span class="num" id="6649174">132</span><span class="op" id="6649177">,</span>&nbsp;<span class="num" id="6649179">2</span><span class="op" id="6649180">,</span>&nbsp;<span class="num" id="6649182">64</span><span class="op" id="6649184">,</span>&nbsp;<span class="num" id="6649186">0</span><span class="op" id="6649187">,</span>&nbsp;<span class="num" id="6649189">0</span><span class="op" id="6649190">,</span>&nbsp;<span class="num" id="6649192">0</span><span class="op" id="6649193">,</span>&nbsp;<span class="num" id="6649195">255</span><span class="op" id="6649198">,</span>&nbsp;<span class="num" id="6649200">255</span><span class="op" id="6649203">}</span><span class="op" id="6649204">}</span><span class="op" id="6649205">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6649208">{</span><span class="op" id="6649209">[</span><span class="op" id="6649210">]</span><span class="builtintype" id="6649211">byte</span><span class="op" id="6649215">{</span><span class="op" id="6649216">}</span><span class="op" id="6649217">,</span>&nbsp;<span class="num" id="6649219">9</span><span class="op" id="6649220">,</span>&nbsp;<span class="op" id="6649222">[</span><span class="op" id="6649223">]</span><span class="builtintype" id="6649224">byte</span><span class="op" id="6649228">{</span><span class="num" id="6649229">1</span><span class="op" id="6649230">,</span>&nbsp;<span class="num" id="6649232">0</span><span class="op" id="6649233">,</span>&nbsp;<span class="num" id="6649235">0</span><span class="op" id="6649236">,</span>&nbsp;<span class="num" id="6649238">255</span><span class="op" id="6649241">,</span>&nbsp;<span class="num" id="6649243">255</span><span class="op" id="6649246">}</span><span class="op" id="6649247">}</span><span class="op" id="6649248">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6649251">{</span><span class="op" id="6649252">[</span><span class="op" id="6649253">]</span><span class="builtintype" id="6649254">byte</span><span class="op" id="6649258">{</span><span class="num" id="6649259">0x11</span><span class="op" id="6649263">}</span><span class="op" id="6649264">,</span>&nbsp;<span class="num" id="6649266">9</span><span class="op" id="6649267">,</span>&nbsp;<span class="op" id="6649269">[</span><span class="op" id="6649270">]</span><span class="builtintype" id="6649271">byte</span><span class="op" id="6649275">{</span><span class="num" id="6649276">18</span><span class="op" id="6649278">,</span>&nbsp;<span class="num" id="6649280">4</span><span class="op" id="6649281">,</span>&nbsp;<span class="num" id="6649283">4</span><span class="op" id="6649284">,</span>&nbsp;<span class="num" id="6649286">0</span><span class="op" id="6649287">,</span>&nbsp;<span class="num" id="6649289">0</span><span class="op" id="6649290">,</span>&nbsp;<span class="num" id="6649292">255</span><span class="op" id="6649295">,</span>&nbsp;<span class="num" id="6649297">255</span><span class="op" id="6649300">}</span><span class="op" id="6649301">}</span><span class="op" id="6649302">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6649305">{</span><span class="op" id="6649306">[</span><span class="op" id="6649307">]</span><span class="builtintype" id="6649308">byte</span><span class="op" id="6649312">{</span><span class="num" id="6649313">0x11</span><span class="op" id="6649317">,</span>&nbsp;<span class="num" id="6649319">0x12</span><span class="op" id="6649323">}</span><span class="op" id="6649324">,</span>&nbsp;<span class="num" id="6649326">9</span><span class="op" id="6649327">,</span>&nbsp;<span class="op" id="6649329">[</span><span class="op" id="6649330">]</span><span class="builtintype" id="6649331">byte</span><span class="op" id="6649335">{</span><span class="num" id="6649336">18</span><span class="op" id="6649338">,</span>&nbsp;<span class="num" id="6649340">20</span><span class="op" id="6649342">,</span>&nbsp;<span class="num" id="6649344">2</span><span class="op" id="6649345">,</span>&nbsp;<span class="num" id="6649347">4</span><span class="op" id="6649348">,</span>&nbsp;<span class="num" id="6649350">0</span><span class="op" id="6649351">,</span>&nbsp;<span class="num" id="6649353">0</span><span class="op" id="6649354">,</span>&nbsp;<span class="num" id="6649356">255</span><span class="op" id="6649359">,</span>&nbsp;<span class="num" id="6649361">255</span><span class="op" id="6649364">}</span><span class="op" id="6649365">}</span><span class="op" id="6649366">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6649369">{</span><span class="op" id="6649370">[</span><span class="op" id="6649371">]</span><span class="builtintype" id="6649372">byte</span><span class="op" id="6649376">{</span><span class="num" id="6649377">0x11</span><span class="op" id="6649381">,</span>&nbsp;<span class="num" id="6649383">0x11</span><span class="op" id="6649387">,</span>&nbsp;<span class="num" id="6649389">0x11</span><span class="op" id="6649393">,</span>&nbsp;<span class="num" id="6649395">0x11</span><span class="op" id="6649399">,</span>&nbsp;<span class="num" id="6649401">0x11</span><span class="op" id="6649405">,</span>&nbsp;<span class="num" id="6649407">0x11</span><span class="op" id="6649411">,</span>&nbsp;<span class="num" id="6649413">0x11</span><span class="op" id="6649417">,</span>&nbsp;<span class="num" id="6649419">0x11</span><span class="op" id="6649423">}</span><span class="op" id="6649424">,</span>&nbsp;<span class="num" id="6649426">9</span><span class="op" id="6649427">,</span>&nbsp;<span class="op" id="6649429">[</span><span class="op" id="6649430">]</span><span class="builtintype" id="6649431">byte</span><span class="op" id="6649435">{</span><span class="num" id="6649436">18</span><span class="op" id="6649438">,</span>&nbsp;<span class="num" id="6649440">132</span><span class="op" id="6649443">,</span>&nbsp;<span class="num" id="6649445">2</span><span class="op" id="6649446">,</span>&nbsp;<span class="num" id="6649448">64</span><span class="op" id="6649450">,</span>&nbsp;<span class="num" id="6649452">0</span><span class="op" id="6649453">,</span>&nbsp;<span class="num" id="6649455">0</span><span class="op" id="6649456">,</span>&nbsp;<span class="num" id="6649458">0</span><span class="op" id="6649459">,</span>&nbsp;<span class="num" id="6649461">255</span><span class="op" id="6649464">,</span>&nbsp;<span class="num" id="6649466">255</span><span class="op" id="6649469">}</span><span class="op" id="6649470">}</span><span class="op" id="6649471">,</span><br>
<span class="lineno"></span><span class="op" id="6649473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6649476">var</span>&nbsp;<span class="ident" id="6649480">deflateInflateTests</span>&nbsp;<span class="op" id="6649500">=</span>&nbsp;<span class="op" id="6649502">[</span><span class="op" id="6649503">]</span><span class="op" id="6649504">*</span><span class="ident" id="6649505">deflateInflateTest</span><span class="op" id="6649523">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6649526">{</span><span class="op" id="6649527">[</span><span class="op" id="6649528">]</span><span class="builtintype" id="6649529">byte</span><span class="op" id="6649533">{</span><span class="op" id="6649534">}</span><span class="op" id="6649535">}</span><span class="op" id="6649536">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6649539">{</span><span class="op" id="6649540">[</span><span class="op" id="6649541">]</span><span class="builtintype" id="6649542">byte</span><span class="op" id="6649546">{</span><span class="num" id="6649547">0x11</span><span class="op" id="6649551">}</span><span class="op" id="6649552">}</span><span class="op" id="6649553">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6649556">{</span><span class="op" id="6649557">[</span><span class="op" id="6649558">]</span><span class="builtintype" id="6649559">byte</span><span class="op" id="6649563">{</span><span class="num" id="6649564">0x11</span><span class="op" id="6649568">,</span>&nbsp;<span class="num" id="6649570">0x12</span><span class="op" id="6649574">}</span><span class="op" id="6649575">}</span><span class="op" id="6649576">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6649579">{</span><span class="op" id="6649580">[</span><span class="op" id="6649581">]</span><span class="builtintype" id="6649582">byte</span><span class="op" id="6649586">{</span><span class="num" id="6649587">0x11</span><span class="op" id="6649591">,</span>&nbsp;<span class="num" id="6649593">0x11</span><span class="op" id="6649597">,</span>&nbsp;<span class="num" id="6649599">0x11</span><span class="op" id="6649603">,</span>&nbsp;<span class="num" id="6649605">0x11</span><span class="op" id="6649609">,</span>&nbsp;<span class="num" id="6649611">0x11</span><span class="op" id="6649615">,</span>&nbsp;<span class="num" id="6649617">0x11</span><span class="op" id="6649621">,</span>&nbsp;<span class="num" id="6649623">0x11</span><span class="op" id="6649627">,</span>&nbsp;<span class="num" id="6649629">0x11</span><span class="op" id="6649633">}</span><span class="op" id="6649634">}</span><span class="op" id="6649635">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6649638">{</span><span class="op" id="6649639">[</span><span class="op" id="6649640">]</span><span class="builtintype" id="6649641">byte</span><span class="op" id="6649645">{</span><span class="num" id="6649646">0x11</span><span class="op" id="6649650">,</span>&nbsp;<span class="num" id="6649652">0x10</span><span class="op" id="6649656">,</span>&nbsp;<span class="num" id="6649658">0x13</span><span class="op" id="6649662">,</span>&nbsp;<span class="num" id="6649664">0x41</span><span class="op" id="6649668">,</span>&nbsp;<span class="num" id="6649670">0x21</span><span class="op" id="6649674">,</span>&nbsp;<span class="num" id="6649676">0x21</span><span class="op" id="6649680">,</span>&nbsp;<span class="num" id="6649682">0x41</span><span class="op" id="6649686">,</span>&nbsp;<span class="num" id="6649688">0x13</span><span class="op" id="6649692">,</span>&nbsp;<span class="num" id="6649694">0x87</span><span class="op" id="6649698">,</span>&nbsp;<span class="num" id="6649700">0x78</span><span class="op" id="6649704">,</span>&nbsp;<span class="num" id="6649706">0x13</span><span class="op" id="6649710">}</span><span class="op" id="6649711">}</span><span class="op" id="6649712">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6649715">{</span><span class="ident" id="6649716">largeDataChunk</span><span class="op" id="6649730">(</span><span class="op" id="6649731">)</span><span class="op" id="6649732">}</span><span class="op" id="6649733">,</span><br>
<span class="lineno"></span><span class="op" id="6649735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6649738">var</span>&nbsp;<span class="ident" id="6649742">reverseBitsTests</span>&nbsp;<span class="op" id="6649759">=</span>&nbsp;<span class="op" id="6649761">[</span><span class="op" id="6649762">]</span><span class="op" id="6649763">*</span><span class="ident" id="6649764">reverseBitsTest</span><span class="op" id="6649779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6649782">{</span><span class="num" id="6649783">1</span><span class="op" id="6649784">,</span>&nbsp;<span class="num" id="6649786">1</span><span class="op" id="6649787">,</span>&nbsp;<span class="num" id="6649789">1</span><span class="op" id="6649790">}</span><span class="op" id="6649791">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6649794">{</span><span class="num" id="6649795">1</span><span class="op" id="6649796">,</span>&nbsp;<span class="num" id="6649798">2</span><span class="op" id="6649799">,</span>&nbsp;<span class="num" id="6649801">2</span><span class="op" id="6649802">}</span><span class="op" id="6649803">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6649806">{</span><span class="num" id="6649807">1</span><span class="op" id="6649808">,</span>&nbsp;<span class="num" id="6649810">3</span><span class="op" id="6649811">,</span>&nbsp;<span class="num" id="6649813">4</span><span class="op" id="6649814">}</span><span class="op" id="6649815">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6649818">{</span><span class="num" id="6649819">1</span><span class="op" id="6649820">,</span>&nbsp;<span class="num" id="6649822">4</span><span class="op" id="6649823">,</span>&nbsp;<span class="num" id="6649825">8</span><span class="op" id="6649826">}</span><span class="op" id="6649827">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6649830">{</span><span class="num" id="6649831">1</span><span class="op" id="6649832">,</span>&nbsp;<span class="num" id="6649834">5</span><span class="op" id="6649835">,</span>&nbsp;<span class="num" id="6649837">16</span><span class="op" id="6649839">}</span><span class="op" id="6649840">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6649843">{</span><span class="num" id="6649844">17</span><span class="op" id="6649846">,</span>&nbsp;<span class="num" id="6649848">5</span><span class="op" id="6649849">,</span>&nbsp;<span class="num" id="6649851">17</span><span class="op" id="6649853">}</span><span class="op" id="6649854">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6649857">{</span><span class="num" id="6649858">257</span><span class="op" id="6649861">,</span>&nbsp;<span class="num" id="6649863">9</span><span class="op" id="6649864">,</span>&nbsp;<span class="num" id="6649866">257</span><span class="op" id="6649869">}</span><span class="op" id="6649870">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6649873">{</span><span class="num" id="6649874">29</span><span class="op" id="6649876">,</span>&nbsp;<span class="num" id="6649878">5</span><span class="op" id="6649879">,</span>&nbsp;<span class="num" id="6649881">23</span><span class="op" id="6649883">}</span><span class="op" id="6649884">,</span><br>
<span class="lineno"></span><span class="op" id="6649886">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6649889">func</span>&nbsp;<span class="ident" id="6649894">largeDataChunk</span><span class="op" id="6649908">(</span><span class="op" id="6649909">)</span>&nbsp;<span class="op" id="6649911">[</span><span class="op" id="6649912">]</span><span class="builtintype" id="6649913">byte</span>&nbsp;<span class="op" id="6649918">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6649921">result</span>&nbsp;<span class="op" id="6649928">:=</span>&nbsp;<span class="builtinfunc" id="6649931">make</span><span class="op" id="6649935">(</span><span class="op" id="6649936">[</span><span class="op" id="6649937">]</span><span class="builtintype" id="6649938">byte</span><span class="op" id="6649942">,</span>&nbsp;<span class="num" id="6649944">100000</span><span class="op" id="6649950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6649953">for</span>&nbsp;<span class="ident" id="6649957">i</span>&nbsp;<span class="op" id="6649959">:=</span>&nbsp;<span class="keyword" id="6649962">range</span>&nbsp;<span class="ident" id="6649968">result</span>&nbsp;<span class="op" id="6649975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6649979">result</span><span class="op" id="6649985">[</span><span class="ident" id="6649986">i</span><span class="op" id="6649987">]</span>&nbsp;<span class="op" id="6649989">=</span>&nbsp;<span class="builtintype" id="6649991">byte</span><span class="op" id="6649995">(</span><span class="ident" id="6649996">i</span>&nbsp;<span class="op" id="6649998">*</span>&nbsp;<span class="ident" id="6650000">i</span>&nbsp;<span class="op" id="6650002">&amp;</span>&nbsp;<span class="num" id="6650004">0xFF</span><span class="op" id="6650008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6650011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6650014">return</span>&nbsp;<span class="ident" id="6650021">result</span><br>
<span class="lineno">80</span><span class="op" id="6650028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6650031">func</span>&nbsp;<span class="ident" id="6650036">TestDeflate</span><span class="op" id="6650047">(</span><span class="ident" id="6650048">t</span>&nbsp;<span class="op" id="6650050">*</span><span class="ident" id="6650051">testing</span><span class="op" id="6650058">.</span><span class="ident" id="6650059">T</span><span class="op" id="6650060">)</span>&nbsp;<span class="op" id="6650062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6650065">for</span>&nbsp;<span class="ident" id="6650069">_</span><span class="op" id="6650070">,</span>&nbsp;<span class="ident" id="6650072">h</span>&nbsp;<span class="op" id="6650074">:=</span>&nbsp;<span class="keyword" id="6650077">range</span>&nbsp;<span class="ident" id="6650083">deflateTests</span>&nbsp;<span class="op" id="6650096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6650100">var</span>&nbsp;<span class="ident" id="6650104">buf</span>&nbsp;<span class="ident" id="6650108">bytes</span><span class="op" id="6650113">.</span><span class="ident" id="6650114">Buffer</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6650123">w</span><span class="op" id="6650124">,</span>&nbsp;<span class="ident" id="6650126">err</span>&nbsp;<span class="op" id="6650130">:=</span>&nbsp;<span class="ident" id="6650133">NewWriter</span><span class="op" id="6650142">(</span><span class="op" id="6650143">&amp;</span><span class="ident" id="6650144">buf</span><span class="op" id="6650147">,</span>&nbsp;<span class="ident" id="6650149">h</span><span class="op" id="6650150">.</span><span class="ident" id="6650151">level</span><span class="op" id="6650156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6650160">if</span>&nbsp;<span class="ident" id="6650163">err</span>&nbsp;<span class="op" id="6650167">!=</span>&nbsp;<span class="ident" id="6650170">nil</span>&nbsp;<span class="op" id="6650174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6650179">t</span><span class="op" id="6650180">.</span><span class="ident" id="6650181">Errorf</span><span class="op" id="6650187">(</span><span class="string" id="6650188">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6650203">,</span>&nbsp;<span class="ident" id="6650205">err</span><span class="op" id="6650208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6650213">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6650224">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6650228">w</span><span class="op" id="6650229">.</span><span class="ident" id="6650230">Write</span><span class="op" id="6650235">(</span><span class="ident" id="6650236">h</span><span class="op" id="6650237">.</span><span class="ident" id="6650238">in</span><span class="op" id="6650240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6650244">w</span><span class="op" id="6650245">.</span><span class="ident" id="6650246">Close</span><span class="op" id="6650251">(</span><span class="op" id="6650252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6650256">if</span>&nbsp;<span class="op" id="6650259">!</span><span class="ident" id="6650260">bytes</span><span class="op" id="6650265">.</span><span class="ident" id="6650266">Equal</span><span class="op" id="6650271">(</span><span class="ident" id="6650272">buf</span><span class="op" id="6650275">.</span><span class="ident" id="6650276">Bytes</span><span class="op" id="6650281">(</span><span class="op" id="6650282">)</span><span class="op" id="6650283">,</span>&nbsp;<span class="ident" id="6650285">h</span><span class="op" id="6650286">.</span><span class="ident" id="6650287">out</span><span class="op" id="6650290">)</span>&nbsp;<span class="op" id="6650292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6650297">t</span><span class="op" id="6650298">.</span><span class="ident" id="6650299">Errorf</span><span class="op" id="6650305">(</span><span class="string" id="6650306">&#34;Deflate(%d,&nbsp;%x)&nbsp;=&nbsp;%x,&nbsp;want&nbsp;%x&#34;</span><span class="op" id="6650337">,</span>&nbsp;<span class="ident" id="6650339">h</span><span class="op" id="6650340">.</span><span class="ident" id="6650341">level</span><span class="op" id="6650346">,</span>&nbsp;<span class="ident" id="6650348">h</span><span class="op" id="6650349">.</span><span class="ident" id="6650350">in</span><span class="op" id="6650352">,</span>&nbsp;<span class="ident" id="6650354">buf</span><span class="op" id="6650357">.</span><span class="ident" id="6650358">Bytes</span><span class="op" id="6650363">(</span><span class="op" id="6650364">)</span><span class="op" id="6650365">,</span>&nbsp;<span class="ident" id="6650367">h</span><span class="op" id="6650368">.</span><span class="ident" id="6650369">out</span><span class="op" id="6650372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6650376">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6650379">}</span><br>
<span class="lineno"></span><span class="op" id="6650381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6650384">//&nbsp;A&nbsp;sparseReader&nbsp;returns&nbsp;a&nbsp;stream&nbsp;consisting&nbsp;of&nbsp;0s&nbsp;followed&nbsp;by&nbsp;1&lt;&lt;16&nbsp;1s.</span><br>
<span class="lineno"></span><span class="comment" id="6650458">//&nbsp;This&nbsp;tests&nbsp;missing&nbsp;hash&nbsp;references&nbsp;in&nbsp;a&nbsp;very&nbsp;large&nbsp;input.</span><br>
<span class="lineno">100</span><span class="keyword" id="6650519">type</span>&nbsp;<span class="ident" id="6650524">sparseReader</span>&nbsp;<span class="keyword" id="6650537">struct</span>&nbsp;<span class="op" id="6650544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6650547">l</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6650551">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6650558">cur</span>&nbsp;<span class="ident" id="6650562">int64</span><br>
<span class="lineno"></span><span class="op" id="6650568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="6650571">func</span>&nbsp;<span class="op" id="6650576">(</span><span class="ident" id="6650577">r</span>&nbsp;<span class="op" id="6650579">*</span><span class="ident" id="6650580">sparseReader</span><span class="op" id="6650592">)</span>&nbsp;<span class="ident" id="6650594">Read</span><span class="op" id="6650598">(</span><span class="ident" id="6650599">b</span>&nbsp;<span class="op" id="6650601">[</span><span class="op" id="6650602">]</span><span class="builtintype" id="6650603">byte</span><span class="op" id="6650607">)</span>&nbsp;<span class="op" id="6650609">(</span><span class="ident" id="6650610">n</span>&nbsp;<span class="builtintype" id="6650612">int</span><span class="op" id="6650615">,</span>&nbsp;<span class="ident" id="6650617">err</span>&nbsp;<span class="builtintype" id="6650621">error</span><span class="op" id="6650626">)</span>&nbsp;<span class="op" id="6650628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6650631">if</span>&nbsp;<span class="ident" id="6650634">r</span><span class="op" id="6650635">.</span><span class="ident" id="6650636">cur</span>&nbsp;<span class="op" id="6650640">&gt;=</span>&nbsp;<span class="ident" id="6650643">r</span><span class="op" id="6650644">.</span><span class="ident" id="6650645">l</span>&nbsp;<span class="op" id="6650647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6650651">return</span>&nbsp;<span class="num" id="6650658">0</span><span class="op" id="6650659">,</span>&nbsp;<span class="ident" id="6650661">io</span><span class="op" id="6650663">.</span><span class="ident" id="6650664">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6650669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6650672">n</span>&nbsp;<span class="op" id="6650674">=</span>&nbsp;<span class="builtinfunc" id="6650676">len</span><span class="op" id="6650679">(</span><span class="ident" id="6650680">b</span><span class="op" id="6650681">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6650684">cur</span>&nbsp;<span class="op" id="6650688">:=</span>&nbsp;<span class="ident" id="6650691">r</span><span class="op" id="6650692">.</span><span class="ident" id="6650693">cur</span>&nbsp;<span class="op" id="6650697">+</span>&nbsp;<span class="ident" id="6650699">int64</span><span class="op" id="6650704">(</span><span class="ident" id="6650705">n</span><span class="op" id="6650706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6650709">if</span>&nbsp;<span class="ident" id="6650712">cur</span>&nbsp;<span class="op" id="6650716">&gt;</span>&nbsp;<span class="ident" id="6650718">r</span><span class="op" id="6650719">.</span><span class="ident" id="6650720">l</span>&nbsp;<span class="op" id="6650722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6650726">n</span>&nbsp;<span class="op" id="6650728">-=</span>&nbsp;<span class="builtintype" id="6650731">int</span><span class="op" id="6650734">(</span><span class="ident" id="6650735">cur</span>&nbsp;<span class="op" id="6650739">-</span>&nbsp;<span class="ident" id="6650741">r</span><span class="op" id="6650742">.</span><span class="ident" id="6650743">l</span><span class="op" id="6650744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6650748">cur</span>&nbsp;<span class="op" id="6650752">=</span>&nbsp;<span class="ident" id="6650754">r</span><span class="op" id="6650755">.</span><span class="ident" id="6650756">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6650759">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6650762">for</span>&nbsp;<span class="ident" id="6650766">i</span>&nbsp;<span class="op" id="6650768">:=</span>&nbsp;<span class="keyword" id="6650771">range</span>&nbsp;<span class="ident" id="6650777">b</span><span class="op" id="6650778">[</span><span class="num" id="6650779">0</span><span class="op" id="6650780">:</span><span class="ident" id="6650781">n</span><span class="op" id="6650782">]</span>&nbsp;<span class="op" id="6650784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6650788">if</span>&nbsp;<span class="ident" id="6650791">r</span><span class="op" id="6650792">.</span><span class="ident" id="6650793">cur</span><span class="op" id="6650796">+</span><span class="ident" id="6650797">int64</span><span class="op" id="6650802">(</span><span class="ident" id="6650803">i</span><span class="op" id="6650804">)</span>&nbsp;<span class="op" id="6650806">&gt;=</span>&nbsp;<span class="ident" id="6650809">r</span><span class="op" id="6650810">.</span><span class="ident" id="6650811">l</span><span class="op" id="6650812">-</span><span class="num" id="6650813">1</span><span class="op" id="6650814">&lt;&lt;</span><span class="num" id="6650816">16</span>&nbsp;<span class="op" id="6650819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6650824">b</span><span class="op" id="6650825">[</span><span class="ident" id="6650826">i</span><span class="op" id="6650827">]</span>&nbsp;<span class="op" id="6650829">=</span>&nbsp;<span class="num" id="6650831">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6650835">}</span>&nbsp;<span class="keyword" id="6650837">else</span>&nbsp;<span class="op" id="6650842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6650847">b</span><span class="op" id="6650848">[</span><span class="ident" id="6650849">i</span><span class="op" id="6650850">]</span>&nbsp;<span class="op" id="6650852">=</span>&nbsp;<span class="num" id="6650854">0</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6650858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6650861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6650864">r</span><span class="op" id="6650865">.</span><span class="ident" id="6650866">cur</span>&nbsp;<span class="op" id="6650870">=</span>&nbsp;<span class="ident" id="6650872">cur</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6650877">return</span><br>
<span class="lineno"></span><span class="op" id="6650884">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="6650887">func</span>&nbsp;<span class="ident" id="6650892">TestVeryLongSparseChunk</span><span class="op" id="6650915">(</span><span class="ident" id="6650916">t</span>&nbsp;<span class="op" id="6650918">*</span><span class="ident" id="6650919">testing</span><span class="op" id="6650926">.</span><span class="ident" id="6650927">T</span><span class="op" id="6650928">)</span>&nbsp;<span class="op" id="6650930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6650933">if</span>&nbsp;<span class="ident" id="6650936">testing</span><span class="op" id="6650943">.</span><span class="ident" id="6650944">Short</span><span class="op" id="6650949">(</span><span class="op" id="6650950">)</span>&nbsp;<span class="op" id="6650952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6650956">t</span><span class="op" id="6650957">.</span><span class="ident" id="6650958">Skip</span><span class="op" id="6650962">(</span><span class="string" id="6650963">&#34;skipping&nbsp;sparse&nbsp;chunk&nbsp;during&nbsp;short&nbsp;test&#34;</span><span class="op" id="6651004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6651007">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6651010">w</span><span class="op" id="6651011">,</span>&nbsp;<span class="ident" id="6651013">err</span>&nbsp;<span class="op" id="6651017">:=</span>&nbsp;<span class="ident" id="6651020">NewWriter</span><span class="op" id="6651029">(</span><span class="ident" id="6651030">ioutil</span><span class="op" id="6651036">.</span><span class="ident" id="6651037">Discard</span><span class="op" id="6651044">,</span>&nbsp;<span class="num" id="6651046">1</span><span class="op" id="6651047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6651050">if</span>&nbsp;<span class="ident" id="6651053">err</span>&nbsp;<span class="op" id="6651057">!=</span>&nbsp;<span class="ident" id="6651060">nil</span>&nbsp;<span class="op" id="6651064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6651068">t</span><span class="op" id="6651069">.</span><span class="ident" id="6651070">Errorf</span><span class="op" id="6651076">(</span><span class="string" id="6651077">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6651092">,</span>&nbsp;<span class="ident" id="6651094">err</span><span class="op" id="6651097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6651101">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6651109">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6651112">if</span>&nbsp;<span class="ident" id="6651115">_</span><span class="op" id="6651116">,</span>&nbsp;<span class="ident" id="6651118">err</span>&nbsp;<span class="op" id="6651122">=</span>&nbsp;<span class="ident" id="6651124">io</span><span class="op" id="6651126">.</span><span class="ident" id="6651127">Copy</span><span class="op" id="6651131">(</span><span class="ident" id="6651132">w</span><span class="op" id="6651133">,</span>&nbsp;<span class="op" id="6651135">&amp;</span><span class="ident" id="6651136">sparseReader</span><span class="op" id="6651148">{</span><span class="ident" id="6651149">l</span><span class="op" id="6651150">:</span>&nbsp;<span class="num" id="6651152">23E8</span><span class="op" id="6651156">}</span><span class="op" id="6651157">)</span><span class="op" id="6651158">;</span>&nbsp;<span class="ident" id="6651160">err</span>&nbsp;<span class="op" id="6651164">!=</span>&nbsp;<span class="ident" id="6651167">nil</span>&nbsp;<span class="op" id="6651171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6651175">t</span><span class="op" id="6651176">.</span><span class="ident" id="6651177">Errorf</span><span class="op" id="6651183">(</span><span class="string" id="6651184">&#34;Compress&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6651205">,</span>&nbsp;<span class="ident" id="6651207">err</span><span class="op" id="6651210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6651214">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6651222">}</span><br>
<span class="lineno"></span><span class="op" id="6651224">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="6651227">type</span>&nbsp;<span class="ident" id="6651232">syncBuffer</span>&nbsp;<span class="keyword" id="6651243">struct</span>&nbsp;<span class="op" id="6651250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6651253">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6651260">bytes</span><span class="op" id="6651265">.</span><span class="ident" id="6651266">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6651274">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6651281">sync</span><span class="op" id="6651285">.</span><span class="ident" id="6651286">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6651295">closed</span>&nbsp;<span class="builtintype" id="6651302">bool</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6651308">ready</span>&nbsp;&nbsp;<span class="keyword" id="6651315">chan</span>&nbsp;<span class="builtintype" id="6651320">bool</span><br>
<span class="lineno"></span><span class="op" id="6651325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6651328">func</span>&nbsp;<span class="ident" id="6651333">newSyncBuffer</span><span class="op" id="6651346">(</span><span class="op" id="6651347">)</span>&nbsp;<span class="op" id="6651349">*</span><span class="ident" id="6651350">syncBuffer</span>&nbsp;<span class="op" id="6651361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6651364">return</span>&nbsp;<span class="op" id="6651371">&amp;</span><span class="ident" id="6651372">syncBuffer</span><span class="op" id="6651382">{</span><span class="ident" id="6651383">ready</span><span class="op" id="6651388">:</span>&nbsp;<span class="builtinfunc" id="6651390">make</span><span class="op" id="6651394">(</span><span class="keyword" id="6651395">chan</span>&nbsp;<span class="builtintype" id="6651400">bool</span><span class="op" id="6651404">,</span>&nbsp;<span class="num" id="6651406">1</span><span class="op" id="6651407">)</span><span class="op" id="6651408">}</span><br>
<span class="lineno">150</span><span class="op" id="6651410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6651413">func</span>&nbsp;<span class="op" id="6651418">(</span><span class="ident" id="6651419">b</span>&nbsp;<span class="op" id="6651421">*</span><span class="ident" id="6651422">syncBuffer</span><span class="op" id="6651432">)</span>&nbsp;<span class="ident" id="6651434">Read</span><span class="op" id="6651438">(</span><span class="ident" id="6651439">p</span>&nbsp;<span class="op" id="6651441">[</span><span class="op" id="6651442">]</span><span class="builtintype" id="6651443">byte</span><span class="op" id="6651447">)</span>&nbsp;<span class="op" id="6651449">(</span><span class="ident" id="6651450">n</span>&nbsp;<span class="builtintype" id="6651452">int</span><span class="op" id="6651455">,</span>&nbsp;<span class="ident" id="6651457">err</span>&nbsp;<span class="builtintype" id="6651461">error</span><span class="op" id="6651466">)</span>&nbsp;<span class="op" id="6651468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6651471">for</span>&nbsp;<span class="op" id="6651475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6651479">b</span><span class="op" id="6651480">.</span><span class="ident" id="6651481">mu</span><span class="op" id="6651483">.</span><span class="ident" id="6651484">RLock</span><span class="op" id="6651489">(</span><span class="op" id="6651490">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6651494">n</span><span class="op" id="6651495">,</span>&nbsp;<span class="ident" id="6651497">err</span>&nbsp;<span class="op" id="6651501">=</span>&nbsp;<span class="ident" id="6651503">b</span><span class="op" id="6651504">.</span><span class="ident" id="6651505">buf</span><span class="op" id="6651508">.</span><span class="ident" id="6651509">Read</span><span class="op" id="6651513">(</span><span class="ident" id="6651514">p</span><span class="op" id="6651515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6651519">b</span><span class="op" id="6651520">.</span><span class="ident" id="6651521">mu</span><span class="op" id="6651523">.</span><span class="ident" id="6651524">RUnlock</span><span class="op" id="6651531">(</span><span class="op" id="6651532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6651536">if</span>&nbsp;<span class="ident" id="6651539">n</span>&nbsp;<span class="op" id="6651541">&gt;</span>&nbsp;<span class="num" id="6651543">0</span>&nbsp;<span class="op" id="6651545">||</span>&nbsp;<span class="ident" id="6651548">b</span><span class="op" id="6651549">.</span><span class="ident" id="6651550">closed</span>&nbsp;<span class="op" id="6651557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6651562">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6651571">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6651575">&lt;-</span><span class="ident" id="6651577">b</span><span class="op" id="6651578">.</span><span class="ident" id="6651579">ready</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6651586">}</span><br>
<span class="lineno"></span><span class="op" id="6651588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6651591">func</span>&nbsp;<span class="op" id="6651596">(</span><span class="ident" id="6651597">b</span>&nbsp;<span class="op" id="6651599">*</span><span class="ident" id="6651600">syncBuffer</span><span class="op" id="6651610">)</span>&nbsp;<span class="ident" id="6651612">signal</span><span class="op" id="6651618">(</span><span class="op" id="6651619">)</span>&nbsp;<span class="op" id="6651621">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6651624">select</span>&nbsp;<span class="op" id="6651631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6651634">case</span>&nbsp;<span class="ident" id="6651639">b</span><span class="op" id="6651640">.</span><span class="ident" id="6651641">ready</span>&nbsp;<span class="op" id="6651647">&lt;-</span>&nbsp;<span class="builtintype" id="6651650">true</span><span class="op" id="6651654">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6651657">default</span><span class="op" id="6651664">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6651667">}</span><br>
<span class="lineno"></span><span class="op" id="6651669">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="6651672">func</span>&nbsp;<span class="op" id="6651677">(</span><span class="ident" id="6651678">b</span>&nbsp;<span class="op" id="6651680">*</span><span class="ident" id="6651681">syncBuffer</span><span class="op" id="6651691">)</span>&nbsp;<span class="ident" id="6651693">Write</span><span class="op" id="6651698">(</span><span class="ident" id="6651699">p</span>&nbsp;<span class="op" id="6651701">[</span><span class="op" id="6651702">]</span><span class="builtintype" id="6651703">byte</span><span class="op" id="6651707">)</span>&nbsp;<span class="op" id="6651709">(</span><span class="ident" id="6651710">n</span>&nbsp;<span class="builtintype" id="6651712">int</span><span class="op" id="6651715">,</span>&nbsp;<span class="ident" id="6651717">err</span>&nbsp;<span class="builtintype" id="6651721">error</span><span class="op" id="6651726">)</span>&nbsp;<span class="op" id="6651728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6651731">n</span><span class="op" id="6651732">,</span>&nbsp;<span class="ident" id="6651734">err</span>&nbsp;<span class="op" id="6651738">=</span>&nbsp;<span class="ident" id="6651740">b</span><span class="op" id="6651741">.</span><span class="ident" id="6651742">buf</span><span class="op" id="6651745">.</span><span class="ident" id="6651746">Write</span><span class="op" id="6651751">(</span><span class="ident" id="6651752">p</span><span class="op" id="6651753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6651756">b</span><span class="op" id="6651757">.</span><span class="ident" id="6651758">signal</span><span class="op" id="6651764">(</span><span class="op" id="6651765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6651768">return</span><br>
<span class="lineno">175</span><span class="op" id="6651775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6651778">func</span>&nbsp;<span class="op" id="6651783">(</span><span class="ident" id="6651784">b</span>&nbsp;<span class="op" id="6651786">*</span><span class="ident" id="6651787">syncBuffer</span><span class="op" id="6651797">)</span>&nbsp;<span class="ident" id="6651799">WriteMode</span><span class="op" id="6651808">(</span><span class="op" id="6651809">)</span>&nbsp;<span class="op" id="6651811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6651814">b</span><span class="op" id="6651815">.</span><span class="ident" id="6651816">mu</span><span class="op" id="6651818">.</span><span class="ident" id="6651819">Lock</span><span class="op" id="6651823">(</span><span class="op" id="6651824">)</span><br>
<span class="lineno"></span><span class="op" id="6651826">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="6651829">func</span>&nbsp;<span class="op" id="6651834">(</span><span class="ident" id="6651835">b</span>&nbsp;<span class="op" id="6651837">*</span><span class="ident" id="6651838">syncBuffer</span><span class="op" id="6651848">)</span>&nbsp;<span class="ident" id="6651850">ReadMode</span><span class="op" id="6651858">(</span><span class="op" id="6651859">)</span>&nbsp;<span class="op" id="6651861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6651864">b</span><span class="op" id="6651865">.</span><span class="ident" id="6651866">mu</span><span class="op" id="6651868">.</span><span class="ident" id="6651869">Unlock</span><span class="op" id="6651875">(</span><span class="op" id="6651876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6651879">b</span><span class="op" id="6651880">.</span><span class="ident" id="6651881">signal</span><span class="op" id="6651887">(</span><span class="op" id="6651888">)</span><br>
<span class="lineno"></span><span class="op" id="6651890">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword" id="6651893">func</span>&nbsp;<span class="op" id="6651898">(</span><span class="ident" id="6651899">b</span>&nbsp;<span class="op" id="6651901">*</span><span class="ident" id="6651902">syncBuffer</span><span class="op" id="6651912">)</span>&nbsp;<span class="ident" id="6651914">Close</span><span class="op" id="6651919">(</span><span class="op" id="6651920">)</span>&nbsp;<span class="builtintype" id="6651922">error</span>&nbsp;<span class="op" id="6651928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6651931">b</span><span class="op" id="6651932">.</span><span class="ident" id="6651933">closed</span>&nbsp;<span class="op" id="6651940">=</span>&nbsp;<span class="builtintype" id="6651942">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6651948">b</span><span class="op" id="6651949">.</span><span class="ident" id="6651950">signal</span><span class="op" id="6651956">(</span><span class="op" id="6651957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6651960">return</span>&nbsp;<span class="ident" id="6651967">nil</span><br>
<span class="lineno">190</span><span class="op" id="6651971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6651974">func</span>&nbsp;<span class="ident" id="6651979">testSync</span><span class="op" id="6651987">(</span><span class="ident" id="6651988">t</span>&nbsp;<span class="op" id="6651990">*</span><span class="ident" id="6651991">testing</span><span class="op" id="6651998">.</span><span class="ident" id="6651999">T</span><span class="op" id="6652000">,</span>&nbsp;<span class="ident" id="6652002">level</span>&nbsp;<span class="builtintype" id="6652008">int</span><span class="op" id="6652011">,</span>&nbsp;<span class="ident" id="6652013">input</span>&nbsp;<span class="op" id="6652019">[</span><span class="op" id="6652020">]</span><span class="builtintype" id="6652021">byte</span><span class="op" id="6652025">,</span>&nbsp;<span class="ident" id="6652027">name</span>&nbsp;<span class="builtintype" id="6652032">string</span><span class="op" id="6652038">)</span>&nbsp;<span class="op" id="6652040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6652043">if</span>&nbsp;<span class="builtinfunc" id="6652046">len</span><span class="op" id="6652049">(</span><span class="ident" id="6652050">input</span><span class="op" id="6652055">)</span>&nbsp;<span class="op" id="6652057">==</span>&nbsp;<span class="num" id="6652060">0</span>&nbsp;<span class="op" id="6652062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6652066">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6652074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6652078">t</span><span class="op" id="6652079">.</span><span class="ident" id="6652080">Logf</span><span class="op" id="6652084">(</span><span class="string" id="6652085">&#34;--testSync&nbsp;%d,&nbsp;%d,&nbsp;%s&#34;</span><span class="op" id="6652108">,</span>&nbsp;<span class="ident" id="6652110">level</span><span class="op" id="6652115">,</span>&nbsp;<span class="builtinfunc" id="6652117">len</span><span class="op" id="6652120">(</span><span class="ident" id="6652121">input</span><span class="op" id="6652126">)</span><span class="op" id="6652127">,</span>&nbsp;<span class="ident" id="6652129">name</span><span class="op" id="6652133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6652136">buf</span>&nbsp;<span class="op" id="6652140">:=</span>&nbsp;<span class="ident" id="6652143">newSyncBuffer</span><span class="op" id="6652156">(</span><span class="op" id="6652157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6652160">buf1</span>&nbsp;<span class="op" id="6652165">:=</span>&nbsp;<span class="builtinfunc" id="6652168">new</span><span class="op" id="6652171">(</span><span class="ident" id="6652172">bytes</span><span class="op" id="6652177">.</span><span class="ident" id="6652178">Buffer</span><span class="op" id="6652184">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6652187">buf</span><span class="op" id="6652190">.</span><span class="ident" id="6652191">WriteMode</span><span class="op" id="6652200">(</span><span class="op" id="6652201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6652204">w</span><span class="op" id="6652205">,</span>&nbsp;<span class="ident" id="6652207">err</span>&nbsp;<span class="op" id="6652211">:=</span>&nbsp;<span class="ident" id="6652214">NewWriter</span><span class="op" id="6652223">(</span><span class="ident" id="6652224">io</span><span class="op" id="6652226">.</span><span class="ident" id="6652227">MultiWriter</span><span class="op" id="6652238">(</span><span class="ident" id="6652239">buf</span><span class="op" id="6652242">,</span>&nbsp;<span class="ident" id="6652244">buf1</span><span class="op" id="6652248">)</span><span class="op" id="6652249">,</span>&nbsp;<span class="ident" id="6652251">level</span><span class="op" id="6652256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6652259">if</span>&nbsp;<span class="ident" id="6652262">err</span>&nbsp;<span class="op" id="6652266">!=</span>&nbsp;<span class="ident" id="6652269">nil</span>&nbsp;<span class="op" id="6652273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6652277">t</span><span class="op" id="6652278">.</span><span class="ident" id="6652279">Errorf</span><span class="op" id="6652285">(</span><span class="string" id="6652286">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6652301">,</span>&nbsp;<span class="ident" id="6652303">err</span><span class="op" id="6652306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6652310">return</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6652318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6652321">r</span>&nbsp;<span class="op" id="6652323">:=</span>&nbsp;<span class="ident" id="6652326">NewReader</span><span class="op" id="6652335">(</span><span class="ident" id="6652336">buf</span><span class="op" id="6652339">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6652343">//&nbsp;Write&nbsp;half&nbsp;the&nbsp;input&nbsp;and&nbsp;read&nbsp;back.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6652383">for</span>&nbsp;<span class="ident" id="6652387">i</span>&nbsp;<span class="op" id="6652389">:=</span>&nbsp;<span class="num" id="6652392">0</span><span class="op" id="6652393">;</span>&nbsp;<span class="ident" id="6652395">i</span>&nbsp;<span class="op" id="6652397">&lt;</span>&nbsp;<span class="num" id="6652399">2</span><span class="op" id="6652400">;</span>&nbsp;<span class="ident" id="6652402">i</span><span class="op" id="6652403">++</span>&nbsp;<span class="op" id="6652406">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6652410">var</span>&nbsp;<span class="ident" id="6652414">lo</span><span class="op" id="6652416">,</span>&nbsp;<span class="ident" id="6652418">hi</span>&nbsp;<span class="builtintype" id="6652421">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6652427">if</span>&nbsp;<span class="ident" id="6652430">i</span>&nbsp;<span class="op" id="6652432">==</span>&nbsp;<span class="num" id="6652435">0</span>&nbsp;<span class="op" id="6652437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6652442">lo</span><span class="op" id="6652444">,</span>&nbsp;<span class="ident" id="6652446">hi</span>&nbsp;<span class="op" id="6652449">=</span>&nbsp;<span class="num" id="6652451">0</span><span class="op" id="6652452">,</span>&nbsp;<span class="op" id="6652454">(</span><span class="builtinfunc" id="6652455">len</span><span class="op" id="6652458">(</span><span class="ident" id="6652459">input</span><span class="op" id="6652464">)</span><span class="op" id="6652465">+</span><span class="num" id="6652466">1</span><span class="op" id="6652467">)</span><span class="op" id="6652468">/</span><span class="num" id="6652469">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6652473">}</span>&nbsp;<span class="keyword" id="6652475">else</span>&nbsp;<span class="op" id="6652480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6652485">lo</span><span class="op" id="6652487">,</span>&nbsp;<span class="ident" id="6652489">hi</span>&nbsp;<span class="op" id="6652492">=</span>&nbsp;<span class="op" id="6652494">(</span><span class="builtinfunc" id="6652495">len</span><span class="op" id="6652498">(</span><span class="ident" id="6652499">input</span><span class="op" id="6652504">)</span><span class="op" id="6652505">+</span><span class="num" id="6652506">1</span><span class="op" id="6652507">)</span><span class="op" id="6652508">/</span><span class="num" id="6652509">2</span><span class="op" id="6652510">,</span>&nbsp;<span class="builtinfunc" id="6652512">len</span><span class="op" id="6652515">(</span><span class="ident" id="6652516">input</span><span class="op" id="6652521">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6652525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6652529">t</span><span class="op" id="6652530">.</span><span class="ident" id="6652531">Logf</span><span class="op" id="6652535">(</span><span class="string" id="6652536">&#34;#%d:&nbsp;write&nbsp;%d-%d&#34;</span><span class="op" id="6652554">,</span>&nbsp;<span class="ident" id="6652556">i</span><span class="op" id="6652557">,</span>&nbsp;<span class="ident" id="6652559">lo</span><span class="op" id="6652561">,</span>&nbsp;<span class="ident" id="6652563">hi</span><span class="op" id="6652565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6652569">if</span>&nbsp;<span class="ident" id="6652572">_</span><span class="op" id="6652573">,</span>&nbsp;<span class="ident" id="6652575">err</span>&nbsp;<span class="op" id="6652579">:=</span>&nbsp;<span class="ident" id="6652582">w</span><span class="op" id="6652583">.</span><span class="ident" id="6652584">Write</span><span class="op" id="6652589">(</span><span class="ident" id="6652590">input</span><span class="op" id="6652595">[</span><span class="ident" id="6652596">lo</span><span class="op" id="6652598">:</span><span class="ident" id="6652599">hi</span><span class="op" id="6652601">]</span><span class="op" id="6652602">)</span><span class="op" id="6652603">;</span>&nbsp;<span class="ident" id="6652605">err</span>&nbsp;<span class="op" id="6652609">!=</span>&nbsp;<span class="ident" id="6652612">nil</span>&nbsp;<span class="op" id="6652616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6652621">t</span><span class="op" id="6652622">.</span><span class="ident" id="6652623">Errorf</span><span class="op" id="6652629">(</span><span class="string" id="6652630">&#34;testSync:&nbsp;write:&nbsp;%v&#34;</span><span class="op" id="6652651">,</span>&nbsp;<span class="ident" id="6652653">err</span><span class="op" id="6652656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6652661">return</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6652670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6652674">if</span>&nbsp;<span class="ident" id="6652677">i</span>&nbsp;<span class="op" id="6652679">==</span>&nbsp;<span class="num" id="6652682">0</span>&nbsp;<span class="op" id="6652684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6652689">if</span>&nbsp;<span class="ident" id="6652692">err</span>&nbsp;<span class="op" id="6652696">:=</span>&nbsp;<span class="ident" id="6652699">w</span><span class="op" id="6652700">.</span><span class="ident" id="6652701">Flush</span><span class="op" id="6652706">(</span><span class="op" id="6652707">)</span><span class="op" id="6652708">;</span>&nbsp;<span class="ident" id="6652710">err</span>&nbsp;<span class="op" id="6652714">!=</span>&nbsp;<span class="ident" id="6652717">nil</span>&nbsp;<span class="op" id="6652721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6652727">t</span><span class="op" id="6652728">.</span><span class="ident" id="6652729">Errorf</span><span class="op" id="6652735">(</span><span class="string" id="6652736">&#34;testSync:&nbsp;flush:&nbsp;%v&#34;</span><span class="op" id="6652757">,</span>&nbsp;<span class="ident" id="6652759">err</span><span class="op" id="6652762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6652768">return</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6652778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6652782">}</span>&nbsp;<span class="keyword" id="6652784">else</span>&nbsp;<span class="op" id="6652789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6652794">if</span>&nbsp;<span class="ident" id="6652797">err</span>&nbsp;<span class="op" id="6652801">:=</span>&nbsp;<span class="ident" id="6652804">w</span><span class="op" id="6652805">.</span><span class="ident" id="6652806">Close</span><span class="op" id="6652811">(</span><span class="op" id="6652812">)</span><span class="op" id="6652813">;</span>&nbsp;<span class="ident" id="6652815">err</span>&nbsp;<span class="op" id="6652819">!=</span>&nbsp;<span class="ident" id="6652822">nil</span>&nbsp;<span class="op" id="6652826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6652832">t</span><span class="op" id="6652833">.</span><span class="ident" id="6652834">Errorf</span><span class="op" id="6652840">(</span><span class="string" id="6652841">&#34;testSync:&nbsp;close:&nbsp;%v&#34;</span><span class="op" id="6652862">,</span>&nbsp;<span class="ident" id="6652864">err</span><span class="op" id="6652867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6652872">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6652876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6652880">buf</span><span class="op" id="6652883">.</span><span class="ident" id="6652884">ReadMode</span><span class="op" id="6652892">(</span><span class="op" id="6652893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6652897">out</span>&nbsp;<span class="op" id="6652901">:=</span>&nbsp;<span class="builtinfunc" id="6652904">make</span><span class="op" id="6652908">(</span><span class="op" id="6652909">[</span><span class="op" id="6652910">]</span><span class="builtintype" id="6652911">byte</span><span class="op" id="6652915">,</span>&nbsp;<span class="ident" id="6652917">hi</span><span class="op" id="6652919">-</span><span class="ident" id="6652920">lo</span><span class="op" id="6652922">+</span><span class="num" id="6652923">1</span><span class="op" id="6652924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6652928">m</span><span class="op" id="6652929">,</span>&nbsp;<span class="ident" id="6652931">err</span>&nbsp;<span class="op" id="6652935">:=</span>&nbsp;<span class="ident" id="6652938">io</span><span class="op" id="6652940">.</span><span class="ident" id="6652941">ReadAtLeast</span><span class="op" id="6652952">(</span><span class="ident" id="6652953">r</span><span class="op" id="6652954">,</span>&nbsp;<span class="ident" id="6652956">out</span><span class="op" id="6652959">,</span>&nbsp;<span class="ident" id="6652961">hi</span><span class="op" id="6652963">-</span><span class="ident" id="6652964">lo</span><span class="op" id="6652966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6652970">t</span><span class="op" id="6652971">.</span><span class="ident" id="6652972">Logf</span><span class="op" id="6652976">(</span><span class="string" id="6652977">&#34;#%d:&nbsp;read&nbsp;%d&#34;</span><span class="op" id="6652991">,</span>&nbsp;<span class="ident" id="6652993">i</span><span class="op" id="6652994">,</span>&nbsp;<span class="ident" id="6652996">m</span><span class="op" id="6652997">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6653001">if</span>&nbsp;<span class="ident" id="6653004">m</span>&nbsp;<span class="op" id="6653006">!=</span>&nbsp;<span class="ident" id="6653009">hi</span><span class="op" id="6653011">-</span><span class="ident" id="6653012">lo</span>&nbsp;<span class="op" id="6653015">||</span>&nbsp;<span class="ident" id="6653018">err</span>&nbsp;<span class="op" id="6653022">!=</span>&nbsp;<span class="ident" id="6653025">nil</span>&nbsp;<span class="op" id="6653029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6653034">t</span><span class="op" id="6653035">.</span><span class="ident" id="6653036">Errorf</span><span class="op" id="6653042">(</span><span class="string" id="6653043">&#34;testSync/%d&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;read&nbsp;%d:&nbsp;%d,&nbsp;%v&nbsp;(%d&nbsp;left)&#34;</span><span class="op" id="6653096">,</span>&nbsp;<span class="ident" id="6653098">i</span><span class="op" id="6653099">,</span>&nbsp;<span class="ident" id="6653101">level</span><span class="op" id="6653106">,</span>&nbsp;<span class="builtinfunc" id="6653108">len</span><span class="op" id="6653111">(</span><span class="ident" id="6653112">input</span><span class="op" id="6653117">)</span><span class="op" id="6653118">,</span>&nbsp;<span class="ident" id="6653120">name</span><span class="op" id="6653124">,</span>&nbsp;<span class="ident" id="6653126">hi</span><span class="op" id="6653128">-</span><span class="ident" id="6653129">lo</span><span class="op" id="6653131">,</span>&nbsp;<span class="ident" id="6653133">m</span><span class="op" id="6653134">,</span>&nbsp;<span class="ident" id="6653136">err</span><span class="op" id="6653139">,</span>&nbsp;<span class="ident" id="6653141">buf</span><span class="op" id="6653144">.</span><span class="ident" id="6653145">buf</span><span class="op" id="6653148">.</span><span class="ident" id="6653149">Len</span><span class="op" id="6653152">(</span><span class="op" id="6653153">)</span><span class="op" id="6653154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6653159">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6653168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6653172">if</span>&nbsp;<span class="op" id="6653175">!</span><span class="ident" id="6653176">bytes</span><span class="op" id="6653181">.</span><span class="ident" id="6653182">Equal</span><span class="op" id="6653187">(</span><span class="ident" id="6653188">input</span><span class="op" id="6653193">[</span><span class="ident" id="6653194">lo</span><span class="op" id="6653196">:</span><span class="ident" id="6653197">hi</span><span class="op" id="6653199">]</span><span class="op" id="6653200">,</span>&nbsp;<span class="ident" id="6653202">out</span><span class="op" id="6653205">[</span><span class="op" id="6653206">:</span><span class="ident" id="6653207">hi</span><span class="op" id="6653209">-</span><span class="ident" id="6653210">lo</span><span class="op" id="6653212">]</span><span class="op" id="6653213">)</span>&nbsp;<span class="op" id="6653215">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6653220">t</span><span class="op" id="6653221">.</span><span class="ident" id="6653222">Errorf</span><span class="op" id="6653228">(</span><span class="string" id="6653229">&#34;testSync/%d:&nbsp;read&nbsp;wrong&nbsp;bytes:&nbsp;%x&nbsp;vs&nbsp;%x&#34;</span><span class="op" id="6653270">,</span>&nbsp;<span class="ident" id="6653272">i</span><span class="op" id="6653273">,</span>&nbsp;<span class="ident" id="6653275">input</span><span class="op" id="6653280">[</span><span class="ident" id="6653281">lo</span><span class="op" id="6653283">:</span><span class="ident" id="6653284">hi</span><span class="op" id="6653286">]</span><span class="op" id="6653287">,</span>&nbsp;<span class="ident" id="6653289">out</span><span class="op" id="6653292">[</span><span class="op" id="6653293">:</span><span class="ident" id="6653294">hi</span><span class="op" id="6653296">-</span><span class="ident" id="6653297">lo</span><span class="op" id="6653299">]</span><span class="op" id="6653300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6653305">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6653314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6653318">//&nbsp;This&nbsp;test&nbsp;originally&nbsp;checked&nbsp;that&nbsp;after&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6653371">//&nbsp;the&nbsp;first&nbsp;half&nbsp;of&nbsp;the&nbsp;input,&nbsp;there&nbsp;was&nbsp;nothing&nbsp;left</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6653428">//&nbsp;in&nbsp;the&nbsp;read&nbsp;buffer&nbsp;(buf.buf.Len()&nbsp;!=&nbsp;0)&nbsp;but&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6653485">//&nbsp;not&nbsp;necessarily&nbsp;the&nbsp;case:&nbsp;the&nbsp;write&nbsp;Flush&nbsp;may&nbsp;emit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6653541">//&nbsp;some&nbsp;extra&nbsp;framing&nbsp;bits&nbsp;that&nbsp;are&nbsp;not&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6653593">//&nbsp;to&nbsp;process&nbsp;to&nbsp;obtain&nbsp;the&nbsp;first&nbsp;half&nbsp;of&nbsp;the&nbsp;uncompressed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6653654">//&nbsp;data.&nbsp;&nbsp;The&nbsp;test&nbsp;ran&nbsp;correctly&nbsp;most&nbsp;of&nbsp;the&nbsp;time,&nbsp;because</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6653715">//&nbsp;the&nbsp;background&nbsp;goroutine&nbsp;had&nbsp;usually&nbsp;read&nbsp;even</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6653767">//&nbsp;those&nbsp;extra&nbsp;bits&nbsp;by&nbsp;now,&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;useful&nbsp;thing&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6653828">//&nbsp;check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6653840">buf</span><span class="op" id="6653843">.</span><span class="ident" id="6653844">WriteMode</span><span class="op" id="6653853">(</span><span class="op" id="6653854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6653857">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6653860">buf</span><span class="op" id="6653863">.</span><span class="ident" id="6653864">ReadMode</span><span class="op" id="6653872">(</span><span class="op" id="6653873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6653876">out</span>&nbsp;<span class="op" id="6653880">:=</span>&nbsp;<span class="builtinfunc" id="6653883">make</span><span class="op" id="6653887">(</span><span class="op" id="6653888">[</span><span class="op" id="6653889">]</span><span class="builtintype" id="6653890">byte</span><span class="op" id="6653894">,</span>&nbsp;<span class="num" id="6653896">10</span><span class="op" id="6653898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6653901">if</span>&nbsp;<span class="ident" id="6653904">n</span><span class="op" id="6653905">,</span>&nbsp;<span class="ident" id="6653907">err</span>&nbsp;<span class="op" id="6653911">:=</span>&nbsp;<span class="ident" id="6653914">r</span><span class="op" id="6653915">.</span><span class="ident" id="6653916">Read</span><span class="op" id="6653920">(</span><span class="ident" id="6653921">out</span><span class="op" id="6653924">)</span><span class="op" id="6653925">;</span>&nbsp;<span class="ident" id="6653927">n</span>&nbsp;<span class="op" id="6653929">&gt;</span>&nbsp;<span class="num" id="6653931">0</span>&nbsp;<span class="op" id="6653933">||</span>&nbsp;<span class="ident" id="6653936">err</span>&nbsp;<span class="op" id="6653940">!=</span>&nbsp;<span class="ident" id="6653943">io</span><span class="op" id="6653945">.</span><span class="ident" id="6653946">EOF</span>&nbsp;<span class="op" id="6653950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6653954">t</span><span class="op" id="6653955">.</span><span class="ident" id="6653956">Errorf</span><span class="op" id="6653962">(</span><span class="string" id="6653963">&#34;testSync&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;final&nbsp;Read:&nbsp;%d,&nbsp;%v&nbsp;(hex:&nbsp;%x)&#34;</span><span class="op" id="6654016">,</span>&nbsp;<span class="ident" id="6654018">level</span><span class="op" id="6654023">,</span>&nbsp;<span class="builtinfunc" id="6654025">len</span><span class="op" id="6654028">(</span><span class="ident" id="6654029">input</span><span class="op" id="6654034">)</span><span class="op" id="6654035">,</span>&nbsp;<span class="ident" id="6654037">name</span><span class="op" id="6654041">,</span>&nbsp;<span class="ident" id="6654043">n</span><span class="op" id="6654044">,</span>&nbsp;<span class="ident" id="6654046">err</span><span class="op" id="6654049">,</span>&nbsp;<span class="ident" id="6654051">out</span><span class="op" id="6654054">[</span><span class="num" id="6654055">0</span><span class="op" id="6654056">:</span><span class="ident" id="6654057">n</span><span class="op" id="6654058">]</span><span class="op" id="6654059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6654062">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6654065">if</span>&nbsp;<span class="ident" id="6654068">buf</span><span class="op" id="6654071">.</span><span class="ident" id="6654072">buf</span><span class="op" id="6654075">.</span><span class="ident" id="6654076">Len</span><span class="op" id="6654079">(</span><span class="op" id="6654080">)</span>&nbsp;<span class="op" id="6654082">!=</span>&nbsp;<span class="num" id="6654085">0</span>&nbsp;<span class="op" id="6654087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654091">t</span><span class="op" id="6654092">.</span><span class="ident" id="6654093">Errorf</span><span class="op" id="6654099">(</span><span class="string" id="6654100">&#34;testSync&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;extra&nbsp;data&nbsp;at&nbsp;end&#34;</span><span class="op" id="6654142">,</span>&nbsp;<span class="ident" id="6654144">level</span><span class="op" id="6654149">,</span>&nbsp;<span class="builtinfunc" id="6654151">len</span><span class="op" id="6654154">(</span><span class="ident" id="6654155">input</span><span class="op" id="6654160">)</span><span class="op" id="6654161">,</span>&nbsp;<span class="ident" id="6654163">name</span><span class="op" id="6654167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6654170">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654173">r</span><span class="op" id="6654174">.</span><span class="ident" id="6654175">Close</span><span class="op" id="6654180">(</span><span class="op" id="6654181">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6654185">//&nbsp;stream&nbsp;should&nbsp;work&nbsp;for&nbsp;ordinary&nbsp;reader&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654232">r</span>&nbsp;<span class="op" id="6654234">=</span>&nbsp;<span class="ident" id="6654236">NewReader</span><span class="op" id="6654245">(</span><span class="ident" id="6654246">buf1</span><span class="op" id="6654250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654253">out</span><span class="op" id="6654256">,</span>&nbsp;<span class="ident" id="6654258">err</span>&nbsp;<span class="op" id="6654262">=</span>&nbsp;<span class="ident" id="6654264">ioutil</span><span class="op" id="6654270">.</span><span class="ident" id="6654271">ReadAll</span><span class="op" id="6654278">(</span><span class="ident" id="6654279">r</span><span class="op" id="6654280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6654283">if</span>&nbsp;<span class="ident" id="6654286">err</span>&nbsp;<span class="op" id="6654290">!=</span>&nbsp;<span class="ident" id="6654293">nil</span>&nbsp;<span class="op" id="6654297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654301">t</span><span class="op" id="6654302">.</span><span class="ident" id="6654303">Errorf</span><span class="op" id="6654309">(</span><span class="string" id="6654310">&#34;testSync:&nbsp;read:&nbsp;%s&#34;</span><span class="op" id="6654330">,</span>&nbsp;<span class="ident" id="6654332">err</span><span class="op" id="6654335">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6654339">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6654347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654350">r</span><span class="op" id="6654351">.</span><span class="ident" id="6654352">Close</span><span class="op" id="6654357">(</span><span class="op" id="6654358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6654361">if</span>&nbsp;<span class="op" id="6654364">!</span><span class="ident" id="6654365">bytes</span><span class="op" id="6654370">.</span><span class="ident" id="6654371">Equal</span><span class="op" id="6654376">(</span><span class="ident" id="6654377">input</span><span class="op" id="6654382">,</span>&nbsp;<span class="ident" id="6654384">out</span><span class="op" id="6654387">)</span>&nbsp;<span class="op" id="6654389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654393">t</span><span class="op" id="6654394">.</span><span class="ident" id="6654395">Errorf</span><span class="op" id="6654401">(</span><span class="string" id="6654402">&#34;testSync:&nbsp;decompress(compress(data))&nbsp;!=&nbsp;data:&nbsp;level=%d&nbsp;input=%s&#34;</span><span class="op" id="6654467">,</span>&nbsp;<span class="ident" id="6654469">level</span><span class="op" id="6654474">,</span>&nbsp;<span class="ident" id="6654476">name</span><span class="op" id="6654480">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6654483">}</span><br>
<span class="lineno"></span><span class="op" id="6654485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6654488">func</span>&nbsp;<span class="ident" id="6654493">testToFromWithLevelAndLimit</span><span class="op" id="6654520">(</span><span class="ident" id="6654521">t</span>&nbsp;<span class="op" id="6654523">*</span><span class="ident" id="6654524">testing</span><span class="op" id="6654531">.</span><span class="ident" id="6654532">T</span><span class="op" id="6654533">,</span>&nbsp;<span class="ident" id="6654535">level</span>&nbsp;<span class="builtintype" id="6654541">int</span><span class="op" id="6654544">,</span>&nbsp;<span class="ident" id="6654546">input</span>&nbsp;<span class="op" id="6654552">[</span><span class="op" id="6654553">]</span><span class="builtintype" id="6654554">byte</span><span class="op" id="6654558">,</span>&nbsp;<span class="ident" id="6654560">name</span>&nbsp;<span class="builtintype" id="6654565">string</span><span class="op" id="6654571">,</span>&nbsp;<span class="ident" id="6654573">limit</span>&nbsp;<span class="builtintype" id="6654579">int</span><span class="op" id="6654582">)</span>&nbsp;<span class="op" id="6654584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6654587">var</span>&nbsp;<span class="ident" id="6654591">buffer</span>&nbsp;<span class="ident" id="6654598">bytes</span><span class="op" id="6654603">.</span><span class="ident" id="6654604">Buffer</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654612">w</span><span class="op" id="6654613">,</span>&nbsp;<span class="ident" id="6654615">err</span>&nbsp;<span class="op" id="6654619">:=</span>&nbsp;<span class="ident" id="6654622">NewWriter</span><span class="op" id="6654631">(</span><span class="op" id="6654632">&amp;</span><span class="ident" id="6654633">buffer</span><span class="op" id="6654639">,</span>&nbsp;<span class="ident" id="6654641">level</span><span class="op" id="6654646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6654649">if</span>&nbsp;<span class="ident" id="6654652">err</span>&nbsp;<span class="op" id="6654656">!=</span>&nbsp;<span class="ident" id="6654659">nil</span>&nbsp;<span class="op" id="6654663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654667">t</span><span class="op" id="6654668">.</span><span class="ident" id="6654669">Errorf</span><span class="op" id="6654675">(</span><span class="string" id="6654676">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6654691">,</span>&nbsp;<span class="ident" id="6654693">err</span><span class="op" id="6654696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6654700">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6654708">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654711">w</span><span class="op" id="6654712">.</span><span class="ident" id="6654713">Write</span><span class="op" id="6654718">(</span><span class="ident" id="6654719">input</span><span class="op" id="6654724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654727">w</span><span class="op" id="6654728">.</span><span class="ident" id="6654729">Close</span><span class="op" id="6654734">(</span><span class="op" id="6654735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6654738">if</span>&nbsp;<span class="ident" id="6654741">limit</span>&nbsp;<span class="op" id="6654747">&gt;</span>&nbsp;<span class="num" id="6654749">0</span>&nbsp;<span class="op" id="6654751">&amp;&amp;</span>&nbsp;<span class="ident" id="6654754">buffer</span><span class="op" id="6654760">.</span><span class="ident" id="6654761">Len</span><span class="op" id="6654764">(</span><span class="op" id="6654765">)</span>&nbsp;<span class="op" id="6654767">&gt;</span>&nbsp;<span class="ident" id="6654769">limit</span>&nbsp;<span class="op" id="6654775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654779">t</span><span class="op" id="6654780">.</span><span class="ident" id="6654781">Errorf</span><span class="op" id="6654787">(</span><span class="string" id="6654788">&#34;level:&nbsp;%d,&nbsp;len(compress(data))&nbsp;=&nbsp;%d&nbsp;&gt;&nbsp;limit&nbsp;=&nbsp;%d&#34;</span><span class="op" id="6654838">,</span>&nbsp;<span class="ident" id="6654840">level</span><span class="op" id="6654845">,</span>&nbsp;<span class="ident" id="6654847">buffer</span><span class="op" id="6654853">.</span><span class="ident" id="6654854">Len</span><span class="op" id="6654857">(</span><span class="op" id="6654858">)</span><span class="op" id="6654859">,</span>&nbsp;<span class="ident" id="6654861">limit</span><span class="op" id="6654866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6654870">return</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6654878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654881">r</span>&nbsp;<span class="op" id="6654883">:=</span>&nbsp;<span class="ident" id="6654886">NewReader</span><span class="op" id="6654895">(</span><span class="op" id="6654896">&amp;</span><span class="ident" id="6654897">buffer</span><span class="op" id="6654903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654906">out</span><span class="op" id="6654909">,</span>&nbsp;<span class="ident" id="6654911">err</span>&nbsp;<span class="op" id="6654915">:=</span>&nbsp;<span class="ident" id="6654918">ioutil</span><span class="op" id="6654924">.</span><span class="ident" id="6654925">ReadAll</span><span class="op" id="6654932">(</span><span class="ident" id="6654933">r</span><span class="op" id="6654934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6654937">if</span>&nbsp;<span class="ident" id="6654940">err</span>&nbsp;<span class="op" id="6654944">!=</span>&nbsp;<span class="ident" id="6654947">nil</span>&nbsp;<span class="op" id="6654951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654955">t</span><span class="op" id="6654956">.</span><span class="ident" id="6654957">Errorf</span><span class="op" id="6654963">(</span><span class="string" id="6654964">&#34;read:&nbsp;%s&#34;</span><span class="op" id="6654974">,</span>&nbsp;<span class="ident" id="6654976">err</span><span class="op" id="6654979">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6654983">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6654991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654994">r</span><span class="op" id="6654995">.</span><span class="ident" id="6654996">Close</span><span class="op" id="6655001">(</span><span class="op" id="6655002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655005">if</span>&nbsp;<span class="op" id="6655008">!</span><span class="ident" id="6655009">bytes</span><span class="op" id="6655014">.</span><span class="ident" id="6655015">Equal</span><span class="op" id="6655020">(</span><span class="ident" id="6655021">input</span><span class="op" id="6655026">,</span>&nbsp;<span class="ident" id="6655028">out</span><span class="op" id="6655031">)</span>&nbsp;<span class="op" id="6655033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655037">t</span><span class="op" id="6655038">.</span><span class="ident" id="6655039">Errorf</span><span class="op" id="6655045">(</span><span class="string" id="6655046">&#34;decompress(compress(data))&nbsp;!=&nbsp;data:&nbsp;level=%d&nbsp;input=%s&#34;</span><span class="op" id="6655101">,</span>&nbsp;<span class="ident" id="6655103">level</span><span class="op" id="6655108">,</span>&nbsp;<span class="ident" id="6655110">name</span><span class="op" id="6655114">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655118">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655129">testSync</span><span class="op" id="6655137">(</span><span class="ident" id="6655138">t</span><span class="op" id="6655139">,</span>&nbsp;<span class="ident" id="6655141">level</span><span class="op" id="6655146">,</span>&nbsp;<span class="ident" id="6655148">input</span><span class="op" id="6655153">,</span>&nbsp;<span class="ident" id="6655155">name</span><span class="op" id="6655159">)</span><br>
<span class="lineno"></span><span class="op" id="6655161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="6655164">func</span>&nbsp;<span class="ident" id="6655169">testToFromWithLimit</span><span class="op" id="6655188">(</span><span class="ident" id="6655189">t</span>&nbsp;<span class="op" id="6655191">*</span><span class="ident" id="6655192">testing</span><span class="op" id="6655199">.</span><span class="ident" id="6655200">T</span><span class="op" id="6655201">,</span>&nbsp;<span class="ident" id="6655203">input</span>&nbsp;<span class="op" id="6655209">[</span><span class="op" id="6655210">]</span><span class="builtintype" id="6655211">byte</span><span class="op" id="6655215">,</span>&nbsp;<span class="ident" id="6655217">name</span>&nbsp;<span class="builtintype" id="6655222">string</span><span class="op" id="6655228">,</span>&nbsp;<span class="ident" id="6655230">limit</span>&nbsp;<span class="op" id="6655236">[</span><span class="num" id="6655237">10</span><span class="op" id="6655239">]</span><span class="builtintype" id="6655240">int</span><span class="op" id="6655243">)</span>&nbsp;<span class="op" id="6655245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655248">for</span>&nbsp;<span class="ident" id="6655252">i</span>&nbsp;<span class="op" id="6655254">:=</span>&nbsp;<span class="num" id="6655257">0</span><span class="op" id="6655258">;</span>&nbsp;<span class="ident" id="6655260">i</span>&nbsp;<span class="op" id="6655262">&lt;</span>&nbsp;<span class="num" id="6655264">10</span><span class="op" id="6655266">;</span>&nbsp;<span class="ident" id="6655268">i</span><span class="op" id="6655269">++</span>&nbsp;<span class="op" id="6655272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655276">testToFromWithLevelAndLimit</span><span class="op" id="6655303">(</span><span class="ident" id="6655304">t</span><span class="op" id="6655305">,</span>&nbsp;<span class="ident" id="6655307">i</span><span class="op" id="6655308">,</span>&nbsp;<span class="ident" id="6655310">input</span><span class="op" id="6655315">,</span>&nbsp;<span class="ident" id="6655317">name</span><span class="op" id="6655321">,</span>&nbsp;<span class="ident" id="6655323">limit</span><span class="op" id="6655328">[</span><span class="ident" id="6655329">i</span><span class="op" id="6655330">]</span><span class="op" id="6655331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655334">}</span><br>
<span class="lineno"></span><span class="op" id="6655336">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="keyword" id="6655339">func</span>&nbsp;<span class="ident" id="6655344">TestDeflateInflate</span><span class="op" id="6655362">(</span><span class="ident" id="6655363">t</span>&nbsp;<span class="op" id="6655365">*</span><span class="ident" id="6655366">testing</span><span class="op" id="6655373">.</span><span class="ident" id="6655374">T</span><span class="op" id="6655375">)</span>&nbsp;<span class="op" id="6655377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655380">for</span>&nbsp;<span class="ident" id="6655384">i</span><span class="op" id="6655385">,</span>&nbsp;<span class="ident" id="6655387">h</span>&nbsp;<span class="op" id="6655389">:=</span>&nbsp;<span class="keyword" id="6655392">range</span>&nbsp;<span class="ident" id="6655398">deflateInflateTests</span>&nbsp;<span class="op" id="6655418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655422">testToFromWithLimit</span><span class="op" id="6655441">(</span><span class="ident" id="6655442">t</span><span class="op" id="6655443">,</span>&nbsp;<span class="ident" id="6655445">h</span><span class="op" id="6655446">.</span><span class="ident" id="6655447">in</span><span class="op" id="6655449">,</span>&nbsp;<span class="ident" id="6655451">fmt</span><span class="op" id="6655454">.</span><span class="ident" id="6655455">Sprintf</span><span class="op" id="6655462">(</span><span class="string" id="6655463">&#34;#%d&#34;</span><span class="op" id="6655468">,</span>&nbsp;<span class="ident" id="6655470">i</span><span class="op" id="6655471">)</span><span class="op" id="6655472">,</span>&nbsp;<span class="op" id="6655474">[</span><span class="num" id="6655475">10</span><span class="op" id="6655477">]</span><span class="builtintype" id="6655478">int</span><span class="op" id="6655481">{</span><span class="op" id="6655482">}</span><span class="op" id="6655483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655486">}</span><br>
<span class="lineno">315</span><span class="op" id="6655488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6655491">func</span>&nbsp;<span class="ident" id="6655496">TestReverseBits</span><span class="op" id="6655511">(</span><span class="ident" id="6655512">t</span>&nbsp;<span class="op" id="6655514">*</span><span class="ident" id="6655515">testing</span><span class="op" id="6655522">.</span><span class="ident" id="6655523">T</span><span class="op" id="6655524">)</span>&nbsp;<span class="op" id="6655526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655529">for</span>&nbsp;<span class="ident" id="6655533">_</span><span class="op" id="6655534">,</span>&nbsp;<span class="ident" id="6655536">h</span>&nbsp;<span class="op" id="6655538">:=</span>&nbsp;<span class="keyword" id="6655541">range</span>&nbsp;<span class="ident" id="6655547">reverseBitsTests</span>&nbsp;<span class="op" id="6655564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655568">if</span>&nbsp;<span class="ident" id="6655571">v</span>&nbsp;<span class="op" id="6655573">:=</span>&nbsp;<span class="ident" id="6655576">reverseBits</span><span class="op" id="6655587">(</span><span class="ident" id="6655588">h</span><span class="op" id="6655589">.</span><span class="ident" id="6655590">in</span><span class="op" id="6655592">,</span>&nbsp;<span class="ident" id="6655594">h</span><span class="op" id="6655595">.</span><span class="ident" id="6655596">bitCount</span><span class="op" id="6655604">)</span><span class="op" id="6655605">;</span>&nbsp;<span class="ident" id="6655607">v</span>&nbsp;<span class="op" id="6655609">!=</span>&nbsp;<span class="ident" id="6655612">h</span><span class="op" id="6655613">.</span><span class="ident" id="6655614">out</span>&nbsp;<span class="op" id="6655618">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655623">t</span><span class="op" id="6655624">.</span><span class="ident" id="6655625">Errorf</span><span class="op" id="6655631">(</span><span class="string" id="6655632">&#34;reverseBits(%v,%v)&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6655666">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655672">h</span><span class="op" id="6655673">.</span><span class="ident" id="6655674">in</span><span class="op" id="6655676">,</span>&nbsp;<span class="ident" id="6655678">h</span><span class="op" id="6655679">.</span><span class="ident" id="6655680">bitCount</span><span class="op" id="6655688">,</span>&nbsp;<span class="ident" id="6655690">v</span><span class="op" id="6655691">,</span>&nbsp;<span class="ident" id="6655693">h</span><span class="op" id="6655694">.</span><span class="ident" id="6655695">out</span><span class="op" id="6655698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655705">}</span><br>
<span class="lineno"></span><span class="op" id="6655707">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="6655710">type</span>&nbsp;<span class="ident" id="6655715">deflateInflateStringTest</span>&nbsp;<span class="keyword" id="6655740">struct</span>&nbsp;<span class="op" id="6655747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655750">filename</span>&nbsp;<span class="builtintype" id="6655759">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655767">label</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6655776">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655784">limit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655793">[</span><span class="num" id="6655794">10</span><span class="op" id="6655796">]</span><span class="builtintype" id="6655797">int</span><br>
<span class="lineno">330</span><span class="op" id="6655801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6655804">var</span>&nbsp;<span class="ident" id="6655808">deflateInflateStringTests</span>&nbsp;<span class="op" id="6655834">=</span>&nbsp;<span class="op" id="6655836">[</span><span class="op" id="6655837">]</span><span class="ident" id="6655838">deflateInflateStringTest</span><span class="op" id="6655862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6655869">&#34;../testdata/e.txt&#34;</span><span class="op" id="6655888">,</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6655892">&#34;2.718281828...&#34;</span><span class="op" id="6655908">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655912">[</span><span class="op" id="6655913">...</span><span class="op" id="6655916">]</span><span class="builtintype" id="6655917">int</span><span class="op" id="6655920">{</span><span class="num" id="6655921">100018</span><span class="op" id="6655927">,</span>&nbsp;<span class="num" id="6655929">50650</span><span class="op" id="6655934">,</span>&nbsp;<span class="num" id="6655936">50960</span><span class="op" id="6655941">,</span>&nbsp;<span class="num" id="6655943">51150</span><span class="op" id="6655948">,</span>&nbsp;<span class="num" id="6655950">50930</span><span class="op" id="6655955">,</span>&nbsp;<span class="num" id="6655957">50790</span><span class="op" id="6655962">,</span>&nbsp;<span class="num" id="6655964">50790</span><span class="op" id="6655969">,</span>&nbsp;<span class="num" id="6655971">50790</span><span class="op" id="6655976">,</span>&nbsp;<span class="num" id="6655978">50790</span><span class="op" id="6655983">,</span>&nbsp;<span class="num" id="6655985">50790</span><span class="op" id="6655990">}</span><span class="op" id="6655991">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655994">}</span><span class="op" id="6655995">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6656002">&#34;../testdata/Mark.Twain-Tom.Sawyer.txt&#34;</span><span class="op" id="6656041">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6656045">&#34;Mark.Twain-Tom.Sawyer&#34;</span><span class="op" id="6656068">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656072">[</span><span class="op" id="6656073">...</span><span class="op" id="6656076">]</span><span class="builtintype" id="6656077">int</span><span class="op" id="6656080">{</span><span class="num" id="6656081">407330</span><span class="op" id="6656087">,</span>&nbsp;<span class="num" id="6656089">187598</span><span class="op" id="6656095">,</span>&nbsp;<span class="num" id="6656097">180361</span><span class="op" id="6656103">,</span>&nbsp;<span class="num" id="6656105">172974</span><span class="op" id="6656111">,</span>&nbsp;<span class="num" id="6656113">169160</span><span class="op" id="6656119">,</span>&nbsp;<span class="num" id="6656121">163476</span><span class="op" id="6656127">,</span>&nbsp;<span class="num" id="6656129">160936</span><span class="op" id="6656135">,</span>&nbsp;<span class="num" id="6656137">160506</span><span class="op" id="6656143">,</span>&nbsp;<span class="num" id="6656145">160295</span><span class="op" id="6656151">,</span>&nbsp;<span class="num" id="6656153">160295</span><span class="op" id="6656159">}</span><span class="op" id="6656160">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656163">}</span><span class="op" id="6656164">,</span><br>
<span class="lineno"></span><span class="op" id="6656166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="keyword" id="6656169">func</span>&nbsp;<span class="ident" id="6656174">TestDeflateInflateString</span><span class="op" id="6656198">(</span><span class="ident" id="6656199">t</span>&nbsp;<span class="op" id="6656201">*</span><span class="ident" id="6656202">testing</span><span class="op" id="6656209">.</span><span class="ident" id="6656210">T</span><span class="op" id="6656211">)</span>&nbsp;<span class="op" id="6656213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656216">for</span>&nbsp;<span class="ident" id="6656220">_</span><span class="op" id="6656221">,</span>&nbsp;<span class="ident" id="6656223">test</span>&nbsp;<span class="op" id="6656228">:=</span>&nbsp;<span class="keyword" id="6656231">range</span>&nbsp;<span class="ident" id="6656237">deflateInflateStringTests</span>&nbsp;<span class="op" id="6656263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656267">gold</span><span class="op" id="6656271">,</span>&nbsp;<span class="ident" id="6656273">err</span>&nbsp;<span class="op" id="6656277">:=</span>&nbsp;<span class="ident" id="6656280">ioutil</span><span class="op" id="6656286">.</span><span class="ident" id="6656287">ReadFile</span><span class="op" id="6656295">(</span><span class="ident" id="6656296">test</span><span class="op" id="6656300">.</span><span class="ident" id="6656301">filename</span><span class="op" id="6656309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656313">if</span>&nbsp;<span class="ident" id="6656316">err</span>&nbsp;<span class="op" id="6656320">!=</span>&nbsp;<span class="ident" id="6656323">nil</span>&nbsp;<span class="op" id="6656327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656332">t</span><span class="op" id="6656333">.</span><span class="ident" id="6656334">Error</span><span class="op" id="6656339">(</span><span class="ident" id="6656340">err</span><span class="op" id="6656343">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656351">testToFromWithLimit</span><span class="op" id="6656370">(</span><span class="ident" id="6656371">t</span><span class="op" id="6656372">,</span>&nbsp;<span class="ident" id="6656374">gold</span><span class="op" id="6656378">,</span>&nbsp;<span class="ident" id="6656380">test</span><span class="op" id="6656384">.</span><span class="ident" id="6656385">label</span><span class="op" id="6656390">,</span>&nbsp;<span class="ident" id="6656392">test</span><span class="op" id="6656396">.</span><span class="ident" id="6656397">limit</span><span class="op" id="6656402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656406">if</span>&nbsp;<span class="ident" id="6656409">testing</span><span class="op" id="6656416">.</span><span class="ident" id="6656417">Short</span><span class="op" id="6656422">(</span><span class="op" id="6656423">)</span>&nbsp;<span class="op" id="6656425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656430">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656438">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656441">}</span><br>
<span class="lineno"></span><span class="op" id="6656443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6656446">func</span>&nbsp;<span class="ident" id="6656451">TestReaderDict</span><span class="op" id="6656465">(</span><span class="ident" id="6656466">t</span>&nbsp;<span class="op" id="6656468">*</span><span class="ident" id="6656469">testing</span><span class="op" id="6656476">.</span><span class="ident" id="6656477">T</span><span class="op" id="6656478">)</span>&nbsp;<span class="op" id="6656480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656483">const</span>&nbsp;<span class="op" id="6656489">(</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656493">dict</span>&nbsp;<span class="op" id="6656498">=</span>&nbsp;<span class="string" id="6656500">&#34;hello&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656516">text</span>&nbsp;<span class="op" id="6656521">=</span>&nbsp;<span class="string" id="6656523">&#34;hello&nbsp;again&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656547">var</span>&nbsp;<span class="ident" id="6656551">b</span>&nbsp;<span class="ident" id="6656553">bytes</span><span class="op" id="6656558">.</span><span class="ident" id="6656559">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656567">w</span><span class="op" id="6656568">,</span>&nbsp;<span class="ident" id="6656570">err</span>&nbsp;<span class="op" id="6656574">:=</span>&nbsp;<span class="ident" id="6656577">NewWriter</span><span class="op" id="6656586">(</span><span class="op" id="6656587">&amp;</span><span class="ident" id="6656588">b</span><span class="op" id="6656589">,</span>&nbsp;<span class="num" id="6656591">5</span><span class="op" id="6656592">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656595">if</span>&nbsp;<span class="ident" id="6656598">err</span>&nbsp;<span class="op" id="6656602">!=</span>&nbsp;<span class="ident" id="6656605">nil</span>&nbsp;<span class="op" id="6656609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656613">t</span><span class="op" id="6656614">.</span><span class="ident" id="6656615">Fatalf</span><span class="op" id="6656621">(</span><span class="string" id="6656622">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6656637">,</span>&nbsp;<span class="ident" id="6656639">err</span><span class="op" id="6656642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656648">w</span><span class="op" id="6656649">.</span><span class="ident" id="6656650">Write</span><span class="op" id="6656655">(</span><span class="op" id="6656656">[</span><span class="op" id="6656657">]</span><span class="builtintype" id="6656658">byte</span><span class="op" id="6656662">(</span><span class="ident" id="6656663">dict</span><span class="op" id="6656667">)</span><span class="op" id="6656668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656671">w</span><span class="op" id="6656672">.</span><span class="ident" id="6656673">Flush</span><span class="op" id="6656678">(</span><span class="op" id="6656679">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656682">b</span><span class="op" id="6656683">.</span><span class="ident" id="6656684">Reset</span><span class="op" id="6656689">(</span><span class="op" id="6656690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656693">w</span><span class="op" id="6656694">.</span><span class="ident" id="6656695">Write</span><span class="op" id="6656700">(</span><span class="op" id="6656701">[</span><span class="op" id="6656702">]</span><span class="builtintype" id="6656703">byte</span><span class="op" id="6656707">(</span><span class="ident" id="6656708">text</span><span class="op" id="6656712">)</span><span class="op" id="6656713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656716">w</span><span class="op" id="6656717">.</span><span class="ident" id="6656718">Close</span><span class="op" id="6656723">(</span><span class="op" id="6656724">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656728">r</span>&nbsp;<span class="op" id="6656730">:=</span>&nbsp;<span class="ident" id="6656733">NewReaderDict</span><span class="op" id="6656746">(</span><span class="op" id="6656747">&amp;</span><span class="ident" id="6656748">b</span><span class="op" id="6656749">,</span>&nbsp;<span class="op" id="6656751">[</span><span class="op" id="6656752">]</span><span class="builtintype" id="6656753">byte</span><span class="op" id="6656757">(</span><span class="ident" id="6656758">dict</span><span class="op" id="6656762">)</span><span class="op" id="6656763">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656766">data</span><span class="op" id="6656770">,</span>&nbsp;<span class="ident" id="6656772">err</span>&nbsp;<span class="op" id="6656776">:=</span>&nbsp;<span class="ident" id="6656779">ioutil</span><span class="op" id="6656785">.</span><span class="ident" id="6656786">ReadAll</span><span class="op" id="6656793">(</span><span class="ident" id="6656794">r</span><span class="op" id="6656795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656798">if</span>&nbsp;<span class="ident" id="6656801">err</span>&nbsp;<span class="op" id="6656805">!=</span>&nbsp;<span class="ident" id="6656808">nil</span>&nbsp;<span class="op" id="6656812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656816">t</span><span class="op" id="6656817">.</span><span class="ident" id="6656818">Fatal</span><span class="op" id="6656823">(</span><span class="ident" id="6656824">err</span><span class="op" id="6656827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656833">if</span>&nbsp;<span class="builtintype" id="6656836">string</span><span class="op" id="6656842">(</span><span class="ident" id="6656843">data</span><span class="op" id="6656847">)</span>&nbsp;<span class="op" id="6656849">!=</span>&nbsp;<span class="string" id="6656852">&#34;hello&nbsp;again&nbsp;world&#34;</span>&nbsp;<span class="op" id="6656872">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656876">t</span><span class="op" id="6656877">.</span><span class="ident" id="6656878">Fatalf</span><span class="op" id="6656884">(</span><span class="string" id="6656885">&#34;read&nbsp;returned&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6656911">,</span>&nbsp;<span class="builtintype" id="6656913">string</span><span class="op" id="6656919">(</span><span class="ident" id="6656920">data</span><span class="op" id="6656924">)</span><span class="op" id="6656925">,</span>&nbsp;<span class="ident" id="6656927">text</span><span class="op" id="6656931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656934">}</span><br>
<span class="lineno"></span><span class="op" id="6656936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6656939">func</span>&nbsp;<span class="ident" id="6656944">TestWriterDict</span><span class="op" id="6656958">(</span><span class="ident" id="6656959">t</span>&nbsp;<span class="op" id="6656961">*</span><span class="ident" id="6656962">testing</span><span class="op" id="6656969">.</span><span class="ident" id="6656970">T</span><span class="op" id="6656971">)</span>&nbsp;<span class="op" id="6656973">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656976">const</span>&nbsp;<span class="op" id="6656982">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656986">dict</span>&nbsp;<span class="op" id="6656991">=</span>&nbsp;<span class="string" id="6656993">&#34;hello&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657009">text</span>&nbsp;<span class="op" id="6657014">=</span>&nbsp;<span class="string" id="6657016">&#34;hello&nbsp;again&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6657037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657040">var</span>&nbsp;<span class="ident" id="6657044">b</span>&nbsp;<span class="ident" id="6657046">bytes</span><span class="op" id="6657051">.</span><span class="ident" id="6657052">Buffer</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657060">w</span><span class="op" id="6657061">,</span>&nbsp;<span class="ident" id="6657063">err</span>&nbsp;<span class="op" id="6657067">:=</span>&nbsp;<span class="ident" id="6657070">NewWriter</span><span class="op" id="6657079">(</span><span class="op" id="6657080">&amp;</span><span class="ident" id="6657081">b</span><span class="op" id="6657082">,</span>&nbsp;<span class="num" id="6657084">5</span><span class="op" id="6657085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657088">if</span>&nbsp;<span class="ident" id="6657091">err</span>&nbsp;<span class="op" id="6657095">!=</span>&nbsp;<span class="ident" id="6657098">nil</span>&nbsp;<span class="op" id="6657102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657106">t</span><span class="op" id="6657107">.</span><span class="ident" id="6657108">Fatalf</span><span class="op" id="6657114">(</span><span class="string" id="6657115">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6657130">,</span>&nbsp;<span class="ident" id="6657132">err</span><span class="op" id="6657135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6657138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657141">w</span><span class="op" id="6657142">.</span><span class="ident" id="6657143">Write</span><span class="op" id="6657148">(</span><span class="op" id="6657149">[</span><span class="op" id="6657150">]</span><span class="builtintype" id="6657151">byte</span><span class="op" id="6657155">(</span><span class="ident" id="6657156">dict</span><span class="op" id="6657160">)</span><span class="op" id="6657161">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657164">w</span><span class="op" id="6657165">.</span><span class="ident" id="6657166">Flush</span><span class="op" id="6657171">(</span><span class="op" id="6657172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657175">b</span><span class="op" id="6657176">.</span><span class="ident" id="6657177">Reset</span><span class="op" id="6657182">(</span><span class="op" id="6657183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657186">w</span><span class="op" id="6657187">.</span><span class="ident" id="6657188">Write</span><span class="op" id="6657193">(</span><span class="op" id="6657194">[</span><span class="op" id="6657195">]</span><span class="builtintype" id="6657196">byte</span><span class="op" id="6657200">(</span><span class="ident" id="6657201">text</span><span class="op" id="6657205">)</span><span class="op" id="6657206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657209">w</span><span class="op" id="6657210">.</span><span class="ident" id="6657211">Close</span><span class="op" id="6657216">(</span><span class="op" id="6657217">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657221">var</span>&nbsp;<span class="ident" id="6657225">b1</span>&nbsp;<span class="ident" id="6657228">bytes</span><span class="op" id="6657233">.</span><span class="ident" id="6657234">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657242">w</span><span class="op" id="6657243">,</span>&nbsp;<span class="ident" id="6657245">_</span>&nbsp;<span class="op" id="6657247">=</span>&nbsp;<span class="ident" id="6657249">NewWriterDict</span><span class="op" id="6657262">(</span><span class="op" id="6657263">&amp;</span><span class="ident" id="6657264">b1</span><span class="op" id="6657266">,</span>&nbsp;<span class="num" id="6657268">5</span><span class="op" id="6657269">,</span>&nbsp;<span class="op" id="6657271">[</span><span class="op" id="6657272">]</span><span class="builtintype" id="6657273">byte</span><span class="op" id="6657277">(</span><span class="ident" id="6657278">dict</span><span class="op" id="6657282">)</span><span class="op" id="6657283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657286">w</span><span class="op" id="6657287">.</span><span class="ident" id="6657288">Write</span><span class="op" id="6657293">(</span><span class="op" id="6657294">[</span><span class="op" id="6657295">]</span><span class="builtintype" id="6657296">byte</span><span class="op" id="6657300">(</span><span class="ident" id="6657301">text</span><span class="op" id="6657305">)</span><span class="op" id="6657306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657309">w</span><span class="op" id="6657310">.</span><span class="ident" id="6657311">Close</span><span class="op" id="6657316">(</span><span class="op" id="6657317">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657321">if</span>&nbsp;<span class="op" id="6657324">!</span><span class="ident" id="6657325">bytes</span><span class="op" id="6657330">.</span><span class="ident" id="6657331">Equal</span><span class="op" id="6657336">(</span><span class="ident" id="6657337">b1</span><span class="op" id="6657339">.</span><span class="ident" id="6657340">Bytes</span><span class="op" id="6657345">(</span><span class="op" id="6657346">)</span><span class="op" id="6657347">,</span>&nbsp;<span class="ident" id="6657349">b</span><span class="op" id="6657350">.</span><span class="ident" id="6657351">Bytes</span><span class="op" id="6657356">(</span><span class="op" id="6657357">)</span><span class="op" id="6657358">)</span>&nbsp;<span class="op" id="6657360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657364">t</span><span class="op" id="6657365">.</span><span class="ident" id="6657366">Fatalf</span><span class="op" id="6657372">(</span><span class="string" id="6657373">&#34;writer&nbsp;wrote&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6657398">,</span>&nbsp;<span class="ident" id="6657400">b1</span><span class="op" id="6657402">.</span><span class="ident" id="6657403">Bytes</span><span class="op" id="6657408">(</span><span class="op" id="6657409">)</span><span class="op" id="6657410">,</span>&nbsp;<span class="ident" id="6657412">b</span><span class="op" id="6657413">.</span><span class="ident" id="6657414">Bytes</span><span class="op" id="6657419">(</span><span class="op" id="6657420">)</span><span class="op" id="6657421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6657424">}</span><br>
<span class="lineno"></span><span class="op" id="6657426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span><span class="comment" id="6657429">//&nbsp;See&nbsp;http://code.google.com/p/go/issues/detail?id=2508</span><br>
<span class="lineno"></span><span class="keyword" id="6657486">func</span>&nbsp;<span class="ident" id="6657491">TestRegression2508</span><span class="op" id="6657509">(</span><span class="ident" id="6657510">t</span>&nbsp;<span class="op" id="6657512">*</span><span class="ident" id="6657513">testing</span><span class="op" id="6657520">.</span><span class="ident" id="6657521">T</span><span class="op" id="6657522">)</span>&nbsp;<span class="op" id="6657524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657527">if</span>&nbsp;<span class="ident" id="6657530">testing</span><span class="op" id="6657537">.</span><span class="ident" id="6657538">Short</span><span class="op" id="6657543">(</span><span class="op" id="6657544">)</span>&nbsp;<span class="op" id="6657546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657550">t</span><span class="op" id="6657551">.</span><span class="ident" id="6657552">Logf</span><span class="op" id="6657556">(</span><span class="string" id="6657557">&#34;test&nbsp;disabled&nbsp;with&nbsp;-short&#34;</span><span class="op" id="6657584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657588">return</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6657596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657599">w</span><span class="op" id="6657600">,</span>&nbsp;<span class="ident" id="6657602">err</span>&nbsp;<span class="op" id="6657606">:=</span>&nbsp;<span class="ident" id="6657609">NewWriter</span><span class="op" id="6657618">(</span><span class="ident" id="6657619">ioutil</span><span class="op" id="6657625">.</span><span class="ident" id="6657626">Discard</span><span class="op" id="6657633">,</span>&nbsp;<span class="num" id="6657635">1</span><span class="op" id="6657636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657639">if</span>&nbsp;<span class="ident" id="6657642">err</span>&nbsp;<span class="op" id="6657646">!=</span>&nbsp;<span class="ident" id="6657649">nil</span>&nbsp;<span class="op" id="6657653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657657">t</span><span class="op" id="6657658">.</span><span class="ident" id="6657659">Fatalf</span><span class="op" id="6657665">(</span><span class="string" id="6657666">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6657681">,</span>&nbsp;<span class="ident" id="6657683">err</span><span class="op" id="6657686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6657689">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657692">buf</span>&nbsp;<span class="op" id="6657696">:=</span>&nbsp;<span class="builtinfunc" id="6657699">make</span><span class="op" id="6657703">(</span><span class="op" id="6657704">[</span><span class="op" id="6657705">]</span><span class="builtintype" id="6657706">byte</span><span class="op" id="6657710">,</span>&nbsp;<span class="num" id="6657712">1024</span><span class="op" id="6657716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657719">for</span>&nbsp;<span class="ident" id="6657723">i</span>&nbsp;<span class="op" id="6657725">:=</span>&nbsp;<span class="num" id="6657728">0</span><span class="op" id="6657729">;</span>&nbsp;<span class="ident" id="6657731">i</span>&nbsp;<span class="op" id="6657733">&lt;</span>&nbsp;<span class="num" id="6657735">131072</span><span class="op" id="6657741">;</span>&nbsp;<span class="ident" id="6657743">i</span><span class="op" id="6657744">++</span>&nbsp;<span class="op" id="6657747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657751">if</span>&nbsp;<span class="ident" id="6657754">_</span><span class="op" id="6657755">,</span>&nbsp;<span class="ident" id="6657757">err</span>&nbsp;<span class="op" id="6657761">:=</span>&nbsp;<span class="ident" id="6657764">w</span><span class="op" id="6657765">.</span><span class="ident" id="6657766">Write</span><span class="op" id="6657771">(</span><span class="ident" id="6657772">buf</span><span class="op" id="6657775">)</span><span class="op" id="6657776">;</span>&nbsp;<span class="ident" id="6657778">err</span>&nbsp;<span class="op" id="6657782">!=</span>&nbsp;<span class="ident" id="6657785">nil</span>&nbsp;<span class="op" id="6657789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657794">t</span><span class="op" id="6657795">.</span><span class="ident" id="6657796">Fatalf</span><span class="op" id="6657802">(</span><span class="string" id="6657803">&#34;writer&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6657822">,</span>&nbsp;<span class="ident" id="6657824">err</span><span class="op" id="6657827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6657831">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6657834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657837">w</span><span class="op" id="6657838">.</span><span class="ident" id="6657839">Close</span><span class="op" id="6657844">(</span><span class="op" id="6657845">)</span><br>
<span class="lineno"></span><span class="op" id="6657847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6657850">func</span>&nbsp;<span class="ident" id="6657855">TestWriterReset</span><span class="op" id="6657870">(</span><span class="ident" id="6657871">t</span>&nbsp;<span class="op" id="6657873">*</span><span class="ident" id="6657874">testing</span><span class="op" id="6657881">.</span><span class="ident" id="6657882">T</span><span class="op" id="6657883">)</span>&nbsp;<span class="op" id="6657885">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657888">for</span>&nbsp;<span class="ident" id="6657892">level</span>&nbsp;<span class="op" id="6657898">:=</span>&nbsp;<span class="num" id="6657901">0</span><span class="op" id="6657902">;</span>&nbsp;<span class="ident" id="6657904">level</span>&nbsp;<span class="op" id="6657910">&lt;=</span>&nbsp;<span class="num" id="6657913">9</span><span class="op" id="6657914">;</span>&nbsp;<span class="ident" id="6657916">level</span><span class="op" id="6657921">++</span>&nbsp;<span class="op" id="6657924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657928">if</span>&nbsp;<span class="ident" id="6657931">testing</span><span class="op" id="6657938">.</span><span class="ident" id="6657939">Short</span><span class="op" id="6657944">(</span><span class="op" id="6657945">)</span>&nbsp;<span class="op" id="6657947">&amp;&amp;</span>&nbsp;<span class="ident" id="6657950">level</span>&nbsp;<span class="op" id="6657956">&gt;</span>&nbsp;<span class="num" id="6657958">1</span>&nbsp;<span class="op" id="6657960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657965">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6657973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657977">w</span><span class="op" id="6657978">,</span>&nbsp;<span class="ident" id="6657980">err</span>&nbsp;<span class="op" id="6657984">:=</span>&nbsp;<span class="ident" id="6657987">NewWriter</span><span class="op" id="6657996">(</span><span class="ident" id="6657997">ioutil</span><span class="op" id="6658003">.</span><span class="ident" id="6658004">Discard</span><span class="op" id="6658011">,</span>&nbsp;<span class="ident" id="6658013">level</span><span class="op" id="6658018">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6658022">if</span>&nbsp;<span class="ident" id="6658025">err</span>&nbsp;<span class="op" id="6658029">!=</span>&nbsp;<span class="ident" id="6658032">nil</span>&nbsp;<span class="op" id="6658036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658041">t</span><span class="op" id="6658042">.</span><span class="ident" id="6658043">Fatalf</span><span class="op" id="6658049">(</span><span class="string" id="6658050">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6658065">,</span>&nbsp;<span class="ident" id="6658067">err</span><span class="op" id="6658070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6658074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658078">buf</span>&nbsp;<span class="op" id="6658082">:=</span>&nbsp;<span class="op" id="6658085">[</span><span class="op" id="6658086">]</span><span class="builtintype" id="6658087">byte</span><span class="op" id="6658091">(</span><span class="string" id="6658092">&#34;hello&nbsp;world&#34;</span><span class="op" id="6658105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6658109">for</span>&nbsp;<span class="ident" id="6658113">i</span>&nbsp;<span class="op" id="6658115">:=</span>&nbsp;<span class="num" id="6658118">0</span><span class="op" id="6658119">;</span>&nbsp;<span class="ident" id="6658121">i</span>&nbsp;<span class="op" id="6658123">&lt;</span>&nbsp;<span class="num" id="6658125">1024</span><span class="op" id="6658129">;</span>&nbsp;<span class="ident" id="6658131">i</span><span class="op" id="6658132">++</span>&nbsp;<span class="op" id="6658135">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658140">w</span><span class="op" id="6658141">.</span><span class="ident" id="6658142">Write</span><span class="op" id="6658147">(</span><span class="ident" id="6658148">buf</span><span class="op" id="6658151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6658155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658159">w</span><span class="op" id="6658160">.</span><span class="ident" id="6658161">Reset</span><span class="op" id="6658166">(</span><span class="ident" id="6658167">ioutil</span><span class="op" id="6658173">.</span><span class="ident" id="6658174">Discard</span><span class="op" id="6658181">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658186">wref</span><span class="op" id="6658190">,</span>&nbsp;<span class="ident" id="6658192">err</span>&nbsp;<span class="op" id="6658196">:=</span>&nbsp;<span class="ident" id="6658199">NewWriter</span><span class="op" id="6658208">(</span><span class="ident" id="6658209">ioutil</span><span class="op" id="6658215">.</span><span class="ident" id="6658216">Discard</span><span class="op" id="6658223">,</span>&nbsp;<span class="ident" id="6658225">level</span><span class="op" id="6658230">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6658234">if</span>&nbsp;<span class="ident" id="6658237">err</span>&nbsp;<span class="op" id="6658241">!=</span>&nbsp;<span class="ident" id="6658244">nil</span>&nbsp;<span class="op" id="6658248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658253">t</span><span class="op" id="6658254">.</span><span class="ident" id="6658255">Fatalf</span><span class="op" id="6658261">(</span><span class="string" id="6658262">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6658277">,</span>&nbsp;<span class="ident" id="6658279">err</span><span class="op" id="6658282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6658286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6658291">//&nbsp;DeepEqual&nbsp;doesn&#39;t&nbsp;compare&nbsp;functions.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658333">w</span><span class="op" id="6658334">.</span><span class="ident" id="6658335">d</span><span class="op" id="6658336">.</span><span class="ident" id="6658337">fill</span><span class="op" id="6658341">,</span>&nbsp;<span class="ident" id="6658343">wref</span><span class="op" id="6658347">.</span><span class="ident" id="6658348">d</span><span class="op" id="6658349">.</span><span class="ident" id="6658350">fill</span>&nbsp;<span class="op" id="6658355">=</span>&nbsp;<span class="ident" id="6658357">nil</span><span class="op" id="6658360">,</span>&nbsp;<span class="ident" id="6658362">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658368">w</span><span class="op" id="6658369">.</span><span class="ident" id="6658370">d</span><span class="op" id="6658371">.</span><span class="ident" id="6658372">step</span><span class="op" id="6658376">,</span>&nbsp;<span class="ident" id="6658378">wref</span><span class="op" id="6658382">.</span><span class="ident" id="6658383">d</span><span class="op" id="6658384">.</span><span class="ident" id="6658385">step</span>&nbsp;<span class="op" id="6658390">=</span>&nbsp;<span class="ident" id="6658392">nil</span><span class="op" id="6658395">,</span>&nbsp;<span class="ident" id="6658397">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6658403">if</span>&nbsp;<span class="op" id="6658406">!</span><span class="ident" id="6658407">reflect</span><span class="op" id="6658414">.</span><span class="ident" id="6658415">DeepEqual</span><span class="op" id="6658424">(</span><span class="ident" id="6658425">w</span><span class="op" id="6658426">,</span>&nbsp;<span class="ident" id="6658428">wref</span><span class="op" id="6658432">)</span>&nbsp;<span class="op" id="6658434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658439">t</span><span class="op" id="6658440">.</span><span class="ident" id="6658441">Errorf</span><span class="op" id="6658447">(</span><span class="string" id="6658448">&#34;level&nbsp;%d&nbsp;Writer&nbsp;not&nbsp;reset&nbsp;after&nbsp;Reset&#34;</span><span class="op" id="6658487">,</span>&nbsp;<span class="ident" id="6658489">level</span><span class="op" id="6658494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6658498">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6658501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658504">testResetOutput</span><span class="op" id="6658519">(</span><span class="ident" id="6658520">t</span><span class="op" id="6658521">,</span>&nbsp;<span class="keyword" id="6658523">func</span><span class="op" id="6658527">(</span><span class="ident" id="6658528">w</span>&nbsp;<span class="ident" id="6658530">io</span><span class="op" id="6658532">.</span><span class="ident" id="6658533">Writer</span><span class="op" id="6658539">)</span>&nbsp;<span class="op" id="6658541">(</span><span class="op" id="6658542">*</span><span class="ident" id="6658543">Writer</span><span class="op" id="6658549">,</span>&nbsp;<span class="builtintype" id="6658551">error</span><span class="op" id="6658556">)</span>&nbsp;<span class="op" id="6658558">{</span>&nbsp;<span class="keyword" id="6658560">return</span>&nbsp;<span class="ident" id="6658567">NewWriter</span><span class="op" id="6658576">(</span><span class="ident" id="6658577">w</span><span class="op" id="6658578">,</span>&nbsp;<span class="ident" id="6658580">NoCompression</span><span class="op" id="6658593">)</span>&nbsp;<span class="op" id="6658595">}</span><span class="op" id="6658596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658599">testResetOutput</span><span class="op" id="6658614">(</span><span class="ident" id="6658615">t</span><span class="op" id="6658616">,</span>&nbsp;<span class="keyword" id="6658618">func</span><span class="op" id="6658622">(</span><span class="ident" id="6658623">w</span>&nbsp;<span class="ident" id="6658625">io</span><span class="op" id="6658627">.</span><span class="ident" id="6658628">Writer</span><span class="op" id="6658634">)</span>&nbsp;<span class="op" id="6658636">(</span><span class="op" id="6658637">*</span><span class="ident" id="6658638">Writer</span><span class="op" id="6658644">,</span>&nbsp;<span class="builtintype" id="6658646">error</span><span class="op" id="6658651">)</span>&nbsp;<span class="op" id="6658653">{</span>&nbsp;<span class="keyword" id="6658655">return</span>&nbsp;<span class="ident" id="6658662">NewWriter</span><span class="op" id="6658671">(</span><span class="ident" id="6658672">w</span><span class="op" id="6658673">,</span>&nbsp;<span class="ident" id="6658675">DefaultCompression</span><span class="op" id="6658693">)</span>&nbsp;<span class="op" id="6658695">}</span><span class="op" id="6658696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658699">testResetOutput</span><span class="op" id="6658714">(</span><span class="ident" id="6658715">t</span><span class="op" id="6658716">,</span>&nbsp;<span class="keyword" id="6658718">func</span><span class="op" id="6658722">(</span><span class="ident" id="6658723">w</span>&nbsp;<span class="ident" id="6658725">io</span><span class="op" id="6658727">.</span><span class="ident" id="6658728">Writer</span><span class="op" id="6658734">)</span>&nbsp;<span class="op" id="6658736">(</span><span class="op" id="6658737">*</span><span class="ident" id="6658738">Writer</span><span class="op" id="6658744">,</span>&nbsp;<span class="builtintype" id="6658746">error</span><span class="op" id="6658751">)</span>&nbsp;<span class="op" id="6658753">{</span>&nbsp;<span class="keyword" id="6658755">return</span>&nbsp;<span class="ident" id="6658762">NewWriter</span><span class="op" id="6658771">(</span><span class="ident" id="6658772">w</span><span class="op" id="6658773">,</span>&nbsp;<span class="ident" id="6658775">BestCompression</span><span class="op" id="6658790">)</span>&nbsp;<span class="op" id="6658792">}</span><span class="op" id="6658793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658796">dict</span>&nbsp;<span class="op" id="6658801">:=</span>&nbsp;<span class="op" id="6658804">[</span><span class="op" id="6658805">]</span><span class="builtintype" id="6658806">byte</span><span class="op" id="6658810">(</span><span class="string" id="6658811">&#34;we&nbsp;are&nbsp;the&nbsp;world&#34;</span><span class="op" id="6658829">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658832">testResetOutput</span><span class="op" id="6658847">(</span><span class="ident" id="6658848">t</span><span class="op" id="6658849">,</span>&nbsp;<span class="keyword" id="6658851">func</span><span class="op" id="6658855">(</span><span class="ident" id="6658856">w</span>&nbsp;<span class="ident" id="6658858">io</span><span class="op" id="6658860">.</span><span class="ident" id="6658861">Writer</span><span class="op" id="6658867">)</span>&nbsp;<span class="op" id="6658869">(</span><span class="op" id="6658870">*</span><span class="ident" id="6658871">Writer</span><span class="op" id="6658877">,</span>&nbsp;<span class="builtintype" id="6658879">error</span><span class="op" id="6658884">)</span>&nbsp;<span class="op" id="6658886">{</span>&nbsp;<span class="keyword" id="6658888">return</span>&nbsp;<span class="ident" id="6658895">NewWriterDict</span><span class="op" id="6658908">(</span><span class="ident" id="6658909">w</span><span class="op" id="6658910">,</span>&nbsp;<span class="ident" id="6658912">NoCompression</span><span class="op" id="6658925">,</span>&nbsp;<span class="ident" id="6658927">dict</span><span class="op" id="6658931">)</span>&nbsp;<span class="op" id="6658933">}</span><span class="op" id="6658934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658937">testResetOutput</span><span class="op" id="6658952">(</span><span class="ident" id="6658953">t</span><span class="op" id="6658954">,</span>&nbsp;<span class="keyword" id="6658956">func</span><span class="op" id="6658960">(</span><span class="ident" id="6658961">w</span>&nbsp;<span class="ident" id="6658963">io</span><span class="op" id="6658965">.</span><span class="ident" id="6658966">Writer</span><span class="op" id="6658972">)</span>&nbsp;<span class="op" id="6658974">(</span><span class="op" id="6658975">*</span><span class="ident" id="6658976">Writer</span><span class="op" id="6658982">,</span>&nbsp;<span class="builtintype" id="6658984">error</span><span class="op" id="6658989">)</span>&nbsp;<span class="op" id="6658991">{</span>&nbsp;<span class="keyword" id="6658993">return</span>&nbsp;<span class="ident" id="6659000">NewWriterDict</span><span class="op" id="6659013">(</span><span class="ident" id="6659014">w</span><span class="op" id="6659015">,</span>&nbsp;<span class="ident" id="6659017">DefaultCompression</span><span class="op" id="6659035">,</span>&nbsp;<span class="ident" id="6659037">dict</span><span class="op" id="6659041">)</span>&nbsp;<span class="op" id="6659043">}</span><span class="op" id="6659044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659047">testResetOutput</span><span class="op" id="6659062">(</span><span class="ident" id="6659063">t</span><span class="op" id="6659064">,</span>&nbsp;<span class="keyword" id="6659066">func</span><span class="op" id="6659070">(</span><span class="ident" id="6659071">w</span>&nbsp;<span class="ident" id="6659073">io</span><span class="op" id="6659075">.</span><span class="ident" id="6659076">Writer</span><span class="op" id="6659082">)</span>&nbsp;<span class="op" id="6659084">(</span><span class="op" id="6659085">*</span><span class="ident" id="6659086">Writer</span><span class="op" id="6659092">,</span>&nbsp;<span class="builtintype" id="6659094">error</span><span class="op" id="6659099">)</span>&nbsp;<span class="op" id="6659101">{</span>&nbsp;<span class="keyword" id="6659103">return</span>&nbsp;<span class="ident" id="6659110">NewWriterDict</span><span class="op" id="6659123">(</span><span class="ident" id="6659124">w</span><span class="op" id="6659125">,</span>&nbsp;<span class="ident" id="6659127">BestCompression</span><span class="op" id="6659142">,</span>&nbsp;<span class="ident" id="6659144">dict</span><span class="op" id="6659148">)</span>&nbsp;<span class="op" id="6659150">}</span><span class="op" id="6659151">)</span><br>
<span class="lineno"></span><span class="op" id="6659153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span><span class="keyword" id="6659156">func</span>&nbsp;<span class="ident" id="6659161">testResetOutput</span><span class="op" id="6659176">(</span><span class="ident" id="6659177">t</span>&nbsp;<span class="op" id="6659179">*</span><span class="ident" id="6659180">testing</span><span class="op" id="6659187">.</span><span class="ident" id="6659188">T</span><span class="op" id="6659189">,</span>&nbsp;<span class="ident" id="6659191">newWriter</span>&nbsp;<span class="keyword" id="6659201">func</span><span class="op" id="6659205">(</span><span class="ident" id="6659206">w</span>&nbsp;<span class="ident" id="6659208">io</span><span class="op" id="6659210">.</span><span class="ident" id="6659211">Writer</span><span class="op" id="6659217">)</span>&nbsp;<span class="op" id="6659219">(</span><span class="op" id="6659220">*</span><span class="ident" id="6659221">Writer</span><span class="op" id="6659227">,</span>&nbsp;<span class="builtintype" id="6659229">error</span><span class="op" id="6659234">)</span><span class="op" id="6659235">)</span>&nbsp;<span class="op" id="6659237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659240">buf</span>&nbsp;<span class="op" id="6659244">:=</span>&nbsp;<span class="builtinfunc" id="6659247">new</span><span class="op" id="6659250">(</span><span class="ident" id="6659251">bytes</span><span class="op" id="6659256">.</span><span class="ident" id="6659257">Buffer</span><span class="op" id="6659263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659266">w</span><span class="op" id="6659267">,</span>&nbsp;<span class="ident" id="6659269">err</span>&nbsp;<span class="op" id="6659273">:=</span>&nbsp;<span class="ident" id="6659276">newWriter</span><span class="op" id="6659285">(</span><span class="ident" id="6659286">buf</span><span class="op" id="6659289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6659292">if</span>&nbsp;<span class="ident" id="6659295">err</span>&nbsp;<span class="op" id="6659299">!=</span>&nbsp;<span class="ident" id="6659302">nil</span>&nbsp;<span class="op" id="6659306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659310">t</span><span class="op" id="6659311">.</span><span class="ident" id="6659312">Fatalf</span><span class="op" id="6659318">(</span><span class="string" id="6659319">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="6659334">,</span>&nbsp;<span class="ident" id="6659336">err</span><span class="op" id="6659339">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6659342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659345">b</span>&nbsp;<span class="op" id="6659347">:=</span>&nbsp;<span class="op" id="6659350">[</span><span class="op" id="6659351">]</span><span class="builtintype" id="6659352">byte</span><span class="op" id="6659356">(</span><span class="string" id="6659357">&#34;hello&nbsp;world&#34;</span><span class="op" id="6659370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6659373">for</span>&nbsp;<span class="ident" id="6659377">i</span>&nbsp;<span class="op" id="6659379">:=</span>&nbsp;<span class="num" id="6659382">0</span><span class="op" id="6659383">;</span>&nbsp;<span class="ident" id="6659385">i</span>&nbsp;<span class="op" id="6659387">&lt;</span>&nbsp;<span class="num" id="6659389">1024</span><span class="op" id="6659393">;</span>&nbsp;<span class="ident" id="6659395">i</span><span class="op" id="6659396">++</span>&nbsp;<span class="op" id="6659399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659403">w</span><span class="op" id="6659404">.</span><span class="ident" id="6659405">Write</span><span class="op" id="6659410">(</span><span class="ident" id="6659411">b</span><span class="op" id="6659412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6659415">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659418">w</span><span class="op" id="6659419">.</span><span class="ident" id="6659420">Close</span><span class="op" id="6659425">(</span><span class="op" id="6659426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659429">out1</span>&nbsp;<span class="op" id="6659434">:=</span>&nbsp;<span class="ident" id="6659437">buf</span><span class="op" id="6659440">.</span><span class="ident" id="6659441">String</span><span class="op" id="6659447">(</span><span class="op" id="6659448">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659452">buf2</span>&nbsp;<span class="op" id="6659457">:=</span>&nbsp;<span class="builtinfunc" id="6659460">new</span><span class="op" id="6659463">(</span><span class="ident" id="6659464">bytes</span><span class="op" id="6659469">.</span><span class="ident" id="6659470">Buffer</span><span class="op" id="6659476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659479">w</span><span class="op" id="6659480">.</span><span class="ident" id="6659481">Reset</span><span class="op" id="6659486">(</span><span class="ident" id="6659487">buf2</span><span class="op" id="6659491">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6659494">for</span>&nbsp;<span class="ident" id="6659498">i</span>&nbsp;<span class="op" id="6659500">:=</span>&nbsp;<span class="num" id="6659503">0</span><span class="op" id="6659504">;</span>&nbsp;<span class="ident" id="6659506">i</span>&nbsp;<span class="op" id="6659508">&lt;</span>&nbsp;<span class="num" id="6659510">1024</span><span class="op" id="6659514">;</span>&nbsp;<span class="ident" id="6659516">i</span><span class="op" id="6659517">++</span>&nbsp;<span class="op" id="6659520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659524">w</span><span class="op" id="6659525">.</span><span class="ident" id="6659526">Write</span><span class="op" id="6659531">(</span><span class="ident" id="6659532">b</span><span class="op" id="6659533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6659536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659539">w</span><span class="op" id="6659540">.</span><span class="ident" id="6659541">Close</span><span class="op" id="6659546">(</span><span class="op" id="6659547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659550">out2</span>&nbsp;<span class="op" id="6659555">:=</span>&nbsp;<span class="ident" id="6659558">buf2</span><span class="op" id="6659562">.</span><span class="ident" id="6659563">String</span><span class="op" id="6659569">(</span><span class="op" id="6659570">)</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6659574">if</span>&nbsp;<span class="ident" id="6659577">out1</span>&nbsp;<span class="op" id="6659582">!=</span>&nbsp;<span class="ident" id="6659585">out2</span>&nbsp;<span class="op" id="6659590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659594">t</span><span class="op" id="6659595">.</span><span class="ident" id="6659596">Errorf</span><span class="op" id="6659602">(</span><span class="string" id="6659603">&#34;got&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="6659624">,</span>&nbsp;<span class="ident" id="6659626">out2</span><span class="op" id="6659630">,</span>&nbsp;<span class="ident" id="6659632">out1</span><span class="op" id="6659636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6659639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659642">t</span><span class="op" id="6659643">.</span><span class="ident" id="6659644">Logf</span><span class="op" id="6659648">(</span><span class="string" id="6659649">&#34;got&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="6659663">,</span>&nbsp;<span class="builtinfunc" id="6659665">len</span><span class="op" id="6659668">(</span><span class="ident" id="6659669">out1</span><span class="op" id="6659673">)</span><span class="op" id="6659674">)</span><br>
<span class="lineno">490</span><span class="op" id="6659676">}</span>
</div>
</body>
</html>
