<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2236965">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2237021">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2237075">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2237126">package</span>&nbsp;<span class="ident" id="2237134">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2237142">import</span>&nbsp;<span class="op" id="2237149">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2237152">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2237160">&#34;strings&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2237171">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2237182">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="2237197">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2237200">//&nbsp;An&nbsp;Error&nbsp;describes&nbsp;a&nbsp;failure&nbsp;to&nbsp;parse&nbsp;a&nbsp;regular&nbsp;expression</span><br>
<span class="lineno">15</span><span class="comment" id="2237262">//&nbsp;and&nbsp;gives&nbsp;the&nbsp;offending&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="2237301">type</span>&nbsp;<span class="ident" id="2237306">Error</span>&nbsp;<span class="keyword" id="2237312">struct</span>&nbsp;<span class="op" id="2237319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2237322">Code</span>&nbsp;<span class="ident" id="2237327">ErrorCode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2237338">Expr</span>&nbsp;<span class="builtintype" id="2237343">string</span><br>
<span class="lineno"></span><span class="op" id="2237350">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="2237353">func</span>&nbsp;<span class="op" id="2237358">(</span><span class="ident" id="2237359">e</span>&nbsp;<span class="op" id="2237361">*</span><span class="ident" id="2237362">Error</span><span class="op" id="2237367">)</span>&nbsp;<span class="ident" id="2237369">Error</span><span class="op" id="2237374">(</span><span class="op" id="2237375">)</span>&nbsp;<span class="builtintype" id="2237377">string</span>&nbsp;<span class="op" id="2237384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2237387">return</span>&nbsp;<span class="string" id="2237394">&#34;error&nbsp;parsing&nbsp;regexp:&nbsp;&#34;</span>&nbsp;<span class="op" id="2237419">+</span>&nbsp;<span class="ident" id="2237421">e</span><span class="op" id="2237422">.</span><span class="ident" id="2237423">Code</span><span class="op" id="2237427">.</span><span class="ident" id="2237428">String</span><span class="op" id="2237434">(</span><span class="op" id="2237435">)</span>&nbsp;<span class="op" id="2237437">+</span>&nbsp;<span class="string" id="2237439">&#34;:&nbsp;`&#34;</span>&nbsp;<span class="op" id="2237445">+</span>&nbsp;<span class="ident" id="2237447">e</span><span class="op" id="2237448">.</span><span class="ident" id="2237449">Expr</span>&nbsp;<span class="op" id="2237454">+</span>&nbsp;<span class="string" id="2237456">&#34;`&#34;</span><br>
<span class="lineno"></span><span class="op" id="2237460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="2237463">//&nbsp;An&nbsp;ErrorCode&nbsp;describes&nbsp;a&nbsp;failure&nbsp;to&nbsp;parse&nbsp;a&nbsp;regular&nbsp;expression.</span><br>
<span class="lineno"></span><span class="keyword" id="2237530">type</span>&nbsp;<span class="ident" id="2237535">ErrorCode</span>&nbsp;<span class="builtintype" id="2237545">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2237553">const</span>&nbsp;<span class="op" id="2237559">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2237562">//&nbsp;Unexpected&nbsp;error</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2237583">ErrInternalError</span>&nbsp;<span class="ident" id="2237600">ErrorCode</span>&nbsp;<span class="op" id="2237610">=</span>&nbsp;<span class="string" id="2237612">&#34;regexp/syntax:&nbsp;internal&nbsp;error&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2237646">//&nbsp;Parse&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2237663">ErrInvalidCharClass</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2237688">ErrorCode</span>&nbsp;<span class="op" id="2237698">=</span>&nbsp;<span class="string" id="2237700">&#34;invalid&nbsp;character&nbsp;class&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2237727">ErrInvalidCharRange</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2237752">ErrorCode</span>&nbsp;<span class="op" id="2237762">=</span>&nbsp;<span class="string" id="2237764">&#34;invalid&nbsp;character&nbsp;class&nbsp;range&#34;</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2237797">ErrInvalidEscape</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2237822">ErrorCode</span>&nbsp;<span class="op" id="2237832">=</span>&nbsp;<span class="string" id="2237834">&#34;invalid&nbsp;escape&nbsp;sequence&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2237861">ErrInvalidNamedCapture</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2237886">ErrorCode</span>&nbsp;<span class="op" id="2237896">=</span>&nbsp;<span class="string" id="2237898">&#34;invalid&nbsp;named&nbsp;capture&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2237923">ErrInvalidPerlOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2237948">ErrorCode</span>&nbsp;<span class="op" id="2237958">=</span>&nbsp;<span class="string" id="2237960">&#34;invalid&nbsp;or&nbsp;unsupported&nbsp;Perl&nbsp;syntax&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2237998">ErrInvalidRepeatOp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2238023">ErrorCode</span>&nbsp;<span class="op" id="2238033">=</span>&nbsp;<span class="string" id="2238035">&#34;invalid&nbsp;nested&nbsp;repetition&nbsp;operator&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2238073">ErrInvalidRepeatSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2238098">ErrorCode</span>&nbsp;<span class="op" id="2238108">=</span>&nbsp;<span class="string" id="2238110">&#34;invalid&nbsp;repeat&nbsp;count&#34;</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2238134">ErrInvalidUTF8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2238159">ErrorCode</span>&nbsp;<span class="op" id="2238169">=</span>&nbsp;<span class="string" id="2238171">&#34;invalid&nbsp;UTF-8&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2238188">ErrMissingBracket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2238213">ErrorCode</span>&nbsp;<span class="op" id="2238223">=</span>&nbsp;<span class="string" id="2238225">&#34;missing&nbsp;closing&nbsp;]&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2238246">ErrMissingParen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2238271">ErrorCode</span>&nbsp;<span class="op" id="2238281">=</span>&nbsp;<span class="string" id="2238283">&#34;missing&nbsp;closing&nbsp;)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2238304">ErrMissingRepeatArgument</span>&nbsp;<span class="ident" id="2238329">ErrorCode</span>&nbsp;<span class="op" id="2238339">=</span>&nbsp;<span class="string" id="2238341">&#34;missing&nbsp;argument&nbsp;to&nbsp;repetition&nbsp;operator&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2238384">ErrTrailingBackslash</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2238409">ErrorCode</span>&nbsp;<span class="op" id="2238419">=</span>&nbsp;<span class="string" id="2238421">&#34;trailing&nbsp;backslash&nbsp;at&nbsp;end&nbsp;of&nbsp;expression&#34;</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2238464">ErrUnexpectedParen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2238489">ErrorCode</span>&nbsp;<span class="op" id="2238499">=</span>&nbsp;<span class="string" id="2238501">&#34;unexpected&nbsp;)&#34;</span><br>
<span class="lineno"></span><span class="op" id="2238516">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2238519">func</span>&nbsp;<span class="op" id="2238524">(</span><span class="ident" id="2238525">e</span>&nbsp;<span class="ident" id="2238527">ErrorCode</span><span class="op" id="2238536">)</span>&nbsp;<span class="ident" id="2238538">String</span><span class="op" id="2238544">(</span><span class="op" id="2238545">)</span>&nbsp;<span class="builtintype" id="2238547">string</span>&nbsp;<span class="op" id="2238554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2238557">return</span>&nbsp;<span class="builtintype" id="2238564">string</span><span class="op" id="2238570">(</span><span class="ident" id="2238571">e</span><span class="op" id="2238572">)</span><br>
<span class="lineno">50</span><span class="op" id="2238574">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2238577">//&nbsp;Flags&nbsp;control&nbsp;the&nbsp;behavior&nbsp;of&nbsp;the&nbsp;parser&nbsp;and&nbsp;record&nbsp;information&nbsp;about&nbsp;regexp&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="2238666">type</span>&nbsp;<span class="ident" id="2238671">Flags</span>&nbsp;<span class="builtintype" id="2238677">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="2238685">const</span>&nbsp;<span class="op" id="2238691">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2238694">FoldCase</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2238708">Flags</span>&nbsp;<span class="op" id="2238714">=</span>&nbsp;<span class="num" id="2238716">1</span>&nbsp;<span class="op" id="2238718">&lt;&lt;</span>&nbsp;<span class="ident" id="2238721">iota</span>&nbsp;<span class="comment" id="2238726">//&nbsp;case-insensitive&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2238753">Literal</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2238785">//&nbsp;treat&nbsp;pattern&nbsp;as&nbsp;literal&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2238821">ClassNL</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2238853">//&nbsp;allow&nbsp;character&nbsp;classes&nbsp;like&nbsp;[^a-z]&nbsp;and&nbsp;[[:space:]]&nbsp;to&nbsp;match&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2238926">DotNL</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2238958">//&nbsp;allow&nbsp;.&nbsp;to&nbsp;match&nbsp;newline</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2238987">OneLine</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2239019">//&nbsp;treat&nbsp;^&nbsp;and&nbsp;$&nbsp;as&nbsp;only&nbsp;matching&nbsp;at&nbsp;beginning&nbsp;and&nbsp;end&nbsp;of&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2239083">NonGreedy</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2239115">//&nbsp;make&nbsp;repetition&nbsp;operators&nbsp;default&nbsp;to&nbsp;non-greedy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2239167">PerlX</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2239199">//&nbsp;allow&nbsp;Perl&nbsp;extensions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2239225">UnicodeGroups</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2239257">//&nbsp;allow&nbsp;\p{Han},&nbsp;\P{Han}&nbsp;for&nbsp;Unicode&nbsp;group&nbsp;and&nbsp;negation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2239315">WasDollar</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2239347">//&nbsp;regexp&nbsp;OpEndText&nbsp;was&nbsp;$,&nbsp;not&nbsp;\z</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2239382">Simple</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2239414">//&nbsp;regexp&nbsp;contains&nbsp;no&nbsp;counted&nbsp;repetition</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2239457">MatchNL</span>&nbsp;<span class="op" id="2239465">=</span>&nbsp;<span class="ident" id="2239467">ClassNL</span>&nbsp;<span class="op" id="2239475">|</span>&nbsp;<span class="ident" id="2239477">DotNL</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2239485">Perl</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2239497">=</span>&nbsp;<span class="ident" id="2239499">ClassNL</span>&nbsp;<span class="op" id="2239507">|</span>&nbsp;<span class="ident" id="2239509">OneLine</span>&nbsp;<span class="op" id="2239517">|</span>&nbsp;<span class="ident" id="2239519">PerlX</span>&nbsp;<span class="op" id="2239525">|</span>&nbsp;<span class="ident" id="2239527">UnicodeGroups</span>&nbsp;<span class="comment" id="2239541">//&nbsp;as&nbsp;close&nbsp;to&nbsp;Perl&nbsp;as&nbsp;possible</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2239574">POSIX</span>&nbsp;<span class="ident" id="2239580">Flags</span>&nbsp;<span class="op" id="2239586">=</span>&nbsp;<span class="num" id="2239588">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2239630">//&nbsp;POSIX&nbsp;syntax</span><br>
<span class="lineno"></span><span class="op" id="2239646">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2239649">//&nbsp;Pseudo-ops&nbsp;for&nbsp;parsing&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="2239682">const</span>&nbsp;<span class="op" id="2239688">(</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2239691">opLeftParen</span>&nbsp;<span class="op" id="2239703">=</span>&nbsp;<span class="ident" id="2239705">opPseudo</span>&nbsp;<span class="op" id="2239714">+</span>&nbsp;<span class="ident" id="2239716">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2239722">opVerticalBar</span><br>
<span class="lineno"></span><span class="op" id="2239736">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2239739">type</span>&nbsp;<span class="ident" id="2239744">parser</span>&nbsp;<span class="keyword" id="2239751">struct</span>&nbsp;<span class="op" id="2239758">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2239761">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2239773">Flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2239783">//&nbsp;parse&nbsp;mode&nbsp;flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2239804">stack</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2239816">[</span><span class="op" id="2239817">]</span><span class="op" id="2239818">*</span><span class="ident" id="2239819">Regexp</span>&nbsp;<span class="comment" id="2239826">//&nbsp;stack&nbsp;of&nbsp;parsed&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2239858">free</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2239870">*</span><span class="ident" id="2239871">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2239879">numCap</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2239891">int</span>&nbsp;<span class="comment" id="2239895">//&nbsp;number&nbsp;of&nbsp;capturing&nbsp;groups&nbsp;seen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2239931">wholeRegexp</span>&nbsp;<span class="builtintype" id="2239943">string</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2239951">tmpClass</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2239963">[</span><span class="op" id="2239964">]</span><span class="builtintype" id="2239965">rune</span>&nbsp;<span class="comment" id="2239970">//&nbsp;temporary&nbsp;char&nbsp;class&nbsp;work&nbsp;space</span><br>
<span class="lineno"></span><span class="op" id="2240005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2240008">func</span>&nbsp;<span class="op" id="2240013">(</span><span class="ident" id="2240014">p</span>&nbsp;<span class="op" id="2240016">*</span><span class="ident" id="2240017">parser</span><span class="op" id="2240023">)</span>&nbsp;<span class="ident" id="2240025">newRegexp</span><span class="op" id="2240034">(</span><span class="ident" id="2240035">op</span>&nbsp;<span class="ident" id="2240038">Op</span><span class="op" id="2240040">)</span>&nbsp;<span class="op" id="2240042">*</span><span class="ident" id="2240043">Regexp</span>&nbsp;<span class="op" id="2240050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2240053">re</span>&nbsp;<span class="op" id="2240056">:=</span>&nbsp;<span class="ident" id="2240059">p</span><span class="op" id="2240060">.</span><span class="ident" id="2240061">free</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2240067">if</span>&nbsp;<span class="ident" id="2240070">re</span>&nbsp;<span class="op" id="2240073">!=</span>&nbsp;<span class="ident" id="2240076">nil</span>&nbsp;<span class="op" id="2240080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2240084">p</span><span class="op" id="2240085">.</span><span class="ident" id="2240086">free</span>&nbsp;<span class="op" id="2240091">=</span>&nbsp;<span class="ident" id="2240093">re</span><span class="op" id="2240095">.</span><span class="ident" id="2240096">Sub0</span><span class="op" id="2240100">[</span><span class="num" id="2240101">0</span><span class="op" id="2240102">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2240106">*</span><span class="ident" id="2240107">re</span>&nbsp;<span class="op" id="2240110">=</span>&nbsp;<span class="ident" id="2240112">Regexp</span><span class="op" id="2240118">{</span><span class="op" id="2240119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2240122">}</span>&nbsp;<span class="keyword" id="2240124">else</span>&nbsp;<span class="op" id="2240129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2240133">re</span>&nbsp;<span class="op" id="2240136">=</span>&nbsp;<span class="builtinfunc" id="2240138">new</span><span class="op" id="2240141">(</span><span class="ident" id="2240142">Regexp</span><span class="op" id="2240148">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2240151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2240154">re</span><span class="op" id="2240156">.</span><span class="ident" id="2240157">Op</span>&nbsp;<span class="op" id="2240160">=</span>&nbsp;<span class="ident" id="2240162">op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2240166">return</span>&nbsp;<span class="ident" id="2240173">re</span><br>
<span class="lineno"></span><span class="op" id="2240176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="2240179">func</span>&nbsp;<span class="op" id="2240184">(</span><span class="ident" id="2240185">p</span>&nbsp;<span class="op" id="2240187">*</span><span class="ident" id="2240188">parser</span><span class="op" id="2240194">)</span>&nbsp;<span class="ident" id="2240196">reuse</span><span class="op" id="2240201">(</span><span class="ident" id="2240202">re</span>&nbsp;<span class="op" id="2240205">*</span><span class="ident" id="2240206">Regexp</span><span class="op" id="2240212">)</span>&nbsp;<span class="op" id="2240214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2240217">re</span><span class="op" id="2240219">.</span><span class="ident" id="2240220">Sub0</span><span class="op" id="2240224">[</span><span class="num" id="2240225">0</span><span class="op" id="2240226">]</span>&nbsp;<span class="op" id="2240228">=</span>&nbsp;<span class="ident" id="2240230">p</span><span class="op" id="2240231">.</span><span class="ident" id="2240232">free</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2240238">p</span><span class="op" id="2240239">.</span><span class="ident" id="2240240">free</span>&nbsp;<span class="op" id="2240245">=</span>&nbsp;<span class="ident" id="2240247">re</span><br>
<span class="lineno"></span><span class="op" id="2240250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="2240253">//&nbsp;Parse&nbsp;stack&nbsp;manipulation.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2240283">//&nbsp;push&nbsp;pushes&nbsp;the&nbsp;regexp&nbsp;re&nbsp;onto&nbsp;the&nbsp;parse&nbsp;stack&nbsp;and&nbsp;returns&nbsp;the&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="keyword" id="2240357">func</span>&nbsp;<span class="op" id="2240362">(</span><span class="ident" id="2240363">p</span>&nbsp;<span class="op" id="2240365">*</span><span class="ident" id="2240366">parser</span><span class="op" id="2240372">)</span>&nbsp;<span class="ident" id="2240374">push</span><span class="op" id="2240378">(</span><span class="ident" id="2240379">re</span>&nbsp;<span class="op" id="2240382">*</span><span class="ident" id="2240383">Regexp</span><span class="op" id="2240389">)</span>&nbsp;<span class="op" id="2240391">*</span><span class="ident" id="2240392">Regexp</span>&nbsp;<span class="op" id="2240399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2240402">if</span>&nbsp;<span class="ident" id="2240405">re</span><span class="op" id="2240407">.</span><span class="ident" id="2240408">Op</span>&nbsp;<span class="op" id="2240411">==</span>&nbsp;<span class="ident" id="2240414">OpCharClass</span>&nbsp;<span class="op" id="2240426">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2240429">len</span><span class="op" id="2240432">(</span><span class="ident" id="2240433">re</span><span class="op" id="2240435">.</span><span class="ident" id="2240436">Rune</span><span class="op" id="2240440">)</span>&nbsp;<span class="op" id="2240442">==</span>&nbsp;<span class="num" id="2240445">2</span>&nbsp;<span class="op" id="2240447">&amp;&amp;</span>&nbsp;<span class="ident" id="2240450">re</span><span class="op" id="2240452">.</span><span class="ident" id="2240453">Rune</span><span class="op" id="2240457">[</span><span class="num" id="2240458">0</span><span class="op" id="2240459">]</span>&nbsp;<span class="op" id="2240461">==</span>&nbsp;<span class="ident" id="2240464">re</span><span class="op" id="2240466">.</span><span class="ident" id="2240467">Rune</span><span class="op" id="2240471">[</span><span class="num" id="2240472">1</span><span class="op" id="2240473">]</span>&nbsp;<span class="op" id="2240475">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2240479">//&nbsp;Single&nbsp;rune.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2240497">if</span>&nbsp;<span class="ident" id="2240500">p</span><span class="op" id="2240501">.</span><span class="ident" id="2240502">maybeConcat</span><span class="op" id="2240513">(</span><span class="ident" id="2240514">re</span><span class="op" id="2240516">.</span><span class="ident" id="2240517">Rune</span><span class="op" id="2240521">[</span><span class="num" id="2240522">0</span><span class="op" id="2240523">]</span><span class="op" id="2240524">,</span>&nbsp;<span class="ident" id="2240526">p</span><span class="op" id="2240527">.</span><span class="ident" id="2240528">flags</span><span class="op" id="2240533">&amp;^</span><span class="ident" id="2240535">FoldCase</span><span class="op" id="2240543">)</span>&nbsp;<span class="op" id="2240545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2240550">return</span>&nbsp;<span class="ident" id="2240557">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2240563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2240567">re</span><span class="op" id="2240569">.</span><span class="ident" id="2240570">Op</span>&nbsp;<span class="op" id="2240573">=</span>&nbsp;<span class="ident" id="2240575">OpLiteral</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2240587">re</span><span class="op" id="2240589">.</span><span class="ident" id="2240590">Rune</span>&nbsp;<span class="op" id="2240595">=</span>&nbsp;<span class="ident" id="2240597">re</span><span class="op" id="2240599">.</span><span class="ident" id="2240600">Rune</span><span class="op" id="2240604">[</span><span class="op" id="2240605">:</span><span class="num" id="2240606">1</span><span class="op" id="2240607">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2240611">re</span><span class="op" id="2240613">.</span><span class="ident" id="2240614">Flags</span>&nbsp;<span class="op" id="2240620">=</span>&nbsp;<span class="ident" id="2240622">p</span><span class="op" id="2240623">.</span><span class="ident" id="2240624">flags</span>&nbsp;<span class="op" id="2240630">&amp;^</span>&nbsp;<span class="ident" id="2240633">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2240643">}</span>&nbsp;<span class="keyword" id="2240645">else</span>&nbsp;<span class="keyword" id="2240650">if</span>&nbsp;<span class="ident" id="2240653">re</span><span class="op" id="2240655">.</span><span class="ident" id="2240656">Op</span>&nbsp;<span class="op" id="2240659">==</span>&nbsp;<span class="ident" id="2240662">OpCharClass</span>&nbsp;<span class="op" id="2240674">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2240677">len</span><span class="op" id="2240680">(</span><span class="ident" id="2240681">re</span><span class="op" id="2240683">.</span><span class="ident" id="2240684">Rune</span><span class="op" id="2240688">)</span>&nbsp;<span class="op" id="2240690">==</span>&nbsp;<span class="num" id="2240693">4</span>&nbsp;<span class="op" id="2240695">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2240700">re</span><span class="op" id="2240702">.</span><span class="ident" id="2240703">Rune</span><span class="op" id="2240707">[</span><span class="num" id="2240708">0</span><span class="op" id="2240709">]</span>&nbsp;<span class="op" id="2240711">==</span>&nbsp;<span class="ident" id="2240714">re</span><span class="op" id="2240716">.</span><span class="ident" id="2240717">Rune</span><span class="op" id="2240721">[</span><span class="num" id="2240722">1</span><span class="op" id="2240723">]</span>&nbsp;<span class="op" id="2240725">&amp;&amp;</span>&nbsp;<span class="ident" id="2240728">re</span><span class="op" id="2240730">.</span><span class="ident" id="2240731">Rune</span><span class="op" id="2240735">[</span><span class="num" id="2240736">2</span><span class="op" id="2240737">]</span>&nbsp;<span class="op" id="2240739">==</span>&nbsp;<span class="ident" id="2240742">re</span><span class="op" id="2240744">.</span><span class="ident" id="2240745">Rune</span><span class="op" id="2240749">[</span><span class="num" id="2240750">3</span><span class="op" id="2240751">]</span>&nbsp;<span class="op" id="2240753">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2240758">unicode</span><span class="op" id="2240765">.</span><span class="ident" id="2240766">SimpleFold</span><span class="op" id="2240776">(</span><span class="ident" id="2240777">re</span><span class="op" id="2240779">.</span><span class="ident" id="2240780">Rune</span><span class="op" id="2240784">[</span><span class="num" id="2240785">0</span><span class="op" id="2240786">]</span><span class="op" id="2240787">)</span>&nbsp;<span class="op" id="2240789">==</span>&nbsp;<span class="ident" id="2240792">re</span><span class="op" id="2240794">.</span><span class="ident" id="2240795">Rune</span><span class="op" id="2240799">[</span><span class="num" id="2240800">2</span><span class="op" id="2240801">]</span>&nbsp;<span class="op" id="2240803">&amp;&amp;</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2240808">unicode</span><span class="op" id="2240815">.</span><span class="ident" id="2240816">SimpleFold</span><span class="op" id="2240826">(</span><span class="ident" id="2240827">re</span><span class="op" id="2240829">.</span><span class="ident" id="2240830">Rune</span><span class="op" id="2240834">[</span><span class="num" id="2240835">2</span><span class="op" id="2240836">]</span><span class="op" id="2240837">)</span>&nbsp;<span class="op" id="2240839">==</span>&nbsp;<span class="ident" id="2240842">re</span><span class="op" id="2240844">.</span><span class="ident" id="2240845">Rune</span><span class="op" id="2240849">[</span><span class="num" id="2240850">0</span><span class="op" id="2240851">]</span>&nbsp;<span class="op" id="2240853">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2240858">re</span><span class="op" id="2240860">.</span><span class="ident" id="2240861">Op</span>&nbsp;<span class="op" id="2240864">==</span>&nbsp;<span class="ident" id="2240867">OpCharClass</span>&nbsp;<span class="op" id="2240879">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2240882">len</span><span class="op" id="2240885">(</span><span class="ident" id="2240886">re</span><span class="op" id="2240888">.</span><span class="ident" id="2240889">Rune</span><span class="op" id="2240893">)</span>&nbsp;<span class="op" id="2240895">==</span>&nbsp;<span class="num" id="2240898">2</span>&nbsp;<span class="op" id="2240900">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2240906">re</span><span class="op" id="2240908">.</span><span class="ident" id="2240909">Rune</span><span class="op" id="2240913">[</span><span class="num" id="2240914">0</span><span class="op" id="2240915">]</span><span class="op" id="2240916">+</span><span class="num" id="2240917">1</span>&nbsp;<span class="op" id="2240919">==</span>&nbsp;<span class="ident" id="2240922">re</span><span class="op" id="2240924">.</span><span class="ident" id="2240925">Rune</span><span class="op" id="2240929">[</span><span class="num" id="2240930">1</span><span class="op" id="2240931">]</span>&nbsp;<span class="op" id="2240933">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2240939">unicode</span><span class="op" id="2240946">.</span><span class="ident" id="2240947">SimpleFold</span><span class="op" id="2240957">(</span><span class="ident" id="2240958">re</span><span class="op" id="2240960">.</span><span class="ident" id="2240961">Rune</span><span class="op" id="2240965">[</span><span class="num" id="2240966">0</span><span class="op" id="2240967">]</span><span class="op" id="2240968">)</span>&nbsp;<span class="op" id="2240970">==</span>&nbsp;<span class="ident" id="2240973">re</span><span class="op" id="2240975">.</span><span class="ident" id="2240976">Rune</span><span class="op" id="2240980">[</span><span class="num" id="2240981">1</span><span class="op" id="2240982">]</span>&nbsp;<span class="op" id="2240984">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2240990">unicode</span><span class="op" id="2240997">.</span><span class="ident" id="2240998">SimpleFold</span><span class="op" id="2241008">(</span><span class="ident" id="2241009">re</span><span class="op" id="2241011">.</span><span class="ident" id="2241012">Rune</span><span class="op" id="2241016">[</span><span class="num" id="2241017">1</span><span class="op" id="2241018">]</span><span class="op" id="2241019">)</span>&nbsp;<span class="op" id="2241021">==</span>&nbsp;<span class="ident" id="2241024">re</span><span class="op" id="2241026">.</span><span class="ident" id="2241027">Rune</span><span class="op" id="2241031">[</span><span class="num" id="2241032">0</span><span class="op" id="2241033">]</span>&nbsp;<span class="op" id="2241035">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2241039">//&nbsp;Case-insensitive&nbsp;rune&nbsp;like&nbsp;[Aa]&nbsp;or&nbsp;[Δδ].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2241087">if</span>&nbsp;<span class="ident" id="2241090">p</span><span class="op" id="2241091">.</span><span class="ident" id="2241092">maybeConcat</span><span class="op" id="2241103">(</span><span class="ident" id="2241104">re</span><span class="op" id="2241106">.</span><span class="ident" id="2241107">Rune</span><span class="op" id="2241111">[</span><span class="num" id="2241112">0</span><span class="op" id="2241113">]</span><span class="op" id="2241114">,</span>&nbsp;<span class="ident" id="2241116">p</span><span class="op" id="2241117">.</span><span class="ident" id="2241118">flags</span><span class="op" id="2241123">|</span><span class="ident" id="2241124">FoldCase</span><span class="op" id="2241132">)</span>&nbsp;<span class="op" id="2241134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2241139">return</span>&nbsp;<span class="ident" id="2241146">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2241152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2241157">//&nbsp;Rewrite&nbsp;as&nbsp;(case-insensitive)&nbsp;literal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2241201">re</span><span class="op" id="2241203">.</span><span class="ident" id="2241204">Op</span>&nbsp;<span class="op" id="2241207">=</span>&nbsp;<span class="ident" id="2241209">OpLiteral</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2241221">re</span><span class="op" id="2241223">.</span><span class="ident" id="2241224">Rune</span>&nbsp;<span class="op" id="2241229">=</span>&nbsp;<span class="ident" id="2241231">re</span><span class="op" id="2241233">.</span><span class="ident" id="2241234">Rune</span><span class="op" id="2241238">[</span><span class="op" id="2241239">:</span><span class="num" id="2241240">1</span><span class="op" id="2241241">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2241245">re</span><span class="op" id="2241247">.</span><span class="ident" id="2241248">Flags</span>&nbsp;<span class="op" id="2241254">=</span>&nbsp;<span class="ident" id="2241256">p</span><span class="op" id="2241257">.</span><span class="ident" id="2241258">flags</span>&nbsp;<span class="op" id="2241264">|</span>&nbsp;<span class="ident" id="2241266">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2241276">}</span>&nbsp;<span class="keyword" id="2241278">else</span>&nbsp;<span class="op" id="2241283">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2241287">//&nbsp;Incremental&nbsp;concatenation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2241319">p</span><span class="op" id="2241320">.</span><span class="ident" id="2241321">maybeConcat</span><span class="op" id="2241332">(</span><span class="op" id="2241333">-</span><span class="num" id="2241334">1</span><span class="op" id="2241335">,</span>&nbsp;<span class="num" id="2241337">0</span><span class="op" id="2241338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2241341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2241345">p</span><span class="op" id="2241346">.</span><span class="ident" id="2241347">stack</span>&nbsp;<span class="op" id="2241353">=</span>&nbsp;<span class="builtinfunc" id="2241355">append</span><span class="op" id="2241361">(</span><span class="ident" id="2241362">p</span><span class="op" id="2241363">.</span><span class="ident" id="2241364">stack</span><span class="op" id="2241369">,</span>&nbsp;<span class="ident" id="2241371">re</span><span class="op" id="2241373">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2241376">return</span>&nbsp;<span class="ident" id="2241383">re</span><br>
<span class="lineno"></span><span class="op" id="2241386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2241389">//&nbsp;maybeConcat&nbsp;implements&nbsp;incremental&nbsp;concatenation</span><br>
<span class="lineno"></span><span class="comment" id="2241441">//&nbsp;of&nbsp;literal&nbsp;runes&nbsp;into&nbsp;string&nbsp;nodes.&nbsp;&nbsp;The&nbsp;parser&nbsp;calls&nbsp;this</span><br>
<span class="lineno">145</span><span class="comment" id="2241503">//&nbsp;before&nbsp;each&nbsp;push,&nbsp;so&nbsp;only&nbsp;the&nbsp;top&nbsp;fragment&nbsp;of&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="2241562">//&nbsp;might&nbsp;need&nbsp;processing.&nbsp;&nbsp;Since&nbsp;this&nbsp;is&nbsp;called&nbsp;before&nbsp;a&nbsp;push,</span><br>
<span class="lineno"></span><span class="comment" id="2241625">//&nbsp;the&nbsp;topmost&nbsp;literal&nbsp;is&nbsp;no&nbsp;longer&nbsp;subject&nbsp;to&nbsp;operators&nbsp;like&nbsp;*</span><br>
<span class="lineno"></span><span class="comment" id="2241689">//&nbsp;(Otherwise&nbsp;ab*&nbsp;would&nbsp;turn&nbsp;into&nbsp;(ab)*.)</span><br>
<span class="lineno"></span><span class="comment" id="2241731">//&nbsp;If&nbsp;r&nbsp;&gt;=&nbsp;0&nbsp;and&nbsp;there&#39;s&nbsp;a&nbsp;node&nbsp;left&nbsp;over,&nbsp;maybeConcat&nbsp;uses&nbsp;it</span><br>
<span class="lineno">150</span><span class="comment" id="2241794">//&nbsp;to&nbsp;push&nbsp;r&nbsp;with&nbsp;the&nbsp;given&nbsp;flags.</span><br>
<span class="lineno"></span><span class="comment" id="2241829">//&nbsp;maybeConcat&nbsp;reports&nbsp;whether&nbsp;r&nbsp;was&nbsp;pushed.</span><br>
<span class="lineno"></span><span class="keyword" id="2241874">func</span>&nbsp;<span class="op" id="2241879">(</span><span class="ident" id="2241880">p</span>&nbsp;<span class="op" id="2241882">*</span><span class="ident" id="2241883">parser</span><span class="op" id="2241889">)</span>&nbsp;<span class="ident" id="2241891">maybeConcat</span><span class="op" id="2241902">(</span><span class="ident" id="2241903">r</span>&nbsp;<span class="builtintype" id="2241905">rune</span><span class="op" id="2241909">,</span>&nbsp;<span class="ident" id="2241911">flags</span>&nbsp;<span class="ident" id="2241917">Flags</span><span class="op" id="2241922">)</span>&nbsp;<span class="builtintype" id="2241924">bool</span>&nbsp;<span class="op" id="2241929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2241932">n</span>&nbsp;<span class="op" id="2241934">:=</span>&nbsp;<span class="builtinfunc" id="2241937">len</span><span class="op" id="2241940">(</span><span class="ident" id="2241941">p</span><span class="op" id="2241942">.</span><span class="ident" id="2241943">stack</span><span class="op" id="2241948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2241951">if</span>&nbsp;<span class="ident" id="2241954">n</span>&nbsp;<span class="op" id="2241956">&lt;</span>&nbsp;<span class="num" id="2241958">2</span>&nbsp;<span class="op" id="2241960">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2241964">return</span>&nbsp;<span class="builtintype" id="2241971">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2241978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2241982">re1</span>&nbsp;<span class="op" id="2241986">:=</span>&nbsp;<span class="ident" id="2241989">p</span><span class="op" id="2241990">.</span><span class="ident" id="2241991">stack</span><span class="op" id="2241996">[</span><span class="ident" id="2241997">n</span><span class="op" id="2241998">-</span><span class="num" id="2241999">1</span><span class="op" id="2242000">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242003">re2</span>&nbsp;<span class="op" id="2242007">:=</span>&nbsp;<span class="ident" id="2242010">p</span><span class="op" id="2242011">.</span><span class="ident" id="2242012">stack</span><span class="op" id="2242017">[</span><span class="ident" id="2242018">n</span><span class="op" id="2242019">-</span><span class="num" id="2242020">2</span><span class="op" id="2242021">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2242024">if</span>&nbsp;<span class="ident" id="2242027">re1</span><span class="op" id="2242030">.</span><span class="ident" id="2242031">Op</span>&nbsp;<span class="op" id="2242034">!=</span>&nbsp;<span class="ident" id="2242037">OpLiteral</span>&nbsp;<span class="op" id="2242047">||</span>&nbsp;<span class="ident" id="2242050">re2</span><span class="op" id="2242053">.</span><span class="ident" id="2242054">Op</span>&nbsp;<span class="op" id="2242057">!=</span>&nbsp;<span class="ident" id="2242060">OpLiteral</span>&nbsp;<span class="op" id="2242070">||</span>&nbsp;<span class="ident" id="2242073">re1</span><span class="op" id="2242076">.</span><span class="ident" id="2242077">Flags</span><span class="op" id="2242082">&amp;</span><span class="ident" id="2242083">FoldCase</span>&nbsp;<span class="op" id="2242092">!=</span>&nbsp;<span class="ident" id="2242095">re2</span><span class="op" id="2242098">.</span><span class="ident" id="2242099">Flags</span><span class="op" id="2242104">&amp;</span><span class="ident" id="2242105">FoldCase</span>&nbsp;<span class="op" id="2242114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2242118">return</span>&nbsp;<span class="builtintype" id="2242125">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2242132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2242136">//&nbsp;Push&nbsp;re1&nbsp;into&nbsp;re2.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242159">re2</span><span class="op" id="2242162">.</span><span class="ident" id="2242163">Rune</span>&nbsp;<span class="op" id="2242168">=</span>&nbsp;<span class="builtinfunc" id="2242170">append</span><span class="op" id="2242176">(</span><span class="ident" id="2242177">re2</span><span class="op" id="2242180">.</span><span class="ident" id="2242181">Rune</span><span class="op" id="2242185">,</span>&nbsp;<span class="ident" id="2242187">re1</span><span class="op" id="2242190">.</span><span class="ident" id="2242191">Rune</span><span class="op" id="2242195">...</span><span class="op" id="2242198">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2242202">//&nbsp;Reuse&nbsp;re1&nbsp;if&nbsp;possible.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2242229">if</span>&nbsp;<span class="ident" id="2242232">r</span>&nbsp;<span class="op" id="2242234">&gt;=</span>&nbsp;<span class="num" id="2242237">0</span>&nbsp;<span class="op" id="2242239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242243">re1</span><span class="op" id="2242246">.</span><span class="ident" id="2242247">Rune</span>&nbsp;<span class="op" id="2242252">=</span>&nbsp;<span class="ident" id="2242254">re1</span><span class="op" id="2242257">.</span><span class="ident" id="2242258">Rune0</span><span class="op" id="2242263">[</span><span class="op" id="2242264">:</span><span class="num" id="2242265">1</span><span class="op" id="2242266">]</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242270">re1</span><span class="op" id="2242273">.</span><span class="ident" id="2242274">Rune</span><span class="op" id="2242278">[</span><span class="num" id="2242279">0</span><span class="op" id="2242280">]</span>&nbsp;<span class="op" id="2242282">=</span>&nbsp;<span class="ident" id="2242284">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242288">re1</span><span class="op" id="2242291">.</span><span class="ident" id="2242292">Flags</span>&nbsp;<span class="op" id="2242298">=</span>&nbsp;<span class="ident" id="2242300">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2242308">return</span>&nbsp;<span class="builtintype" id="2242315">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2242321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242325">p</span><span class="op" id="2242326">.</span><span class="ident" id="2242327">stack</span>&nbsp;<span class="op" id="2242333">=</span>&nbsp;<span class="ident" id="2242335">p</span><span class="op" id="2242336">.</span><span class="ident" id="2242337">stack</span><span class="op" id="2242342">[</span><span class="op" id="2242343">:</span><span class="ident" id="2242344">n</span><span class="op" id="2242345">-</span><span class="num" id="2242346">1</span><span class="op" id="2242347">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242350">p</span><span class="op" id="2242351">.</span><span class="ident" id="2242352">reuse</span><span class="op" id="2242357">(</span><span class="ident" id="2242358">re1</span><span class="op" id="2242361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2242364">return</span>&nbsp;<span class="builtintype" id="2242371">false</span>&nbsp;<span class="comment" id="2242377">//&nbsp;did&nbsp;not&nbsp;push&nbsp;r</span><br>
<span class="lineno"></span><span class="op" id="2242395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="2242398">//&nbsp;newLiteral&nbsp;returns&nbsp;a&nbsp;new&nbsp;OpLiteral&nbsp;Regexp&nbsp;with&nbsp;the&nbsp;given&nbsp;flags</span><br>
<span class="lineno"></span><span class="keyword" id="2242464">func</span>&nbsp;<span class="op" id="2242469">(</span><span class="ident" id="2242470">p</span>&nbsp;<span class="op" id="2242472">*</span><span class="ident" id="2242473">parser</span><span class="op" id="2242479">)</span>&nbsp;<span class="ident" id="2242481">newLiteral</span><span class="op" id="2242491">(</span><span class="ident" id="2242492">r</span>&nbsp;<span class="builtintype" id="2242494">rune</span><span class="op" id="2242498">,</span>&nbsp;<span class="ident" id="2242500">flags</span>&nbsp;<span class="ident" id="2242506">Flags</span><span class="op" id="2242511">)</span>&nbsp;<span class="op" id="2242513">*</span><span class="ident" id="2242514">Regexp</span>&nbsp;<span class="op" id="2242521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242524">re</span>&nbsp;<span class="op" id="2242527">:=</span>&nbsp;<span class="ident" id="2242530">p</span><span class="op" id="2242531">.</span><span class="ident" id="2242532">newRegexp</span><span class="op" id="2242541">(</span><span class="ident" id="2242542">OpLiteral</span><span class="op" id="2242551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242554">re</span><span class="op" id="2242556">.</span><span class="ident" id="2242557">Flags</span>&nbsp;<span class="op" id="2242563">=</span>&nbsp;<span class="ident" id="2242565">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2242572">if</span>&nbsp;<span class="ident" id="2242575">flags</span><span class="op" id="2242580">&amp;</span><span class="ident" id="2242581">FoldCase</span>&nbsp;<span class="op" id="2242590">!=</span>&nbsp;<span class="num" id="2242593">0</span>&nbsp;<span class="op" id="2242595">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242599">r</span>&nbsp;<span class="op" id="2242601">=</span>&nbsp;<span class="ident" id="2242603">minFoldRune</span><span class="op" id="2242614">(</span><span class="ident" id="2242615">r</span><span class="op" id="2242616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2242619">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242622">re</span><span class="op" id="2242624">.</span><span class="ident" id="2242625">Rune0</span><span class="op" id="2242630">[</span><span class="num" id="2242631">0</span><span class="op" id="2242632">]</span>&nbsp;<span class="op" id="2242634">=</span>&nbsp;<span class="ident" id="2242636">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242639">re</span><span class="op" id="2242641">.</span><span class="ident" id="2242642">Rune</span>&nbsp;<span class="op" id="2242647">=</span>&nbsp;<span class="ident" id="2242649">re</span><span class="op" id="2242651">.</span><span class="ident" id="2242652">Rune0</span><span class="op" id="2242657">[</span><span class="op" id="2242658">:</span><span class="num" id="2242659">1</span><span class="op" id="2242660">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2242663">return</span>&nbsp;<span class="ident" id="2242670">re</span><br>
<span class="lineno">190</span><span class="op" id="2242673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2242676">//&nbsp;minFoldRune&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;rune&nbsp;fold-equivalent&nbsp;to&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="2242738">func</span>&nbsp;<span class="ident" id="2242743">minFoldRune</span><span class="op" id="2242754">(</span><span class="ident" id="2242755">r</span>&nbsp;<span class="builtintype" id="2242757">rune</span><span class="op" id="2242761">)</span>&nbsp;<span class="builtintype" id="2242763">rune</span>&nbsp;<span class="op" id="2242768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2242771">if</span>&nbsp;<span class="ident" id="2242774">r</span>&nbsp;<span class="op" id="2242776">&lt;</span>&nbsp;<span class="ident" id="2242778">minFold</span>&nbsp;<span class="op" id="2242786">||</span>&nbsp;<span class="ident" id="2242789">r</span>&nbsp;<span class="op" id="2242791">&gt;</span>&nbsp;<span class="ident" id="2242793">maxFold</span>&nbsp;<span class="op" id="2242801">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2242805">return</span>&nbsp;<span class="ident" id="2242812">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2242815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242818">min</span>&nbsp;<span class="op" id="2242822">:=</span>&nbsp;<span class="ident" id="2242825">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242828">r0</span>&nbsp;<span class="op" id="2242831">:=</span>&nbsp;<span class="ident" id="2242834">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2242837">for</span>&nbsp;<span class="ident" id="2242841">r</span>&nbsp;<span class="op" id="2242843">=</span>&nbsp;<span class="ident" id="2242845">unicode</span><span class="op" id="2242852">.</span><span class="ident" id="2242853">SimpleFold</span><span class="op" id="2242863">(</span><span class="ident" id="2242864">r</span><span class="op" id="2242865">)</span><span class="op" id="2242866">;</span>&nbsp;<span class="ident" id="2242868">r</span>&nbsp;<span class="op" id="2242870">!=</span>&nbsp;<span class="ident" id="2242873">r0</span><span class="op" id="2242875">;</span>&nbsp;<span class="ident" id="2242877">r</span>&nbsp;<span class="op" id="2242879">=</span>&nbsp;<span class="ident" id="2242881">unicode</span><span class="op" id="2242888">.</span><span class="ident" id="2242889">SimpleFold</span><span class="op" id="2242899">(</span><span class="ident" id="2242900">r</span><span class="op" id="2242901">)</span>&nbsp;<span class="op" id="2242903">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2242907">if</span>&nbsp;<span class="ident" id="2242910">min</span>&nbsp;<span class="op" id="2242914">&gt;</span>&nbsp;<span class="ident" id="2242916">r</span>&nbsp;<span class="op" id="2242918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2242923">min</span>&nbsp;<span class="op" id="2242927">=</span>&nbsp;<span class="ident" id="2242929">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2242933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2242936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2242939">return</span>&nbsp;<span class="ident" id="2242946">min</span><br>
<span class="lineno">205</span><span class="op" id="2242950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2242953">//&nbsp;literal&nbsp;pushes&nbsp;a&nbsp;literal&nbsp;regexp&nbsp;for&nbsp;the&nbsp;rune&nbsp;r&nbsp;on&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="2243016">//&nbsp;and&nbsp;returns&nbsp;that&nbsp;regexp.</span><br>
<span class="lineno"></span><span class="keyword" id="2243044">func</span>&nbsp;<span class="op" id="2243049">(</span><span class="ident" id="2243050">p</span>&nbsp;<span class="op" id="2243052">*</span><span class="ident" id="2243053">parser</span><span class="op" id="2243059">)</span>&nbsp;<span class="ident" id="2243061">literal</span><span class="op" id="2243068">(</span><span class="ident" id="2243069">r</span>&nbsp;<span class="builtintype" id="2243071">rune</span><span class="op" id="2243075">)</span>&nbsp;<span class="op" id="2243077">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2243080">p</span><span class="op" id="2243081">.</span><span class="ident" id="2243082">push</span><span class="op" id="2243086">(</span><span class="ident" id="2243087">p</span><span class="op" id="2243088">.</span><span class="ident" id="2243089">newLiteral</span><span class="op" id="2243099">(</span><span class="ident" id="2243100">r</span><span class="op" id="2243101">,</span>&nbsp;<span class="ident" id="2243103">p</span><span class="op" id="2243104">.</span><span class="ident" id="2243105">flags</span><span class="op" id="2243110">)</span><span class="op" id="2243111">)</span><br>
<span class="lineno"></span><span class="op" id="2243113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2243116">//&nbsp;op&nbsp;pushes&nbsp;a&nbsp;regexp&nbsp;with&nbsp;the&nbsp;given&nbsp;op&nbsp;onto&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="2243171">//&nbsp;and&nbsp;returns&nbsp;that&nbsp;regexp.</span><br>
<span class="lineno">215</span><span class="keyword" id="2243199">func</span>&nbsp;<span class="op" id="2243204">(</span><span class="ident" id="2243205">p</span>&nbsp;<span class="op" id="2243207">*</span><span class="ident" id="2243208">parser</span><span class="op" id="2243214">)</span>&nbsp;<span class="ident" id="2243216">op</span><span class="op" id="2243218">(</span><span class="ident" id="2243219">op</span>&nbsp;<span class="ident" id="2243222">Op</span><span class="op" id="2243224">)</span>&nbsp;<span class="op" id="2243226">*</span><span class="ident" id="2243227">Regexp</span>&nbsp;<span class="op" id="2243234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2243237">re</span>&nbsp;<span class="op" id="2243240">:=</span>&nbsp;<span class="ident" id="2243243">p</span><span class="op" id="2243244">.</span><span class="ident" id="2243245">newRegexp</span><span class="op" id="2243254">(</span><span class="ident" id="2243255">op</span><span class="op" id="2243257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2243260">re</span><span class="op" id="2243262">.</span><span class="ident" id="2243263">Flags</span>&nbsp;<span class="op" id="2243269">=</span>&nbsp;<span class="ident" id="2243271">p</span><span class="op" id="2243272">.</span><span class="ident" id="2243273">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2243280">return</span>&nbsp;<span class="ident" id="2243287">p</span><span class="op" id="2243288">.</span><span class="ident" id="2243289">push</span><span class="op" id="2243293">(</span><span class="ident" id="2243294">re</span><span class="op" id="2243296">)</span><br>
<span class="lineno"></span><span class="op" id="2243298">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="2243301">//&nbsp;repeat&nbsp;replaces&nbsp;the&nbsp;top&nbsp;stack&nbsp;element&nbsp;with&nbsp;itself&nbsp;repeated&nbsp;according&nbsp;to&nbsp;op,&nbsp;min,&nbsp;max.</span><br>
<span class="lineno"></span><span class="comment" id="2243390">//&nbsp;before&nbsp;is&nbsp;the&nbsp;regexp&nbsp;suffix&nbsp;starting&nbsp;at&nbsp;the&nbsp;repetition&nbsp;operator.</span><br>
<span class="lineno"></span><span class="comment" id="2243458">//&nbsp;after&nbsp;is&nbsp;the&nbsp;regexp&nbsp;suffix&nbsp;following&nbsp;after&nbsp;the&nbsp;repetition&nbsp;operator.</span><br>
<span class="lineno"></span><span class="comment" id="2243529">//&nbsp;repeat&nbsp;returns&nbsp;an&nbsp;updated&nbsp;&#39;after&#39;&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.</span><br>
<span class="lineno">225</span><span class="keyword" id="2243588">func</span>&nbsp;<span class="op" id="2243593">(</span><span class="ident" id="2243594">p</span>&nbsp;<span class="op" id="2243596">*</span><span class="ident" id="2243597">parser</span><span class="op" id="2243603">)</span>&nbsp;<span class="ident" id="2243605">repeat</span><span class="op" id="2243611">(</span><span class="ident" id="2243612">op</span>&nbsp;<span class="ident" id="2243615">Op</span><span class="op" id="2243617">,</span>&nbsp;<span class="ident" id="2243619">min</span><span class="op" id="2243622">,</span>&nbsp;<span class="ident" id="2243624">max</span>&nbsp;<span class="builtintype" id="2243628">int</span><span class="op" id="2243631">,</span>&nbsp;<span class="ident" id="2243633">before</span><span class="op" id="2243639">,</span>&nbsp;<span class="ident" id="2243641">after</span><span class="op" id="2243646">,</span>&nbsp;<span class="ident" id="2243648">lastRepeat</span>&nbsp;<span class="builtintype" id="2243659">string</span><span class="op" id="2243665">)</span>&nbsp;<span class="op" id="2243667">(</span><span class="builtintype" id="2243668">string</span><span class="op" id="2243674">,</span>&nbsp;<span class="builtintype" id="2243676">error</span><span class="op" id="2243681">)</span>&nbsp;<span class="op" id="2243683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2243686">flags</span>&nbsp;<span class="op" id="2243692">:=</span>&nbsp;<span class="ident" id="2243695">p</span><span class="op" id="2243696">.</span><span class="ident" id="2243697">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2243704">if</span>&nbsp;<span class="ident" id="2243707">p</span><span class="op" id="2243708">.</span><span class="ident" id="2243709">flags</span><span class="op" id="2243714">&amp;</span><span class="ident" id="2243715">PerlX</span>&nbsp;<span class="op" id="2243721">!=</span>&nbsp;<span class="num" id="2243724">0</span>&nbsp;<span class="op" id="2243726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2243730">if</span>&nbsp;<span class="builtinfunc" id="2243733">len</span><span class="op" id="2243736">(</span><span class="ident" id="2243737">after</span><span class="op" id="2243742">)</span>&nbsp;<span class="op" id="2243744">&gt;</span>&nbsp;<span class="num" id="2243746">0</span>&nbsp;<span class="op" id="2243748">&amp;&amp;</span>&nbsp;<span class="ident" id="2243751">after</span><span class="op" id="2243756">[</span><span class="num" id="2243757">0</span><span class="op" id="2243758">]</span>&nbsp;<span class="op" id="2243760">==</span>&nbsp;<span class="string" id="2243763">&#39;?&#39;</span>&nbsp;<span class="op" id="2243767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2243772">after</span>&nbsp;<span class="op" id="2243778">=</span>&nbsp;<span class="ident" id="2243780">after</span><span class="op" id="2243785">[</span><span class="num" id="2243786">1</span><span class="op" id="2243787">:</span><span class="op" id="2243788">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2243793">flags</span>&nbsp;<span class="op" id="2243799">^=</span>&nbsp;<span class="ident" id="2243802">NonGreedy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2243814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2243818">if</span>&nbsp;<span class="ident" id="2243821">lastRepeat</span>&nbsp;<span class="op" id="2243832">!=</span>&nbsp;<span class="string" id="2243835">&#34;&#34;</span>&nbsp;<span class="op" id="2243838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2243843">//&nbsp;In&nbsp;Perl&nbsp;it&nbsp;is&nbsp;not&nbsp;allowed&nbsp;to&nbsp;stack&nbsp;repetition&nbsp;operators:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2243906">//&nbsp;a**&nbsp;is&nbsp;a&nbsp;syntax&nbsp;error,&nbsp;not&nbsp;a&nbsp;doubled&nbsp;star,&nbsp;and&nbsp;a++&nbsp;means</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2243969">//&nbsp;something&nbsp;else&nbsp;entirely,&nbsp;which&nbsp;we&nbsp;don&#39;t&nbsp;support!</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2244024">return</span>&nbsp;<span class="string" id="2244031">&#34;&#34;</span><span class="op" id="2244033">,</span>&nbsp;<span class="op" id="2244035">&amp;</span><span class="ident" id="2244036">Error</span><span class="op" id="2244041">{</span><span class="ident" id="2244042">ErrInvalidRepeatOp</span><span class="op" id="2244060">,</span>&nbsp;<span class="ident" id="2244062">lastRepeat</span><span class="op" id="2244072">[</span><span class="op" id="2244073">:</span><span class="builtinfunc" id="2244074">len</span><span class="op" id="2244077">(</span><span class="ident" id="2244078">lastRepeat</span><span class="op" id="2244088">)</span><span class="op" id="2244089">-</span><span class="builtinfunc" id="2244090">len</span><span class="op" id="2244093">(</span><span class="ident" id="2244094">after</span><span class="op" id="2244099">)</span><span class="op" id="2244100">]</span><span class="op" id="2244101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2244105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2244108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2244111">n</span>&nbsp;<span class="op" id="2244113">:=</span>&nbsp;<span class="builtinfunc" id="2244116">len</span><span class="op" id="2244119">(</span><span class="ident" id="2244120">p</span><span class="op" id="2244121">.</span><span class="ident" id="2244122">stack</span><span class="op" id="2244127">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2244130">if</span>&nbsp;<span class="ident" id="2244133">n</span>&nbsp;<span class="op" id="2244135">==</span>&nbsp;<span class="num" id="2244138">0</span>&nbsp;<span class="op" id="2244140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2244144">return</span>&nbsp;<span class="string" id="2244151">&#34;&#34;</span><span class="op" id="2244153">,</span>&nbsp;<span class="op" id="2244155">&amp;</span><span class="ident" id="2244156">Error</span><span class="op" id="2244161">{</span><span class="ident" id="2244162">ErrMissingRepeatArgument</span><span class="op" id="2244186">,</span>&nbsp;<span class="ident" id="2244188">before</span><span class="op" id="2244194">[</span><span class="op" id="2244195">:</span><span class="builtinfunc" id="2244196">len</span><span class="op" id="2244199">(</span><span class="ident" id="2244200">before</span><span class="op" id="2244206">)</span><span class="op" id="2244207">-</span><span class="builtinfunc" id="2244208">len</span><span class="op" id="2244211">(</span><span class="ident" id="2244212">after</span><span class="op" id="2244217">)</span><span class="op" id="2244218">]</span><span class="op" id="2244219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2244222">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2244225">sub</span>&nbsp;<span class="op" id="2244229">:=</span>&nbsp;<span class="ident" id="2244232">p</span><span class="op" id="2244233">.</span><span class="ident" id="2244234">stack</span><span class="op" id="2244239">[</span><span class="ident" id="2244240">n</span><span class="op" id="2244241">-</span><span class="num" id="2244242">1</span><span class="op" id="2244243">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2244246">if</span>&nbsp;<span class="ident" id="2244249">sub</span><span class="op" id="2244252">.</span><span class="ident" id="2244253">Op</span>&nbsp;<span class="op" id="2244256">&gt;=</span>&nbsp;<span class="ident" id="2244259">opPseudo</span>&nbsp;<span class="op" id="2244268">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2244272">return</span>&nbsp;<span class="string" id="2244279">&#34;&#34;</span><span class="op" id="2244281">,</span>&nbsp;<span class="op" id="2244283">&amp;</span><span class="ident" id="2244284">Error</span><span class="op" id="2244289">{</span><span class="ident" id="2244290">ErrMissingRepeatArgument</span><span class="op" id="2244314">,</span>&nbsp;<span class="ident" id="2244316">before</span><span class="op" id="2244322">[</span><span class="op" id="2244323">:</span><span class="builtinfunc" id="2244324">len</span><span class="op" id="2244327">(</span><span class="ident" id="2244328">before</span><span class="op" id="2244334">)</span><span class="op" id="2244335">-</span><span class="builtinfunc" id="2244336">len</span><span class="op" id="2244339">(</span><span class="ident" id="2244340">after</span><span class="op" id="2244345">)</span><span class="op" id="2244346">]</span><span class="op" id="2244347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2244350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2244354">re</span>&nbsp;<span class="op" id="2244357">:=</span>&nbsp;<span class="ident" id="2244360">p</span><span class="op" id="2244361">.</span><span class="ident" id="2244362">newRegexp</span><span class="op" id="2244371">(</span><span class="ident" id="2244372">op</span><span class="op" id="2244374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2244377">re</span><span class="op" id="2244379">.</span><span class="ident" id="2244380">Min</span>&nbsp;<span class="op" id="2244384">=</span>&nbsp;<span class="ident" id="2244386">min</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2244391">re</span><span class="op" id="2244393">.</span><span class="ident" id="2244394">Max</span>&nbsp;<span class="op" id="2244398">=</span>&nbsp;<span class="ident" id="2244400">max</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2244405">re</span><span class="op" id="2244407">.</span><span class="ident" id="2244408">Flags</span>&nbsp;<span class="op" id="2244414">=</span>&nbsp;<span class="ident" id="2244416">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2244423">re</span><span class="op" id="2244425">.</span><span class="ident" id="2244426">Sub</span>&nbsp;<span class="op" id="2244430">=</span>&nbsp;<span class="ident" id="2244432">re</span><span class="op" id="2244434">.</span><span class="ident" id="2244435">Sub0</span><span class="op" id="2244439">[</span><span class="op" id="2244440">:</span><span class="num" id="2244441">1</span><span class="op" id="2244442">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2244445">re</span><span class="op" id="2244447">.</span><span class="ident" id="2244448">Sub</span><span class="op" id="2244451">[</span><span class="num" id="2244452">0</span><span class="op" id="2244453">]</span>&nbsp;<span class="op" id="2244455">=</span>&nbsp;<span class="ident" id="2244457">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2244462">p</span><span class="op" id="2244463">.</span><span class="ident" id="2244464">stack</span><span class="op" id="2244469">[</span><span class="ident" id="2244470">n</span><span class="op" id="2244471">-</span><span class="num" id="2244472">1</span><span class="op" id="2244473">]</span>&nbsp;<span class="op" id="2244475">=</span>&nbsp;<span class="ident" id="2244477">re</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2244482">if</span>&nbsp;<span class="ident" id="2244485">op</span>&nbsp;<span class="op" id="2244488">==</span>&nbsp;<span class="ident" id="2244491">OpRepeat</span>&nbsp;<span class="op" id="2244500">&amp;&amp;</span>&nbsp;<span class="op" id="2244503">(</span><span class="ident" id="2244504">min</span>&nbsp;<span class="op" id="2244508">&gt;=</span>&nbsp;<span class="num" id="2244511">2</span>&nbsp;<span class="op" id="2244513">||</span>&nbsp;<span class="ident" id="2244516">max</span>&nbsp;<span class="op" id="2244520">&gt;=</span>&nbsp;<span class="num" id="2244523">2</span><span class="op" id="2244524">)</span>&nbsp;<span class="op" id="2244526">&amp;&amp;</span>&nbsp;<span class="op" id="2244529">!</span><span class="ident" id="2244530">repeatIsValid</span><span class="op" id="2244543">(</span><span class="ident" id="2244544">re</span><span class="op" id="2244546">,</span>&nbsp;<span class="num" id="2244548">1000</span><span class="op" id="2244552">)</span>&nbsp;<span class="op" id="2244554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2244558">return</span>&nbsp;<span class="string" id="2244565">&#34;&#34;</span><span class="op" id="2244567">,</span>&nbsp;<span class="op" id="2244569">&amp;</span><span class="ident" id="2244570">Error</span><span class="op" id="2244575">{</span><span class="ident" id="2244576">ErrInvalidRepeatSize</span><span class="op" id="2244596">,</span>&nbsp;<span class="ident" id="2244598">before</span><span class="op" id="2244604">[</span><span class="op" id="2244605">:</span><span class="builtinfunc" id="2244606">len</span><span class="op" id="2244609">(</span><span class="ident" id="2244610">before</span><span class="op" id="2244616">)</span><span class="op" id="2244617">-</span><span class="builtinfunc" id="2244618">len</span><span class="op" id="2244621">(</span><span class="ident" id="2244622">after</span><span class="op" id="2244627">)</span><span class="op" id="2244628">]</span><span class="op" id="2244629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2244632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2244636">return</span>&nbsp;<span class="ident" id="2244643">after</span><span class="op" id="2244648">,</span>&nbsp;<span class="ident" id="2244650">nil</span><br>
<span class="lineno"></span><span class="op" id="2244654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2244657">//&nbsp;repeatIsValid&nbsp;reports&nbsp;whether&nbsp;the&nbsp;repetition&nbsp;re&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="comment" id="2244718">//&nbsp;Valid&nbsp;means&nbsp;that&nbsp;the&nbsp;combination&nbsp;of&nbsp;the&nbsp;top-level&nbsp;repetition</span><br>
<span class="lineno">265</span><span class="comment" id="2244782">//&nbsp;and&nbsp;any&nbsp;inner&nbsp;repetitions&nbsp;does&nbsp;not&nbsp;exceed&nbsp;n&nbsp;copies&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2244843">//&nbsp;innermost&nbsp;thing.</span><br>
<span class="lineno"></span><span class="comment" id="2244863">//&nbsp;This&nbsp;function&nbsp;rewalks&nbsp;the&nbsp;regexp&nbsp;tree&nbsp;and&nbsp;is&nbsp;called&nbsp;for&nbsp;every&nbsp;repetition,</span><br>
<span class="lineno"></span><span class="comment" id="2244940">//&nbsp;so&nbsp;we&nbsp;have&nbsp;to&nbsp;worry&nbsp;about&nbsp;inducing&nbsp;quadratic&nbsp;behavior&nbsp;in&nbsp;the&nbsp;parser.</span><br>
<span class="lineno"></span><span class="comment" id="2245012">//&nbsp;We&nbsp;avoid&nbsp;this&nbsp;by&nbsp;only&nbsp;calling&nbsp;repeatIsValid&nbsp;when&nbsp;min&nbsp;or&nbsp;max&nbsp;&gt;=&nbsp;2.</span><br>
<span class="lineno">270</span><span class="comment" id="2245081">//&nbsp;In&nbsp;that&nbsp;case&nbsp;the&nbsp;depth&nbsp;of&nbsp;any&nbsp;&gt;=&nbsp;2&nbsp;nesting&nbsp;can&nbsp;only&nbsp;get&nbsp;to&nbsp;9&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="2245153">//&nbsp;triggering&nbsp;a&nbsp;parse&nbsp;error,&nbsp;so&nbsp;each&nbsp;subtree&nbsp;can&nbsp;only&nbsp;be&nbsp;rewalked&nbsp;9&nbsp;times.</span><br>
<span class="lineno"></span><span class="keyword" id="2245228">func</span>&nbsp;<span class="ident" id="2245233">repeatIsValid</span><span class="op" id="2245246">(</span><span class="ident" id="2245247">re</span>&nbsp;<span class="op" id="2245250">*</span><span class="ident" id="2245251">Regexp</span><span class="op" id="2245257">,</span>&nbsp;<span class="ident" id="2245259">n</span>&nbsp;<span class="builtintype" id="2245261">int</span><span class="op" id="2245264">)</span>&nbsp;<span class="builtintype" id="2245266">bool</span>&nbsp;<span class="op" id="2245271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2245274">if</span>&nbsp;<span class="ident" id="2245277">re</span><span class="op" id="2245279">.</span><span class="ident" id="2245280">Op</span>&nbsp;<span class="op" id="2245283">==</span>&nbsp;<span class="ident" id="2245286">OpRepeat</span>&nbsp;<span class="op" id="2245295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2245299">m</span>&nbsp;<span class="op" id="2245301">:=</span>&nbsp;<span class="ident" id="2245304">re</span><span class="op" id="2245306">.</span><span class="ident" id="2245307">Max</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2245313">if</span>&nbsp;<span class="ident" id="2245316">m</span>&nbsp;<span class="op" id="2245318">==</span>&nbsp;<span class="num" id="2245321">0</span>&nbsp;<span class="op" id="2245323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2245328">return</span>&nbsp;<span class="builtintype" id="2245335">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2245342">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2245346">if</span>&nbsp;<span class="ident" id="2245349">m</span>&nbsp;<span class="op" id="2245351">&lt;</span>&nbsp;<span class="num" id="2245353">0</span>&nbsp;<span class="op" id="2245355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2245360">m</span>&nbsp;<span class="op" id="2245362">=</span>&nbsp;<span class="ident" id="2245364">re</span><span class="op" id="2245366">.</span><span class="ident" id="2245367">Min</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2245373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2245377">if</span>&nbsp;<span class="ident" id="2245380">m</span>&nbsp;<span class="op" id="2245382">&gt;</span>&nbsp;<span class="ident" id="2245384">n</span>&nbsp;<span class="op" id="2245386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2245391">return</span>&nbsp;<span class="builtintype" id="2245398">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2245406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2245410">if</span>&nbsp;<span class="ident" id="2245413">m</span>&nbsp;<span class="op" id="2245415">&gt;</span>&nbsp;<span class="num" id="2245417">0</span>&nbsp;<span class="op" id="2245419">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2245424">n</span>&nbsp;<span class="op" id="2245426">/=</span>&nbsp;<span class="ident" id="2245429">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2245433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2245436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2245439">for</span>&nbsp;<span class="ident" id="2245443">_</span><span class="op" id="2245444">,</span>&nbsp;<span class="ident" id="2245446">sub</span>&nbsp;<span class="op" id="2245450">:=</span>&nbsp;<span class="keyword" id="2245453">range</span>&nbsp;<span class="ident" id="2245459">re</span><span class="op" id="2245461">.</span><span class="ident" id="2245462">Sub</span>&nbsp;<span class="op" id="2245466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2245470">if</span>&nbsp;<span class="op" id="2245473">!</span><span class="ident" id="2245474">repeatIsValid</span><span class="op" id="2245487">(</span><span class="ident" id="2245488">sub</span><span class="op" id="2245491">,</span>&nbsp;<span class="ident" id="2245493">n</span><span class="op" id="2245494">)</span>&nbsp;<span class="op" id="2245496">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2245501">return</span>&nbsp;<span class="builtintype" id="2245508">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2245516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2245519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2245522">return</span>&nbsp;<span class="builtintype" id="2245529">true</span><br>
<span class="lineno"></span><span class="op" id="2245534">}</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span><span class="comment" id="2245537">//&nbsp;concat&nbsp;replaces&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;(above&nbsp;the&nbsp;topmost&nbsp;&#39;|&#39;&nbsp;or&nbsp;&#39;(&#39;)&nbsp;with&nbsp;its&nbsp;concatenation.</span><br>
<span class="lineno"></span><span class="keyword" id="2245632">func</span>&nbsp;<span class="op" id="2245637">(</span><span class="ident" id="2245638">p</span>&nbsp;<span class="op" id="2245640">*</span><span class="ident" id="2245641">parser</span><span class="op" id="2245647">)</span>&nbsp;<span class="ident" id="2245649">concat</span><span class="op" id="2245655">(</span><span class="op" id="2245656">)</span>&nbsp;<span class="op" id="2245658">*</span><span class="ident" id="2245659">Regexp</span>&nbsp;<span class="op" id="2245666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2245669">p</span><span class="op" id="2245670">.</span><span class="ident" id="2245671">maybeConcat</span><span class="op" id="2245682">(</span><span class="op" id="2245683">-</span><span class="num" id="2245684">1</span><span class="op" id="2245685">,</span>&nbsp;<span class="num" id="2245687">0</span><span class="op" id="2245688">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2245692">//&nbsp;Scan&nbsp;down&nbsp;to&nbsp;find&nbsp;pseudo-operator&nbsp;|&nbsp;or&nbsp;(.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2245738">i</span>&nbsp;<span class="op" id="2245740">:=</span>&nbsp;<span class="builtinfunc" id="2245743">len</span><span class="op" id="2245746">(</span><span class="ident" id="2245747">p</span><span class="op" id="2245748">.</span><span class="ident" id="2245749">stack</span><span class="op" id="2245754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2245757">for</span>&nbsp;<span class="ident" id="2245761">i</span>&nbsp;<span class="op" id="2245763">&gt;</span>&nbsp;<span class="num" id="2245765">0</span>&nbsp;<span class="op" id="2245767">&amp;&amp;</span>&nbsp;<span class="ident" id="2245770">p</span><span class="op" id="2245771">.</span><span class="ident" id="2245772">stack</span><span class="op" id="2245777">[</span><span class="ident" id="2245778">i</span><span class="op" id="2245779">-</span><span class="num" id="2245780">1</span><span class="op" id="2245781">]</span><span class="op" id="2245782">.</span><span class="ident" id="2245783">Op</span>&nbsp;<span class="op" id="2245786">&lt;</span>&nbsp;<span class="ident" id="2245788">opPseudo</span>&nbsp;<span class="op" id="2245797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2245801">i</span><span class="op" id="2245802">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2245806">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2245809">subs</span>&nbsp;<span class="op" id="2245814">:=</span>&nbsp;<span class="ident" id="2245817">p</span><span class="op" id="2245818">.</span><span class="ident" id="2245819">stack</span><span class="op" id="2245824">[</span><span class="ident" id="2245825">i</span><span class="op" id="2245826">:</span><span class="op" id="2245827">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2245830">p</span><span class="op" id="2245831">.</span><span class="ident" id="2245832">stack</span>&nbsp;<span class="op" id="2245838">=</span>&nbsp;<span class="ident" id="2245840">p</span><span class="op" id="2245841">.</span><span class="ident" id="2245842">stack</span><span class="op" id="2245847">[</span><span class="op" id="2245848">:</span><span class="ident" id="2245849">i</span><span class="op" id="2245850">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2245854">//&nbsp;Empty&nbsp;concatenation&nbsp;is&nbsp;special&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2245895">if</span>&nbsp;<span class="builtinfunc" id="2245898">len</span><span class="op" id="2245901">(</span><span class="ident" id="2245902">subs</span><span class="op" id="2245906">)</span>&nbsp;<span class="op" id="2245908">==</span>&nbsp;<span class="num" id="2245911">0</span>&nbsp;<span class="op" id="2245913">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2245917">return</span>&nbsp;<span class="ident" id="2245924">p</span><span class="op" id="2245925">.</span><span class="ident" id="2245926">push</span><span class="op" id="2245930">(</span><span class="ident" id="2245931">p</span><span class="op" id="2245932">.</span><span class="ident" id="2245933">newRegexp</span><span class="op" id="2245942">(</span><span class="ident" id="2245943">OpEmptyMatch</span><span class="op" id="2245955">)</span><span class="op" id="2245956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2245959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2245963">return</span>&nbsp;<span class="ident" id="2245970">p</span><span class="op" id="2245971">.</span><span class="ident" id="2245972">push</span><span class="op" id="2245976">(</span><span class="ident" id="2245977">p</span><span class="op" id="2245978">.</span><span class="ident" id="2245979">collapse</span><span class="op" id="2245987">(</span><span class="ident" id="2245988">subs</span><span class="op" id="2245992">,</span>&nbsp;<span class="ident" id="2245994">OpConcat</span><span class="op" id="2246002">)</span><span class="op" id="2246003">)</span><br>
<span class="lineno"></span><span class="op" id="2246005">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="comment" id="2246008">//&nbsp;alternate&nbsp;replaces&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;(above&nbsp;the&nbsp;topmost&nbsp;&#39;(&#39;)&nbsp;with&nbsp;its&nbsp;alternation.</span><br>
<span class="lineno"></span><span class="keyword" id="2246097">func</span>&nbsp;<span class="op" id="2246102">(</span><span class="ident" id="2246103">p</span>&nbsp;<span class="op" id="2246105">*</span><span class="ident" id="2246106">parser</span><span class="op" id="2246112">)</span>&nbsp;<span class="ident" id="2246114">alternate</span><span class="op" id="2246123">(</span><span class="op" id="2246124">)</span>&nbsp;<span class="op" id="2246126">*</span><span class="ident" id="2246127">Regexp</span>&nbsp;<span class="op" id="2246134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2246137">//&nbsp;Scan&nbsp;down&nbsp;to&nbsp;find&nbsp;pseudo-operator&nbsp;(.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2246178">//&nbsp;There&nbsp;are&nbsp;no&nbsp;|&nbsp;above&nbsp;(.</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2246206">i</span>&nbsp;<span class="op" id="2246208">:=</span>&nbsp;<span class="builtinfunc" id="2246211">len</span><span class="op" id="2246214">(</span><span class="ident" id="2246215">p</span><span class="op" id="2246216">.</span><span class="ident" id="2246217">stack</span><span class="op" id="2246222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2246225">for</span>&nbsp;<span class="ident" id="2246229">i</span>&nbsp;<span class="op" id="2246231">&gt;</span>&nbsp;<span class="num" id="2246233">0</span>&nbsp;<span class="op" id="2246235">&amp;&amp;</span>&nbsp;<span class="ident" id="2246238">p</span><span class="op" id="2246239">.</span><span class="ident" id="2246240">stack</span><span class="op" id="2246245">[</span><span class="ident" id="2246246">i</span><span class="op" id="2246247">-</span><span class="num" id="2246248">1</span><span class="op" id="2246249">]</span><span class="op" id="2246250">.</span><span class="ident" id="2246251">Op</span>&nbsp;<span class="op" id="2246254">&lt;</span>&nbsp;<span class="ident" id="2246256">opPseudo</span>&nbsp;<span class="op" id="2246265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2246269">i</span><span class="op" id="2246270">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2246274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2246277">subs</span>&nbsp;<span class="op" id="2246282">:=</span>&nbsp;<span class="ident" id="2246285">p</span><span class="op" id="2246286">.</span><span class="ident" id="2246287">stack</span><span class="op" id="2246292">[</span><span class="ident" id="2246293">i</span><span class="op" id="2246294">:</span><span class="op" id="2246295">]</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2246298">p</span><span class="op" id="2246299">.</span><span class="ident" id="2246300">stack</span>&nbsp;<span class="op" id="2246306">=</span>&nbsp;<span class="ident" id="2246308">p</span><span class="op" id="2246309">.</span><span class="ident" id="2246310">stack</span><span class="op" id="2246315">[</span><span class="op" id="2246316">:</span><span class="ident" id="2246317">i</span><span class="op" id="2246318">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2246322">//&nbsp;Make&nbsp;sure&nbsp;top&nbsp;class&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2246356">//&nbsp;All&nbsp;the&nbsp;others&nbsp;already&nbsp;are&nbsp;(see&nbsp;swapVerticalBar).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2246410">if</span>&nbsp;<span class="builtinfunc" id="2246413">len</span><span class="op" id="2246416">(</span><span class="ident" id="2246417">subs</span><span class="op" id="2246421">)</span>&nbsp;<span class="op" id="2246423">&gt;</span>&nbsp;<span class="num" id="2246425">0</span>&nbsp;<span class="op" id="2246427">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2246431">cleanAlt</span><span class="op" id="2246439">(</span><span class="ident" id="2246440">subs</span><span class="op" id="2246444">[</span><span class="builtinfunc" id="2246445">len</span><span class="op" id="2246448">(</span><span class="ident" id="2246449">subs</span><span class="op" id="2246453">)</span><span class="op" id="2246454">-</span><span class="num" id="2246455">1</span><span class="op" id="2246456">]</span><span class="op" id="2246457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2246460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2246464">//&nbsp;Empty&nbsp;alternate&nbsp;is&nbsp;special&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2246500">//&nbsp;(shouldn&#39;t&nbsp;happen&nbsp;but&nbsp;easy&nbsp;to&nbsp;handle).</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2246543">if</span>&nbsp;<span class="builtinfunc" id="2246546">len</span><span class="op" id="2246549">(</span><span class="ident" id="2246550">subs</span><span class="op" id="2246554">)</span>&nbsp;<span class="op" id="2246556">==</span>&nbsp;<span class="num" id="2246559">0</span>&nbsp;<span class="op" id="2246561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2246565">return</span>&nbsp;<span class="ident" id="2246572">p</span><span class="op" id="2246573">.</span><span class="ident" id="2246574">push</span><span class="op" id="2246578">(</span><span class="ident" id="2246579">p</span><span class="op" id="2246580">.</span><span class="ident" id="2246581">newRegexp</span><span class="op" id="2246590">(</span><span class="ident" id="2246591">OpNoMatch</span><span class="op" id="2246600">)</span><span class="op" id="2246601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2246604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2246608">return</span>&nbsp;<span class="ident" id="2246615">p</span><span class="op" id="2246616">.</span><span class="ident" id="2246617">push</span><span class="op" id="2246621">(</span><span class="ident" id="2246622">p</span><span class="op" id="2246623">.</span><span class="ident" id="2246624">collapse</span><span class="op" id="2246632">(</span><span class="ident" id="2246633">subs</span><span class="op" id="2246637">,</span>&nbsp;<span class="ident" id="2246639">OpAlternate</span><span class="op" id="2246650">)</span><span class="op" id="2246651">)</span><br>
<span class="lineno">340</span><span class="op" id="2246653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2246656">//&nbsp;cleanAlt&nbsp;cleans&nbsp;re&nbsp;for&nbsp;eventual&nbsp;inclusion&nbsp;in&nbsp;an&nbsp;alternation.</span><br>
<span class="lineno"></span><span class="keyword" id="2246720">func</span>&nbsp;<span class="ident" id="2246725">cleanAlt</span><span class="op" id="2246733">(</span><span class="ident" id="2246734">re</span>&nbsp;<span class="op" id="2246737">*</span><span class="ident" id="2246738">Regexp</span><span class="op" id="2246744">)</span>&nbsp;<span class="op" id="2246746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2246749">switch</span>&nbsp;<span class="ident" id="2246756">re</span><span class="op" id="2246758">.</span><span class="ident" id="2246759">Op</span>&nbsp;<span class="op" id="2246762">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2246765">case</span>&nbsp;<span class="ident" id="2246770">OpCharClass</span><span class="op" id="2246781">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2246785">re</span><span class="op" id="2246787">.</span><span class="ident" id="2246788">Rune</span>&nbsp;<span class="op" id="2246793">=</span>&nbsp;<span class="ident" id="2246795">cleanClass</span><span class="op" id="2246805">(</span><span class="op" id="2246806">&amp;</span><span class="ident" id="2246807">re</span><span class="op" id="2246809">.</span><span class="ident" id="2246810">Rune</span><span class="op" id="2246814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2246818">if</span>&nbsp;<span class="builtinfunc" id="2246821">len</span><span class="op" id="2246824">(</span><span class="ident" id="2246825">re</span><span class="op" id="2246827">.</span><span class="ident" id="2246828">Rune</span><span class="op" id="2246832">)</span>&nbsp;<span class="op" id="2246834">==</span>&nbsp;<span class="num" id="2246837">2</span>&nbsp;<span class="op" id="2246839">&amp;&amp;</span>&nbsp;<span class="ident" id="2246842">re</span><span class="op" id="2246844">.</span><span class="ident" id="2246845">Rune</span><span class="op" id="2246849">[</span><span class="num" id="2246850">0</span><span class="op" id="2246851">]</span>&nbsp;<span class="op" id="2246853">==</span>&nbsp;<span class="num" id="2246856">0</span>&nbsp;<span class="op" id="2246858">&amp;&amp;</span>&nbsp;<span class="ident" id="2246861">re</span><span class="op" id="2246863">.</span><span class="ident" id="2246864">Rune</span><span class="op" id="2246868">[</span><span class="num" id="2246869">1</span><span class="op" id="2246870">]</span>&nbsp;<span class="op" id="2246872">==</span>&nbsp;<span class="ident" id="2246875">unicode</span><span class="op" id="2246882">.</span><span class="ident" id="2246883">MaxRune</span>&nbsp;<span class="op" id="2246891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2246896">re</span><span class="op" id="2246898">.</span><span class="ident" id="2246899">Rune</span>&nbsp;<span class="op" id="2246904">=</span>&nbsp;<span class="ident" id="2246906">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2246913">re</span><span class="op" id="2246915">.</span><span class="ident" id="2246916">Op</span>&nbsp;<span class="op" id="2246919">=</span>&nbsp;<span class="ident" id="2246921">OpAnyChar</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2246934">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2246943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2246947">if</span>&nbsp;<span class="builtinfunc" id="2246950">len</span><span class="op" id="2246953">(</span><span class="ident" id="2246954">re</span><span class="op" id="2246956">.</span><span class="ident" id="2246957">Rune</span><span class="op" id="2246961">)</span>&nbsp;<span class="op" id="2246963">==</span>&nbsp;<span class="num" id="2246966">4</span>&nbsp;<span class="op" id="2246968">&amp;&amp;</span>&nbsp;<span class="ident" id="2246971">re</span><span class="op" id="2246973">.</span><span class="ident" id="2246974">Rune</span><span class="op" id="2246978">[</span><span class="num" id="2246979">0</span><span class="op" id="2246980">]</span>&nbsp;<span class="op" id="2246982">==</span>&nbsp;<span class="num" id="2246985">0</span>&nbsp;<span class="op" id="2246987">&amp;&amp;</span>&nbsp;<span class="ident" id="2246990">re</span><span class="op" id="2246992">.</span><span class="ident" id="2246993">Rune</span><span class="op" id="2246997">[</span><span class="num" id="2246998">1</span><span class="op" id="2246999">]</span>&nbsp;<span class="op" id="2247001">==</span>&nbsp;<span class="string" id="2247004">&#39;\n&#39;</span><span class="op" id="2247008">-</span><span class="num" id="2247009">1</span>&nbsp;<span class="op" id="2247011">&amp;&amp;</span>&nbsp;<span class="ident" id="2247014">re</span><span class="op" id="2247016">.</span><span class="ident" id="2247017">Rune</span><span class="op" id="2247021">[</span><span class="num" id="2247022">2</span><span class="op" id="2247023">]</span>&nbsp;<span class="op" id="2247025">==</span>&nbsp;<span class="string" id="2247028">&#39;\n&#39;</span><span class="op" id="2247032">+</span><span class="num" id="2247033">1</span>&nbsp;<span class="op" id="2247035">&amp;&amp;</span>&nbsp;<span class="ident" id="2247038">re</span><span class="op" id="2247040">.</span><span class="ident" id="2247041">Rune</span><span class="op" id="2247045">[</span><span class="num" id="2247046">3</span><span class="op" id="2247047">]</span>&nbsp;<span class="op" id="2247049">==</span>&nbsp;<span class="ident" id="2247052">unicode</span><span class="op" id="2247059">.</span><span class="ident" id="2247060">MaxRune</span>&nbsp;<span class="op" id="2247068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2247073">re</span><span class="op" id="2247075">.</span><span class="ident" id="2247076">Rune</span>&nbsp;<span class="op" id="2247081">=</span>&nbsp;<span class="ident" id="2247083">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2247090">re</span><span class="op" id="2247092">.</span><span class="ident" id="2247093">Op</span>&nbsp;<span class="op" id="2247096">=</span>&nbsp;<span class="ident" id="2247098">OpAnyCharNotNL</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2247116">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2247125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2247129">if</span>&nbsp;<span class="builtinfunc" id="2247132">cap</span><span class="op" id="2247135">(</span><span class="ident" id="2247136">re</span><span class="op" id="2247138">.</span><span class="ident" id="2247139">Rune</span><span class="op" id="2247143">)</span><span class="op" id="2247144">-</span><span class="builtinfunc" id="2247145">len</span><span class="op" id="2247148">(</span><span class="ident" id="2247149">re</span><span class="op" id="2247151">.</span><span class="ident" id="2247152">Rune</span><span class="op" id="2247156">)</span>&nbsp;<span class="op" id="2247158">&gt;</span>&nbsp;<span class="num" id="2247160">100</span>&nbsp;<span class="op" id="2247164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2247169">//&nbsp;re.Rune&nbsp;will&nbsp;not&nbsp;grow&nbsp;any&nbsp;more.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2247207">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;or&nbsp;inline&nbsp;to&nbsp;reclaim&nbsp;storage.</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2247255">re</span><span class="op" id="2247257">.</span><span class="ident" id="2247258">Rune</span>&nbsp;<span class="op" id="2247263">=</span>&nbsp;<span class="builtinfunc" id="2247265">append</span><span class="op" id="2247271">(</span><span class="ident" id="2247272">re</span><span class="op" id="2247274">.</span><span class="ident" id="2247275">Rune0</span><span class="op" id="2247280">[</span><span class="op" id="2247281">:</span><span class="num" id="2247282">0</span><span class="op" id="2247283">]</span><span class="op" id="2247284">,</span>&nbsp;<span class="ident" id="2247286">re</span><span class="op" id="2247288">.</span><span class="ident" id="2247289">Rune</span><span class="op" id="2247293">...</span><span class="op" id="2247296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2247300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2247303">}</span><br>
<span class="lineno"></span><span class="op" id="2247305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="2247308">//&nbsp;collapse&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;applying&nbsp;op&nbsp;to&nbsp;sub.</span><br>
<span class="lineno"></span><span class="comment" id="2247362">//&nbsp;If&nbsp;sub&nbsp;contains&nbsp;op&nbsp;nodes,&nbsp;they&nbsp;all&nbsp;get&nbsp;hoisted&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="2247415">//&nbsp;so&nbsp;that&nbsp;there&nbsp;is&nbsp;never&nbsp;a&nbsp;concat&nbsp;of&nbsp;a&nbsp;concat&nbsp;or&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2247468">//&nbsp;alternate&nbsp;of&nbsp;an&nbsp;alternate.</span><br>
<span class="lineno"></span><span class="keyword" id="2247498">func</span>&nbsp;<span class="op" id="2247503">(</span><span class="ident" id="2247504">p</span>&nbsp;<span class="op" id="2247506">*</span><span class="ident" id="2247507">parser</span><span class="op" id="2247513">)</span>&nbsp;<span class="ident" id="2247515">collapse</span><span class="op" id="2247523">(</span><span class="ident" id="2247524">subs</span>&nbsp;<span class="op" id="2247529">[</span><span class="op" id="2247530">]</span><span class="op" id="2247531">*</span><span class="ident" id="2247532">Regexp</span><span class="op" id="2247538">,</span>&nbsp;<span class="ident" id="2247540">op</span>&nbsp;<span class="ident" id="2247543">Op</span><span class="op" id="2247545">)</span>&nbsp;<span class="op" id="2247547">*</span><span class="ident" id="2247548">Regexp</span>&nbsp;<span class="op" id="2247555">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2247558">if</span>&nbsp;<span class="builtinfunc" id="2247561">len</span><span class="op" id="2247564">(</span><span class="ident" id="2247565">subs</span><span class="op" id="2247569">)</span>&nbsp;<span class="op" id="2247571">==</span>&nbsp;<span class="num" id="2247574">1</span>&nbsp;<span class="op" id="2247576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2247580">return</span>&nbsp;<span class="ident" id="2247587">subs</span><span class="op" id="2247591">[</span><span class="num" id="2247592">0</span><span class="op" id="2247593">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2247596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2247599">re</span>&nbsp;<span class="op" id="2247602">:=</span>&nbsp;<span class="ident" id="2247605">p</span><span class="op" id="2247606">.</span><span class="ident" id="2247607">newRegexp</span><span class="op" id="2247616">(</span><span class="ident" id="2247617">op</span><span class="op" id="2247619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2247622">re</span><span class="op" id="2247624">.</span><span class="ident" id="2247625">Sub</span>&nbsp;<span class="op" id="2247629">=</span>&nbsp;<span class="ident" id="2247631">re</span><span class="op" id="2247633">.</span><span class="ident" id="2247634">Sub0</span><span class="op" id="2247638">[</span><span class="op" id="2247639">:</span><span class="num" id="2247640">0</span><span class="op" id="2247641">]</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2247644">for</span>&nbsp;<span class="ident" id="2247648">_</span><span class="op" id="2247649">,</span>&nbsp;<span class="ident" id="2247651">sub</span>&nbsp;<span class="op" id="2247655">:=</span>&nbsp;<span class="keyword" id="2247658">range</span>&nbsp;<span class="ident" id="2247664">subs</span>&nbsp;<span class="op" id="2247669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2247673">if</span>&nbsp;<span class="ident" id="2247676">sub</span><span class="op" id="2247679">.</span><span class="ident" id="2247680">Op</span>&nbsp;<span class="op" id="2247683">==</span>&nbsp;<span class="ident" id="2247686">op</span>&nbsp;<span class="op" id="2247689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2247694">re</span><span class="op" id="2247696">.</span><span class="ident" id="2247697">Sub</span>&nbsp;<span class="op" id="2247701">=</span>&nbsp;<span class="builtinfunc" id="2247703">append</span><span class="op" id="2247709">(</span><span class="ident" id="2247710">re</span><span class="op" id="2247712">.</span><span class="ident" id="2247713">Sub</span><span class="op" id="2247716">,</span>&nbsp;<span class="ident" id="2247718">sub</span><span class="op" id="2247721">.</span><span class="ident" id="2247722">Sub</span><span class="op" id="2247725">...</span><span class="op" id="2247728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2247733">p</span><span class="op" id="2247734">.</span><span class="ident" id="2247735">reuse</span><span class="op" id="2247740">(</span><span class="ident" id="2247741">sub</span><span class="op" id="2247744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2247748">}</span>&nbsp;<span class="keyword" id="2247750">else</span>&nbsp;<span class="op" id="2247755">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2247760">re</span><span class="op" id="2247762">.</span><span class="ident" id="2247763">Sub</span>&nbsp;<span class="op" id="2247767">=</span>&nbsp;<span class="builtinfunc" id="2247769">append</span><span class="op" id="2247775">(</span><span class="ident" id="2247776">re</span><span class="op" id="2247778">.</span><span class="ident" id="2247779">Sub</span><span class="op" id="2247782">,</span>&nbsp;<span class="ident" id="2247784">sub</span><span class="op" id="2247787">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2247791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2247794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2247797">if</span>&nbsp;<span class="ident" id="2247800">op</span>&nbsp;<span class="op" id="2247803">==</span>&nbsp;<span class="ident" id="2247806">OpAlternate</span>&nbsp;<span class="op" id="2247818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2247822">re</span><span class="op" id="2247824">.</span><span class="ident" id="2247825">Sub</span>&nbsp;<span class="op" id="2247829">=</span>&nbsp;<span class="ident" id="2247831">p</span><span class="op" id="2247832">.</span><span class="ident" id="2247833">factor</span><span class="op" id="2247839">(</span><span class="ident" id="2247840">re</span><span class="op" id="2247842">.</span><span class="ident" id="2247843">Sub</span><span class="op" id="2247846">,</span>&nbsp;<span class="ident" id="2247848">re</span><span class="op" id="2247850">.</span><span class="ident" id="2247851">Flags</span><span class="op" id="2247856">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2247860">if</span>&nbsp;<span class="builtinfunc" id="2247863">len</span><span class="op" id="2247866">(</span><span class="ident" id="2247867">re</span><span class="op" id="2247869">.</span><span class="ident" id="2247870">Sub</span><span class="op" id="2247873">)</span>&nbsp;<span class="op" id="2247875">==</span>&nbsp;<span class="num" id="2247878">1</span>&nbsp;<span class="op" id="2247880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2247885">old</span>&nbsp;<span class="op" id="2247889">:=</span>&nbsp;<span class="ident" id="2247892">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2247898">re</span>&nbsp;<span class="op" id="2247901">=</span>&nbsp;<span class="ident" id="2247903">re</span><span class="op" id="2247905">.</span><span class="ident" id="2247906">Sub</span><span class="op" id="2247909">[</span><span class="num" id="2247910">0</span><span class="op" id="2247911">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2247916">p</span><span class="op" id="2247917">.</span><span class="ident" id="2247918">reuse</span><span class="op" id="2247923">(</span><span class="ident" id="2247924">old</span><span class="op" id="2247927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2247931">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2247934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2247937">return</span>&nbsp;<span class="ident" id="2247944">re</span><br>
<span class="lineno"></span><span class="op" id="2247947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2247950">//&nbsp;factor&nbsp;factors&nbsp;common&nbsp;prefixes&nbsp;from&nbsp;the&nbsp;alternation&nbsp;list&nbsp;sub.</span><br>
<span class="lineno">395</span><span class="comment" id="2248015">//&nbsp;It&nbsp;returns&nbsp;a&nbsp;replacement&nbsp;list&nbsp;that&nbsp;reuses&nbsp;the&nbsp;same&nbsp;storage&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2248081">//&nbsp;frees&nbsp;(passes&nbsp;to&nbsp;p.reuse)&nbsp;any&nbsp;removed&nbsp;*Regexps.</span><br>
<span class="lineno"></span><span class="comment" id="2248132">//</span><br>
<span class="lineno"></span><span class="comment" id="2248135">//&nbsp;For&nbsp;example,</span><br>
<span class="lineno"></span><span class="comment" id="2248151">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ABC|ABD|AEF|BCX|BCY</span><br>
<span class="lineno">400</span><span class="comment" id="2248178">//&nbsp;simplifies&nbsp;by&nbsp;literal&nbsp;prefix&nbsp;extraction&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2248224">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A(B(C|D)|EF)|BC(X|Y)</span><br>
<span class="lineno"></span><span class="comment" id="2248252">//&nbsp;which&nbsp;simplifies&nbsp;by&nbsp;character&nbsp;class&nbsp;introduction&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2248307">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A(B[CD]|EF)|BC[XY]</span><br>
<span class="lineno"></span><span class="comment" id="2248333">//</span><br>
<span class="lineno">405</span><span class="keyword" id="2248336">func</span>&nbsp;<span class="op" id="2248341">(</span><span class="ident" id="2248342">p</span>&nbsp;<span class="op" id="2248344">*</span><span class="ident" id="2248345">parser</span><span class="op" id="2248351">)</span>&nbsp;<span class="ident" id="2248353">factor</span><span class="op" id="2248359">(</span><span class="ident" id="2248360">sub</span>&nbsp;<span class="op" id="2248364">[</span><span class="op" id="2248365">]</span><span class="op" id="2248366">*</span><span class="ident" id="2248367">Regexp</span><span class="op" id="2248373">,</span>&nbsp;<span class="ident" id="2248375">flags</span>&nbsp;<span class="ident" id="2248381">Flags</span><span class="op" id="2248386">)</span>&nbsp;<span class="op" id="2248388">[</span><span class="op" id="2248389">]</span><span class="op" id="2248390">*</span><span class="ident" id="2248391">Regexp</span>&nbsp;<span class="op" id="2248398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2248401">if</span>&nbsp;<span class="builtinfunc" id="2248404">len</span><span class="op" id="2248407">(</span><span class="ident" id="2248408">sub</span><span class="op" id="2248411">)</span>&nbsp;<span class="op" id="2248413">&lt;</span>&nbsp;<span class="num" id="2248415">2</span>&nbsp;<span class="op" id="2248417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2248421">return</span>&nbsp;<span class="ident" id="2248428">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2248433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2248437">//&nbsp;Round&nbsp;1:&nbsp;Factor&nbsp;out&nbsp;common&nbsp;literal&nbsp;prefixes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2248486">var</span>&nbsp;<span class="ident" id="2248490">str</span>&nbsp;<span class="op" id="2248494">[</span><span class="op" id="2248495">]</span><span class="builtintype" id="2248496">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2248502">var</span>&nbsp;<span class="ident" id="2248506">strflags</span>&nbsp;<span class="ident" id="2248515">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2248522">start</span>&nbsp;<span class="op" id="2248528">:=</span>&nbsp;<span class="num" id="2248531">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2248534">out</span>&nbsp;<span class="op" id="2248538">:=</span>&nbsp;<span class="ident" id="2248541">sub</span><span class="op" id="2248544">[</span><span class="op" id="2248545">:</span><span class="num" id="2248546">0</span><span class="op" id="2248547">]</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2248550">for</span>&nbsp;<span class="ident" id="2248554">i</span>&nbsp;<span class="op" id="2248556">:=</span>&nbsp;<span class="num" id="2248559">0</span><span class="op" id="2248560">;</span>&nbsp;<span class="ident" id="2248562">i</span>&nbsp;<span class="op" id="2248564">&lt;=</span>&nbsp;<span class="builtinfunc" id="2248567">len</span><span class="op" id="2248570">(</span><span class="ident" id="2248571">sub</span><span class="op" id="2248574">)</span><span class="op" id="2248575">;</span>&nbsp;<span class="ident" id="2248577">i</span><span class="op" id="2248578">++</span>&nbsp;<span class="op" id="2248581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2248585">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2248649">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2248716">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2248750">//</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2248755">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;all&nbsp;begin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2248819">//&nbsp;with&nbsp;str&nbsp;as&nbsp;modified&nbsp;by&nbsp;strflags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2248858">var</span>&nbsp;<span class="ident" id="2248862">istr</span>&nbsp;<span class="op" id="2248867">[</span><span class="op" id="2248868">]</span><span class="builtintype" id="2248869">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2248876">var</span>&nbsp;<span class="ident" id="2248880">iflags</span>&nbsp;<span class="ident" id="2248887">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2248895">if</span>&nbsp;<span class="ident" id="2248898">i</span>&nbsp;<span class="op" id="2248900">&lt;</span>&nbsp;<span class="builtinfunc" id="2248902">len</span><span class="op" id="2248905">(</span><span class="ident" id="2248906">sub</span><span class="op" id="2248909">)</span>&nbsp;<span class="op" id="2248911">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2248916">istr</span><span class="op" id="2248920">,</span>&nbsp;<span class="ident" id="2248922">iflags</span>&nbsp;<span class="op" id="2248929">=</span>&nbsp;<span class="ident" id="2248931">p</span><span class="op" id="2248932">.</span><span class="ident" id="2248933">leadingString</span><span class="op" id="2248946">(</span><span class="ident" id="2248947">sub</span><span class="op" id="2248950">[</span><span class="ident" id="2248951">i</span><span class="op" id="2248952">]</span><span class="op" id="2248953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2248958">if</span>&nbsp;<span class="ident" id="2248961">iflags</span>&nbsp;<span class="op" id="2248968">==</span>&nbsp;<span class="ident" id="2248971">strflags</span>&nbsp;<span class="op" id="2248980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2248986">same</span>&nbsp;<span class="op" id="2248991">:=</span>&nbsp;<span class="num" id="2248994">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2249000">for</span>&nbsp;<span class="ident" id="2249004">same</span>&nbsp;<span class="op" id="2249009">&lt;</span>&nbsp;<span class="builtinfunc" id="2249011">len</span><span class="op" id="2249014">(</span><span class="ident" id="2249015">str</span><span class="op" id="2249018">)</span>&nbsp;<span class="op" id="2249020">&amp;&amp;</span>&nbsp;<span class="ident" id="2249023">same</span>&nbsp;<span class="op" id="2249028">&lt;</span>&nbsp;<span class="builtinfunc" id="2249030">len</span><span class="op" id="2249033">(</span><span class="ident" id="2249034">istr</span><span class="op" id="2249038">)</span>&nbsp;<span class="op" id="2249040">&amp;&amp;</span>&nbsp;<span class="ident" id="2249043">str</span><span class="op" id="2249046">[</span><span class="ident" id="2249047">same</span><span class="op" id="2249051">]</span>&nbsp;<span class="op" id="2249053">==</span>&nbsp;<span class="ident" id="2249056">istr</span><span class="op" id="2249060">[</span><span class="ident" id="2249061">same</span><span class="op" id="2249065">]</span>&nbsp;<span class="op" id="2249067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2249074">same</span><span class="op" id="2249078">++</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2249085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2249091">if</span>&nbsp;<span class="ident" id="2249094">same</span>&nbsp;<span class="op" id="2249099">&gt;</span>&nbsp;<span class="num" id="2249101">0</span>&nbsp;<span class="op" id="2249103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2249110">//&nbsp;Matches&nbsp;at&nbsp;least&nbsp;one&nbsp;rune&nbsp;in&nbsp;current&nbsp;range.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2249162">//&nbsp;Keep&nbsp;going&nbsp;around.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2249189">str</span>&nbsp;<span class="op" id="2249193">=</span>&nbsp;<span class="ident" id="2249195">str</span><span class="op" id="2249198">[</span><span class="op" id="2249199">:</span><span class="ident" id="2249200">same</span><span class="op" id="2249204">]</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2249211">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2249224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2249229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2249233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2249238">//&nbsp;Found&nbsp;end&nbsp;of&nbsp;a&nbsp;run&nbsp;with&nbsp;common&nbsp;leading&nbsp;literal&nbsp;string:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2249298">//&nbsp;sub[start:i]&nbsp;all&nbsp;begin&nbsp;with&nbsp;str[0:len(str)],&nbsp;but&nbsp;sub[i]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2249359">//&nbsp;does&nbsp;not&nbsp;even&nbsp;begin&nbsp;with&nbsp;str[0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2249397">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2249402">//&nbsp;Factor&nbsp;out&nbsp;common&nbsp;string&nbsp;and&nbsp;append&nbsp;factored&nbsp;expression&nbsp;to&nbsp;out.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2249471">if</span>&nbsp;<span class="ident" id="2249474">i</span>&nbsp;<span class="op" id="2249476">==</span>&nbsp;<span class="ident" id="2249479">start</span>&nbsp;<span class="op" id="2249485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2249490">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2249528">}</span>&nbsp;<span class="keyword" id="2249530">else</span>&nbsp;<span class="keyword" id="2249535">if</span>&nbsp;<span class="ident" id="2249538">i</span>&nbsp;<span class="op" id="2249540">==</span>&nbsp;<span class="ident" id="2249543">start</span><span class="op" id="2249548">+</span><span class="num" id="2249549">1</span>&nbsp;<span class="op" id="2249551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2249556">//&nbsp;Just&nbsp;one:&nbsp;don&#39;t&nbsp;bother&nbsp;factoring.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2249596">out</span>&nbsp;<span class="op" id="2249600">=</span>&nbsp;<span class="builtinfunc" id="2249602">append</span><span class="op" id="2249608">(</span><span class="ident" id="2249609">out</span><span class="op" id="2249612">,</span>&nbsp;<span class="ident" id="2249614">sub</span><span class="op" id="2249617">[</span><span class="ident" id="2249618">start</span><span class="op" id="2249623">]</span><span class="op" id="2249624">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2249628">}</span>&nbsp;<span class="keyword" id="2249630">else</span>&nbsp;<span class="op" id="2249635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2249640">//&nbsp;Construct&nbsp;factored&nbsp;form:&nbsp;prefix(suffix1|suffix2|...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2249699">prefix</span>&nbsp;<span class="op" id="2249706">:=</span>&nbsp;<span class="ident" id="2249709">p</span><span class="op" id="2249710">.</span><span class="ident" id="2249711">newRegexp</span><span class="op" id="2249720">(</span><span class="ident" id="2249721">OpLiteral</span><span class="op" id="2249730">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2249735">prefix</span><span class="op" id="2249741">.</span><span class="ident" id="2249742">Flags</span>&nbsp;<span class="op" id="2249748">=</span>&nbsp;<span class="ident" id="2249750">strflags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2249762">prefix</span><span class="op" id="2249768">.</span><span class="ident" id="2249769">Rune</span>&nbsp;<span class="op" id="2249774">=</span>&nbsp;<span class="builtinfunc" id="2249776">append</span><span class="op" id="2249782">(</span><span class="ident" id="2249783">prefix</span><span class="op" id="2249789">.</span><span class="ident" id="2249790">Rune</span><span class="op" id="2249794">[</span><span class="op" id="2249795">:</span><span class="num" id="2249796">0</span><span class="op" id="2249797">]</span><span class="op" id="2249798">,</span>&nbsp;<span class="ident" id="2249800">str</span><span class="op" id="2249803">...</span><span class="op" id="2249806">)</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2249812">for</span>&nbsp;<span class="ident" id="2249816">j</span>&nbsp;<span class="op" id="2249818">:=</span>&nbsp;<span class="ident" id="2249821">start</span><span class="op" id="2249826">;</span>&nbsp;<span class="ident" id="2249828">j</span>&nbsp;<span class="op" id="2249830">&lt;</span>&nbsp;<span class="ident" id="2249832">i</span><span class="op" id="2249833">;</span>&nbsp;<span class="ident" id="2249835">j</span><span class="op" id="2249836">++</span>&nbsp;<span class="op" id="2249839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2249845">sub</span><span class="op" id="2249848">[</span><span class="ident" id="2249849">j</span><span class="op" id="2249850">]</span>&nbsp;<span class="op" id="2249852">=</span>&nbsp;<span class="ident" id="2249854">p</span><span class="op" id="2249855">.</span><span class="ident" id="2249856">removeLeadingString</span><span class="op" id="2249875">(</span><span class="ident" id="2249876">sub</span><span class="op" id="2249879">[</span><span class="ident" id="2249880">j</span><span class="op" id="2249881">]</span><span class="op" id="2249882">,</span>&nbsp;<span class="builtinfunc" id="2249884">len</span><span class="op" id="2249887">(</span><span class="ident" id="2249888">str</span><span class="op" id="2249891">)</span><span class="op" id="2249892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2249897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2249902">suffix</span>&nbsp;<span class="op" id="2249909">:=</span>&nbsp;<span class="ident" id="2249912">p</span><span class="op" id="2249913">.</span><span class="ident" id="2249914">collapse</span><span class="op" id="2249922">(</span><span class="ident" id="2249923">sub</span><span class="op" id="2249926">[</span><span class="ident" id="2249927">start</span><span class="op" id="2249932">:</span><span class="ident" id="2249933">i</span><span class="op" id="2249934">]</span><span class="op" id="2249935">,</span>&nbsp;<span class="ident" id="2249937">OpAlternate</span><span class="op" id="2249948">)</span>&nbsp;<span class="comment" id="2249950">//&nbsp;recurse</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2249965">re</span>&nbsp;<span class="op" id="2249968">:=</span>&nbsp;<span class="ident" id="2249971">p</span><span class="op" id="2249972">.</span><span class="ident" id="2249973">newRegexp</span><span class="op" id="2249982">(</span><span class="ident" id="2249983">OpConcat</span><span class="op" id="2249991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2249996">re</span><span class="op" id="2249998">.</span><span class="ident" id="2249999">Sub</span>&nbsp;<span class="op" id="2250003">=</span>&nbsp;<span class="builtinfunc" id="2250005">append</span><span class="op" id="2250011">(</span><span class="ident" id="2250012">re</span><span class="op" id="2250014">.</span><span class="ident" id="2250015">Sub</span><span class="op" id="2250018">[</span><span class="op" id="2250019">:</span><span class="num" id="2250020">0</span><span class="op" id="2250021">]</span><span class="op" id="2250022">,</span>&nbsp;<span class="ident" id="2250024">prefix</span><span class="op" id="2250030">,</span>&nbsp;<span class="ident" id="2250032">suffix</span><span class="op" id="2250038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2250043">out</span>&nbsp;<span class="op" id="2250047">=</span>&nbsp;<span class="builtinfunc" id="2250049">append</span><span class="op" id="2250055">(</span><span class="ident" id="2250056">out</span><span class="op" id="2250059">,</span>&nbsp;<span class="ident" id="2250061">re</span><span class="op" id="2250063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2250067">}</span><br>
<span class="lineno">465</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2250072">//&nbsp;Prepare&nbsp;for&nbsp;next&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2250105">start</span>&nbsp;<span class="op" id="2250111">=</span>&nbsp;<span class="ident" id="2250113">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2250117">str</span>&nbsp;<span class="op" id="2250121">=</span>&nbsp;<span class="ident" id="2250123">istr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2250130">strflags</span>&nbsp;<span class="op" id="2250139">=</span>&nbsp;<span class="ident" id="2250141">iflags</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2250149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2250152">sub</span>&nbsp;<span class="op" id="2250156">=</span>&nbsp;<span class="ident" id="2250158">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2250164">//&nbsp;Round&nbsp;2:&nbsp;Factor&nbsp;out&nbsp;common&nbsp;complex&nbsp;prefixes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2250213">//&nbsp;just&nbsp;the&nbsp;first&nbsp;piece&nbsp;of&nbsp;each&nbsp;concatenation,</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2250261">//&nbsp;whatever&nbsp;it&nbsp;is.&nbsp;&nbsp;This&nbsp;is&nbsp;good&nbsp;enough&nbsp;a&nbsp;lot&nbsp;of&nbsp;the&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2250321">start</span>&nbsp;<span class="op" id="2250327">=</span>&nbsp;<span class="num" id="2250329">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2250332">out</span>&nbsp;<span class="op" id="2250336">=</span>&nbsp;<span class="ident" id="2250338">sub</span><span class="op" id="2250341">[</span><span class="op" id="2250342">:</span><span class="num" id="2250343">0</span><span class="op" id="2250344">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2250347">var</span>&nbsp;<span class="ident" id="2250351">first</span>&nbsp;<span class="op" id="2250357">*</span><span class="ident" id="2250358">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2250366">for</span>&nbsp;<span class="ident" id="2250370">i</span>&nbsp;<span class="op" id="2250372">:=</span>&nbsp;<span class="num" id="2250375">0</span><span class="op" id="2250376">;</span>&nbsp;<span class="ident" id="2250378">i</span>&nbsp;<span class="op" id="2250380">&lt;=</span>&nbsp;<span class="builtinfunc" id="2250383">len</span><span class="op" id="2250386">(</span><span class="ident" id="2250387">sub</span><span class="op" id="2250390">)</span><span class="op" id="2250391">;</span>&nbsp;<span class="ident" id="2250393">i</span><span class="op" id="2250394">++</span>&nbsp;<span class="op" id="2250397">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2250401">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2250465">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2250532">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2250566">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2250571">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;all&nbsp;begin&nbsp;with&nbsp;ifirst.</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2250648">var</span>&nbsp;<span class="ident" id="2250652">ifirst</span>&nbsp;<span class="op" id="2250659">*</span><span class="ident" id="2250660">Regexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2250669">if</span>&nbsp;<span class="ident" id="2250672">i</span>&nbsp;<span class="op" id="2250674">&lt;</span>&nbsp;<span class="builtinfunc" id="2250676">len</span><span class="op" id="2250679">(</span><span class="ident" id="2250680">sub</span><span class="op" id="2250683">)</span>&nbsp;<span class="op" id="2250685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2250690">ifirst</span>&nbsp;<span class="op" id="2250697">=</span>&nbsp;<span class="ident" id="2250699">p</span><span class="op" id="2250700">.</span><span class="ident" id="2250701">leadingRegexp</span><span class="op" id="2250714">(</span><span class="ident" id="2250715">sub</span><span class="op" id="2250718">[</span><span class="ident" id="2250719">i</span><span class="op" id="2250720">]</span><span class="op" id="2250721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2250726">if</span>&nbsp;<span class="ident" id="2250729">first</span>&nbsp;<span class="op" id="2250735">!=</span>&nbsp;<span class="ident" id="2250738">nil</span>&nbsp;<span class="op" id="2250742">&amp;&amp;</span>&nbsp;<span class="ident" id="2250745">first</span><span class="op" id="2250750">.</span><span class="ident" id="2250751">Equal</span><span class="op" id="2250756">(</span><span class="ident" id="2250757">ifirst</span><span class="op" id="2250763">)</span>&nbsp;<span class="op" id="2250765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2250771">continue</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2250783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2250787">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2250792">//&nbsp;Found&nbsp;end&nbsp;of&nbsp;a&nbsp;run&nbsp;with&nbsp;common&nbsp;leading&nbsp;regexp:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2250844">//&nbsp;sub[start:i]&nbsp;all&nbsp;begin&nbsp;with&nbsp;first&nbsp;but&nbsp;sub[i]&nbsp;does&nbsp;not.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2250904">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2250909">//&nbsp;Factor&nbsp;out&nbsp;common&nbsp;regexp&nbsp;and&nbsp;append&nbsp;factored&nbsp;expression&nbsp;to&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2250978">if</span>&nbsp;<span class="ident" id="2250981">i</span>&nbsp;<span class="op" id="2250983">==</span>&nbsp;<span class="ident" id="2250986">start</span>&nbsp;<span class="op" id="2250992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2250997">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2251035">}</span>&nbsp;<span class="keyword" id="2251037">else</span>&nbsp;<span class="keyword" id="2251042">if</span>&nbsp;<span class="ident" id="2251045">i</span>&nbsp;<span class="op" id="2251047">==</span>&nbsp;<span class="ident" id="2251050">start</span><span class="op" id="2251055">+</span><span class="num" id="2251056">1</span>&nbsp;<span class="op" id="2251058">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2251063">//&nbsp;Just&nbsp;one:&nbsp;don&#39;t&nbsp;bother&nbsp;factoring.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251103">out</span>&nbsp;<span class="op" id="2251107">=</span>&nbsp;<span class="builtinfunc" id="2251109">append</span><span class="op" id="2251115">(</span><span class="ident" id="2251116">out</span><span class="op" id="2251119">,</span>&nbsp;<span class="ident" id="2251121">sub</span><span class="op" id="2251124">[</span><span class="ident" id="2251125">start</span><span class="op" id="2251130">]</span><span class="op" id="2251131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2251135">}</span>&nbsp;<span class="keyword" id="2251137">else</span>&nbsp;<span class="op" id="2251142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2251147">//&nbsp;Construct&nbsp;factored&nbsp;form:&nbsp;prefix(suffix1|suffix2|...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251206">prefix</span>&nbsp;<span class="op" id="2251213">:=</span>&nbsp;<span class="ident" id="2251216">first</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2251225">for</span>&nbsp;<span class="ident" id="2251229">j</span>&nbsp;<span class="op" id="2251231">:=</span>&nbsp;<span class="ident" id="2251234">start</span><span class="op" id="2251239">;</span>&nbsp;<span class="ident" id="2251241">j</span>&nbsp;<span class="op" id="2251243">&lt;</span>&nbsp;<span class="ident" id="2251245">i</span><span class="op" id="2251246">;</span>&nbsp;<span class="ident" id="2251248">j</span><span class="op" id="2251249">++</span>&nbsp;<span class="op" id="2251252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251258">reuse</span>&nbsp;<span class="op" id="2251264">:=</span>&nbsp;<span class="ident" id="2251267">j</span>&nbsp;<span class="op" id="2251269">!=</span>&nbsp;<span class="ident" id="2251272">start</span>&nbsp;<span class="comment" id="2251278">//&nbsp;prefix&nbsp;came&nbsp;from&nbsp;sub[start]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251313">sub</span><span class="op" id="2251316">[</span><span class="ident" id="2251317">j</span><span class="op" id="2251318">]</span>&nbsp;<span class="op" id="2251320">=</span>&nbsp;<span class="ident" id="2251322">p</span><span class="op" id="2251323">.</span><span class="ident" id="2251324">removeLeadingRegexp</span><span class="op" id="2251343">(</span><span class="ident" id="2251344">sub</span><span class="op" id="2251347">[</span><span class="ident" id="2251348">j</span><span class="op" id="2251349">]</span><span class="op" id="2251350">,</span>&nbsp;<span class="ident" id="2251352">reuse</span><span class="op" id="2251357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2251362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251367">suffix</span>&nbsp;<span class="op" id="2251374">:=</span>&nbsp;<span class="ident" id="2251377">p</span><span class="op" id="2251378">.</span><span class="ident" id="2251379">collapse</span><span class="op" id="2251387">(</span><span class="ident" id="2251388">sub</span><span class="op" id="2251391">[</span><span class="ident" id="2251392">start</span><span class="op" id="2251397">:</span><span class="ident" id="2251398">i</span><span class="op" id="2251399">]</span><span class="op" id="2251400">,</span>&nbsp;<span class="ident" id="2251402">OpAlternate</span><span class="op" id="2251413">)</span>&nbsp;<span class="comment" id="2251415">//&nbsp;recurse</span><br>
<span class="lineno">510</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251430">re</span>&nbsp;<span class="op" id="2251433">:=</span>&nbsp;<span class="ident" id="2251436">p</span><span class="op" id="2251437">.</span><span class="ident" id="2251438">newRegexp</span><span class="op" id="2251447">(</span><span class="ident" id="2251448">OpConcat</span><span class="op" id="2251456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251461">re</span><span class="op" id="2251463">.</span><span class="ident" id="2251464">Sub</span>&nbsp;<span class="op" id="2251468">=</span>&nbsp;<span class="builtinfunc" id="2251470">append</span><span class="op" id="2251476">(</span><span class="ident" id="2251477">re</span><span class="op" id="2251479">.</span><span class="ident" id="2251480">Sub</span><span class="op" id="2251483">[</span><span class="op" id="2251484">:</span><span class="num" id="2251485">0</span><span class="op" id="2251486">]</span><span class="op" id="2251487">,</span>&nbsp;<span class="ident" id="2251489">prefix</span><span class="op" id="2251495">,</span>&nbsp;<span class="ident" id="2251497">suffix</span><span class="op" id="2251503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251508">out</span>&nbsp;<span class="op" id="2251512">=</span>&nbsp;<span class="builtinfunc" id="2251514">append</span><span class="op" id="2251520">(</span><span class="ident" id="2251521">out</span><span class="op" id="2251524">,</span>&nbsp;<span class="ident" id="2251526">re</span><span class="op" id="2251528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2251532">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2251537">//&nbsp;Prepare&nbsp;for&nbsp;next&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251570">start</span>&nbsp;<span class="op" id="2251576">=</span>&nbsp;<span class="ident" id="2251578">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251582">first</span>&nbsp;<span class="op" id="2251588">=</span>&nbsp;<span class="ident" id="2251590">ifirst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2251598">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251601">sub</span>&nbsp;<span class="op" id="2251605">=</span>&nbsp;<span class="ident" id="2251607">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2251613">//&nbsp;Round&nbsp;3:&nbsp;Collapse&nbsp;runs&nbsp;of&nbsp;single&nbsp;literals&nbsp;into&nbsp;character&nbsp;classes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251683">start</span>&nbsp;<span class="op" id="2251689">=</span>&nbsp;<span class="num" id="2251691">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2251694">out</span>&nbsp;<span class="op" id="2251698">=</span>&nbsp;<span class="ident" id="2251700">sub</span><span class="op" id="2251703">[</span><span class="op" id="2251704">:</span><span class="num" id="2251705">0</span><span class="op" id="2251706">]</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2251709">for</span>&nbsp;<span class="ident" id="2251713">i</span>&nbsp;<span class="op" id="2251715">:=</span>&nbsp;<span class="num" id="2251718">0</span><span class="op" id="2251719">;</span>&nbsp;<span class="ident" id="2251721">i</span>&nbsp;<span class="op" id="2251723">&lt;=</span>&nbsp;<span class="builtinfunc" id="2251726">len</span><span class="op" id="2251729">(</span><span class="ident" id="2251730">sub</span><span class="op" id="2251733">)</span><span class="op" id="2251734">;</span>&nbsp;<span class="ident" id="2251736">i</span><span class="op" id="2251737">++</span>&nbsp;<span class="op" id="2251740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2251744">//&nbsp;Invariant:&nbsp;the&nbsp;Regexps&nbsp;that&nbsp;were&nbsp;in&nbsp;sub[0:start]&nbsp;have&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2251808">//&nbsp;used&nbsp;or&nbsp;marked&nbsp;for&nbsp;reuse,&nbsp;and&nbsp;the&nbsp;slice&nbsp;space&nbsp;has&nbsp;been&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2251875">//&nbsp;for&nbsp;out&nbsp;(len(out)&nbsp;&lt;=&nbsp;start).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2251909">//</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2251914">//&nbsp;Invariant:&nbsp;sub[start:i]&nbsp;consists&nbsp;of&nbsp;regexps&nbsp;that&nbsp;are&nbsp;either</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2251979">//&nbsp;literal&nbsp;runes&nbsp;or&nbsp;character&nbsp;classes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2252020">if</span>&nbsp;<span class="ident" id="2252023">i</span>&nbsp;<span class="op" id="2252025">&lt;</span>&nbsp;<span class="builtinfunc" id="2252027">len</span><span class="op" id="2252030">(</span><span class="ident" id="2252031">sub</span><span class="op" id="2252034">)</span>&nbsp;<span class="op" id="2252036">&amp;&amp;</span>&nbsp;<span class="ident" id="2252039">isCharClass</span><span class="op" id="2252050">(</span><span class="ident" id="2252051">sub</span><span class="op" id="2252054">[</span><span class="ident" id="2252055">i</span><span class="op" id="2252056">]</span><span class="op" id="2252057">)</span>&nbsp;<span class="op" id="2252059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2252064">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2252075">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2252080">//&nbsp;sub[i]&nbsp;is&nbsp;not&nbsp;a&nbsp;char&nbsp;or&nbsp;char&nbsp;class;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2252121">//&nbsp;emit&nbsp;char&nbsp;class&nbsp;for&nbsp;sub[start:i]...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2252162">if</span>&nbsp;<span class="ident" id="2252165">i</span>&nbsp;<span class="op" id="2252167">==</span>&nbsp;<span class="ident" id="2252170">start</span>&nbsp;<span class="op" id="2252176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2252181">//&nbsp;Nothing&nbsp;to&nbsp;do&nbsp;-&nbsp;run&nbsp;of&nbsp;length&nbsp;0.</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2252219">}</span>&nbsp;<span class="keyword" id="2252221">else</span>&nbsp;<span class="keyword" id="2252226">if</span>&nbsp;<span class="ident" id="2252229">i</span>&nbsp;<span class="op" id="2252231">==</span>&nbsp;<span class="ident" id="2252234">start</span><span class="op" id="2252239">+</span><span class="num" id="2252240">1</span>&nbsp;<span class="op" id="2252242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2252247">out</span>&nbsp;<span class="op" id="2252251">=</span>&nbsp;<span class="builtinfunc" id="2252253">append</span><span class="op" id="2252259">(</span><span class="ident" id="2252260">out</span><span class="op" id="2252263">,</span>&nbsp;<span class="ident" id="2252265">sub</span><span class="op" id="2252268">[</span><span class="ident" id="2252269">start</span><span class="op" id="2252274">]</span><span class="op" id="2252275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2252279">}</span>&nbsp;<span class="keyword" id="2252281">else</span>&nbsp;<span class="op" id="2252286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2252291">//&nbsp;Make&nbsp;new&nbsp;char&nbsp;class.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2252318">//&nbsp;Start&nbsp;with&nbsp;most&nbsp;complex&nbsp;regexp&nbsp;in&nbsp;sub[start].</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2252370">max</span>&nbsp;<span class="op" id="2252374">:=</span>&nbsp;<span class="ident" id="2252377">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2252386">for</span>&nbsp;<span class="ident" id="2252390">j</span>&nbsp;<span class="op" id="2252392">:=</span>&nbsp;<span class="ident" id="2252395">start</span>&nbsp;<span class="op" id="2252401">+</span>&nbsp;<span class="num" id="2252403">1</span><span class="op" id="2252404">;</span>&nbsp;<span class="ident" id="2252406">j</span>&nbsp;<span class="op" id="2252408">&lt;</span>&nbsp;<span class="ident" id="2252410">i</span><span class="op" id="2252411">;</span>&nbsp;<span class="ident" id="2252413">j</span><span class="op" id="2252414">++</span>&nbsp;<span class="op" id="2252417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2252423">if</span>&nbsp;<span class="ident" id="2252426">sub</span><span class="op" id="2252429">[</span><span class="ident" id="2252430">max</span><span class="op" id="2252433">]</span><span class="op" id="2252434">.</span><span class="ident" id="2252435">Op</span>&nbsp;<span class="op" id="2252438">&lt;</span>&nbsp;<span class="ident" id="2252440">sub</span><span class="op" id="2252443">[</span><span class="ident" id="2252444">j</span><span class="op" id="2252445">]</span><span class="op" id="2252446">.</span><span class="ident" id="2252447">Op</span>&nbsp;<span class="op" id="2252450">||</span>&nbsp;<span class="ident" id="2252453">sub</span><span class="op" id="2252456">[</span><span class="ident" id="2252457">max</span><span class="op" id="2252460">]</span><span class="op" id="2252461">.</span><span class="ident" id="2252462">Op</span>&nbsp;<span class="op" id="2252465">==</span>&nbsp;<span class="ident" id="2252468">sub</span><span class="op" id="2252471">[</span><span class="ident" id="2252472">j</span><span class="op" id="2252473">]</span><span class="op" id="2252474">.</span><span class="ident" id="2252475">Op</span>&nbsp;<span class="op" id="2252478">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2252481">len</span><span class="op" id="2252484">(</span><span class="ident" id="2252485">sub</span><span class="op" id="2252488">[</span><span class="ident" id="2252489">max</span><span class="op" id="2252492">]</span><span class="op" id="2252493">.</span><span class="ident" id="2252494">Rune</span><span class="op" id="2252498">)</span>&nbsp;<span class="op" id="2252500">&lt;</span>&nbsp;<span class="builtinfunc" id="2252502">len</span><span class="op" id="2252505">(</span><span class="ident" id="2252506">sub</span><span class="op" id="2252509">[</span><span class="ident" id="2252510">j</span><span class="op" id="2252511">]</span><span class="op" id="2252512">.</span><span class="ident" id="2252513">Rune</span><span class="op" id="2252517">)</span>&nbsp;<span class="op" id="2252519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2252526">max</span>&nbsp;<span class="op" id="2252530">=</span>&nbsp;<span class="ident" id="2252532">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2252538">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2252543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2252548">sub</span><span class="op" id="2252551">[</span><span class="ident" id="2252552">start</span><span class="op" id="2252557">]</span><span class="op" id="2252558">,</span>&nbsp;<span class="ident" id="2252560">sub</span><span class="op" id="2252563">[</span><span class="ident" id="2252564">max</span><span class="op" id="2252567">]</span>&nbsp;<span class="op" id="2252569">=</span>&nbsp;<span class="ident" id="2252571">sub</span><span class="op" id="2252574">[</span><span class="ident" id="2252575">max</span><span class="op" id="2252578">]</span><span class="op" id="2252579">,</span>&nbsp;<span class="ident" id="2252581">sub</span><span class="op" id="2252584">[</span><span class="ident" id="2252585">start</span><span class="op" id="2252590">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2252596">for</span>&nbsp;<span class="ident" id="2252600">j</span>&nbsp;<span class="op" id="2252602">:=</span>&nbsp;<span class="ident" id="2252605">start</span>&nbsp;<span class="op" id="2252611">+</span>&nbsp;<span class="num" id="2252613">1</span><span class="op" id="2252614">;</span>&nbsp;<span class="ident" id="2252616">j</span>&nbsp;<span class="op" id="2252618">&lt;</span>&nbsp;<span class="ident" id="2252620">i</span><span class="op" id="2252621">;</span>&nbsp;<span class="ident" id="2252623">j</span><span class="op" id="2252624">++</span>&nbsp;<span class="op" id="2252627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2252633">mergeCharClass</span><span class="op" id="2252647">(</span><span class="ident" id="2252648">sub</span><span class="op" id="2252651">[</span><span class="ident" id="2252652">start</span><span class="op" id="2252657">]</span><span class="op" id="2252658">,</span>&nbsp;<span class="ident" id="2252660">sub</span><span class="op" id="2252663">[</span><span class="ident" id="2252664">j</span><span class="op" id="2252665">]</span><span class="op" id="2252666">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2252672">p</span><span class="op" id="2252673">.</span><span class="ident" id="2252674">reuse</span><span class="op" id="2252679">(</span><span class="ident" id="2252680">sub</span><span class="op" id="2252683">[</span><span class="ident" id="2252684">j</span><span class="op" id="2252685">]</span><span class="op" id="2252686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2252691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2252696">cleanAlt</span><span class="op" id="2252704">(</span><span class="ident" id="2252705">sub</span><span class="op" id="2252708">[</span><span class="ident" id="2252709">start</span><span class="op" id="2252714">]</span><span class="op" id="2252715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2252720">out</span>&nbsp;<span class="op" id="2252724">=</span>&nbsp;<span class="builtinfunc" id="2252726">append</span><span class="op" id="2252732">(</span><span class="ident" id="2252733">out</span><span class="op" id="2252736">,</span>&nbsp;<span class="ident" id="2252738">sub</span><span class="op" id="2252741">[</span><span class="ident" id="2252742">start</span><span class="op" id="2252747">]</span><span class="op" id="2252748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2252752">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2252757">//&nbsp;...&nbsp;and&nbsp;then&nbsp;emit&nbsp;sub[i].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2252788">if</span>&nbsp;<span class="ident" id="2252791">i</span>&nbsp;<span class="op" id="2252793">&lt;</span>&nbsp;<span class="builtinfunc" id="2252795">len</span><span class="op" id="2252798">(</span><span class="ident" id="2252799">sub</span><span class="op" id="2252802">)</span>&nbsp;<span class="op" id="2252804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2252809">out</span>&nbsp;<span class="op" id="2252813">=</span>&nbsp;<span class="builtinfunc" id="2252815">append</span><span class="op" id="2252821">(</span><span class="ident" id="2252822">out</span><span class="op" id="2252825">,</span>&nbsp;<span class="ident" id="2252827">sub</span><span class="op" id="2252830">[</span><span class="ident" id="2252831">i</span><span class="op" id="2252832">]</span><span class="op" id="2252833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2252837">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2252841">start</span>&nbsp;<span class="op" id="2252847">=</span>&nbsp;<span class="ident" id="2252849">i</span>&nbsp;<span class="op" id="2252851">+</span>&nbsp;<span class="num" id="2252853">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2252856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2252859">sub</span>&nbsp;<span class="op" id="2252863">=</span>&nbsp;<span class="ident" id="2252865">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2252871">//&nbsp;Round&nbsp;4:&nbsp;Collapse&nbsp;runs&nbsp;of&nbsp;empty&nbsp;matches&nbsp;into&nbsp;a&nbsp;single&nbsp;empty&nbsp;match.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2252942">start</span>&nbsp;<span class="op" id="2252948">=</span>&nbsp;<span class="num" id="2252950">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2252953">out</span>&nbsp;<span class="op" id="2252957">=</span>&nbsp;<span class="ident" id="2252959">sub</span><span class="op" id="2252962">[</span><span class="op" id="2252963">:</span><span class="num" id="2252964">0</span><span class="op" id="2252965">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2252968">for</span>&nbsp;<span class="ident" id="2252972">i</span>&nbsp;<span class="op" id="2252974">:=</span>&nbsp;<span class="keyword" id="2252977">range</span>&nbsp;<span class="ident" id="2252983">sub</span>&nbsp;<span class="op" id="2252987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2252991">if</span>&nbsp;<span class="ident" id="2252994">i</span><span class="op" id="2252995">+</span><span class="num" id="2252996">1</span>&nbsp;<span class="op" id="2252998">&lt;</span>&nbsp;<span class="builtinfunc" id="2253000">len</span><span class="op" id="2253003">(</span><span class="ident" id="2253004">sub</span><span class="op" id="2253007">)</span>&nbsp;<span class="op" id="2253009">&amp;&amp;</span>&nbsp;<span class="ident" id="2253012">sub</span><span class="op" id="2253015">[</span><span class="ident" id="2253016">i</span><span class="op" id="2253017">]</span><span class="op" id="2253018">.</span><span class="ident" id="2253019">Op</span>&nbsp;<span class="op" id="2253022">==</span>&nbsp;<span class="ident" id="2253025">OpEmptyMatch</span>&nbsp;<span class="op" id="2253038">&amp;&amp;</span>&nbsp;<span class="ident" id="2253041">sub</span><span class="op" id="2253044">[</span><span class="ident" id="2253045">i</span><span class="op" id="2253046">+</span><span class="num" id="2253047">1</span><span class="op" id="2253048">]</span><span class="op" id="2253049">.</span><span class="ident" id="2253050">Op</span>&nbsp;<span class="op" id="2253053">==</span>&nbsp;<span class="ident" id="2253056">OpEmptyMatch</span>&nbsp;<span class="op" id="2253069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2253074">continue</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2253085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2253089">out</span>&nbsp;<span class="op" id="2253093">=</span>&nbsp;<span class="builtinfunc" id="2253095">append</span><span class="op" id="2253101">(</span><span class="ident" id="2253102">out</span><span class="op" id="2253105">,</span>&nbsp;<span class="ident" id="2253107">sub</span><span class="op" id="2253110">[</span><span class="ident" id="2253111">i</span><span class="op" id="2253112">]</span><span class="op" id="2253113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2253116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2253119">sub</span>&nbsp;<span class="op" id="2253123">=</span>&nbsp;<span class="ident" id="2253125">out</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2253131">return</span>&nbsp;<span class="ident" id="2253138">sub</span><br>
<span class="lineno"></span><span class="op" id="2253142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2253145">//&nbsp;leadingString&nbsp;returns&nbsp;the&nbsp;leading&nbsp;literal&nbsp;string&nbsp;that&nbsp;re&nbsp;begins&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="2253218">//&nbsp;The&nbsp;string&nbsp;refers&nbsp;to&nbsp;storage&nbsp;in&nbsp;re&nbsp;or&nbsp;its&nbsp;children.</span><br>
<span class="lineno">585</span><span class="keyword" id="2253273">func</span>&nbsp;<span class="op" id="2253278">(</span><span class="ident" id="2253279">p</span>&nbsp;<span class="op" id="2253281">*</span><span class="ident" id="2253282">parser</span><span class="op" id="2253288">)</span>&nbsp;<span class="ident" id="2253290">leadingString</span><span class="op" id="2253303">(</span><span class="ident" id="2253304">re</span>&nbsp;<span class="op" id="2253307">*</span><span class="ident" id="2253308">Regexp</span><span class="op" id="2253314">)</span>&nbsp;<span class="op" id="2253316">(</span><span class="op" id="2253317">[</span><span class="op" id="2253318">]</span><span class="builtintype" id="2253319">rune</span><span class="op" id="2253323">,</span>&nbsp;<span class="ident" id="2253325">Flags</span><span class="op" id="2253330">)</span>&nbsp;<span class="op" id="2253332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2253335">if</span>&nbsp;<span class="ident" id="2253338">re</span><span class="op" id="2253340">.</span><span class="ident" id="2253341">Op</span>&nbsp;<span class="op" id="2253344">==</span>&nbsp;<span class="ident" id="2253347">OpConcat</span>&nbsp;<span class="op" id="2253356">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2253359">len</span><span class="op" id="2253362">(</span><span class="ident" id="2253363">re</span><span class="op" id="2253365">.</span><span class="ident" id="2253366">Sub</span><span class="op" id="2253369">)</span>&nbsp;<span class="op" id="2253371">&gt;</span>&nbsp;<span class="num" id="2253373">0</span>&nbsp;<span class="op" id="2253375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2253379">re</span>&nbsp;<span class="op" id="2253382">=</span>&nbsp;<span class="ident" id="2253384">re</span><span class="op" id="2253386">.</span><span class="ident" id="2253387">Sub</span><span class="op" id="2253390">[</span><span class="num" id="2253391">0</span><span class="op" id="2253392">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2253395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2253398">if</span>&nbsp;<span class="ident" id="2253401">re</span><span class="op" id="2253403">.</span><span class="ident" id="2253404">Op</span>&nbsp;<span class="op" id="2253407">!=</span>&nbsp;<span class="ident" id="2253410">OpLiteral</span>&nbsp;<span class="op" id="2253420">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2253424">return</span>&nbsp;<span class="ident" id="2253431">nil</span><span class="op" id="2253434">,</span>&nbsp;<span class="num" id="2253436">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2253439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2253442">return</span>&nbsp;<span class="ident" id="2253449">re</span><span class="op" id="2253451">.</span><span class="ident" id="2253452">Rune</span><span class="op" id="2253456">,</span>&nbsp;<span class="ident" id="2253458">re</span><span class="op" id="2253460">.</span><span class="ident" id="2253461">Flags</span>&nbsp;<span class="op" id="2253467">&amp;</span>&nbsp;<span class="ident" id="2253469">FoldCase</span><br>
<span class="lineno"></span><span class="op" id="2253478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="comment" id="2253481">//&nbsp;removeLeadingString&nbsp;removes&nbsp;the&nbsp;first&nbsp;n&nbsp;leading&nbsp;runes</span><br>
<span class="lineno"></span><span class="comment" id="2253538">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;re.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;replacement&nbsp;for&nbsp;re.</span><br>
<span class="lineno"></span><span class="keyword" id="2253603">func</span>&nbsp;<span class="op" id="2253608">(</span><span class="ident" id="2253609">p</span>&nbsp;<span class="op" id="2253611">*</span><span class="ident" id="2253612">parser</span><span class="op" id="2253618">)</span>&nbsp;<span class="ident" id="2253620">removeLeadingString</span><span class="op" id="2253639">(</span><span class="ident" id="2253640">re</span>&nbsp;<span class="op" id="2253643">*</span><span class="ident" id="2253644">Regexp</span><span class="op" id="2253650">,</span>&nbsp;<span class="ident" id="2253652">n</span>&nbsp;<span class="builtintype" id="2253654">int</span><span class="op" id="2253657">)</span>&nbsp;<span class="op" id="2253659">*</span><span class="ident" id="2253660">Regexp</span>&nbsp;<span class="op" id="2253667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2253670">if</span>&nbsp;<span class="ident" id="2253673">re</span><span class="op" id="2253675">.</span><span class="ident" id="2253676">Op</span>&nbsp;<span class="op" id="2253679">==</span>&nbsp;<span class="ident" id="2253682">OpConcat</span>&nbsp;<span class="op" id="2253691">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2253694">len</span><span class="op" id="2253697">(</span><span class="ident" id="2253698">re</span><span class="op" id="2253700">.</span><span class="ident" id="2253701">Sub</span><span class="op" id="2253704">)</span>&nbsp;<span class="op" id="2253706">&gt;</span>&nbsp;<span class="num" id="2253708">0</span>&nbsp;<span class="op" id="2253710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2253714">//&nbsp;Removing&nbsp;a&nbsp;leading&nbsp;string&nbsp;in&nbsp;a&nbsp;concatenation</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2253764">//&nbsp;might&nbsp;simplify&nbsp;the&nbsp;concatenation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2253803">sub</span>&nbsp;<span class="op" id="2253807">:=</span>&nbsp;<span class="ident" id="2253810">re</span><span class="op" id="2253812">.</span><span class="ident" id="2253813">Sub</span><span class="op" id="2253816">[</span><span class="num" id="2253817">0</span><span class="op" id="2253818">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2253822">sub</span>&nbsp;<span class="op" id="2253826">=</span>&nbsp;<span class="ident" id="2253828">p</span><span class="op" id="2253829">.</span><span class="ident" id="2253830">removeLeadingString</span><span class="op" id="2253849">(</span><span class="ident" id="2253850">sub</span><span class="op" id="2253853">,</span>&nbsp;<span class="ident" id="2253855">n</span><span class="op" id="2253856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2253860">re</span><span class="op" id="2253862">.</span><span class="ident" id="2253863">Sub</span><span class="op" id="2253866">[</span><span class="num" id="2253867">0</span><span class="op" id="2253868">]</span>&nbsp;<span class="op" id="2253870">=</span>&nbsp;<span class="ident" id="2253872">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2253878">if</span>&nbsp;<span class="ident" id="2253881">sub</span><span class="op" id="2253884">.</span><span class="ident" id="2253885">Op</span>&nbsp;<span class="op" id="2253888">==</span>&nbsp;<span class="ident" id="2253891">OpEmptyMatch</span>&nbsp;<span class="op" id="2253904">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2253909">p</span><span class="op" id="2253910">.</span><span class="ident" id="2253911">reuse</span><span class="op" id="2253916">(</span><span class="ident" id="2253917">sub</span><span class="op" id="2253920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2253925">switch</span>&nbsp;<span class="builtinfunc" id="2253932">len</span><span class="op" id="2253935">(</span><span class="ident" id="2253936">re</span><span class="op" id="2253938">.</span><span class="ident" id="2253939">Sub</span><span class="op" id="2253942">)</span>&nbsp;<span class="op" id="2253944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2253949">case</span>&nbsp;<span class="num" id="2253954">0</span><span class="op" id="2253955">,</span>&nbsp;<span class="num" id="2253957">1</span><span class="op" id="2253958">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2253964">//&nbsp;Impossible&nbsp;but&nbsp;handle.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2253994">re</span><span class="op" id="2253996">.</span><span class="ident" id="2253997">Op</span>&nbsp;<span class="op" id="2254000">=</span>&nbsp;<span class="ident" id="2254002">OpEmptyMatch</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2254019">re</span><span class="op" id="2254021">.</span><span class="ident" id="2254022">Sub</span>&nbsp;<span class="op" id="2254026">=</span>&nbsp;<span class="ident" id="2254028">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2254035">case</span>&nbsp;<span class="num" id="2254040">2</span><span class="op" id="2254041">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2254047">old</span>&nbsp;<span class="op" id="2254051">:=</span>&nbsp;<span class="ident" id="2254054">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2254061">re</span>&nbsp;<span class="op" id="2254064">=</span>&nbsp;<span class="ident" id="2254066">re</span><span class="op" id="2254068">.</span><span class="ident" id="2254069">Sub</span><span class="op" id="2254072">[</span><span class="num" id="2254073">1</span><span class="op" id="2254074">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2254080">p</span><span class="op" id="2254081">.</span><span class="ident" id="2254082">reuse</span><span class="op" id="2254087">(</span><span class="ident" id="2254088">old</span><span class="op" id="2254091">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2254096">default</span><span class="op" id="2254103">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2254109">copy</span><span class="op" id="2254113">(</span><span class="ident" id="2254114">re</span><span class="op" id="2254116">.</span><span class="ident" id="2254117">Sub</span><span class="op" id="2254120">,</span>&nbsp;<span class="ident" id="2254122">re</span><span class="op" id="2254124">.</span><span class="ident" id="2254125">Sub</span><span class="op" id="2254128">[</span><span class="num" id="2254129">1</span><span class="op" id="2254130">:</span><span class="op" id="2254131">]</span><span class="op" id="2254132">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2254138">re</span><span class="op" id="2254140">.</span><span class="ident" id="2254141">Sub</span>&nbsp;<span class="op" id="2254145">=</span>&nbsp;<span class="ident" id="2254147">re</span><span class="op" id="2254149">.</span><span class="ident" id="2254150">Sub</span><span class="op" id="2254153">[</span><span class="op" id="2254154">:</span><span class="builtinfunc" id="2254155">len</span><span class="op" id="2254158">(</span><span class="ident" id="2254159">re</span><span class="op" id="2254161">.</span><span class="ident" id="2254162">Sub</span><span class="op" id="2254165">)</span><span class="op" id="2254166">-</span><span class="num" id="2254167">1</span><span class="op" id="2254168">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2254173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2254177">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2254181">return</span>&nbsp;<span class="ident" id="2254188">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2254192">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2254196">if</span>&nbsp;<span class="ident" id="2254199">re</span><span class="op" id="2254201">.</span><span class="ident" id="2254202">Op</span>&nbsp;<span class="op" id="2254205">==</span>&nbsp;<span class="ident" id="2254208">OpLiteral</span>&nbsp;<span class="op" id="2254218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2254222">re</span><span class="op" id="2254224">.</span><span class="ident" id="2254225">Rune</span>&nbsp;<span class="op" id="2254230">=</span>&nbsp;<span class="ident" id="2254232">re</span><span class="op" id="2254234">.</span><span class="ident" id="2254235">Rune</span><span class="op" id="2254239">[</span><span class="op" id="2254240">:</span><span class="builtinfunc" id="2254241">copy</span><span class="op" id="2254245">(</span><span class="ident" id="2254246">re</span><span class="op" id="2254248">.</span><span class="ident" id="2254249">Rune</span><span class="op" id="2254253">,</span>&nbsp;<span class="ident" id="2254255">re</span><span class="op" id="2254257">.</span><span class="ident" id="2254258">Rune</span><span class="op" id="2254262">[</span><span class="ident" id="2254263">n</span><span class="op" id="2254264">:</span><span class="op" id="2254265">]</span><span class="op" id="2254266">)</span><span class="op" id="2254267">]</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2254271">if</span>&nbsp;<span class="builtinfunc" id="2254274">len</span><span class="op" id="2254277">(</span><span class="ident" id="2254278">re</span><span class="op" id="2254280">.</span><span class="ident" id="2254281">Rune</span><span class="op" id="2254285">)</span>&nbsp;<span class="op" id="2254287">==</span>&nbsp;<span class="num" id="2254290">0</span>&nbsp;<span class="op" id="2254292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2254297">re</span><span class="op" id="2254299">.</span><span class="ident" id="2254300">Op</span>&nbsp;<span class="op" id="2254303">=</span>&nbsp;<span class="ident" id="2254305">OpEmptyMatch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2254320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2254323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2254326">return</span>&nbsp;<span class="ident" id="2254333">re</span><br>
<span class="lineno">630</span><span class="op" id="2254336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2254339">//&nbsp;leadingRegexp&nbsp;returns&nbsp;the&nbsp;leading&nbsp;regexp&nbsp;that&nbsp;re&nbsp;begins&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="2254404">//&nbsp;The&nbsp;regexp&nbsp;refers&nbsp;to&nbsp;storage&nbsp;in&nbsp;re&nbsp;or&nbsp;its&nbsp;children.</span><br>
<span class="lineno"></span><span class="keyword" id="2254459">func</span>&nbsp;<span class="op" id="2254464">(</span><span class="ident" id="2254465">p</span>&nbsp;<span class="op" id="2254467">*</span><span class="ident" id="2254468">parser</span><span class="op" id="2254474">)</span>&nbsp;<span class="ident" id="2254476">leadingRegexp</span><span class="op" id="2254489">(</span><span class="ident" id="2254490">re</span>&nbsp;<span class="op" id="2254493">*</span><span class="ident" id="2254494">Regexp</span><span class="op" id="2254500">)</span>&nbsp;<span class="op" id="2254502">*</span><span class="ident" id="2254503">Regexp</span>&nbsp;<span class="op" id="2254510">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2254513">if</span>&nbsp;<span class="ident" id="2254516">re</span><span class="op" id="2254518">.</span><span class="ident" id="2254519">Op</span>&nbsp;<span class="op" id="2254522">==</span>&nbsp;<span class="ident" id="2254525">OpEmptyMatch</span>&nbsp;<span class="op" id="2254538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2254542">return</span>&nbsp;<span class="ident" id="2254549">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2254554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2254557">if</span>&nbsp;<span class="ident" id="2254560">re</span><span class="op" id="2254562">.</span><span class="ident" id="2254563">Op</span>&nbsp;<span class="op" id="2254566">==</span>&nbsp;<span class="ident" id="2254569">OpConcat</span>&nbsp;<span class="op" id="2254578">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2254581">len</span><span class="op" id="2254584">(</span><span class="ident" id="2254585">re</span><span class="op" id="2254587">.</span><span class="ident" id="2254588">Sub</span><span class="op" id="2254591">)</span>&nbsp;<span class="op" id="2254593">&gt;</span>&nbsp;<span class="num" id="2254595">0</span>&nbsp;<span class="op" id="2254597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2254601">sub</span>&nbsp;<span class="op" id="2254605">:=</span>&nbsp;<span class="ident" id="2254608">re</span><span class="op" id="2254610">.</span><span class="ident" id="2254611">Sub</span><span class="op" id="2254614">[</span><span class="num" id="2254615">0</span><span class="op" id="2254616">]</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2254620">if</span>&nbsp;<span class="ident" id="2254623">sub</span><span class="op" id="2254626">.</span><span class="ident" id="2254627">Op</span>&nbsp;<span class="op" id="2254630">==</span>&nbsp;<span class="ident" id="2254633">OpEmptyMatch</span>&nbsp;<span class="op" id="2254646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2254651">return</span>&nbsp;<span class="ident" id="2254658">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2254664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2254668">return</span>&nbsp;<span class="ident" id="2254675">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2254680">}</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2254683">return</span>&nbsp;<span class="ident" id="2254690">re</span><br>
<span class="lineno"></span><span class="op" id="2254693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2254696">//&nbsp;removeLeadingRegexp&nbsp;removes&nbsp;the&nbsp;leading&nbsp;regexp&nbsp;in&nbsp;re.</span><br>
<span class="lineno"></span><span class="comment" id="2254753">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;replacement&nbsp;for&nbsp;re.</span><br>
<span class="lineno">650</span><span class="comment" id="2254791">//&nbsp;If&nbsp;reuse&nbsp;is&nbsp;true,&nbsp;it&nbsp;passes&nbsp;the&nbsp;removed&nbsp;regexp&nbsp;(if&nbsp;no&nbsp;longer&nbsp;needed)&nbsp;to&nbsp;p.reuse.</span><br>
<span class="lineno"></span><span class="keyword" id="2254875">func</span>&nbsp;<span class="op" id="2254880">(</span><span class="ident" id="2254881">p</span>&nbsp;<span class="op" id="2254883">*</span><span class="ident" id="2254884">parser</span><span class="op" id="2254890">)</span>&nbsp;<span class="ident" id="2254892">removeLeadingRegexp</span><span class="op" id="2254911">(</span><span class="ident" id="2254912">re</span>&nbsp;<span class="op" id="2254915">*</span><span class="ident" id="2254916">Regexp</span><span class="op" id="2254922">,</span>&nbsp;<span class="ident" id="2254924">reuse</span>&nbsp;<span class="builtintype" id="2254930">bool</span><span class="op" id="2254934">)</span>&nbsp;<span class="op" id="2254936">*</span><span class="ident" id="2254937">Regexp</span>&nbsp;<span class="op" id="2254944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2254947">if</span>&nbsp;<span class="ident" id="2254950">re</span><span class="op" id="2254952">.</span><span class="ident" id="2254953">Op</span>&nbsp;<span class="op" id="2254956">==</span>&nbsp;<span class="ident" id="2254959">OpConcat</span>&nbsp;<span class="op" id="2254968">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2254971">len</span><span class="op" id="2254974">(</span><span class="ident" id="2254975">re</span><span class="op" id="2254977">.</span><span class="ident" id="2254978">Sub</span><span class="op" id="2254981">)</span>&nbsp;<span class="op" id="2254983">&gt;</span>&nbsp;<span class="num" id="2254985">0</span>&nbsp;<span class="op" id="2254987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2254991">if</span>&nbsp;<span class="ident" id="2254994">reuse</span>&nbsp;<span class="op" id="2255000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2255005">p</span><span class="op" id="2255006">.</span><span class="ident" id="2255007">reuse</span><span class="op" id="2255012">(</span><span class="ident" id="2255013">re</span><span class="op" id="2255015">.</span><span class="ident" id="2255016">Sub</span><span class="op" id="2255019">[</span><span class="num" id="2255020">0</span><span class="op" id="2255021">]</span><span class="op" id="2255022">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2255026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2255030">re</span><span class="op" id="2255032">.</span><span class="ident" id="2255033">Sub</span>&nbsp;<span class="op" id="2255037">=</span>&nbsp;<span class="ident" id="2255039">re</span><span class="op" id="2255041">.</span><span class="ident" id="2255042">Sub</span><span class="op" id="2255045">[</span><span class="op" id="2255046">:</span><span class="builtinfunc" id="2255047">copy</span><span class="op" id="2255051">(</span><span class="ident" id="2255052">re</span><span class="op" id="2255054">.</span><span class="ident" id="2255055">Sub</span><span class="op" id="2255058">,</span>&nbsp;<span class="ident" id="2255060">re</span><span class="op" id="2255062">.</span><span class="ident" id="2255063">Sub</span><span class="op" id="2255066">[</span><span class="num" id="2255067">1</span><span class="op" id="2255068">:</span><span class="op" id="2255069">]</span><span class="op" id="2255070">)</span><span class="op" id="2255071">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2255075">switch</span>&nbsp;<span class="builtinfunc" id="2255082">len</span><span class="op" id="2255085">(</span><span class="ident" id="2255086">re</span><span class="op" id="2255088">.</span><span class="ident" id="2255089">Sub</span><span class="op" id="2255092">)</span>&nbsp;<span class="op" id="2255094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2255098">case</span>&nbsp;<span class="num" id="2255103">0</span><span class="op" id="2255104">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2255109">re</span><span class="op" id="2255111">.</span><span class="ident" id="2255112">Op</span>&nbsp;<span class="op" id="2255115">=</span>&nbsp;<span class="ident" id="2255117">OpEmptyMatch</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2255133">re</span><span class="op" id="2255135">.</span><span class="ident" id="2255136">Sub</span>&nbsp;<span class="op" id="2255140">=</span>&nbsp;<span class="ident" id="2255142">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2255148">case</span>&nbsp;<span class="num" id="2255153">1</span><span class="op" id="2255154">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2255159">old</span>&nbsp;<span class="op" id="2255163">:=</span>&nbsp;<span class="ident" id="2255166">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2255172">re</span>&nbsp;<span class="op" id="2255175">=</span>&nbsp;<span class="ident" id="2255177">re</span><span class="op" id="2255179">.</span><span class="ident" id="2255180">Sub</span><span class="op" id="2255183">[</span><span class="num" id="2255184">0</span><span class="op" id="2255185">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2255190">p</span><span class="op" id="2255191">.</span><span class="ident" id="2255192">reuse</span><span class="op" id="2255197">(</span><span class="ident" id="2255198">old</span><span class="op" id="2255201">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2255205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2255209">return</span>&nbsp;<span class="ident" id="2255216">re</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2255220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2255223">if</span>&nbsp;<span class="ident" id="2255226">reuse</span>&nbsp;<span class="op" id="2255232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2255236">p</span><span class="op" id="2255237">.</span><span class="ident" id="2255238">reuse</span><span class="op" id="2255243">(</span><span class="ident" id="2255244">re</span><span class="op" id="2255246">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2255249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2255252">return</span>&nbsp;<span class="ident" id="2255259">p</span><span class="op" id="2255260">.</span><span class="ident" id="2255261">newRegexp</span><span class="op" id="2255270">(</span><span class="ident" id="2255271">OpEmptyMatch</span><span class="op" id="2255283">)</span><br>
<span class="lineno"></span><span class="op" id="2255285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2255288">func</span>&nbsp;<span class="ident" id="2255293">literalRegexp</span><span class="op" id="2255306">(</span><span class="ident" id="2255307">s</span>&nbsp;<span class="builtintype" id="2255309">string</span><span class="op" id="2255315">,</span>&nbsp;<span class="ident" id="2255317">flags</span>&nbsp;<span class="ident" id="2255323">Flags</span><span class="op" id="2255328">)</span>&nbsp;<span class="op" id="2255330">*</span><span class="ident" id="2255331">Regexp</span>&nbsp;<span class="op" id="2255338">{</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2255341">re</span>&nbsp;<span class="op" id="2255344">:=</span>&nbsp;<span class="op" id="2255347">&amp;</span><span class="ident" id="2255348">Regexp</span><span class="op" id="2255354">{</span><span class="ident" id="2255355">Op</span><span class="op" id="2255357">:</span>&nbsp;<span class="ident" id="2255359">OpLiteral</span><span class="op" id="2255368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2255371">re</span><span class="op" id="2255373">.</span><span class="ident" id="2255374">Flags</span>&nbsp;<span class="op" id="2255380">=</span>&nbsp;<span class="ident" id="2255382">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2255389">re</span><span class="op" id="2255391">.</span><span class="ident" id="2255392">Rune</span>&nbsp;<span class="op" id="2255397">=</span>&nbsp;<span class="ident" id="2255399">re</span><span class="op" id="2255401">.</span><span class="ident" id="2255402">Rune0</span><span class="op" id="2255407">[</span><span class="op" id="2255408">:</span><span class="num" id="2255409">0</span><span class="op" id="2255410">]</span>&nbsp;<span class="comment" id="2255412">//&nbsp;use&nbsp;local&nbsp;storage&nbsp;for&nbsp;small&nbsp;strings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2255452">for</span>&nbsp;<span class="ident" id="2255456">_</span><span class="op" id="2255457">,</span>&nbsp;<span class="ident" id="2255459">c</span>&nbsp;<span class="op" id="2255461">:=</span>&nbsp;<span class="keyword" id="2255464">range</span>&nbsp;<span class="ident" id="2255470">s</span>&nbsp;<span class="op" id="2255472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2255476">if</span>&nbsp;<span class="builtinfunc" id="2255479">len</span><span class="op" id="2255482">(</span><span class="ident" id="2255483">re</span><span class="op" id="2255485">.</span><span class="ident" id="2255486">Rune</span><span class="op" id="2255490">)</span>&nbsp;<span class="op" id="2255492">&gt;=</span>&nbsp;<span class="builtinfunc" id="2255495">cap</span><span class="op" id="2255498">(</span><span class="ident" id="2255499">re</span><span class="op" id="2255501">.</span><span class="ident" id="2255502">Rune</span><span class="op" id="2255506">)</span>&nbsp;<span class="op" id="2255508">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2255513">//&nbsp;string&nbsp;is&nbsp;too&nbsp;long&nbsp;to&nbsp;fit&nbsp;in&nbsp;Rune0.&nbsp;&nbsp;let&nbsp;Go&nbsp;handle&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2255573">re</span><span class="op" id="2255575">.</span><span class="ident" id="2255576">Rune</span>&nbsp;<span class="op" id="2255581">=</span>&nbsp;<span class="op" id="2255583">[</span><span class="op" id="2255584">]</span><span class="builtintype" id="2255585">rune</span><span class="op" id="2255589">(</span><span class="ident" id="2255590">s</span><span class="op" id="2255591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2255596">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2255604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2255608">re</span><span class="op" id="2255610">.</span><span class="ident" id="2255611">Rune</span>&nbsp;<span class="op" id="2255616">=</span>&nbsp;<span class="builtinfunc" id="2255618">append</span><span class="op" id="2255624">(</span><span class="ident" id="2255625">re</span><span class="op" id="2255627">.</span><span class="ident" id="2255628">Rune</span><span class="op" id="2255632">,</span>&nbsp;<span class="ident" id="2255634">c</span><span class="op" id="2255635">)</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2255638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2255641">return</span>&nbsp;<span class="ident" id="2255648">re</span><br>
<span class="lineno"></span><span class="op" id="2255651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2255654">//&nbsp;Parsing.</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="comment" id="2255667">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;regular&nbsp;expression&nbsp;string&nbsp;s,&nbsp;controlled&nbsp;by&nbsp;the&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="2255742">//&nbsp;Flags,&nbsp;and&nbsp;returns&nbsp;a&nbsp;regular&nbsp;expression&nbsp;parse&nbsp;tree.&nbsp;The&nbsp;syntax&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2255811">//&nbsp;described&nbsp;in&nbsp;the&nbsp;top-level&nbsp;comment.</span><br>
<span class="lineno"></span><span class="keyword" id="2255850">func</span>&nbsp;<span class="ident" id="2255855">Parse</span><span class="op" id="2255860">(</span><span class="ident" id="2255861">s</span>&nbsp;<span class="builtintype" id="2255863">string</span><span class="op" id="2255869">,</span>&nbsp;<span class="ident" id="2255871">flags</span>&nbsp;<span class="ident" id="2255877">Flags</span><span class="op" id="2255882">)</span>&nbsp;<span class="op" id="2255884">(</span><span class="op" id="2255885">*</span><span class="ident" id="2255886">Regexp</span><span class="op" id="2255892">,</span>&nbsp;<span class="builtintype" id="2255894">error</span><span class="op" id="2255899">)</span>&nbsp;<span class="op" id="2255901">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2255904">if</span>&nbsp;<span class="ident" id="2255907">flags</span><span class="op" id="2255912">&amp;</span><span class="ident" id="2255913">Literal</span>&nbsp;<span class="op" id="2255921">!=</span>&nbsp;<span class="num" id="2255924">0</span>&nbsp;<span class="op" id="2255926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2255930">//&nbsp;Trivial&nbsp;parser&nbsp;for&nbsp;literal&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2255970">if</span>&nbsp;<span class="ident" id="2255973">err</span>&nbsp;<span class="op" id="2255977">:=</span>&nbsp;<span class="ident" id="2255980">checkUTF8</span><span class="op" id="2255989">(</span><span class="ident" id="2255990">s</span><span class="op" id="2255991">)</span><span class="op" id="2255992">;</span>&nbsp;<span class="ident" id="2255994">err</span>&nbsp;<span class="op" id="2255998">!=</span>&nbsp;<span class="ident" id="2256001">nil</span>&nbsp;<span class="op" id="2256005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2256010">return</span>&nbsp;<span class="ident" id="2256017">nil</span><span class="op" id="2256020">,</span>&nbsp;<span class="ident" id="2256022">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2256028">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2256032">return</span>&nbsp;<span class="ident" id="2256039">literalRegexp</span><span class="op" id="2256052">(</span><span class="ident" id="2256053">s</span><span class="op" id="2256054">,</span>&nbsp;<span class="ident" id="2256056">flags</span><span class="op" id="2256061">)</span><span class="op" id="2256062">,</span>&nbsp;<span class="ident" id="2256064">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2256069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2256073">//&nbsp;Otherwise,&nbsp;must&nbsp;do&nbsp;real&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2256107">var</span>&nbsp;<span class="op" id="2256111">(</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2256115">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2256126">parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2256135">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2256146">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2256154">c</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2256165">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2256172">op</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2256183">Op</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2256188">lastRepeat</span>&nbsp;<span class="builtintype" id="2256199">string</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2256207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2256210">p</span><span class="op" id="2256211">.</span><span class="ident" id="2256212">flags</span>&nbsp;<span class="op" id="2256218">=</span>&nbsp;<span class="ident" id="2256220">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2256227">p</span><span class="op" id="2256228">.</span><span class="ident" id="2256229">wholeRegexp</span>&nbsp;<span class="op" id="2256241">=</span>&nbsp;<span class="ident" id="2256243">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2256246">t</span>&nbsp;<span class="op" id="2256248">:=</span>&nbsp;<span class="ident" id="2256251">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2256254">for</span>&nbsp;<span class="ident" id="2256258">t</span>&nbsp;<span class="op" id="2256260">!=</span>&nbsp;<span class="string" id="2256263">&#34;&#34;</span>&nbsp;<span class="op" id="2256266">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2256270">repeat</span>&nbsp;<span class="op" id="2256277">:=</span>&nbsp;<span class="string" id="2256280">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2256284">BigSwitch</span><span class="op" id="2256293">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2256297">switch</span>&nbsp;<span class="ident" id="2256304">t</span><span class="op" id="2256305">[</span><span class="num" id="2256306">0</span><span class="op" id="2256307">]</span>&nbsp;<span class="op" id="2256309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2256313">default</span><span class="op" id="2256320">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2256325">if</span>&nbsp;<span class="ident" id="2256328">c</span><span class="op" id="2256329">,</span>&nbsp;<span class="ident" id="2256331">t</span><span class="op" id="2256332">,</span>&nbsp;<span class="ident" id="2256334">err</span>&nbsp;<span class="op" id="2256338">=</span>&nbsp;<span class="ident" id="2256340">nextRune</span><span class="op" id="2256348">(</span><span class="ident" id="2256349">t</span><span class="op" id="2256350">)</span><span class="op" id="2256351">;</span>&nbsp;<span class="ident" id="2256353">err</span>&nbsp;<span class="op" id="2256357">!=</span>&nbsp;<span class="ident" id="2256360">nil</span>&nbsp;<span class="op" id="2256364">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2256370">return</span>&nbsp;<span class="ident" id="2256377">nil</span><span class="op" id="2256380">,</span>&nbsp;<span class="ident" id="2256382">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2256389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2256394">p</span><span class="op" id="2256395">.</span><span class="ident" id="2256396">literal</span><span class="op" id="2256403">(</span><span class="ident" id="2256404">c</span><span class="op" id="2256405">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2256410">case</span>&nbsp;<span class="string" id="2256415">&#39;(&#39;</span><span class="op" id="2256418">:</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2256423">if</span>&nbsp;<span class="ident" id="2256426">p</span><span class="op" id="2256427">.</span><span class="ident" id="2256428">flags</span><span class="op" id="2256433">&amp;</span><span class="ident" id="2256434">PerlX</span>&nbsp;<span class="op" id="2256440">!=</span>&nbsp;<span class="num" id="2256443">0</span>&nbsp;<span class="op" id="2256445">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2256448">len</span><span class="op" id="2256451">(</span><span class="ident" id="2256452">t</span><span class="op" id="2256453">)</span>&nbsp;<span class="op" id="2256455">&gt;=</span>&nbsp;<span class="num" id="2256458">2</span>&nbsp;<span class="op" id="2256460">&amp;&amp;</span>&nbsp;<span class="ident" id="2256463">t</span><span class="op" id="2256464">[</span><span class="num" id="2256465">1</span><span class="op" id="2256466">]</span>&nbsp;<span class="op" id="2256468">==</span>&nbsp;<span class="string" id="2256471">&#39;?&#39;</span>&nbsp;<span class="op" id="2256475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2256481">//&nbsp;Flag&nbsp;changes&nbsp;and&nbsp;non-capturing&nbsp;groups.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2256527">if</span>&nbsp;<span class="ident" id="2256530">t</span><span class="op" id="2256531">,</span>&nbsp;<span class="ident" id="2256533">err</span>&nbsp;<span class="op" id="2256537">=</span>&nbsp;<span class="ident" id="2256539">p</span><span class="op" id="2256540">.</span><span class="ident" id="2256541">parsePerlFlags</span><span class="op" id="2256555">(</span><span class="ident" id="2256556">t</span><span class="op" id="2256557">)</span><span class="op" id="2256558">;</span>&nbsp;<span class="ident" id="2256560">err</span>&nbsp;<span class="op" id="2256564">!=</span>&nbsp;<span class="ident" id="2256567">nil</span>&nbsp;<span class="op" id="2256571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2256578">return</span>&nbsp;<span class="ident" id="2256585">nil</span><span class="op" id="2256588">,</span>&nbsp;<span class="ident" id="2256590">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2256598">}</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2256604">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2256613">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2256618">p</span><span class="op" id="2256619">.</span><span class="ident" id="2256620">numCap</span><span class="op" id="2256626">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2256632">p</span><span class="op" id="2256633">.</span><span class="ident" id="2256634">op</span><span class="op" id="2256636">(</span><span class="ident" id="2256637">opLeftParen</span><span class="op" id="2256648">)</span><span class="op" id="2256649">.</span><span class="ident" id="2256650">Cap</span>&nbsp;<span class="op" id="2256654">=</span>&nbsp;<span class="ident" id="2256656">p</span><span class="op" id="2256657">.</span><span class="ident" id="2256658">numCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2256668">t</span>&nbsp;<span class="op" id="2256670">=</span>&nbsp;<span class="ident" id="2256672">t</span><span class="op" id="2256673">[</span><span class="num" id="2256674">1</span><span class="op" id="2256675">:</span><span class="op" id="2256676">]</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2256680">case</span>&nbsp;<span class="string" id="2256685">&#39;|&#39;</span><span class="op" id="2256688">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2256693">if</span>&nbsp;<span class="ident" id="2256696">err</span>&nbsp;<span class="op" id="2256700">=</span>&nbsp;<span class="ident" id="2256702">p</span><span class="op" id="2256703">.</span><span class="ident" id="2256704">parseVerticalBar</span><span class="op" id="2256720">(</span><span class="op" id="2256721">)</span><span class="op" id="2256722">;</span>&nbsp;<span class="ident" id="2256724">err</span>&nbsp;<span class="op" id="2256728">!=</span>&nbsp;<span class="ident" id="2256731">nil</span>&nbsp;<span class="op" id="2256735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2256741">return</span>&nbsp;<span class="ident" id="2256748">nil</span><span class="op" id="2256751">,</span>&nbsp;<span class="ident" id="2256753">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2256760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2256765">t</span>&nbsp;<span class="op" id="2256767">=</span>&nbsp;<span class="ident" id="2256769">t</span><span class="op" id="2256770">[</span><span class="num" id="2256771">1</span><span class="op" id="2256772">:</span><span class="op" id="2256773">]</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2256777">case</span>&nbsp;<span class="string" id="2256782">&#39;)&#39;</span><span class="op" id="2256785">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2256790">if</span>&nbsp;<span class="ident" id="2256793">err</span>&nbsp;<span class="op" id="2256797">=</span>&nbsp;<span class="ident" id="2256799">p</span><span class="op" id="2256800">.</span><span class="ident" id="2256801">parseRightParen</span><span class="op" id="2256816">(</span><span class="op" id="2256817">)</span><span class="op" id="2256818">;</span>&nbsp;<span class="ident" id="2256820">err</span>&nbsp;<span class="op" id="2256824">!=</span>&nbsp;<span class="ident" id="2256827">nil</span>&nbsp;<span class="op" id="2256831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2256837">return</span>&nbsp;<span class="ident" id="2256844">nil</span><span class="op" id="2256847">,</span>&nbsp;<span class="ident" id="2256849">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2256856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2256861">t</span>&nbsp;<span class="op" id="2256863">=</span>&nbsp;<span class="ident" id="2256865">t</span><span class="op" id="2256866">[</span><span class="num" id="2256867">1</span><span class="op" id="2256868">:</span><span class="op" id="2256869">]</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2256873">case</span>&nbsp;<span class="string" id="2256878">&#39;^&#39;</span><span class="op" id="2256881">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2256886">if</span>&nbsp;<span class="ident" id="2256889">p</span><span class="op" id="2256890">.</span><span class="ident" id="2256891">flags</span><span class="op" id="2256896">&amp;</span><span class="ident" id="2256897">OneLine</span>&nbsp;<span class="op" id="2256905">!=</span>&nbsp;<span class="num" id="2256908">0</span>&nbsp;<span class="op" id="2256910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2256916">p</span><span class="op" id="2256917">.</span><span class="ident" id="2256918">op</span><span class="op" id="2256920">(</span><span class="ident" id="2256921">OpBeginText</span><span class="op" id="2256932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2256937">}</span>&nbsp;<span class="keyword" id="2256939">else</span>&nbsp;<span class="op" id="2256944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2256950">p</span><span class="op" id="2256951">.</span><span class="ident" id="2256952">op</span><span class="op" id="2256954">(</span><span class="ident" id="2256955">OpBeginLine</span><span class="op" id="2256966">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2256971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2256976">t</span>&nbsp;<span class="op" id="2256978">=</span>&nbsp;<span class="ident" id="2256980">t</span><span class="op" id="2256981">[</span><span class="num" id="2256982">1</span><span class="op" id="2256983">:</span><span class="op" id="2256984">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2256988">case</span>&nbsp;<span class="string" id="2256993">&#39;$&#39;</span><span class="op" id="2256996">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2257001">if</span>&nbsp;<span class="ident" id="2257004">p</span><span class="op" id="2257005">.</span><span class="ident" id="2257006">flags</span><span class="op" id="2257011">&amp;</span><span class="ident" id="2257012">OneLine</span>&nbsp;<span class="op" id="2257020">!=</span>&nbsp;<span class="num" id="2257023">0</span>&nbsp;<span class="op" id="2257025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2257031">p</span><span class="op" id="2257032">.</span><span class="ident" id="2257033">op</span><span class="op" id="2257035">(</span><span class="ident" id="2257036">OpEndText</span><span class="op" id="2257045">)</span><span class="op" id="2257046">.</span><span class="ident" id="2257047">Flags</span>&nbsp;<span class="op" id="2257053">|=</span>&nbsp;<span class="ident" id="2257056">WasDollar</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2257069">}</span>&nbsp;<span class="keyword" id="2257071">else</span>&nbsp;<span class="op" id="2257076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2257082">p</span><span class="op" id="2257083">.</span><span class="ident" id="2257084">op</span><span class="op" id="2257086">(</span><span class="ident" id="2257087">OpEndLine</span><span class="op" id="2257096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2257101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2257106">t</span>&nbsp;<span class="op" id="2257108">=</span>&nbsp;<span class="ident" id="2257110">t</span><span class="op" id="2257111">[</span><span class="num" id="2257112">1</span><span class="op" id="2257113">:</span><span class="op" id="2257114">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2257118">case</span>&nbsp;<span class="string" id="2257123">&#39;.&#39;</span><span class="op" id="2257126">:</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2257131">if</span>&nbsp;<span class="ident" id="2257134">p</span><span class="op" id="2257135">.</span><span class="ident" id="2257136">flags</span><span class="op" id="2257141">&amp;</span><span class="ident" id="2257142">DotNL</span>&nbsp;<span class="op" id="2257148">!=</span>&nbsp;<span class="num" id="2257151">0</span>&nbsp;<span class="op" id="2257153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2257159">p</span><span class="op" id="2257160">.</span><span class="ident" id="2257161">op</span><span class="op" id="2257163">(</span><span class="ident" id="2257164">OpAnyChar</span><span class="op" id="2257173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2257178">}</span>&nbsp;<span class="keyword" id="2257180">else</span>&nbsp;<span class="op" id="2257185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2257191">p</span><span class="op" id="2257192">.</span><span class="ident" id="2257193">op</span><span class="op" id="2257195">(</span><span class="ident" id="2257196">OpAnyCharNotNL</span><span class="op" id="2257210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2257215">}</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2257220">t</span>&nbsp;<span class="op" id="2257222">=</span>&nbsp;<span class="ident" id="2257224">t</span><span class="op" id="2257225">[</span><span class="num" id="2257226">1</span><span class="op" id="2257227">:</span><span class="op" id="2257228">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2257232">case</span>&nbsp;<span class="string" id="2257237">&#39;[&#39;</span><span class="op" id="2257240">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2257245">if</span>&nbsp;<span class="ident" id="2257248">t</span><span class="op" id="2257249">,</span>&nbsp;<span class="ident" id="2257251">err</span>&nbsp;<span class="op" id="2257255">=</span>&nbsp;<span class="ident" id="2257257">p</span><span class="op" id="2257258">.</span><span class="ident" id="2257259">parseClass</span><span class="op" id="2257269">(</span><span class="ident" id="2257270">t</span><span class="op" id="2257271">)</span><span class="op" id="2257272">;</span>&nbsp;<span class="ident" id="2257274">err</span>&nbsp;<span class="op" id="2257278">!=</span>&nbsp;<span class="ident" id="2257281">nil</span>&nbsp;<span class="op" id="2257285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2257291">return</span>&nbsp;<span class="ident" id="2257298">nil</span><span class="op" id="2257301">,</span>&nbsp;<span class="ident" id="2257303">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2257310">}</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2257314">case</span>&nbsp;<span class="string" id="2257319">&#39;*&#39;</span><span class="op" id="2257322">,</span>&nbsp;<span class="string" id="2257324">&#39;+&#39;</span><span class="op" id="2257327">,</span>&nbsp;<span class="string" id="2257329">&#39;?&#39;</span><span class="op" id="2257332">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2257337">before</span>&nbsp;<span class="op" id="2257344">:=</span>&nbsp;<span class="ident" id="2257347">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2257352">switch</span>&nbsp;<span class="ident" id="2257359">t</span><span class="op" id="2257360">[</span><span class="num" id="2257361">0</span><span class="op" id="2257362">]</span>&nbsp;<span class="op" id="2257364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2257369">case</span>&nbsp;<span class="string" id="2257374">&#39;*&#39;</span><span class="op" id="2257377">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2257383">op</span>&nbsp;<span class="op" id="2257386">=</span>&nbsp;<span class="ident" id="2257388">OpStar</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2257398">case</span>&nbsp;<span class="string" id="2257403">&#39;+&#39;</span><span class="op" id="2257406">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2257412">op</span>&nbsp;<span class="op" id="2257415">=</span>&nbsp;<span class="ident" id="2257417">OpPlus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2257427">case</span>&nbsp;<span class="string" id="2257432">&#39;?&#39;</span><span class="op" id="2257435">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2257441">op</span>&nbsp;<span class="op" id="2257444">=</span>&nbsp;<span class="ident" id="2257446">OpQuest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2257457">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2257462">after</span>&nbsp;<span class="op" id="2257468">:=</span>&nbsp;<span class="ident" id="2257471">t</span><span class="op" id="2257472">[</span><span class="num" id="2257473">1</span><span class="op" id="2257474">:</span><span class="op" id="2257475">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2257480">if</span>&nbsp;<span class="ident" id="2257483">after</span><span class="op" id="2257488">,</span>&nbsp;<span class="ident" id="2257490">err</span>&nbsp;<span class="op" id="2257494">=</span>&nbsp;<span class="ident" id="2257496">p</span><span class="op" id="2257497">.</span><span class="ident" id="2257498">repeat</span><span class="op" id="2257504">(</span><span class="ident" id="2257505">op</span><span class="op" id="2257507">,</span>&nbsp;<span class="num" id="2257509">0</span><span class="op" id="2257510">,</span>&nbsp;<span class="num" id="2257512">0</span><span class="op" id="2257513">,</span>&nbsp;<span class="ident" id="2257515">before</span><span class="op" id="2257521">,</span>&nbsp;<span class="ident" id="2257523">after</span><span class="op" id="2257528">,</span>&nbsp;<span class="ident" id="2257530">lastRepeat</span><span class="op" id="2257540">)</span><span class="op" id="2257541">;</span>&nbsp;<span class="ident" id="2257543">err</span>&nbsp;<span class="op" id="2257547">!=</span>&nbsp;<span class="ident" id="2257550">nil</span>&nbsp;<span class="op" id="2257554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2257560">return</span>&nbsp;<span class="ident" id="2257567">nil</span><span class="op" id="2257570">,</span>&nbsp;<span class="ident" id="2257572">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2257579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2257584">repeat</span>&nbsp;<span class="op" id="2257591">=</span>&nbsp;<span class="ident" id="2257593">before</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2257603">t</span>&nbsp;<span class="op" id="2257605">=</span>&nbsp;<span class="ident" id="2257607">after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2257615">case</span>&nbsp;<span class="string" id="2257620">&#39;{&#39;</span><span class="op" id="2257623">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2257628">op</span>&nbsp;<span class="op" id="2257631">=</span>&nbsp;<span class="ident" id="2257633">OpRepeat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2257645">before</span>&nbsp;<span class="op" id="2257652">:=</span>&nbsp;<span class="ident" id="2257655">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2257660">min</span><span class="op" id="2257663">,</span>&nbsp;<span class="ident" id="2257665">max</span><span class="op" id="2257668">,</span>&nbsp;<span class="ident" id="2257670">after</span><span class="op" id="2257675">,</span>&nbsp;<span class="ident" id="2257677">ok</span>&nbsp;<span class="op" id="2257680">:=</span>&nbsp;<span class="ident" id="2257683">p</span><span class="op" id="2257684">.</span><span class="ident" id="2257685">parseRepeat</span><span class="op" id="2257696">(</span><span class="ident" id="2257697">t</span><span class="op" id="2257698">)</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2257703">if</span>&nbsp;<span class="op" id="2257706">!</span><span class="ident" id="2257707">ok</span>&nbsp;<span class="op" id="2257710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2257716">//&nbsp;If&nbsp;the&nbsp;repeat&nbsp;cannot&nbsp;be&nbsp;parsed,&nbsp;{&nbsp;is&nbsp;a&nbsp;literal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2257771">p</span><span class="op" id="2257772">.</span><span class="ident" id="2257773">literal</span><span class="op" id="2257780">(</span><span class="string" id="2257781">&#39;{&#39;</span><span class="op" id="2257784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2257790">t</span>&nbsp;<span class="op" id="2257792">=</span>&nbsp;<span class="ident" id="2257794">t</span><span class="op" id="2257795">[</span><span class="num" id="2257796">1</span><span class="op" id="2257797">:</span><span class="op" id="2257798">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2257804">break</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2257813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2257818">if</span>&nbsp;<span class="ident" id="2257821">min</span>&nbsp;<span class="op" id="2257825">&lt;</span>&nbsp;<span class="num" id="2257827">0</span>&nbsp;<span class="op" id="2257829">||</span>&nbsp;<span class="ident" id="2257832">min</span>&nbsp;<span class="op" id="2257836">&gt;</span>&nbsp;<span class="num" id="2257838">1000</span>&nbsp;<span class="op" id="2257843">||</span>&nbsp;<span class="ident" id="2257846">max</span>&nbsp;<span class="op" id="2257850">&gt;</span>&nbsp;<span class="num" id="2257852">1000</span>&nbsp;<span class="op" id="2257857">||</span>&nbsp;<span class="ident" id="2257860">max</span>&nbsp;<span class="op" id="2257864">&gt;=</span>&nbsp;<span class="num" id="2257867">0</span>&nbsp;<span class="op" id="2257869">&amp;&amp;</span>&nbsp;<span class="ident" id="2257872">min</span>&nbsp;<span class="op" id="2257876">&gt;</span>&nbsp;<span class="ident" id="2257878">max</span>&nbsp;<span class="op" id="2257882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2257888">//&nbsp;Numbers&nbsp;were&nbsp;too&nbsp;big,&nbsp;or&nbsp;max&nbsp;is&nbsp;present&nbsp;and&nbsp;min&nbsp;&gt;&nbsp;max.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2257950">return</span>&nbsp;<span class="ident" id="2257957">nil</span><span class="op" id="2257960">,</span>&nbsp;<span class="op" id="2257962">&amp;</span><span class="ident" id="2257963">Error</span><span class="op" id="2257968">{</span><span class="ident" id="2257969">ErrInvalidRepeatSize</span><span class="op" id="2257989">,</span>&nbsp;<span class="ident" id="2257991">before</span><span class="op" id="2257997">[</span><span class="op" id="2257998">:</span><span class="builtinfunc" id="2257999">len</span><span class="op" id="2258002">(</span><span class="ident" id="2258003">before</span><span class="op" id="2258009">)</span><span class="op" id="2258010">-</span><span class="builtinfunc" id="2258011">len</span><span class="op" id="2258014">(</span><span class="ident" id="2258015">after</span><span class="op" id="2258020">)</span><span class="op" id="2258021">]</span><span class="op" id="2258022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2258027">}</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2258032">if</span>&nbsp;<span class="ident" id="2258035">after</span><span class="op" id="2258040">,</span>&nbsp;<span class="ident" id="2258042">err</span>&nbsp;<span class="op" id="2258046">=</span>&nbsp;<span class="ident" id="2258048">p</span><span class="op" id="2258049">.</span><span class="ident" id="2258050">repeat</span><span class="op" id="2258056">(</span><span class="ident" id="2258057">op</span><span class="op" id="2258059">,</span>&nbsp;<span class="ident" id="2258061">min</span><span class="op" id="2258064">,</span>&nbsp;<span class="ident" id="2258066">max</span><span class="op" id="2258069">,</span>&nbsp;<span class="ident" id="2258071">before</span><span class="op" id="2258077">,</span>&nbsp;<span class="ident" id="2258079">after</span><span class="op" id="2258084">,</span>&nbsp;<span class="ident" id="2258086">lastRepeat</span><span class="op" id="2258096">)</span><span class="op" id="2258097">;</span>&nbsp;<span class="ident" id="2258099">err</span>&nbsp;<span class="op" id="2258103">!=</span>&nbsp;<span class="ident" id="2258106">nil</span>&nbsp;<span class="op" id="2258110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2258116">return</span>&nbsp;<span class="ident" id="2258123">nil</span><span class="op" id="2258126">,</span>&nbsp;<span class="ident" id="2258128">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2258135">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2258140">repeat</span>&nbsp;<span class="op" id="2258147">=</span>&nbsp;<span class="ident" id="2258149">before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2258159">t</span>&nbsp;<span class="op" id="2258161">=</span>&nbsp;<span class="ident" id="2258163">after</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2258171">case</span>&nbsp;<span class="string" id="2258176">&#39;\\&#39;</span><span class="op" id="2258180">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2258185">if</span>&nbsp;<span class="ident" id="2258188">p</span><span class="op" id="2258189">.</span><span class="ident" id="2258190">flags</span><span class="op" id="2258195">&amp;</span><span class="ident" id="2258196">PerlX</span>&nbsp;<span class="op" id="2258202">!=</span>&nbsp;<span class="num" id="2258205">0</span>&nbsp;<span class="op" id="2258207">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2258210">len</span><span class="op" id="2258213">(</span><span class="ident" id="2258214">t</span><span class="op" id="2258215">)</span>&nbsp;<span class="op" id="2258217">&gt;=</span>&nbsp;<span class="num" id="2258220">2</span>&nbsp;<span class="op" id="2258222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2258228">switch</span>&nbsp;<span class="ident" id="2258235">t</span><span class="op" id="2258236">[</span><span class="num" id="2258237">1</span><span class="op" id="2258238">]</span>&nbsp;<span class="op" id="2258240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2258246">case</span>&nbsp;<span class="string" id="2258251">&#39;A&#39;</span><span class="op" id="2258254">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2258261">p</span><span class="op" id="2258262">.</span><span class="ident" id="2258263">op</span><span class="op" id="2258265">(</span><span class="ident" id="2258266">OpBeginText</span><span class="op" id="2258277">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2258284">t</span>&nbsp;<span class="op" id="2258286">=</span>&nbsp;<span class="ident" id="2258288">t</span><span class="op" id="2258289">[</span><span class="num" id="2258290">2</span><span class="op" id="2258291">:</span><span class="op" id="2258292">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2258299">break</span>&nbsp;<span class="ident" id="2258305">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2258319">case</span>&nbsp;<span class="string" id="2258324">&#39;b&#39;</span><span class="op" id="2258327">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2258334">p</span><span class="op" id="2258335">.</span><span class="ident" id="2258336">op</span><span class="op" id="2258338">(</span><span class="ident" id="2258339">OpWordBoundary</span><span class="op" id="2258353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2258360">t</span>&nbsp;<span class="op" id="2258362">=</span>&nbsp;<span class="ident" id="2258364">t</span><span class="op" id="2258365">[</span><span class="num" id="2258366">2</span><span class="op" id="2258367">:</span><span class="op" id="2258368">]</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2258375">break</span>&nbsp;<span class="ident" id="2258381">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2258395">case</span>&nbsp;<span class="string" id="2258400">&#39;B&#39;</span><span class="op" id="2258403">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2258410">p</span><span class="op" id="2258411">.</span><span class="ident" id="2258412">op</span><span class="op" id="2258414">(</span><span class="ident" id="2258415">OpNoWordBoundary</span><span class="op" id="2258431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2258438">t</span>&nbsp;<span class="op" id="2258440">=</span>&nbsp;<span class="ident" id="2258442">t</span><span class="op" id="2258443">[</span><span class="num" id="2258444">2</span><span class="op" id="2258445">:</span><span class="op" id="2258446">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2258453">break</span>&nbsp;<span class="ident" id="2258459">BigSwitch</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2258473">case</span>&nbsp;<span class="string" id="2258478">&#39;C&#39;</span><span class="op" id="2258481">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2258488">//&nbsp;any&nbsp;byte;&nbsp;not&nbsp;supported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2258520">return</span>&nbsp;<span class="ident" id="2258527">nil</span><span class="op" id="2258530">,</span>&nbsp;<span class="op" id="2258532">&amp;</span><span class="ident" id="2258533">Error</span><span class="op" id="2258538">{</span><span class="ident" id="2258539">ErrInvalidEscape</span><span class="op" id="2258555">,</span>&nbsp;<span class="ident" id="2258557">t</span><span class="op" id="2258558">[</span><span class="op" id="2258559">:</span><span class="num" id="2258560">2</span><span class="op" id="2258561">]</span><span class="op" id="2258562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2258568">case</span>&nbsp;<span class="string" id="2258573">&#39;Q&#39;</span><span class="op" id="2258576">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2258583">//&nbsp;\Q&nbsp;...&nbsp;\E:&nbsp;the&nbsp;...&nbsp;is&nbsp;always&nbsp;literals</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2258629">var</span>&nbsp;<span class="ident" id="2258633">lit</span>&nbsp;<span class="builtintype" id="2258637">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2258649">if</span>&nbsp;<span class="ident" id="2258652">i</span>&nbsp;<span class="op" id="2258654">:=</span>&nbsp;<span class="ident" id="2258657">strings</span><span class="op" id="2258664">.</span><span class="ident" id="2258665">Index</span><span class="op" id="2258670">(</span><span class="ident" id="2258671">t</span><span class="op" id="2258672">,</span>&nbsp;<span class="string" id="2258674">`\E`</span><span class="op" id="2258678">)</span><span class="op" id="2258679">;</span>&nbsp;<span class="ident" id="2258681">i</span>&nbsp;<span class="op" id="2258683">&lt;</span>&nbsp;<span class="num" id="2258685">0</span>&nbsp;<span class="op" id="2258687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2258695">lit</span>&nbsp;<span class="op" id="2258699">=</span>&nbsp;<span class="ident" id="2258701">t</span><span class="op" id="2258702">[</span><span class="num" id="2258703">2</span><span class="op" id="2258704">:</span><span class="op" id="2258705">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2258713">t</span>&nbsp;<span class="op" id="2258715">=</span>&nbsp;<span class="string" id="2258717">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2258725">}</span>&nbsp;<span class="keyword" id="2258727">else</span>&nbsp;<span class="op" id="2258732">{</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2258740">lit</span>&nbsp;<span class="op" id="2258744">=</span>&nbsp;<span class="ident" id="2258746">t</span><span class="op" id="2258747">[</span><span class="num" id="2258748">2</span><span class="op" id="2258749">:</span><span class="ident" id="2258750">i</span><span class="op" id="2258751">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2258759">t</span>&nbsp;<span class="op" id="2258761">=</span>&nbsp;<span class="ident" id="2258763">t</span><span class="op" id="2258764">[</span><span class="ident" id="2258765">i</span><span class="op" id="2258766">+</span><span class="num" id="2258767">2</span><span class="op" id="2258768">:</span><span class="op" id="2258769">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2258776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2258783">p</span><span class="op" id="2258784">.</span><span class="ident" id="2258785">push</span><span class="op" id="2258789">(</span><span class="ident" id="2258790">literalRegexp</span><span class="op" id="2258803">(</span><span class="ident" id="2258804">lit</span><span class="op" id="2258807">,</span>&nbsp;<span class="ident" id="2258809">p</span><span class="op" id="2258810">.</span><span class="ident" id="2258811">flags</span><span class="op" id="2258816">)</span><span class="op" id="2258817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2258824">break</span>&nbsp;<span class="ident" id="2258830">BigSwitch</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2258844">case</span>&nbsp;<span class="string" id="2258849">&#39;z&#39;</span><span class="op" id="2258852">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2258859">p</span><span class="op" id="2258860">.</span><span class="ident" id="2258861">op</span><span class="op" id="2258863">(</span><span class="ident" id="2258864">OpEndText</span><span class="op" id="2258873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2258880">t</span>&nbsp;<span class="op" id="2258882">=</span>&nbsp;<span class="ident" id="2258884">t</span><span class="op" id="2258885">[</span><span class="num" id="2258886">2</span><span class="op" id="2258887">:</span><span class="op" id="2258888">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2258895">break</span>&nbsp;<span class="ident" id="2258901">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2258915">}</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2258920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2258926">re</span>&nbsp;<span class="op" id="2258929">:=</span>&nbsp;<span class="ident" id="2258932">p</span><span class="op" id="2258933">.</span><span class="ident" id="2258934">newRegexp</span><span class="op" id="2258943">(</span><span class="ident" id="2258944">OpCharClass</span><span class="op" id="2258955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2258960">re</span><span class="op" id="2258962">.</span><span class="ident" id="2258963">Flags</span>&nbsp;<span class="op" id="2258969">=</span>&nbsp;<span class="ident" id="2258971">p</span><span class="op" id="2258972">.</span><span class="ident" id="2258973">flags</span><br>
<span class="lineno"></span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2258983">//&nbsp;Look&nbsp;for&nbsp;Unicode&nbsp;character&nbsp;group&nbsp;like&nbsp;\p{Han}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2259035">if</span>&nbsp;<span class="builtinfunc" id="2259038">len</span><span class="op" id="2259041">(</span><span class="ident" id="2259042">t</span><span class="op" id="2259043">)</span>&nbsp;<span class="op" id="2259045">&gt;=</span>&nbsp;<span class="num" id="2259048">2</span>&nbsp;<span class="op" id="2259050">&amp;&amp;</span>&nbsp;<span class="op" id="2259053">(</span><span class="ident" id="2259054">t</span><span class="op" id="2259055">[</span><span class="num" id="2259056">1</span><span class="op" id="2259057">]</span>&nbsp;<span class="op" id="2259059">==</span>&nbsp;<span class="string" id="2259062">&#39;p&#39;</span>&nbsp;<span class="op" id="2259066">||</span>&nbsp;<span class="ident" id="2259069">t</span><span class="op" id="2259070">[</span><span class="num" id="2259071">1</span><span class="op" id="2259072">]</span>&nbsp;<span class="op" id="2259074">==</span>&nbsp;<span class="string" id="2259077">&#39;P&#39;</span><span class="op" id="2259080">)</span>&nbsp;<span class="op" id="2259082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2259088">r</span><span class="op" id="2259089">,</span>&nbsp;<span class="ident" id="2259091">rest</span><span class="op" id="2259095">,</span>&nbsp;<span class="ident" id="2259097">err</span>&nbsp;<span class="op" id="2259101">:=</span>&nbsp;<span class="ident" id="2259104">p</span><span class="op" id="2259105">.</span><span class="ident" id="2259106">parseUnicodeClass</span><span class="op" id="2259123">(</span><span class="ident" id="2259124">t</span><span class="op" id="2259125">,</span>&nbsp;<span class="ident" id="2259127">re</span><span class="op" id="2259129">.</span><span class="ident" id="2259130">Rune0</span><span class="op" id="2259135">[</span><span class="op" id="2259136">:</span><span class="num" id="2259137">0</span><span class="op" id="2259138">]</span><span class="op" id="2259139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2259145">if</span>&nbsp;<span class="ident" id="2259148">err</span>&nbsp;<span class="op" id="2259152">!=</span>&nbsp;<span class="ident" id="2259155">nil</span>&nbsp;<span class="op" id="2259159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2259166">return</span>&nbsp;<span class="ident" id="2259173">nil</span><span class="op" id="2259176">,</span>&nbsp;<span class="ident" id="2259178">err</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2259186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2259192">if</span>&nbsp;<span class="ident" id="2259195">r</span>&nbsp;<span class="op" id="2259197">!=</span>&nbsp;<span class="ident" id="2259200">nil</span>&nbsp;<span class="op" id="2259204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2259211">re</span><span class="op" id="2259213">.</span><span class="ident" id="2259214">Rune</span>&nbsp;<span class="op" id="2259219">=</span>&nbsp;<span class="ident" id="2259221">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2259228">t</span>&nbsp;<span class="op" id="2259230">=</span>&nbsp;<span class="ident" id="2259232">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2259242">p</span><span class="op" id="2259243">.</span><span class="ident" id="2259244">push</span><span class="op" id="2259248">(</span><span class="ident" id="2259249">re</span><span class="op" id="2259251">)</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2259258">break</span>&nbsp;<span class="ident" id="2259264">BigSwitch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2259278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2259283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2259289">//&nbsp;Perl&nbsp;character&nbsp;class&nbsp;escape.</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2259324">if</span>&nbsp;<span class="ident" id="2259327">r</span><span class="op" id="2259328">,</span>&nbsp;<span class="ident" id="2259330">rest</span>&nbsp;<span class="op" id="2259335">:=</span>&nbsp;<span class="ident" id="2259338">p</span><span class="op" id="2259339">.</span><span class="ident" id="2259340">parsePerlClassEscape</span><span class="op" id="2259360">(</span><span class="ident" id="2259361">t</span><span class="op" id="2259362">,</span>&nbsp;<span class="ident" id="2259364">re</span><span class="op" id="2259366">.</span><span class="ident" id="2259367">Rune0</span><span class="op" id="2259372">[</span><span class="op" id="2259373">:</span><span class="num" id="2259374">0</span><span class="op" id="2259375">]</span><span class="op" id="2259376">)</span><span class="op" id="2259377">;</span>&nbsp;<span class="ident" id="2259379">r</span>&nbsp;<span class="op" id="2259381">!=</span>&nbsp;<span class="ident" id="2259384">nil</span>&nbsp;<span class="op" id="2259388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2259394">re</span><span class="op" id="2259396">.</span><span class="ident" id="2259397">Rune</span>&nbsp;<span class="op" id="2259402">=</span>&nbsp;<span class="ident" id="2259404">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2259410">t</span>&nbsp;<span class="op" id="2259412">=</span>&nbsp;<span class="ident" id="2259414">rest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2259423">p</span><span class="op" id="2259424">.</span><span class="ident" id="2259425">push</span><span class="op" id="2259429">(</span><span class="ident" id="2259430">re</span><span class="op" id="2259432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2259438">break</span>&nbsp;<span class="ident" id="2259444">BigSwitch</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2259457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2259462">p</span><span class="op" id="2259463">.</span><span class="ident" id="2259464">reuse</span><span class="op" id="2259469">(</span><span class="ident" id="2259470">re</span><span class="op" id="2259472">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2259478">//&nbsp;Ordinary&nbsp;single-character&nbsp;escape.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2259518">if</span>&nbsp;<span class="ident" id="2259521">c</span><span class="op" id="2259522">,</span>&nbsp;<span class="ident" id="2259524">t</span><span class="op" id="2259525">,</span>&nbsp;<span class="ident" id="2259527">err</span>&nbsp;<span class="op" id="2259531">=</span>&nbsp;<span class="ident" id="2259533">p</span><span class="op" id="2259534">.</span><span class="ident" id="2259535">parseEscape</span><span class="op" id="2259546">(</span><span class="ident" id="2259547">t</span><span class="op" id="2259548">)</span><span class="op" id="2259549">;</span>&nbsp;<span class="ident" id="2259551">err</span>&nbsp;<span class="op" id="2259555">!=</span>&nbsp;<span class="ident" id="2259558">nil</span>&nbsp;<span class="op" id="2259562">{</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2259568">return</span>&nbsp;<span class="ident" id="2259575">nil</span><span class="op" id="2259578">,</span>&nbsp;<span class="ident" id="2259580">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2259587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2259592">p</span><span class="op" id="2259593">.</span><span class="ident" id="2259594">literal</span><span class="op" id="2259601">(</span><span class="ident" id="2259602">c</span><span class="op" id="2259603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2259607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2259611">lastRepeat</span>&nbsp;<span class="op" id="2259622">=</span>&nbsp;<span class="ident" id="2259624">repeat</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2259632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2259636">p</span><span class="op" id="2259637">.</span><span class="ident" id="2259638">concat</span><span class="op" id="2259644">(</span><span class="op" id="2259645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2259648">if</span>&nbsp;<span class="ident" id="2259651">p</span><span class="op" id="2259652">.</span><span class="ident" id="2259653">swapVerticalBar</span><span class="op" id="2259668">(</span><span class="op" id="2259669">)</span>&nbsp;<span class="op" id="2259671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2259675">//&nbsp;pop&nbsp;vertical&nbsp;bar</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2259697">p</span><span class="op" id="2259698">.</span><span class="ident" id="2259699">stack</span>&nbsp;<span class="op" id="2259705">=</span>&nbsp;<span class="ident" id="2259707">p</span><span class="op" id="2259708">.</span><span class="ident" id="2259709">stack</span><span class="op" id="2259714">[</span><span class="op" id="2259715">:</span><span class="builtinfunc" id="2259716">len</span><span class="op" id="2259719">(</span><span class="ident" id="2259720">p</span><span class="op" id="2259721">.</span><span class="ident" id="2259722">stack</span><span class="op" id="2259727">)</span><span class="op" id="2259728">-</span><span class="num" id="2259729">1</span><span class="op" id="2259730">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2259733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2259736">p</span><span class="op" id="2259737">.</span><span class="ident" id="2259738">alternate</span><span class="op" id="2259747">(</span><span class="op" id="2259748">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2259752">n</span>&nbsp;<span class="op" id="2259754">:=</span>&nbsp;<span class="builtinfunc" id="2259757">len</span><span class="op" id="2259760">(</span><span class="ident" id="2259761">p</span><span class="op" id="2259762">.</span><span class="ident" id="2259763">stack</span><span class="op" id="2259768">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2259771">if</span>&nbsp;<span class="ident" id="2259774">n</span>&nbsp;<span class="op" id="2259776">!=</span>&nbsp;<span class="num" id="2259779">1</span>&nbsp;<span class="op" id="2259781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2259785">return</span>&nbsp;<span class="ident" id="2259792">nil</span><span class="op" id="2259795">,</span>&nbsp;<span class="op" id="2259797">&amp;</span><span class="ident" id="2259798">Error</span><span class="op" id="2259803">{</span><span class="ident" id="2259804">ErrMissingParen</span><span class="op" id="2259819">,</span>&nbsp;<span class="ident" id="2259821">s</span><span class="op" id="2259822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2259825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2259828">return</span>&nbsp;<span class="ident" id="2259835">p</span><span class="op" id="2259836">.</span><span class="ident" id="2259837">stack</span><span class="op" id="2259842">[</span><span class="num" id="2259843">0</span><span class="op" id="2259844">]</span><span class="op" id="2259845">,</span>&nbsp;<span class="ident" id="2259847">nil</span><br>
<span class="lineno"></span><span class="op" id="2259851">}</span><br>
<span class="lineno">890</span><br>
<span class="lineno"></span><span class="comment" id="2259854">//&nbsp;parseRepeat&nbsp;parses&nbsp;{min}&nbsp;(max=min)&nbsp;or&nbsp;{min,}&nbsp;(max=-1)&nbsp;or&nbsp;{min,max}.</span><br>
<span class="lineno"></span><span class="comment" id="2259925">//&nbsp;If&nbsp;s&nbsp;is&nbsp;not&nbsp;of&nbsp;that&nbsp;form,&nbsp;it&nbsp;returns&nbsp;ok&nbsp;==&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="2259978">//&nbsp;If&nbsp;s&nbsp;has&nbsp;the&nbsp;right&nbsp;form&nbsp;but&nbsp;the&nbsp;values&nbsp;are&nbsp;too&nbsp;big,&nbsp;it&nbsp;returns&nbsp;min&nbsp;==&nbsp;-1,&nbsp;ok&nbsp;==&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="2260067">func</span>&nbsp;<span class="op" id="2260072">(</span><span class="ident" id="2260073">p</span>&nbsp;<span class="op" id="2260075">*</span><span class="ident" id="2260076">parser</span><span class="op" id="2260082">)</span>&nbsp;<span class="ident" id="2260084">parseRepeat</span><span class="op" id="2260095">(</span><span class="ident" id="2260096">s</span>&nbsp;<span class="builtintype" id="2260098">string</span><span class="op" id="2260104">)</span>&nbsp;<span class="op" id="2260106">(</span><span class="ident" id="2260107">min</span><span class="op" id="2260110">,</span>&nbsp;<span class="ident" id="2260112">max</span>&nbsp;<span class="builtintype" id="2260116">int</span><span class="op" id="2260119">,</span>&nbsp;<span class="ident" id="2260121">rest</span>&nbsp;<span class="builtintype" id="2260126">string</span><span class="op" id="2260132">,</span>&nbsp;<span class="ident" id="2260134">ok</span>&nbsp;<span class="builtintype" id="2260137">bool</span><span class="op" id="2260141">)</span>&nbsp;<span class="op" id="2260143">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2260146">if</span>&nbsp;<span class="ident" id="2260149">s</span>&nbsp;<span class="op" id="2260151">==</span>&nbsp;<span class="string" id="2260154">&#34;&#34;</span>&nbsp;<span class="op" id="2260157">||</span>&nbsp;<span class="ident" id="2260160">s</span><span class="op" id="2260161">[</span><span class="num" id="2260162">0</span><span class="op" id="2260163">]</span>&nbsp;<span class="op" id="2260165">!=</span>&nbsp;<span class="string" id="2260168">&#39;{&#39;</span>&nbsp;<span class="op" id="2260172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2260176">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2260184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2260187">s</span>&nbsp;<span class="op" id="2260189">=</span>&nbsp;<span class="ident" id="2260191">s</span><span class="op" id="2260192">[</span><span class="num" id="2260193">1</span><span class="op" id="2260194">:</span><span class="op" id="2260195">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2260198">var</span>&nbsp;<span class="ident" id="2260202">ok1</span>&nbsp;<span class="builtintype" id="2260206">bool</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2260212">if</span>&nbsp;<span class="ident" id="2260215">min</span><span class="op" id="2260218">,</span>&nbsp;<span class="ident" id="2260220">s</span><span class="op" id="2260221">,</span>&nbsp;<span class="ident" id="2260223">ok1</span>&nbsp;<span class="op" id="2260227">=</span>&nbsp;<span class="ident" id="2260229">p</span><span class="op" id="2260230">.</span><span class="ident" id="2260231">parseInt</span><span class="op" id="2260239">(</span><span class="ident" id="2260240">s</span><span class="op" id="2260241">)</span><span class="op" id="2260242">;</span>&nbsp;<span class="op" id="2260244">!</span><span class="ident" id="2260245">ok1</span>&nbsp;<span class="op" id="2260249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2260253">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2260261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2260264">if</span>&nbsp;<span class="ident" id="2260267">s</span>&nbsp;<span class="op" id="2260269">==</span>&nbsp;<span class="string" id="2260272">&#34;&#34;</span>&nbsp;<span class="op" id="2260275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2260279">return</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2260287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2260290">if</span>&nbsp;<span class="ident" id="2260293">s</span><span class="op" id="2260294">[</span><span class="num" id="2260295">0</span><span class="op" id="2260296">]</span>&nbsp;<span class="op" id="2260298">!=</span>&nbsp;<span class="string" id="2260301">&#39;,&#39;</span>&nbsp;<span class="op" id="2260305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2260309">max</span>&nbsp;<span class="op" id="2260313">=</span>&nbsp;<span class="ident" id="2260315">min</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2260320">}</span>&nbsp;<span class="keyword" id="2260322">else</span>&nbsp;<span class="op" id="2260327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2260331">s</span>&nbsp;<span class="op" id="2260333">=</span>&nbsp;<span class="ident" id="2260335">s</span><span class="op" id="2260336">[</span><span class="num" id="2260337">1</span><span class="op" id="2260338">:</span><span class="op" id="2260339">]</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2260343">if</span>&nbsp;<span class="ident" id="2260346">s</span>&nbsp;<span class="op" id="2260348">==</span>&nbsp;<span class="string" id="2260351">&#34;&#34;</span>&nbsp;<span class="op" id="2260354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2260359">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2260368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2260372">if</span>&nbsp;<span class="ident" id="2260375">s</span><span class="op" id="2260376">[</span><span class="num" id="2260377">0</span><span class="op" id="2260378">]</span>&nbsp;<span class="op" id="2260380">==</span>&nbsp;<span class="string" id="2260383">&#39;}&#39;</span>&nbsp;<span class="op" id="2260387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2260392">max</span>&nbsp;<span class="op" id="2260396">=</span>&nbsp;<span class="op" id="2260398">-</span><span class="num" id="2260399">1</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2260403">}</span>&nbsp;<span class="keyword" id="2260405">else</span>&nbsp;<span class="keyword" id="2260410">if</span>&nbsp;<span class="ident" id="2260413">max</span><span class="op" id="2260416">,</span>&nbsp;<span class="ident" id="2260418">s</span><span class="op" id="2260419">,</span>&nbsp;<span class="ident" id="2260421">ok1</span>&nbsp;<span class="op" id="2260425">=</span>&nbsp;<span class="ident" id="2260427">p</span><span class="op" id="2260428">.</span><span class="ident" id="2260429">parseInt</span><span class="op" id="2260437">(</span><span class="ident" id="2260438">s</span><span class="op" id="2260439">)</span><span class="op" id="2260440">;</span>&nbsp;<span class="op" id="2260442">!</span><span class="ident" id="2260443">ok1</span>&nbsp;<span class="op" id="2260447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2260452">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2260461">}</span>&nbsp;<span class="keyword" id="2260463">else</span>&nbsp;<span class="keyword" id="2260468">if</span>&nbsp;<span class="ident" id="2260471">max</span>&nbsp;<span class="op" id="2260475">&lt;</span>&nbsp;<span class="num" id="2260477">0</span>&nbsp;<span class="op" id="2260479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2260484">//&nbsp;parseInt&nbsp;found&nbsp;too&nbsp;big&nbsp;a&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2260522">min</span>&nbsp;<span class="op" id="2260526">=</span>&nbsp;<span class="op" id="2260528">-</span><span class="num" id="2260529">1</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2260533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2260536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2260539">if</span>&nbsp;<span class="ident" id="2260542">s</span>&nbsp;<span class="op" id="2260544">==</span>&nbsp;<span class="string" id="2260547">&#34;&#34;</span>&nbsp;<span class="op" id="2260550">||</span>&nbsp;<span class="ident" id="2260553">s</span><span class="op" id="2260554">[</span><span class="num" id="2260555">0</span><span class="op" id="2260556">]</span>&nbsp;<span class="op" id="2260558">!=</span>&nbsp;<span class="string" id="2260561">&#39;}&#39;</span>&nbsp;<span class="op" id="2260565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2260569">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2260577">}</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2260580">rest</span>&nbsp;<span class="op" id="2260585">=</span>&nbsp;<span class="ident" id="2260587">s</span><span class="op" id="2260588">[</span><span class="num" id="2260589">1</span><span class="op" id="2260590">:</span><span class="op" id="2260591">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2260594">ok</span>&nbsp;<span class="op" id="2260597">=</span>&nbsp;<span class="builtintype" id="2260599">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2260605">return</span><br>
<span class="lineno"></span><span class="op" id="2260612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">930</span><span class="comment" id="2260615">//&nbsp;parsePerlFlags&nbsp;parses&nbsp;a&nbsp;Perl&nbsp;flag&nbsp;setting&nbsp;or&nbsp;non-capturing&nbsp;group&nbsp;or&nbsp;both,</span><br>
<span class="lineno"></span><span class="comment" id="2260692">//&nbsp;like&nbsp;(?i)&nbsp;or&nbsp;(?:&nbsp;or&nbsp;(?i:.&nbsp;&nbsp;It&nbsp;removes&nbsp;the&nbsp;prefix&nbsp;from&nbsp;s&nbsp;and&nbsp;updates&nbsp;the&nbsp;parse&nbsp;state.</span><br>
<span class="lineno"></span><span class="comment" id="2260780">//&nbsp;The&nbsp;caller&nbsp;must&nbsp;have&nbsp;ensured&nbsp;that&nbsp;s&nbsp;begins&nbsp;with&nbsp;&#34;(?&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="2260837">func</span>&nbsp;<span class="op" id="2260842">(</span><span class="ident" id="2260843">p</span>&nbsp;<span class="op" id="2260845">*</span><span class="ident" id="2260846">parser</span><span class="op" id="2260852">)</span>&nbsp;<span class="ident" id="2260854">parsePerlFlags</span><span class="op" id="2260868">(</span><span class="ident" id="2260869">s</span>&nbsp;<span class="builtintype" id="2260871">string</span><span class="op" id="2260877">)</span>&nbsp;<span class="op" id="2260879">(</span><span class="ident" id="2260880">rest</span>&nbsp;<span class="builtintype" id="2260885">string</span><span class="op" id="2260891">,</span>&nbsp;<span class="ident" id="2260893">err</span>&nbsp;<span class="builtintype" id="2260897">error</span><span class="op" id="2260902">)</span>&nbsp;<span class="op" id="2260904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2260907">t</span>&nbsp;<span class="op" id="2260909">:=</span>&nbsp;<span class="ident" id="2260912">s</span><br>
<span class="lineno">935</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2260916">//&nbsp;Check&nbsp;for&nbsp;named&nbsp;captures,&nbsp;first&nbsp;introduced&nbsp;in&nbsp;Python&#39;s&nbsp;regexp&nbsp;library.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2260991">//&nbsp;As&nbsp;usual,&nbsp;there&nbsp;are&nbsp;three&nbsp;slightly&nbsp;different&nbsp;syntaxes:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2261050">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2261054">//&nbsp;&nbsp;&nbsp;(?P&lt;name&gt;expr)&nbsp;&nbsp;&nbsp;the&nbsp;original,&nbsp;introduced&nbsp;by&nbsp;Python</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2261112">//&nbsp;&nbsp;&nbsp;(?&lt;name&gt;expr)&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;.NET&nbsp;alteration,&nbsp;adopted&nbsp;by&nbsp;Perl&nbsp;5.10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2261177">//&nbsp;&nbsp;&nbsp;(?&#39;name&#39;expr)&nbsp;&nbsp;&nbsp;&nbsp;another&nbsp;.NET&nbsp;alteration,&nbsp;adopted&nbsp;by&nbsp;Perl&nbsp;5.10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2261246">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2261250">//&nbsp;Perl&nbsp;5.10&nbsp;gave&nbsp;in&nbsp;and&nbsp;implemented&nbsp;the&nbsp;Python&nbsp;version&nbsp;too,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2261312">//&nbsp;but&nbsp;they&nbsp;claim&nbsp;that&nbsp;the&nbsp;last&nbsp;two&nbsp;are&nbsp;the&nbsp;preferred&nbsp;forms.</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2261374">//&nbsp;PCRE&nbsp;and&nbsp;languages&nbsp;based&nbsp;on&nbsp;it&nbsp;(specifically,&nbsp;PHP&nbsp;and&nbsp;Ruby)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2261438">//&nbsp;support&nbsp;all&nbsp;three&nbsp;as&nbsp;well.&nbsp;&nbsp;EcmaScript&nbsp;4&nbsp;uses&nbsp;only&nbsp;the&nbsp;Python&nbsp;form.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2261510">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2261514">//&nbsp;In&nbsp;both&nbsp;the&nbsp;open&nbsp;source&nbsp;world&nbsp;(via&nbsp;Code&nbsp;Search)&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2261574">//&nbsp;Google&nbsp;source&nbsp;tree,&nbsp;(?P&lt;expr&gt;name)&nbsp;is&nbsp;the&nbsp;dominant&nbsp;form,</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2261635">//&nbsp;so&nbsp;that&#39;s&nbsp;the&nbsp;one&nbsp;we&nbsp;implement.&nbsp;&nbsp;One&nbsp;is&nbsp;enough.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2261687">if</span>&nbsp;<span class="builtinfunc" id="2261690">len</span><span class="op" id="2261693">(</span><span class="ident" id="2261694">t</span><span class="op" id="2261695">)</span>&nbsp;<span class="op" id="2261697">&gt;</span>&nbsp;<span class="num" id="2261699">4</span>&nbsp;<span class="op" id="2261701">&amp;&amp;</span>&nbsp;<span class="ident" id="2261704">t</span><span class="op" id="2261705">[</span><span class="num" id="2261706">2</span><span class="op" id="2261707">]</span>&nbsp;<span class="op" id="2261709">==</span>&nbsp;<span class="string" id="2261712">&#39;P&#39;</span>&nbsp;<span class="op" id="2261716">&amp;&amp;</span>&nbsp;<span class="ident" id="2261719">t</span><span class="op" id="2261720">[</span><span class="num" id="2261721">3</span><span class="op" id="2261722">]</span>&nbsp;<span class="op" id="2261724">==</span>&nbsp;<span class="string" id="2261727">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="2261731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2261735">//&nbsp;Pull&nbsp;out&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2261755">end</span>&nbsp;<span class="op" id="2261759">:=</span>&nbsp;<span class="ident" id="2261762">strings</span><span class="op" id="2261769">.</span><span class="ident" id="2261770">IndexRune</span><span class="op" id="2261779">(</span><span class="ident" id="2261780">t</span><span class="op" id="2261781">,</span>&nbsp;<span class="string" id="2261783">&#39;&gt;&#39;</span><span class="op" id="2261786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2261790">if</span>&nbsp;<span class="ident" id="2261793">end</span>&nbsp;<span class="op" id="2261797">&lt;</span>&nbsp;<span class="num" id="2261799">0</span>&nbsp;<span class="op" id="2261801">{</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2261806">if</span>&nbsp;<span class="ident" id="2261809">err</span>&nbsp;<span class="op" id="2261813">=</span>&nbsp;<span class="ident" id="2261815">checkUTF8</span><span class="op" id="2261824">(</span><span class="ident" id="2261825">t</span><span class="op" id="2261826">)</span><span class="op" id="2261827">;</span>&nbsp;<span class="ident" id="2261829">err</span>&nbsp;<span class="op" id="2261833">!=</span>&nbsp;<span class="ident" id="2261836">nil</span>&nbsp;<span class="op" id="2261840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2261846">return</span>&nbsp;<span class="string" id="2261853">&#34;&#34;</span><span class="op" id="2261855">,</span>&nbsp;<span class="ident" id="2261857">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2261864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2261869">return</span>&nbsp;<span class="string" id="2261876">&#34;&#34;</span><span class="op" id="2261878">,</span>&nbsp;<span class="op" id="2261880">&amp;</span><span class="ident" id="2261881">Error</span><span class="op" id="2261886">{</span><span class="ident" id="2261887">ErrInvalidNamedCapture</span><span class="op" id="2261909">,</span>&nbsp;<span class="ident" id="2261911">s</span><span class="op" id="2261912">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2261916">}</span><br>
<span class="lineno">960</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2261921">capture</span>&nbsp;<span class="op" id="2261929">:=</span>&nbsp;<span class="ident" id="2261932">t</span><span class="op" id="2261933">[</span><span class="op" id="2261934">:</span><span class="ident" id="2261935">end</span><span class="op" id="2261938">+</span><span class="num" id="2261939">1</span><span class="op" id="2261940">]</span>&nbsp;<span class="comment" id="2261942">//&nbsp;&#34;(?P&lt;name&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2261959">name</span>&nbsp;<span class="op" id="2261964">:=</span>&nbsp;<span class="ident" id="2261967">t</span><span class="op" id="2261968">[</span><span class="num" id="2261969">4</span><span class="op" id="2261970">:</span><span class="ident" id="2261971">end</span><span class="op" id="2261974">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2261980">//&nbsp;&#34;name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2261992">if</span>&nbsp;<span class="ident" id="2261995">err</span>&nbsp;<span class="op" id="2261999">=</span>&nbsp;<span class="ident" id="2262001">checkUTF8</span><span class="op" id="2262010">(</span><span class="ident" id="2262011">name</span><span class="op" id="2262015">)</span><span class="op" id="2262016">;</span>&nbsp;<span class="ident" id="2262018">err</span>&nbsp;<span class="op" id="2262022">!=</span>&nbsp;<span class="ident" id="2262025">nil</span>&nbsp;<span class="op" id="2262029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262034">return</span>&nbsp;<span class="string" id="2262041">&#34;&#34;</span><span class="op" id="2262043">,</span>&nbsp;<span class="ident" id="2262045">err</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2262051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262055">if</span>&nbsp;<span class="op" id="2262058">!</span><span class="ident" id="2262059">isValidCaptureName</span><span class="op" id="2262077">(</span><span class="ident" id="2262078">name</span><span class="op" id="2262082">)</span>&nbsp;<span class="op" id="2262084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262089">return</span>&nbsp;<span class="string" id="2262096">&#34;&#34;</span><span class="op" id="2262098">,</span>&nbsp;<span class="op" id="2262100">&amp;</span><span class="ident" id="2262101">Error</span><span class="op" id="2262106">{</span><span class="ident" id="2262107">ErrInvalidNamedCapture</span><span class="op" id="2262129">,</span>&nbsp;<span class="ident" id="2262131">capture</span><span class="op" id="2262138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2262142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2262147">//&nbsp;Like&nbsp;ordinary&nbsp;capture,&nbsp;but&nbsp;named.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2262186">p</span><span class="op" id="2262187">.</span><span class="ident" id="2262188">numCap</span><span class="op" id="2262194">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2262199">re</span>&nbsp;<span class="op" id="2262202">:=</span>&nbsp;<span class="ident" id="2262205">p</span><span class="op" id="2262206">.</span><span class="ident" id="2262207">op</span><span class="op" id="2262209">(</span><span class="ident" id="2262210">opLeftParen</span><span class="op" id="2262221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2262225">re</span><span class="op" id="2262227">.</span><span class="ident" id="2262228">Cap</span>&nbsp;<span class="op" id="2262232">=</span>&nbsp;<span class="ident" id="2262234">p</span><span class="op" id="2262235">.</span><span class="ident" id="2262236">numCap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2262245">re</span><span class="op" id="2262247">.</span><span class="ident" id="2262248">Name</span>&nbsp;<span class="op" id="2262253">=</span>&nbsp;<span class="ident" id="2262255">name</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262262">return</span>&nbsp;<span class="ident" id="2262269">t</span><span class="op" id="2262270">[</span><span class="ident" id="2262271">end</span><span class="op" id="2262274">+</span><span class="num" id="2262275">1</span><span class="op" id="2262276">:</span><span class="op" id="2262277">]</span><span class="op" id="2262278">,</span>&nbsp;<span class="ident" id="2262280">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2262285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2262289">//&nbsp;Non-capturing&nbsp;group.&nbsp;&nbsp;Might&nbsp;also&nbsp;twiddle&nbsp;Perl&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262346">var</span>&nbsp;<span class="ident" id="2262350">c</span>&nbsp;<span class="builtintype" id="2262352">rune</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2262358">t</span>&nbsp;<span class="op" id="2262360">=</span>&nbsp;<span class="ident" id="2262362">t</span><span class="op" id="2262363">[</span><span class="num" id="2262364">2</span><span class="op" id="2262365">:</span><span class="op" id="2262366">]</span>&nbsp;<span class="comment" id="2262368">//&nbsp;skip&nbsp;(?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2262380">flags</span>&nbsp;<span class="op" id="2262386">:=</span>&nbsp;<span class="ident" id="2262389">p</span><span class="op" id="2262390">.</span><span class="ident" id="2262391">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2262398">sign</span>&nbsp;<span class="op" id="2262403">:=</span>&nbsp;<span class="op" id="2262406">+</span><span class="num" id="2262407">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2262410">sawFlag</span>&nbsp;<span class="op" id="2262418">:=</span>&nbsp;<span class="builtintype" id="2262421">false</span><br>
<span class="lineno"></span><span class="ident" id="2262427">Loop</span><span class="op" id="2262431">:</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262434">for</span>&nbsp;<span class="ident" id="2262438">t</span>&nbsp;<span class="op" id="2262440">!=</span>&nbsp;<span class="string" id="2262443">&#34;&#34;</span>&nbsp;<span class="op" id="2262446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262450">if</span>&nbsp;<span class="ident" id="2262453">c</span><span class="op" id="2262454">,</span>&nbsp;<span class="ident" id="2262456">t</span><span class="op" id="2262457">,</span>&nbsp;<span class="ident" id="2262459">err</span>&nbsp;<span class="op" id="2262463">=</span>&nbsp;<span class="ident" id="2262465">nextRune</span><span class="op" id="2262473">(</span><span class="ident" id="2262474">t</span><span class="op" id="2262475">)</span><span class="op" id="2262476">;</span>&nbsp;<span class="ident" id="2262478">err</span>&nbsp;<span class="op" id="2262482">!=</span>&nbsp;<span class="ident" id="2262485">nil</span>&nbsp;<span class="op" id="2262489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262494">return</span>&nbsp;<span class="string" id="2262501">&#34;&#34;</span><span class="op" id="2262503">,</span>&nbsp;<span class="ident" id="2262505">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2262511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262515">switch</span>&nbsp;<span class="ident" id="2262522">c</span>&nbsp;<span class="op" id="2262524">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262528">default</span><span class="op" id="2262535">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262540">break</span>&nbsp;<span class="ident" id="2262546">Loop</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2262554">//&nbsp;Flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262566">case</span>&nbsp;<span class="string" id="2262571">&#39;i&#39;</span><span class="op" id="2262574">:</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2262579">flags</span>&nbsp;<span class="op" id="2262585">|=</span>&nbsp;<span class="ident" id="2262588">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2262600">sawFlag</span>&nbsp;<span class="op" id="2262608">=</span>&nbsp;<span class="builtintype" id="2262610">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262617">case</span>&nbsp;<span class="string" id="2262622">&#39;m&#39;</span><span class="op" id="2262625">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2262630">flags</span>&nbsp;<span class="op" id="2262636">&amp;^=</span>&nbsp;<span class="ident" id="2262640">OneLine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2262651">sawFlag</span>&nbsp;<span class="op" id="2262659">=</span>&nbsp;<span class="builtintype" id="2262661">true</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262668">case</span>&nbsp;<span class="string" id="2262673">&#39;s&#39;</span><span class="op" id="2262676">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2262681">flags</span>&nbsp;<span class="op" id="2262687">|=</span>&nbsp;<span class="ident" id="2262690">DotNL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2262699">sawFlag</span>&nbsp;<span class="op" id="2262707">=</span>&nbsp;<span class="builtintype" id="2262709">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262716">case</span>&nbsp;<span class="string" id="2262721">&#39;U&#39;</span><span class="op" id="2262724">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2262729">flags</span>&nbsp;<span class="op" id="2262735">|=</span>&nbsp;<span class="ident" id="2262738">NonGreedy</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2262751">sawFlag</span>&nbsp;<span class="op" id="2262759">=</span>&nbsp;<span class="builtintype" id="2262761">true</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2262769">//&nbsp;Switch&nbsp;to&nbsp;negation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262794">case</span>&nbsp;<span class="string" id="2262799">&#39;-&#39;</span><span class="op" id="2262802">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262807">if</span>&nbsp;<span class="ident" id="2262810">sign</span>&nbsp;<span class="op" id="2262815">&lt;</span>&nbsp;<span class="num" id="2262817">0</span>&nbsp;<span class="op" id="2262819">{</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2262825">break</span>&nbsp;<span class="ident" id="2262831">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2262839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2262844">sign</span>&nbsp;<span class="op" id="2262849">=</span>&nbsp;<span class="op" id="2262851">-</span><span class="num" id="2262852">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2262857">//&nbsp;Invert&nbsp;flags&nbsp;so&nbsp;that&nbsp;|&nbsp;above&nbsp;turn&nbsp;into&nbsp;&amp;^&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2262921">//&nbsp;We&#39;ll&nbsp;invert&nbsp;flags&nbsp;again&nbsp;before&nbsp;using&nbsp;it&nbsp;below.</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2262975">flags</span>&nbsp;<span class="op" id="2262981">=</span>&nbsp;<span class="op" id="2262983">^</span><span class="ident" id="2262984">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2262993">sawFlag</span>&nbsp;<span class="op" id="2263001">=</span>&nbsp;<span class="builtintype" id="2263003">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2263012">//&nbsp;End&nbsp;of&nbsp;flags,&nbsp;starting&nbsp;group&nbsp;or&nbsp;not.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263054">case</span>&nbsp;<span class="string" id="2263059">&#39;:&#39;</span><span class="op" id="2263062">,</span>&nbsp;<span class="string" id="2263064">&#39;)&#39;</span><span class="op" id="2263067">:</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263072">if</span>&nbsp;<span class="ident" id="2263075">sign</span>&nbsp;<span class="op" id="2263080">&lt;</span>&nbsp;<span class="num" id="2263082">0</span>&nbsp;<span class="op" id="2263084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263090">if</span>&nbsp;<span class="op" id="2263093">!</span><span class="ident" id="2263094">sawFlag</span>&nbsp;<span class="op" id="2263102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263109">break</span>&nbsp;<span class="ident" id="2263115">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2263124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2263130">flags</span>&nbsp;<span class="op" id="2263136">=</span>&nbsp;<span class="op" id="2263138">^</span><span class="ident" id="2263139">flags</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2263148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263153">if</span>&nbsp;<span class="ident" id="2263156">c</span>&nbsp;<span class="op" id="2263158">==</span>&nbsp;<span class="string" id="2263161">&#39;:&#39;</span>&nbsp;<span class="op" id="2263165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2263171">//&nbsp;Open&nbsp;new&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2263193">p</span><span class="op" id="2263194">.</span><span class="ident" id="2263195">op</span><span class="op" id="2263197">(</span><span class="ident" id="2263198">opLeftParen</span><span class="op" id="2263209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2263214">}</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2263219">p</span><span class="op" id="2263220">.</span><span class="ident" id="2263221">flags</span>&nbsp;<span class="op" id="2263227">=</span>&nbsp;<span class="ident" id="2263229">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263238">return</span>&nbsp;<span class="ident" id="2263245">t</span><span class="op" id="2263246">,</span>&nbsp;<span class="ident" id="2263248">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2263254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2263257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263261">return</span>&nbsp;<span class="string" id="2263268">&#34;&#34;</span><span class="op" id="2263270">,</span>&nbsp;<span class="op" id="2263272">&amp;</span><span class="ident" id="2263273">Error</span><span class="op" id="2263278">{</span><span class="ident" id="2263279">ErrInvalidPerlOp</span><span class="op" id="2263295">,</span>&nbsp;<span class="ident" id="2263297">s</span><span class="op" id="2263298">[</span><span class="op" id="2263299">:</span><span class="builtinfunc" id="2263300">len</span><span class="op" id="2263303">(</span><span class="ident" id="2263304">s</span><span class="op" id="2263305">)</span><span class="op" id="2263306">-</span><span class="builtinfunc" id="2263307">len</span><span class="op" id="2263310">(</span><span class="ident" id="2263311">t</span><span class="op" id="2263312">)</span><span class="op" id="2263313">]</span><span class="op" id="2263314">}</span><br>
<span class="lineno"></span><span class="op" id="2263316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2263319">//&nbsp;isValidCaptureName&nbsp;reports&nbsp;whether&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="2263362">//&nbsp;is&nbsp;a&nbsp;valid&nbsp;capture&nbsp;name:&nbsp;[A-Za-z0-9_]+.</span><br>
<span class="lineno">1040</span><span class="comment" id="2263405">//&nbsp;PCRE&nbsp;limits&nbsp;names&nbsp;to&nbsp;32&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="2263439">//&nbsp;Python&nbsp;rejects&nbsp;names&nbsp;starting&nbsp;with&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="2263485">//&nbsp;We&nbsp;don&#39;t&nbsp;enforce&nbsp;either&nbsp;of&nbsp;those.</span><br>
<span class="lineno"></span><span class="keyword" id="2263522">func</span>&nbsp;<span class="ident" id="2263527">isValidCaptureName</span><span class="op" id="2263545">(</span><span class="ident" id="2263546">name</span>&nbsp;<span class="builtintype" id="2263551">string</span><span class="op" id="2263557">)</span>&nbsp;<span class="builtintype" id="2263559">bool</span>&nbsp;<span class="op" id="2263564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263567">if</span>&nbsp;<span class="ident" id="2263570">name</span>&nbsp;<span class="op" id="2263575">==</span>&nbsp;<span class="string" id="2263578">&#34;&#34;</span>&nbsp;<span class="op" id="2263581">{</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263585">return</span>&nbsp;<span class="builtintype" id="2263592">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2263599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263602">for</span>&nbsp;<span class="ident" id="2263606">_</span><span class="op" id="2263607">,</span>&nbsp;<span class="ident" id="2263609">c</span>&nbsp;<span class="op" id="2263611">:=</span>&nbsp;<span class="keyword" id="2263614">range</span>&nbsp;<span class="ident" id="2263620">name</span>&nbsp;<span class="op" id="2263625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263629">if</span>&nbsp;<span class="ident" id="2263632">c</span>&nbsp;<span class="op" id="2263634">!=</span>&nbsp;<span class="string" id="2263637">&#39;_&#39;</span>&nbsp;<span class="op" id="2263641">&amp;&amp;</span>&nbsp;<span class="op" id="2263644">!</span><span class="ident" id="2263645">isalnum</span><span class="op" id="2263652">(</span><span class="ident" id="2263653">c</span><span class="op" id="2263654">)</span>&nbsp;<span class="op" id="2263656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263661">return</span>&nbsp;<span class="builtintype" id="2263668">false</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2263676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2263679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263682">return</span>&nbsp;<span class="builtintype" id="2263689">true</span><br>
<span class="lineno"></span><span class="op" id="2263694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1055</span><span class="comment" id="2263697">//&nbsp;parseInt&nbsp;parses&nbsp;a&nbsp;decimal&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="2263735">func</span>&nbsp;<span class="op" id="2263740">(</span><span class="ident" id="2263741">p</span>&nbsp;<span class="op" id="2263743">*</span><span class="ident" id="2263744">parser</span><span class="op" id="2263750">)</span>&nbsp;<span class="ident" id="2263752">parseInt</span><span class="op" id="2263760">(</span><span class="ident" id="2263761">s</span>&nbsp;<span class="builtintype" id="2263763">string</span><span class="op" id="2263769">)</span>&nbsp;<span class="op" id="2263771">(</span><span class="ident" id="2263772">n</span>&nbsp;<span class="builtintype" id="2263774">int</span><span class="op" id="2263777">,</span>&nbsp;<span class="ident" id="2263779">rest</span>&nbsp;<span class="builtintype" id="2263784">string</span><span class="op" id="2263790">,</span>&nbsp;<span class="ident" id="2263792">ok</span>&nbsp;<span class="builtintype" id="2263795">bool</span><span class="op" id="2263799">)</span>&nbsp;<span class="op" id="2263801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263804">if</span>&nbsp;<span class="ident" id="2263807">s</span>&nbsp;<span class="op" id="2263809">==</span>&nbsp;<span class="string" id="2263812">&#34;&#34;</span>&nbsp;<span class="op" id="2263815">||</span>&nbsp;<span class="ident" id="2263818">s</span><span class="op" id="2263819">[</span><span class="num" id="2263820">0</span><span class="op" id="2263821">]</span>&nbsp;<span class="op" id="2263823">&lt;</span>&nbsp;<span class="string" id="2263825">&#39;0&#39;</span>&nbsp;<span class="op" id="2263829">||</span>&nbsp;<span class="string" id="2263832">&#39;9&#39;</span>&nbsp;<span class="op" id="2263836">&lt;</span>&nbsp;<span class="ident" id="2263838">s</span><span class="op" id="2263839">[</span><span class="num" id="2263840">0</span><span class="op" id="2263841">]</span>&nbsp;<span class="op" id="2263843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263847">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2263855">}</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2263858">//&nbsp;Disallow&nbsp;leading&nbsp;zeros.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263886">if</span>&nbsp;<span class="builtinfunc" id="2263889">len</span><span class="op" id="2263892">(</span><span class="ident" id="2263893">s</span><span class="op" id="2263894">)</span>&nbsp;<span class="op" id="2263896">&gt;=</span>&nbsp;<span class="num" id="2263899">2</span>&nbsp;<span class="op" id="2263901">&amp;&amp;</span>&nbsp;<span class="ident" id="2263904">s</span><span class="op" id="2263905">[</span><span class="num" id="2263906">0</span><span class="op" id="2263907">]</span>&nbsp;<span class="op" id="2263909">==</span>&nbsp;<span class="string" id="2263912">&#39;0&#39;</span>&nbsp;<span class="op" id="2263916">&amp;&amp;</span>&nbsp;<span class="string" id="2263919">&#39;0&#39;</span>&nbsp;<span class="op" id="2263923">&lt;=</span>&nbsp;<span class="ident" id="2263926">s</span><span class="op" id="2263927">[</span><span class="num" id="2263928">1</span><span class="op" id="2263929">]</span>&nbsp;<span class="op" id="2263931">&amp;&amp;</span>&nbsp;<span class="ident" id="2263934">s</span><span class="op" id="2263935">[</span><span class="num" id="2263936">1</span><span class="op" id="2263937">]</span>&nbsp;<span class="op" id="2263939">&lt;=</span>&nbsp;<span class="string" id="2263942">&#39;9&#39;</span>&nbsp;<span class="op" id="2263946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263950">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2263958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2263961">t</span>&nbsp;<span class="op" id="2263963">:=</span>&nbsp;<span class="ident" id="2263966">s</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2263969">for</span>&nbsp;<span class="ident" id="2263973">s</span>&nbsp;<span class="op" id="2263975">!=</span>&nbsp;<span class="string" id="2263978">&#34;&#34;</span>&nbsp;<span class="op" id="2263981">&amp;&amp;</span>&nbsp;<span class="string" id="2263984">&#39;0&#39;</span>&nbsp;<span class="op" id="2263988">&lt;=</span>&nbsp;<span class="ident" id="2263991">s</span><span class="op" id="2263992">[</span><span class="num" id="2263993">0</span><span class="op" id="2263994">]</span>&nbsp;<span class="op" id="2263996">&amp;&amp;</span>&nbsp;<span class="ident" id="2263999">s</span><span class="op" id="2264000">[</span><span class="num" id="2264001">0</span><span class="op" id="2264002">]</span>&nbsp;<span class="op" id="2264004">&lt;=</span>&nbsp;<span class="string" id="2264007">&#39;9&#39;</span>&nbsp;<span class="op" id="2264011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2264015">s</span>&nbsp;<span class="op" id="2264017">=</span>&nbsp;<span class="ident" id="2264019">s</span><span class="op" id="2264020">[</span><span class="num" id="2264021">1</span><span class="op" id="2264022">:</span><span class="op" id="2264023">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2264026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2264029">rest</span>&nbsp;<span class="op" id="2264034">=</span>&nbsp;<span class="ident" id="2264036">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2264039">ok</span>&nbsp;<span class="op" id="2264042">=</span>&nbsp;<span class="builtintype" id="2264044">true</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2264050">//&nbsp;Have&nbsp;digits,&nbsp;compute&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2264082">t</span>&nbsp;<span class="op" id="2264084">=</span>&nbsp;<span class="ident" id="2264086">t</span><span class="op" id="2264087">[</span><span class="op" id="2264088">:</span><span class="builtinfunc" id="2264089">len</span><span class="op" id="2264092">(</span><span class="ident" id="2264093">t</span><span class="op" id="2264094">)</span><span class="op" id="2264095">-</span><span class="builtinfunc" id="2264096">len</span><span class="op" id="2264099">(</span><span class="ident" id="2264100">s</span><span class="op" id="2264101">)</span><span class="op" id="2264102">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264105">for</span>&nbsp;<span class="ident" id="2264109">i</span>&nbsp;<span class="op" id="2264111">:=</span>&nbsp;<span class="num" id="2264114">0</span><span class="op" id="2264115">;</span>&nbsp;<span class="ident" id="2264117">i</span>&nbsp;<span class="op" id="2264119">&lt;</span>&nbsp;<span class="builtinfunc" id="2264121">len</span><span class="op" id="2264124">(</span><span class="ident" id="2264125">t</span><span class="op" id="2264126">)</span><span class="op" id="2264127">;</span>&nbsp;<span class="ident" id="2264129">i</span><span class="op" id="2264130">++</span>&nbsp;<span class="op" id="2264133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2264137">//&nbsp;Avoid&nbsp;overflow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264158">if</span>&nbsp;<span class="ident" id="2264161">n</span>&nbsp;<span class="op" id="2264163">&gt;=</span>&nbsp;<span class="num" id="2264166">1e8</span>&nbsp;<span class="op" id="2264170">{</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2264175">n</span>&nbsp;<span class="op" id="2264177">=</span>&nbsp;<span class="op" id="2264179">-</span><span class="num" id="2264180">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264185">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2264193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2264197">n</span>&nbsp;<span class="op" id="2264199">=</span>&nbsp;<span class="ident" id="2264201">n</span><span class="op" id="2264202">*</span><span class="num" id="2264203">10</span>&nbsp;<span class="op" id="2264206">+</span>&nbsp;<span class="builtintype" id="2264208">int</span><span class="op" id="2264211">(</span><span class="ident" id="2264212">t</span><span class="op" id="2264213">[</span><span class="ident" id="2264214">i</span><span class="op" id="2264215">]</span><span class="op" id="2264216">)</span>&nbsp;<span class="op" id="2264218">-</span>&nbsp;<span class="string" id="2264220">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2264225">}</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264228">return</span><br>
<span class="lineno"></span><span class="op" id="2264235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2264238">//&nbsp;can&nbsp;this&nbsp;be&nbsp;represented&nbsp;as&nbsp;a&nbsp;character&nbsp;class?</span><br>
<span class="lineno"></span><span class="comment" id="2264287">//&nbsp;single-rune&nbsp;literal&nbsp;string,&nbsp;char&nbsp;class,&nbsp;.,&nbsp;and&nbsp;.|\n.</span><br>
<span class="lineno">1085</span><span class="keyword" id="2264343">func</span>&nbsp;<span class="ident" id="2264348">isCharClass</span><span class="op" id="2264359">(</span><span class="ident" id="2264360">re</span>&nbsp;<span class="op" id="2264363">*</span><span class="ident" id="2264364">Regexp</span><span class="op" id="2264370">)</span>&nbsp;<span class="builtintype" id="2264372">bool</span>&nbsp;<span class="op" id="2264377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264380">return</span>&nbsp;<span class="ident" id="2264387">re</span><span class="op" id="2264389">.</span><span class="ident" id="2264390">Op</span>&nbsp;<span class="op" id="2264393">==</span>&nbsp;<span class="ident" id="2264396">OpLiteral</span>&nbsp;<span class="op" id="2264406">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2264409">len</span><span class="op" id="2264412">(</span><span class="ident" id="2264413">re</span><span class="op" id="2264415">.</span><span class="ident" id="2264416">Rune</span><span class="op" id="2264420">)</span>&nbsp;<span class="op" id="2264422">==</span>&nbsp;<span class="num" id="2264425">1</span>&nbsp;<span class="op" id="2264427">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2264432">re</span><span class="op" id="2264434">.</span><span class="ident" id="2264435">Op</span>&nbsp;<span class="op" id="2264438">==</span>&nbsp;<span class="ident" id="2264441">OpCharClass</span>&nbsp;<span class="op" id="2264453">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2264458">re</span><span class="op" id="2264460">.</span><span class="ident" id="2264461">Op</span>&nbsp;<span class="op" id="2264464">==</span>&nbsp;<span class="ident" id="2264467">OpAnyCharNotNL</span>&nbsp;<span class="op" id="2264482">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2264487">re</span><span class="op" id="2264489">.</span><span class="ident" id="2264490">Op</span>&nbsp;<span class="op" id="2264493">==</span>&nbsp;<span class="ident" id="2264496">OpAnyChar</span><br>
<span class="lineno">1090</span><span class="op" id="2264506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2264509">//&nbsp;does&nbsp;re&nbsp;match&nbsp;r?</span><br>
<span class="lineno"></span><span class="keyword" id="2264529">func</span>&nbsp;<span class="ident" id="2264534">matchRune</span><span class="op" id="2264543">(</span><span class="ident" id="2264544">re</span>&nbsp;<span class="op" id="2264547">*</span><span class="ident" id="2264548">Regexp</span><span class="op" id="2264554">,</span>&nbsp;<span class="ident" id="2264556">r</span>&nbsp;<span class="builtintype" id="2264558">rune</span><span class="op" id="2264562">)</span>&nbsp;<span class="builtintype" id="2264564">bool</span>&nbsp;<span class="op" id="2264569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264572">switch</span>&nbsp;<span class="ident" id="2264579">re</span><span class="op" id="2264581">.</span><span class="ident" id="2264582">Op</span>&nbsp;<span class="op" id="2264585">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264588">case</span>&nbsp;<span class="ident" id="2264593">OpLiteral</span><span class="op" id="2264602">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264606">return</span>&nbsp;<span class="builtinfunc" id="2264613">len</span><span class="op" id="2264616">(</span><span class="ident" id="2264617">re</span><span class="op" id="2264619">.</span><span class="ident" id="2264620">Rune</span><span class="op" id="2264624">)</span>&nbsp;<span class="op" id="2264626">==</span>&nbsp;<span class="num" id="2264629">1</span>&nbsp;<span class="op" id="2264631">&amp;&amp;</span>&nbsp;<span class="ident" id="2264634">re</span><span class="op" id="2264636">.</span><span class="ident" id="2264637">Rune</span><span class="op" id="2264641">[</span><span class="num" id="2264642">0</span><span class="op" id="2264643">]</span>&nbsp;<span class="op" id="2264645">==</span>&nbsp;<span class="ident" id="2264648">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264651">case</span>&nbsp;<span class="ident" id="2264656">OpCharClass</span><span class="op" id="2264667">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264671">for</span>&nbsp;<span class="ident" id="2264675">i</span>&nbsp;<span class="op" id="2264677">:=</span>&nbsp;<span class="num" id="2264680">0</span><span class="op" id="2264681">;</span>&nbsp;<span class="ident" id="2264683">i</span>&nbsp;<span class="op" id="2264685">&lt;</span>&nbsp;<span class="builtinfunc" id="2264687">len</span><span class="op" id="2264690">(</span><span class="ident" id="2264691">re</span><span class="op" id="2264693">.</span><span class="ident" id="2264694">Rune</span><span class="op" id="2264698">)</span><span class="op" id="2264699">;</span>&nbsp;<span class="ident" id="2264701">i</span>&nbsp;<span class="op" id="2264703">+=</span>&nbsp;<span class="num" id="2264706">2</span>&nbsp;<span class="op" id="2264708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264713">if</span>&nbsp;<span class="ident" id="2264716">re</span><span class="op" id="2264718">.</span><span class="ident" id="2264719">Rune</span><span class="op" id="2264723">[</span><span class="ident" id="2264724">i</span><span class="op" id="2264725">]</span>&nbsp;<span class="op" id="2264727">&lt;=</span>&nbsp;<span class="ident" id="2264730">r</span>&nbsp;<span class="op" id="2264732">&amp;&amp;</span>&nbsp;<span class="ident" id="2264735">r</span>&nbsp;<span class="op" id="2264737">&lt;=</span>&nbsp;<span class="ident" id="2264740">re</span><span class="op" id="2264742">.</span><span class="ident" id="2264743">Rune</span><span class="op" id="2264747">[</span><span class="ident" id="2264748">i</span><span class="op" id="2264749">+</span><span class="num" id="2264750">1</span><span class="op" id="2264751">]</span>&nbsp;<span class="op" id="2264753">{</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264759">return</span>&nbsp;<span class="builtintype" id="2264766">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2264774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2264778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264782">return</span>&nbsp;<span class="builtintype" id="2264789">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264796">case</span>&nbsp;<span class="ident" id="2264801">OpAnyCharNotNL</span><span class="op" id="2264815">:</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264819">return</span>&nbsp;<span class="ident" id="2264826">r</span>&nbsp;<span class="op" id="2264828">!=</span>&nbsp;<span class="string" id="2264831">&#39;\n&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264837">case</span>&nbsp;<span class="ident" id="2264842">OpAnyChar</span><span class="op" id="2264851">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264855">return</span>&nbsp;<span class="builtintype" id="2264862">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2264868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2264871">return</span>&nbsp;<span class="builtintype" id="2264878">false</span><br>
<span class="lineno">1110</span><span class="op" id="2264884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2264887">//&nbsp;parseVerticalBar&nbsp;handles&nbsp;a&nbsp;|&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="2264933">func</span>&nbsp;<span class="op" id="2264938">(</span><span class="ident" id="2264939">p</span>&nbsp;<span class="op" id="2264941">*</span><span class="ident" id="2264942">parser</span><span class="op" id="2264948">)</span>&nbsp;<span class="ident" id="2264950">parseVerticalBar</span><span class="op" id="2264966">(</span><span class="op" id="2264967">)</span>&nbsp;<span class="builtintype" id="2264969">error</span>&nbsp;<span class="op" id="2264975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2264978">p</span><span class="op" id="2264979">.</span><span class="ident" id="2264980">concat</span><span class="op" id="2264986">(</span><span class="op" id="2264987">)</span><br>
<span class="lineno">1115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2264991">//&nbsp;The&nbsp;concatenation&nbsp;we&nbsp;just&nbsp;parsed&nbsp;is&nbsp;on&nbsp;top&nbsp;of&nbsp;the&nbsp;stack.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2265052">//&nbsp;If&nbsp;it&nbsp;sits&nbsp;above&nbsp;an&nbsp;opVerticalBar,&nbsp;swap&nbsp;it&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2265105">//&nbsp;(things&nbsp;below&nbsp;an&nbsp;opVerticalBar&nbsp;become&nbsp;an&nbsp;alternation).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2265164">//&nbsp;Otherwise,&nbsp;push&nbsp;a&nbsp;new&nbsp;vertical&nbsp;bar.</span><br>
<span class="lineno">1120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265204">if</span>&nbsp;<span class="op" id="2265207">!</span><span class="ident" id="2265208">p</span><span class="op" id="2265209">.</span><span class="ident" id="2265210">swapVerticalBar</span><span class="op" id="2265225">(</span><span class="op" id="2265226">)</span>&nbsp;<span class="op" id="2265228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2265232">p</span><span class="op" id="2265233">.</span><span class="ident" id="2265234">op</span><span class="op" id="2265236">(</span><span class="ident" id="2265237">opVerticalBar</span><span class="op" id="2265250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2265253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265257">return</span>&nbsp;<span class="ident" id="2265264">nil</span><br>
<span class="lineno">1125</span><span class="op" id="2265268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2265271">//&nbsp;mergeCharClass&nbsp;makes&nbsp;dst&nbsp;=&nbsp;dst|src.</span><br>
<span class="lineno"></span><span class="comment" id="2265310">//&nbsp;The&nbsp;caller&nbsp;must&nbsp;ensure&nbsp;that&nbsp;dst.Op&nbsp;&gt;=&nbsp;src.Op,</span><br>
<span class="lineno"></span><span class="comment" id="2265359">//&nbsp;to&nbsp;reduce&nbsp;the&nbsp;amount&nbsp;of&nbsp;copying.</span><br>
<span class="lineno">1130</span><span class="keyword" id="2265395">func</span>&nbsp;<span class="ident" id="2265400">mergeCharClass</span><span class="op" id="2265414">(</span><span class="ident" id="2265415">dst</span><span class="op" id="2265418">,</span>&nbsp;<span class="ident" id="2265420">src</span>&nbsp;<span class="op" id="2265424">*</span><span class="ident" id="2265425">Regexp</span><span class="op" id="2265431">)</span>&nbsp;<span class="op" id="2265433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265436">switch</span>&nbsp;<span class="ident" id="2265443">dst</span><span class="op" id="2265446">.</span><span class="ident" id="2265447">Op</span>&nbsp;<span class="op" id="2265450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265453">case</span>&nbsp;<span class="ident" id="2265458">OpAnyChar</span><span class="op" id="2265467">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2265471">//&nbsp;src&nbsp;doesn&#39;t&nbsp;add&nbsp;anything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265501">case</span>&nbsp;<span class="ident" id="2265506">OpAnyCharNotNL</span><span class="op" id="2265520">:</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2265524">//&nbsp;src&nbsp;might&nbsp;add&nbsp;\n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265546">if</span>&nbsp;<span class="ident" id="2265549">matchRune</span><span class="op" id="2265558">(</span><span class="ident" id="2265559">src</span><span class="op" id="2265562">,</span>&nbsp;<span class="string" id="2265564">&#39;\n&#39;</span><span class="op" id="2265568">)</span>&nbsp;<span class="op" id="2265570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2265575">dst</span><span class="op" id="2265578">.</span><span class="ident" id="2265579">Op</span>&nbsp;<span class="op" id="2265582">=</span>&nbsp;<span class="ident" id="2265584">OpAnyChar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2265596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265599">case</span>&nbsp;<span class="ident" id="2265604">OpCharClass</span><span class="op" id="2265615">:</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2265619">//&nbsp;src&nbsp;is&nbsp;simpler,&nbsp;so&nbsp;either&nbsp;literal&nbsp;or&nbsp;char&nbsp;class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265672">if</span>&nbsp;<span class="ident" id="2265675">src</span><span class="op" id="2265678">.</span><span class="ident" id="2265679">Op</span>&nbsp;<span class="op" id="2265682">==</span>&nbsp;<span class="ident" id="2265685">OpLiteral</span>&nbsp;<span class="op" id="2265695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2265700">dst</span><span class="op" id="2265703">.</span><span class="ident" id="2265704">Rune</span>&nbsp;<span class="op" id="2265709">=</span>&nbsp;<span class="ident" id="2265711">appendLiteral</span><span class="op" id="2265724">(</span><span class="ident" id="2265725">dst</span><span class="op" id="2265728">.</span><span class="ident" id="2265729">Rune</span><span class="op" id="2265733">,</span>&nbsp;<span class="ident" id="2265735">src</span><span class="op" id="2265738">.</span><span class="ident" id="2265739">Rune</span><span class="op" id="2265743">[</span><span class="num" id="2265744">0</span><span class="op" id="2265745">]</span><span class="op" id="2265746">,</span>&nbsp;<span class="ident" id="2265748">src</span><span class="op" id="2265751">.</span><span class="ident" id="2265752">Flags</span><span class="op" id="2265757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2265761">}</span>&nbsp;<span class="keyword" id="2265763">else</span>&nbsp;<span class="op" id="2265768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2265773">dst</span><span class="op" id="2265776">.</span><span class="ident" id="2265777">Rune</span>&nbsp;<span class="op" id="2265782">=</span>&nbsp;<span class="ident" id="2265784">appendClass</span><span class="op" id="2265795">(</span><span class="ident" id="2265796">dst</span><span class="op" id="2265799">.</span><span class="ident" id="2265800">Rune</span><span class="op" id="2265804">,</span>&nbsp;<span class="ident" id="2265806">src</span><span class="op" id="2265809">.</span><span class="ident" id="2265810">Rune</span><span class="op" id="2265814">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2265818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265821">case</span>&nbsp;<span class="ident" id="2265826">OpLiteral</span><span class="op" id="2265835">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2265839">//&nbsp;both&nbsp;literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265857">if</span>&nbsp;<span class="ident" id="2265860">src</span><span class="op" id="2265863">.</span><span class="ident" id="2265864">Rune</span><span class="op" id="2265868">[</span><span class="num" id="2265869">0</span><span class="op" id="2265870">]</span>&nbsp;<span class="op" id="2265872">==</span>&nbsp;<span class="ident" id="2265875">dst</span><span class="op" id="2265878">.</span><span class="ident" id="2265879">Rune</span><span class="op" id="2265883">[</span><span class="num" id="2265884">0</span><span class="op" id="2265885">]</span>&nbsp;<span class="op" id="2265887">&amp;&amp;</span>&nbsp;<span class="ident" id="2265890">src</span><span class="op" id="2265893">.</span><span class="ident" id="2265894">Flags</span>&nbsp;<span class="op" id="2265900">==</span>&nbsp;<span class="ident" id="2265903">dst</span><span class="op" id="2265906">.</span><span class="ident" id="2265907">Flags</span>&nbsp;<span class="op" id="2265913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2265918">break</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2265926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2265930">dst</span><span class="op" id="2265933">.</span><span class="ident" id="2265934">Op</span>&nbsp;<span class="op" id="2265937">=</span>&nbsp;<span class="ident" id="2265939">OpCharClass</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2265953">dst</span><span class="op" id="2265956">.</span><span class="ident" id="2265957">Rune</span>&nbsp;<span class="op" id="2265962">=</span>&nbsp;<span class="ident" id="2265964">appendLiteral</span><span class="op" id="2265977">(</span><span class="ident" id="2265978">dst</span><span class="op" id="2265981">.</span><span class="ident" id="2265982">Rune</span><span class="op" id="2265986">[</span><span class="op" id="2265987">:</span><span class="num" id="2265988">0</span><span class="op" id="2265989">]</span><span class="op" id="2265990">,</span>&nbsp;<span class="ident" id="2265992">dst</span><span class="op" id="2265995">.</span><span class="ident" id="2265996">Rune</span><span class="op" id="2266000">[</span><span class="num" id="2266001">0</span><span class="op" id="2266002">]</span><span class="op" id="2266003">,</span>&nbsp;<span class="ident" id="2266005">dst</span><span class="op" id="2266008">.</span><span class="ident" id="2266009">Flags</span><span class="op" id="2266014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266018">dst</span><span class="op" id="2266021">.</span><span class="ident" id="2266022">Rune</span>&nbsp;<span class="op" id="2266027">=</span>&nbsp;<span class="ident" id="2266029">appendLiteral</span><span class="op" id="2266042">(</span><span class="ident" id="2266043">dst</span><span class="op" id="2266046">.</span><span class="ident" id="2266047">Rune</span><span class="op" id="2266051">,</span>&nbsp;<span class="ident" id="2266053">src</span><span class="op" id="2266056">.</span><span class="ident" id="2266057">Rune</span><span class="op" id="2266061">[</span><span class="num" id="2266062">0</span><span class="op" id="2266063">]</span><span class="op" id="2266064">,</span>&nbsp;<span class="ident" id="2266066">src</span><span class="op" id="2266069">.</span><span class="ident" id="2266070">Flags</span><span class="op" id="2266075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2266078">}</span><br>
<span class="lineno">1155</span><span class="op" id="2266080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2266083">//&nbsp;If&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;stack&nbsp;is&nbsp;an&nbsp;element&nbsp;followed&nbsp;by&nbsp;an&nbsp;opVerticalBar</span><br>
<span class="lineno"></span><span class="comment" id="2266153">//&nbsp;swapVerticalBar&nbsp;swaps&nbsp;the&nbsp;two&nbsp;and&nbsp;returns&nbsp;true.</span><br>
<span class="lineno"></span><span class="comment" id="2266204">//&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;false.</span><br>
<span class="lineno">1160</span><span class="keyword" id="2266235">func</span>&nbsp;<span class="op" id="2266240">(</span><span class="ident" id="2266241">p</span>&nbsp;<span class="op" id="2266243">*</span><span class="ident" id="2266244">parser</span><span class="op" id="2266250">)</span>&nbsp;<span class="ident" id="2266252">swapVerticalBar</span><span class="op" id="2266267">(</span><span class="op" id="2266268">)</span>&nbsp;<span class="builtintype" id="2266270">bool</span>&nbsp;<span class="op" id="2266275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2266278">//&nbsp;If&nbsp;above&nbsp;and&nbsp;below&nbsp;vertical&nbsp;bar&nbsp;are&nbsp;literal&nbsp;or&nbsp;char&nbsp;class,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2266341">//&nbsp;can&nbsp;merge&nbsp;into&nbsp;a&nbsp;single&nbsp;char&nbsp;class.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266381">n</span>&nbsp;<span class="op" id="2266383">:=</span>&nbsp;<span class="builtinfunc" id="2266386">len</span><span class="op" id="2266389">(</span><span class="ident" id="2266390">p</span><span class="op" id="2266391">.</span><span class="ident" id="2266392">stack</span><span class="op" id="2266397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266400">if</span>&nbsp;<span class="ident" id="2266403">n</span>&nbsp;<span class="op" id="2266405">&gt;=</span>&nbsp;<span class="num" id="2266408">3</span>&nbsp;<span class="op" id="2266410">&amp;&amp;</span>&nbsp;<span class="ident" id="2266413">p</span><span class="op" id="2266414">.</span><span class="ident" id="2266415">stack</span><span class="op" id="2266420">[</span><span class="ident" id="2266421">n</span><span class="op" id="2266422">-</span><span class="num" id="2266423">2</span><span class="op" id="2266424">]</span><span class="op" id="2266425">.</span><span class="ident" id="2266426">Op</span>&nbsp;<span class="op" id="2266429">==</span>&nbsp;<span class="ident" id="2266432">opVerticalBar</span>&nbsp;<span class="op" id="2266446">&amp;&amp;</span>&nbsp;<span class="ident" id="2266449">isCharClass</span><span class="op" id="2266460">(</span><span class="ident" id="2266461">p</span><span class="op" id="2266462">.</span><span class="ident" id="2266463">stack</span><span class="op" id="2266468">[</span><span class="ident" id="2266469">n</span><span class="op" id="2266470">-</span><span class="num" id="2266471">1</span><span class="op" id="2266472">]</span><span class="op" id="2266473">)</span>&nbsp;<span class="op" id="2266475">&amp;&amp;</span>&nbsp;<span class="ident" id="2266478">isCharClass</span><span class="op" id="2266489">(</span><span class="ident" id="2266490">p</span><span class="op" id="2266491">.</span><span class="ident" id="2266492">stack</span><span class="op" id="2266497">[</span><span class="ident" id="2266498">n</span><span class="op" id="2266499">-</span><span class="num" id="2266500">3</span><span class="op" id="2266501">]</span><span class="op" id="2266502">)</span>&nbsp;<span class="op" id="2266504">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266508">re1</span>&nbsp;<span class="op" id="2266512">:=</span>&nbsp;<span class="ident" id="2266515">p</span><span class="op" id="2266516">.</span><span class="ident" id="2266517">stack</span><span class="op" id="2266522">[</span><span class="ident" id="2266523">n</span><span class="op" id="2266524">-</span><span class="num" id="2266525">1</span><span class="op" id="2266526">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266530">re3</span>&nbsp;<span class="op" id="2266534">:=</span>&nbsp;<span class="ident" id="2266537">p</span><span class="op" id="2266538">.</span><span class="ident" id="2266539">stack</span><span class="op" id="2266544">[</span><span class="ident" id="2266545">n</span><span class="op" id="2266546">-</span><span class="num" id="2266547">3</span><span class="op" id="2266548">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2266552">//&nbsp;Make&nbsp;re3&nbsp;the&nbsp;more&nbsp;complex&nbsp;of&nbsp;the&nbsp;two.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266595">if</span>&nbsp;<span class="ident" id="2266598">re1</span><span class="op" id="2266601">.</span><span class="ident" id="2266602">Op</span>&nbsp;<span class="op" id="2266605">&gt;</span>&nbsp;<span class="ident" id="2266607">re3</span><span class="op" id="2266610">.</span><span class="ident" id="2266611">Op</span>&nbsp;<span class="op" id="2266614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266619">re1</span><span class="op" id="2266622">,</span>&nbsp;<span class="ident" id="2266624">re3</span>&nbsp;<span class="op" id="2266628">=</span>&nbsp;<span class="ident" id="2266630">re3</span><span class="op" id="2266633">,</span>&nbsp;<span class="ident" id="2266635">re1</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266642">p</span><span class="op" id="2266643">.</span><span class="ident" id="2266644">stack</span><span class="op" id="2266649">[</span><span class="ident" id="2266650">n</span><span class="op" id="2266651">-</span><span class="num" id="2266652">3</span><span class="op" id="2266653">]</span>&nbsp;<span class="op" id="2266655">=</span>&nbsp;<span class="ident" id="2266657">re3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2266663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266667">mergeCharClass</span><span class="op" id="2266681">(</span><span class="ident" id="2266682">re3</span><span class="op" id="2266685">,</span>&nbsp;<span class="ident" id="2266687">re1</span><span class="op" id="2266690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266694">p</span><span class="op" id="2266695">.</span><span class="ident" id="2266696">reuse</span><span class="op" id="2266701">(</span><span class="ident" id="2266702">re1</span><span class="op" id="2266705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266709">p</span><span class="op" id="2266710">.</span><span class="ident" id="2266711">stack</span>&nbsp;<span class="op" id="2266717">=</span>&nbsp;<span class="ident" id="2266719">p</span><span class="op" id="2266720">.</span><span class="ident" id="2266721">stack</span><span class="op" id="2266726">[</span><span class="op" id="2266727">:</span><span class="ident" id="2266728">n</span><span class="op" id="2266729">-</span><span class="num" id="2266730">1</span><span class="op" id="2266731">]</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266735">return</span>&nbsp;<span class="builtintype" id="2266742">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2266748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266752">if</span>&nbsp;<span class="ident" id="2266755">n</span>&nbsp;<span class="op" id="2266757">&gt;=</span>&nbsp;<span class="num" id="2266760">2</span>&nbsp;<span class="op" id="2266762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266766">re1</span>&nbsp;<span class="op" id="2266770">:=</span>&nbsp;<span class="ident" id="2266773">p</span><span class="op" id="2266774">.</span><span class="ident" id="2266775">stack</span><span class="op" id="2266780">[</span><span class="ident" id="2266781">n</span><span class="op" id="2266782">-</span><span class="num" id="2266783">1</span><span class="op" id="2266784">]</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266788">re2</span>&nbsp;<span class="op" id="2266792">:=</span>&nbsp;<span class="ident" id="2266795">p</span><span class="op" id="2266796">.</span><span class="ident" id="2266797">stack</span><span class="op" id="2266802">[</span><span class="ident" id="2266803">n</span><span class="op" id="2266804">-</span><span class="num" id="2266805">2</span><span class="op" id="2266806">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266810">if</span>&nbsp;<span class="ident" id="2266813">re2</span><span class="op" id="2266816">.</span><span class="ident" id="2266817">Op</span>&nbsp;<span class="op" id="2266820">==</span>&nbsp;<span class="ident" id="2266823">opVerticalBar</span>&nbsp;<span class="op" id="2266837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266842">if</span>&nbsp;<span class="ident" id="2266845">n</span>&nbsp;<span class="op" id="2266847">&gt;=</span>&nbsp;<span class="num" id="2266850">3</span>&nbsp;<span class="op" id="2266852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2266858">//&nbsp;Now&nbsp;out&nbsp;of&nbsp;reach.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2266883">//&nbsp;Clean&nbsp;opportunistically.</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266915">cleanAlt</span><span class="op" id="2266923">(</span><span class="ident" id="2266924">p</span><span class="op" id="2266925">.</span><span class="ident" id="2266926">stack</span><span class="op" id="2266931">[</span><span class="ident" id="2266932">n</span><span class="op" id="2266933">-</span><span class="num" id="2266934">3</span><span class="op" id="2266935">]</span><span class="op" id="2266936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2266941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266946">p</span><span class="op" id="2266947">.</span><span class="ident" id="2266948">stack</span><span class="op" id="2266953">[</span><span class="ident" id="2266954">n</span><span class="op" id="2266955">-</span><span class="num" id="2266956">2</span><span class="op" id="2266957">]</span>&nbsp;<span class="op" id="2266959">=</span>&nbsp;<span class="ident" id="2266961">re1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2266968">p</span><span class="op" id="2266969">.</span><span class="ident" id="2266970">stack</span><span class="op" id="2266975">[</span><span class="ident" id="2266976">n</span><span class="op" id="2266977">-</span><span class="num" id="2266978">1</span><span class="op" id="2266979">]</span>&nbsp;<span class="op" id="2266981">=</span>&nbsp;<span class="ident" id="2266983">re2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2266990">return</span>&nbsp;<span class="builtintype" id="2266997">true</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2267004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2267007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2267010">return</span>&nbsp;<span class="builtintype" id="2267017">false</span><br>
<span class="lineno"></span><span class="op" id="2267023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1195</span><span class="comment" id="2267026">//&nbsp;parseRightParen&nbsp;handles&nbsp;a&nbsp;)&nbsp;in&nbsp;the&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="2267071">func</span>&nbsp;<span class="op" id="2267076">(</span><span class="ident" id="2267077">p</span>&nbsp;<span class="op" id="2267079">*</span><span class="ident" id="2267080">parser</span><span class="op" id="2267086">)</span>&nbsp;<span class="ident" id="2267088">parseRightParen</span><span class="op" id="2267103">(</span><span class="op" id="2267104">)</span>&nbsp;<span class="builtintype" id="2267106">error</span>&nbsp;<span class="op" id="2267112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2267115">p</span><span class="op" id="2267116">.</span><span class="ident" id="2267117">concat</span><span class="op" id="2267123">(</span><span class="op" id="2267124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2267127">if</span>&nbsp;<span class="ident" id="2267130">p</span><span class="op" id="2267131">.</span><span class="ident" id="2267132">swapVerticalBar</span><span class="op" id="2267147">(</span><span class="op" id="2267148">)</span>&nbsp;<span class="op" id="2267150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2267154">//&nbsp;pop&nbsp;vertical&nbsp;bar</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2267176">p</span><span class="op" id="2267177">.</span><span class="ident" id="2267178">stack</span>&nbsp;<span class="op" id="2267184">=</span>&nbsp;<span class="ident" id="2267186">p</span><span class="op" id="2267187">.</span><span class="ident" id="2267188">stack</span><span class="op" id="2267193">[</span><span class="op" id="2267194">:</span><span class="builtinfunc" id="2267195">len</span><span class="op" id="2267198">(</span><span class="ident" id="2267199">p</span><span class="op" id="2267200">.</span><span class="ident" id="2267201">stack</span><span class="op" id="2267206">)</span><span class="op" id="2267207">-</span><span class="num" id="2267208">1</span><span class="op" id="2267209">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2267212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2267215">p</span><span class="op" id="2267216">.</span><span class="ident" id="2267217">alternate</span><span class="op" id="2267226">(</span><span class="op" id="2267227">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2267231">n</span>&nbsp;<span class="op" id="2267233">:=</span>&nbsp;<span class="builtinfunc" id="2267236">len</span><span class="op" id="2267239">(</span><span class="ident" id="2267240">p</span><span class="op" id="2267241">.</span><span class="ident" id="2267242">stack</span><span class="op" id="2267247">)</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2267250">if</span>&nbsp;<span class="ident" id="2267253">n</span>&nbsp;<span class="op" id="2267255">&lt;</span>&nbsp;<span class="num" id="2267257">2</span>&nbsp;<span class="op" id="2267259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2267263">return</span>&nbsp;<span class="op" id="2267270">&amp;</span><span class="ident" id="2267271">Error</span><span class="op" id="2267276">{</span><span class="ident" id="2267277">ErrUnexpectedParen</span><span class="op" id="2267295">,</span>&nbsp;<span class="ident" id="2267297">p</span><span class="op" id="2267298">.</span><span class="ident" id="2267299">wholeRegexp</span><span class="op" id="2267310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2267313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2267316">re1</span>&nbsp;<span class="op" id="2267320">:=</span>&nbsp;<span class="ident" id="2267323">p</span><span class="op" id="2267324">.</span><span class="ident" id="2267325">stack</span><span class="op" id="2267330">[</span><span class="ident" id="2267331">n</span><span class="op" id="2267332">-</span><span class="num" id="2267333">1</span><span class="op" id="2267334">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2267337">re2</span>&nbsp;<span class="op" id="2267341">:=</span>&nbsp;<span class="ident" id="2267344">p</span><span class="op" id="2267345">.</span><span class="ident" id="2267346">stack</span><span class="op" id="2267351">[</span><span class="ident" id="2267352">n</span><span class="op" id="2267353">-</span><span class="num" id="2267354">2</span><span class="op" id="2267355">]</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2267358">p</span><span class="op" id="2267359">.</span><span class="ident" id="2267360">stack</span>&nbsp;<span class="op" id="2267366">=</span>&nbsp;<span class="ident" id="2267368">p</span><span class="op" id="2267369">.</span><span class="ident" id="2267370">stack</span><span class="op" id="2267375">[</span><span class="op" id="2267376">:</span><span class="ident" id="2267377">n</span><span class="op" id="2267378">-</span><span class="num" id="2267379">2</span><span class="op" id="2267380">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2267383">if</span>&nbsp;<span class="ident" id="2267386">re2</span><span class="op" id="2267389">.</span><span class="ident" id="2267390">Op</span>&nbsp;<span class="op" id="2267393">!=</span>&nbsp;<span class="ident" id="2267396">opLeftParen</span>&nbsp;<span class="op" id="2267408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2267412">return</span>&nbsp;<span class="op" id="2267419">&amp;</span><span class="ident" id="2267420">Error</span><span class="op" id="2267425">{</span><span class="ident" id="2267426">ErrUnexpectedParen</span><span class="op" id="2267444">,</span>&nbsp;<span class="ident" id="2267446">p</span><span class="op" id="2267447">.</span><span class="ident" id="2267448">wholeRegexp</span><span class="op" id="2267459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2267462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2267465">//&nbsp;Restore&nbsp;flags&nbsp;at&nbsp;time&nbsp;of&nbsp;paren.</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2267501">p</span><span class="op" id="2267502">.</span><span class="ident" id="2267503">flags</span>&nbsp;<span class="op" id="2267509">=</span>&nbsp;<span class="ident" id="2267511">re2</span><span class="op" id="2267514">.</span><span class="ident" id="2267515">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2267522">if</span>&nbsp;<span class="ident" id="2267525">re2</span><span class="op" id="2267528">.</span><span class="ident" id="2267529">Cap</span>&nbsp;<span class="op" id="2267533">==</span>&nbsp;<span class="num" id="2267536">0</span>&nbsp;<span class="op" id="2267538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2267542">//&nbsp;Just&nbsp;for&nbsp;grouping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2267566">p</span><span class="op" id="2267567">.</span><span class="ident" id="2267568">push</span><span class="op" id="2267572">(</span><span class="ident" id="2267573">re1</span><span class="op" id="2267576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2267579">}</span>&nbsp;<span class="keyword" id="2267581">else</span>&nbsp;<span class="op" id="2267586">{</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2267590">re2</span><span class="op" id="2267593">.</span><span class="ident" id="2267594">Op</span>&nbsp;<span class="op" id="2267597">=</span>&nbsp;<span class="ident" id="2267599">OpCapture</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2267611">re2</span><span class="op" id="2267614">.</span><span class="ident" id="2267615">Sub</span>&nbsp;<span class="op" id="2267619">=</span>&nbsp;<span class="ident" id="2267621">re2</span><span class="op" id="2267624">.</span><span class="ident" id="2267625">Sub0</span><span class="op" id="2267629">[</span><span class="op" id="2267630">:</span><span class="num" id="2267631">1</span><span class="op" id="2267632">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2267636">re2</span><span class="op" id="2267639">.</span><span class="ident" id="2267640">Sub</span><span class="op" id="2267643">[</span><span class="num" id="2267644">0</span><span class="op" id="2267645">]</span>&nbsp;<span class="op" id="2267647">=</span>&nbsp;<span class="ident" id="2267649">re1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2267655">p</span><span class="op" id="2267656">.</span><span class="ident" id="2267657">push</span><span class="op" id="2267661">(</span><span class="ident" id="2267662">re2</span><span class="op" id="2267665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2267668">}</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2267671">return</span>&nbsp;<span class="ident" id="2267678">nil</span><br>
<span class="lineno"></span><span class="op" id="2267682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2267685">//&nbsp;parseEscape&nbsp;parses&nbsp;an&nbsp;escape&nbsp;sequence&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="2267748">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;rune.</span><br>
<span class="lineno">1230</span><span class="keyword" id="2267773">func</span>&nbsp;<span class="op" id="2267778">(</span><span class="ident" id="2267779">p</span>&nbsp;<span class="op" id="2267781">*</span><span class="ident" id="2267782">parser</span><span class="op" id="2267788">)</span>&nbsp;<span class="ident" id="2267790">parseEscape</span><span class="op" id="2267801">(</span><span class="ident" id="2267802">s</span>&nbsp;<span class="builtintype" id="2267804">string</span><span class="op" id="2267810">)</span>&nbsp;<span class="op" id="2267812">(</span><span class="ident" id="2267813">r</span>&nbsp;<span class="builtintype" id="2267815">rune</span><span class="op" id="2267819">,</span>&nbsp;<span class="ident" id="2267821">rest</span>&nbsp;<span class="builtintype" id="2267826">string</span><span class="op" id="2267832">,</span>&nbsp;<span class="ident" id="2267834">err</span>&nbsp;<span class="builtintype" id="2267838">error</span><span class="op" id="2267843">)</span>&nbsp;<span class="op" id="2267845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2267848">t</span>&nbsp;<span class="op" id="2267850">:=</span>&nbsp;<span class="ident" id="2267853">s</span><span class="op" id="2267854">[</span><span class="num" id="2267855">1</span><span class="op" id="2267856">:</span><span class="op" id="2267857">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2267860">if</span>&nbsp;<span class="ident" id="2267863">t</span>&nbsp;<span class="op" id="2267865">==</span>&nbsp;<span class="string" id="2267868">&#34;&#34;</span>&nbsp;<span class="op" id="2267871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2267875">return</span>&nbsp;<span class="num" id="2267882">0</span><span class="op" id="2267883">,</span>&nbsp;<span class="string" id="2267885">&#34;&#34;</span><span class="op" id="2267887">,</span>&nbsp;<span class="op" id="2267889">&amp;</span><span class="ident" id="2267890">Error</span><span class="op" id="2267895">{</span><span class="ident" id="2267896">ErrTrailingBackslash</span><span class="op" id="2267916">,</span>&nbsp;<span class="string" id="2267918">&#34;&#34;</span><span class="op" id="2267920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2267923">}</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2267926">c</span><span class="op" id="2267927">,</span>&nbsp;<span class="ident" id="2267929">t</span><span class="op" id="2267930">,</span>&nbsp;<span class="ident" id="2267932">err</span>&nbsp;<span class="op" id="2267936">:=</span>&nbsp;<span class="ident" id="2267939">nextRune</span><span class="op" id="2267947">(</span><span class="ident" id="2267948">t</span><span class="op" id="2267949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2267952">if</span>&nbsp;<span class="ident" id="2267955">err</span>&nbsp;<span class="op" id="2267959">!=</span>&nbsp;<span class="ident" id="2267962">nil</span>&nbsp;<span class="op" id="2267966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2267970">return</span>&nbsp;<span class="num" id="2267977">0</span><span class="op" id="2267978">,</span>&nbsp;<span class="string" id="2267980">&#34;&#34;</span><span class="op" id="2267982">,</span>&nbsp;<span class="ident" id="2267984">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2267989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1240</span><span class="ident" id="2267992">Switch</span><span class="op" id="2267998">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268001">switch</span>&nbsp;<span class="ident" id="2268008">c</span>&nbsp;<span class="op" id="2268010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268013">default</span><span class="op" id="2268020">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268024">if</span>&nbsp;<span class="ident" id="2268027">c</span>&nbsp;<span class="op" id="2268029">&lt;</span>&nbsp;<span class="ident" id="2268031">utf8</span><span class="op" id="2268035">.</span><span class="ident" id="2268036">RuneSelf</span>&nbsp;<span class="op" id="2268045">&amp;&amp;</span>&nbsp;<span class="op" id="2268048">!</span><span class="ident" id="2268049">isalnum</span><span class="op" id="2268056">(</span><span class="ident" id="2268057">c</span><span class="op" id="2268058">)</span>&nbsp;<span class="op" id="2268060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2268065">//&nbsp;Escaped&nbsp;non-word&nbsp;characters&nbsp;are&nbsp;always&nbsp;themselves.</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2268122">//&nbsp;PCRE&nbsp;is&nbsp;not&nbsp;quite&nbsp;so&nbsp;rigorous:&nbsp;it&nbsp;accepts&nbsp;things&nbsp;like</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2268182">//&nbsp;\q,&nbsp;but&nbsp;we&nbsp;don&#39;t.&nbsp;&nbsp;We&nbsp;once&nbsp;rejected&nbsp;\_,&nbsp;but&nbsp;too&nbsp;many</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2268241">//&nbsp;programs&nbsp;and&nbsp;people&nbsp;insist&nbsp;on&nbsp;using&nbsp;it,&nbsp;so&nbsp;allow&nbsp;\_.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268300">return</span>&nbsp;<span class="ident" id="2268307">c</span><span class="op" id="2268308">,</span>&nbsp;<span class="ident" id="2268310">t</span><span class="op" id="2268311">,</span>&nbsp;<span class="ident" id="2268313">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2268319">}</span><br>
<span class="lineno">1250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2268323">//&nbsp;Octal&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268342">case</span>&nbsp;<span class="string" id="2268347">&#39;1&#39;</span><span class="op" id="2268350">,</span>&nbsp;<span class="string" id="2268352">&#39;2&#39;</span><span class="op" id="2268355">,</span>&nbsp;<span class="string" id="2268357">&#39;3&#39;</span><span class="op" id="2268360">,</span>&nbsp;<span class="string" id="2268362">&#39;4&#39;</span><span class="op" id="2268365">,</span>&nbsp;<span class="string" id="2268367">&#39;5&#39;</span><span class="op" id="2268370">,</span>&nbsp;<span class="string" id="2268372">&#39;6&#39;</span><span class="op" id="2268375">,</span>&nbsp;<span class="string" id="2268377">&#39;7&#39;</span><span class="op" id="2268380">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2268384">//&nbsp;Single&nbsp;non-zero&nbsp;digit&nbsp;is&nbsp;a&nbsp;backreference;&nbsp;not&nbsp;supported</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268445">if</span>&nbsp;<span class="ident" id="2268448">t</span>&nbsp;<span class="op" id="2268450">==</span>&nbsp;<span class="string" id="2268453">&#34;&#34;</span>&nbsp;<span class="op" id="2268456">||</span>&nbsp;<span class="ident" id="2268459">t</span><span class="op" id="2268460">[</span><span class="num" id="2268461">0</span><span class="op" id="2268462">]</span>&nbsp;<span class="op" id="2268464">&lt;</span>&nbsp;<span class="string" id="2268466">&#39;0&#39;</span>&nbsp;<span class="op" id="2268470">||</span>&nbsp;<span class="ident" id="2268473">t</span><span class="op" id="2268474">[</span><span class="num" id="2268475">0</span><span class="op" id="2268476">]</span>&nbsp;<span class="op" id="2268478">&gt;</span>&nbsp;<span class="string" id="2268480">&#39;7&#39;</span>&nbsp;<span class="op" id="2268484">{</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268489">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2268497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268501">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268514">case</span>&nbsp;<span class="string" id="2268519">&#39;0&#39;</span><span class="op" id="2268522">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2268526">//&nbsp;Consume&nbsp;up&nbsp;to&nbsp;three&nbsp;octal&nbsp;digits;&nbsp;already&nbsp;have&nbsp;one.</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2268583">r</span>&nbsp;<span class="op" id="2268585">=</span>&nbsp;<span class="ident" id="2268587">c</span>&nbsp;<span class="op" id="2268589">-</span>&nbsp;<span class="string" id="2268591">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268597">for</span>&nbsp;<span class="ident" id="2268601">i</span>&nbsp;<span class="op" id="2268603">:=</span>&nbsp;<span class="num" id="2268606">1</span><span class="op" id="2268607">;</span>&nbsp;<span class="ident" id="2268609">i</span>&nbsp;<span class="op" id="2268611">&lt;</span>&nbsp;<span class="num" id="2268613">3</span><span class="op" id="2268614">;</span>&nbsp;<span class="ident" id="2268616">i</span><span class="op" id="2268617">++</span>&nbsp;<span class="op" id="2268620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268625">if</span>&nbsp;<span class="ident" id="2268628">t</span>&nbsp;<span class="op" id="2268630">==</span>&nbsp;<span class="string" id="2268633">&#34;&#34;</span>&nbsp;<span class="op" id="2268636">||</span>&nbsp;<span class="ident" id="2268639">t</span><span class="op" id="2268640">[</span><span class="num" id="2268641">0</span><span class="op" id="2268642">]</span>&nbsp;<span class="op" id="2268644">&lt;</span>&nbsp;<span class="string" id="2268646">&#39;0&#39;</span>&nbsp;<span class="op" id="2268650">||</span>&nbsp;<span class="ident" id="2268653">t</span><span class="op" id="2268654">[</span><span class="num" id="2268655">0</span><span class="op" id="2268656">]</span>&nbsp;<span class="op" id="2268658">&gt;</span>&nbsp;<span class="string" id="2268660">&#39;7&#39;</span>&nbsp;<span class="op" id="2268664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268670">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2268679">}</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2268684">r</span>&nbsp;<span class="op" id="2268686">=</span>&nbsp;<span class="ident" id="2268688">r</span><span class="op" id="2268689">*</span><span class="num" id="2268690">8</span>&nbsp;<span class="op" id="2268692">+</span>&nbsp;<span class="builtintype" id="2268694">rune</span><span class="op" id="2268698">(</span><span class="ident" id="2268699">t</span><span class="op" id="2268700">[</span><span class="num" id="2268701">0</span><span class="op" id="2268702">]</span><span class="op" id="2268703">)</span>&nbsp;<span class="op" id="2268705">-</span>&nbsp;<span class="string" id="2268707">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2268714">t</span>&nbsp;<span class="op" id="2268716">=</span>&nbsp;<span class="ident" id="2268718">t</span><span class="op" id="2268719">[</span><span class="num" id="2268720">1</span><span class="op" id="2268721">:</span><span class="op" id="2268722">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2268726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268730">return</span>&nbsp;<span class="ident" id="2268737">r</span><span class="op" id="2268738">,</span>&nbsp;<span class="ident" id="2268740">t</span><span class="op" id="2268741">,</span>&nbsp;<span class="ident" id="2268743">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2268749">//&nbsp;Hexadecimal&nbsp;escapes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268774">case</span>&nbsp;<span class="string" id="2268779">&#39;x&#39;</span><span class="op" id="2268782">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268786">if</span>&nbsp;<span class="ident" id="2268789">t</span>&nbsp;<span class="op" id="2268791">==</span>&nbsp;<span class="string" id="2268794">&#34;&#34;</span>&nbsp;<span class="op" id="2268797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268802">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2268810">}</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268814">if</span>&nbsp;<span class="ident" id="2268817">c</span><span class="op" id="2268818">,</span>&nbsp;<span class="ident" id="2268820">t</span><span class="op" id="2268821">,</span>&nbsp;<span class="ident" id="2268823">err</span>&nbsp;<span class="op" id="2268827">=</span>&nbsp;<span class="ident" id="2268829">nextRune</span><span class="op" id="2268837">(</span><span class="ident" id="2268838">t</span><span class="op" id="2268839">)</span><span class="op" id="2268840">;</span>&nbsp;<span class="ident" id="2268842">err</span>&nbsp;<span class="op" id="2268846">!=</span>&nbsp;<span class="ident" id="2268849">nil</span>&nbsp;<span class="op" id="2268853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268858">return</span>&nbsp;<span class="num" id="2268865">0</span><span class="op" id="2268866">,</span>&nbsp;<span class="string" id="2268868">&#34;&#34;</span><span class="op" id="2268870">,</span>&nbsp;<span class="ident" id="2268872">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2268878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2268882">if</span>&nbsp;<span class="ident" id="2268885">c</span>&nbsp;<span class="op" id="2268887">==</span>&nbsp;<span class="string" id="2268890">&#39;{&#39;</span>&nbsp;<span class="op" id="2268894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2268899">//&nbsp;Any&nbsp;number&nbsp;of&nbsp;digits&nbsp;in&nbsp;braces.</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2268937">//&nbsp;Perl&nbsp;accepts&nbsp;any&nbsp;text&nbsp;at&nbsp;all;&nbsp;it&nbsp;ignores&nbsp;all&nbsp;text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2268993">//&nbsp;after&nbsp;the&nbsp;first&nbsp;non-hex&nbsp;digit.&nbsp;&nbsp;We&nbsp;require&nbsp;only&nbsp;hex&nbsp;digits,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2269059">//&nbsp;and&nbsp;at&nbsp;least&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2269083">nhex</span>&nbsp;<span class="op" id="2269088">:=</span>&nbsp;<span class="num" id="2269091">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2269096">r</span>&nbsp;<span class="op" id="2269098">=</span>&nbsp;<span class="num" id="2269100">0</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2269105">for</span>&nbsp;<span class="op" id="2269109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2269115">if</span>&nbsp;<span class="ident" id="2269118">t</span>&nbsp;<span class="op" id="2269120">==</span>&nbsp;<span class="string" id="2269123">&#34;&#34;</span>&nbsp;<span class="op" id="2269126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2269133">break</span>&nbsp;<span class="ident" id="2269139">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2269150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2269156">if</span>&nbsp;<span class="ident" id="2269159">c</span><span class="op" id="2269160">,</span>&nbsp;<span class="ident" id="2269162">t</span><span class="op" id="2269163">,</span>&nbsp;<span class="ident" id="2269165">err</span>&nbsp;<span class="op" id="2269169">=</span>&nbsp;<span class="ident" id="2269171">nextRune</span><span class="op" id="2269179">(</span><span class="ident" id="2269180">t</span><span class="op" id="2269181">)</span><span class="op" id="2269182">;</span>&nbsp;<span class="ident" id="2269184">err</span>&nbsp;<span class="op" id="2269188">!=</span>&nbsp;<span class="ident" id="2269191">nil</span>&nbsp;<span class="op" id="2269195">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2269202">return</span>&nbsp;<span class="num" id="2269209">0</span><span class="op" id="2269210">,</span>&nbsp;<span class="string" id="2269212">&#34;&#34;</span><span class="op" id="2269214">,</span>&nbsp;<span class="ident" id="2269216">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2269224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2269230">if</span>&nbsp;<span class="ident" id="2269233">c</span>&nbsp;<span class="op" id="2269235">==</span>&nbsp;<span class="string" id="2269238">&#39;}&#39;</span>&nbsp;<span class="op" id="2269242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2269249">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2269259">}</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2269265">v</span>&nbsp;<span class="op" id="2269267">:=</span>&nbsp;<span class="ident" id="2269270">unhex</span><span class="op" id="2269275">(</span><span class="ident" id="2269276">c</span><span class="op" id="2269277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2269283">if</span>&nbsp;<span class="ident" id="2269286">v</span>&nbsp;<span class="op" id="2269288">&lt;</span>&nbsp;<span class="num" id="2269290">0</span>&nbsp;<span class="op" id="2269292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2269299">break</span>&nbsp;<span class="ident" id="2269305">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2269316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2269322">r</span>&nbsp;<span class="op" id="2269324">=</span>&nbsp;<span class="ident" id="2269326">r</span><span class="op" id="2269327">*</span><span class="num" id="2269328">16</span>&nbsp;<span class="op" id="2269331">+</span>&nbsp;<span class="ident" id="2269333">v</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2269339">if</span>&nbsp;<span class="ident" id="2269342">r</span>&nbsp;<span class="op" id="2269344">&gt;</span>&nbsp;<span class="ident" id="2269346">unicode</span><span class="op" id="2269353">.</span><span class="ident" id="2269354">MaxRune</span>&nbsp;<span class="op" id="2269362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2269369">break</span>&nbsp;<span class="ident" id="2269375">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2269386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2269392">nhex</span><span class="op" id="2269396">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2269402">}</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2269407">if</span>&nbsp;<span class="ident" id="2269410">nhex</span>&nbsp;<span class="op" id="2269415">==</span>&nbsp;<span class="num" id="2269418">0</span>&nbsp;<span class="op" id="2269420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2269426">break</span>&nbsp;<span class="ident" id="2269432">Switch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2269442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2269447">return</span>&nbsp;<span class="ident" id="2269454">r</span><span class="op" id="2269455">,</span>&nbsp;<span class="ident" id="2269457">t</span><span class="op" id="2269458">,</span>&nbsp;<span class="ident" id="2269460">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2269466">}</span><br>
<span class="lineno">1310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2269471">//&nbsp;Easy&nbsp;case:&nbsp;two&nbsp;hex&nbsp;digits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2269503">x</span>&nbsp;<span class="op" id="2269505">:=</span>&nbsp;<span class="ident" id="2269508">unhex</span><span class="op" id="2269513">(</span><span class="ident" id="2269514">c</span><span class="op" id="2269515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2269519">if</span>&nbsp;<span class="ident" id="2269522">c</span><span class="op" id="2269523">,</span>&nbsp;<span class="ident" id="2269525">t</span><span class="op" id="2269526">,</span>&nbsp;<span class="ident" id="2269528">err</span>&nbsp;<span class="op" id="2269532">=</span>&nbsp;<span class="ident" id="2269534">nextRune</span><span class="op" id="2269542">(</span><span class="ident" id="2269543">t</span><span class="op" id="2269544">)</span><span class="op" id="2269545">;</span>&nbsp;<span class="ident" id="2269547">err</span>&nbsp;<span class="op" id="2269551">!=</span>&nbsp;<span class="ident" id="2269554">nil</span>&nbsp;<span class="op" id="2269558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2269563">return</span>&nbsp;<span class="num" id="2269570">0</span><span class="op" id="2269571">,</span>&nbsp;<span class="string" id="2269573">&#34;&#34;</span><span class="op" id="2269575">,</span>&nbsp;<span class="ident" id="2269577">err</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2269583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2269587">y</span>&nbsp;<span class="op" id="2269589">:=</span>&nbsp;<span class="ident" id="2269592">unhex</span><span class="op" id="2269597">(</span><span class="ident" id="2269598">c</span><span class="op" id="2269599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2269603">if</span>&nbsp;<span class="ident" id="2269606">x</span>&nbsp;<span class="op" id="2269608">&lt;</span>&nbsp;<span class="num" id="2269610">0</span>&nbsp;<span class="op" id="2269612">||</span>&nbsp;<span class="ident" id="2269615">y</span>&nbsp;<span class="op" id="2269617">&lt;</span>&nbsp;<span class="num" id="2269619">0</span>&nbsp;<span class="op" id="2269621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2269626">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2269634">}</span><br>
<span class="lineno">1320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2269638">return</span>&nbsp;<span class="ident" id="2269645">x</span><span class="op" id="2269646">*</span><span class="num" id="2269647">16</span>&nbsp;<span class="op" id="2269650">+</span>&nbsp;<span class="ident" id="2269652">y</span><span class="op" id="2269653">,</span>&nbsp;<span class="ident" id="2269655">t</span><span class="op" id="2269656">,</span>&nbsp;<span class="ident" id="2269658">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2269664">//&nbsp;C&nbsp;escapes.&nbsp;&nbsp;There&nbsp;is&nbsp;no&nbsp;case&nbsp;&#39;b&#39;,&nbsp;to&nbsp;avoid&nbsp;misparsing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2269722">//&nbsp;the&nbsp;Perl&nbsp;word-boundary&nbsp;\b&nbsp;as&nbsp;the&nbsp;C&nbsp;backspace&nbsp;\b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2269774">//&nbsp;when&nbsp;in&nbsp;POSIX&nbsp;mode.&nbsp;&nbsp;In&nbsp;Perl,&nbsp;/\b/&nbsp;means&nbsp;word-boundary</span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2269833">//&nbsp;but&nbsp;/[\b]/&nbsp;means&nbsp;backspace.&nbsp;&nbsp;We&nbsp;don&#39;t&nbsp;support&nbsp;that.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2269889">//&nbsp;If&nbsp;you&nbsp;want&nbsp;a&nbsp;backspace,&nbsp;embed&nbsp;a&nbsp;literal&nbsp;backspace</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2269944">//&nbsp;character&nbsp;or&nbsp;use&nbsp;\x08.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2269971">case</span>&nbsp;<span class="string" id="2269976">&#39;a&#39;</span><span class="op" id="2269979">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2269983">return</span>&nbsp;<span class="string" id="2269990">&#39;\a&#39;</span><span class="op" id="2269994">,</span>&nbsp;<span class="ident" id="2269996">t</span><span class="op" id="2269997">,</span>&nbsp;<span class="ident" id="2269999">err</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270004">case</span>&nbsp;<span class="string" id="2270009">&#39;f&#39;</span><span class="op" id="2270012">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270016">return</span>&nbsp;<span class="string" id="2270023">&#39;\f&#39;</span><span class="op" id="2270027">,</span>&nbsp;<span class="ident" id="2270029">t</span><span class="op" id="2270030">,</span>&nbsp;<span class="ident" id="2270032">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270037">case</span>&nbsp;<span class="string" id="2270042">&#39;n&#39;</span><span class="op" id="2270045">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270049">return</span>&nbsp;<span class="string" id="2270056">&#39;\n&#39;</span><span class="op" id="2270060">,</span>&nbsp;<span class="ident" id="2270062">t</span><span class="op" id="2270063">,</span>&nbsp;<span class="ident" id="2270065">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270070">case</span>&nbsp;<span class="string" id="2270075">&#39;r&#39;</span><span class="op" id="2270078">:</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270082">return</span>&nbsp;<span class="string" id="2270089">&#39;\r&#39;</span><span class="op" id="2270093">,</span>&nbsp;<span class="ident" id="2270095">t</span><span class="op" id="2270096">,</span>&nbsp;<span class="ident" id="2270098">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270103">case</span>&nbsp;<span class="string" id="2270108">&#39;t&#39;</span><span class="op" id="2270111">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270115">return</span>&nbsp;<span class="string" id="2270122">&#39;\t&#39;</span><span class="op" id="2270126">,</span>&nbsp;<span class="ident" id="2270128">t</span><span class="op" id="2270129">,</span>&nbsp;<span class="ident" id="2270131">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270136">case</span>&nbsp;<span class="string" id="2270141">&#39;v&#39;</span><span class="op" id="2270144">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270148">return</span>&nbsp;<span class="string" id="2270155">&#39;\v&#39;</span><span class="op" id="2270159">,</span>&nbsp;<span class="ident" id="2270161">t</span><span class="op" id="2270162">,</span>&nbsp;<span class="ident" id="2270164">err</span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2270169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270172">return</span>&nbsp;<span class="num" id="2270179">0</span><span class="op" id="2270180">,</span>&nbsp;<span class="string" id="2270182">&#34;&#34;</span><span class="op" id="2270184">,</span>&nbsp;<span class="op" id="2270186">&amp;</span><span class="ident" id="2270187">Error</span><span class="op" id="2270192">{</span><span class="ident" id="2270193">ErrInvalidEscape</span><span class="op" id="2270209">,</span>&nbsp;<span class="ident" id="2270211">s</span><span class="op" id="2270212">[</span><span class="op" id="2270213">:</span><span class="builtinfunc" id="2270214">len</span><span class="op" id="2270217">(</span><span class="ident" id="2270218">s</span><span class="op" id="2270219">)</span><span class="op" id="2270220">-</span><span class="builtinfunc" id="2270221">len</span><span class="op" id="2270224">(</span><span class="ident" id="2270225">t</span><span class="op" id="2270226">)</span><span class="op" id="2270227">]</span><span class="op" id="2270228">}</span><br>
<span class="lineno"></span><span class="op" id="2270230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2270233">//&nbsp;parseClassChar&nbsp;parses&nbsp;a&nbsp;character&nbsp;class&nbsp;character&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno">1345</span><span class="comment" id="2270308">//&nbsp;and&nbsp;returns&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="2270327">func</span>&nbsp;<span class="op" id="2270332">(</span><span class="ident" id="2270333">p</span>&nbsp;<span class="op" id="2270335">*</span><span class="ident" id="2270336">parser</span><span class="op" id="2270342">)</span>&nbsp;<span class="ident" id="2270344">parseClassChar</span><span class="op" id="2270358">(</span><span class="ident" id="2270359">s</span><span class="op" id="2270360">,</span>&nbsp;<span class="ident" id="2270362">wholeClass</span>&nbsp;<span class="builtintype" id="2270373">string</span><span class="op" id="2270379">)</span>&nbsp;<span class="op" id="2270381">(</span><span class="ident" id="2270382">r</span>&nbsp;<span class="builtintype" id="2270384">rune</span><span class="op" id="2270388">,</span>&nbsp;<span class="ident" id="2270390">rest</span>&nbsp;<span class="builtintype" id="2270395">string</span><span class="op" id="2270401">,</span>&nbsp;<span class="ident" id="2270403">err</span>&nbsp;<span class="builtintype" id="2270407">error</span><span class="op" id="2270412">)</span>&nbsp;<span class="op" id="2270414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270417">if</span>&nbsp;<span class="ident" id="2270420">s</span>&nbsp;<span class="op" id="2270422">==</span>&nbsp;<span class="string" id="2270425">&#34;&#34;</span>&nbsp;<span class="op" id="2270428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270432">return</span>&nbsp;<span class="num" id="2270439">0</span><span class="op" id="2270440">,</span>&nbsp;<span class="string" id="2270442">&#34;&#34;</span><span class="op" id="2270444">,</span>&nbsp;<span class="op" id="2270446">&amp;</span><span class="ident" id="2270447">Error</span><span class="op" id="2270452">{</span><span class="ident" id="2270453">Code</span><span class="op" id="2270457">:</span>&nbsp;<span class="ident" id="2270459">ErrMissingBracket</span><span class="op" id="2270476">,</span>&nbsp;<span class="ident" id="2270478">Expr</span><span class="op" id="2270482">:</span>&nbsp;<span class="ident" id="2270484">wholeClass</span><span class="op" id="2270494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2270497">}</span><br>
<span class="lineno">1350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2270501">//&nbsp;Allow&nbsp;regular&nbsp;escape&nbsp;sequences&nbsp;even&nbsp;though</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2270548">//&nbsp;many&nbsp;need&nbsp;not&nbsp;be&nbsp;escaped&nbsp;in&nbsp;this&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270594">if</span>&nbsp;<span class="ident" id="2270597">s</span><span class="op" id="2270598">[</span><span class="num" id="2270599">0</span><span class="op" id="2270600">]</span>&nbsp;<span class="op" id="2270602">==</span>&nbsp;<span class="string" id="2270605">&#39;\\&#39;</span>&nbsp;<span class="op" id="2270610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270614">return</span>&nbsp;<span class="ident" id="2270621">p</span><span class="op" id="2270622">.</span><span class="ident" id="2270623">parseEscape</span><span class="op" id="2270634">(</span><span class="ident" id="2270635">s</span><span class="op" id="2270636">)</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2270639">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2270643">return</span>&nbsp;<span class="ident" id="2270650">nextRune</span><span class="op" id="2270658">(</span><span class="ident" id="2270659">s</span><span class="op" id="2270660">)</span><br>
<span class="lineno"></span><span class="op" id="2270662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1360</span><span class="keyword" id="2270665">type</span>&nbsp;<span class="ident" id="2270670">charGroup</span>&nbsp;<span class="keyword" id="2270680">struct</span>&nbsp;<span class="op" id="2270687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2270690">sign</span>&nbsp;&nbsp;<span class="builtintype" id="2270696">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2270701">class</span>&nbsp;<span class="op" id="2270707">[</span><span class="op" id="2270708">]</span><span class="builtintype" id="2270709">rune</span><br>
<span class="lineno"></span><span class="op" id="2270714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1365</span><span class="comment" id="2270717">//&nbsp;parsePerlClassEscape&nbsp;parses&nbsp;a&nbsp;leading&nbsp;Perl&nbsp;character&nbsp;class&nbsp;escape&nbsp;like&nbsp;\d</span><br>
<span class="lineno"></span><span class="comment" id="2270794">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="2270873">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="2270937">func</span>&nbsp;<span class="op" id="2270942">(</span><span class="ident" id="2270943">p</span>&nbsp;<span class="op" id="2270945">*</span><span class="ident" id="2270946">parser</span><span class="op" id="2270952">)</span>&nbsp;<span class="ident" id="2270954">parsePerlClassEscape</span><span class="op" id="2270974">(</span><span class="ident" id="2270975">s</span>&nbsp;<span class="builtintype" id="2270977">string</span><span class="op" id="2270983">,</span>&nbsp;<span class="ident" id="2270985">r</span>&nbsp;<span class="op" id="2270987">[</span><span class="op" id="2270988">]</span><span class="builtintype" id="2270989">rune</span><span class="op" id="2270993">)</span>&nbsp;<span class="op" id="2270995">(</span><span class="ident" id="2270996">out</span>&nbsp;<span class="op" id="2271000">[</span><span class="op" id="2271001">]</span><span class="builtintype" id="2271002">rune</span><span class="op" id="2271006">,</span>&nbsp;<span class="ident" id="2271008">rest</span>&nbsp;<span class="builtintype" id="2271013">string</span><span class="op" id="2271019">)</span>&nbsp;<span class="op" id="2271021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271024">if</span>&nbsp;<span class="ident" id="2271027">p</span><span class="op" id="2271028">.</span><span class="ident" id="2271029">flags</span><span class="op" id="2271034">&amp;</span><span class="ident" id="2271035">PerlX</span>&nbsp;<span class="op" id="2271041">==</span>&nbsp;<span class="num" id="2271044">0</span>&nbsp;<span class="op" id="2271046">||</span>&nbsp;<span class="builtinfunc" id="2271049">len</span><span class="op" id="2271052">(</span><span class="ident" id="2271053">s</span><span class="op" id="2271054">)</span>&nbsp;<span class="op" id="2271056">&lt;</span>&nbsp;<span class="num" id="2271058">2</span>&nbsp;<span class="op" id="2271060">||</span>&nbsp;<span class="ident" id="2271063">s</span><span class="op" id="2271064">[</span><span class="num" id="2271065">0</span><span class="op" id="2271066">]</span>&nbsp;<span class="op" id="2271068">!=</span>&nbsp;<span class="string" id="2271071">&#39;\\&#39;</span>&nbsp;<span class="op" id="2271076">{</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271080">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2271088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2271091">g</span>&nbsp;<span class="op" id="2271093">:=</span>&nbsp;<span class="ident" id="2271096">perlGroup</span><span class="op" id="2271105">[</span><span class="ident" id="2271106">s</span><span class="op" id="2271107">[</span><span class="num" id="2271108">0</span><span class="op" id="2271109">:</span><span class="num" id="2271110">2</span><span class="op" id="2271111">]</span><span class="op" id="2271112">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271115">if</span>&nbsp;<span class="ident" id="2271118">g</span><span class="op" id="2271119">.</span><span class="ident" id="2271120">sign</span>&nbsp;<span class="op" id="2271125">==</span>&nbsp;<span class="num" id="2271128">0</span>&nbsp;<span class="op" id="2271130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271134">return</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2271142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271145">return</span>&nbsp;<span class="ident" id="2271152">p</span><span class="op" id="2271153">.</span><span class="ident" id="2271154">appendGroup</span><span class="op" id="2271165">(</span><span class="ident" id="2271166">r</span><span class="op" id="2271167">,</span>&nbsp;<span class="ident" id="2271169">g</span><span class="op" id="2271170">)</span><span class="op" id="2271171">,</span>&nbsp;<span class="ident" id="2271173">s</span><span class="op" id="2271174">[</span><span class="num" id="2271175">2</span><span class="op" id="2271176">:</span><span class="op" id="2271177">]</span><br>
<span class="lineno"></span><span class="op" id="2271179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2271182">//&nbsp;parseNamedClass&nbsp;parses&nbsp;a&nbsp;leading&nbsp;POSIX&nbsp;named&nbsp;character&nbsp;class&nbsp;like&nbsp;[:alnum:]</span><br>
<span class="lineno">1380</span><span class="comment" id="2271261">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="2271340">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="2271404">func</span>&nbsp;<span class="op" id="2271409">(</span><span class="ident" id="2271410">p</span>&nbsp;<span class="op" id="2271412">*</span><span class="ident" id="2271413">parser</span><span class="op" id="2271419">)</span>&nbsp;<span class="ident" id="2271421">parseNamedClass</span><span class="op" id="2271436">(</span><span class="ident" id="2271437">s</span>&nbsp;<span class="builtintype" id="2271439">string</span><span class="op" id="2271445">,</span>&nbsp;<span class="ident" id="2271447">r</span>&nbsp;<span class="op" id="2271449">[</span><span class="op" id="2271450">]</span><span class="builtintype" id="2271451">rune</span><span class="op" id="2271455">)</span>&nbsp;<span class="op" id="2271457">(</span><span class="ident" id="2271458">out</span>&nbsp;<span class="op" id="2271462">[</span><span class="op" id="2271463">]</span><span class="builtintype" id="2271464">rune</span><span class="op" id="2271468">,</span>&nbsp;<span class="ident" id="2271470">rest</span>&nbsp;<span class="builtintype" id="2271475">string</span><span class="op" id="2271481">,</span>&nbsp;<span class="ident" id="2271483">err</span>&nbsp;<span class="builtintype" id="2271487">error</span><span class="op" id="2271492">)</span>&nbsp;<span class="op" id="2271494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271497">if</span>&nbsp;<span class="builtinfunc" id="2271500">len</span><span class="op" id="2271503">(</span><span class="ident" id="2271504">s</span><span class="op" id="2271505">)</span>&nbsp;<span class="op" id="2271507">&lt;</span>&nbsp;<span class="num" id="2271509">2</span>&nbsp;<span class="op" id="2271511">||</span>&nbsp;<span class="ident" id="2271514">s</span><span class="op" id="2271515">[</span><span class="num" id="2271516">0</span><span class="op" id="2271517">]</span>&nbsp;<span class="op" id="2271519">!=</span>&nbsp;<span class="string" id="2271522">&#39;[&#39;</span>&nbsp;<span class="op" id="2271526">||</span>&nbsp;<span class="ident" id="2271529">s</span><span class="op" id="2271530">[</span><span class="num" id="2271531">1</span><span class="op" id="2271532">]</span>&nbsp;<span class="op" id="2271534">!=</span>&nbsp;<span class="string" id="2271537">&#39;:&#39;</span>&nbsp;<span class="op" id="2271541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271545">return</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2271553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2271557">i</span>&nbsp;<span class="op" id="2271559">:=</span>&nbsp;<span class="ident" id="2271562">strings</span><span class="op" id="2271569">.</span><span class="ident" id="2271570">Index</span><span class="op" id="2271575">(</span><span class="ident" id="2271576">s</span><span class="op" id="2271577">[</span><span class="num" id="2271578">2</span><span class="op" id="2271579">:</span><span class="op" id="2271580">]</span><span class="op" id="2271581">,</span>&nbsp;<span class="string" id="2271583">&#34;:]&#34;</span><span class="op" id="2271587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271590">if</span>&nbsp;<span class="ident" id="2271593">i</span>&nbsp;<span class="op" id="2271595">&lt;</span>&nbsp;<span class="num" id="2271597">0</span>&nbsp;<span class="op" id="2271599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271603">return</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2271611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2271614">i</span>&nbsp;<span class="op" id="2271616">+=</span>&nbsp;<span class="num" id="2271619">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2271622">name</span><span class="op" id="2271626">,</span>&nbsp;<span class="ident" id="2271628">s</span>&nbsp;<span class="op" id="2271630">:=</span>&nbsp;<span class="ident" id="2271633">s</span><span class="op" id="2271634">[</span><span class="num" id="2271635">0</span><span class="op" id="2271636">:</span><span class="ident" id="2271637">i</span><span class="op" id="2271638">+</span><span class="num" id="2271639">2</span><span class="op" id="2271640">]</span><span class="op" id="2271641">,</span>&nbsp;<span class="ident" id="2271643">s</span><span class="op" id="2271644">[</span><span class="ident" id="2271645">i</span><span class="op" id="2271646">+</span><span class="num" id="2271647">2</span><span class="op" id="2271648">:</span><span class="op" id="2271649">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2271652">g</span>&nbsp;<span class="op" id="2271654">:=</span>&nbsp;<span class="ident" id="2271657">posixGroup</span><span class="op" id="2271667">[</span><span class="ident" id="2271668">name</span><span class="op" id="2271672">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271675">if</span>&nbsp;<span class="ident" id="2271678">g</span><span class="op" id="2271679">.</span><span class="ident" id="2271680">sign</span>&nbsp;<span class="op" id="2271685">==</span>&nbsp;<span class="num" id="2271688">0</span>&nbsp;<span class="op" id="2271690">{</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271694">return</span>&nbsp;<span class="ident" id="2271701">nil</span><span class="op" id="2271704">,</span>&nbsp;<span class="string" id="2271706">&#34;&#34;</span><span class="op" id="2271708">,</span>&nbsp;<span class="op" id="2271710">&amp;</span><span class="ident" id="2271711">Error</span><span class="op" id="2271716">{</span><span class="ident" id="2271717">ErrInvalidCharRange</span><span class="op" id="2271736">,</span>&nbsp;<span class="ident" id="2271738">name</span><span class="op" id="2271742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2271745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271748">return</span>&nbsp;<span class="ident" id="2271755">p</span><span class="op" id="2271756">.</span><span class="ident" id="2271757">appendGroup</span><span class="op" id="2271768">(</span><span class="ident" id="2271769">r</span><span class="op" id="2271770">,</span>&nbsp;<span class="ident" id="2271772">g</span><span class="op" id="2271773">)</span><span class="op" id="2271774">,</span>&nbsp;<span class="ident" id="2271776">s</span><span class="op" id="2271777">,</span>&nbsp;<span class="ident" id="2271779">nil</span><br>
<span class="lineno"></span><span class="op" id="2271783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1400</span><span class="keyword" id="2271786">func</span>&nbsp;<span class="op" id="2271791">(</span><span class="ident" id="2271792">p</span>&nbsp;<span class="op" id="2271794">*</span><span class="ident" id="2271795">parser</span><span class="op" id="2271801">)</span>&nbsp;<span class="ident" id="2271803">appendGroup</span><span class="op" id="2271814">(</span><span class="ident" id="2271815">r</span>&nbsp;<span class="op" id="2271817">[</span><span class="op" id="2271818">]</span><span class="builtintype" id="2271819">rune</span><span class="op" id="2271823">,</span>&nbsp;<span class="ident" id="2271825">g</span>&nbsp;<span class="ident" id="2271827">charGroup</span><span class="op" id="2271836">)</span>&nbsp;<span class="op" id="2271838">[</span><span class="op" id="2271839">]</span><span class="builtintype" id="2271840">rune</span>&nbsp;<span class="op" id="2271845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271848">if</span>&nbsp;<span class="ident" id="2271851">p</span><span class="op" id="2271852">.</span><span class="ident" id="2271853">flags</span><span class="op" id="2271858">&amp;</span><span class="ident" id="2271859">FoldCase</span>&nbsp;<span class="op" id="2271868">==</span>&nbsp;<span class="num" id="2271871">0</span>&nbsp;<span class="op" id="2271873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2271877">if</span>&nbsp;<span class="ident" id="2271880">g</span><span class="op" id="2271881">.</span><span class="ident" id="2271882">sign</span>&nbsp;<span class="op" id="2271887">&lt;</span>&nbsp;<span class="num" id="2271889">0</span>&nbsp;<span class="op" id="2271891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2271896">r</span>&nbsp;<span class="op" id="2271898">=</span>&nbsp;<span class="ident" id="2271900">appendNegatedClass</span><span class="op" id="2271918">(</span><span class="ident" id="2271919">r</span><span class="op" id="2271920">,</span>&nbsp;<span class="ident" id="2271922">g</span><span class="op" id="2271923">.</span><span class="ident" id="2271924">class</span><span class="op" id="2271929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2271933">}</span>&nbsp;<span class="keyword" id="2271935">else</span>&nbsp;<span class="op" id="2271940">{</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2271945">r</span>&nbsp;<span class="op" id="2271947">=</span>&nbsp;<span class="ident" id="2271949">appendClass</span><span class="op" id="2271960">(</span><span class="ident" id="2271961">r</span><span class="op" id="2271962">,</span>&nbsp;<span class="ident" id="2271964">g</span><span class="op" id="2271965">.</span><span class="ident" id="2271966">class</span><span class="op" id="2271971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2271975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2271978">}</span>&nbsp;<span class="keyword" id="2271980">else</span>&nbsp;<span class="op" id="2271985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2271989">tmp</span>&nbsp;<span class="op" id="2271993">:=</span>&nbsp;<span class="ident" id="2271996">p</span><span class="op" id="2271997">.</span><span class="ident" id="2271998">tmpClass</span><span class="op" id="2272006">[</span><span class="op" id="2272007">:</span><span class="num" id="2272008">0</span><span class="op" id="2272009">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272013">tmp</span>&nbsp;<span class="op" id="2272017">=</span>&nbsp;<span class="ident" id="2272019">appendFoldedClass</span><span class="op" id="2272036">(</span><span class="ident" id="2272037">tmp</span><span class="op" id="2272040">,</span>&nbsp;<span class="ident" id="2272042">g</span><span class="op" id="2272043">.</span><span class="ident" id="2272044">class</span><span class="op" id="2272049">)</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272053">p</span><span class="op" id="2272054">.</span><span class="ident" id="2272055">tmpClass</span>&nbsp;<span class="op" id="2272064">=</span>&nbsp;<span class="ident" id="2272066">tmp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272072">tmp</span>&nbsp;<span class="op" id="2272076">=</span>&nbsp;<span class="ident" id="2272078">cleanClass</span><span class="op" id="2272088">(</span><span class="op" id="2272089">&amp;</span><span class="ident" id="2272090">p</span><span class="op" id="2272091">.</span><span class="ident" id="2272092">tmpClass</span><span class="op" id="2272100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272104">if</span>&nbsp;<span class="ident" id="2272107">g</span><span class="op" id="2272108">.</span><span class="ident" id="2272109">sign</span>&nbsp;<span class="op" id="2272114">&lt;</span>&nbsp;<span class="num" id="2272116">0</span>&nbsp;<span class="op" id="2272118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272123">r</span>&nbsp;<span class="op" id="2272125">=</span>&nbsp;<span class="ident" id="2272127">appendNegatedClass</span><span class="op" id="2272145">(</span><span class="ident" id="2272146">r</span><span class="op" id="2272147">,</span>&nbsp;<span class="ident" id="2272149">tmp</span><span class="op" id="2272152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2272156">}</span>&nbsp;<span class="keyword" id="2272158">else</span>&nbsp;<span class="op" id="2272163">{</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272168">r</span>&nbsp;<span class="op" id="2272170">=</span>&nbsp;<span class="ident" id="2272172">appendClass</span><span class="op" id="2272183">(</span><span class="ident" id="2272184">r</span><span class="op" id="2272185">,</span>&nbsp;<span class="ident" id="2272187">tmp</span><span class="op" id="2272190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2272194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2272197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272200">return</span>&nbsp;<span class="ident" id="2272207">r</span><br>
<span class="lineno"></span><span class="op" id="2272209">}</span><br>
<span class="lineno">1420</span><br>
<span class="lineno"></span><span class="keyword" id="2272212">var</span>&nbsp;<span class="ident" id="2272216">anyTable</span>&nbsp;<span class="op" id="2272225">=</span>&nbsp;<span class="op" id="2272227">&amp;</span><span class="ident" id="2272228">unicode</span><span class="op" id="2272235">.</span><span class="ident" id="2272236">RangeTable</span><span class="op" id="2272246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272249">R16</span><span class="op" id="2272252">:</span>&nbsp;<span class="op" id="2272254">[</span><span class="op" id="2272255">]</span><span class="ident" id="2272256">unicode</span><span class="op" id="2272263">.</span><span class="ident" id="2272264">Range16</span><span class="op" id="2272271">{</span><span class="op" id="2272272">{</span><span class="ident" id="2272273">Lo</span><span class="op" id="2272275">:</span>&nbsp;<span class="num" id="2272277">0</span><span class="op" id="2272278">,</span>&nbsp;<span class="ident" id="2272280">Hi</span><span class="op" id="2272282">:</span>&nbsp;<span class="num" id="2272284">1</span><span class="op" id="2272285">&lt;&lt;</span><span class="num" id="2272287">16</span>&nbsp;<span class="op" id="2272290">-</span>&nbsp;<span class="num" id="2272292">1</span><span class="op" id="2272293">,</span>&nbsp;<span class="ident" id="2272295">Stride</span><span class="op" id="2272301">:</span>&nbsp;<span class="num" id="2272303">1</span><span class="op" id="2272304">}</span><span class="op" id="2272305">}</span><span class="op" id="2272306">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2272309">R32</span><span class="op" id="2272312">:</span>&nbsp;<span class="op" id="2272314">[</span><span class="op" id="2272315">]</span><span class="ident" id="2272316">unicode</span><span class="op" id="2272323">.</span><span class="ident" id="2272324">Range32</span><span class="op" id="2272331">{</span><span class="op" id="2272332">{</span><span class="ident" id="2272333">Lo</span><span class="op" id="2272335">:</span>&nbsp;<span class="num" id="2272337">1</span>&nbsp;<span class="op" id="2272339">&lt;&lt;</span>&nbsp;<span class="num" id="2272342">16</span><span class="op" id="2272344">,</span>&nbsp;<span class="ident" id="2272346">Hi</span><span class="op" id="2272348">:</span>&nbsp;<span class="ident" id="2272350">unicode</span><span class="op" id="2272357">.</span><span class="ident" id="2272358">MaxRune</span><span class="op" id="2272365">,</span>&nbsp;<span class="ident" id="2272367">Stride</span><span class="op" id="2272373">:</span>&nbsp;<span class="num" id="2272375">1</span><span class="op" id="2272376">}</span><span class="op" id="2272377">}</span><span class="op" id="2272378">,</span><br>
<span class="lineno"></span><span class="op" id="2272380">}</span><br>
<span class="lineno">1425</span><br>
<span class="lineno"></span><span class="comment" id="2272383">//&nbsp;unicodeTable&nbsp;returns&nbsp;the&nbsp;unicode.RangeTable&nbsp;identified&nbsp;by&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="2272449">//&nbsp;and&nbsp;the&nbsp;table&nbsp;of&nbsp;additional&nbsp;fold-equivalent&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="keyword" id="2272509">func</span>&nbsp;<span class="ident" id="2272514">unicodeTable</span><span class="op" id="2272526">(</span><span class="ident" id="2272527">name</span>&nbsp;<span class="builtintype" id="2272532">string</span><span class="op" id="2272538">)</span>&nbsp;<span class="op" id="2272540">(</span><span class="op" id="2272541">*</span><span class="ident" id="2272542">unicode</span><span class="op" id="2272549">.</span><span class="ident" id="2272550">RangeTable</span><span class="op" id="2272560">,</span>&nbsp;<span class="op" id="2272562">*</span><span class="ident" id="2272563">unicode</span><span class="op" id="2272570">.</span><span class="ident" id="2272571">RangeTable</span><span class="op" id="2272581">)</span>&nbsp;<span class="op" id="2272583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2272586">//&nbsp;Special&nbsp;case:&nbsp;&#34;Any&#34;&nbsp;means&nbsp;any.</span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272621">if</span>&nbsp;<span class="ident" id="2272624">name</span>&nbsp;<span class="op" id="2272629">==</span>&nbsp;<span class="string" id="2272632">&#34;Any&#34;</span>&nbsp;<span class="op" id="2272638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272642">return</span>&nbsp;<span class="ident" id="2272649">anyTable</span><span class="op" id="2272657">,</span>&nbsp;<span class="ident" id="2272659">anyTable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2272669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272672">if</span>&nbsp;<span class="ident" id="2272675">t</span>&nbsp;<span class="op" id="2272677">:=</span>&nbsp;<span class="ident" id="2272680">unicode</span><span class="op" id="2272687">.</span><span class="ident" id="2272688">Categories</span><span class="op" id="2272698">[</span><span class="ident" id="2272699">name</span><span class="op" id="2272703">]</span><span class="op" id="2272704">;</span>&nbsp;<span class="ident" id="2272706">t</span>&nbsp;<span class="op" id="2272708">!=</span>&nbsp;<span class="ident" id="2272711">nil</span>&nbsp;<span class="op" id="2272715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272719">return</span>&nbsp;<span class="ident" id="2272726">t</span><span class="op" id="2272727">,</span>&nbsp;<span class="ident" id="2272729">unicode</span><span class="op" id="2272736">.</span><span class="ident" id="2272737">FoldCategory</span><span class="op" id="2272749">[</span><span class="ident" id="2272750">name</span><span class="op" id="2272754">]</span><br>
<span class="lineno">1435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2272757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272760">if</span>&nbsp;<span class="ident" id="2272763">t</span>&nbsp;<span class="op" id="2272765">:=</span>&nbsp;<span class="ident" id="2272768">unicode</span><span class="op" id="2272775">.</span><span class="ident" id="2272776">Scripts</span><span class="op" id="2272783">[</span><span class="ident" id="2272784">name</span><span class="op" id="2272788">]</span><span class="op" id="2272789">;</span>&nbsp;<span class="ident" id="2272791">t</span>&nbsp;<span class="op" id="2272793">!=</span>&nbsp;<span class="ident" id="2272796">nil</span>&nbsp;<span class="op" id="2272800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272804">return</span>&nbsp;<span class="ident" id="2272811">t</span><span class="op" id="2272812">,</span>&nbsp;<span class="ident" id="2272814">unicode</span><span class="op" id="2272821">.</span><span class="ident" id="2272822">FoldScript</span><span class="op" id="2272832">[</span><span class="ident" id="2272833">name</span><span class="op" id="2272837">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2272840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2272843">return</span>&nbsp;<span class="ident" id="2272850">nil</span><span class="op" id="2272853">,</span>&nbsp;<span class="ident" id="2272855">nil</span><br>
<span class="lineno">1440</span><span class="op" id="2272859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2272862">//&nbsp;parseUnicodeClass&nbsp;parses&nbsp;a&nbsp;leading&nbsp;Unicode&nbsp;character&nbsp;class&nbsp;like&nbsp;\p{Han}</span><br>
<span class="lineno"></span><span class="comment" id="2272937">//&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;one&nbsp;is&nbsp;present,&nbsp;it&nbsp;appends&nbsp;the&nbsp;characters&nbsp;to&nbsp;r</span><br>
<span class="lineno"></span><span class="comment" id="2273016">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;new&nbsp;slice&nbsp;r&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;string.</span><br>
<span class="lineno">1445</span><span class="keyword" id="2273080">func</span>&nbsp;<span class="op" id="2273085">(</span><span class="ident" id="2273086">p</span>&nbsp;<span class="op" id="2273088">*</span><span class="ident" id="2273089">parser</span><span class="op" id="2273095">)</span>&nbsp;<span class="ident" id="2273097">parseUnicodeClass</span><span class="op" id="2273114">(</span><span class="ident" id="2273115">s</span>&nbsp;<span class="builtintype" id="2273117">string</span><span class="op" id="2273123">,</span>&nbsp;<span class="ident" id="2273125">r</span>&nbsp;<span class="op" id="2273127">[</span><span class="op" id="2273128">]</span><span class="builtintype" id="2273129">rune</span><span class="op" id="2273133">)</span>&nbsp;<span class="op" id="2273135">(</span><span class="ident" id="2273136">out</span>&nbsp;<span class="op" id="2273140">[</span><span class="op" id="2273141">]</span><span class="builtintype" id="2273142">rune</span><span class="op" id="2273146">,</span>&nbsp;<span class="ident" id="2273148">rest</span>&nbsp;<span class="builtintype" id="2273153">string</span><span class="op" id="2273159">,</span>&nbsp;<span class="ident" id="2273161">err</span>&nbsp;<span class="builtintype" id="2273165">error</span><span class="op" id="2273170">)</span>&nbsp;<span class="op" id="2273172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273175">if</span>&nbsp;<span class="ident" id="2273178">p</span><span class="op" id="2273179">.</span><span class="ident" id="2273180">flags</span><span class="op" id="2273185">&amp;</span><span class="ident" id="2273186">UnicodeGroups</span>&nbsp;<span class="op" id="2273200">==</span>&nbsp;<span class="num" id="2273203">0</span>&nbsp;<span class="op" id="2273205">||</span>&nbsp;<span class="builtinfunc" id="2273208">len</span><span class="op" id="2273211">(</span><span class="ident" id="2273212">s</span><span class="op" id="2273213">)</span>&nbsp;<span class="op" id="2273215">&lt;</span>&nbsp;<span class="num" id="2273217">2</span>&nbsp;<span class="op" id="2273219">||</span>&nbsp;<span class="ident" id="2273222">s</span><span class="op" id="2273223">[</span><span class="num" id="2273224">0</span><span class="op" id="2273225">]</span>&nbsp;<span class="op" id="2273227">!=</span>&nbsp;<span class="string" id="2273230">&#39;\\&#39;</span>&nbsp;<span class="op" id="2273235">||</span>&nbsp;<span class="ident" id="2273238">s</span><span class="op" id="2273239">[</span><span class="num" id="2273240">1</span><span class="op" id="2273241">]</span>&nbsp;<span class="op" id="2273243">!=</span>&nbsp;<span class="string" id="2273246">&#39;p&#39;</span>&nbsp;<span class="op" id="2273250">&amp;&amp;</span>&nbsp;<span class="ident" id="2273253">s</span><span class="op" id="2273254">[</span><span class="num" id="2273255">1</span><span class="op" id="2273256">]</span>&nbsp;<span class="op" id="2273258">!=</span>&nbsp;<span class="string" id="2273261">&#39;P&#39;</span>&nbsp;<span class="op" id="2273265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273269">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2273281">//&nbsp;Committed&nbsp;to&nbsp;parse&nbsp;or&nbsp;return&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273321">sign</span>&nbsp;<span class="op" id="2273326">:=</span>&nbsp;<span class="op" id="2273329">+</span><span class="num" id="2273330">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273333">if</span>&nbsp;<span class="ident" id="2273336">s</span><span class="op" id="2273337">[</span><span class="num" id="2273338">1</span><span class="op" id="2273339">]</span>&nbsp;<span class="op" id="2273341">==</span>&nbsp;<span class="string" id="2273344">&#39;P&#39;</span>&nbsp;<span class="op" id="2273348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273352">sign</span>&nbsp;<span class="op" id="2273357">=</span>&nbsp;<span class="op" id="2273359">-</span><span class="num" id="2273360">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273363">}</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273366">t</span>&nbsp;<span class="op" id="2273368">:=</span>&nbsp;<span class="ident" id="2273371">s</span><span class="op" id="2273372">[</span><span class="num" id="2273373">2</span><span class="op" id="2273374">:</span><span class="op" id="2273375">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273378">c</span><span class="op" id="2273379">,</span>&nbsp;<span class="ident" id="2273381">t</span><span class="op" id="2273382">,</span>&nbsp;<span class="ident" id="2273384">err</span>&nbsp;<span class="op" id="2273388">:=</span>&nbsp;<span class="ident" id="2273391">nextRune</span><span class="op" id="2273399">(</span><span class="ident" id="2273400">t</span><span class="op" id="2273401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273404">if</span>&nbsp;<span class="ident" id="2273407">err</span>&nbsp;<span class="op" id="2273411">!=</span>&nbsp;<span class="ident" id="2273414">nil</span>&nbsp;<span class="op" id="2273418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273422">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273430">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273433">var</span>&nbsp;<span class="ident" id="2273437">seq</span><span class="op" id="2273440">,</span>&nbsp;<span class="ident" id="2273442">name</span>&nbsp;<span class="builtintype" id="2273447">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273455">if</span>&nbsp;<span class="ident" id="2273458">c</span>&nbsp;<span class="op" id="2273460">!=</span>&nbsp;<span class="string" id="2273463">&#39;{&#39;</span>&nbsp;<span class="op" id="2273467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2273471">//&nbsp;Single-letter&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273496">seq</span>&nbsp;<span class="op" id="2273500">=</span>&nbsp;<span class="ident" id="2273502">s</span><span class="op" id="2273503">[</span><span class="op" id="2273504">:</span><span class="builtinfunc" id="2273505">len</span><span class="op" id="2273508">(</span><span class="ident" id="2273509">s</span><span class="op" id="2273510">)</span><span class="op" id="2273511">-</span><span class="builtinfunc" id="2273512">len</span><span class="op" id="2273515">(</span><span class="ident" id="2273516">t</span><span class="op" id="2273517">)</span><span class="op" id="2273518">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273522">name</span>&nbsp;<span class="op" id="2273527">=</span>&nbsp;<span class="ident" id="2273529">seq</span><span class="op" id="2273532">[</span><span class="num" id="2273533">2</span><span class="op" id="2273534">:</span><span class="op" id="2273535">]</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273538">}</span>&nbsp;<span class="keyword" id="2273540">else</span>&nbsp;<span class="op" id="2273545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2273549">//&nbsp;Name&nbsp;is&nbsp;in&nbsp;braces.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273573">end</span>&nbsp;<span class="op" id="2273577">:=</span>&nbsp;<span class="ident" id="2273580">strings</span><span class="op" id="2273587">.</span><span class="ident" id="2273588">IndexRune</span><span class="op" id="2273597">(</span><span class="ident" id="2273598">s</span><span class="op" id="2273599">,</span>&nbsp;<span class="string" id="2273601">&#39;}&#39;</span><span class="op" id="2273604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273608">if</span>&nbsp;<span class="ident" id="2273611">end</span>&nbsp;<span class="op" id="2273615">&lt;</span>&nbsp;<span class="num" id="2273617">0</span>&nbsp;<span class="op" id="2273619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273624">if</span>&nbsp;<span class="ident" id="2273627">err</span>&nbsp;<span class="op" id="2273631">=</span>&nbsp;<span class="ident" id="2273633">checkUTF8</span><span class="op" id="2273642">(</span><span class="ident" id="2273643">s</span><span class="op" id="2273644">)</span><span class="op" id="2273645">;</span>&nbsp;<span class="ident" id="2273647">err</span>&nbsp;<span class="op" id="2273651">!=</span>&nbsp;<span class="ident" id="2273654">nil</span>&nbsp;<span class="op" id="2273658">{</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273664">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273679">return</span>&nbsp;<span class="ident" id="2273686">nil</span><span class="op" id="2273689">,</span>&nbsp;<span class="string" id="2273691">&#34;&#34;</span><span class="op" id="2273693">,</span>&nbsp;<span class="op" id="2273695">&amp;</span><span class="ident" id="2273696">Error</span><span class="op" id="2273701">{</span><span class="ident" id="2273702">ErrInvalidCharRange</span><span class="op" id="2273721">,</span>&nbsp;<span class="ident" id="2273723">s</span><span class="op" id="2273724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273732">seq</span><span class="op" id="2273735">,</span>&nbsp;<span class="ident" id="2273737">t</span>&nbsp;<span class="op" id="2273739">=</span>&nbsp;<span class="ident" id="2273741">s</span><span class="op" id="2273742">[</span><span class="op" id="2273743">:</span><span class="ident" id="2273744">end</span><span class="op" id="2273747">+</span><span class="num" id="2273748">1</span><span class="op" id="2273749">]</span><span class="op" id="2273750">,</span>&nbsp;<span class="ident" id="2273752">s</span><span class="op" id="2273753">[</span><span class="ident" id="2273754">end</span><span class="op" id="2273757">+</span><span class="num" id="2273758">1</span><span class="op" id="2273759">:</span><span class="op" id="2273760">]</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273764">name</span>&nbsp;<span class="op" id="2273769">=</span>&nbsp;<span class="ident" id="2273771">s</span><span class="op" id="2273772">[</span><span class="num" id="2273773">3</span><span class="op" id="2273774">:</span><span class="ident" id="2273775">end</span><span class="op" id="2273778">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273782">if</span>&nbsp;<span class="ident" id="2273785">err</span>&nbsp;<span class="op" id="2273789">=</span>&nbsp;<span class="ident" id="2273791">checkUTF8</span><span class="op" id="2273800">(</span><span class="ident" id="2273801">name</span><span class="op" id="2273805">)</span><span class="op" id="2273806">;</span>&nbsp;<span class="ident" id="2273808">err</span>&nbsp;<span class="op" id="2273812">!=</span>&nbsp;<span class="ident" id="2273815">nil</span>&nbsp;<span class="op" id="2273819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273824">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273836">}</span><br>
<span class="lineno">1480</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2273840">//&nbsp;Group&nbsp;can&nbsp;have&nbsp;leading&nbsp;negation&nbsp;too.&nbsp;&nbsp;\p{^Han}&nbsp;==&nbsp;\P{Han},&nbsp;\P{^Han}&nbsp;==&nbsp;\p{Han}.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2273924">if</span>&nbsp;<span class="ident" id="2273927">name</span>&nbsp;<span class="op" id="2273932">!=</span>&nbsp;<span class="string" id="2273935">&#34;&#34;</span>&nbsp;<span class="op" id="2273938">&amp;&amp;</span>&nbsp;<span class="ident" id="2273941">name</span><span class="op" id="2273945">[</span><span class="num" id="2273946">0</span><span class="op" id="2273947">]</span>&nbsp;<span class="op" id="2273949">==</span>&nbsp;<span class="string" id="2273952">&#39;^&#39;</span>&nbsp;<span class="op" id="2273956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273960">sign</span>&nbsp;<span class="op" id="2273965">=</span>&nbsp;<span class="op" id="2273967">-</span><span class="ident" id="2273968">sign</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273975">name</span>&nbsp;<span class="op" id="2273980">=</span>&nbsp;<span class="ident" id="2273982">name</span><span class="op" id="2273986">[</span><span class="num" id="2273987">1</span><span class="op" id="2273988">:</span><span class="op" id="2273989">]</span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2273992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2273996">tab</span><span class="op" id="2273999">,</span>&nbsp;<span class="ident" id="2274001">fold</span>&nbsp;<span class="op" id="2274006">:=</span>&nbsp;<span class="ident" id="2274009">unicodeTable</span><span class="op" id="2274021">(</span><span class="ident" id="2274022">name</span><span class="op" id="2274026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2274029">if</span>&nbsp;<span class="ident" id="2274032">tab</span>&nbsp;<span class="op" id="2274036">==</span>&nbsp;<span class="ident" id="2274039">nil</span>&nbsp;<span class="op" id="2274043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2274047">return</span>&nbsp;<span class="ident" id="2274054">nil</span><span class="op" id="2274057">,</span>&nbsp;<span class="string" id="2274059">&#34;&#34;</span><span class="op" id="2274061">,</span>&nbsp;<span class="op" id="2274063">&amp;</span><span class="ident" id="2274064">Error</span><span class="op" id="2274069">{</span><span class="ident" id="2274070">ErrInvalidCharRange</span><span class="op" id="2274089">,</span>&nbsp;<span class="ident" id="2274091">seq</span><span class="op" id="2274094">}</span><br>
<span class="lineno">1490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2274097">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2274101">if</span>&nbsp;<span class="ident" id="2274104">p</span><span class="op" id="2274105">.</span><span class="ident" id="2274106">flags</span><span class="op" id="2274111">&amp;</span><span class="ident" id="2274112">FoldCase</span>&nbsp;<span class="op" id="2274121">==</span>&nbsp;<span class="num" id="2274124">0</span>&nbsp;<span class="op" id="2274126">||</span>&nbsp;<span class="ident" id="2274129">fold</span>&nbsp;<span class="op" id="2274134">==</span>&nbsp;<span class="ident" id="2274137">nil</span>&nbsp;<span class="op" id="2274141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2274145">if</span>&nbsp;<span class="ident" id="2274148">sign</span>&nbsp;<span class="op" id="2274153">&gt;</span>&nbsp;<span class="num" id="2274155">0</span>&nbsp;<span class="op" id="2274157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2274162">r</span>&nbsp;<span class="op" id="2274164">=</span>&nbsp;<span class="ident" id="2274166">appendTable</span><span class="op" id="2274177">(</span><span class="ident" id="2274178">r</span><span class="op" id="2274179">,</span>&nbsp;<span class="ident" id="2274181">tab</span><span class="op" id="2274184">)</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2274188">}</span>&nbsp;<span class="keyword" id="2274190">else</span>&nbsp;<span class="op" id="2274195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2274200">r</span>&nbsp;<span class="op" id="2274202">=</span>&nbsp;<span class="ident" id="2274204">appendNegatedTable</span><span class="op" id="2274222">(</span><span class="ident" id="2274223">r</span><span class="op" id="2274224">,</span>&nbsp;<span class="ident" id="2274226">tab</span><span class="op" id="2274229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2274233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2274236">}</span>&nbsp;<span class="keyword" id="2274238">else</span>&nbsp;<span class="op" id="2274243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2274247">//&nbsp;Merge&nbsp;and&nbsp;clean&nbsp;tab&nbsp;and&nbsp;fold&nbsp;in&nbsp;a&nbsp;temporary&nbsp;buffer.</span><br>
<span class="lineno">1500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2274304">//&nbsp;This&nbsp;is&nbsp;necessary&nbsp;for&nbsp;the&nbsp;negative&nbsp;case&nbsp;and&nbsp;just&nbsp;tidy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2274363">//&nbsp;for&nbsp;the&nbsp;positive&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2274391">tmp</span>&nbsp;<span class="op" id="2274395">:=</span>&nbsp;<span class="ident" id="2274398">p</span><span class="op" id="2274399">.</span><span class="ident" id="2274400">tmpClass</span><span class="op" id="2274408">[</span><span class="op" id="2274409">:</span><span class="num" id="2274410">0</span><span class="op" id="2274411">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2274415">tmp</span>&nbsp;<span class="op" id="2274419">=</span>&nbsp;<span class="ident" id="2274421">appendTable</span><span class="op" id="2274432">(</span><span class="ident" id="2274433">tmp</span><span class="op" id="2274436">,</span>&nbsp;<span class="ident" id="2274438">tab</span><span class="op" id="2274441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2274445">tmp</span>&nbsp;<span class="op" id="2274449">=</span>&nbsp;<span class="ident" id="2274451">appendTable</span><span class="op" id="2274462">(</span><span class="ident" id="2274463">tmp</span><span class="op" id="2274466">,</span>&nbsp;<span class="ident" id="2274468">fold</span><span class="op" id="2274472">)</span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2274476">p</span><span class="op" id="2274477">.</span><span class="ident" id="2274478">tmpClass</span>&nbsp;<span class="op" id="2274487">=</span>&nbsp;<span class="ident" id="2274489">tmp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2274495">tmp</span>&nbsp;<span class="op" id="2274499">=</span>&nbsp;<span class="ident" id="2274501">cleanClass</span><span class="op" id="2274511">(</span><span class="op" id="2274512">&amp;</span><span class="ident" id="2274513">p</span><span class="op" id="2274514">.</span><span class="ident" id="2274515">tmpClass</span><span class="op" id="2274523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2274527">if</span>&nbsp;<span class="ident" id="2274530">sign</span>&nbsp;<span class="op" id="2274535">&gt;</span>&nbsp;<span class="num" id="2274537">0</span>&nbsp;<span class="op" id="2274539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2274544">r</span>&nbsp;<span class="op" id="2274546">=</span>&nbsp;<span class="ident" id="2274548">appendClass</span><span class="op" id="2274559">(</span><span class="ident" id="2274560">r</span><span class="op" id="2274561">,</span>&nbsp;<span class="ident" id="2274563">tmp</span><span class="op" id="2274566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2274570">}</span>&nbsp;<span class="keyword" id="2274572">else</span>&nbsp;<span class="op" id="2274577">{</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2274582">r</span>&nbsp;<span class="op" id="2274584">=</span>&nbsp;<span class="ident" id="2274586">appendNegatedClass</span><span class="op" id="2274604">(</span><span class="ident" id="2274605">r</span><span class="op" id="2274606">,</span>&nbsp;<span class="ident" id="2274608">tmp</span><span class="op" id="2274611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2274615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2274618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2274621">return</span>&nbsp;<span class="ident" id="2274628">r</span><span class="op" id="2274629">,</span>&nbsp;<span class="ident" id="2274631">t</span><span class="op" id="2274632">,</span>&nbsp;<span class="ident" id="2274634">nil</span><br>
<span class="lineno"></span><span class="op" id="2274638">}</span><br>
<span class="lineno">1515</span><br>
<span class="lineno"></span><span class="comment" id="2274641">//&nbsp;parseClass&nbsp;parses&nbsp;a&nbsp;character&nbsp;class&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="2274702">//&nbsp;and&nbsp;pushes&nbsp;it&nbsp;onto&nbsp;the&nbsp;parse&nbsp;stack.</span><br>
<span class="lineno"></span><span class="keyword" id="2274741">func</span>&nbsp;<span class="op" id="2274746">(</span><span class="ident" id="2274747">p</span>&nbsp;<span class="op" id="2274749">*</span><span class="ident" id="2274750">parser</span><span class="op" id="2274756">)</span>&nbsp;<span class="ident" id="2274758">parseClass</span><span class="op" id="2274768">(</span><span class="ident" id="2274769">s</span>&nbsp;<span class="builtintype" id="2274771">string</span><span class="op" id="2274777">)</span>&nbsp;<span class="op" id="2274779">(</span><span class="ident" id="2274780">rest</span>&nbsp;<span class="builtintype" id="2274785">string</span><span class="op" id="2274791">,</span>&nbsp;<span class="ident" id="2274793">err</span>&nbsp;<span class="builtintype" id="2274797">error</span><span class="op" id="2274802">)</span>&nbsp;<span class="op" id="2274804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2274807">t</span>&nbsp;<span class="op" id="2274809">:=</span>&nbsp;<span class="ident" id="2274812">s</span><span class="op" id="2274813">[</span><span class="num" id="2274814">1</span><span class="op" id="2274815">:</span><span class="op" id="2274816">]</span>&nbsp;<span class="comment" id="2274818">//&nbsp;chop&nbsp;[</span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2274829">re</span>&nbsp;<span class="op" id="2274832">:=</span>&nbsp;<span class="ident" id="2274835">p</span><span class="op" id="2274836">.</span><span class="ident" id="2274837">newRegexp</span><span class="op" id="2274846">(</span><span class="ident" id="2274847">OpCharClass</span><span class="op" id="2274858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2274861">re</span><span class="op" id="2274863">.</span><span class="ident" id="2274864">Flags</span>&nbsp;<span class="op" id="2274870">=</span>&nbsp;<span class="ident" id="2274872">p</span><span class="op" id="2274873">.</span><span class="ident" id="2274874">flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2274881">re</span><span class="op" id="2274883">.</span><span class="ident" id="2274884">Rune</span>&nbsp;<span class="op" id="2274889">=</span>&nbsp;<span class="ident" id="2274891">re</span><span class="op" id="2274893">.</span><span class="ident" id="2274894">Rune0</span><span class="op" id="2274899">[</span><span class="op" id="2274900">:</span><span class="num" id="2274901">0</span><span class="op" id="2274902">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2274906">sign</span>&nbsp;<span class="op" id="2274911">:=</span>&nbsp;<span class="op" id="2274914">+</span><span class="num" id="2274915">1</span><br>
<span class="lineno">1525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2274918">if</span>&nbsp;<span class="ident" id="2274921">t</span>&nbsp;<span class="op" id="2274923">!=</span>&nbsp;<span class="string" id="2274926">&#34;&#34;</span>&nbsp;<span class="op" id="2274929">&amp;&amp;</span>&nbsp;<span class="ident" id="2274932">t</span><span class="op" id="2274933">[</span><span class="num" id="2274934">0</span><span class="op" id="2274935">]</span>&nbsp;<span class="op" id="2274937">==</span>&nbsp;<span class="string" id="2274940">&#39;^&#39;</span>&nbsp;<span class="op" id="2274944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2274948">sign</span>&nbsp;<span class="op" id="2274953">=</span>&nbsp;<span class="op" id="2274955">-</span><span class="num" id="2274956">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2274960">t</span>&nbsp;<span class="op" id="2274962">=</span>&nbsp;<span class="ident" id="2274964">t</span><span class="op" id="2274965">[</span><span class="num" id="2274966">1</span><span class="op" id="2274967">:</span><span class="op" id="2274968">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2274973">//&nbsp;If&nbsp;character&nbsp;class&nbsp;does&nbsp;not&nbsp;match&nbsp;\n,&nbsp;add&nbsp;it&nbsp;here,</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2275029">//&nbsp;so&nbsp;that&nbsp;negation&nbsp;later&nbsp;will&nbsp;do&nbsp;the&nbsp;right&nbsp;thing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275082">if</span>&nbsp;<span class="ident" id="2275085">p</span><span class="op" id="2275086">.</span><span class="ident" id="2275087">flags</span><span class="op" id="2275092">&amp;</span><span class="ident" id="2275093">ClassNL</span>&nbsp;<span class="op" id="2275101">==</span>&nbsp;<span class="num" id="2275104">0</span>&nbsp;<span class="op" id="2275106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2275111">re</span><span class="op" id="2275113">.</span><span class="ident" id="2275114">Rune</span>&nbsp;<span class="op" id="2275119">=</span>&nbsp;<span class="builtinfunc" id="2275121">append</span><span class="op" id="2275127">(</span><span class="ident" id="2275128">re</span><span class="op" id="2275130">.</span><span class="ident" id="2275131">Rune</span><span class="op" id="2275135">,</span>&nbsp;<span class="string" id="2275137">&#39;\n&#39;</span><span class="op" id="2275141">,</span>&nbsp;<span class="string" id="2275143">&#39;\n&#39;</span><span class="op" id="2275147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2275151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2275154">}</span><br>
<span class="lineno">1535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2275158">class</span>&nbsp;<span class="op" id="2275164">:=</span>&nbsp;<span class="ident" id="2275167">re</span><span class="op" id="2275169">.</span><span class="ident" id="2275170">Rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2275176">first</span>&nbsp;<span class="op" id="2275182">:=</span>&nbsp;<span class="builtintype" id="2275185">true</span>&nbsp;<span class="comment" id="2275190">//&nbsp;]&nbsp;and&nbsp;-&nbsp;are&nbsp;okay&nbsp;as&nbsp;first&nbsp;char&nbsp;in&nbsp;class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275234">for</span>&nbsp;<span class="ident" id="2275238">t</span>&nbsp;<span class="op" id="2275240">==</span>&nbsp;<span class="string" id="2275243">&#34;&#34;</span>&nbsp;<span class="op" id="2275246">||</span>&nbsp;<span class="ident" id="2275249">t</span><span class="op" id="2275250">[</span><span class="num" id="2275251">0</span><span class="op" id="2275252">]</span>&nbsp;<span class="op" id="2275254">!=</span>&nbsp;<span class="string" id="2275257">&#39;]&#39;</span>&nbsp;<span class="op" id="2275261">||</span>&nbsp;<span class="ident" id="2275264">first</span>&nbsp;<span class="op" id="2275270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2275274">//&nbsp;POSIX:&nbsp;-&nbsp;is&nbsp;only&nbsp;okay&nbsp;unescaped&nbsp;as&nbsp;first&nbsp;or&nbsp;last&nbsp;in&nbsp;class.</span><br>
<span class="lineno">1540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2275338">//&nbsp;Perl:&nbsp;-&nbsp;is&nbsp;okay&nbsp;anywhere.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275369">if</span>&nbsp;<span class="ident" id="2275372">t</span>&nbsp;<span class="op" id="2275374">!=</span>&nbsp;<span class="string" id="2275377">&#34;&#34;</span>&nbsp;<span class="op" id="2275380">&amp;&amp;</span>&nbsp;<span class="ident" id="2275383">t</span><span class="op" id="2275384">[</span><span class="num" id="2275385">0</span><span class="op" id="2275386">]</span>&nbsp;<span class="op" id="2275388">==</span>&nbsp;<span class="string" id="2275391">&#39;-&#39;</span>&nbsp;<span class="op" id="2275395">&amp;&amp;</span>&nbsp;<span class="ident" id="2275398">p</span><span class="op" id="2275399">.</span><span class="ident" id="2275400">flags</span><span class="op" id="2275405">&amp;</span><span class="ident" id="2275406">PerlX</span>&nbsp;<span class="op" id="2275412">==</span>&nbsp;<span class="num" id="2275415">0</span>&nbsp;<span class="op" id="2275417">&amp;&amp;</span>&nbsp;<span class="op" id="2275420">!</span><span class="ident" id="2275421">first</span>&nbsp;<span class="op" id="2275427">&amp;&amp;</span>&nbsp;<span class="op" id="2275430">(</span><span class="builtinfunc" id="2275431">len</span><span class="op" id="2275434">(</span><span class="ident" id="2275435">t</span><span class="op" id="2275436">)</span>&nbsp;<span class="op" id="2275438">==</span>&nbsp;<span class="num" id="2275441">1</span>&nbsp;<span class="op" id="2275443">||</span>&nbsp;<span class="ident" id="2275446">t</span><span class="op" id="2275447">[</span><span class="num" id="2275448">1</span><span class="op" id="2275449">]</span>&nbsp;<span class="op" id="2275451">!=</span>&nbsp;<span class="string" id="2275454">&#39;]&#39;</span><span class="op" id="2275457">)</span>&nbsp;<span class="op" id="2275459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2275464">_</span><span class="op" id="2275465">,</span>&nbsp;<span class="ident" id="2275467">size</span>&nbsp;<span class="op" id="2275472">:=</span>&nbsp;<span class="ident" id="2275475">utf8</span><span class="op" id="2275479">.</span><span class="ident" id="2275480">DecodeRuneInString</span><span class="op" id="2275498">(</span><span class="ident" id="2275499">t</span><span class="op" id="2275500">[</span><span class="num" id="2275501">1</span><span class="op" id="2275502">:</span><span class="op" id="2275503">]</span><span class="op" id="2275504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275509">return</span>&nbsp;<span class="string" id="2275516">&#34;&#34;</span><span class="op" id="2275518">,</span>&nbsp;<span class="op" id="2275520">&amp;</span><span class="ident" id="2275521">Error</span><span class="op" id="2275526">{</span><span class="ident" id="2275527">Code</span><span class="op" id="2275531">:</span>&nbsp;<span class="ident" id="2275533">ErrInvalidCharRange</span><span class="op" id="2275552">,</span>&nbsp;<span class="ident" id="2275554">Expr</span><span class="op" id="2275558">:</span>&nbsp;<span class="ident" id="2275560">t</span><span class="op" id="2275561">[</span><span class="op" id="2275562">:</span><span class="num" id="2275563">1</span><span class="op" id="2275564">+</span><span class="ident" id="2275565">size</span><span class="op" id="2275569">]</span><span class="op" id="2275570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2275574">}</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2275578">first</span>&nbsp;<span class="op" id="2275584">=</span>&nbsp;<span class="builtintype" id="2275586">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2275595">//&nbsp;Look&nbsp;for&nbsp;POSIX&nbsp;[:alnum:]&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275630">if</span>&nbsp;<span class="builtinfunc" id="2275633">len</span><span class="op" id="2275636">(</span><span class="ident" id="2275637">t</span><span class="op" id="2275638">)</span>&nbsp;<span class="op" id="2275640">&gt;</span>&nbsp;<span class="num" id="2275642">2</span>&nbsp;<span class="op" id="2275644">&amp;&amp;</span>&nbsp;<span class="ident" id="2275647">t</span><span class="op" id="2275648">[</span><span class="num" id="2275649">0</span><span class="op" id="2275650">]</span>&nbsp;<span class="op" id="2275652">==</span>&nbsp;<span class="string" id="2275655">&#39;[&#39;</span>&nbsp;<span class="op" id="2275659">&amp;&amp;</span>&nbsp;<span class="ident" id="2275662">t</span><span class="op" id="2275663">[</span><span class="num" id="2275664">1</span><span class="op" id="2275665">]</span>&nbsp;<span class="op" id="2275667">==</span>&nbsp;<span class="string" id="2275670">&#39;:&#39;</span>&nbsp;<span class="op" id="2275674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2275679">nclass</span><span class="op" id="2275685">,</span>&nbsp;<span class="ident" id="2275687">nt</span><span class="op" id="2275689">,</span>&nbsp;<span class="ident" id="2275691">err</span>&nbsp;<span class="op" id="2275695">:=</span>&nbsp;<span class="ident" id="2275698">p</span><span class="op" id="2275699">.</span><span class="ident" id="2275700">parseNamedClass</span><span class="op" id="2275715">(</span><span class="ident" id="2275716">t</span><span class="op" id="2275717">,</span>&nbsp;<span class="ident" id="2275719">class</span><span class="op" id="2275724">)</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275729">if</span>&nbsp;<span class="ident" id="2275732">err</span>&nbsp;<span class="op" id="2275736">!=</span>&nbsp;<span class="ident" id="2275739">nil</span>&nbsp;<span class="op" id="2275743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275749">return</span>&nbsp;<span class="string" id="2275756">&#34;&#34;</span><span class="op" id="2275758">,</span>&nbsp;<span class="ident" id="2275760">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2275767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275772">if</span>&nbsp;<span class="ident" id="2275775">nclass</span>&nbsp;<span class="op" id="2275782">!=</span>&nbsp;<span class="ident" id="2275785">nil</span>&nbsp;<span class="op" id="2275789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2275795">class</span><span class="op" id="2275800">,</span>&nbsp;<span class="ident" id="2275802">t</span>&nbsp;<span class="op" id="2275804">=</span>&nbsp;<span class="ident" id="2275806">nclass</span><span class="op" id="2275812">,</span>&nbsp;<span class="ident" id="2275814">nt</span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275821">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2275833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2275837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2275842">//&nbsp;Look&nbsp;for&nbsp;Unicode&nbsp;character&nbsp;group&nbsp;like&nbsp;\p{Han}.</span><br>
<span class="lineno">1560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2275894">nclass</span><span class="op" id="2275900">,</span>&nbsp;<span class="ident" id="2275902">nt</span><span class="op" id="2275904">,</span>&nbsp;<span class="ident" id="2275906">err</span>&nbsp;<span class="op" id="2275910">:=</span>&nbsp;<span class="ident" id="2275913">p</span><span class="op" id="2275914">.</span><span class="ident" id="2275915">parseUnicodeClass</span><span class="op" id="2275932">(</span><span class="ident" id="2275933">t</span><span class="op" id="2275934">,</span>&nbsp;<span class="ident" id="2275936">class</span><span class="op" id="2275941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275945">if</span>&nbsp;<span class="ident" id="2275948">err</span>&nbsp;<span class="op" id="2275952">!=</span>&nbsp;<span class="ident" id="2275955">nil</span>&nbsp;<span class="op" id="2275959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275964">return</span>&nbsp;<span class="string" id="2275971">&#34;&#34;</span><span class="op" id="2275973">,</span>&nbsp;<span class="ident" id="2275975">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2275981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2275985">if</span>&nbsp;<span class="ident" id="2275988">nclass</span>&nbsp;<span class="op" id="2275995">!=</span>&nbsp;<span class="ident" id="2275998">nil</span>&nbsp;<span class="op" id="2276002">{</span><br>
<span class="lineno">1565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276007">class</span><span class="op" id="2276012">,</span>&nbsp;<span class="ident" id="2276014">t</span>&nbsp;<span class="op" id="2276016">=</span>&nbsp;<span class="ident" id="2276018">nclass</span><span class="op" id="2276024">,</span>&nbsp;<span class="ident" id="2276026">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2276032">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2276043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2276048">//&nbsp;Look&nbsp;for&nbsp;Perl&nbsp;character&nbsp;class&nbsp;symbols&nbsp;(extension).</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2276104">if</span>&nbsp;<span class="ident" id="2276107">nclass</span><span class="op" id="2276113">,</span>&nbsp;<span class="ident" id="2276115">nt</span>&nbsp;<span class="op" id="2276118">:=</span>&nbsp;<span class="ident" id="2276121">p</span><span class="op" id="2276122">.</span><span class="ident" id="2276123">parsePerlClassEscape</span><span class="op" id="2276143">(</span><span class="ident" id="2276144">t</span><span class="op" id="2276145">,</span>&nbsp;<span class="ident" id="2276147">class</span><span class="op" id="2276152">)</span><span class="op" id="2276153">;</span>&nbsp;<span class="ident" id="2276155">nclass</span>&nbsp;<span class="op" id="2276162">!=</span>&nbsp;<span class="ident" id="2276165">nil</span>&nbsp;<span class="op" id="2276169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276174">class</span><span class="op" id="2276179">,</span>&nbsp;<span class="ident" id="2276181">t</span>&nbsp;<span class="op" id="2276183">=</span>&nbsp;<span class="ident" id="2276185">nclass</span><span class="op" id="2276191">,</span>&nbsp;<span class="ident" id="2276193">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2276199">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2276210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2276215">//&nbsp;Single&nbsp;character&nbsp;or&nbsp;simple&nbsp;range.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276254">rng</span>&nbsp;<span class="op" id="2276258">:=</span>&nbsp;<span class="ident" id="2276261">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2276265">var</span>&nbsp;<span class="ident" id="2276269">lo</span><span class="op" id="2276271">,</span>&nbsp;<span class="ident" id="2276273">hi</span>&nbsp;<span class="builtintype" id="2276276">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2276283">if</span>&nbsp;<span class="ident" id="2276286">lo</span><span class="op" id="2276288">,</span>&nbsp;<span class="ident" id="2276290">t</span><span class="op" id="2276291">,</span>&nbsp;<span class="ident" id="2276293">err</span>&nbsp;<span class="op" id="2276297">=</span>&nbsp;<span class="ident" id="2276299">p</span><span class="op" id="2276300">.</span><span class="ident" id="2276301">parseClassChar</span><span class="op" id="2276315">(</span><span class="ident" id="2276316">t</span><span class="op" id="2276317">,</span>&nbsp;<span class="ident" id="2276319">s</span><span class="op" id="2276320">)</span><span class="op" id="2276321">;</span>&nbsp;<span class="ident" id="2276323">err</span>&nbsp;<span class="op" id="2276327">!=</span>&nbsp;<span class="ident" id="2276330">nil</span>&nbsp;<span class="op" id="2276334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2276339">return</span>&nbsp;<span class="string" id="2276346">&#34;&#34;</span><span class="op" id="2276348">,</span>&nbsp;<span class="ident" id="2276350">err</span><br>
<span class="lineno">1580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2276356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276360">hi</span>&nbsp;<span class="op" id="2276363">=</span>&nbsp;<span class="ident" id="2276365">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2276370">//&nbsp;[a-]&nbsp;means&nbsp;(a|-)&nbsp;so&nbsp;check&nbsp;for&nbsp;final&nbsp;].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2276414">if</span>&nbsp;<span class="builtinfunc" id="2276417">len</span><span class="op" id="2276420">(</span><span class="ident" id="2276421">t</span><span class="op" id="2276422">)</span>&nbsp;<span class="op" id="2276424">&gt;=</span>&nbsp;<span class="num" id="2276427">2</span>&nbsp;<span class="op" id="2276429">&amp;&amp;</span>&nbsp;<span class="ident" id="2276432">t</span><span class="op" id="2276433">[</span><span class="num" id="2276434">0</span><span class="op" id="2276435">]</span>&nbsp;<span class="op" id="2276437">==</span>&nbsp;<span class="string" id="2276440">&#39;-&#39;</span>&nbsp;<span class="op" id="2276444">&amp;&amp;</span>&nbsp;<span class="ident" id="2276447">t</span><span class="op" id="2276448">[</span><span class="num" id="2276449">1</span><span class="op" id="2276450">]</span>&nbsp;<span class="op" id="2276452">!=</span>&nbsp;<span class="string" id="2276455">&#39;]&#39;</span>&nbsp;<span class="op" id="2276459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276464">t</span>&nbsp;<span class="op" id="2276466">=</span>&nbsp;<span class="ident" id="2276468">t</span><span class="op" id="2276469">[</span><span class="num" id="2276470">1</span><span class="op" id="2276471">:</span><span class="op" id="2276472">]</span><br>
<span class="lineno">1585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2276477">if</span>&nbsp;<span class="ident" id="2276480">hi</span><span class="op" id="2276482">,</span>&nbsp;<span class="ident" id="2276484">t</span><span class="op" id="2276485">,</span>&nbsp;<span class="ident" id="2276487">err</span>&nbsp;<span class="op" id="2276491">=</span>&nbsp;<span class="ident" id="2276493">p</span><span class="op" id="2276494">.</span><span class="ident" id="2276495">parseClassChar</span><span class="op" id="2276509">(</span><span class="ident" id="2276510">t</span><span class="op" id="2276511">,</span>&nbsp;<span class="ident" id="2276513">s</span><span class="op" id="2276514">)</span><span class="op" id="2276515">;</span>&nbsp;<span class="ident" id="2276517">err</span>&nbsp;<span class="op" id="2276521">!=</span>&nbsp;<span class="ident" id="2276524">nil</span>&nbsp;<span class="op" id="2276528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2276534">return</span>&nbsp;<span class="string" id="2276541">&#34;&#34;</span><span class="op" id="2276543">,</span>&nbsp;<span class="ident" id="2276545">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2276552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2276557">if</span>&nbsp;<span class="ident" id="2276560">hi</span>&nbsp;<span class="op" id="2276563">&lt;</span>&nbsp;<span class="ident" id="2276565">lo</span>&nbsp;<span class="op" id="2276568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276574">rng</span>&nbsp;<span class="op" id="2276578">=</span>&nbsp;<span class="ident" id="2276580">rng</span><span class="op" id="2276583">[</span><span class="op" id="2276584">:</span><span class="builtinfunc" id="2276585">len</span><span class="op" id="2276588">(</span><span class="ident" id="2276589">rng</span><span class="op" id="2276592">)</span><span class="op" id="2276593">-</span><span class="builtinfunc" id="2276594">len</span><span class="op" id="2276597">(</span><span class="ident" id="2276598">t</span><span class="op" id="2276599">)</span><span class="op" id="2276600">]</span><br>
<span class="lineno">1590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2276606">return</span>&nbsp;<span class="string" id="2276613">&#34;&#34;</span><span class="op" id="2276615">,</span>&nbsp;<span class="op" id="2276617">&amp;</span><span class="ident" id="2276618">Error</span><span class="op" id="2276623">{</span><span class="ident" id="2276624">Code</span><span class="op" id="2276628">:</span>&nbsp;<span class="ident" id="2276630">ErrInvalidCharRange</span><span class="op" id="2276649">,</span>&nbsp;<span class="ident" id="2276651">Expr</span><span class="op" id="2276655">:</span>&nbsp;<span class="ident" id="2276657">rng</span><span class="op" id="2276660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2276665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2276669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2276673">if</span>&nbsp;<span class="ident" id="2276676">p</span><span class="op" id="2276677">.</span><span class="ident" id="2276678">flags</span><span class="op" id="2276683">&amp;</span><span class="ident" id="2276684">FoldCase</span>&nbsp;<span class="op" id="2276693">==</span>&nbsp;<span class="num" id="2276696">0</span>&nbsp;<span class="op" id="2276698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276703">class</span>&nbsp;<span class="op" id="2276709">=</span>&nbsp;<span class="ident" id="2276711">appendRange</span><span class="op" id="2276722">(</span><span class="ident" id="2276723">class</span><span class="op" id="2276728">,</span>&nbsp;<span class="ident" id="2276730">lo</span><span class="op" id="2276732">,</span>&nbsp;<span class="ident" id="2276734">hi</span><span class="op" id="2276736">)</span><br>
<span class="lineno">1595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2276740">}</span>&nbsp;<span class="keyword" id="2276742">else</span>&nbsp;<span class="op" id="2276747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276752">class</span>&nbsp;<span class="op" id="2276758">=</span>&nbsp;<span class="ident" id="2276760">appendFoldedRange</span><span class="op" id="2276777">(</span><span class="ident" id="2276778">class</span><span class="op" id="2276783">,</span>&nbsp;<span class="ident" id="2276785">lo</span><span class="op" id="2276787">,</span>&nbsp;<span class="ident" id="2276789">hi</span><span class="op" id="2276791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2276795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2276798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276801">t</span>&nbsp;<span class="op" id="2276803">=</span>&nbsp;<span class="ident" id="2276805">t</span><span class="op" id="2276806">[</span><span class="num" id="2276807">1</span><span class="op" id="2276808">:</span><span class="op" id="2276809">]</span>&nbsp;<span class="comment" id="2276811">//&nbsp;chop&nbsp;]</span><br>
<span class="lineno">1600</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2276823">//&nbsp;Use&nbsp;&amp;re.Rune&nbsp;instead&nbsp;of&nbsp;&amp;class&nbsp;to&nbsp;avoid&nbsp;allocation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276879">re</span><span class="op" id="2276881">.</span><span class="ident" id="2276882">Rune</span>&nbsp;<span class="op" id="2276887">=</span>&nbsp;<span class="ident" id="2276889">class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276896">class</span>&nbsp;<span class="op" id="2276902">=</span>&nbsp;<span class="ident" id="2276904">cleanClass</span><span class="op" id="2276914">(</span><span class="op" id="2276915">&amp;</span><span class="ident" id="2276916">re</span><span class="op" id="2276918">.</span><span class="ident" id="2276919">Rune</span><span class="op" id="2276923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2276926">if</span>&nbsp;<span class="ident" id="2276929">sign</span>&nbsp;<span class="op" id="2276934">&lt;</span>&nbsp;<span class="num" id="2276936">0</span>&nbsp;<span class="op" id="2276938">{</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276942">class</span>&nbsp;<span class="op" id="2276948">=</span>&nbsp;<span class="ident" id="2276950">negateClass</span><span class="op" id="2276961">(</span><span class="ident" id="2276962">class</span><span class="op" id="2276967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2276970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276973">re</span><span class="op" id="2276975">.</span><span class="ident" id="2276976">Rune</span>&nbsp;<span class="op" id="2276981">=</span>&nbsp;<span class="ident" id="2276983">class</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2276990">p</span><span class="op" id="2276991">.</span><span class="ident" id="2276992">push</span><span class="op" id="2276996">(</span><span class="ident" id="2276997">re</span><span class="op" id="2276999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277002">return</span>&nbsp;<span class="ident" id="2277009">t</span><span class="op" id="2277010">,</span>&nbsp;<span class="ident" id="2277012">nil</span><br>
<span class="lineno">1610</span><span class="op" id="2277016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2277019">//&nbsp;cleanClass&nbsp;sorts&nbsp;the&nbsp;ranges&nbsp;(pairs&nbsp;of&nbsp;elements&nbsp;of&nbsp;r),</span><br>
<span class="lineno"></span><span class="comment" id="2277076">//&nbsp;merges&nbsp;them,&nbsp;and&nbsp;eliminates&nbsp;duplicates.</span><br>
<span class="lineno"></span><span class="keyword" id="2277119">func</span>&nbsp;<span class="ident" id="2277124">cleanClass</span><span class="op" id="2277134">(</span><span class="ident" id="2277135">rp</span>&nbsp;<span class="op" id="2277138">*</span><span class="op" id="2277139">[</span><span class="op" id="2277140">]</span><span class="builtintype" id="2277141">rune</span><span class="op" id="2277145">)</span>&nbsp;<span class="op" id="2277147">[</span><span class="op" id="2277148">]</span><span class="builtintype" id="2277149">rune</span>&nbsp;<span class="op" id="2277154">{</span><br>
<span class="lineno">1615</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2277158">//&nbsp;Sort&nbsp;by&nbsp;lo&nbsp;increasing,&nbsp;hi&nbsp;decreasing&nbsp;to&nbsp;break&nbsp;ties.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277214">sort</span><span class="op" id="2277218">.</span><span class="ident" id="2277219">Sort</span><span class="op" id="2277223">(</span><span class="ident" id="2277224">ranges</span><span class="op" id="2277230">{</span><span class="ident" id="2277231">rp</span><span class="op" id="2277233">}</span><span class="op" id="2277234">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277238">r</span>&nbsp;<span class="op" id="2277240">:=</span>&nbsp;<span class="op" id="2277243">*</span><span class="ident" id="2277244">rp</span><br>
<span class="lineno">1620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277248">if</span>&nbsp;<span class="builtinfunc" id="2277251">len</span><span class="op" id="2277254">(</span><span class="ident" id="2277255">r</span><span class="op" id="2277256">)</span>&nbsp;<span class="op" id="2277258">&lt;</span>&nbsp;<span class="num" id="2277260">2</span>&nbsp;<span class="op" id="2277262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277266">return</span>&nbsp;<span class="ident" id="2277273">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2277276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2277280">//&nbsp;Merge&nbsp;abutting,&nbsp;overlapping.</span><br>
<span class="lineno">1625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277313">w</span>&nbsp;<span class="op" id="2277315">:=</span>&nbsp;<span class="num" id="2277318">2</span>&nbsp;<span class="comment" id="2277320">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277336">for</span>&nbsp;<span class="ident" id="2277340">i</span>&nbsp;<span class="op" id="2277342">:=</span>&nbsp;<span class="num" id="2277345">2</span><span class="op" id="2277346">;</span>&nbsp;<span class="ident" id="2277348">i</span>&nbsp;<span class="op" id="2277350">&lt;</span>&nbsp;<span class="builtinfunc" id="2277352">len</span><span class="op" id="2277355">(</span><span class="ident" id="2277356">r</span><span class="op" id="2277357">)</span><span class="op" id="2277358">;</span>&nbsp;<span class="ident" id="2277360">i</span>&nbsp;<span class="op" id="2277362">+=</span>&nbsp;<span class="num" id="2277365">2</span>&nbsp;<span class="op" id="2277367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277371">lo</span><span class="op" id="2277373">,</span>&nbsp;<span class="ident" id="2277375">hi</span>&nbsp;<span class="op" id="2277378">:=</span>&nbsp;<span class="ident" id="2277381">r</span><span class="op" id="2277382">[</span><span class="ident" id="2277383">i</span><span class="op" id="2277384">]</span><span class="op" id="2277385">,</span>&nbsp;<span class="ident" id="2277387">r</span><span class="op" id="2277388">[</span><span class="ident" id="2277389">i</span><span class="op" id="2277390">+</span><span class="num" id="2277391">1</span><span class="op" id="2277392">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277396">if</span>&nbsp;<span class="ident" id="2277399">lo</span>&nbsp;<span class="op" id="2277402">&lt;=</span>&nbsp;<span class="ident" id="2277405">r</span><span class="op" id="2277406">[</span><span class="ident" id="2277407">w</span><span class="op" id="2277408">-</span><span class="num" id="2277409">1</span><span class="op" id="2277410">]</span><span class="op" id="2277411">+</span><span class="num" id="2277412">1</span>&nbsp;<span class="op" id="2277414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2277419">//&nbsp;merge&nbsp;with&nbsp;previous&nbsp;range</span><br>
<span class="lineno">1630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277451">if</span>&nbsp;<span class="ident" id="2277454">hi</span>&nbsp;<span class="op" id="2277457">&gt;</span>&nbsp;<span class="ident" id="2277459">r</span><span class="op" id="2277460">[</span><span class="ident" id="2277461">w</span><span class="op" id="2277462">-</span><span class="num" id="2277463">1</span><span class="op" id="2277464">]</span>&nbsp;<span class="op" id="2277466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277472">r</span><span class="op" id="2277473">[</span><span class="ident" id="2277474">w</span><span class="op" id="2277475">-</span><span class="num" id="2277476">1</span><span class="op" id="2277477">]</span>&nbsp;<span class="op" id="2277479">=</span>&nbsp;<span class="ident" id="2277481">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2277487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277492">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2277503">}</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2277507">//&nbsp;new&nbsp;disjoint&nbsp;range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277531">r</span><span class="op" id="2277532">[</span><span class="ident" id="2277533">w</span><span class="op" id="2277534">]</span>&nbsp;<span class="op" id="2277536">=</span>&nbsp;<span class="ident" id="2277538">lo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277543">r</span><span class="op" id="2277544">[</span><span class="ident" id="2277545">w</span><span class="op" id="2277546">+</span><span class="num" id="2277547">1</span><span class="op" id="2277548">]</span>&nbsp;<span class="op" id="2277550">=</span>&nbsp;<span class="ident" id="2277552">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2277557">w</span>&nbsp;<span class="op" id="2277559">+=</span>&nbsp;<span class="num" id="2277562">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2277565">}</span><br>
<span class="lineno">1640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277569">return</span>&nbsp;<span class="ident" id="2277576">r</span><span class="op" id="2277577">[</span><span class="op" id="2277578">:</span><span class="ident" id="2277579">w</span><span class="op" id="2277580">]</span><br>
<span class="lineno"></span><span class="op" id="2277582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2277585">//&nbsp;appendLiteral&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;literal&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno">1645</span><span class="keyword" id="2277664">func</span>&nbsp;<span class="ident" id="2277669">appendLiteral</span><span class="op" id="2277682">(</span><span class="ident" id="2277683">r</span>&nbsp;<span class="op" id="2277685">[</span><span class="op" id="2277686">]</span><span class="builtintype" id="2277687">rune</span><span class="op" id="2277691">,</span>&nbsp;<span class="ident" id="2277693">x</span>&nbsp;<span class="builtintype" id="2277695">rune</span><span class="op" id="2277699">,</span>&nbsp;<span class="ident" id="2277701">flags</span>&nbsp;<span class="ident" id="2277707">Flags</span><span class="op" id="2277712">)</span>&nbsp;<span class="op" id="2277714">[</span><span class="op" id="2277715">]</span><span class="builtintype" id="2277716">rune</span>&nbsp;<span class="op" id="2277721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277724">if</span>&nbsp;<span class="ident" id="2277727">flags</span><span class="op" id="2277732">&amp;</span><span class="ident" id="2277733">FoldCase</span>&nbsp;<span class="op" id="2277742">!=</span>&nbsp;<span class="num" id="2277745">0</span>&nbsp;<span class="op" id="2277747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277751">return</span>&nbsp;<span class="ident" id="2277758">appendFoldedRange</span><span class="op" id="2277775">(</span><span class="ident" id="2277776">r</span><span class="op" id="2277777">,</span>&nbsp;<span class="ident" id="2277779">x</span><span class="op" id="2277780">,</span>&nbsp;<span class="ident" id="2277782">x</span><span class="op" id="2277783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2277786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2277789">return</span>&nbsp;<span class="ident" id="2277796">appendRange</span><span class="op" id="2277807">(</span><span class="ident" id="2277808">r</span><span class="op" id="2277809">,</span>&nbsp;<span class="ident" id="2277811">x</span><span class="op" id="2277812">,</span>&nbsp;<span class="ident" id="2277814">x</span><span class="op" id="2277815">)</span><br>
<span class="lineno">1650</span><span class="op" id="2277817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2277820">//&nbsp;appendRange&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;range&nbsp;lo-hi&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="2277899">func</span>&nbsp;<span class="ident" id="2277904">appendRange</span><span class="op" id="2277915">(</span><span class="ident" id="2277916">r</span>&nbsp;<span class="op" id="2277918">[</span><span class="op" id="2277919">]</span><span class="builtintype" id="2277920">rune</span><span class="op" id="2277924">,</span>&nbsp;<span class="ident" id="2277926">lo</span><span class="op" id="2277928">,</span>&nbsp;<span class="ident" id="2277930">hi</span>&nbsp;<span class="builtintype" id="2277933">rune</span><span class="op" id="2277937">)</span>&nbsp;<span class="op" id="2277939">[</span><span class="op" id="2277940">]</span><span class="builtintype" id="2277941">rune</span>&nbsp;<span class="op" id="2277946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2277949">//&nbsp;Expand&nbsp;last&nbsp;range&nbsp;or&nbsp;next&nbsp;to&nbsp;last&nbsp;range&nbsp;if&nbsp;it&nbsp;overlaps&nbsp;or&nbsp;abuts.</span><br>
<span class="lineno">1655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2278018">//&nbsp;Checking&nbsp;two&nbsp;ranges&nbsp;helps&nbsp;when&nbsp;appending&nbsp;case-folded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2278075">//&nbsp;alphabets,&nbsp;so&nbsp;that&nbsp;one&nbsp;range&nbsp;can&nbsp;be&nbsp;expanding&nbsp;A-Z&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2278137">//&nbsp;other&nbsp;expanding&nbsp;a-z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278162">n</span>&nbsp;<span class="op" id="2278164">:=</span>&nbsp;<span class="builtinfunc" id="2278167">len</span><span class="op" id="2278170">(</span><span class="ident" id="2278171">r</span><span class="op" id="2278172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278175">for</span>&nbsp;<span class="ident" id="2278179">i</span>&nbsp;<span class="op" id="2278181">:=</span>&nbsp;<span class="num" id="2278184">2</span><span class="op" id="2278185">;</span>&nbsp;<span class="ident" id="2278187">i</span>&nbsp;<span class="op" id="2278189">&lt;=</span>&nbsp;<span class="num" id="2278192">4</span><span class="op" id="2278193">;</span>&nbsp;<span class="ident" id="2278195">i</span>&nbsp;<span class="op" id="2278197">+=</span>&nbsp;<span class="num" id="2278200">2</span>&nbsp;<span class="op" id="2278202">{</span>&nbsp;<span class="comment" id="2278204">//&nbsp;twice,&nbsp;using&nbsp;i=2,&nbsp;i=4</span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278231">if</span>&nbsp;<span class="ident" id="2278234">n</span>&nbsp;<span class="op" id="2278236">&gt;=</span>&nbsp;<span class="ident" id="2278239">i</span>&nbsp;<span class="op" id="2278241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278246">rlo</span><span class="op" id="2278249">,</span>&nbsp;<span class="ident" id="2278251">rhi</span>&nbsp;<span class="op" id="2278255">:=</span>&nbsp;<span class="ident" id="2278258">r</span><span class="op" id="2278259">[</span><span class="ident" id="2278260">n</span><span class="op" id="2278261">-</span><span class="ident" id="2278262">i</span><span class="op" id="2278263">]</span><span class="op" id="2278264">,</span>&nbsp;<span class="ident" id="2278266">r</span><span class="op" id="2278267">[</span><span class="ident" id="2278268">n</span><span class="op" id="2278269">-</span><span class="ident" id="2278270">i</span><span class="op" id="2278271">+</span><span class="num" id="2278272">1</span><span class="op" id="2278273">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278278">if</span>&nbsp;<span class="ident" id="2278281">lo</span>&nbsp;<span class="op" id="2278284">&lt;=</span>&nbsp;<span class="ident" id="2278287">rhi</span><span class="op" id="2278290">+</span><span class="num" id="2278291">1</span>&nbsp;<span class="op" id="2278293">&amp;&amp;</span>&nbsp;<span class="ident" id="2278296">rlo</span>&nbsp;<span class="op" id="2278300">&lt;=</span>&nbsp;<span class="ident" id="2278303">hi</span><span class="op" id="2278305">+</span><span class="num" id="2278306">1</span>&nbsp;<span class="op" id="2278308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278314">if</span>&nbsp;<span class="ident" id="2278317">lo</span>&nbsp;<span class="op" id="2278320">&lt;</span>&nbsp;<span class="ident" id="2278322">rlo</span>&nbsp;<span class="op" id="2278326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278333">r</span><span class="op" id="2278334">[</span><span class="ident" id="2278335">n</span><span class="op" id="2278336">-</span><span class="ident" id="2278337">i</span><span class="op" id="2278338">]</span>&nbsp;<span class="op" id="2278340">=</span>&nbsp;<span class="ident" id="2278342">lo</span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2278349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278355">if</span>&nbsp;<span class="ident" id="2278358">hi</span>&nbsp;<span class="op" id="2278361">&gt;</span>&nbsp;<span class="ident" id="2278363">rhi</span>&nbsp;<span class="op" id="2278367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278374">r</span><span class="op" id="2278375">[</span><span class="ident" id="2278376">n</span><span class="op" id="2278377">-</span><span class="ident" id="2278378">i</span><span class="op" id="2278379">+</span><span class="num" id="2278380">1</span><span class="op" id="2278381">]</span>&nbsp;<span class="op" id="2278383">=</span>&nbsp;<span class="ident" id="2278385">hi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2278392">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278398">return</span>&nbsp;<span class="ident" id="2278405">r</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2278410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2278414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2278417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278421">return</span>&nbsp;<span class="builtinfunc" id="2278428">append</span><span class="op" id="2278434">(</span><span class="ident" id="2278435">r</span><span class="op" id="2278436">,</span>&nbsp;<span class="ident" id="2278438">lo</span><span class="op" id="2278440">,</span>&nbsp;<span class="ident" id="2278442">hi</span><span class="op" id="2278444">)</span><br>
<span class="lineno">1675</span><span class="op" id="2278446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2278449">const</span>&nbsp;<span class="op" id="2278455">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2278458">//&nbsp;minimum&nbsp;and&nbsp;maximum&nbsp;runes&nbsp;involved&nbsp;in&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2278509">//&nbsp;checked&nbsp;during&nbsp;test.</span><br>
<span class="lineno">1680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278534">minFold</span>&nbsp;<span class="op" id="2278542">=</span>&nbsp;<span class="num" id="2278544">0x0041</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2278552">maxFold</span>&nbsp;<span class="op" id="2278560">=</span>&nbsp;<span class="num" id="2278562">0x118df</span><br>
<span class="lineno"></span><span class="op" id="2278570">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2278573">//&nbsp;appendFoldedRange&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;range&nbsp;lo-hi</span><br>
<span class="lineno">1685</span><span class="comment" id="2278642">//&nbsp;and&nbsp;its&nbsp;case&nbsp;folding-equivalent&nbsp;runes&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="2278699">func</span>&nbsp;<span class="ident" id="2278704">appendFoldedRange</span><span class="op" id="2278721">(</span><span class="ident" id="2278722">r</span>&nbsp;<span class="op" id="2278724">[</span><span class="op" id="2278725">]</span><span class="builtintype" id="2278726">rune</span><span class="op" id="2278730">,</span>&nbsp;<span class="ident" id="2278732">lo</span><span class="op" id="2278734">,</span>&nbsp;<span class="ident" id="2278736">hi</span>&nbsp;<span class="builtintype" id="2278739">rune</span><span class="op" id="2278743">)</span>&nbsp;<span class="op" id="2278745">[</span><span class="op" id="2278746">]</span><span class="builtintype" id="2278747">rune</span>&nbsp;<span class="op" id="2278752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2278755">//&nbsp;Optimizations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278774">if</span>&nbsp;<span class="ident" id="2278777">lo</span>&nbsp;<span class="op" id="2278780">&lt;=</span>&nbsp;<span class="ident" id="2278783">minFold</span>&nbsp;<span class="op" id="2278791">&amp;&amp;</span>&nbsp;<span class="ident" id="2278794">hi</span>&nbsp;<span class="op" id="2278797">&gt;=</span>&nbsp;<span class="ident" id="2278800">maxFold</span>&nbsp;<span class="op" id="2278808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2278812">//&nbsp;Range&nbsp;is&nbsp;full:&nbsp;folding&nbsp;can&#39;t&nbsp;add&nbsp;more.</span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278856">return</span>&nbsp;<span class="ident" id="2278863">appendRange</span><span class="op" id="2278874">(</span><span class="ident" id="2278875">r</span><span class="op" id="2278876">,</span>&nbsp;<span class="ident" id="2278878">lo</span><span class="op" id="2278880">,</span>&nbsp;<span class="ident" id="2278882">hi</span><span class="op" id="2278884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2278887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278890">if</span>&nbsp;<span class="ident" id="2278893">hi</span>&nbsp;<span class="op" id="2278896">&lt;</span>&nbsp;<span class="ident" id="2278898">minFold</span>&nbsp;<span class="op" id="2278906">||</span>&nbsp;<span class="ident" id="2278909">lo</span>&nbsp;<span class="op" id="2278912">&gt;</span>&nbsp;<span class="ident" id="2278914">maxFold</span>&nbsp;<span class="op" id="2278922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2278926">//&nbsp;Range&nbsp;is&nbsp;outside&nbsp;folding&nbsp;possibilities.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2278971">return</span>&nbsp;<span class="ident" id="2278978">appendRange</span><span class="op" id="2278989">(</span><span class="ident" id="2278990">r</span><span class="op" id="2278991">,</span>&nbsp;<span class="ident" id="2278993">lo</span><span class="op" id="2278995">,</span>&nbsp;<span class="ident" id="2278997">hi</span><span class="op" id="2278999">)</span><br>
<span class="lineno">1695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279005">if</span>&nbsp;<span class="ident" id="2279008">lo</span>&nbsp;<span class="op" id="2279011">&lt;</span>&nbsp;<span class="ident" id="2279013">minFold</span>&nbsp;<span class="op" id="2279021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2279025">//&nbsp;[lo,&nbsp;minFold-1]&nbsp;needs&nbsp;no&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279064">r</span>&nbsp;<span class="op" id="2279066">=</span>&nbsp;<span class="ident" id="2279068">appendRange</span><span class="op" id="2279079">(</span><span class="ident" id="2279080">r</span><span class="op" id="2279081">,</span>&nbsp;<span class="ident" id="2279083">lo</span><span class="op" id="2279085">,</span>&nbsp;<span class="ident" id="2279087">minFold</span><span class="op" id="2279094">-</span><span class="num" id="2279095">1</span><span class="op" id="2279096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279100">lo</span>&nbsp;<span class="op" id="2279103">=</span>&nbsp;<span class="ident" id="2279105">minFold</span><br>
<span class="lineno">1700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279117">if</span>&nbsp;<span class="ident" id="2279120">hi</span>&nbsp;<span class="op" id="2279123">&gt;</span>&nbsp;<span class="ident" id="2279125">maxFold</span>&nbsp;<span class="op" id="2279133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2279137">//&nbsp;[maxFold+1,&nbsp;hi]&nbsp;needs&nbsp;no&nbsp;folding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279176">r</span>&nbsp;<span class="op" id="2279178">=</span>&nbsp;<span class="ident" id="2279180">appendRange</span><span class="op" id="2279191">(</span><span class="ident" id="2279192">r</span><span class="op" id="2279193">,</span>&nbsp;<span class="ident" id="2279195">maxFold</span><span class="op" id="2279202">+</span><span class="num" id="2279203">1</span><span class="op" id="2279204">,</span>&nbsp;<span class="ident" id="2279206">hi</span><span class="op" id="2279208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279212">hi</span>&nbsp;<span class="op" id="2279215">=</span>&nbsp;<span class="ident" id="2279217">maxFold</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2279230">//&nbsp;Brute&nbsp;force.&nbsp;&nbsp;Depend&nbsp;on&nbsp;appendRange&nbsp;to&nbsp;coalesce&nbsp;ranges&nbsp;on&nbsp;the&nbsp;fly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279301">for</span>&nbsp;<span class="ident" id="2279305">c</span>&nbsp;<span class="op" id="2279307">:=</span>&nbsp;<span class="ident" id="2279310">lo</span><span class="op" id="2279312">;</span>&nbsp;<span class="ident" id="2279314">c</span>&nbsp;<span class="op" id="2279316">&lt;=</span>&nbsp;<span class="ident" id="2279319">hi</span><span class="op" id="2279321">;</span>&nbsp;<span class="ident" id="2279323">c</span><span class="op" id="2279324">++</span>&nbsp;<span class="op" id="2279327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279331">r</span>&nbsp;<span class="op" id="2279333">=</span>&nbsp;<span class="ident" id="2279335">appendRange</span><span class="op" id="2279346">(</span><span class="ident" id="2279347">r</span><span class="op" id="2279348">,</span>&nbsp;<span class="ident" id="2279350">c</span><span class="op" id="2279351">,</span>&nbsp;<span class="ident" id="2279353">c</span><span class="op" id="2279354">)</span><br>
<span class="lineno">1710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279358">f</span>&nbsp;<span class="op" id="2279360">:=</span>&nbsp;<span class="ident" id="2279363">unicode</span><span class="op" id="2279370">.</span><span class="ident" id="2279371">SimpleFold</span><span class="op" id="2279381">(</span><span class="ident" id="2279382">c</span><span class="op" id="2279383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279387">for</span>&nbsp;<span class="ident" id="2279391">f</span>&nbsp;<span class="op" id="2279393">!=</span>&nbsp;<span class="ident" id="2279396">c</span>&nbsp;<span class="op" id="2279398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279403">r</span>&nbsp;<span class="op" id="2279405">=</span>&nbsp;<span class="ident" id="2279407">appendRange</span><span class="op" id="2279418">(</span><span class="ident" id="2279419">r</span><span class="op" id="2279420">,</span>&nbsp;<span class="ident" id="2279422">f</span><span class="op" id="2279423">,</span>&nbsp;<span class="ident" id="2279425">f</span><span class="op" id="2279426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279431">f</span>&nbsp;<span class="op" id="2279433">=</span>&nbsp;<span class="ident" id="2279435">unicode</span><span class="op" id="2279442">.</span><span class="ident" id="2279443">SimpleFold</span><span class="op" id="2279453">(</span><span class="ident" id="2279454">f</span><span class="op" id="2279455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279459">}</span><br>
<span class="lineno">1715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279465">return</span>&nbsp;<span class="ident" id="2279472">r</span><br>
<span class="lineno"></span><span class="op" id="2279474">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2279477">//&nbsp;appendClass&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno">1720</span><span class="comment" id="2279552">//&nbsp;It&nbsp;assume&nbsp;x&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="2279577">func</span>&nbsp;<span class="ident" id="2279582">appendClass</span><span class="op" id="2279593">(</span><span class="ident" id="2279594">r</span>&nbsp;<span class="op" id="2279596">[</span><span class="op" id="2279597">]</span><span class="builtintype" id="2279598">rune</span><span class="op" id="2279602">,</span>&nbsp;<span class="ident" id="2279604">x</span>&nbsp;<span class="op" id="2279606">[</span><span class="op" id="2279607">]</span><span class="builtintype" id="2279608">rune</span><span class="op" id="2279612">)</span>&nbsp;<span class="op" id="2279614">[</span><span class="op" id="2279615">]</span><span class="builtintype" id="2279616">rune</span>&nbsp;<span class="op" id="2279621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279624">for</span>&nbsp;<span class="ident" id="2279628">i</span>&nbsp;<span class="op" id="2279630">:=</span>&nbsp;<span class="num" id="2279633">0</span><span class="op" id="2279634">;</span>&nbsp;<span class="ident" id="2279636">i</span>&nbsp;<span class="op" id="2279638">&lt;</span>&nbsp;<span class="builtinfunc" id="2279640">len</span><span class="op" id="2279643">(</span><span class="ident" id="2279644">x</span><span class="op" id="2279645">)</span><span class="op" id="2279646">;</span>&nbsp;<span class="ident" id="2279648">i</span>&nbsp;<span class="op" id="2279650">+=</span>&nbsp;<span class="num" id="2279653">2</span>&nbsp;<span class="op" id="2279655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279659">r</span>&nbsp;<span class="op" id="2279661">=</span>&nbsp;<span class="ident" id="2279663">appendRange</span><span class="op" id="2279674">(</span><span class="ident" id="2279675">r</span><span class="op" id="2279676">,</span>&nbsp;<span class="ident" id="2279678">x</span><span class="op" id="2279679">[</span><span class="ident" id="2279680">i</span><span class="op" id="2279681">]</span><span class="op" id="2279682">,</span>&nbsp;<span class="ident" id="2279684">x</span><span class="op" id="2279685">[</span><span class="ident" id="2279686">i</span><span class="op" id="2279687">+</span><span class="num" id="2279688">1</span><span class="op" id="2279689">]</span><span class="op" id="2279690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279693">}</span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279696">return</span>&nbsp;<span class="ident" id="2279703">r</span><br>
<span class="lineno"></span><span class="op" id="2279705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2279708">//&nbsp;appendFolded&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;case&nbsp;folding&nbsp;of&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="2279804">func</span>&nbsp;<span class="ident" id="2279809">appendFoldedClass</span><span class="op" id="2279826">(</span><span class="ident" id="2279827">r</span>&nbsp;<span class="op" id="2279829">[</span><span class="op" id="2279830">]</span><span class="builtintype" id="2279831">rune</span><span class="op" id="2279835">,</span>&nbsp;<span class="ident" id="2279837">x</span>&nbsp;<span class="op" id="2279839">[</span><span class="op" id="2279840">]</span><span class="builtintype" id="2279841">rune</span><span class="op" id="2279845">)</span>&nbsp;<span class="op" id="2279847">[</span><span class="op" id="2279848">]</span><span class="builtintype" id="2279849">rune</span>&nbsp;<span class="op" id="2279854">{</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279857">for</span>&nbsp;<span class="ident" id="2279861">i</span>&nbsp;<span class="op" id="2279863">:=</span>&nbsp;<span class="num" id="2279866">0</span><span class="op" id="2279867">;</span>&nbsp;<span class="ident" id="2279869">i</span>&nbsp;<span class="op" id="2279871">&lt;</span>&nbsp;<span class="builtinfunc" id="2279873">len</span><span class="op" id="2279876">(</span><span class="ident" id="2279877">x</span><span class="op" id="2279878">)</span><span class="op" id="2279879">;</span>&nbsp;<span class="ident" id="2279881">i</span>&nbsp;<span class="op" id="2279883">+=</span>&nbsp;<span class="num" id="2279886">2</span>&nbsp;<span class="op" id="2279888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2279892">r</span>&nbsp;<span class="op" id="2279894">=</span>&nbsp;<span class="ident" id="2279896">appendFoldedRange</span><span class="op" id="2279913">(</span><span class="ident" id="2279914">r</span><span class="op" id="2279915">,</span>&nbsp;<span class="ident" id="2279917">x</span><span class="op" id="2279918">[</span><span class="ident" id="2279919">i</span><span class="op" id="2279920">]</span><span class="op" id="2279921">,</span>&nbsp;<span class="ident" id="2279923">x</span><span class="op" id="2279924">[</span><span class="ident" id="2279925">i</span><span class="op" id="2279926">+</span><span class="num" id="2279927">1</span><span class="op" id="2279928">]</span><span class="op" id="2279929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2279932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2279935">return</span>&nbsp;<span class="ident" id="2279942">r</span><br>
<span class="lineno"></span><span class="op" id="2279944">}</span><br>
<span class="lineno">1735</span><br>
<span class="lineno"></span><span class="comment" id="2279947">//&nbsp;appendNegatedClass&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;negation&nbsp;of&nbsp;the&nbsp;class&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="2280045">//&nbsp;It&nbsp;assumes&nbsp;x&nbsp;is&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="2280071">func</span>&nbsp;<span class="ident" id="2280076">appendNegatedClass</span><span class="op" id="2280094">(</span><span class="ident" id="2280095">r</span>&nbsp;<span class="op" id="2280097">[</span><span class="op" id="2280098">]</span><span class="builtintype" id="2280099">rune</span><span class="op" id="2280103">,</span>&nbsp;<span class="ident" id="2280105">x</span>&nbsp;<span class="op" id="2280107">[</span><span class="op" id="2280108">]</span><span class="builtintype" id="2280109">rune</span><span class="op" id="2280113">)</span>&nbsp;<span class="op" id="2280115">[</span><span class="op" id="2280116">]</span><span class="builtintype" id="2280117">rune</span>&nbsp;<span class="op" id="2280122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280125">nextLo</span>&nbsp;<span class="op" id="2280132">:=</span>&nbsp;<span class="string" id="2280135">&#39;\u0000&#39;</span><br>
<span class="lineno">1740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280145">for</span>&nbsp;<span class="ident" id="2280149">i</span>&nbsp;<span class="op" id="2280151">:=</span>&nbsp;<span class="num" id="2280154">0</span><span class="op" id="2280155">;</span>&nbsp;<span class="ident" id="2280157">i</span>&nbsp;<span class="op" id="2280159">&lt;</span>&nbsp;<span class="builtinfunc" id="2280161">len</span><span class="op" id="2280164">(</span><span class="ident" id="2280165">x</span><span class="op" id="2280166">)</span><span class="op" id="2280167">;</span>&nbsp;<span class="ident" id="2280169">i</span>&nbsp;<span class="op" id="2280171">+=</span>&nbsp;<span class="num" id="2280174">2</span>&nbsp;<span class="op" id="2280176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280180">lo</span><span class="op" id="2280182">,</span>&nbsp;<span class="ident" id="2280184">hi</span>&nbsp;<span class="op" id="2280187">:=</span>&nbsp;<span class="ident" id="2280190">x</span><span class="op" id="2280191">[</span><span class="ident" id="2280192">i</span><span class="op" id="2280193">]</span><span class="op" id="2280194">,</span>&nbsp;<span class="ident" id="2280196">x</span><span class="op" id="2280197">[</span><span class="ident" id="2280198">i</span><span class="op" id="2280199">+</span><span class="num" id="2280200">1</span><span class="op" id="2280201">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280205">if</span>&nbsp;<span class="ident" id="2280208">nextLo</span>&nbsp;<span class="op" id="2280215">&lt;=</span>&nbsp;<span class="ident" id="2280218">lo</span><span class="op" id="2280220">-</span><span class="num" id="2280221">1</span>&nbsp;<span class="op" id="2280223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280228">r</span>&nbsp;<span class="op" id="2280230">=</span>&nbsp;<span class="ident" id="2280232">appendRange</span><span class="op" id="2280243">(</span><span class="ident" id="2280244">r</span><span class="op" id="2280245">,</span>&nbsp;<span class="ident" id="2280247">nextLo</span><span class="op" id="2280253">,</span>&nbsp;<span class="ident" id="2280255">lo</span><span class="op" id="2280257">-</span><span class="num" id="2280258">1</span><span class="op" id="2280259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2280263">}</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280267">nextLo</span>&nbsp;<span class="op" id="2280274">=</span>&nbsp;<span class="ident" id="2280276">hi</span>&nbsp;<span class="op" id="2280279">+</span>&nbsp;<span class="num" id="2280281">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2280284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280287">if</span>&nbsp;<span class="ident" id="2280290">nextLo</span>&nbsp;<span class="op" id="2280297">&lt;=</span>&nbsp;<span class="ident" id="2280300">unicode</span><span class="op" id="2280307">.</span><span class="ident" id="2280308">MaxRune</span>&nbsp;<span class="op" id="2280316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280320">r</span>&nbsp;<span class="op" id="2280322">=</span>&nbsp;<span class="ident" id="2280324">appendRange</span><span class="op" id="2280335">(</span><span class="ident" id="2280336">r</span><span class="op" id="2280337">,</span>&nbsp;<span class="ident" id="2280339">nextLo</span><span class="op" id="2280345">,</span>&nbsp;<span class="ident" id="2280347">unicode</span><span class="op" id="2280354">.</span><span class="ident" id="2280355">MaxRune</span><span class="op" id="2280362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2280365">}</span><br>
<span class="lineno">1750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280368">return</span>&nbsp;<span class="ident" id="2280375">r</span><br>
<span class="lineno"></span><span class="op" id="2280377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2280380">//&nbsp;appendTable&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="2280445">func</span>&nbsp;<span class="ident" id="2280450">appendTable</span><span class="op" id="2280461">(</span><span class="ident" id="2280462">r</span>&nbsp;<span class="op" id="2280464">[</span><span class="op" id="2280465">]</span><span class="builtintype" id="2280466">rune</span><span class="op" id="2280470">,</span>&nbsp;<span class="ident" id="2280472">x</span>&nbsp;<span class="op" id="2280474">*</span><span class="ident" id="2280475">unicode</span><span class="op" id="2280482">.</span><span class="ident" id="2280483">RangeTable</span><span class="op" id="2280493">)</span>&nbsp;<span class="op" id="2280495">[</span><span class="op" id="2280496">]</span><span class="builtintype" id="2280497">rune</span>&nbsp;<span class="op" id="2280502">{</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280505">for</span>&nbsp;<span class="ident" id="2280509">_</span><span class="op" id="2280510">,</span>&nbsp;<span class="ident" id="2280512">xr</span>&nbsp;<span class="op" id="2280515">:=</span>&nbsp;<span class="keyword" id="2280518">range</span>&nbsp;<span class="ident" id="2280524">x</span><span class="op" id="2280525">.</span><span class="ident" id="2280526">R16</span>&nbsp;<span class="op" id="2280530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280534">lo</span><span class="op" id="2280536">,</span>&nbsp;<span class="ident" id="2280538">hi</span><span class="op" id="2280540">,</span>&nbsp;<span class="ident" id="2280542">stride</span>&nbsp;<span class="op" id="2280549">:=</span>&nbsp;<span class="builtintype" id="2280552">rune</span><span class="op" id="2280556">(</span><span class="ident" id="2280557">xr</span><span class="op" id="2280559">.</span><span class="ident" id="2280560">Lo</span><span class="op" id="2280562">)</span><span class="op" id="2280563">,</span>&nbsp;<span class="builtintype" id="2280565">rune</span><span class="op" id="2280569">(</span><span class="ident" id="2280570">xr</span><span class="op" id="2280572">.</span><span class="ident" id="2280573">Hi</span><span class="op" id="2280575">)</span><span class="op" id="2280576">,</span>&nbsp;<span class="builtintype" id="2280578">rune</span><span class="op" id="2280582">(</span><span class="ident" id="2280583">xr</span><span class="op" id="2280585">.</span><span class="ident" id="2280586">Stride</span><span class="op" id="2280592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280596">if</span>&nbsp;<span class="ident" id="2280599">stride</span>&nbsp;<span class="op" id="2280606">==</span>&nbsp;<span class="num" id="2280609">1</span>&nbsp;<span class="op" id="2280611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280616">r</span>&nbsp;<span class="op" id="2280618">=</span>&nbsp;<span class="ident" id="2280620">appendRange</span><span class="op" id="2280631">(</span><span class="ident" id="2280632">r</span><span class="op" id="2280633">,</span>&nbsp;<span class="ident" id="2280635">lo</span><span class="op" id="2280637">,</span>&nbsp;<span class="ident" id="2280639">hi</span><span class="op" id="2280641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280646">continue</span><br>
<span class="lineno">1760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2280657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280661">for</span>&nbsp;<span class="ident" id="2280665">c</span>&nbsp;<span class="op" id="2280667">:=</span>&nbsp;<span class="ident" id="2280670">lo</span><span class="op" id="2280672">;</span>&nbsp;<span class="ident" id="2280674">c</span>&nbsp;<span class="op" id="2280676">&lt;=</span>&nbsp;<span class="ident" id="2280679">hi</span><span class="op" id="2280681">;</span>&nbsp;<span class="ident" id="2280683">c</span>&nbsp;<span class="op" id="2280685">+=</span>&nbsp;<span class="ident" id="2280688">stride</span>&nbsp;<span class="op" id="2280695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280700">r</span>&nbsp;<span class="op" id="2280702">=</span>&nbsp;<span class="ident" id="2280704">appendRange</span><span class="op" id="2280715">(</span><span class="ident" id="2280716">r</span><span class="op" id="2280717">,</span>&nbsp;<span class="ident" id="2280719">c</span><span class="op" id="2280720">,</span>&nbsp;<span class="ident" id="2280722">c</span><span class="op" id="2280723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2280727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2280730">}</span><br>
<span class="lineno">1765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280733">for</span>&nbsp;<span class="ident" id="2280737">_</span><span class="op" id="2280738">,</span>&nbsp;<span class="ident" id="2280740">xr</span>&nbsp;<span class="op" id="2280743">:=</span>&nbsp;<span class="keyword" id="2280746">range</span>&nbsp;<span class="ident" id="2280752">x</span><span class="op" id="2280753">.</span><span class="ident" id="2280754">R32</span>&nbsp;<span class="op" id="2280758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280762">lo</span><span class="op" id="2280764">,</span>&nbsp;<span class="ident" id="2280766">hi</span><span class="op" id="2280768">,</span>&nbsp;<span class="ident" id="2280770">stride</span>&nbsp;<span class="op" id="2280777">:=</span>&nbsp;<span class="builtintype" id="2280780">rune</span><span class="op" id="2280784">(</span><span class="ident" id="2280785">xr</span><span class="op" id="2280787">.</span><span class="ident" id="2280788">Lo</span><span class="op" id="2280790">)</span><span class="op" id="2280791">,</span>&nbsp;<span class="builtintype" id="2280793">rune</span><span class="op" id="2280797">(</span><span class="ident" id="2280798">xr</span><span class="op" id="2280800">.</span><span class="ident" id="2280801">Hi</span><span class="op" id="2280803">)</span><span class="op" id="2280804">,</span>&nbsp;<span class="builtintype" id="2280806">rune</span><span class="op" id="2280810">(</span><span class="ident" id="2280811">xr</span><span class="op" id="2280813">.</span><span class="ident" id="2280814">Stride</span><span class="op" id="2280820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280824">if</span>&nbsp;<span class="ident" id="2280827">stride</span>&nbsp;<span class="op" id="2280834">==</span>&nbsp;<span class="num" id="2280837">1</span>&nbsp;<span class="op" id="2280839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280844">r</span>&nbsp;<span class="op" id="2280846">=</span>&nbsp;<span class="ident" id="2280848">appendRange</span><span class="op" id="2280859">(</span><span class="ident" id="2280860">r</span><span class="op" id="2280861">,</span>&nbsp;<span class="ident" id="2280863">lo</span><span class="op" id="2280865">,</span>&nbsp;<span class="ident" id="2280867">hi</span><span class="op" id="2280869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280874">continue</span><br>
<span class="lineno">1770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2280885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280889">for</span>&nbsp;<span class="ident" id="2280893">c</span>&nbsp;<span class="op" id="2280895">:=</span>&nbsp;<span class="ident" id="2280898">lo</span><span class="op" id="2280900">;</span>&nbsp;<span class="ident" id="2280902">c</span>&nbsp;<span class="op" id="2280904">&lt;=</span>&nbsp;<span class="ident" id="2280907">hi</span><span class="op" id="2280909">;</span>&nbsp;<span class="ident" id="2280911">c</span>&nbsp;<span class="op" id="2280913">+=</span>&nbsp;<span class="ident" id="2280916">stride</span>&nbsp;<span class="op" id="2280923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2280928">r</span>&nbsp;<span class="op" id="2280930">=</span>&nbsp;<span class="ident" id="2280932">appendRange</span><span class="op" id="2280943">(</span><span class="ident" id="2280944">r</span><span class="op" id="2280945">,</span>&nbsp;<span class="ident" id="2280947">c</span><span class="op" id="2280948">,</span>&nbsp;<span class="ident" id="2280950">c</span><span class="op" id="2280951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2280955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2280958">}</span><br>
<span class="lineno">1775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2280961">return</span>&nbsp;<span class="ident" id="2280968">r</span><br>
<span class="lineno"></span><span class="op" id="2280970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2280973">//&nbsp;appendNegatedTable&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;appending&nbsp;the&nbsp;negation&nbsp;of&nbsp;x&nbsp;to&nbsp;the&nbsp;class&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="2281061">func</span>&nbsp;<span class="ident" id="2281066">appendNegatedTable</span><span class="op" id="2281084">(</span><span class="ident" id="2281085">r</span>&nbsp;<span class="op" id="2281087">[</span><span class="op" id="2281088">]</span><span class="builtintype" id="2281089">rune</span><span class="op" id="2281093">,</span>&nbsp;<span class="ident" id="2281095">x</span>&nbsp;<span class="op" id="2281097">*</span><span class="ident" id="2281098">unicode</span><span class="op" id="2281105">.</span><span class="ident" id="2281106">RangeTable</span><span class="op" id="2281116">)</span>&nbsp;<span class="op" id="2281118">[</span><span class="op" id="2281119">]</span><span class="builtintype" id="2281120">rune</span>&nbsp;<span class="op" id="2281125">{</span><br>
<span class="lineno">1780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281128">nextLo</span>&nbsp;<span class="op" id="2281135">:=</span>&nbsp;<span class="string" id="2281138">&#39;\u0000&#39;</span>&nbsp;<span class="comment" id="2281147">//&nbsp;lo&nbsp;end&nbsp;of&nbsp;next&nbsp;class&nbsp;to&nbsp;add</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281179">for</span>&nbsp;<span class="ident" id="2281183">_</span><span class="op" id="2281184">,</span>&nbsp;<span class="ident" id="2281186">xr</span>&nbsp;<span class="op" id="2281189">:=</span>&nbsp;<span class="keyword" id="2281192">range</span>&nbsp;<span class="ident" id="2281198">x</span><span class="op" id="2281199">.</span><span class="ident" id="2281200">R16</span>&nbsp;<span class="op" id="2281204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281208">lo</span><span class="op" id="2281210">,</span>&nbsp;<span class="ident" id="2281212">hi</span><span class="op" id="2281214">,</span>&nbsp;<span class="ident" id="2281216">stride</span>&nbsp;<span class="op" id="2281223">:=</span>&nbsp;<span class="builtintype" id="2281226">rune</span><span class="op" id="2281230">(</span><span class="ident" id="2281231">xr</span><span class="op" id="2281233">.</span><span class="ident" id="2281234">Lo</span><span class="op" id="2281236">)</span><span class="op" id="2281237">,</span>&nbsp;<span class="builtintype" id="2281239">rune</span><span class="op" id="2281243">(</span><span class="ident" id="2281244">xr</span><span class="op" id="2281246">.</span><span class="ident" id="2281247">Hi</span><span class="op" id="2281249">)</span><span class="op" id="2281250">,</span>&nbsp;<span class="builtintype" id="2281252">rune</span><span class="op" id="2281256">(</span><span class="ident" id="2281257">xr</span><span class="op" id="2281259">.</span><span class="ident" id="2281260">Stride</span><span class="op" id="2281266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281270">if</span>&nbsp;<span class="ident" id="2281273">stride</span>&nbsp;<span class="op" id="2281280">==</span>&nbsp;<span class="num" id="2281283">1</span>&nbsp;<span class="op" id="2281285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281290">if</span>&nbsp;<span class="ident" id="2281293">nextLo</span>&nbsp;<span class="op" id="2281300">&lt;=</span>&nbsp;<span class="ident" id="2281303">lo</span><span class="op" id="2281305">-</span><span class="num" id="2281306">1</span>&nbsp;<span class="op" id="2281308">{</span><br>
<span class="lineno">1785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281314">r</span>&nbsp;<span class="op" id="2281316">=</span>&nbsp;<span class="ident" id="2281318">appendRange</span><span class="op" id="2281329">(</span><span class="ident" id="2281330">r</span><span class="op" id="2281331">,</span>&nbsp;<span class="ident" id="2281333">nextLo</span><span class="op" id="2281339">,</span>&nbsp;<span class="ident" id="2281341">lo</span><span class="op" id="2281343">-</span><span class="num" id="2281344">1</span><span class="op" id="2281345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2281350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281355">nextLo</span>&nbsp;<span class="op" id="2281362">=</span>&nbsp;<span class="ident" id="2281364">hi</span>&nbsp;<span class="op" id="2281367">+</span>&nbsp;<span class="num" id="2281369">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281374">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2281385">}</span><br>
<span class="lineno">1790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281389">for</span>&nbsp;<span class="ident" id="2281393">c</span>&nbsp;<span class="op" id="2281395">:=</span>&nbsp;<span class="ident" id="2281398">lo</span><span class="op" id="2281400">;</span>&nbsp;<span class="ident" id="2281402">c</span>&nbsp;<span class="op" id="2281404">&lt;=</span>&nbsp;<span class="ident" id="2281407">hi</span><span class="op" id="2281409">;</span>&nbsp;<span class="ident" id="2281411">c</span>&nbsp;<span class="op" id="2281413">+=</span>&nbsp;<span class="ident" id="2281416">stride</span>&nbsp;<span class="op" id="2281423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281428">if</span>&nbsp;<span class="ident" id="2281431">nextLo</span>&nbsp;<span class="op" id="2281438">&lt;=</span>&nbsp;<span class="ident" id="2281441">c</span><span class="op" id="2281442">-</span><span class="num" id="2281443">1</span>&nbsp;<span class="op" id="2281445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281451">r</span>&nbsp;<span class="op" id="2281453">=</span>&nbsp;<span class="ident" id="2281455">appendRange</span><span class="op" id="2281466">(</span><span class="ident" id="2281467">r</span><span class="op" id="2281468">,</span>&nbsp;<span class="ident" id="2281470">nextLo</span><span class="op" id="2281476">,</span>&nbsp;<span class="ident" id="2281478">c</span><span class="op" id="2281479">-</span><span class="num" id="2281480">1</span><span class="op" id="2281481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2281486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281491">nextLo</span>&nbsp;<span class="op" id="2281498">=</span>&nbsp;<span class="ident" id="2281500">c</span>&nbsp;<span class="op" id="2281502">+</span>&nbsp;<span class="num" id="2281504">1</span><br>
<span class="lineno">1795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2281508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2281511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281514">for</span>&nbsp;<span class="ident" id="2281518">_</span><span class="op" id="2281519">,</span>&nbsp;<span class="ident" id="2281521">xr</span>&nbsp;<span class="op" id="2281524">:=</span>&nbsp;<span class="keyword" id="2281527">range</span>&nbsp;<span class="ident" id="2281533">x</span><span class="op" id="2281534">.</span><span class="ident" id="2281535">R32</span>&nbsp;<span class="op" id="2281539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281543">lo</span><span class="op" id="2281545">,</span>&nbsp;<span class="ident" id="2281547">hi</span><span class="op" id="2281549">,</span>&nbsp;<span class="ident" id="2281551">stride</span>&nbsp;<span class="op" id="2281558">:=</span>&nbsp;<span class="builtintype" id="2281561">rune</span><span class="op" id="2281565">(</span><span class="ident" id="2281566">xr</span><span class="op" id="2281568">.</span><span class="ident" id="2281569">Lo</span><span class="op" id="2281571">)</span><span class="op" id="2281572">,</span>&nbsp;<span class="builtintype" id="2281574">rune</span><span class="op" id="2281578">(</span><span class="ident" id="2281579">xr</span><span class="op" id="2281581">.</span><span class="ident" id="2281582">Hi</span><span class="op" id="2281584">)</span><span class="op" id="2281585">,</span>&nbsp;<span class="builtintype" id="2281587">rune</span><span class="op" id="2281591">(</span><span class="ident" id="2281592">xr</span><span class="op" id="2281594">.</span><span class="ident" id="2281595">Stride</span><span class="op" id="2281601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281605">if</span>&nbsp;<span class="ident" id="2281608">stride</span>&nbsp;<span class="op" id="2281615">==</span>&nbsp;<span class="num" id="2281618">1</span>&nbsp;<span class="op" id="2281620">{</span><br>
<span class="lineno">1800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281625">if</span>&nbsp;<span class="ident" id="2281628">nextLo</span>&nbsp;<span class="op" id="2281635">&lt;=</span>&nbsp;<span class="ident" id="2281638">lo</span><span class="op" id="2281640">-</span><span class="num" id="2281641">1</span>&nbsp;<span class="op" id="2281643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281649">r</span>&nbsp;<span class="op" id="2281651">=</span>&nbsp;<span class="ident" id="2281653">appendRange</span><span class="op" id="2281664">(</span><span class="ident" id="2281665">r</span><span class="op" id="2281666">,</span>&nbsp;<span class="ident" id="2281668">nextLo</span><span class="op" id="2281674">,</span>&nbsp;<span class="ident" id="2281676">lo</span><span class="op" id="2281678">-</span><span class="num" id="2281679">1</span><span class="op" id="2281680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2281685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281690">nextLo</span>&nbsp;<span class="op" id="2281697">=</span>&nbsp;<span class="ident" id="2281699">hi</span>&nbsp;<span class="op" id="2281702">+</span>&nbsp;<span class="num" id="2281704">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281709">continue</span><br>
<span class="lineno">1805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2281720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281724">for</span>&nbsp;<span class="ident" id="2281728">c</span>&nbsp;<span class="op" id="2281730">:=</span>&nbsp;<span class="ident" id="2281733">lo</span><span class="op" id="2281735">;</span>&nbsp;<span class="ident" id="2281737">c</span>&nbsp;<span class="op" id="2281739">&lt;=</span>&nbsp;<span class="ident" id="2281742">hi</span><span class="op" id="2281744">;</span>&nbsp;<span class="ident" id="2281746">c</span>&nbsp;<span class="op" id="2281748">+=</span>&nbsp;<span class="ident" id="2281751">stride</span>&nbsp;<span class="op" id="2281758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281763">if</span>&nbsp;<span class="ident" id="2281766">nextLo</span>&nbsp;<span class="op" id="2281773">&lt;=</span>&nbsp;<span class="ident" id="2281776">c</span><span class="op" id="2281777">-</span><span class="num" id="2281778">1</span>&nbsp;<span class="op" id="2281780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281786">r</span>&nbsp;<span class="op" id="2281788">=</span>&nbsp;<span class="ident" id="2281790">appendRange</span><span class="op" id="2281801">(</span><span class="ident" id="2281802">r</span><span class="op" id="2281803">,</span>&nbsp;<span class="ident" id="2281805">nextLo</span><span class="op" id="2281811">,</span>&nbsp;<span class="ident" id="2281813">c</span><span class="op" id="2281814">-</span><span class="num" id="2281815">1</span><span class="op" id="2281816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2281821">}</span><br>
<span class="lineno">1810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281826">nextLo</span>&nbsp;<span class="op" id="2281833">=</span>&nbsp;<span class="ident" id="2281835">c</span>&nbsp;<span class="op" id="2281837">+</span>&nbsp;<span class="num" id="2281839">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2281843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2281846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281849">if</span>&nbsp;<span class="ident" id="2281852">nextLo</span>&nbsp;<span class="op" id="2281859">&lt;=</span>&nbsp;<span class="ident" id="2281862">unicode</span><span class="op" id="2281869">.</span><span class="ident" id="2281870">MaxRune</span>&nbsp;<span class="op" id="2281878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2281882">r</span>&nbsp;<span class="op" id="2281884">=</span>&nbsp;<span class="ident" id="2281886">appendRange</span><span class="op" id="2281897">(</span><span class="ident" id="2281898">r</span><span class="op" id="2281899">,</span>&nbsp;<span class="ident" id="2281901">nextLo</span><span class="op" id="2281907">,</span>&nbsp;<span class="ident" id="2281909">unicode</span><span class="op" id="2281916">.</span><span class="ident" id="2281917">MaxRune</span><span class="op" id="2281924">)</span><br>
<span class="lineno">1815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2281927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2281930">return</span>&nbsp;<span class="ident" id="2281937">r</span><br>
<span class="lineno"></span><span class="op" id="2281939">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2281942">//&nbsp;negateClass&nbsp;overwrites&nbsp;r&nbsp;and&nbsp;returns&nbsp;r&#39;s&nbsp;negation.</span><br>
<span class="lineno">1820</span><span class="comment" id="2281996">//&nbsp;It&nbsp;assumes&nbsp;the&nbsp;class&nbsp;r&nbsp;is&nbsp;already&nbsp;clean.</span><br>
<span class="lineno"></span><span class="keyword" id="2282040">func</span>&nbsp;<span class="ident" id="2282045">negateClass</span><span class="op" id="2282056">(</span><span class="ident" id="2282057">r</span>&nbsp;<span class="op" id="2282059">[</span><span class="op" id="2282060">]</span><span class="builtintype" id="2282061">rune</span><span class="op" id="2282065">)</span>&nbsp;<span class="op" id="2282067">[</span><span class="op" id="2282068">]</span><span class="builtintype" id="2282069">rune</span>&nbsp;<span class="op" id="2282074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282077">nextLo</span>&nbsp;<span class="op" id="2282084">:=</span>&nbsp;<span class="string" id="2282087">&#39;\u0000&#39;</span>&nbsp;<span class="comment" id="2282096">//&nbsp;lo&nbsp;end&nbsp;of&nbsp;next&nbsp;class&nbsp;to&nbsp;add</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282128">w</span>&nbsp;<span class="op" id="2282130">:=</span>&nbsp;<span class="num" id="2282133">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2282147">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282163">for</span>&nbsp;<span class="ident" id="2282167">i</span>&nbsp;<span class="op" id="2282169">:=</span>&nbsp;<span class="num" id="2282172">0</span><span class="op" id="2282173">;</span>&nbsp;<span class="ident" id="2282175">i</span>&nbsp;<span class="op" id="2282177">&lt;</span>&nbsp;<span class="builtinfunc" id="2282179">len</span><span class="op" id="2282182">(</span><span class="ident" id="2282183">r</span><span class="op" id="2282184">)</span><span class="op" id="2282185">;</span>&nbsp;<span class="ident" id="2282187">i</span>&nbsp;<span class="op" id="2282189">+=</span>&nbsp;<span class="num" id="2282192">2</span>&nbsp;<span class="op" id="2282194">{</span><br>
<span class="lineno">1825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282198">lo</span><span class="op" id="2282200">,</span>&nbsp;<span class="ident" id="2282202">hi</span>&nbsp;<span class="op" id="2282205">:=</span>&nbsp;<span class="ident" id="2282208">r</span><span class="op" id="2282209">[</span><span class="ident" id="2282210">i</span><span class="op" id="2282211">]</span><span class="op" id="2282212">,</span>&nbsp;<span class="ident" id="2282214">r</span><span class="op" id="2282215">[</span><span class="ident" id="2282216">i</span><span class="op" id="2282217">+</span><span class="num" id="2282218">1</span><span class="op" id="2282219">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282223">if</span>&nbsp;<span class="ident" id="2282226">nextLo</span>&nbsp;<span class="op" id="2282233">&lt;=</span>&nbsp;<span class="ident" id="2282236">lo</span><span class="op" id="2282238">-</span><span class="num" id="2282239">1</span>&nbsp;<span class="op" id="2282241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282246">r</span><span class="op" id="2282247">[</span><span class="ident" id="2282248">w</span><span class="op" id="2282249">]</span>&nbsp;<span class="op" id="2282251">=</span>&nbsp;<span class="ident" id="2282253">nextLo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282263">r</span><span class="op" id="2282264">[</span><span class="ident" id="2282265">w</span><span class="op" id="2282266">+</span><span class="num" id="2282267">1</span><span class="op" id="2282268">]</span>&nbsp;<span class="op" id="2282270">=</span>&nbsp;<span class="ident" id="2282272">lo</span>&nbsp;<span class="op" id="2282275">-</span>&nbsp;<span class="num" id="2282277">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282282">w</span>&nbsp;<span class="op" id="2282284">+=</span>&nbsp;<span class="num" id="2282287">2</span><br>
<span class="lineno">1830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2282291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282295">nextLo</span>&nbsp;<span class="op" id="2282302">=</span>&nbsp;<span class="ident" id="2282304">hi</span>&nbsp;<span class="op" id="2282307">+</span>&nbsp;<span class="num" id="2282309">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2282312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282315">r</span>&nbsp;<span class="op" id="2282317">=</span>&nbsp;<span class="ident" id="2282319">r</span><span class="op" id="2282320">[</span><span class="op" id="2282321">:</span><span class="ident" id="2282322">w</span><span class="op" id="2282323">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282326">if</span>&nbsp;<span class="ident" id="2282329">nextLo</span>&nbsp;<span class="op" id="2282336">&lt;=</span>&nbsp;<span class="ident" id="2282339">unicode</span><span class="op" id="2282346">.</span><span class="ident" id="2282347">MaxRune</span>&nbsp;<span class="op" id="2282355">{</span><br>
<span class="lineno">1835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2282359">//&nbsp;It&#39;s&nbsp;possible&nbsp;for&nbsp;the&nbsp;negation&nbsp;to&nbsp;have&nbsp;one&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2282412">//&nbsp;range&nbsp;-&nbsp;this&nbsp;one&nbsp;-&nbsp;than&nbsp;the&nbsp;original&nbsp;class,&nbsp;so&nbsp;use&nbsp;append.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282476">r</span>&nbsp;<span class="op" id="2282478">=</span>&nbsp;<span class="builtinfunc" id="2282480">append</span><span class="op" id="2282486">(</span><span class="ident" id="2282487">r</span><span class="op" id="2282488">,</span>&nbsp;<span class="ident" id="2282490">nextLo</span><span class="op" id="2282496">,</span>&nbsp;<span class="ident" id="2282498">unicode</span><span class="op" id="2282505">.</span><span class="ident" id="2282506">MaxRune</span><span class="op" id="2282513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2282516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282519">return</span>&nbsp;<span class="ident" id="2282526">r</span><br>
<span class="lineno">1840</span><span class="op" id="2282528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2282531">//&nbsp;ranges&nbsp;implements&nbsp;sort.Interface&nbsp;on&nbsp;a&nbsp;[]rune.</span><br>
<span class="lineno"></span><span class="comment" id="2282580">//&nbsp;The&nbsp;choice&nbsp;of&nbsp;receiver&nbsp;type&nbsp;definition&nbsp;is&nbsp;strange</span><br>
<span class="lineno"></span><span class="comment" id="2282633">//&nbsp;but&nbsp;avoids&nbsp;an&nbsp;allocation&nbsp;since&nbsp;we&nbsp;already&nbsp;have</span><br>
<span class="lineno">1845</span><span class="comment" id="2282683">//&nbsp;a&nbsp;*[]rune.</span><br>
<span class="lineno"></span><span class="keyword" id="2282697">type</span>&nbsp;<span class="ident" id="2282702">ranges</span>&nbsp;<span class="keyword" id="2282709">struct</span>&nbsp;<span class="op" id="2282716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282719">p</span>&nbsp;<span class="op" id="2282721">*</span><span class="op" id="2282722">[</span><span class="op" id="2282723">]</span><span class="builtintype" id="2282724">rune</span><br>
<span class="lineno"></span><span class="op" id="2282729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1850</span><span class="keyword" id="2282732">func</span>&nbsp;<span class="op" id="2282737">(</span><span class="ident" id="2282738">ra</span>&nbsp;<span class="ident" id="2282741">ranges</span><span class="op" id="2282747">)</span>&nbsp;<span class="ident" id="2282749">Less</span><span class="op" id="2282753">(</span><span class="ident" id="2282754">i</span><span class="op" id="2282755">,</span>&nbsp;<span class="ident" id="2282757">j</span>&nbsp;<span class="builtintype" id="2282759">int</span><span class="op" id="2282762">)</span>&nbsp;<span class="builtintype" id="2282764">bool</span>&nbsp;<span class="op" id="2282769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282772">p</span>&nbsp;<span class="op" id="2282774">:=</span>&nbsp;<span class="op" id="2282777">*</span><span class="ident" id="2282778">ra</span><span class="op" id="2282780">.</span><span class="ident" id="2282781">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282784">i</span>&nbsp;<span class="op" id="2282786">*=</span>&nbsp;<span class="num" id="2282789">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282792">j</span>&nbsp;<span class="op" id="2282794">*=</span>&nbsp;<span class="num" id="2282797">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282800">return</span>&nbsp;<span class="ident" id="2282807">p</span><span class="op" id="2282808">[</span><span class="ident" id="2282809">i</span><span class="op" id="2282810">]</span>&nbsp;<span class="op" id="2282812">&lt;</span>&nbsp;<span class="ident" id="2282814">p</span><span class="op" id="2282815">[</span><span class="ident" id="2282816">j</span><span class="op" id="2282817">]</span>&nbsp;<span class="op" id="2282819">||</span>&nbsp;<span class="ident" id="2282822">p</span><span class="op" id="2282823">[</span><span class="ident" id="2282824">i</span><span class="op" id="2282825">]</span>&nbsp;<span class="op" id="2282827">==</span>&nbsp;<span class="ident" id="2282830">p</span><span class="op" id="2282831">[</span><span class="ident" id="2282832">j</span><span class="op" id="2282833">]</span>&nbsp;<span class="op" id="2282835">&amp;&amp;</span>&nbsp;<span class="ident" id="2282838">p</span><span class="op" id="2282839">[</span><span class="ident" id="2282840">i</span><span class="op" id="2282841">+</span><span class="num" id="2282842">1</span><span class="op" id="2282843">]</span>&nbsp;<span class="op" id="2282845">&gt;</span>&nbsp;<span class="ident" id="2282847">p</span><span class="op" id="2282848">[</span><span class="ident" id="2282849">j</span><span class="op" id="2282850">+</span><span class="num" id="2282851">1</span><span class="op" id="2282852">]</span><br>
<span class="lineno">1855</span><span class="op" id="2282854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2282857">func</span>&nbsp;<span class="op" id="2282862">(</span><span class="ident" id="2282863">ra</span>&nbsp;<span class="ident" id="2282866">ranges</span><span class="op" id="2282872">)</span>&nbsp;<span class="ident" id="2282874">Len</span><span class="op" id="2282877">(</span><span class="op" id="2282878">)</span>&nbsp;<span class="builtintype" id="2282880">int</span>&nbsp;<span class="op" id="2282884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2282887">return</span>&nbsp;<span class="builtinfunc" id="2282894">len</span><span class="op" id="2282897">(</span><span class="op" id="2282898">*</span><span class="ident" id="2282899">ra</span><span class="op" id="2282901">.</span><span class="ident" id="2282902">p</span><span class="op" id="2282903">)</span>&nbsp;<span class="op" id="2282905">/</span>&nbsp;<span class="num" id="2282907">2</span><br>
<span class="lineno"></span><span class="op" id="2282909">}</span><br>
<span class="lineno">1860</span><br>
<span class="lineno"></span><span class="keyword" id="2282912">func</span>&nbsp;<span class="op" id="2282917">(</span><span class="ident" id="2282918">ra</span>&nbsp;<span class="ident" id="2282921">ranges</span><span class="op" id="2282927">)</span>&nbsp;<span class="ident" id="2282929">Swap</span><span class="op" id="2282933">(</span><span class="ident" id="2282934">i</span><span class="op" id="2282935">,</span>&nbsp;<span class="ident" id="2282937">j</span>&nbsp;<span class="builtintype" id="2282939">int</span><span class="op" id="2282942">)</span>&nbsp;<span class="op" id="2282944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282947">p</span>&nbsp;<span class="op" id="2282949">:=</span>&nbsp;<span class="op" id="2282952">*</span><span class="ident" id="2282953">ra</span><span class="op" id="2282955">.</span><span class="ident" id="2282956">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282959">i</span>&nbsp;<span class="op" id="2282961">*=</span>&nbsp;<span class="num" id="2282964">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282967">j</span>&nbsp;<span class="op" id="2282969">*=</span>&nbsp;<span class="num" id="2282972">2</span><br>
<span class="lineno">1865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2282975">p</span><span class="op" id="2282976">[</span><span class="ident" id="2282977">i</span><span class="op" id="2282978">]</span><span class="op" id="2282979">,</span>&nbsp;<span class="ident" id="2282981">p</span><span class="op" id="2282982">[</span><span class="ident" id="2282983">i</span><span class="op" id="2282984">+</span><span class="num" id="2282985">1</span><span class="op" id="2282986">]</span><span class="op" id="2282987">,</span>&nbsp;<span class="ident" id="2282989">p</span><span class="op" id="2282990">[</span><span class="ident" id="2282991">j</span><span class="op" id="2282992">]</span><span class="op" id="2282993">,</span>&nbsp;<span class="ident" id="2282995">p</span><span class="op" id="2282996">[</span><span class="ident" id="2282997">j</span><span class="op" id="2282998">+</span><span class="num" id="2282999">1</span><span class="op" id="2283000">]</span>&nbsp;<span class="op" id="2283002">=</span>&nbsp;<span class="ident" id="2283004">p</span><span class="op" id="2283005">[</span><span class="ident" id="2283006">j</span><span class="op" id="2283007">]</span><span class="op" id="2283008">,</span>&nbsp;<span class="ident" id="2283010">p</span><span class="op" id="2283011">[</span><span class="ident" id="2283012">j</span><span class="op" id="2283013">+</span><span class="num" id="2283014">1</span><span class="op" id="2283015">]</span><span class="op" id="2283016">,</span>&nbsp;<span class="ident" id="2283018">p</span><span class="op" id="2283019">[</span><span class="ident" id="2283020">i</span><span class="op" id="2283021">]</span><span class="op" id="2283022">,</span>&nbsp;<span class="ident" id="2283024">p</span><span class="op" id="2283025">[</span><span class="ident" id="2283026">i</span><span class="op" id="2283027">+</span><span class="num" id="2283028">1</span><span class="op" id="2283029">]</span><br>
<span class="lineno"></span><span class="op" id="2283031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2283034">func</span>&nbsp;<span class="ident" id="2283039">checkUTF8</span><span class="op" id="2283048">(</span><span class="ident" id="2283049">s</span>&nbsp;<span class="builtintype" id="2283051">string</span><span class="op" id="2283057">)</span>&nbsp;<span class="builtintype" id="2283059">error</span>&nbsp;<span class="op" id="2283065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283068">for</span>&nbsp;<span class="ident" id="2283072">s</span>&nbsp;<span class="op" id="2283074">!=</span>&nbsp;<span class="string" id="2283077">&#34;&#34;</span>&nbsp;<span class="op" id="2283080">{</span><br>
<span class="lineno">1870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2283084">rune</span><span class="op" id="2283088">,</span>&nbsp;<span class="ident" id="2283090">size</span>&nbsp;<span class="op" id="2283095">:=</span>&nbsp;<span class="ident" id="2283098">utf8</span><span class="op" id="2283102">.</span><span class="ident" id="2283103">DecodeRuneInString</span><span class="op" id="2283121">(</span><span class="ident" id="2283122">s</span><span class="op" id="2283123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283127">if</span>&nbsp;<span class="builtintype" id="2283130">rune</span>&nbsp;<span class="op" id="2283135">==</span>&nbsp;<span class="ident" id="2283138">utf8</span><span class="op" id="2283142">.</span><span class="ident" id="2283143">RuneError</span>&nbsp;<span class="op" id="2283153">&amp;&amp;</span>&nbsp;<span class="ident" id="2283156">size</span>&nbsp;<span class="op" id="2283161">==</span>&nbsp;<span class="num" id="2283164">1</span>&nbsp;<span class="op" id="2283166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283171">return</span>&nbsp;<span class="op" id="2283178">&amp;</span><span class="ident" id="2283179">Error</span><span class="op" id="2283184">{</span><span class="ident" id="2283185">Code</span><span class="op" id="2283189">:</span>&nbsp;<span class="ident" id="2283191">ErrInvalidUTF8</span><span class="op" id="2283205">,</span>&nbsp;<span class="ident" id="2283207">Expr</span><span class="op" id="2283211">:</span>&nbsp;<span class="ident" id="2283213">s</span><span class="op" id="2283214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2283218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2283222">s</span>&nbsp;<span class="op" id="2283224">=</span>&nbsp;<span class="ident" id="2283226">s</span><span class="op" id="2283227">[</span><span class="ident" id="2283228">size</span><span class="op" id="2283232">:</span><span class="op" id="2283233">]</span><br>
<span class="lineno">1875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2283236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283239">return</span>&nbsp;<span class="ident" id="2283246">nil</span><br>
<span class="lineno"></span><span class="op" id="2283250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2283253">func</span>&nbsp;<span class="ident" id="2283258">nextRune</span><span class="op" id="2283266">(</span><span class="ident" id="2283267">s</span>&nbsp;<span class="builtintype" id="2283269">string</span><span class="op" id="2283275">)</span>&nbsp;<span class="op" id="2283277">(</span><span class="ident" id="2283278">c</span>&nbsp;<span class="builtintype" id="2283280">rune</span><span class="op" id="2283284">,</span>&nbsp;<span class="ident" id="2283286">t</span>&nbsp;<span class="builtintype" id="2283288">string</span><span class="op" id="2283294">,</span>&nbsp;<span class="ident" id="2283296">err</span>&nbsp;<span class="builtintype" id="2283300">error</span><span class="op" id="2283305">)</span>&nbsp;<span class="op" id="2283307">{</span><br>
<span class="lineno">1880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2283310">c</span><span class="op" id="2283311">,</span>&nbsp;<span class="ident" id="2283313">size</span>&nbsp;<span class="op" id="2283318">:=</span>&nbsp;<span class="ident" id="2283321">utf8</span><span class="op" id="2283325">.</span><span class="ident" id="2283326">DecodeRuneInString</span><span class="op" id="2283344">(</span><span class="ident" id="2283345">s</span><span class="op" id="2283346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283349">if</span>&nbsp;<span class="ident" id="2283352">c</span>&nbsp;<span class="op" id="2283354">==</span>&nbsp;<span class="ident" id="2283357">utf8</span><span class="op" id="2283361">.</span><span class="ident" id="2283362">RuneError</span>&nbsp;<span class="op" id="2283372">&amp;&amp;</span>&nbsp;<span class="ident" id="2283375">size</span>&nbsp;<span class="op" id="2283380">==</span>&nbsp;<span class="num" id="2283383">1</span>&nbsp;<span class="op" id="2283385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283389">return</span>&nbsp;<span class="num" id="2283396">0</span><span class="op" id="2283397">,</span>&nbsp;<span class="string" id="2283399">&#34;&#34;</span><span class="op" id="2283401">,</span>&nbsp;<span class="op" id="2283403">&amp;</span><span class="ident" id="2283404">Error</span><span class="op" id="2283409">{</span><span class="ident" id="2283410">Code</span><span class="op" id="2283414">:</span>&nbsp;<span class="ident" id="2283416">ErrInvalidUTF8</span><span class="op" id="2283430">,</span>&nbsp;<span class="ident" id="2283432">Expr</span><span class="op" id="2283436">:</span>&nbsp;<span class="ident" id="2283438">s</span><span class="op" id="2283439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2283442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283445">return</span>&nbsp;<span class="ident" id="2283452">c</span><span class="op" id="2283453">,</span>&nbsp;<span class="ident" id="2283455">s</span><span class="op" id="2283456">[</span><span class="ident" id="2283457">size</span><span class="op" id="2283461">:</span><span class="op" id="2283462">]</span><span class="op" id="2283463">,</span>&nbsp;<span class="ident" id="2283465">nil</span><br>
<span class="lineno">1885</span><span class="op" id="2283469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2283472">func</span>&nbsp;<span class="ident" id="2283477">isalnum</span><span class="op" id="2283484">(</span><span class="ident" id="2283485">c</span>&nbsp;<span class="builtintype" id="2283487">rune</span><span class="op" id="2283491">)</span>&nbsp;<span class="builtintype" id="2283493">bool</span>&nbsp;<span class="op" id="2283498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283501">return</span>&nbsp;<span class="string" id="2283508">&#39;0&#39;</span>&nbsp;<span class="op" id="2283512">&lt;=</span>&nbsp;<span class="ident" id="2283515">c</span>&nbsp;<span class="op" id="2283517">&amp;&amp;</span>&nbsp;<span class="ident" id="2283520">c</span>&nbsp;<span class="op" id="2283522">&lt;=</span>&nbsp;<span class="string" id="2283525">&#39;9&#39;</span>&nbsp;<span class="op" id="2283529">||</span>&nbsp;<span class="string" id="2283532">&#39;A&#39;</span>&nbsp;<span class="op" id="2283536">&lt;=</span>&nbsp;<span class="ident" id="2283539">c</span>&nbsp;<span class="op" id="2283541">&amp;&amp;</span>&nbsp;<span class="ident" id="2283544">c</span>&nbsp;<span class="op" id="2283546">&lt;=</span>&nbsp;<span class="string" id="2283549">&#39;Z&#39;</span>&nbsp;<span class="op" id="2283553">||</span>&nbsp;<span class="string" id="2283556">&#39;a&#39;</span>&nbsp;<span class="op" id="2283560">&lt;=</span>&nbsp;<span class="ident" id="2283563">c</span>&nbsp;<span class="op" id="2283565">&amp;&amp;</span>&nbsp;<span class="ident" id="2283568">c</span>&nbsp;<span class="op" id="2283570">&lt;=</span>&nbsp;<span class="string" id="2283573">&#39;z&#39;</span><br>
<span class="lineno"></span><span class="op" id="2283577">}</span><br>
<span class="lineno">1890</span><br>
<span class="lineno"></span><span class="keyword" id="2283580">func</span>&nbsp;<span class="ident" id="2283585">unhex</span><span class="op" id="2283590">(</span><span class="ident" id="2283591">c</span>&nbsp;<span class="builtintype" id="2283593">rune</span><span class="op" id="2283597">)</span>&nbsp;<span class="builtintype" id="2283599">rune</span>&nbsp;<span class="op" id="2283604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283607">if</span>&nbsp;<span class="string" id="2283610">&#39;0&#39;</span>&nbsp;<span class="op" id="2283614">&lt;=</span>&nbsp;<span class="ident" id="2283617">c</span>&nbsp;<span class="op" id="2283619">&amp;&amp;</span>&nbsp;<span class="ident" id="2283622">c</span>&nbsp;<span class="op" id="2283624">&lt;=</span>&nbsp;<span class="string" id="2283627">&#39;9&#39;</span>&nbsp;<span class="op" id="2283631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283635">return</span>&nbsp;<span class="ident" id="2283642">c</span>&nbsp;<span class="op" id="2283644">-</span>&nbsp;<span class="string" id="2283646">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2283651">}</span><br>
<span class="lineno">1895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283654">if</span>&nbsp;<span class="string" id="2283657">&#39;a&#39;</span>&nbsp;<span class="op" id="2283661">&lt;=</span>&nbsp;<span class="ident" id="2283664">c</span>&nbsp;<span class="op" id="2283666">&amp;&amp;</span>&nbsp;<span class="ident" id="2283669">c</span>&nbsp;<span class="op" id="2283671">&lt;=</span>&nbsp;<span class="string" id="2283674">&#39;f&#39;</span>&nbsp;<span class="op" id="2283678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283682">return</span>&nbsp;<span class="ident" id="2283689">c</span>&nbsp;<span class="op" id="2283691">-</span>&nbsp;<span class="string" id="2283693">&#39;a&#39;</span>&nbsp;<span class="op" id="2283697">+</span>&nbsp;<span class="num" id="2283699">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2283703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283706">if</span>&nbsp;<span class="string" id="2283709">&#39;A&#39;</span>&nbsp;<span class="op" id="2283713">&lt;=</span>&nbsp;<span class="ident" id="2283716">c</span>&nbsp;<span class="op" id="2283718">&amp;&amp;</span>&nbsp;<span class="ident" id="2283721">c</span>&nbsp;<span class="op" id="2283723">&lt;=</span>&nbsp;<span class="string" id="2283726">&#39;F&#39;</span>&nbsp;<span class="op" id="2283730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283734">return</span>&nbsp;<span class="ident" id="2283741">c</span>&nbsp;<span class="op" id="2283743">-</span>&nbsp;<span class="string" id="2283745">&#39;A&#39;</span>&nbsp;<span class="op" id="2283749">+</span>&nbsp;<span class="num" id="2283751">10</span><br>
<span class="lineno">1900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2283755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2283758">return</span>&nbsp;<span class="op" id="2283765">-</span><span class="num" id="2283766">1</span><br>
<span class="lineno"></span><span class="op" id="2283768">}</span>
</div>
</body>
</html>
