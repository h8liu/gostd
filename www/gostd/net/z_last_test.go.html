<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8028400">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8028455">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8028509">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8028560">package</span>&nbsp;<span class="ident" id="8028568">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8028573">import</span>&nbsp;<span class="op" id="8028580">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8028583">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8028591">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8028598">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8028609">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8028616">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8028619">var</span>&nbsp;<span class="ident" id="8028623">testDNSFlood</span>&nbsp;<span class="op" id="8028636">=</span>&nbsp;<span class="ident" id="8028638">flag</span><span class="op" id="8028642">.</span><span class="ident" id="8028643">Bool</span><span class="op" id="8028647">(</span><span class="string" id="8028648">&#34;dnsflood&#34;</span><span class="op" id="8028658">,</span>&nbsp;<span class="builtintype" id="8028660">false</span><span class="op" id="8028665">,</span>&nbsp;<span class="string" id="8028667">&#34;whether&nbsp;to&nbsp;test&nbsp;dns&nbsp;query&nbsp;flooding&#34;</span><span class="op" id="8028703">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="8028706">func</span>&nbsp;<span class="ident" id="8028711">TestDNSThreadLimit</span><span class="op" id="8028729">(</span><span class="ident" id="8028730">t</span>&nbsp;<span class="op" id="8028732">*</span><span class="ident" id="8028733">testing</span><span class="op" id="8028740">.</span><span class="ident" id="8028741">T</span><span class="op" id="8028742">)</span>&nbsp;<span class="op" id="8028744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8028747">if</span>&nbsp;<span class="op" id="8028750">!</span><span class="op" id="8028751">*</span><span class="ident" id="8028752">testDNSFlood</span>&nbsp;<span class="op" id="8028765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8028769">t</span><span class="op" id="8028770">.</span><span class="ident" id="8028771">Skip</span><span class="op" id="8028775">(</span><span class="string" id="8028776">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-dnsflood&nbsp;to&nbsp;enable&#34;</span><span class="op" id="8028816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8028819">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8028823">const</span>&nbsp;<span class="ident" id="8028829">N</span>&nbsp;<span class="op" id="8028831">=</span>&nbsp;<span class="num" id="8028833">10000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8028840">c</span>&nbsp;<span class="op" id="8028842">:=</span>&nbsp;<span class="builtinfunc" id="8028845">make</span><span class="op" id="8028849">(</span><span class="keyword" id="8028850">chan</span>&nbsp;<span class="builtintype" id="8028855">int</span><span class="op" id="8028858">,</span>&nbsp;<span class="ident" id="8028860">N</span><span class="op" id="8028861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8028864">for</span>&nbsp;<span class="ident" id="8028868">i</span>&nbsp;<span class="op" id="8028870">:=</span>&nbsp;<span class="num" id="8028873">0</span><span class="op" id="8028874">;</span>&nbsp;<span class="ident" id="8028876">i</span>&nbsp;<span class="op" id="8028878">&lt;</span>&nbsp;<span class="ident" id="8028880">N</span><span class="op" id="8028881">;</span>&nbsp;<span class="ident" id="8028883">i</span><span class="op" id="8028884">++</span>&nbsp;<span class="op" id="8028887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8028891">go</span>&nbsp;<span class="keyword" id="8028894">func</span><span class="op" id="8028898">(</span><span class="ident" id="8028899">i</span>&nbsp;<span class="builtintype" id="8028901">int</span><span class="op" id="8028904">)</span>&nbsp;<span class="op" id="8028906">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8028911">LookupIP</span><span class="op" id="8028919">(</span><span class="ident" id="8028920">fmt</span><span class="op" id="8028923">.</span><span class="ident" id="8028924">Sprintf</span><span class="op" id="8028931">(</span><span class="string" id="8028932">&#34;%d.net-test.golang.org&#34;</span><span class="op" id="8028956">,</span>&nbsp;<span class="ident" id="8028958">i</span><span class="op" id="8028959">)</span><span class="op" id="8028960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8028965">c</span>&nbsp;<span class="op" id="8028967">&lt;-</span>&nbsp;<span class="num" id="8028970">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8028974">}</span><span class="op" id="8028975">(</span><span class="ident" id="8028976">i</span><span class="op" id="8028977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8028980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8028983">//&nbsp;Don&#39;t&nbsp;bother&nbsp;waiting&nbsp;for&nbsp;the&nbsp;stragglers;&nbsp;stop&nbsp;at&nbsp;0.9&nbsp;N.</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8029043">for</span>&nbsp;<span class="ident" id="8029047">i</span>&nbsp;<span class="op" id="8029049">:=</span>&nbsp;<span class="num" id="8029052">0</span><span class="op" id="8029053">;</span>&nbsp;<span class="ident" id="8029055">i</span>&nbsp;<span class="op" id="8029057">&lt;</span>&nbsp;<span class="ident" id="8029059">N</span><span class="op" id="8029060">*</span><span class="num" id="8029061">9</span><span class="op" id="8029062">/</span><span class="num" id="8029063">10</span><span class="op" id="8029065">;</span>&nbsp;<span class="ident" id="8029067">i</span><span class="op" id="8029068">++</span>&nbsp;<span class="op" id="8029071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8029075">if</span>&nbsp;<span class="ident" id="8029078">i</span><span class="op" id="8029079">%</span><span class="num" id="8029080">100</span>&nbsp;<span class="op" id="8029084">==</span>&nbsp;<span class="num" id="8029087">0</span>&nbsp;<span class="op" id="8029089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8029094">//println(&#34;TestDNSThreadLimit:&#34;,&nbsp;i)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8029132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8029136">&lt;-</span><span class="ident" id="8029138">c</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8029141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8029145">//&nbsp;If&nbsp;we&#39;re&nbsp;still&nbsp;here,&nbsp;it&nbsp;worked.</span><br>
<span class="lineno"></span><span class="op" id="8029180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="8029183">func</span>&nbsp;<span class="ident" id="8029188">TestLookupIPDeadline</span><span class="op" id="8029208">(</span><span class="ident" id="8029209">t</span>&nbsp;<span class="op" id="8029211">*</span><span class="ident" id="8029212">testing</span><span class="op" id="8029219">.</span><span class="ident" id="8029220">T</span><span class="op" id="8029221">)</span>&nbsp;<span class="op" id="8029223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8029226">if</span>&nbsp;<span class="op" id="8029229">!</span><span class="op" id="8029230">*</span><span class="ident" id="8029231">testDNSFlood</span>&nbsp;<span class="op" id="8029244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029248">t</span><span class="op" id="8029249">.</span><span class="ident" id="8029250">Skip</span><span class="op" id="8029254">(</span><span class="string" id="8029255">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-dnsflood&nbsp;to&nbsp;enable&#34;</span><span class="op" id="8029295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8029298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8029302">const</span>&nbsp;<span class="ident" id="8029308">N</span>&nbsp;<span class="op" id="8029310">=</span>&nbsp;<span class="num" id="8029312">5000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8029318">const</span>&nbsp;<span class="ident" id="8029324">timeout</span>&nbsp;<span class="op" id="8029332">=</span>&nbsp;<span class="num" id="8029334">3</span>&nbsp;<span class="op" id="8029336">*</span>&nbsp;<span class="ident" id="8029338">time</span><span class="op" id="8029342">.</span><span class="ident" id="8029343">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029351">c</span>&nbsp;<span class="op" id="8029353">:=</span>&nbsp;<span class="builtinfunc" id="8029356">make</span><span class="op" id="8029360">(</span><span class="keyword" id="8029361">chan</span>&nbsp;<span class="builtintype" id="8029366">error</span><span class="op" id="8029371">,</span>&nbsp;<span class="num" id="8029373">2</span><span class="op" id="8029374">*</span><span class="ident" id="8029375">N</span><span class="op" id="8029376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8029379">for</span>&nbsp;<span class="ident" id="8029383">i</span>&nbsp;<span class="op" id="8029385">:=</span>&nbsp;<span class="num" id="8029388">0</span><span class="op" id="8029389">;</span>&nbsp;<span class="ident" id="8029391">i</span>&nbsp;<span class="op" id="8029393">&lt;</span>&nbsp;<span class="ident" id="8029395">N</span><span class="op" id="8029396">;</span>&nbsp;<span class="ident" id="8029398">i</span><span class="op" id="8029399">++</span>&nbsp;<span class="op" id="8029402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029406">name</span>&nbsp;<span class="op" id="8029411">:=</span>&nbsp;<span class="ident" id="8029414">fmt</span><span class="op" id="8029417">.</span><span class="ident" id="8029418">Sprintf</span><span class="op" id="8029425">(</span><span class="string" id="8029426">&#34;%d.net-test.golang.org&#34;</span><span class="op" id="8029450">,</span>&nbsp;<span class="ident" id="8029452">i</span><span class="op" id="8029453">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8029457">go</span>&nbsp;<span class="keyword" id="8029460">func</span><span class="op" id="8029464">(</span><span class="op" id="8029465">)</span>&nbsp;<span class="op" id="8029467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029472">_</span><span class="op" id="8029473">,</span>&nbsp;<span class="ident" id="8029475">err</span>&nbsp;<span class="op" id="8029479">:=</span>&nbsp;<span class="ident" id="8029482">lookupIPDeadline</span><span class="op" id="8029498">(</span><span class="ident" id="8029499">name</span><span class="op" id="8029503">,</span>&nbsp;<span class="ident" id="8029505">time</span><span class="op" id="8029509">.</span><span class="ident" id="8029510">Now</span><span class="op" id="8029513">(</span><span class="op" id="8029514">)</span><span class="op" id="8029515">.</span><span class="ident" id="8029516">Add</span><span class="op" id="8029519">(</span><span class="ident" id="8029520">timeout</span><span class="op" id="8029527">/</span><span class="num" id="8029528">2</span><span class="op" id="8029529">)</span><span class="op" id="8029530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029535">c</span>&nbsp;<span class="op" id="8029537">&lt;-</span>&nbsp;<span class="ident" id="8029540">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8029546">}</span><span class="op" id="8029547">(</span><span class="op" id="8029548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8029552">go</span>&nbsp;<span class="keyword" id="8029555">func</span><span class="op" id="8029559">(</span><span class="op" id="8029560">)</span>&nbsp;<span class="op" id="8029562">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029567">_</span><span class="op" id="8029568">,</span>&nbsp;<span class="ident" id="8029570">err</span>&nbsp;<span class="op" id="8029574">:=</span>&nbsp;<span class="ident" id="8029577">lookupIPDeadline</span><span class="op" id="8029593">(</span><span class="ident" id="8029594">name</span><span class="op" id="8029598">,</span>&nbsp;<span class="ident" id="8029600">time</span><span class="op" id="8029604">.</span><span class="ident" id="8029605">Now</span><span class="op" id="8029608">(</span><span class="op" id="8029609">)</span><span class="op" id="8029610">.</span><span class="ident" id="8029611">Add</span><span class="op" id="8029614">(</span><span class="ident" id="8029615">timeout</span><span class="op" id="8029622">)</span><span class="op" id="8029623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029628">c</span>&nbsp;<span class="op" id="8029630">&lt;-</span>&nbsp;<span class="ident" id="8029633">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8029639">}</span><span class="op" id="8029640">(</span><span class="op" id="8029641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8029644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029647">qstats</span>&nbsp;<span class="op" id="8029654">:=</span>&nbsp;<span class="keyword" id="8029657">struct</span>&nbsp;<span class="op" id="8029664">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029668">succeeded</span><span class="op" id="8029677">,</span>&nbsp;<span class="ident" id="8029679">failed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8029694">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029700">timeout</span><span class="op" id="8029707">,</span>&nbsp;<span class="ident" id="8029709">temporary</span><span class="op" id="8029718">,</span>&nbsp;<span class="ident" id="8029720">other</span>&nbsp;<span class="builtintype" id="8029726">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029732">unknown</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8029758">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8029763">}</span><span class="op" id="8029764">{</span><span class="op" id="8029765">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029768">deadline</span>&nbsp;<span class="op" id="8029777">:=</span>&nbsp;<span class="ident" id="8029780">time</span><span class="op" id="8029784">.</span><span class="ident" id="8029785">After</span><span class="op" id="8029790">(</span><span class="ident" id="8029791">timeout</span>&nbsp;<span class="op" id="8029799">+</span>&nbsp;<span class="ident" id="8029801">time</span><span class="op" id="8029805">.</span><span class="ident" id="8029806">Second</span><span class="op" id="8029812">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8029815">for</span>&nbsp;<span class="ident" id="8029819">i</span>&nbsp;<span class="op" id="8029821">:=</span>&nbsp;<span class="num" id="8029824">0</span><span class="op" id="8029825">;</span>&nbsp;<span class="ident" id="8029827">i</span>&nbsp;<span class="op" id="8029829">&lt;</span>&nbsp;<span class="num" id="8029831">2</span><span class="op" id="8029832">*</span><span class="ident" id="8029833">N</span><span class="op" id="8029834">;</span>&nbsp;<span class="ident" id="8029836">i</span><span class="op" id="8029837">++</span>&nbsp;<span class="op" id="8029840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8029844">select</span>&nbsp;<span class="op" id="8029851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8029855">case</span>&nbsp;<span class="op" id="8029860">&lt;-</span><span class="ident" id="8029862">deadline</span><span class="op" id="8029870">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029875">t</span><span class="op" id="8029876">.</span><span class="ident" id="8029877">Fatal</span><span class="op" id="8029882">(</span><span class="string" id="8029883">&#34;deadline&nbsp;exceeded&#34;</span><span class="op" id="8029902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8029906">case</span>&nbsp;<span class="ident" id="8029911">err</span>&nbsp;<span class="op" id="8029915">:=</span>&nbsp;<span class="op" id="8029918">&lt;-</span><span class="ident" id="8029920">c</span><span class="op" id="8029921">:</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8029926">switch</span>&nbsp;<span class="ident" id="8029933">err</span>&nbsp;<span class="op" id="8029937">:=</span>&nbsp;<span class="ident" id="8029940">err</span><span class="op" id="8029943">.</span><span class="op" id="8029944">(</span><span class="keyword" id="8029945">type</span><span class="op" id="8029949">)</span>&nbsp;<span class="op" id="8029951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8029956">case</span>&nbsp;<span class="ident" id="8029961">nil</span><span class="op" id="8029964">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8029970">qstats</span><span class="op" id="8029976">.</span><span class="ident" id="8029977">succeeded</span><span class="op" id="8029986">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8029992">case</span>&nbsp;<span class="ident" id="8029997">Error</span><span class="op" id="8030002">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8030008">qstats</span><span class="op" id="8030014">.</span><span class="ident" id="8030015">failed</span><span class="op" id="8030021">++</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8030028">if</span>&nbsp;<span class="ident" id="8030031">err</span><span class="op" id="8030034">.</span><span class="ident" id="8030035">Timeout</span><span class="op" id="8030042">(</span><span class="op" id="8030043">)</span>&nbsp;<span class="op" id="8030045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8030052">qstats</span><span class="op" id="8030058">.</span><span class="ident" id="8030059">timeout</span><span class="op" id="8030066">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8030073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8030079">if</span>&nbsp;<span class="ident" id="8030082">err</span><span class="op" id="8030085">.</span><span class="ident" id="8030086">Temporary</span><span class="op" id="8030095">(</span><span class="op" id="8030096">)</span>&nbsp;<span class="op" id="8030098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8030105">qstats</span><span class="op" id="8030111">.</span><span class="ident" id="8030112">temporary</span><span class="op" id="8030121">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8030128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8030134">if</span>&nbsp;<span class="op" id="8030137">!</span><span class="ident" id="8030138">err</span><span class="op" id="8030141">.</span><span class="ident" id="8030142">Timeout</span><span class="op" id="8030149">(</span><span class="op" id="8030150">)</span>&nbsp;<span class="op" id="8030152">&amp;&amp;</span>&nbsp;<span class="op" id="8030155">!</span><span class="ident" id="8030156">err</span><span class="op" id="8030159">.</span><span class="ident" id="8030160">Temporary</span><span class="op" id="8030169">(</span><span class="op" id="8030170">)</span>&nbsp;<span class="op" id="8030172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8030179">qstats</span><span class="op" id="8030185">.</span><span class="ident" id="8030186">other</span><span class="op" id="8030191">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8030198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8030203">default</span><span class="op" id="8030210">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8030216">qstats</span><span class="op" id="8030222">.</span><span class="ident" id="8030223">failed</span><span class="op" id="8030229">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8030236">qstats</span><span class="op" id="8030242">.</span><span class="ident" id="8030243">unknown</span><span class="op" id="8030250">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8030256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8030260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8030263">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8030267">//&nbsp;A&nbsp;high&nbsp;volume&nbsp;of&nbsp;DNS&nbsp;queries&nbsp;for&nbsp;sub-domain&nbsp;of&nbsp;golang.org</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8030329">//&nbsp;would&nbsp;be&nbsp;coordinated&nbsp;by&nbsp;authoritative&nbsp;or&nbsp;recursive&nbsp;server,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8030392">//&nbsp;or&nbsp;stub&nbsp;resolver&nbsp;which&nbsp;implements&nbsp;query-response&nbsp;rate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8030450">//&nbsp;limitation,&nbsp;so&nbsp;we&nbsp;can&nbsp;expect&nbsp;some&nbsp;query&nbsp;successes&nbsp;and&nbsp;more</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8030513">//&nbsp;failures&nbsp;including&nbsp;timeout,&nbsp;temporary&nbsp;and&nbsp;other&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8030571">//&nbsp;As&nbsp;a&nbsp;rule,&nbsp;unknown&nbsp;must&nbsp;not&nbsp;be&nbsp;shown&nbsp;but&nbsp;it&nbsp;might&nbsp;possibly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8030634">//&nbsp;happen&nbsp;due&nbsp;to&nbsp;issue&nbsp;4856&nbsp;for&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8030672">t</span><span class="op" id="8030673">.</span><span class="ident" id="8030674">Logf</span><span class="op" id="8030678">(</span><span class="string" id="8030679">&#34;%v&nbsp;succeeded,&nbsp;%v&nbsp;failed&nbsp;(%v&nbsp;timeout,&nbsp;%v&nbsp;temporary,&nbsp;%v&nbsp;other,&nbsp;%v&nbsp;unknown)&#34;</span><span class="op" id="8030753">,</span>&nbsp;<span class="ident" id="8030755">qstats</span><span class="op" id="8030761">.</span><span class="ident" id="8030762">succeeded</span><span class="op" id="8030771">,</span>&nbsp;<span class="ident" id="8030773">qstats</span><span class="op" id="8030779">.</span><span class="ident" id="8030780">failed</span><span class="op" id="8030786">,</span>&nbsp;<span class="ident" id="8030788">qstats</span><span class="op" id="8030794">.</span><span class="ident" id="8030795">timeout</span><span class="op" id="8030802">,</span>&nbsp;<span class="ident" id="8030804">qstats</span><span class="op" id="8030810">.</span><span class="ident" id="8030811">temporary</span><span class="op" id="8030820">,</span>&nbsp;<span class="ident" id="8030822">qstats</span><span class="op" id="8030828">.</span><span class="ident" id="8030829">other</span><span class="op" id="8030834">,</span>&nbsp;<span class="ident" id="8030836">qstats</span><span class="op" id="8030842">.</span><span class="ident" id="8030843">unknown</span><span class="op" id="8030850">)</span><br>
<span class="lineno"></span><span class="op" id="8030852">}</span>
</div>
</body>
</html>
