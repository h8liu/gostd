<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/smtp</h2>
<ul>
<li><a href="/gostd/net/smtp/auth.go.html">auth.go</a></li>
<li><a href="/gostd/net/smtp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/smtp/smtp.go.html">smtp.go</a></li>
<li><a href="/gostd/net/smtp/smtp_test.go.html">smtp_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5650964">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5651019">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5651073">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5651124">//&nbsp;Package&nbsp;smtp&nbsp;implements&nbsp;the&nbsp;Simple&nbsp;Mail&nbsp;Transfer&nbsp;Protocol&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;5321.</span><br>
<span class="lineno"></span><span class="comment" id="5651209">//&nbsp;It&nbsp;also&nbsp;implements&nbsp;the&nbsp;following&nbsp;extensions:</span><br>
<span class="lineno"></span><span class="comment" id="5651257">//&nbsp;&nbsp;&nbsp;&nbsp8BITMIME&nbsp;&nbsp;RFC&nbsp;1652</span><br>
<span class="lineno"></span><span class="comment" id="5651279">//&nbsp;&nbsp;&nbsp;&nbspAUTH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RFC&nbsp;2554</span><br>
<span class="lineno"></span><span class="comment" id="5651301">//&nbsp;&nbsp;&nbsp;&nbspSTARTTLS&nbsp;&nbsp;RFC&nbsp;3207</span><br>
<span class="lineno">10</span><span class="comment" id="5651323">//&nbsp;Additional&nbsp;extensions&nbsp;may&nbsp;be&nbsp;handled&nbsp;by&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="5651375">package</span>&nbsp;<span class="ident" id="5651383">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5651389">import</span>&nbsp;<span class="op" id="5651396">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5651399">&#34;crypto/tls&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5651413">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5651432">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5651442">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5651448">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5651455">&#34;net/textproto&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5651472">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="5651482">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5651485">//&nbsp;A&nbsp;Client&nbsp;represents&nbsp;a&nbsp;client&nbsp;connection&nbsp;to&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="5651547">type</span>&nbsp;<span class="ident" id="5651552">Client</span>&nbsp;<span class="keyword" id="5651559">struct</span>&nbsp;<span class="op" id="5651566">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5651569">//&nbsp;Text&nbsp;is&nbsp;the&nbsp;textproto.Conn&nbsp;used&nbsp;by&nbsp;the&nbsp;Client.&nbsp;It&nbsp;is&nbsp;exported&nbsp;to&nbsp;allow&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5651648">//&nbsp;clients&nbsp;to&nbsp;add&nbsp;extensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5651679">Text</span>&nbsp;<span class="op" id="5651684">*</span><span class="ident" id="5651685">textproto</span><span class="op" id="5651694">.</span><span class="ident" id="5651695">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5651701">//&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;connection&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;a&nbsp;TLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5651774">//&nbsp;connection&nbsp;later</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5651795">conn</span>&nbsp;<span class="ident" id="5651800">net</span><span class="op" id="5651803">.</span><span class="ident" id="5651804">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5651810">//&nbsp;whether&nbsp;the&nbsp;Client&nbsp;is&nbsp;using&nbsp;TLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5651846">tls</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5651857">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5651863">serverName</span>&nbsp;<span class="builtintype" id="5651874">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5651882">//&nbsp;map&nbsp;of&nbsp;supported&nbsp;extensions</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5651914">ext</span>&nbsp;<span class="keyword" id="5651918">map</span><span class="op" id="5651921">[</span><span class="builtintype" id="5651922">string</span><span class="op" id="5651928">]</span><span class="builtintype" id="5651929">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5651937">//&nbsp;supported&nbsp;auth&nbsp;mechanisms</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5651967">auth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5651978">[</span><span class="op" id="5651979">]</span><span class="builtintype" id="5651980">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5651988">localName</span>&nbsp;&nbsp;<span class="builtintype" id="5651999">string</span>&nbsp;<span class="comment" id="5652006">//&nbsp;the&nbsp;name&nbsp;to&nbsp;use&nbsp;in&nbsp;HELO/EHLO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5652039">didHello</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5652050">bool</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5652057">//&nbsp;whether&nbsp;we&#39;ve&nbsp;said&nbsp;HELO/EHLO</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5652090">helloError</span>&nbsp;<span class="builtintype" id="5652101">error</span>&nbsp;&nbsp;<span class="comment" id="5652108">//&nbsp;the&nbsp;error&nbsp;from&nbsp;the&nbsp;hello</span><br>
<span class="lineno"></span><span class="op" id="5652136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5652139">//&nbsp;Dial&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;connected&nbsp;to&nbsp;an&nbsp;SMTP&nbsp;server&nbsp;at&nbsp;addr.</span><br>
<span class="lineno"></span><span class="comment" id="5652205">//&nbsp;The&nbsp;addr&nbsp;must&nbsp;include&nbsp;a&nbsp;port&nbsp;number.</span><br>
<span class="lineno">45</span><span class="keyword" id="5652245">func</span>&nbsp;<span class="ident" id="5652250">Dial</span><span class="op" id="5652254">(</span><span class="ident" id="5652255">addr</span>&nbsp;<span class="builtintype" id="5652260">string</span><span class="op" id="5652266">)</span>&nbsp;<span class="op" id="5652268">(</span><span class="op" id="5652269">*</span><span class="ident" id="5652270">Client</span><span class="op" id="5652276">,</span>&nbsp;<span class="builtintype" id="5652278">error</span><span class="op" id="5652283">)</span>&nbsp;<span class="op" id="5652285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5652288">conn</span><span class="op" id="5652292">,</span>&nbsp;<span class="ident" id="5652294">err</span>&nbsp;<span class="op" id="5652298">:=</span>&nbsp;<span class="ident" id="5652301">net</span><span class="op" id="5652304">.</span><span class="ident" id="5652305">Dial</span><span class="op" id="5652309">(</span><span class="string" id="5652310">&#34;tcp&#34;</span><span class="op" id="5652315">,</span>&nbsp;<span class="ident" id="5652317">addr</span><span class="op" id="5652321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652324">if</span>&nbsp;<span class="ident" id="5652327">err</span>&nbsp;<span class="op" id="5652331">!=</span>&nbsp;<span class="ident" id="5652334">nil</span>&nbsp;<span class="op" id="5652338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652342">return</span>&nbsp;<span class="ident" id="5652349">nil</span><span class="op" id="5652352">,</span>&nbsp;<span class="ident" id="5652354">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5652359">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5652362">host</span><span class="op" id="5652366">,</span>&nbsp;<span class="ident" id="5652368">_</span><span class="op" id="5652369">,</span>&nbsp;<span class="ident" id="5652371">_</span>&nbsp;<span class="op" id="5652373">:=</span>&nbsp;<span class="ident" id="5652376">net</span><span class="op" id="5652379">.</span><span class="ident" id="5652380">SplitHostPort</span><span class="op" id="5652393">(</span><span class="ident" id="5652394">addr</span><span class="op" id="5652398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652401">return</span>&nbsp;<span class="ident" id="5652408">NewClient</span><span class="op" id="5652417">(</span><span class="ident" id="5652418">conn</span><span class="op" id="5652422">,</span>&nbsp;<span class="ident" id="5652424">host</span><span class="op" id="5652428">)</span><br>
<span class="lineno"></span><span class="op" id="5652430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5652433">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;using&nbsp;an&nbsp;existing&nbsp;connection&nbsp;and&nbsp;host&nbsp;as&nbsp;a</span><br>
<span class="lineno">55</span><span class="comment" id="5652510">//&nbsp;server&nbsp;name&nbsp;to&nbsp;be&nbsp;used&nbsp;when&nbsp;authenticating.</span><br>
<span class="lineno"></span><span class="keyword" id="5652557">func</span>&nbsp;<span class="ident" id="5652562">NewClient</span><span class="op" id="5652571">(</span><span class="ident" id="5652572">conn</span>&nbsp;<span class="ident" id="5652577">net</span><span class="op" id="5652580">.</span><span class="ident" id="5652581">Conn</span><span class="op" id="5652585">,</span>&nbsp;<span class="ident" id="5652587">host</span>&nbsp;<span class="builtintype" id="5652592">string</span><span class="op" id="5652598">)</span>&nbsp;<span class="op" id="5652600">(</span><span class="op" id="5652601">*</span><span class="ident" id="5652602">Client</span><span class="op" id="5652608">,</span>&nbsp;<span class="builtintype" id="5652610">error</span><span class="op" id="5652615">)</span>&nbsp;<span class="op" id="5652617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5652620">text</span>&nbsp;<span class="op" id="5652625">:=</span>&nbsp;<span class="ident" id="5652628">textproto</span><span class="op" id="5652637">.</span><span class="ident" id="5652638">NewConn</span><span class="op" id="5652645">(</span><span class="ident" id="5652646">conn</span><span class="op" id="5652650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5652653">_</span><span class="op" id="5652654">,</span>&nbsp;<span class="ident" id="5652656">_</span><span class="op" id="5652657">,</span>&nbsp;<span class="ident" id="5652659">err</span>&nbsp;<span class="op" id="5652663">:=</span>&nbsp;<span class="ident" id="5652666">text</span><span class="op" id="5652670">.</span><span class="ident" id="5652671">ReadResponse</span><span class="op" id="5652683">(</span><span class="num" id="5652684">220</span><span class="op" id="5652687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652690">if</span>&nbsp;<span class="ident" id="5652693">err</span>&nbsp;<span class="op" id="5652697">!=</span>&nbsp;<span class="ident" id="5652700">nil</span>&nbsp;<span class="op" id="5652704">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5652708">text</span><span class="op" id="5652712">.</span><span class="ident" id="5652713">Close</span><span class="op" id="5652718">(</span><span class="op" id="5652719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652723">return</span>&nbsp;<span class="ident" id="5652730">nil</span><span class="op" id="5652733">,</span>&nbsp;<span class="ident" id="5652735">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5652740">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5652743">c</span>&nbsp;<span class="op" id="5652745">:=</span>&nbsp;<span class="op" id="5652748">&amp;</span><span class="ident" id="5652749">Client</span><span class="op" id="5652755">{</span><span class="ident" id="5652756">Text</span><span class="op" id="5652760">:</span>&nbsp;<span class="ident" id="5652762">text</span><span class="op" id="5652766">,</span>&nbsp;<span class="ident" id="5652768">conn</span><span class="op" id="5652772">:</span>&nbsp;<span class="ident" id="5652774">conn</span><span class="op" id="5652778">,</span>&nbsp;<span class="ident" id="5652780">serverName</span><span class="op" id="5652790">:</span>&nbsp;<span class="ident" id="5652792">host</span><span class="op" id="5652796">,</span>&nbsp;<span class="ident" id="5652798">localName</span><span class="op" id="5652807">:</span>&nbsp;<span class="string" id="5652809">&#34;localhost&#34;</span><span class="op" id="5652820">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652823">return</span>&nbsp;<span class="ident" id="5652830">c</span><span class="op" id="5652831">,</span>&nbsp;<span class="ident" id="5652833">nil</span><br>
<span class="lineno">65</span><span class="op" id="5652837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5652840">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="5652872">func</span>&nbsp;<span class="op" id="5652877">(</span><span class="ident" id="5652878">c</span>&nbsp;<span class="op" id="5652880">*</span><span class="ident" id="5652881">Client</span><span class="op" id="5652887">)</span>&nbsp;<span class="ident" id="5652889">Close</span><span class="op" id="5652894">(</span><span class="op" id="5652895">)</span>&nbsp;<span class="builtintype" id="5652897">error</span>&nbsp;<span class="op" id="5652903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5652906">return</span>&nbsp;<span class="ident" id="5652913">c</span><span class="op" id="5652914">.</span><span class="ident" id="5652915">Text</span><span class="op" id="5652919">.</span><span class="ident" id="5652920">Close</span><span class="op" id="5652925">(</span><span class="op" id="5652926">)</span><br>
<span class="lineno">70</span><span class="op" id="5652928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5652931">//&nbsp;hello&nbsp;runs&nbsp;a&nbsp;hello&nbsp;exchange&nbsp;if&nbsp;needed.</span><br>
<span class="lineno"></span><span class="keyword" id="5652973">func</span>&nbsp;<span class="op" id="5652978">(</span><span class="ident" id="5652979">c</span>&nbsp;<span class="op" id="5652981">*</span><span class="ident" id="5652982">Client</span><span class="op" id="5652988">)</span>&nbsp;<span class="ident" id="5652990">hello</span><span class="op" id="5652995">(</span><span class="op" id="5652996">)</span>&nbsp;<span class="builtintype" id="5652998">error</span>&nbsp;<span class="op" id="5653004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5653007">if</span>&nbsp;<span class="op" id="5653010">!</span><span class="ident" id="5653011">c</span><span class="op" id="5653012">.</span><span class="ident" id="5653013">didHello</span>&nbsp;<span class="op" id="5653022">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653026">c</span><span class="op" id="5653027">.</span><span class="ident" id="5653028">didHello</span>&nbsp;<span class="op" id="5653037">=</span>&nbsp;<span class="builtintype" id="5653039">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653046">err</span>&nbsp;<span class="op" id="5653050">:=</span>&nbsp;<span class="ident" id="5653053">c</span><span class="op" id="5653054">.</span><span class="ident" id="5653055">ehlo</span><span class="op" id="5653059">(</span><span class="op" id="5653060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5653064">if</span>&nbsp;<span class="ident" id="5653067">err</span>&nbsp;<span class="op" id="5653071">!=</span>&nbsp;<span class="ident" id="5653074">nil</span>&nbsp;<span class="op" id="5653078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653083">c</span><span class="op" id="5653084">.</span><span class="ident" id="5653085">helloError</span>&nbsp;<span class="op" id="5653096">=</span>&nbsp;<span class="ident" id="5653098">c</span><span class="op" id="5653099">.</span><span class="ident" id="5653100">helo</span><span class="op" id="5653104">(</span><span class="op" id="5653105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5653109">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5653112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5653115">return</span>&nbsp;<span class="ident" id="5653122">c</span><span class="op" id="5653123">.</span><span class="ident" id="5653124">helloError</span><br>
<span class="lineno"></span><span class="op" id="5653135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5653138">//&nbsp;Hello&nbsp;sends&nbsp;a&nbsp;HELO&nbsp;or&nbsp;EHLO&nbsp;to&nbsp;the&nbsp;server&nbsp;as&nbsp;the&nbsp;given&nbsp;host&nbsp;name.</span><br>
<span class="lineno">85</span><span class="comment" id="5653206">//&nbsp;Calling&nbsp;this&nbsp;method&nbsp;is&nbsp;only&nbsp;necessary&nbsp;if&nbsp;the&nbsp;client&nbsp;needs&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="5653275">//&nbsp;over&nbsp;the&nbsp;host&nbsp;name&nbsp;used.&nbsp;&nbsp;The&nbsp;client&nbsp;will&nbsp;introduce&nbsp;itself&nbsp;as&nbsp;&#34;localhost&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5653352">//&nbsp;automatically&nbsp;otherwise.&nbsp;&nbsp;If&nbsp;Hello&nbsp;is&nbsp;called,&nbsp;it&nbsp;must&nbsp;be&nbsp;called&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="5653426">//&nbsp;any&nbsp;of&nbsp;the&nbsp;other&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="5653455">func</span>&nbsp;<span class="op" id="5653460">(</span><span class="ident" id="5653461">c</span>&nbsp;<span class="op" id="5653463">*</span><span class="ident" id="5653464">Client</span><span class="op" id="5653470">)</span>&nbsp;<span class="ident" id="5653472">Hello</span><span class="op" id="5653477">(</span><span class="ident" id="5653478">localName</span>&nbsp;<span class="builtintype" id="5653488">string</span><span class="op" id="5653494">)</span>&nbsp;<span class="builtintype" id="5653496">error</span>&nbsp;<span class="op" id="5653502">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5653505">if</span>&nbsp;<span class="ident" id="5653508">c</span><span class="op" id="5653509">.</span><span class="ident" id="5653510">didHello</span>&nbsp;<span class="op" id="5653519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5653523">return</span>&nbsp;<span class="ident" id="5653530">errors</span><span class="op" id="5653536">.</span><span class="ident" id="5653537">New</span><span class="op" id="5653540">(</span><span class="string" id="5653541">&#34;smtp:&nbsp;Hello&nbsp;called&nbsp;after&nbsp;other&nbsp;methods&#34;</span><span class="op" id="5653581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5653584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653587">c</span><span class="op" id="5653588">.</span><span class="ident" id="5653589">localName</span>&nbsp;<span class="op" id="5653599">=</span>&nbsp;<span class="ident" id="5653601">localName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5653612">return</span>&nbsp;<span class="ident" id="5653619">c</span><span class="op" id="5653620">.</span><span class="ident" id="5653621">hello</span><span class="op" id="5653626">(</span><span class="op" id="5653627">)</span><br>
<span class="lineno">95</span><span class="op" id="5653629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5653632">//&nbsp;cmd&nbsp;is&nbsp;a&nbsp;convenience&nbsp;function&nbsp;that&nbsp;sends&nbsp;a&nbsp;command&nbsp;and&nbsp;returns&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span><span class="keyword" id="5653711">func</span>&nbsp;<span class="op" id="5653716">(</span><span class="ident" id="5653717">c</span>&nbsp;<span class="op" id="5653719">*</span><span class="ident" id="5653720">Client</span><span class="op" id="5653726">)</span>&nbsp;<span class="ident" id="5653728">cmd</span><span class="op" id="5653731">(</span><span class="ident" id="5653732">expectCode</span>&nbsp;<span class="builtintype" id="5653743">int</span><span class="op" id="5653746">,</span>&nbsp;<span class="ident" id="5653748">format</span>&nbsp;<span class="builtintype" id="5653755">string</span><span class="op" id="5653761">,</span>&nbsp;<span class="ident" id="5653763">args</span>&nbsp;<span class="op" id="5653768">...</span><span class="keyword" id="5653771">interface</span><span class="op" id="5653780">{</span><span class="op" id="5653781">}</span><span class="op" id="5653782">)</span>&nbsp;<span class="op" id="5653784">(</span><span class="builtintype" id="5653785">int</span><span class="op" id="5653788">,</span>&nbsp;<span class="builtintype" id="5653790">string</span><span class="op" id="5653796">,</span>&nbsp;<span class="builtintype" id="5653798">error</span><span class="op" id="5653803">)</span>&nbsp;<span class="op" id="5653805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653808">id</span><span class="op" id="5653810">,</span>&nbsp;<span class="ident" id="5653812">err</span>&nbsp;<span class="op" id="5653816">:=</span>&nbsp;<span class="ident" id="5653819">c</span><span class="op" id="5653820">.</span><span class="ident" id="5653821">Text</span><span class="op" id="5653825">.</span><span class="ident" id="5653826">Cmd</span><span class="op" id="5653829">(</span><span class="ident" id="5653830">format</span><span class="op" id="5653836">,</span>&nbsp;<span class="ident" id="5653838">args</span><span class="op" id="5653842">...</span><span class="op" id="5653845">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5653848">if</span>&nbsp;<span class="ident" id="5653851">err</span>&nbsp;<span class="op" id="5653855">!=</span>&nbsp;<span class="ident" id="5653858">nil</span>&nbsp;<span class="op" id="5653862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5653866">return</span>&nbsp;<span class="num" id="5653873">0</span><span class="op" id="5653874">,</span>&nbsp;<span class="string" id="5653876">&#34;&#34;</span><span class="op" id="5653878">,</span>&nbsp;<span class="ident" id="5653880">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5653885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653888">c</span><span class="op" id="5653889">.</span><span class="ident" id="5653890">Text</span><span class="op" id="5653894">.</span><span class="ident" id="5653895">StartResponse</span><span class="op" id="5653908">(</span><span class="ident" id="5653909">id</span><span class="op" id="5653911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5653914">defer</span>&nbsp;<span class="ident" id="5653920">c</span><span class="op" id="5653921">.</span><span class="ident" id="5653922">Text</span><span class="op" id="5653926">.</span><span class="ident" id="5653927">EndResponse</span><span class="op" id="5653938">(</span><span class="ident" id="5653939">id</span><span class="op" id="5653941">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5653944">code</span><span class="op" id="5653948">,</span>&nbsp;<span class="ident" id="5653950">msg</span><span class="op" id="5653953">,</span>&nbsp;<span class="ident" id="5653955">err</span>&nbsp;<span class="op" id="5653959">:=</span>&nbsp;<span class="ident" id="5653962">c</span><span class="op" id="5653963">.</span><span class="ident" id="5653964">Text</span><span class="op" id="5653968">.</span><span class="ident" id="5653969">ReadResponse</span><span class="op" id="5653981">(</span><span class="ident" id="5653982">expectCode</span><span class="op" id="5653992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5653995">return</span>&nbsp;<span class="ident" id="5654002">code</span><span class="op" id="5654006">,</span>&nbsp;<span class="ident" id="5654008">msg</span><span class="op" id="5654011">,</span>&nbsp;<span class="ident" id="5654013">err</span><br>
<span class="lineno"></span><span class="op" id="5654017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5654020">//&nbsp;helo&nbsp;sends&nbsp;the&nbsp;HELO&nbsp;greeting&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;should&nbsp;be&nbsp;used&nbsp;only&nbsp;when&nbsp;the</span><br>
<span class="lineno">110</span><span class="comment" id="5654099">//&nbsp;server&nbsp;does&nbsp;not&nbsp;support&nbsp;ehlo.</span><br>
<span class="lineno"></span><span class="keyword" id="5654132">func</span>&nbsp;<span class="op" id="5654137">(</span><span class="ident" id="5654138">c</span>&nbsp;<span class="op" id="5654140">*</span><span class="ident" id="5654141">Client</span><span class="op" id="5654147">)</span>&nbsp;<span class="ident" id="5654149">helo</span><span class="op" id="5654153">(</span><span class="op" id="5654154">)</span>&nbsp;<span class="builtintype" id="5654156">error</span>&nbsp;<span class="op" id="5654162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5654165">c</span><span class="op" id="5654166">.</span><span class="ident" id="5654167">ext</span>&nbsp;<span class="op" id="5654171">=</span>&nbsp;<span class="ident" id="5654173">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5654178">_</span><span class="op" id="5654179">,</span>&nbsp;<span class="ident" id="5654181">_</span><span class="op" id="5654182">,</span>&nbsp;<span class="ident" id="5654184">err</span>&nbsp;<span class="op" id="5654188">:=</span>&nbsp;<span class="ident" id="5654191">c</span><span class="op" id="5654192">.</span><span class="ident" id="5654193">cmd</span><span class="op" id="5654196">(</span><span class="num" id="5654197">250</span><span class="op" id="5654200">,</span>&nbsp;<span class="string" id="5654202">&#34;HELO&nbsp;%s&#34;</span><span class="op" id="5654211">,</span>&nbsp;<span class="ident" id="5654213">c</span><span class="op" id="5654214">.</span><span class="ident" id="5654215">localName</span><span class="op" id="5654224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5654227">return</span>&nbsp;<span class="ident" id="5654234">err</span><br>
<span class="lineno">115</span><span class="op" id="5654238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5654241">//&nbsp;ehlo&nbsp;sends&nbsp;the&nbsp;EHLO&nbsp;(extended&nbsp;hello)&nbsp;greeting&nbsp;to&nbsp;the&nbsp;server.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="5654308">//&nbsp;should&nbsp;be&nbsp;the&nbsp;preferred&nbsp;greeting&nbsp;for&nbsp;servers&nbsp;that&nbsp;support&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="5654373">func</span>&nbsp;<span class="op" id="5654378">(</span><span class="ident" id="5654379">c</span>&nbsp;<span class="op" id="5654381">*</span><span class="ident" id="5654382">Client</span><span class="op" id="5654388">)</span>&nbsp;<span class="ident" id="5654390">ehlo</span><span class="op" id="5654394">(</span><span class="op" id="5654395">)</span>&nbsp;<span class="builtintype" id="5654397">error</span>&nbsp;<span class="op" id="5654403">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5654406">_</span><span class="op" id="5654407">,</span>&nbsp;<span class="ident" id="5654409">msg</span><span class="op" id="5654412">,</span>&nbsp;<span class="ident" id="5654414">err</span>&nbsp;<span class="op" id="5654418">:=</span>&nbsp;<span class="ident" id="5654421">c</span><span class="op" id="5654422">.</span><span class="ident" id="5654423">cmd</span><span class="op" id="5654426">(</span><span class="num" id="5654427">250</span><span class="op" id="5654430">,</span>&nbsp;<span class="string" id="5654432">&#34;EHLO&nbsp;%s&#34;</span><span class="op" id="5654441">,</span>&nbsp;<span class="ident" id="5654443">c</span><span class="op" id="5654444">.</span><span class="ident" id="5654445">localName</span><span class="op" id="5654454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5654457">if</span>&nbsp;<span class="ident" id="5654460">err</span>&nbsp;<span class="op" id="5654464">!=</span>&nbsp;<span class="ident" id="5654467">nil</span>&nbsp;<span class="op" id="5654471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5654475">return</span>&nbsp;<span class="ident" id="5654482">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5654487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5654490">ext</span>&nbsp;<span class="op" id="5654494">:=</span>&nbsp;<span class="builtinfunc" id="5654497">make</span><span class="op" id="5654501">(</span><span class="keyword" id="5654502">map</span><span class="op" id="5654505">[</span><span class="builtintype" id="5654506">string</span><span class="op" id="5654512">]</span><span class="builtintype" id="5654513">string</span><span class="op" id="5654519">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5654522">extList</span>&nbsp;<span class="op" id="5654530">:=</span>&nbsp;<span class="ident" id="5654533">strings</span><span class="op" id="5654540">.</span><span class="ident" id="5654541">Split</span><span class="op" id="5654546">(</span><span class="ident" id="5654547">msg</span><span class="op" id="5654550">,</span>&nbsp;<span class="string" id="5654552">&#34;\n&#34;</span><span class="op" id="5654556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5654559">if</span>&nbsp;<span class="builtinfunc" id="5654562">len</span><span class="op" id="5654565">(</span><span class="ident" id="5654566">extList</span><span class="op" id="5654573">)</span>&nbsp;<span class="op" id="5654575">&gt;</span>&nbsp;<span class="num" id="5654577">1</span>&nbsp;<span class="op" id="5654579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5654583">extList</span>&nbsp;<span class="op" id="5654591">=</span>&nbsp;<span class="ident" id="5654593">extList</span><span class="op" id="5654600">[</span><span class="num" id="5654601">1</span><span class="op" id="5654602">:</span><span class="op" id="5654603">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5654607">for</span>&nbsp;<span class="ident" id="5654611">_</span><span class="op" id="5654612">,</span>&nbsp;<span class="ident" id="5654614">line</span>&nbsp;<span class="op" id="5654619">:=</span>&nbsp;<span class="keyword" id="5654622">range</span>&nbsp;<span class="ident" id="5654628">extList</span>&nbsp;<span class="op" id="5654636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5654641">args</span>&nbsp;<span class="op" id="5654646">:=</span>&nbsp;<span class="ident" id="5654649">strings</span><span class="op" id="5654656">.</span><span class="ident" id="5654657">SplitN</span><span class="op" id="5654663">(</span><span class="ident" id="5654664">line</span><span class="op" id="5654668">,</span>&nbsp;<span class="string" id="5654670">&#34;&nbsp;&#34;</span><span class="op" id="5654673">,</span>&nbsp;<span class="num" id="5654675">2</span><span class="op" id="5654676">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5654681">if</span>&nbsp;<span class="builtinfunc" id="5654684">len</span><span class="op" id="5654687">(</span><span class="ident" id="5654688">args</span><span class="op" id="5654692">)</span>&nbsp;<span class="op" id="5654694">&gt;</span>&nbsp;<span class="num" id="5654696">1</span>&nbsp;<span class="op" id="5654698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5654704">ext</span><span class="op" id="5654707">[</span><span class="ident" id="5654708">args</span><span class="op" id="5654712">[</span><span class="num" id="5654713">0</span><span class="op" id="5654714">]</span><span class="op" id="5654715">]</span>&nbsp;<span class="op" id="5654717">=</span>&nbsp;<span class="ident" id="5654719">args</span><span class="op" id="5654723">[</span><span class="num" id="5654724">1</span><span class="op" id="5654725">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5654730">}</span>&nbsp;<span class="keyword" id="5654732">else</span>&nbsp;<span class="op" id="5654737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5654743">ext</span><span class="op" id="5654746">[</span><span class="ident" id="5654747">args</span><span class="op" id="5654751">[</span><span class="num" id="5654752">0</span><span class="op" id="5654753">]</span><span class="op" id="5654754">]</span>&nbsp;<span class="op" id="5654756">=</span>&nbsp;<span class="string" id="5654758">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5654764">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5654768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5654771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5654774">if</span>&nbsp;<span class="ident" id="5654777">mechs</span><span class="op" id="5654782">,</span>&nbsp;<span class="ident" id="5654784">ok</span>&nbsp;<span class="op" id="5654787">:=</span>&nbsp;<span class="ident" id="5654790">ext</span><span class="op" id="5654793">[</span><span class="string" id="5654794">&#34;AUTH&#34;</span><span class="op" id="5654800">]</span><span class="op" id="5654801">;</span>&nbsp;<span class="ident" id="5654803">ok</span>&nbsp;<span class="op" id="5654806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5654810">c</span><span class="op" id="5654811">.</span><span class="ident" id="5654812">auth</span>&nbsp;<span class="op" id="5654817">=</span>&nbsp;<span class="ident" id="5654819">strings</span><span class="op" id="5654826">.</span><span class="ident" id="5654827">Split</span><span class="op" id="5654832">(</span><span class="ident" id="5654833">mechs</span><span class="op" id="5654838">,</span>&nbsp;<span class="string" id="5654840">&#34;&nbsp;&#34;</span><span class="op" id="5654843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5654846">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5654849">c</span><span class="op" id="5654850">.</span><span class="ident" id="5654851">ext</span>&nbsp;<span class="op" id="5654855">=</span>&nbsp;<span class="ident" id="5654857">ext</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5654862">return</span>&nbsp;<span class="ident" id="5654869">err</span><br>
<span class="lineno"></span><span class="op" id="5654873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5654876">//&nbsp;StartTLS&nbsp;sends&nbsp;the&nbsp;STARTTLS&nbsp;command&nbsp;and&nbsp;encrypts&nbsp;all&nbsp;further&nbsp;communication.</span><br>
<span class="lineno">145</span><span class="comment" id="5654955">//&nbsp;Only&nbsp;servers&nbsp;that&nbsp;advertise&nbsp;the&nbsp;STARTTLS&nbsp;extension&nbsp;support&nbsp;this&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="5655032">func</span>&nbsp;<span class="op" id="5655037">(</span><span class="ident" id="5655038">c</span>&nbsp;<span class="op" id="5655040">*</span><span class="ident" id="5655041">Client</span><span class="op" id="5655047">)</span>&nbsp;<span class="ident" id="5655049">StartTLS</span><span class="op" id="5655057">(</span><span class="ident" id="5655058">config</span>&nbsp;<span class="op" id="5655065">*</span><span class="ident" id="5655066">tls</span><span class="op" id="5655069">.</span><span class="ident" id="5655070">Config</span><span class="op" id="5655076">)</span>&nbsp;<span class="builtintype" id="5655078">error</span>&nbsp;<span class="op" id="5655084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5655087">if</span>&nbsp;<span class="ident" id="5655090">err</span>&nbsp;<span class="op" id="5655094">:=</span>&nbsp;<span class="ident" id="5655097">c</span><span class="op" id="5655098">.</span><span class="ident" id="5655099">hello</span><span class="op" id="5655104">(</span><span class="op" id="5655105">)</span><span class="op" id="5655106">;</span>&nbsp;<span class="ident" id="5655108">err</span>&nbsp;<span class="op" id="5655112">!=</span>&nbsp;<span class="ident" id="5655115">nil</span>&nbsp;<span class="op" id="5655119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5655123">return</span>&nbsp;<span class="ident" id="5655130">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5655135">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5655138">_</span><span class="op" id="5655139">,</span>&nbsp;<span class="ident" id="5655141">_</span><span class="op" id="5655142">,</span>&nbsp;<span class="ident" id="5655144">err</span>&nbsp;<span class="op" id="5655148">:=</span>&nbsp;<span class="ident" id="5655151">c</span><span class="op" id="5655152">.</span><span class="ident" id="5655153">cmd</span><span class="op" id="5655156">(</span><span class="num" id="5655157">220</span><span class="op" id="5655160">,</span>&nbsp;<span class="string" id="5655162">&#34;STARTTLS&#34;</span><span class="op" id="5655172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5655175">if</span>&nbsp;<span class="ident" id="5655178">err</span>&nbsp;<span class="op" id="5655182">!=</span>&nbsp;<span class="ident" id="5655185">nil</span>&nbsp;<span class="op" id="5655189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5655193">return</span>&nbsp;<span class="ident" id="5655200">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5655205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5655208">c</span><span class="op" id="5655209">.</span><span class="ident" id="5655210">conn</span>&nbsp;<span class="op" id="5655215">=</span>&nbsp;<span class="ident" id="5655217">tls</span><span class="op" id="5655220">.</span><span class="ident" id="5655221">Client</span><span class="op" id="5655227">(</span><span class="ident" id="5655228">c</span><span class="op" id="5655229">.</span><span class="ident" id="5655230">conn</span><span class="op" id="5655234">,</span>&nbsp;<span class="ident" id="5655236">config</span><span class="op" id="5655242">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5655245">c</span><span class="op" id="5655246">.</span><span class="ident" id="5655247">Text</span>&nbsp;<span class="op" id="5655252">=</span>&nbsp;<span class="ident" id="5655254">textproto</span><span class="op" id="5655263">.</span><span class="ident" id="5655264">NewConn</span><span class="op" id="5655271">(</span><span class="ident" id="5655272">c</span><span class="op" id="5655273">.</span><span class="ident" id="5655274">conn</span><span class="op" id="5655278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5655281">c</span><span class="op" id="5655282">.</span><span class="ident" id="5655283">tls</span>&nbsp;<span class="op" id="5655287">=</span>&nbsp;<span class="builtintype" id="5655289">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5655295">return</span>&nbsp;<span class="ident" id="5655302">c</span><span class="op" id="5655303">.</span><span class="ident" id="5655304">ehlo</span><span class="op" id="5655308">(</span><span class="op" id="5655309">)</span><br>
<span class="lineno"></span><span class="op" id="5655311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="5655314">//&nbsp;Verify&nbsp;checks&nbsp;the&nbsp;validity&nbsp;of&nbsp;an&nbsp;email&nbsp;address&nbsp;on&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="5655379">//&nbsp;If&nbsp;Verify&nbsp;returns&nbsp;nil,&nbsp;the&nbsp;address&nbsp;is&nbsp;valid.&nbsp;A&nbsp;non-nil&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="5655444">//&nbsp;does&nbsp;not&nbsp;necessarily&nbsp;indicate&nbsp;an&nbsp;invalid&nbsp;address.&nbsp;Many&nbsp;servers</span><br>
<span class="lineno"></span><span class="comment" id="5655510">//&nbsp;will&nbsp;not&nbsp;verify&nbsp;addresses&nbsp;for&nbsp;security&nbsp;reasons.</span><br>
<span class="lineno"></span><span class="keyword" id="5655561">func</span>&nbsp;<span class="op" id="5655566">(</span><span class="ident" id="5655567">c</span>&nbsp;<span class="op" id="5655569">*</span><span class="ident" id="5655570">Client</span><span class="op" id="5655576">)</span>&nbsp;<span class="ident" id="5655578">Verify</span><span class="op" id="5655584">(</span><span class="ident" id="5655585">addr</span>&nbsp;<span class="builtintype" id="5655590">string</span><span class="op" id="5655596">)</span>&nbsp;<span class="builtintype" id="5655598">error</span>&nbsp;<span class="op" id="5655604">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5655607">if</span>&nbsp;<span class="ident" id="5655610">err</span>&nbsp;<span class="op" id="5655614">:=</span>&nbsp;<span class="ident" id="5655617">c</span><span class="op" id="5655618">.</span><span class="ident" id="5655619">hello</span><span class="op" id="5655624">(</span><span class="op" id="5655625">)</span><span class="op" id="5655626">;</span>&nbsp;<span class="ident" id="5655628">err</span>&nbsp;<span class="op" id="5655632">!=</span>&nbsp;<span class="ident" id="5655635">nil</span>&nbsp;<span class="op" id="5655639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5655643">return</span>&nbsp;<span class="ident" id="5655650">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5655655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5655658">_</span><span class="op" id="5655659">,</span>&nbsp;<span class="ident" id="5655661">_</span><span class="op" id="5655662">,</span>&nbsp;<span class="ident" id="5655664">err</span>&nbsp;<span class="op" id="5655668">:=</span>&nbsp;<span class="ident" id="5655671">c</span><span class="op" id="5655672">.</span><span class="ident" id="5655673">cmd</span><span class="op" id="5655676">(</span><span class="num" id="5655677">250</span><span class="op" id="5655680">,</span>&nbsp;<span class="string" id="5655682">&#34;VRFY&nbsp;%s&#34;</span><span class="op" id="5655691">,</span>&nbsp;<span class="ident" id="5655693">addr</span><span class="op" id="5655697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5655700">return</span>&nbsp;<span class="ident" id="5655707">err</span><br>
<span class="lineno">170</span><span class="op" id="5655711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5655714">//&nbsp;Auth&nbsp;authenticates&nbsp;a&nbsp;client&nbsp;using&nbsp;the&nbsp;provided&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="comment" id="5655790">//&nbsp;A&nbsp;failed&nbsp;authentication&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="5655840">//&nbsp;Only&nbsp;servers&nbsp;that&nbsp;advertise&nbsp;the&nbsp;AUTH&nbsp;extension&nbsp;support&nbsp;this&nbsp;function.</span><br>
<span class="lineno">175</span><span class="keyword" id="5655913">func</span>&nbsp;<span class="op" id="5655918">(</span><span class="ident" id="5655919">c</span>&nbsp;<span class="op" id="5655921">*</span><span class="ident" id="5655922">Client</span><span class="op" id="5655928">)</span>&nbsp;<span class="ident" id="5655930">Auth</span><span class="op" id="5655934">(</span><span class="ident" id="5655935">a</span>&nbsp;<span class="ident" id="5655937">Auth</span><span class="op" id="5655941">)</span>&nbsp;<span class="builtintype" id="5655943">error</span>&nbsp;<span class="op" id="5655949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5655952">if</span>&nbsp;<span class="ident" id="5655955">err</span>&nbsp;<span class="op" id="5655959">:=</span>&nbsp;<span class="ident" id="5655962">c</span><span class="op" id="5655963">.</span><span class="ident" id="5655964">hello</span><span class="op" id="5655969">(</span><span class="op" id="5655970">)</span><span class="op" id="5655971">;</span>&nbsp;<span class="ident" id="5655973">err</span>&nbsp;<span class="op" id="5655977">!=</span>&nbsp;<span class="ident" id="5655980">nil</span>&nbsp;<span class="op" id="5655984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5655988">return</span>&nbsp;<span class="ident" id="5655995">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5656000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656003">encoding</span>&nbsp;<span class="op" id="5656012">:=</span>&nbsp;<span class="ident" id="5656015">base64</span><span class="op" id="5656021">.</span><span class="ident" id="5656022">StdEncoding</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656035">mech</span><span class="op" id="5656039">,</span>&nbsp;<span class="ident" id="5656041">resp</span><span class="op" id="5656045">,</span>&nbsp;<span class="ident" id="5656047">err</span>&nbsp;<span class="op" id="5656051">:=</span>&nbsp;<span class="ident" id="5656054">a</span><span class="op" id="5656055">.</span><span class="ident" id="5656056">Start</span><span class="op" id="5656061">(</span><span class="op" id="5656062">&amp;</span><span class="ident" id="5656063">ServerInfo</span><span class="op" id="5656073">{</span><span class="ident" id="5656074">c</span><span class="op" id="5656075">.</span><span class="ident" id="5656076">serverName</span><span class="op" id="5656086">,</span>&nbsp;<span class="ident" id="5656088">c</span><span class="op" id="5656089">.</span><span class="ident" id="5656090">tls</span><span class="op" id="5656093">,</span>&nbsp;<span class="ident" id="5656095">c</span><span class="op" id="5656096">.</span><span class="ident" id="5656097">auth</span><span class="op" id="5656101">}</span><span class="op" id="5656102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656105">if</span>&nbsp;<span class="ident" id="5656108">err</span>&nbsp;<span class="op" id="5656112">!=</span>&nbsp;<span class="ident" id="5656115">nil</span>&nbsp;<span class="op" id="5656119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656123">c</span><span class="op" id="5656124">.</span><span class="ident" id="5656125">Quit</span><span class="op" id="5656129">(</span><span class="op" id="5656130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656134">return</span>&nbsp;<span class="ident" id="5656141">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5656146">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656149">resp64</span>&nbsp;<span class="op" id="5656156">:=</span>&nbsp;<span class="builtinfunc" id="5656159">make</span><span class="op" id="5656163">(</span><span class="op" id="5656164">[</span><span class="op" id="5656165">]</span><span class="builtintype" id="5656166">byte</span><span class="op" id="5656170">,</span>&nbsp;<span class="ident" id="5656172">encoding</span><span class="op" id="5656180">.</span><span class="ident" id="5656181">EncodedLen</span><span class="op" id="5656191">(</span><span class="builtinfunc" id="5656192">len</span><span class="op" id="5656195">(</span><span class="ident" id="5656196">resp</span><span class="op" id="5656200">)</span><span class="op" id="5656201">)</span><span class="op" id="5656202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656205">encoding</span><span class="op" id="5656213">.</span><span class="ident" id="5656214">Encode</span><span class="op" id="5656220">(</span><span class="ident" id="5656221">resp64</span><span class="op" id="5656227">,</span>&nbsp;<span class="ident" id="5656229">resp</span><span class="op" id="5656233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656236">code</span><span class="op" id="5656240">,</span>&nbsp;<span class="ident" id="5656242">msg64</span><span class="op" id="5656247">,</span>&nbsp;<span class="ident" id="5656249">err</span>&nbsp;<span class="op" id="5656253">:=</span>&nbsp;<span class="ident" id="5656256">c</span><span class="op" id="5656257">.</span><span class="ident" id="5656258">cmd</span><span class="op" id="5656261">(</span><span class="num" id="5656262">0</span><span class="op" id="5656263">,</span>&nbsp;<span class="string" id="5656265">&#34;AUTH&nbsp;%s&nbsp;%s&#34;</span><span class="op" id="5656277">,</span>&nbsp;<span class="ident" id="5656279">mech</span><span class="op" id="5656283">,</span>&nbsp;<span class="ident" id="5656285">resp64</span><span class="op" id="5656291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656294">for</span>&nbsp;<span class="ident" id="5656298">err</span>&nbsp;<span class="op" id="5656302">==</span>&nbsp;<span class="ident" id="5656305">nil</span>&nbsp;<span class="op" id="5656309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656313">var</span>&nbsp;<span class="ident" id="5656317">msg</span>&nbsp;<span class="op" id="5656321">[</span><span class="op" id="5656322">]</span><span class="builtintype" id="5656323">byte</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656330">switch</span>&nbsp;<span class="ident" id="5656337">code</span>&nbsp;<span class="op" id="5656342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656346">case</span>&nbsp;<span class="num" id="5656351">334</span><span class="op" id="5656354">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656359">msg</span><span class="op" id="5656362">,</span>&nbsp;<span class="ident" id="5656364">err</span>&nbsp;<span class="op" id="5656368">=</span>&nbsp;<span class="ident" id="5656370">encoding</span><span class="op" id="5656378">.</span><span class="ident" id="5656379">DecodeString</span><span class="op" id="5656391">(</span><span class="ident" id="5656392">msg64</span><span class="op" id="5656397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656401">case</span>&nbsp;<span class="num" id="5656406">235</span><span class="op" id="5656409">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5656414">//&nbsp;the&nbsp;last&nbsp;message&nbsp;isn&#39;t&nbsp;base64&nbsp;because&nbsp;it&nbsp;isn&#39;t&nbsp;a&nbsp;challenge</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656479">msg</span>&nbsp;<span class="op" id="5656483">=</span>&nbsp;<span class="op" id="5656485">[</span><span class="op" id="5656486">]</span><span class="builtintype" id="5656487">byte</span><span class="op" id="5656491">(</span><span class="ident" id="5656492">msg64</span><span class="op" id="5656497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656501">default</span><span class="op" id="5656508">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656513">err</span>&nbsp;<span class="op" id="5656517">=</span>&nbsp;<span class="op" id="5656519">&amp;</span><span class="ident" id="5656520">textproto</span><span class="op" id="5656529">.</span><span class="ident" id="5656530">Error</span><span class="op" id="5656535">{</span><span class="ident" id="5656536">Code</span><span class="op" id="5656540">:</span>&nbsp;<span class="ident" id="5656542">code</span><span class="op" id="5656546">,</span>&nbsp;<span class="ident" id="5656548">Msg</span><span class="op" id="5656551">:</span>&nbsp;<span class="ident" id="5656553">msg64</span><span class="op" id="5656558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5656562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656566">if</span>&nbsp;<span class="ident" id="5656569">err</span>&nbsp;<span class="op" id="5656573">==</span>&nbsp;<span class="ident" id="5656576">nil</span>&nbsp;<span class="op" id="5656580">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656585">resp</span><span class="op" id="5656589">,</span>&nbsp;<span class="ident" id="5656591">err</span>&nbsp;<span class="op" id="5656595">=</span>&nbsp;<span class="ident" id="5656597">a</span><span class="op" id="5656598">.</span><span class="ident" id="5656599">Next</span><span class="op" id="5656603">(</span><span class="ident" id="5656604">msg</span><span class="op" id="5656607">,</span>&nbsp;<span class="ident" id="5656609">code</span>&nbsp;<span class="op" id="5656614">==</span>&nbsp;<span class="num" id="5656617">334</span><span class="op" id="5656620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5656624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656628">if</span>&nbsp;<span class="ident" id="5656631">err</span>&nbsp;<span class="op" id="5656635">!=</span>&nbsp;<span class="ident" id="5656638">nil</span>&nbsp;<span class="op" id="5656642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5656647">//&nbsp;abort&nbsp;the&nbsp;AUTH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656668">c</span><span class="op" id="5656669">.</span><span class="ident" id="5656670">cmd</span><span class="op" id="5656673">(</span><span class="num" id="5656674">501</span><span class="op" id="5656677">,</span>&nbsp;<span class="string" id="5656679">&#34;*&#34;</span><span class="op" id="5656682">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656687">c</span><span class="op" id="5656688">.</span><span class="ident" id="5656689">Quit</span><span class="op" id="5656693">(</span><span class="op" id="5656694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656699">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5656707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656711">if</span>&nbsp;<span class="ident" id="5656714">resp</span>&nbsp;<span class="op" id="5656719">==</span>&nbsp;<span class="ident" id="5656722">nil</span>&nbsp;<span class="op" id="5656726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656731">break</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5656739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656743">resp64</span>&nbsp;<span class="op" id="5656750">=</span>&nbsp;<span class="builtinfunc" id="5656752">make</span><span class="op" id="5656756">(</span><span class="op" id="5656757">[</span><span class="op" id="5656758">]</span><span class="builtintype" id="5656759">byte</span><span class="op" id="5656763">,</span>&nbsp;<span class="ident" id="5656765">encoding</span><span class="op" id="5656773">.</span><span class="ident" id="5656774">EncodedLen</span><span class="op" id="5656784">(</span><span class="builtinfunc" id="5656785">len</span><span class="op" id="5656788">(</span><span class="ident" id="5656789">resp</span><span class="op" id="5656793">)</span><span class="op" id="5656794">)</span><span class="op" id="5656795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656799">encoding</span><span class="op" id="5656807">.</span><span class="ident" id="5656808">Encode</span><span class="op" id="5656814">(</span><span class="ident" id="5656815">resp64</span><span class="op" id="5656821">,</span>&nbsp;<span class="ident" id="5656823">resp</span><span class="op" id="5656827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5656831">code</span><span class="op" id="5656835">,</span>&nbsp;<span class="ident" id="5656837">msg64</span><span class="op" id="5656842">,</span>&nbsp;<span class="ident" id="5656844">err</span>&nbsp;<span class="op" id="5656848">=</span>&nbsp;<span class="ident" id="5656850">c</span><span class="op" id="5656851">.</span><span class="ident" id="5656852">cmd</span><span class="op" id="5656855">(</span><span class="num" id="5656856">0</span><span class="op" id="5656857">,</span>&nbsp;<span class="builtintype" id="5656859">string</span><span class="op" id="5656865">(</span><span class="ident" id="5656866">resp64</span><span class="op" id="5656872">)</span><span class="op" id="5656873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5656876">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5656879">return</span>&nbsp;<span class="ident" id="5656886">err</span><br>
<span class="lineno"></span><span class="op" id="5656890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5656893">//&nbsp;Mail&nbsp;issues&nbsp;a&nbsp;MAIL&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;provided&nbsp;email&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="5656971">//&nbsp;If&nbsp;the&nbsp;server&nbsp;supports&nbsp;the&nbsp;8BITMIME&nbsp;extension,&nbsp;Mail&nbsp;adds&nbsp;the&nbsp;BODY=8BITMIME</span><br>
<span class="lineno">220</span><span class="comment" id="5657049">//&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="5657063">//&nbsp;This&nbsp;initiates&nbsp;a&nbsp;mail&nbsp;transaction&nbsp;and&nbsp;is&nbsp;followed&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;Rcpt&nbsp;calls.</span><br>
<span class="lineno"></span><span class="keyword" id="5657143">func</span>&nbsp;<span class="op" id="5657148">(</span><span class="ident" id="5657149">c</span>&nbsp;<span class="op" id="5657151">*</span><span class="ident" id="5657152">Client</span><span class="op" id="5657158">)</span>&nbsp;<span class="ident" id="5657160">Mail</span><span class="op" id="5657164">(</span><span class="ident" id="5657165">from</span>&nbsp;<span class="builtintype" id="5657170">string</span><span class="op" id="5657176">)</span>&nbsp;<span class="builtintype" id="5657178">error</span>&nbsp;<span class="op" id="5657184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657187">if</span>&nbsp;<span class="ident" id="5657190">err</span>&nbsp;<span class="op" id="5657194">:=</span>&nbsp;<span class="ident" id="5657197">c</span><span class="op" id="5657198">.</span><span class="ident" id="5657199">hello</span><span class="op" id="5657204">(</span><span class="op" id="5657205">)</span><span class="op" id="5657206">;</span>&nbsp;<span class="ident" id="5657208">err</span>&nbsp;<span class="op" id="5657212">!=</span>&nbsp;<span class="ident" id="5657215">nil</span>&nbsp;<span class="op" id="5657219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657223">return</span>&nbsp;<span class="ident" id="5657230">err</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5657235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5657238">cmdStr</span>&nbsp;<span class="op" id="5657245">:=</span>&nbsp;<span class="string" id="5657248">&#34;MAIL&nbsp;FROM:&lt;%s&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657266">if</span>&nbsp;<span class="ident" id="5657269">c</span><span class="op" id="5657270">.</span><span class="ident" id="5657271">ext</span>&nbsp;<span class="op" id="5657275">!=</span>&nbsp;<span class="ident" id="5657278">nil</span>&nbsp;<span class="op" id="5657282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657286">if</span>&nbsp;<span class="ident" id="5657289">_</span><span class="op" id="5657290">,</span>&nbsp;<span class="ident" id="5657292">ok</span>&nbsp;<span class="op" id="5657295">:=</span>&nbsp;<span class="ident" id="5657298">c</span><span class="op" id="5657299">.</span><span class="ident" id="5657300">ext</span><span class="op" id="5657303">[</span><span class="string" id="5657304">&#34;8BITMIME&#34;</span><span class="op" id="5657314">]</span><span class="op" id="5657315">;</span>&nbsp;<span class="ident" id="5657317">ok</span>&nbsp;<span class="op" id="5657320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5657325">cmdStr</span>&nbsp;<span class="op" id="5657332">+=</span>&nbsp;<span class="string" id="5657335">&#34;&nbsp;BODY=8BITMIME&#34;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5657354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5657357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5657360">_</span><span class="op" id="5657361">,</span>&nbsp;<span class="ident" id="5657363">_</span><span class="op" id="5657364">,</span>&nbsp;<span class="ident" id="5657366">err</span>&nbsp;<span class="op" id="5657370">:=</span>&nbsp;<span class="ident" id="5657373">c</span><span class="op" id="5657374">.</span><span class="ident" id="5657375">cmd</span><span class="op" id="5657378">(</span><span class="num" id="5657379">250</span><span class="op" id="5657382">,</span>&nbsp;<span class="ident" id="5657384">cmdStr</span><span class="op" id="5657390">,</span>&nbsp;<span class="ident" id="5657392">from</span><span class="op" id="5657396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657399">return</span>&nbsp;<span class="ident" id="5657406">err</span><br>
<span class="lineno"></span><span class="op" id="5657410">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="5657413">//&nbsp;Rcpt&nbsp;issues&nbsp;a&nbsp;RCPT&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;provided&nbsp;email&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="5657491">//&nbsp;A&nbsp;call&nbsp;to&nbsp;Rcpt&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Mail&nbsp;and&nbsp;may&nbsp;be&nbsp;followed&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="5657567">//&nbsp;a&nbsp;Data&nbsp;call&nbsp;or&nbsp;another&nbsp;Rcpt&nbsp;call.</span><br>
<span class="lineno"></span><span class="keyword" id="5657604">func</span>&nbsp;<span class="op" id="5657609">(</span><span class="ident" id="5657610">c</span>&nbsp;<span class="op" id="5657612">*</span><span class="ident" id="5657613">Client</span><span class="op" id="5657619">)</span>&nbsp;<span class="ident" id="5657621">Rcpt</span><span class="op" id="5657625">(</span><span class="ident" id="5657626">to</span>&nbsp;<span class="builtintype" id="5657629">string</span><span class="op" id="5657635">)</span>&nbsp;<span class="builtintype" id="5657637">error</span>&nbsp;<span class="op" id="5657643">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5657646">_</span><span class="op" id="5657647">,</span>&nbsp;<span class="ident" id="5657649">_</span><span class="op" id="5657650">,</span>&nbsp;<span class="ident" id="5657652">err</span>&nbsp;<span class="op" id="5657656">:=</span>&nbsp;<span class="ident" id="5657659">c</span><span class="op" id="5657660">.</span><span class="ident" id="5657661">cmd</span><span class="op" id="5657664">(</span><span class="num" id="5657665">25</span><span class="op" id="5657667">,</span>&nbsp;<span class="string" id="5657669">&#34;RCPT&nbsp;TO:&lt;%s&gt;&#34;</span><span class="op" id="5657683">,</span>&nbsp;<span class="ident" id="5657685">to</span><span class="op" id="5657687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657690">return</span>&nbsp;<span class="ident" id="5657697">err</span><br>
<span class="lineno"></span><span class="op" id="5657701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5657704">type</span>&nbsp;<span class="ident" id="5657709">dataCloser</span>&nbsp;<span class="keyword" id="5657720">struct</span>&nbsp;<span class="op" id="5657727">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5657730">c</span>&nbsp;<span class="op" id="5657732">*</span><span class="ident" id="5657733">Client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5657741">io</span><span class="op" id="5657743">.</span><span class="ident" id="5657744">WriteCloser</span><br>
<span class="lineno"></span><span class="op" id="5657756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5657759">func</span>&nbsp;<span class="op" id="5657764">(</span><span class="ident" id="5657765">d</span>&nbsp;<span class="op" id="5657767">*</span><span class="ident" id="5657768">dataCloser</span><span class="op" id="5657778">)</span>&nbsp;<span class="ident" id="5657780">Close</span><span class="op" id="5657785">(</span><span class="op" id="5657786">)</span>&nbsp;<span class="builtintype" id="5657788">error</span>&nbsp;<span class="op" id="5657794">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5657797">d</span><span class="op" id="5657798">.</span><span class="ident" id="5657799">WriteCloser</span><span class="op" id="5657810">.</span><span class="ident" id="5657811">Close</span><span class="op" id="5657816">(</span><span class="op" id="5657817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5657820">_</span><span class="op" id="5657821">,</span>&nbsp;<span class="ident" id="5657823">_</span><span class="op" id="5657824">,</span>&nbsp;<span class="ident" id="5657826">err</span>&nbsp;<span class="op" id="5657830">:=</span>&nbsp;<span class="ident" id="5657833">d</span><span class="op" id="5657834">.</span><span class="ident" id="5657835">c</span><span class="op" id="5657836">.</span><span class="ident" id="5657837">Text</span><span class="op" id="5657841">.</span><span class="ident" id="5657842">ReadResponse</span><span class="op" id="5657854">(</span><span class="num" id="5657855">250</span><span class="op" id="5657858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5657861">return</span>&nbsp;<span class="ident" id="5657868">err</span><br>
<span class="lineno"></span><span class="op" id="5657872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="5657875">//&nbsp;Data&nbsp;issues&nbsp;a&nbsp;DATA&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;and&nbsp;returns&nbsp;a&nbsp;writer&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5657945">//&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;write&nbsp;the&nbsp;data.&nbsp;The&nbsp;caller&nbsp;should&nbsp;close&nbsp;the&nbsp;writer</span><br>
<span class="lineno"></span><span class="comment" id="5658014">//&nbsp;before&nbsp;calling&nbsp;any&nbsp;more&nbsp;methods&nbsp;on&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="5658055">//&nbsp;A&nbsp;call&nbsp;to&nbsp;Data&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;calls&nbsp;to&nbsp;Rcpt.</span><br>
<span class="lineno"></span><span class="keyword" id="5658120">func</span>&nbsp;<span class="op" id="5658125">(</span><span class="ident" id="5658126">c</span>&nbsp;<span class="op" id="5658128">*</span><span class="ident" id="5658129">Client</span><span class="op" id="5658135">)</span>&nbsp;<span class="ident" id="5658137">Data</span><span class="op" id="5658141">(</span><span class="op" id="5658142">)</span>&nbsp;<span class="op" id="5658144">(</span><span class="ident" id="5658145">io</span><span class="op" id="5658147">.</span><span class="ident" id="5658148">WriteCloser</span><span class="op" id="5658159">,</span>&nbsp;<span class="builtintype" id="5658161">error</span><span class="op" id="5658166">)</span>&nbsp;<span class="op" id="5658168">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5658171">_</span><span class="op" id="5658172">,</span>&nbsp;<span class="ident" id="5658174">_</span><span class="op" id="5658175">,</span>&nbsp;<span class="ident" id="5658177">err</span>&nbsp;<span class="op" id="5658181">:=</span>&nbsp;<span class="ident" id="5658184">c</span><span class="op" id="5658185">.</span><span class="ident" id="5658186">cmd</span><span class="op" id="5658189">(</span><span class="num" id="5658190">354</span><span class="op" id="5658193">,</span>&nbsp;<span class="string" id="5658195">&#34;DATA&#34;</span><span class="op" id="5658201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658204">if</span>&nbsp;<span class="ident" id="5658207">err</span>&nbsp;<span class="op" id="5658211">!=</span>&nbsp;<span class="ident" id="5658214">nil</span>&nbsp;<span class="op" id="5658218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658222">return</span>&nbsp;<span class="ident" id="5658229">nil</span><span class="op" id="5658232">,</span>&nbsp;<span class="ident" id="5658234">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5658239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658242">return</span>&nbsp;<span class="op" id="5658249">&amp;</span><span class="ident" id="5658250">dataCloser</span><span class="op" id="5658260">{</span><span class="ident" id="5658261">c</span><span class="op" id="5658262">,</span>&nbsp;<span class="ident" id="5658264">c</span><span class="op" id="5658265">.</span><span class="ident" id="5658266">Text</span><span class="op" id="5658270">.</span><span class="ident" id="5658271">DotWriter</span><span class="op" id="5658280">(</span><span class="op" id="5658281">)</span><span class="op" id="5658282">}</span><span class="op" id="5658283">,</span>&nbsp;<span class="ident" id="5658285">nil</span><br>
<span class="lineno">265</span><span class="op" id="5658289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5658292">var</span>&nbsp;<span class="ident" id="5658296">testHookStartTLS</span>&nbsp;<span class="keyword" id="5658313">func</span><span class="op" id="5658317">(</span><span class="op" id="5658318">*</span><span class="ident" id="5658319">tls</span><span class="op" id="5658322">.</span><span class="ident" id="5658323">Config</span><span class="op" id="5658329">)</span>&nbsp;<span class="comment" id="5658331">//&nbsp;nil,&nbsp;except&nbsp;for&nbsp;tests</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5658357">//&nbsp;SendMail&nbsp;connects&nbsp;to&nbsp;the&nbsp;server&nbsp;at&nbsp;addr,&nbsp;switches&nbsp;to&nbsp;TLS&nbsp;if</span><br>
<span class="lineno">270</span><span class="comment" id="5658420">//&nbsp;possible,&nbsp;authenticates&nbsp;with&nbsp;the&nbsp;optional&nbsp;mechanism&nbsp;a&nbsp;if&nbsp;possible,</span><br>
<span class="lineno"></span><span class="comment" id="5658490">//&nbsp;and&nbsp;then&nbsp;sends&nbsp;an&nbsp;email&nbsp;from&nbsp;address&nbsp;from,&nbsp;to&nbsp;addresses&nbsp;to,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5658558">//&nbsp;message&nbsp;msg.</span><br>
<span class="lineno"></span><span class="keyword" id="5658574">func</span>&nbsp;<span class="ident" id="5658579">SendMail</span><span class="op" id="5658587">(</span><span class="ident" id="5658588">addr</span>&nbsp;<span class="builtintype" id="5658593">string</span><span class="op" id="5658599">,</span>&nbsp;<span class="ident" id="5658601">a</span>&nbsp;<span class="ident" id="5658603">Auth</span><span class="op" id="5658607">,</span>&nbsp;<span class="ident" id="5658609">from</span>&nbsp;<span class="builtintype" id="5658614">string</span><span class="op" id="5658620">,</span>&nbsp;<span class="ident" id="5658622">to</span>&nbsp;<span class="op" id="5658625">[</span><span class="op" id="5658626">]</span><span class="builtintype" id="5658627">string</span><span class="op" id="5658633">,</span>&nbsp;<span class="ident" id="5658635">msg</span>&nbsp;<span class="op" id="5658639">[</span><span class="op" id="5658640">]</span><span class="builtintype" id="5658641">byte</span><span class="op" id="5658645">)</span>&nbsp;<span class="builtintype" id="5658647">error</span>&nbsp;<span class="op" id="5658653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5658656">c</span><span class="op" id="5658657">,</span>&nbsp;<span class="ident" id="5658659">err</span>&nbsp;<span class="op" id="5658663">:=</span>&nbsp;<span class="ident" id="5658666">Dial</span><span class="op" id="5658670">(</span><span class="ident" id="5658671">addr</span><span class="op" id="5658675">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658678">if</span>&nbsp;<span class="ident" id="5658681">err</span>&nbsp;<span class="op" id="5658685">!=</span>&nbsp;<span class="ident" id="5658688">nil</span>&nbsp;<span class="op" id="5658692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658696">return</span>&nbsp;<span class="ident" id="5658703">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5658708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658711">defer</span>&nbsp;<span class="ident" id="5658717">c</span><span class="op" id="5658718">.</span><span class="ident" id="5658719">Close</span><span class="op" id="5658724">(</span><span class="op" id="5658725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658728">if</span>&nbsp;<span class="ident" id="5658731">err</span>&nbsp;<span class="op" id="5658735">=</span>&nbsp;<span class="ident" id="5658737">c</span><span class="op" id="5658738">.</span><span class="ident" id="5658739">hello</span><span class="op" id="5658744">(</span><span class="op" id="5658745">)</span><span class="op" id="5658746">;</span>&nbsp;<span class="ident" id="5658748">err</span>&nbsp;<span class="op" id="5658752">!=</span>&nbsp;<span class="ident" id="5658755">nil</span>&nbsp;<span class="op" id="5658759">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658763">return</span>&nbsp;<span class="ident" id="5658770">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5658775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658778">if</span>&nbsp;<span class="ident" id="5658781">ok</span><span class="op" id="5658783">,</span>&nbsp;<span class="ident" id="5658785">_</span>&nbsp;<span class="op" id="5658787">:=</span>&nbsp;<span class="ident" id="5658790">c</span><span class="op" id="5658791">.</span><span class="ident" id="5658792">Extension</span><span class="op" id="5658801">(</span><span class="string" id="5658802">&#34;STARTTLS&#34;</span><span class="op" id="5658812">)</span><span class="op" id="5658813">;</span>&nbsp;<span class="ident" id="5658815">ok</span>&nbsp;<span class="op" id="5658818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5658822">config</span>&nbsp;<span class="op" id="5658829">:=</span>&nbsp;<span class="op" id="5658832">&amp;</span><span class="ident" id="5658833">tls</span><span class="op" id="5658836">.</span><span class="ident" id="5658837">Config</span><span class="op" id="5658843">{</span><span class="ident" id="5658844">ServerName</span><span class="op" id="5658854">:</span>&nbsp;<span class="ident" id="5658856">c</span><span class="op" id="5658857">.</span><span class="ident" id="5658858">serverName</span><span class="op" id="5658868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658872">if</span>&nbsp;<span class="ident" id="5658875">testHookStartTLS</span>&nbsp;<span class="op" id="5658892">!=</span>&nbsp;<span class="ident" id="5658895">nil</span>&nbsp;<span class="op" id="5658899">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5658904">testHookStartTLS</span><span class="op" id="5658920">(</span><span class="ident" id="5658921">config</span><span class="op" id="5658927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5658931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658935">if</span>&nbsp;<span class="ident" id="5658938">err</span>&nbsp;<span class="op" id="5658942">=</span>&nbsp;<span class="ident" id="5658944">c</span><span class="op" id="5658945">.</span><span class="ident" id="5658946">StartTLS</span><span class="op" id="5658954">(</span><span class="ident" id="5658955">config</span><span class="op" id="5658961">)</span><span class="op" id="5658962">;</span>&nbsp;<span class="ident" id="5658964">err</span>&nbsp;<span class="op" id="5658968">!=</span>&nbsp;<span class="ident" id="5658971">nil</span>&nbsp;<span class="op" id="5658975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658980">return</span>&nbsp;<span class="ident" id="5658987">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5658993">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5658996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5658999">if</span>&nbsp;<span class="ident" id="5659002">a</span>&nbsp;<span class="op" id="5659004">!=</span>&nbsp;<span class="ident" id="5659007">nil</span>&nbsp;<span class="op" id="5659011">&amp;&amp;</span>&nbsp;<span class="ident" id="5659014">c</span><span class="op" id="5659015">.</span><span class="ident" id="5659016">ext</span>&nbsp;<span class="op" id="5659020">!=</span>&nbsp;<span class="ident" id="5659023">nil</span>&nbsp;<span class="op" id="5659027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659031">if</span>&nbsp;<span class="ident" id="5659034">_</span><span class="op" id="5659035">,</span>&nbsp;<span class="ident" id="5659037">ok</span>&nbsp;<span class="op" id="5659040">:=</span>&nbsp;<span class="ident" id="5659043">c</span><span class="op" id="5659044">.</span><span class="ident" id="5659045">ext</span><span class="op" id="5659048">[</span><span class="string" id="5659049">&#34;AUTH&#34;</span><span class="op" id="5659055">]</span><span class="op" id="5659056">;</span>&nbsp;<span class="ident" id="5659058">ok</span>&nbsp;<span class="op" id="5659061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659066">if</span>&nbsp;<span class="ident" id="5659069">err</span>&nbsp;<span class="op" id="5659073">=</span>&nbsp;<span class="ident" id="5659075">c</span><span class="op" id="5659076">.</span><span class="ident" id="5659077">Auth</span><span class="op" id="5659081">(</span><span class="ident" id="5659082">a</span><span class="op" id="5659083">)</span><span class="op" id="5659084">;</span>&nbsp;<span class="ident" id="5659086">err</span>&nbsp;<span class="op" id="5659090">!=</span>&nbsp;<span class="ident" id="5659093">nil</span>&nbsp;<span class="op" id="5659097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659103">return</span>&nbsp;<span class="ident" id="5659110">err</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5659117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5659121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5659124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659127">if</span>&nbsp;<span class="ident" id="5659130">err</span>&nbsp;<span class="op" id="5659134">=</span>&nbsp;<span class="ident" id="5659136">c</span><span class="op" id="5659137">.</span><span class="ident" id="5659138">Mail</span><span class="op" id="5659142">(</span><span class="ident" id="5659143">from</span><span class="op" id="5659147">)</span><span class="op" id="5659148">;</span>&nbsp;<span class="ident" id="5659150">err</span>&nbsp;<span class="op" id="5659154">!=</span>&nbsp;<span class="ident" id="5659157">nil</span>&nbsp;<span class="op" id="5659161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659165">return</span>&nbsp;<span class="ident" id="5659172">err</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5659177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659180">for</span>&nbsp;<span class="ident" id="5659184">_</span><span class="op" id="5659185">,</span>&nbsp;<span class="ident" id="5659187">addr</span>&nbsp;<span class="op" id="5659192">:=</span>&nbsp;<span class="keyword" id="5659195">range</span>&nbsp;<span class="ident" id="5659201">to</span>&nbsp;<span class="op" id="5659204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659208">if</span>&nbsp;<span class="ident" id="5659211">err</span>&nbsp;<span class="op" id="5659215">=</span>&nbsp;<span class="ident" id="5659217">c</span><span class="op" id="5659218">.</span><span class="ident" id="5659219">Rcpt</span><span class="op" id="5659223">(</span><span class="ident" id="5659224">addr</span><span class="op" id="5659228">)</span><span class="op" id="5659229">;</span>&nbsp;<span class="ident" id="5659231">err</span>&nbsp;<span class="op" id="5659235">!=</span>&nbsp;<span class="ident" id="5659238">nil</span>&nbsp;<span class="op" id="5659242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659247">return</span>&nbsp;<span class="ident" id="5659254">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5659260">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5659263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5659266">w</span><span class="op" id="5659267">,</span>&nbsp;<span class="ident" id="5659269">err</span>&nbsp;<span class="op" id="5659273">:=</span>&nbsp;<span class="ident" id="5659276">c</span><span class="op" id="5659277">.</span><span class="ident" id="5659278">Data</span><span class="op" id="5659282">(</span><span class="op" id="5659283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659286">if</span>&nbsp;<span class="ident" id="5659289">err</span>&nbsp;<span class="op" id="5659293">!=</span>&nbsp;<span class="ident" id="5659296">nil</span>&nbsp;<span class="op" id="5659300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659304">return</span>&nbsp;<span class="ident" id="5659311">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5659316">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5659319">_</span><span class="op" id="5659320">,</span>&nbsp;<span class="ident" id="5659322">err</span>&nbsp;<span class="op" id="5659326">=</span>&nbsp;<span class="ident" id="5659328">w</span><span class="op" id="5659329">.</span><span class="ident" id="5659330">Write</span><span class="op" id="5659335">(</span><span class="ident" id="5659336">msg</span><span class="op" id="5659339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659342">if</span>&nbsp;<span class="ident" id="5659345">err</span>&nbsp;<span class="op" id="5659349">!=</span>&nbsp;<span class="ident" id="5659352">nil</span>&nbsp;<span class="op" id="5659356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659360">return</span>&nbsp;<span class="ident" id="5659367">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5659372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5659375">err</span>&nbsp;<span class="op" id="5659379">=</span>&nbsp;<span class="ident" id="5659381">w</span><span class="op" id="5659382">.</span><span class="ident" id="5659383">Close</span><span class="op" id="5659388">(</span><span class="op" id="5659389">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659392">if</span>&nbsp;<span class="ident" id="5659395">err</span>&nbsp;<span class="op" id="5659399">!=</span>&nbsp;<span class="ident" id="5659402">nil</span>&nbsp;<span class="op" id="5659406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659410">return</span>&nbsp;<span class="ident" id="5659417">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5659422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659425">return</span>&nbsp;<span class="ident" id="5659432">c</span><span class="op" id="5659433">.</span><span class="ident" id="5659434">Quit</span><span class="op" id="5659438">(</span><span class="op" id="5659439">)</span><br>
<span class="lineno"></span><span class="op" id="5659441">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="5659444">//&nbsp;Extension&nbsp;reports&nbsp;whether&nbsp;an&nbsp;extension&nbsp;is&nbsp;support&nbsp;by&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="5659512">//&nbsp;The&nbsp;extension&nbsp;name&nbsp;is&nbsp;case-insensitive.&nbsp;If&nbsp;the&nbsp;extension&nbsp;is&nbsp;supported,</span><br>
<span class="lineno"></span><span class="comment" id="5659586">//&nbsp;Extension&nbsp;also&nbsp;returns&nbsp;a&nbsp;string&nbsp;that&nbsp;contains&nbsp;any&nbsp;parameters&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5659654">//&nbsp;server&nbsp;specifies&nbsp;for&nbsp;the&nbsp;extension.</span><br>
<span class="lineno">325</span><span class="keyword" id="5659693">func</span>&nbsp;<span class="op" id="5659698">(</span><span class="ident" id="5659699">c</span>&nbsp;<span class="op" id="5659701">*</span><span class="ident" id="5659702">Client</span><span class="op" id="5659708">)</span>&nbsp;<span class="ident" id="5659710">Extension</span><span class="op" id="5659719">(</span><span class="ident" id="5659720">ext</span>&nbsp;<span class="builtintype" id="5659724">string</span><span class="op" id="5659730">)</span>&nbsp;<span class="op" id="5659732">(</span><span class="builtintype" id="5659733">bool</span><span class="op" id="5659737">,</span>&nbsp;<span class="builtintype" id="5659739">string</span><span class="op" id="5659745">)</span>&nbsp;<span class="op" id="5659747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659750">if</span>&nbsp;<span class="ident" id="5659753">err</span>&nbsp;<span class="op" id="5659757">:=</span>&nbsp;<span class="ident" id="5659760">c</span><span class="op" id="5659761">.</span><span class="ident" id="5659762">hello</span><span class="op" id="5659767">(</span><span class="op" id="5659768">)</span><span class="op" id="5659769">;</span>&nbsp;<span class="ident" id="5659771">err</span>&nbsp;<span class="op" id="5659775">!=</span>&nbsp;<span class="ident" id="5659778">nil</span>&nbsp;<span class="op" id="5659782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659786">return</span>&nbsp;<span class="builtintype" id="5659793">false</span><span class="op" id="5659798">,</span>&nbsp;<span class="string" id="5659800">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5659804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659807">if</span>&nbsp;<span class="ident" id="5659810">c</span><span class="op" id="5659811">.</span><span class="ident" id="5659812">ext</span>&nbsp;<span class="op" id="5659816">==</span>&nbsp;<span class="ident" id="5659819">nil</span>&nbsp;<span class="op" id="5659823">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659827">return</span>&nbsp;<span class="builtintype" id="5659834">false</span><span class="op" id="5659839">,</span>&nbsp;<span class="string" id="5659841">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5659845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5659848">ext</span>&nbsp;<span class="op" id="5659852">=</span>&nbsp;<span class="ident" id="5659854">strings</span><span class="op" id="5659861">.</span><span class="ident" id="5659862">ToUpper</span><span class="op" id="5659869">(</span><span class="ident" id="5659870">ext</span><span class="op" id="5659873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5659876">param</span><span class="op" id="5659881">,</span>&nbsp;<span class="ident" id="5659883">ok</span>&nbsp;<span class="op" id="5659886">:=</span>&nbsp;<span class="ident" id="5659889">c</span><span class="op" id="5659890">.</span><span class="ident" id="5659891">ext</span><span class="op" id="5659894">[</span><span class="ident" id="5659895">ext</span><span class="op" id="5659898">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5659901">return</span>&nbsp;<span class="ident" id="5659908">ok</span><span class="op" id="5659910">,</span>&nbsp;<span class="ident" id="5659912">param</span><br>
<span class="lineno">335</span><span class="op" id="5659918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5659921">//&nbsp;Reset&nbsp;sends&nbsp;the&nbsp;RSET&nbsp;command&nbsp;to&nbsp;the&nbsp;server,&nbsp;aborting&nbsp;the&nbsp;current&nbsp;mail</span><br>
<span class="lineno"></span><span class="comment" id="5659994">//&nbsp;transaction.</span><br>
<span class="lineno"></span><span class="keyword" id="5660010">func</span>&nbsp;<span class="op" id="5660015">(</span><span class="ident" id="5660016">c</span>&nbsp;<span class="op" id="5660018">*</span><span class="ident" id="5660019">Client</span><span class="op" id="5660025">)</span>&nbsp;<span class="ident" id="5660027">Reset</span><span class="op" id="5660032">(</span><span class="op" id="5660033">)</span>&nbsp;<span class="builtintype" id="5660035">error</span>&nbsp;<span class="op" id="5660041">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660044">if</span>&nbsp;<span class="ident" id="5660047">err</span>&nbsp;<span class="op" id="5660051">:=</span>&nbsp;<span class="ident" id="5660054">c</span><span class="op" id="5660055">.</span><span class="ident" id="5660056">hello</span><span class="op" id="5660061">(</span><span class="op" id="5660062">)</span><span class="op" id="5660063">;</span>&nbsp;<span class="ident" id="5660065">err</span>&nbsp;<span class="op" id="5660069">!=</span>&nbsp;<span class="ident" id="5660072">nil</span>&nbsp;<span class="op" id="5660076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660080">return</span>&nbsp;<span class="ident" id="5660087">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5660092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660095">_</span><span class="op" id="5660096">,</span>&nbsp;<span class="ident" id="5660098">_</span><span class="op" id="5660099">,</span>&nbsp;<span class="ident" id="5660101">err</span>&nbsp;<span class="op" id="5660105">:=</span>&nbsp;<span class="ident" id="5660108">c</span><span class="op" id="5660109">.</span><span class="ident" id="5660110">cmd</span><span class="op" id="5660113">(</span><span class="num" id="5660114">250</span><span class="op" id="5660117">,</span>&nbsp;<span class="string" id="5660119">&#34;RSET&#34;</span><span class="op" id="5660125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660128">return</span>&nbsp;<span class="ident" id="5660135">err</span><br>
<span class="lineno">345</span><span class="op" id="5660139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5660142">//&nbsp;Quit&nbsp;sends&nbsp;the&nbsp;QUIT&nbsp;command&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection&nbsp;to&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="5660214">func</span>&nbsp;<span class="op" id="5660219">(</span><span class="ident" id="5660220">c</span>&nbsp;<span class="op" id="5660222">*</span><span class="ident" id="5660223">Client</span><span class="op" id="5660229">)</span>&nbsp;<span class="ident" id="5660231">Quit</span><span class="op" id="5660235">(</span><span class="op" id="5660236">)</span>&nbsp;<span class="builtintype" id="5660238">error</span>&nbsp;<span class="op" id="5660244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660247">if</span>&nbsp;<span class="ident" id="5660250">err</span>&nbsp;<span class="op" id="5660254">:=</span>&nbsp;<span class="ident" id="5660257">c</span><span class="op" id="5660258">.</span><span class="ident" id="5660259">hello</span><span class="op" id="5660264">(</span><span class="op" id="5660265">)</span><span class="op" id="5660266">;</span>&nbsp;<span class="ident" id="5660268">err</span>&nbsp;<span class="op" id="5660272">!=</span>&nbsp;<span class="ident" id="5660275">nil</span>&nbsp;<span class="op" id="5660279">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660283">return</span>&nbsp;<span class="ident" id="5660290">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5660295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5660298">_</span><span class="op" id="5660299">,</span>&nbsp;<span class="ident" id="5660301">_</span><span class="op" id="5660302">,</span>&nbsp;<span class="ident" id="5660304">err</span>&nbsp;<span class="op" id="5660308">:=</span>&nbsp;<span class="ident" id="5660311">c</span><span class="op" id="5660312">.</span><span class="ident" id="5660313">cmd</span><span class="op" id="5660316">(</span><span class="num" id="5660317">221</span><span class="op" id="5660320">,</span>&nbsp;<span class="string" id="5660322">&#34;QUIT&#34;</span><span class="op" id="5660328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660331">if</span>&nbsp;<span class="ident" id="5660334">err</span>&nbsp;<span class="op" id="5660338">!=</span>&nbsp;<span class="ident" id="5660341">nil</span>&nbsp;<span class="op" id="5660345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660349">return</span>&nbsp;<span class="ident" id="5660356">err</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5660361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5660364">return</span>&nbsp;<span class="ident" id="5660371">c</span><span class="op" id="5660372">.</span><span class="ident" id="5660373">Text</span><span class="op" id="5660377">.</span><span class="ident" id="5660378">Close</span><span class="op" id="5660383">(</span><span class="op" id="5660384">)</span><br>
<span class="lineno"></span><span class="op" id="5660386">}</span>
</div>
</body>
</html>
