<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/pem</h2>
<ul>
<li><a href="/gostd/encoding/pem/pem.go.html" class="current">pem.go</a></li>
<li><a href="/gostd/encoding/pem/pem_test.go.html">pem_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4128490">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4128545">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4128599">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4128650">//&nbsp;Package&nbsp;pem&nbsp;implements&nbsp;the&nbsp;PEM&nbsp;data&nbsp;encoding,&nbsp;which&nbsp;originated&nbsp;in&nbsp;Privacy</span><br>
<span class="lineno"></span><span class="comment" id="4128727">//&nbsp;Enhanced&nbsp;Mail.&nbsp;The&nbsp;most&nbsp;common&nbsp;use&nbsp;of&nbsp;PEM&nbsp;encoding&nbsp;today&nbsp;is&nbsp;in&nbsp;TLS&nbsp;keys&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4128806">//&nbsp;certificates.&nbsp;See&nbsp;RFC&nbsp;1421.</span><br>
<span class="lineno"></span><span class="keyword" id="4128837">package</span>&nbsp;<span class="ident" id="4128845">pem</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="4128850">import</span>&nbsp;<span class="op" id="4128857">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4128860">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4128869">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4128888">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4128894">&#34;sort&#34;</span><br>
<span class="lineno">15</span><span class="op" id="4128901">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4128904">//&nbsp;A&nbsp;Block&nbsp;represents&nbsp;a&nbsp;PEM&nbsp;encoded&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="4128951">//</span><br>
<span class="lineno"></span><span class="comment" id="4128954">//&nbsp;The&nbsp;encoded&nbsp;form&nbsp;is:</span><br>
<span class="lineno">20</span><span class="comment" id="4128978">//&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;Type-----</span><br>
<span class="lineno"></span><span class="comment" id="4129005">//&nbsp;&nbsp;&nbsp;&nbsp;Headers</span><br>
<span class="lineno"></span><span class="comment" id="4129019">//&nbsp;&nbsp;&nbsp;&nbsp;base64-encoded&nbsp;Bytes</span><br>
<span class="lineno"></span><span class="comment" id="4129046">//&nbsp;&nbsp;&nbsp;&nbsp;-----END&nbsp;Type-----</span><br>
<span class="lineno"></span><span class="comment" id="4129071">//&nbsp;where&nbsp;Headers&nbsp;is&nbsp;a&nbsp;possibly&nbsp;empty&nbsp;sequence&nbsp;of&nbsp;Key:&nbsp;Value&nbsp;lines.</span><br>
<span class="lineno">25</span><span class="keyword" id="4129138">type</span>&nbsp;<span class="ident" id="4129143">Block</span>&nbsp;<span class="keyword" id="4129149">struct</span>&nbsp;<span class="op" id="4129156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129159">Type</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4129167">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4129185">//&nbsp;The&nbsp;type,&nbsp;taken&nbsp;from&nbsp;the&nbsp;preamble&nbsp;(i.e.&nbsp;&#34;RSA&nbsp;PRIVATE&nbsp;KEY&#34;).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129249">Headers</span>&nbsp;<span class="keyword" id="4129257">map</span><span class="op" id="4129260">[</span><span class="builtintype" id="4129261">string</span><span class="op" id="4129267">]</span><span class="builtintype" id="4129268">string</span>&nbsp;<span class="comment" id="4129275">//&nbsp;Optional&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129297">Bytes</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4129305">[</span><span class="op" id="4129306">]</span><span class="builtintype" id="4129307">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4129323">//&nbsp;The&nbsp;decoded&nbsp;bytes&nbsp;of&nbsp;the&nbsp;contents.&nbsp;Typically&nbsp;a&nbsp;DER&nbsp;encoded&nbsp;ASN.1&nbsp;structure.</span><br>
<span class="lineno"></span><span class="op" id="4129402">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="4129405">//&nbsp;getLine&nbsp;results&nbsp;the&nbsp;first&nbsp;\r\n&nbsp;or&nbsp;\n&nbsp;delineated&nbsp;line&nbsp;from&nbsp;the&nbsp;given&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="4129481">//&nbsp;array.&nbsp;The&nbsp;line&nbsp;does&nbsp;not&nbsp;include&nbsp;trailing&nbsp;whitespace&nbsp;or&nbsp;the&nbsp;trailing&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="4129557">//&nbsp;line&nbsp;bytes.&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;byte&nbsp;array&nbsp;(also&nbsp;not&nbsp;including&nbsp;the&nbsp;new&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="4129637">//&nbsp;bytes)&nbsp;is&nbsp;also&nbsp;returned&nbsp;and&nbsp;this&nbsp;will&nbsp;always&nbsp;be&nbsp;smaller&nbsp;than&nbsp;the&nbsp;original</span><br>
<span class="lineno">35</span><span class="comment" id="4129714">//&nbsp;argument.</span><br>
<span class="lineno"></span><span class="keyword" id="4129727">func</span>&nbsp;<span class="ident" id="4129732">getLine</span><span class="op" id="4129739">(</span><span class="ident" id="4129740">data</span>&nbsp;<span class="op" id="4129745">[</span><span class="op" id="4129746">]</span><span class="builtintype" id="4129747">byte</span><span class="op" id="4129751">)</span>&nbsp;<span class="op" id="4129753">(</span><span class="ident" id="4129754">line</span><span class="op" id="4129758">,</span>&nbsp;<span class="ident" id="4129760">rest</span>&nbsp;<span class="op" id="4129765">[</span><span class="op" id="4129766">]</span><span class="builtintype" id="4129767">byte</span><span class="op" id="4129771">)</span>&nbsp;<span class="op" id="4129773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129776">i</span>&nbsp;<span class="op" id="4129778">:=</span>&nbsp;<span class="ident" id="4129781">bytes</span><span class="op" id="4129786">.</span><span class="ident" id="4129787">Index</span><span class="op" id="4129792">(</span><span class="ident" id="4129793">data</span><span class="op" id="4129797">,</span>&nbsp;<span class="op" id="4129799">[</span><span class="op" id="4129800">]</span><span class="builtintype" id="4129801">byte</span><span class="op" id="4129805">{</span><span class="string" id="4129806">&#39;\n&#39;</span><span class="op" id="4129810">}</span><span class="op" id="4129811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4129814">var</span>&nbsp;<span class="ident" id="4129818">j</span>&nbsp;<span class="builtintype" id="4129820">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4129825">if</span>&nbsp;<span class="ident" id="4129828">i</span>&nbsp;<span class="op" id="4129830">&lt;</span>&nbsp;<span class="num" id="4129832">0</span>&nbsp;<span class="op" id="4129834">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129838">i</span>&nbsp;<span class="op" id="4129840">=</span>&nbsp;<span class="builtinfunc" id="4129842">len</span><span class="op" id="4129845">(</span><span class="ident" id="4129846">data</span><span class="op" id="4129850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129854">j</span>&nbsp;<span class="op" id="4129856">=</span>&nbsp;<span class="ident" id="4129858">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4129861">}</span>&nbsp;<span class="keyword" id="4129863">else</span>&nbsp;<span class="op" id="4129868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129872">j</span>&nbsp;<span class="op" id="4129874">=</span>&nbsp;<span class="ident" id="4129876">i</span>&nbsp;<span class="op" id="4129878">+</span>&nbsp;<span class="num" id="4129880">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4129884">if</span>&nbsp;<span class="ident" id="4129887">i</span>&nbsp;<span class="op" id="4129889">&gt;</span>&nbsp;<span class="num" id="4129891">0</span>&nbsp;<span class="op" id="4129893">&amp;&amp;</span>&nbsp;<span class="ident" id="4129896">data</span><span class="op" id="4129900">[</span><span class="ident" id="4129901">i</span><span class="op" id="4129902">-</span><span class="num" id="4129903">1</span><span class="op" id="4129904">]</span>&nbsp;<span class="op" id="4129906">==</span>&nbsp;<span class="string" id="4129909">&#39;\r&#39;</span>&nbsp;<span class="op" id="4129914">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4129919">i</span><span class="op" id="4129920">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4129925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4129928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4129931">return</span>&nbsp;<span class="ident" id="4129938">bytes</span><span class="op" id="4129943">.</span><span class="ident" id="4129944">TrimRight</span><span class="op" id="4129953">(</span><span class="ident" id="4129954">data</span><span class="op" id="4129958">[</span><span class="num" id="4129959">0</span><span class="op" id="4129960">:</span><span class="ident" id="4129961">i</span><span class="op" id="4129962">]</span><span class="op" id="4129963">,</span>&nbsp;<span class="string" id="4129965">&#34;&nbsp;\t&#34;</span><span class="op" id="4129970">)</span><span class="op" id="4129971">,</span>&nbsp;<span class="ident" id="4129973">data</span><span class="op" id="4129977">[</span><span class="ident" id="4129978">j</span><span class="op" id="4129979">:</span><span class="op" id="4129980">]</span><br>
<span class="lineno"></span><span class="op" id="4129982">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="4129985">//&nbsp;removeWhitespace&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;its&nbsp;input&nbsp;with&nbsp;all&nbsp;spaces,&nbsp;tab&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4130058">//&nbsp;newline&nbsp;characters&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="4130089">func</span>&nbsp;<span class="ident" id="4130094">removeWhitespace</span><span class="op" id="4130110">(</span><span class="ident" id="4130111">data</span>&nbsp;<span class="op" id="4130116">[</span><span class="op" id="4130117">]</span><span class="builtintype" id="4130118">byte</span><span class="op" id="4130122">)</span>&nbsp;<span class="op" id="4130124">[</span><span class="op" id="4130125">]</span><span class="builtintype" id="4130126">byte</span>&nbsp;<span class="op" id="4130131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4130134">result</span>&nbsp;<span class="op" id="4130141">:=</span>&nbsp;<span class="builtinfunc" id="4130144">make</span><span class="op" id="4130148">(</span><span class="op" id="4130149">[</span><span class="op" id="4130150">]</span><span class="builtintype" id="4130151">byte</span><span class="op" id="4130155">,</span>&nbsp;<span class="builtinfunc" id="4130157">len</span><span class="op" id="4130160">(</span><span class="ident" id="4130161">data</span><span class="op" id="4130165">)</span><span class="op" id="4130166">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4130169">n</span>&nbsp;<span class="op" id="4130171">:=</span>&nbsp;<span class="num" id="4130174">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4130178">for</span>&nbsp;<span class="ident" id="4130182">_</span><span class="op" id="4130183">,</span>&nbsp;<span class="ident" id="4130185">b</span>&nbsp;<span class="op" id="4130187">:=</span>&nbsp;<span class="keyword" id="4130190">range</span>&nbsp;<span class="ident" id="4130196">data</span>&nbsp;<span class="op" id="4130201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4130205">if</span>&nbsp;<span class="ident" id="4130208">b</span>&nbsp;<span class="op" id="4130210">==</span>&nbsp;<span class="string" id="4130213">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4130217">||</span>&nbsp;<span class="ident" id="4130220">b</span>&nbsp;<span class="op" id="4130222">==</span>&nbsp;<span class="string" id="4130225">&#39;\t&#39;</span>&nbsp;<span class="op" id="4130230">||</span>&nbsp;<span class="ident" id="4130233">b</span>&nbsp;<span class="op" id="4130235">==</span>&nbsp;<span class="string" id="4130238">&#39;\r&#39;</span>&nbsp;<span class="op" id="4130243">||</span>&nbsp;<span class="ident" id="4130246">b</span>&nbsp;<span class="op" id="4130248">==</span>&nbsp;<span class="string" id="4130251">&#39;\n&#39;</span>&nbsp;<span class="op" id="4130256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4130261">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4130272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4130276">result</span><span class="op" id="4130282">[</span><span class="ident" id="4130283">n</span><span class="op" id="4130284">]</span>&nbsp;<span class="op" id="4130286">=</span>&nbsp;<span class="ident" id="4130288">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4130292">n</span><span class="op" id="4130293">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4130297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4130301">return</span>&nbsp;<span class="ident" id="4130308">result</span><span class="op" id="4130314">[</span><span class="num" id="4130315">0</span><span class="op" id="4130316">:</span><span class="ident" id="4130317">n</span><span class="op" id="4130318">]</span><br>
<span class="lineno"></span><span class="op" id="4130320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4130323">var</span>&nbsp;<span class="ident" id="4130327">pemStart</span>&nbsp;<span class="op" id="4130336">=</span>&nbsp;<span class="op" id="4130338">[</span><span class="op" id="4130339">]</span><span class="builtintype" id="4130340">byte</span><span class="op" id="4130344">(</span><span class="string" id="4130345">&#34;\n-----BEGIN&nbsp;&#34;</span><span class="op" id="4130360">)</span><br>
<span class="lineno"></span><span class="keyword" id="4130362">var</span>&nbsp;<span class="ident" id="4130366">pemEnd</span>&nbsp;<span class="op" id="4130373">=</span>&nbsp;<span class="op" id="4130375">[</span><span class="op" id="4130376">]</span><span class="builtintype" id="4130377">byte</span><span class="op" id="4130381">(</span><span class="string" id="4130382">&#34;\n-----END&nbsp;&#34;</span><span class="op" id="4130395">)</span><br>
<span class="lineno">70</span><span class="keyword" id="4130397">var</span>&nbsp;<span class="ident" id="4130401">pemEndOfLine</span>&nbsp;<span class="op" id="4130414">=</span>&nbsp;<span class="op" id="4130416">[</span><span class="op" id="4130417">]</span><span class="builtintype" id="4130418">byte</span><span class="op" id="4130422">(</span><span class="string" id="4130423">&#34;-----&#34;</span><span class="op" id="4130430">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4130433">//&nbsp;Decode&nbsp;will&nbsp;find&nbsp;the&nbsp;next&nbsp;PEM&nbsp;formatted&nbsp;block&nbsp;(certificate,&nbsp;private&nbsp;key</span><br>
<span class="lineno"></span><span class="comment" id="4130508">//&nbsp;etc)&nbsp;in&nbsp;the&nbsp;input.&nbsp;It&nbsp;returns&nbsp;that&nbsp;block&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;input.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="4130587">//&nbsp;no&nbsp;PEM&nbsp;data&nbsp;is&nbsp;found,&nbsp;p&nbsp;is&nbsp;nil&nbsp;and&nbsp;the&nbsp;whole&nbsp;of&nbsp;the&nbsp;input&nbsp;is&nbsp;returned&nbsp;in</span><br>
<span class="lineno">75</span><span class="comment" id="4130663">//&nbsp;rest.</span><br>
<span class="lineno"></span><span class="keyword" id="4130672">func</span>&nbsp;<span class="ident" id="4130677">Decode</span><span class="op" id="4130683">(</span><span class="ident" id="4130684">data</span>&nbsp;<span class="op" id="4130689">[</span><span class="op" id="4130690">]</span><span class="builtintype" id="4130691">byte</span><span class="op" id="4130695">)</span>&nbsp;<span class="op" id="4130697">(</span><span class="ident" id="4130698">p</span>&nbsp;<span class="op" id="4130700">*</span><span class="ident" id="4130701">Block</span><span class="op" id="4130706">,</span>&nbsp;<span class="ident" id="4130708">rest</span>&nbsp;<span class="op" id="4130713">[</span><span class="op" id="4130714">]</span><span class="builtintype" id="4130715">byte</span><span class="op" id="4130719">)</span>&nbsp;<span class="op" id="4130721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4130724">//&nbsp;pemStart&nbsp;begins&nbsp;with&nbsp;a&nbsp;newline.&nbsp;However,&nbsp;at&nbsp;the&nbsp;very&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4130794">//&nbsp;the&nbsp;byte&nbsp;array,&nbsp;we&#39;ll&nbsp;accept&nbsp;the&nbsp;start&nbsp;string&nbsp;without&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4130856">rest</span>&nbsp;<span class="op" id="4130861">=</span>&nbsp;<span class="ident" id="4130863">data</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4130869">if</span>&nbsp;<span class="ident" id="4130872">bytes</span><span class="op" id="4130877">.</span><span class="ident" id="4130878">HasPrefix</span><span class="op" id="4130887">(</span><span class="ident" id="4130888">data</span><span class="op" id="4130892">,</span>&nbsp;<span class="ident" id="4130894">pemStart</span><span class="op" id="4130902">[</span><span class="num" id="4130903">1</span><span class="op" id="4130904">:</span><span class="op" id="4130905">]</span><span class="op" id="4130906">)</span>&nbsp;<span class="op" id="4130908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4130912">rest</span>&nbsp;<span class="op" id="4130917">=</span>&nbsp;<span class="ident" id="4130919">rest</span><span class="op" id="4130923">[</span><span class="builtinfunc" id="4130924">len</span><span class="op" id="4130927">(</span><span class="ident" id="4130928">pemStart</span><span class="op" id="4130936">)</span><span class="op" id="4130937">-</span><span class="num" id="4130938">1</span>&nbsp;<span class="op" id="4130940">:</span>&nbsp;<span class="builtinfunc" id="4130942">len</span><span class="op" id="4130945">(</span><span class="ident" id="4130946">data</span><span class="op" id="4130950">)</span><span class="op" id="4130951">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4130954">}</span>&nbsp;<span class="keyword" id="4130956">else</span>&nbsp;<span class="keyword" id="4130961">if</span>&nbsp;<span class="ident" id="4130964">i</span>&nbsp;<span class="op" id="4130966">:=</span>&nbsp;<span class="ident" id="4130969">bytes</span><span class="op" id="4130974">.</span><span class="ident" id="4130975">Index</span><span class="op" id="4130980">(</span><span class="ident" id="4130981">data</span><span class="op" id="4130985">,</span>&nbsp;<span class="ident" id="4130987">pemStart</span><span class="op" id="4130995">)</span><span class="op" id="4130996">;</span>&nbsp;<span class="ident" id="4130998">i</span>&nbsp;<span class="op" id="4131000">&gt;=</span>&nbsp;<span class="num" id="4131003">0</span>&nbsp;<span class="op" id="4131005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4131009">rest</span>&nbsp;<span class="op" id="4131014">=</span>&nbsp;<span class="ident" id="4131016">rest</span><span class="op" id="4131020">[</span><span class="ident" id="4131021">i</span><span class="op" id="4131022">+</span><span class="builtinfunc" id="4131023">len</span><span class="op" id="4131026">(</span><span class="ident" id="4131027">pemStart</span><span class="op" id="4131035">)</span>&nbsp;<span class="op" id="4131037">:</span>&nbsp;<span class="builtinfunc" id="4131039">len</span><span class="op" id="4131042">(</span><span class="ident" id="4131043">data</span><span class="op" id="4131047">)</span><span class="op" id="4131048">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4131051">}</span>&nbsp;<span class="keyword" id="4131053">else</span>&nbsp;<span class="op" id="4131058">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4131062">return</span>&nbsp;<span class="ident" id="4131069">nil</span><span class="op" id="4131072">,</span>&nbsp;<span class="ident" id="4131074">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4131080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4131084">typeLine</span><span class="op" id="4131092">,</span>&nbsp;<span class="ident" id="4131094">rest</span>&nbsp;<span class="op" id="4131099">:=</span>&nbsp;<span class="ident" id="4131102">getLine</span><span class="op" id="4131109">(</span><span class="ident" id="4131110">rest</span><span class="op" id="4131114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4131117">if</span>&nbsp;<span class="op" id="4131120">!</span><span class="ident" id="4131121">bytes</span><span class="op" id="4131126">.</span><span class="ident" id="4131127">HasSuffix</span><span class="op" id="4131136">(</span><span class="ident" id="4131137">typeLine</span><span class="op" id="4131145">,</span>&nbsp;<span class="ident" id="4131147">pemEndOfLine</span><span class="op" id="4131159">)</span>&nbsp;<span class="op" id="4131161">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4131165">return</span>&nbsp;<span class="ident" id="4131172">decodeError</span><span class="op" id="4131183">(</span><span class="ident" id="4131184">data</span><span class="op" id="4131188">,</span>&nbsp;<span class="ident" id="4131190">rest</span><span class="op" id="4131194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4131197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4131200">typeLine</span>&nbsp;<span class="op" id="4131209">=</span>&nbsp;<span class="ident" id="4131211">typeLine</span><span class="op" id="4131219">[</span><span class="num" id="4131220">0</span>&nbsp;<span class="op" id="4131222">:</span>&nbsp;<span class="builtinfunc" id="4131224">len</span><span class="op" id="4131227">(</span><span class="ident" id="4131228">typeLine</span><span class="op" id="4131236">)</span><span class="op" id="4131237">-</span><span class="builtinfunc" id="4131238">len</span><span class="op" id="4131241">(</span><span class="ident" id="4131242">pemEndOfLine</span><span class="op" id="4131254">)</span><span class="op" id="4131255">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4131259">p</span>&nbsp;<span class="op" id="4131261">=</span>&nbsp;<span class="op" id="4131263">&amp;</span><span class="ident" id="4131264">Block</span><span class="op" id="4131269">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4131273">Headers</span><span class="op" id="4131280">:</span>&nbsp;<span class="builtinfunc" id="4131282">make</span><span class="op" id="4131286">(</span><span class="keyword" id="4131287">map</span><span class="op" id="4131290">[</span><span class="builtintype" id="4131291">string</span><span class="op" id="4131297">]</span><span class="builtintype" id="4131298">string</span><span class="op" id="4131304">)</span><span class="op" id="4131305">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4131309">Type</span><span class="op" id="4131313">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4131318">string</span><span class="op" id="4131324">(</span><span class="ident" id="4131325">typeLine</span><span class="op" id="4131333">)</span><span class="op" id="4131334">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4131337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4131341">for</span>&nbsp;<span class="op" id="4131345">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4131349">//&nbsp;This&nbsp;loop&nbsp;terminates&nbsp;because&nbsp;getLine&#39;s&nbsp;second&nbsp;result&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4131410">//&nbsp;always&nbsp;smaller&nbsp;than&nbsp;its&nbsp;argument.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4131449">if</span>&nbsp;<span class="builtinfunc" id="4131452">len</span><span class="op" id="4131455">(</span><span class="ident" id="4131456">rest</span><span class="op" id="4131460">)</span>&nbsp;<span class="op" id="4131462">==</span>&nbsp;<span class="num" id="4131465">0</span>&nbsp;<span class="op" id="4131467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4131472">return</span>&nbsp;<span class="ident" id="4131479">nil</span><span class="op" id="4131482">,</span>&nbsp;<span class="ident" id="4131484">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4131491">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4131495">line</span><span class="op" id="4131499">,</span>&nbsp;<span class="ident" id="4131501">next</span>&nbsp;<span class="op" id="4131506">:=</span>&nbsp;<span class="ident" id="4131509">getLine</span><span class="op" id="4131516">(</span><span class="ident" id="4131517">rest</span><span class="op" id="4131521">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4131526">i</span>&nbsp;<span class="op" id="4131528">:=</span>&nbsp;<span class="ident" id="4131531">bytes</span><span class="op" id="4131536">.</span><span class="ident" id="4131537">Index</span><span class="op" id="4131542">(</span><span class="ident" id="4131543">line</span><span class="op" id="4131547">,</span>&nbsp;<span class="op" id="4131549">[</span><span class="op" id="4131550">]</span><span class="builtintype" id="4131551">byte</span><span class="op" id="4131555">{</span><span class="string" id="4131556">&#39;:&#39;</span><span class="op" id="4131559">}</span><span class="op" id="4131560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4131564">if</span>&nbsp;<span class="ident" id="4131567">i</span>&nbsp;<span class="op" id="4131569">==</span>&nbsp;<span class="op" id="4131572">-</span><span class="num" id="4131573">1</span>&nbsp;<span class="op" id="4131575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4131580">break</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4131588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4131593">//&nbsp;TODO(agl):&nbsp;need&nbsp;to&nbsp;cope&nbsp;with&nbsp;values&nbsp;that&nbsp;spread&nbsp;across&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4131660">key</span><span class="op" id="4131663">,</span>&nbsp;<span class="ident" id="4131665">val</span>&nbsp;<span class="op" id="4131669">:=</span>&nbsp;<span class="ident" id="4131672">line</span><span class="op" id="4131676">[</span><span class="num" id="4131677">0</span><span class="op" id="4131678">:</span><span class="ident" id="4131679">i</span><span class="op" id="4131680">]</span><span class="op" id="4131681">,</span>&nbsp;<span class="ident" id="4131683">line</span><span class="op" id="4131687">[</span><span class="ident" id="4131688">i</span><span class="op" id="4131689">+</span><span class="num" id="4131690">1</span><span class="op" id="4131691">:</span><span class="op" id="4131692">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4131696">key</span>&nbsp;<span class="op" id="4131700">=</span>&nbsp;<span class="ident" id="4131702">bytes</span><span class="op" id="4131707">.</span><span class="ident" id="4131708">TrimSpace</span><span class="op" id="4131717">(</span><span class="ident" id="4131718">key</span><span class="op" id="4131721">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4131725">val</span>&nbsp;<span class="op" id="4131729">=</span>&nbsp;<span class="ident" id="4131731">bytes</span><span class="op" id="4131736">.</span><span class="ident" id="4131737">TrimSpace</span><span class="op" id="4131746">(</span><span class="ident" id="4131747">val</span><span class="op" id="4131750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4131754">p</span><span class="op" id="4131755">.</span><span class="ident" id="4131756">Headers</span><span class="op" id="4131763">[</span><span class="builtintype" id="4131764">string</span><span class="op" id="4131770">(</span><span class="ident" id="4131771">key</span><span class="op" id="4131774">)</span><span class="op" id="4131775">]</span>&nbsp;<span class="op" id="4131777">=</span>&nbsp;<span class="builtintype" id="4131779">string</span><span class="op" id="4131785">(</span><span class="ident" id="4131786">val</span><span class="op" id="4131789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4131793">rest</span>&nbsp;<span class="op" id="4131798">=</span>&nbsp;<span class="ident" id="4131800">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4131806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4131810">i</span>&nbsp;<span class="op" id="4131812">:=</span>&nbsp;<span class="ident" id="4131815">bytes</span><span class="op" id="4131820">.</span><span class="ident" id="4131821">Index</span><span class="op" id="4131826">(</span><span class="ident" id="4131827">rest</span><span class="op" id="4131831">,</span>&nbsp;<span class="ident" id="4131833">pemEnd</span><span class="op" id="4131839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4131842">if</span>&nbsp;<span class="ident" id="4131845">i</span>&nbsp;<span class="op" id="4131847">&lt;</span>&nbsp;<span class="num" id="4131849">0</span>&nbsp;<span class="op" id="4131851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4131855">return</span>&nbsp;<span class="ident" id="4131862">decodeError</span><span class="op" id="4131873">(</span><span class="ident" id="4131874">data</span><span class="op" id="4131878">,</span>&nbsp;<span class="ident" id="4131880">rest</span><span class="op" id="4131884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4131887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4131890">base64Data</span>&nbsp;<span class="op" id="4131901">:=</span>&nbsp;<span class="ident" id="4131904">removeWhitespace</span><span class="op" id="4131920">(</span><span class="ident" id="4131921">rest</span><span class="op" id="4131925">[</span><span class="num" id="4131926">0</span><span class="op" id="4131927">:</span><span class="ident" id="4131928">i</span><span class="op" id="4131929">]</span><span class="op" id="4131930">)</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4131934">p</span><span class="op" id="4131935">.</span><span class="ident" id="4131936">Bytes</span>&nbsp;<span class="op" id="4131942">=</span>&nbsp;<span class="builtinfunc" id="4131944">make</span><span class="op" id="4131948">(</span><span class="op" id="4131949">[</span><span class="op" id="4131950">]</span><span class="builtintype" id="4131951">byte</span><span class="op" id="4131955">,</span>&nbsp;<span class="ident" id="4131957">base64</span><span class="op" id="4131963">.</span><span class="ident" id="4131964">StdEncoding</span><span class="op" id="4131975">.</span><span class="ident" id="4131976">DecodedLen</span><span class="op" id="4131986">(</span><span class="builtinfunc" id="4131987">len</span><span class="op" id="4131990">(</span><span class="ident" id="4131991">base64Data</span><span class="op" id="4132001">)</span><span class="op" id="4132002">)</span><span class="op" id="4132003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4132006">n</span><span class="op" id="4132007">,</span>&nbsp;<span class="ident" id="4132009">err</span>&nbsp;<span class="op" id="4132013">:=</span>&nbsp;<span class="ident" id="4132016">base64</span><span class="op" id="4132022">.</span><span class="ident" id="4132023">StdEncoding</span><span class="op" id="4132034">.</span><span class="ident" id="4132035">Decode</span><span class="op" id="4132041">(</span><span class="ident" id="4132042">p</span><span class="op" id="4132043">.</span><span class="ident" id="4132044">Bytes</span><span class="op" id="4132049">,</span>&nbsp;<span class="ident" id="4132051">base64Data</span><span class="op" id="4132061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4132064">if</span>&nbsp;<span class="ident" id="4132067">err</span>&nbsp;<span class="op" id="4132071">!=</span>&nbsp;<span class="ident" id="4132074">nil</span>&nbsp;<span class="op" id="4132078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4132082">return</span>&nbsp;<span class="ident" id="4132089">decodeError</span><span class="op" id="4132100">(</span><span class="ident" id="4132101">data</span><span class="op" id="4132105">,</span>&nbsp;<span class="ident" id="4132107">rest</span><span class="op" id="4132111">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4132114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4132117">p</span><span class="op" id="4132118">.</span><span class="ident" id="4132119">Bytes</span>&nbsp;<span class="op" id="4132125">=</span>&nbsp;<span class="ident" id="4132127">p</span><span class="op" id="4132128">.</span><span class="ident" id="4132129">Bytes</span><span class="op" id="4132134">[</span><span class="num" id="4132135">0</span><span class="op" id="4132136">:</span><span class="ident" id="4132137">n</span><span class="op" id="4132138">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4132142">_</span><span class="op" id="4132143">,</span>&nbsp;<span class="ident" id="4132145">rest</span>&nbsp;<span class="op" id="4132150">=</span>&nbsp;<span class="ident" id="4132152">getLine</span><span class="op" id="4132159">(</span><span class="ident" id="4132160">rest</span><span class="op" id="4132164">[</span><span class="ident" id="4132165">i</span><span class="op" id="4132166">+</span><span class="builtinfunc" id="4132167">len</span><span class="op" id="4132170">(</span><span class="ident" id="4132171">pemEnd</span><span class="op" id="4132177">)</span><span class="op" id="4132178">:</span><span class="op" id="4132179">]</span><span class="op" id="4132180">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4132184">return</span><br>
<span class="lineno"></span><span class="op" id="4132191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4132194">func</span>&nbsp;<span class="ident" id="4132199">decodeError</span><span class="op" id="4132210">(</span><span class="ident" id="4132211">data</span><span class="op" id="4132215">,</span>&nbsp;<span class="ident" id="4132217">rest</span>&nbsp;<span class="op" id="4132222">[</span><span class="op" id="4132223">]</span><span class="builtintype" id="4132224">byte</span><span class="op" id="4132228">)</span>&nbsp;<span class="op" id="4132230">(</span><span class="op" id="4132231">*</span><span class="ident" id="4132232">Block</span><span class="op" id="4132237">,</span>&nbsp;<span class="op" id="4132239">[</span><span class="op" id="4132240">]</span><span class="builtintype" id="4132241">byte</span><span class="op" id="4132245">)</span>&nbsp;<span class="op" id="4132247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4132250">//&nbsp;If&nbsp;we&nbsp;get&nbsp;here&nbsp;then&nbsp;we&nbsp;have&nbsp;rejected&nbsp;a&nbsp;likely&nbsp;looking,&nbsp;but</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4132313">//&nbsp;ultimately&nbsp;invalid&nbsp;PEM&nbsp;block.&nbsp;We&nbsp;need&nbsp;to&nbsp;start&nbsp;over&nbsp;from&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4132380">//&nbsp;position.&nbsp;&nbsp;We&nbsp;have&nbsp;consumed&nbsp;the&nbsp;preamble&nbsp;line&nbsp;and&nbsp;will&nbsp;have&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4132453">//&nbsp;any&nbsp;lines&nbsp;which&nbsp;could&nbsp;be&nbsp;header&nbsp;lines.&nbsp;However,&nbsp;a&nbsp;valid&nbsp;preamble</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4132522">//&nbsp;line&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;header&nbsp;line,&nbsp;therefore&nbsp;we&nbsp;cannot&nbsp;have&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4132593">//&nbsp;the&nbsp;preamble&nbsp;line&nbsp;for&nbsp;the&nbsp;any&nbsp;subsequent&nbsp;block.&nbsp;Thus,&nbsp;we&nbsp;will&nbsp;always</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4132666">//&nbsp;find&nbsp;any&nbsp;valid&nbsp;block,&nbsp;no&nbsp;matter&nbsp;what&nbsp;bytes&nbsp;precede&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4132725">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4132729">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;the&nbsp;input&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4132762">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4132766">//&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;MALFORMED&nbsp;BLOCK-----</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4132805">//&nbsp;&nbsp;&nbsp;&nbsp;junk&nbsp;that&nbsp;may&nbsp;look&nbsp;like&nbsp;header&nbsp;lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4132849">//&nbsp;&nbsp;&nbsp;or&nbsp;data&nbsp;lines,&nbsp;but&nbsp;no&nbsp;END&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4132886">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4132890">//&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;ACTUAL&nbsp;BLOCK-----</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4132926">//&nbsp;&nbsp;&nbsp;&nbsp;realdata</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4132942">//&nbsp;&nbsp;&nbsp;&nbsp;-----END&nbsp;ACTUAL&nbsp;BLOCK-----</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4132976">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4132980">//&nbsp;we&#39;ve&nbsp;failed&nbsp;to&nbsp;parse&nbsp;using&nbsp;the&nbsp;first&nbsp;BEGIN&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4133033">//&nbsp;and&nbsp;now&nbsp;will&nbsp;try&nbsp;again,&nbsp;using&nbsp;the&nbsp;second&nbsp;BEGIN&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4133090">p</span><span class="op" id="4133091">,</span>&nbsp;<span class="ident" id="4133093">rest</span>&nbsp;<span class="op" id="4133098">:=</span>&nbsp;<span class="ident" id="4133101">Decode</span><span class="op" id="4133107">(</span><span class="ident" id="4133108">rest</span><span class="op" id="4133112">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4133115">if</span>&nbsp;<span class="ident" id="4133118">p</span>&nbsp;<span class="op" id="4133120">==</span>&nbsp;<span class="ident" id="4133123">nil</span>&nbsp;<span class="op" id="4133127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4133131">rest</span>&nbsp;<span class="op" id="4133136">=</span>&nbsp;<span class="ident" id="4133138">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4133144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4133147">return</span>&nbsp;<span class="ident" id="4133154">p</span><span class="op" id="4133155">,</span>&nbsp;<span class="ident" id="4133157">rest</span><br>
<span class="lineno"></span><span class="op" id="4133162">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="4133165">const</span>&nbsp;<span class="ident" id="4133171">pemLineLength</span>&nbsp;<span class="op" id="4133185">=</span>&nbsp;<span class="num" id="4133187">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4133191">type</span>&nbsp;<span class="ident" id="4133196">lineBreaker</span>&nbsp;<span class="keyword" id="4133208">struct</span>&nbsp;<span class="op" id="4133215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4133218">line</span>&nbsp;<span class="op" id="4133223">[</span><span class="ident" id="4133224">pemLineLength</span><span class="op" id="4133237">]</span><span class="builtintype" id="4133238">byte</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4133244">used</span>&nbsp;<span class="builtintype" id="4133249">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4133254">out</span>&nbsp;&nbsp;<span class="ident" id="4133259">io</span><span class="op" id="4133261">.</span><span class="ident" id="4133262">Writer</span><br>
<span class="lineno"></span><span class="op" id="4133269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4133272">func</span>&nbsp;<span class="op" id="4133277">(</span><span class="ident" id="4133278">l</span>&nbsp;<span class="op" id="4133280">*</span><span class="ident" id="4133281">lineBreaker</span><span class="op" id="4133292">)</span>&nbsp;<span class="ident" id="4133294">Write</span><span class="op" id="4133299">(</span><span class="ident" id="4133300">b</span>&nbsp;<span class="op" id="4133302">[</span><span class="op" id="4133303">]</span><span class="builtintype" id="4133304">byte</span><span class="op" id="4133308">)</span>&nbsp;<span class="op" id="4133310">(</span><span class="ident" id="4133311">n</span>&nbsp;<span class="builtintype" id="4133313">int</span><span class="op" id="4133316">,</span>&nbsp;<span class="ident" id="4133318">err</span>&nbsp;<span class="builtintype" id="4133322">error</span><span class="op" id="4133327">)</span>&nbsp;<span class="op" id="4133329">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4133332">if</span>&nbsp;<span class="ident" id="4133335">l</span><span class="op" id="4133336">.</span><span class="ident" id="4133337">used</span><span class="op" id="4133341">+</span><span class="builtinfunc" id="4133342">len</span><span class="op" id="4133345">(</span><span class="ident" id="4133346">b</span><span class="op" id="4133347">)</span>&nbsp;<span class="op" id="4133349">&lt;</span>&nbsp;<span class="ident" id="4133351">pemLineLength</span>&nbsp;<span class="op" id="4133365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4133369">copy</span><span class="op" id="4133373">(</span><span class="ident" id="4133374">l</span><span class="op" id="4133375">.</span><span class="ident" id="4133376">line</span><span class="op" id="4133380">[</span><span class="ident" id="4133381">l</span><span class="op" id="4133382">.</span><span class="ident" id="4133383">used</span><span class="op" id="4133387">:</span><span class="op" id="4133388">]</span><span class="op" id="4133389">,</span>&nbsp;<span class="ident" id="4133391">b</span><span class="op" id="4133392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4133396">l</span><span class="op" id="4133397">.</span><span class="ident" id="4133398">used</span>&nbsp;<span class="op" id="4133403">+=</span>&nbsp;<span class="builtinfunc" id="4133406">len</span><span class="op" id="4133409">(</span><span class="ident" id="4133410">b</span><span class="op" id="4133411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4133415">return</span>&nbsp;<span class="builtinfunc" id="4133422">len</span><span class="op" id="4133425">(</span><span class="ident" id="4133426">b</span><span class="op" id="4133427">)</span><span class="op" id="4133428">,</span>&nbsp;<span class="ident" id="4133430">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4133435">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4133439">n</span><span class="op" id="4133440">,</span>&nbsp;<span class="ident" id="4133442">err</span>&nbsp;<span class="op" id="4133446">=</span>&nbsp;<span class="ident" id="4133448">l</span><span class="op" id="4133449">.</span><span class="ident" id="4133450">out</span><span class="op" id="4133453">.</span><span class="ident" id="4133454">Write</span><span class="op" id="4133459">(</span><span class="ident" id="4133460">l</span><span class="op" id="4133461">.</span><span class="ident" id="4133462">line</span><span class="op" id="4133466">[</span><span class="num" id="4133467">0</span><span class="op" id="4133468">:</span><span class="ident" id="4133469">l</span><span class="op" id="4133470">.</span><span class="ident" id="4133471">used</span><span class="op" id="4133475">]</span><span class="op" id="4133476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4133479">if</span>&nbsp;<span class="ident" id="4133482">err</span>&nbsp;<span class="op" id="4133486">!=</span>&nbsp;<span class="ident" id="4133489">nil</span>&nbsp;<span class="op" id="4133493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4133497">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4133505">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4133508">excess</span>&nbsp;<span class="op" id="4133515">:=</span>&nbsp;<span class="ident" id="4133518">pemLineLength</span>&nbsp;<span class="op" id="4133532">-</span>&nbsp;<span class="ident" id="4133534">l</span><span class="op" id="4133535">.</span><span class="ident" id="4133536">used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4133542">l</span><span class="op" id="4133543">.</span><span class="ident" id="4133544">used</span>&nbsp;<span class="op" id="4133549">=</span>&nbsp;<span class="num" id="4133551">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4133555">n</span><span class="op" id="4133556">,</span>&nbsp;<span class="ident" id="4133558">err</span>&nbsp;<span class="op" id="4133562">=</span>&nbsp;<span class="ident" id="4133564">l</span><span class="op" id="4133565">.</span><span class="ident" id="4133566">out</span><span class="op" id="4133569">.</span><span class="ident" id="4133570">Write</span><span class="op" id="4133575">(</span><span class="ident" id="4133576">b</span><span class="op" id="4133577">[</span><span class="num" id="4133578">0</span><span class="op" id="4133579">:</span><span class="ident" id="4133580">excess</span><span class="op" id="4133586">]</span><span class="op" id="4133587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4133590">if</span>&nbsp;<span class="ident" id="4133593">err</span>&nbsp;<span class="op" id="4133597">!=</span>&nbsp;<span class="ident" id="4133600">nil</span>&nbsp;<span class="op" id="4133604">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4133608">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4133616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4133620">n</span><span class="op" id="4133621">,</span>&nbsp;<span class="ident" id="4133623">err</span>&nbsp;<span class="op" id="4133627">=</span>&nbsp;<span class="ident" id="4133629">l</span><span class="op" id="4133630">.</span><span class="ident" id="4133631">out</span><span class="op" id="4133634">.</span><span class="ident" id="4133635">Write</span><span class="op" id="4133640">(</span><span class="op" id="4133641">[</span><span class="op" id="4133642">]</span><span class="builtintype" id="4133643">byte</span><span class="op" id="4133647">{</span><span class="string" id="4133648">&#39;\n&#39;</span><span class="op" id="4133652">}</span><span class="op" id="4133653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4133656">if</span>&nbsp;<span class="ident" id="4133659">err</span>&nbsp;<span class="op" id="4133663">!=</span>&nbsp;<span class="ident" id="4133666">nil</span>&nbsp;<span class="op" id="4133670">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4133674">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4133682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4133686">return</span>&nbsp;<span class="ident" id="4133693">l</span><span class="op" id="4133694">.</span><span class="ident" id="4133695">Write</span><span class="op" id="4133700">(</span><span class="ident" id="4133701">b</span><span class="op" id="4133702">[</span><span class="ident" id="4133703">excess</span><span class="op" id="4133709">:</span><span class="op" id="4133710">]</span><span class="op" id="4133711">)</span><br>
<span class="lineno"></span><span class="op" id="4133713">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="4133716">func</span>&nbsp;<span class="op" id="4133721">(</span><span class="ident" id="4133722">l</span>&nbsp;<span class="op" id="4133724">*</span><span class="ident" id="4133725">lineBreaker</span><span class="op" id="4133736">)</span>&nbsp;<span class="ident" id="4133738">Close</span><span class="op" id="4133743">(</span><span class="op" id="4133744">)</span>&nbsp;<span class="op" id="4133746">(</span><span class="ident" id="4133747">err</span>&nbsp;<span class="builtintype" id="4133751">error</span><span class="op" id="4133756">)</span>&nbsp;<span class="op" id="4133758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4133761">if</span>&nbsp;<span class="ident" id="4133764">l</span><span class="op" id="4133765">.</span><span class="ident" id="4133766">used</span>&nbsp;<span class="op" id="4133771">&gt;</span>&nbsp;<span class="num" id="4133773">0</span>&nbsp;<span class="op" id="4133775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4133779">_</span><span class="op" id="4133780">,</span>&nbsp;<span class="ident" id="4133782">err</span>&nbsp;<span class="op" id="4133786">=</span>&nbsp;<span class="ident" id="4133788">l</span><span class="op" id="4133789">.</span><span class="ident" id="4133790">out</span><span class="op" id="4133793">.</span><span class="ident" id="4133794">Write</span><span class="op" id="4133799">(</span><span class="ident" id="4133800">l</span><span class="op" id="4133801">.</span><span class="ident" id="4133802">line</span><span class="op" id="4133806">[</span><span class="num" id="4133807">0</span><span class="op" id="4133808">:</span><span class="ident" id="4133809">l</span><span class="op" id="4133810">.</span><span class="ident" id="4133811">used</span><span class="op" id="4133815">]</span><span class="op" id="4133816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4133820">if</span>&nbsp;<span class="ident" id="4133823">err</span>&nbsp;<span class="op" id="4133827">!=</span>&nbsp;<span class="ident" id="4133830">nil</span>&nbsp;<span class="op" id="4133834">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4133839">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4133848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4133852">_</span><span class="op" id="4133853">,</span>&nbsp;<span class="ident" id="4133855">err</span>&nbsp;<span class="op" id="4133859">=</span>&nbsp;<span class="ident" id="4133861">l</span><span class="op" id="4133862">.</span><span class="ident" id="4133863">out</span><span class="op" id="4133866">.</span><span class="ident" id="4133867">Write</span><span class="op" id="4133872">(</span><span class="op" id="4133873">[</span><span class="op" id="4133874">]</span><span class="builtintype" id="4133875">byte</span><span class="op" id="4133879">{</span><span class="string" id="4133880">&#39;\n&#39;</span><span class="op" id="4133884">}</span><span class="op" id="4133885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4133888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4133892">return</span><br>
<span class="lineno"></span><span class="op" id="4133899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4133902">func</span>&nbsp;<span class="ident" id="4133907">writeHeader</span><span class="op" id="4133918">(</span><span class="ident" id="4133919">out</span>&nbsp;<span class="ident" id="4133923">io</span><span class="op" id="4133925">.</span><span class="ident" id="4133926">Writer</span><span class="op" id="4133932">,</span>&nbsp;<span class="ident" id="4133934">k</span><span class="op" id="4133935">,</span>&nbsp;<span class="ident" id="4133937">v</span>&nbsp;<span class="builtintype" id="4133939">string</span><span class="op" id="4133945">)</span>&nbsp;<span class="builtintype" id="4133947">error</span>&nbsp;<span class="op" id="4133953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4133956">_</span><span class="op" id="4133957">,</span>&nbsp;<span class="ident" id="4133959">err</span>&nbsp;<span class="op" id="4133963">:=</span>&nbsp;<span class="ident" id="4133966">out</span><span class="op" id="4133969">.</span><span class="ident" id="4133970">Write</span><span class="op" id="4133975">(</span><span class="op" id="4133976">[</span><span class="op" id="4133977">]</span><span class="builtintype" id="4133978">byte</span><span class="op" id="4133982">(</span><span class="ident" id="4133983">k</span>&nbsp;<span class="op" id="4133985">+</span>&nbsp;<span class="string" id="4133987">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="4133992">+</span>&nbsp;<span class="ident" id="4133994">v</span>&nbsp;<span class="op" id="4133996">+</span>&nbsp;<span class="string" id="4133998">&#34;\n&#34;</span><span class="op" id="4134002">)</span><span class="op" id="4134003">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4134006">return</span>&nbsp;<span class="ident" id="4134013">err</span><br>
<span class="lineno"></span><span class="op" id="4134017">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4134020">func</span>&nbsp;<span class="ident" id="4134025">Encode</span><span class="op" id="4134031">(</span><span class="ident" id="4134032">out</span>&nbsp;<span class="ident" id="4134036">io</span><span class="op" id="4134038">.</span><span class="ident" id="4134039">Writer</span><span class="op" id="4134045">,</span>&nbsp;<span class="ident" id="4134047">b</span>&nbsp;<span class="op" id="4134049">*</span><span class="ident" id="4134050">Block</span><span class="op" id="4134055">)</span>&nbsp;<span class="builtintype" id="4134057">error</span>&nbsp;<span class="op" id="4134063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4134066">if</span>&nbsp;<span class="ident" id="4134069">_</span><span class="op" id="4134070">,</span>&nbsp;<span class="ident" id="4134072">err</span>&nbsp;<span class="op" id="4134076">:=</span>&nbsp;<span class="ident" id="4134079">out</span><span class="op" id="4134082">.</span><span class="ident" id="4134083">Write</span><span class="op" id="4134088">(</span><span class="ident" id="4134089">pemStart</span><span class="op" id="4134097">[</span><span class="num" id="4134098">1</span><span class="op" id="4134099">:</span><span class="op" id="4134100">]</span><span class="op" id="4134101">)</span><span class="op" id="4134102">;</span>&nbsp;<span class="ident" id="4134104">err</span>&nbsp;<span class="op" id="4134108">!=</span>&nbsp;<span class="ident" id="4134111">nil</span>&nbsp;<span class="op" id="4134115">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4134119">return</span>&nbsp;<span class="ident" id="4134126">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4134131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4134134">if</span>&nbsp;<span class="ident" id="4134137">_</span><span class="op" id="4134138">,</span>&nbsp;<span class="ident" id="4134140">err</span>&nbsp;<span class="op" id="4134144">:=</span>&nbsp;<span class="ident" id="4134147">out</span><span class="op" id="4134150">.</span><span class="ident" id="4134151">Write</span><span class="op" id="4134156">(</span><span class="op" id="4134157">[</span><span class="op" id="4134158">]</span><span class="builtintype" id="4134159">byte</span><span class="op" id="4134163">(</span><span class="ident" id="4134164">b</span><span class="op" id="4134165">.</span><span class="ident" id="4134166">Type</span>&nbsp;<span class="op" id="4134171">+</span>&nbsp;<span class="string" id="4134173">&#34;-----\n&#34;</span><span class="op" id="4134182">)</span><span class="op" id="4134183">)</span><span class="op" id="4134184">;</span>&nbsp;<span class="ident" id="4134186">err</span>&nbsp;<span class="op" id="4134190">!=</span>&nbsp;<span class="ident" id="4134193">nil</span>&nbsp;<span class="op" id="4134197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4134201">return</span>&nbsp;<span class="ident" id="4134208">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4134213">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4134217">if</span>&nbsp;<span class="builtinfunc" id="4134220">len</span><span class="op" id="4134223">(</span><span class="ident" id="4134224">b</span><span class="op" id="4134225">.</span><span class="ident" id="4134226">Headers</span><span class="op" id="4134233">)</span>&nbsp;<span class="op" id="4134235">&gt;</span>&nbsp;<span class="num" id="4134237">0</span>&nbsp;<span class="op" id="4134239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4134243">const</span>&nbsp;<span class="ident" id="4134249">procType</span>&nbsp;<span class="op" id="4134258">=</span>&nbsp;<span class="string" id="4134260">&#34;Proc-Type&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4134274">h</span>&nbsp;<span class="op" id="4134276">:=</span>&nbsp;<span class="builtinfunc" id="4134279">make</span><span class="op" id="4134283">(</span><span class="op" id="4134284">[</span><span class="op" id="4134285">]</span><span class="builtintype" id="4134286">string</span><span class="op" id="4134292">,</span>&nbsp;<span class="num" id="4134294">0</span><span class="op" id="4134295">,</span>&nbsp;<span class="builtinfunc" id="4134297">len</span><span class="op" id="4134300">(</span><span class="ident" id="4134301">b</span><span class="op" id="4134302">.</span><span class="ident" id="4134303">Headers</span><span class="op" id="4134310">)</span><span class="op" id="4134311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4134315">hasProcType</span>&nbsp;<span class="op" id="4134327">:=</span>&nbsp;<span class="builtintype" id="4134330">false</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4134338">for</span>&nbsp;<span class="ident" id="4134342">k</span>&nbsp;<span class="op" id="4134344">:=</span>&nbsp;<span class="keyword" id="4134347">range</span>&nbsp;<span class="ident" id="4134353">b</span><span class="op" id="4134354">.</span><span class="ident" id="4134355">Headers</span>&nbsp;<span class="op" id="4134363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4134368">if</span>&nbsp;<span class="ident" id="4134371">k</span>&nbsp;<span class="op" id="4134373">==</span>&nbsp;<span class="ident" id="4134376">procType</span>&nbsp;<span class="op" id="4134385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4134391">hasProcType</span>&nbsp;<span class="op" id="4134403">=</span>&nbsp;<span class="builtintype" id="4134405">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4134414">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4134426">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4134431">h</span>&nbsp;<span class="op" id="4134433">=</span>&nbsp;<span class="builtinfunc" id="4134435">append</span><span class="op" id="4134441">(</span><span class="ident" id="4134442">h</span><span class="op" id="4134443">,</span>&nbsp;<span class="ident" id="4134445">k</span><span class="op" id="4134446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4134450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4134454">//&nbsp;The&nbsp;Proc-Type&nbsp;header&nbsp;must&nbsp;be&nbsp;written&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4134503">//&nbsp;See&nbsp;RFC&nbsp;1421,&nbsp;section&nbsp;4.6.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4134538">if</span>&nbsp;<span class="ident" id="4134541">hasProcType</span>&nbsp;<span class="op" id="4134553">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4134558">if</span>&nbsp;<span class="ident" id="4134561">err</span>&nbsp;<span class="op" id="4134565">:=</span>&nbsp;<span class="ident" id="4134568">writeHeader</span><span class="op" id="4134579">(</span><span class="ident" id="4134580">out</span><span class="op" id="4134583">,</span>&nbsp;<span class="ident" id="4134585">procType</span><span class="op" id="4134593">,</span>&nbsp;<span class="ident" id="4134595">b</span><span class="op" id="4134596">.</span><span class="ident" id="4134597">Headers</span><span class="op" id="4134604">[</span><span class="ident" id="4134605">procType</span><span class="op" id="4134613">]</span><span class="op" id="4134614">)</span><span class="op" id="4134615">;</span>&nbsp;<span class="ident" id="4134617">err</span>&nbsp;<span class="op" id="4134621">!=</span>&nbsp;<span class="ident" id="4134624">nil</span>&nbsp;<span class="op" id="4134628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4134634">return</span>&nbsp;<span class="ident" id="4134641">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4134648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4134652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4134656">//&nbsp;For&nbsp;consistency&nbsp;of&nbsp;output,&nbsp;write&nbsp;other&nbsp;headers&nbsp;sorted&nbsp;by&nbsp;key.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4134723">sort</span><span class="op" id="4134727">.</span><span class="ident" id="4134728">Strings</span><span class="op" id="4134735">(</span><span class="ident" id="4134736">h</span><span class="op" id="4134737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4134741">for</span>&nbsp;<span class="ident" id="4134745">_</span><span class="op" id="4134746">,</span>&nbsp;<span class="ident" id="4134748">k</span>&nbsp;<span class="op" id="4134750">:=</span>&nbsp;<span class="keyword" id="4134753">range</span>&nbsp;<span class="ident" id="4134759">h</span>&nbsp;<span class="op" id="4134761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4134766">if</span>&nbsp;<span class="ident" id="4134769">err</span>&nbsp;<span class="op" id="4134773">:=</span>&nbsp;<span class="ident" id="4134776">writeHeader</span><span class="op" id="4134787">(</span><span class="ident" id="4134788">out</span><span class="op" id="4134791">,</span>&nbsp;<span class="ident" id="4134793">k</span><span class="op" id="4134794">,</span>&nbsp;<span class="ident" id="4134796">b</span><span class="op" id="4134797">.</span><span class="ident" id="4134798">Headers</span><span class="op" id="4134805">[</span><span class="ident" id="4134806">k</span><span class="op" id="4134807">]</span><span class="op" id="4134808">)</span><span class="op" id="4134809">;</span>&nbsp;<span class="ident" id="4134811">err</span>&nbsp;<span class="op" id="4134815">!=</span>&nbsp;<span class="ident" id="4134818">nil</span>&nbsp;<span class="op" id="4134822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4134828">return</span>&nbsp;<span class="ident" id="4134835">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4134842">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4134846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4134850">if</span>&nbsp;<span class="ident" id="4134853">_</span><span class="op" id="4134854">,</span>&nbsp;<span class="ident" id="4134856">err</span>&nbsp;<span class="op" id="4134860">:=</span>&nbsp;<span class="ident" id="4134863">out</span><span class="op" id="4134866">.</span><span class="ident" id="4134867">Write</span><span class="op" id="4134872">(</span><span class="op" id="4134873">[</span><span class="op" id="4134874">]</span><span class="builtintype" id="4134875">byte</span><span class="op" id="4134879">{</span><span class="string" id="4134880">&#39;\n&#39;</span><span class="op" id="4134884">}</span><span class="op" id="4134885">)</span><span class="op" id="4134886">;</span>&nbsp;<span class="ident" id="4134888">err</span>&nbsp;<span class="op" id="4134892">!=</span>&nbsp;<span class="ident" id="4134895">nil</span>&nbsp;<span class="op" id="4134899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4134904">return</span>&nbsp;<span class="ident" id="4134911">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4134917">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4134920">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4134924">var</span>&nbsp;<span class="ident" id="4134928">breaker</span>&nbsp;<span class="ident" id="4134936">lineBreaker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4134949">breaker</span><span class="op" id="4134956">.</span><span class="ident" id="4134957">out</span>&nbsp;<span class="op" id="4134961">=</span>&nbsp;<span class="ident" id="4134963">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4134969">b64</span>&nbsp;<span class="op" id="4134973">:=</span>&nbsp;<span class="ident" id="4134976">base64</span><span class="op" id="4134982">.</span><span class="ident" id="4134983">NewEncoder</span><span class="op" id="4134993">(</span><span class="ident" id="4134994">base64</span><span class="op" id="4135000">.</span><span class="ident" id="4135001">StdEncoding</span><span class="op" id="4135012">,</span>&nbsp;<span class="op" id="4135014">&amp;</span><span class="ident" id="4135015">breaker</span><span class="op" id="4135022">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4135025">if</span>&nbsp;<span class="ident" id="4135028">_</span><span class="op" id="4135029">,</span>&nbsp;<span class="ident" id="4135031">err</span>&nbsp;<span class="op" id="4135035">:=</span>&nbsp;<span class="ident" id="4135038">b64</span><span class="op" id="4135041">.</span><span class="ident" id="4135042">Write</span><span class="op" id="4135047">(</span><span class="ident" id="4135048">b</span><span class="op" id="4135049">.</span><span class="ident" id="4135050">Bytes</span><span class="op" id="4135055">)</span><span class="op" id="4135056">;</span>&nbsp;<span class="ident" id="4135058">err</span>&nbsp;<span class="op" id="4135062">!=</span>&nbsp;<span class="ident" id="4135065">nil</span>&nbsp;<span class="op" id="4135069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4135073">return</span>&nbsp;<span class="ident" id="4135080">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4135085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4135088">b64</span><span class="op" id="4135091">.</span><span class="ident" id="4135092">Close</span><span class="op" id="4135097">(</span><span class="op" id="4135098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4135101">breaker</span><span class="op" id="4135108">.</span><span class="ident" id="4135109">Close</span><span class="op" id="4135114">(</span><span class="op" id="4135115">)</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4135119">if</span>&nbsp;<span class="ident" id="4135122">_</span><span class="op" id="4135123">,</span>&nbsp;<span class="ident" id="4135125">err</span>&nbsp;<span class="op" id="4135129">:=</span>&nbsp;<span class="ident" id="4135132">out</span><span class="op" id="4135135">.</span><span class="ident" id="4135136">Write</span><span class="op" id="4135141">(</span><span class="ident" id="4135142">pemEnd</span><span class="op" id="4135148">[</span><span class="num" id="4135149">1</span><span class="op" id="4135150">:</span><span class="op" id="4135151">]</span><span class="op" id="4135152">)</span><span class="op" id="4135153">;</span>&nbsp;<span class="ident" id="4135155">err</span>&nbsp;<span class="op" id="4135159">!=</span>&nbsp;<span class="ident" id="4135162">nil</span>&nbsp;<span class="op" id="4135166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4135170">return</span>&nbsp;<span class="ident" id="4135177">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4135182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4135185">_</span><span class="op" id="4135186">,</span>&nbsp;<span class="ident" id="4135188">err</span>&nbsp;<span class="op" id="4135192">:=</span>&nbsp;<span class="ident" id="4135195">out</span><span class="op" id="4135198">.</span><span class="ident" id="4135199">Write</span><span class="op" id="4135204">(</span><span class="op" id="4135205">[</span><span class="op" id="4135206">]</span><span class="builtintype" id="4135207">byte</span><span class="op" id="4135211">(</span><span class="ident" id="4135212">b</span><span class="op" id="4135213">.</span><span class="ident" id="4135214">Type</span>&nbsp;<span class="op" id="4135219">+</span>&nbsp;<span class="string" id="4135221">&#34;-----\n&#34;</span><span class="op" id="4135230">)</span><span class="op" id="4135231">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4135234">return</span>&nbsp;<span class="ident" id="4135241">err</span><br>
<span class="lineno"></span><span class="op" id="4135245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4135248">func</span>&nbsp;<span class="ident" id="4135253">EncodeToMemory</span><span class="op" id="4135267">(</span><span class="ident" id="4135268">b</span>&nbsp;<span class="op" id="4135270">*</span><span class="ident" id="4135271">Block</span><span class="op" id="4135276">)</span>&nbsp;<span class="op" id="4135278">[</span><span class="op" id="4135279">]</span><span class="builtintype" id="4135280">byte</span>&nbsp;<span class="op" id="4135285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4135288">var</span>&nbsp;<span class="ident" id="4135292">buf</span>&nbsp;<span class="ident" id="4135296">bytes</span><span class="op" id="4135301">.</span><span class="ident" id="4135302">Buffer</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4135310">Encode</span><span class="op" id="4135316">(</span><span class="op" id="4135317">&amp;</span><span class="ident" id="4135318">buf</span><span class="op" id="4135321">,</span>&nbsp;<span class="ident" id="4135323">b</span><span class="op" id="4135324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4135327">return</span>&nbsp;<span class="ident" id="4135334">buf</span><span class="op" id="4135337">.</span><span class="ident" id="4135338">Bytes</span><span class="op" id="4135343">(</span><span class="op" id="4135344">)</span><br>
<span class="lineno"></span><span class="op" id="4135346">}</span>
</div>
</body>
</html>
