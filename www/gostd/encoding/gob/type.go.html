<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4841901">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4841956">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4842010">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4842061">package</span>&nbsp;<span class="ident" id="4842069">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4842074">import</span>&nbsp;<span class="op" id="4842081">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4842084">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4842096">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4842106">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4842113">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4842119">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4842130">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4842138">&#34;sync/atomic&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4842153">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4842164">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4842179">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4842182">//&nbsp;userTypeInfo&nbsp;stores&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;a&nbsp;type&nbsp;the&nbsp;user&nbsp;has&nbsp;handed</span><br>
<span class="lineno">20</span><span class="comment" id="4842264">//&nbsp;to&nbsp;the&nbsp;package.&nbsp;&nbsp;It&#39;s&nbsp;computed&nbsp;once&nbsp;and&nbsp;stored&nbsp;in&nbsp;a&nbsp;map&nbsp;keyed&nbsp;by&nbsp;reflection</span><br>
<span class="lineno"></span><span class="comment" id="4842343">//&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="4842352">type</span>&nbsp;<span class="ident" id="4842357">userTypeInfo</span>&nbsp;<span class="keyword" id="4842370">struct</span>&nbsp;<span class="op" id="4842377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4842380">user</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4842392">reflect</span><span class="op" id="4842399">.</span><span class="ident" id="4842400">Type</span>&nbsp;<span class="comment" id="4842405">//&nbsp;the&nbsp;type&nbsp;the&nbsp;user&nbsp;handed&nbsp;us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4842437">base</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4842449">reflect</span><span class="op" id="4842456">.</span><span class="ident" id="4842457">Type</span>&nbsp;<span class="comment" id="4842462">//&nbsp;the&nbsp;base&nbsp;type&nbsp;after&nbsp;all&nbsp;indirections</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4842503">indir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4842515">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4842528">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;base&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4842578">externalEnc</span>&nbsp;<span class="builtintype" id="4842590">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4842603">//&nbsp;xGob,&nbsp;xBinary,&nbsp;or&nbsp;xText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4842631">externalDec</span>&nbsp;<span class="builtintype" id="4842643">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4842656">//&nbsp;xGob,&nbsp;xBinary&nbsp;or&nbsp;xText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4842683">encIndir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4842695">int8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4842708">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;receiver&nbsp;type;&nbsp;may&nbsp;be&nbsp;negative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4842779">decIndir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4842791">int8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4842804">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;receiver&nbsp;type;&nbsp;may&nbsp;be&nbsp;negative</span><br>
<span class="lineno">30</span><span class="op" id="4842874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4842877">//&nbsp;externalEncoding&nbsp;bits</span><br>
<span class="lineno"></span><span class="keyword" id="4842902">const</span>&nbsp;<span class="op" id="4842908">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4842911">xGob</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4842919">=</span>&nbsp;<span class="num" id="4842921">1</span>&nbsp;<span class="op" id="4842923">+</span>&nbsp;<span class="ident" id="4842925">iota</span>&nbsp;<span class="comment" id="4842930">//&nbsp;GobEncoder&nbsp;or&nbsp;GobDecoder</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4842959">xBinary</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4842978">//&nbsp;encoding.BinaryMarshaler&nbsp;or&nbsp;encoding.BinaryUnmarshaler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843037">xText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4843056">//&nbsp;encoding.TextMarshaler&nbsp;or&nbsp;encoding.TextUnmarshaler</span><br>
<span class="lineno"></span><span class="op" id="4843110">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4843113">var</span>&nbsp;<span class="op" id="4843117">(</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4843120">//&nbsp;Protected&nbsp;by&nbsp;an&nbsp;RWMutex&nbsp;because&nbsp;we&nbsp;read&nbsp;it&nbsp;a&nbsp;lot&nbsp;and&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4843183">//&nbsp;it&nbsp;only&nbsp;when&nbsp;we&nbsp;see&nbsp;a&nbsp;new&nbsp;type,&nbsp;typically&nbsp;when&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843245">userTypeLock</span>&nbsp;&nbsp;<span class="ident" id="4843259">sync</span><span class="op" id="4843263">.</span><span class="ident" id="4843264">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843273">userTypeCache</span>&nbsp;<span class="op" id="4843287">=</span>&nbsp;<span class="builtinfunc" id="4843289">make</span><span class="op" id="4843293">(</span><span class="keyword" id="4843294">map</span><span class="op" id="4843297">[</span><span class="ident" id="4843298">reflect</span><span class="op" id="4843305">.</span><span class="ident" id="4843306">Type</span><span class="op" id="4843310">]</span><span class="op" id="4843311">*</span><span class="ident" id="4843312">userTypeInfo</span><span class="op" id="4843324">)</span><br>
<span class="lineno"></span><span class="op" id="4843326">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="4843329">//&nbsp;validType&nbsp;returns,&nbsp;and&nbsp;saves,&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;user-provided&nbsp;type&nbsp;rt.</span><br>
<span class="lineno"></span><span class="comment" id="4843417">//&nbsp;If&nbsp;the&nbsp;user&nbsp;type&nbsp;is&nbsp;not&nbsp;valid,&nbsp;err&nbsp;will&nbsp;be&nbsp;non-nil.&nbsp;&nbsp;To&nbsp;be&nbsp;used&nbsp;when&nbsp;the&nbsp;error&nbsp;handler</span><br>
<span class="lineno"></span><span class="comment" id="4843507">//&nbsp;is&nbsp;not&nbsp;set&nbsp;up.</span><br>
<span class="lineno"></span><span class="keyword" id="4843525">func</span>&nbsp;<span class="ident" id="4843530">validUserType</span><span class="op" id="4843543">(</span><span class="ident" id="4843544">rt</span>&nbsp;<span class="ident" id="4843547">reflect</span><span class="op" id="4843554">.</span><span class="ident" id="4843555">Type</span><span class="op" id="4843559">)</span>&nbsp;<span class="op" id="4843561">(</span><span class="ident" id="4843562">ut</span>&nbsp;<span class="op" id="4843565">*</span><span class="ident" id="4843566">userTypeInfo</span><span class="op" id="4843578">,</span>&nbsp;<span class="ident" id="4843580">err</span>&nbsp;<span class="builtintype" id="4843584">error</span><span class="op" id="4843589">)</span>&nbsp;<span class="op" id="4843591">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843594">userTypeLock</span><span class="op" id="4843606">.</span><span class="ident" id="4843607">RLock</span><span class="op" id="4843612">(</span><span class="op" id="4843613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843616">ut</span>&nbsp;<span class="op" id="4843619">=</span>&nbsp;<span class="ident" id="4843621">userTypeCache</span><span class="op" id="4843634">[</span><span class="ident" id="4843635">rt</span><span class="op" id="4843637">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843640">userTypeLock</span><span class="op" id="4843652">.</span><span class="ident" id="4843653">RUnlock</span><span class="op" id="4843660">(</span><span class="op" id="4843661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4843664">if</span>&nbsp;<span class="ident" id="4843667">ut</span>&nbsp;<span class="op" id="4843670">!=</span>&nbsp;<span class="ident" id="4843673">nil</span>&nbsp;<span class="op" id="4843677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4843681">return</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4843689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4843692">//&nbsp;Now&nbsp;set&nbsp;the&nbsp;value&nbsp;under&nbsp;the&nbsp;write&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843736">userTypeLock</span><span class="op" id="4843748">.</span><span class="ident" id="4843749">Lock</span><span class="op" id="4843753">(</span><span class="op" id="4843754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4843757">defer</span>&nbsp;<span class="ident" id="4843763">userTypeLock</span><span class="op" id="4843775">.</span><span class="ident" id="4843776">Unlock</span><span class="op" id="4843782">(</span><span class="op" id="4843783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4843786">if</span>&nbsp;<span class="ident" id="4843789">ut</span>&nbsp;<span class="op" id="4843792">=</span>&nbsp;<span class="ident" id="4843794">userTypeCache</span><span class="op" id="4843807">[</span><span class="ident" id="4843808">rt</span><span class="op" id="4843810">]</span><span class="op" id="4843811">;</span>&nbsp;<span class="ident" id="4843813">ut</span>&nbsp;<span class="op" id="4843816">!=</span>&nbsp;<span class="ident" id="4843819">nil</span>&nbsp;<span class="op" id="4843823">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4843827">//&nbsp;Lost&nbsp;the&nbsp;race;&nbsp;not&nbsp;a&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4843862">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4843870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843873">ut</span>&nbsp;<span class="op" id="4843876">=</span>&nbsp;<span class="builtinfunc" id="4843878">new</span><span class="op" id="4843881">(</span><span class="ident" id="4843882">userTypeInfo</span><span class="op" id="4843894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843897">ut</span><span class="op" id="4843899">.</span><span class="ident" id="4843900">base</span>&nbsp;<span class="op" id="4843905">=</span>&nbsp;<span class="ident" id="4843907">rt</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4843911">ut</span><span class="op" id="4843913">.</span><span class="ident" id="4843914">user</span>&nbsp;<span class="op" id="4843919">=</span>&nbsp;<span class="ident" id="4843921">rt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4843925">//&nbsp;A&nbsp;type&nbsp;that&nbsp;is&nbsp;just&nbsp;a&nbsp;cycle&nbsp;of&nbsp;pointers&nbsp;(such&nbsp;as&nbsp;type&nbsp;T&nbsp;*T)&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4843996">//&nbsp;be&nbsp;represented&nbsp;in&nbsp;gobs,&nbsp;which&nbsp;need&nbsp;some&nbsp;concrete&nbsp;data.&nbsp;&nbsp;We&nbsp;use&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4844065">//&nbsp;cycle&nbsp;detection&nbsp;algorithm&nbsp;from&nbsp;Knuth,&nbsp;Vol&nbsp;2,&nbsp;Section&nbsp;3.1,&nbsp;Ex&nbsp;6,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4844133">//&nbsp;pp&nbsp;539-540.&nbsp;&nbsp;As&nbsp;we&nbsp;step&nbsp;through&nbsp;indirections,&nbsp;run&nbsp;another&nbsp;type&nbsp;at</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4844203">//&nbsp;half&nbsp;speed.&nbsp;If&nbsp;they&nbsp;meet&nbsp;up,&nbsp;there&#39;s&nbsp;a&nbsp;cycle.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4844253">slowpoke</span>&nbsp;<span class="op" id="4844262">:=</span>&nbsp;<span class="ident" id="4844265">ut</span><span class="op" id="4844267">.</span><span class="ident" id="4844268">base</span>&nbsp;<span class="comment" id="4844273">//&nbsp;walks&nbsp;half&nbsp;as&nbsp;fast&nbsp;as&nbsp;ut.base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4844307">for</span>&nbsp;<span class="op" id="4844311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4844315">pt</span>&nbsp;<span class="op" id="4844318">:=</span>&nbsp;<span class="ident" id="4844321">ut</span><span class="op" id="4844323">.</span><span class="ident" id="4844324">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4844331">if</span>&nbsp;<span class="ident" id="4844334">pt</span><span class="op" id="4844336">.</span><span class="ident" id="4844337">Kind</span><span class="op" id="4844341">(</span><span class="op" id="4844342">)</span>&nbsp;<span class="op" id="4844344">!=</span>&nbsp;<span class="ident" id="4844347">reflect</span><span class="op" id="4844354">.</span><span class="ident" id="4844355">Ptr</span>&nbsp;<span class="op" id="4844359">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4844364">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4844372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4844376">ut</span><span class="op" id="4844378">.</span><span class="ident" id="4844379">base</span>&nbsp;<span class="op" id="4844384">=</span>&nbsp;<span class="ident" id="4844386">pt</span><span class="op" id="4844388">.</span><span class="ident" id="4844389">Elem</span><span class="op" id="4844393">(</span><span class="op" id="4844394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4844398">if</span>&nbsp;<span class="ident" id="4844401">ut</span><span class="op" id="4844403">.</span><span class="ident" id="4844404">base</span>&nbsp;<span class="op" id="4844409">==</span>&nbsp;<span class="ident" id="4844412">slowpoke</span>&nbsp;<span class="op" id="4844421">{</span>&nbsp;<span class="comment" id="4844423">//&nbsp;ut.base&nbsp;lapped&nbsp;slowpoke</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4844453">//&nbsp;recursive&nbsp;pointer&nbsp;type.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4844483">return</span>&nbsp;<span class="ident" id="4844490">nil</span><span class="op" id="4844493">,</span>&nbsp;<span class="ident" id="4844495">errors</span><span class="op" id="4844501">.</span><span class="ident" id="4844502">New</span><span class="op" id="4844505">(</span><span class="string" id="4844506">&#34;can&#39;t&nbsp;represent&nbsp;recursive&nbsp;pointer&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4844548">+</span>&nbsp;<span class="ident" id="4844550">ut</span><span class="op" id="4844552">.</span><span class="ident" id="4844553">base</span><span class="op" id="4844557">.</span><span class="ident" id="4844558">String</span><span class="op" id="4844564">(</span><span class="op" id="4844565">)</span><span class="op" id="4844566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4844570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4844574">if</span>&nbsp;<span class="ident" id="4844577">ut</span><span class="op" id="4844579">.</span><span class="ident" id="4844580">indir</span><span class="op" id="4844585">%</span><span class="num" id="4844586">2</span>&nbsp;<span class="op" id="4844588">==</span>&nbsp;<span class="num" id="4844591">0</span>&nbsp;<span class="op" id="4844593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4844598">slowpoke</span>&nbsp;<span class="op" id="4844607">=</span>&nbsp;<span class="ident" id="4844609">slowpoke</span><span class="op" id="4844617">.</span><span class="ident" id="4844618">Elem</span><span class="op" id="4844622">(</span><span class="op" id="4844623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4844627">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4844631">ut</span><span class="op" id="4844633">.</span><span class="ident" id="4844634">indir</span><span class="op" id="4844639">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4844643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4844647">if</span>&nbsp;<span class="ident" id="4844650">ok</span><span class="op" id="4844652">,</span>&nbsp;<span class="ident" id="4844654">indir</span>&nbsp;<span class="op" id="4844660">:=</span>&nbsp;<span class="ident" id="4844663">implementsInterface</span><span class="op" id="4844682">(</span><span class="ident" id="4844683">ut</span><span class="op" id="4844685">.</span><span class="ident" id="4844686">user</span><span class="op" id="4844690">,</span>&nbsp;<span class="ident" id="4844692">gobEncoderInterfaceType</span><span class="op" id="4844715">)</span><span class="op" id="4844716">;</span>&nbsp;<span class="ident" id="4844718">ok</span>&nbsp;<span class="op" id="4844721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4844725">ut</span><span class="op" id="4844727">.</span><span class="ident" id="4844728">externalEnc</span><span class="op" id="4844739">,</span>&nbsp;<span class="ident" id="4844741">ut</span><span class="op" id="4844743">.</span><span class="ident" id="4844744">encIndir</span>&nbsp;<span class="op" id="4844753">=</span>&nbsp;<span class="ident" id="4844755">xGob</span><span class="op" id="4844759">,</span>&nbsp;<span class="ident" id="4844761">indir</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4844768">}</span>&nbsp;<span class="keyword" id="4844770">else</span>&nbsp;<span class="keyword" id="4844775">if</span>&nbsp;<span class="ident" id="4844778">ok</span><span class="op" id="4844780">,</span>&nbsp;<span class="ident" id="4844782">indir</span>&nbsp;<span class="op" id="4844788">:=</span>&nbsp;<span class="ident" id="4844791">implementsInterface</span><span class="op" id="4844810">(</span><span class="ident" id="4844811">ut</span><span class="op" id="4844813">.</span><span class="ident" id="4844814">user</span><span class="op" id="4844818">,</span>&nbsp;<span class="ident" id="4844820">binaryMarshalerInterfaceType</span><span class="op" id="4844848">)</span><span class="op" id="4844849">;</span>&nbsp;<span class="ident" id="4844851">ok</span>&nbsp;<span class="op" id="4844854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4844858">ut</span><span class="op" id="4844860">.</span><span class="ident" id="4844861">externalEnc</span><span class="op" id="4844872">,</span>&nbsp;<span class="ident" id="4844874">ut</span><span class="op" id="4844876">.</span><span class="ident" id="4844877">encIndir</span>&nbsp;<span class="op" id="4844886">=</span>&nbsp;<span class="ident" id="4844888">xBinary</span><span class="op" id="4844895">,</span>&nbsp;<span class="ident" id="4844897">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4844904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4844908">//&nbsp;NOTE(rsc):&nbsp;Would&nbsp;like&nbsp;to&nbsp;allow&nbsp;MarshalText&nbsp;here,&nbsp;but&nbsp;results&nbsp;in&nbsp;incompatibility</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4844992">//&nbsp;with&nbsp;older&nbsp;encodings&nbsp;for&nbsp;net.IP.&nbsp;See&nbsp;golang.org/issue/6760.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4845056">//&nbsp;}&nbsp;else&nbsp;if&nbsp;ok,&nbsp;indir&nbsp;:=&nbsp;implementsInterface(ut.user,&nbsp;textMarshalerInterfaceType);&nbsp;ok&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4845146">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsput.externalEnc,&nbsp;ut.encIndir&nbsp;=&nbsp;xText,&nbsp;indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4845194">//&nbsp;}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4845201">if</span>&nbsp;<span class="ident" id="4845204">ok</span><span class="op" id="4845206">,</span>&nbsp;<span class="ident" id="4845208">indir</span>&nbsp;<span class="op" id="4845214">:=</span>&nbsp;<span class="ident" id="4845217">implementsInterface</span><span class="op" id="4845236">(</span><span class="ident" id="4845237">ut</span><span class="op" id="4845239">.</span><span class="ident" id="4845240">user</span><span class="op" id="4845244">,</span>&nbsp;<span class="ident" id="4845246">gobDecoderInterfaceType</span><span class="op" id="4845269">)</span><span class="op" id="4845270">;</span>&nbsp;<span class="ident" id="4845272">ok</span>&nbsp;<span class="op" id="4845275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4845279">ut</span><span class="op" id="4845281">.</span><span class="ident" id="4845282">externalDec</span><span class="op" id="4845293">,</span>&nbsp;<span class="ident" id="4845295">ut</span><span class="op" id="4845297">.</span><span class="ident" id="4845298">decIndir</span>&nbsp;<span class="op" id="4845307">=</span>&nbsp;<span class="ident" id="4845309">xGob</span><span class="op" id="4845313">,</span>&nbsp;<span class="ident" id="4845315">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4845322">}</span>&nbsp;<span class="keyword" id="4845324">else</span>&nbsp;<span class="keyword" id="4845329">if</span>&nbsp;<span class="ident" id="4845332">ok</span><span class="op" id="4845334">,</span>&nbsp;<span class="ident" id="4845336">indir</span>&nbsp;<span class="op" id="4845342">:=</span>&nbsp;<span class="ident" id="4845345">implementsInterface</span><span class="op" id="4845364">(</span><span class="ident" id="4845365">ut</span><span class="op" id="4845367">.</span><span class="ident" id="4845368">user</span><span class="op" id="4845372">,</span>&nbsp;<span class="ident" id="4845374">binaryUnmarshalerInterfaceType</span><span class="op" id="4845404">)</span><span class="op" id="4845405">;</span>&nbsp;<span class="ident" id="4845407">ok</span>&nbsp;<span class="op" id="4845410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4845414">ut</span><span class="op" id="4845416">.</span><span class="ident" id="4845417">externalDec</span><span class="op" id="4845428">,</span>&nbsp;<span class="ident" id="4845430">ut</span><span class="op" id="4845432">.</span><span class="ident" id="4845433">decIndir</span>&nbsp;<span class="op" id="4845442">=</span>&nbsp;<span class="ident" id="4845444">xBinary</span><span class="op" id="4845451">,</span>&nbsp;<span class="ident" id="4845453">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4845460">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4845464">//&nbsp;See&nbsp;note&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4845484">//&nbsp;}&nbsp;else&nbsp;if&nbsp;ok,&nbsp;indir&nbsp;:=&nbsp;implementsInterface(ut.user,&nbsp;textUnmarshalerInterfaceType);&nbsp;ok&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4845576">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsput.externalDec,&nbsp;ut.decIndir&nbsp;=&nbsp;xText,&nbsp;indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4845624">//&nbsp;}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4845631">userTypeCache</span><span class="op" id="4845644">[</span><span class="ident" id="4845645">rt</span><span class="op" id="4845647">]</span>&nbsp;<span class="op" id="4845649">=</span>&nbsp;<span class="ident" id="4845651">ut</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4845655">return</span><br>
<span class="lineno"></span><span class="op" id="4845662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="4845665">var</span>&nbsp;<span class="op" id="4845669">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4845672">gobEncoderInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4845703">=</span>&nbsp;<span class="ident" id="4845705">reflect</span><span class="op" id="4845712">.</span><span class="ident" id="4845713">TypeOf</span><span class="op" id="4845719">(</span><span class="op" id="4845720">(</span><span class="op" id="4845721">*</span><span class="ident" id="4845722">GobEncoder</span><span class="op" id="4845732">)</span><span class="op" id="4845733">(</span><span class="ident" id="4845734">nil</span><span class="op" id="4845737">)</span><span class="op" id="4845738">)</span><span class="op" id="4845739">.</span><span class="ident" id="4845740">Elem</span><span class="op" id="4845744">(</span><span class="op" id="4845745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4845748">gobDecoderInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4845779">=</span>&nbsp;<span class="ident" id="4845781">reflect</span><span class="op" id="4845788">.</span><span class="ident" id="4845789">TypeOf</span><span class="op" id="4845795">(</span><span class="op" id="4845796">(</span><span class="op" id="4845797">*</span><span class="ident" id="4845798">GobDecoder</span><span class="op" id="4845808">)</span><span class="op" id="4845809">(</span><span class="ident" id="4845810">nil</span><span class="op" id="4845813">)</span><span class="op" id="4845814">)</span><span class="op" id="4845815">.</span><span class="ident" id="4845816">Elem</span><span class="op" id="4845820">(</span><span class="op" id="4845821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4845824">binaryMarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4845855">=</span>&nbsp;<span class="ident" id="4845857">reflect</span><span class="op" id="4845864">.</span><span class="ident" id="4845865">TypeOf</span><span class="op" id="4845871">(</span><span class="op" id="4845872">(</span><span class="op" id="4845873">*</span><span class="ident" id="4845874">encoding</span><span class="op" id="4845882">.</span><span class="ident" id="4845883">BinaryMarshaler</span><span class="op" id="4845898">)</span><span class="op" id="4845899">(</span><span class="ident" id="4845900">nil</span><span class="op" id="4845903">)</span><span class="op" id="4845904">)</span><span class="op" id="4845905">.</span><span class="ident" id="4845906">Elem</span><span class="op" id="4845910">(</span><span class="op" id="4845911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4845914">binaryUnmarshalerInterfaceType</span>&nbsp;<span class="op" id="4845945">=</span>&nbsp;<span class="ident" id="4845947">reflect</span><span class="op" id="4845954">.</span><span class="ident" id="4845955">TypeOf</span><span class="op" id="4845961">(</span><span class="op" id="4845962">(</span><span class="op" id="4845963">*</span><span class="ident" id="4845964">encoding</span><span class="op" id="4845972">.</span><span class="ident" id="4845973">BinaryUnmarshaler</span><span class="op" id="4845990">)</span><span class="op" id="4845991">(</span><span class="ident" id="4845992">nil</span><span class="op" id="4845995">)</span><span class="op" id="4845996">)</span><span class="op" id="4845997">.</span><span class="ident" id="4845998">Elem</span><span class="op" id="4846002">(</span><span class="op" id="4846003">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4846006">textMarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4846037">=</span>&nbsp;<span class="ident" id="4846039">reflect</span><span class="op" id="4846046">.</span><span class="ident" id="4846047">TypeOf</span><span class="op" id="4846053">(</span><span class="op" id="4846054">(</span><span class="op" id="4846055">*</span><span class="ident" id="4846056">encoding</span><span class="op" id="4846064">.</span><span class="ident" id="4846065">TextMarshaler</span><span class="op" id="4846078">)</span><span class="op" id="4846079">(</span><span class="ident" id="4846080">nil</span><span class="op" id="4846083">)</span><span class="op" id="4846084">)</span><span class="op" id="4846085">.</span><span class="ident" id="4846086">Elem</span><span class="op" id="4846090">(</span><span class="op" id="4846091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4846094">textUnmarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4846125">=</span>&nbsp;<span class="ident" id="4846127">reflect</span><span class="op" id="4846134">.</span><span class="ident" id="4846135">TypeOf</span><span class="op" id="4846141">(</span><span class="op" id="4846142">(</span><span class="op" id="4846143">*</span><span class="ident" id="4846144">encoding</span><span class="op" id="4846152">.</span><span class="ident" id="4846153">TextUnmarshaler</span><span class="op" id="4846168">)</span><span class="op" id="4846169">(</span><span class="ident" id="4846170">nil</span><span class="op" id="4846173">)</span><span class="op" id="4846174">)</span><span class="op" id="4846175">.</span><span class="ident" id="4846176">Elem</span><span class="op" id="4846180">(</span><span class="op" id="4846181">)</span><br>
<span class="lineno"></span><span class="op" id="4846183">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4846186">//&nbsp;implementsInterface&nbsp;reports&nbsp;whether&nbsp;the&nbsp;type&nbsp;implements&nbsp;the</span><br>
<span class="lineno">125</span><span class="comment" id="4846249">//&nbsp;gobEncoder/gobDecoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="4846285">//&nbsp;It&nbsp;also&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;indirections&nbsp;required&nbsp;to&nbsp;get&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4846354">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="4846373">func</span>&nbsp;<span class="ident" id="4846378">implementsInterface</span><span class="op" id="4846397">(</span><span class="ident" id="4846398">typ</span><span class="op" id="4846401">,</span>&nbsp;<span class="ident" id="4846403">gobEncDecType</span>&nbsp;<span class="ident" id="4846417">reflect</span><span class="op" id="4846424">.</span><span class="ident" id="4846425">Type</span><span class="op" id="4846429">)</span>&nbsp;<span class="op" id="4846431">(</span><span class="ident" id="4846432">success</span>&nbsp;<span class="builtintype" id="4846440">bool</span><span class="op" id="4846444">,</span>&nbsp;<span class="ident" id="4846446">indir</span>&nbsp;<span class="builtintype" id="4846452">int8</span><span class="op" id="4846456">)</span>&nbsp;<span class="op" id="4846458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4846461">if</span>&nbsp;<span class="ident" id="4846464">typ</span>&nbsp;<span class="op" id="4846468">==</span>&nbsp;<span class="ident" id="4846471">nil</span>&nbsp;<span class="op" id="4846475">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4846479">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4846487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4846490">rt</span>&nbsp;<span class="op" id="4846493">:=</span>&nbsp;<span class="ident" id="4846496">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4846501">//&nbsp;The&nbsp;type&nbsp;might&nbsp;be&nbsp;a&nbsp;pointer&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;keep</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4846553">//&nbsp;dereferencing&nbsp;to&nbsp;the&nbsp;base&nbsp;type&nbsp;until&nbsp;we&nbsp;find&nbsp;an&nbsp;implementation.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4846621">for</span>&nbsp;<span class="op" id="4846625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4846629">if</span>&nbsp;<span class="ident" id="4846632">rt</span><span class="op" id="4846634">.</span><span class="ident" id="4846635">Implements</span><span class="op" id="4846645">(</span><span class="ident" id="4846646">gobEncDecType</span><span class="op" id="4846659">)</span>&nbsp;<span class="op" id="4846661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4846666">return</span>&nbsp;<span class="builtintype" id="4846673">true</span><span class="op" id="4846677">,</span>&nbsp;<span class="ident" id="4846679">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4846687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4846691">if</span>&nbsp;<span class="ident" id="4846694">p</span>&nbsp;<span class="op" id="4846696">:=</span>&nbsp;<span class="ident" id="4846699">rt</span><span class="op" id="4846701">;</span>&nbsp;<span class="ident" id="4846703">p</span><span class="op" id="4846704">.</span><span class="ident" id="4846705">Kind</span><span class="op" id="4846709">(</span><span class="op" id="4846710">)</span>&nbsp;<span class="op" id="4846712">==</span>&nbsp;<span class="ident" id="4846715">reflect</span><span class="op" id="4846722">.</span><span class="ident" id="4846723">Ptr</span>&nbsp;<span class="op" id="4846727">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4846732">indir</span><span class="op" id="4846737">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4846743">if</span>&nbsp;<span class="ident" id="4846746">indir</span>&nbsp;<span class="op" id="4846752">&gt;</span>&nbsp;<span class="num" id="4846754">100</span>&nbsp;<span class="op" id="4846758">{</span>&nbsp;<span class="comment" id="4846760">//&nbsp;insane&nbsp;number&nbsp;of&nbsp;indirections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4846797">return</span>&nbsp;<span class="builtintype" id="4846804">false</span><span class="op" id="4846809">,</span>&nbsp;<span class="num" id="4846811">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4846816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4846821">rt</span>&nbsp;<span class="op" id="4846824">=</span>&nbsp;<span class="ident" id="4846826">p</span><span class="op" id="4846827">.</span><span class="ident" id="4846828">Elem</span><span class="op" id="4846832">(</span><span class="op" id="4846833">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4846838">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4846849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4846853">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4846860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4846863">//&nbsp;No&nbsp;luck&nbsp;yet,&nbsp;but&nbsp;if&nbsp;this&nbsp;is&nbsp;a&nbsp;base&nbsp;type&nbsp;(non-pointer),&nbsp;the&nbsp;pointer&nbsp;might&nbsp;satisfy.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4846949">if</span>&nbsp;<span class="ident" id="4846952">typ</span><span class="op" id="4846955">.</span><span class="ident" id="4846956">Kind</span><span class="op" id="4846960">(</span><span class="op" id="4846961">)</span>&nbsp;<span class="op" id="4846963">!=</span>&nbsp;<span class="ident" id="4846966">reflect</span><span class="op" id="4846973">.</span><span class="ident" id="4846974">Ptr</span>&nbsp;<span class="op" id="4846978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4846982">//&nbsp;Not&nbsp;a&nbsp;pointer,&nbsp;but&nbsp;does&nbsp;the&nbsp;pointer&nbsp;work?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4847029">if</span>&nbsp;<span class="ident" id="4847032">reflect</span><span class="op" id="4847039">.</span><span class="ident" id="4847040">PtrTo</span><span class="op" id="4847045">(</span><span class="ident" id="4847046">typ</span><span class="op" id="4847049">)</span><span class="op" id="4847050">.</span><span class="ident" id="4847051">Implements</span><span class="op" id="4847061">(</span><span class="ident" id="4847062">gobEncDecType</span><span class="op" id="4847075">)</span>&nbsp;<span class="op" id="4847077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4847082">return</span>&nbsp;<span class="builtintype" id="4847089">true</span><span class="op" id="4847093">,</span>&nbsp;<span class="op" id="4847095">-</span><span class="num" id="4847096">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4847100">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4847103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4847106">return</span>&nbsp;<span class="builtintype" id="4847113">false</span><span class="op" id="4847118">,</span>&nbsp;<span class="num" id="4847120">0</span><br>
<span class="lineno"></span><span class="op" id="4847122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4847125">//&nbsp;userType&nbsp;returns,&nbsp;and&nbsp;saves,&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;user-provided&nbsp;type&nbsp;rt.</span><br>
<span class="lineno">160</span><span class="comment" id="4847212">//&nbsp;If&nbsp;the&nbsp;user&nbsp;type&nbsp;is&nbsp;not&nbsp;valid,&nbsp;it&nbsp;calls&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="4847262">func</span>&nbsp;<span class="ident" id="4847267">userType</span><span class="op" id="4847275">(</span><span class="ident" id="4847276">rt</span>&nbsp;<span class="ident" id="4847279">reflect</span><span class="op" id="4847286">.</span><span class="ident" id="4847287">Type</span><span class="op" id="4847291">)</span>&nbsp;<span class="op" id="4847293">*</span><span class="ident" id="4847294">userTypeInfo</span>&nbsp;<span class="op" id="4847307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847310">ut</span><span class="op" id="4847312">,</span>&nbsp;<span class="ident" id="4847314">err</span>&nbsp;<span class="op" id="4847318">:=</span>&nbsp;<span class="ident" id="4847321">validUserType</span><span class="op" id="4847334">(</span><span class="ident" id="4847335">rt</span><span class="op" id="4847337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4847340">if</span>&nbsp;<span class="ident" id="4847343">err</span>&nbsp;<span class="op" id="4847347">!=</span>&nbsp;<span class="ident" id="4847350">nil</span>&nbsp;<span class="op" id="4847354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847358">error_</span><span class="op" id="4847364">(</span><span class="ident" id="4847365">err</span><span class="op" id="4847368">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4847371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4847374">return</span>&nbsp;<span class="ident" id="4847381">ut</span><br>
<span class="lineno"></span><span class="op" id="4847384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4847387">//&nbsp;A&nbsp;typeId&nbsp;represents&nbsp;a&nbsp;gob&nbsp;Type&nbsp;as&nbsp;an&nbsp;integer&nbsp;that&nbsp;can&nbsp;be&nbsp;passed&nbsp;on&nbsp;the&nbsp;wire.</span><br>
<span class="lineno">170</span><span class="comment" id="4847467">//&nbsp;Internally,&nbsp;typeIds&nbsp;are&nbsp;used&nbsp;as&nbsp;keys&nbsp;to&nbsp;a&nbsp;map&nbsp;to&nbsp;recover&nbsp;the&nbsp;underlying&nbsp;type&nbsp;info.</span><br>
<span class="lineno"></span><span class="keyword" id="4847553">type</span>&nbsp;<span class="ident" id="4847558">typeId</span>&nbsp;<span class="builtintype" id="4847565">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4847572">var</span>&nbsp;<span class="ident" id="4847576">nextId</span>&nbsp;<span class="ident" id="4847583">typeId</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4847596">//&nbsp;incremented&nbsp;for&nbsp;each&nbsp;new&nbsp;type&nbsp;we&nbsp;build</span><br>
<span class="lineno"></span><span class="keyword" id="4847638">var</span>&nbsp;<span class="ident" id="4847642">typeLock</span>&nbsp;<span class="ident" id="4847651">sync</span><span class="op" id="4847655">.</span><span class="ident" id="4847656">Mutex</span>&nbsp;<span class="comment" id="4847662">//&nbsp;set&nbsp;while&nbsp;building&nbsp;a&nbsp;type</span><br>
<span class="lineno">175</span><span class="keyword" id="4847691">const</span>&nbsp;<span class="ident" id="4847697">firstUserId</span>&nbsp;<span class="op" id="4847709">=</span>&nbsp;<span class="num" id="4847711">64</span>&nbsp;&nbsp;<span class="comment" id="4847715">//&nbsp;lowest&nbsp;id&nbsp;number&nbsp;granted&nbsp;to&nbsp;user</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4847752">type</span>&nbsp;<span class="ident" id="4847757">gobType</span>&nbsp;<span class="keyword" id="4847765">interface</span>&nbsp;<span class="op" id="4847775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847778">id</span><span class="op" id="4847780">(</span><span class="op" id="4847781">)</span>&nbsp;<span class="ident" id="4847783">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847791">setId</span><span class="op" id="4847796">(</span><span class="ident" id="4847797">id</span>&nbsp;<span class="ident" id="4847800">typeId</span><span class="op" id="4847806">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847809">name</span><span class="op" id="4847813">(</span><span class="op" id="4847814">)</span>&nbsp;<span class="builtintype" id="4847816">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4847824">string</span><span class="op" id="4847830">(</span><span class="op" id="4847831">)</span>&nbsp;<span class="builtintype" id="4847833">string</span>&nbsp;<span class="comment" id="4847840">//&nbsp;not&nbsp;public;&nbsp;only&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4847875">safeString</span><span class="op" id="4847885">(</span><span class="ident" id="4847886">seen</span>&nbsp;<span class="keyword" id="4847891">map</span><span class="op" id="4847894">[</span><span class="ident" id="4847895">typeId</span><span class="op" id="4847901">]</span><span class="builtintype" id="4847902">bool</span><span class="op" id="4847906">)</span>&nbsp;<span class="builtintype" id="4847908">string</span><br>
<span class="lineno"></span><span class="op" id="4847915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="4847918">var</span>&nbsp;<span class="ident" id="4847922">types</span>&nbsp;<span class="op" id="4847928">=</span>&nbsp;<span class="builtinfunc" id="4847930">make</span><span class="op" id="4847934">(</span><span class="keyword" id="4847935">map</span><span class="op" id="4847938">[</span><span class="ident" id="4847939">reflect</span><span class="op" id="4847946">.</span><span class="ident" id="4847947">Type</span><span class="op" id="4847951">]</span><span class="ident" id="4847952">gobType</span><span class="op" id="4847959">)</span><br>
<span class="lineno"></span><span class="keyword" id="4847961">var</span>&nbsp;<span class="ident" id="4847965">idToType</span>&nbsp;<span class="op" id="4847974">=</span>&nbsp;<span class="builtinfunc" id="4847976">make</span><span class="op" id="4847980">(</span><span class="keyword" id="4847981">map</span><span class="op" id="4847984">[</span><span class="ident" id="4847985">typeId</span><span class="op" id="4847991">]</span><span class="ident" id="4847992">gobType</span><span class="op" id="4847999">)</span><br>
<span class="lineno"></span><span class="keyword" id="4848001">var</span>&nbsp;<span class="ident" id="4848005">builtinIdToType</span>&nbsp;<span class="keyword" id="4848021">map</span><span class="op" id="4848024">[</span><span class="ident" id="4848025">typeId</span><span class="op" id="4848031">]</span><span class="ident" id="4848032">gobType</span>&nbsp;<span class="comment" id="4848040">//&nbsp;set&nbsp;in&nbsp;init()&nbsp;after&nbsp;builtins&nbsp;are&nbsp;established</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4848089">func</span>&nbsp;<span class="ident" id="4848094">setTypeId</span><span class="op" id="4848103">(</span><span class="ident" id="4848104">typ</span>&nbsp;<span class="ident" id="4848108">gobType</span><span class="op" id="4848115">)</span>&nbsp;<span class="op" id="4848117">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4848120">//&nbsp;When&nbsp;building&nbsp;recursive&nbsp;types,&nbsp;someone&nbsp;may&nbsp;get&nbsp;there&nbsp;before&nbsp;us.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848188">if</span>&nbsp;<span class="ident" id="4848191">typ</span><span class="op" id="4848194">.</span><span class="ident" id="4848195">id</span><span class="op" id="4848197">(</span><span class="op" id="4848198">)</span>&nbsp;<span class="op" id="4848200">!=</span>&nbsp;<span class="num" id="4848203">0</span>&nbsp;<span class="op" id="4848205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848209">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4848217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4848220">nextId</span><span class="op" id="4848226">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4848230">typ</span><span class="op" id="4848233">.</span><span class="ident" id="4848234">setId</span><span class="op" id="4848239">(</span><span class="ident" id="4848240">nextId</span><span class="op" id="4848246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4848249">idToType</span><span class="op" id="4848257">[</span><span class="ident" id="4848258">nextId</span><span class="op" id="4848264">]</span>&nbsp;<span class="op" id="4848266">=</span>&nbsp;<span class="ident" id="4848268">typ</span><br>
<span class="lineno"></span><span class="op" id="4848272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4848275">func</span>&nbsp;<span class="op" id="4848280">(</span><span class="ident" id="4848281">t</span>&nbsp;<span class="ident" id="4848283">typeId</span><span class="op" id="4848289">)</span>&nbsp;<span class="ident" id="4848291">gobType</span><span class="op" id="4848298">(</span><span class="op" id="4848299">)</span>&nbsp;<span class="ident" id="4848301">gobType</span>&nbsp;<span class="op" id="4848309">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848312">if</span>&nbsp;<span class="ident" id="4848315">t</span>&nbsp;<span class="op" id="4848317">==</span>&nbsp;<span class="num" id="4848320">0</span>&nbsp;<span class="op" id="4848322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848326">return</span>&nbsp;<span class="ident" id="4848333">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4848338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848341">return</span>&nbsp;<span class="ident" id="4848348">idToType</span><span class="op" id="4848356">[</span><span class="ident" id="4848357">t</span><span class="op" id="4848358">]</span><br>
<span class="lineno"></span><span class="op" id="4848360">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="comment" id="4848363">//&nbsp;string&nbsp;returns&nbsp;the&nbsp;string&nbsp;representation&nbsp;of&nbsp;the&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;typeId.</span><br>
<span class="lineno"></span><span class="keyword" id="4848447">func</span>&nbsp;<span class="op" id="4848452">(</span><span class="ident" id="4848453">t</span>&nbsp;<span class="ident" id="4848455">typeId</span><span class="op" id="4848461">)</span>&nbsp;<span class="builtintype" id="4848463">string</span><span class="op" id="4848469">(</span><span class="op" id="4848470">)</span>&nbsp;<span class="builtintype" id="4848472">string</span>&nbsp;<span class="op" id="4848479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848482">if</span>&nbsp;<span class="ident" id="4848485">t</span><span class="op" id="4848486">.</span><span class="ident" id="4848487">gobType</span><span class="op" id="4848494">(</span><span class="op" id="4848495">)</span>&nbsp;<span class="op" id="4848497">==</span>&nbsp;<span class="ident" id="4848500">nil</span>&nbsp;<span class="op" id="4848504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848508">return</span>&nbsp;<span class="string" id="4848515">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4848524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848527">return</span>&nbsp;<span class="ident" id="4848534">t</span><span class="op" id="4848535">.</span><span class="ident" id="4848536">gobType</span><span class="op" id="4848543">(</span><span class="op" id="4848544">)</span><span class="op" id="4848545">.</span><span class="builtintype" id="4848546">string</span><span class="op" id="4848552">(</span><span class="op" id="4848553">)</span><br>
<span class="lineno"></span><span class="op" id="4848555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4848558">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;typeId.</span><br>
<span class="lineno">215</span><span class="keyword" id="4848623">func</span>&nbsp;<span class="op" id="4848628">(</span><span class="ident" id="4848629">t</span>&nbsp;<span class="ident" id="4848631">typeId</span><span class="op" id="4848637">)</span>&nbsp;<span class="ident" id="4848639">name</span><span class="op" id="4848643">(</span><span class="op" id="4848644">)</span>&nbsp;<span class="builtintype" id="4848646">string</span>&nbsp;<span class="op" id="4848653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848656">if</span>&nbsp;<span class="ident" id="4848659">t</span><span class="op" id="4848660">.</span><span class="ident" id="4848661">gobType</span><span class="op" id="4848668">(</span><span class="op" id="4848669">)</span>&nbsp;<span class="op" id="4848671">==</span>&nbsp;<span class="ident" id="4848674">nil</span>&nbsp;<span class="op" id="4848678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848682">return</span>&nbsp;<span class="string" id="4848689">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4848698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4848701">return</span>&nbsp;<span class="ident" id="4848708">t</span><span class="op" id="4848709">.</span><span class="ident" id="4848710">gobType</span><span class="op" id="4848717">(</span><span class="op" id="4848718">)</span><span class="op" id="4848719">.</span><span class="ident" id="4848720">name</span><span class="op" id="4848724">(</span><span class="op" id="4848725">)</span><br>
<span class="lineno">220</span><span class="op" id="4848727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4848730">//&nbsp;CommonType&nbsp;holds&nbsp;elements&nbsp;of&nbsp;all&nbsp;types.</span><br>
<span class="lineno"></span><span class="comment" id="4848773">//&nbsp;It&nbsp;is&nbsp;a&nbsp;historical&nbsp;artifact,&nbsp;kept&nbsp;for&nbsp;binary&nbsp;compatibility&nbsp;and&nbsp;exported</span><br>
<span class="lineno"></span><span class="comment" id="4848848">//&nbsp;only&nbsp;for&nbsp;the&nbsp;benefit&nbsp;of&nbsp;the&nbsp;package&#39;s&nbsp;encoding&nbsp;of&nbsp;type&nbsp;descriptors.&nbsp;It&nbsp;is</span><br>
<span class="lineno">225</span><span class="comment" id="4848925">//&nbsp;not&nbsp;intended&nbsp;for&nbsp;direct&nbsp;use&nbsp;by&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="4848968">type</span>&nbsp;<span class="ident" id="4848973">CommonType</span>&nbsp;<span class="keyword" id="4848984">struct</span>&nbsp;<span class="op" id="4848991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4848994">Name</span>&nbsp;<span class="builtintype" id="4848999">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849007">Id</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4849012">typeId</span><br>
<span class="lineno"></span><span class="op" id="4849019">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="4849022">func</span>&nbsp;<span class="op" id="4849027">(</span><span class="ident" id="4849028">t</span>&nbsp;<span class="op" id="4849030">*</span><span class="ident" id="4849031">CommonType</span><span class="op" id="4849041">)</span>&nbsp;<span class="ident" id="4849043">id</span><span class="op" id="4849045">(</span><span class="op" id="4849046">)</span>&nbsp;<span class="ident" id="4849048">typeId</span>&nbsp;<span class="op" id="4849055">{</span>&nbsp;<span class="keyword" id="4849057">return</span>&nbsp;<span class="ident" id="4849064">t</span><span class="op" id="4849065">.</span><span class="ident" id="4849066">Id</span>&nbsp;<span class="op" id="4849069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4849072">func</span>&nbsp;<span class="op" id="4849077">(</span><span class="ident" id="4849078">t</span>&nbsp;<span class="op" id="4849080">*</span><span class="ident" id="4849081">CommonType</span><span class="op" id="4849091">)</span>&nbsp;<span class="ident" id="4849093">setId</span><span class="op" id="4849098">(</span><span class="ident" id="4849099">id</span>&nbsp;<span class="ident" id="4849102">typeId</span><span class="op" id="4849108">)</span>&nbsp;<span class="op" id="4849110">{</span>&nbsp;<span class="ident" id="4849112">t</span><span class="op" id="4849113">.</span><span class="ident" id="4849114">Id</span>&nbsp;<span class="op" id="4849117">=</span>&nbsp;<span class="ident" id="4849119">id</span>&nbsp;<span class="op" id="4849122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="4849125">func</span>&nbsp;<span class="op" id="4849130">(</span><span class="ident" id="4849131">t</span>&nbsp;<span class="op" id="4849133">*</span><span class="ident" id="4849134">CommonType</span><span class="op" id="4849144">)</span>&nbsp;<span class="builtintype" id="4849146">string</span><span class="op" id="4849152">(</span><span class="op" id="4849153">)</span>&nbsp;<span class="builtintype" id="4849155">string</span>&nbsp;<span class="op" id="4849162">{</span>&nbsp;<span class="keyword" id="4849164">return</span>&nbsp;<span class="ident" id="4849171">t</span><span class="op" id="4849172">.</span><span class="ident" id="4849173">Name</span>&nbsp;<span class="op" id="4849178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4849181">func</span>&nbsp;<span class="op" id="4849186">(</span><span class="ident" id="4849187">t</span>&nbsp;<span class="op" id="4849189">*</span><span class="ident" id="4849190">CommonType</span><span class="op" id="4849200">)</span>&nbsp;<span class="ident" id="4849202">safeString</span><span class="op" id="4849212">(</span><span class="ident" id="4849213">seen</span>&nbsp;<span class="keyword" id="4849218">map</span><span class="op" id="4849221">[</span><span class="ident" id="4849222">typeId</span><span class="op" id="4849228">]</span><span class="builtintype" id="4849229">bool</span><span class="op" id="4849233">)</span>&nbsp;<span class="builtintype" id="4849235">string</span>&nbsp;<span class="op" id="4849242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4849245">return</span>&nbsp;<span class="ident" id="4849252">t</span><span class="op" id="4849253">.</span><span class="ident" id="4849254">Name</span><br>
<span class="lineno"></span><span class="op" id="4849259">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="4849262">func</span>&nbsp;<span class="op" id="4849267">(</span><span class="ident" id="4849268">t</span>&nbsp;<span class="op" id="4849270">*</span><span class="ident" id="4849271">CommonType</span><span class="op" id="4849281">)</span>&nbsp;<span class="ident" id="4849283">name</span><span class="op" id="4849287">(</span><span class="op" id="4849288">)</span>&nbsp;<span class="builtintype" id="4849290">string</span>&nbsp;<span class="op" id="4849297">{</span>&nbsp;<span class="keyword" id="4849299">return</span>&nbsp;<span class="ident" id="4849306">t</span><span class="op" id="4849307">.</span><span class="ident" id="4849308">Name</span>&nbsp;<span class="op" id="4849313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4849316">//&nbsp;Create&nbsp;and&nbsp;check&nbsp;predefined&nbsp;types</span><br>
<span class="lineno"></span><span class="comment" id="4849353">//&nbsp;The&nbsp;string&nbsp;for&nbsp;tBytes&nbsp;is&nbsp;&#34;bytes&#34;&nbsp;not&nbsp;&#34;[]byte&#34;&nbsp;to&nbsp;signify&nbsp;its&nbsp;specialness.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="4849431">var</span>&nbsp;<span class="op" id="4849435">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4849438">//&nbsp;Primordial&nbsp;types,&nbsp;needed&nbsp;during&nbsp;initialization.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4849490">//&nbsp;Always&nbsp;passed&nbsp;as&nbsp;pointers&nbsp;so&nbsp;the&nbsp;interface{}&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4849544">//&nbsp;goes&nbsp;through&nbsp;without&nbsp;losing&nbsp;its&nbsp;interfaceness.</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849595">tBool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4849606">=</span>&nbsp;<span class="ident" id="4849608">bootstrapType</span><span class="op" id="4849621">(</span><span class="string" id="4849622">&#34;bool&#34;</span><span class="op" id="4849628">,</span>&nbsp;<span class="op" id="4849630">(</span><span class="op" id="4849631">*</span><span class="builtintype" id="4849632">bool</span><span class="op" id="4849636">)</span><span class="op" id="4849637">(</span><span class="ident" id="4849638">nil</span><span class="op" id="4849641">)</span><span class="op" id="4849642">,</span>&nbsp;<span class="num" id="4849644">1</span><span class="op" id="4849645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849648">tInt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4849659">=</span>&nbsp;<span class="ident" id="4849661">bootstrapType</span><span class="op" id="4849674">(</span><span class="string" id="4849675">&#34;int&#34;</span><span class="op" id="4849680">,</span>&nbsp;<span class="op" id="4849682">(</span><span class="op" id="4849683">*</span><span class="builtintype" id="4849684">int</span><span class="op" id="4849687">)</span><span class="op" id="4849688">(</span><span class="ident" id="4849689">nil</span><span class="op" id="4849692">)</span><span class="op" id="4849693">,</span>&nbsp;<span class="num" id="4849695">2</span><span class="op" id="4849696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849699">tUint</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4849710">=</span>&nbsp;<span class="ident" id="4849712">bootstrapType</span><span class="op" id="4849725">(</span><span class="string" id="4849726">&#34;uint&#34;</span><span class="op" id="4849732">,</span>&nbsp;<span class="op" id="4849734">(</span><span class="op" id="4849735">*</span><span class="builtintype" id="4849736">uint</span><span class="op" id="4849740">)</span><span class="op" id="4849741">(</span><span class="ident" id="4849742">nil</span><span class="op" id="4849745">)</span><span class="op" id="4849746">,</span>&nbsp;<span class="num" id="4849748">3</span><span class="op" id="4849749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849752">tFloat</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4849763">=</span>&nbsp;<span class="ident" id="4849765">bootstrapType</span><span class="op" id="4849778">(</span><span class="string" id="4849779">&#34;float&#34;</span><span class="op" id="4849786">,</span>&nbsp;<span class="op" id="4849788">(</span><span class="op" id="4849789">*</span><span class="builtintype" id="4849790">float64</span><span class="op" id="4849797">)</span><span class="op" id="4849798">(</span><span class="ident" id="4849799">nil</span><span class="op" id="4849802">)</span><span class="op" id="4849803">,</span>&nbsp;<span class="num" id="4849805">4</span><span class="op" id="4849806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849809">tBytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4849820">=</span>&nbsp;<span class="ident" id="4849822">bootstrapType</span><span class="op" id="4849835">(</span><span class="string" id="4849836">&#34;bytes&#34;</span><span class="op" id="4849843">,</span>&nbsp;<span class="op" id="4849845">(</span><span class="op" id="4849846">*</span><span class="op" id="4849847">[</span><span class="op" id="4849848">]</span><span class="builtintype" id="4849849">byte</span><span class="op" id="4849853">)</span><span class="op" id="4849854">(</span><span class="ident" id="4849855">nil</span><span class="op" id="4849858">)</span><span class="op" id="4849859">,</span>&nbsp;<span class="num" id="4849861">5</span><span class="op" id="4849862">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849865">tString</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4849876">=</span>&nbsp;<span class="ident" id="4849878">bootstrapType</span><span class="op" id="4849891">(</span><span class="string" id="4849892">&#34;string&#34;</span><span class="op" id="4849900">,</span>&nbsp;<span class="op" id="4849902">(</span><span class="op" id="4849903">*</span><span class="builtintype" id="4849904">string</span><span class="op" id="4849910">)</span><span class="op" id="4849911">(</span><span class="ident" id="4849912">nil</span><span class="op" id="4849915">)</span><span class="op" id="4849916">,</span>&nbsp;<span class="num" id="4849918">6</span><span class="op" id="4849919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849922">tComplex</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4849933">=</span>&nbsp;<span class="ident" id="4849935">bootstrapType</span><span class="op" id="4849948">(</span><span class="string" id="4849949">&#34;complex&#34;</span><span class="op" id="4849958">,</span>&nbsp;<span class="op" id="4849960">(</span><span class="op" id="4849961">*</span><span class="builtintype" id="4849962">complex128</span><span class="op" id="4849972">)</span><span class="op" id="4849973">(</span><span class="ident" id="4849974">nil</span><span class="op" id="4849977">)</span><span class="op" id="4849978">,</span>&nbsp;<span class="num" id="4849980">7</span><span class="op" id="4849981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4849984">tInterface</span>&nbsp;<span class="op" id="4849995">=</span>&nbsp;<span class="ident" id="4849997">bootstrapType</span><span class="op" id="4850010">(</span><span class="string" id="4850011">&#34;interface&#34;</span><span class="op" id="4850022">,</span>&nbsp;<span class="op" id="4850024">(</span><span class="op" id="4850025">*</span><span class="keyword" id="4850026">interface</span><span class="op" id="4850035">{</span><span class="op" id="4850036">}</span><span class="op" id="4850037">)</span><span class="op" id="4850038">(</span><span class="ident" id="4850039">nil</span><span class="op" id="4850042">)</span><span class="op" id="4850043">,</span>&nbsp;<span class="num" id="4850045">8</span><span class="op" id="4850046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4850049">//&nbsp;Reserve&nbsp;some&nbsp;Ids&nbsp;for&nbsp;compatible&nbsp;expansion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4850095">tReserved7</span>&nbsp;<span class="op" id="4850106">=</span>&nbsp;<span class="ident" id="4850108">bootstrapType</span><span class="op" id="4850121">(</span><span class="string" id="4850122">&#34;_reserved1&#34;</span><span class="op" id="4850134">,</span>&nbsp;<span class="op" id="4850136">(</span><span class="op" id="4850137">*</span><span class="keyword" id="4850138">struct</span><span class="op" id="4850144">{</span>&nbsp;<span class="ident" id="4850146">r7</span>&nbsp;<span class="builtintype" id="4850149">int</span>&nbsp;<span class="op" id="4850153">}</span><span class="op" id="4850154">)</span><span class="op" id="4850155">(</span><span class="ident" id="4850156">nil</span><span class="op" id="4850159">)</span><span class="op" id="4850160">,</span>&nbsp;<span class="num" id="4850162">9</span><span class="op" id="4850163">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4850166">tReserved6</span>&nbsp;<span class="op" id="4850177">=</span>&nbsp;<span class="ident" id="4850179">bootstrapType</span><span class="op" id="4850192">(</span><span class="string" id="4850193">&#34;_reserved1&#34;</span><span class="op" id="4850205">,</span>&nbsp;<span class="op" id="4850207">(</span><span class="op" id="4850208">*</span><span class="keyword" id="4850209">struct</span><span class="op" id="4850215">{</span>&nbsp;<span class="ident" id="4850217">r6</span>&nbsp;<span class="builtintype" id="4850220">int</span>&nbsp;<span class="op" id="4850224">}</span><span class="op" id="4850225">)</span><span class="op" id="4850226">(</span><span class="ident" id="4850227">nil</span><span class="op" id="4850230">)</span><span class="op" id="4850231">,</span>&nbsp;<span class="num" id="4850233">10</span><span class="op" id="4850235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4850238">tReserved5</span>&nbsp;<span class="op" id="4850249">=</span>&nbsp;<span class="ident" id="4850251">bootstrapType</span><span class="op" id="4850264">(</span><span class="string" id="4850265">&#34;_reserved1&#34;</span><span class="op" id="4850277">,</span>&nbsp;<span class="op" id="4850279">(</span><span class="op" id="4850280">*</span><span class="keyword" id="4850281">struct</span><span class="op" id="4850287">{</span>&nbsp;<span class="ident" id="4850289">r5</span>&nbsp;<span class="builtintype" id="4850292">int</span>&nbsp;<span class="op" id="4850296">}</span><span class="op" id="4850297">)</span><span class="op" id="4850298">(</span><span class="ident" id="4850299">nil</span><span class="op" id="4850302">)</span><span class="op" id="4850303">,</span>&nbsp;<span class="num" id="4850305">11</span><span class="op" id="4850307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4850310">tReserved4</span>&nbsp;<span class="op" id="4850321">=</span>&nbsp;<span class="ident" id="4850323">bootstrapType</span><span class="op" id="4850336">(</span><span class="string" id="4850337">&#34;_reserved1&#34;</span><span class="op" id="4850349">,</span>&nbsp;<span class="op" id="4850351">(</span><span class="op" id="4850352">*</span><span class="keyword" id="4850353">struct</span><span class="op" id="4850359">{</span>&nbsp;<span class="ident" id="4850361">r4</span>&nbsp;<span class="builtintype" id="4850364">int</span>&nbsp;<span class="op" id="4850368">}</span><span class="op" id="4850369">)</span><span class="op" id="4850370">(</span><span class="ident" id="4850371">nil</span><span class="op" id="4850374">)</span><span class="op" id="4850375">,</span>&nbsp;<span class="num" id="4850377">12</span><span class="op" id="4850379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4850382">tReserved3</span>&nbsp;<span class="op" id="4850393">=</span>&nbsp;<span class="ident" id="4850395">bootstrapType</span><span class="op" id="4850408">(</span><span class="string" id="4850409">&#34;_reserved1&#34;</span><span class="op" id="4850421">,</span>&nbsp;<span class="op" id="4850423">(</span><span class="op" id="4850424">*</span><span class="keyword" id="4850425">struct</span><span class="op" id="4850431">{</span>&nbsp;<span class="ident" id="4850433">r3</span>&nbsp;<span class="builtintype" id="4850436">int</span>&nbsp;<span class="op" id="4850440">}</span><span class="op" id="4850441">)</span><span class="op" id="4850442">(</span><span class="ident" id="4850443">nil</span><span class="op" id="4850446">)</span><span class="op" id="4850447">,</span>&nbsp;<span class="num" id="4850449">13</span><span class="op" id="4850451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4850454">tReserved2</span>&nbsp;<span class="op" id="4850465">=</span>&nbsp;<span class="ident" id="4850467">bootstrapType</span><span class="op" id="4850480">(</span><span class="string" id="4850481">&#34;_reserved1&#34;</span><span class="op" id="4850493">,</span>&nbsp;<span class="op" id="4850495">(</span><span class="op" id="4850496">*</span><span class="keyword" id="4850497">struct</span><span class="op" id="4850503">{</span>&nbsp;<span class="ident" id="4850505">r2</span>&nbsp;<span class="builtintype" id="4850508">int</span>&nbsp;<span class="op" id="4850512">}</span><span class="op" id="4850513">)</span><span class="op" id="4850514">(</span><span class="ident" id="4850515">nil</span><span class="op" id="4850518">)</span><span class="op" id="4850519">,</span>&nbsp;<span class="num" id="4850521">14</span><span class="op" id="4850523">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4850526">tReserved1</span>&nbsp;<span class="op" id="4850537">=</span>&nbsp;<span class="ident" id="4850539">bootstrapType</span><span class="op" id="4850552">(</span><span class="string" id="4850553">&#34;_reserved1&#34;</span><span class="op" id="4850565">,</span>&nbsp;<span class="op" id="4850567">(</span><span class="op" id="4850568">*</span><span class="keyword" id="4850569">struct</span><span class="op" id="4850575">{</span>&nbsp;<span class="ident" id="4850577">r1</span>&nbsp;<span class="builtintype" id="4850580">int</span>&nbsp;<span class="op" id="4850584">}</span><span class="op" id="4850585">)</span><span class="op" id="4850586">(</span><span class="ident" id="4850587">nil</span><span class="op" id="4850590">)</span><span class="op" id="4850591">,</span>&nbsp;<span class="num" id="4850593">15</span><span class="op" id="4850595">)</span><br>
<span class="lineno"></span><span class="op" id="4850597">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4850600">//&nbsp;Predefined&nbsp;because&nbsp;it&#39;s&nbsp;needed&nbsp;by&nbsp;the&nbsp;Decoder</span><br>
<span class="lineno"></span><span class="keyword" id="4850649">var</span>&nbsp;<span class="ident" id="4850653">tWireType</span>&nbsp;<span class="op" id="4850663">=</span>&nbsp;<span class="ident" id="4850665">mustGetTypeInfo</span><span class="op" id="4850680">(</span><span class="ident" id="4850681">reflect</span><span class="op" id="4850688">.</span><span class="ident" id="4850689">TypeOf</span><span class="op" id="4850695">(</span><span class="ident" id="4850696">wireType</span><span class="op" id="4850704">{</span><span class="op" id="4850705">}</span><span class="op" id="4850706">)</span><span class="op" id="4850707">)</span><span class="op" id="4850708">.</span><span class="ident" id="4850709">id</span><br>
<span class="lineno">270</span><span class="keyword" id="4850712">var</span>&nbsp;<span class="ident" id="4850716">wireTypeUserInfo</span>&nbsp;<span class="op" id="4850733">*</span><span class="ident" id="4850734">userTypeInfo</span>&nbsp;<span class="comment" id="4850747">//&nbsp;userTypeInfo&nbsp;of&nbsp;(*wireType)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4850779">func</span>&nbsp;<span class="ident" id="4850784">init</span><span class="op" id="4850788">(</span><span class="op" id="4850789">)</span>&nbsp;<span class="op" id="4850791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4850794">//&nbsp;Some&nbsp;magic&nbsp;numbers&nbsp;to&nbsp;make&nbsp;sure&nbsp;there&nbsp;are&nbsp;no&nbsp;surprises.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4850854">checkId</span><span class="op" id="4850861">(</span><span class="num" id="4850862">16</span><span class="op" id="4850864">,</span>&nbsp;<span class="ident" id="4850866">tWireType</span><span class="op" id="4850875">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4850878">checkId</span><span class="op" id="4850885">(</span><span class="num" id="4850886">17</span><span class="op" id="4850888">,</span>&nbsp;<span class="ident" id="4850890">mustGetTypeInfo</span><span class="op" id="4850905">(</span><span class="ident" id="4850906">reflect</span><span class="op" id="4850913">.</span><span class="ident" id="4850914">TypeOf</span><span class="op" id="4850920">(</span><span class="ident" id="4850921">arrayType</span><span class="op" id="4850930">{</span><span class="op" id="4850931">}</span><span class="op" id="4850932">)</span><span class="op" id="4850933">)</span><span class="op" id="4850934">.</span><span class="ident" id="4850935">id</span><span class="op" id="4850937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4850940">checkId</span><span class="op" id="4850947">(</span><span class="num" id="4850948">18</span><span class="op" id="4850950">,</span>&nbsp;<span class="ident" id="4850952">mustGetTypeInfo</span><span class="op" id="4850967">(</span><span class="ident" id="4850968">reflect</span><span class="op" id="4850975">.</span><span class="ident" id="4850976">TypeOf</span><span class="op" id="4850982">(</span><span class="ident" id="4850983">CommonType</span><span class="op" id="4850993">{</span><span class="op" id="4850994">}</span><span class="op" id="4850995">)</span><span class="op" id="4850996">)</span><span class="op" id="4850997">.</span><span class="ident" id="4850998">id</span><span class="op" id="4851000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851003">checkId</span><span class="op" id="4851010">(</span><span class="num" id="4851011">19</span><span class="op" id="4851013">,</span>&nbsp;<span class="ident" id="4851015">mustGetTypeInfo</span><span class="op" id="4851030">(</span><span class="ident" id="4851031">reflect</span><span class="op" id="4851038">.</span><span class="ident" id="4851039">TypeOf</span><span class="op" id="4851045">(</span><span class="ident" id="4851046">sliceType</span><span class="op" id="4851055">{</span><span class="op" id="4851056">}</span><span class="op" id="4851057">)</span><span class="op" id="4851058">)</span><span class="op" id="4851059">.</span><span class="ident" id="4851060">id</span><span class="op" id="4851062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851065">checkId</span><span class="op" id="4851072">(</span><span class="num" id="4851073">20</span><span class="op" id="4851075">,</span>&nbsp;<span class="ident" id="4851077">mustGetTypeInfo</span><span class="op" id="4851092">(</span><span class="ident" id="4851093">reflect</span><span class="op" id="4851100">.</span><span class="ident" id="4851101">TypeOf</span><span class="op" id="4851107">(</span><span class="ident" id="4851108">structType</span><span class="op" id="4851118">{</span><span class="op" id="4851119">}</span><span class="op" id="4851120">)</span><span class="op" id="4851121">)</span><span class="op" id="4851122">.</span><span class="ident" id="4851123">id</span><span class="op" id="4851125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851128">checkId</span><span class="op" id="4851135">(</span><span class="num" id="4851136">21</span><span class="op" id="4851138">,</span>&nbsp;<span class="ident" id="4851140">mustGetTypeInfo</span><span class="op" id="4851155">(</span><span class="ident" id="4851156">reflect</span><span class="op" id="4851163">.</span><span class="ident" id="4851164">TypeOf</span><span class="op" id="4851170">(</span><span class="ident" id="4851171">fieldType</span><span class="op" id="4851180">{</span><span class="op" id="4851181">}</span><span class="op" id="4851182">)</span><span class="op" id="4851183">)</span><span class="op" id="4851184">.</span><span class="ident" id="4851185">id</span><span class="op" id="4851187">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851190">checkId</span><span class="op" id="4851197">(</span><span class="num" id="4851198">23</span><span class="op" id="4851200">,</span>&nbsp;<span class="ident" id="4851202">mustGetTypeInfo</span><span class="op" id="4851217">(</span><span class="ident" id="4851218">reflect</span><span class="op" id="4851225">.</span><span class="ident" id="4851226">TypeOf</span><span class="op" id="4851232">(</span><span class="ident" id="4851233">mapType</span><span class="op" id="4851240">{</span><span class="op" id="4851241">}</span><span class="op" id="4851242">)</span><span class="op" id="4851243">)</span><span class="op" id="4851244">.</span><span class="ident" id="4851245">id</span><span class="op" id="4851247">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851251">builtinIdToType</span>&nbsp;<span class="op" id="4851267">=</span>&nbsp;<span class="builtinfunc" id="4851269">make</span><span class="op" id="4851273">(</span><span class="keyword" id="4851274">map</span><span class="op" id="4851277">[</span><span class="ident" id="4851278">typeId</span><span class="op" id="4851284">]</span><span class="ident" id="4851285">gobType</span><span class="op" id="4851292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4851295">for</span>&nbsp;<span class="ident" id="4851299">k</span><span class="op" id="4851300">,</span>&nbsp;<span class="ident" id="4851302">v</span>&nbsp;<span class="op" id="4851304">:=</span>&nbsp;<span class="keyword" id="4851307">range</span>&nbsp;<span class="ident" id="4851313">idToType</span>&nbsp;<span class="op" id="4851322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851326">builtinIdToType</span><span class="op" id="4851341">[</span><span class="ident" id="4851342">k</span><span class="op" id="4851343">]</span>&nbsp;<span class="op" id="4851345">=</span>&nbsp;<span class="ident" id="4851347">v</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4851350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4851354">//&nbsp;Move&nbsp;the&nbsp;id&nbsp;space&nbsp;upwards&nbsp;to&nbsp;allow&nbsp;for&nbsp;growth&nbsp;in&nbsp;the&nbsp;predefined&nbsp;world</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4851428">//&nbsp;without&nbsp;breaking&nbsp;existing&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4851465">if</span>&nbsp;<span class="ident" id="4851468">nextId</span>&nbsp;<span class="op" id="4851475">&gt;</span>&nbsp;<span class="ident" id="4851477">firstUserId</span>&nbsp;<span class="op" id="4851489">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4851493">panic</span><span class="op" id="4851498">(</span><span class="ident" id="4851499">fmt</span><span class="op" id="4851502">.</span><span class="ident" id="4851503">Sprintln</span><span class="op" id="4851511">(</span><span class="string" id="4851512">&#34;nextId&nbsp;too&nbsp;large:&#34;</span><span class="op" id="4851531">,</span>&nbsp;<span class="ident" id="4851533">nextId</span><span class="op" id="4851539">)</span><span class="op" id="4851540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4851543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851546">nextId</span>&nbsp;<span class="op" id="4851553">=</span>&nbsp;<span class="ident" id="4851555">firstUserId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851568">registerBasics</span><span class="op" id="4851582">(</span><span class="op" id="4851583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851586">wireTypeUserInfo</span>&nbsp;<span class="op" id="4851603">=</span>&nbsp;<span class="ident" id="4851605">userType</span><span class="op" id="4851613">(</span><span class="ident" id="4851614">reflect</span><span class="op" id="4851621">.</span><span class="ident" id="4851622">TypeOf</span><span class="op" id="4851628">(</span><span class="op" id="4851629">(</span><span class="op" id="4851630">*</span><span class="ident" id="4851631">wireType</span><span class="op" id="4851639">)</span><span class="op" id="4851640">(</span><span class="ident" id="4851641">nil</span><span class="op" id="4851644">)</span><span class="op" id="4851645">)</span><span class="op" id="4851646">)</span><br>
<span class="lineno">295</span><span class="op" id="4851648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4851651">//&nbsp;Array&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="4851665">type</span>&nbsp;<span class="ident" id="4851670">arrayType</span>&nbsp;<span class="keyword" id="4851680">struct</span>&nbsp;<span class="op" id="4851687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851690">CommonType</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851702">Elem</span>&nbsp;<span class="ident" id="4851707">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851715">Len</span>&nbsp;&nbsp;<span class="builtintype" id="4851720">int</span><br>
<span class="lineno"></span><span class="op" id="4851724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4851727">func</span>&nbsp;<span class="ident" id="4851732">newArrayType</span><span class="op" id="4851744">(</span><span class="ident" id="4851745">name</span>&nbsp;<span class="builtintype" id="4851750">string</span><span class="op" id="4851756">)</span>&nbsp;<span class="op" id="4851758">*</span><span class="ident" id="4851759">arrayType</span>&nbsp;<span class="op" id="4851769">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851772">a</span>&nbsp;<span class="op" id="4851774">:=</span>&nbsp;<span class="op" id="4851777">&amp;</span><span class="ident" id="4851778">arrayType</span><span class="op" id="4851787">{</span><span class="ident" id="4851788">CommonType</span><span class="op" id="4851798">{</span><span class="ident" id="4851799">Name</span><span class="op" id="4851803">:</span>&nbsp;<span class="ident" id="4851805">name</span><span class="op" id="4851809">}</span><span class="op" id="4851810">,</span>&nbsp;<span class="num" id="4851812">0</span><span class="op" id="4851813">,</span>&nbsp;<span class="num" id="4851815">0</span><span class="op" id="4851816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4851819">return</span>&nbsp;<span class="ident" id="4851826">a</span><br>
<span class="lineno"></span><span class="op" id="4851828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4851831">func</span>&nbsp;<span class="op" id="4851836">(</span><span class="ident" id="4851837">a</span>&nbsp;<span class="op" id="4851839">*</span><span class="ident" id="4851840">arrayType</span><span class="op" id="4851849">)</span>&nbsp;<span class="ident" id="4851851">init</span><span class="op" id="4851855">(</span><span class="ident" id="4851856">elem</span>&nbsp;<span class="ident" id="4851861">gobType</span><span class="op" id="4851868">,</span>&nbsp;<span class="builtinfunc" id="4851870">len</span>&nbsp;<span class="builtintype" id="4851874">int</span><span class="op" id="4851877">)</span>&nbsp;<span class="op" id="4851879">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4851882">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851957">setTypeId</span><span class="op" id="4851966">(</span><span class="ident" id="4851967">a</span><span class="op" id="4851968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851971">a</span><span class="op" id="4851972">.</span><span class="ident" id="4851973">Elem</span>&nbsp;<span class="op" id="4851978">=</span>&nbsp;<span class="ident" id="4851980">elem</span><span class="op" id="4851984">.</span><span class="ident" id="4851985">id</span><span class="op" id="4851987">(</span><span class="op" id="4851988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4851991">a</span><span class="op" id="4851992">.</span><span class="ident" id="4851993">Len</span>&nbsp;<span class="op" id="4851997">=</span>&nbsp;<span class="builtinfunc" id="4851999">len</span><br>
<span class="lineno"></span><span class="op" id="4852003">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="keyword" id="4852006">func</span>&nbsp;<span class="op" id="4852011">(</span><span class="ident" id="4852012">a</span>&nbsp;<span class="op" id="4852014">*</span><span class="ident" id="4852015">arrayType</span><span class="op" id="4852024">)</span>&nbsp;<span class="ident" id="4852026">safeString</span><span class="op" id="4852036">(</span><span class="ident" id="4852037">seen</span>&nbsp;<span class="keyword" id="4852042">map</span><span class="op" id="4852045">[</span><span class="ident" id="4852046">typeId</span><span class="op" id="4852052">]</span><span class="builtintype" id="4852053">bool</span><span class="op" id="4852057">)</span>&nbsp;<span class="builtintype" id="4852059">string</span>&nbsp;<span class="op" id="4852066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4852069">if</span>&nbsp;<span class="ident" id="4852072">seen</span><span class="op" id="4852076">[</span><span class="ident" id="4852077">a</span><span class="op" id="4852078">.</span><span class="ident" id="4852079">Id</span><span class="op" id="4852081">]</span>&nbsp;<span class="op" id="4852083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4852087">return</span>&nbsp;<span class="ident" id="4852094">a</span><span class="op" id="4852095">.</span><span class="ident" id="4852096">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4852102">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4852105">seen</span><span class="op" id="4852109">[</span><span class="ident" id="4852110">a</span><span class="op" id="4852111">.</span><span class="ident" id="4852112">Id</span><span class="op" id="4852114">]</span>&nbsp;<span class="op" id="4852116">=</span>&nbsp;<span class="builtintype" id="4852118">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4852124">return</span>&nbsp;<span class="ident" id="4852131">fmt</span><span class="op" id="4852134">.</span><span class="ident" id="4852135">Sprintf</span><span class="op" id="4852142">(</span><span class="string" id="4852143">&#34;[%d]%s&#34;</span><span class="op" id="4852151">,</span>&nbsp;<span class="ident" id="4852153">a</span><span class="op" id="4852154">.</span><span class="ident" id="4852155">Len</span><span class="op" id="4852158">,</span>&nbsp;<span class="ident" id="4852160">a</span><span class="op" id="4852161">.</span><span class="ident" id="4852162">Elem</span><span class="op" id="4852166">.</span><span class="ident" id="4852167">gobType</span><span class="op" id="4852174">(</span><span class="op" id="4852175">)</span><span class="op" id="4852176">.</span><span class="ident" id="4852177">safeString</span><span class="op" id="4852187">(</span><span class="ident" id="4852188">seen</span><span class="op" id="4852192">)</span><span class="op" id="4852193">)</span><br>
<span class="lineno"></span><span class="op" id="4852195">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4852198">func</span>&nbsp;<span class="op" id="4852203">(</span><span class="ident" id="4852204">a</span>&nbsp;<span class="op" id="4852206">*</span><span class="ident" id="4852207">arrayType</span><span class="op" id="4852216">)</span>&nbsp;<span class="builtintype" id="4852218">string</span><span class="op" id="4852224">(</span><span class="op" id="4852225">)</span>&nbsp;<span class="builtintype" id="4852227">string</span>&nbsp;<span class="op" id="4852234">{</span>&nbsp;<span class="keyword" id="4852236">return</span>&nbsp;<span class="ident" id="4852243">a</span><span class="op" id="4852244">.</span><span class="ident" id="4852245">safeString</span><span class="op" id="4852255">(</span><span class="builtinfunc" id="4852256">make</span><span class="op" id="4852260">(</span><span class="keyword" id="4852261">map</span><span class="op" id="4852264">[</span><span class="ident" id="4852265">typeId</span><span class="op" id="4852271">]</span><span class="builtintype" id="4852272">bool</span><span class="op" id="4852276">)</span><span class="op" id="4852277">)</span>&nbsp;<span class="op" id="4852279">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="4852282">//&nbsp;GobEncoder&nbsp;type&nbsp;(something&nbsp;that&nbsp;implements&nbsp;the&nbsp;GobEncoder&nbsp;interface)</span><br>
<span class="lineno"></span><span class="keyword" id="4852354">type</span>&nbsp;<span class="ident" id="4852359">gobEncoderType</span>&nbsp;<span class="keyword" id="4852374">struct</span>&nbsp;<span class="op" id="4852381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4852384">CommonType</span><br>
<span class="lineno"></span><span class="op" id="4852395">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="4852398">func</span>&nbsp;<span class="ident" id="4852403">newGobEncoderType</span><span class="op" id="4852420">(</span><span class="ident" id="4852421">name</span>&nbsp;<span class="builtintype" id="4852426">string</span><span class="op" id="4852432">)</span>&nbsp;<span class="op" id="4852434">*</span><span class="ident" id="4852435">gobEncoderType</span>&nbsp;<span class="op" id="4852450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4852453">g</span>&nbsp;<span class="op" id="4852455">:=</span>&nbsp;<span class="op" id="4852458">&amp;</span><span class="ident" id="4852459">gobEncoderType</span><span class="op" id="4852473">{</span><span class="ident" id="4852474">CommonType</span><span class="op" id="4852484">{</span><span class="ident" id="4852485">Name</span><span class="op" id="4852489">:</span>&nbsp;<span class="ident" id="4852491">name</span><span class="op" id="4852495">}</span><span class="op" id="4852496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4852499">setTypeId</span><span class="op" id="4852508">(</span><span class="ident" id="4852509">g</span><span class="op" id="4852510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4852513">return</span>&nbsp;<span class="ident" id="4852520">g</span><br>
<span class="lineno">335</span><span class="op" id="4852522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4852525">func</span>&nbsp;<span class="op" id="4852530">(</span><span class="ident" id="4852531">g</span>&nbsp;<span class="op" id="4852533">*</span><span class="ident" id="4852534">gobEncoderType</span><span class="op" id="4852548">)</span>&nbsp;<span class="ident" id="4852550">safeString</span><span class="op" id="4852560">(</span><span class="ident" id="4852561">seen</span>&nbsp;<span class="keyword" id="4852566">map</span><span class="op" id="4852569">[</span><span class="ident" id="4852570">typeId</span><span class="op" id="4852576">]</span><span class="builtintype" id="4852577">bool</span><span class="op" id="4852581">)</span>&nbsp;<span class="builtintype" id="4852583">string</span>&nbsp;<span class="op" id="4852590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4852593">return</span>&nbsp;<span class="ident" id="4852600">g</span><span class="op" id="4852601">.</span><span class="ident" id="4852602">Name</span><br>
<span class="lineno"></span><span class="op" id="4852607">}</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="keyword" id="4852610">func</span>&nbsp;<span class="op" id="4852615">(</span><span class="ident" id="4852616">g</span>&nbsp;<span class="op" id="4852618">*</span><span class="ident" id="4852619">gobEncoderType</span><span class="op" id="4852633">)</span>&nbsp;<span class="builtintype" id="4852635">string</span><span class="op" id="4852641">(</span><span class="op" id="4852642">)</span>&nbsp;<span class="builtintype" id="4852644">string</span>&nbsp;<span class="op" id="4852651">{</span>&nbsp;<span class="keyword" id="4852653">return</span>&nbsp;<span class="ident" id="4852660">g</span><span class="op" id="4852661">.</span><span class="ident" id="4852662">Name</span>&nbsp;<span class="op" id="4852667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4852670">//&nbsp;Map&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="4852682">type</span>&nbsp;<span class="ident" id="4852687">mapType</span>&nbsp;<span class="keyword" id="4852695">struct</span>&nbsp;<span class="op" id="4852702">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4852705">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4852717">Key</span>&nbsp;&nbsp;<span class="ident" id="4852722">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4852730">Elem</span>&nbsp;<span class="ident" id="4852735">typeId</span><br>
<span class="lineno"></span><span class="op" id="4852742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="keyword" id="4852745">func</span>&nbsp;<span class="ident" id="4852750">newMapType</span><span class="op" id="4852760">(</span><span class="ident" id="4852761">name</span>&nbsp;<span class="builtintype" id="4852766">string</span><span class="op" id="4852772">)</span>&nbsp;<span class="op" id="4852774">*</span><span class="ident" id="4852775">mapType</span>&nbsp;<span class="op" id="4852783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4852786">m</span>&nbsp;<span class="op" id="4852788">:=</span>&nbsp;<span class="op" id="4852791">&amp;</span><span class="ident" id="4852792">mapType</span><span class="op" id="4852799">{</span><span class="ident" id="4852800">CommonType</span><span class="op" id="4852810">{</span><span class="ident" id="4852811">Name</span><span class="op" id="4852815">:</span>&nbsp;<span class="ident" id="4852817">name</span><span class="op" id="4852821">}</span><span class="op" id="4852822">,</span>&nbsp;<span class="num" id="4852824">0</span><span class="op" id="4852825">,</span>&nbsp;<span class="num" id="4852827">0</span><span class="op" id="4852828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4852831">return</span>&nbsp;<span class="ident" id="4852838">m</span><br>
<span class="lineno"></span><span class="op" id="4852840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="4852843">func</span>&nbsp;<span class="op" id="4852848">(</span><span class="ident" id="4852849">m</span>&nbsp;<span class="op" id="4852851">*</span><span class="ident" id="4852852">mapType</span><span class="op" id="4852859">)</span>&nbsp;<span class="ident" id="4852861">init</span><span class="op" id="4852865">(</span><span class="ident" id="4852866">key</span><span class="op" id="4852869">,</span>&nbsp;<span class="ident" id="4852871">elem</span>&nbsp;<span class="ident" id="4852876">gobType</span><span class="op" id="4852883">)</span>&nbsp;<span class="op" id="4852885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4852888">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4852963">setTypeId</span><span class="op" id="4852972">(</span><span class="ident" id="4852973">m</span><span class="op" id="4852974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4852977">m</span><span class="op" id="4852978">.</span><span class="ident" id="4852979">Key</span>&nbsp;<span class="op" id="4852983">=</span>&nbsp;<span class="ident" id="4852985">key</span><span class="op" id="4852988">.</span><span class="ident" id="4852989">id</span><span class="op" id="4852991">(</span><span class="op" id="4852992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4852995">m</span><span class="op" id="4852996">.</span><span class="ident" id="4852997">Elem</span>&nbsp;<span class="op" id="4853002">=</span>&nbsp;<span class="ident" id="4853004">elem</span><span class="op" id="4853008">.</span><span class="ident" id="4853009">id</span><span class="op" id="4853011">(</span><span class="op" id="4853012">)</span><br>
<span class="lineno">360</span><span class="op" id="4853014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4853017">func</span>&nbsp;<span class="op" id="4853022">(</span><span class="ident" id="4853023">m</span>&nbsp;<span class="op" id="4853025">*</span><span class="ident" id="4853026">mapType</span><span class="op" id="4853033">)</span>&nbsp;<span class="ident" id="4853035">safeString</span><span class="op" id="4853045">(</span><span class="ident" id="4853046">seen</span>&nbsp;<span class="keyword" id="4853051">map</span><span class="op" id="4853054">[</span><span class="ident" id="4853055">typeId</span><span class="op" id="4853061">]</span><span class="builtintype" id="4853062">bool</span><span class="op" id="4853066">)</span>&nbsp;<span class="builtintype" id="4853068">string</span>&nbsp;<span class="op" id="4853075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4853078">if</span>&nbsp;<span class="ident" id="4853081">seen</span><span class="op" id="4853085">[</span><span class="ident" id="4853086">m</span><span class="op" id="4853087">.</span><span class="ident" id="4853088">Id</span><span class="op" id="4853090">]</span>&nbsp;<span class="op" id="4853092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4853096">return</span>&nbsp;<span class="ident" id="4853103">m</span><span class="op" id="4853104">.</span><span class="ident" id="4853105">Name</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4853111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4853114">seen</span><span class="op" id="4853118">[</span><span class="ident" id="4853119">m</span><span class="op" id="4853120">.</span><span class="ident" id="4853121">Id</span><span class="op" id="4853123">]</span>&nbsp;<span class="op" id="4853125">=</span>&nbsp;<span class="builtintype" id="4853127">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4853133">key</span>&nbsp;<span class="op" id="4853137">:=</span>&nbsp;<span class="ident" id="4853140">m</span><span class="op" id="4853141">.</span><span class="ident" id="4853142">Key</span><span class="op" id="4853145">.</span><span class="ident" id="4853146">gobType</span><span class="op" id="4853153">(</span><span class="op" id="4853154">)</span><span class="op" id="4853155">.</span><span class="ident" id="4853156">safeString</span><span class="op" id="4853166">(</span><span class="ident" id="4853167">seen</span><span class="op" id="4853171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4853174">elem</span>&nbsp;<span class="op" id="4853179">:=</span>&nbsp;<span class="ident" id="4853182">m</span><span class="op" id="4853183">.</span><span class="ident" id="4853184">Elem</span><span class="op" id="4853188">.</span><span class="ident" id="4853189">gobType</span><span class="op" id="4853196">(</span><span class="op" id="4853197">)</span><span class="op" id="4853198">.</span><span class="ident" id="4853199">safeString</span><span class="op" id="4853209">(</span><span class="ident" id="4853210">seen</span><span class="op" id="4853214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4853217">return</span>&nbsp;<span class="ident" id="4853224">fmt</span><span class="op" id="4853227">.</span><span class="ident" id="4853228">Sprintf</span><span class="op" id="4853235">(</span><span class="string" id="4853236">&#34;map[%s]%s&#34;</span><span class="op" id="4853247">,</span>&nbsp;<span class="ident" id="4853249">key</span><span class="op" id="4853252">,</span>&nbsp;<span class="ident" id="4853254">elem</span><span class="op" id="4853258">)</span><br>
<span class="lineno">370</span><span class="op" id="4853260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4853263">func</span>&nbsp;<span class="op" id="4853268">(</span><span class="ident" id="4853269">m</span>&nbsp;<span class="op" id="4853271">*</span><span class="ident" id="4853272">mapType</span><span class="op" id="4853279">)</span>&nbsp;<span class="builtintype" id="4853281">string</span><span class="op" id="4853287">(</span><span class="op" id="4853288">)</span>&nbsp;<span class="builtintype" id="4853290">string</span>&nbsp;<span class="op" id="4853297">{</span>&nbsp;<span class="keyword" id="4853299">return</span>&nbsp;<span class="ident" id="4853306">m</span><span class="op" id="4853307">.</span><span class="ident" id="4853308">safeString</span><span class="op" id="4853318">(</span><span class="builtinfunc" id="4853319">make</span><span class="op" id="4853323">(</span><span class="keyword" id="4853324">map</span><span class="op" id="4853327">[</span><span class="ident" id="4853328">typeId</span><span class="op" id="4853334">]</span><span class="builtintype" id="4853335">bool</span><span class="op" id="4853339">)</span><span class="op" id="4853340">)</span>&nbsp;<span class="op" id="4853342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4853345">//&nbsp;Slice&nbsp;type</span><br>
<span class="lineno">375</span><span class="keyword" id="4853359">type</span>&nbsp;<span class="ident" id="4853364">sliceType</span>&nbsp;<span class="keyword" id="4853374">struct</span>&nbsp;<span class="op" id="4853381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4853384">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4853396">Elem</span>&nbsp;<span class="ident" id="4853401">typeId</span><br>
<span class="lineno"></span><span class="op" id="4853408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="keyword" id="4853411">func</span>&nbsp;<span class="ident" id="4853416">newSliceType</span><span class="op" id="4853428">(</span><span class="ident" id="4853429">name</span>&nbsp;<span class="builtintype" id="4853434">string</span><span class="op" id="4853440">)</span>&nbsp;<span class="op" id="4853442">*</span><span class="ident" id="4853443">sliceType</span>&nbsp;<span class="op" id="4853453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4853456">s</span>&nbsp;<span class="op" id="4853458">:=</span>&nbsp;<span class="op" id="4853461">&amp;</span><span class="ident" id="4853462">sliceType</span><span class="op" id="4853471">{</span><span class="ident" id="4853472">CommonType</span><span class="op" id="4853482">{</span><span class="ident" id="4853483">Name</span><span class="op" id="4853487">:</span>&nbsp;<span class="ident" id="4853489">name</span><span class="op" id="4853493">}</span><span class="op" id="4853494">,</span>&nbsp;<span class="num" id="4853496">0</span><span class="op" id="4853497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4853500">return</span>&nbsp;<span class="ident" id="4853507">s</span><br>
<span class="lineno"></span><span class="op" id="4853509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="keyword" id="4853512">func</span>&nbsp;<span class="op" id="4853517">(</span><span class="ident" id="4853518">s</span>&nbsp;<span class="op" id="4853520">*</span><span class="ident" id="4853521">sliceType</span><span class="op" id="4853530">)</span>&nbsp;<span class="ident" id="4853532">init</span><span class="op" id="4853536">(</span><span class="ident" id="4853537">elem</span>&nbsp;<span class="ident" id="4853542">gobType</span><span class="op" id="4853549">)</span>&nbsp;<span class="op" id="4853551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4853554">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4853629">setTypeId</span><span class="op" id="4853638">(</span><span class="ident" id="4853639">s</span><span class="op" id="4853640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4853643">//&nbsp;See&nbsp;the&nbsp;comments&nbsp;about&nbsp;ids&nbsp;in&nbsp;newTypeObject.&nbsp;Only&nbsp;slices&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4853708">//&nbsp;structs&nbsp;have&nbsp;mutual&nbsp;recursion.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4853743">if</span>&nbsp;<span class="ident" id="4853746">elem</span><span class="op" id="4853750">.</span><span class="ident" id="4853751">id</span><span class="op" id="4853753">(</span><span class="op" id="4853754">)</span>&nbsp;<span class="op" id="4853756">==</span>&nbsp;<span class="num" id="4853759">0</span>&nbsp;<span class="op" id="4853761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4853765">setTypeId</span><span class="op" id="4853774">(</span><span class="ident" id="4853775">elem</span><span class="op" id="4853779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4853782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4853785">s</span><span class="op" id="4853786">.</span><span class="ident" id="4853787">Elem</span>&nbsp;<span class="op" id="4853792">=</span>&nbsp;<span class="ident" id="4853794">elem</span><span class="op" id="4853798">.</span><span class="ident" id="4853799">id</span><span class="op" id="4853801">(</span><span class="op" id="4853802">)</span><br>
<span class="lineno"></span><span class="op" id="4853804">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="4853807">func</span>&nbsp;<span class="op" id="4853812">(</span><span class="ident" id="4853813">s</span>&nbsp;<span class="op" id="4853815">*</span><span class="ident" id="4853816">sliceType</span><span class="op" id="4853825">)</span>&nbsp;<span class="ident" id="4853827">safeString</span><span class="op" id="4853837">(</span><span class="ident" id="4853838">seen</span>&nbsp;<span class="keyword" id="4853843">map</span><span class="op" id="4853846">[</span><span class="ident" id="4853847">typeId</span><span class="op" id="4853853">]</span><span class="builtintype" id="4853854">bool</span><span class="op" id="4853858">)</span>&nbsp;<span class="builtintype" id="4853860">string</span>&nbsp;<span class="op" id="4853867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4853870">if</span>&nbsp;<span class="ident" id="4853873">seen</span><span class="op" id="4853877">[</span><span class="ident" id="4853878">s</span><span class="op" id="4853879">.</span><span class="ident" id="4853880">Id</span><span class="op" id="4853882">]</span>&nbsp;<span class="op" id="4853884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4853888">return</span>&nbsp;<span class="ident" id="4853895">s</span><span class="op" id="4853896">.</span><span class="ident" id="4853897">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4853903">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4853906">seen</span><span class="op" id="4853910">[</span><span class="ident" id="4853911">s</span><span class="op" id="4853912">.</span><span class="ident" id="4853913">Id</span><span class="op" id="4853915">]</span>&nbsp;<span class="op" id="4853917">=</span>&nbsp;<span class="builtintype" id="4853919">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4853925">return</span>&nbsp;<span class="ident" id="4853932">fmt</span><span class="op" id="4853935">.</span><span class="ident" id="4853936">Sprintf</span><span class="op" id="4853943">(</span><span class="string" id="4853944">&#34;[]%s&#34;</span><span class="op" id="4853950">,</span>&nbsp;<span class="ident" id="4853952">s</span><span class="op" id="4853953">.</span><span class="ident" id="4853954">Elem</span><span class="op" id="4853958">.</span><span class="ident" id="4853959">gobType</span><span class="op" id="4853966">(</span><span class="op" id="4853967">)</span><span class="op" id="4853968">.</span><span class="ident" id="4853969">safeString</span><span class="op" id="4853979">(</span><span class="ident" id="4853980">seen</span><span class="op" id="4853984">)</span><span class="op" id="4853985">)</span><br>
<span class="lineno"></span><span class="op" id="4853987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4853990">func</span>&nbsp;<span class="op" id="4853995">(</span><span class="ident" id="4853996">s</span>&nbsp;<span class="op" id="4853998">*</span><span class="ident" id="4853999">sliceType</span><span class="op" id="4854008">)</span>&nbsp;<span class="builtintype" id="4854010">string</span><span class="op" id="4854016">(</span><span class="op" id="4854017">)</span>&nbsp;<span class="builtintype" id="4854019">string</span>&nbsp;<span class="op" id="4854026">{</span>&nbsp;<span class="keyword" id="4854028">return</span>&nbsp;<span class="ident" id="4854035">s</span><span class="op" id="4854036">.</span><span class="ident" id="4854037">safeString</span><span class="op" id="4854047">(</span><span class="builtinfunc" id="4854048">make</span><span class="op" id="4854052">(</span><span class="keyword" id="4854053">map</span><span class="op" id="4854056">[</span><span class="ident" id="4854057">typeId</span><span class="op" id="4854063">]</span><span class="builtintype" id="4854064">bool</span><span class="op" id="4854068">)</span><span class="op" id="4854069">)</span>&nbsp;<span class="op" id="4854071">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="4854074">//&nbsp;Struct&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="4854089">type</span>&nbsp;<span class="ident" id="4854094">fieldType</span>&nbsp;<span class="keyword" id="4854104">struct</span>&nbsp;<span class="op" id="4854111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854114">Name</span>&nbsp;<span class="builtintype" id="4854119">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854127">Id</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4854132">typeId</span><br>
<span class="lineno">410</span><span class="op" id="4854139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4854142">type</span>&nbsp;<span class="ident" id="4854147">structType</span>&nbsp;<span class="keyword" id="4854158">struct</span>&nbsp;<span class="op" id="4854165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854168">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854180">Field</span>&nbsp;<span class="op" id="4854186">[</span><span class="op" id="4854187">]</span><span class="op" id="4854188">*</span><span class="ident" id="4854189">fieldType</span><br>
<span class="lineno">415</span><span class="op" id="4854199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4854202">func</span>&nbsp;<span class="op" id="4854207">(</span><span class="ident" id="4854208">s</span>&nbsp;<span class="op" id="4854210">*</span><span class="ident" id="4854211">structType</span><span class="op" id="4854221">)</span>&nbsp;<span class="ident" id="4854223">safeString</span><span class="op" id="4854233">(</span><span class="ident" id="4854234">seen</span>&nbsp;<span class="keyword" id="4854239">map</span><span class="op" id="4854242">[</span><span class="ident" id="4854243">typeId</span><span class="op" id="4854249">]</span><span class="builtintype" id="4854250">bool</span><span class="op" id="4854254">)</span>&nbsp;<span class="builtintype" id="4854256">string</span>&nbsp;<span class="op" id="4854263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4854266">if</span>&nbsp;<span class="ident" id="4854269">s</span>&nbsp;<span class="op" id="4854271">==</span>&nbsp;<span class="ident" id="4854274">nil</span>&nbsp;<span class="op" id="4854278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4854282">return</span>&nbsp;<span class="string" id="4854289">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4854298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4854301">if</span>&nbsp;<span class="ident" id="4854304">_</span><span class="op" id="4854305">,</span>&nbsp;<span class="ident" id="4854307">ok</span>&nbsp;<span class="op" id="4854310">:=</span>&nbsp;<span class="ident" id="4854313">seen</span><span class="op" id="4854317">[</span><span class="ident" id="4854318">s</span><span class="op" id="4854319">.</span><span class="ident" id="4854320">Id</span><span class="op" id="4854322">]</span><span class="op" id="4854323">;</span>&nbsp;<span class="ident" id="4854325">ok</span>&nbsp;<span class="op" id="4854328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4854332">return</span>&nbsp;<span class="ident" id="4854339">s</span><span class="op" id="4854340">.</span><span class="ident" id="4854341">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4854347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854350">seen</span><span class="op" id="4854354">[</span><span class="ident" id="4854355">s</span><span class="op" id="4854356">.</span><span class="ident" id="4854357">Id</span><span class="op" id="4854359">]</span>&nbsp;<span class="op" id="4854361">=</span>&nbsp;<span class="builtintype" id="4854363">true</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854369">str</span>&nbsp;<span class="op" id="4854373">:=</span>&nbsp;<span class="ident" id="4854376">s</span><span class="op" id="4854377">.</span><span class="ident" id="4854378">Name</span>&nbsp;<span class="op" id="4854383">+</span>&nbsp;<span class="string" id="4854385">&#34;&nbsp;=&nbsp;struct&nbsp;{&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4854401">for</span>&nbsp;<span class="ident" id="4854405">_</span><span class="op" id="4854406">,</span>&nbsp;<span class="ident" id="4854408">f</span>&nbsp;<span class="op" id="4854410">:=</span>&nbsp;<span class="keyword" id="4854413">range</span>&nbsp;<span class="ident" id="4854419">s</span><span class="op" id="4854420">.</span><span class="ident" id="4854421">Field</span>&nbsp;<span class="op" id="4854427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854431">str</span>&nbsp;<span class="op" id="4854435">+=</span>&nbsp;<span class="ident" id="4854438">fmt</span><span class="op" id="4854441">.</span><span class="ident" id="4854442">Sprintf</span><span class="op" id="4854449">(</span><span class="string" id="4854450">&#34;%s&nbsp;%s;&nbsp;&#34;</span><span class="op" id="4854459">,</span>&nbsp;<span class="ident" id="4854461">f</span><span class="op" id="4854462">.</span><span class="ident" id="4854463">Name</span><span class="op" id="4854467">,</span>&nbsp;<span class="ident" id="4854469">f</span><span class="op" id="4854470">.</span><span class="ident" id="4854471">Id</span><span class="op" id="4854473">.</span><span class="ident" id="4854474">gobType</span><span class="op" id="4854481">(</span><span class="op" id="4854482">)</span><span class="op" id="4854483">.</span><span class="ident" id="4854484">safeString</span><span class="op" id="4854494">(</span><span class="ident" id="4854495">seen</span><span class="op" id="4854499">)</span><span class="op" id="4854500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4854503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854506">str</span>&nbsp;<span class="op" id="4854510">+=</span>&nbsp;<span class="string" id="4854513">&#34;}&#34;</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4854518">return</span>&nbsp;<span class="ident" id="4854525">str</span><br>
<span class="lineno"></span><span class="op" id="4854529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4854532">func</span>&nbsp;<span class="op" id="4854537">(</span><span class="ident" id="4854538">s</span>&nbsp;<span class="op" id="4854540">*</span><span class="ident" id="4854541">structType</span><span class="op" id="4854551">)</span>&nbsp;<span class="builtintype" id="4854553">string</span><span class="op" id="4854559">(</span><span class="op" id="4854560">)</span>&nbsp;<span class="builtintype" id="4854562">string</span>&nbsp;<span class="op" id="4854569">{</span>&nbsp;<span class="keyword" id="4854571">return</span>&nbsp;<span class="ident" id="4854578">s</span><span class="op" id="4854579">.</span><span class="ident" id="4854580">safeString</span><span class="op" id="4854590">(</span><span class="builtinfunc" id="4854591">make</span><span class="op" id="4854595">(</span><span class="keyword" id="4854596">map</span><span class="op" id="4854599">[</span><span class="ident" id="4854600">typeId</span><span class="op" id="4854606">]</span><span class="builtintype" id="4854607">bool</span><span class="op" id="4854611">)</span><span class="op" id="4854612">)</span>&nbsp;<span class="op" id="4854614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="4854617">func</span>&nbsp;<span class="ident" id="4854622">newStructType</span><span class="op" id="4854635">(</span><span class="ident" id="4854636">name</span>&nbsp;<span class="builtintype" id="4854641">string</span><span class="op" id="4854647">)</span>&nbsp;<span class="op" id="4854649">*</span><span class="ident" id="4854650">structType</span>&nbsp;<span class="op" id="4854661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854664">s</span>&nbsp;<span class="op" id="4854666">:=</span>&nbsp;<span class="op" id="4854669">&amp;</span><span class="ident" id="4854670">structType</span><span class="op" id="4854680">{</span><span class="ident" id="4854681">CommonType</span><span class="op" id="4854691">{</span><span class="ident" id="4854692">Name</span><span class="op" id="4854696">:</span>&nbsp;<span class="ident" id="4854698">name</span><span class="op" id="4854702">}</span><span class="op" id="4854703">,</span>&nbsp;<span class="ident" id="4854705">nil</span><span class="op" id="4854708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4854711">//&nbsp;For&nbsp;historical&nbsp;reasons&nbsp;we&nbsp;set&nbsp;the&nbsp;id&nbsp;here&nbsp;rather&nbsp;than&nbsp;init.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4854775">//&nbsp;See&nbsp;the&nbsp;comment&nbsp;in&nbsp;newTypeObject&nbsp;for&nbsp;details.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4854825">setTypeId</span><span class="op" id="4854834">(</span><span class="ident" id="4854835">s</span><span class="op" id="4854836">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4854839">return</span>&nbsp;<span class="ident" id="4854846">s</span><br>
<span class="lineno"></span><span class="op" id="4854848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4854851">//&nbsp;newTypeObject&nbsp;allocates&nbsp;a&nbsp;gobType&nbsp;for&nbsp;the&nbsp;reflection&nbsp;type&nbsp;rt.</span><br>
<span class="lineno"></span><span class="comment" id="4854916">//&nbsp;Unless&nbsp;ut&nbsp;represents&nbsp;a&nbsp;GobEncoder,&nbsp;rt&nbsp;should&nbsp;be&nbsp;the&nbsp;base&nbsp;type</span><br>
<span class="lineno">445</span><span class="comment" id="4854981">//&nbsp;of&nbsp;ut.</span><br>
<span class="lineno"></span><span class="comment" id="4854991">//&nbsp;This&nbsp;is&nbsp;only&nbsp;called&nbsp;from&nbsp;the&nbsp;encoding&nbsp;side.&nbsp;The&nbsp;decoding&nbsp;side</span><br>
<span class="lineno"></span><span class="comment" id="4855056">//&nbsp;works&nbsp;through&nbsp;typeIds&nbsp;and&nbsp;userTypeInfos&nbsp;alone.</span><br>
<span class="lineno"></span><span class="keyword" id="4855106">func</span>&nbsp;<span class="ident" id="4855111">newTypeObject</span><span class="op" id="4855124">(</span><span class="ident" id="4855125">name</span>&nbsp;<span class="builtintype" id="4855130">string</span><span class="op" id="4855136">,</span>&nbsp;<span class="ident" id="4855138">ut</span>&nbsp;<span class="op" id="4855141">*</span><span class="ident" id="4855142">userTypeInfo</span><span class="op" id="4855154">,</span>&nbsp;<span class="ident" id="4855156">rt</span>&nbsp;<span class="ident" id="4855159">reflect</span><span class="op" id="4855166">.</span><span class="ident" id="4855167">Type</span><span class="op" id="4855171">)</span>&nbsp;<span class="op" id="4855173">(</span><span class="ident" id="4855174">gobType</span><span class="op" id="4855181">,</span>&nbsp;<span class="builtintype" id="4855183">error</span><span class="op" id="4855188">)</span>&nbsp;<span class="op" id="4855190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4855193">//&nbsp;Does&nbsp;this&nbsp;type&nbsp;implement&nbsp;GobEncoder?</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855234">if</span>&nbsp;<span class="ident" id="4855237">ut</span><span class="op" id="4855239">.</span><span class="ident" id="4855240">externalEnc</span>&nbsp;<span class="op" id="4855252">!=</span>&nbsp;<span class="num" id="4855255">0</span>&nbsp;<span class="op" id="4855257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855261">return</span>&nbsp;<span class="ident" id="4855268">newGobEncoderType</span><span class="op" id="4855285">(</span><span class="ident" id="4855286">name</span><span class="op" id="4855290">)</span><span class="op" id="4855291">,</span>&nbsp;<span class="ident" id="4855293">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855301">var</span>&nbsp;<span class="ident" id="4855305">err</span>&nbsp;<span class="builtintype" id="4855309">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855316">var</span>&nbsp;<span class="ident" id="4855320">type0</span><span class="op" id="4855325">,</span>&nbsp;<span class="ident" id="4855327">type1</span>&nbsp;<span class="ident" id="4855333">gobType</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855342">defer</span>&nbsp;<span class="keyword" id="4855348">func</span><span class="op" id="4855352">(</span><span class="op" id="4855353">)</span>&nbsp;<span class="op" id="4855355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855359">if</span>&nbsp;<span class="ident" id="4855362">err</span>&nbsp;<span class="op" id="4855366">!=</span>&nbsp;<span class="ident" id="4855369">nil</span>&nbsp;<span class="op" id="4855373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4855378">delete</span><span class="op" id="4855384">(</span><span class="ident" id="4855385">types</span><span class="op" id="4855390">,</span>&nbsp;<span class="ident" id="4855392">rt</span><span class="op" id="4855394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4855401">}</span><span class="op" id="4855402">(</span><span class="op" id="4855403">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4855406">//&nbsp;Install&nbsp;the&nbsp;top-level&nbsp;type&nbsp;before&nbsp;the&nbsp;subtypes&nbsp;(e.g.&nbsp;struct&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4855477">//&nbsp;fields)&nbsp;so&nbsp;recursive&nbsp;types&nbsp;can&nbsp;be&nbsp;constructed&nbsp;safely.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855535">switch</span>&nbsp;<span class="ident" id="4855542">t</span>&nbsp;<span class="op" id="4855544">:=</span>&nbsp;<span class="ident" id="4855547">rt</span><span class="op" id="4855549">;</span>&nbsp;<span class="ident" id="4855551">t</span><span class="op" id="4855552">.</span><span class="ident" id="4855553">Kind</span><span class="op" id="4855557">(</span><span class="op" id="4855558">)</span>&nbsp;<span class="op" id="4855560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4855563">//&nbsp;All&nbsp;basic&nbsp;types&nbsp;are&nbsp;easy:&nbsp;they&nbsp;are&nbsp;predefined.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855614">case</span>&nbsp;<span class="ident" id="4855619">reflect</span><span class="op" id="4855626">.</span><span class="ident" id="4855627">Bool</span><span class="op" id="4855631">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855635">return</span>&nbsp;<span class="ident" id="4855642">tBool</span><span class="op" id="4855647">.</span><span class="ident" id="4855648">gobType</span><span class="op" id="4855655">(</span><span class="op" id="4855656">)</span><span class="op" id="4855657">,</span>&nbsp;<span class="ident" id="4855659">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855665">case</span>&nbsp;<span class="ident" id="4855670">reflect</span><span class="op" id="4855677">.</span><span class="ident" id="4855678">Int</span><span class="op" id="4855681">,</span>&nbsp;<span class="ident" id="4855683">reflect</span><span class="op" id="4855690">.</span><span class="ident" id="4855691">Int8</span><span class="op" id="4855695">,</span>&nbsp;<span class="ident" id="4855697">reflect</span><span class="op" id="4855704">.</span><span class="ident" id="4855705">Int16</span><span class="op" id="4855710">,</span>&nbsp;<span class="ident" id="4855712">reflect</span><span class="op" id="4855719">.</span><span class="ident" id="4855720">Int32</span><span class="op" id="4855725">,</span>&nbsp;<span class="ident" id="4855727">reflect</span><span class="op" id="4855734">.</span><span class="ident" id="4855735">Int64</span><span class="op" id="4855740">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855744">return</span>&nbsp;<span class="ident" id="4855751">tInt</span><span class="op" id="4855755">.</span><span class="ident" id="4855756">gobType</span><span class="op" id="4855763">(</span><span class="op" id="4855764">)</span><span class="op" id="4855765">,</span>&nbsp;<span class="ident" id="4855767">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855773">case</span>&nbsp;<span class="ident" id="4855778">reflect</span><span class="op" id="4855785">.</span><span class="ident" id="4855786">Uint</span><span class="op" id="4855790">,</span>&nbsp;<span class="ident" id="4855792">reflect</span><span class="op" id="4855799">.</span><span class="ident" id="4855800">Uint8</span><span class="op" id="4855805">,</span>&nbsp;<span class="ident" id="4855807">reflect</span><span class="op" id="4855814">.</span><span class="ident" id="4855815">Uint16</span><span class="op" id="4855821">,</span>&nbsp;<span class="ident" id="4855823">reflect</span><span class="op" id="4855830">.</span><span class="ident" id="4855831">Uint32</span><span class="op" id="4855837">,</span>&nbsp;<span class="ident" id="4855839">reflect</span><span class="op" id="4855846">.</span><span class="ident" id="4855847">Uint64</span><span class="op" id="4855853">,</span>&nbsp;<span class="ident" id="4855855">reflect</span><span class="op" id="4855862">.</span><span class="ident" id="4855863">Uintptr</span><span class="op" id="4855870">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855874">return</span>&nbsp;<span class="ident" id="4855881">tUint</span><span class="op" id="4855886">.</span><span class="ident" id="4855887">gobType</span><span class="op" id="4855894">(</span><span class="op" id="4855895">)</span><span class="op" id="4855896">,</span>&nbsp;<span class="ident" id="4855898">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855904">case</span>&nbsp;<span class="ident" id="4855909">reflect</span><span class="op" id="4855916">.</span><span class="ident" id="4855917">Float32</span><span class="op" id="4855924">,</span>&nbsp;<span class="ident" id="4855926">reflect</span><span class="op" id="4855933">.</span><span class="ident" id="4855934">Float64</span><span class="op" id="4855941">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855945">return</span>&nbsp;<span class="ident" id="4855952">tFloat</span><span class="op" id="4855958">.</span><span class="ident" id="4855959">gobType</span><span class="op" id="4855966">(</span><span class="op" id="4855967">)</span><span class="op" id="4855968">,</span>&nbsp;<span class="ident" id="4855970">nil</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4855976">case</span>&nbsp;<span class="ident" id="4855981">reflect</span><span class="op" id="4855988">.</span><span class="ident" id="4855989">Complex64</span><span class="op" id="4855998">,</span>&nbsp;<span class="ident" id="4856000">reflect</span><span class="op" id="4856007">.</span><span class="ident" id="4856008">Complex128</span><span class="op" id="4856018">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856022">return</span>&nbsp;<span class="ident" id="4856029">tComplex</span><span class="op" id="4856037">.</span><span class="ident" id="4856038">gobType</span><span class="op" id="4856045">(</span><span class="op" id="4856046">)</span><span class="op" id="4856047">,</span>&nbsp;<span class="ident" id="4856049">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856055">case</span>&nbsp;<span class="ident" id="4856060">reflect</span><span class="op" id="4856067">.</span><span class="ident" id="4856068">String</span><span class="op" id="4856074">:</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856078">return</span>&nbsp;<span class="ident" id="4856085">tString</span><span class="op" id="4856092">.</span><span class="ident" id="4856093">gobType</span><span class="op" id="4856100">(</span><span class="op" id="4856101">)</span><span class="op" id="4856102">,</span>&nbsp;<span class="ident" id="4856104">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856110">case</span>&nbsp;<span class="ident" id="4856115">reflect</span><span class="op" id="4856122">.</span><span class="ident" id="4856123">Interface</span><span class="op" id="4856132">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856136">return</span>&nbsp;<span class="ident" id="4856143">tInterface</span><span class="op" id="4856153">.</span><span class="ident" id="4856154">gobType</span><span class="op" id="4856161">(</span><span class="op" id="4856162">)</span><span class="op" id="4856163">,</span>&nbsp;<span class="ident" id="4856165">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856171">case</span>&nbsp;<span class="ident" id="4856176">reflect</span><span class="op" id="4856183">.</span><span class="ident" id="4856184">Array</span><span class="op" id="4856189">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856193">at</span>&nbsp;<span class="op" id="4856196">:=</span>&nbsp;<span class="ident" id="4856199">newArrayType</span><span class="op" id="4856211">(</span><span class="ident" id="4856212">name</span><span class="op" id="4856216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856220">types</span><span class="op" id="4856225">[</span><span class="ident" id="4856226">rt</span><span class="op" id="4856228">]</span>&nbsp;<span class="op" id="4856230">=</span>&nbsp;<span class="ident" id="4856232">at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856237">type0</span><span class="op" id="4856242">,</span>&nbsp;<span class="ident" id="4856244">err</span>&nbsp;<span class="op" id="4856248">=</span>&nbsp;<span class="ident" id="4856250">getBaseType</span><span class="op" id="4856261">(</span><span class="string" id="4856262">&#34;&#34;</span><span class="op" id="4856264">,</span>&nbsp;<span class="ident" id="4856266">t</span><span class="op" id="4856267">.</span><span class="ident" id="4856268">Elem</span><span class="op" id="4856272">(</span><span class="op" id="4856273">)</span><span class="op" id="4856274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856278">if</span>&nbsp;<span class="ident" id="4856281">err</span>&nbsp;<span class="op" id="4856285">!=</span>&nbsp;<span class="ident" id="4856288">nil</span>&nbsp;<span class="op" id="4856292">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856297">return</span>&nbsp;<span class="ident" id="4856304">nil</span><span class="op" id="4856307">,</span>&nbsp;<span class="ident" id="4856309">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4856315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4856319">//&nbsp;Historical&nbsp;aside:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4856342">//&nbsp;For&nbsp;arrays,&nbsp;maps,&nbsp;and&nbsp;slices,&nbsp;we&nbsp;set&nbsp;the&nbsp;type&nbsp;id&nbsp;after&nbsp;the&nbsp;elements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4856415">//&nbsp;are&nbsp;constructed.&nbsp;This&nbsp;is&nbsp;to&nbsp;retain&nbsp;the&nbsp;order&nbsp;of&nbsp;type&nbsp;id&nbsp;allocation&nbsp;after</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4856493">//&nbsp;a&nbsp;fix&nbsp;made&nbsp;to&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;which&nbsp;changed&nbsp;the&nbsp;order&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4856563">//&nbsp;which&nbsp;types&nbsp;are&nbsp;built.&nbsp;&nbsp;Delaying&nbsp;the&nbsp;setting&nbsp;in&nbsp;this&nbsp;way&nbsp;preserves</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4856635">//&nbsp;type&nbsp;ids&nbsp;while&nbsp;allowing&nbsp;recursive&nbsp;types&nbsp;to&nbsp;be&nbsp;described.&nbsp;Structs,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4856706">//&nbsp;done&nbsp;below,&nbsp;were&nbsp;already&nbsp;handling&nbsp;recursion&nbsp;correctly&nbsp;so&nbsp;they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4856773">//&nbsp;assign&nbsp;the&nbsp;top-level&nbsp;id&nbsp;before&nbsp;those&nbsp;of&nbsp;the&nbsp;field.</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856829">at</span><span class="op" id="4856831">.</span><span class="ident" id="4856832">init</span><span class="op" id="4856836">(</span><span class="ident" id="4856837">type0</span><span class="op" id="4856842">,</span>&nbsp;<span class="ident" id="4856844">t</span><span class="op" id="4856845">.</span><span class="ident" id="4856846">Len</span><span class="op" id="4856849">(</span><span class="op" id="4856850">)</span><span class="op" id="4856851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856855">return</span>&nbsp;<span class="ident" id="4856862">at</span><span class="op" id="4856864">,</span>&nbsp;<span class="ident" id="4856866">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856872">case</span>&nbsp;<span class="ident" id="4856877">reflect</span><span class="op" id="4856884">.</span><span class="ident" id="4856885">Map</span><span class="op" id="4856888">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856892">mt</span>&nbsp;<span class="op" id="4856895">:=</span>&nbsp;<span class="ident" id="4856898">newMapType</span><span class="op" id="4856908">(</span><span class="ident" id="4856909">name</span><span class="op" id="4856913">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856917">types</span><span class="op" id="4856922">[</span><span class="ident" id="4856923">rt</span><span class="op" id="4856925">]</span>&nbsp;<span class="op" id="4856927">=</span>&nbsp;<span class="ident" id="4856929">mt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4856934">type0</span><span class="op" id="4856939">,</span>&nbsp;<span class="ident" id="4856941">err</span>&nbsp;<span class="op" id="4856945">=</span>&nbsp;<span class="ident" id="4856947">getBaseType</span><span class="op" id="4856958">(</span><span class="string" id="4856959">&#34;&#34;</span><span class="op" id="4856961">,</span>&nbsp;<span class="ident" id="4856963">t</span><span class="op" id="4856964">.</span><span class="ident" id="4856965">Key</span><span class="op" id="4856968">(</span><span class="op" id="4856969">)</span><span class="op" id="4856970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856974">if</span>&nbsp;<span class="ident" id="4856977">err</span>&nbsp;<span class="op" id="4856981">!=</span>&nbsp;<span class="ident" id="4856984">nil</span>&nbsp;<span class="op" id="4856988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4856993">return</span>&nbsp;<span class="ident" id="4857000">nil</span><span class="op" id="4857003">,</span>&nbsp;<span class="ident" id="4857005">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857011">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857015">type1</span><span class="op" id="4857020">,</span>&nbsp;<span class="ident" id="4857022">err</span>&nbsp;<span class="op" id="4857026">=</span>&nbsp;<span class="ident" id="4857028">getBaseType</span><span class="op" id="4857039">(</span><span class="string" id="4857040">&#34;&#34;</span><span class="op" id="4857042">,</span>&nbsp;<span class="ident" id="4857044">t</span><span class="op" id="4857045">.</span><span class="ident" id="4857046">Elem</span><span class="op" id="4857050">(</span><span class="op" id="4857051">)</span><span class="op" id="4857052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857056">if</span>&nbsp;<span class="ident" id="4857059">err</span>&nbsp;<span class="op" id="4857063">!=</span>&nbsp;<span class="ident" id="4857066">nil</span>&nbsp;<span class="op" id="4857070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857075">return</span>&nbsp;<span class="ident" id="4857082">nil</span><span class="op" id="4857085">,</span>&nbsp;<span class="ident" id="4857087">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857097">mt</span><span class="op" id="4857099">.</span><span class="ident" id="4857100">init</span><span class="op" id="4857104">(</span><span class="ident" id="4857105">type0</span><span class="op" id="4857110">,</span>&nbsp;<span class="ident" id="4857112">type1</span><span class="op" id="4857117">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857121">return</span>&nbsp;<span class="ident" id="4857128">mt</span><span class="op" id="4857130">,</span>&nbsp;<span class="ident" id="4857132">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857138">case</span>&nbsp;<span class="ident" id="4857143">reflect</span><span class="op" id="4857150">.</span><span class="ident" id="4857151">Slice</span><span class="op" id="4857156">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4857160">//&nbsp;[]byte&nbsp;==&nbsp;[]uint8&nbsp;is&nbsp;a&nbsp;special&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857201">if</span>&nbsp;<span class="ident" id="4857204">t</span><span class="op" id="4857205">.</span><span class="ident" id="4857206">Elem</span><span class="op" id="4857210">(</span><span class="op" id="4857211">)</span><span class="op" id="4857212">.</span><span class="ident" id="4857213">Kind</span><span class="op" id="4857217">(</span><span class="op" id="4857218">)</span>&nbsp;<span class="op" id="4857220">==</span>&nbsp;<span class="ident" id="4857223">reflect</span><span class="op" id="4857230">.</span><span class="ident" id="4857231">Uint8</span>&nbsp;<span class="op" id="4857237">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857242">return</span>&nbsp;<span class="ident" id="4857249">tBytes</span><span class="op" id="4857255">.</span><span class="ident" id="4857256">gobType</span><span class="op" id="4857263">(</span><span class="op" id="4857264">)</span><span class="op" id="4857265">,</span>&nbsp;<span class="ident" id="4857267">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857277">st</span>&nbsp;<span class="op" id="4857280">:=</span>&nbsp;<span class="ident" id="4857283">newSliceType</span><span class="op" id="4857295">(</span><span class="ident" id="4857296">name</span><span class="op" id="4857300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857304">types</span><span class="op" id="4857309">[</span><span class="ident" id="4857310">rt</span><span class="op" id="4857312">]</span>&nbsp;<span class="op" id="4857314">=</span>&nbsp;<span class="ident" id="4857316">st</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857321">type0</span><span class="op" id="4857326">,</span>&nbsp;<span class="ident" id="4857328">err</span>&nbsp;<span class="op" id="4857332">=</span>&nbsp;<span class="ident" id="4857334">getBaseType</span><span class="op" id="4857345">(</span><span class="ident" id="4857346">t</span><span class="op" id="4857347">.</span><span class="ident" id="4857348">Elem</span><span class="op" id="4857352">(</span><span class="op" id="4857353">)</span><span class="op" id="4857354">.</span><span class="ident" id="4857355">Name</span><span class="op" id="4857359">(</span><span class="op" id="4857360">)</span><span class="op" id="4857361">,</span>&nbsp;<span class="ident" id="4857363">t</span><span class="op" id="4857364">.</span><span class="ident" id="4857365">Elem</span><span class="op" id="4857369">(</span><span class="op" id="4857370">)</span><span class="op" id="4857371">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857375">if</span>&nbsp;<span class="ident" id="4857378">err</span>&nbsp;<span class="op" id="4857382">!=</span>&nbsp;<span class="ident" id="4857385">nil</span>&nbsp;<span class="op" id="4857389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857394">return</span>&nbsp;<span class="ident" id="4857401">nil</span><span class="op" id="4857404">,</span>&nbsp;<span class="ident" id="4857406">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857416">st</span><span class="op" id="4857418">.</span><span class="ident" id="4857419">init</span><span class="op" id="4857423">(</span><span class="ident" id="4857424">type0</span><span class="op" id="4857429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857433">return</span>&nbsp;<span class="ident" id="4857440">st</span><span class="op" id="4857442">,</span>&nbsp;<span class="ident" id="4857444">nil</span><br>
<span class="lineno">530</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857450">case</span>&nbsp;<span class="ident" id="4857455">reflect</span><span class="op" id="4857462">.</span><span class="ident" id="4857463">Struct</span><span class="op" id="4857469">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857473">st</span>&nbsp;<span class="op" id="4857476">:=</span>&nbsp;<span class="ident" id="4857479">newStructType</span><span class="op" id="4857492">(</span><span class="ident" id="4857493">name</span><span class="op" id="4857497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857501">types</span><span class="op" id="4857506">[</span><span class="ident" id="4857507">rt</span><span class="op" id="4857509">]</span>&nbsp;<span class="op" id="4857511">=</span>&nbsp;<span class="ident" id="4857513">st</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857518">idToType</span><span class="op" id="4857526">[</span><span class="ident" id="4857527">st</span><span class="op" id="4857529">.</span><span class="ident" id="4857530">id</span><span class="op" id="4857532">(</span><span class="op" id="4857533">)</span><span class="op" id="4857534">]</span>&nbsp;<span class="op" id="4857536">=</span>&nbsp;<span class="ident" id="4857538">st</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857543">for</span>&nbsp;<span class="ident" id="4857547">i</span>&nbsp;<span class="op" id="4857549">:=</span>&nbsp;<span class="num" id="4857552">0</span><span class="op" id="4857553">;</span>&nbsp;<span class="ident" id="4857555">i</span>&nbsp;<span class="op" id="4857557">&lt;</span>&nbsp;<span class="ident" id="4857559">t</span><span class="op" id="4857560">.</span><span class="ident" id="4857561">NumField</span><span class="op" id="4857569">(</span><span class="op" id="4857570">)</span><span class="op" id="4857571">;</span>&nbsp;<span class="ident" id="4857573">i</span><span class="op" id="4857574">++</span>&nbsp;<span class="op" id="4857577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857582">f</span>&nbsp;<span class="op" id="4857584">:=</span>&nbsp;<span class="ident" id="4857587">t</span><span class="op" id="4857588">.</span><span class="ident" id="4857589">Field</span><span class="op" id="4857594">(</span><span class="ident" id="4857595">i</span><span class="op" id="4857596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857601">if</span>&nbsp;<span class="op" id="4857604">!</span><span class="ident" id="4857605">isSent</span><span class="op" id="4857611">(</span><span class="op" id="4857612">&amp;</span><span class="ident" id="4857613">f</span><span class="op" id="4857614">)</span>&nbsp;<span class="op" id="4857616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857622">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857634">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857639">typ</span>&nbsp;<span class="op" id="4857643">:=</span>&nbsp;<span class="ident" id="4857646">userType</span><span class="op" id="4857654">(</span><span class="ident" id="4857655">f</span><span class="op" id="4857656">.</span><span class="ident" id="4857657">Type</span><span class="op" id="4857661">)</span><span class="op" id="4857662">.</span><span class="ident" id="4857663">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857671">tname</span>&nbsp;<span class="op" id="4857677">:=</span>&nbsp;<span class="ident" id="4857680">typ</span><span class="op" id="4857683">.</span><span class="ident" id="4857684">Name</span><span class="op" id="4857688">(</span><span class="op" id="4857689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857694">if</span>&nbsp;<span class="ident" id="4857697">tname</span>&nbsp;<span class="op" id="4857703">==</span>&nbsp;<span class="string" id="4857706">&#34;&#34;</span>&nbsp;<span class="op" id="4857709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857715">t</span>&nbsp;<span class="op" id="4857717">:=</span>&nbsp;<span class="ident" id="4857720">userType</span><span class="op" id="4857728">(</span><span class="ident" id="4857729">f</span><span class="op" id="4857730">.</span><span class="ident" id="4857731">Type</span><span class="op" id="4857735">)</span><span class="op" id="4857736">.</span><span class="ident" id="4857737">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857746">tname</span>&nbsp;<span class="op" id="4857752">=</span>&nbsp;<span class="ident" id="4857754">t</span><span class="op" id="4857755">.</span><span class="ident" id="4857756">String</span><span class="op" id="4857762">(</span><span class="op" id="4857763">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4857773">gt</span><span class="op" id="4857775">,</span>&nbsp;<span class="ident" id="4857777">err</span>&nbsp;<span class="op" id="4857781">:=</span>&nbsp;<span class="ident" id="4857784">getBaseType</span><span class="op" id="4857795">(</span><span class="ident" id="4857796">tname</span><span class="op" id="4857801">,</span>&nbsp;<span class="ident" id="4857803">f</span><span class="op" id="4857804">.</span><span class="ident" id="4857805">Type</span><span class="op" id="4857809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857814">if</span>&nbsp;<span class="ident" id="4857817">err</span>&nbsp;<span class="op" id="4857821">!=</span>&nbsp;<span class="ident" id="4857824">nil</span>&nbsp;<span class="op" id="4857828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4857834">return</span>&nbsp;<span class="ident" id="4857841">nil</span><span class="op" id="4857844">,</span>&nbsp;<span class="ident" id="4857846">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4857853">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4857858">//&nbsp;Some&nbsp;mutually&nbsp;recursive&nbsp;types&nbsp;can&nbsp;cause&nbsp;us&nbsp;to&nbsp;be&nbsp;here&nbsp;while</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4857924">//&nbsp;still&nbsp;defining&nbsp;the&nbsp;element.&nbsp;Fix&nbsp;the&nbsp;element&nbsp;type&nbsp;id&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4857988">//&nbsp;We&nbsp;could&nbsp;do&nbsp;this&nbsp;more&nbsp;neatly&nbsp;by&nbsp;setting&nbsp;the&nbsp;id&nbsp;at&nbsp;the&nbsp;start&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4858057">//&nbsp;building&nbsp;every&nbsp;type,&nbsp;but&nbsp;that&nbsp;would&nbsp;break&nbsp;binary&nbsp;compatibility.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858127">if</span>&nbsp;<span class="ident" id="4858130">gt</span><span class="op" id="4858132">.</span><span class="ident" id="4858133">id</span><span class="op" id="4858135">(</span><span class="op" id="4858136">)</span>&nbsp;<span class="op" id="4858138">==</span>&nbsp;<span class="num" id="4858141">0</span>&nbsp;<span class="op" id="4858143">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858149">setTypeId</span><span class="op" id="4858158">(</span><span class="ident" id="4858159">gt</span><span class="op" id="4858161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858171">st</span><span class="op" id="4858173">.</span><span class="ident" id="4858174">Field</span>&nbsp;<span class="op" id="4858180">=</span>&nbsp;<span class="builtinfunc" id="4858182">append</span><span class="op" id="4858188">(</span><span class="ident" id="4858189">st</span><span class="op" id="4858191">.</span><span class="ident" id="4858192">Field</span><span class="op" id="4858197">,</span>&nbsp;<span class="op" id="4858199">&amp;</span><span class="ident" id="4858200">fieldType</span><span class="op" id="4858209">{</span><span class="ident" id="4858210">f</span><span class="op" id="4858211">.</span><span class="ident" id="4858212">Name</span><span class="op" id="4858216">,</span>&nbsp;<span class="ident" id="4858218">gt</span><span class="op" id="4858220">.</span><span class="ident" id="4858221">id</span><span class="op" id="4858223">(</span><span class="op" id="4858224">)</span><span class="op" id="4858225">}</span><span class="op" id="4858226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858234">return</span>&nbsp;<span class="ident" id="4858241">st</span><span class="op" id="4858243">,</span>&nbsp;<span class="ident" id="4858245">nil</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858251">default</span><span class="op" id="4858258">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858262">return</span>&nbsp;<span class="ident" id="4858269">nil</span><span class="op" id="4858272">,</span>&nbsp;<span class="ident" id="4858274">errors</span><span class="op" id="4858280">.</span><span class="ident" id="4858281">New</span><span class="op" id="4858284">(</span><span class="string" id="4858285">&#34;gob&nbsp;NewTypeObject&nbsp;can&#39;t&nbsp;handle&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="4858325">+</span>&nbsp;<span class="ident" id="4858327">rt</span><span class="op" id="4858329">.</span><span class="ident" id="4858330">String</span><span class="op" id="4858336">(</span><span class="op" id="4858337">)</span><span class="op" id="4858338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858341">}</span><br>
<span class="lineno"></span><span class="op" id="4858343">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="comment" id="4858346">//&nbsp;isExported&nbsp;reports&nbsp;whether&nbsp;this&nbsp;is&nbsp;an&nbsp;exported&nbsp;-&nbsp;upper&nbsp;case&nbsp;-&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="4858417">func</span>&nbsp;<span class="ident" id="4858422">isExported</span><span class="op" id="4858432">(</span><span class="ident" id="4858433">name</span>&nbsp;<span class="builtintype" id="4858438">string</span><span class="op" id="4858444">)</span>&nbsp;<span class="builtintype" id="4858446">bool</span>&nbsp;<span class="op" id="4858451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4858454">rune</span><span class="op" id="4858458">,</span>&nbsp;<span class="ident" id="4858460">_</span>&nbsp;<span class="op" id="4858462">:=</span>&nbsp;<span class="ident" id="4858465">utf8</span><span class="op" id="4858469">.</span><span class="ident" id="4858470">DecodeRuneInString</span><span class="op" id="4858488">(</span><span class="ident" id="4858489">name</span><span class="op" id="4858493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858496">return</span>&nbsp;<span class="ident" id="4858503">unicode</span><span class="op" id="4858510">.</span><span class="ident" id="4858511">IsUpper</span><span class="op" id="4858518">(</span><span class="builtintype" id="4858519">rune</span><span class="op" id="4858523">)</span><br>
<span class="lineno">570</span><span class="op" id="4858525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4858528">//&nbsp;isSent&nbsp;reports&nbsp;whether&nbsp;this&nbsp;struct&nbsp;field&nbsp;is&nbsp;to&nbsp;be&nbsp;transmitted.</span><br>
<span class="lineno"></span><span class="comment" id="4858594">//&nbsp;It&nbsp;will&nbsp;be&nbsp;transmitted&nbsp;only&nbsp;if&nbsp;it&nbsp;is&nbsp;exported&nbsp;and&nbsp;not&nbsp;a&nbsp;chan&nbsp;or&nbsp;func&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="4858672">//&nbsp;or&nbsp;pointer&nbsp;to&nbsp;chan&nbsp;or&nbsp;func.</span><br>
<span class="lineno">575</span><span class="keyword" id="4858703">func</span>&nbsp;<span class="ident" id="4858708">isSent</span><span class="op" id="4858714">(</span><span class="ident" id="4858715">field</span>&nbsp;<span class="op" id="4858721">*</span><span class="ident" id="4858722">reflect</span><span class="op" id="4858729">.</span><span class="ident" id="4858730">StructField</span><span class="op" id="4858741">)</span>&nbsp;<span class="builtintype" id="4858743">bool</span>&nbsp;<span class="op" id="4858748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858751">if</span>&nbsp;<span class="op" id="4858754">!</span><span class="ident" id="4858755">isExported</span><span class="op" id="4858765">(</span><span class="ident" id="4858766">field</span><span class="op" id="4858771">.</span><span class="ident" id="4858772">Name</span><span class="op" id="4858776">)</span>&nbsp;<span class="op" id="4858778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858782">return</span>&nbsp;<span class="builtintype" id="4858789">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4858799">//&nbsp;If&nbsp;the&nbsp;field&nbsp;is&nbsp;a&nbsp;chan&nbsp;or&nbsp;func&nbsp;or&nbsp;pointer&nbsp;thereto,&nbsp;don&#39;t&nbsp;send&nbsp;it.</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4858869">//&nbsp;That&nbsp;is,&nbsp;treat&nbsp;it&nbsp;like&nbsp;an&nbsp;unexported&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858917">typ</span>&nbsp;<span class="op" id="4858921">:=</span>&nbsp;<span class="ident" id="4858924">field</span><span class="op" id="4858929">.</span><span class="ident" id="4858930">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858936">for</span>&nbsp;<span class="ident" id="4858940">typ</span><span class="op" id="4858943">.</span><span class="ident" id="4858944">Kind</span><span class="op" id="4858948">(</span><span class="op" id="4858949">)</span>&nbsp;<span class="op" id="4858951">==</span>&nbsp;<span class="ident" id="4858954">reflect</span><span class="op" id="4858961">.</span><span class="ident" id="4858962">Ptr</span>&nbsp;<span class="op" id="4858966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4858970">typ</span>&nbsp;<span class="op" id="4858974">=</span>&nbsp;<span class="ident" id="4858976">typ</span><span class="op" id="4858979">.</span><span class="ident" id="4858980">Elem</span><span class="op" id="4858984">(</span><span class="op" id="4858985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4858988">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4858991">if</span>&nbsp;<span class="ident" id="4858994">typ</span><span class="op" id="4858997">.</span><span class="ident" id="4858998">Kind</span><span class="op" id="4859002">(</span><span class="op" id="4859003">)</span>&nbsp;<span class="op" id="4859005">==</span>&nbsp;<span class="ident" id="4859008">reflect</span><span class="op" id="4859015">.</span><span class="ident" id="4859016">Chan</span>&nbsp;<span class="op" id="4859021">||</span>&nbsp;<span class="ident" id="4859024">typ</span><span class="op" id="4859027">.</span><span class="ident" id="4859028">Kind</span><span class="op" id="4859032">(</span><span class="op" id="4859033">)</span>&nbsp;<span class="op" id="4859035">==</span>&nbsp;<span class="ident" id="4859038">reflect</span><span class="op" id="4859045">.</span><span class="ident" id="4859046">Func</span>&nbsp;<span class="op" id="4859051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859055">return</span>&nbsp;<span class="builtintype" id="4859062">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4859069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859072">return</span>&nbsp;<span class="builtintype" id="4859079">true</span><br>
<span class="lineno"></span><span class="op" id="4859084">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span><span class="comment" id="4859087">//&nbsp;getBaseType&nbsp;returns&nbsp;the&nbsp;Gob&nbsp;type&nbsp;describing&nbsp;the&nbsp;given&nbsp;reflect.Type&#39;s&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="4859170">//&nbsp;typeLock&nbsp;must&nbsp;be&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="4859196">func</span>&nbsp;<span class="ident" id="4859201">getBaseType</span><span class="op" id="4859212">(</span><span class="ident" id="4859213">name</span>&nbsp;<span class="builtintype" id="4859218">string</span><span class="op" id="4859224">,</span>&nbsp;<span class="ident" id="4859226">rt</span>&nbsp;<span class="ident" id="4859229">reflect</span><span class="op" id="4859236">.</span><span class="ident" id="4859237">Type</span><span class="op" id="4859241">)</span>&nbsp;<span class="op" id="4859243">(</span><span class="ident" id="4859244">gobType</span><span class="op" id="4859251">,</span>&nbsp;<span class="builtintype" id="4859253">error</span><span class="op" id="4859258">)</span>&nbsp;<span class="op" id="4859260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859263">ut</span>&nbsp;<span class="op" id="4859266">:=</span>&nbsp;<span class="ident" id="4859269">userType</span><span class="op" id="4859277">(</span><span class="ident" id="4859278">rt</span><span class="op" id="4859280">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859283">return</span>&nbsp;<span class="ident" id="4859290">getType</span><span class="op" id="4859297">(</span><span class="ident" id="4859298">name</span><span class="op" id="4859302">,</span>&nbsp;<span class="ident" id="4859304">ut</span><span class="op" id="4859306">,</span>&nbsp;<span class="ident" id="4859308">ut</span><span class="op" id="4859310">.</span><span class="ident" id="4859311">base</span><span class="op" id="4859315">)</span><br>
<span class="lineno"></span><span class="op" id="4859317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4859320">//&nbsp;getType&nbsp;returns&nbsp;the&nbsp;Gob&nbsp;type&nbsp;describing&nbsp;the&nbsp;given&nbsp;reflect.Type.</span><br>
<span class="lineno"></span><span class="comment" id="4859387">//&nbsp;Should&nbsp;be&nbsp;called&nbsp;only&nbsp;when&nbsp;handling&nbsp;GobEncoders/Decoders,</span><br>
<span class="lineno">600</span><span class="comment" id="4859448">//&nbsp;which&nbsp;may&nbsp;be&nbsp;pointers.&nbsp;&nbsp;All&nbsp;other&nbsp;types&nbsp;are&nbsp;handled&nbsp;through&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4859515">//&nbsp;base&nbsp;type,&nbsp;never&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span><span class="comment" id="4859546">//&nbsp;typeLock&nbsp;must&nbsp;be&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="4859572">func</span>&nbsp;<span class="ident" id="4859577">getType</span><span class="op" id="4859584">(</span><span class="ident" id="4859585">name</span>&nbsp;<span class="builtintype" id="4859590">string</span><span class="op" id="4859596">,</span>&nbsp;<span class="ident" id="4859598">ut</span>&nbsp;<span class="op" id="4859601">*</span><span class="ident" id="4859602">userTypeInfo</span><span class="op" id="4859614">,</span>&nbsp;<span class="ident" id="4859616">rt</span>&nbsp;<span class="ident" id="4859619">reflect</span><span class="op" id="4859626">.</span><span class="ident" id="4859627">Type</span><span class="op" id="4859631">)</span>&nbsp;<span class="op" id="4859633">(</span><span class="ident" id="4859634">gobType</span><span class="op" id="4859641">,</span>&nbsp;<span class="builtintype" id="4859643">error</span><span class="op" id="4859648">)</span>&nbsp;<span class="op" id="4859650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859653">typ</span><span class="op" id="4859656">,</span>&nbsp;<span class="ident" id="4859658">present</span>&nbsp;<span class="op" id="4859666">:=</span>&nbsp;<span class="ident" id="4859669">types</span><span class="op" id="4859674">[</span><span class="ident" id="4859675">rt</span><span class="op" id="4859677">]</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859680">if</span>&nbsp;<span class="ident" id="4859683">present</span>&nbsp;<span class="op" id="4859691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859695">return</span>&nbsp;<span class="ident" id="4859702">typ</span><span class="op" id="4859705">,</span>&nbsp;<span class="ident" id="4859707">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4859712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859715">typ</span><span class="op" id="4859718">,</span>&nbsp;<span class="ident" id="4859720">err</span>&nbsp;<span class="op" id="4859724">:=</span>&nbsp;<span class="ident" id="4859727">newTypeObject</span><span class="op" id="4859740">(</span><span class="ident" id="4859741">name</span><span class="op" id="4859745">,</span>&nbsp;<span class="ident" id="4859747">ut</span><span class="op" id="4859749">,</span>&nbsp;<span class="ident" id="4859751">rt</span><span class="op" id="4859753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859756">if</span>&nbsp;<span class="ident" id="4859759">err</span>&nbsp;<span class="op" id="4859763">==</span>&nbsp;<span class="ident" id="4859766">nil</span>&nbsp;<span class="op" id="4859770">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859774">types</span><span class="op" id="4859779">[</span><span class="ident" id="4859780">rt</span><span class="op" id="4859782">]</span>&nbsp;<span class="op" id="4859784">=</span>&nbsp;<span class="ident" id="4859786">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4859791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859794">return</span>&nbsp;<span class="ident" id="4859801">typ</span><span class="op" id="4859804">,</span>&nbsp;<span class="ident" id="4859806">err</span><br>
<span class="lineno"></span><span class="op" id="4859810">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span><span class="keyword" id="4859813">func</span>&nbsp;<span class="ident" id="4859818">checkId</span><span class="op" id="4859825">(</span><span class="ident" id="4859826">want</span><span class="op" id="4859830">,</span>&nbsp;<span class="ident" id="4859832">got</span>&nbsp;<span class="ident" id="4859836">typeId</span><span class="op" id="4859842">)</span>&nbsp;<span class="op" id="4859844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4859847">if</span>&nbsp;<span class="ident" id="4859850">want</span>&nbsp;<span class="op" id="4859855">!=</span>&nbsp;<span class="ident" id="4859858">got</span>&nbsp;<span class="op" id="4859862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4859866">fmt</span><span class="op" id="4859869">.</span><span class="ident" id="4859870">Fprintf</span><span class="op" id="4859877">(</span><span class="ident" id="4859878">os</span><span class="op" id="4859880">.</span><span class="ident" id="4859881">Stderr</span><span class="op" id="4859887">,</span>&nbsp;<span class="string" id="4859889">&#34;checkId:&nbsp;%d&nbsp;should&nbsp;be&nbsp;%d\n&#34;</span><span class="op" id="4859917">,</span>&nbsp;<span class="builtintype" id="4859919">int</span><span class="op" id="4859922">(</span><span class="ident" id="4859923">got</span><span class="op" id="4859926">)</span><span class="op" id="4859927">,</span>&nbsp;<span class="builtintype" id="4859929">int</span><span class="op" id="4859932">(</span><span class="ident" id="4859933">want</span><span class="op" id="4859937">)</span><span class="op" id="4859938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4859942">panic</span><span class="op" id="4859947">(</span><span class="string" id="4859948">&#34;bootstrap&nbsp;type&nbsp;wrong&nbsp;id:&nbsp;&#34;</span>&nbsp;<span class="op" id="4859976">+</span>&nbsp;<span class="ident" id="4859978">got</span><span class="op" id="4859981">.</span><span class="ident" id="4859982">name</span><span class="op" id="4859986">(</span><span class="op" id="4859987">)</span>&nbsp;<span class="op" id="4859989">+</span>&nbsp;<span class="string" id="4859991">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="4859995">+</span>&nbsp;<span class="ident" id="4859997">got</span><span class="op" id="4860000">.</span><span class="builtintype" id="4860001">string</span><span class="op" id="4860007">(</span><span class="op" id="4860008">)</span>&nbsp;<span class="op" id="4860010">+</span>&nbsp;<span class="string" id="4860012">&#34;&nbsp;not&nbsp;&#34;</span>&nbsp;<span class="op" id="4860020">+</span>&nbsp;<span class="ident" id="4860022">want</span><span class="op" id="4860026">.</span><span class="builtintype" id="4860027">string</span><span class="op" id="4860033">(</span><span class="op" id="4860034">)</span><span class="op" id="4860035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4860038">}</span><br>
<span class="lineno">620</span><span class="op" id="4860040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4860043">//&nbsp;used&nbsp;for&nbsp;building&nbsp;the&nbsp;basic&nbsp;types;&nbsp;called&nbsp;only&nbsp;from&nbsp;init().&nbsp;&nbsp;the&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="4860120">//&nbsp;interface&nbsp;always&nbsp;refers&nbsp;to&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span><span class="keyword" id="4860161">func</span>&nbsp;<span class="ident" id="4860166">bootstrapType</span><span class="op" id="4860179">(</span><span class="ident" id="4860180">name</span>&nbsp;<span class="builtintype" id="4860185">string</span><span class="op" id="4860191">,</span>&nbsp;<span class="ident" id="4860193">e</span>&nbsp;<span class="keyword" id="4860195">interface</span><span class="op" id="4860204">{</span><span class="op" id="4860205">}</span><span class="op" id="4860206">,</span>&nbsp;<span class="ident" id="4860208">expect</span>&nbsp;<span class="ident" id="4860215">typeId</span><span class="op" id="4860221">)</span>&nbsp;<span class="ident" id="4860223">typeId</span>&nbsp;<span class="op" id="4860230">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4860233">rt</span>&nbsp;<span class="op" id="4860236">:=</span>&nbsp;<span class="ident" id="4860239">reflect</span><span class="op" id="4860246">.</span><span class="ident" id="4860247">TypeOf</span><span class="op" id="4860253">(</span><span class="ident" id="4860254">e</span><span class="op" id="4860255">)</span><span class="op" id="4860256">.</span><span class="ident" id="4860257">Elem</span><span class="op" id="4860261">(</span><span class="op" id="4860262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4860265">_</span><span class="op" id="4860266">,</span>&nbsp;<span class="ident" id="4860268">present</span>&nbsp;<span class="op" id="4860276">:=</span>&nbsp;<span class="ident" id="4860279">types</span><span class="op" id="4860284">[</span><span class="ident" id="4860285">rt</span><span class="op" id="4860287">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4860290">if</span>&nbsp;<span class="ident" id="4860293">present</span>&nbsp;<span class="op" id="4860301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4860305">panic</span><span class="op" id="4860310">(</span><span class="string" id="4860311">&#34;bootstrap&nbsp;type&nbsp;already&nbsp;present:&nbsp;&#34;</span>&nbsp;<span class="op" id="4860346">+</span>&nbsp;<span class="ident" id="4860348">name</span>&nbsp;<span class="op" id="4860353">+</span>&nbsp;<span class="string" id="4860355">&#34;,&nbsp;&#34;</span>&nbsp;<span class="op" id="4860360">+</span>&nbsp;<span class="ident" id="4860362">rt</span><span class="op" id="4860364">.</span><span class="ident" id="4860365">String</span><span class="op" id="4860371">(</span><span class="op" id="4860372">)</span><span class="op" id="4860373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4860376">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4860379">typ</span>&nbsp;<span class="op" id="4860383">:=</span>&nbsp;<span class="op" id="4860386">&amp;</span><span class="ident" id="4860387">CommonType</span><span class="op" id="4860397">{</span><span class="ident" id="4860398">Name</span><span class="op" id="4860402">:</span>&nbsp;<span class="ident" id="4860404">name</span><span class="op" id="4860408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4860411">types</span><span class="op" id="4860416">[</span><span class="ident" id="4860417">rt</span><span class="op" id="4860419">]</span>&nbsp;<span class="op" id="4860421">=</span>&nbsp;<span class="ident" id="4860423">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4860428">setTypeId</span><span class="op" id="4860437">(</span><span class="ident" id="4860438">typ</span><span class="op" id="4860441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4860444">checkId</span><span class="op" id="4860451">(</span><span class="ident" id="4860452">expect</span><span class="op" id="4860458">,</span>&nbsp;<span class="ident" id="4860460">nextId</span><span class="op" id="4860466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4860469">userType</span><span class="op" id="4860477">(</span><span class="ident" id="4860478">rt</span><span class="op" id="4860480">)</span>&nbsp;<span class="comment" id="4860482">//&nbsp;might&nbsp;as&nbsp;well&nbsp;cache&nbsp;it&nbsp;now</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4860513">return</span>&nbsp;<span class="ident" id="4860520">nextId</span><br>
<span class="lineno"></span><span class="op" id="4860527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4860530">//&nbsp;Representation&nbsp;of&nbsp;the&nbsp;information&nbsp;we&nbsp;send&nbsp;and&nbsp;receive&nbsp;about&nbsp;this&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="4860604">//&nbsp;Each&nbsp;value&nbsp;we&nbsp;send&nbsp;is&nbsp;preceded&nbsp;by&nbsp;its&nbsp;type&nbsp;definition:&nbsp;an&nbsp;encoded&nbsp;int.</span><br>
<span class="lineno">640</span><span class="comment" id="4860678">//&nbsp;However,&nbsp;the&nbsp;very&nbsp;first&nbsp;time&nbsp;we&nbsp;send&nbsp;the&nbsp;value,&nbsp;we&nbsp;first&nbsp;send&nbsp;the&nbsp;pair</span><br>
<span class="lineno"></span><span class="comment" id="4860752">//&nbsp;(-id,&nbsp;wireType).</span><br>
<span class="lineno"></span><span class="comment" id="4860772">//&nbsp;For&nbsp;bootstrapping&nbsp;purposes,&nbsp;we&nbsp;assume&nbsp;that&nbsp;the&nbsp;recipient&nbsp;knows&nbsp;how</span><br>
<span class="lineno"></span><span class="comment" id="4860842">//&nbsp;to&nbsp;decode&nbsp;a&nbsp;wireType;&nbsp;it&nbsp;is&nbsp;exactly&nbsp;the&nbsp;wireType&nbsp;struct&nbsp;here,&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="4860919">//&nbsp;using&nbsp;the&nbsp;gob&nbsp;rules&nbsp;for&nbsp;sending&nbsp;a&nbsp;structure,&nbsp;except&nbsp;that&nbsp;we&nbsp;assume&nbsp;the</span><br>
<span class="lineno">645</span><span class="comment" id="4860993">//&nbsp;ids&nbsp;for&nbsp;wireType&nbsp;and&nbsp;structType&nbsp;etc.&nbsp;are&nbsp;known.&nbsp;&nbsp;The&nbsp;relevant&nbsp;pieces</span><br>
<span class="lineno"></span><span class="comment" id="4861065">//&nbsp;are&nbsp;built&nbsp;in&nbsp;encode.go&#39;s&nbsp;init()&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="4861110">//&nbsp;To&nbsp;maintain&nbsp;binary&nbsp;compatibility,&nbsp;if&nbsp;you&nbsp;extend&nbsp;this&nbsp;type,&nbsp;always&nbsp;put</span><br>
<span class="lineno"></span><span class="comment" id="4861183">//&nbsp;the&nbsp;new&nbsp;fields&nbsp;last.</span><br>
<span class="lineno"></span><span class="keyword" id="4861207">type</span>&nbsp;<span class="ident" id="4861212">wireType</span>&nbsp;<span class="keyword" id="4861221">struct</span>&nbsp;<span class="op" id="4861228">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861231">ArrayT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4861248">*</span><span class="ident" id="4861249">arrayType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861260">SliceT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4861277">*</span><span class="ident" id="4861278">sliceType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861289">StructT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4861306">*</span><span class="ident" id="4861307">structType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861319">MapT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4861336">*</span><span class="ident" id="4861337">mapType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861346">GobEncoderT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4861363">*</span><span class="ident" id="4861364">gobEncoderType</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861380">BinaryMarshalerT</span>&nbsp;<span class="op" id="4861397">*</span><span class="ident" id="4861398">gobEncoderType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861414">TextMarshalerT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4861431">*</span><span class="ident" id="4861432">gobEncoderType</span><br>
<span class="lineno"></span><span class="op" id="4861447">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4861450">func</span>&nbsp;<span class="op" id="4861455">(</span><span class="ident" id="4861456">w</span>&nbsp;<span class="op" id="4861458">*</span><span class="ident" id="4861459">wireType</span><span class="op" id="4861467">)</span>&nbsp;<span class="builtintype" id="4861469">string</span><span class="op" id="4861475">(</span><span class="op" id="4861476">)</span>&nbsp;<span class="builtintype" id="4861478">string</span>&nbsp;<span class="op" id="4861485">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861488">const</span>&nbsp;<span class="ident" id="4861494">unknown</span>&nbsp;<span class="op" id="4861502">=</span>&nbsp;<span class="string" id="4861504">&#34;unknown&nbsp;type&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861520">if</span>&nbsp;<span class="ident" id="4861523">w</span>&nbsp;<span class="op" id="4861525">==</span>&nbsp;<span class="ident" id="4861528">nil</span>&nbsp;<span class="op" id="4861532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861536">return</span>&nbsp;<span class="ident" id="4861543">unknown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4861552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861555">switch</span>&nbsp;<span class="op" id="4861562">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861565">case</span>&nbsp;<span class="ident" id="4861570">w</span><span class="op" id="4861571">.</span><span class="ident" id="4861572">ArrayT</span>&nbsp;<span class="op" id="4861579">!=</span>&nbsp;<span class="ident" id="4861582">nil</span><span class="op" id="4861585">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861589">return</span>&nbsp;<span class="ident" id="4861596">w</span><span class="op" id="4861597">.</span><span class="ident" id="4861598">ArrayT</span><span class="op" id="4861604">.</span><span class="ident" id="4861605">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861611">case</span>&nbsp;<span class="ident" id="4861616">w</span><span class="op" id="4861617">.</span><span class="ident" id="4861618">SliceT</span>&nbsp;<span class="op" id="4861625">!=</span>&nbsp;<span class="ident" id="4861628">nil</span><span class="op" id="4861631">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861635">return</span>&nbsp;<span class="ident" id="4861642">w</span><span class="op" id="4861643">.</span><span class="ident" id="4861644">SliceT</span><span class="op" id="4861650">.</span><span class="ident" id="4861651">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861657">case</span>&nbsp;<span class="ident" id="4861662">w</span><span class="op" id="4861663">.</span><span class="ident" id="4861664">StructT</span>&nbsp;<span class="op" id="4861672">!=</span>&nbsp;<span class="ident" id="4861675">nil</span><span class="op" id="4861678">:</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861682">return</span>&nbsp;<span class="ident" id="4861689">w</span><span class="op" id="4861690">.</span><span class="ident" id="4861691">StructT</span><span class="op" id="4861698">.</span><span class="ident" id="4861699">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861705">case</span>&nbsp;<span class="ident" id="4861710">w</span><span class="op" id="4861711">.</span><span class="ident" id="4861712">MapT</span>&nbsp;<span class="op" id="4861717">!=</span>&nbsp;<span class="ident" id="4861720">nil</span><span class="op" id="4861723">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861727">return</span>&nbsp;<span class="ident" id="4861734">w</span><span class="op" id="4861735">.</span><span class="ident" id="4861736">MapT</span><span class="op" id="4861740">.</span><span class="ident" id="4861741">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861747">case</span>&nbsp;<span class="ident" id="4861752">w</span><span class="op" id="4861753">.</span><span class="ident" id="4861754">GobEncoderT</span>&nbsp;<span class="op" id="4861766">!=</span>&nbsp;<span class="ident" id="4861769">nil</span><span class="op" id="4861772">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861776">return</span>&nbsp;<span class="ident" id="4861783">w</span><span class="op" id="4861784">.</span><span class="ident" id="4861785">GobEncoderT</span><span class="op" id="4861796">.</span><span class="ident" id="4861797">Name</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861803">case</span>&nbsp;<span class="ident" id="4861808">w</span><span class="op" id="4861809">.</span><span class="ident" id="4861810">BinaryMarshalerT</span>&nbsp;<span class="op" id="4861827">!=</span>&nbsp;<span class="ident" id="4861830">nil</span><span class="op" id="4861833">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861837">return</span>&nbsp;<span class="ident" id="4861844">w</span><span class="op" id="4861845">.</span><span class="ident" id="4861846">BinaryMarshalerT</span><span class="op" id="4861862">.</span><span class="ident" id="4861863">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861869">case</span>&nbsp;<span class="ident" id="4861874">w</span><span class="op" id="4861875">.</span><span class="ident" id="4861876">TextMarshalerT</span>&nbsp;<span class="op" id="4861891">!=</span>&nbsp;<span class="ident" id="4861894">nil</span><span class="op" id="4861897">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861901">return</span>&nbsp;<span class="ident" id="4861908">w</span><span class="op" id="4861909">.</span><span class="ident" id="4861910">TextMarshalerT</span><span class="op" id="4861924">.</span><span class="ident" id="4861925">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4861931">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4861934">return</span>&nbsp;<span class="ident" id="4861941">unknown</span><br>
<span class="lineno"></span><span class="op" id="4861949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4861952">type</span>&nbsp;<span class="ident" id="4861957">typeInfo</span>&nbsp;<span class="keyword" id="4861966">struct</span>&nbsp;<span class="op" id="4861973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861976">id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4861984">typeId</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4861992">encInit</span>&nbsp;<span class="ident" id="4862000">sync</span><span class="op" id="4862004">.</span><span class="ident" id="4862005">Mutex</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4862013">//&nbsp;protects&nbsp;creation&nbsp;of&nbsp;encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4862046">encoder</span>&nbsp;<span class="ident" id="4862054">atomic</span><span class="op" id="4862060">.</span><span class="ident" id="4862061">Value</span>&nbsp;<span class="comment" id="4862067">//&nbsp;*encEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4862082">wire</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4862090">*</span><span class="ident" id="4862091">wireType</span><br>
<span class="lineno"></span><span class="op" id="4862100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">690</span><span class="comment" id="4862103">//&nbsp;typeInfoMap&nbsp;is&nbsp;an&nbsp;atomic&nbsp;pointer&nbsp;to&nbsp;map[reflect.Type]*typeInfo.</span><br>
<span class="lineno"></span><span class="comment" id="4862170">//&nbsp;It&#39;s&nbsp;updated&nbsp;copy-on-write.&nbsp;Readers&nbsp;just&nbsp;do&nbsp;an&nbsp;atomic&nbsp;load</span><br>
<span class="lineno"></span><span class="comment" id="4862232">//&nbsp;to&nbsp;get&nbsp;the&nbsp;current&nbsp;version&nbsp;of&nbsp;the&nbsp;map.&nbsp;Writers&nbsp;make&nbsp;a&nbsp;full&nbsp;copy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4862302">//&nbsp;the&nbsp;map&nbsp;and&nbsp;atomically&nbsp;update&nbsp;the&nbsp;pointer&nbsp;to&nbsp;point&nbsp;to&nbsp;the&nbsp;new&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="4862372">//&nbsp;Under&nbsp;heavy&nbsp;read&nbsp;contention,&nbsp;this&nbsp;is&nbsp;significantly&nbsp;faster&nbsp;than&nbsp;a&nbsp;map</span><br>
<span class="lineno">695</span><span class="comment" id="4862444">//&nbsp;protected&nbsp;by&nbsp;a&nbsp;mutex.</span><br>
<span class="lineno"></span><span class="keyword" id="4862469">var</span>&nbsp;<span class="ident" id="4862473">typeInfoMap</span>&nbsp;<span class="ident" id="4862485">atomic</span><span class="op" id="4862491">.</span><span class="ident" id="4862492">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4862499">func</span>&nbsp;<span class="ident" id="4862504">lookupTypeInfo</span><span class="op" id="4862518">(</span><span class="ident" id="4862519">rt</span>&nbsp;<span class="ident" id="4862522">reflect</span><span class="op" id="4862529">.</span><span class="ident" id="4862530">Type</span><span class="op" id="4862534">)</span>&nbsp;<span class="op" id="4862536">*</span><span class="ident" id="4862537">typeInfo</span>&nbsp;<span class="op" id="4862546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4862549">m</span><span class="op" id="4862550">,</span>&nbsp;<span class="ident" id="4862552">_</span>&nbsp;<span class="op" id="4862554">:=</span>&nbsp;<span class="ident" id="4862557">typeInfoMap</span><span class="op" id="4862568">.</span><span class="ident" id="4862569">Load</span><span class="op" id="4862573">(</span><span class="op" id="4862574">)</span><span class="op" id="4862575">.</span><span class="op" id="4862576">(</span><span class="keyword" id="4862577">map</span><span class="op" id="4862580">[</span><span class="ident" id="4862581">reflect</span><span class="op" id="4862588">.</span><span class="ident" id="4862589">Type</span><span class="op" id="4862593">]</span><span class="op" id="4862594">*</span><span class="ident" id="4862595">typeInfo</span><span class="op" id="4862603">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862606">return</span>&nbsp;<span class="ident" id="4862613">m</span><span class="op" id="4862614">[</span><span class="ident" id="4862615">rt</span><span class="op" id="4862617">]</span><br>
<span class="lineno"></span><span class="op" id="4862619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4862622">func</span>&nbsp;<span class="ident" id="4862627">getTypeInfo</span><span class="op" id="4862638">(</span><span class="ident" id="4862639">ut</span>&nbsp;<span class="op" id="4862642">*</span><span class="ident" id="4862643">userTypeInfo</span><span class="op" id="4862655">)</span>&nbsp;<span class="op" id="4862657">(</span><span class="op" id="4862658">*</span><span class="ident" id="4862659">typeInfo</span><span class="op" id="4862667">,</span>&nbsp;<span class="builtintype" id="4862669">error</span><span class="op" id="4862674">)</span>&nbsp;<span class="op" id="4862676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4862679">rt</span>&nbsp;<span class="op" id="4862682">:=</span>&nbsp;<span class="ident" id="4862685">ut</span><span class="op" id="4862687">.</span><span class="ident" id="4862688">base</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862694">if</span>&nbsp;<span class="ident" id="4862697">ut</span><span class="op" id="4862699">.</span><span class="ident" id="4862700">externalEnc</span>&nbsp;<span class="op" id="4862712">!=</span>&nbsp;<span class="num" id="4862715">0</span>&nbsp;<span class="op" id="4862717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4862721">//&nbsp;We&nbsp;want&nbsp;the&nbsp;user&nbsp;type,&nbsp;not&nbsp;the&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4862768">rt</span>&nbsp;<span class="op" id="4862771">=</span>&nbsp;<span class="ident" id="4862773">ut</span><span class="op" id="4862775">.</span><span class="ident" id="4862776">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4862782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862785">if</span>&nbsp;<span class="ident" id="4862788">info</span>&nbsp;<span class="op" id="4862793">:=</span>&nbsp;<span class="ident" id="4862796">lookupTypeInfo</span><span class="op" id="4862810">(</span><span class="ident" id="4862811">rt</span><span class="op" id="4862813">)</span><span class="op" id="4862814">;</span>&nbsp;<span class="ident" id="4862816">info</span>&nbsp;<span class="op" id="4862821">!=</span>&nbsp;<span class="ident" id="4862824">nil</span>&nbsp;<span class="op" id="4862828">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862832">return</span>&nbsp;<span class="ident" id="4862839">info</span><span class="op" id="4862843">,</span>&nbsp;<span class="ident" id="4862845">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4862850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4862853">return</span>&nbsp;<span class="ident" id="4862860">buildTypeInfo</span><span class="op" id="4862873">(</span><span class="ident" id="4862874">ut</span><span class="op" id="4862876">,</span>&nbsp;<span class="ident" id="4862878">rt</span><span class="op" id="4862880">)</span><br>
<span class="lineno"></span><span class="op" id="4862882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">715</span><span class="comment" id="4862885">//&nbsp;buildTypeInfo&nbsp;constructs&nbsp;the&nbsp;type&nbsp;information&nbsp;for&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="4862947">//&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;the&nbsp;type&nbsp;info&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="4862986">func</span>&nbsp;<span class="ident" id="4862991">buildTypeInfo</span><span class="op" id="4863004">(</span><span class="ident" id="4863005">ut</span>&nbsp;<span class="op" id="4863008">*</span><span class="ident" id="4863009">userTypeInfo</span><span class="op" id="4863021">,</span>&nbsp;<span class="ident" id="4863023">rt</span>&nbsp;<span class="ident" id="4863026">reflect</span><span class="op" id="4863033">.</span><span class="ident" id="4863034">Type</span><span class="op" id="4863038">)</span>&nbsp;<span class="op" id="4863040">(</span><span class="op" id="4863041">*</span><span class="ident" id="4863042">typeInfo</span><span class="op" id="4863050">,</span>&nbsp;<span class="builtintype" id="4863052">error</span><span class="op" id="4863057">)</span>&nbsp;<span class="op" id="4863059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863062">typeLock</span><span class="op" id="4863070">.</span><span class="ident" id="4863071">Lock</span><span class="op" id="4863075">(</span><span class="op" id="4863076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863079">defer</span>&nbsp;<span class="ident" id="4863085">typeLock</span><span class="op" id="4863093">.</span><span class="ident" id="4863094">Unlock</span><span class="op" id="4863100">(</span><span class="op" id="4863101">)</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863105">if</span>&nbsp;<span class="ident" id="4863108">info</span>&nbsp;<span class="op" id="4863113">:=</span>&nbsp;<span class="ident" id="4863116">lookupTypeInfo</span><span class="op" id="4863130">(</span><span class="ident" id="4863131">rt</span><span class="op" id="4863133">)</span><span class="op" id="4863134">;</span>&nbsp;<span class="ident" id="4863136">info</span>&nbsp;<span class="op" id="4863141">!=</span>&nbsp;<span class="ident" id="4863144">nil</span>&nbsp;<span class="op" id="4863148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863152">return</span>&nbsp;<span class="ident" id="4863159">info</span><span class="op" id="4863163">,</span>&nbsp;<span class="ident" id="4863165">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4863170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863174">gt</span><span class="op" id="4863176">,</span>&nbsp;<span class="ident" id="4863178">err</span>&nbsp;<span class="op" id="4863182">:=</span>&nbsp;<span class="ident" id="4863185">getBaseType</span><span class="op" id="4863196">(</span><span class="ident" id="4863197">rt</span><span class="op" id="4863199">.</span><span class="ident" id="4863200">Name</span><span class="op" id="4863204">(</span><span class="op" id="4863205">)</span><span class="op" id="4863206">,</span>&nbsp;<span class="ident" id="4863208">rt</span><span class="op" id="4863210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863213">if</span>&nbsp;<span class="ident" id="4863216">err</span>&nbsp;<span class="op" id="4863220">!=</span>&nbsp;<span class="ident" id="4863223">nil</span>&nbsp;<span class="op" id="4863227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863231">return</span>&nbsp;<span class="ident" id="4863238">nil</span><span class="op" id="4863241">,</span>&nbsp;<span class="ident" id="4863243">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4863248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863251">info</span>&nbsp;<span class="op" id="4863256">:=</span>&nbsp;<span class="op" id="4863259">&amp;</span><span class="ident" id="4863260">typeInfo</span><span class="op" id="4863268">{</span><span class="ident" id="4863269">id</span><span class="op" id="4863271">:</span>&nbsp;<span class="ident" id="4863273">gt</span><span class="op" id="4863275">.</span><span class="ident" id="4863276">id</span><span class="op" id="4863278">(</span><span class="op" id="4863279">)</span><span class="op" id="4863280">}</span><br>
<span class="lineno">730</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863284">if</span>&nbsp;<span class="ident" id="4863287">ut</span><span class="op" id="4863289">.</span><span class="ident" id="4863290">externalEnc</span>&nbsp;<span class="op" id="4863302">!=</span>&nbsp;<span class="num" id="4863305">0</span>&nbsp;<span class="op" id="4863307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863311">userType</span><span class="op" id="4863319">,</span>&nbsp;<span class="ident" id="4863321">err</span>&nbsp;<span class="op" id="4863325">:=</span>&nbsp;<span class="ident" id="4863328">getType</span><span class="op" id="4863335">(</span><span class="ident" id="4863336">rt</span><span class="op" id="4863338">.</span><span class="ident" id="4863339">Name</span><span class="op" id="4863343">(</span><span class="op" id="4863344">)</span><span class="op" id="4863345">,</span>&nbsp;<span class="ident" id="4863347">ut</span><span class="op" id="4863349">,</span>&nbsp;<span class="ident" id="4863351">rt</span><span class="op" id="4863353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863357">if</span>&nbsp;<span class="ident" id="4863360">err</span>&nbsp;<span class="op" id="4863364">!=</span>&nbsp;<span class="ident" id="4863367">nil</span>&nbsp;<span class="op" id="4863371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863376">return</span>&nbsp;<span class="ident" id="4863383">nil</span><span class="op" id="4863386">,</span>&nbsp;<span class="ident" id="4863388">err</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4863394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863398">gt</span>&nbsp;<span class="op" id="4863401">:=</span>&nbsp;<span class="ident" id="4863404">userType</span><span class="op" id="4863412">.</span><span class="ident" id="4863413">id</span><span class="op" id="4863415">(</span><span class="op" id="4863416">)</span><span class="op" id="4863417">.</span><span class="ident" id="4863418">gobType</span><span class="op" id="4863425">(</span><span class="op" id="4863426">)</span><span class="op" id="4863427">.</span><span class="op" id="4863428">(</span><span class="op" id="4863429">*</span><span class="ident" id="4863430">gobEncoderType</span><span class="op" id="4863444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863448">switch</span>&nbsp;<span class="ident" id="4863455">ut</span><span class="op" id="4863457">.</span><span class="ident" id="4863458">externalEnc</span>&nbsp;<span class="op" id="4863470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863474">case</span>&nbsp;<span class="ident" id="4863479">xGob</span><span class="op" id="4863483">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863488">info</span><span class="op" id="4863492">.</span><span class="ident" id="4863493">wire</span>&nbsp;<span class="op" id="4863498">=</span>&nbsp;<span class="op" id="4863500">&amp;</span><span class="ident" id="4863501">wireType</span><span class="op" id="4863509">{</span><span class="ident" id="4863510">GobEncoderT</span><span class="op" id="4863521">:</span>&nbsp;<span class="ident" id="4863523">gt</span><span class="op" id="4863525">}</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863529">case</span>&nbsp;<span class="ident" id="4863534">xBinary</span><span class="op" id="4863541">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863546">info</span><span class="op" id="4863550">.</span><span class="ident" id="4863551">wire</span>&nbsp;<span class="op" id="4863556">=</span>&nbsp;<span class="op" id="4863558">&amp;</span><span class="ident" id="4863559">wireType</span><span class="op" id="4863567">{</span><span class="ident" id="4863568">BinaryMarshalerT</span><span class="op" id="4863584">:</span>&nbsp;<span class="ident" id="4863586">gt</span><span class="op" id="4863588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863592">case</span>&nbsp;<span class="ident" id="4863597">xText</span><span class="op" id="4863602">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863607">info</span><span class="op" id="4863611">.</span><span class="ident" id="4863612">wire</span>&nbsp;<span class="op" id="4863617">=</span>&nbsp;<span class="op" id="4863619">&amp;</span><span class="ident" id="4863620">wireType</span><span class="op" id="4863628">{</span><span class="ident" id="4863629">TextMarshalerT</span><span class="op" id="4863643">:</span>&nbsp;<span class="ident" id="4863645">gt</span><span class="op" id="4863647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4863651">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863655">rt</span>&nbsp;<span class="op" id="4863658">=</span>&nbsp;<span class="ident" id="4863660">ut</span><span class="op" id="4863662">.</span><span class="ident" id="4863663">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4863669">}</span>&nbsp;<span class="keyword" id="4863671">else</span>&nbsp;<span class="op" id="4863676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863680">t</span>&nbsp;<span class="op" id="4863682">:=</span>&nbsp;<span class="ident" id="4863685">info</span><span class="op" id="4863689">.</span><span class="ident" id="4863690">id</span><span class="op" id="4863692">.</span><span class="ident" id="4863693">gobType</span><span class="op" id="4863700">(</span><span class="op" id="4863701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863705">switch</span>&nbsp;<span class="ident" id="4863712">typ</span>&nbsp;<span class="op" id="4863716">:=</span>&nbsp;<span class="ident" id="4863719">rt</span><span class="op" id="4863721">;</span>&nbsp;<span class="ident" id="4863723">typ</span><span class="op" id="4863726">.</span><span class="ident" id="4863727">Kind</span><span class="op" id="4863731">(</span><span class="op" id="4863732">)</span>&nbsp;<span class="op" id="4863734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863738">case</span>&nbsp;<span class="ident" id="4863743">reflect</span><span class="op" id="4863750">.</span><span class="ident" id="4863751">Array</span><span class="op" id="4863756">:</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863761">info</span><span class="op" id="4863765">.</span><span class="ident" id="4863766">wire</span>&nbsp;<span class="op" id="4863771">=</span>&nbsp;<span class="op" id="4863773">&amp;</span><span class="ident" id="4863774">wireType</span><span class="op" id="4863782">{</span><span class="ident" id="4863783">ArrayT</span><span class="op" id="4863789">:</span>&nbsp;<span class="ident" id="4863791">t</span><span class="op" id="4863792">.</span><span class="op" id="4863793">(</span><span class="op" id="4863794">*</span><span class="ident" id="4863795">arrayType</span><span class="op" id="4863804">)</span><span class="op" id="4863805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863809">case</span>&nbsp;<span class="ident" id="4863814">reflect</span><span class="op" id="4863821">.</span><span class="ident" id="4863822">Map</span><span class="op" id="4863825">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4863830">info</span><span class="op" id="4863834">.</span><span class="ident" id="4863835">wire</span>&nbsp;<span class="op" id="4863840">=</span>&nbsp;<span class="op" id="4863842">&amp;</span><span class="ident" id="4863843">wireType</span><span class="op" id="4863851">{</span><span class="ident" id="4863852">MapT</span><span class="op" id="4863856">:</span>&nbsp;<span class="ident" id="4863858">t</span><span class="op" id="4863859">.</span><span class="op" id="4863860">(</span><span class="op" id="4863861">*</span><span class="ident" id="4863862">mapType</span><span class="op" id="4863869">)</span><span class="op" id="4863870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863874">case</span>&nbsp;<span class="ident" id="4863879">reflect</span><span class="op" id="4863886">.</span><span class="ident" id="4863887">Slice</span><span class="op" id="4863892">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4863897">//&nbsp;[]byte&nbsp;==&nbsp;[]uint8&nbsp;is&nbsp;a&nbsp;special&nbsp;case&nbsp;handled&nbsp;separately</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4863958">if</span>&nbsp;<span class="ident" id="4863961">typ</span><span class="op" id="4863964">.</span><span class="ident" id="4863965">Elem</span><span class="op" id="4863969">(</span><span class="op" id="4863970">)</span><span class="op" id="4863971">.</span><span class="ident" id="4863972">Kind</span><span class="op" id="4863976">(</span><span class="op" id="4863977">)</span>&nbsp;<span class="op" id="4863979">!=</span>&nbsp;<span class="ident" id="4863982">reflect</span><span class="op" id="4863989">.</span><span class="ident" id="4863990">Uint8</span>&nbsp;<span class="op" id="4863996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864002">info</span><span class="op" id="4864006">.</span><span class="ident" id="4864007">wire</span>&nbsp;<span class="op" id="4864012">=</span>&nbsp;<span class="op" id="4864014">&amp;</span><span class="ident" id="4864015">wireType</span><span class="op" id="4864023">{</span><span class="ident" id="4864024">SliceT</span><span class="op" id="4864030">:</span>&nbsp;<span class="ident" id="4864032">t</span><span class="op" id="4864033">.</span><span class="op" id="4864034">(</span><span class="op" id="4864035">*</span><span class="ident" id="4864036">sliceType</span><span class="op" id="4864045">)</span><span class="op" id="4864046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4864051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864055">case</span>&nbsp;<span class="ident" id="4864060">reflect</span><span class="op" id="4864067">.</span><span class="ident" id="4864068">Struct</span><span class="op" id="4864074">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864079">info</span><span class="op" id="4864083">.</span><span class="ident" id="4864084">wire</span>&nbsp;<span class="op" id="4864089">=</span>&nbsp;<span class="op" id="4864091">&amp;</span><span class="ident" id="4864092">wireType</span><span class="op" id="4864100">{</span><span class="ident" id="4864101">StructT</span><span class="op" id="4864108">:</span>&nbsp;<span class="ident" id="4864110">t</span><span class="op" id="4864111">.</span><span class="op" id="4864112">(</span><span class="op" id="4864113">*</span><span class="ident" id="4864114">structType</span><span class="op" id="4864124">)</span><span class="op" id="4864125">}</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4864129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4864132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4864136">//&nbsp;Create&nbsp;new&nbsp;map&nbsp;with&nbsp;old&nbsp;contents&nbsp;plus&nbsp;new&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864189">newm</span>&nbsp;<span class="op" id="4864194">:=</span>&nbsp;<span class="builtinfunc" id="4864197">make</span><span class="op" id="4864201">(</span><span class="keyword" id="4864202">map</span><span class="op" id="4864205">[</span><span class="ident" id="4864206">reflect</span><span class="op" id="4864213">.</span><span class="ident" id="4864214">Type</span><span class="op" id="4864218">]</span><span class="op" id="4864219">*</span><span class="ident" id="4864220">typeInfo</span><span class="op" id="4864228">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864231">m</span><span class="op" id="4864232">,</span>&nbsp;<span class="ident" id="4864234">_</span>&nbsp;<span class="op" id="4864236">:=</span>&nbsp;<span class="ident" id="4864239">typeInfoMap</span><span class="op" id="4864250">.</span><span class="ident" id="4864251">Load</span><span class="op" id="4864255">(</span><span class="op" id="4864256">)</span><span class="op" id="4864257">.</span><span class="op" id="4864258">(</span><span class="keyword" id="4864259">map</span><span class="op" id="4864262">[</span><span class="ident" id="4864263">reflect</span><span class="op" id="4864270">.</span><span class="ident" id="4864271">Type</span><span class="op" id="4864275">]</span><span class="op" id="4864276">*</span><span class="ident" id="4864277">typeInfo</span><span class="op" id="4864285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864288">for</span>&nbsp;<span class="ident" id="4864292">k</span><span class="op" id="4864293">,</span>&nbsp;<span class="ident" id="4864295">v</span>&nbsp;<span class="op" id="4864297">:=</span>&nbsp;<span class="keyword" id="4864300">range</span>&nbsp;<span class="ident" id="4864306">m</span>&nbsp;<span class="op" id="4864308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864312">newm</span><span class="op" id="4864316">[</span><span class="ident" id="4864317">k</span><span class="op" id="4864318">]</span>&nbsp;<span class="op" id="4864320">=</span>&nbsp;<span class="ident" id="4864322">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4864325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864328">newm</span><span class="op" id="4864332">[</span><span class="ident" id="4864333">rt</span><span class="op" id="4864335">]</span>&nbsp;<span class="op" id="4864337">=</span>&nbsp;<span class="ident" id="4864339">info</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864345">typeInfoMap</span><span class="op" id="4864356">.</span><span class="ident" id="4864357">Store</span><span class="op" id="4864362">(</span><span class="ident" id="4864363">newm</span><span class="op" id="4864367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864370">return</span>&nbsp;<span class="ident" id="4864377">info</span><span class="op" id="4864381">,</span>&nbsp;<span class="ident" id="4864383">nil</span><br>
<span class="lineno"></span><span class="op" id="4864387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4864390">//&nbsp;Called&nbsp;only&nbsp;when&nbsp;a&nbsp;panic&nbsp;is&nbsp;acceptable&nbsp;and&nbsp;unexpected.</span><br>
<span class="lineno">775</span><span class="keyword" id="4864448">func</span>&nbsp;<span class="ident" id="4864453">mustGetTypeInfo</span><span class="op" id="4864468">(</span><span class="ident" id="4864469">rt</span>&nbsp;<span class="ident" id="4864472">reflect</span><span class="op" id="4864479">.</span><span class="ident" id="4864480">Type</span><span class="op" id="4864484">)</span>&nbsp;<span class="op" id="4864486">*</span><span class="ident" id="4864487">typeInfo</span>&nbsp;<span class="op" id="4864496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864499">t</span><span class="op" id="4864500">,</span>&nbsp;<span class="ident" id="4864502">err</span>&nbsp;<span class="op" id="4864506">:=</span>&nbsp;<span class="ident" id="4864509">getTypeInfo</span><span class="op" id="4864520">(</span><span class="ident" id="4864521">userType</span><span class="op" id="4864529">(</span><span class="ident" id="4864530">rt</span><span class="op" id="4864532">)</span><span class="op" id="4864533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864536">if</span>&nbsp;<span class="ident" id="4864539">err</span>&nbsp;<span class="op" id="4864543">!=</span>&nbsp;<span class="ident" id="4864546">nil</span>&nbsp;<span class="op" id="4864550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4864554">panic</span><span class="op" id="4864559">(</span><span class="string" id="4864560">&#34;getTypeInfo:&nbsp;&#34;</span>&nbsp;<span class="op" id="4864576">+</span>&nbsp;<span class="ident" id="4864578">err</span><span class="op" id="4864581">.</span><span class="ident" id="4864582">Error</span><span class="op" id="4864587">(</span><span class="op" id="4864588">)</span><span class="op" id="4864589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4864592">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864595">return</span>&nbsp;<span class="ident" id="4864602">t</span><br>
<span class="lineno"></span><span class="op" id="4864604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4864607">//&nbsp;GobEncoder&nbsp;is&nbsp;the&nbsp;interface&nbsp;describing&nbsp;data&nbsp;that&nbsp;provides&nbsp;its&nbsp;own</span><br>
<span class="lineno"></span><span class="comment" id="4864676">//&nbsp;representation&nbsp;for&nbsp;encoding&nbsp;values&nbsp;for&nbsp;transmission&nbsp;to&nbsp;a&nbsp;GobDecoder.</span><br>
<span class="lineno">785</span><span class="comment" id="4864748">//&nbsp;A&nbsp;type&nbsp;that&nbsp;implements&nbsp;GobEncoder&nbsp;and&nbsp;GobDecoder&nbsp;has&nbsp;complete</span><br>
<span class="lineno"></span><span class="comment" id="4864813">//&nbsp;control&nbsp;over&nbsp;the&nbsp;representation&nbsp;of&nbsp;its&nbsp;data&nbsp;and&nbsp;may&nbsp;therefore</span><br>
<span class="lineno"></span><span class="comment" id="4864878">//&nbsp;contain&nbsp;things&nbsp;such&nbsp;as&nbsp;private&nbsp;fields,&nbsp;channels,&nbsp;and&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="4864945">//&nbsp;which&nbsp;are&nbsp;not&nbsp;usually&nbsp;transmissible&nbsp;in&nbsp;gob&nbsp;streams.</span><br>
<span class="lineno"></span><span class="comment" id="4865000">//</span><br>
<span class="lineno">790</span><span class="comment" id="4865003">//&nbsp;Note:&nbsp;Since&nbsp;gobs&nbsp;can&nbsp;be&nbsp;stored&nbsp;permanently,&nbsp;It&nbsp;is&nbsp;good&nbsp;design</span><br>
<span class="lineno"></span><span class="comment" id="4865068">//&nbsp;to&nbsp;guarantee&nbsp;the&nbsp;encoding&nbsp;used&nbsp;by&nbsp;a&nbsp;GobEncoder&nbsp;is&nbsp;stable&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4865135">//&nbsp;software&nbsp;evolves.&nbsp;&nbsp;For&nbsp;instance,&nbsp;it&nbsp;might&nbsp;make&nbsp;sense&nbsp;for&nbsp;GobEncode</span><br>
<span class="lineno"></span><span class="comment" id="4865205">//&nbsp;to&nbsp;include&nbsp;a&nbsp;version&nbsp;number&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4865253">type</span>&nbsp;<span class="ident" id="4865258">GobEncoder</span>&nbsp;<span class="keyword" id="4865269">interface</span>&nbsp;<span class="op" id="4865279">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4865282">//&nbsp;GobEncode&nbsp;returns&nbsp;a&nbsp;byte&nbsp;slice&nbsp;representing&nbsp;the&nbsp;encoding&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4865350">//&nbsp;receiver&nbsp;for&nbsp;transmission&nbsp;to&nbsp;a&nbsp;GobDecoder,&nbsp;usually&nbsp;of&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4865417">//&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865436">GobEncode</span><span class="op" id="4865445">(</span><span class="op" id="4865446">)</span>&nbsp;<span class="op" id="4865448">(</span><span class="op" id="4865449">[</span><span class="op" id="4865450">]</span><span class="builtintype" id="4865451">byte</span><span class="op" id="4865455">,</span>&nbsp;<span class="builtintype" id="4865457">error</span><span class="op" id="4865462">)</span><br>
<span class="lineno"></span><span class="op" id="4865464">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="comment" id="4865467">//&nbsp;GobDecoder&nbsp;is&nbsp;the&nbsp;interface&nbsp;describing&nbsp;data&nbsp;that&nbsp;provides&nbsp;its&nbsp;own</span><br>
<span class="lineno"></span><span class="comment" id="4865536">//&nbsp;routine&nbsp;for&nbsp;decoding&nbsp;transmitted&nbsp;values&nbsp;sent&nbsp;by&nbsp;a&nbsp;GobEncoder.</span><br>
<span class="lineno"></span><span class="keyword" id="4865601">type</span>&nbsp;<span class="ident" id="4865606">GobDecoder</span>&nbsp;<span class="keyword" id="4865617">interface</span>&nbsp;<span class="op" id="4865627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4865630">//&nbsp;GobDecode&nbsp;overwrites&nbsp;the&nbsp;receiver,&nbsp;which&nbsp;must&nbsp;be&nbsp;a&nbsp;pointer,</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4865694">//&nbsp;with&nbsp;the&nbsp;value&nbsp;represented&nbsp;by&nbsp;the&nbsp;byte&nbsp;slice,&nbsp;which&nbsp;was&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4865762">//&nbsp;by&nbsp;GobEncode,&nbsp;usually&nbsp;for&nbsp;the&nbsp;same&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865816">GobDecode</span><span class="op" id="4865825">(</span><span class="op" id="4865826">[</span><span class="op" id="4865827">]</span><span class="builtintype" id="4865828">byte</span><span class="op" id="4865832">)</span>&nbsp;<span class="builtintype" id="4865834">error</span><br>
<span class="lineno"></span><span class="op" id="4865840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">810</span><span class="keyword" id="4865843">var</span>&nbsp;<span class="op" id="4865847">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865850">registerLock</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4865869">sync</span><span class="op" id="4865873">.</span><span class="ident" id="4865874">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865883">nameToConcreteType</span>&nbsp;<span class="op" id="4865902">=</span>&nbsp;<span class="builtinfunc" id="4865904">make</span><span class="op" id="4865908">(</span><span class="keyword" id="4865909">map</span><span class="op" id="4865912">[</span><span class="builtintype" id="4865913">string</span><span class="op" id="4865919">]</span><span class="ident" id="4865920">reflect</span><span class="op" id="4865927">.</span><span class="ident" id="4865928">Type</span><span class="op" id="4865932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865935">concreteTypeToName</span>&nbsp;<span class="op" id="4865954">=</span>&nbsp;<span class="builtinfunc" id="4865956">make</span><span class="op" id="4865960">(</span><span class="keyword" id="4865961">map</span><span class="op" id="4865964">[</span><span class="ident" id="4865965">reflect</span><span class="op" id="4865972">.</span><span class="ident" id="4865973">Type</span><span class="op" id="4865977">]</span><span class="builtintype" id="4865978">string</span><span class="op" id="4865984">)</span><br>
<span class="lineno"></span><span class="op" id="4865986">)</span><br>
<span class="lineno">815</span><br>
<span class="lineno"></span><span class="comment" id="4865989">//&nbsp;RegisterName&nbsp;is&nbsp;like&nbsp;Register&nbsp;but&nbsp;uses&nbsp;the&nbsp;provided&nbsp;name&nbsp;rather&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4866065">//&nbsp;type&#39;s&nbsp;default.</span><br>
<span class="lineno"></span><span class="keyword" id="4866084">func</span>&nbsp;<span class="ident" id="4866089">RegisterName</span><span class="op" id="4866101">(</span><span class="ident" id="4866102">name</span>&nbsp;<span class="builtintype" id="4866107">string</span><span class="op" id="4866113">,</span>&nbsp;<span class="ident" id="4866115">value</span>&nbsp;<span class="keyword" id="4866121">interface</span><span class="op" id="4866130">{</span><span class="op" id="4866131">}</span><span class="op" id="4866132">)</span>&nbsp;<span class="op" id="4866134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866137">if</span>&nbsp;<span class="ident" id="4866140">name</span>&nbsp;<span class="op" id="4866145">==</span>&nbsp;<span class="string" id="4866148">&#34;&#34;</span>&nbsp;<span class="op" id="4866151">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4866155">//&nbsp;reserved&nbsp;for&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4866177">panic</span><span class="op" id="4866182">(</span><span class="string" id="4866183">&#34;attempt&nbsp;to&nbsp;register&nbsp;empty&nbsp;name&#34;</span><span class="op" id="4866215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4866218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866221">registerLock</span><span class="op" id="4866233">.</span><span class="ident" id="4866234">Lock</span><span class="op" id="4866238">(</span><span class="op" id="4866239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866242">defer</span>&nbsp;<span class="ident" id="4866248">registerLock</span><span class="op" id="4866260">.</span><span class="ident" id="4866261">Unlock</span><span class="op" id="4866267">(</span><span class="op" id="4866268">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866271">ut</span>&nbsp;<span class="op" id="4866274">:=</span>&nbsp;<span class="ident" id="4866277">userType</span><span class="op" id="4866285">(</span><span class="ident" id="4866286">reflect</span><span class="op" id="4866293">.</span><span class="ident" id="4866294">TypeOf</span><span class="op" id="4866300">(</span><span class="ident" id="4866301">value</span><span class="op" id="4866306">)</span><span class="op" id="4866307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4866310">//&nbsp;Check&nbsp;for&nbsp;incompatible&nbsp;duplicates.&nbsp;The&nbsp;name&nbsp;must&nbsp;refer&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4866376">//&nbsp;same&nbsp;user&nbsp;type,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866412">if</span>&nbsp;<span class="ident" id="4866415">t</span><span class="op" id="4866416">,</span>&nbsp;<span class="ident" id="4866418">ok</span>&nbsp;<span class="op" id="4866421">:=</span>&nbsp;<span class="ident" id="4866424">nameToConcreteType</span><span class="op" id="4866442">[</span><span class="ident" id="4866443">name</span><span class="op" id="4866447">]</span><span class="op" id="4866448">;</span>&nbsp;<span class="ident" id="4866450">ok</span>&nbsp;<span class="op" id="4866453">&amp;&amp;</span>&nbsp;<span class="ident" id="4866456">t</span>&nbsp;<span class="op" id="4866458">!=</span>&nbsp;<span class="ident" id="4866461">ut</span><span class="op" id="4866463">.</span><span class="ident" id="4866464">user</span>&nbsp;<span class="op" id="4866469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4866473">panic</span><span class="op" id="4866478">(</span><span class="ident" id="4866479">fmt</span><span class="op" id="4866482">.</span><span class="ident" id="4866483">Sprintf</span><span class="op" id="4866490">(</span><span class="string" id="4866491">&#34;gob:&nbsp;registering&nbsp;duplicate&nbsp;types&nbsp;for&nbsp;%q:&nbsp;%s&nbsp;!=&nbsp;%s&#34;</span><span class="op" id="4866542">,</span>&nbsp;<span class="ident" id="4866544">name</span><span class="op" id="4866548">,</span>&nbsp;<span class="ident" id="4866550">t</span><span class="op" id="4866551">,</span>&nbsp;<span class="ident" id="4866553">ut</span><span class="op" id="4866555">.</span><span class="ident" id="4866556">user</span><span class="op" id="4866560">)</span><span class="op" id="4866561">)</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4866564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4866567">if</span>&nbsp;<span class="ident" id="4866570">n</span><span class="op" id="4866571">,</span>&nbsp;<span class="ident" id="4866573">ok</span>&nbsp;<span class="op" id="4866576">:=</span>&nbsp;<span class="ident" id="4866579">concreteTypeToName</span><span class="op" id="4866597">[</span><span class="ident" id="4866598">ut</span><span class="op" id="4866600">.</span><span class="ident" id="4866601">base</span><span class="op" id="4866605">]</span><span class="op" id="4866606">;</span>&nbsp;<span class="ident" id="4866608">ok</span>&nbsp;<span class="op" id="4866611">&amp;&amp;</span>&nbsp;<span class="ident" id="4866614">n</span>&nbsp;<span class="op" id="4866616">!=</span>&nbsp;<span class="ident" id="4866619">name</span>&nbsp;<span class="op" id="4866624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4866628">panic</span><span class="op" id="4866633">(</span><span class="ident" id="4866634">fmt</span><span class="op" id="4866637">.</span><span class="ident" id="4866638">Sprintf</span><span class="op" id="4866645">(</span><span class="string" id="4866646">&#34;gob:&nbsp;registering&nbsp;duplicate&nbsp;names&nbsp;for&nbsp;%s:&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="4866697">,</span>&nbsp;<span class="ident" id="4866699">ut</span><span class="op" id="4866701">.</span><span class="ident" id="4866702">user</span><span class="op" id="4866706">,</span>&nbsp;<span class="ident" id="4866708">n</span><span class="op" id="4866709">,</span>&nbsp;<span class="ident" id="4866711">name</span><span class="op" id="4866715">)</span><span class="op" id="4866716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4866719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4866722">//&nbsp;Store&nbsp;the&nbsp;name&nbsp;and&nbsp;type&nbsp;provided&nbsp;by&nbsp;the&nbsp;user....</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866775">nameToConcreteType</span><span class="op" id="4866793">[</span><span class="ident" id="4866794">name</span><span class="op" id="4866798">]</span>&nbsp;<span class="op" id="4866800">=</span>&nbsp;<span class="ident" id="4866802">reflect</span><span class="op" id="4866809">.</span><span class="ident" id="4866810">TypeOf</span><span class="op" id="4866816">(</span><span class="ident" id="4866817">value</span><span class="op" id="4866822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4866825">//&nbsp;but&nbsp;the&nbsp;flattened&nbsp;type&nbsp;in&nbsp;the&nbsp;type&nbsp;table,&nbsp;since&nbsp;that&#39;s&nbsp;what&nbsp;decode&nbsp;needs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4866903">concreteTypeToName</span><span class="op" id="4866921">[</span><span class="ident" id="4866922">ut</span><span class="op" id="4866924">.</span><span class="ident" id="4866925">base</span><span class="op" id="4866929">]</span>&nbsp;<span class="op" id="4866931">=</span>&nbsp;<span class="ident" id="4866933">name</span><br>
<span class="lineno"></span><span class="op" id="4866938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">840</span><span class="comment" id="4866941">//&nbsp;Register&nbsp;records&nbsp;a&nbsp;type,&nbsp;identified&nbsp;by&nbsp;a&nbsp;value&nbsp;for&nbsp;that&nbsp;type,&nbsp;under&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="4867016">//&nbsp;internal&nbsp;type&nbsp;name.&nbsp;&nbsp;That&nbsp;name&nbsp;will&nbsp;identify&nbsp;the&nbsp;concrete&nbsp;type&nbsp;of&nbsp;a&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="4867093">//&nbsp;sent&nbsp;or&nbsp;received&nbsp;as&nbsp;an&nbsp;interface&nbsp;variable.&nbsp;&nbsp;Only&nbsp;types&nbsp;that&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4867164">//&nbsp;transferred&nbsp;as&nbsp;implementations&nbsp;of&nbsp;interface&nbsp;values&nbsp;need&nbsp;to&nbsp;be&nbsp;registered.</span><br>
<span class="lineno"></span><span class="comment" id="4867241">//&nbsp;Expecting&nbsp;to&nbsp;be&nbsp;used&nbsp;only&nbsp;during&nbsp;initialization,&nbsp;it&nbsp;panics&nbsp;if&nbsp;the&nbsp;mapping</span><br>
<span class="lineno">845</span><span class="comment" id="4867318">//&nbsp;between&nbsp;types&nbsp;and&nbsp;names&nbsp;is&nbsp;not&nbsp;a&nbsp;bijection.</span><br>
<span class="lineno"></span><span class="keyword" id="4867365">func</span>&nbsp;<span class="ident" id="4867370">Register</span><span class="op" id="4867378">(</span><span class="ident" id="4867379">value</span>&nbsp;<span class="keyword" id="4867385">interface</span><span class="op" id="4867394">{</span><span class="op" id="4867395">}</span><span class="op" id="4867396">)</span>&nbsp;<span class="op" id="4867398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4867401">//&nbsp;Default&nbsp;to&nbsp;printed&nbsp;representation&nbsp;for&nbsp;unnamed&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867457">rt</span>&nbsp;<span class="op" id="4867460">:=</span>&nbsp;<span class="ident" id="4867463">reflect</span><span class="op" id="4867470">.</span><span class="ident" id="4867471">TypeOf</span><span class="op" id="4867477">(</span><span class="ident" id="4867478">value</span><span class="op" id="4867483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867486">name</span>&nbsp;<span class="op" id="4867491">:=</span>&nbsp;<span class="ident" id="4867494">rt</span><span class="op" id="4867496">.</span><span class="ident" id="4867497">String</span><span class="op" id="4867503">(</span><span class="op" id="4867504">)</span><br>
<span class="lineno">850</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4867508">//&nbsp;But&nbsp;for&nbsp;named&nbsp;types&nbsp;(or&nbsp;pointers&nbsp;to&nbsp;them),&nbsp;qualify&nbsp;with&nbsp;import&nbsp;path&nbsp;(but&nbsp;see&nbsp;inner&nbsp;comment).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4867605">//&nbsp;Dereference&nbsp;one&nbsp;pointer&nbsp;looking&nbsp;for&nbsp;a&nbsp;named&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867659">star</span>&nbsp;<span class="op" id="4867664">:=</span>&nbsp;<span class="string" id="4867667">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4867671">if</span>&nbsp;<span class="ident" id="4867674">rt</span><span class="op" id="4867676">.</span><span class="ident" id="4867677">Name</span><span class="op" id="4867681">(</span><span class="op" id="4867682">)</span>&nbsp;<span class="op" id="4867684">==</span>&nbsp;<span class="string" id="4867687">&#34;&#34;</span>&nbsp;<span class="op" id="4867690">{</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4867694">if</span>&nbsp;<span class="ident" id="4867697">pt</span>&nbsp;<span class="op" id="4867700">:=</span>&nbsp;<span class="ident" id="4867703">rt</span><span class="op" id="4867705">;</span>&nbsp;<span class="ident" id="4867707">pt</span><span class="op" id="4867709">.</span><span class="ident" id="4867710">Kind</span><span class="op" id="4867714">(</span><span class="op" id="4867715">)</span>&nbsp;<span class="op" id="4867717">==</span>&nbsp;<span class="ident" id="4867720">reflect</span><span class="op" id="4867727">.</span><span class="ident" id="4867728">Ptr</span>&nbsp;<span class="op" id="4867732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4867737">star</span>&nbsp;<span class="op" id="4867742">=</span>&nbsp;<span class="string" id="4867744">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4867751">//&nbsp;NOTE:&nbsp;The&nbsp;following&nbsp;line&nbsp;should&nbsp;be&nbsp;rt&nbsp;=&nbsp;pt.Elem()&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4867820">//&nbsp;what&nbsp;the&nbsp;comment&nbsp;above&nbsp;claims,&nbsp;but&nbsp;fixing&nbsp;it&nbsp;would&nbsp;break&nbsp;compatibility</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4867897">//&nbsp;with&nbsp;existing&nbsp;gobs.</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4867923">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4867929">//&nbsp;Given&nbsp;package&nbsp;p&nbsp;imported&nbsp;as&nbsp;&#34;full/p&#34;&nbsp;with&nbsp;these&nbsp;definitions:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4867996">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4868016">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;T1&nbsp;struct&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4868049">//&nbsp;this&nbsp;table&nbsp;shows&nbsp;the&nbsp;intended&nbsp;and&nbsp;actual&nbsp;strings&nbsp;used&nbsp;by&nbsp;gob&nbsp;to</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4868119">//&nbsp;name&nbsp;the&nbsp;types:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4868141">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4868147">//&nbsp;Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Correct&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Actual&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4868196">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4868202">//&nbsp;T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;full/p.T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;full/p.T1</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4868247">//&nbsp;*T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*full/p.T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*p.T1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4868288">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4868294">//&nbsp;The&nbsp;missing&nbsp;full&nbsp;path&nbsp;cannot&nbsp;be&nbsp;fixed&nbsp;without&nbsp;breaking&nbsp;existing&nbsp;gob&nbsp;decoders.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868378">rt</span>&nbsp;<span class="op" id="4868381">=</span>&nbsp;<span class="ident" id="4868383">pt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4868388">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4868391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4868394">if</span>&nbsp;<span class="ident" id="4868397">rt</span><span class="op" id="4868399">.</span><span class="ident" id="4868400">Name</span><span class="op" id="4868404">(</span><span class="op" id="4868405">)</span>&nbsp;<span class="op" id="4868407">!=</span>&nbsp;<span class="string" id="4868410">&#34;&#34;</span>&nbsp;<span class="op" id="4868413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4868417">if</span>&nbsp;<span class="ident" id="4868420">rt</span><span class="op" id="4868422">.</span><span class="ident" id="4868423">PkgPath</span><span class="op" id="4868430">(</span><span class="op" id="4868431">)</span>&nbsp;<span class="op" id="4868433">==</span>&nbsp;<span class="string" id="4868436">&#34;&#34;</span>&nbsp;<span class="op" id="4868439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868444">name</span>&nbsp;<span class="op" id="4868449">=</span>&nbsp;<span class="ident" id="4868451">star</span>&nbsp;<span class="op" id="4868456">+</span>&nbsp;<span class="ident" id="4868458">rt</span><span class="op" id="4868460">.</span><span class="ident" id="4868461">Name</span><span class="op" id="4868465">(</span><span class="op" id="4868466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4868470">}</span>&nbsp;<span class="keyword" id="4868472">else</span>&nbsp;<span class="op" id="4868477">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868482">name</span>&nbsp;<span class="op" id="4868487">=</span>&nbsp;<span class="ident" id="4868489">star</span>&nbsp;<span class="op" id="4868494">+</span>&nbsp;<span class="ident" id="4868496">rt</span><span class="op" id="4868498">.</span><span class="ident" id="4868499">PkgPath</span><span class="op" id="4868506">(</span><span class="op" id="4868507">)</span>&nbsp;<span class="op" id="4868509">+</span>&nbsp;<span class="string" id="4868511">&#34;.&#34;</span>&nbsp;<span class="op" id="4868515">+</span>&nbsp;<span class="ident" id="4868517">rt</span><span class="op" id="4868519">.</span><span class="ident" id="4868520">Name</span><span class="op" id="4868524">(</span><span class="op" id="4868525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4868529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4868532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868536">RegisterName</span><span class="op" id="4868548">(</span><span class="ident" id="4868549">name</span><span class="op" id="4868553">,</span>&nbsp;<span class="ident" id="4868555">value</span><span class="op" id="4868560">)</span><br>
<span class="lineno">885</span><span class="op" id="4868562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4868565">func</span>&nbsp;<span class="ident" id="4868570">registerBasics</span><span class="op" id="4868584">(</span><span class="op" id="4868585">)</span>&nbsp;<span class="op" id="4868587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868590">Register</span><span class="op" id="4868598">(</span><span class="builtintype" id="4868599">int</span><span class="op" id="4868602">(</span><span class="num" id="4868603">0</span><span class="op" id="4868604">)</span><span class="op" id="4868605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868608">Register</span><span class="op" id="4868616">(</span><span class="builtintype" id="4868617">int8</span><span class="op" id="4868621">(</span><span class="num" id="4868622">0</span><span class="op" id="4868623">)</span><span class="op" id="4868624">)</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868627">Register</span><span class="op" id="4868635">(</span><span class="builtintype" id="4868636">int16</span><span class="op" id="4868641">(</span><span class="num" id="4868642">0</span><span class="op" id="4868643">)</span><span class="op" id="4868644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868647">Register</span><span class="op" id="4868655">(</span><span class="builtintype" id="4868656">int32</span><span class="op" id="4868661">(</span><span class="num" id="4868662">0</span><span class="op" id="4868663">)</span><span class="op" id="4868664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868667">Register</span><span class="op" id="4868675">(</span><span class="ident" id="4868676">int64</span><span class="op" id="4868681">(</span><span class="num" id="4868682">0</span><span class="op" id="4868683">)</span><span class="op" id="4868684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868687">Register</span><span class="op" id="4868695">(</span><span class="builtintype" id="4868696">uint</span><span class="op" id="4868700">(</span><span class="num" id="4868701">0</span><span class="op" id="4868702">)</span><span class="op" id="4868703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868706">Register</span><span class="op" id="4868714">(</span><span class="builtintype" id="4868715">uint8</span><span class="op" id="4868720">(</span><span class="num" id="4868721">0</span><span class="op" id="4868722">)</span><span class="op" id="4868723">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868726">Register</span><span class="op" id="4868734">(</span><span class="builtintype" id="4868735">uint16</span><span class="op" id="4868741">(</span><span class="num" id="4868742">0</span><span class="op" id="4868743">)</span><span class="op" id="4868744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868747">Register</span><span class="op" id="4868755">(</span><span class="builtintype" id="4868756">uint32</span><span class="op" id="4868762">(</span><span class="num" id="4868763">0</span><span class="op" id="4868764">)</span><span class="op" id="4868765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868768">Register</span><span class="op" id="4868776">(</span><span class="ident" id="4868777">uint64</span><span class="op" id="4868783">(</span><span class="num" id="4868784">0</span><span class="op" id="4868785">)</span><span class="op" id="4868786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868789">Register</span><span class="op" id="4868797">(</span><span class="builtintype" id="4868798">float32</span><span class="op" id="4868805">(</span><span class="num" id="4868806">0</span><span class="op" id="4868807">)</span><span class="op" id="4868808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868811">Register</span><span class="op" id="4868819">(</span><span class="builtintype" id="4868820">float64</span><span class="op" id="4868827">(</span><span class="num" id="4868828">0</span><span class="op" id="4868829">)</span><span class="op" id="4868830">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868833">Register</span><span class="op" id="4868841">(</span><span class="builtintype" id="4868842">complex64</span><span class="op" id="4868851">(</span><span class="num" id="4868852">0i</span><span class="op" id="4868854">)</span><span class="op" id="4868855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868858">Register</span><span class="op" id="4868866">(</span><span class="builtintype" id="4868867">complex128</span><span class="op" id="4868877">(</span><span class="num" id="4868878">0i</span><span class="op" id="4868880">)</span><span class="op" id="4868881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868884">Register</span><span class="op" id="4868892">(</span><span class="builtintype" id="4868893">uintptr</span><span class="op" id="4868900">(</span><span class="num" id="4868901">0</span><span class="op" id="4868902">)</span><span class="op" id="4868903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868906">Register</span><span class="op" id="4868914">(</span><span class="builtintype" id="4868915">false</span><span class="op" id="4868920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868923">Register</span><span class="op" id="4868931">(</span><span class="string" id="4868932">&#34;&#34;</span><span class="op" id="4868934">)</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868937">Register</span><span class="op" id="4868945">(</span><span class="op" id="4868946">[</span><span class="op" id="4868947">]</span><span class="builtintype" id="4868948">byte</span><span class="op" id="4868952">(</span><span class="ident" id="4868953">nil</span><span class="op" id="4868956">)</span><span class="op" id="4868957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868960">Register</span><span class="op" id="4868968">(</span><span class="op" id="4868969">[</span><span class="op" id="4868970">]</span><span class="builtintype" id="4868971">int</span><span class="op" id="4868974">(</span><span class="ident" id="4868975">nil</span><span class="op" id="4868978">)</span><span class="op" id="4868979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4868982">Register</span><span class="op" id="4868990">(</span><span class="op" id="4868991">[</span><span class="op" id="4868992">]</span><span class="builtintype" id="4868993">int8</span><span class="op" id="4868997">(</span><span class="ident" id="4868998">nil</span><span class="op" id="4869001">)</span><span class="op" id="4869002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869005">Register</span><span class="op" id="4869013">(</span><span class="op" id="4869014">[</span><span class="op" id="4869015">]</span><span class="builtintype" id="4869016">int16</span><span class="op" id="4869021">(</span><span class="ident" id="4869022">nil</span><span class="op" id="4869025">)</span><span class="op" id="4869026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869029">Register</span><span class="op" id="4869037">(</span><span class="op" id="4869038">[</span><span class="op" id="4869039">]</span><span class="builtintype" id="4869040">int32</span><span class="op" id="4869045">(</span><span class="ident" id="4869046">nil</span><span class="op" id="4869049">)</span><span class="op" id="4869050">)</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869053">Register</span><span class="op" id="4869061">(</span><span class="op" id="4869062">[</span><span class="op" id="4869063">]</span><span class="ident" id="4869064">int64</span><span class="op" id="4869069">(</span><span class="ident" id="4869070">nil</span><span class="op" id="4869073">)</span><span class="op" id="4869074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869077">Register</span><span class="op" id="4869085">(</span><span class="op" id="4869086">[</span><span class="op" id="4869087">]</span><span class="builtintype" id="4869088">uint</span><span class="op" id="4869092">(</span><span class="ident" id="4869093">nil</span><span class="op" id="4869096">)</span><span class="op" id="4869097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869100">Register</span><span class="op" id="4869108">(</span><span class="op" id="4869109">[</span><span class="op" id="4869110">]</span><span class="builtintype" id="4869111">uint8</span><span class="op" id="4869116">(</span><span class="ident" id="4869117">nil</span><span class="op" id="4869120">)</span><span class="op" id="4869121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869124">Register</span><span class="op" id="4869132">(</span><span class="op" id="4869133">[</span><span class="op" id="4869134">]</span><span class="builtintype" id="4869135">uint16</span><span class="op" id="4869141">(</span><span class="ident" id="4869142">nil</span><span class="op" id="4869145">)</span><span class="op" id="4869146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869149">Register</span><span class="op" id="4869157">(</span><span class="op" id="4869158">[</span><span class="op" id="4869159">]</span><span class="builtintype" id="4869160">uint32</span><span class="op" id="4869166">(</span><span class="ident" id="4869167">nil</span><span class="op" id="4869170">)</span><span class="op" id="4869171">)</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869174">Register</span><span class="op" id="4869182">(</span><span class="op" id="4869183">[</span><span class="op" id="4869184">]</span><span class="ident" id="4869185">uint64</span><span class="op" id="4869191">(</span><span class="ident" id="4869192">nil</span><span class="op" id="4869195">)</span><span class="op" id="4869196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869199">Register</span><span class="op" id="4869207">(</span><span class="op" id="4869208">[</span><span class="op" id="4869209">]</span><span class="builtintype" id="4869210">float32</span><span class="op" id="4869217">(</span><span class="ident" id="4869218">nil</span><span class="op" id="4869221">)</span><span class="op" id="4869222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869225">Register</span><span class="op" id="4869233">(</span><span class="op" id="4869234">[</span><span class="op" id="4869235">]</span><span class="builtintype" id="4869236">float64</span><span class="op" id="4869243">(</span><span class="ident" id="4869244">nil</span><span class="op" id="4869247">)</span><span class="op" id="4869248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869251">Register</span><span class="op" id="4869259">(</span><span class="op" id="4869260">[</span><span class="op" id="4869261">]</span><span class="builtintype" id="4869262">complex64</span><span class="op" id="4869271">(</span><span class="ident" id="4869272">nil</span><span class="op" id="4869275">)</span><span class="op" id="4869276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869279">Register</span><span class="op" id="4869287">(</span><span class="op" id="4869288">[</span><span class="op" id="4869289">]</span><span class="builtintype" id="4869290">complex128</span><span class="op" id="4869300">(</span><span class="ident" id="4869301">nil</span><span class="op" id="4869304">)</span><span class="op" id="4869305">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869308">Register</span><span class="op" id="4869316">(</span><span class="op" id="4869317">[</span><span class="op" id="4869318">]</span><span class="builtintype" id="4869319">uintptr</span><span class="op" id="4869326">(</span><span class="ident" id="4869327">nil</span><span class="op" id="4869330">)</span><span class="op" id="4869331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869334">Register</span><span class="op" id="4869342">(</span><span class="op" id="4869343">[</span><span class="op" id="4869344">]</span><span class="builtintype" id="4869345">bool</span><span class="op" id="4869349">(</span><span class="ident" id="4869350">nil</span><span class="op" id="4869353">)</span><span class="op" id="4869354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4869357">Register</span><span class="op" id="4869365">(</span><span class="op" id="4869366">[</span><span class="op" id="4869367">]</span><span class="builtintype" id="4869368">string</span><span class="op" id="4869374">(</span><span class="ident" id="4869375">nil</span><span class="op" id="4869378">)</span><span class="op" id="4869379">)</span><br>
<span class="lineno"></span><span class="op" id="4869381">}</span>
</div>
</body>
</html>
