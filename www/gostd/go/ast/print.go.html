<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/ast</h2>
<ul>
<li><a href="/gostd/go/ast/ast.go.html">ast.go</a></li>
<li><a href="/gostd/go/ast/ast_test.go.html">ast_test.go</a></li>
<li><a href="/gostd/go/ast/commentmap.go.html">commentmap.go</a></li>
<li><a href="/gostd/go/ast/commentmap_test.go.html">commentmap_test.go</a></li>
<li><a href="/gostd/go/ast/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/ast/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/ast/filter_test.go.html">filter_test.go</a></li>
<li><a href="/gostd/go/ast/import.go.html">import.go</a></li>
<li><a href="/gostd/go/ast/print.go.html">print.go</a></li>
<li><a href="/gostd/go/ast/print_test.go.html">print_test.go</a></li>
<li><a href="/gostd/go/ast/resolve.go.html">resolve.go</a></li>
<li><a href="/gostd/go/ast/scope.go.html">scope.go</a></li>
<li><a href="/gostd/go/ast/walk.go.html">walk.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4284240">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4284295">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4284349">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4284400">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;printing&nbsp;support&nbsp;for&nbsp;ASTs.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4284450">package</span>&nbsp;<span class="ident" id="4284458">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4284463">import</span>&nbsp;<span class="op" id="4284470">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4284473">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4284480">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4284492">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4284498">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4284504">&#34;reflect&#34;</span><br>
<span class="lineno">15</span><span class="op" id="4284514">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4284517">//&nbsp;A&nbsp;FieldFilter&nbsp;may&nbsp;be&nbsp;provided&nbsp;to&nbsp;Fprint&nbsp;to&nbsp;control&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="4284583">type</span>&nbsp;<span class="ident" id="4284588">FieldFilter</span>&nbsp;<span class="keyword" id="4284600">func</span><span class="op" id="4284604">(</span><span class="ident" id="4284605">name</span>&nbsp;<span class="builtintype" id="4284610">string</span><span class="op" id="4284616">,</span>&nbsp;<span class="ident" id="4284618">value</span>&nbsp;<span class="ident" id="4284624">reflect</span><span class="op" id="4284631">.</span><span class="ident" id="4284632">Value</span><span class="op" id="4284637">)</span>&nbsp;<span class="builtintype" id="4284639">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4284645">//&nbsp;NotNilFilter&nbsp;returns&nbsp;true&nbsp;for&nbsp;field&nbsp;values&nbsp;that&nbsp;are&nbsp;not&nbsp;nil;</span><br>
<span class="lineno"></span><span class="comment" id="4284709">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="4284740">func</span>&nbsp;<span class="ident" id="4284745">NotNilFilter</span><span class="op" id="4284757">(</span><span class="ident" id="4284758">_</span>&nbsp;<span class="builtintype" id="4284760">string</span><span class="op" id="4284766">,</span>&nbsp;<span class="ident" id="4284768">v</span>&nbsp;<span class="ident" id="4284770">reflect</span><span class="op" id="4284777">.</span><span class="ident" id="4284778">Value</span><span class="op" id="4284783">)</span>&nbsp;<span class="builtintype" id="4284785">bool</span>&nbsp;<span class="op" id="4284790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4284793">switch</span>&nbsp;<span class="ident" id="4284800">v</span><span class="op" id="4284801">.</span><span class="ident" id="4284802">Kind</span><span class="op" id="4284806">(</span><span class="op" id="4284807">)</span>&nbsp;<span class="op" id="4284809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4284812">case</span>&nbsp;<span class="ident" id="4284817">reflect</span><span class="op" id="4284824">.</span><span class="ident" id="4284825">Chan</span><span class="op" id="4284829">,</span>&nbsp;<span class="ident" id="4284831">reflect</span><span class="op" id="4284838">.</span><span class="ident" id="4284839">Func</span><span class="op" id="4284843">,</span>&nbsp;<span class="ident" id="4284845">reflect</span><span class="op" id="4284852">.</span><span class="ident" id="4284853">Interface</span><span class="op" id="4284862">,</span>&nbsp;<span class="ident" id="4284864">reflect</span><span class="op" id="4284871">.</span><span class="ident" id="4284872">Map</span><span class="op" id="4284875">,</span>&nbsp;<span class="ident" id="4284877">reflect</span><span class="op" id="4284884">.</span><span class="ident" id="4284885">Ptr</span><span class="op" id="4284888">,</span>&nbsp;<span class="ident" id="4284890">reflect</span><span class="op" id="4284897">.</span><span class="ident" id="4284898">Slice</span><span class="op" id="4284903">:</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4284907">return</span>&nbsp;<span class="op" id="4284914">!</span><span class="ident" id="4284915">v</span><span class="op" id="4284916">.</span><span class="ident" id="4284917">IsNil</span><span class="op" id="4284922">(</span><span class="op" id="4284923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4284926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4284929">return</span>&nbsp;<span class="builtintype" id="4284936">true</span><br>
<span class="lineno"></span><span class="op" id="4284941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="4284944">//&nbsp;Fprint&nbsp;prints&nbsp;the&nbsp;(sub-)tree&nbsp;starting&nbsp;at&nbsp;AST&nbsp;node&nbsp;x&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="4285005">//&nbsp;If&nbsp;fset&nbsp;!=&nbsp;nil,&nbsp;position&nbsp;information&nbsp;is&nbsp;interpreted&nbsp;relative</span><br>
<span class="lineno"></span><span class="comment" id="4285069">//&nbsp;to&nbsp;that&nbsp;file&nbsp;set.&nbsp;Otherwise&nbsp;positions&nbsp;are&nbsp;printed&nbsp;as&nbsp;integer</span><br>
<span class="lineno"></span><span class="comment" id="4285133">//&nbsp;values&nbsp;(file&nbsp;set&nbsp;specific&nbsp;offsets).</span><br>
<span class="lineno"></span><span class="comment" id="4285172">//</span><br>
<span class="lineno">35</span><span class="comment" id="4285175">//&nbsp;A&nbsp;non-nil&nbsp;FieldFilter&nbsp;f&nbsp;may&nbsp;be&nbsp;provided&nbsp;to&nbsp;control&nbsp;the&nbsp;output:</span><br>
<span class="lineno"></span><span class="comment" id="4285241">//&nbsp;struct&nbsp;fields&nbsp;for&nbsp;which&nbsp;f(fieldname,&nbsp;fieldvalue)&nbsp;is&nbsp;true&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4285305">//&nbsp;printed;&nbsp;all&nbsp;others&nbsp;are&nbsp;filtered&nbsp;from&nbsp;the&nbsp;output.&nbsp;Unexported</span><br>
<span class="lineno"></span><span class="comment" id="4285369">//&nbsp;struct&nbsp;fields&nbsp;are&nbsp;never&nbsp;printed.</span><br>
<span class="lineno"></span><span class="comment" id="4285405">//</span><br>
<span class="lineno">40</span><span class="keyword" id="4285408">func</span>&nbsp;<span class="ident" id="4285413">Fprint</span><span class="op" id="4285419">(</span><span class="ident" id="4285420">w</span>&nbsp;<span class="ident" id="4285422">io</span><span class="op" id="4285424">.</span><span class="ident" id="4285425">Writer</span><span class="op" id="4285431">,</span>&nbsp;<span class="ident" id="4285433">fset</span>&nbsp;<span class="op" id="4285438">*</span><span class="ident" id="4285439">token</span><span class="op" id="4285444">.</span><span class="ident" id="4285445">FileSet</span><span class="op" id="4285452">,</span>&nbsp;<span class="ident" id="4285454">x</span>&nbsp;<span class="keyword" id="4285456">interface</span><span class="op" id="4285465">{</span><span class="op" id="4285466">}</span><span class="op" id="4285467">,</span>&nbsp;<span class="ident" id="4285469">f</span>&nbsp;<span class="ident" id="4285471">FieldFilter</span><span class="op" id="4285482">)</span>&nbsp;<span class="op" id="4285484">(</span><span class="ident" id="4285485">err</span>&nbsp;<span class="builtintype" id="4285489">error</span><span class="op" id="4285494">)</span>&nbsp;<span class="op" id="4285496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4285499">//&nbsp;setup&nbsp;printer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285517">p</span>&nbsp;<span class="op" id="4285519">:=</span>&nbsp;<span class="ident" id="4285522">printer</span><span class="op" id="4285529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285533">output</span><span class="op" id="4285539">:</span>&nbsp;<span class="ident" id="4285541">w</span><span class="op" id="4285542">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285546">fset</span><span class="op" id="4285550">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4285554">fset</span><span class="op" id="4285558">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285562">filter</span><span class="op" id="4285568">:</span>&nbsp;<span class="ident" id="4285570">f</span><span class="op" id="4285571">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285575">ptrmap</span><span class="op" id="4285581">:</span>&nbsp;<span class="builtinfunc" id="4285583">make</span><span class="op" id="4285587">(</span><span class="keyword" id="4285588">map</span><span class="op" id="4285591">[</span><span class="keyword" id="4285592">interface</span><span class="op" id="4285601">{</span><span class="op" id="4285602">}</span><span class="op" id="4285603">]</span><span class="builtintype" id="4285604">int</span><span class="op" id="4285607">)</span><span class="op" id="4285608">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285612">last</span><span class="op" id="4285616">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="4285620">&#39;\n&#39;</span><span class="op" id="4285624">,</span>&nbsp;<span class="comment" id="4285626">//&nbsp;force&nbsp;printing&nbsp;of&nbsp;line&nbsp;number&nbsp;on&nbsp;first&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4285674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4285678">//&nbsp;install&nbsp;error&nbsp;handler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4285704">defer</span>&nbsp;<span class="keyword" id="4285710">func</span><span class="op" id="4285714">(</span><span class="op" id="4285715">)</span>&nbsp;<span class="op" id="4285717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4285721">if</span>&nbsp;<span class="ident" id="4285724">e</span>&nbsp;<span class="op" id="4285726">:=</span>&nbsp;<span class="builtinfunc" id="4285729">recover</span><span class="op" id="4285736">(</span><span class="op" id="4285737">)</span><span class="op" id="4285738">;</span>&nbsp;<span class="ident" id="4285740">e</span>&nbsp;<span class="op" id="4285742">!=</span>&nbsp;<span class="ident" id="4285745">nil</span>&nbsp;<span class="op" id="4285749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285754">err</span>&nbsp;<span class="op" id="4285758">=</span>&nbsp;<span class="ident" id="4285760">e</span><span class="op" id="4285761">.</span><span class="op" id="4285762">(</span><span class="ident" id="4285763">localError</span><span class="op" id="4285773">)</span><span class="op" id="4285774">.</span><span class="ident" id="4285775">err</span>&nbsp;<span class="comment" id="4285779">//&nbsp;re-panics&nbsp;if&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;localError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4285819">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4285822">}</span><span class="op" id="4285823">(</span><span class="op" id="4285824">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4285828">//&nbsp;print&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4285840">if</span>&nbsp;<span class="ident" id="4285843">x</span>&nbsp;<span class="op" id="4285845">==</span>&nbsp;<span class="ident" id="4285848">nil</span>&nbsp;<span class="op" id="4285852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285856">p</span><span class="op" id="4285857">.</span><span class="ident" id="4285858">printf</span><span class="op" id="4285864">(</span><span class="string" id="4285865">&#34;nil\n&#34;</span><span class="op" id="4285872">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4285876">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4285884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285887">p</span><span class="op" id="4285888">.</span><span class="builtinfunc" id="4285889">print</span><span class="op" id="4285894">(</span><span class="ident" id="4285895">reflect</span><span class="op" id="4285902">.</span><span class="ident" id="4285903">ValueOf</span><span class="op" id="4285910">(</span><span class="ident" id="4285911">x</span><span class="op" id="4285912">)</span><span class="op" id="4285913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285916">p</span><span class="op" id="4285917">.</span><span class="ident" id="4285918">printf</span><span class="op" id="4285924">(</span><span class="string" id="4285925">&#34;\n&#34;</span><span class="op" id="4285929">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4285933">return</span><br>
<span class="lineno"></span><span class="op" id="4285940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4285943">//&nbsp;Print&nbsp;prints&nbsp;x&nbsp;to&nbsp;standard&nbsp;output,&nbsp;skipping&nbsp;nil&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="4286002">//&nbsp;Print(fset,&nbsp;x)&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;Fprint(os.Stdout,&nbsp;fset,&nbsp;x,&nbsp;NotNilFilter).</span><br>
<span class="lineno">70</span><span class="keyword" id="4286077">func</span>&nbsp;<span class="ident" id="4286082">Print</span><span class="op" id="4286087">(</span><span class="ident" id="4286088">fset</span>&nbsp;<span class="op" id="4286093">*</span><span class="ident" id="4286094">token</span><span class="op" id="4286099">.</span><span class="ident" id="4286100">FileSet</span><span class="op" id="4286107">,</span>&nbsp;<span class="ident" id="4286109">x</span>&nbsp;<span class="keyword" id="4286111">interface</span><span class="op" id="4286120">{</span><span class="op" id="4286121">}</span><span class="op" id="4286122">)</span>&nbsp;<span class="builtintype" id="4286124">error</span>&nbsp;<span class="op" id="4286130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286133">return</span>&nbsp;<span class="ident" id="4286140">Fprint</span><span class="op" id="4286146">(</span><span class="ident" id="4286147">os</span><span class="op" id="4286149">.</span><span class="ident" id="4286150">Stdout</span><span class="op" id="4286156">,</span>&nbsp;<span class="ident" id="4286158">fset</span><span class="op" id="4286162">,</span>&nbsp;<span class="ident" id="4286164">x</span><span class="op" id="4286165">,</span>&nbsp;<span class="ident" id="4286167">NotNilFilter</span><span class="op" id="4286179">)</span><br>
<span class="lineno"></span><span class="op" id="4286181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4286184">type</span>&nbsp;<span class="ident" id="4286189">printer</span>&nbsp;<span class="keyword" id="4286197">struct</span>&nbsp;<span class="op" id="4286204">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286207">output</span>&nbsp;<span class="ident" id="4286214">io</span><span class="op" id="4286216">.</span><span class="ident" id="4286217">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286225">fset</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4286232">*</span><span class="ident" id="4286233">token</span><span class="op" id="4286238">.</span><span class="ident" id="4286239">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286248">filter</span>&nbsp;<span class="ident" id="4286255">FieldFilter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286268">ptrmap</span>&nbsp;<span class="keyword" id="4286275">map</span><span class="op" id="4286278">[</span><span class="keyword" id="4286279">interface</span><span class="op" id="4286288">{</span><span class="op" id="4286289">}</span><span class="op" id="4286290">]</span><span class="builtintype" id="4286291">int</span>&nbsp;<span class="comment" id="4286295">//&nbsp;*T&nbsp;-&gt;&nbsp;line&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286317">indent</span>&nbsp;<span class="builtintype" id="4286324">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4286344">//&nbsp;current&nbsp;indentation&nbsp;level</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286374">last</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4286381">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4286401">//&nbsp;the&nbsp;last&nbsp;byte&nbsp;processed&nbsp;by&nbsp;Write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286438">line</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4286445">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4286465">//&nbsp;current&nbsp;line&nbsp;number</span><br>
<span class="lineno"></span><span class="op" id="4286488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4286491">var</span>&nbsp;<span class="ident" id="4286495">indent</span>&nbsp;<span class="op" id="4286502">=</span>&nbsp;<span class="op" id="4286504">[</span><span class="op" id="4286505">]</span><span class="builtintype" id="4286506">byte</span><span class="op" id="4286510">(</span><span class="string" id="4286511">&#34;.&nbsp;&nbsp;&#34;</span><span class="op" id="4286516">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="4286519">func</span>&nbsp;<span class="op" id="4286524">(</span><span class="ident" id="4286525">p</span>&nbsp;<span class="op" id="4286527">*</span><span class="ident" id="4286528">printer</span><span class="op" id="4286535">)</span>&nbsp;<span class="ident" id="4286537">Write</span><span class="op" id="4286542">(</span><span class="ident" id="4286543">data</span>&nbsp;<span class="op" id="4286548">[</span><span class="op" id="4286549">]</span><span class="builtintype" id="4286550">byte</span><span class="op" id="4286554">)</span>&nbsp;<span class="op" id="4286556">(</span><span class="ident" id="4286557">n</span>&nbsp;<span class="builtintype" id="4286559">int</span><span class="op" id="4286562">,</span>&nbsp;<span class="ident" id="4286564">err</span>&nbsp;<span class="builtintype" id="4286568">error</span><span class="op" id="4286573">)</span>&nbsp;<span class="op" id="4286575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286578">var</span>&nbsp;<span class="ident" id="4286582">m</span>&nbsp;<span class="builtintype" id="4286584">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286589">for</span>&nbsp;<span class="ident" id="4286593">i</span><span class="op" id="4286594">,</span>&nbsp;<span class="ident" id="4286596">b</span>&nbsp;<span class="op" id="4286598">:=</span>&nbsp;<span class="keyword" id="4286601">range</span>&nbsp;<span class="ident" id="4286607">data</span>&nbsp;<span class="op" id="4286612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4286616">//&nbsp;invariant:&nbsp;data[0:n]&nbsp;has&nbsp;been&nbsp;written</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286659">if</span>&nbsp;<span class="ident" id="4286662">b</span>&nbsp;<span class="op" id="4286664">==</span>&nbsp;<span class="string" id="4286667">&#39;\n&#39;</span>&nbsp;<span class="op" id="4286672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286677">m</span><span class="op" id="4286678">,</span>&nbsp;<span class="ident" id="4286680">err</span>&nbsp;<span class="op" id="4286684">=</span>&nbsp;<span class="ident" id="4286686">p</span><span class="op" id="4286687">.</span><span class="ident" id="4286688">output</span><span class="op" id="4286694">.</span><span class="ident" id="4286695">Write</span><span class="op" id="4286700">(</span><span class="ident" id="4286701">data</span><span class="op" id="4286705">[</span><span class="ident" id="4286706">n</span>&nbsp;<span class="op" id="4286708">:</span>&nbsp;<span class="ident" id="4286710">i</span><span class="op" id="4286711">+</span><span class="num" id="4286712">1</span><span class="op" id="4286713">]</span><span class="op" id="4286714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286719">n</span>&nbsp;<span class="op" id="4286721">+=</span>&nbsp;<span class="ident" id="4286724">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286729">if</span>&nbsp;<span class="ident" id="4286732">err</span>&nbsp;<span class="op" id="4286736">!=</span>&nbsp;<span class="ident" id="4286739">nil</span>&nbsp;<span class="op" id="4286743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286749">return</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4286759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286764">p</span><span class="op" id="4286765">.</span><span class="ident" id="4286766">line</span><span class="op" id="4286770">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4286775">}</span>&nbsp;<span class="keyword" id="4286777">else</span>&nbsp;<span class="keyword" id="4286782">if</span>&nbsp;<span class="ident" id="4286785">p</span><span class="op" id="4286786">.</span><span class="ident" id="4286787">last</span>&nbsp;<span class="op" id="4286792">==</span>&nbsp;<span class="string" id="4286795">&#39;\n&#39;</span>&nbsp;<span class="op" id="4286800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286805">_</span><span class="op" id="4286806">,</span>&nbsp;<span class="ident" id="4286808">err</span>&nbsp;<span class="op" id="4286812">=</span>&nbsp;<span class="ident" id="4286814">fmt</span><span class="op" id="4286817">.</span><span class="ident" id="4286818">Fprintf</span><span class="op" id="4286825">(</span><span class="ident" id="4286826">p</span><span class="op" id="4286827">.</span><span class="ident" id="4286828">output</span><span class="op" id="4286834">,</span>&nbsp;<span class="string" id="4286836">&#34;%6d&nbsp;&nbsp;&#34;</span><span class="op" id="4286843">,</span>&nbsp;<span class="ident" id="4286845">p</span><span class="op" id="4286846">.</span><span class="ident" id="4286847">line</span><span class="op" id="4286851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286856">if</span>&nbsp;<span class="ident" id="4286859">err</span>&nbsp;<span class="op" id="4286863">!=</span>&nbsp;<span class="ident" id="4286866">nil</span>&nbsp;<span class="op" id="4286870">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286876">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4286886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286891">for</span>&nbsp;<span class="ident" id="4286895">j</span>&nbsp;<span class="op" id="4286897">:=</span>&nbsp;<span class="ident" id="4286900">p</span><span class="op" id="4286901">.</span><span class="ident" id="4286902">indent</span><span class="op" id="4286908">;</span>&nbsp;<span class="ident" id="4286910">j</span>&nbsp;<span class="op" id="4286912">&gt;</span>&nbsp;<span class="num" id="4286914">0</span><span class="op" id="4286915">;</span>&nbsp;<span class="ident" id="4286917">j</span><span class="op" id="4286918">--</span>&nbsp;<span class="op" id="4286921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286927">_</span><span class="op" id="4286928">,</span>&nbsp;<span class="ident" id="4286930">err</span>&nbsp;<span class="op" id="4286934">=</span>&nbsp;<span class="ident" id="4286936">p</span><span class="op" id="4286937">.</span><span class="ident" id="4286938">output</span><span class="op" id="4286944">.</span><span class="ident" id="4286945">Write</span><span class="op" id="4286950">(</span><span class="ident" id="4286951">indent</span><span class="op" id="4286957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286963">if</span>&nbsp;<span class="ident" id="4286966">err</span>&nbsp;<span class="op" id="4286970">!=</span>&nbsp;<span class="ident" id="4286973">nil</span>&nbsp;<span class="op" id="4286977">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286984">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4286995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4287000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4287004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4287008">p</span><span class="op" id="4287009">.</span><span class="ident" id="4287010">last</span>&nbsp;<span class="op" id="4287015">=</span>&nbsp;<span class="ident" id="4287017">b</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4287020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4287023">if</span>&nbsp;<span class="builtinfunc" id="4287026">len</span><span class="op" id="4287029">(</span><span class="ident" id="4287030">data</span><span class="op" id="4287034">)</span>&nbsp;<span class="op" id="4287036">&gt;</span>&nbsp;<span class="ident" id="4287038">n</span>&nbsp;<span class="op" id="4287040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4287044">m</span><span class="op" id="4287045">,</span>&nbsp;<span class="ident" id="4287047">err</span>&nbsp;<span class="op" id="4287051">=</span>&nbsp;<span class="ident" id="4287053">p</span><span class="op" id="4287054">.</span><span class="ident" id="4287055">output</span><span class="op" id="4287061">.</span><span class="ident" id="4287062">Write</span><span class="op" id="4287067">(</span><span class="ident" id="4287068">data</span><span class="op" id="4287072">[</span><span class="ident" id="4287073">n</span><span class="op" id="4287074">:</span><span class="op" id="4287075">]</span><span class="op" id="4287076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4287080">n</span>&nbsp;<span class="op" id="4287082">+=</span>&nbsp;<span class="ident" id="4287085">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4287088">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4287091">return</span><br>
<span class="lineno"></span><span class="op" id="4287098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4287101">//&nbsp;localError&nbsp;wraps&nbsp;locally&nbsp;caught&nbsp;errors&nbsp;so&nbsp;we&nbsp;can&nbsp;distinguish</span><br>
<span class="lineno"></span><span class="comment" id="4287165">//&nbsp;them&nbsp;from&nbsp;genuine&nbsp;panics&nbsp;which&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;return&nbsp;as&nbsp;errors.</span><br>
<span class="lineno">120</span><span class="keyword" id="4287234">type</span>&nbsp;<span class="ident" id="4287239">localError</span>&nbsp;<span class="keyword" id="4287250">struct</span>&nbsp;<span class="op" id="4287257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4287260">err</span>&nbsp;<span class="builtintype" id="4287264">error</span><br>
<span class="lineno"></span><span class="op" id="4287270">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4287273">//&nbsp;printf&nbsp;is&nbsp;a&nbsp;convenience&nbsp;wrapper&nbsp;that&nbsp;takes&nbsp;care&nbsp;of&nbsp;print&nbsp;errors.</span><br>
<span class="lineno">125</span><span class="keyword" id="4287341">func</span>&nbsp;<span class="op" id="4287346">(</span><span class="ident" id="4287347">p</span>&nbsp;<span class="op" id="4287349">*</span><span class="ident" id="4287350">printer</span><span class="op" id="4287357">)</span>&nbsp;<span class="ident" id="4287359">printf</span><span class="op" id="4287365">(</span><span class="ident" id="4287366">format</span>&nbsp;<span class="builtintype" id="4287373">string</span><span class="op" id="4287379">,</span>&nbsp;<span class="ident" id="4287381">args</span>&nbsp;<span class="op" id="4287386">...</span><span class="keyword" id="4287389">interface</span><span class="op" id="4287398">{</span><span class="op" id="4287399">}</span><span class="op" id="4287400">)</span>&nbsp;<span class="op" id="4287402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4287405">if</span>&nbsp;<span class="ident" id="4287408">_</span><span class="op" id="4287409">,</span>&nbsp;<span class="ident" id="4287411">err</span>&nbsp;<span class="op" id="4287415">:=</span>&nbsp;<span class="ident" id="4287418">fmt</span><span class="op" id="4287421">.</span><span class="ident" id="4287422">Fprintf</span><span class="op" id="4287429">(</span><span class="ident" id="4287430">p</span><span class="op" id="4287431">,</span>&nbsp;<span class="ident" id="4287433">format</span><span class="op" id="4287439">,</span>&nbsp;<span class="ident" id="4287441">args</span><span class="op" id="4287445">...</span><span class="op" id="4287448">)</span><span class="op" id="4287449">;</span>&nbsp;<span class="ident" id="4287451">err</span>&nbsp;<span class="op" id="4287455">!=</span>&nbsp;<span class="ident" id="4287458">nil</span>&nbsp;<span class="op" id="4287462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4287466">panic</span><span class="op" id="4287471">(</span><span class="ident" id="4287472">localError</span><span class="op" id="4287482">{</span><span class="ident" id="4287483">err</span><span class="op" id="4287486">}</span><span class="op" id="4287487">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4287490">}</span><br>
<span class="lineno"></span><span class="op" id="4287492">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="4287495">//&nbsp;Implementation&nbsp;note:&nbsp;Print&nbsp;is&nbsp;written&nbsp;for&nbsp;AST&nbsp;nodes&nbsp;but&nbsp;could&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4287563">//&nbsp;used&nbsp;to&nbsp;print&nbsp;arbitrary&nbsp;data&nbsp;structures;&nbsp;such&nbsp;a&nbsp;version&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="4287629">//&nbsp;probably&nbsp;be&nbsp;in&nbsp;a&nbsp;different&nbsp;package.</span><br>
<span class="lineno"></span><span class="comment" id="4287668">//</span><br>
<span class="lineno">135</span><span class="comment" id="4287671">//&nbsp;Note:&nbsp;This&nbsp;code&nbsp;detects&nbsp;(some)&nbsp;cycles&nbsp;created&nbsp;via&nbsp;pointers&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="4287737">//&nbsp;not&nbsp;cycles&nbsp;that&nbsp;are&nbsp;created&nbsp;via&nbsp;slices&nbsp;or&nbsp;maps&nbsp;containing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4287802">//&nbsp;same&nbsp;slice&nbsp;or&nbsp;map.&nbsp;Code&nbsp;for&nbsp;general&nbsp;data&nbsp;structures&nbsp;probably</span><br>
<span class="lineno"></span><span class="comment" id="4287866">//&nbsp;should&nbsp;catch&nbsp;those&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="keyword" id="4287898">func</span>&nbsp;<span class="op" id="4287903">(</span><span class="ident" id="4287904">p</span>&nbsp;<span class="op" id="4287906">*</span><span class="ident" id="4287907">printer</span><span class="op" id="4287914">)</span>&nbsp;<span class="builtinfunc" id="4287916">print</span><span class="op" id="4287921">(</span><span class="ident" id="4287922">x</span>&nbsp;<span class="ident" id="4287924">reflect</span><span class="op" id="4287931">.</span><span class="ident" id="4287932">Value</span><span class="op" id="4287937">)</span>&nbsp;<span class="op" id="4287939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4287942">if</span>&nbsp;<span class="op" id="4287945">!</span><span class="ident" id="4287946">NotNilFilter</span><span class="op" id="4287958">(</span><span class="string" id="4287959">&#34;&#34;</span><span class="op" id="4287961">,</span>&nbsp;<span class="ident" id="4287963">x</span><span class="op" id="4287964">)</span>&nbsp;<span class="op" id="4287966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4287970">p</span><span class="op" id="4287971">.</span><span class="ident" id="4287972">printf</span><span class="op" id="4287978">(</span><span class="string" id="4287979">&#34;nil&#34;</span><span class="op" id="4287984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4287988">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4287996">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288000">switch</span>&nbsp;<span class="ident" id="4288007">x</span><span class="op" id="4288008">.</span><span class="ident" id="4288009">Kind</span><span class="op" id="4288013">(</span><span class="op" id="4288014">)</span>&nbsp;<span class="op" id="4288016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288019">case</span>&nbsp;<span class="ident" id="4288024">reflect</span><span class="op" id="4288031">.</span><span class="ident" id="4288032">Interface</span><span class="op" id="4288041">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288045">p</span><span class="op" id="4288046">.</span><span class="builtinfunc" id="4288047">print</span><span class="op" id="4288052">(</span><span class="ident" id="4288053">x</span><span class="op" id="4288054">.</span><span class="ident" id="4288055">Elem</span><span class="op" id="4288059">(</span><span class="op" id="4288060">)</span><span class="op" id="4288061">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288065">case</span>&nbsp;<span class="ident" id="4288070">reflect</span><span class="op" id="4288077">.</span><span class="ident" id="4288078">Map</span><span class="op" id="4288081">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288085">p</span><span class="op" id="4288086">.</span><span class="ident" id="4288087">printf</span><span class="op" id="4288093">(</span><span class="string" id="4288094">&#34;%s&nbsp;(len&nbsp;=&nbsp;%d)&nbsp;{&#34;</span><span class="op" id="4288111">,</span>&nbsp;<span class="ident" id="4288113">x</span><span class="op" id="4288114">.</span><span class="ident" id="4288115">Type</span><span class="op" id="4288119">(</span><span class="op" id="4288120">)</span><span class="op" id="4288121">,</span>&nbsp;<span class="ident" id="4288123">x</span><span class="op" id="4288124">.</span><span class="ident" id="4288125">Len</span><span class="op" id="4288128">(</span><span class="op" id="4288129">)</span><span class="op" id="4288130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288134">if</span>&nbsp;<span class="ident" id="4288137">x</span><span class="op" id="4288138">.</span><span class="ident" id="4288139">Len</span><span class="op" id="4288142">(</span><span class="op" id="4288143">)</span>&nbsp;<span class="op" id="4288145">&gt;</span>&nbsp;<span class="num" id="4288147">0</span>&nbsp;<span class="op" id="4288149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288154">p</span><span class="op" id="4288155">.</span><span class="ident" id="4288156">indent</span><span class="op" id="4288162">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288168">p</span><span class="op" id="4288169">.</span><span class="ident" id="4288170">printf</span><span class="op" id="4288176">(</span><span class="string" id="4288177">&#34;\n&#34;</span><span class="op" id="4288181">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288186">for</span>&nbsp;<span class="ident" id="4288190">_</span><span class="op" id="4288191">,</span>&nbsp;<span class="ident" id="4288193">key</span>&nbsp;<span class="op" id="4288197">:=</span>&nbsp;<span class="keyword" id="4288200">range</span>&nbsp;<span class="ident" id="4288206">x</span><span class="op" id="4288207">.</span><span class="ident" id="4288208">MapKeys</span><span class="op" id="4288215">(</span><span class="op" id="4288216">)</span>&nbsp;<span class="op" id="4288218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288224">p</span><span class="op" id="4288225">.</span><span class="builtinfunc" id="4288226">print</span><span class="op" id="4288231">(</span><span class="ident" id="4288232">key</span><span class="op" id="4288235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288241">p</span><span class="op" id="4288242">.</span><span class="ident" id="4288243">printf</span><span class="op" id="4288249">(</span><span class="string" id="4288250">&#34;:&nbsp;&#34;</span><span class="op" id="4288254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288260">p</span><span class="op" id="4288261">.</span><span class="builtinfunc" id="4288262">print</span><span class="op" id="4288267">(</span><span class="ident" id="4288268">x</span><span class="op" id="4288269">.</span><span class="ident" id="4288270">MapIndex</span><span class="op" id="4288278">(</span><span class="ident" id="4288279">key</span><span class="op" id="4288282">)</span><span class="op" id="4288283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288289">p</span><span class="op" id="4288290">.</span><span class="ident" id="4288291">printf</span><span class="op" id="4288297">(</span><span class="string" id="4288298">&#34;\n&#34;</span><span class="op" id="4288302">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4288307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288312">p</span><span class="op" id="4288313">.</span><span class="ident" id="4288314">indent</span><span class="op" id="4288320">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4288325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288329">p</span><span class="op" id="4288330">.</span><span class="ident" id="4288331">printf</span><span class="op" id="4288337">(</span><span class="string" id="4288338">&#34;}&#34;</span><span class="op" id="4288341">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288345">case</span>&nbsp;<span class="ident" id="4288350">reflect</span><span class="op" id="4288357">.</span><span class="ident" id="4288358">Ptr</span><span class="op" id="4288361">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288365">p</span><span class="op" id="4288366">.</span><span class="ident" id="4288367">printf</span><span class="op" id="4288373">(</span><span class="string" id="4288374">&#34;*&#34;</span><span class="op" id="4288377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4288381">//&nbsp;type-checked&nbsp;ASTs&nbsp;may&nbsp;contain&nbsp;cycles&nbsp;-&nbsp;use&nbsp;ptrmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4288436">//&nbsp;to&nbsp;keep&nbsp;track&nbsp;of&nbsp;objects&nbsp;that&nbsp;have&nbsp;been&nbsp;printed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4288489">//&nbsp;already&nbsp;and&nbsp;print&nbsp;the&nbsp;respective&nbsp;line&nbsp;number&nbsp;instead</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288547">ptr</span>&nbsp;<span class="op" id="4288551">:=</span>&nbsp;<span class="ident" id="4288554">x</span><span class="op" id="4288555">.</span><span class="ident" id="4288556">Interface</span><span class="op" id="4288565">(</span><span class="op" id="4288566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288570">if</span>&nbsp;<span class="ident" id="4288573">line</span><span class="op" id="4288577">,</span>&nbsp;<span class="ident" id="4288579">exists</span>&nbsp;<span class="op" id="4288586">:=</span>&nbsp;<span class="ident" id="4288589">p</span><span class="op" id="4288590">.</span><span class="ident" id="4288591">ptrmap</span><span class="op" id="4288597">[</span><span class="ident" id="4288598">ptr</span><span class="op" id="4288601">]</span><span class="op" id="4288602">;</span>&nbsp;<span class="ident" id="4288604">exists</span>&nbsp;<span class="op" id="4288611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288616">p</span><span class="op" id="4288617">.</span><span class="ident" id="4288618">printf</span><span class="op" id="4288624">(</span><span class="string" id="4288625">&#34;(obj&nbsp;@&nbsp;%d)&#34;</span><span class="op" id="4288637">,</span>&nbsp;<span class="ident" id="4288639">line</span><span class="op" id="4288643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4288647">}</span>&nbsp;<span class="keyword" id="4288649">else</span>&nbsp;<span class="op" id="4288654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288659">p</span><span class="op" id="4288660">.</span><span class="ident" id="4288661">ptrmap</span><span class="op" id="4288667">[</span><span class="ident" id="4288668">ptr</span><span class="op" id="4288671">]</span>&nbsp;<span class="op" id="4288673">=</span>&nbsp;<span class="ident" id="4288675">p</span><span class="op" id="4288676">.</span><span class="ident" id="4288677">line</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288685">p</span><span class="op" id="4288686">.</span><span class="builtinfunc" id="4288687">print</span><span class="op" id="4288692">(</span><span class="ident" id="4288693">x</span><span class="op" id="4288694">.</span><span class="ident" id="4288695">Elem</span><span class="op" id="4288699">(</span><span class="op" id="4288700">)</span><span class="op" id="4288701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4288705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288709">case</span>&nbsp;<span class="ident" id="4288714">reflect</span><span class="op" id="4288721">.</span><span class="ident" id="4288722">Array</span><span class="op" id="4288727">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288731">p</span><span class="op" id="4288732">.</span><span class="ident" id="4288733">printf</span><span class="op" id="4288739">(</span><span class="string" id="4288740">&#34;%s&nbsp;{&#34;</span><span class="op" id="4288746">,</span>&nbsp;<span class="ident" id="4288748">x</span><span class="op" id="4288749">.</span><span class="ident" id="4288750">Type</span><span class="op" id="4288754">(</span><span class="op" id="4288755">)</span><span class="op" id="4288756">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288760">if</span>&nbsp;<span class="ident" id="4288763">x</span><span class="op" id="4288764">.</span><span class="ident" id="4288765">Len</span><span class="op" id="4288768">(</span><span class="op" id="4288769">)</span>&nbsp;<span class="op" id="4288771">&gt;</span>&nbsp;<span class="num" id="4288773">0</span>&nbsp;<span class="op" id="4288775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288780">p</span><span class="op" id="4288781">.</span><span class="ident" id="4288782">indent</span><span class="op" id="4288788">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288794">p</span><span class="op" id="4288795">.</span><span class="ident" id="4288796">printf</span><span class="op" id="4288802">(</span><span class="string" id="4288803">&#34;\n&#34;</span><span class="op" id="4288807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288812">for</span>&nbsp;<span class="ident" id="4288816">i</span><span class="op" id="4288817">,</span>&nbsp;<span class="ident" id="4288819">n</span>&nbsp;<span class="op" id="4288821">:=</span>&nbsp;<span class="num" id="4288824">0</span><span class="op" id="4288825">,</span>&nbsp;<span class="ident" id="4288827">x</span><span class="op" id="4288828">.</span><span class="ident" id="4288829">Len</span><span class="op" id="4288832">(</span><span class="op" id="4288833">)</span><span class="op" id="4288834">;</span>&nbsp;<span class="ident" id="4288836">i</span>&nbsp;<span class="op" id="4288838">&lt;</span>&nbsp;<span class="ident" id="4288840">n</span><span class="op" id="4288841">;</span>&nbsp;<span class="ident" id="4288843">i</span><span class="op" id="4288844">++</span>&nbsp;<span class="op" id="4288847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288853">p</span><span class="op" id="4288854">.</span><span class="ident" id="4288855">printf</span><span class="op" id="4288861">(</span><span class="string" id="4288862">&#34;%d:&nbsp;&#34;</span><span class="op" id="4288868">,</span>&nbsp;<span class="ident" id="4288870">i</span><span class="op" id="4288871">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288877">p</span><span class="op" id="4288878">.</span><span class="builtinfunc" id="4288879">print</span><span class="op" id="4288884">(</span><span class="ident" id="4288885">x</span><span class="op" id="4288886">.</span><span class="ident" id="4288887">Index</span><span class="op" id="4288892">(</span><span class="ident" id="4288893">i</span><span class="op" id="4288894">)</span><span class="op" id="4288895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288901">p</span><span class="op" id="4288902">.</span><span class="ident" id="4288903">printf</span><span class="op" id="4288909">(</span><span class="string" id="4288910">&#34;\n&#34;</span><span class="op" id="4288914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4288919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288924">p</span><span class="op" id="4288925">.</span><span class="ident" id="4288926">indent</span><span class="op" id="4288932">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4288937">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288941">p</span><span class="op" id="4288942">.</span><span class="ident" id="4288943">printf</span><span class="op" id="4288949">(</span><span class="string" id="4288950">&#34;}&#34;</span><span class="op" id="4288953">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288957">case</span>&nbsp;<span class="ident" id="4288962">reflect</span><span class="op" id="4288969">.</span><span class="ident" id="4288970">Slice</span><span class="op" id="4288975">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288979">if</span>&nbsp;<span class="ident" id="4288982">s</span><span class="op" id="4288983">,</span>&nbsp;<span class="ident" id="4288985">ok</span>&nbsp;<span class="op" id="4288988">:=</span>&nbsp;<span class="ident" id="4288991">x</span><span class="op" id="4288992">.</span><span class="ident" id="4288993">Interface</span><span class="op" id="4289002">(</span><span class="op" id="4289003">)</span><span class="op" id="4289004">.</span><span class="op" id="4289005">(</span><span class="op" id="4289006">[</span><span class="op" id="4289007">]</span><span class="builtintype" id="4289008">byte</span><span class="op" id="4289012">)</span><span class="op" id="4289013">;</span>&nbsp;<span class="ident" id="4289015">ok</span>&nbsp;<span class="op" id="4289018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289023">p</span><span class="op" id="4289024">.</span><span class="ident" id="4289025">printf</span><span class="op" id="4289031">(</span><span class="string" id="4289032">&#34;%#q&#34;</span><span class="op" id="4289037">,</span>&nbsp;<span class="ident" id="4289039">s</span><span class="op" id="4289040">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289045">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4289054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289058">p</span><span class="op" id="4289059">.</span><span class="ident" id="4289060">printf</span><span class="op" id="4289066">(</span><span class="string" id="4289067">&#34;%s&nbsp;(len&nbsp;=&nbsp;%d)&nbsp;{&#34;</span><span class="op" id="4289084">,</span>&nbsp;<span class="ident" id="4289086">x</span><span class="op" id="4289087">.</span><span class="ident" id="4289088">Type</span><span class="op" id="4289092">(</span><span class="op" id="4289093">)</span><span class="op" id="4289094">,</span>&nbsp;<span class="ident" id="4289096">x</span><span class="op" id="4289097">.</span><span class="ident" id="4289098">Len</span><span class="op" id="4289101">(</span><span class="op" id="4289102">)</span><span class="op" id="4289103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289107">if</span>&nbsp;<span class="ident" id="4289110">x</span><span class="op" id="4289111">.</span><span class="ident" id="4289112">Len</span><span class="op" id="4289115">(</span><span class="op" id="4289116">)</span>&nbsp;<span class="op" id="4289118">&gt;</span>&nbsp;<span class="num" id="4289120">0</span>&nbsp;<span class="op" id="4289122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289127">p</span><span class="op" id="4289128">.</span><span class="ident" id="4289129">indent</span><span class="op" id="4289135">++</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289141">p</span><span class="op" id="4289142">.</span><span class="ident" id="4289143">printf</span><span class="op" id="4289149">(</span><span class="string" id="4289150">&#34;\n&#34;</span><span class="op" id="4289154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289159">for</span>&nbsp;<span class="ident" id="4289163">i</span><span class="op" id="4289164">,</span>&nbsp;<span class="ident" id="4289166">n</span>&nbsp;<span class="op" id="4289168">:=</span>&nbsp;<span class="num" id="4289171">0</span><span class="op" id="4289172">,</span>&nbsp;<span class="ident" id="4289174">x</span><span class="op" id="4289175">.</span><span class="ident" id="4289176">Len</span><span class="op" id="4289179">(</span><span class="op" id="4289180">)</span><span class="op" id="4289181">;</span>&nbsp;<span class="ident" id="4289183">i</span>&nbsp;<span class="op" id="4289185">&lt;</span>&nbsp;<span class="ident" id="4289187">n</span><span class="op" id="4289188">;</span>&nbsp;<span class="ident" id="4289190">i</span><span class="op" id="4289191">++</span>&nbsp;<span class="op" id="4289194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289200">p</span><span class="op" id="4289201">.</span><span class="ident" id="4289202">printf</span><span class="op" id="4289208">(</span><span class="string" id="4289209">&#34;%d:&nbsp;&#34;</span><span class="op" id="4289215">,</span>&nbsp;<span class="ident" id="4289217">i</span><span class="op" id="4289218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289224">p</span><span class="op" id="4289225">.</span><span class="builtinfunc" id="4289226">print</span><span class="op" id="4289231">(</span><span class="ident" id="4289232">x</span><span class="op" id="4289233">.</span><span class="ident" id="4289234">Index</span><span class="op" id="4289239">(</span><span class="ident" id="4289240">i</span><span class="op" id="4289241">)</span><span class="op" id="4289242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289248">p</span><span class="op" id="4289249">.</span><span class="ident" id="4289250">printf</span><span class="op" id="4289256">(</span><span class="string" id="4289257">&#34;\n&#34;</span><span class="op" id="4289261">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4289266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289271">p</span><span class="op" id="4289272">.</span><span class="ident" id="4289273">indent</span><span class="op" id="4289279">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4289284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289288">p</span><span class="op" id="4289289">.</span><span class="ident" id="4289290">printf</span><span class="op" id="4289296">(</span><span class="string" id="4289297">&#34;}&#34;</span><span class="op" id="4289300">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289304">case</span>&nbsp;<span class="ident" id="4289309">reflect</span><span class="op" id="4289316">.</span><span class="ident" id="4289317">Struct</span><span class="op" id="4289323">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289327">t</span>&nbsp;<span class="op" id="4289329">:=</span>&nbsp;<span class="ident" id="4289332">x</span><span class="op" id="4289333">.</span><span class="ident" id="4289334">Type</span><span class="op" id="4289338">(</span><span class="op" id="4289339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289343">p</span><span class="op" id="4289344">.</span><span class="ident" id="4289345">printf</span><span class="op" id="4289351">(</span><span class="string" id="4289352">&#34;%s&nbsp;{&#34;</span><span class="op" id="4289358">,</span>&nbsp;<span class="ident" id="4289360">t</span><span class="op" id="4289361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289365">p</span><span class="op" id="4289366">.</span><span class="ident" id="4289367">indent</span><span class="op" id="4289373">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289378">first</span>&nbsp;<span class="op" id="4289384">:=</span>&nbsp;<span class="builtintype" id="4289387">true</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289394">for</span>&nbsp;<span class="ident" id="4289398">i</span><span class="op" id="4289399">,</span>&nbsp;<span class="ident" id="4289401">n</span>&nbsp;<span class="op" id="4289403">:=</span>&nbsp;<span class="num" id="4289406">0</span><span class="op" id="4289407">,</span>&nbsp;<span class="ident" id="4289409">t</span><span class="op" id="4289410">.</span><span class="ident" id="4289411">NumField</span><span class="op" id="4289419">(</span><span class="op" id="4289420">)</span><span class="op" id="4289421">;</span>&nbsp;<span class="ident" id="4289423">i</span>&nbsp;<span class="op" id="4289425">&lt;</span>&nbsp;<span class="ident" id="4289427">n</span><span class="op" id="4289428">;</span>&nbsp;<span class="ident" id="4289430">i</span><span class="op" id="4289431">++</span>&nbsp;<span class="op" id="4289434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4289439">//&nbsp;exclude&nbsp;non-exported&nbsp;fields&nbsp;because&nbsp;their</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4289487">//&nbsp;values&nbsp;cannot&nbsp;be&nbsp;accessed&nbsp;via&nbsp;reflection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289534">if</span>&nbsp;<span class="ident" id="4289537">name</span>&nbsp;<span class="op" id="4289542">:=</span>&nbsp;<span class="ident" id="4289545">t</span><span class="op" id="4289546">.</span><span class="ident" id="4289547">Field</span><span class="op" id="4289552">(</span><span class="ident" id="4289553">i</span><span class="op" id="4289554">)</span><span class="op" id="4289555">.</span><span class="ident" id="4289556">Name</span><span class="op" id="4289560">;</span>&nbsp;<span class="ident" id="4289562">IsExported</span><span class="op" id="4289572">(</span><span class="ident" id="4289573">name</span><span class="op" id="4289577">)</span>&nbsp;<span class="op" id="4289579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289585">value</span>&nbsp;<span class="op" id="4289591">:=</span>&nbsp;<span class="ident" id="4289594">x</span><span class="op" id="4289595">.</span><span class="ident" id="4289596">Field</span><span class="op" id="4289601">(</span><span class="ident" id="4289602">i</span><span class="op" id="4289603">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289609">if</span>&nbsp;<span class="ident" id="4289612">p</span><span class="op" id="4289613">.</span><span class="ident" id="4289614">filter</span>&nbsp;<span class="op" id="4289621">==</span>&nbsp;<span class="ident" id="4289624">nil</span>&nbsp;<span class="op" id="4289628">||</span>&nbsp;<span class="ident" id="4289631">p</span><span class="op" id="4289632">.</span><span class="ident" id="4289633">filter</span><span class="op" id="4289639">(</span><span class="ident" id="4289640">name</span><span class="op" id="4289644">,</span>&nbsp;<span class="ident" id="4289646">value</span><span class="op" id="4289651">)</span>&nbsp;<span class="op" id="4289653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289660">if</span>&nbsp;<span class="ident" id="4289663">first</span>&nbsp;<span class="op" id="4289669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289677">p</span><span class="op" id="4289678">.</span><span class="ident" id="4289679">printf</span><span class="op" id="4289685">(</span><span class="string" id="4289686">&#34;\n&#34;</span><span class="op" id="4289690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289698">first</span>&nbsp;<span class="op" id="4289704">=</span>&nbsp;<span class="builtintype" id="4289706">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4289717">}</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289724">p</span><span class="op" id="4289725">.</span><span class="ident" id="4289726">printf</span><span class="op" id="4289732">(</span><span class="string" id="4289733">&#34;%s:&nbsp;&#34;</span><span class="op" id="4289739">,</span>&nbsp;<span class="ident" id="4289741">name</span><span class="op" id="4289745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289752">p</span><span class="op" id="4289753">.</span><span class="builtinfunc" id="4289754">print</span><span class="op" id="4289759">(</span><span class="ident" id="4289760">value</span><span class="op" id="4289765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289772">p</span><span class="op" id="4289773">.</span><span class="ident" id="4289774">printf</span><span class="op" id="4289780">(</span><span class="string" id="4289781">&#34;\n&#34;</span><span class="op" id="4289785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4289791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4289796">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4289800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289804">p</span><span class="op" id="4289805">.</span><span class="ident" id="4289806">indent</span><span class="op" id="4289812">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289817">p</span><span class="op" id="4289818">.</span><span class="ident" id="4289819">printf</span><span class="op" id="4289825">(</span><span class="string" id="4289826">&#34;}&#34;</span><span class="op" id="4289829">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289833">default</span><span class="op" id="4289840">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289844">v</span>&nbsp;<span class="op" id="4289846">:=</span>&nbsp;<span class="ident" id="4289849">x</span><span class="op" id="4289850">.</span><span class="ident" id="4289851">Interface</span><span class="op" id="4289860">(</span><span class="op" id="4289861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289865">switch</span>&nbsp;<span class="ident" id="4289872">v</span>&nbsp;<span class="op" id="4289874">:=</span>&nbsp;<span class="ident" id="4289877">v</span><span class="op" id="4289878">.</span><span class="op" id="4289879">(</span><span class="keyword" id="4289880">type</span><span class="op" id="4289884">)</span>&nbsp;<span class="op" id="4289886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289890">case</span>&nbsp;<span class="builtintype" id="4289895">string</span><span class="op" id="4289901">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4289906">//&nbsp;print&nbsp;strings&nbsp;in&nbsp;quotes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289936">p</span><span class="op" id="4289937">.</span><span class="ident" id="4289938">printf</span><span class="op" id="4289944">(</span><span class="string" id="4289945">&#34;%q&#34;</span><span class="op" id="4289949">,</span>&nbsp;<span class="ident" id="4289951">v</span><span class="op" id="4289952">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289957">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289966">case</span>&nbsp;<span class="ident" id="4289971">token</span><span class="op" id="4289976">.</span><span class="ident" id="4289977">Pos</span><span class="op" id="4289980">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4289985">//&nbsp;position&nbsp;values&nbsp;can&nbsp;be&nbsp;printed&nbsp;nicely&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290051">if</span>&nbsp;<span class="ident" id="4290054">p</span><span class="op" id="4290055">.</span><span class="ident" id="4290056">fset</span>&nbsp;<span class="op" id="4290061">!=</span>&nbsp;<span class="ident" id="4290064">nil</span>&nbsp;<span class="op" id="4290068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4290074">p</span><span class="op" id="4290075">.</span><span class="ident" id="4290076">printf</span><span class="op" id="4290082">(</span><span class="string" id="4290083">&#34;%s&#34;</span><span class="op" id="4290087">,</span>&nbsp;<span class="ident" id="4290089">p</span><span class="op" id="4290090">.</span><span class="ident" id="4290091">fset</span><span class="op" id="4290095">.</span><span class="ident" id="4290096">Position</span><span class="op" id="4290104">(</span><span class="ident" id="4290105">v</span><span class="op" id="4290106">)</span><span class="op" id="4290107">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290113">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4290123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4290127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4290131">//&nbsp;default</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4290144">p</span><span class="op" id="4290145">.</span><span class="ident" id="4290146">printf</span><span class="op" id="4290152">(</span><span class="string" id="4290153">&#34;%v&#34;</span><span class="op" id="4290157">,</span>&nbsp;<span class="ident" id="4290159">v</span><span class="op" id="4290160">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4290163">}</span><br>
<span class="lineno"></span><span class="op" id="4290165">}</span>
</div>
</body>
</html>
