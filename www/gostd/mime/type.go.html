<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime</h2>
<ul>
<li><a href="/gostd/mime/grammar.go.html">grammar.go</a></li>
<li><a href="/gostd/mime/mediatype.go.html">mediatype.go</a></li>
<li><a href="/gostd/mime/mediatype_test.go.html">mediatype_test.go</a></li>
<li><a href="/gostd/mime/type.go.html" class="current">type.go</a></li>
<li><a href="/gostd/mime/type_test.go.html">type_test.go</a></li>
<li><a href="/gostd/mime/type_unix.go.html">type_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2326443">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2326498">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2326552">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2326603">//&nbsp;Package&nbsp;mime&nbsp;implements&nbsp;parts&nbsp;of&nbsp;the&nbsp;MIME&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="2326654">package</span>&nbsp;<span class="ident" id="2326662">mime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2326668">import</span>&nbsp;<span class="op" id="2326675">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2326678">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2326685">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2326696">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="2326703">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2326706">var</span>&nbsp;<span class="op" id="2326710">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2326713">mimeLock</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2326728">sync</span><span class="op" id="2326732">.</span><span class="ident" id="2326733">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2326742">mimeTypesLower</span>&nbsp;<span class="op" id="2326757">=</span>&nbsp;<span class="keyword" id="2326759">map</span><span class="op" id="2326762">[</span><span class="builtintype" id="2326763">string</span><span class="op" id="2326769">]</span><span class="builtintype" id="2326770">string</span><span class="op" id="2326776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2326780">&#34;.css&#34;</span><span class="op" id="2326786">:</span>&nbsp;&nbsp;<span class="string" id="2326789">&#34;text/css;&nbsp;charset=utf-8&#34;</span><span class="op" id="2326814">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2326818">&#34;.gif&#34;</span><span class="op" id="2326824">:</span>&nbsp;&nbsp;<span class="string" id="2326827">&#34;image/gif&#34;</span><span class="op" id="2326838">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2326842">&#34;.htm&#34;</span><span class="op" id="2326848">:</span>&nbsp;&nbsp;<span class="string" id="2326851">&#34;text/html;&nbsp;charset=utf-8&#34;</span><span class="op" id="2326877">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2326881">&#34;.html&#34;</span><span class="op" id="2326888">:</span>&nbsp;<span class="string" id="2326890">&#34;text/html;&nbsp;charset=utf-8&#34;</span><span class="op" id="2326916">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2326920">&#34;.jpg&#34;</span><span class="op" id="2326926">:</span>&nbsp;&nbsp;<span class="string" id="2326929">&#34;image/jpeg&#34;</span><span class="op" id="2326941">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2326945">&#34;.js&#34;</span><span class="op" id="2326950">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="2326954">&#34;application/x-javascript&#34;</span><span class="op" id="2326980">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2326984">&#34;.pdf&#34;</span><span class="op" id="2326990">:</span>&nbsp;&nbsp;<span class="string" id="2326993">&#34;application/pdf&#34;</span><span class="op" id="2327010">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2327014">&#34;.png&#34;</span><span class="op" id="2327020">:</span>&nbsp;&nbsp;<span class="string" id="2327023">&#34;image/png&#34;</span><span class="op" id="2327034">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2327038">&#34;.xml&#34;</span><span class="op" id="2327044">:</span>&nbsp;&nbsp;<span class="string" id="2327047">&#34;text/xml;&nbsp;charset=utf-8&#34;</span><span class="op" id="2327072">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2327075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2327078">mimeTypes</span>&nbsp;<span class="op" id="2327088">=</span>&nbsp;<span class="ident" id="2327090">clone</span><span class="op" id="2327095">(</span><span class="ident" id="2327096">mimeTypesLower</span><span class="op" id="2327110">)</span><br>
<span class="lineno"></span><span class="op" id="2327112">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="2327115">func</span>&nbsp;<span class="ident" id="2327120">clone</span><span class="op" id="2327125">(</span><span class="ident" id="2327126">m</span>&nbsp;<span class="keyword" id="2327128">map</span><span class="op" id="2327131">[</span><span class="builtintype" id="2327132">string</span><span class="op" id="2327138">]</span><span class="builtintype" id="2327139">string</span><span class="op" id="2327145">)</span>&nbsp;<span class="keyword" id="2327147">map</span><span class="op" id="2327150">[</span><span class="builtintype" id="2327151">string</span><span class="op" id="2327157">]</span><span class="builtintype" id="2327158">string</span>&nbsp;<span class="op" id="2327165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2327168">m2</span>&nbsp;<span class="op" id="2327171">:=</span>&nbsp;<span class="builtinfunc" id="2327174">make</span><span class="op" id="2327178">(</span><span class="keyword" id="2327179">map</span><span class="op" id="2327182">[</span><span class="builtintype" id="2327183">string</span><span class="op" id="2327189">]</span><span class="builtintype" id="2327190">string</span><span class="op" id="2327196">,</span>&nbsp;<span class="builtinfunc" id="2327198">len</span><span class="op" id="2327201">(</span><span class="ident" id="2327202">m</span><span class="op" id="2327203">)</span><span class="op" id="2327204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2327207">for</span>&nbsp;<span class="ident" id="2327211">k</span><span class="op" id="2327212">,</span>&nbsp;<span class="ident" id="2327214">v</span>&nbsp;<span class="op" id="2327216">:=</span>&nbsp;<span class="keyword" id="2327219">range</span>&nbsp;<span class="ident" id="2327225">m</span>&nbsp;<span class="op" id="2327227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2327231">m2</span><span class="op" id="2327233">[</span><span class="ident" id="2327234">k</span><span class="op" id="2327235">]</span>&nbsp;<span class="op" id="2327237">=</span>&nbsp;<span class="ident" id="2327239">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2327243">if</span>&nbsp;<span class="ident" id="2327246">strings</span><span class="op" id="2327253">.</span><span class="ident" id="2327254">ToLower</span><span class="op" id="2327261">(</span><span class="ident" id="2327262">k</span><span class="op" id="2327263">)</span>&nbsp;<span class="op" id="2327265">!=</span>&nbsp;<span class="ident" id="2327268">k</span>&nbsp;<span class="op" id="2327270">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2327275">panic</span><span class="op" id="2327280">(</span><span class="string" id="2327281">&#34;keys&nbsp;in&nbsp;mimeTypesLower&nbsp;must&nbsp;be&nbsp;lowercase&#34;</span><span class="op" id="2327323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2327327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2327330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2327333">return</span>&nbsp;<span class="ident" id="2327340">m2</span><br>
<span class="lineno"></span><span class="op" id="2327343">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="2327346">var</span>&nbsp;<span class="ident" id="2327350">once</span>&nbsp;<span class="ident" id="2327355">sync</span><span class="op" id="2327359">.</span><span class="ident" id="2327360">Once</span>&nbsp;<span class="comment" id="2327365">//&nbsp;guards&nbsp;initMime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2327385">//&nbsp;TypeByExtension&nbsp;returns&nbsp;the&nbsp;MIME&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;file&nbsp;extension&nbsp;ext.</span><br>
<span class="lineno"></span><span class="comment" id="2327466">//&nbsp;The&nbsp;extension&nbsp;ext&nbsp;should&nbsp;begin&nbsp;with&nbsp;a&nbsp;leading&nbsp;dot,&nbsp;as&nbsp;in&nbsp;&#34;.html&#34;.</span><br>
<span class="lineno">45</span><span class="comment" id="2327535">//&nbsp;When&nbsp;ext&nbsp;has&nbsp;no&nbsp;associated&nbsp;type,&nbsp;TypeByExtension&nbsp;returns&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="2327599">//</span><br>
<span class="lineno"></span><span class="comment" id="2327602">//&nbsp;Extensions&nbsp;are&nbsp;looked&nbsp;up&nbsp;first&nbsp;case-sensitively,&nbsp;then&nbsp;case-insensitively.</span><br>
<span class="lineno"></span><span class="comment" id="2327679">//</span><br>
<span class="lineno"></span><span class="comment" id="2327682">//&nbsp;The&nbsp;built-in&nbsp;table&nbsp;is&nbsp;small&nbsp;but&nbsp;on&nbsp;unix&nbsp;it&nbsp;is&nbsp;augmented&nbsp;by&nbsp;the&nbsp;local</span><br>
<span class="lineno">50</span><span class="comment" id="2327754">//&nbsp;system&#39;s&nbsp;mime.types&nbsp;file(s)&nbsp;if&nbsp;available&nbsp;under&nbsp;one&nbsp;or&nbsp;more&nbsp;of&nbsp;these</span><br>
<span class="lineno"></span><span class="comment" id="2327825">//&nbsp;names:</span><br>
<span class="lineno"></span><span class="comment" id="2327835">//</span><br>
<span class="lineno"></span><span class="comment" id="2327838">//&nbsp;&nbsp;&nbsp;/etc/mime.types</span><br>
<span class="lineno"></span><span class="comment" id="2327859">//&nbsp;&nbsp;&nbsp;/etc/apache2/mime.types</span><br>
<span class="lineno">55</span><span class="comment" id="2327888">//&nbsp;&nbsp;&nbsp;/etc/apache/mime.types</span><br>
<span class="lineno"></span><span class="comment" id="2327916">//</span><br>
<span class="lineno"></span><span class="comment" id="2327919">//&nbsp;On&nbsp;Windows,&nbsp;MIME&nbsp;types&nbsp;are&nbsp;extracted&nbsp;from&nbsp;the&nbsp;registry.</span><br>
<span class="lineno"></span><span class="comment" id="2327978">//</span><br>
<span class="lineno"></span><span class="comment" id="2327981">//&nbsp;Text&nbsp;types&nbsp;have&nbsp;the&nbsp;charset&nbsp;parameter&nbsp;set&nbsp;to&nbsp;&#34;utf-8&#34;&nbsp;by&nbsp;default.</span><br>
<span class="lineno">60</span><span class="keyword" id="2328049">func</span>&nbsp;<span class="ident" id="2328054">TypeByExtension</span><span class="op" id="2328069">(</span><span class="ident" id="2328070">ext</span>&nbsp;<span class="builtintype" id="2328074">string</span><span class="op" id="2328080">)</span>&nbsp;<span class="builtintype" id="2328082">string</span>&nbsp;<span class="op" id="2328089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2328092">once</span><span class="op" id="2328096">.</span><span class="ident" id="2328097">Do</span><span class="op" id="2328099">(</span><span class="ident" id="2328100">initMime</span><span class="op" id="2328108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2328111">mimeLock</span><span class="op" id="2328119">.</span><span class="ident" id="2328120">RLock</span><span class="op" id="2328125">(</span><span class="op" id="2328126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2328129">defer</span>&nbsp;<span class="ident" id="2328135">mimeLock</span><span class="op" id="2328143">.</span><span class="ident" id="2328144">RUnlock</span><span class="op" id="2328151">(</span><span class="op" id="2328152">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2328156">//&nbsp;Case-sensitive&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2328183">v</span>&nbsp;<span class="op" id="2328185">:=</span>&nbsp;<span class="ident" id="2328188">mimeTypes</span><span class="op" id="2328197">[</span><span class="ident" id="2328198">ext</span><span class="op" id="2328201">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2328204">if</span>&nbsp;<span class="ident" id="2328207">v</span>&nbsp;<span class="op" id="2328209">!=</span>&nbsp;<span class="string" id="2328212">&#34;&#34;</span>&nbsp;<span class="op" id="2328215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2328219">return</span>&nbsp;<span class="ident" id="2328226">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2328229">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2328233">//&nbsp;Case-insensitive&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2328262">//&nbsp;Optimistically&nbsp;assume&nbsp;a&nbsp;short&nbsp;ASCII&nbsp;extension&nbsp;and&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2328319">//&nbsp;allocation-free&nbsp;in&nbsp;that&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2328353">var</span>&nbsp;<span class="ident" id="2328357">buf</span>&nbsp;<span class="op" id="2328361">[</span><span class="num" id="2328362">10</span><span class="op" id="2328364">]</span><span class="builtintype" id="2328365">byte</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2328371">lower</span>&nbsp;<span class="op" id="2328377">:=</span>&nbsp;<span class="ident" id="2328380">buf</span><span class="op" id="2328383">[</span><span class="op" id="2328384">:</span><span class="num" id="2328385">0</span><span class="op" id="2328386">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2328389">const</span>&nbsp;<span class="ident" id="2328395">utf8RuneSelf</span>&nbsp;<span class="op" id="2328408">=</span>&nbsp;<span class="num" id="2328410">0x80</span>&nbsp;<span class="comment" id="2328415">//&nbsp;from&nbsp;utf8&nbsp;package,&nbsp;but&nbsp;not&nbsp;importing&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2328460">for</span>&nbsp;<span class="ident" id="2328464">i</span>&nbsp;<span class="op" id="2328466">:=</span>&nbsp;<span class="num" id="2328469">0</span><span class="op" id="2328470">;</span>&nbsp;<span class="ident" id="2328472">i</span>&nbsp;<span class="op" id="2328474">&lt;</span>&nbsp;<span class="builtinfunc" id="2328476">len</span><span class="op" id="2328479">(</span><span class="ident" id="2328480">ext</span><span class="op" id="2328483">)</span><span class="op" id="2328484">;</span>&nbsp;<span class="ident" id="2328486">i</span><span class="op" id="2328487">++</span>&nbsp;<span class="op" id="2328490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2328494">c</span>&nbsp;<span class="op" id="2328496">:=</span>&nbsp;<span class="ident" id="2328499">ext</span><span class="op" id="2328502">[</span><span class="ident" id="2328503">i</span><span class="op" id="2328504">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2328508">if</span>&nbsp;<span class="ident" id="2328511">c</span>&nbsp;<span class="op" id="2328513">&gt;=</span>&nbsp;<span class="ident" id="2328516">utf8RuneSelf</span>&nbsp;<span class="op" id="2328529">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2328534">//&nbsp;Slow&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2328551">return</span>&nbsp;<span class="ident" id="2328558">mimeTypesLower</span><span class="op" id="2328572">[</span><span class="ident" id="2328573">strings</span><span class="op" id="2328580">.</span><span class="ident" id="2328581">ToLower</span><span class="op" id="2328588">(</span><span class="ident" id="2328589">ext</span><span class="op" id="2328592">)</span><span class="op" id="2328593">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2328597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2328601">if</span>&nbsp;<span class="string" id="2328604">&#39;A&#39;</span>&nbsp;<span class="op" id="2328608">&lt;=</span>&nbsp;<span class="ident" id="2328611">c</span>&nbsp;<span class="op" id="2328613">&amp;&amp;</span>&nbsp;<span class="ident" id="2328616">c</span>&nbsp;<span class="op" id="2328618">&lt;=</span>&nbsp;<span class="string" id="2328621">&#39;Z&#39;</span>&nbsp;<span class="op" id="2328625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2328630">lower</span>&nbsp;<span class="op" id="2328636">=</span>&nbsp;<span class="builtinfunc" id="2328638">append</span><span class="op" id="2328644">(</span><span class="ident" id="2328645">lower</span><span class="op" id="2328650">,</span>&nbsp;<span class="ident" id="2328652">c</span><span class="op" id="2328653">+</span><span class="op" id="2328654">(</span><span class="string" id="2328655">&#39;a&#39;</span><span class="op" id="2328658">-</span><span class="string" id="2328659">&#39;A&#39;</span><span class="op" id="2328662">)</span><span class="op" id="2328663">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2328667">}</span>&nbsp;<span class="keyword" id="2328669">else</span>&nbsp;<span class="op" id="2328674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2328679">lower</span>&nbsp;<span class="op" id="2328685">=</span>&nbsp;<span class="builtinfunc" id="2328687">append</span><span class="op" id="2328693">(</span><span class="ident" id="2328694">lower</span><span class="op" id="2328699">,</span>&nbsp;<span class="ident" id="2328701">c</span><span class="op" id="2328702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2328706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2328709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2328712">//&nbsp;The&nbsp;conversion&nbsp;from&nbsp;[]byte&nbsp;to&nbsp;string&nbsp;doesn&#39;t&nbsp;allocate&nbsp;in</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2328773">//&nbsp;a&nbsp;map&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2328791">return</span>&nbsp;<span class="ident" id="2328798">mimeTypesLower</span><span class="op" id="2328812">[</span><span class="builtintype" id="2328813">string</span><span class="op" id="2328819">(</span><span class="ident" id="2328820">lower</span><span class="op" id="2328825">)</span><span class="op" id="2328826">]</span><br>
<span class="lineno"></span><span class="op" id="2328828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2328831">//&nbsp;AddExtensionType&nbsp;sets&nbsp;the&nbsp;MIME&nbsp;type&nbsp;associated&nbsp;with</span><br>
<span class="lineno">95</span><span class="comment" id="2328886">//&nbsp;the&nbsp;extension&nbsp;ext&nbsp;to&nbsp;typ.&nbsp;The&nbsp;extension&nbsp;should&nbsp;begin&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="2328947">//&nbsp;a&nbsp;leading&nbsp;dot,&nbsp;as&nbsp;in&nbsp;&#34;.html&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="2328980">func</span>&nbsp;<span class="ident" id="2328985">AddExtensionType</span><span class="op" id="2329001">(</span><span class="ident" id="2329002">ext</span><span class="op" id="2329005">,</span>&nbsp;<span class="ident" id="2329007">typ</span>&nbsp;<span class="builtintype" id="2329011">string</span><span class="op" id="2329017">)</span>&nbsp;<span class="builtintype" id="2329019">error</span>&nbsp;<span class="op" id="2329025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2329028">if</span>&nbsp;<span class="op" id="2329031">!</span><span class="ident" id="2329032">strings</span><span class="op" id="2329039">.</span><span class="ident" id="2329040">HasPrefix</span><span class="op" id="2329049">(</span><span class="ident" id="2329050">ext</span><span class="op" id="2329053">,</span>&nbsp;<span class="string" id="2329055">&#34;.&#34;</span><span class="op" id="2329058">)</span>&nbsp;<span class="op" id="2329060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2329064">return</span>&nbsp;<span class="ident" id="2329071">fmt</span><span class="op" id="2329074">.</span><span class="ident" id="2329075">Errorf</span><span class="op" id="2329081">(</span><span class="string" id="2329082">`mime:&nbsp;extension&nbsp;%q&nbsp;misses&nbsp;dot`</span><span class="op" id="2329113">,</span>&nbsp;<span class="ident" id="2329115">ext</span><span class="op" id="2329118">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2329121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2329124">once</span><span class="op" id="2329128">.</span><span class="ident" id="2329129">Do</span><span class="op" id="2329131">(</span><span class="ident" id="2329132">initMime</span><span class="op" id="2329140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2329143">return</span>&nbsp;<span class="ident" id="2329150">setExtensionType</span><span class="op" id="2329166">(</span><span class="ident" id="2329167">ext</span><span class="op" id="2329170">,</span>&nbsp;<span class="ident" id="2329172">typ</span><span class="op" id="2329175">)</span><br>
<span class="lineno"></span><span class="op" id="2329177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="2329180">func</span>&nbsp;<span class="ident" id="2329185">setExtensionType</span><span class="op" id="2329201">(</span><span class="ident" id="2329202">extension</span><span class="op" id="2329211">,</span>&nbsp;<span class="ident" id="2329213">mimeType</span>&nbsp;<span class="builtintype" id="2329222">string</span><span class="op" id="2329228">)</span>&nbsp;<span class="builtintype" id="2329230">error</span>&nbsp;<span class="op" id="2329236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2329239">_</span><span class="op" id="2329240">,</span>&nbsp;<span class="ident" id="2329242">param</span><span class="op" id="2329247">,</span>&nbsp;<span class="ident" id="2329249">err</span>&nbsp;<span class="op" id="2329253">:=</span>&nbsp;<span class="ident" id="2329256">ParseMediaType</span><span class="op" id="2329270">(</span><span class="ident" id="2329271">mimeType</span><span class="op" id="2329279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2329282">if</span>&nbsp;<span class="ident" id="2329285">err</span>&nbsp;<span class="op" id="2329289">!=</span>&nbsp;<span class="builtintype" id="2329292">nil</span>&nbsp;<span class="op" id="2329296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2329300">return</span>&nbsp;<span class="ident" id="2329307">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2329312">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2329315">if</span>&nbsp;<span class="ident" id="2329318">strings</span><span class="op" id="2329325">.</span><span class="ident" id="2329326">HasPrefix</span><span class="op" id="2329335">(</span><span class="ident" id="2329336">mimeType</span><span class="op" id="2329344">,</span>&nbsp;<span class="string" id="2329346">&#34;text/&#34;</span><span class="op" id="2329353">)</span>&nbsp;<span class="op" id="2329355">&amp;&amp;</span>&nbsp;<span class="ident" id="2329358">param</span><span class="op" id="2329363">[</span><span class="string" id="2329364">&#34;charset&#34;</span><span class="op" id="2329373">]</span>&nbsp;<span class="op" id="2329375">==</span>&nbsp;<span class="string" id="2329378">&#34;&#34;</span>&nbsp;<span class="op" id="2329381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2329385">param</span><span class="op" id="2329390">[</span><span class="string" id="2329391">&#34;charset&#34;</span><span class="op" id="2329400">]</span>&nbsp;<span class="op" id="2329402">=</span>&nbsp;<span class="string" id="2329404">&#34;utf-8&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2329414">mimeType</span>&nbsp;<span class="op" id="2329423">=</span>&nbsp;<span class="ident" id="2329425">FormatMediaType</span><span class="op" id="2329440">(</span><span class="ident" id="2329441">mimeType</span><span class="op" id="2329449">,</span>&nbsp;<span class="ident" id="2329451">param</span><span class="op" id="2329456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2329459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2329462">extLower</span>&nbsp;<span class="op" id="2329471">:=</span>&nbsp;<span class="ident" id="2329474">strings</span><span class="op" id="2329481">.</span><span class="ident" id="2329482">ToLower</span><span class="op" id="2329489">(</span><span class="ident" id="2329490">extension</span><span class="op" id="2329499">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2329503">mimeLock</span><span class="op" id="2329511">.</span><span class="ident" id="2329512">Lock</span><span class="op" id="2329516">(</span><span class="op" id="2329517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2329520">mimeTypes</span><span class="op" id="2329529">[</span><span class="ident" id="2329530">extension</span><span class="op" id="2329539">]</span>&nbsp;<span class="op" id="2329541">=</span>&nbsp;<span class="ident" id="2329543">mimeType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2329553">mimeTypesLower</span><span class="op" id="2329567">[</span><span class="ident" id="2329568">extLower</span><span class="op" id="2329576">]</span>&nbsp;<span class="op" id="2329578">=</span>&nbsp;<span class="ident" id="2329580">mimeType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2329590">mimeLock</span><span class="op" id="2329598">.</span><span class="ident" id="2329599">Unlock</span><span class="op" id="2329605">(</span><span class="op" id="2329606">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2329609">return</span>&nbsp;<span class="builtintype" id="2329616">nil</span><br>
<span class="lineno"></span><span class="op" id="2329620">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
