<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1914659">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1914715">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1914769">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1914820">package</span>&nbsp;<span class="ident" id="1914828">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1914837">var</span>&nbsp;<span class="ident" id="1914841">ticks</span>&nbsp;<span class="keyword" id="1914847">struct</span>&nbsp;<span class="op" id="1914854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1914857">lock</span>&nbsp;<span class="ident" id="1914862"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2016175">mutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1914869">val</span>&nbsp;&nbsp;<span class="ident" id="1914874">uint64</span><br>
<span class="lineno">10</span><span class="op" id="1914881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1914884">var</span>&nbsp;<span class="ident" id="1914888">tls0</span>&nbsp;<span class="op" id="1914893">[</span><span class="num" id="1914894">8</span><span class="op" id="1914895">]</span><span class="builtintype" id="1914896">uintptr</span>&nbsp;<span class="comment" id="1914904">//&nbsp;available&nbsp;storage&nbsp;for&nbsp;m0&#39;s&nbsp;TLS;&nbsp;not&nbsp;necessarily&nbsp;used;&nbsp;opaque&nbsp;to&nbsp;GC</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1914975">//&nbsp;Note:&nbsp;Called&nbsp;by&nbsp;runtime/pprof&nbsp;in&nbsp;addition&nbsp;to&nbsp;runtime&nbsp;code.</span><br>
<span class="lineno">15</span><span class="keyword" id="1915037">func</span>&nbsp;<span class="ident" id="1915042">tickspersecond</span><span class="op" id="1915056">(</span><span class="op" id="1915057">)</span>&nbsp;<span class="ident" id="1915059">int64</span>&nbsp;<span class="op" id="1915065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1915068">r</span>&nbsp;<span class="op" id="1915070">:=</span>&nbsp;<span class="ident" id="1915073">int64</span><span class="op" id="1915078">(</span><span class="ident" id="1915079"><a href="/runtime/atomic.go.html#1711348">atomicload64</a></span><span class="op" id="1915091">(</span><span class="op" id="1915092">&amp;</span><span class="ident" id="1915093"><a href="/runtime/runtime.go.html#1914841">ticks</a></span><span class="op" id="1915098">.</span><span class="ident" id="1915099">val</span><span class="op" id="1915102">)</span><span class="op" id="1915103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1915106">if</span>&nbsp;<span class="ident" id="1915109"><a href="/runtime/runtime.go.html#1915068">r</a></span>&nbsp;<span class="op" id="1915111">!=</span>&nbsp;<span class="num" id="1915114">0</span>&nbsp;<span class="op" id="1915116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1915120">return</span>&nbsp;<span class="ident" id="1915127"><a href="/runtime/runtime.go.html#1915068">r</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1915130">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1915133"><a href="/runtime/lock_futex.go.html#1815304">lock</a></span><span class="op" id="1915137">(</span><span class="op" id="1915138">&amp;</span><span class="ident" id="1915139"><a href="/runtime/runtime.go.html#1914841">ticks</a></span><span class="op" id="1915144">.</span><span class="ident" id="1915145">lock</span><span class="op" id="1915149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1915152"><a href="/runtime/runtime.go.html#1915068">r</a></span>&nbsp;<span class="op" id="1915154">=</span>&nbsp;<span class="ident" id="1915156">int64</span><span class="op" id="1915161">(</span><span class="ident" id="1915162"><a href="/runtime/runtime.go.html#1914841">ticks</a></span><span class="op" id="1915167">.</span><span class="ident" id="1915168">val</span><span class="op" id="1915171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1915174">if</span>&nbsp;<span class="ident" id="1915177"><a href="/runtime/runtime.go.html#1915068">r</a></span>&nbsp;<span class="op" id="1915179">==</span>&nbsp;<span class="num" id="1915182">0</span>&nbsp;<span class="op" id="1915184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1915188">t0</span>&nbsp;<span class="op" id="1915191">:=</span>&nbsp;<span class="ident" id="1915194"><a href="/runtime/stubs.go.html#1973903">nanotime</a></span><span class="op" id="1915202">(</span><span class="op" id="1915203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1915207">c0</span>&nbsp;<span class="op" id="1915210">:=</span>&nbsp;<span class="ident" id="1915213"><a href="/runtime/stubs.go.html#1974111">cputicks</a></span><span class="op" id="1915221">(</span><span class="op" id="1915222">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1915226"><a href="/runtime/stubs.go.html#1973925">usleep</a></span><span class="op" id="1915232">(</span><span class="num" id="1915233">100</span>&nbsp;<span class="op" id="1915237">*</span>&nbsp;<span class="num" id="1915239">1000</span><span class="op" id="1915243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1915247">t1</span>&nbsp;<span class="op" id="1915250">:=</span>&nbsp;<span class="ident" id="1915253"><a href="/runtime/stubs.go.html#1973903">nanotime</a></span><span class="op" id="1915261">(</span><span class="op" id="1915262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1915266">c1</span>&nbsp;<span class="op" id="1915269">:=</span>&nbsp;<span class="ident" id="1915272"><a href="/runtime/stubs.go.html#1974111">cputicks</a></span><span class="op" id="1915280">(</span><span class="op" id="1915281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1915285">if</span>&nbsp;<span class="ident" id="1915288"><a href="/runtime/runtime.go.html#1915247">t1</a></span>&nbsp;<span class="op" id="1915291">==</span>&nbsp;<span class="ident" id="1915294"><a href="/runtime/runtime.go.html#1915188">t0</a></span>&nbsp;<span class="op" id="1915297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1915302"><a href="/runtime/runtime.go.html#1915247">t1</a></span><span class="op" id="1915304">++</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1915309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1915313"><a href="/runtime/runtime.go.html#1915068">r</a></span>&nbsp;<span class="op" id="1915315">=</span>&nbsp;<span class="op" id="1915317">(</span><span class="ident" id="1915318"><a href="/runtime/runtime.go.html#1915266">c1</a></span>&nbsp;<span class="op" id="1915321">-</span>&nbsp;<span class="ident" id="1915323"><a href="/runtime/runtime.go.html#1915207">c0</a></span><span class="op" id="1915325">)</span>&nbsp;<span class="op" id="1915327">*</span>&nbsp;<span class="num" id="1915329">1000</span>&nbsp;<span class="op" id="1915334">*</span>&nbsp;<span class="num" id="1915336">1000</span>&nbsp;<span class="op" id="1915341">*</span>&nbsp;<span class="num" id="1915343">1000</span>&nbsp;<span class="op" id="1915348">/</span>&nbsp;<span class="op" id="1915350">(</span><span class="ident" id="1915351"><a href="/runtime/runtime.go.html#1915247">t1</a></span>&nbsp;<span class="op" id="1915354">-</span>&nbsp;<span class="ident" id="1915356"><a href="/runtime/runtime.go.html#1915188">t0</a></span><span class="op" id="1915358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1915362">if</span>&nbsp;<span class="ident" id="1915365"><a href="/runtime/runtime.go.html#1915068">r</a></span>&nbsp;<span class="op" id="1915367">==</span>&nbsp;<span class="num" id="1915370">0</span>&nbsp;<span class="op" id="1915372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1915377"><a href="/runtime/runtime.go.html#1915068">r</a></span><span class="op" id="1915378">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1915383">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1915387"><a href="/runtime/atomic.go.html#1711639">atomicstore64</a></span><span class="op" id="1915400">(</span><span class="op" id="1915401">&amp;</span><span class="ident" id="1915402"><a href="/runtime/runtime.go.html#1914841">ticks</a></span><span class="op" id="1915407">.</span><span class="ident" id="1915408">val</span><span class="op" id="1915411">,</span>&nbsp;<span class="ident" id="1915413">uint64</span><span class="op" id="1915419">(</span><span class="ident" id="1915420"><a href="/runtime/runtime.go.html#1915068">r</a></span><span class="op" id="1915421">)</span><span class="op" id="1915422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1915425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1915428"><a href="/runtime/lock_futex.go.html#1816596">unlock</a></span><span class="op" id="1915434">(</span><span class="op" id="1915435">&amp;</span><span class="ident" id="1915436"><a href="/runtime/runtime.go.html#1914841">ticks</a></span><span class="op" id="1915441">.</span><span class="ident" id="1915442">lock</span><span class="op" id="1915446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1915449">return</span>&nbsp;<span class="ident" id="1915456"><a href="/runtime/runtime.go.html#1915068">r</a></span><br>
<span class="lineno"></span><span class="op" id="1915458">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="1915461">func</span>&nbsp;<span class="ident" id="1915466">makeStringSlice</span><span class="op" id="1915481">(</span><span class="ident" id="1915482">n</span>&nbsp;<span class="builtintype" id="1915484">int</span><span class="op" id="1915487">)</span>&nbsp;<span class="op" id="1915489">[</span><span class="op" id="1915490">]</span><span class="builtintype" id="1915491">string</span>&nbsp;<span class="op" id="1915498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1915501">return</span>&nbsp;<span class="builtinfunc" id="1915508">make</span><span class="op" id="1915512">(</span><span class="op" id="1915513">[</span><span class="op" id="1915514">]</span><span class="builtintype" id="1915515">string</span><span class="op" id="1915521">,</span>&nbsp;<span class="ident" id="1915523"><a href="/runtime/runtime.go.html#1915482">n</a></span><span class="op" id="1915524">)</span><br>
<span class="lineno"></span><span class="op" id="1915526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="1915529">//&nbsp;TODO:&nbsp;Move&nbsp;to&nbsp;parfor.go&nbsp;when&nbsp;parfor.c&nbsp;becomes&nbsp;parfor.go.</span><br>
<span class="lineno"></span><span class="keyword" id="1915589">func</span>&nbsp;<span class="ident" id="1915594">parforalloc</span><span class="op" id="1915605">(</span><span class="ident" id="1915606">nthrmax</span>&nbsp;<span class="builtintype" id="1915614">uint32</span><span class="op" id="1915620">)</span>&nbsp;<span class="op" id="1915622">*</span><span class="ident" id="1915623"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2019896">parfor</a></span>&nbsp;<span class="op" id="1915630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1915633">return</span>&nbsp;<span class="op" id="1915640">&amp;</span><span class="ident" id="1915641"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2019896">parfor</a></span><span class="op" id="1915647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1915651">thr</span><span class="op" id="1915654">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1915660">&amp;</span><span class="builtinfunc" id="1915661">make</span><span class="op" id="1915665">(</span><span class="op" id="1915666">[</span><span class="op" id="1915667">]</span><span class="ident" id="1915668"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2034148">parforthread</a></span><span class="op" id="1915680">,</span>&nbsp;<span class="ident" id="1915682"><a href="/runtime/runtime.go.html#1915606">nthrmax</a></span><span class="op" id="1915689">)</span><span class="op" id="1915690">[</span><span class="num" id="1915691">0</span><span class="op" id="1915692">]</span><span class="op" id="1915693">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1915697">nthrmax</span><span class="op" id="1915704">:</span>&nbsp;<span class="ident" id="1915706"><a href="/runtime/runtime.go.html#1915606">nthrmax</a></span><span class="op" id="1915713">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1915716">}</span><br>
<span class="lineno"></span><span class="op" id="1915718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1915721">var</span>&nbsp;<span class="ident" id="1915725">envs</span>&nbsp;<span class="op" id="1915730">[</span><span class="op" id="1915731">]</span><span class="builtintype" id="1915732">string</span><br>
<span class="lineno"></span><span class="keyword" id="1915739">var</span>&nbsp;<span class="ident" id="1915743">argslice</span>&nbsp;<span class="op" id="1915752">[</span><span class="op" id="1915753">]</span><span class="builtintype" id="1915754">string</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="1915762">//&nbsp;called&nbsp;from&nbsp;syscall</span><br>
<span class="lineno"></span><span class="keyword" id="1915785">func</span>&nbsp;<span class="ident" id="1915790">runtime_envs</span><span class="op" id="1915802">(</span><span class="op" id="1915803">)</span>&nbsp;<span class="op" id="1915805">[</span><span class="op" id="1915806">]</span><span class="builtintype" id="1915807">string</span>&nbsp;<span class="op" id="1915814">{</span>&nbsp;<span class="keyword" id="1915816">return</span>&nbsp;<span class="ident" id="1915823"><a href="/runtime/runtime.go.html#1915725">envs</a></span>&nbsp;<span class="op" id="1915828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1915831">//&nbsp;called&nbsp;from&nbsp;os</span><br>
<span class="lineno">60</span><span class="keyword" id="1915849">func</span>&nbsp;<span class="ident" id="1915854">runtime_args</span><span class="op" id="1915866">(</span><span class="op" id="1915867">)</span>&nbsp;<span class="op" id="1915869">[</span><span class="op" id="1915870">]</span><span class="builtintype" id="1915871">string</span>&nbsp;<span class="op" id="1915878">{</span>&nbsp;<span class="keyword" id="1915880">return</span>&nbsp;<span class="ident" id="1915887"><a href="/runtime/runtime.go.html#1915743">argslice</a></span>&nbsp;<span class="op" id="1915896">}</span>
</div>
</body>
</html>
