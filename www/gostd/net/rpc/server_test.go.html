<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc</h2>
<ul>
<li><a href="/gostd/net/rpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/rpc/debug.go.html">debug.go</a></li>
<li><a href="/gostd/net/rpc/server.go.html">server.go</a></li>
<li><a href="/gostd/net/rpc/server_test.go.html" class="current">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7429927">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7429982">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7430036">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7430087">package</span>&nbsp;<span class="ident" id="7430095">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7430100">import</span>&nbsp;<span class="op" id="7430107">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430110">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430120">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430127">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430133">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430140">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430147">&#34;net/http/httptest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430168">&#34;runtime&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430179">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430190">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430198">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430213">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7430224">&#34;time&#34;</span><br>
<span class="lineno">20</span><span class="op" id="7430231">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7430234">var</span>&nbsp;<span class="op" id="7430238">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7430241">newServer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7430267">*</span><span class="ident" id="7430268">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7430276">serverAddr</span><span class="op" id="7430286">,</span>&nbsp;<span class="ident" id="7430288">newServerAddr</span>&nbsp;<span class="builtintype" id="7430302">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7430310">httpServerAddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7430336">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7430344">once</span><span class="op" id="7430348">,</span>&nbsp;<span class="ident" id="7430350">newOnce</span><span class="op" id="7430357">,</span>&nbsp;<span class="ident" id="7430359">httpOnce</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7430370">sync</span><span class="op" id="7430374">.</span><span class="ident" id="7430375">Once</span><br>
<span class="lineno"></span><span class="op" id="7430380">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7430383">const</span>&nbsp;<span class="op" id="7430389">(</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7430392">newHttpPath</span>&nbsp;<span class="op" id="7430404">=</span>&nbsp;<span class="string" id="7430406">&#34;/foo&#34;</span><br>
<span class="lineno"></span><span class="op" id="7430413">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7430416">type</span>&nbsp;<span class="ident" id="7430421">Args</span>&nbsp;<span class="keyword" id="7430426">struct</span>&nbsp;<span class="op" id="7430433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7430436">A</span><span class="op" id="7430437">,</span>&nbsp;<span class="ident" id="7430439">B</span>&nbsp;<span class="builtintype" id="7430441">int</span><br>
<span class="lineno">35</span><span class="op" id="7430445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7430448">type</span>&nbsp;<span class="ident" id="7430453">Reply</span>&nbsp;<span class="keyword" id="7430459">struct</span>&nbsp;<span class="op" id="7430466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7430469">C</span>&nbsp;<span class="builtintype" id="7430471">int</span><br>
<span class="lineno"></span><span class="op" id="7430475">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="7430478">type</span>&nbsp;<span class="ident" id="7430483">Arith</span>&nbsp;<span class="builtintype" id="7430489">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7430494">//&nbsp;Some&nbsp;of&nbsp;Arith&#39;s&nbsp;methods&nbsp;have&nbsp;value&nbsp;args,&nbsp;some&nbsp;have&nbsp;pointer&nbsp;args.&nbsp;That&#39;s&nbsp;deliberate.</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="7430582">func</span>&nbsp;<span class="op" id="7430587">(</span><span class="ident" id="7430588">t</span>&nbsp;<span class="op" id="7430590">*</span><span class="ident" id="7430591">Arith</span><span class="op" id="7430596">)</span>&nbsp;<span class="ident" id="7430598">Add</span><span class="op" id="7430601">(</span><span class="ident" id="7430602">args</span>&nbsp;<span class="ident" id="7430607">Args</span><span class="op" id="7430611">,</span>&nbsp;<span class="ident" id="7430613">reply</span>&nbsp;<span class="op" id="7430619">*</span><span class="ident" id="7430620">Reply</span><span class="op" id="7430625">)</span>&nbsp;<span class="builtintype" id="7430627">error</span>&nbsp;<span class="op" id="7430633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7430636">reply</span><span class="op" id="7430641">.</span><span class="ident" id="7430642">C</span>&nbsp;<span class="op" id="7430644">=</span>&nbsp;<span class="ident" id="7430646">args</span><span class="op" id="7430650">.</span><span class="ident" id="7430651">A</span>&nbsp;<span class="op" id="7430653">+</span>&nbsp;<span class="ident" id="7430655">args</span><span class="op" id="7430659">.</span><span class="ident" id="7430660">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7430663">return</span>&nbsp;<span class="builtintype" id="7430670">nil</span><br>
<span class="lineno"></span><span class="op" id="7430674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="7430677">func</span>&nbsp;<span class="op" id="7430682">(</span><span class="ident" id="7430683">t</span>&nbsp;<span class="op" id="7430685">*</span><span class="ident" id="7430686">Arith</span><span class="op" id="7430691">)</span>&nbsp;<span class="ident" id="7430693">Mul</span><span class="op" id="7430696">(</span><span class="ident" id="7430697">args</span>&nbsp;<span class="op" id="7430702">*</span><span class="ident" id="7430703">Args</span><span class="op" id="7430707">,</span>&nbsp;<span class="ident" id="7430709">reply</span>&nbsp;<span class="op" id="7430715">*</span><span class="ident" id="7430716">Reply</span><span class="op" id="7430721">)</span>&nbsp;<span class="builtintype" id="7430723">error</span>&nbsp;<span class="op" id="7430729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7430732">reply</span><span class="op" id="7430737">.</span><span class="ident" id="7430738">C</span>&nbsp;<span class="op" id="7430740">=</span>&nbsp;<span class="ident" id="7430742">args</span><span class="op" id="7430746">.</span><span class="ident" id="7430747">A</span>&nbsp;<span class="op" id="7430749">*</span>&nbsp;<span class="ident" id="7430751">args</span><span class="op" id="7430755">.</span><span class="ident" id="7430756">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7430759">return</span>&nbsp;<span class="builtintype" id="7430766">nil</span><br>
<span class="lineno"></span><span class="op" id="7430770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="7430773">func</span>&nbsp;<span class="op" id="7430778">(</span><span class="ident" id="7430779">t</span>&nbsp;<span class="op" id="7430781">*</span><span class="ident" id="7430782">Arith</span><span class="op" id="7430787">)</span>&nbsp;<span class="ident" id="7430789">Div</span><span class="op" id="7430792">(</span><span class="ident" id="7430793">args</span>&nbsp;<span class="ident" id="7430798">Args</span><span class="op" id="7430802">,</span>&nbsp;<span class="ident" id="7430804">reply</span>&nbsp;<span class="op" id="7430810">*</span><span class="ident" id="7430811">Reply</span><span class="op" id="7430816">)</span>&nbsp;<span class="builtintype" id="7430818">error</span>&nbsp;<span class="op" id="7430824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7430827">if</span>&nbsp;<span class="ident" id="7430830">args</span><span class="op" id="7430834">.</span><span class="ident" id="7430835">B</span>&nbsp;<span class="op" id="7430837">==</span>&nbsp;<span class="num" id="7430840">0</span>&nbsp;<span class="op" id="7430842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7430846">return</span>&nbsp;<span class="ident" id="7430853">errors</span><span class="op" id="7430859">.</span><span class="ident" id="7430860">New</span><span class="op" id="7430863">(</span><span class="string" id="7430864">&#34;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="7430880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7430883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7430886">reply</span><span class="op" id="7430891">.</span><span class="ident" id="7430892">C</span>&nbsp;<span class="op" id="7430894">=</span>&nbsp;<span class="ident" id="7430896">args</span><span class="op" id="7430900">.</span><span class="ident" id="7430901">A</span>&nbsp;<span class="op" id="7430903">/</span>&nbsp;<span class="ident" id="7430905">args</span><span class="op" id="7430909">.</span><span class="ident" id="7430910">B</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7430913">return</span>&nbsp;<span class="builtintype" id="7430920">nil</span><br>
<span class="lineno"></span><span class="op" id="7430924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7430927">func</span>&nbsp;<span class="op" id="7430932">(</span><span class="ident" id="7430933">t</span>&nbsp;<span class="op" id="7430935">*</span><span class="ident" id="7430936">Arith</span><span class="op" id="7430941">)</span>&nbsp;<span class="ident" id="7430943">String</span><span class="op" id="7430949">(</span><span class="ident" id="7430950">args</span>&nbsp;<span class="op" id="7430955">*</span><span class="ident" id="7430956">Args</span><span class="op" id="7430960">,</span>&nbsp;<span class="ident" id="7430962">reply</span>&nbsp;<span class="op" id="7430968">*</span><span class="builtintype" id="7430969">string</span><span class="op" id="7430975">)</span>&nbsp;<span class="builtintype" id="7430977">error</span>&nbsp;<span class="op" id="7430983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7430986">*</span><span class="ident" id="7430987">reply</span>&nbsp;<span class="op" id="7430993">=</span>&nbsp;<span class="ident" id="7430995">fmt</span><span class="op" id="7430998">.</span><span class="ident" id="7430999">Sprintf</span><span class="op" id="7431006">(</span><span class="string" id="7431007">&#34;%d+%d=%d&#34;</span><span class="op" id="7431017">,</span>&nbsp;<span class="ident" id="7431019">args</span><span class="op" id="7431023">.</span><span class="ident" id="7431024">A</span><span class="op" id="7431025">,</span>&nbsp;<span class="ident" id="7431027">args</span><span class="op" id="7431031">.</span><span class="ident" id="7431032">B</span><span class="op" id="7431033">,</span>&nbsp;<span class="ident" id="7431035">args</span><span class="op" id="7431039">.</span><span class="ident" id="7431040">A</span><span class="op" id="7431041">+</span><span class="ident" id="7431042">args</span><span class="op" id="7431046">.</span><span class="ident" id="7431047">B</span><span class="op" id="7431048">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7431051">return</span>&nbsp;<span class="builtintype" id="7431058">nil</span><br>
<span class="lineno"></span><span class="op" id="7431062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7431065">func</span>&nbsp;<span class="op" id="7431070">(</span><span class="ident" id="7431071">t</span>&nbsp;<span class="op" id="7431073">*</span><span class="ident" id="7431074">Arith</span><span class="op" id="7431079">)</span>&nbsp;<span class="ident" id="7431081">Scan</span><span class="op" id="7431085">(</span><span class="ident" id="7431086">args</span>&nbsp;<span class="builtintype" id="7431091">string</span><span class="op" id="7431097">,</span>&nbsp;<span class="ident" id="7431099">reply</span>&nbsp;<span class="op" id="7431105">*</span><span class="ident" id="7431106">Reply</span><span class="op" id="7431111">)</span>&nbsp;<span class="op" id="7431113">(</span><span class="ident" id="7431114">err</span>&nbsp;<span class="builtintype" id="7431118">error</span><span class="op" id="7431123">)</span>&nbsp;<span class="op" id="7431125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431128">_</span><span class="op" id="7431129">,</span>&nbsp;<span class="ident" id="7431131">err</span>&nbsp;<span class="op" id="7431135">=</span>&nbsp;<span class="ident" id="7431137">fmt</span><span class="op" id="7431140">.</span><span class="ident" id="7431141">Sscan</span><span class="op" id="7431146">(</span><span class="ident" id="7431147">args</span><span class="op" id="7431151">,</span>&nbsp;<span class="op" id="7431153">&amp;</span><span class="ident" id="7431154">reply</span><span class="op" id="7431159">.</span><span class="ident" id="7431160">C</span><span class="op" id="7431161">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7431164">return</span><br>
<span class="lineno"></span><span class="op" id="7431171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7431174">func</span>&nbsp;<span class="op" id="7431179">(</span><span class="ident" id="7431180">t</span>&nbsp;<span class="op" id="7431182">*</span><span class="ident" id="7431183">Arith</span><span class="op" id="7431188">)</span>&nbsp;<span class="ident" id="7431190">Error</span><span class="op" id="7431195">(</span><span class="ident" id="7431196">args</span>&nbsp;<span class="op" id="7431201">*</span><span class="ident" id="7431202">Args</span><span class="op" id="7431206">,</span>&nbsp;<span class="ident" id="7431208">reply</span>&nbsp;<span class="op" id="7431214">*</span><span class="ident" id="7431215">Reply</span><span class="op" id="7431220">)</span>&nbsp;<span class="builtintype" id="7431222">error</span>&nbsp;<span class="op" id="7431228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7431231">panic</span><span class="op" id="7431236">(</span><span class="string" id="7431237">&#34;ERROR&#34;</span><span class="op" id="7431244">)</span><br>
<span class="lineno">75</span><span class="op" id="7431246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7431249">func</span>&nbsp;<span class="ident" id="7431254">listenTCP</span><span class="op" id="7431263">(</span><span class="op" id="7431264">)</span>&nbsp;<span class="op" id="7431266">(</span><span class="ident" id="7431267">net</span><span class="op" id="7431270">.</span><span class="ident" id="7431271">Listener</span><span class="op" id="7431279">,</span>&nbsp;<span class="builtintype" id="7431281">string</span><span class="op" id="7431287">)</span>&nbsp;<span class="op" id="7431289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431292">l</span><span class="op" id="7431293">,</span>&nbsp;<span class="ident" id="7431295">e</span>&nbsp;<span class="op" id="7431297">:=</span>&nbsp;<span class="ident" id="7431300">net</span><span class="op" id="7431303">.</span><span class="ident" id="7431304">Listen</span><span class="op" id="7431310">(</span><span class="string" id="7431311">&#34;tcp&#34;</span><span class="op" id="7431316">,</span>&nbsp;<span class="string" id="7431318">&#34;127.0.0.1:0&#34;</span><span class="op" id="7431331">)</span>&nbsp;<span class="comment" id="7431333">//&nbsp;any&nbsp;available&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7431359">if</span>&nbsp;<span class="ident" id="7431362">e</span>&nbsp;<span class="op" id="7431364">!=</span>&nbsp;<span class="builtintype" id="7431367">nil</span>&nbsp;<span class="op" id="7431371">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431375">log</span><span class="op" id="7431378">.</span><span class="ident" id="7431379">Fatalf</span><span class="op" id="7431385">(</span><span class="string" id="7431386">&#34;net.Listen&nbsp;tcp&nbsp;:0:&nbsp;%v&#34;</span><span class="op" id="7431409">,</span>&nbsp;<span class="ident" id="7431411">e</span><span class="op" id="7431412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7431415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7431418">return</span>&nbsp;<span class="ident" id="7431425">l</span><span class="op" id="7431426">,</span>&nbsp;<span class="ident" id="7431428">l</span><span class="op" id="7431429">.</span><span class="ident" id="7431430">Addr</span><span class="op" id="7431434">(</span><span class="op" id="7431435">)</span><span class="op" id="7431436">.</span><span class="ident" id="7431437">String</span><span class="op" id="7431443">(</span><span class="op" id="7431444">)</span><br>
<span class="lineno"></span><span class="op" id="7431446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="keyword" id="7431449">func</span>&nbsp;<span class="ident" id="7431454">startServer</span><span class="op" id="7431465">(</span><span class="op" id="7431466">)</span>&nbsp;<span class="op" id="7431468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431471">Register</span><span class="op" id="7431479">(</span><span class="builtinfunc" id="7431480">new</span><span class="op" id="7431483">(</span><span class="ident" id="7431484">Arith</span><span class="op" id="7431489">)</span><span class="op" id="7431490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431493">RegisterName</span><span class="op" id="7431505">(</span><span class="string" id="7431506">&#34;net.rpc.Arith&#34;</span><span class="op" id="7431521">,</span>&nbsp;<span class="builtinfunc" id="7431523">new</span><span class="op" id="7431526">(</span><span class="ident" id="7431527">Arith</span><span class="op" id="7431532">)</span><span class="op" id="7431533">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7431537">var</span>&nbsp;<span class="ident" id="7431541">l</span>&nbsp;<span class="ident" id="7431543">net</span><span class="op" id="7431546">.</span><span class="ident" id="7431547">Listener</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431557">l</span><span class="op" id="7431558">,</span>&nbsp;<span class="ident" id="7431560">serverAddr</span>&nbsp;<span class="op" id="7431571">=</span>&nbsp;<span class="ident" id="7431573">listenTCP</span><span class="op" id="7431582">(</span><span class="op" id="7431583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431586">log</span><span class="op" id="7431589">.</span><span class="ident" id="7431590">Println</span><span class="op" id="7431597">(</span><span class="string" id="7431598">&#34;Test&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="7431628">,</span>&nbsp;<span class="ident" id="7431630">serverAddr</span><span class="op" id="7431640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7431643">go</span>&nbsp;<span class="ident" id="7431646">Accept</span><span class="op" id="7431652">(</span><span class="ident" id="7431653">l</span><span class="op" id="7431654">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431658">HandleHTTP</span><span class="op" id="7431668">(</span><span class="op" id="7431669">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431672">httpOnce</span><span class="op" id="7431680">.</span><span class="ident" id="7431681">Do</span><span class="op" id="7431683">(</span><span class="ident" id="7431684">startHttpServer</span><span class="op" id="7431699">)</span><br>
<span class="lineno"></span><span class="op" id="7431701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7431704">func</span>&nbsp;<span class="ident" id="7431709">startNewServer</span><span class="op" id="7431723">(</span><span class="op" id="7431724">)</span>&nbsp;<span class="op" id="7431726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431729">newServer</span>&nbsp;<span class="op" id="7431739">=</span>&nbsp;<span class="ident" id="7431741">NewServer</span><span class="op" id="7431750">(</span><span class="op" id="7431751">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431754">newServer</span><span class="op" id="7431763">.</span><span class="ident" id="7431764">Register</span><span class="op" id="7431772">(</span><span class="builtinfunc" id="7431773">new</span><span class="op" id="7431776">(</span><span class="ident" id="7431777">Arith</span><span class="op" id="7431782">)</span><span class="op" id="7431783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431786">newServer</span><span class="op" id="7431795">.</span><span class="ident" id="7431796">RegisterName</span><span class="op" id="7431808">(</span><span class="string" id="7431809">&#34;net.rpc.Arith&#34;</span><span class="op" id="7431824">,</span>&nbsp;<span class="builtinfunc" id="7431826">new</span><span class="op" id="7431829">(</span><span class="ident" id="7431830">Arith</span><span class="op" id="7431835">)</span><span class="op" id="7431836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431839">newServer</span><span class="op" id="7431848">.</span><span class="ident" id="7431849">RegisterName</span><span class="op" id="7431861">(</span><span class="string" id="7431862">&#34;newServer.Arith&#34;</span><span class="op" id="7431879">,</span>&nbsp;<span class="builtinfunc" id="7431881">new</span><span class="op" id="7431884">(</span><span class="ident" id="7431885">Arith</span><span class="op" id="7431890">)</span><span class="op" id="7431891">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7431895">var</span>&nbsp;<span class="ident" id="7431899">l</span>&nbsp;<span class="ident" id="7431901">net</span><span class="op" id="7431904">.</span><span class="ident" id="7431905">Listener</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431915">l</span><span class="op" id="7431916">,</span>&nbsp;<span class="ident" id="7431918">newServerAddr</span>&nbsp;<span class="op" id="7431932">=</span>&nbsp;<span class="ident" id="7431934">listenTCP</span><span class="op" id="7431943">(</span><span class="op" id="7431944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7431947">log</span><span class="op" id="7431950">.</span><span class="ident" id="7431951">Println</span><span class="op" id="7431958">(</span><span class="string" id="7431959">&#34;NewServer&nbsp;test&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="7431999">,</span>&nbsp;<span class="ident" id="7432001">newServerAddr</span><span class="op" id="7432014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7432017">go</span>&nbsp;<span class="ident" id="7432020">newServer</span><span class="op" id="7432029">.</span><span class="ident" id="7432030">Accept</span><span class="op" id="7432036">(</span><span class="ident" id="7432037">l</span><span class="op" id="7432038">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432042">newServer</span><span class="op" id="7432051">.</span><span class="ident" id="7432052">HandleHTTP</span><span class="op" id="7432062">(</span><span class="ident" id="7432063">newHttpPath</span><span class="op" id="7432074">,</span>&nbsp;<span class="string" id="7432076">&#34;/bar&#34;</span><span class="op" id="7432082">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432085">httpOnce</span><span class="op" id="7432093">.</span><span class="ident" id="7432094">Do</span><span class="op" id="7432096">(</span><span class="ident" id="7432097">startHttpServer</span><span class="op" id="7432112">)</span><br>
<span class="lineno"></span><span class="op" id="7432114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7432117">func</span>&nbsp;<span class="ident" id="7432122">startHttpServer</span><span class="op" id="7432137">(</span><span class="op" id="7432138">)</span>&nbsp;<span class="op" id="7432140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432143">server</span>&nbsp;<span class="op" id="7432150">:=</span>&nbsp;<span class="ident" id="7432153">httptest</span><span class="op" id="7432161">.</span><span class="ident" id="7432162">NewServer</span><span class="op" id="7432171">(</span><span class="builtintype" id="7432172">nil</span><span class="op" id="7432175">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432178">httpServerAddr</span>&nbsp;<span class="op" id="7432193">=</span>&nbsp;<span class="ident" id="7432195">server</span><span class="op" id="7432201">.</span><span class="ident" id="7432202">Listener</span><span class="op" id="7432210">.</span><span class="ident" id="7432211">Addr</span><span class="op" id="7432215">(</span><span class="op" id="7432216">)</span><span class="op" id="7432217">.</span><span class="ident" id="7432218">String</span><span class="op" id="7432224">(</span><span class="op" id="7432225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432228">log</span><span class="op" id="7432231">.</span><span class="ident" id="7432232">Println</span><span class="op" id="7432239">(</span><span class="string" id="7432240">&#34;Test&nbsp;HTTP&nbsp;RPC&nbsp;server&nbsp;listening&nbsp;on&#34;</span><span class="op" id="7432275">,</span>&nbsp;<span class="ident" id="7432277">httpServerAddr</span><span class="op" id="7432291">)</span><br>
<span class="lineno"></span><span class="op" id="7432293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7432296">func</span>&nbsp;<span class="ident" id="7432301">TestRPC</span><span class="op" id="7432308">(</span><span class="ident" id="7432309">t</span>&nbsp;<span class="op" id="7432311">*</span><span class="ident" id="7432312">testing</span><span class="op" id="7432319">.</span><span class="ident" id="7432320">T</span><span class="op" id="7432321">)</span>&nbsp;<span class="op" id="7432323">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432326">once</span><span class="op" id="7432330">.</span><span class="ident" id="7432331">Do</span><span class="op" id="7432333">(</span><span class="ident" id="7432334">startServer</span><span class="op" id="7432345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432348">testRPC</span><span class="op" id="7432355">(</span><span class="ident" id="7432356">t</span><span class="op" id="7432357">,</span>&nbsp;<span class="ident" id="7432359">serverAddr</span><span class="op" id="7432369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432372">newOnce</span><span class="op" id="7432379">.</span><span class="ident" id="7432380">Do</span><span class="op" id="7432382">(</span><span class="ident" id="7432383">startNewServer</span><span class="op" id="7432397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432400">testRPC</span><span class="op" id="7432407">(</span><span class="ident" id="7432408">t</span><span class="op" id="7432409">,</span>&nbsp;<span class="ident" id="7432411">newServerAddr</span><span class="op" id="7432424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432427">testNewServerRPC</span><span class="op" id="7432443">(</span><span class="ident" id="7432444">t</span><span class="op" id="7432445">,</span>&nbsp;<span class="ident" id="7432447">newServerAddr</span><span class="op" id="7432460">)</span><br>
<span class="lineno">125</span><span class="op" id="7432462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7432465">func</span>&nbsp;<span class="ident" id="7432470">testRPC</span><span class="op" id="7432477">(</span><span class="ident" id="7432478">t</span>&nbsp;<span class="op" id="7432480">*</span><span class="ident" id="7432481">testing</span><span class="op" id="7432488">.</span><span class="ident" id="7432489">T</span><span class="op" id="7432490">,</span>&nbsp;<span class="ident" id="7432492">addr</span>&nbsp;<span class="builtintype" id="7432497">string</span><span class="op" id="7432503">)</span>&nbsp;<span class="op" id="7432505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432508">client</span><span class="op" id="7432514">,</span>&nbsp;<span class="ident" id="7432516">err</span>&nbsp;<span class="op" id="7432520">:=</span>&nbsp;<span class="ident" id="7432523">Dial</span><span class="op" id="7432527">(</span><span class="string" id="7432528">&#34;tcp&#34;</span><span class="op" id="7432533">,</span>&nbsp;<span class="ident" id="7432535">addr</span><span class="op" id="7432539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7432542">if</span>&nbsp;<span class="ident" id="7432545">err</span>&nbsp;<span class="op" id="7432549">!=</span>&nbsp;<span class="builtintype" id="7432552">nil</span>&nbsp;<span class="op" id="7432556">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432560">t</span><span class="op" id="7432561">.</span><span class="ident" id="7432562">Fatal</span><span class="op" id="7432567">(</span><span class="string" id="7432568">&#34;dialing&#34;</span><span class="op" id="7432577">,</span>&nbsp;<span class="ident" id="7432579">err</span><span class="op" id="7432582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7432585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7432588">defer</span>&nbsp;<span class="ident" id="7432594">client</span><span class="op" id="7432600">.</span><span class="ident" id="7432601">Close</span><span class="op" id="7432606">(</span><span class="op" id="7432607">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7432611">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432633">args</span>&nbsp;<span class="op" id="7432638">:=</span>&nbsp;<span class="op" id="7432641">&amp;</span><span class="ident" id="7432642">Args</span><span class="op" id="7432646">{</span><span class="num" id="7432647">7</span><span class="op" id="7432648">,</span>&nbsp;<span class="num" id="7432650">8</span><span class="op" id="7432651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432654">reply</span>&nbsp;<span class="op" id="7432660">:=</span>&nbsp;<span class="builtinfunc" id="7432663">new</span><span class="op" id="7432666">(</span><span class="ident" id="7432667">Reply</span><span class="op" id="7432672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432675">err</span>&nbsp;<span class="op" id="7432679">=</span>&nbsp;<span class="ident" id="7432681">client</span><span class="op" id="7432687">.</span><span class="ident" id="7432688">Call</span><span class="op" id="7432692">(</span><span class="string" id="7432693">&#34;Arith.Add&#34;</span><span class="op" id="7432704">,</span>&nbsp;<span class="ident" id="7432706">args</span><span class="op" id="7432710">,</span>&nbsp;<span class="ident" id="7432712">reply</span><span class="op" id="7432717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7432720">if</span>&nbsp;<span class="ident" id="7432723">err</span>&nbsp;<span class="op" id="7432727">!=</span>&nbsp;<span class="builtintype" id="7432730">nil</span>&nbsp;<span class="op" id="7432734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432738">t</span><span class="op" id="7432739">.</span><span class="ident" id="7432740">Errorf</span><span class="op" id="7432746">(</span><span class="string" id="7432747">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7432789">,</span>&nbsp;<span class="ident" id="7432791">err</span><span class="op" id="7432794">.</span><span class="ident" id="7432795">Error</span><span class="op" id="7432800">(</span><span class="op" id="7432801">)</span><span class="op" id="7432802">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7432805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7432808">if</span>&nbsp;<span class="ident" id="7432811">reply</span><span class="op" id="7432816">.</span><span class="ident" id="7432817">C</span>&nbsp;<span class="op" id="7432819">!=</span>&nbsp;<span class="ident" id="7432822">args</span><span class="op" id="7432826">.</span><span class="ident" id="7432827">A</span><span class="op" id="7432828">+</span><span class="ident" id="7432829">args</span><span class="op" id="7432833">.</span><span class="ident" id="7432834">B</span>&nbsp;<span class="op" id="7432836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432840">t</span><span class="op" id="7432841">.</span><span class="ident" id="7432842">Errorf</span><span class="op" id="7432848">(</span><span class="string" id="7432849">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7432874">,</span>&nbsp;<span class="ident" id="7432876">reply</span><span class="op" id="7432881">.</span><span class="ident" id="7432882">C</span><span class="op" id="7432883">,</span>&nbsp;<span class="ident" id="7432885">args</span><span class="op" id="7432889">.</span><span class="ident" id="7432890">A</span><span class="op" id="7432891">+</span><span class="ident" id="7432892">args</span><span class="op" id="7432896">.</span><span class="ident" id="7432897">B</span><span class="op" id="7432898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7432901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7432905">//&nbsp;Nonexistent&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432928">args</span>&nbsp;<span class="op" id="7432933">=</span>&nbsp;<span class="op" id="7432935">&amp;</span><span class="ident" id="7432936">Args</span><span class="op" id="7432940">{</span><span class="num" id="7432941">7</span><span class="op" id="7432942">,</span>&nbsp;<span class="num" id="7432944">0</span><span class="op" id="7432945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432948">reply</span>&nbsp;<span class="op" id="7432954">=</span>&nbsp;<span class="builtinfunc" id="7432956">new</span><span class="op" id="7432959">(</span><span class="ident" id="7432960">Reply</span><span class="op" id="7432965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7432968">err</span>&nbsp;<span class="op" id="7432972">=</span>&nbsp;<span class="ident" id="7432974">client</span><span class="op" id="7432980">.</span><span class="ident" id="7432981">Call</span><span class="op" id="7432985">(</span><span class="string" id="7432986">&#34;Arith.BadOperation&#34;</span><span class="op" id="7433006">,</span>&nbsp;<span class="ident" id="7433008">args</span><span class="op" id="7433012">,</span>&nbsp;<span class="ident" id="7433014">reply</span><span class="op" id="7433019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7433022">//&nbsp;expect&nbsp;an&nbsp;error</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7433042">if</span>&nbsp;<span class="ident" id="7433045">err</span>&nbsp;<span class="op" id="7433049">==</span>&nbsp;<span class="builtintype" id="7433052">nil</span>&nbsp;<span class="op" id="7433056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433060">t</span><span class="op" id="7433061">.</span><span class="ident" id="7433062">Error</span><span class="op" id="7433067">(</span><span class="string" id="7433068">&#34;BadOperation:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="7433098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7433101">}</span>&nbsp;<span class="keyword" id="7433103">else</span>&nbsp;<span class="keyword" id="7433108">if</span>&nbsp;<span class="op" id="7433111">!</span><span class="ident" id="7433112">strings</span><span class="op" id="7433119">.</span><span class="ident" id="7433120">HasPrefix</span><span class="op" id="7433129">(</span><span class="ident" id="7433130">err</span><span class="op" id="7433133">.</span><span class="ident" id="7433134">Error</span><span class="op" id="7433139">(</span><span class="op" id="7433140">)</span><span class="op" id="7433141">,</span>&nbsp;<span class="string" id="7433143">&#34;rpc:&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;&#34;</span><span class="op" id="7433168">)</span>&nbsp;<span class="op" id="7433170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433174">t</span><span class="op" id="7433175">.</span><span class="ident" id="7433176">Errorf</span><span class="op" id="7433182">(</span><span class="string" id="7433183">&#34;BadOperation:&nbsp;expected&nbsp;can&#39;t&nbsp;find&nbsp;method&nbsp;error;&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7433239">,</span>&nbsp;<span class="ident" id="7433241">err</span><span class="op" id="7433244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7433247">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7433251">//&nbsp;Unknown&nbsp;service</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433271">args</span>&nbsp;<span class="op" id="7433276">=</span>&nbsp;<span class="op" id="7433278">&amp;</span><span class="ident" id="7433279">Args</span><span class="op" id="7433283">{</span><span class="num" id="7433284">7</span><span class="op" id="7433285">,</span>&nbsp;<span class="num" id="7433287">8</span><span class="op" id="7433288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433291">reply</span>&nbsp;<span class="op" id="7433297">=</span>&nbsp;<span class="builtinfunc" id="7433299">new</span><span class="op" id="7433302">(</span><span class="ident" id="7433303">Reply</span><span class="op" id="7433308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433311">err</span>&nbsp;<span class="op" id="7433315">=</span>&nbsp;<span class="ident" id="7433317">client</span><span class="op" id="7433323">.</span><span class="ident" id="7433324">Call</span><span class="op" id="7433328">(</span><span class="string" id="7433329">&#34;Arith.Unknown&#34;</span><span class="op" id="7433344">,</span>&nbsp;<span class="ident" id="7433346">args</span><span class="op" id="7433350">,</span>&nbsp;<span class="ident" id="7433352">reply</span><span class="op" id="7433357">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7433360">if</span>&nbsp;<span class="ident" id="7433363">err</span>&nbsp;<span class="op" id="7433367">==</span>&nbsp;<span class="builtintype" id="7433370">nil</span>&nbsp;<span class="op" id="7433374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433378">t</span><span class="op" id="7433379">.</span><span class="ident" id="7433380">Error</span><span class="op" id="7433385">(</span><span class="string" id="7433386">&#34;expected&nbsp;error&nbsp;calling&nbsp;unknown&nbsp;service&#34;</span><span class="op" id="7433426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7433429">}</span>&nbsp;<span class="keyword" id="7433431">else</span>&nbsp;<span class="keyword" id="7433436">if</span>&nbsp;<span class="ident" id="7433439">strings</span><span class="op" id="7433446">.</span><span class="ident" id="7433447">Index</span><span class="op" id="7433452">(</span><span class="ident" id="7433453">err</span><span class="op" id="7433456">.</span><span class="ident" id="7433457">Error</span><span class="op" id="7433462">(</span><span class="op" id="7433463">)</span><span class="op" id="7433464">,</span>&nbsp;<span class="string" id="7433466">&#34;method&#34;</span><span class="op" id="7433474">)</span>&nbsp;<span class="op" id="7433476">&lt;</span>&nbsp;<span class="num" id="7433478">0</span>&nbsp;<span class="op" id="7433480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433484">t</span><span class="op" id="7433485">.</span><span class="ident" id="7433486">Error</span><span class="op" id="7433491">(</span><span class="string" id="7433492">&#34;expected&nbsp;error&nbsp;about&nbsp;method;&nbsp;got&#34;</span><span class="op" id="7433526">,</span>&nbsp;<span class="ident" id="7433528">err</span><span class="op" id="7433531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7433534">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7433538">//&nbsp;Out&nbsp;of&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433556">args</span>&nbsp;<span class="op" id="7433561">=</span>&nbsp;<span class="op" id="7433563">&amp;</span><span class="ident" id="7433564">Args</span><span class="op" id="7433568">{</span><span class="num" id="7433569">7</span><span class="op" id="7433570">,</span>&nbsp;<span class="num" id="7433572">8</span><span class="op" id="7433573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433576">mulReply</span>&nbsp;<span class="op" id="7433585">:=</span>&nbsp;<span class="builtinfunc" id="7433588">new</span><span class="op" id="7433591">(</span><span class="ident" id="7433592">Reply</span><span class="op" id="7433597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433600">mulCall</span>&nbsp;<span class="op" id="7433608">:=</span>&nbsp;<span class="ident" id="7433611">client</span><span class="op" id="7433617">.</span><span class="ident" id="7433618">Go</span><span class="op" id="7433620">(</span><span class="string" id="7433621">&#34;Arith.Mul&#34;</span><span class="op" id="7433632">,</span>&nbsp;<span class="ident" id="7433634">args</span><span class="op" id="7433638">,</span>&nbsp;<span class="ident" id="7433640">mulReply</span><span class="op" id="7433648">,</span>&nbsp;<span class="builtintype" id="7433650">nil</span><span class="op" id="7433653">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433656">addReply</span>&nbsp;<span class="op" id="7433665">:=</span>&nbsp;<span class="builtinfunc" id="7433668">new</span><span class="op" id="7433671">(</span><span class="ident" id="7433672">Reply</span><span class="op" id="7433677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433680">addCall</span>&nbsp;<span class="op" id="7433688">:=</span>&nbsp;<span class="ident" id="7433691">client</span><span class="op" id="7433697">.</span><span class="ident" id="7433698">Go</span><span class="op" id="7433700">(</span><span class="string" id="7433701">&#34;Arith.Add&#34;</span><span class="op" id="7433712">,</span>&nbsp;<span class="ident" id="7433714">args</span><span class="op" id="7433718">,</span>&nbsp;<span class="ident" id="7433720">addReply</span><span class="op" id="7433728">,</span>&nbsp;<span class="builtintype" id="7433730">nil</span><span class="op" id="7433733">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433737">addCall</span>&nbsp;<span class="op" id="7433745">=</span>&nbsp;<span class="op" id="7433747">&lt;-</span><span class="ident" id="7433749">addCall</span><span class="op" id="7433756">.</span><span class="ident" id="7433757">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7433763">if</span>&nbsp;<span class="ident" id="7433766">addCall</span><span class="op" id="7433773">.</span><span class="ident" id="7433774">Error</span>&nbsp;<span class="op" id="7433780">!=</span>&nbsp;<span class="builtintype" id="7433783">nil</span>&nbsp;<span class="op" id="7433787">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433791">t</span><span class="op" id="7433792">.</span><span class="ident" id="7433793">Errorf</span><span class="op" id="7433799">(</span><span class="string" id="7433800">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7433842">,</span>&nbsp;<span class="ident" id="7433844">addCall</span><span class="op" id="7433851">.</span><span class="ident" id="7433852">Error</span><span class="op" id="7433857">.</span><span class="ident" id="7433858">Error</span><span class="op" id="7433863">(</span><span class="op" id="7433864">)</span><span class="op" id="7433865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7433868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7433871">if</span>&nbsp;<span class="ident" id="7433874">addReply</span><span class="op" id="7433882">.</span><span class="ident" id="7433883">C</span>&nbsp;<span class="op" id="7433885">!=</span>&nbsp;<span class="ident" id="7433888">args</span><span class="op" id="7433892">.</span><span class="ident" id="7433893">A</span><span class="op" id="7433894">+</span><span class="ident" id="7433895">args</span><span class="op" id="7433899">.</span><span class="ident" id="7433900">B</span>&nbsp;<span class="op" id="7433902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433906">t</span><span class="op" id="7433907">.</span><span class="ident" id="7433908">Errorf</span><span class="op" id="7433914">(</span><span class="string" id="7433915">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7433940">,</span>&nbsp;<span class="ident" id="7433942">addReply</span><span class="op" id="7433950">.</span><span class="ident" id="7433951">C</span><span class="op" id="7433952">,</span>&nbsp;<span class="ident" id="7433954">args</span><span class="op" id="7433958">.</span><span class="ident" id="7433959">A</span><span class="op" id="7433960">+</span><span class="ident" id="7433961">args</span><span class="op" id="7433965">.</span><span class="ident" id="7433966">B</span><span class="op" id="7433967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7433970">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7433974">mulCall</span>&nbsp;<span class="op" id="7433982">=</span>&nbsp;<span class="op" id="7433984">&lt;-</span><span class="ident" id="7433986">mulCall</span><span class="op" id="7433993">.</span><span class="ident" id="7433994">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7434000">if</span>&nbsp;<span class="ident" id="7434003">mulCall</span><span class="op" id="7434010">.</span><span class="ident" id="7434011">Error</span>&nbsp;<span class="op" id="7434017">!=</span>&nbsp;<span class="builtintype" id="7434020">nil</span>&nbsp;<span class="op" id="7434024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434028">t</span><span class="op" id="7434029">.</span><span class="ident" id="7434030">Errorf</span><span class="op" id="7434036">(</span><span class="string" id="7434037">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7434079">,</span>&nbsp;<span class="ident" id="7434081">mulCall</span><span class="op" id="7434088">.</span><span class="ident" id="7434089">Error</span><span class="op" id="7434094">.</span><span class="ident" id="7434095">Error</span><span class="op" id="7434100">(</span><span class="op" id="7434101">)</span><span class="op" id="7434102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7434105">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7434108">if</span>&nbsp;<span class="ident" id="7434111">mulReply</span><span class="op" id="7434119">.</span><span class="ident" id="7434120">C</span>&nbsp;<span class="op" id="7434122">!=</span>&nbsp;<span class="ident" id="7434125">args</span><span class="op" id="7434129">.</span><span class="ident" id="7434130">A</span><span class="op" id="7434131">*</span><span class="ident" id="7434132">args</span><span class="op" id="7434136">.</span><span class="ident" id="7434137">B</span>&nbsp;<span class="op" id="7434139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434143">t</span><span class="op" id="7434144">.</span><span class="ident" id="7434145">Errorf</span><span class="op" id="7434151">(</span><span class="string" id="7434152">&#34;Mul:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7434177">,</span>&nbsp;<span class="ident" id="7434179">mulReply</span><span class="op" id="7434187">.</span><span class="ident" id="7434188">C</span><span class="op" id="7434189">,</span>&nbsp;<span class="ident" id="7434191">args</span><span class="op" id="7434195">.</span><span class="ident" id="7434196">A</span><span class="op" id="7434197">*</span><span class="ident" id="7434198">args</span><span class="op" id="7434202">.</span><span class="ident" id="7434203">B</span><span class="op" id="7434204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7434207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7434211">//&nbsp;Error&nbsp;test</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434226">args</span>&nbsp;<span class="op" id="7434231">=</span>&nbsp;<span class="op" id="7434233">&amp;</span><span class="ident" id="7434234">Args</span><span class="op" id="7434238">{</span><span class="num" id="7434239">7</span><span class="op" id="7434240">,</span>&nbsp;<span class="num" id="7434242">0</span><span class="op" id="7434243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434246">reply</span>&nbsp;<span class="op" id="7434252">=</span>&nbsp;<span class="builtinfunc" id="7434254">new</span><span class="op" id="7434257">(</span><span class="ident" id="7434258">Reply</span><span class="op" id="7434263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434266">err</span>&nbsp;<span class="op" id="7434270">=</span>&nbsp;<span class="ident" id="7434272">client</span><span class="op" id="7434278">.</span><span class="ident" id="7434279">Call</span><span class="op" id="7434283">(</span><span class="string" id="7434284">&#34;Arith.Div&#34;</span><span class="op" id="7434295">,</span>&nbsp;<span class="ident" id="7434297">args</span><span class="op" id="7434301">,</span>&nbsp;<span class="ident" id="7434303">reply</span><span class="op" id="7434308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7434311">//&nbsp;expect&nbsp;an&nbsp;error:&nbsp;zero&nbsp;divide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7434344">if</span>&nbsp;<span class="ident" id="7434347">err</span>&nbsp;<span class="op" id="7434351">==</span>&nbsp;<span class="builtintype" id="7434354">nil</span>&nbsp;<span class="op" id="7434358">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434362">t</span><span class="op" id="7434363">.</span><span class="ident" id="7434364">Error</span><span class="op" id="7434369">(</span><span class="string" id="7434370">&#34;Div:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="7434391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7434394">}</span>&nbsp;<span class="keyword" id="7434396">else</span>&nbsp;<span class="keyword" id="7434401">if</span>&nbsp;<span class="ident" id="7434404">err</span><span class="op" id="7434407">.</span><span class="ident" id="7434408">Error</span><span class="op" id="7434413">(</span><span class="op" id="7434414">)</span>&nbsp;<span class="op" id="7434416">!=</span>&nbsp;<span class="string" id="7434419">&#34;divide&nbsp;by&nbsp;zero&#34;</span>&nbsp;<span class="op" id="7434436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434440">t</span><span class="op" id="7434441">.</span><span class="ident" id="7434442">Error</span><span class="op" id="7434447">(</span><span class="string" id="7434448">&#34;Div:&nbsp;expected&nbsp;divide&nbsp;by&nbsp;zero&nbsp;error;&nbsp;got&#34;</span><span class="op" id="7434489">,</span>&nbsp;<span class="ident" id="7434491">err</span><span class="op" id="7434494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7434497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7434501">//&nbsp;Bad&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434515">reply</span>&nbsp;<span class="op" id="7434521">=</span>&nbsp;<span class="builtinfunc" id="7434523">new</span><span class="op" id="7434526">(</span><span class="ident" id="7434527">Reply</span><span class="op" id="7434532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434535">err</span>&nbsp;<span class="op" id="7434539">=</span>&nbsp;<span class="ident" id="7434541">client</span><span class="op" id="7434547">.</span><span class="ident" id="7434548">Call</span><span class="op" id="7434552">(</span><span class="string" id="7434553">&#34;Arith.Add&#34;</span><span class="op" id="7434564">,</span>&nbsp;<span class="ident" id="7434566">reply</span><span class="op" id="7434571">,</span>&nbsp;<span class="ident" id="7434573">reply</span><span class="op" id="7434578">)</span>&nbsp;<span class="comment" id="7434580">//&nbsp;args,&nbsp;reply&nbsp;would&nbsp;be&nbsp;the&nbsp;correct&nbsp;thing&nbsp;to&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7434630">if</span>&nbsp;<span class="ident" id="7434633">err</span>&nbsp;<span class="op" id="7434637">==</span>&nbsp;<span class="builtintype" id="7434640">nil</span>&nbsp;<span class="op" id="7434644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434648">t</span><span class="op" id="7434649">.</span><span class="ident" id="7434650">Error</span><span class="op" id="7434655">(</span><span class="string" id="7434656">&#34;expected&nbsp;error&nbsp;calling&nbsp;Arith.Add&nbsp;with&nbsp;wrong&nbsp;arg&nbsp;type&#34;</span><span class="op" id="7434710">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7434713">}</span>&nbsp;<span class="keyword" id="7434715">else</span>&nbsp;<span class="keyword" id="7434720">if</span>&nbsp;<span class="ident" id="7434723">strings</span><span class="op" id="7434730">.</span><span class="ident" id="7434731">Index</span><span class="op" id="7434736">(</span><span class="ident" id="7434737">err</span><span class="op" id="7434740">.</span><span class="ident" id="7434741">Error</span><span class="op" id="7434746">(</span><span class="op" id="7434747">)</span><span class="op" id="7434748">,</span>&nbsp;<span class="string" id="7434750">&#34;type&#34;</span><span class="op" id="7434756">)</span>&nbsp;<span class="op" id="7434758">&lt;</span>&nbsp;<span class="num" id="7434760">0</span>&nbsp;<span class="op" id="7434762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434766">t</span><span class="op" id="7434767">.</span><span class="ident" id="7434768">Error</span><span class="op" id="7434773">(</span><span class="string" id="7434774">&#34;expected&nbsp;error&nbsp;about&nbsp;type;&nbsp;got&#34;</span><span class="op" id="7434806">,</span>&nbsp;<span class="ident" id="7434808">err</span><span class="op" id="7434811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7434814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7434818">//&nbsp;Non-struct&nbsp;argument</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7434842">const</span>&nbsp;<span class="ident" id="7434848">Val</span>&nbsp;<span class="op" id="7434852">=</span>&nbsp;<span class="num" id="7434854">12345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434861">str</span>&nbsp;<span class="op" id="7434865">:=</span>&nbsp;<span class="ident" id="7434868">fmt</span><span class="op" id="7434871">.</span><span class="ident" id="7434872">Sprint</span><span class="op" id="7434878">(</span><span class="ident" id="7434879">Val</span><span class="op" id="7434882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434885">reply</span>&nbsp;<span class="op" id="7434891">=</span>&nbsp;<span class="builtinfunc" id="7434893">new</span><span class="op" id="7434896">(</span><span class="ident" id="7434897">Reply</span><span class="op" id="7434902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434905">err</span>&nbsp;<span class="op" id="7434909">=</span>&nbsp;<span class="ident" id="7434911">client</span><span class="op" id="7434917">.</span><span class="ident" id="7434918">Call</span><span class="op" id="7434922">(</span><span class="string" id="7434923">&#34;Arith.Scan&#34;</span><span class="op" id="7434935">,</span>&nbsp;<span class="op" id="7434937">&amp;</span><span class="ident" id="7434938">str</span><span class="op" id="7434941">,</span>&nbsp;<span class="ident" id="7434943">reply</span><span class="op" id="7434948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7434951">if</span>&nbsp;<span class="ident" id="7434954">err</span>&nbsp;<span class="op" id="7434958">!=</span>&nbsp;<span class="builtintype" id="7434961">nil</span>&nbsp;<span class="op" id="7434965">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7434969">t</span><span class="op" id="7434970">.</span><span class="ident" id="7434971">Errorf</span><span class="op" id="7434977">(</span><span class="string" id="7434978">&#34;Scan:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7435021">,</span>&nbsp;<span class="ident" id="7435023">err</span><span class="op" id="7435026">.</span><span class="ident" id="7435027">Error</span><span class="op" id="7435032">(</span><span class="op" id="7435033">)</span><span class="op" id="7435034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7435037">}</span>&nbsp;<span class="keyword" id="7435039">else</span>&nbsp;<span class="keyword" id="7435044">if</span>&nbsp;<span class="ident" id="7435047">reply</span><span class="op" id="7435052">.</span><span class="ident" id="7435053">C</span>&nbsp;<span class="op" id="7435055">!=</span>&nbsp;<span class="ident" id="7435058">Val</span>&nbsp;<span class="op" id="7435062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7435066">t</span><span class="op" id="7435067">.</span><span class="ident" id="7435068">Errorf</span><span class="op" id="7435074">(</span><span class="string" id="7435075">&#34;Scan:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7435101">,</span>&nbsp;<span class="ident" id="7435103">Val</span><span class="op" id="7435106">,</span>&nbsp;<span class="ident" id="7435108">reply</span><span class="op" id="7435113">.</span><span class="ident" id="7435114">C</span><span class="op" id="7435115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7435118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7435122">//&nbsp;Non-struct&nbsp;reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7435143">args</span>&nbsp;<span class="op" id="7435148">=</span>&nbsp;<span class="op" id="7435150">&amp;</span><span class="ident" id="7435151">Args</span><span class="op" id="7435155">{</span><span class="num" id="7435156">27</span><span class="op" id="7435158">,</span>&nbsp;<span class="num" id="7435160">35</span><span class="op" id="7435162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7435165">str</span>&nbsp;<span class="op" id="7435169">=</span>&nbsp;<span class="string" id="7435171">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7435175">err</span>&nbsp;<span class="op" id="7435179">=</span>&nbsp;<span class="ident" id="7435181">client</span><span class="op" id="7435187">.</span><span class="ident" id="7435188">Call</span><span class="op" id="7435192">(</span><span class="string" id="7435193">&#34;Arith.String&#34;</span><span class="op" id="7435207">,</span>&nbsp;<span class="ident" id="7435209">args</span><span class="op" id="7435213">,</span>&nbsp;<span class="op" id="7435215">&amp;</span><span class="ident" id="7435216">str</span><span class="op" id="7435219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7435222">if</span>&nbsp;<span class="ident" id="7435225">err</span>&nbsp;<span class="op" id="7435229">!=</span>&nbsp;<span class="builtintype" id="7435232">nil</span>&nbsp;<span class="op" id="7435236">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7435240">t</span><span class="op" id="7435241">.</span><span class="ident" id="7435242">Errorf</span><span class="op" id="7435248">(</span><span class="string" id="7435249">&#34;String:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7435294">,</span>&nbsp;<span class="ident" id="7435296">err</span><span class="op" id="7435299">.</span><span class="ident" id="7435300">Error</span><span class="op" id="7435305">(</span><span class="op" id="7435306">)</span><span class="op" id="7435307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7435310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7435313">expect</span>&nbsp;<span class="op" id="7435320">:=</span>&nbsp;<span class="ident" id="7435323">fmt</span><span class="op" id="7435326">.</span><span class="ident" id="7435327">Sprintf</span><span class="op" id="7435334">(</span><span class="string" id="7435335">&#34;%d+%d=%d&#34;</span><span class="op" id="7435345">,</span>&nbsp;<span class="ident" id="7435347">args</span><span class="op" id="7435351">.</span><span class="ident" id="7435352">A</span><span class="op" id="7435353">,</span>&nbsp;<span class="ident" id="7435355">args</span><span class="op" id="7435359">.</span><span class="ident" id="7435360">B</span><span class="op" id="7435361">,</span>&nbsp;<span class="ident" id="7435363">args</span><span class="op" id="7435367">.</span><span class="ident" id="7435368">A</span><span class="op" id="7435369">+</span><span class="ident" id="7435370">args</span><span class="op" id="7435374">.</span><span class="ident" id="7435375">B</span><span class="op" id="7435376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7435379">if</span>&nbsp;<span class="ident" id="7435382">str</span>&nbsp;<span class="op" id="7435386">!=</span>&nbsp;<span class="ident" id="7435389">expect</span>&nbsp;<span class="op" id="7435396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7435400">t</span><span class="op" id="7435401">.</span><span class="ident" id="7435402">Errorf</span><span class="op" id="7435408">(</span><span class="string" id="7435409">&#34;String:&nbsp;expected&nbsp;%s&nbsp;got&nbsp;%s&#34;</span><span class="op" id="7435437">,</span>&nbsp;<span class="ident" id="7435439">expect</span><span class="op" id="7435445">,</span>&nbsp;<span class="ident" id="7435447">str</span><span class="op" id="7435450">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7435453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7435457">args</span>&nbsp;<span class="op" id="7435462">=</span>&nbsp;<span class="op" id="7435464">&amp;</span><span class="ident" id="7435465">Args</span><span class="op" id="7435469">{</span><span class="num" id="7435470">7</span><span class="op" id="7435471">,</span>&nbsp;<span class="num" id="7435473">8</span><span class="op" id="7435474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7435477">reply</span>&nbsp;<span class="op" id="7435483">=</span>&nbsp;<span class="builtinfunc" id="7435485">new</span><span class="op" id="7435488">(</span><span class="ident" id="7435489">Reply</span><span class="op" id="7435494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7435497">err</span>&nbsp;<span class="op" id="7435501">=</span>&nbsp;<span class="ident" id="7435503">client</span><span class="op" id="7435509">.</span><span class="ident" id="7435510">Call</span><span class="op" id="7435514">(</span><span class="string" id="7435515">&#34;Arith.Mul&#34;</span><span class="op" id="7435526">,</span>&nbsp;<span class="ident" id="7435528">args</span><span class="op" id="7435532">,</span>&nbsp;<span class="ident" id="7435534">reply</span><span class="op" id="7435539">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7435542">if</span>&nbsp;<span class="ident" id="7435545">err</span>&nbsp;<span class="op" id="7435549">!=</span>&nbsp;<span class="builtintype" id="7435552">nil</span>&nbsp;<span class="op" id="7435556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7435560">t</span><span class="op" id="7435561">.</span><span class="ident" id="7435562">Errorf</span><span class="op" id="7435568">(</span><span class="string" id="7435569">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7435611">,</span>&nbsp;<span class="ident" id="7435613">err</span><span class="op" id="7435616">.</span><span class="ident" id="7435617">Error</span><span class="op" id="7435622">(</span><span class="op" id="7435623">)</span><span class="op" id="7435624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7435627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7435630">if</span>&nbsp;<span class="ident" id="7435633">reply</span><span class="op" id="7435638">.</span><span class="ident" id="7435639">C</span>&nbsp;<span class="op" id="7435641">!=</span>&nbsp;<span class="ident" id="7435644">args</span><span class="op" id="7435648">.</span><span class="ident" id="7435649">A</span><span class="op" id="7435650">*</span><span class="ident" id="7435651">args</span><span class="op" id="7435655">.</span><span class="ident" id="7435656">B</span>&nbsp;<span class="op" id="7435658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7435662">t</span><span class="op" id="7435663">.</span><span class="ident" id="7435664">Errorf</span><span class="op" id="7435670">(</span><span class="string" id="7435671">&#34;Mul:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7435696">,</span>&nbsp;<span class="ident" id="7435698">reply</span><span class="op" id="7435703">.</span><span class="ident" id="7435704">C</span><span class="op" id="7435705">,</span>&nbsp;<span class="ident" id="7435707">args</span><span class="op" id="7435711">.</span><span class="ident" id="7435712">A</span><span class="op" id="7435713">*</span><span class="ident" id="7435714">args</span><span class="op" id="7435718">.</span><span class="ident" id="7435719">B</span><span class="op" id="7435720">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7435723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7435727">//&nbsp;ServiceName&nbsp;contain&nbsp;&#34;.&#34;&nbsp;character</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7435765">args</span>&nbsp;<span class="op" id="7435770">=</span>&nbsp;<span class="op" id="7435772">&amp;</span><span class="ident" id="7435773">Args</span><span class="op" id="7435777">{</span><span class="num" id="7435778">7</span><span class="op" id="7435779">,</span>&nbsp;<span class="num" id="7435781">8</span><span class="op" id="7435782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7435785">reply</span>&nbsp;<span class="op" id="7435791">=</span>&nbsp;<span class="builtinfunc" id="7435793">new</span><span class="op" id="7435796">(</span><span class="ident" id="7435797">Reply</span><span class="op" id="7435802">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7435805">err</span>&nbsp;<span class="op" id="7435809">=</span>&nbsp;<span class="ident" id="7435811">client</span><span class="op" id="7435817">.</span><span class="ident" id="7435818">Call</span><span class="op" id="7435822">(</span><span class="string" id="7435823">&#34;net.rpc.Arith.Add&#34;</span><span class="op" id="7435842">,</span>&nbsp;<span class="ident" id="7435844">args</span><span class="op" id="7435848">,</span>&nbsp;<span class="ident" id="7435850">reply</span><span class="op" id="7435855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7435858">if</span>&nbsp;<span class="ident" id="7435861">err</span>&nbsp;<span class="op" id="7435865">!=</span>&nbsp;<span class="builtintype" id="7435868">nil</span>&nbsp;<span class="op" id="7435872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7435876">t</span><span class="op" id="7435877">.</span><span class="ident" id="7435878">Errorf</span><span class="op" id="7435884">(</span><span class="string" id="7435885">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7435927">,</span>&nbsp;<span class="ident" id="7435929">err</span><span class="op" id="7435932">.</span><span class="ident" id="7435933">Error</span><span class="op" id="7435938">(</span><span class="op" id="7435939">)</span><span class="op" id="7435940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7435943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7435946">if</span>&nbsp;<span class="ident" id="7435949">reply</span><span class="op" id="7435954">.</span><span class="ident" id="7435955">C</span>&nbsp;<span class="op" id="7435957">!=</span>&nbsp;<span class="ident" id="7435960">args</span><span class="op" id="7435964">.</span><span class="ident" id="7435965">A</span><span class="op" id="7435966">+</span><span class="ident" id="7435967">args</span><span class="op" id="7435971">.</span><span class="ident" id="7435972">B</span>&nbsp;<span class="op" id="7435974">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7435978">t</span><span class="op" id="7435979">.</span><span class="ident" id="7435980">Errorf</span><span class="op" id="7435986">(</span><span class="string" id="7435987">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7436012">,</span>&nbsp;<span class="ident" id="7436014">reply</span><span class="op" id="7436019">.</span><span class="ident" id="7436020">C</span><span class="op" id="7436021">,</span>&nbsp;<span class="ident" id="7436023">args</span><span class="op" id="7436027">.</span><span class="ident" id="7436028">A</span><span class="op" id="7436029">+</span><span class="ident" id="7436030">args</span><span class="op" id="7436034">.</span><span class="ident" id="7436035">B</span><span class="op" id="7436036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7436039">}</span><br>
<span class="lineno"></span><span class="op" id="7436041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7436044">func</span>&nbsp;<span class="ident" id="7436049">testNewServerRPC</span><span class="op" id="7436065">(</span><span class="ident" id="7436066">t</span>&nbsp;<span class="op" id="7436068">*</span><span class="ident" id="7436069">testing</span><span class="op" id="7436076">.</span><span class="ident" id="7436077">T</span><span class="op" id="7436078">,</span>&nbsp;<span class="ident" id="7436080">addr</span>&nbsp;<span class="builtintype" id="7436085">string</span><span class="op" id="7436091">)</span>&nbsp;<span class="op" id="7436093">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7436096">client</span><span class="op" id="7436102">,</span>&nbsp;<span class="ident" id="7436104">err</span>&nbsp;<span class="op" id="7436108">:=</span>&nbsp;<span class="ident" id="7436111">Dial</span><span class="op" id="7436115">(</span><span class="string" id="7436116">&#34;tcp&#34;</span><span class="op" id="7436121">,</span>&nbsp;<span class="ident" id="7436123">addr</span><span class="op" id="7436127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7436130">if</span>&nbsp;<span class="ident" id="7436133">err</span>&nbsp;<span class="op" id="7436137">!=</span>&nbsp;<span class="builtintype" id="7436140">nil</span>&nbsp;<span class="op" id="7436144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7436148">t</span><span class="op" id="7436149">.</span><span class="ident" id="7436150">Fatal</span><span class="op" id="7436155">(</span><span class="string" id="7436156">&#34;dialing&#34;</span><span class="op" id="7436165">,</span>&nbsp;<span class="ident" id="7436167">err</span><span class="op" id="7436170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7436173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7436176">defer</span>&nbsp;<span class="ident" id="7436182">client</span><span class="op" id="7436188">.</span><span class="ident" id="7436189">Close</span><span class="op" id="7436194">(</span><span class="op" id="7436195">)</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7436199">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7436221">args</span>&nbsp;<span class="op" id="7436226">:=</span>&nbsp;<span class="op" id="7436229">&amp;</span><span class="ident" id="7436230">Args</span><span class="op" id="7436234">{</span><span class="num" id="7436235">7</span><span class="op" id="7436236">,</span>&nbsp;<span class="num" id="7436238">8</span><span class="op" id="7436239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7436242">reply</span>&nbsp;<span class="op" id="7436248">:=</span>&nbsp;<span class="builtinfunc" id="7436251">new</span><span class="op" id="7436254">(</span><span class="ident" id="7436255">Reply</span><span class="op" id="7436260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7436263">err</span>&nbsp;<span class="op" id="7436267">=</span>&nbsp;<span class="ident" id="7436269">client</span><span class="op" id="7436275">.</span><span class="ident" id="7436276">Call</span><span class="op" id="7436280">(</span><span class="string" id="7436281">&#34;newServer.Arith.Add&#34;</span><span class="op" id="7436302">,</span>&nbsp;<span class="ident" id="7436304">args</span><span class="op" id="7436308">,</span>&nbsp;<span class="ident" id="7436310">reply</span><span class="op" id="7436315">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7436318">if</span>&nbsp;<span class="ident" id="7436321">err</span>&nbsp;<span class="op" id="7436325">!=</span>&nbsp;<span class="builtintype" id="7436328">nil</span>&nbsp;<span class="op" id="7436332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7436336">t</span><span class="op" id="7436337">.</span><span class="ident" id="7436338">Errorf</span><span class="op" id="7436344">(</span><span class="string" id="7436345">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7436387">,</span>&nbsp;<span class="ident" id="7436389">err</span><span class="op" id="7436392">.</span><span class="ident" id="7436393">Error</span><span class="op" id="7436398">(</span><span class="op" id="7436399">)</span><span class="op" id="7436400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7436403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7436406">if</span>&nbsp;<span class="ident" id="7436409">reply</span><span class="op" id="7436414">.</span><span class="ident" id="7436415">C</span>&nbsp;<span class="op" id="7436417">!=</span>&nbsp;<span class="ident" id="7436420">args</span><span class="op" id="7436424">.</span><span class="ident" id="7436425">A</span><span class="op" id="7436426">+</span><span class="ident" id="7436427">args</span><span class="op" id="7436431">.</span><span class="ident" id="7436432">B</span>&nbsp;<span class="op" id="7436434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7436438">t</span><span class="op" id="7436439">.</span><span class="ident" id="7436440">Errorf</span><span class="op" id="7436446">(</span><span class="string" id="7436447">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7436472">,</span>&nbsp;<span class="ident" id="7436474">reply</span><span class="op" id="7436479">.</span><span class="ident" id="7436480">C</span><span class="op" id="7436481">,</span>&nbsp;<span class="ident" id="7436483">args</span><span class="op" id="7436487">.</span><span class="ident" id="7436488">A</span><span class="op" id="7436489">+</span><span class="ident" id="7436490">args</span><span class="op" id="7436494">.</span><span class="ident" id="7436495">B</span><span class="op" id="7436496">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7436499">}</span><br>
<span class="lineno"></span><span class="op" id="7436501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7436504">func</span>&nbsp;<span class="ident" id="7436509">TestHTTP</span><span class="op" id="7436517">(</span><span class="ident" id="7436518">t</span>&nbsp;<span class="op" id="7436520">*</span><span class="ident" id="7436521">testing</span><span class="op" id="7436528">.</span><span class="ident" id="7436529">T</span><span class="op" id="7436530">)</span>&nbsp;<span class="op" id="7436532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7436535">once</span><span class="op" id="7436539">.</span><span class="ident" id="7436540">Do</span><span class="op" id="7436542">(</span><span class="ident" id="7436543">startServer</span><span class="op" id="7436554">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7436557">testHTTPRPC</span><span class="op" id="7436568">(</span><span class="ident" id="7436569">t</span><span class="op" id="7436570">,</span>&nbsp;<span class="string" id="7436572">&#34;&#34;</span><span class="op" id="7436574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7436577">newOnce</span><span class="op" id="7436584">.</span><span class="ident" id="7436585">Do</span><span class="op" id="7436587">(</span><span class="ident" id="7436588">startNewServer</span><span class="op" id="7436602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7436605">testHTTPRPC</span><span class="op" id="7436616">(</span><span class="ident" id="7436617">t</span><span class="op" id="7436618">,</span>&nbsp;<span class="ident" id="7436620">newHttpPath</span><span class="op" id="7436631">)</span><br>
<span class="lineno"></span><span class="op" id="7436633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span><span class="keyword" id="7436636">func</span>&nbsp;<span class="ident" id="7436641">testHTTPRPC</span><span class="op" id="7436652">(</span><span class="ident" id="7436653">t</span>&nbsp;<span class="op" id="7436655">*</span><span class="ident" id="7436656">testing</span><span class="op" id="7436663">.</span><span class="ident" id="7436664">T</span><span class="op" id="7436665">,</span>&nbsp;<span class="ident" id="7436667">path</span>&nbsp;<span class="builtintype" id="7436672">string</span><span class="op" id="7436678">)</span>&nbsp;<span class="op" id="7436680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7436683">var</span>&nbsp;<span class="ident" id="7436687">client</span>&nbsp;<span class="op" id="7436694">*</span><span class="ident" id="7436695">Client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7436703">var</span>&nbsp;<span class="ident" id="7436707">err</span>&nbsp;<span class="builtintype" id="7436711">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7436718">if</span>&nbsp;<span class="ident" id="7436721">path</span>&nbsp;<span class="op" id="7436726">==</span>&nbsp;<span class="string" id="7436729">&#34;&#34;</span>&nbsp;<span class="op" id="7436732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7436736">client</span><span class="op" id="7436742">,</span>&nbsp;<span class="ident" id="7436744">err</span>&nbsp;<span class="op" id="7436748">=</span>&nbsp;<span class="ident" id="7436750">DialHTTP</span><span class="op" id="7436758">(</span><span class="string" id="7436759">&#34;tcp&#34;</span><span class="op" id="7436764">,</span>&nbsp;<span class="ident" id="7436766">httpServerAddr</span><span class="op" id="7436780">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7436783">}</span>&nbsp;<span class="keyword" id="7436785">else</span>&nbsp;<span class="op" id="7436790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7436794">client</span><span class="op" id="7436800">,</span>&nbsp;<span class="ident" id="7436802">err</span>&nbsp;<span class="op" id="7436806">=</span>&nbsp;<span class="ident" id="7436808">DialHTTPPath</span><span class="op" id="7436820">(</span><span class="string" id="7436821">&#34;tcp&#34;</span><span class="op" id="7436826">,</span>&nbsp;<span class="ident" id="7436828">httpServerAddr</span><span class="op" id="7436842">,</span>&nbsp;<span class="ident" id="7436844">path</span><span class="op" id="7436848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7436851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7436854">if</span>&nbsp;<span class="ident" id="7436857">err</span>&nbsp;<span class="op" id="7436861">!=</span>&nbsp;<span class="builtintype" id="7436864">nil</span>&nbsp;<span class="op" id="7436868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7436872">t</span><span class="op" id="7436873">.</span><span class="ident" id="7436874">Fatal</span><span class="op" id="7436879">(</span><span class="string" id="7436880">&#34;dialing&#34;</span><span class="op" id="7436889">,</span>&nbsp;<span class="ident" id="7436891">err</span><span class="op" id="7436894">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7436897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7436900">defer</span>&nbsp;<span class="ident" id="7436906">client</span><span class="op" id="7436912">.</span><span class="ident" id="7436913">Close</span><span class="op" id="7436918">(</span><span class="op" id="7436919">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7436923">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7436945">args</span>&nbsp;<span class="op" id="7436950">:=</span>&nbsp;<span class="op" id="7436953">&amp;</span><span class="ident" id="7436954">Args</span><span class="op" id="7436958">{</span><span class="num" id="7436959">7</span><span class="op" id="7436960">,</span>&nbsp;<span class="num" id="7436962">8</span><span class="op" id="7436963">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7436966">reply</span>&nbsp;<span class="op" id="7436972">:=</span>&nbsp;<span class="builtinfunc" id="7436975">new</span><span class="op" id="7436978">(</span><span class="ident" id="7436979">Reply</span><span class="op" id="7436984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7436987">err</span>&nbsp;<span class="op" id="7436991">=</span>&nbsp;<span class="ident" id="7436993">client</span><span class="op" id="7436999">.</span><span class="ident" id="7437000">Call</span><span class="op" id="7437004">(</span><span class="string" id="7437005">&#34;Arith.Add&#34;</span><span class="op" id="7437016">,</span>&nbsp;<span class="ident" id="7437018">args</span><span class="op" id="7437022">,</span>&nbsp;<span class="ident" id="7437024">reply</span><span class="op" id="7437029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7437032">if</span>&nbsp;<span class="ident" id="7437035">err</span>&nbsp;<span class="op" id="7437039">!=</span>&nbsp;<span class="builtintype" id="7437042">nil</span>&nbsp;<span class="op" id="7437046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7437050">t</span><span class="op" id="7437051">.</span><span class="ident" id="7437052">Errorf</span><span class="op" id="7437058">(</span><span class="string" id="7437059">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7437101">,</span>&nbsp;<span class="ident" id="7437103">err</span><span class="op" id="7437106">.</span><span class="ident" id="7437107">Error</span><span class="op" id="7437112">(</span><span class="op" id="7437113">)</span><span class="op" id="7437114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7437117">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7437120">if</span>&nbsp;<span class="ident" id="7437123">reply</span><span class="op" id="7437128">.</span><span class="ident" id="7437129">C</span>&nbsp;<span class="op" id="7437131">!=</span>&nbsp;<span class="ident" id="7437134">args</span><span class="op" id="7437138">.</span><span class="ident" id="7437139">A</span><span class="op" id="7437140">+</span><span class="ident" id="7437141">args</span><span class="op" id="7437145">.</span><span class="ident" id="7437146">B</span>&nbsp;<span class="op" id="7437148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7437152">t</span><span class="op" id="7437153">.</span><span class="ident" id="7437154">Errorf</span><span class="op" id="7437160">(</span><span class="string" id="7437161">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7437186">,</span>&nbsp;<span class="ident" id="7437188">reply</span><span class="op" id="7437193">.</span><span class="ident" id="7437194">C</span><span class="op" id="7437195">,</span>&nbsp;<span class="ident" id="7437197">args</span><span class="op" id="7437201">.</span><span class="ident" id="7437202">A</span><span class="op" id="7437203">+</span><span class="ident" id="7437204">args</span><span class="op" id="7437208">.</span><span class="ident" id="7437209">B</span><span class="op" id="7437210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7437213">}</span><br>
<span class="lineno"></span><span class="op" id="7437215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="comment" id="7437218">//&nbsp;CodecEmulator&nbsp;provides&nbsp;a&nbsp;client-like&nbsp;api&nbsp;and&nbsp;a&nbsp;ServerCodec&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="7437291">//&nbsp;Can&nbsp;be&nbsp;used&nbsp;to&nbsp;test&nbsp;ServeRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="7437328">type</span>&nbsp;<span class="ident" id="7437333">CodecEmulator</span>&nbsp;<span class="keyword" id="7437347">struct</span>&nbsp;<span class="op" id="7437354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7437357">server</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7437371">*</span><span class="ident" id="7437372">Server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7437380">serviceMethod</span>&nbsp;<span class="builtintype" id="7437394">string</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7437402">args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7437416">*</span><span class="ident" id="7437417">Args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7437423">reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7437437">*</span><span class="ident" id="7437438">Reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7437445">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7437459">error</span><br>
<span class="lineno"></span><span class="op" id="7437465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="7437468">func</span>&nbsp;<span class="op" id="7437473">(</span><span class="ident" id="7437474">codec</span>&nbsp;<span class="op" id="7437480">*</span><span class="ident" id="7437481">CodecEmulator</span><span class="op" id="7437494">)</span>&nbsp;<span class="ident" id="7437496">Call</span><span class="op" id="7437500">(</span><span class="ident" id="7437501">serviceMethod</span>&nbsp;<span class="builtintype" id="7437515">string</span><span class="op" id="7437521">,</span>&nbsp;<span class="ident" id="7437523">args</span>&nbsp;<span class="op" id="7437528">*</span><span class="ident" id="7437529">Args</span><span class="op" id="7437533">,</span>&nbsp;<span class="ident" id="7437535">reply</span>&nbsp;<span class="op" id="7437541">*</span><span class="ident" id="7437542">Reply</span><span class="op" id="7437547">)</span>&nbsp;<span class="builtintype" id="7437549">error</span>&nbsp;<span class="op" id="7437555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7437558">codec</span><span class="op" id="7437563">.</span><span class="ident" id="7437564">serviceMethod</span>&nbsp;<span class="op" id="7437578">=</span>&nbsp;<span class="ident" id="7437580">serviceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7437595">codec</span><span class="op" id="7437600">.</span><span class="ident" id="7437601">args</span>&nbsp;<span class="op" id="7437606">=</span>&nbsp;<span class="ident" id="7437608">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7437614">codec</span><span class="op" id="7437619">.</span><span class="ident" id="7437620">reply</span>&nbsp;<span class="op" id="7437626">=</span>&nbsp;<span class="ident" id="7437628">reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7437635">codec</span><span class="op" id="7437640">.</span><span class="ident" id="7437641">err</span>&nbsp;<span class="op" id="7437645">=</span>&nbsp;<span class="builtintype" id="7437647">nil</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7437652">var</span>&nbsp;<span class="ident" id="7437656">serverError</span>&nbsp;<span class="builtintype" id="7437668">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7437675">if</span>&nbsp;<span class="ident" id="7437678">codec</span><span class="op" id="7437683">.</span><span class="ident" id="7437684">server</span>&nbsp;<span class="op" id="7437691">==</span>&nbsp;<span class="builtintype" id="7437694">nil</span>&nbsp;<span class="op" id="7437698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7437702">serverError</span>&nbsp;<span class="op" id="7437714">=</span>&nbsp;<span class="ident" id="7437716">ServeRequest</span><span class="op" id="7437728">(</span><span class="ident" id="7437729">codec</span><span class="op" id="7437734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7437737">}</span>&nbsp;<span class="keyword" id="7437739">else</span>&nbsp;<span class="op" id="7437744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7437748">serverError</span>&nbsp;<span class="op" id="7437760">=</span>&nbsp;<span class="ident" id="7437762">codec</span><span class="op" id="7437767">.</span><span class="ident" id="7437768">server</span><span class="op" id="7437774">.</span><span class="ident" id="7437775">ServeRequest</span><span class="op" id="7437787">(</span><span class="ident" id="7437788">codec</span><span class="op" id="7437793">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7437796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7437799">if</span>&nbsp;<span class="ident" id="7437802">codec</span><span class="op" id="7437807">.</span><span class="ident" id="7437808">err</span>&nbsp;<span class="op" id="7437812">==</span>&nbsp;<span class="builtintype" id="7437815">nil</span>&nbsp;<span class="op" id="7437819">&amp;&amp;</span>&nbsp;<span class="ident" id="7437822">serverError</span>&nbsp;<span class="op" id="7437834">!=</span>&nbsp;<span class="builtintype" id="7437837">nil</span>&nbsp;<span class="op" id="7437841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7437845">codec</span><span class="op" id="7437850">.</span><span class="ident" id="7437851">err</span>&nbsp;<span class="op" id="7437855">=</span>&nbsp;<span class="ident" id="7437857">serverError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7437870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7437873">return</span>&nbsp;<span class="ident" id="7437880">codec</span><span class="op" id="7437885">.</span><span class="ident" id="7437886">err</span><br>
<span class="lineno">330</span><span class="op" id="7437890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7437893">func</span>&nbsp;<span class="op" id="7437898">(</span><span class="ident" id="7437899">codec</span>&nbsp;<span class="op" id="7437905">*</span><span class="ident" id="7437906">CodecEmulator</span><span class="op" id="7437919">)</span>&nbsp;<span class="ident" id="7437921">ReadRequestHeader</span><span class="op" id="7437938">(</span><span class="ident" id="7437939">req</span>&nbsp;<span class="op" id="7437943">*</span><span class="ident" id="7437944">Request</span><span class="op" id="7437951">)</span>&nbsp;<span class="builtintype" id="7437953">error</span>&nbsp;<span class="op" id="7437959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7437962">req</span><span class="op" id="7437965">.</span><span class="ident" id="7437966">ServiceMethod</span>&nbsp;<span class="op" id="7437980">=</span>&nbsp;<span class="ident" id="7437982">codec</span><span class="op" id="7437987">.</span><span class="ident" id="7437988">serviceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7438003">req</span><span class="op" id="7438006">.</span><span class="ident" id="7438007">Seq</span>&nbsp;<span class="op" id="7438011">=</span>&nbsp;<span class="num" id="7438013">0</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7438016">return</span>&nbsp;<span class="builtintype" id="7438023">nil</span><br>
<span class="lineno"></span><span class="op" id="7438027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7438030">func</span>&nbsp;<span class="op" id="7438035">(</span><span class="ident" id="7438036">codec</span>&nbsp;<span class="op" id="7438042">*</span><span class="ident" id="7438043">CodecEmulator</span><span class="op" id="7438056">)</span>&nbsp;<span class="ident" id="7438058">ReadRequestBody</span><span class="op" id="7438073">(</span><span class="ident" id="7438074">argv</span>&nbsp;<span class="keyword" id="7438079">interface</span><span class="op" id="7438088">{</span><span class="op" id="7438089">}</span><span class="op" id="7438090">)</span>&nbsp;<span class="builtintype" id="7438092">error</span>&nbsp;<span class="op" id="7438098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7438101">if</span>&nbsp;<span class="ident" id="7438104">codec</span><span class="op" id="7438109">.</span><span class="ident" id="7438110">args</span>&nbsp;<span class="op" id="7438115">==</span>&nbsp;<span class="builtintype" id="7438118">nil</span>&nbsp;<span class="op" id="7438122">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7438126">return</span>&nbsp;<span class="ident" id="7438133">io</span><span class="op" id="7438135">.</span><span class="ident" id="7438136">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7438154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7438157">*</span><span class="op" id="7438158">(</span><span class="ident" id="7438159">argv</span><span class="op" id="7438163">.</span><span class="op" id="7438164">(</span><span class="op" id="7438165">*</span><span class="ident" id="7438166">Args</span><span class="op" id="7438170">)</span><span class="op" id="7438171">)</span>&nbsp;<span class="op" id="7438173">=</span>&nbsp;<span class="op" id="7438175">*</span><span class="ident" id="7438176">codec</span><span class="op" id="7438181">.</span><span class="ident" id="7438182">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7438188">return</span>&nbsp;<span class="builtintype" id="7438195">nil</span><br>
<span class="lineno"></span><span class="op" id="7438199">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="7438202">func</span>&nbsp;<span class="op" id="7438207">(</span><span class="ident" id="7438208">codec</span>&nbsp;<span class="op" id="7438214">*</span><span class="ident" id="7438215">CodecEmulator</span><span class="op" id="7438228">)</span>&nbsp;<span class="ident" id="7438230">WriteResponse</span><span class="op" id="7438243">(</span><span class="ident" id="7438244">resp</span>&nbsp;<span class="op" id="7438249">*</span><span class="ident" id="7438250">Response</span><span class="op" id="7438258">,</span>&nbsp;<span class="ident" id="7438260">reply</span>&nbsp;<span class="keyword" id="7438266">interface</span><span class="op" id="7438275">{</span><span class="op" id="7438276">}</span><span class="op" id="7438277">)</span>&nbsp;<span class="builtintype" id="7438279">error</span>&nbsp;<span class="op" id="7438285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7438288">if</span>&nbsp;<span class="ident" id="7438291">resp</span><span class="op" id="7438295">.</span><span class="ident" id="7438296">Error</span>&nbsp;<span class="op" id="7438302">!=</span>&nbsp;<span class="string" id="7438305">&#34;&#34;</span>&nbsp;<span class="op" id="7438308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7438312">codec</span><span class="op" id="7438317">.</span><span class="ident" id="7438318">err</span>&nbsp;<span class="op" id="7438322">=</span>&nbsp;<span class="ident" id="7438324">errors</span><span class="op" id="7438330">.</span><span class="ident" id="7438331">New</span><span class="op" id="7438334">(</span><span class="ident" id="7438335">resp</span><span class="op" id="7438339">.</span><span class="ident" id="7438340">Error</span><span class="op" id="7438345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7438348">}</span>&nbsp;<span class="keyword" id="7438350">else</span>&nbsp;<span class="op" id="7438355">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7438359">*</span><span class="ident" id="7438360">codec</span><span class="op" id="7438365">.</span><span class="ident" id="7438366">reply</span>&nbsp;<span class="op" id="7438372">=</span>&nbsp;<span class="op" id="7438374">*</span><span class="op" id="7438375">(</span><span class="ident" id="7438376">reply</span><span class="op" id="7438381">.</span><span class="op" id="7438382">(</span><span class="op" id="7438383">*</span><span class="ident" id="7438384">Reply</span><span class="op" id="7438389">)</span><span class="op" id="7438390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7438393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7438396">return</span>&nbsp;<span class="builtintype" id="7438403">nil</span><br>
<span class="lineno"></span><span class="op" id="7438407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="7438410">func</span>&nbsp;<span class="op" id="7438415">(</span><span class="ident" id="7438416">codec</span>&nbsp;<span class="op" id="7438422">*</span><span class="ident" id="7438423">CodecEmulator</span><span class="op" id="7438436">)</span>&nbsp;<span class="ident" id="7438438">Close</span><span class="op" id="7438443">(</span><span class="op" id="7438444">)</span>&nbsp;<span class="builtintype" id="7438446">error</span>&nbsp;<span class="op" id="7438452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7438455">return</span>&nbsp;<span class="builtintype" id="7438462">nil</span><br>
<span class="lineno"></span><span class="op" id="7438466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7438469">func</span>&nbsp;<span class="ident" id="7438474">TestServeRequest</span><span class="op" id="7438490">(</span><span class="ident" id="7438491">t</span>&nbsp;<span class="op" id="7438493">*</span><span class="ident" id="7438494">testing</span><span class="op" id="7438501">.</span><span class="ident" id="7438502">T</span><span class="op" id="7438503">)</span>&nbsp;<span class="op" id="7438505">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7438508">once</span><span class="op" id="7438512">.</span><span class="ident" id="7438513">Do</span><span class="op" id="7438515">(</span><span class="ident" id="7438516">startServer</span><span class="op" id="7438527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7438530">testServeRequest</span><span class="op" id="7438546">(</span><span class="ident" id="7438547">t</span><span class="op" id="7438548">,</span>&nbsp;<span class="builtintype" id="7438550">nil</span><span class="op" id="7438553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7438556">newOnce</span><span class="op" id="7438563">.</span><span class="ident" id="7438564">Do</span><span class="op" id="7438566">(</span><span class="ident" id="7438567">startNewServer</span><span class="op" id="7438581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7438584">testServeRequest</span><span class="op" id="7438600">(</span><span class="ident" id="7438601">t</span><span class="op" id="7438602">,</span>&nbsp;<span class="ident" id="7438604">newServer</span><span class="op" id="7438613">)</span><br>
<span class="lineno"></span><span class="op" id="7438615">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="7438618">func</span>&nbsp;<span class="ident" id="7438623">testServeRequest</span><span class="op" id="7438639">(</span><span class="ident" id="7438640">t</span>&nbsp;<span class="op" id="7438642">*</span><span class="ident" id="7438643">testing</span><span class="op" id="7438650">.</span><span class="ident" id="7438651">T</span><span class="op" id="7438652">,</span>&nbsp;<span class="ident" id="7438654">server</span>&nbsp;<span class="op" id="7438661">*</span><span class="ident" id="7438662">Server</span><span class="op" id="7438668">)</span>&nbsp;<span class="op" id="7438670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7438673">client</span>&nbsp;<span class="op" id="7438680">:=</span>&nbsp;<span class="ident" id="7438683">CodecEmulator</span><span class="op" id="7438696">{</span><span class="ident" id="7438697">server</span><span class="op" id="7438703">:</span>&nbsp;<span class="ident" id="7438705">server</span><span class="op" id="7438711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7438714">defer</span>&nbsp;<span class="ident" id="7438720">client</span><span class="op" id="7438726">.</span><span class="ident" id="7438727">Close</span><span class="op" id="7438732">(</span><span class="op" id="7438733">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7438737">args</span>&nbsp;<span class="op" id="7438742">:=</span>&nbsp;<span class="op" id="7438745">&amp;</span><span class="ident" id="7438746">Args</span><span class="op" id="7438750">{</span><span class="num" id="7438751">7</span><span class="op" id="7438752">,</span>&nbsp;<span class="num" id="7438754">8</span><span class="op" id="7438755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7438758">reply</span>&nbsp;<span class="op" id="7438764">:=</span>&nbsp;<span class="builtinfunc" id="7438767">new</span><span class="op" id="7438770">(</span><span class="ident" id="7438771">Reply</span><span class="op" id="7438776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7438779">err</span>&nbsp;<span class="op" id="7438783">:=</span>&nbsp;<span class="ident" id="7438786">client</span><span class="op" id="7438792">.</span><span class="ident" id="7438793">Call</span><span class="op" id="7438797">(</span><span class="string" id="7438798">&#34;Arith.Add&#34;</span><span class="op" id="7438809">,</span>&nbsp;<span class="ident" id="7438811">args</span><span class="op" id="7438815">,</span>&nbsp;<span class="ident" id="7438817">reply</span><span class="op" id="7438822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7438825">if</span>&nbsp;<span class="ident" id="7438828">err</span>&nbsp;<span class="op" id="7438832">!=</span>&nbsp;<span class="builtintype" id="7438835">nil</span>&nbsp;<span class="op" id="7438839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7438843">t</span><span class="op" id="7438844">.</span><span class="ident" id="7438845">Errorf</span><span class="op" id="7438851">(</span><span class="string" id="7438852">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7438894">,</span>&nbsp;<span class="ident" id="7438896">err</span><span class="op" id="7438899">.</span><span class="ident" id="7438900">Error</span><span class="op" id="7438905">(</span><span class="op" id="7438906">)</span><span class="op" id="7438907">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7438910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7438913">if</span>&nbsp;<span class="ident" id="7438916">reply</span><span class="op" id="7438921">.</span><span class="ident" id="7438922">C</span>&nbsp;<span class="op" id="7438924">!=</span>&nbsp;<span class="ident" id="7438927">args</span><span class="op" id="7438931">.</span><span class="ident" id="7438932">A</span><span class="op" id="7438933">+</span><span class="ident" id="7438934">args</span><span class="op" id="7438938">.</span><span class="ident" id="7438939">B</span>&nbsp;<span class="op" id="7438941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7438945">t</span><span class="op" id="7438946">.</span><span class="ident" id="7438947">Errorf</span><span class="op" id="7438953">(</span><span class="string" id="7438954">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7438979">,</span>&nbsp;<span class="ident" id="7438981">reply</span><span class="op" id="7438986">.</span><span class="ident" id="7438987">C</span><span class="op" id="7438988">,</span>&nbsp;<span class="ident" id="7438990">args</span><span class="op" id="7438994">.</span><span class="ident" id="7438995">A</span><span class="op" id="7438996">+</span><span class="ident" id="7438997">args</span><span class="op" id="7439001">.</span><span class="ident" id="7439002">B</span><span class="op" id="7439003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7439006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7439010">err</span>&nbsp;<span class="op" id="7439014">=</span>&nbsp;<span class="ident" id="7439016">client</span><span class="op" id="7439022">.</span><span class="ident" id="7439023">Call</span><span class="op" id="7439027">(</span><span class="string" id="7439028">&#34;Arith.Add&#34;</span><span class="op" id="7439039">,</span>&nbsp;<span class="builtintype" id="7439041">nil</span><span class="op" id="7439044">,</span>&nbsp;<span class="ident" id="7439046">reply</span><span class="op" id="7439051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7439054">if</span>&nbsp;<span class="ident" id="7439057">err</span>&nbsp;<span class="op" id="7439061">==</span>&nbsp;<span class="builtintype" id="7439064">nil</span>&nbsp;<span class="op" id="7439068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7439072">t</span><span class="op" id="7439073">.</span><span class="ident" id="7439074">Errorf</span><span class="op" id="7439080">(</span><span class="string" id="7439081">&#34;expected&nbsp;error&nbsp;calling&nbsp;Arith.Add&nbsp;with&nbsp;nil&nbsp;arg&#34;</span><span class="op" id="7439128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7439131">}</span><br>
<span class="lineno"></span><span class="op" id="7439133">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="keyword" id="7439136">type</span>&nbsp;<span class="ident" id="7439141">ReplyNotPointer</span>&nbsp;<span class="builtintype" id="7439157">int</span><br>
<span class="lineno"></span><span class="keyword" id="7439161">type</span>&nbsp;<span class="ident" id="7439166">ArgNotPublic</span>&nbsp;<span class="builtintype" id="7439179">int</span><br>
<span class="lineno"></span><span class="keyword" id="7439183">type</span>&nbsp;<span class="ident" id="7439188">ReplyNotPublic</span>&nbsp;<span class="builtintype" id="7439203">int</span><br>
<span class="lineno"></span><span class="keyword" id="7439207">type</span>&nbsp;<span class="ident" id="7439212">NeedsPtrType</span>&nbsp;<span class="builtintype" id="7439225">int</span><br>
<span class="lineno">390</span><span class="keyword" id="7439229">type</span>&nbsp;<span class="ident" id="7439234">local</span>&nbsp;<span class="keyword" id="7439240">struct</span><span class="op" id="7439246">{</span><span class="op" id="7439247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7439250">func</span>&nbsp;<span class="op" id="7439255">(</span><span class="ident" id="7439256">t</span>&nbsp;<span class="op" id="7439258">*</span><span class="ident" id="7439259">ReplyNotPointer</span><span class="op" id="7439274">)</span>&nbsp;<span class="ident" id="7439276">ReplyNotPointer</span><span class="op" id="7439291">(</span><span class="ident" id="7439292">args</span>&nbsp;<span class="op" id="7439297">*</span><span class="ident" id="7439298">Args</span><span class="op" id="7439302">,</span>&nbsp;<span class="ident" id="7439304">reply</span>&nbsp;<span class="ident" id="7439310">Reply</span><span class="op" id="7439315">)</span>&nbsp;<span class="builtintype" id="7439317">error</span>&nbsp;<span class="op" id="7439323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7439326">return</span>&nbsp;<span class="builtintype" id="7439333">nil</span><br>
<span class="lineno"></span><span class="op" id="7439337">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="7439340">func</span>&nbsp;<span class="op" id="7439345">(</span><span class="ident" id="7439346">t</span>&nbsp;<span class="op" id="7439348">*</span><span class="ident" id="7439349">ArgNotPublic</span><span class="op" id="7439361">)</span>&nbsp;<span class="ident" id="7439363">ArgNotPublic</span><span class="op" id="7439375">(</span><span class="ident" id="7439376">args</span>&nbsp;<span class="op" id="7439381">*</span><span class="ident" id="7439382">local</span><span class="op" id="7439387">,</span>&nbsp;<span class="ident" id="7439389">reply</span>&nbsp;<span class="op" id="7439395">*</span><span class="ident" id="7439396">Reply</span><span class="op" id="7439401">)</span>&nbsp;<span class="builtintype" id="7439403">error</span>&nbsp;<span class="op" id="7439409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7439412">return</span>&nbsp;<span class="builtintype" id="7439419">nil</span><br>
<span class="lineno"></span><span class="op" id="7439423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="keyword" id="7439426">func</span>&nbsp;<span class="op" id="7439431">(</span><span class="ident" id="7439432">t</span>&nbsp;<span class="op" id="7439434">*</span><span class="ident" id="7439435">ReplyNotPublic</span><span class="op" id="7439449">)</span>&nbsp;<span class="ident" id="7439451">ReplyNotPublic</span><span class="op" id="7439465">(</span><span class="ident" id="7439466">args</span>&nbsp;<span class="op" id="7439471">*</span><span class="ident" id="7439472">Args</span><span class="op" id="7439476">,</span>&nbsp;<span class="ident" id="7439478">reply</span>&nbsp;<span class="op" id="7439484">*</span><span class="ident" id="7439485">local</span><span class="op" id="7439490">)</span>&nbsp;<span class="builtintype" id="7439492">error</span>&nbsp;<span class="op" id="7439498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7439501">return</span>&nbsp;<span class="builtintype" id="7439508">nil</span><br>
<span class="lineno"></span><span class="op" id="7439512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7439515">func</span>&nbsp;<span class="op" id="7439520">(</span><span class="ident" id="7439521">t</span>&nbsp;<span class="op" id="7439523">*</span><span class="ident" id="7439524">NeedsPtrType</span><span class="op" id="7439536">)</span>&nbsp;<span class="ident" id="7439538">NeedsPtrType</span><span class="op" id="7439550">(</span><span class="ident" id="7439551">args</span>&nbsp;<span class="op" id="7439556">*</span><span class="ident" id="7439557">Args</span><span class="op" id="7439561">,</span>&nbsp;<span class="ident" id="7439563">reply</span>&nbsp;<span class="op" id="7439569">*</span><span class="ident" id="7439570">Reply</span><span class="op" id="7439575">)</span>&nbsp;<span class="builtintype" id="7439577">error</span>&nbsp;<span class="op" id="7439583">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7439586">return</span>&nbsp;<span class="builtintype" id="7439593">nil</span><br>
<span class="lineno"></span><span class="op" id="7439597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7439600">//&nbsp;Check&nbsp;that&nbsp;registration&nbsp;handles&nbsp;lots&nbsp;of&nbsp;bad&nbsp;methods&nbsp;and&nbsp;a&nbsp;type&nbsp;with&nbsp;no&nbsp;suitable&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="7439692">func</span>&nbsp;<span class="ident" id="7439697">TestRegistrationError</span><span class="op" id="7439718">(</span><span class="ident" id="7439719">t</span>&nbsp;<span class="op" id="7439721">*</span><span class="ident" id="7439722">testing</span><span class="op" id="7439729">.</span><span class="ident" id="7439730">T</span><span class="op" id="7439731">)</span>&nbsp;<span class="op" id="7439733">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7439736">err</span>&nbsp;<span class="op" id="7439740">:=</span>&nbsp;<span class="ident" id="7439743">Register</span><span class="op" id="7439751">(</span><span class="builtinfunc" id="7439752">new</span><span class="op" id="7439755">(</span><span class="ident" id="7439756">ReplyNotPointer</span><span class="op" id="7439771">)</span><span class="op" id="7439772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7439775">if</span>&nbsp;<span class="ident" id="7439778">err</span>&nbsp;<span class="op" id="7439782">==</span>&nbsp;<span class="builtintype" id="7439785">nil</span>&nbsp;<span class="op" id="7439789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7439793">t</span><span class="op" id="7439794">.</span><span class="ident" id="7439795">Error</span><span class="op" id="7439800">(</span><span class="string" id="7439801">&#34;expected&nbsp;error&nbsp;registering&nbsp;ReplyNotPointer&#34;</span><span class="op" id="7439845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7439848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7439851">err</span>&nbsp;<span class="op" id="7439855">=</span>&nbsp;<span class="ident" id="7439857">Register</span><span class="op" id="7439865">(</span><span class="builtinfunc" id="7439866">new</span><span class="op" id="7439869">(</span><span class="ident" id="7439870">ArgNotPublic</span><span class="op" id="7439882">)</span><span class="op" id="7439883">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7439886">if</span>&nbsp;<span class="ident" id="7439889">err</span>&nbsp;<span class="op" id="7439893">==</span>&nbsp;<span class="builtintype" id="7439896">nil</span>&nbsp;<span class="op" id="7439900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7439904">t</span><span class="op" id="7439905">.</span><span class="ident" id="7439906">Error</span><span class="op" id="7439911">(</span><span class="string" id="7439912">&#34;expected&nbsp;error&nbsp;registering&nbsp;ArgNotPublic&#34;</span><span class="op" id="7439953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7439956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7439959">err</span>&nbsp;<span class="op" id="7439963">=</span>&nbsp;<span class="ident" id="7439965">Register</span><span class="op" id="7439973">(</span><span class="builtinfunc" id="7439974">new</span><span class="op" id="7439977">(</span><span class="ident" id="7439978">ReplyNotPublic</span><span class="op" id="7439992">)</span><span class="op" id="7439993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7439996">if</span>&nbsp;<span class="ident" id="7439999">err</span>&nbsp;<span class="op" id="7440003">==</span>&nbsp;<span class="builtintype" id="7440006">nil</span>&nbsp;<span class="op" id="7440010">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7440014">t</span><span class="op" id="7440015">.</span><span class="ident" id="7440016">Error</span><span class="op" id="7440021">(</span><span class="string" id="7440022">&#34;expected&nbsp;error&nbsp;registering&nbsp;ReplyNotPublic&#34;</span><span class="op" id="7440065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7440068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7440071">err</span>&nbsp;<span class="op" id="7440075">=</span>&nbsp;<span class="ident" id="7440077">Register</span><span class="op" id="7440085">(</span><span class="ident" id="7440086">NeedsPtrType</span><span class="op" id="7440098">(</span><span class="num" id="7440099">0</span><span class="op" id="7440100">)</span><span class="op" id="7440101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7440104">if</span>&nbsp;<span class="ident" id="7440107">err</span>&nbsp;<span class="op" id="7440111">==</span>&nbsp;<span class="builtintype" id="7440114">nil</span>&nbsp;<span class="op" id="7440118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7440122">t</span><span class="op" id="7440123">.</span><span class="ident" id="7440124">Error</span><span class="op" id="7440129">(</span><span class="string" id="7440130">&#34;expected&nbsp;error&nbsp;registering&nbsp;NeedsPtrType&#34;</span><span class="op" id="7440171">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7440174">}</span>&nbsp;<span class="keyword" id="7440176">else</span>&nbsp;<span class="keyword" id="7440181">if</span>&nbsp;<span class="op" id="7440184">!</span><span class="ident" id="7440185">strings</span><span class="op" id="7440192">.</span><span class="ident" id="7440193">Contains</span><span class="op" id="7440201">(</span><span class="ident" id="7440202">err</span><span class="op" id="7440205">.</span><span class="ident" id="7440206">Error</span><span class="op" id="7440211">(</span><span class="op" id="7440212">)</span><span class="op" id="7440213">,</span>&nbsp;<span class="string" id="7440215">&#34;pointer&#34;</span><span class="op" id="7440224">)</span>&nbsp;<span class="op" id="7440226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7440230">t</span><span class="op" id="7440231">.</span><span class="ident" id="7440232">Error</span><span class="op" id="7440237">(</span><span class="string" id="7440238">&#34;expected&nbsp;hint&nbsp;when&nbsp;registering&nbsp;NeedsPtrType&#34;</span><span class="op" id="7440283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7440286">}</span><br>
<span class="lineno"></span><span class="op" id="7440288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="7440291">type</span>&nbsp;<span class="ident" id="7440296">WriteFailCodec</span>&nbsp;<span class="builtintype" id="7440311">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7440316">func</span>&nbsp;<span class="op" id="7440321">(</span><span class="ident" id="7440322">WriteFailCodec</span><span class="op" id="7440336">)</span>&nbsp;<span class="ident" id="7440338">WriteRequest</span><span class="op" id="7440350">(</span><span class="op" id="7440351">*</span><span class="ident" id="7440352">Request</span><span class="op" id="7440359">,</span>&nbsp;<span class="keyword" id="7440361">interface</span><span class="op" id="7440370">{</span><span class="op" id="7440371">}</span><span class="op" id="7440372">)</span>&nbsp;<span class="builtintype" id="7440374">error</span>&nbsp;<span class="op" id="7440380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7440383">//&nbsp;the&nbsp;panic&nbsp;caused&nbsp;by&nbsp;this&nbsp;error&nbsp;used&nbsp;to&nbsp;not&nbsp;unlock&nbsp;a&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7440445">return</span>&nbsp;<span class="ident" id="7440452">errors</span><span class="op" id="7440458">.</span><span class="ident" id="7440459">New</span><span class="op" id="7440462">(</span><span class="string" id="7440463">&#34;fail&#34;</span><span class="op" id="7440469">)</span><br>
<span class="lineno">435</span><span class="op" id="7440471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7440474">func</span>&nbsp;<span class="op" id="7440479">(</span><span class="ident" id="7440480">WriteFailCodec</span><span class="op" id="7440494">)</span>&nbsp;<span class="ident" id="7440496">ReadResponseHeader</span><span class="op" id="7440514">(</span><span class="op" id="7440515">*</span><span class="ident" id="7440516">Response</span><span class="op" id="7440524">)</span>&nbsp;<span class="builtintype" id="7440526">error</span>&nbsp;<span class="op" id="7440532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7440535">select</span>&nbsp;<span class="op" id="7440542">{</span><span class="op" id="7440543">}</span><br>
<span class="lineno"></span><span class="op" id="7440545">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="keyword" id="7440548">func</span>&nbsp;<span class="op" id="7440553">(</span><span class="ident" id="7440554">WriteFailCodec</span><span class="op" id="7440568">)</span>&nbsp;<span class="ident" id="7440570">ReadResponseBody</span><span class="op" id="7440586">(</span><span class="keyword" id="7440587">interface</span><span class="op" id="7440596">{</span><span class="op" id="7440597">}</span><span class="op" id="7440598">)</span>&nbsp;<span class="builtintype" id="7440600">error</span>&nbsp;<span class="op" id="7440606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7440609">select</span>&nbsp;<span class="op" id="7440616">{</span><span class="op" id="7440617">}</span><br>
<span class="lineno"></span><span class="op" id="7440619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span><span class="keyword" id="7440622">func</span>&nbsp;<span class="op" id="7440627">(</span><span class="ident" id="7440628">WriteFailCodec</span><span class="op" id="7440642">)</span>&nbsp;<span class="ident" id="7440644">Close</span><span class="op" id="7440649">(</span><span class="op" id="7440650">)</span>&nbsp;<span class="builtintype" id="7440652">error</span>&nbsp;<span class="op" id="7440658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7440661">return</span>&nbsp;<span class="builtintype" id="7440668">nil</span><br>
<span class="lineno"></span><span class="op" id="7440672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7440675">func</span>&nbsp;<span class="ident" id="7440680">TestSendDeadlock</span><span class="op" id="7440696">(</span><span class="ident" id="7440697">t</span>&nbsp;<span class="op" id="7440699">*</span><span class="ident" id="7440700">testing</span><span class="op" id="7440707">.</span><span class="ident" id="7440708">T</span><span class="op" id="7440709">)</span>&nbsp;<span class="op" id="7440711">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7440714">client</span>&nbsp;<span class="op" id="7440721">:=</span>&nbsp;<span class="ident" id="7440724">NewClientWithCodec</span><span class="op" id="7440742">(</span><span class="ident" id="7440743">WriteFailCodec</span><span class="op" id="7440757">(</span><span class="num" id="7440758">0</span><span class="op" id="7440759">)</span><span class="op" id="7440760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7440763">defer</span>&nbsp;<span class="ident" id="7440769">client</span><span class="op" id="7440775">.</span><span class="ident" id="7440776">Close</span><span class="op" id="7440781">(</span><span class="op" id="7440782">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7440786">done</span>&nbsp;<span class="op" id="7440791">:=</span>&nbsp;<span class="builtinfunc" id="7440794">make</span><span class="op" id="7440798">(</span><span class="keyword" id="7440799">chan</span>&nbsp;<span class="builtintype" id="7440804">bool</span><span class="op" id="7440808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7440811">go</span>&nbsp;<span class="keyword" id="7440814">func</span><span class="op" id="7440818">(</span><span class="op" id="7440819">)</span>&nbsp;<span class="op" id="7440821">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7440825">testSendDeadlock</span><span class="op" id="7440841">(</span><span class="ident" id="7440842">client</span><span class="op" id="7440848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7440852">testSendDeadlock</span><span class="op" id="7440868">(</span><span class="ident" id="7440869">client</span><span class="op" id="7440875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7440879">done</span>&nbsp;<span class="op" id="7440884">&lt;-</span>&nbsp;<span class="builtintype" id="7440887">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7440893">}</span><span class="op" id="7440894">(</span><span class="op" id="7440895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7440898">select</span>&nbsp;<span class="op" id="7440905">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7440908">case</span>&nbsp;<span class="op" id="7440913">&lt;-</span><span class="ident" id="7440915">done</span><span class="op" id="7440919">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7440923">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7440931">case</span>&nbsp;<span class="op" id="7440936">&lt;-</span><span class="ident" id="7440938">time</span><span class="op" id="7440942">.</span><span class="ident" id="7440943">After</span><span class="op" id="7440948">(</span><span class="num" id="7440949">5</span>&nbsp;<span class="op" id="7440951">*</span>&nbsp;<span class="ident" id="7440953">time</span><span class="op" id="7440957">.</span><span class="ident" id="7440958">Second</span><span class="op" id="7440964">)</span><span class="op" id="7440965">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7440969">t</span><span class="op" id="7440970">.</span><span class="ident" id="7440971">Fatal</span><span class="op" id="7440976">(</span><span class="string" id="7440977">&#34;deadlock&#34;</span><span class="op" id="7440987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7440990">}</span><br>
<span class="lineno">465</span><span class="op" id="7440992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7440995">func</span>&nbsp;<span class="ident" id="7441000">testSendDeadlock</span><span class="op" id="7441016">(</span><span class="ident" id="7441017">client</span>&nbsp;<span class="op" id="7441024">*</span><span class="ident" id="7441025">Client</span><span class="op" id="7441031">)</span>&nbsp;<span class="op" id="7441033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7441036">defer</span>&nbsp;<span class="keyword" id="7441042">func</span><span class="op" id="7441046">(</span><span class="op" id="7441047">)</span>&nbsp;<span class="op" id="7441049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7441053">recover</span><span class="op" id="7441060">(</span><span class="op" id="7441061">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7441064">}</span><span class="op" id="7441065">(</span><span class="op" id="7441066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7441069">args</span>&nbsp;<span class="op" id="7441074">:=</span>&nbsp;<span class="op" id="7441077">&amp;</span><span class="ident" id="7441078">Args</span><span class="op" id="7441082">{</span><span class="num" id="7441083">7</span><span class="op" id="7441084">,</span>&nbsp;<span class="num" id="7441086">8</span><span class="op" id="7441087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7441090">reply</span>&nbsp;<span class="op" id="7441096">:=</span>&nbsp;<span class="builtinfunc" id="7441099">new</span><span class="op" id="7441102">(</span><span class="ident" id="7441103">Reply</span><span class="op" id="7441108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7441111">client</span><span class="op" id="7441117">.</span><span class="ident" id="7441118">Call</span><span class="op" id="7441122">(</span><span class="string" id="7441123">&#34;Arith.Add&#34;</span><span class="op" id="7441134">,</span>&nbsp;<span class="ident" id="7441136">args</span><span class="op" id="7441140">,</span>&nbsp;<span class="ident" id="7441142">reply</span><span class="op" id="7441147">)</span><br>
<span class="lineno"></span><span class="op" id="7441149">}</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span><span class="keyword" id="7441152">func</span>&nbsp;<span class="ident" id="7441157">dialDirect</span><span class="op" id="7441167">(</span><span class="op" id="7441168">)</span>&nbsp;<span class="op" id="7441170">(</span><span class="op" id="7441171">*</span><span class="ident" id="7441172">Client</span><span class="op" id="7441178">,</span>&nbsp;<span class="builtintype" id="7441180">error</span><span class="op" id="7441185">)</span>&nbsp;<span class="op" id="7441187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7441190">return</span>&nbsp;<span class="ident" id="7441197">Dial</span><span class="op" id="7441201">(</span><span class="string" id="7441202">&#34;tcp&#34;</span><span class="op" id="7441207">,</span>&nbsp;<span class="ident" id="7441209">serverAddr</span><span class="op" id="7441219">)</span><br>
<span class="lineno"></span><span class="op" id="7441221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">480</span><span class="keyword" id="7441224">func</span>&nbsp;<span class="ident" id="7441229">dialHTTP</span><span class="op" id="7441237">(</span><span class="op" id="7441238">)</span>&nbsp;<span class="op" id="7441240">(</span><span class="op" id="7441241">*</span><span class="ident" id="7441242">Client</span><span class="op" id="7441248">,</span>&nbsp;<span class="builtintype" id="7441250">error</span><span class="op" id="7441255">)</span>&nbsp;<span class="op" id="7441257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7441260">return</span>&nbsp;<span class="ident" id="7441267">DialHTTP</span><span class="op" id="7441275">(</span><span class="string" id="7441276">&#34;tcp&#34;</span><span class="op" id="7441281">,</span>&nbsp;<span class="ident" id="7441283">httpServerAddr</span><span class="op" id="7441297">)</span><br>
<span class="lineno"></span><span class="op" id="7441299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7441302">func</span>&nbsp;<span class="ident" id="7441307">countMallocs</span><span class="op" id="7441319">(</span><span class="ident" id="7441320">dial</span>&nbsp;<span class="keyword" id="7441325">func</span><span class="op" id="7441329">(</span><span class="op" id="7441330">)</span>&nbsp;<span class="op" id="7441332">(</span><span class="op" id="7441333">*</span><span class="ident" id="7441334">Client</span><span class="op" id="7441340">,</span>&nbsp;<span class="builtintype" id="7441342">error</span><span class="op" id="7441347">)</span><span class="op" id="7441348">,</span>&nbsp;<span class="ident" id="7441350">t</span>&nbsp;<span class="op" id="7441352">*</span><span class="ident" id="7441353">testing</span><span class="op" id="7441360">.</span><span class="ident" id="7441361">T</span><span class="op" id="7441362">)</span>&nbsp;<span class="builtintype" id="7441364">float64</span>&nbsp;<span class="op" id="7441372">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7441375">once</span><span class="op" id="7441379">.</span><span class="ident" id="7441380">Do</span><span class="op" id="7441382">(</span><span class="ident" id="7441383">startServer</span><span class="op" id="7441394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7441397">client</span><span class="op" id="7441403">,</span>&nbsp;<span class="ident" id="7441405">err</span>&nbsp;<span class="op" id="7441409">:=</span>&nbsp;<span class="ident" id="7441412">dial</span><span class="op" id="7441416">(</span><span class="op" id="7441417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7441420">if</span>&nbsp;<span class="ident" id="7441423">err</span>&nbsp;<span class="op" id="7441427">!=</span>&nbsp;<span class="builtintype" id="7441430">nil</span>&nbsp;<span class="op" id="7441434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7441438">t</span><span class="op" id="7441439">.</span><span class="ident" id="7441440">Fatal</span><span class="op" id="7441445">(</span><span class="string" id="7441446">&#34;error&nbsp;dialing&#34;</span><span class="op" id="7441461">,</span>&nbsp;<span class="ident" id="7441463">err</span><span class="op" id="7441466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7441469">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7441472">defer</span>&nbsp;<span class="ident" id="7441478">client</span><span class="op" id="7441484">.</span><span class="ident" id="7441485">Close</span><span class="op" id="7441490">(</span><span class="op" id="7441491">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7441495">args</span>&nbsp;<span class="op" id="7441500">:=</span>&nbsp;<span class="op" id="7441503">&amp;</span><span class="ident" id="7441504">Args</span><span class="op" id="7441508">{</span><span class="num" id="7441509">7</span><span class="op" id="7441510">,</span>&nbsp;<span class="num" id="7441512">8</span><span class="op" id="7441513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7441516">reply</span>&nbsp;<span class="op" id="7441522">:=</span>&nbsp;<span class="builtinfunc" id="7441525">new</span><span class="op" id="7441528">(</span><span class="ident" id="7441529">Reply</span><span class="op" id="7441534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7441537">return</span>&nbsp;<span class="ident" id="7441544">testing</span><span class="op" id="7441551">.</span><span class="ident" id="7441552">AllocsPerRun</span><span class="op" id="7441564">(</span><span class="num" id="7441565">100</span><span class="op" id="7441568">,</span>&nbsp;<span class="keyword" id="7441570">func</span><span class="op" id="7441574">(</span><span class="op" id="7441575">)</span>&nbsp;<span class="op" id="7441577">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7441581">err</span>&nbsp;<span class="op" id="7441585">:=</span>&nbsp;<span class="ident" id="7441588">client</span><span class="op" id="7441594">.</span><span class="ident" id="7441595">Call</span><span class="op" id="7441599">(</span><span class="string" id="7441600">&#34;Arith.Add&#34;</span><span class="op" id="7441611">,</span>&nbsp;<span class="ident" id="7441613">args</span><span class="op" id="7441617">,</span>&nbsp;<span class="ident" id="7441619">reply</span><span class="op" id="7441624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7441628">if</span>&nbsp;<span class="ident" id="7441631">err</span>&nbsp;<span class="op" id="7441635">!=</span>&nbsp;<span class="builtintype" id="7441638">nil</span>&nbsp;<span class="op" id="7441642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7441647">t</span><span class="op" id="7441648">.</span><span class="ident" id="7441649">Errorf</span><span class="op" id="7441655">(</span><span class="string" id="7441656">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7441698">,</span>&nbsp;<span class="ident" id="7441700">err</span><span class="op" id="7441703">.</span><span class="ident" id="7441704">Error</span><span class="op" id="7441709">(</span><span class="op" id="7441710">)</span><span class="op" id="7441711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7441715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7441719">if</span>&nbsp;<span class="ident" id="7441722">reply</span><span class="op" id="7441727">.</span><span class="ident" id="7441728">C</span>&nbsp;<span class="op" id="7441730">!=</span>&nbsp;<span class="ident" id="7441733">args</span><span class="op" id="7441737">.</span><span class="ident" id="7441738">A</span><span class="op" id="7441739">+</span><span class="ident" id="7441740">args</span><span class="op" id="7441744">.</span><span class="ident" id="7441745">B</span>&nbsp;<span class="op" id="7441747">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7441752">t</span><span class="op" id="7441753">.</span><span class="ident" id="7441754">Errorf</span><span class="op" id="7441760">(</span><span class="string" id="7441761">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7441786">,</span>&nbsp;<span class="ident" id="7441788">reply</span><span class="op" id="7441793">.</span><span class="ident" id="7441794">C</span><span class="op" id="7441795">,</span>&nbsp;<span class="ident" id="7441797">args</span><span class="op" id="7441801">.</span><span class="ident" id="7441802">A</span><span class="op" id="7441803">+</span><span class="ident" id="7441804">args</span><span class="op" id="7441808">.</span><span class="ident" id="7441809">B</span><span class="op" id="7441810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7441814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7441817">}</span><span class="op" id="7441818">)</span><br>
<span class="lineno"></span><span class="op" id="7441820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span><span class="keyword" id="7441823">func</span>&nbsp;<span class="ident" id="7441828">TestCountMallocs</span><span class="op" id="7441844">(</span><span class="ident" id="7441845">t</span>&nbsp;<span class="op" id="7441847">*</span><span class="ident" id="7441848">testing</span><span class="op" id="7441855">.</span><span class="ident" id="7441856">T</span><span class="op" id="7441857">)</span>&nbsp;<span class="op" id="7441859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7441862">if</span>&nbsp;<span class="ident" id="7441865">testing</span><span class="op" id="7441872">.</span><span class="ident" id="7441873">Short</span><span class="op" id="7441878">(</span><span class="op" id="7441879">)</span>&nbsp;<span class="op" id="7441881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7441885">t</span><span class="op" id="7441886">.</span><span class="ident" id="7441887">Skip</span><span class="op" id="7441891">(</span><span class="string" id="7441892">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7441929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7441932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7441935">if</span>&nbsp;<span class="ident" id="7441938">runtime</span><span class="op" id="7441945">.</span><span class="ident" id="7441946">GOMAXPROCS</span><span class="op" id="7441956">(</span><span class="num" id="7441957">0</span><span class="op" id="7441958">)</span>&nbsp;<span class="op" id="7441960">&gt;</span>&nbsp;<span class="num" id="7441962">1</span>&nbsp;<span class="op" id="7441964">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7441968">t</span><span class="op" id="7441969">.</span><span class="ident" id="7441970">Skip</span><span class="op" id="7441974">(</span><span class="string" id="7441975">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="7441999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7442002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7442005">fmt</span><span class="op" id="7442008">.</span><span class="ident" id="7442009">Printf</span><span class="op" id="7442015">(</span><span class="string" id="7442016">&#34;mallocs&nbsp;per&nbsp;rpc&nbsp;round&nbsp;trip:&nbsp;%v\n&#34;</span><span class="op" id="7442050">,</span>&nbsp;<span class="ident" id="7442052">countMallocs</span><span class="op" id="7442064">(</span><span class="ident" id="7442065">dialDirect</span><span class="op" id="7442075">,</span>&nbsp;<span class="ident" id="7442077">t</span><span class="op" id="7442078">)</span><span class="op" id="7442079">)</span><br>
<span class="lineno"></span><span class="op" id="7442081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="7442084">func</span>&nbsp;<span class="ident" id="7442089">TestCountMallocsOverHTTP</span><span class="op" id="7442113">(</span><span class="ident" id="7442114">t</span>&nbsp;<span class="op" id="7442116">*</span><span class="ident" id="7442117">testing</span><span class="op" id="7442124">.</span><span class="ident" id="7442125">T</span><span class="op" id="7442126">)</span>&nbsp;<span class="op" id="7442128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7442131">if</span>&nbsp;<span class="ident" id="7442134">testing</span><span class="op" id="7442141">.</span><span class="ident" id="7442142">Short</span><span class="op" id="7442147">(</span><span class="op" id="7442148">)</span>&nbsp;<span class="op" id="7442150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7442154">t</span><span class="op" id="7442155">.</span><span class="ident" id="7442156">Skip</span><span class="op" id="7442160">(</span><span class="string" id="7442161">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7442198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7442201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7442204">if</span>&nbsp;<span class="ident" id="7442207">runtime</span><span class="op" id="7442214">.</span><span class="ident" id="7442215">GOMAXPROCS</span><span class="op" id="7442225">(</span><span class="num" id="7442226">0</span><span class="op" id="7442227">)</span>&nbsp;<span class="op" id="7442229">&gt;</span>&nbsp;<span class="num" id="7442231">1</span>&nbsp;<span class="op" id="7442233">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7442237">t</span><span class="op" id="7442238">.</span><span class="ident" id="7442239">Skip</span><span class="op" id="7442243">(</span><span class="string" id="7442244">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="7442268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7442271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7442274">fmt</span><span class="op" id="7442277">.</span><span class="ident" id="7442278">Printf</span><span class="op" id="7442284">(</span><span class="string" id="7442285">&#34;mallocs&nbsp;per&nbsp;HTTP&nbsp;rpc&nbsp;round&nbsp;trip:&nbsp;%v\n&#34;</span><span class="op" id="7442324">,</span>&nbsp;<span class="ident" id="7442326">countMallocs</span><span class="op" id="7442338">(</span><span class="ident" id="7442339">dialHTTP</span><span class="op" id="7442347">,</span>&nbsp;<span class="ident" id="7442349">t</span><span class="op" id="7442350">)</span><span class="op" id="7442351">)</span><br>
<span class="lineno"></span><span class="op" id="7442353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="keyword" id="7442356">type</span>&nbsp;<span class="ident" id="7442361">writeCrasher</span>&nbsp;<span class="keyword" id="7442374">struct</span>&nbsp;<span class="op" id="7442381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7442384">done</span>&nbsp;<span class="keyword" id="7442389">chan</span>&nbsp;<span class="builtintype" id="7442394">bool</span><br>
<span class="lineno"></span><span class="op" id="7442399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7442402">func</span>&nbsp;<span class="op" id="7442407">(</span><span class="ident" id="7442408">writeCrasher</span><span class="op" id="7442420">)</span>&nbsp;<span class="ident" id="7442422">Close</span><span class="op" id="7442427">(</span><span class="op" id="7442428">)</span>&nbsp;<span class="builtintype" id="7442430">error</span>&nbsp;<span class="op" id="7442436">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7442439">return</span>&nbsp;<span class="builtintype" id="7442446">nil</span><br>
<span class="lineno"></span><span class="op" id="7442450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7442453">func</span>&nbsp;<span class="op" id="7442458">(</span><span class="ident" id="7442459">w</span>&nbsp;<span class="op" id="7442461">*</span><span class="ident" id="7442462">writeCrasher</span><span class="op" id="7442474">)</span>&nbsp;<span class="ident" id="7442476">Read</span><span class="op" id="7442480">(</span><span class="ident" id="7442481">p</span>&nbsp;<span class="op" id="7442483">[</span><span class="op" id="7442484">]</span><span class="builtintype" id="7442485">byte</span><span class="op" id="7442489">)</span>&nbsp;<span class="op" id="7442491">(</span><span class="builtintype" id="7442492">int</span><span class="op" id="7442495">,</span>&nbsp;<span class="builtintype" id="7442497">error</span><span class="op" id="7442502">)</span>&nbsp;<span class="op" id="7442504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7442507">&lt;-</span><span class="ident" id="7442509">w</span><span class="op" id="7442510">.</span><span class="ident" id="7442511">done</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7442517">return</span>&nbsp;<span class="num" id="7442524">0</span><span class="op" id="7442525">,</span>&nbsp;<span class="ident" id="7442527">io</span><span class="op" id="7442529">.</span><span class="ident" id="7442530">EOF</span><br>
<span class="lineno"></span><span class="op" id="7442534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7442537">func</span>&nbsp;<span class="op" id="7442542">(</span><span class="ident" id="7442543">writeCrasher</span><span class="op" id="7442555">)</span>&nbsp;<span class="ident" id="7442557">Write</span><span class="op" id="7442562">(</span><span class="ident" id="7442563">p</span>&nbsp;<span class="op" id="7442565">[</span><span class="op" id="7442566">]</span><span class="builtintype" id="7442567">byte</span><span class="op" id="7442571">)</span>&nbsp;<span class="op" id="7442573">(</span><span class="builtintype" id="7442574">int</span><span class="op" id="7442577">,</span>&nbsp;<span class="builtintype" id="7442579">error</span><span class="op" id="7442584">)</span>&nbsp;<span class="op" id="7442586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7442589">return</span>&nbsp;<span class="num" id="7442596">0</span><span class="op" id="7442597">,</span>&nbsp;<span class="ident" id="7442599">errors</span><span class="op" id="7442605">.</span><span class="ident" id="7442606">New</span><span class="op" id="7442609">(</span><span class="string" id="7442610">&#34;fake&nbsp;write&nbsp;failure&#34;</span><span class="op" id="7442630">)</span><br>
<span class="lineno">540</span><span class="op" id="7442632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7442635">func</span>&nbsp;<span class="ident" id="7442640">TestClientWriteError</span><span class="op" id="7442660">(</span><span class="ident" id="7442661">t</span>&nbsp;<span class="op" id="7442663">*</span><span class="ident" id="7442664">testing</span><span class="op" id="7442671">.</span><span class="ident" id="7442672">T</span><span class="op" id="7442673">)</span>&nbsp;<span class="op" id="7442675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7442678">w</span>&nbsp;<span class="op" id="7442680">:=</span>&nbsp;<span class="op" id="7442683">&amp;</span><span class="ident" id="7442684">writeCrasher</span><span class="op" id="7442696">{</span><span class="ident" id="7442697">done</span><span class="op" id="7442701">:</span>&nbsp;<span class="builtinfunc" id="7442703">make</span><span class="op" id="7442707">(</span><span class="keyword" id="7442708">chan</span>&nbsp;<span class="builtintype" id="7442713">bool</span><span class="op" id="7442717">)</span><span class="op" id="7442718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7442721">c</span>&nbsp;<span class="op" id="7442723">:=</span>&nbsp;<span class="ident" id="7442726">NewClient</span><span class="op" id="7442735">(</span><span class="ident" id="7442736">w</span><span class="op" id="7442737">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7442740">defer</span>&nbsp;<span class="ident" id="7442746">c</span><span class="op" id="7442747">.</span><span class="ident" id="7442748">Close</span><span class="op" id="7442753">(</span><span class="op" id="7442754">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7442758">res</span>&nbsp;<span class="op" id="7442762">:=</span>&nbsp;<span class="builtintype" id="7442765">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7442772">err</span>&nbsp;<span class="op" id="7442776">:=</span>&nbsp;<span class="ident" id="7442779">c</span><span class="op" id="7442780">.</span><span class="ident" id="7442781">Call</span><span class="op" id="7442785">(</span><span class="string" id="7442786">&#34;foo&#34;</span><span class="op" id="7442791">,</span>&nbsp;<span class="num" id="7442793">1</span><span class="op" id="7442794">,</span>&nbsp;<span class="op" id="7442796">&amp;</span><span class="ident" id="7442797">res</span><span class="op" id="7442800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7442803">if</span>&nbsp;<span class="ident" id="7442806">err</span>&nbsp;<span class="op" id="7442810">==</span>&nbsp;<span class="builtintype" id="7442813">nil</span>&nbsp;<span class="op" id="7442817">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7442821">t</span><span class="op" id="7442822">.</span><span class="ident" id="7442823">Fatal</span><span class="op" id="7442828">(</span><span class="string" id="7442829">&#34;expected&nbsp;error&#34;</span><span class="op" id="7442845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7442848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7442851">if</span>&nbsp;<span class="ident" id="7442854">err</span><span class="op" id="7442857">.</span><span class="ident" id="7442858">Error</span><span class="op" id="7442863">(</span><span class="op" id="7442864">)</span>&nbsp;<span class="op" id="7442866">!=</span>&nbsp;<span class="string" id="7442869">&#34;fake&nbsp;write&nbsp;failure&#34;</span>&nbsp;<span class="op" id="7442890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7442894">t</span><span class="op" id="7442895">.</span><span class="ident" id="7442896">Error</span><span class="op" id="7442901">(</span><span class="string" id="7442902">&#34;unexpected&nbsp;value&nbsp;of&nbsp;error:&#34;</span><span class="op" id="7442930">,</span>&nbsp;<span class="ident" id="7442932">err</span><span class="op" id="7442935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7442938">}</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7442941">w</span><span class="op" id="7442942">.</span><span class="ident" id="7442943">done</span>&nbsp;<span class="op" id="7442948">&lt;-</span>&nbsp;<span class="builtintype" id="7442951">true</span><br>
<span class="lineno"></span><span class="op" id="7442956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7442959">func</span>&nbsp;<span class="ident" id="7442964">TestTCPClose</span><span class="op" id="7442976">(</span><span class="ident" id="7442977">t</span>&nbsp;<span class="op" id="7442979">*</span><span class="ident" id="7442980">testing</span><span class="op" id="7442987">.</span><span class="ident" id="7442988">T</span><span class="op" id="7442989">)</span>&nbsp;<span class="op" id="7442991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7442994">once</span><span class="op" id="7442998">.</span><span class="ident" id="7442999">Do</span><span class="op" id="7443001">(</span><span class="ident" id="7443002">startServer</span><span class="op" id="7443013">)</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7443017">client</span><span class="op" id="7443023">,</span>&nbsp;<span class="ident" id="7443025">err</span>&nbsp;<span class="op" id="7443029">:=</span>&nbsp;<span class="ident" id="7443032">dialHTTP</span><span class="op" id="7443040">(</span><span class="op" id="7443041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7443044">if</span>&nbsp;<span class="ident" id="7443047">err</span>&nbsp;<span class="op" id="7443051">!=</span>&nbsp;<span class="builtintype" id="7443054">nil</span>&nbsp;<span class="op" id="7443058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7443062">t</span><span class="op" id="7443063">.</span><span class="ident" id="7443064">Fatalf</span><span class="op" id="7443070">(</span><span class="string" id="7443071">&#34;dialing:&nbsp;%v&#34;</span><span class="op" id="7443084">,</span>&nbsp;<span class="ident" id="7443086">err</span><span class="op" id="7443089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7443092">}</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7443095">defer</span>&nbsp;<span class="ident" id="7443101">client</span><span class="op" id="7443107">.</span><span class="ident" id="7443108">Close</span><span class="op" id="7443113">(</span><span class="op" id="7443114">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7443118">args</span>&nbsp;<span class="op" id="7443123">:=</span>&nbsp;<span class="ident" id="7443126">Args</span><span class="op" id="7443130">{</span><span class="num" id="7443131">17</span><span class="op" id="7443133">,</span>&nbsp;<span class="num" id="7443135">8</span><span class="op" id="7443136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7443139">var</span>&nbsp;<span class="ident" id="7443143">reply</span>&nbsp;<span class="ident" id="7443149">Reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7443156">err</span>&nbsp;<span class="op" id="7443160">=</span>&nbsp;<span class="ident" id="7443162">client</span><span class="op" id="7443168">.</span><span class="ident" id="7443169">Call</span><span class="op" id="7443173">(</span><span class="string" id="7443174">&#34;Arith.Mul&#34;</span><span class="op" id="7443185">,</span>&nbsp;<span class="ident" id="7443187">args</span><span class="op" id="7443191">,</span>&nbsp;<span class="op" id="7443193">&amp;</span><span class="ident" id="7443194">reply</span><span class="op" id="7443199">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7443202">if</span>&nbsp;<span class="ident" id="7443205">err</span>&nbsp;<span class="op" id="7443209">!=</span>&nbsp;<span class="builtintype" id="7443212">nil</span>&nbsp;<span class="op" id="7443216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7443220">t</span><span class="op" id="7443221">.</span><span class="ident" id="7443222">Fatal</span><span class="op" id="7443227">(</span><span class="string" id="7443228">&#34;arith&nbsp;error:&#34;</span><span class="op" id="7443242">,</span>&nbsp;<span class="ident" id="7443244">err</span><span class="op" id="7443247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7443250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7443253">t</span><span class="op" id="7443254">.</span><span class="ident" id="7443255">Logf</span><span class="op" id="7443259">(</span><span class="string" id="7443260">&#34;Arith:&nbsp;%d*%d=%d\n&#34;</span><span class="op" id="7443279">,</span>&nbsp;<span class="ident" id="7443281">args</span><span class="op" id="7443285">.</span><span class="ident" id="7443286">A</span><span class="op" id="7443287">,</span>&nbsp;<span class="ident" id="7443289">args</span><span class="op" id="7443293">.</span><span class="ident" id="7443294">B</span><span class="op" id="7443295">,</span>&nbsp;<span class="ident" id="7443297">reply</span><span class="op" id="7443302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7443305">if</span>&nbsp;<span class="ident" id="7443308">reply</span><span class="op" id="7443313">.</span><span class="ident" id="7443314">C</span>&nbsp;<span class="op" id="7443316">!=</span>&nbsp;<span class="ident" id="7443319">args</span><span class="op" id="7443323">.</span><span class="ident" id="7443324">A</span><span class="op" id="7443325">*</span><span class="ident" id="7443326">args</span><span class="op" id="7443330">.</span><span class="ident" id="7443331">B</span>&nbsp;<span class="op" id="7443333">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7443337">t</span><span class="op" id="7443338">.</span><span class="ident" id="7443339">Errorf</span><span class="op" id="7443345">(</span><span class="string" id="7443346">&#34;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7443371">,</span>&nbsp;<span class="ident" id="7443373">reply</span><span class="op" id="7443378">.</span><span class="ident" id="7443379">C</span><span class="op" id="7443380">,</span>&nbsp;<span class="ident" id="7443382">args</span><span class="op" id="7443386">.</span><span class="ident" id="7443387">A</span><span class="op" id="7443388">*</span><span class="ident" id="7443389">args</span><span class="op" id="7443393">.</span><span class="ident" id="7443394">B</span><span class="op" id="7443395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7443398">}</span><br>
<span class="lineno"></span><span class="op" id="7443400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7443403">func</span>&nbsp;<span class="ident" id="7443408">TestErrorAfterClientClose</span><span class="op" id="7443433">(</span><span class="ident" id="7443434">t</span>&nbsp;<span class="op" id="7443436">*</span><span class="ident" id="7443437">testing</span><span class="op" id="7443444">.</span><span class="ident" id="7443445">T</span><span class="op" id="7443446">)</span>&nbsp;<span class="op" id="7443448">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7443451">once</span><span class="op" id="7443455">.</span><span class="ident" id="7443456">Do</span><span class="op" id="7443458">(</span><span class="ident" id="7443459">startServer</span><span class="op" id="7443470">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7443474">client</span><span class="op" id="7443480">,</span>&nbsp;<span class="ident" id="7443482">err</span>&nbsp;<span class="op" id="7443486">:=</span>&nbsp;<span class="ident" id="7443489">dialHTTP</span><span class="op" id="7443497">(</span><span class="op" id="7443498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7443501">if</span>&nbsp;<span class="ident" id="7443504">err</span>&nbsp;<span class="op" id="7443508">!=</span>&nbsp;<span class="builtintype" id="7443511">nil</span>&nbsp;<span class="op" id="7443515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7443519">t</span><span class="op" id="7443520">.</span><span class="ident" id="7443521">Fatalf</span><span class="op" id="7443527">(</span><span class="string" id="7443528">&#34;dialing:&nbsp;%v&#34;</span><span class="op" id="7443541">,</span>&nbsp;<span class="ident" id="7443543">err</span><span class="op" id="7443546">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7443549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7443552">err</span>&nbsp;<span class="op" id="7443556">=</span>&nbsp;<span class="ident" id="7443558">client</span><span class="op" id="7443564">.</span><span class="ident" id="7443565">Close</span><span class="op" id="7443570">(</span><span class="op" id="7443571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7443574">if</span>&nbsp;<span class="ident" id="7443577">err</span>&nbsp;<span class="op" id="7443581">!=</span>&nbsp;<span class="builtintype" id="7443584">nil</span>&nbsp;<span class="op" id="7443588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7443592">t</span><span class="op" id="7443593">.</span><span class="ident" id="7443594">Fatal</span><span class="op" id="7443599">(</span><span class="string" id="7443600">&#34;close&nbsp;error:&#34;</span><span class="op" id="7443614">,</span>&nbsp;<span class="ident" id="7443616">err</span><span class="op" id="7443619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7443622">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7443625">err</span>&nbsp;<span class="op" id="7443629">=</span>&nbsp;<span class="ident" id="7443631">client</span><span class="op" id="7443637">.</span><span class="ident" id="7443638">Call</span><span class="op" id="7443642">(</span><span class="string" id="7443643">&#34;Arith.Add&#34;</span><span class="op" id="7443654">,</span>&nbsp;<span class="op" id="7443656">&amp;</span><span class="ident" id="7443657">Args</span><span class="op" id="7443661">{</span><span class="num" id="7443662">7</span><span class="op" id="7443663">,</span>&nbsp;<span class="num" id="7443665">9</span><span class="op" id="7443666">}</span><span class="op" id="7443667">,</span>&nbsp;<span class="builtinfunc" id="7443669">new</span><span class="op" id="7443672">(</span><span class="ident" id="7443673">Reply</span><span class="op" id="7443678">)</span><span class="op" id="7443679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7443682">if</span>&nbsp;<span class="ident" id="7443685">err</span>&nbsp;<span class="op" id="7443689">!=</span>&nbsp;<span class="ident" id="7443692">ErrShutdown</span>&nbsp;<span class="op" id="7443704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7443708">t</span><span class="op" id="7443709">.</span><span class="ident" id="7443710">Errorf</span><span class="op" id="7443716">(</span><span class="string" id="7443717">&#34;Forever:&nbsp;expected&nbsp;ErrShutdown&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7443755">,</span>&nbsp;<span class="ident" id="7443757">err</span><span class="op" id="7443760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7443763">}</span><br>
<span class="lineno"></span><span class="op" id="7443765">}</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="keyword" id="7443768">func</span>&nbsp;<span class="ident" id="7443773">benchmarkEndToEnd</span><span class="op" id="7443790">(</span><span class="ident" id="7443791">dial</span>&nbsp;<span class="keyword" id="7443796">func</span><span class="op" id="7443800">(</span><span class="op" id="7443801">)</span>&nbsp;<span class="op" id="7443803">(</span><span class="op" id="7443804">*</span><span class="ident" id="7443805">Client</span><span class="op" id="7443811">,</span>&nbsp;<span class="builtintype" id="7443813">error</span><span class="op" id="7443818">)</span><span class="op" id="7443819">,</span>&nbsp;<span class="ident" id="7443821">b</span>&nbsp;<span class="op" id="7443823">*</span><span class="ident" id="7443824">testing</span><span class="op" id="7443831">.</span><span class="ident" id="7443832">B</span><span class="op" id="7443833">)</span>&nbsp;<span class="op" id="7443835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7443838">once</span><span class="op" id="7443842">.</span><span class="ident" id="7443843">Do</span><span class="op" id="7443845">(</span><span class="ident" id="7443846">startServer</span><span class="op" id="7443857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7443860">client</span><span class="op" id="7443866">,</span>&nbsp;<span class="ident" id="7443868">err</span>&nbsp;<span class="op" id="7443872">:=</span>&nbsp;<span class="ident" id="7443875">dial</span><span class="op" id="7443879">(</span><span class="op" id="7443880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7443883">if</span>&nbsp;<span class="ident" id="7443886">err</span>&nbsp;<span class="op" id="7443890">!=</span>&nbsp;<span class="builtintype" id="7443893">nil</span>&nbsp;<span class="op" id="7443897">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7443901">b</span><span class="op" id="7443902">.</span><span class="ident" id="7443903">Fatal</span><span class="op" id="7443908">(</span><span class="string" id="7443909">&#34;error&nbsp;dialing:&#34;</span><span class="op" id="7443925">,</span>&nbsp;<span class="ident" id="7443927">err</span><span class="op" id="7443930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7443933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7443936">defer</span>&nbsp;<span class="ident" id="7443942">client</span><span class="op" id="7443948">.</span><span class="ident" id="7443949">Close</span><span class="op" id="7443954">(</span><span class="op" id="7443955">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7443959">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7443981">args</span>&nbsp;<span class="op" id="7443986">:=</span>&nbsp;<span class="op" id="7443989">&amp;</span><span class="ident" id="7443990">Args</span><span class="op" id="7443994">{</span><span class="num" id="7443995">7</span><span class="op" id="7443996">,</span>&nbsp;<span class="num" id="7443998">8</span><span class="op" id="7443999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7444002">b</span><span class="op" id="7444003">.</span><span class="ident" id="7444004">ResetTimer</span><span class="op" id="7444014">(</span><span class="op" id="7444015">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7444019">b</span><span class="op" id="7444020">.</span><span class="ident" id="7444021">RunParallel</span><span class="op" id="7444032">(</span><span class="keyword" id="7444033">func</span><span class="op" id="7444037">(</span><span class="ident" id="7444038">pb</span>&nbsp;<span class="op" id="7444041">*</span><span class="ident" id="7444042">testing</span><span class="op" id="7444049">.</span><span class="ident" id="7444050">PB</span><span class="op" id="7444052">)</span>&nbsp;<span class="op" id="7444054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7444058">reply</span>&nbsp;<span class="op" id="7444064">:=</span>&nbsp;<span class="builtinfunc" id="7444067">new</span><span class="op" id="7444070">(</span><span class="ident" id="7444071">Reply</span><span class="op" id="7444076">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7444080">for</span>&nbsp;<span class="ident" id="7444084">pb</span><span class="op" id="7444086">.</span><span class="ident" id="7444087">Next</span><span class="op" id="7444091">(</span><span class="op" id="7444092">)</span>&nbsp;<span class="op" id="7444094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7444099">err</span>&nbsp;<span class="op" id="7444103">:=</span>&nbsp;<span class="ident" id="7444106">client</span><span class="op" id="7444112">.</span><span class="ident" id="7444113">Call</span><span class="op" id="7444117">(</span><span class="string" id="7444118">&#34;Arith.Add&#34;</span><span class="op" id="7444129">,</span>&nbsp;<span class="ident" id="7444131">args</span><span class="op" id="7444135">,</span>&nbsp;<span class="ident" id="7444137">reply</span><span class="op" id="7444142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7444147">if</span>&nbsp;<span class="ident" id="7444150">err</span>&nbsp;<span class="op" id="7444154">!=</span>&nbsp;<span class="builtintype" id="7444157">nil</span>&nbsp;<span class="op" id="7444161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7444167">b</span><span class="op" id="7444168">.</span><span class="ident" id="7444169">Fatalf</span><span class="op" id="7444175">(</span><span class="string" id="7444176">&#34;rpc&nbsp;error:&nbsp;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7444229">,</span>&nbsp;<span class="ident" id="7444231">err</span><span class="op" id="7444234">.</span><span class="ident" id="7444235">Error</span><span class="op" id="7444240">(</span><span class="op" id="7444241">)</span><span class="op" id="7444242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7444247">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7444252">if</span>&nbsp;<span class="ident" id="7444255">reply</span><span class="op" id="7444260">.</span><span class="ident" id="7444261">C</span>&nbsp;<span class="op" id="7444263">!=</span>&nbsp;<span class="ident" id="7444266">args</span><span class="op" id="7444270">.</span><span class="ident" id="7444271">A</span><span class="op" id="7444272">+</span><span class="ident" id="7444273">args</span><span class="op" id="7444277">.</span><span class="ident" id="7444278">B</span>&nbsp;<span class="op" id="7444280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7444286">b</span><span class="op" id="7444287">.</span><span class="ident" id="7444288">Fatalf</span><span class="op" id="7444294">(</span><span class="string" id="7444295">&#34;rpc&nbsp;error:&nbsp;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7444331">,</span>&nbsp;<span class="ident" id="7444333">reply</span><span class="op" id="7444338">.</span><span class="ident" id="7444339">C</span><span class="op" id="7444340">,</span>&nbsp;<span class="ident" id="7444342">args</span><span class="op" id="7444346">.</span><span class="ident" id="7444347">A</span><span class="op" id="7444348">+</span><span class="ident" id="7444349">args</span><span class="op" id="7444353">.</span><span class="ident" id="7444354">B</span><span class="op" id="7444355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7444360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7444364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7444367">}</span><span class="op" id="7444368">)</span><br>
<span class="lineno">620</span><span class="op" id="7444370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7444373">func</span>&nbsp;<span class="ident" id="7444378">benchmarkEndToEndAsync</span><span class="op" id="7444400">(</span><span class="ident" id="7444401">dial</span>&nbsp;<span class="keyword" id="7444406">func</span><span class="op" id="7444410">(</span><span class="op" id="7444411">)</span>&nbsp;<span class="op" id="7444413">(</span><span class="op" id="7444414">*</span><span class="ident" id="7444415">Client</span><span class="op" id="7444421">,</span>&nbsp;<span class="builtintype" id="7444423">error</span><span class="op" id="7444428">)</span><span class="op" id="7444429">,</span>&nbsp;<span class="ident" id="7444431">b</span>&nbsp;<span class="op" id="7444433">*</span><span class="ident" id="7444434">testing</span><span class="op" id="7444441">.</span><span class="ident" id="7444442">B</span><span class="op" id="7444443">)</span>&nbsp;<span class="op" id="7444445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7444448">const</span>&nbsp;<span class="ident" id="7444454">MaxConcurrentCalls</span>&nbsp;<span class="op" id="7444473">=</span>&nbsp;<span class="num" id="7444475">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7444480">once</span><span class="op" id="7444484">.</span><span class="ident" id="7444485">Do</span><span class="op" id="7444487">(</span><span class="ident" id="7444488">startServer</span><span class="op" id="7444499">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7444502">client</span><span class="op" id="7444508">,</span>&nbsp;<span class="ident" id="7444510">err</span>&nbsp;<span class="op" id="7444514">:=</span>&nbsp;<span class="ident" id="7444517">dial</span><span class="op" id="7444521">(</span><span class="op" id="7444522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7444525">if</span>&nbsp;<span class="ident" id="7444528">err</span>&nbsp;<span class="op" id="7444532">!=</span>&nbsp;<span class="builtintype" id="7444535">nil</span>&nbsp;<span class="op" id="7444539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7444543">b</span><span class="op" id="7444544">.</span><span class="ident" id="7444545">Fatal</span><span class="op" id="7444550">(</span><span class="string" id="7444551">&#34;error&nbsp;dialing:&#34;</span><span class="op" id="7444567">,</span>&nbsp;<span class="ident" id="7444569">err</span><span class="op" id="7444572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7444575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7444578">defer</span>&nbsp;<span class="ident" id="7444584">client</span><span class="op" id="7444590">.</span><span class="ident" id="7444591">Close</span><span class="op" id="7444596">(</span><span class="op" id="7444597">)</span><br>
<span class="lineno">630</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7444601">//&nbsp;Asynchronous&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7444624">args</span>&nbsp;<span class="op" id="7444629">:=</span>&nbsp;<span class="op" id="7444632">&amp;</span><span class="ident" id="7444633">Args</span><span class="op" id="7444637">{</span><span class="num" id="7444638">7</span><span class="op" id="7444639">,</span>&nbsp;<span class="num" id="7444641">8</span><span class="op" id="7444642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7444645">procs</span>&nbsp;<span class="op" id="7444651">:=</span>&nbsp;<span class="num" id="7444654">4</span>&nbsp;<span class="op" id="7444656">*</span>&nbsp;<span class="ident" id="7444658">runtime</span><span class="op" id="7444665">.</span><span class="ident" id="7444666">GOMAXPROCS</span><span class="op" id="7444676">(</span><span class="op" id="7444677">-</span><span class="num" id="7444678">1</span><span class="op" id="7444679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7444682">send</span>&nbsp;<span class="op" id="7444687">:=</span>&nbsp;<span class="builtintype" id="7444690">int32</span><span class="op" id="7444695">(</span><span class="ident" id="7444696">b</span><span class="op" id="7444697">.</span><span class="ident" id="7444698">N</span><span class="op" id="7444699">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7444702">recv</span>&nbsp;<span class="op" id="7444707">:=</span>&nbsp;<span class="builtintype" id="7444710">int32</span><span class="op" id="7444715">(</span><span class="ident" id="7444716">b</span><span class="op" id="7444717">.</span><span class="ident" id="7444718">N</span><span class="op" id="7444719">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7444722">var</span>&nbsp;<span class="ident" id="7444726">wg</span>&nbsp;<span class="ident" id="7444729">sync</span><span class="op" id="7444733">.</span><span class="ident" id="7444734">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7444745">wg</span><span class="op" id="7444747">.</span><span class="ident" id="7444748">Add</span><span class="op" id="7444751">(</span><span class="ident" id="7444752">procs</span><span class="op" id="7444757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7444760">gate</span>&nbsp;<span class="op" id="7444765">:=</span>&nbsp;<span class="builtinfunc" id="7444768">make</span><span class="op" id="7444772">(</span><span class="keyword" id="7444773">chan</span>&nbsp;<span class="builtintype" id="7444778">bool</span><span class="op" id="7444782">,</span>&nbsp;<span class="ident" id="7444784">MaxConcurrentCalls</span><span class="op" id="7444802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7444805">res</span>&nbsp;<span class="op" id="7444809">:=</span>&nbsp;<span class="builtinfunc" id="7444812">make</span><span class="op" id="7444816">(</span><span class="keyword" id="7444817">chan</span>&nbsp;<span class="op" id="7444822">*</span><span class="ident" id="7444823">Call</span><span class="op" id="7444827">,</span>&nbsp;<span class="ident" id="7444829">MaxConcurrentCalls</span><span class="op" id="7444847">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7444850">b</span><span class="op" id="7444851">.</span><span class="ident" id="7444852">ResetTimer</span><span class="op" id="7444862">(</span><span class="op" id="7444863">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7444867">for</span>&nbsp;<span class="ident" id="7444871">p</span>&nbsp;<span class="op" id="7444873">:=</span>&nbsp;<span class="num" id="7444876">0</span><span class="op" id="7444877">;</span>&nbsp;<span class="ident" id="7444879">p</span>&nbsp;<span class="op" id="7444881">&lt;</span>&nbsp;<span class="ident" id="7444883">procs</span><span class="op" id="7444888">;</span>&nbsp;<span class="ident" id="7444890">p</span><span class="op" id="7444891">++</span>&nbsp;<span class="op" id="7444894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7444898">go</span>&nbsp;<span class="keyword" id="7444901">func</span><span class="op" id="7444905">(</span><span class="op" id="7444906">)</span>&nbsp;<span class="op" id="7444908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7444913">for</span>&nbsp;<span class="ident" id="7444917">atomic</span><span class="op" id="7444923">.</span><span class="ident" id="7444924">AddInt32</span><span class="op" id="7444932">(</span><span class="op" id="7444933">&amp;</span><span class="ident" id="7444934">send</span><span class="op" id="7444938">,</span>&nbsp;<span class="op" id="7444940">-</span><span class="num" id="7444941">1</span><span class="op" id="7444942">)</span>&nbsp;<span class="op" id="7444944">&gt;=</span>&nbsp;<span class="num" id="7444947">0</span>&nbsp;<span class="op" id="7444949">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7444955">gate</span>&nbsp;<span class="op" id="7444960">&lt;-</span>&nbsp;<span class="builtintype" id="7444963">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7444972">reply</span>&nbsp;<span class="op" id="7444978">:=</span>&nbsp;<span class="builtinfunc" id="7444981">new</span><span class="op" id="7444984">(</span><span class="ident" id="7444985">Reply</span><span class="op" id="7444990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7444996">client</span><span class="op" id="7445002">.</span><span class="ident" id="7445003">Go</span><span class="op" id="7445005">(</span><span class="string" id="7445006">&#34;Arith.Add&#34;</span><span class="op" id="7445017">,</span>&nbsp;<span class="ident" id="7445019">args</span><span class="op" id="7445023">,</span>&nbsp;<span class="ident" id="7445025">reply</span><span class="op" id="7445030">,</span>&nbsp;<span class="ident" id="7445032">res</span><span class="op" id="7445035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7445040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7445044">}</span><span class="op" id="7445045">(</span><span class="op" id="7445046">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7445050">go</span>&nbsp;<span class="keyword" id="7445053">func</span><span class="op" id="7445057">(</span><span class="op" id="7445058">)</span>&nbsp;<span class="op" id="7445060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7445065">for</span>&nbsp;<span class="ident" id="7445069">call</span>&nbsp;<span class="op" id="7445074">:=</span>&nbsp;<span class="keyword" id="7445077">range</span>&nbsp;<span class="ident" id="7445083">res</span>&nbsp;<span class="op" id="7445087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7445093">A</span>&nbsp;<span class="op" id="7445095">:=</span>&nbsp;<span class="ident" id="7445098">call</span><span class="op" id="7445102">.</span><span class="ident" id="7445103">Args</span><span class="op" id="7445107">.</span><span class="op" id="7445108">(</span><span class="op" id="7445109">*</span><span class="ident" id="7445110">Args</span><span class="op" id="7445114">)</span><span class="op" id="7445115">.</span><span class="ident" id="7445116">A</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7445122">B</span>&nbsp;<span class="op" id="7445124">:=</span>&nbsp;<span class="ident" id="7445127">call</span><span class="op" id="7445131">.</span><span class="ident" id="7445132">Args</span><span class="op" id="7445136">.</span><span class="op" id="7445137">(</span><span class="op" id="7445138">*</span><span class="ident" id="7445139">Args</span><span class="op" id="7445143">)</span><span class="op" id="7445144">.</span><span class="ident" id="7445145">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7445151">C</span>&nbsp;<span class="op" id="7445153">:=</span>&nbsp;<span class="ident" id="7445156">call</span><span class="op" id="7445160">.</span><span class="ident" id="7445161">Reply</span><span class="op" id="7445166">.</span><span class="op" id="7445167">(</span><span class="op" id="7445168">*</span><span class="ident" id="7445169">Reply</span><span class="op" id="7445174">)</span><span class="op" id="7445175">.</span><span class="ident" id="7445176">C</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7445182">if</span>&nbsp;<span class="ident" id="7445185">A</span><span class="op" id="7445186">+</span><span class="ident" id="7445187">B</span>&nbsp;<span class="op" id="7445189">!=</span>&nbsp;<span class="ident" id="7445192">C</span>&nbsp;<span class="op" id="7445194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7445201">b</span><span class="op" id="7445202">.</span><span class="ident" id="7445203">Fatalf</span><span class="op" id="7445209">(</span><span class="string" id="7445210">&#34;incorrect&nbsp;reply:&nbsp;Add:&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7445252">,</span>&nbsp;<span class="ident" id="7445254">A</span><span class="op" id="7445255">+</span><span class="ident" id="7445256">B</span><span class="op" id="7445257">,</span>&nbsp;<span class="ident" id="7445259">C</span><span class="op" id="7445260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7445266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7445272">&lt;-</span><span class="ident" id="7445274">gate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7445283">if</span>&nbsp;<span class="ident" id="7445286">atomic</span><span class="op" id="7445292">.</span><span class="ident" id="7445293">AddInt32</span><span class="op" id="7445301">(</span><span class="op" id="7445302">&amp;</span><span class="ident" id="7445303">recv</span><span class="op" id="7445307">,</span>&nbsp;<span class="op" id="7445309">-</span><span class="num" id="7445310">1</span><span class="op" id="7445311">)</span>&nbsp;<span class="op" id="7445313">==</span>&nbsp;<span class="num" id="7445316">0</span>&nbsp;<span class="op" id="7445318">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="7445325">close</span><span class="op" id="7445330">(</span><span class="ident" id="7445331">res</span><span class="op" id="7445334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7445340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7445345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7445350">wg</span><span class="op" id="7445352">.</span><span class="ident" id="7445353">Done</span><span class="op" id="7445357">(</span><span class="op" id="7445358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7445362">}</span><span class="op" id="7445363">(</span><span class="op" id="7445364">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7445367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7445370">wg</span><span class="op" id="7445372">.</span><span class="ident" id="7445373">Wait</span><span class="op" id="7445377">(</span><span class="op" id="7445378">)</span><br>
<span class="lineno"></span><span class="op" id="7445380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7445383">func</span>&nbsp;<span class="ident" id="7445388">BenchmarkEndToEnd</span><span class="op" id="7445405">(</span><span class="ident" id="7445406">b</span>&nbsp;<span class="op" id="7445408">*</span><span class="ident" id="7445409">testing</span><span class="op" id="7445416">.</span><span class="ident" id="7445417">B</span><span class="op" id="7445418">)</span>&nbsp;<span class="op" id="7445420">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7445423">benchmarkEndToEnd</span><span class="op" id="7445440">(</span><span class="ident" id="7445441">dialDirect</span><span class="op" id="7445451">,</span>&nbsp;<span class="ident" id="7445453">b</span><span class="op" id="7445454">)</span><br>
<span class="lineno"></span><span class="op" id="7445456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7445459">func</span>&nbsp;<span class="ident" id="7445464">BenchmarkEndToEndHTTP</span><span class="op" id="7445485">(</span><span class="ident" id="7445486">b</span>&nbsp;<span class="op" id="7445488">*</span><span class="ident" id="7445489">testing</span><span class="op" id="7445496">.</span><span class="ident" id="7445497">B</span><span class="op" id="7445498">)</span>&nbsp;<span class="op" id="7445500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7445503">benchmarkEndToEnd</span><span class="op" id="7445520">(</span><span class="ident" id="7445521">dialHTTP</span><span class="op" id="7445529">,</span>&nbsp;<span class="ident" id="7445531">b</span><span class="op" id="7445532">)</span><br>
<span class="lineno">675</span><span class="op" id="7445534">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7445537">func</span>&nbsp;<span class="ident" id="7445542">BenchmarkEndToEndAsync</span><span class="op" id="7445564">(</span><span class="ident" id="7445565">b</span>&nbsp;<span class="op" id="7445567">*</span><span class="ident" id="7445568">testing</span><span class="op" id="7445575">.</span><span class="ident" id="7445576">B</span><span class="op" id="7445577">)</span>&nbsp;<span class="op" id="7445579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7445582">benchmarkEndToEndAsync</span><span class="op" id="7445604">(</span><span class="ident" id="7445605">dialDirect</span><span class="op" id="7445615">,</span>&nbsp;<span class="ident" id="7445617">b</span><span class="op" id="7445618">)</span><br>
<span class="lineno"></span><span class="op" id="7445620">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span><span class="keyword" id="7445623">func</span>&nbsp;<span class="ident" id="7445628">BenchmarkEndToEndAsyncHTTP</span><span class="op" id="7445654">(</span><span class="ident" id="7445655">b</span>&nbsp;<span class="op" id="7445657">*</span><span class="ident" id="7445658">testing</span><span class="op" id="7445665">.</span><span class="ident" id="7445666">B</span><span class="op" id="7445667">)</span>&nbsp;<span class="op" id="7445669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7445672">benchmarkEndToEndAsync</span><span class="op" id="7445694">(</span><span class="ident" id="7445695">dialHTTP</span><span class="op" id="7445703">,</span>&nbsp;<span class="ident" id="7445705">b</span><span class="op" id="7445706">)</span><br>
<span class="lineno"></span><span class="op" id="7445708">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
