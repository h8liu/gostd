<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>path/filepath</h2>
<ul>
<li><a href="/gostd/path/filepath/example_unix_test.go.html">example_unix_test.go</a></li>
<li><a href="/gostd/path/filepath/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/path/filepath/match.go.html">match.go</a></li>
<li><a href="/gostd/path/filepath/match_test.go.html">match_test.go</a></li>
<li><a href="/gostd/path/filepath/path.go.html" class="current">path.go</a></li>
<li><a href="/gostd/path/filepath/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/path/filepath/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/path/filepath/symlink.go.html">symlink.go</a></li>
<li><a href="/gostd/path/filepath/symlink_unix.go.html">symlink_unix.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3151987">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3152042">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3152096">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3152147">//&nbsp;Package&nbsp;filepath&nbsp;implements&nbsp;utility&nbsp;routines&nbsp;for&nbsp;manipulating&nbsp;filename&nbsp;paths</span><br>
<span class="lineno"></span><span class="comment" id="3152227">//&nbsp;in&nbsp;a&nbsp;way&nbsp;compatible&nbsp;with&nbsp;the&nbsp;target&nbsp;operating&nbsp;system-defined&nbsp;file&nbsp;paths.</span><br>
<span class="lineno"></span><span class="keyword" id="3152303">package</span>&nbsp;<span class="ident" id="3152311">filepath</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3152321">import</span>&nbsp;<span class="op" id="3152328">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3152331">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3152341">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3152347">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3152355">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3152365">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3152368">//&nbsp;A&nbsp;lazybuf&nbsp;is&nbsp;a&nbsp;lazily&nbsp;constructed&nbsp;path&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="3152418">//&nbsp;It&nbsp;supports&nbsp;append,&nbsp;reading&nbsp;previously&nbsp;appended&nbsp;bytes,</span><br>
<span class="lineno"></span><span class="comment" id="3152476">//&nbsp;and&nbsp;retrieving&nbsp;the&nbsp;final&nbsp;string.&nbsp;It&nbsp;does&nbsp;not&nbsp;allocate&nbsp;a&nbsp;buffer</span><br>
<span class="lineno"></span><span class="comment" id="3152542">//&nbsp;to&nbsp;hold&nbsp;the&nbsp;output&nbsp;until&nbsp;that&nbsp;output&nbsp;diverges&nbsp;from&nbsp;s.</span><br>
<span class="lineno">20</span><span class="keyword" id="3152599">type</span>&nbsp;<span class="ident" id="3152604">lazybuf</span>&nbsp;<span class="keyword" id="3152612">struct</span>&nbsp;<span class="op" id="3152619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3152622">path</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3152633">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3152641">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3152652">[</span><span class="op" id="3152653">]</span><span class="builtintype" id="3152654">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3152660">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3152671">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3152676">volAndPath</span>&nbsp;<span class="builtintype" id="3152687">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3152695">volLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3152706">int</span><br>
<span class="lineno"></span><span class="op" id="3152710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3152713">func</span>&nbsp;<span class="op" id="3152718">(</span><span class="ident" id="3152719">b</span>&nbsp;<span class="op" id="3152721">*</span><span class="ident" id="3152722">lazybuf</span><span class="op" id="3152729">)</span>&nbsp;<span class="ident" id="3152731">index</span><span class="op" id="3152736">(</span><span class="ident" id="3152737">i</span>&nbsp;<span class="builtintype" id="3152739">int</span><span class="op" id="3152742">)</span>&nbsp;<span class="builtintype" id="3152744">byte</span>&nbsp;<span class="op" id="3152749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3152752">if</span>&nbsp;<span class="ident" id="3152755">b</span><span class="op" id="3152756">.</span><span class="ident" id="3152757">buf</span>&nbsp;<span class="op" id="3152761">!=</span>&nbsp;<span class="builtintype" id="3152764">nil</span>&nbsp;<span class="op" id="3152768">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3152772">return</span>&nbsp;<span class="ident" id="3152779">b</span><span class="op" id="3152780">.</span><span class="ident" id="3152781">buf</span><span class="op" id="3152784">[</span><span class="ident" id="3152785">i</span><span class="op" id="3152786">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3152789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3152792">return</span>&nbsp;<span class="ident" id="3152799">b</span><span class="op" id="3152800">.</span><span class="ident" id="3152801">path</span><span class="op" id="3152805">[</span><span class="ident" id="3152806">i</span><span class="op" id="3152807">]</span><br>
<span class="lineno"></span><span class="op" id="3152809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="keyword" id="3152812">func</span>&nbsp;<span class="op" id="3152817">(</span><span class="ident" id="3152818">b</span>&nbsp;<span class="op" id="3152820">*</span><span class="ident" id="3152821">lazybuf</span><span class="op" id="3152828">)</span>&nbsp;<span class="builtinfunc" id="3152830">append</span><span class="op" id="3152836">(</span><span class="ident" id="3152837">c</span>&nbsp;<span class="builtintype" id="3152839">byte</span><span class="op" id="3152843">)</span>&nbsp;<span class="op" id="3152845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3152848">if</span>&nbsp;<span class="ident" id="3152851">b</span><span class="op" id="3152852">.</span><span class="ident" id="3152853">buf</span>&nbsp;<span class="op" id="3152857">==</span>&nbsp;<span class="builtintype" id="3152860">nil</span>&nbsp;<span class="op" id="3152864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3152868">if</span>&nbsp;<span class="ident" id="3152871">b</span><span class="op" id="3152872">.</span><span class="ident" id="3152873">w</span>&nbsp;<span class="op" id="3152875">&lt;</span>&nbsp;<span class="builtinfunc" id="3152877">len</span><span class="op" id="3152880">(</span><span class="ident" id="3152881">b</span><span class="op" id="3152882">.</span><span class="ident" id="3152883">path</span><span class="op" id="3152887">)</span>&nbsp;<span class="op" id="3152889">&amp;&amp;</span>&nbsp;<span class="ident" id="3152892">b</span><span class="op" id="3152893">.</span><span class="ident" id="3152894">path</span><span class="op" id="3152898">[</span><span class="ident" id="3152899">b</span><span class="op" id="3152900">.</span><span class="ident" id="3152901">w</span><span class="op" id="3152902">]</span>&nbsp;<span class="op" id="3152904">==</span>&nbsp;<span class="ident" id="3152907">c</span>&nbsp;<span class="op" id="3152909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3152914">b</span><span class="op" id="3152915">.</span><span class="ident" id="3152916">w</span><span class="op" id="3152917">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3152923">return</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3152932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3152936">b</span><span class="op" id="3152937">.</span><span class="ident" id="3152938">buf</span>&nbsp;<span class="op" id="3152942">=</span>&nbsp;<span class="builtinfunc" id="3152944">make</span><span class="op" id="3152948">(</span><span class="op" id="3152949">[</span><span class="op" id="3152950">]</span><span class="builtintype" id="3152951">byte</span><span class="op" id="3152955">,</span>&nbsp;<span class="builtinfunc" id="3152957">len</span><span class="op" id="3152960">(</span><span class="ident" id="3152961">b</span><span class="op" id="3152962">.</span><span class="ident" id="3152963">path</span><span class="op" id="3152967">)</span><span class="op" id="3152968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3152972">copy</span><span class="op" id="3152976">(</span><span class="ident" id="3152977">b</span><span class="op" id="3152978">.</span><span class="ident" id="3152979">buf</span><span class="op" id="3152982">,</span>&nbsp;<span class="ident" id="3152984">b</span><span class="op" id="3152985">.</span><span class="ident" id="3152986">path</span><span class="op" id="3152990">[</span><span class="op" id="3152991">:</span><span class="ident" id="3152992">b</span><span class="op" id="3152993">.</span><span class="ident" id="3152994">w</span><span class="op" id="3152995">]</span><span class="op" id="3152996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3152999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3153002">b</span><span class="op" id="3153003">.</span><span class="ident" id="3153004">buf</span><span class="op" id="3153007">[</span><span class="ident" id="3153008">b</span><span class="op" id="3153009">.</span><span class="ident" id="3153010">w</span><span class="op" id="3153011">]</span>&nbsp;<span class="op" id="3153013">=</span>&nbsp;<span class="ident" id="3153015">c</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3153018">b</span><span class="op" id="3153019">.</span><span class="ident" id="3153020">w</span><span class="op" id="3153021">++</span><br>
<span class="lineno"></span><span class="op" id="3153024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3153027">func</span>&nbsp;<span class="op" id="3153032">(</span><span class="ident" id="3153033">b</span>&nbsp;<span class="op" id="3153035">*</span><span class="ident" id="3153036">lazybuf</span><span class="op" id="3153043">)</span>&nbsp;<span class="builtintype" id="3153045">string</span><span class="op" id="3153051">(</span><span class="op" id="3153052">)</span>&nbsp;<span class="builtintype" id="3153054">string</span>&nbsp;<span class="op" id="3153061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3153064">if</span>&nbsp;<span class="ident" id="3153067">b</span><span class="op" id="3153068">.</span><span class="ident" id="3153069">buf</span>&nbsp;<span class="op" id="3153073">==</span>&nbsp;<span class="builtintype" id="3153076">nil</span>&nbsp;<span class="op" id="3153080">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3153084">return</span>&nbsp;<span class="ident" id="3153091">b</span><span class="op" id="3153092">.</span><span class="ident" id="3153093">volAndPath</span><span class="op" id="3153103">[</span><span class="op" id="3153104">:</span><span class="ident" id="3153105">b</span><span class="op" id="3153106">.</span><span class="ident" id="3153107">volLen</span><span class="op" id="3153113">+</span><span class="ident" id="3153114">b</span><span class="op" id="3153115">.</span><span class="ident" id="3153116">w</span><span class="op" id="3153117">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3153120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3153123">return</span>&nbsp;<span class="ident" id="3153130">b</span><span class="op" id="3153131">.</span><span class="ident" id="3153132">volAndPath</span><span class="op" id="3153142">[</span><span class="op" id="3153143">:</span><span class="ident" id="3153144">b</span><span class="op" id="3153145">.</span><span class="ident" id="3153146">volLen</span><span class="op" id="3153152">]</span>&nbsp;<span class="op" id="3153154">+</span>&nbsp;<span class="builtintype" id="3153156">string</span><span class="op" id="3153162">(</span><span class="ident" id="3153163">b</span><span class="op" id="3153164">.</span><span class="ident" id="3153165">buf</span><span class="op" id="3153168">[</span><span class="op" id="3153169">:</span><span class="ident" id="3153170">b</span><span class="op" id="3153171">.</span><span class="ident" id="3153172">w</span><span class="op" id="3153173">]</span><span class="op" id="3153174">)</span><br>
<span class="lineno"></span><span class="op" id="3153176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3153179">const</span>&nbsp;<span class="op" id="3153185">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3153188">Separator</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3153202">=</span>&nbsp;<span class="ident" id="3153204">os</span><span class="op" id="3153206">.</span><span class="ident" id="3153207">PathSeparator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3153222">ListSeparator</span>&nbsp;<span class="op" id="3153236">=</span>&nbsp;<span class="ident" id="3153238">os</span><span class="op" id="3153240">.</span><span class="ident" id="3153241">PathListSeparator</span><br>
<span class="lineno"></span><span class="op" id="3153259">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="3153262">//&nbsp;Clean&nbsp;returns&nbsp;the&nbsp;shortest&nbsp;path&nbsp;name&nbsp;equivalent&nbsp;to&nbsp;path</span><br>
<span class="lineno"></span><span class="comment" id="3153321">//&nbsp;by&nbsp;purely&nbsp;lexical&nbsp;processing.&nbsp;&nbsp;It&nbsp;applies&nbsp;the&nbsp;following&nbsp;rules</span><br>
<span class="lineno"></span><span class="comment" id="3153386">//&nbsp;iteratively&nbsp;until&nbsp;no&nbsp;further&nbsp;processing&nbsp;can&nbsp;be&nbsp;done:</span><br>
<span class="lineno"></span><span class="comment" id="3153442">//</span><br>
<span class="lineno"></span><span class="comment" id="3153445">//&nbsp;&nbsp;&nbsp;&nbsp;1.&nbsp;Replace&nbsp;multiple&nbsp;Separator&nbsp;elements&nbsp;with&nbsp;a&nbsp;single&nbsp;one.</span><br>
<span class="lineno">65</span><span class="comment" id="3153506">//&nbsp;&nbsp;&nbsp;&nbsp;2.&nbsp;Eliminate&nbsp;each&nbsp;.&nbsp;path&nbsp;name&nbsp;element&nbsp;(the&nbsp;current&nbsp;directory).</span><br>
<span class="lineno"></span><span class="comment" id="3153572">//&nbsp;&nbsp;&nbsp;&nbsp;3.&nbsp;Eliminate&nbsp;each&nbsp;inner&nbsp;..&nbsp;path&nbsp;name&nbsp;element&nbsp;(the&nbsp;parent&nbsp;directory)</span><br>
<span class="lineno"></span><span class="comment" id="3153643">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;along&nbsp;with&nbsp;the&nbsp;non-..&nbsp;element&nbsp;that&nbsp;precedes&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="3153697">//&nbsp;&nbsp;&nbsp;&nbsp;4.&nbsp;Eliminate&nbsp;..&nbsp;elements&nbsp;that&nbsp;begin&nbsp;a&nbsp;rooted&nbsp;path:</span><br>
<span class="lineno"></span><span class="comment" id="3153751">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;is,&nbsp;replace&nbsp;&#34;/..&#34;&nbsp;by&nbsp;&#34;/&#34;&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;a&nbsp;path,</span><br>
<span class="lineno">70</span><span class="comment" id="3153815">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assuming&nbsp;Separator&nbsp;is&nbsp;&#39;/&#39;.</span><br>
<span class="lineno"></span><span class="comment" id="3153848">//</span><br>
<span class="lineno"></span><span class="comment" id="3153851">//&nbsp;The&nbsp;returned&nbsp;path&nbsp;ends&nbsp;in&nbsp;a&nbsp;slash&nbsp;only&nbsp;if&nbsp;it&nbsp;represents&nbsp;a&nbsp;root&nbsp;directory,</span><br>
<span class="lineno"></span><span class="comment" id="3153928">//&nbsp;such&nbsp;as&nbsp;&#34;/&#34;&nbsp;on&nbsp;Unix&nbsp;or&nbsp;`C:\`&nbsp;on&nbsp;Windows.</span><br>
<span class="lineno"></span><span class="comment" id="3153972">//</span><br>
<span class="lineno">75</span><span class="comment" id="3153975">//&nbsp;If&nbsp;the&nbsp;result&nbsp;of&nbsp;this&nbsp;process&nbsp;is&nbsp;an&nbsp;empty&nbsp;string,&nbsp;Clean</span><br>
<span class="lineno"></span><span class="comment" id="3154034">//&nbsp;returns&nbsp;the&nbsp;string&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3154061">//</span><br>
<span class="lineno"></span><span class="comment" id="3154064">//&nbsp;See&nbsp;also&nbsp;Rob&nbsp;Pike,&nbsp;``Lexical&nbsp;File&nbsp;Names&nbsp;in&nbsp;Plan&nbsp;9&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3154120">//&nbsp;Getting&nbsp;Dot-Dot&nbsp;Right,&#39;&#39;</span><br>
<span class="lineno">80</span><span class="comment" id="3154148">//&nbsp;http://plan9.bell-labs.com/sys/doc/lexnames.html</span><br>
<span class="lineno"></span><span class="keyword" id="3154200">func</span>&nbsp;<span class="ident" id="3154205">Clean</span><span class="op" id="3154210">(</span><span class="ident" id="3154211">path</span>&nbsp;<span class="builtintype" id="3154216">string</span><span class="op" id="3154222">)</span>&nbsp;<span class="builtintype" id="3154224">string</span>&nbsp;<span class="op" id="3154231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3154234">originalPath</span>&nbsp;<span class="op" id="3154247">:=</span>&nbsp;<span class="ident" id="3154250">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3154256">volLen</span>&nbsp;<span class="op" id="3154263">:=</span>&nbsp;<span class="ident" id="3154266">volumeNameLen</span><span class="op" id="3154279">(</span><span class="ident" id="3154280">path</span><span class="op" id="3154284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3154287">path</span>&nbsp;<span class="op" id="3154292">=</span>&nbsp;<span class="ident" id="3154294">path</span><span class="op" id="3154298">[</span><span class="ident" id="3154299">volLen</span><span class="op" id="3154305">:</span><span class="op" id="3154306">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3154309">if</span>&nbsp;<span class="ident" id="3154312">path</span>&nbsp;<span class="op" id="3154317">==</span>&nbsp;<span class="string" id="3154320">&#34;&#34;</span>&nbsp;<span class="op" id="3154323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3154327">if</span>&nbsp;<span class="ident" id="3154330">volLen</span>&nbsp;<span class="op" id="3154337">&gt;</span>&nbsp;<span class="num" id="3154339">1</span>&nbsp;<span class="op" id="3154341">&amp;&amp;</span>&nbsp;<span class="ident" id="3154344">originalPath</span><span class="op" id="3154356">[</span><span class="num" id="3154357">1</span><span class="op" id="3154358">]</span>&nbsp;<span class="op" id="3154360">!=</span>&nbsp;<span class="string" id="3154363">&#39;:&#39;</span>&nbsp;<span class="op" id="3154367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3154372">//&nbsp;should&nbsp;be&nbsp;UNC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3154392">return</span>&nbsp;<span class="ident" id="3154399">FromSlash</span><span class="op" id="3154408">(</span><span class="ident" id="3154409">originalPath</span><span class="op" id="3154421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3154425">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3154429">return</span>&nbsp;<span class="ident" id="3154436">originalPath</span>&nbsp;<span class="op" id="3154449">+</span>&nbsp;<span class="string" id="3154451">&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3154456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3154459">rooted</span>&nbsp;<span class="op" id="3154466">:=</span>&nbsp;<span class="ident" id="3154469">os</span><span class="op" id="3154471">.</span><span class="ident" id="3154472">IsPathSeparator</span><span class="op" id="3154487">(</span><span class="ident" id="3154488">path</span><span class="op" id="3154492">[</span><span class="num" id="3154493">0</span><span class="op" id="3154494">]</span><span class="op" id="3154495">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3154499">//&nbsp;Invariants:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3154515">//&nbsp;&nbsp;&nbsp;&nbsp;reading&nbsp;from&nbsp;path;&nbsp;r&nbsp;is&nbsp;index&nbsp;of&nbsp;next&nbsp;byte&nbsp;to&nbsp;process.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3154574">//&nbsp;&nbsp;&nbsp;&nbsp;writing&nbsp;to&nbsp;buf;&nbsp;w&nbsp;is&nbsp;index&nbsp;of&nbsp;next&nbsp;byte&nbsp;to&nbsp;write.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3154628">//&nbsp;&nbsp;&nbsp;&nbsp;dotdot&nbsp;is&nbsp;index&nbsp;in&nbsp;buf&nbsp;where&nbsp;..&nbsp;must&nbsp;stop,&nbsp;either&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3154690">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it&nbsp;is&nbsp;the&nbsp;leading&nbsp;slash&nbsp;or&nbsp;it&nbsp;is&nbsp;a&nbsp;leading&nbsp;../../..&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3154755">n</span>&nbsp;<span class="op" id="3154757">:=</span>&nbsp;<span class="builtinfunc" id="3154760">len</span><span class="op" id="3154763">(</span><span class="ident" id="3154764">path</span><span class="op" id="3154768">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3154771">out</span>&nbsp;<span class="op" id="3154775">:=</span>&nbsp;<span class="ident" id="3154778">lazybuf</span><span class="op" id="3154785">{</span><span class="ident" id="3154786">path</span><span class="op" id="3154790">:</span>&nbsp;<span class="ident" id="3154792">path</span><span class="op" id="3154796">,</span>&nbsp;<span class="ident" id="3154798">volAndPath</span><span class="op" id="3154808">:</span>&nbsp;<span class="ident" id="3154810">originalPath</span><span class="op" id="3154822">,</span>&nbsp;<span class="ident" id="3154824">volLen</span><span class="op" id="3154830">:</span>&nbsp;<span class="ident" id="3154832">volLen</span><span class="op" id="3154838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3154841">r</span><span class="op" id="3154842">,</span>&nbsp;<span class="ident" id="3154844">dotdot</span>&nbsp;<span class="op" id="3154851">:=</span>&nbsp;<span class="num" id="3154854">0</span><span class="op" id="3154855">,</span>&nbsp;<span class="num" id="3154857">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3154860">if</span>&nbsp;<span class="ident" id="3154863">rooted</span>&nbsp;<span class="op" id="3154870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3154874">out</span><span class="op" id="3154877">.</span><span class="builtinfunc" id="3154878">append</span><span class="op" id="3154884">(</span><span class="ident" id="3154885">Separator</span><span class="op" id="3154894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3154898">r</span><span class="op" id="3154899">,</span>&nbsp;<span class="ident" id="3154901">dotdot</span>&nbsp;<span class="op" id="3154908">=</span>&nbsp;<span class="num" id="3154910">1</span><span class="op" id="3154911">,</span>&nbsp;<span class="num" id="3154913">1</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3154916">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3154920">for</span>&nbsp;<span class="ident" id="3154924">r</span>&nbsp;<span class="op" id="3154926">&lt;</span>&nbsp;<span class="ident" id="3154928">n</span>&nbsp;<span class="op" id="3154930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3154934">switch</span>&nbsp;<span class="op" id="3154941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3154945">case</span>&nbsp;<span class="ident" id="3154950">os</span><span class="op" id="3154952">.</span><span class="ident" id="3154953">IsPathSeparator</span><span class="op" id="3154968">(</span><span class="ident" id="3154969">path</span><span class="op" id="3154973">[</span><span class="ident" id="3154974">r</span><span class="op" id="3154975">]</span><span class="op" id="3154976">)</span><span class="op" id="3154977">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3154982">//&nbsp;empty&nbsp;path&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3155007">r</span><span class="op" id="3155008">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3155013">case</span>&nbsp;<span class="ident" id="3155018">path</span><span class="op" id="3155022">[</span><span class="ident" id="3155023">r</span><span class="op" id="3155024">]</span>&nbsp;<span class="op" id="3155026">==</span>&nbsp;<span class="string" id="3155029">&#39;.&#39;</span>&nbsp;<span class="op" id="3155033">&amp;&amp;</span>&nbsp;<span class="op" id="3155036">(</span><span class="ident" id="3155037">r</span><span class="op" id="3155038">+</span><span class="num" id="3155039">1</span>&nbsp;<span class="op" id="3155041">==</span>&nbsp;<span class="ident" id="3155044">n</span>&nbsp;<span class="op" id="3155046">||</span>&nbsp;<span class="ident" id="3155049">os</span><span class="op" id="3155051">.</span><span class="ident" id="3155052">IsPathSeparator</span><span class="op" id="3155067">(</span><span class="ident" id="3155068">path</span><span class="op" id="3155072">[</span><span class="ident" id="3155073">r</span><span class="op" id="3155074">+</span><span class="num" id="3155075">1</span><span class="op" id="3155076">]</span><span class="op" id="3155077">)</span><span class="op" id="3155078">)</span><span class="op" id="3155079">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3155084">//&nbsp;.&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3155100">r</span><span class="op" id="3155101">++</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3155106">case</span>&nbsp;<span class="ident" id="3155111">path</span><span class="op" id="3155115">[</span><span class="ident" id="3155116">r</span><span class="op" id="3155117">]</span>&nbsp;<span class="op" id="3155119">==</span>&nbsp;<span class="string" id="3155122">&#39;.&#39;</span>&nbsp;<span class="op" id="3155126">&amp;&amp;</span>&nbsp;<span class="ident" id="3155129">path</span><span class="op" id="3155133">[</span><span class="ident" id="3155134">r</span><span class="op" id="3155135">+</span><span class="num" id="3155136">1</span><span class="op" id="3155137">]</span>&nbsp;<span class="op" id="3155139">==</span>&nbsp;<span class="string" id="3155142">&#39;.&#39;</span>&nbsp;<span class="op" id="3155146">&amp;&amp;</span>&nbsp;<span class="op" id="3155149">(</span><span class="ident" id="3155150">r</span><span class="op" id="3155151">+</span><span class="num" id="3155152">2</span>&nbsp;<span class="op" id="3155154">==</span>&nbsp;<span class="ident" id="3155157">n</span>&nbsp;<span class="op" id="3155159">||</span>&nbsp;<span class="ident" id="3155162">os</span><span class="op" id="3155164">.</span><span class="ident" id="3155165">IsPathSeparator</span><span class="op" id="3155180">(</span><span class="ident" id="3155181">path</span><span class="op" id="3155185">[</span><span class="ident" id="3155186">r</span><span class="op" id="3155187">+</span><span class="num" id="3155188">2</span><span class="op" id="3155189">]</span><span class="op" id="3155190">)</span><span class="op" id="3155191">)</span><span class="op" id="3155192">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3155197">//&nbsp;..&nbsp;element:&nbsp;remove&nbsp;to&nbsp;last&nbsp;separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3155240">r</span>&nbsp;<span class="op" id="3155242">+=</span>&nbsp;<span class="num" id="3155245">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3155250">switch</span>&nbsp;<span class="op" id="3155257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3155262">case</span>&nbsp;<span class="ident" id="3155267">out</span><span class="op" id="3155270">.</span><span class="ident" id="3155271">w</span>&nbsp;<span class="op" id="3155273">&gt;</span>&nbsp;<span class="ident" id="3155275">dotdot</span><span class="op" id="3155281">:</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3155287">//&nbsp;can&nbsp;backtrack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3155308">out</span><span class="op" id="3155311">.</span><span class="ident" id="3155312">w</span><span class="op" id="3155313">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3155320">for</span>&nbsp;<span class="ident" id="3155324">out</span><span class="op" id="3155327">.</span><span class="ident" id="3155328">w</span>&nbsp;<span class="op" id="3155330">&gt;</span>&nbsp;<span class="ident" id="3155332">dotdot</span>&nbsp;<span class="op" id="3155339">&amp;&amp;</span>&nbsp;<span class="op" id="3155342">!</span><span class="ident" id="3155343">os</span><span class="op" id="3155345">.</span><span class="ident" id="3155346">IsPathSeparator</span><span class="op" id="3155361">(</span><span class="ident" id="3155362">out</span><span class="op" id="3155365">.</span><span class="ident" id="3155366">index</span><span class="op" id="3155371">(</span><span class="ident" id="3155372">out</span><span class="op" id="3155375">.</span><span class="ident" id="3155376">w</span><span class="op" id="3155377">)</span><span class="op" id="3155378">)</span>&nbsp;<span class="op" id="3155380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3155387">out</span><span class="op" id="3155390">.</span><span class="ident" id="3155391">w</span><span class="op" id="3155392">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3155399">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3155404">case</span>&nbsp;<span class="op" id="3155409">!</span><span class="ident" id="3155410">rooted</span><span class="op" id="3155416">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3155422">//&nbsp;cannot&nbsp;backtrack,&nbsp;but&nbsp;not&nbsp;rooted,&nbsp;so&nbsp;append&nbsp;..&nbsp;element.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3155485">if</span>&nbsp;<span class="ident" id="3155488">out</span><span class="op" id="3155491">.</span><span class="ident" id="3155492">w</span>&nbsp;<span class="op" id="3155494">&gt;</span>&nbsp;<span class="num" id="3155496">0</span>&nbsp;<span class="op" id="3155498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3155505">out</span><span class="op" id="3155508">.</span><span class="builtinfunc" id="3155509">append</span><span class="op" id="3155515">(</span><span class="ident" id="3155516">Separator</span><span class="op" id="3155525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3155531">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3155537">out</span><span class="op" id="3155540">.</span><span class="builtinfunc" id="3155541">append</span><span class="op" id="3155547">(</span><span class="string" id="3155548">&#39;.&#39;</span><span class="op" id="3155551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3155557">out</span><span class="op" id="3155560">.</span><span class="builtinfunc" id="3155561">append</span><span class="op" id="3155567">(</span><span class="string" id="3155568">&#39;.&#39;</span><span class="op" id="3155571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3155577">dotdot</span>&nbsp;<span class="op" id="3155584">=</span>&nbsp;<span class="ident" id="3155586">out</span><span class="op" id="3155589">.</span><span class="ident" id="3155590">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3155595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3155599">default</span><span class="op" id="3155606">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3155611">//&nbsp;real&nbsp;path&nbsp;element.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3155636">//&nbsp;add&nbsp;slash&nbsp;if&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3155662">if</span>&nbsp;<span class="ident" id="3155665">rooted</span>&nbsp;<span class="op" id="3155672">&amp;&amp;</span>&nbsp;<span class="ident" id="3155675">out</span><span class="op" id="3155678">.</span><span class="ident" id="3155679">w</span>&nbsp;<span class="op" id="3155681">!=</span>&nbsp;<span class="num" id="3155684">1</span>&nbsp;<span class="op" id="3155686">||</span>&nbsp;<span class="op" id="3155689">!</span><span class="ident" id="3155690">rooted</span>&nbsp;<span class="op" id="3155697">&amp;&amp;</span>&nbsp;<span class="ident" id="3155700">out</span><span class="op" id="3155703">.</span><span class="ident" id="3155704">w</span>&nbsp;<span class="op" id="3155706">!=</span>&nbsp;<span class="num" id="3155709">0</span>&nbsp;<span class="op" id="3155711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3155717">out</span><span class="op" id="3155720">.</span><span class="builtinfunc" id="3155721">append</span><span class="op" id="3155727">(</span><span class="ident" id="3155728">Separator</span><span class="op" id="3155737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3155742">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3155747">//&nbsp;copy&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3155766">for</span>&nbsp;<span class="op" id="3155770">;</span>&nbsp;<span class="ident" id="3155772">r</span>&nbsp;<span class="op" id="3155774">&lt;</span>&nbsp;<span class="ident" id="3155776">n</span>&nbsp;<span class="op" id="3155778">&amp;&amp;</span>&nbsp;<span class="op" id="3155781">!</span><span class="ident" id="3155782">os</span><span class="op" id="3155784">.</span><span class="ident" id="3155785">IsPathSeparator</span><span class="op" id="3155800">(</span><span class="ident" id="3155801">path</span><span class="op" id="3155805">[</span><span class="ident" id="3155806">r</span><span class="op" id="3155807">]</span><span class="op" id="3155808">)</span><span class="op" id="3155809">;</span>&nbsp;<span class="ident" id="3155811">r</span><span class="op" id="3155812">++</span>&nbsp;<span class="op" id="3155815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3155821">out</span><span class="op" id="3155824">.</span><span class="builtinfunc" id="3155825">append</span><span class="op" id="3155831">(</span><span class="ident" id="3155832">path</span><span class="op" id="3155836">[</span><span class="ident" id="3155837">r</span><span class="op" id="3155838">]</span><span class="op" id="3155839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3155844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3155848">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3155851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3155855">//&nbsp;Turn&nbsp;empty&nbsp;string&nbsp;into&nbsp;&#34;.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3155886">if</span>&nbsp;<span class="ident" id="3155889">out</span><span class="op" id="3155892">.</span><span class="ident" id="3155893">w</span>&nbsp;<span class="op" id="3155895">==</span>&nbsp;<span class="num" id="3155898">0</span>&nbsp;<span class="op" id="3155900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3155904">out</span><span class="op" id="3155907">.</span><span class="builtinfunc" id="3155908">append</span><span class="op" id="3155914">(</span><span class="string" id="3155915">&#39;.&#39;</span><span class="op" id="3155918">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3155921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3155925">return</span>&nbsp;<span class="ident" id="3155932">FromSlash</span><span class="op" id="3155941">(</span><span class="ident" id="3155942">out</span><span class="op" id="3155945">.</span><span class="builtintype" id="3155946">string</span><span class="op" id="3155952">(</span><span class="op" id="3155953">)</span><span class="op" id="3155954">)</span><br>
<span class="lineno"></span><span class="op" id="3155956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="comment" id="3155959">//&nbsp;ToSlash&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;replacing&nbsp;each&nbsp;separator&nbsp;character</span><br>
<span class="lineno"></span><span class="comment" id="3156027">//&nbsp;in&nbsp;path&nbsp;with&nbsp;a&nbsp;slash&nbsp;(&#39;/&#39;)&nbsp;character.&nbsp;Multiple&nbsp;separators&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3156092">//&nbsp;replaced&nbsp;by&nbsp;multiple&nbsp;slashes.</span><br>
<span class="lineno"></span><span class="keyword" id="3156125">func</span>&nbsp;<span class="ident" id="3156130">ToSlash</span><span class="op" id="3156137">(</span><span class="ident" id="3156138">path</span>&nbsp;<span class="builtintype" id="3156143">string</span><span class="op" id="3156149">)</span>&nbsp;<span class="builtintype" id="3156151">string</span>&nbsp;<span class="op" id="3156158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3156161">if</span>&nbsp;<span class="ident" id="3156164">Separator</span>&nbsp;<span class="op" id="3156174">==</span>&nbsp;<span class="string" id="3156177">&#39;/&#39;</span>&nbsp;<span class="op" id="3156181">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3156185">return</span>&nbsp;<span class="ident" id="3156192">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3156198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3156201">return</span>&nbsp;<span class="ident" id="3156208">strings</span><span class="op" id="3156215">.</span><span class="ident" id="3156216">Replace</span><span class="op" id="3156223">(</span><span class="ident" id="3156224">path</span><span class="op" id="3156228">,</span>&nbsp;<span class="builtintype" id="3156230">string</span><span class="op" id="3156236">(</span><span class="ident" id="3156237">Separator</span><span class="op" id="3156246">)</span><span class="op" id="3156247">,</span>&nbsp;<span class="string" id="3156249">&#34;/&#34;</span><span class="op" id="3156252">,</span>&nbsp;<span class="op" id="3156254">-</span><span class="num" id="3156255">1</span><span class="op" id="3156256">)</span><br>
<span class="lineno"></span><span class="op" id="3156258">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="3156261">//&nbsp;FromSlash&nbsp;returns&nbsp;the&nbsp;result&nbsp;of&nbsp;replacing&nbsp;each&nbsp;slash&nbsp;(&#39;/&#39;)&nbsp;character</span><br>
<span class="lineno"></span><span class="comment" id="3156333">//&nbsp;in&nbsp;path&nbsp;with&nbsp;a&nbsp;separator&nbsp;character.&nbsp;Multiple&nbsp;slashes&nbsp;are&nbsp;replaced</span><br>
<span class="lineno"></span><span class="comment" id="3156402">//&nbsp;by&nbsp;multiple&nbsp;separators.</span><br>
<span class="lineno"></span><span class="keyword" id="3156429">func</span>&nbsp;<span class="ident" id="3156434">FromSlash</span><span class="op" id="3156443">(</span><span class="ident" id="3156444">path</span>&nbsp;<span class="builtintype" id="3156449">string</span><span class="op" id="3156455">)</span>&nbsp;<span class="builtintype" id="3156457">string</span>&nbsp;<span class="op" id="3156464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3156467">if</span>&nbsp;<span class="ident" id="3156470">Separator</span>&nbsp;<span class="op" id="3156480">==</span>&nbsp;<span class="string" id="3156483">&#39;/&#39;</span>&nbsp;<span class="op" id="3156487">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3156491">return</span>&nbsp;<span class="ident" id="3156498">path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3156504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3156507">return</span>&nbsp;<span class="ident" id="3156514">strings</span><span class="op" id="3156521">.</span><span class="ident" id="3156522">Replace</span><span class="op" id="3156529">(</span><span class="ident" id="3156530">path</span><span class="op" id="3156534">,</span>&nbsp;<span class="string" id="3156536">&#34;/&#34;</span><span class="op" id="3156539">,</span>&nbsp;<span class="builtintype" id="3156541">string</span><span class="op" id="3156547">(</span><span class="ident" id="3156548">Separator</span><span class="op" id="3156557">)</span><span class="op" id="3156558">,</span>&nbsp;<span class="op" id="3156560">-</span><span class="num" id="3156561">1</span><span class="op" id="3156562">)</span><br>
<span class="lineno"></span><span class="op" id="3156564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="3156567">//&nbsp;SplitList&nbsp;splits&nbsp;a&nbsp;list&nbsp;of&nbsp;paths&nbsp;joined&nbsp;by&nbsp;the&nbsp;OS-specific&nbsp;ListSeparator,</span><br>
<span class="lineno"></span><span class="comment" id="3156644">//&nbsp;usually&nbsp;found&nbsp;in&nbsp;PATH&nbsp;or&nbsp;GOPATH&nbsp;environment&nbsp;variables.</span><br>
<span class="lineno"></span><span class="comment" id="3156702">//&nbsp;Unlike&nbsp;strings.Split,&nbsp;SplitList&nbsp;returns&nbsp;an&nbsp;empty&nbsp;slice&nbsp;when&nbsp;passed&nbsp;an&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3156789">func</span>&nbsp;<span class="ident" id="3156794">SplitList</span><span class="op" id="3156803">(</span><span class="ident" id="3156804">path</span>&nbsp;<span class="builtintype" id="3156809">string</span><span class="op" id="3156815">)</span>&nbsp;<span class="op" id="3156817">[</span><span class="op" id="3156818">]</span><span class="builtintype" id="3156819">string</span>&nbsp;<span class="op" id="3156826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3156829">return</span>&nbsp;<span class="ident" id="3156836">splitList</span><span class="op" id="3156845">(</span><span class="ident" id="3156846">path</span><span class="op" id="3156850">)</span><br>
<span class="lineno">180</span><span class="op" id="3156852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3156855">//&nbsp;Split&nbsp;splits&nbsp;path&nbsp;immediately&nbsp;following&nbsp;the&nbsp;final&nbsp;Separator,</span><br>
<span class="lineno"></span><span class="comment" id="3156919">//&nbsp;separating&nbsp;it&nbsp;into&nbsp;a&nbsp;directory&nbsp;and&nbsp;file&nbsp;name&nbsp;component.</span><br>
<span class="lineno"></span><span class="comment" id="3156978">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;Separator&nbsp;in&nbsp;path,&nbsp;Split&nbsp;returns&nbsp;an&nbsp;empty&nbsp;dir</span><br>
<span class="lineno">185</span><span class="comment" id="3157042">//&nbsp;and&nbsp;file&nbsp;set&nbsp;to&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3157067">//&nbsp;The&nbsp;returned&nbsp;values&nbsp;have&nbsp;the&nbsp;property&nbsp;that&nbsp;path&nbsp;=&nbsp;dir+file.</span><br>
<span class="lineno"></span><span class="keyword" id="3157130">func</span>&nbsp;<span class="ident" id="3157135">Split</span><span class="op" id="3157140">(</span><span class="ident" id="3157141">path</span>&nbsp;<span class="builtintype" id="3157146">string</span><span class="op" id="3157152">)</span>&nbsp;<span class="op" id="3157154">(</span><span class="ident" id="3157155">dir</span><span class="op" id="3157158">,</span>&nbsp;<span class="ident" id="3157160">file</span>&nbsp;<span class="builtintype" id="3157165">string</span><span class="op" id="3157171">)</span>&nbsp;<span class="op" id="3157173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3157176">vol</span>&nbsp;<span class="op" id="3157180">:=</span>&nbsp;<span class="ident" id="3157183">VolumeName</span><span class="op" id="3157193">(</span><span class="ident" id="3157194">path</span><span class="op" id="3157198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3157201">i</span>&nbsp;<span class="op" id="3157203">:=</span>&nbsp;<span class="builtinfunc" id="3157206">len</span><span class="op" id="3157209">(</span><span class="ident" id="3157210">path</span><span class="op" id="3157214">)</span>&nbsp;<span class="op" id="3157216">-</span>&nbsp;<span class="num" id="3157218">1</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3157221">for</span>&nbsp;<span class="ident" id="3157225">i</span>&nbsp;<span class="op" id="3157227">&gt;=</span>&nbsp;<span class="builtinfunc" id="3157230">len</span><span class="op" id="3157233">(</span><span class="ident" id="3157234">vol</span><span class="op" id="3157237">)</span>&nbsp;<span class="op" id="3157239">&amp;&amp;</span>&nbsp;<span class="op" id="3157242">!</span><span class="ident" id="3157243">os</span><span class="op" id="3157245">.</span><span class="ident" id="3157246">IsPathSeparator</span><span class="op" id="3157261">(</span><span class="ident" id="3157262">path</span><span class="op" id="3157266">[</span><span class="ident" id="3157267">i</span><span class="op" id="3157268">]</span><span class="op" id="3157269">)</span>&nbsp;<span class="op" id="3157271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3157275">i</span><span class="op" id="3157276">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3157280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3157283">return</span>&nbsp;<span class="ident" id="3157290">path</span><span class="op" id="3157294">[</span><span class="op" id="3157295">:</span><span class="ident" id="3157296">i</span><span class="op" id="3157297">+</span><span class="num" id="3157298">1</span><span class="op" id="3157299">]</span><span class="op" id="3157300">,</span>&nbsp;<span class="ident" id="3157302">path</span><span class="op" id="3157306">[</span><span class="ident" id="3157307">i</span><span class="op" id="3157308">+</span><span class="num" id="3157309">1</span><span class="op" id="3157310">:</span><span class="op" id="3157311">]</span><br>
<span class="lineno"></span><span class="op" id="3157313">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="3157316">//&nbsp;Join&nbsp;joins&nbsp;any&nbsp;number&nbsp;of&nbsp;path&nbsp;elements&nbsp;into&nbsp;a&nbsp;single&nbsp;path,&nbsp;adding</span><br>
<span class="lineno"></span><span class="comment" id="3157385">//&nbsp;a&nbsp;Separator&nbsp;if&nbsp;necessary.&nbsp;The&nbsp;result&nbsp;is&nbsp;Cleaned,&nbsp;in&nbsp;particular</span><br>
<span class="lineno"></span><span class="comment" id="3157451">//&nbsp;all&nbsp;empty&nbsp;strings&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="keyword" id="3157485">func</span>&nbsp;<span class="ident" id="3157490">Join</span><span class="op" id="3157494">(</span><span class="ident" id="3157495">elem</span>&nbsp;<span class="op" id="3157500">...</span><span class="builtintype" id="3157503">string</span><span class="op" id="3157509">)</span>&nbsp;<span class="builtintype" id="3157511">string</span>&nbsp;<span class="op" id="3157518">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3157521">for</span>&nbsp;<span class="ident" id="3157525">i</span><span class="op" id="3157526">,</span>&nbsp;<span class="ident" id="3157528">e</span>&nbsp;<span class="op" id="3157530">:=</span>&nbsp;<span class="keyword" id="3157533">range</span>&nbsp;<span class="ident" id="3157539">elem</span>&nbsp;<span class="op" id="3157544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3157548">if</span>&nbsp;<span class="ident" id="3157551">e</span>&nbsp;<span class="op" id="3157553">!=</span>&nbsp;<span class="string" id="3157556">&#34;&#34;</span>&nbsp;<span class="op" id="3157559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3157564">return</span>&nbsp;<span class="ident" id="3157571">Clean</span><span class="op" id="3157576">(</span><span class="ident" id="3157577">strings</span><span class="op" id="3157584">.</span><span class="ident" id="3157585">Join</span><span class="op" id="3157589">(</span><span class="ident" id="3157590">elem</span><span class="op" id="3157594">[</span><span class="ident" id="3157595">i</span><span class="op" id="3157596">:</span><span class="op" id="3157597">]</span><span class="op" id="3157598">,</span>&nbsp;<span class="builtintype" id="3157600">string</span><span class="op" id="3157606">(</span><span class="ident" id="3157607">Separator</span><span class="op" id="3157616">)</span><span class="op" id="3157617">)</span><span class="op" id="3157618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3157622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3157625">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3157628">return</span>&nbsp;<span class="string" id="3157635">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3157638">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3157641">//&nbsp;Ext&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;extension&nbsp;used&nbsp;by&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3157694">//&nbsp;The&nbsp;extension&nbsp;is&nbsp;the&nbsp;suffix&nbsp;beginning&nbsp;at&nbsp;the&nbsp;final&nbsp;dot</span><br>
<span class="lineno">210</span><span class="comment" id="3157752">//&nbsp;in&nbsp;the&nbsp;final&nbsp;element&nbsp;of&nbsp;path;&nbsp;it&nbsp;is&nbsp;empty&nbsp;if&nbsp;there&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3157809">//&nbsp;no&nbsp;dot.</span><br>
<span class="lineno"></span><span class="keyword" id="3157820">func</span>&nbsp;<span class="ident" id="3157825">Ext</span><span class="op" id="3157828">(</span><span class="ident" id="3157829">path</span>&nbsp;<span class="builtintype" id="3157834">string</span><span class="op" id="3157840">)</span>&nbsp;<span class="builtintype" id="3157842">string</span>&nbsp;<span class="op" id="3157849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3157852">for</span>&nbsp;<span class="ident" id="3157856">i</span>&nbsp;<span class="op" id="3157858">:=</span>&nbsp;<span class="builtinfunc" id="3157861">len</span><span class="op" id="3157864">(</span><span class="ident" id="3157865">path</span><span class="op" id="3157869">)</span>&nbsp;<span class="op" id="3157871">-</span>&nbsp;<span class="num" id="3157873">1</span><span class="op" id="3157874">;</span>&nbsp;<span class="ident" id="3157876">i</span>&nbsp;<span class="op" id="3157878">&gt;=</span>&nbsp;<span class="num" id="3157881">0</span>&nbsp;<span class="op" id="3157883">&amp;&amp;</span>&nbsp;<span class="op" id="3157886">!</span><span class="ident" id="3157887">os</span><span class="op" id="3157889">.</span><span class="ident" id="3157890">IsPathSeparator</span><span class="op" id="3157905">(</span><span class="ident" id="3157906">path</span><span class="op" id="3157910">[</span><span class="ident" id="3157911">i</span><span class="op" id="3157912">]</span><span class="op" id="3157913">)</span><span class="op" id="3157914">;</span>&nbsp;<span class="ident" id="3157916">i</span><span class="op" id="3157917">--</span>&nbsp;<span class="op" id="3157920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3157924">if</span>&nbsp;<span class="ident" id="3157927">path</span><span class="op" id="3157931">[</span><span class="ident" id="3157932">i</span><span class="op" id="3157933">]</span>&nbsp;<span class="op" id="3157935">==</span>&nbsp;<span class="string" id="3157938">&#39;.&#39;</span>&nbsp;<span class="op" id="3157942">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3157947">return</span>&nbsp;<span class="ident" id="3157954">path</span><span class="op" id="3157958">[</span><span class="ident" id="3157959">i</span><span class="op" id="3157960">:</span><span class="op" id="3157961">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3157965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3157968">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3157971">return</span>&nbsp;<span class="string" id="3157978">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3157981">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3157984">//&nbsp;EvalSymlinks&nbsp;returns&nbsp;the&nbsp;path&nbsp;name&nbsp;after&nbsp;the&nbsp;evaluation&nbsp;of&nbsp;any&nbsp;symbolic</span><br>
<span class="lineno"></span><span class="comment" id="3158059">//&nbsp;links.</span><br>
<span class="lineno"></span><span class="comment" id="3158069">//&nbsp;If&nbsp;path&nbsp;is&nbsp;relative&nbsp;the&nbsp;result&nbsp;will&nbsp;be&nbsp;relative&nbsp;to&nbsp;the&nbsp;current&nbsp;directory,</span><br>
<span class="lineno"></span><span class="comment" id="3158146">//&nbsp;unless&nbsp;one&nbsp;of&nbsp;the&nbsp;components&nbsp;is&nbsp;an&nbsp;absolute&nbsp;symbolic&nbsp;link.</span><br>
<span class="lineno">225</span><span class="keyword" id="3158208">func</span>&nbsp;<span class="ident" id="3158213">EvalSymlinks</span><span class="op" id="3158225">(</span><span class="ident" id="3158226">path</span>&nbsp;<span class="builtintype" id="3158231">string</span><span class="op" id="3158237">)</span>&nbsp;<span class="op" id="3158239">(</span><span class="builtintype" id="3158240">string</span><span class="op" id="3158246">,</span>&nbsp;<span class="builtintype" id="3158248">error</span><span class="op" id="3158253">)</span>&nbsp;<span class="op" id="3158255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3158258">return</span>&nbsp;<span class="ident" id="3158265">evalSymlinks</span><span class="op" id="3158277">(</span><span class="ident" id="3158278">path</span><span class="op" id="3158282">)</span><br>
<span class="lineno"></span><span class="op" id="3158284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3158287">//&nbsp;Abs&nbsp;returns&nbsp;an&nbsp;absolute&nbsp;representation&nbsp;of&nbsp;path.</span><br>
<span class="lineno">230</span><span class="comment" id="3158338">//&nbsp;If&nbsp;the&nbsp;path&nbsp;is&nbsp;not&nbsp;absolute&nbsp;it&nbsp;will&nbsp;be&nbsp;joined&nbsp;with&nbsp;the&nbsp;current</span><br>
<span class="lineno"></span><span class="comment" id="3158404">//&nbsp;working&nbsp;directory&nbsp;to&nbsp;turn&nbsp;it&nbsp;into&nbsp;an&nbsp;absolute&nbsp;path.&nbsp;&nbsp;The&nbsp;absolute</span><br>
<span class="lineno"></span><span class="comment" id="3158473">//&nbsp;path&nbsp;name&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;unique.</span><br>
<span class="lineno"></span><span class="keyword" id="3158535">func</span>&nbsp;<span class="ident" id="3158540">Abs</span><span class="op" id="3158543">(</span><span class="ident" id="3158544">path</span>&nbsp;<span class="builtintype" id="3158549">string</span><span class="op" id="3158555">)</span>&nbsp;<span class="op" id="3158557">(</span><span class="builtintype" id="3158558">string</span><span class="op" id="3158564">,</span>&nbsp;<span class="builtintype" id="3158566">error</span><span class="op" id="3158571">)</span>&nbsp;<span class="op" id="3158573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3158576">return</span>&nbsp;<span class="ident" id="3158583">abs</span><span class="op" id="3158586">(</span><span class="ident" id="3158587">path</span><span class="op" id="3158591">)</span><br>
<span class="lineno">235</span><span class="op" id="3158593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3158596">func</span>&nbsp;<span class="ident" id="3158601">unixAbs</span><span class="op" id="3158608">(</span><span class="ident" id="3158609">path</span>&nbsp;<span class="builtintype" id="3158614">string</span><span class="op" id="3158620">)</span>&nbsp;<span class="op" id="3158622">(</span><span class="builtintype" id="3158623">string</span><span class="op" id="3158629">,</span>&nbsp;<span class="builtintype" id="3158631">error</span><span class="op" id="3158636">)</span>&nbsp;<span class="op" id="3158638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3158641">if</span>&nbsp;<span class="ident" id="3158644">IsAbs</span><span class="op" id="3158649">(</span><span class="ident" id="3158650">path</span><span class="op" id="3158654">)</span>&nbsp;<span class="op" id="3158656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3158660">return</span>&nbsp;<span class="ident" id="3158667">Clean</span><span class="op" id="3158672">(</span><span class="ident" id="3158673">path</span><span class="op" id="3158677">)</span><span class="op" id="3158678">,</span>&nbsp;<span class="builtintype" id="3158680">nil</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3158685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3158688">wd</span><span class="op" id="3158690">,</span>&nbsp;<span class="ident" id="3158692">err</span>&nbsp;<span class="op" id="3158696">:=</span>&nbsp;<span class="ident" id="3158699">os</span><span class="op" id="3158701">.</span><span class="ident" id="3158702">Getwd</span><span class="op" id="3158707">(</span><span class="op" id="3158708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3158711">if</span>&nbsp;<span class="ident" id="3158714">err</span>&nbsp;<span class="op" id="3158718">!=</span>&nbsp;<span class="builtintype" id="3158721">nil</span>&nbsp;<span class="op" id="3158725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3158729">return</span>&nbsp;<span class="string" id="3158736">&#34;&#34;</span><span class="op" id="3158738">,</span>&nbsp;<span class="ident" id="3158740">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3158745">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3158748">return</span>&nbsp;<span class="ident" id="3158755">Join</span><span class="op" id="3158759">(</span><span class="ident" id="3158760">wd</span><span class="op" id="3158762">,</span>&nbsp;<span class="ident" id="3158764">path</span><span class="op" id="3158768">)</span><span class="op" id="3158769">,</span>&nbsp;<span class="builtintype" id="3158771">nil</span><br>
<span class="lineno"></span><span class="op" id="3158775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3158778">//&nbsp;Rel&nbsp;returns&nbsp;a&nbsp;relative&nbsp;path&nbsp;that&nbsp;is&nbsp;lexically&nbsp;equivalent&nbsp;to&nbsp;targpath&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="3158855">//&nbsp;joined&nbsp;to&nbsp;basepath&nbsp;with&nbsp;an&nbsp;intervening&nbsp;separator.&nbsp;That&nbsp;is,</span><br>
<span class="lineno">250</span><span class="comment" id="3158917">//&nbsp;Join(basepath,&nbsp;Rel(basepath,&nbsp;targpath))&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;targpath&nbsp;itself.</span><br>
<span class="lineno"></span><span class="comment" id="3158994">//&nbsp;On&nbsp;success,&nbsp;the&nbsp;returned&nbsp;path&nbsp;will&nbsp;always&nbsp;be&nbsp;relative&nbsp;to&nbsp;basepath,</span><br>
<span class="lineno"></span><span class="comment" id="3159064">//&nbsp;even&nbsp;if&nbsp;basepath&nbsp;and&nbsp;targpath&nbsp;share&nbsp;no&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="3159116">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;targpath&nbsp;can&#39;t&nbsp;be&nbsp;made&nbsp;relative&nbsp;to&nbsp;basepath&nbsp;or&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3159193">//&nbsp;knowing&nbsp;the&nbsp;current&nbsp;working&nbsp;directory&nbsp;would&nbsp;be&nbsp;necessary&nbsp;to&nbsp;compute&nbsp;it.</span><br>
<span class="lineno">255</span><span class="keyword" id="3159268">func</span>&nbsp;<span class="ident" id="3159273">Rel</span><span class="op" id="3159276">(</span><span class="ident" id="3159277">basepath</span><span class="op" id="3159285">,</span>&nbsp;<span class="ident" id="3159287">targpath</span>&nbsp;<span class="builtintype" id="3159296">string</span><span class="op" id="3159302">)</span>&nbsp;<span class="op" id="3159304">(</span><span class="builtintype" id="3159305">string</span><span class="op" id="3159311">,</span>&nbsp;<span class="builtintype" id="3159313">error</span><span class="op" id="3159318">)</span>&nbsp;<span class="op" id="3159320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3159323">baseVol</span>&nbsp;<span class="op" id="3159331">:=</span>&nbsp;<span class="ident" id="3159334">VolumeName</span><span class="op" id="3159344">(</span><span class="ident" id="3159345">basepath</span><span class="op" id="3159353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3159356">targVol</span>&nbsp;<span class="op" id="3159364">:=</span>&nbsp;<span class="ident" id="3159367">VolumeName</span><span class="op" id="3159377">(</span><span class="ident" id="3159378">targpath</span><span class="op" id="3159386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3159389">base</span>&nbsp;<span class="op" id="3159394">:=</span>&nbsp;<span class="ident" id="3159397">Clean</span><span class="op" id="3159402">(</span><span class="ident" id="3159403">basepath</span><span class="op" id="3159411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3159414">targ</span>&nbsp;<span class="op" id="3159419">:=</span>&nbsp;<span class="ident" id="3159422">Clean</span><span class="op" id="3159427">(</span><span class="ident" id="3159428">targpath</span><span class="op" id="3159436">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3159439">if</span>&nbsp;<span class="ident" id="3159442">targ</span>&nbsp;<span class="op" id="3159447">==</span>&nbsp;<span class="ident" id="3159450">base</span>&nbsp;<span class="op" id="3159455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3159459">return</span>&nbsp;<span class="string" id="3159466">&#34;.&#34;</span><span class="op" id="3159469">,</span>&nbsp;<span class="builtintype" id="3159471">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3159476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3159479">base</span>&nbsp;<span class="op" id="3159484">=</span>&nbsp;<span class="ident" id="3159486">base</span><span class="op" id="3159490">[</span><span class="builtinfunc" id="3159491">len</span><span class="op" id="3159494">(</span><span class="ident" id="3159495">baseVol</span><span class="op" id="3159502">)</span><span class="op" id="3159503">:</span><span class="op" id="3159504">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3159507">targ</span>&nbsp;<span class="op" id="3159512">=</span>&nbsp;<span class="ident" id="3159514">targ</span><span class="op" id="3159518">[</span><span class="builtinfunc" id="3159519">len</span><span class="op" id="3159522">(</span><span class="ident" id="3159523">targVol</span><span class="op" id="3159530">)</span><span class="op" id="3159531">:</span><span class="op" id="3159532">]</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3159535">if</span>&nbsp;<span class="ident" id="3159538">base</span>&nbsp;<span class="op" id="3159543">==</span>&nbsp;<span class="string" id="3159546">&#34;.&#34;</span>&nbsp;<span class="op" id="3159550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3159554">base</span>&nbsp;<span class="op" id="3159559">=</span>&nbsp;<span class="string" id="3159561">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3159565">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3159568">//&nbsp;Can&#39;t&nbsp;use&nbsp;IsAbs&nbsp;-&nbsp;`\a`&nbsp;and&nbsp;`a`&nbsp;are&nbsp;both&nbsp;relative&nbsp;in&nbsp;Windows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3159633">baseSlashed</span>&nbsp;<span class="op" id="3159645">:=</span>&nbsp;<span class="builtinfunc" id="3159648">len</span><span class="op" id="3159651">(</span><span class="ident" id="3159652">base</span><span class="op" id="3159656">)</span>&nbsp;<span class="op" id="3159658">&gt;</span>&nbsp;<span class="num" id="3159660">0</span>&nbsp;<span class="op" id="3159662">&amp;&amp;</span>&nbsp;<span class="ident" id="3159665">base</span><span class="op" id="3159669">[</span><span class="num" id="3159670">0</span><span class="op" id="3159671">]</span>&nbsp;<span class="op" id="3159673">==</span>&nbsp;<span class="ident" id="3159676">Separator</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3159687">targSlashed</span>&nbsp;<span class="op" id="3159699">:=</span>&nbsp;<span class="builtinfunc" id="3159702">len</span><span class="op" id="3159705">(</span><span class="ident" id="3159706">targ</span><span class="op" id="3159710">)</span>&nbsp;<span class="op" id="3159712">&gt;</span>&nbsp;<span class="num" id="3159714">0</span>&nbsp;<span class="op" id="3159716">&amp;&amp;</span>&nbsp;<span class="ident" id="3159719">targ</span><span class="op" id="3159723">[</span><span class="num" id="3159724">0</span><span class="op" id="3159725">]</span>&nbsp;<span class="op" id="3159727">==</span>&nbsp;<span class="ident" id="3159730">Separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3159741">if</span>&nbsp;<span class="ident" id="3159744">baseSlashed</span>&nbsp;<span class="op" id="3159756">!=</span>&nbsp;<span class="ident" id="3159759">targSlashed</span>&nbsp;<span class="op" id="3159771">||</span>&nbsp;<span class="ident" id="3159774">baseVol</span>&nbsp;<span class="op" id="3159782">!=</span>&nbsp;<span class="ident" id="3159785">targVol</span>&nbsp;<span class="op" id="3159793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3159797">return</span>&nbsp;<span class="string" id="3159804">&#34;&#34;</span><span class="op" id="3159806">,</span>&nbsp;<span class="ident" id="3159808">errors</span><span class="op" id="3159814">.</span><span class="ident" id="3159815">New</span><span class="op" id="3159818">(</span><span class="string" id="3159819">&#34;Rel:&nbsp;can&#39;t&nbsp;make&nbsp;&#34;</span>&nbsp;<span class="op" id="3159838">+</span>&nbsp;<span class="ident" id="3159840">targ</span>&nbsp;<span class="op" id="3159845">+</span>&nbsp;<span class="string" id="3159847">&#34;&nbsp;relative&nbsp;to&nbsp;&#34;</span>&nbsp;<span class="op" id="3159863">+</span>&nbsp;<span class="ident" id="3159865">base</span><span class="op" id="3159869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3159872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3159875">//&nbsp;Position&nbsp;base[b0:bi]&nbsp;and&nbsp;targ[t0:ti]&nbsp;at&nbsp;the&nbsp;first&nbsp;differing&nbsp;elements.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3159949">bl</span>&nbsp;<span class="op" id="3159952">:=</span>&nbsp;<span class="builtinfunc" id="3159955">len</span><span class="op" id="3159958">(</span><span class="ident" id="3159959">base</span><span class="op" id="3159963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3159966">tl</span>&nbsp;<span class="op" id="3159969">:=</span>&nbsp;<span class="builtinfunc" id="3159972">len</span><span class="op" id="3159975">(</span><span class="ident" id="3159976">targ</span><span class="op" id="3159980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3159983">var</span>&nbsp;<span class="ident" id="3159987">b0</span><span class="op" id="3159989">,</span>&nbsp;<span class="ident" id="3159991">bi</span><span class="op" id="3159993">,</span>&nbsp;<span class="ident" id="3159995">t0</span><span class="op" id="3159997">,</span>&nbsp;<span class="ident" id="3159999">ti</span>&nbsp;<span class="builtintype" id="3160002">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160007">for</span>&nbsp;<span class="op" id="3160011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160015">for</span>&nbsp;<span class="ident" id="3160019">bi</span>&nbsp;<span class="op" id="3160022">&lt;</span>&nbsp;<span class="ident" id="3160024">bl</span>&nbsp;<span class="op" id="3160027">&amp;&amp;</span>&nbsp;<span class="ident" id="3160030">base</span><span class="op" id="3160034">[</span><span class="ident" id="3160035">bi</span><span class="op" id="3160037">]</span>&nbsp;<span class="op" id="3160039">!=</span>&nbsp;<span class="ident" id="3160042">Separator</span>&nbsp;<span class="op" id="3160052">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3160057">bi</span><span class="op" id="3160059">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3160064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160068">for</span>&nbsp;<span class="ident" id="3160072">ti</span>&nbsp;<span class="op" id="3160075">&lt;</span>&nbsp;<span class="ident" id="3160077">tl</span>&nbsp;<span class="op" id="3160080">&amp;&amp;</span>&nbsp;<span class="ident" id="3160083">targ</span><span class="op" id="3160087">[</span><span class="ident" id="3160088">ti</span><span class="op" id="3160090">]</span>&nbsp;<span class="op" id="3160092">!=</span>&nbsp;<span class="ident" id="3160095">Separator</span>&nbsp;<span class="op" id="3160105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3160110">ti</span><span class="op" id="3160112">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3160117">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160121">if</span>&nbsp;<span class="ident" id="3160124">targ</span><span class="op" id="3160128">[</span><span class="ident" id="3160129">t0</span><span class="op" id="3160131">:</span><span class="ident" id="3160132">ti</span><span class="op" id="3160134">]</span>&nbsp;<span class="op" id="3160136">!=</span>&nbsp;<span class="ident" id="3160139">base</span><span class="op" id="3160143">[</span><span class="ident" id="3160144">b0</span><span class="op" id="3160146">:</span><span class="ident" id="3160147">bi</span><span class="op" id="3160149">]</span>&nbsp;<span class="op" id="3160151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160156">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3160164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160168">if</span>&nbsp;<span class="ident" id="3160171">bi</span>&nbsp;<span class="op" id="3160174">&lt;</span>&nbsp;<span class="ident" id="3160176">bl</span>&nbsp;<span class="op" id="3160179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3160184">bi</span><span class="op" id="3160186">++</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3160191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160195">if</span>&nbsp;<span class="ident" id="3160198">ti</span>&nbsp;<span class="op" id="3160201">&lt;</span>&nbsp;<span class="ident" id="3160203">tl</span>&nbsp;<span class="op" id="3160206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3160211">ti</span><span class="op" id="3160213">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3160218">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3160222">b0</span>&nbsp;<span class="op" id="3160225">=</span>&nbsp;<span class="ident" id="3160227">bi</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3160232">t0</span>&nbsp;<span class="op" id="3160235">=</span>&nbsp;<span class="ident" id="3160237">ti</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3160241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160244">if</span>&nbsp;<span class="ident" id="3160247">base</span><span class="op" id="3160251">[</span><span class="ident" id="3160252">b0</span><span class="op" id="3160254">:</span><span class="ident" id="3160255">bi</span><span class="op" id="3160257">]</span>&nbsp;<span class="op" id="3160259">==</span>&nbsp;<span class="string" id="3160262">&#34;..&#34;</span>&nbsp;<span class="op" id="3160267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160271">return</span>&nbsp;<span class="string" id="3160278">&#34;&#34;</span><span class="op" id="3160280">,</span>&nbsp;<span class="ident" id="3160282">errors</span><span class="op" id="3160288">.</span><span class="ident" id="3160289">New</span><span class="op" id="3160292">(</span><span class="string" id="3160293">&#34;Rel:&nbsp;can&#39;t&nbsp;make&nbsp;&#34;</span>&nbsp;<span class="op" id="3160312">+</span>&nbsp;<span class="ident" id="3160314">targ</span>&nbsp;<span class="op" id="3160319">+</span>&nbsp;<span class="string" id="3160321">&#34;&nbsp;relative&nbsp;to&nbsp;&#34;</span>&nbsp;<span class="op" id="3160337">+</span>&nbsp;<span class="ident" id="3160339">base</span><span class="op" id="3160343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3160346">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160349">if</span>&nbsp;<span class="ident" id="3160352">b0</span>&nbsp;<span class="op" id="3160355">!=</span>&nbsp;<span class="ident" id="3160358">bl</span>&nbsp;<span class="op" id="3160361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3160365">//&nbsp;Base&nbsp;elements&nbsp;left.&nbsp;Must&nbsp;go&nbsp;up&nbsp;before&nbsp;going&nbsp;down.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3160420">seps</span>&nbsp;<span class="op" id="3160425">:=</span>&nbsp;<span class="ident" id="3160428">strings</span><span class="op" id="3160435">.</span><span class="ident" id="3160436">Count</span><span class="op" id="3160441">(</span><span class="ident" id="3160442">base</span><span class="op" id="3160446">[</span><span class="ident" id="3160447">b0</span><span class="op" id="3160449">:</span><span class="ident" id="3160450">bl</span><span class="op" id="3160452">]</span><span class="op" id="3160453">,</span>&nbsp;<span class="builtintype" id="3160455">string</span><span class="op" id="3160461">(</span><span class="ident" id="3160462">Separator</span><span class="op" id="3160471">)</span><span class="op" id="3160472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3160476">size</span>&nbsp;<span class="op" id="3160481">:=</span>&nbsp;<span class="num" id="3160484">2</span>&nbsp;<span class="op" id="3160486">+</span>&nbsp;<span class="ident" id="3160488">seps</span><span class="op" id="3160492">*</span><span class="num" id="3160493">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160497">if</span>&nbsp;<span class="ident" id="3160500">tl</span>&nbsp;<span class="op" id="3160503">!=</span>&nbsp;<span class="ident" id="3160506">t0</span>&nbsp;<span class="op" id="3160509">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3160514">size</span>&nbsp;<span class="op" id="3160519">+=</span>&nbsp;<span class="num" id="3160522">1</span>&nbsp;<span class="op" id="3160524">+</span>&nbsp;<span class="ident" id="3160526">tl</span>&nbsp;<span class="op" id="3160529">-</span>&nbsp;<span class="ident" id="3160531">t0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3160536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3160540">buf</span>&nbsp;<span class="op" id="3160544">:=</span>&nbsp;<span class="builtinfunc" id="3160547">make</span><span class="op" id="3160551">(</span><span class="op" id="3160552">[</span><span class="op" id="3160553">]</span><span class="builtintype" id="3160554">byte</span><span class="op" id="3160558">,</span>&nbsp;<span class="ident" id="3160560">size</span><span class="op" id="3160564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3160568">n</span>&nbsp;<span class="op" id="3160570">:=</span>&nbsp;<span class="builtinfunc" id="3160573">copy</span><span class="op" id="3160577">(</span><span class="ident" id="3160578">buf</span><span class="op" id="3160581">,</span>&nbsp;<span class="string" id="3160583">&#34;..&#34;</span><span class="op" id="3160587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160591">for</span>&nbsp;<span class="ident" id="3160595">i</span>&nbsp;<span class="op" id="3160597">:=</span>&nbsp;<span class="num" id="3160600">0</span><span class="op" id="3160601">;</span>&nbsp;<span class="ident" id="3160603">i</span>&nbsp;<span class="op" id="3160605">&lt;</span>&nbsp;<span class="ident" id="3160607">seps</span><span class="op" id="3160611">;</span>&nbsp;<span class="ident" id="3160613">i</span><span class="op" id="3160614">++</span>&nbsp;<span class="op" id="3160617">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3160622">buf</span><span class="op" id="3160625">[</span><span class="ident" id="3160626">n</span><span class="op" id="3160627">]</span>&nbsp;<span class="op" id="3160629">=</span>&nbsp;<span class="ident" id="3160631">Separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3160644">copy</span><span class="op" id="3160648">(</span><span class="ident" id="3160649">buf</span><span class="op" id="3160652">[</span><span class="ident" id="3160653">n</span><span class="op" id="3160654">+</span><span class="num" id="3160655">1</span><span class="op" id="3160656">:</span><span class="op" id="3160657">]</span><span class="op" id="3160658">,</span>&nbsp;<span class="string" id="3160660">&#34;..&#34;</span><span class="op" id="3160664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3160669">n</span>&nbsp;<span class="op" id="3160671">+=</span>&nbsp;<span class="num" id="3160674">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3160678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160682">if</span>&nbsp;<span class="ident" id="3160685">t0</span>&nbsp;<span class="op" id="3160688">!=</span>&nbsp;<span class="ident" id="3160691">tl</span>&nbsp;<span class="op" id="3160694">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3160699">buf</span><span class="op" id="3160702">[</span><span class="ident" id="3160703">n</span><span class="op" id="3160704">]</span>&nbsp;<span class="op" id="3160706">=</span>&nbsp;<span class="ident" id="3160708">Separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3160721">copy</span><span class="op" id="3160725">(</span><span class="ident" id="3160726">buf</span><span class="op" id="3160729">[</span><span class="ident" id="3160730">n</span><span class="op" id="3160731">+</span><span class="num" id="3160732">1</span><span class="op" id="3160733">:</span><span class="op" id="3160734">]</span><span class="op" id="3160735">,</span>&nbsp;<span class="ident" id="3160737">targ</span><span class="op" id="3160741">[</span><span class="ident" id="3160742">t0</span><span class="op" id="3160744">:</span><span class="op" id="3160745">]</span><span class="op" id="3160746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3160750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160754">return</span>&nbsp;<span class="builtintype" id="3160761">string</span><span class="op" id="3160767">(</span><span class="ident" id="3160768">buf</span><span class="op" id="3160771">)</span><span class="op" id="3160772">,</span>&nbsp;<span class="builtintype" id="3160774">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3160779">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3160782">return</span>&nbsp;<span class="ident" id="3160789">targ</span><span class="op" id="3160793">[</span><span class="ident" id="3160794">t0</span><span class="op" id="3160796">:</span><span class="op" id="3160797">]</span><span class="op" id="3160798">,</span>&nbsp;<span class="builtintype" id="3160800">nil</span><br>
<span class="lineno"></span><span class="op" id="3160804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3160807">//&nbsp;SkipDir&nbsp;is&nbsp;used&nbsp;as&nbsp;a&nbsp;return&nbsp;value&nbsp;from&nbsp;WalkFuncs&nbsp;to&nbsp;indicate&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3160876">//&nbsp;the&nbsp;directory&nbsp;named&nbsp;in&nbsp;the&nbsp;call&nbsp;is&nbsp;to&nbsp;be&nbsp;skipped.&nbsp;It&nbsp;is&nbsp;not&nbsp;returned</span><br>
<span class="lineno">325</span><span class="comment" id="3160948">//&nbsp;as&nbsp;an&nbsp;error&nbsp;by&nbsp;any&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="3160980">var</span>&nbsp;<span class="ident" id="3160984">SkipDir</span>&nbsp;<span class="op" id="3160992">=</span>&nbsp;<span class="ident" id="3160994">errors</span><span class="op" id="3161000">.</span><span class="ident" id="3161001">New</span><span class="op" id="3161004">(</span><span class="string" id="3161005">&#34;skip&nbsp;this&nbsp;directory&#34;</span><span class="op" id="3161026">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3161029">//&nbsp;WalkFunc&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;the&nbsp;function&nbsp;called&nbsp;for&nbsp;each&nbsp;file&nbsp;or&nbsp;directory</span><br>
<span class="lineno"></span><span class="comment" id="3161103">//&nbsp;visited&nbsp;by&nbsp;Walk.&nbsp;The&nbsp;path&nbsp;argument&nbsp;contains&nbsp;the&nbsp;argument&nbsp;to&nbsp;Walk&nbsp;as&nbsp;a</span><br>
<span class="lineno">330</span><span class="comment" id="3161176">//&nbsp;prefix;&nbsp;that&nbsp;is,&nbsp;if&nbsp;Walk&nbsp;is&nbsp;called&nbsp;with&nbsp;&#34;dir&#34;,&nbsp;which&nbsp;is&nbsp;a&nbsp;directory</span><br>
<span class="lineno"></span><span class="comment" id="3161247">//&nbsp;containing&nbsp;the&nbsp;file&nbsp;&#34;a&#34;,&nbsp;the&nbsp;walk&nbsp;function&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;argument</span><br>
<span class="lineno"></span><span class="comment" id="3161322">//&nbsp;&#34;dir/a&#34;.&nbsp;The&nbsp;info&nbsp;argument&nbsp;is&nbsp;the&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;named&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3161391">//</span><br>
<span class="lineno"></span><span class="comment" id="3161394">//&nbsp;If&nbsp;there&nbsp;was&nbsp;a&nbsp;problem&nbsp;walking&nbsp;to&nbsp;the&nbsp;file&nbsp;or&nbsp;directory&nbsp;named&nbsp;by&nbsp;path,&nbsp;the</span><br>
<span class="lineno">335</span><span class="comment" id="3161472">//&nbsp;incoming&nbsp;error&nbsp;will&nbsp;describe&nbsp;the&nbsp;problem&nbsp;and&nbsp;the&nbsp;function&nbsp;can&nbsp;decide&nbsp;how</span><br>
<span class="lineno"></span><span class="comment" id="3161548">//&nbsp;to&nbsp;handle&nbsp;that&nbsp;error&nbsp;(and&nbsp;Walk&nbsp;will&nbsp;not&nbsp;descend&nbsp;into&nbsp;that&nbsp;directory).&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="3161624">//&nbsp;an&nbsp;error&nbsp;is&nbsp;returned,&nbsp;processing&nbsp;stops.&nbsp;The&nbsp;sole&nbsp;exception&nbsp;is&nbsp;that&nbsp;if&nbsp;path</span><br>
<span class="lineno"></span><span class="comment" id="3161702">//&nbsp;is&nbsp;a&nbsp;directory&nbsp;and&nbsp;the&nbsp;function&nbsp;returns&nbsp;the&nbsp;special&nbsp;value&nbsp;SkipDir,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3161776">//&nbsp;contents&nbsp;of&nbsp;the&nbsp;directory&nbsp;are&nbsp;skipped&nbsp;and&nbsp;processing&nbsp;continues&nbsp;as&nbsp;usual&nbsp;on</span><br>
<span class="lineno">340</span><span class="comment" id="3161854">//&nbsp;the&nbsp;next&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="3161872">type</span>&nbsp;<span class="ident" id="3161877">WalkFunc</span>&nbsp;<span class="keyword" id="3161886">func</span><span class="op" id="3161890">(</span><span class="ident" id="3161891">path</span>&nbsp;<span class="builtintype" id="3161896">string</span><span class="op" id="3161902">,</span>&nbsp;<span class="ident" id="3161904">info</span>&nbsp;<span class="ident" id="3161909">os</span><span class="op" id="3161911">.</span><span class="ident" id="3161912">FileInfo</span><span class="op" id="3161920">,</span>&nbsp;<span class="ident" id="3161922">err</span>&nbsp;<span class="builtintype" id="3161926">error</span><span class="op" id="3161931">)</span>&nbsp;<span class="builtintype" id="3161933">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3161940">var</span>&nbsp;<span class="ident" id="3161944">lstat</span>&nbsp;<span class="op" id="3161950">=</span>&nbsp;<span class="ident" id="3161952">os</span><span class="op" id="3161954">.</span><span class="ident" id="3161955">Lstat</span>&nbsp;<span class="comment" id="3161961">//&nbsp;for&nbsp;testing</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="comment" id="3161977">//&nbsp;walk&nbsp;recursively&nbsp;descends&nbsp;path,&nbsp;calling&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3162023">func</span>&nbsp;<span class="ident" id="3162028">walk</span><span class="op" id="3162032">(</span><span class="ident" id="3162033">path</span>&nbsp;<span class="builtintype" id="3162038">string</span><span class="op" id="3162044">,</span>&nbsp;<span class="ident" id="3162046">info</span>&nbsp;<span class="ident" id="3162051">os</span><span class="op" id="3162053">.</span><span class="ident" id="3162054">FileInfo</span><span class="op" id="3162062">,</span>&nbsp;<span class="ident" id="3162064">walkFn</span>&nbsp;<span class="ident" id="3162071">WalkFunc</span><span class="op" id="3162079">)</span>&nbsp;<span class="builtintype" id="3162081">error</span>&nbsp;<span class="op" id="3162087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3162090">err</span>&nbsp;<span class="op" id="3162094">:=</span>&nbsp;<span class="ident" id="3162097">walkFn</span><span class="op" id="3162103">(</span><span class="ident" id="3162104">path</span><span class="op" id="3162108">,</span>&nbsp;<span class="ident" id="3162110">info</span><span class="op" id="3162114">,</span>&nbsp;<span class="builtintype" id="3162116">nil</span><span class="op" id="3162119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3162122">if</span>&nbsp;<span class="ident" id="3162125">err</span>&nbsp;<span class="op" id="3162129">!=</span>&nbsp;<span class="builtintype" id="3162132">nil</span>&nbsp;<span class="op" id="3162136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3162140">if</span>&nbsp;<span class="ident" id="3162143">info</span><span class="op" id="3162147">.</span><span class="ident" id="3162148">IsDir</span><span class="op" id="3162153">(</span><span class="op" id="3162154">)</span>&nbsp;<span class="op" id="3162156">&amp;&amp;</span>&nbsp;<span class="ident" id="3162159">err</span>&nbsp;<span class="op" id="3162163">==</span>&nbsp;<span class="ident" id="3162166">SkipDir</span>&nbsp;<span class="op" id="3162174">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3162179">return</span>&nbsp;<span class="builtintype" id="3162186">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3162192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3162196">return</span>&nbsp;<span class="ident" id="3162203">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3162208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3162212">if</span>&nbsp;<span class="op" id="3162215">!</span><span class="ident" id="3162216">info</span><span class="op" id="3162220">.</span><span class="ident" id="3162221">IsDir</span><span class="op" id="3162226">(</span><span class="op" id="3162227">)</span>&nbsp;<span class="op" id="3162229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3162233">return</span>&nbsp;<span class="builtintype" id="3162240">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3162245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3162249">names</span><span class="op" id="3162254">,</span>&nbsp;<span class="ident" id="3162256">err</span>&nbsp;<span class="op" id="3162260">:=</span>&nbsp;<span class="ident" id="3162263">readDirNames</span><span class="op" id="3162275">(</span><span class="ident" id="3162276">path</span><span class="op" id="3162280">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3162283">if</span>&nbsp;<span class="ident" id="3162286">err</span>&nbsp;<span class="op" id="3162290">!=</span>&nbsp;<span class="builtintype" id="3162293">nil</span>&nbsp;<span class="op" id="3162297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3162301">return</span>&nbsp;<span class="ident" id="3162308">walkFn</span><span class="op" id="3162314">(</span><span class="ident" id="3162315">path</span><span class="op" id="3162319">,</span>&nbsp;<span class="ident" id="3162321">info</span><span class="op" id="3162325">,</span>&nbsp;<span class="ident" id="3162327">err</span><span class="op" id="3162330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3162333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3162337">for</span>&nbsp;<span class="ident" id="3162341">_</span><span class="op" id="3162342">,</span>&nbsp;<span class="ident" id="3162344">name</span>&nbsp;<span class="op" id="3162349">:=</span>&nbsp;<span class="keyword" id="3162352">range</span>&nbsp;<span class="ident" id="3162358">names</span>&nbsp;<span class="op" id="3162364">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3162368">filename</span>&nbsp;<span class="op" id="3162377">:=</span>&nbsp;<span class="ident" id="3162380">Join</span><span class="op" id="3162384">(</span><span class="ident" id="3162385">path</span><span class="op" id="3162389">,</span>&nbsp;<span class="ident" id="3162391">name</span><span class="op" id="3162395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3162399">fileInfo</span><span class="op" id="3162407">,</span>&nbsp;<span class="ident" id="3162409">err</span>&nbsp;<span class="op" id="3162413">:=</span>&nbsp;<span class="ident" id="3162416">lstat</span><span class="op" id="3162421">(</span><span class="ident" id="3162422">filename</span><span class="op" id="3162430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3162434">if</span>&nbsp;<span class="ident" id="3162437">err</span>&nbsp;<span class="op" id="3162441">!=</span>&nbsp;<span class="builtintype" id="3162444">nil</span>&nbsp;<span class="op" id="3162448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3162453">if</span>&nbsp;<span class="ident" id="3162456">err</span>&nbsp;<span class="op" id="3162460">:=</span>&nbsp;<span class="ident" id="3162463">walkFn</span><span class="op" id="3162469">(</span><span class="ident" id="3162470">filename</span><span class="op" id="3162478">,</span>&nbsp;<span class="ident" id="3162480">fileInfo</span><span class="op" id="3162488">,</span>&nbsp;<span class="ident" id="3162490">err</span><span class="op" id="3162493">)</span><span class="op" id="3162494">;</span>&nbsp;<span class="ident" id="3162496">err</span>&nbsp;<span class="op" id="3162500">!=</span>&nbsp;<span class="builtintype" id="3162503">nil</span>&nbsp;<span class="op" id="3162507">&amp;&amp;</span>&nbsp;<span class="ident" id="3162510">err</span>&nbsp;<span class="op" id="3162514">!=</span>&nbsp;<span class="ident" id="3162517">SkipDir</span>&nbsp;<span class="op" id="3162525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3162531">return</span>&nbsp;<span class="ident" id="3162538">err</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3162545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3162549">}</span>&nbsp;<span class="keyword" id="3162551">else</span>&nbsp;<span class="op" id="3162556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3162561">err</span>&nbsp;<span class="op" id="3162565">=</span>&nbsp;<span class="ident" id="3162567">walk</span><span class="op" id="3162571">(</span><span class="ident" id="3162572">filename</span><span class="op" id="3162580">,</span>&nbsp;<span class="ident" id="3162582">fileInfo</span><span class="op" id="3162590">,</span>&nbsp;<span class="ident" id="3162592">walkFn</span><span class="op" id="3162598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3162603">if</span>&nbsp;<span class="ident" id="3162606">err</span>&nbsp;<span class="op" id="3162610">!=</span>&nbsp;<span class="builtintype" id="3162613">nil</span>&nbsp;<span class="op" id="3162617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3162623">if</span>&nbsp;<span class="op" id="3162626">!</span><span class="ident" id="3162627">fileInfo</span><span class="op" id="3162635">.</span><span class="ident" id="3162636">IsDir</span><span class="op" id="3162641">(</span><span class="op" id="3162642">)</span>&nbsp;<span class="op" id="3162644">||</span>&nbsp;<span class="ident" id="3162647">err</span>&nbsp;<span class="op" id="3162651">!=</span>&nbsp;<span class="ident" id="3162654">SkipDir</span>&nbsp;<span class="op" id="3162662">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3162669">return</span>&nbsp;<span class="ident" id="3162676">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3162684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3162689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3162693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3162696">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3162699">return</span>&nbsp;<span class="builtintype" id="3162706">nil</span><br>
<span class="lineno"></span><span class="op" id="3162710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3162713">//&nbsp;Walk&nbsp;walks&nbsp;the&nbsp;file&nbsp;tree&nbsp;rooted&nbsp;at&nbsp;root,&nbsp;calling&nbsp;walkFn&nbsp;for&nbsp;each&nbsp;file&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="3162789">//&nbsp;directory&nbsp;in&nbsp;the&nbsp;tree,&nbsp;including&nbsp;root.&nbsp;All&nbsp;errors&nbsp;that&nbsp;arise&nbsp;visiting&nbsp;files</span><br>
<span class="lineno">385</span><span class="comment" id="3162868">//&nbsp;and&nbsp;directories&nbsp;are&nbsp;filtered&nbsp;by&nbsp;walkFn.&nbsp;The&nbsp;files&nbsp;are&nbsp;walked&nbsp;in&nbsp;lexical</span><br>
<span class="lineno"></span><span class="comment" id="3162943">//&nbsp;order,&nbsp;which&nbsp;makes&nbsp;the&nbsp;output&nbsp;deterministic&nbsp;but&nbsp;means&nbsp;that&nbsp;for&nbsp;very</span><br>
<span class="lineno"></span><span class="comment" id="3163014">//&nbsp;large&nbsp;directories&nbsp;Walk&nbsp;can&nbsp;be&nbsp;inefficient.</span><br>
<span class="lineno"></span><span class="comment" id="3163060">//&nbsp;Walk&nbsp;does&nbsp;not&nbsp;follow&nbsp;symbolic&nbsp;links.</span><br>
<span class="lineno"></span><span class="keyword" id="3163100">func</span>&nbsp;<span class="ident" id="3163105">Walk</span><span class="op" id="3163109">(</span><span class="ident" id="3163110">root</span>&nbsp;<span class="builtintype" id="3163115">string</span><span class="op" id="3163121">,</span>&nbsp;<span class="ident" id="3163123">walkFn</span>&nbsp;<span class="ident" id="3163130">WalkFunc</span><span class="op" id="3163138">)</span>&nbsp;<span class="builtintype" id="3163140">error</span>&nbsp;<span class="op" id="3163146">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3163149">info</span><span class="op" id="3163153">,</span>&nbsp;<span class="ident" id="3163155">err</span>&nbsp;<span class="op" id="3163159">:=</span>&nbsp;<span class="ident" id="3163162">os</span><span class="op" id="3163164">.</span><span class="ident" id="3163165">Lstat</span><span class="op" id="3163170">(</span><span class="ident" id="3163171">root</span><span class="op" id="3163175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3163178">if</span>&nbsp;<span class="ident" id="3163181">err</span>&nbsp;<span class="op" id="3163185">!=</span>&nbsp;<span class="builtintype" id="3163188">nil</span>&nbsp;<span class="op" id="3163192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3163196">return</span>&nbsp;<span class="ident" id="3163203">walkFn</span><span class="op" id="3163209">(</span><span class="ident" id="3163210">root</span><span class="op" id="3163214">,</span>&nbsp;<span class="builtintype" id="3163216">nil</span><span class="op" id="3163219">,</span>&nbsp;<span class="ident" id="3163221">err</span><span class="op" id="3163224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3163227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3163230">return</span>&nbsp;<span class="ident" id="3163237">walk</span><span class="op" id="3163241">(</span><span class="ident" id="3163242">root</span><span class="op" id="3163246">,</span>&nbsp;<span class="ident" id="3163248">info</span><span class="op" id="3163252">,</span>&nbsp;<span class="ident" id="3163254">walkFn</span><span class="op" id="3163260">)</span><br>
<span class="lineno">395</span><span class="op" id="3163262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3163265">//&nbsp;readDirNames&nbsp;reads&nbsp;the&nbsp;directory&nbsp;named&nbsp;by&nbsp;dirname&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3163330">//&nbsp;a&nbsp;sorted&nbsp;list&nbsp;of&nbsp;directory&nbsp;entries.</span><br>
<span class="lineno"></span><span class="keyword" id="3163369">func</span>&nbsp;<span class="ident" id="3163374">readDirNames</span><span class="op" id="3163386">(</span><span class="ident" id="3163387">dirname</span>&nbsp;<span class="builtintype" id="3163395">string</span><span class="op" id="3163401">)</span>&nbsp;<span class="op" id="3163403">(</span><span class="op" id="3163404">[</span><span class="op" id="3163405">]</span><span class="builtintype" id="3163406">string</span><span class="op" id="3163412">,</span>&nbsp;<span class="builtintype" id="3163414">error</span><span class="op" id="3163419">)</span>&nbsp;<span class="op" id="3163421">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3163424">f</span><span class="op" id="3163425">,</span>&nbsp;<span class="ident" id="3163427">err</span>&nbsp;<span class="op" id="3163431">:=</span>&nbsp;<span class="ident" id="3163434">os</span><span class="op" id="3163436">.</span><span class="ident" id="3163437">Open</span><span class="op" id="3163441">(</span><span class="ident" id="3163442">dirname</span><span class="op" id="3163449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3163452">if</span>&nbsp;<span class="ident" id="3163455">err</span>&nbsp;<span class="op" id="3163459">!=</span>&nbsp;<span class="builtintype" id="3163462">nil</span>&nbsp;<span class="op" id="3163466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3163470">return</span>&nbsp;<span class="builtintype" id="3163477">nil</span><span class="op" id="3163480">,</span>&nbsp;<span class="ident" id="3163482">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3163487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3163490">names</span><span class="op" id="3163495">,</span>&nbsp;<span class="ident" id="3163497">err</span>&nbsp;<span class="op" id="3163501">:=</span>&nbsp;<span class="ident" id="3163504">f</span><span class="op" id="3163505">.</span><span class="ident" id="3163506">Readdirnames</span><span class="op" id="3163518">(</span><span class="op" id="3163519">-</span><span class="num" id="3163520">1</span><span class="op" id="3163521">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3163524">f</span><span class="op" id="3163525">.</span><span class="ident" id="3163526">Close</span><span class="op" id="3163531">(</span><span class="op" id="3163532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3163535">if</span>&nbsp;<span class="ident" id="3163538">err</span>&nbsp;<span class="op" id="3163542">!=</span>&nbsp;<span class="builtintype" id="3163545">nil</span>&nbsp;<span class="op" id="3163549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3163553">return</span>&nbsp;<span class="builtintype" id="3163560">nil</span><span class="op" id="3163563">,</span>&nbsp;<span class="ident" id="3163565">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3163570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3163573">sort</span><span class="op" id="3163577">.</span><span class="ident" id="3163578">Strings</span><span class="op" id="3163585">(</span><span class="ident" id="3163586">names</span><span class="op" id="3163591">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3163594">return</span>&nbsp;<span class="ident" id="3163601">names</span><span class="op" id="3163606">,</span>&nbsp;<span class="builtintype" id="3163608">nil</span><br>
<span class="lineno"></span><span class="op" id="3163612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3163615">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;last&nbsp;element&nbsp;of&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="3163657">//&nbsp;Trailing&nbsp;path&nbsp;separators&nbsp;are&nbsp;removed&nbsp;before&nbsp;extracting&nbsp;the&nbsp;last&nbsp;element.</span><br>
<span class="lineno">415</span><span class="comment" id="3163733">//&nbsp;If&nbsp;the&nbsp;path&nbsp;is&nbsp;empty,&nbsp;Base&nbsp;returns&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3163776">//&nbsp;If&nbsp;the&nbsp;path&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;separators,&nbsp;Base&nbsp;returns&nbsp;a&nbsp;single&nbsp;separator.</span><br>
<span class="lineno"></span><span class="keyword" id="3163857">func</span>&nbsp;<span class="ident" id="3163862">Base</span><span class="op" id="3163866">(</span><span class="ident" id="3163867">path</span>&nbsp;<span class="builtintype" id="3163872">string</span><span class="op" id="3163878">)</span>&nbsp;<span class="builtintype" id="3163880">string</span>&nbsp;<span class="op" id="3163887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3163890">if</span>&nbsp;<span class="ident" id="3163893">path</span>&nbsp;<span class="op" id="3163898">==</span>&nbsp;<span class="string" id="3163901">&#34;&#34;</span>&nbsp;<span class="op" id="3163904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3163908">return</span>&nbsp;<span class="string" id="3163915">&#34;.&#34;</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3163920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3163923">//&nbsp;Strip&nbsp;trailing&nbsp;slashes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3163951">for</span>&nbsp;<span class="builtinfunc" id="3163955">len</span><span class="op" id="3163958">(</span><span class="ident" id="3163959">path</span><span class="op" id="3163963">)</span>&nbsp;<span class="op" id="3163965">&gt;</span>&nbsp;<span class="num" id="3163967">0</span>&nbsp;<span class="op" id="3163969">&amp;&amp;</span>&nbsp;<span class="ident" id="3163972">os</span><span class="op" id="3163974">.</span><span class="ident" id="3163975">IsPathSeparator</span><span class="op" id="3163990">(</span><span class="ident" id="3163991">path</span><span class="op" id="3163995">[</span><span class="builtinfunc" id="3163996">len</span><span class="op" id="3163999">(</span><span class="ident" id="3164000">path</span><span class="op" id="3164004">)</span><span class="op" id="3164005">-</span><span class="num" id="3164006">1</span><span class="op" id="3164007">]</span><span class="op" id="3164008">)</span>&nbsp;<span class="op" id="3164010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3164014">path</span>&nbsp;<span class="op" id="3164019">=</span>&nbsp;<span class="ident" id="3164021">path</span><span class="op" id="3164025">[</span><span class="num" id="3164026">0</span>&nbsp;<span class="op" id="3164028">:</span>&nbsp;<span class="builtinfunc" id="3164030">len</span><span class="op" id="3164033">(</span><span class="ident" id="3164034">path</span><span class="op" id="3164038">)</span><span class="op" id="3164039">-</span><span class="num" id="3164040">1</span><span class="op" id="3164041">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3164044">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3164047">//&nbsp;Throw&nbsp;away&nbsp;volume&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3164074">path</span>&nbsp;<span class="op" id="3164079">=</span>&nbsp;<span class="ident" id="3164081">path</span><span class="op" id="3164085">[</span><span class="builtinfunc" id="3164086">len</span><span class="op" id="3164089">(</span><span class="ident" id="3164090">VolumeName</span><span class="op" id="3164100">(</span><span class="ident" id="3164101">path</span><span class="op" id="3164105">)</span><span class="op" id="3164106">)</span><span class="op" id="3164107">:</span><span class="op" id="3164108">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3164111">//&nbsp;Find&nbsp;the&nbsp;last&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3164137">i</span>&nbsp;<span class="op" id="3164139">:=</span>&nbsp;<span class="builtinfunc" id="3164142">len</span><span class="op" id="3164145">(</span><span class="ident" id="3164146">path</span><span class="op" id="3164150">)</span>&nbsp;<span class="op" id="3164152">-</span>&nbsp;<span class="num" id="3164154">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3164157">for</span>&nbsp;<span class="ident" id="3164161">i</span>&nbsp;<span class="op" id="3164163">&gt;=</span>&nbsp;<span class="num" id="3164166">0</span>&nbsp;<span class="op" id="3164168">&amp;&amp;</span>&nbsp;<span class="op" id="3164171">!</span><span class="ident" id="3164172">os</span><span class="op" id="3164174">.</span><span class="ident" id="3164175">IsPathSeparator</span><span class="op" id="3164190">(</span><span class="ident" id="3164191">path</span><span class="op" id="3164195">[</span><span class="ident" id="3164196">i</span><span class="op" id="3164197">]</span><span class="op" id="3164198">)</span>&nbsp;<span class="op" id="3164200">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3164204">i</span><span class="op" id="3164205">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3164209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3164212">if</span>&nbsp;<span class="ident" id="3164215">i</span>&nbsp;<span class="op" id="3164217">&gt;=</span>&nbsp;<span class="num" id="3164220">0</span>&nbsp;<span class="op" id="3164222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3164226">path</span>&nbsp;<span class="op" id="3164231">=</span>&nbsp;<span class="ident" id="3164233">path</span><span class="op" id="3164237">[</span><span class="ident" id="3164238">i</span><span class="op" id="3164239">+</span><span class="num" id="3164240">1</span><span class="op" id="3164241">:</span><span class="op" id="3164242">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3164245">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3164248">//&nbsp;If&nbsp;empty&nbsp;now,&nbsp;it&nbsp;had&nbsp;only&nbsp;slashes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3164287">if</span>&nbsp;<span class="ident" id="3164290">path</span>&nbsp;<span class="op" id="3164295">==</span>&nbsp;<span class="string" id="3164298">&#34;&#34;</span>&nbsp;<span class="op" id="3164301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3164305">return</span>&nbsp;<span class="builtintype" id="3164312">string</span><span class="op" id="3164318">(</span><span class="ident" id="3164319">Separator</span><span class="op" id="3164328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3164331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3164334">return</span>&nbsp;<span class="ident" id="3164341">path</span><br>
<span class="lineno">440</span><span class="op" id="3164346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3164349">//&nbsp;Dir&nbsp;returns&nbsp;all&nbsp;but&nbsp;the&nbsp;last&nbsp;element&nbsp;of&nbsp;path,&nbsp;typically&nbsp;the&nbsp;path&#39;s&nbsp;directory.</span><br>
<span class="lineno"></span><span class="comment" id="3164430">//&nbsp;After&nbsp;dropping&nbsp;the&nbsp;final&nbsp;element,&nbsp;the&nbsp;path&nbsp;is&nbsp;Cleaned&nbsp;and&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="3164500">//&nbsp;slashes&nbsp;are&nbsp;removed.</span><br>
<span class="lineno">445</span><span class="comment" id="3164524">//&nbsp;If&nbsp;the&nbsp;path&nbsp;is&nbsp;empty,&nbsp;Dir&nbsp;returns&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3164566">//&nbsp;If&nbsp;the&nbsp;path&nbsp;consists&nbsp;entirely&nbsp;of&nbsp;separators,&nbsp;Dir&nbsp;returns&nbsp;a&nbsp;single&nbsp;separator.</span><br>
<span class="lineno"></span><span class="comment" id="3164646">//&nbsp;The&nbsp;returned&nbsp;path&nbsp;does&nbsp;not&nbsp;end&nbsp;in&nbsp;a&nbsp;separator&nbsp;unless&nbsp;it&nbsp;is&nbsp;the&nbsp;root&nbsp;directory.</span><br>
<span class="lineno"></span><span class="keyword" id="3164728">func</span>&nbsp;<span class="ident" id="3164733">Dir</span><span class="op" id="3164736">(</span><span class="ident" id="3164737">path</span>&nbsp;<span class="builtintype" id="3164742">string</span><span class="op" id="3164748">)</span>&nbsp;<span class="builtintype" id="3164750">string</span>&nbsp;<span class="op" id="3164757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3164760">vol</span>&nbsp;<span class="op" id="3164764">:=</span>&nbsp;<span class="ident" id="3164767">VolumeName</span><span class="op" id="3164777">(</span><span class="ident" id="3164778">path</span><span class="op" id="3164782">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3164785">i</span>&nbsp;<span class="op" id="3164787">:=</span>&nbsp;<span class="builtinfunc" id="3164790">len</span><span class="op" id="3164793">(</span><span class="ident" id="3164794">path</span><span class="op" id="3164798">)</span>&nbsp;<span class="op" id="3164800">-</span>&nbsp;<span class="num" id="3164802">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3164805">for</span>&nbsp;<span class="ident" id="3164809">i</span>&nbsp;<span class="op" id="3164811">&gt;=</span>&nbsp;<span class="builtinfunc" id="3164814">len</span><span class="op" id="3164817">(</span><span class="ident" id="3164818">vol</span><span class="op" id="3164821">)</span>&nbsp;<span class="op" id="3164823">&amp;&amp;</span>&nbsp;<span class="op" id="3164826">!</span><span class="ident" id="3164827">os</span><span class="op" id="3164829">.</span><span class="ident" id="3164830">IsPathSeparator</span><span class="op" id="3164845">(</span><span class="ident" id="3164846">path</span><span class="op" id="3164850">[</span><span class="ident" id="3164851">i</span><span class="op" id="3164852">]</span><span class="op" id="3164853">)</span>&nbsp;<span class="op" id="3164855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3164859">i</span><span class="op" id="3164860">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3164864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3164867">dir</span>&nbsp;<span class="op" id="3164871">:=</span>&nbsp;<span class="ident" id="3164874">Clean</span><span class="op" id="3164879">(</span><span class="ident" id="3164880">path</span><span class="op" id="3164884">[</span><span class="builtinfunc" id="3164885">len</span><span class="op" id="3164888">(</span><span class="ident" id="3164889">vol</span><span class="op" id="3164892">)</span>&nbsp;<span class="op" id="3164894">:</span>&nbsp;<span class="ident" id="3164896">i</span><span class="op" id="3164897">+</span><span class="num" id="3164898">1</span><span class="op" id="3164899">]</span><span class="op" id="3164900">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3164903">return</span>&nbsp;<span class="ident" id="3164910">vol</span>&nbsp;<span class="op" id="3164914">+</span>&nbsp;<span class="ident" id="3164916">dir</span><br>
<span class="lineno"></span><span class="op" id="3164920">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3164923">//&nbsp;VolumeName&nbsp;returns&nbsp;leading&nbsp;volume&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="3164966">//&nbsp;Given&nbsp;&#34;C:\foo\bar&#34;&nbsp;it&nbsp;returns&nbsp;&#34;C:&#34;&nbsp;under&nbsp;windows.</span><br>
<span class="lineno">460</span><span class="comment" id="3165019">//&nbsp;Given&nbsp;&#34;\\host\share\foo&#34;&nbsp;it&nbsp;returns&nbsp;&#34;\\host\share&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3165074">//&nbsp;On&nbsp;other&nbsp;platforms&nbsp;it&nbsp;returns&nbsp;&#34;&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3165111">func</span>&nbsp;<span class="ident" id="3165116">VolumeName</span><span class="op" id="3165126">(</span><span class="ident" id="3165127">path</span>&nbsp;<span class="builtintype" id="3165132">string</span><span class="op" id="3165138">)</span>&nbsp;<span class="op" id="3165140">(</span><span class="ident" id="3165141">v</span>&nbsp;<span class="builtintype" id="3165143">string</span><span class="op" id="3165149">)</span>&nbsp;<span class="op" id="3165151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3165154">return</span>&nbsp;<span class="ident" id="3165161">path</span><span class="op" id="3165165">[</span><span class="op" id="3165166">:</span><span class="ident" id="3165167">volumeNameLen</span><span class="op" id="3165180">(</span><span class="ident" id="3165181">path</span><span class="op" id="3165185">)</span><span class="op" id="3165186">]</span><br>
<span class="lineno"></span><span class="op" id="3165188">}</span>
</div>
</body>
</html>
