<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>bytes</h2>
<ul>
<li><a href="/gostd/bytes/buffer.go.html">buffer.go</a></li>
<li><a href="/gostd/bytes/buffer_test.go.html">buffer_test.go</a></li>
<li><a href="/gostd/bytes/bytes.go.html">bytes.go</a></li>
<li><a href="/gostd/bytes/bytes_decl.go.html">bytes_decl.go</a></li>
<li><a href="/gostd/bytes/bytes_test.go.html">bytes_test.go</a></li>
<li><a href="/gostd/bytes/compare_test.go.html">compare_test.go</a></li>
<li><a href="/gostd/bytes/equal_test.go.html">equal_test.go</a></li>
<li><a href="/gostd/bytes/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/bytes/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/bytes/reader.go.html">reader.go</a></li>
<li><a href="/gostd/bytes/reader_test.go.html">reader_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2198294">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2198349">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2198403">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2198454">//&nbsp;Package&nbsp;bytes&nbsp;implements&nbsp;functions&nbsp;for&nbsp;the&nbsp;manipulation&nbsp;of&nbsp;byte&nbsp;slices.</span><br>
<span class="lineno"></span><span class="comment" id="2198529">//&nbsp;It&nbsp;is&nbsp;analogous&nbsp;to&nbsp;the&nbsp;facilities&nbsp;of&nbsp;the&nbsp;strings&nbsp;package.</span><br>
<span class="lineno"></span><span class="keyword" id="2198590">package</span>&nbsp;<span class="ident" id="2198598">bytes</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2198605">import</span>&nbsp;<span class="op" id="2198612">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2198615">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2198626">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="2198641">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2198644">func</span>&nbsp;<span class="ident" id="2198649">equalPortable</span><span class="op" id="2198662">(</span><span class="ident" id="2198663">a</span><span class="op" id="2198664">,</span>&nbsp;<span class="ident" id="2198666">b</span>&nbsp;<span class="op" id="2198668">[</span><span class="op" id="2198669">]</span><span class="builtintype" id="2198670">byte</span><span class="op" id="2198674">)</span>&nbsp;<span class="builtintype" id="2198676">bool</span>&nbsp;<span class="op" id="2198681">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2198684">if</span>&nbsp;<span class="builtinfunc" id="2198687">len</span><span class="op" id="2198690">(</span><span class="ident" id="2198691">a</span><span class="op" id="2198692">)</span>&nbsp;<span class="op" id="2198694">!=</span>&nbsp;<span class="builtinfunc" id="2198697">len</span><span class="op" id="2198700">(</span><span class="ident" id="2198701">b</span><span class="op" id="2198702">)</span>&nbsp;<span class="op" id="2198704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2198708">return</span>&nbsp;<span class="builtintype" id="2198715">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2198722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2198725">for</span>&nbsp;<span class="ident" id="2198729">i</span><span class="op" id="2198730">,</span>&nbsp;<span class="ident" id="2198732">c</span>&nbsp;<span class="op" id="2198734">:=</span>&nbsp;<span class="keyword" id="2198737">range</span>&nbsp;<span class="ident" id="2198743">a</span>&nbsp;<span class="op" id="2198745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2198749">if</span>&nbsp;<span class="ident" id="2198752">c</span>&nbsp;<span class="op" id="2198754">!=</span>&nbsp;<span class="ident" id="2198757">b</span><span class="op" id="2198758">[</span><span class="ident" id="2198759">i</span><span class="op" id="2198760">]</span>&nbsp;<span class="op" id="2198762">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2198767">return</span>&nbsp;<span class="builtintype" id="2198774">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2198782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2198785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2198788">return</span>&nbsp;<span class="builtintype" id="2198795">true</span><br>
<span class="lineno"></span><span class="op" id="2198800">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="2198803">//&nbsp;explode&nbsp;splits&nbsp;s&nbsp;into&nbsp;a&nbsp;slice&nbsp;of&nbsp;UTF-8&nbsp;sequences,&nbsp;one&nbsp;per&nbsp;Unicode&nbsp;character&nbsp;(still&nbsp;slices&nbsp;of&nbsp;bytes),</span><br>
<span class="lineno"></span><span class="comment" id="2198907">//&nbsp;up&nbsp;to&nbsp;a&nbsp;maximum&nbsp;of&nbsp;n&nbsp;byte&nbsp;slices.&nbsp;Invalid&nbsp;UTF-8&nbsp;sequences&nbsp;are&nbsp;chopped&nbsp;into&nbsp;individual&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="2199003">func</span>&nbsp;<span class="ident" id="2199008">explode</span><span class="op" id="2199015">(</span><span class="ident" id="2199016">s</span>&nbsp;<span class="op" id="2199018">[</span><span class="op" id="2199019">]</span><span class="builtintype" id="2199020">byte</span><span class="op" id="2199024">,</span>&nbsp;<span class="ident" id="2199026">n</span>&nbsp;<span class="builtintype" id="2199028">int</span><span class="op" id="2199031">)</span>&nbsp;<span class="op" id="2199033">[</span><span class="op" id="2199034">]</span><span class="op" id="2199035">[</span><span class="op" id="2199036">]</span><span class="builtintype" id="2199037">byte</span>&nbsp;<span class="op" id="2199042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2199045">if</span>&nbsp;<span class="ident" id="2199048">n</span>&nbsp;<span class="op" id="2199050">&lt;=</span>&nbsp;<span class="num" id="2199053">0</span>&nbsp;<span class="op" id="2199055">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2199059">n</span>&nbsp;<span class="op" id="2199061">=</span>&nbsp;<span class="builtinfunc" id="2199063">len</span><span class="op" id="2199066">(</span><span class="ident" id="2199067">s</span><span class="op" id="2199068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2199071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2199074">a</span>&nbsp;<span class="op" id="2199076">:=</span>&nbsp;<span class="builtinfunc" id="2199079">make</span><span class="op" id="2199083">(</span><span class="op" id="2199084">[</span><span class="op" id="2199085">]</span><span class="op" id="2199086">[</span><span class="op" id="2199087">]</span><span class="builtintype" id="2199088">byte</span><span class="op" id="2199092">,</span>&nbsp;<span class="ident" id="2199094">n</span><span class="op" id="2199095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2199098">var</span>&nbsp;<span class="ident" id="2199102">size</span>&nbsp;<span class="builtintype" id="2199107">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2199112">na</span>&nbsp;<span class="op" id="2199115">:=</span>&nbsp;<span class="num" id="2199118">0</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2199121">for</span>&nbsp;<span class="builtinfunc" id="2199125">len</span><span class="op" id="2199128">(</span><span class="ident" id="2199129">s</span><span class="op" id="2199130">)</span>&nbsp;<span class="op" id="2199132">&gt;</span>&nbsp;<span class="num" id="2199134">0</span>&nbsp;<span class="op" id="2199136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2199140">if</span>&nbsp;<span class="ident" id="2199143">na</span><span class="op" id="2199145">+</span><span class="num" id="2199146">1</span>&nbsp;<span class="op" id="2199148">&gt;=</span>&nbsp;<span class="ident" id="2199151">n</span>&nbsp;<span class="op" id="2199153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2199158">a</span><span class="op" id="2199159">[</span><span class="ident" id="2199160">na</span><span class="op" id="2199162">]</span>&nbsp;<span class="op" id="2199164">=</span>&nbsp;<span class="ident" id="2199166">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2199171">na</span><span class="op" id="2199173">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2199179">break</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2199187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2199191">_</span><span class="op" id="2199192">,</span>&nbsp;<span class="ident" id="2199194">size</span>&nbsp;<span class="op" id="2199199">=</span>&nbsp;<span class="ident" id="2199201">utf8</span><span class="op" id="2199205">.</span><span class="ident" id="2199206">DecodeRune</span><span class="op" id="2199216">(</span><span class="ident" id="2199217">s</span><span class="op" id="2199218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2199222">a</span><span class="op" id="2199223">[</span><span class="ident" id="2199224">na</span><span class="op" id="2199226">]</span>&nbsp;<span class="op" id="2199228">=</span>&nbsp;<span class="ident" id="2199230">s</span><span class="op" id="2199231">[</span><span class="num" id="2199232">0</span><span class="op" id="2199233">:</span><span class="ident" id="2199234">size</span><span class="op" id="2199238">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2199242">s</span>&nbsp;<span class="op" id="2199244">=</span>&nbsp;<span class="ident" id="2199246">s</span><span class="op" id="2199247">[</span><span class="ident" id="2199248">size</span><span class="op" id="2199252">:</span><span class="op" id="2199253">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2199257">na</span><span class="op" id="2199259">++</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2199263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2199266">return</span>&nbsp;<span class="ident" id="2199273">a</span><span class="op" id="2199274">[</span><span class="num" id="2199275">0</span><span class="op" id="2199276">:</span><span class="ident" id="2199277">na</span><span class="op" id="2199279">]</span><br>
<span class="lineno"></span><span class="op" id="2199281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2199284">//&nbsp;Count&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;non-overlapping&nbsp;instances&nbsp;of&nbsp;sep&nbsp;in&nbsp;s.</span><br>
<span class="lineno">50</span><span class="keyword" id="2199353">func</span>&nbsp;<span class="ident" id="2199358">Count</span><span class="op" id="2199363">(</span><span class="ident" id="2199364">s</span><span class="op" id="2199365">,</span>&nbsp;<span class="ident" id="2199367">sep</span>&nbsp;<span class="op" id="2199371">[</span><span class="op" id="2199372">]</span><span class="builtintype" id="2199373">byte</span><span class="op" id="2199377">)</span>&nbsp;<span class="builtintype" id="2199379">int</span>&nbsp;<span class="op" id="2199383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2199386">n</span>&nbsp;<span class="op" id="2199388">:=</span>&nbsp;<span class="builtinfunc" id="2199391">len</span><span class="op" id="2199394">(</span><span class="ident" id="2199395">sep</span><span class="op" id="2199398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2199401">if</span>&nbsp;<span class="ident" id="2199404">n</span>&nbsp;<span class="op" id="2199406">==</span>&nbsp;<span class="num" id="2199409">0</span>&nbsp;<span class="op" id="2199411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2199415">return</span>&nbsp;<span class="ident" id="2199422">utf8</span><span class="op" id="2199426">.</span><span class="ident" id="2199427">RuneCount</span><span class="op" id="2199436">(</span><span class="ident" id="2199437">s</span><span class="op" id="2199438">)</span>&nbsp;<span class="op" id="2199440">+</span>&nbsp;<span class="num" id="2199442">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2199445">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2199448">if</span>&nbsp;<span class="ident" id="2199451">n</span>&nbsp;<span class="op" id="2199453">&gt;</span>&nbsp;<span class="builtinfunc" id="2199455">len</span><span class="op" id="2199458">(</span><span class="ident" id="2199459">s</span><span class="op" id="2199460">)</span>&nbsp;<span class="op" id="2199462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2199466">return</span>&nbsp;<span class="num" id="2199473">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2199476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2199479">count</span>&nbsp;<span class="op" id="2199485">:=</span>&nbsp;<span class="num" id="2199488">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2199491">c</span>&nbsp;<span class="op" id="2199493">:=</span>&nbsp;<span class="ident" id="2199496">sep</span><span class="op" id="2199499">[</span><span class="num" id="2199500">0</span><span class="op" id="2199501">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2199504">i</span>&nbsp;<span class="op" id="2199506">:=</span>&nbsp;<span class="num" id="2199509">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2199512">t</span>&nbsp;<span class="op" id="2199514">:=</span>&nbsp;<span class="ident" id="2199517">s</span><span class="op" id="2199518">[</span><span class="op" id="2199519">:</span><span class="builtinfunc" id="2199520">len</span><span class="op" id="2199523">(</span><span class="ident" id="2199524">s</span><span class="op" id="2199525">)</span><span class="op" id="2199526">-</span><span class="ident" id="2199527">n</span><span class="op" id="2199528">+</span><span class="num" id="2199529">1</span><span class="op" id="2199530">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2199533">for</span>&nbsp;<span class="ident" id="2199537">i</span>&nbsp;<span class="op" id="2199539">&lt;</span>&nbsp;<span class="builtinfunc" id="2199541">len</span><span class="op" id="2199544">(</span><span class="ident" id="2199545">t</span><span class="op" id="2199546">)</span>&nbsp;<span class="op" id="2199548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2199552">if</span>&nbsp;<span class="ident" id="2199555">t</span><span class="op" id="2199556">[</span><span class="ident" id="2199557">i</span><span class="op" id="2199558">]</span>&nbsp;<span class="op" id="2199560">!=</span>&nbsp;<span class="ident" id="2199563">c</span>&nbsp;<span class="op" id="2199565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2199570">o</span>&nbsp;<span class="op" id="2199572">:=</span>&nbsp;<span class="ident" id="2199575">IndexByte</span><span class="op" id="2199584">(</span><span class="ident" id="2199585">t</span><span class="op" id="2199586">[</span><span class="ident" id="2199587">i</span><span class="op" id="2199588">:</span><span class="op" id="2199589">]</span><span class="op" id="2199590">,</span>&nbsp;<span class="ident" id="2199592">c</span><span class="op" id="2199593">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2199598">if</span>&nbsp;<span class="ident" id="2199601">o</span>&nbsp;<span class="op" id="2199603">&lt;</span>&nbsp;<span class="num" id="2199605">0</span>&nbsp;<span class="op" id="2199607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2199613">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2199622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2199627">i</span>&nbsp;<span class="op" id="2199629">+=</span>&nbsp;<span class="ident" id="2199632">o</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2199636">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2199640">if</span>&nbsp;<span class="ident" id="2199643">n</span>&nbsp;<span class="op" id="2199645">==</span>&nbsp;<span class="num" id="2199648">1</span>&nbsp;<span class="op" id="2199650">||</span>&nbsp;<span class="ident" id="2199653">Equal</span><span class="op" id="2199658">(</span><span class="ident" id="2199659">s</span><span class="op" id="2199660">[</span><span class="ident" id="2199661">i</span><span class="op" id="2199662">:</span><span class="ident" id="2199663">i</span><span class="op" id="2199664">+</span><span class="ident" id="2199665">n</span><span class="op" id="2199666">]</span><span class="op" id="2199667">,</span>&nbsp;<span class="ident" id="2199669">sep</span><span class="op" id="2199672">)</span>&nbsp;<span class="op" id="2199674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2199679">count</span><span class="op" id="2199684">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2199690">i</span>&nbsp;<span class="op" id="2199692">+=</span>&nbsp;<span class="ident" id="2199695">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2199700">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2199711">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2199715">i</span><span class="op" id="2199716">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2199720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2199723">return</span>&nbsp;<span class="ident" id="2199730">count</span><br>
<span class="lineno"></span><span class="op" id="2199736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="2199739">//&nbsp;Contains&nbsp;reports&nbsp;whether&nbsp;subslice&nbsp;is&nbsp;within&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="2199789">func</span>&nbsp;<span class="ident" id="2199794">Contains</span><span class="op" id="2199802">(</span><span class="ident" id="2199803">b</span><span class="op" id="2199804">,</span>&nbsp;<span class="ident" id="2199806">subslice</span>&nbsp;<span class="op" id="2199815">[</span><span class="op" id="2199816">]</span><span class="builtintype" id="2199817">byte</span><span class="op" id="2199821">)</span>&nbsp;<span class="builtintype" id="2199823">bool</span>&nbsp;<span class="op" id="2199828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2199831">return</span>&nbsp;<span class="ident" id="2199838">Index</span><span class="op" id="2199843">(</span><span class="ident" id="2199844">b</span><span class="op" id="2199845">,</span>&nbsp;<span class="ident" id="2199847">subslice</span><span class="op" id="2199855">)</span>&nbsp;<span class="op" id="2199857">!=</span>&nbsp;<span class="op" id="2199860">-</span><span class="num" id="2199861">1</span><br>
<span class="lineno"></span><span class="op" id="2199863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="2199866">//&nbsp;Index&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;instance&nbsp;of&nbsp;sep&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;sep&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2199962">func</span>&nbsp;<span class="ident" id="2199967">Index</span><span class="op" id="2199972">(</span><span class="ident" id="2199973">s</span><span class="op" id="2199974">,</span>&nbsp;<span class="ident" id="2199976">sep</span>&nbsp;<span class="op" id="2199980">[</span><span class="op" id="2199981">]</span><span class="builtintype" id="2199982">byte</span><span class="op" id="2199986">)</span>&nbsp;<span class="builtintype" id="2199988">int</span>&nbsp;<span class="op" id="2199992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2199995">n</span>&nbsp;<span class="op" id="2199997">:=</span>&nbsp;<span class="builtinfunc" id="2200000">len</span><span class="op" id="2200003">(</span><span class="ident" id="2200004">sep</span><span class="op" id="2200007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2200010">if</span>&nbsp;<span class="ident" id="2200013">n</span>&nbsp;<span class="op" id="2200015">==</span>&nbsp;<span class="num" id="2200018">0</span>&nbsp;<span class="op" id="2200020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2200024">return</span>&nbsp;<span class="num" id="2200031">0</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2200034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2200037">if</span>&nbsp;<span class="ident" id="2200040">n</span>&nbsp;<span class="op" id="2200042">&gt;</span>&nbsp;<span class="builtinfunc" id="2200044">len</span><span class="op" id="2200047">(</span><span class="ident" id="2200048">s</span><span class="op" id="2200049">)</span>&nbsp;<span class="op" id="2200051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2200055">return</span>&nbsp;<span class="op" id="2200062">-</span><span class="num" id="2200063">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2200066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2200069">c</span>&nbsp;<span class="op" id="2200071">:=</span>&nbsp;<span class="ident" id="2200074">sep</span><span class="op" id="2200077">[</span><span class="num" id="2200078">0</span><span class="op" id="2200079">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2200082">if</span>&nbsp;<span class="ident" id="2200085">n</span>&nbsp;<span class="op" id="2200087">==</span>&nbsp;<span class="num" id="2200090">1</span>&nbsp;<span class="op" id="2200092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2200096">return</span>&nbsp;<span class="ident" id="2200103">IndexByte</span><span class="op" id="2200112">(</span><span class="ident" id="2200113">s</span><span class="op" id="2200114">,</span>&nbsp;<span class="ident" id="2200116">c</span><span class="op" id="2200117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2200120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2200123">i</span>&nbsp;<span class="op" id="2200125">:=</span>&nbsp;<span class="num" id="2200128">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2200131">t</span>&nbsp;<span class="op" id="2200133">:=</span>&nbsp;<span class="ident" id="2200136">s</span><span class="op" id="2200137">[</span><span class="op" id="2200138">:</span><span class="builtinfunc" id="2200139">len</span><span class="op" id="2200142">(</span><span class="ident" id="2200143">s</span><span class="op" id="2200144">)</span><span class="op" id="2200145">-</span><span class="ident" id="2200146">n</span><span class="op" id="2200147">+</span><span class="num" id="2200148">1</span><span class="op" id="2200149">]</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2200152">for</span>&nbsp;<span class="ident" id="2200156">i</span>&nbsp;<span class="op" id="2200158">&lt;</span>&nbsp;<span class="builtinfunc" id="2200160">len</span><span class="op" id="2200163">(</span><span class="ident" id="2200164">t</span><span class="op" id="2200165">)</span>&nbsp;<span class="op" id="2200167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2200171">if</span>&nbsp;<span class="ident" id="2200174">t</span><span class="op" id="2200175">[</span><span class="ident" id="2200176">i</span><span class="op" id="2200177">]</span>&nbsp;<span class="op" id="2200179">!=</span>&nbsp;<span class="ident" id="2200182">c</span>&nbsp;<span class="op" id="2200184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2200189">o</span>&nbsp;<span class="op" id="2200191">:=</span>&nbsp;<span class="ident" id="2200194">IndexByte</span><span class="op" id="2200203">(</span><span class="ident" id="2200204">t</span><span class="op" id="2200205">[</span><span class="ident" id="2200206">i</span><span class="op" id="2200207">:</span><span class="op" id="2200208">]</span><span class="op" id="2200209">,</span>&nbsp;<span class="ident" id="2200211">c</span><span class="op" id="2200212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2200217">if</span>&nbsp;<span class="ident" id="2200220">o</span>&nbsp;<span class="op" id="2200222">&lt;</span>&nbsp;<span class="num" id="2200224">0</span>&nbsp;<span class="op" id="2200226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2200232">break</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2200241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2200246">i</span>&nbsp;<span class="op" id="2200248">+=</span>&nbsp;<span class="ident" id="2200251">o</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2200255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2200259">if</span>&nbsp;<span class="ident" id="2200262">Equal</span><span class="op" id="2200267">(</span><span class="ident" id="2200268">s</span><span class="op" id="2200269">[</span><span class="ident" id="2200270">i</span><span class="op" id="2200271">:</span><span class="ident" id="2200272">i</span><span class="op" id="2200273">+</span><span class="ident" id="2200274">n</span><span class="op" id="2200275">]</span><span class="op" id="2200276">,</span>&nbsp;<span class="ident" id="2200278">sep</span><span class="op" id="2200281">)</span>&nbsp;<span class="op" id="2200283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2200288">return</span>&nbsp;<span class="ident" id="2200295">i</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2200299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2200303">i</span><span class="op" id="2200304">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2200308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2200311">return</span>&nbsp;<span class="op" id="2200318">-</span><span class="num" id="2200319">1</span><br>
<span class="lineno"></span><span class="op" id="2200321">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="2200324">func</span>&nbsp;<span class="ident" id="2200329">indexBytePortable</span><span class="op" id="2200346">(</span><span class="ident" id="2200347">s</span>&nbsp;<span class="op" id="2200349">[</span><span class="op" id="2200350">]</span><span class="builtintype" id="2200351">byte</span><span class="op" id="2200355">,</span>&nbsp;<span class="ident" id="2200357">c</span>&nbsp;<span class="builtintype" id="2200359">byte</span><span class="op" id="2200363">)</span>&nbsp;<span class="builtintype" id="2200365">int</span>&nbsp;<span class="op" id="2200369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2200372">for</span>&nbsp;<span class="ident" id="2200376">i</span><span class="op" id="2200377">,</span>&nbsp;<span class="ident" id="2200379">b</span>&nbsp;<span class="op" id="2200381">:=</span>&nbsp;<span class="keyword" id="2200384">range</span>&nbsp;<span class="ident" id="2200390">s</span>&nbsp;<span class="op" id="2200392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2200396">if</span>&nbsp;<span class="ident" id="2200399">b</span>&nbsp;<span class="op" id="2200401">==</span>&nbsp;<span class="ident" id="2200404">c</span>&nbsp;<span class="op" id="2200406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2200411">return</span>&nbsp;<span class="ident" id="2200418">i</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2200422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2200425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2200428">return</span>&nbsp;<span class="op" id="2200435">-</span><span class="num" id="2200436">1</span><br>
<span class="lineno"></span><span class="op" id="2200438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="2200441">//&nbsp;LastIndex&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;instance&nbsp;of&nbsp;sep&nbsp;in&nbsp;s,&nbsp;or&nbsp;-1&nbsp;if&nbsp;sep&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2200540">func</span>&nbsp;<span class="ident" id="2200545">LastIndex</span><span class="op" id="2200554">(</span><span class="ident" id="2200555">s</span><span class="op" id="2200556">,</span>&nbsp;<span class="ident" id="2200558">sep</span>&nbsp;<span class="op" id="2200562">[</span><span class="op" id="2200563">]</span><span class="builtintype" id="2200564">byte</span><span class="op" id="2200568">)</span>&nbsp;<span class="builtintype" id="2200570">int</span>&nbsp;<span class="op" id="2200574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2200577">n</span>&nbsp;<span class="op" id="2200579">:=</span>&nbsp;<span class="builtinfunc" id="2200582">len</span><span class="op" id="2200585">(</span><span class="ident" id="2200586">sep</span><span class="op" id="2200589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2200592">if</span>&nbsp;<span class="ident" id="2200595">n</span>&nbsp;<span class="op" id="2200597">==</span>&nbsp;<span class="num" id="2200600">0</span>&nbsp;<span class="op" id="2200602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2200606">return</span>&nbsp;<span class="builtinfunc" id="2200613">len</span><span class="op" id="2200616">(</span><span class="ident" id="2200617">s</span><span class="op" id="2200618">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2200621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2200624">c</span>&nbsp;<span class="op" id="2200626">:=</span>&nbsp;<span class="ident" id="2200629">sep</span><span class="op" id="2200632">[</span><span class="num" id="2200633">0</span><span class="op" id="2200634">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2200637">for</span>&nbsp;<span class="ident" id="2200641">i</span>&nbsp;<span class="op" id="2200643">:=</span>&nbsp;<span class="builtinfunc" id="2200646">len</span><span class="op" id="2200649">(</span><span class="ident" id="2200650">s</span><span class="op" id="2200651">)</span>&nbsp;<span class="op" id="2200653">-</span>&nbsp;<span class="ident" id="2200655">n</span><span class="op" id="2200656">;</span>&nbsp;<span class="ident" id="2200658">i</span>&nbsp;<span class="op" id="2200660">&gt;=</span>&nbsp;<span class="num" id="2200663">0</span><span class="op" id="2200664">;</span>&nbsp;<span class="ident" id="2200666">i</span><span class="op" id="2200667">--</span>&nbsp;<span class="op" id="2200670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2200674">if</span>&nbsp;<span class="ident" id="2200677">s</span><span class="op" id="2200678">[</span><span class="ident" id="2200679">i</span><span class="op" id="2200680">]</span>&nbsp;<span class="op" id="2200682">==</span>&nbsp;<span class="ident" id="2200685">c</span>&nbsp;<span class="op" id="2200687">&amp;&amp;</span>&nbsp;<span class="op" id="2200690">(</span><span class="ident" id="2200691">n</span>&nbsp;<span class="op" id="2200693">==</span>&nbsp;<span class="num" id="2200696">1</span>&nbsp;<span class="op" id="2200698">||</span>&nbsp;<span class="ident" id="2200701">Equal</span><span class="op" id="2200706">(</span><span class="ident" id="2200707">s</span><span class="op" id="2200708">[</span><span class="ident" id="2200709">i</span><span class="op" id="2200710">:</span><span class="ident" id="2200711">i</span><span class="op" id="2200712">+</span><span class="ident" id="2200713">n</span><span class="op" id="2200714">]</span><span class="op" id="2200715">,</span>&nbsp;<span class="ident" id="2200717">sep</span><span class="op" id="2200720">)</span><span class="op" id="2200721">)</span>&nbsp;<span class="op" id="2200723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2200728">return</span>&nbsp;<span class="ident" id="2200735">i</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2200739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2200742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2200745">return</span>&nbsp;<span class="op" id="2200752">-</span><span class="num" id="2200753">1</span><br>
<span class="lineno"></span><span class="op" id="2200755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="2200758">//&nbsp;IndexRune&nbsp;interprets&nbsp;s&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="comment" id="2200836">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;byte&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;given&nbsp;rune.</span><br>
<span class="lineno"></span><span class="comment" id="2200913">//&nbsp;It&nbsp;returns&nbsp;-1&nbsp;if&nbsp;rune&nbsp;is&nbsp;not&nbsp;present&nbsp;in&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2200959">func</span>&nbsp;<span class="ident" id="2200964">IndexRune</span><span class="op" id="2200973">(</span><span class="ident" id="2200974">s</span>&nbsp;<span class="op" id="2200976">[</span><span class="op" id="2200977">]</span><span class="builtintype" id="2200978">byte</span><span class="op" id="2200982">,</span>&nbsp;<span class="ident" id="2200984">r</span>&nbsp;<span class="builtintype" id="2200986">rune</span><span class="op" id="2200990">)</span>&nbsp;<span class="builtintype" id="2200992">int</span>&nbsp;<span class="op" id="2200996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2200999">for</span>&nbsp;<span class="ident" id="2201003">i</span>&nbsp;<span class="op" id="2201005">:=</span>&nbsp;<span class="num" id="2201008">0</span><span class="op" id="2201009">;</span>&nbsp;<span class="ident" id="2201011">i</span>&nbsp;<span class="op" id="2201013">&lt;</span>&nbsp;<span class="builtinfunc" id="2201015">len</span><span class="op" id="2201018">(</span><span class="ident" id="2201019">s</span><span class="op" id="2201020">)</span><span class="op" id="2201021">;</span>&nbsp;<span class="op" id="2201023">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2201027">r1</span><span class="op" id="2201029">,</span>&nbsp;<span class="ident" id="2201031">size</span>&nbsp;<span class="op" id="2201036">:=</span>&nbsp;<span class="ident" id="2201039">utf8</span><span class="op" id="2201043">.</span><span class="ident" id="2201044">DecodeRune</span><span class="op" id="2201054">(</span><span class="ident" id="2201055">s</span><span class="op" id="2201056">[</span><span class="ident" id="2201057">i</span><span class="op" id="2201058">:</span><span class="op" id="2201059">]</span><span class="op" id="2201060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2201064">if</span>&nbsp;<span class="ident" id="2201067">r</span>&nbsp;<span class="op" id="2201069">==</span>&nbsp;<span class="ident" id="2201072">r1</span>&nbsp;<span class="op" id="2201075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2201080">return</span>&nbsp;<span class="ident" id="2201087">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2201091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2201095">i</span>&nbsp;<span class="op" id="2201097">+=</span>&nbsp;<span class="ident" id="2201100">size</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2201106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2201109">return</span>&nbsp;<span class="op" id="2201116">-</span><span class="num" id="2201117">1</span><br>
<span class="lineno"></span><span class="op" id="2201119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2201122">//&nbsp;IndexAny&nbsp;interprets&nbsp;s&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno">155</span><span class="comment" id="2201199">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;byte&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;in&nbsp;s&nbsp;of&nbsp;any&nbsp;of&nbsp;the&nbsp;Unicode</span><br>
<span class="lineno"></span><span class="comment" id="2201279">//&nbsp;code&nbsp;points&nbsp;in&nbsp;chars.&nbsp;&nbsp;It&nbsp;returns&nbsp;-1&nbsp;if&nbsp;chars&nbsp;is&nbsp;empty&nbsp;or&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;code</span><br>
<span class="lineno"></span><span class="comment" id="2201360">//&nbsp;point&nbsp;in&nbsp;common.</span><br>
<span class="lineno"></span><span class="keyword" id="2201380">func</span>&nbsp;<span class="ident" id="2201385">IndexAny</span><span class="op" id="2201393">(</span><span class="ident" id="2201394">s</span>&nbsp;<span class="op" id="2201396">[</span><span class="op" id="2201397">]</span><span class="builtintype" id="2201398">byte</span><span class="op" id="2201402">,</span>&nbsp;<span class="ident" id="2201404">chars</span>&nbsp;<span class="builtintype" id="2201410">string</span><span class="op" id="2201416">)</span>&nbsp;<span class="builtintype" id="2201418">int</span>&nbsp;<span class="op" id="2201422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2201425">if</span>&nbsp;<span class="builtinfunc" id="2201428">len</span><span class="op" id="2201431">(</span><span class="ident" id="2201432">chars</span><span class="op" id="2201437">)</span>&nbsp;<span class="op" id="2201439">&gt;</span>&nbsp;<span class="num" id="2201441">0</span>&nbsp;<span class="op" id="2201443">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2201447">var</span>&nbsp;<span class="ident" id="2201451">r</span>&nbsp;<span class="builtintype" id="2201453">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2201460">var</span>&nbsp;<span class="ident" id="2201464">width</span>&nbsp;<span class="builtintype" id="2201470">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2201476">for</span>&nbsp;<span class="ident" id="2201480">i</span>&nbsp;<span class="op" id="2201482">:=</span>&nbsp;<span class="num" id="2201485">0</span><span class="op" id="2201486">;</span>&nbsp;<span class="ident" id="2201488">i</span>&nbsp;<span class="op" id="2201490">&lt;</span>&nbsp;<span class="builtinfunc" id="2201492">len</span><span class="op" id="2201495">(</span><span class="ident" id="2201496">s</span><span class="op" id="2201497">)</span><span class="op" id="2201498">;</span>&nbsp;<span class="ident" id="2201500">i</span>&nbsp;<span class="op" id="2201502">+=</span>&nbsp;<span class="ident" id="2201505">width</span>&nbsp;<span class="op" id="2201511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2201516">r</span>&nbsp;<span class="op" id="2201518">=</span>&nbsp;<span class="builtintype" id="2201520">rune</span><span class="op" id="2201524">(</span><span class="ident" id="2201525">s</span><span class="op" id="2201526">[</span><span class="ident" id="2201527">i</span><span class="op" id="2201528">]</span><span class="op" id="2201529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2201534">if</span>&nbsp;<span class="ident" id="2201537">r</span>&nbsp;<span class="op" id="2201539">&lt;</span>&nbsp;<span class="ident" id="2201541">utf8</span><span class="op" id="2201545">.</span><span class="ident" id="2201546">RuneSelf</span>&nbsp;<span class="op" id="2201555">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2201561">width</span>&nbsp;<span class="op" id="2201567">=</span>&nbsp;<span class="num" id="2201569">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2201574">}</span>&nbsp;<span class="keyword" id="2201576">else</span>&nbsp;<span class="op" id="2201581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2201587">r</span><span class="op" id="2201588">,</span>&nbsp;<span class="ident" id="2201590">width</span>&nbsp;<span class="op" id="2201596">=</span>&nbsp;<span class="ident" id="2201598">utf8</span><span class="op" id="2201602">.</span><span class="ident" id="2201603">DecodeRune</span><span class="op" id="2201613">(</span><span class="ident" id="2201614">s</span><span class="op" id="2201615">[</span><span class="ident" id="2201616">i</span><span class="op" id="2201617">:</span><span class="op" id="2201618">]</span><span class="op" id="2201619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2201624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2201629">for</span>&nbsp;<span class="ident" id="2201633">_</span><span class="op" id="2201634">,</span>&nbsp;<span class="ident" id="2201636">ch</span>&nbsp;<span class="op" id="2201639">:=</span>&nbsp;<span class="keyword" id="2201642">range</span>&nbsp;<span class="ident" id="2201648">chars</span>&nbsp;<span class="op" id="2201654">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2201660">if</span>&nbsp;<span class="ident" id="2201663">r</span>&nbsp;<span class="op" id="2201665">==</span>&nbsp;<span class="ident" id="2201668">ch</span>&nbsp;<span class="op" id="2201671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2201678">return</span>&nbsp;<span class="ident" id="2201685">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2201691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2201696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2201700">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2201703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2201706">return</span>&nbsp;<span class="op" id="2201713">-</span><span class="num" id="2201714">1</span><br>
<span class="lineno"></span><span class="op" id="2201716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2201719">//&nbsp;LastIndexAny&nbsp;interprets&nbsp;s&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code</span><br>
<span class="lineno">180</span><span class="comment" id="2201792">//&nbsp;points.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;byte&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;occurrence&nbsp;in&nbsp;s&nbsp;of&nbsp;any&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2201868">//&nbsp;the&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;in&nbsp;chars.&nbsp;&nbsp;It&nbsp;returns&nbsp;-1&nbsp;if&nbsp;chars&nbsp;is&nbsp;empty&nbsp;or&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2201944">//&nbsp;there&nbsp;is&nbsp;no&nbsp;code&nbsp;point&nbsp;in&nbsp;common.</span><br>
<span class="lineno"></span><span class="keyword" id="2201981">func</span>&nbsp;<span class="ident" id="2201986">LastIndexAny</span><span class="op" id="2201998">(</span><span class="ident" id="2201999">s</span>&nbsp;<span class="op" id="2202001">[</span><span class="op" id="2202002">]</span><span class="builtintype" id="2202003">byte</span><span class="op" id="2202007">,</span>&nbsp;<span class="ident" id="2202009">chars</span>&nbsp;<span class="builtintype" id="2202015">string</span><span class="op" id="2202021">)</span>&nbsp;<span class="builtintype" id="2202023">int</span>&nbsp;<span class="op" id="2202027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2202030">if</span>&nbsp;<span class="builtinfunc" id="2202033">len</span><span class="op" id="2202036">(</span><span class="ident" id="2202037">chars</span><span class="op" id="2202042">)</span>&nbsp;<span class="op" id="2202044">&gt;</span>&nbsp;<span class="num" id="2202046">0</span>&nbsp;<span class="op" id="2202048">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2202052">for</span>&nbsp;<span class="ident" id="2202056">i</span>&nbsp;<span class="op" id="2202058">:=</span>&nbsp;<span class="builtinfunc" id="2202061">len</span><span class="op" id="2202064">(</span><span class="ident" id="2202065">s</span><span class="op" id="2202066">)</span><span class="op" id="2202067">;</span>&nbsp;<span class="ident" id="2202069">i</span>&nbsp;<span class="op" id="2202071">&gt;</span>&nbsp;<span class="num" id="2202073">0</span><span class="op" id="2202074">;</span>&nbsp;<span class="op" id="2202076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2202081">r</span><span class="op" id="2202082">,</span>&nbsp;<span class="ident" id="2202084">size</span>&nbsp;<span class="op" id="2202089">:=</span>&nbsp;<span class="ident" id="2202092">utf8</span><span class="op" id="2202096">.</span><span class="ident" id="2202097">DecodeLastRune</span><span class="op" id="2202111">(</span><span class="ident" id="2202112">s</span><span class="op" id="2202113">[</span><span class="num" id="2202114">0</span><span class="op" id="2202115">:</span><span class="ident" id="2202116">i</span><span class="op" id="2202117">]</span><span class="op" id="2202118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2202123">i</span>&nbsp;<span class="op" id="2202125">-=</span>&nbsp;<span class="ident" id="2202128">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2202136">for</span>&nbsp;<span class="ident" id="2202140">_</span><span class="op" id="2202141">,</span>&nbsp;<span class="ident" id="2202143">ch</span>&nbsp;<span class="op" id="2202146">:=</span>&nbsp;<span class="keyword" id="2202149">range</span>&nbsp;<span class="ident" id="2202155">chars</span>&nbsp;<span class="op" id="2202161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2202167">if</span>&nbsp;<span class="ident" id="2202170">r</span>&nbsp;<span class="op" id="2202172">==</span>&nbsp;<span class="ident" id="2202175">ch</span>&nbsp;<span class="op" id="2202178">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2202185">return</span>&nbsp;<span class="ident" id="2202192">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2202198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2202203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2202207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2202210">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2202213">return</span>&nbsp;<span class="op" id="2202220">-</span><span class="num" id="2202221">1</span><br>
<span class="lineno"></span><span class="op" id="2202223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2202226">//&nbsp;Generic&nbsp;split:&nbsp;splits&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep,</span><br>
<span class="lineno"></span><span class="comment" id="2202279">//&nbsp;including&nbsp;sepSave&nbsp;bytes&nbsp;of&nbsp;sep&nbsp;in&nbsp;the&nbsp;subslices.</span><br>
<span class="lineno">200</span><span class="keyword" id="2202331">func</span>&nbsp;<span class="ident" id="2202336">genSplit</span><span class="op" id="2202344">(</span><span class="ident" id="2202345">s</span><span class="op" id="2202346">,</span>&nbsp;<span class="ident" id="2202348">sep</span>&nbsp;<span class="op" id="2202352">[</span><span class="op" id="2202353">]</span><span class="builtintype" id="2202354">byte</span><span class="op" id="2202358">,</span>&nbsp;<span class="ident" id="2202360">sepSave</span><span class="op" id="2202367">,</span>&nbsp;<span class="ident" id="2202369">n</span>&nbsp;<span class="builtintype" id="2202371">int</span><span class="op" id="2202374">)</span>&nbsp;<span class="op" id="2202376">[</span><span class="op" id="2202377">]</span><span class="op" id="2202378">[</span><span class="op" id="2202379">]</span><span class="builtintype" id="2202380">byte</span>&nbsp;<span class="op" id="2202385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2202388">if</span>&nbsp;<span class="ident" id="2202391">n</span>&nbsp;<span class="op" id="2202393">==</span>&nbsp;<span class="num" id="2202396">0</span>&nbsp;<span class="op" id="2202398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2202402">return</span>&nbsp;<span class="ident" id="2202409">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2202414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2202417">if</span>&nbsp;<span class="builtinfunc" id="2202420">len</span><span class="op" id="2202423">(</span><span class="ident" id="2202424">sep</span><span class="op" id="2202427">)</span>&nbsp;<span class="op" id="2202429">==</span>&nbsp;<span class="num" id="2202432">0</span>&nbsp;<span class="op" id="2202434">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2202438">return</span>&nbsp;<span class="ident" id="2202445">explode</span><span class="op" id="2202452">(</span><span class="ident" id="2202453">s</span><span class="op" id="2202454">,</span>&nbsp;<span class="ident" id="2202456">n</span><span class="op" id="2202457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2202460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2202463">if</span>&nbsp;<span class="ident" id="2202466">n</span>&nbsp;<span class="op" id="2202468">&lt;</span>&nbsp;<span class="num" id="2202470">0</span>&nbsp;<span class="op" id="2202472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2202476">n</span>&nbsp;<span class="op" id="2202478">=</span>&nbsp;<span class="ident" id="2202480">Count</span><span class="op" id="2202485">(</span><span class="ident" id="2202486">s</span><span class="op" id="2202487">,</span>&nbsp;<span class="ident" id="2202489">sep</span><span class="op" id="2202492">)</span>&nbsp;<span class="op" id="2202494">+</span>&nbsp;<span class="num" id="2202496">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2202499">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2202502">c</span>&nbsp;<span class="op" id="2202504">:=</span>&nbsp;<span class="ident" id="2202507">sep</span><span class="op" id="2202510">[</span><span class="num" id="2202511">0</span><span class="op" id="2202512">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2202515">start</span>&nbsp;<span class="op" id="2202521">:=</span>&nbsp;<span class="num" id="2202524">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2202527">a</span>&nbsp;<span class="op" id="2202529">:=</span>&nbsp;<span class="builtinfunc" id="2202532">make</span><span class="op" id="2202536">(</span><span class="op" id="2202537">[</span><span class="op" id="2202538">]</span><span class="op" id="2202539">[</span><span class="op" id="2202540">]</span><span class="builtintype" id="2202541">byte</span><span class="op" id="2202545">,</span>&nbsp;<span class="ident" id="2202547">n</span><span class="op" id="2202548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2202551">na</span>&nbsp;<span class="op" id="2202554">:=</span>&nbsp;<span class="num" id="2202557">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2202560">for</span>&nbsp;<span class="ident" id="2202564">i</span>&nbsp;<span class="op" id="2202566">:=</span>&nbsp;<span class="num" id="2202569">0</span><span class="op" id="2202570">;</span>&nbsp;<span class="ident" id="2202572">i</span><span class="op" id="2202573">+</span><span class="builtinfunc" id="2202574">len</span><span class="op" id="2202577">(</span><span class="ident" id="2202578">sep</span><span class="op" id="2202581">)</span>&nbsp;<span class="op" id="2202583">&lt;=</span>&nbsp;<span class="builtinfunc" id="2202586">len</span><span class="op" id="2202589">(</span><span class="ident" id="2202590">s</span><span class="op" id="2202591">)</span>&nbsp;<span class="op" id="2202593">&amp;&amp;</span>&nbsp;<span class="ident" id="2202596">na</span><span class="op" id="2202598">+</span><span class="num" id="2202599">1</span>&nbsp;<span class="op" id="2202601">&lt;</span>&nbsp;<span class="ident" id="2202603">n</span><span class="op" id="2202604">;</span>&nbsp;<span class="ident" id="2202606">i</span><span class="op" id="2202607">++</span>&nbsp;<span class="op" id="2202610">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2202614">if</span>&nbsp;<span class="ident" id="2202617">s</span><span class="op" id="2202618">[</span><span class="ident" id="2202619">i</span><span class="op" id="2202620">]</span>&nbsp;<span class="op" id="2202622">==</span>&nbsp;<span class="ident" id="2202625">c</span>&nbsp;<span class="op" id="2202627">&amp;&amp;</span>&nbsp;<span class="op" id="2202630">(</span><span class="builtinfunc" id="2202631">len</span><span class="op" id="2202634">(</span><span class="ident" id="2202635">sep</span><span class="op" id="2202638">)</span>&nbsp;<span class="op" id="2202640">==</span>&nbsp;<span class="num" id="2202643">1</span>&nbsp;<span class="op" id="2202645">||</span>&nbsp;<span class="ident" id="2202648">Equal</span><span class="op" id="2202653">(</span><span class="ident" id="2202654">s</span><span class="op" id="2202655">[</span><span class="ident" id="2202656">i</span><span class="op" id="2202657">:</span><span class="ident" id="2202658">i</span><span class="op" id="2202659">+</span><span class="builtinfunc" id="2202660">len</span><span class="op" id="2202663">(</span><span class="ident" id="2202664">sep</span><span class="op" id="2202667">)</span><span class="op" id="2202668">]</span><span class="op" id="2202669">,</span>&nbsp;<span class="ident" id="2202671">sep</span><span class="op" id="2202674">)</span><span class="op" id="2202675">)</span>&nbsp;<span class="op" id="2202677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2202682">a</span><span class="op" id="2202683">[</span><span class="ident" id="2202684">na</span><span class="op" id="2202686">]</span>&nbsp;<span class="op" id="2202688">=</span>&nbsp;<span class="ident" id="2202690">s</span><span class="op" id="2202691">[</span><span class="ident" id="2202692">start</span>&nbsp;<span class="op" id="2202698">:</span>&nbsp;<span class="ident" id="2202700">i</span><span class="op" id="2202701">+</span><span class="ident" id="2202702">sepSave</span><span class="op" id="2202709">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2202714">na</span><span class="op" id="2202716">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2202722">start</span>&nbsp;<span class="op" id="2202728">=</span>&nbsp;<span class="ident" id="2202730">i</span>&nbsp;<span class="op" id="2202732">+</span>&nbsp;<span class="builtinfunc" id="2202734">len</span><span class="op" id="2202737">(</span><span class="ident" id="2202738">sep</span><span class="op" id="2202741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2202746">i</span>&nbsp;<span class="op" id="2202748">+=</span>&nbsp;<span class="builtinfunc" id="2202751">len</span><span class="op" id="2202754">(</span><span class="ident" id="2202755">sep</span><span class="op" id="2202758">)</span>&nbsp;<span class="op" id="2202760">-</span>&nbsp;<span class="num" id="2202762">1</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2202766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2202769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2202772">a</span><span class="op" id="2202773">[</span><span class="ident" id="2202774">na</span><span class="op" id="2202776">]</span>&nbsp;<span class="op" id="2202778">=</span>&nbsp;<span class="ident" id="2202780">s</span><span class="op" id="2202781">[</span><span class="ident" id="2202782">start</span><span class="op" id="2202787">:</span><span class="op" id="2202788">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2202791">return</span>&nbsp;<span class="ident" id="2202798">a</span><span class="op" id="2202799">[</span><span class="num" id="2202800">0</span>&nbsp;<span class="op" id="2202802">:</span>&nbsp;<span class="ident" id="2202804">na</span><span class="op" id="2202806">+</span><span class="num" id="2202807">1</span><span class="op" id="2202808">]</span><br>
<span class="lineno"></span><span class="op" id="2202810">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="2202813">//&nbsp;SplitN&nbsp;slices&nbsp;s&nbsp;into&nbsp;subslices&nbsp;separated&nbsp;by&nbsp;sep&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2202887">//&nbsp;the&nbsp;subslices&nbsp;between&nbsp;those&nbsp;separators.</span><br>
<span class="lineno"></span><span class="comment" id="2202930">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitN&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2202991">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;subslices&nbsp;to&nbsp;return:</span><br>
<span class="lineno">230</span><span class="comment" id="2203050">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;subslices;&nbsp;the&nbsp;last&nbsp;subslice&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno"></span><span class="comment" id="2203132">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;subslices)</span><br>
<span class="lineno"></span><span class="comment" id="2203180">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;subslices</span><br>
<span class="lineno"></span><span class="keyword" id="2203206">func</span>&nbsp;<span class="ident" id="2203211">SplitN</span><span class="op" id="2203217">(</span><span class="ident" id="2203218">s</span><span class="op" id="2203219">,</span>&nbsp;<span class="ident" id="2203221">sep</span>&nbsp;<span class="op" id="2203225">[</span><span class="op" id="2203226">]</span><span class="builtintype" id="2203227">byte</span><span class="op" id="2203231">,</span>&nbsp;<span class="ident" id="2203233">n</span>&nbsp;<span class="builtintype" id="2203235">int</span><span class="op" id="2203238">)</span>&nbsp;<span class="op" id="2203240">[</span><span class="op" id="2203241">]</span><span class="op" id="2203242">[</span><span class="op" id="2203243">]</span><span class="builtintype" id="2203244">byte</span>&nbsp;<span class="op" id="2203249">{</span>&nbsp;<span class="keyword" id="2203251">return</span>&nbsp;<span class="ident" id="2203258">genSplit</span><span class="op" id="2203266">(</span><span class="ident" id="2203267">s</span><span class="op" id="2203268">,</span>&nbsp;<span class="ident" id="2203270">sep</span><span class="op" id="2203273">,</span>&nbsp;<span class="num" id="2203275">0</span><span class="op" id="2203276">,</span>&nbsp;<span class="ident" id="2203278">n</span><span class="op" id="2203279">)</span>&nbsp;<span class="op" id="2203281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="comment" id="2203284">//&nbsp;SplitAfterN&nbsp;slices&nbsp;s&nbsp;into&nbsp;subslices&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2203354">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;those&nbsp;subslices.</span><br>
<span class="lineno"></span><span class="comment" id="2203393">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitAfterN&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2203459">//&nbsp;The&nbsp;count&nbsp;determines&nbsp;the&nbsp;number&nbsp;of&nbsp;subslices&nbsp;to&nbsp;return:</span><br>
<span class="lineno"></span><span class="comment" id="2203518">//&nbsp;&nbsp;&nbsp;n&nbsp;&gt;&nbsp;0:&nbsp;at&nbsp;most&nbsp;n&nbsp;subslices;&nbsp;the&nbsp;last&nbsp;subslice&nbsp;will&nbsp;be&nbsp;the&nbsp;unsplit&nbsp;remainder.</span><br>
<span class="lineno">240</span><span class="comment" id="2203600">//&nbsp;&nbsp;&nbsp;n&nbsp;==&nbsp;0:&nbsp;the&nbsp;result&nbsp;is&nbsp;nil&nbsp;(zero&nbsp;subslices)</span><br>
<span class="lineno"></span><span class="comment" id="2203648">//&nbsp;&nbsp;&nbsp;n&nbsp;&lt;&nbsp;0:&nbsp;all&nbsp;subslices</span><br>
<span class="lineno"></span><span class="keyword" id="2203674">func</span>&nbsp;<span class="ident" id="2203679">SplitAfterN</span><span class="op" id="2203690">(</span><span class="ident" id="2203691">s</span><span class="op" id="2203692">,</span>&nbsp;<span class="ident" id="2203694">sep</span>&nbsp;<span class="op" id="2203698">[</span><span class="op" id="2203699">]</span><span class="builtintype" id="2203700">byte</span><span class="op" id="2203704">,</span>&nbsp;<span class="ident" id="2203706">n</span>&nbsp;<span class="builtintype" id="2203708">int</span><span class="op" id="2203711">)</span>&nbsp;<span class="op" id="2203713">[</span><span class="op" id="2203714">]</span><span class="op" id="2203715">[</span><span class="op" id="2203716">]</span><span class="builtintype" id="2203717">byte</span>&nbsp;<span class="op" id="2203722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2203725">return</span>&nbsp;<span class="ident" id="2203732">genSplit</span><span class="op" id="2203740">(</span><span class="ident" id="2203741">s</span><span class="op" id="2203742">,</span>&nbsp;<span class="ident" id="2203744">sep</span><span class="op" id="2203747">,</span>&nbsp;<span class="builtinfunc" id="2203749">len</span><span class="op" id="2203752">(</span><span class="ident" id="2203753">sep</span><span class="op" id="2203756">)</span><span class="op" id="2203757">,</span>&nbsp;<span class="ident" id="2203759">n</span><span class="op" id="2203760">)</span><br>
<span class="lineno"></span><span class="op" id="2203762">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="2203765">//&nbsp;Split&nbsp;slices&nbsp;s&nbsp;into&nbsp;all&nbsp;subslices&nbsp;separated&nbsp;by&nbsp;sep&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2203842">//&nbsp;the&nbsp;subslices&nbsp;between&nbsp;those&nbsp;separators.</span><br>
<span class="lineno"></span><span class="comment" id="2203885">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;Split&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno"></span><span class="comment" id="2203945">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;SplitN&nbsp;with&nbsp;a&nbsp;count&nbsp;of&nbsp;-1.</span><br>
<span class="lineno">250</span><span class="keyword" id="2203995">func</span>&nbsp;<span class="ident" id="2204000">Split</span><span class="op" id="2204005">(</span><span class="ident" id="2204006">s</span><span class="op" id="2204007">,</span>&nbsp;<span class="ident" id="2204009">sep</span>&nbsp;<span class="op" id="2204013">[</span><span class="op" id="2204014">]</span><span class="builtintype" id="2204015">byte</span><span class="op" id="2204019">)</span>&nbsp;<span class="op" id="2204021">[</span><span class="op" id="2204022">]</span><span class="op" id="2204023">[</span><span class="op" id="2204024">]</span><span class="builtintype" id="2204025">byte</span>&nbsp;<span class="op" id="2204030">{</span>&nbsp;<span class="keyword" id="2204032">return</span>&nbsp;<span class="ident" id="2204039">genSplit</span><span class="op" id="2204047">(</span><span class="ident" id="2204048">s</span><span class="op" id="2204049">,</span>&nbsp;<span class="ident" id="2204051">sep</span><span class="op" id="2204054">,</span>&nbsp;<span class="num" id="2204056">0</span><span class="op" id="2204057">,</span>&nbsp;<span class="op" id="2204059">-</span><span class="num" id="2204060">1</span><span class="op" id="2204061">)</span>&nbsp;<span class="op" id="2204063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2204066">//&nbsp;SplitAfter&nbsp;slices&nbsp;s&nbsp;into&nbsp;all&nbsp;subslices&nbsp;after&nbsp;each&nbsp;instance&nbsp;of&nbsp;sep&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2204139">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;those&nbsp;subslices.</span><br>
<span class="lineno"></span><span class="comment" id="2204178">//&nbsp;If&nbsp;sep&nbsp;is&nbsp;empty,&nbsp;SplitAfter&nbsp;splits&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence.</span><br>
<span class="lineno">255</span><span class="comment" id="2204243">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;SplitAfterN&nbsp;with&nbsp;a&nbsp;count&nbsp;of&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="2204298">func</span>&nbsp;<span class="ident" id="2204303">SplitAfter</span><span class="op" id="2204313">(</span><span class="ident" id="2204314">s</span><span class="op" id="2204315">,</span>&nbsp;<span class="ident" id="2204317">sep</span>&nbsp;<span class="op" id="2204321">[</span><span class="op" id="2204322">]</span><span class="builtintype" id="2204323">byte</span><span class="op" id="2204327">)</span>&nbsp;<span class="op" id="2204329">[</span><span class="op" id="2204330">]</span><span class="op" id="2204331">[</span><span class="op" id="2204332">]</span><span class="builtintype" id="2204333">byte</span>&nbsp;<span class="op" id="2204338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2204341">return</span>&nbsp;<span class="ident" id="2204348">genSplit</span><span class="op" id="2204356">(</span><span class="ident" id="2204357">s</span><span class="op" id="2204358">,</span>&nbsp;<span class="ident" id="2204360">sep</span><span class="op" id="2204363">,</span>&nbsp;<span class="builtinfunc" id="2204365">len</span><span class="op" id="2204368">(</span><span class="ident" id="2204369">sep</span><span class="op" id="2204372">)</span><span class="op" id="2204373">,</span>&nbsp;<span class="op" id="2204375">-</span><span class="num" id="2204376">1</span><span class="op" id="2204377">)</span><br>
<span class="lineno"></span><span class="op" id="2204379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="2204382">//&nbsp;Fields&nbsp;splits&nbsp;the&nbsp;slice&nbsp;s&nbsp;around&nbsp;each&nbsp;instance&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;consecutive&nbsp;white&nbsp;space</span><br>
<span class="lineno"></span><span class="comment" id="2204471">//&nbsp;characters,&nbsp;returning&nbsp;a&nbsp;slice&nbsp;of&nbsp;subslices&nbsp;of&nbsp;s&nbsp;or&nbsp;an&nbsp;empty&nbsp;list&nbsp;if&nbsp;s&nbsp;contains&nbsp;only&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="keyword" id="2204571">func</span>&nbsp;<span class="ident" id="2204576">Fields</span><span class="op" id="2204582">(</span><span class="ident" id="2204583">s</span>&nbsp;<span class="op" id="2204585">[</span><span class="op" id="2204586">]</span><span class="builtintype" id="2204587">byte</span><span class="op" id="2204591">)</span>&nbsp;<span class="op" id="2204593">[</span><span class="op" id="2204594">]</span><span class="op" id="2204595">[</span><span class="op" id="2204596">]</span><span class="builtintype" id="2204597">byte</span>&nbsp;<span class="op" id="2204602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2204605">return</span>&nbsp;<span class="ident" id="2204612">FieldsFunc</span><span class="op" id="2204622">(</span><span class="ident" id="2204623">s</span><span class="op" id="2204624">,</span>&nbsp;<span class="ident" id="2204626">unicode</span><span class="op" id="2204633">.</span><span class="ident" id="2204634">IsSpace</span><span class="op" id="2204641">)</span><br>
<span class="lineno"></span><span class="op" id="2204643">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="comment" id="2204646">//&nbsp;FieldsFunc&nbsp;interprets&nbsp;s&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="comment" id="2204725">//&nbsp;It&nbsp;splits&nbsp;the&nbsp;slice&nbsp;s&nbsp;at&nbsp;each&nbsp;run&nbsp;of&nbsp;code&nbsp;points&nbsp;c&nbsp;satisfying&nbsp;f(c)&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2204799">//&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;subslices&nbsp;of&nbsp;s.&nbsp;&nbsp;If&nbsp;all&nbsp;code&nbsp;points&nbsp;in&nbsp;s&nbsp;satisfy&nbsp;f(c),&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="2204879">//&nbsp;len(s)&nbsp;==&nbsp;0,&nbsp;an&nbsp;empty&nbsp;slice&nbsp;is&nbsp;returned.</span><br>
<span class="lineno">270</span><span class="comment" id="2204923">//&nbsp;FieldsFunc&nbsp;makes&nbsp;no&nbsp;guarantees&nbsp;about&nbsp;the&nbsp;order&nbsp;in&nbsp;which&nbsp;it&nbsp;calls&nbsp;f(c).</span><br>
<span class="lineno"></span><span class="comment" id="2204997">//&nbsp;If&nbsp;f&nbsp;does&nbsp;not&nbsp;return&nbsp;consistent&nbsp;results&nbsp;for&nbsp;a&nbsp;given&nbsp;c,&nbsp;FieldsFunc&nbsp;may&nbsp;crash.</span><br>
<span class="lineno"></span><span class="keyword" id="2205077">func</span>&nbsp;<span class="ident" id="2205082">FieldsFunc</span><span class="op" id="2205092">(</span><span class="ident" id="2205093">s</span>&nbsp;<span class="op" id="2205095">[</span><span class="op" id="2205096">]</span><span class="builtintype" id="2205097">byte</span><span class="op" id="2205101">,</span>&nbsp;<span class="ident" id="2205103">f</span>&nbsp;<span class="keyword" id="2205105">func</span><span class="op" id="2205109">(</span><span class="builtintype" id="2205110">rune</span><span class="op" id="2205114">)</span>&nbsp;<span class="builtintype" id="2205116">bool</span><span class="op" id="2205120">)</span>&nbsp;<span class="op" id="2205122">[</span><span class="op" id="2205123">]</span><span class="op" id="2205124">[</span><span class="op" id="2205125">]</span><span class="builtintype" id="2205126">byte</span>&nbsp;<span class="op" id="2205131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2205134">n</span>&nbsp;<span class="op" id="2205136">:=</span>&nbsp;<span class="num" id="2205139">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2205142">inField</span>&nbsp;<span class="op" id="2205150">:=</span>&nbsp;<span class="builtintype" id="2205153">false</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2205160">for</span>&nbsp;<span class="ident" id="2205164">i</span>&nbsp;<span class="op" id="2205166">:=</span>&nbsp;<span class="num" id="2205169">0</span><span class="op" id="2205170">;</span>&nbsp;<span class="ident" id="2205172">i</span>&nbsp;<span class="op" id="2205174">&lt;</span>&nbsp;<span class="builtinfunc" id="2205176">len</span><span class="op" id="2205179">(</span><span class="ident" id="2205180">s</span><span class="op" id="2205181">)</span><span class="op" id="2205182">;</span>&nbsp;<span class="op" id="2205184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2205188">r</span><span class="op" id="2205189">,</span>&nbsp;<span class="ident" id="2205191">size</span>&nbsp;<span class="op" id="2205196">:=</span>&nbsp;<span class="ident" id="2205199">utf8</span><span class="op" id="2205203">.</span><span class="ident" id="2205204">DecodeRune</span><span class="op" id="2205214">(</span><span class="ident" id="2205215">s</span><span class="op" id="2205216">[</span><span class="ident" id="2205217">i</span><span class="op" id="2205218">:</span><span class="op" id="2205219">]</span><span class="op" id="2205220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2205224">wasInField</span>&nbsp;<span class="op" id="2205235">:=</span>&nbsp;<span class="ident" id="2205238">inField</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2205248">inField</span>&nbsp;<span class="op" id="2205256">=</span>&nbsp;<span class="op" id="2205258">!</span><span class="ident" id="2205259">f</span><span class="op" id="2205260">(</span><span class="ident" id="2205261">r</span><span class="op" id="2205262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2205266">if</span>&nbsp;<span class="ident" id="2205269">inField</span>&nbsp;<span class="op" id="2205277">&amp;&amp;</span>&nbsp;<span class="op" id="2205280">!</span><span class="ident" id="2205281">wasInField</span>&nbsp;<span class="op" id="2205292">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2205297">n</span><span class="op" id="2205298">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2205303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2205307">i</span>&nbsp;<span class="op" id="2205309">+=</span>&nbsp;<span class="ident" id="2205312">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2205318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2205322">a</span>&nbsp;<span class="op" id="2205324">:=</span>&nbsp;<span class="builtinfunc" id="2205327">make</span><span class="op" id="2205331">(</span><span class="op" id="2205332">[</span><span class="op" id="2205333">]</span><span class="op" id="2205334">[</span><span class="op" id="2205335">]</span><span class="builtintype" id="2205336">byte</span><span class="op" id="2205340">,</span>&nbsp;<span class="ident" id="2205342">n</span><span class="op" id="2205343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2205346">na</span>&nbsp;<span class="op" id="2205349">:=</span>&nbsp;<span class="num" id="2205352">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2205355">fieldStart</span>&nbsp;<span class="op" id="2205366">:=</span>&nbsp;<span class="op" id="2205369">-</span><span class="num" id="2205370">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2205373">for</span>&nbsp;<span class="ident" id="2205377">i</span>&nbsp;<span class="op" id="2205379">:=</span>&nbsp;<span class="num" id="2205382">0</span><span class="op" id="2205383">;</span>&nbsp;<span class="ident" id="2205385">i</span>&nbsp;<span class="op" id="2205387">&lt;=</span>&nbsp;<span class="builtinfunc" id="2205390">len</span><span class="op" id="2205393">(</span><span class="ident" id="2205394">s</span><span class="op" id="2205395">)</span>&nbsp;<span class="op" id="2205397">&amp;&amp;</span>&nbsp;<span class="ident" id="2205400">na</span>&nbsp;<span class="op" id="2205403">&lt;</span>&nbsp;<span class="ident" id="2205405">n</span><span class="op" id="2205406">;</span>&nbsp;<span class="op" id="2205408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2205412">r</span><span class="op" id="2205413">,</span>&nbsp;<span class="ident" id="2205415">size</span>&nbsp;<span class="op" id="2205420">:=</span>&nbsp;<span class="ident" id="2205423">utf8</span><span class="op" id="2205427">.</span><span class="ident" id="2205428">DecodeRune</span><span class="op" id="2205438">(</span><span class="ident" id="2205439">s</span><span class="op" id="2205440">[</span><span class="ident" id="2205441">i</span><span class="op" id="2205442">:</span><span class="op" id="2205443">]</span><span class="op" id="2205444">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2205448">if</span>&nbsp;<span class="ident" id="2205451">fieldStart</span>&nbsp;<span class="op" id="2205462">&lt;</span>&nbsp;<span class="num" id="2205464">0</span>&nbsp;<span class="op" id="2205466">&amp;&amp;</span>&nbsp;<span class="ident" id="2205469">size</span>&nbsp;<span class="op" id="2205474">&gt;</span>&nbsp;<span class="num" id="2205476">0</span>&nbsp;<span class="op" id="2205478">&amp;&amp;</span>&nbsp;<span class="op" id="2205481">!</span><span class="ident" id="2205482">f</span><span class="op" id="2205483">(</span><span class="ident" id="2205484">r</span><span class="op" id="2205485">)</span>&nbsp;<span class="op" id="2205487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2205492">fieldStart</span>&nbsp;<span class="op" id="2205503">=</span>&nbsp;<span class="ident" id="2205505">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2205510">i</span>&nbsp;<span class="op" id="2205512">+=</span>&nbsp;<span class="ident" id="2205515">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2205523">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2205534">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2205538">if</span>&nbsp;<span class="ident" id="2205541">fieldStart</span>&nbsp;<span class="op" id="2205552">&gt;=</span>&nbsp;<span class="num" id="2205555">0</span>&nbsp;<span class="op" id="2205557">&amp;&amp;</span>&nbsp;<span class="op" id="2205560">(</span><span class="ident" id="2205561">size</span>&nbsp;<span class="op" id="2205566">==</span>&nbsp;<span class="num" id="2205569">0</span>&nbsp;<span class="op" id="2205571">||</span>&nbsp;<span class="ident" id="2205574">f</span><span class="op" id="2205575">(</span><span class="ident" id="2205576">r</span><span class="op" id="2205577">)</span><span class="op" id="2205578">)</span>&nbsp;<span class="op" id="2205580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2205585">a</span><span class="op" id="2205586">[</span><span class="ident" id="2205587">na</span><span class="op" id="2205589">]</span>&nbsp;<span class="op" id="2205591">=</span>&nbsp;<span class="ident" id="2205593">s</span><span class="op" id="2205594">[</span><span class="ident" id="2205595">fieldStart</span><span class="op" id="2205605">:</span><span class="ident" id="2205606">i</span><span class="op" id="2205607">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2205612">na</span><span class="op" id="2205614">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2205620">fieldStart</span>&nbsp;<span class="op" id="2205631">=</span>&nbsp;<span class="op" id="2205633">-</span><span class="num" id="2205634">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2205638">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2205642">if</span>&nbsp;<span class="ident" id="2205645">size</span>&nbsp;<span class="op" id="2205650">==</span>&nbsp;<span class="num" id="2205653">0</span>&nbsp;<span class="op" id="2205655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2205660">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2205668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2205672">i</span>&nbsp;<span class="op" id="2205674">+=</span>&nbsp;<span class="ident" id="2205677">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2205683">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2205686">return</span>&nbsp;<span class="ident" id="2205693">a</span><span class="op" id="2205694">[</span><span class="num" id="2205695">0</span><span class="op" id="2205696">:</span><span class="ident" id="2205697">na</span><span class="op" id="2205699">]</span><br>
<span class="lineno"></span><span class="op" id="2205701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2205704">//&nbsp;Join&nbsp;concatenates&nbsp;the&nbsp;elements&nbsp;of&nbsp;s&nbsp;to&nbsp;create&nbsp;a&nbsp;new&nbsp;byte&nbsp;slice.&nbsp;The&nbsp;separator</span><br>
<span class="lineno"></span><span class="comment" id="2205785">//&nbsp;sep&nbsp;is&nbsp;placed&nbsp;between&nbsp;elements&nbsp;in&nbsp;the&nbsp;resulting&nbsp;slice.</span><br>
<span class="lineno">310</span><span class="keyword" id="2205843">func</span>&nbsp;<span class="ident" id="2205848">Join</span><span class="op" id="2205852">(</span><span class="ident" id="2205853">s</span>&nbsp;<span class="op" id="2205855">[</span><span class="op" id="2205856">]</span><span class="op" id="2205857">[</span><span class="op" id="2205858">]</span><span class="builtintype" id="2205859">byte</span><span class="op" id="2205863">,</span>&nbsp;<span class="ident" id="2205865">sep</span>&nbsp;<span class="op" id="2205869">[</span><span class="op" id="2205870">]</span><span class="builtintype" id="2205871">byte</span><span class="op" id="2205875">)</span>&nbsp;<span class="op" id="2205877">[</span><span class="op" id="2205878">]</span><span class="builtintype" id="2205879">byte</span>&nbsp;<span class="op" id="2205884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2205887">if</span>&nbsp;<span class="builtinfunc" id="2205890">len</span><span class="op" id="2205893">(</span><span class="ident" id="2205894">s</span><span class="op" id="2205895">)</span>&nbsp;<span class="op" id="2205897">==</span>&nbsp;<span class="num" id="2205900">0</span>&nbsp;<span class="op" id="2205902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2205906">return</span>&nbsp;<span class="op" id="2205913">[</span><span class="op" id="2205914">]</span><span class="builtintype" id="2205915">byte</span><span class="op" id="2205919">{</span><span class="op" id="2205920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2205923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2205926">if</span>&nbsp;<span class="builtinfunc" id="2205929">len</span><span class="op" id="2205932">(</span><span class="ident" id="2205933">s</span><span class="op" id="2205934">)</span>&nbsp;<span class="op" id="2205936">==</span>&nbsp;<span class="num" id="2205939">1</span>&nbsp;<span class="op" id="2205941">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2205945">//&nbsp;Just&nbsp;return&nbsp;a&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2205970">return</span>&nbsp;<span class="builtinfunc" id="2205977">append</span><span class="op" id="2205983">(</span><span class="op" id="2205984">[</span><span class="op" id="2205985">]</span><span class="builtintype" id="2205986">byte</span><span class="op" id="2205990">(</span><span class="ident" id="2205991">nil</span><span class="op" id="2205994">)</span><span class="op" id="2205995">,</span>&nbsp;<span class="ident" id="2205997">s</span><span class="op" id="2205998">[</span><span class="num" id="2205999">0</span><span class="op" id="2206000">]</span><span class="op" id="2206001">...</span><span class="op" id="2206004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2206007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2206010">n</span>&nbsp;<span class="op" id="2206012">:=</span>&nbsp;<span class="builtinfunc" id="2206015">len</span><span class="op" id="2206018">(</span><span class="ident" id="2206019">sep</span><span class="op" id="2206022">)</span>&nbsp;<span class="op" id="2206024">*</span>&nbsp;<span class="op" id="2206026">(</span><span class="builtinfunc" id="2206027">len</span><span class="op" id="2206030">(</span><span class="ident" id="2206031">s</span><span class="op" id="2206032">)</span>&nbsp;<span class="op" id="2206034">-</span>&nbsp;<span class="num" id="2206036">1</span><span class="op" id="2206037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2206040">for</span>&nbsp;<span class="ident" id="2206044">_</span><span class="op" id="2206045">,</span>&nbsp;<span class="ident" id="2206047">v</span>&nbsp;<span class="op" id="2206049">:=</span>&nbsp;<span class="keyword" id="2206052">range</span>&nbsp;<span class="ident" id="2206058">s</span>&nbsp;<span class="op" id="2206060">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2206064">n</span>&nbsp;<span class="op" id="2206066">+=</span>&nbsp;<span class="builtinfunc" id="2206069">len</span><span class="op" id="2206072">(</span><span class="ident" id="2206073">v</span><span class="op" id="2206074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2206077">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2206081">b</span>&nbsp;<span class="op" id="2206083">:=</span>&nbsp;<span class="builtinfunc" id="2206086">make</span><span class="op" id="2206090">(</span><span class="op" id="2206091">[</span><span class="op" id="2206092">]</span><span class="builtintype" id="2206093">byte</span><span class="op" id="2206097">,</span>&nbsp;<span class="ident" id="2206099">n</span><span class="op" id="2206100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2206103">bp</span>&nbsp;<span class="op" id="2206106">:=</span>&nbsp;<span class="builtinfunc" id="2206109">copy</span><span class="op" id="2206113">(</span><span class="ident" id="2206114">b</span><span class="op" id="2206115">,</span>&nbsp;<span class="ident" id="2206117">s</span><span class="op" id="2206118">[</span><span class="num" id="2206119">0</span><span class="op" id="2206120">]</span><span class="op" id="2206121">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2206124">for</span>&nbsp;<span class="ident" id="2206128">_</span><span class="op" id="2206129">,</span>&nbsp;<span class="ident" id="2206131">v</span>&nbsp;<span class="op" id="2206133">:=</span>&nbsp;<span class="keyword" id="2206136">range</span>&nbsp;<span class="ident" id="2206142">s</span><span class="op" id="2206143">[</span><span class="num" id="2206144">1</span><span class="op" id="2206145">:</span><span class="op" id="2206146">]</span>&nbsp;<span class="op" id="2206148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2206152">bp</span>&nbsp;<span class="op" id="2206155">+=</span>&nbsp;<span class="builtinfunc" id="2206158">copy</span><span class="op" id="2206162">(</span><span class="ident" id="2206163">b</span><span class="op" id="2206164">[</span><span class="ident" id="2206165">bp</span><span class="op" id="2206167">:</span><span class="op" id="2206168">]</span><span class="op" id="2206169">,</span>&nbsp;<span class="ident" id="2206171">sep</span><span class="op" id="2206174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2206178">bp</span>&nbsp;<span class="op" id="2206181">+=</span>&nbsp;<span class="builtinfunc" id="2206184">copy</span><span class="op" id="2206188">(</span><span class="ident" id="2206189">b</span><span class="op" id="2206190">[</span><span class="ident" id="2206191">bp</span><span class="op" id="2206193">:</span><span class="op" id="2206194">]</span><span class="op" id="2206195">,</span>&nbsp;<span class="ident" id="2206197">v</span><span class="op" id="2206198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2206201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2206204">return</span>&nbsp;<span class="ident" id="2206211">b</span><br>
<span class="lineno">330</span><span class="op" id="2206213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2206216">//&nbsp;HasPrefix&nbsp;tests&nbsp;whether&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;begins&nbsp;with&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="2206280">func</span>&nbsp;<span class="ident" id="2206285">HasPrefix</span><span class="op" id="2206294">(</span><span class="ident" id="2206295">s</span><span class="op" id="2206296">,</span>&nbsp;<span class="ident" id="2206298">prefix</span>&nbsp;<span class="op" id="2206305">[</span><span class="op" id="2206306">]</span><span class="builtintype" id="2206307">byte</span><span class="op" id="2206311">)</span>&nbsp;<span class="builtintype" id="2206313">bool</span>&nbsp;<span class="op" id="2206318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2206321">return</span>&nbsp;<span class="builtinfunc" id="2206328">len</span><span class="op" id="2206331">(</span><span class="ident" id="2206332">s</span><span class="op" id="2206333">)</span>&nbsp;<span class="op" id="2206335">&gt;=</span>&nbsp;<span class="builtinfunc" id="2206338">len</span><span class="op" id="2206341">(</span><span class="ident" id="2206342">prefix</span><span class="op" id="2206348">)</span>&nbsp;<span class="op" id="2206350">&amp;&amp;</span>&nbsp;<span class="ident" id="2206353">Equal</span><span class="op" id="2206358">(</span><span class="ident" id="2206359">s</span><span class="op" id="2206360">[</span><span class="num" id="2206361">0</span><span class="op" id="2206362">:</span><span class="builtinfunc" id="2206363">len</span><span class="op" id="2206366">(</span><span class="ident" id="2206367">prefix</span><span class="op" id="2206373">)</span><span class="op" id="2206374">]</span><span class="op" id="2206375">,</span>&nbsp;<span class="ident" id="2206377">prefix</span><span class="op" id="2206383">)</span><br>
<span class="lineno">335</span><span class="op" id="2206385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2206388">//&nbsp;HasSuffix&nbsp;tests&nbsp;whether&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;ends&nbsp;with&nbsp;suffix.</span><br>
<span class="lineno"></span><span class="keyword" id="2206450">func</span>&nbsp;<span class="ident" id="2206455">HasSuffix</span><span class="op" id="2206464">(</span><span class="ident" id="2206465">s</span><span class="op" id="2206466">,</span>&nbsp;<span class="ident" id="2206468">suffix</span>&nbsp;<span class="op" id="2206475">[</span><span class="op" id="2206476">]</span><span class="builtintype" id="2206477">byte</span><span class="op" id="2206481">)</span>&nbsp;<span class="builtintype" id="2206483">bool</span>&nbsp;<span class="op" id="2206488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2206491">return</span>&nbsp;<span class="builtinfunc" id="2206498">len</span><span class="op" id="2206501">(</span><span class="ident" id="2206502">s</span><span class="op" id="2206503">)</span>&nbsp;<span class="op" id="2206505">&gt;=</span>&nbsp;<span class="builtinfunc" id="2206508">len</span><span class="op" id="2206511">(</span><span class="ident" id="2206512">suffix</span><span class="op" id="2206518">)</span>&nbsp;<span class="op" id="2206520">&amp;&amp;</span>&nbsp;<span class="ident" id="2206523">Equal</span><span class="op" id="2206528">(</span><span class="ident" id="2206529">s</span><span class="op" id="2206530">[</span><span class="builtinfunc" id="2206531">len</span><span class="op" id="2206534">(</span><span class="ident" id="2206535">s</span><span class="op" id="2206536">)</span><span class="op" id="2206537">-</span><span class="builtinfunc" id="2206538">len</span><span class="op" id="2206541">(</span><span class="ident" id="2206542">suffix</span><span class="op" id="2206548">)</span><span class="op" id="2206549">:</span><span class="op" id="2206550">]</span><span class="op" id="2206551">,</span>&nbsp;<span class="ident" id="2206553">suffix</span><span class="op" id="2206559">)</span><br>
<span class="lineno">340</span><span class="op" id="2206561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2206564">//&nbsp;Map&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;its&nbsp;characters&nbsp;modified</span><br>
<span class="lineno"></span><span class="comment" id="2206639">//&nbsp;according&nbsp;to&nbsp;the&nbsp;mapping&nbsp;function.&nbsp;If&nbsp;mapping&nbsp;returns&nbsp;a&nbsp;negative&nbsp;value,&nbsp;the&nbsp;character&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2206731">//&nbsp;dropped&nbsp;from&nbsp;the&nbsp;string&nbsp;with&nbsp;no&nbsp;replacement.&nbsp;&nbsp;The&nbsp;characters&nbsp;in&nbsp;s&nbsp;and&nbsp;the</span><br>
<span class="lineno">345</span><span class="comment" id="2206808">//&nbsp;output&nbsp;are&nbsp;interpreted&nbsp;as&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="keyword" id="2206872">func</span>&nbsp;<span class="ident" id="2206877">Map</span><span class="op" id="2206880">(</span><span class="ident" id="2206881">mapping</span>&nbsp;<span class="keyword" id="2206889">func</span><span class="op" id="2206893">(</span><span class="ident" id="2206894">r</span>&nbsp;<span class="builtintype" id="2206896">rune</span><span class="op" id="2206900">)</span>&nbsp;<span class="builtintype" id="2206902">rune</span><span class="op" id="2206906">,</span>&nbsp;<span class="ident" id="2206908">s</span>&nbsp;<span class="op" id="2206910">[</span><span class="op" id="2206911">]</span><span class="builtintype" id="2206912">byte</span><span class="op" id="2206916">)</span>&nbsp;<span class="op" id="2206918">[</span><span class="op" id="2206919">]</span><span class="builtintype" id="2206920">byte</span>&nbsp;<span class="op" id="2206925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2206928">//&nbsp;In&nbsp;the&nbsp;worst&nbsp;case,&nbsp;the&nbsp;slice&nbsp;can&nbsp;grow&nbsp;when&nbsp;mapped,&nbsp;making</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2206990">//&nbsp;things&nbsp;unpleasant.&nbsp;&nbsp;But&nbsp;it&#39;s&nbsp;so&nbsp;rare&nbsp;we&nbsp;barge&nbsp;in&nbsp;assuming&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2207057">//&nbsp;fine.&nbsp;&nbsp;It&nbsp;could&nbsp;also&nbsp;shrink&nbsp;but&nbsp;that&nbsp;falls&nbsp;out&nbsp;naturally.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207119">maxbytes</span>&nbsp;<span class="op" id="2207128">:=</span>&nbsp;<span class="builtinfunc" id="2207131">len</span><span class="op" id="2207134">(</span><span class="ident" id="2207135">s</span><span class="op" id="2207136">)</span>&nbsp;<span class="comment" id="2207138">//&nbsp;length&nbsp;of&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207154">nbytes</span>&nbsp;<span class="op" id="2207161">:=</span>&nbsp;<span class="num" id="2207164">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2207173">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;encoded&nbsp;in&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207206">b</span>&nbsp;<span class="op" id="2207208">:=</span>&nbsp;<span class="builtinfunc" id="2207211">make</span><span class="op" id="2207215">(</span><span class="op" id="2207216">[</span><span class="op" id="2207217">]</span><span class="builtintype" id="2207218">byte</span><span class="op" id="2207222">,</span>&nbsp;<span class="ident" id="2207224">maxbytes</span><span class="op" id="2207232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207235">for</span>&nbsp;<span class="ident" id="2207239">i</span>&nbsp;<span class="op" id="2207241">:=</span>&nbsp;<span class="num" id="2207244">0</span><span class="op" id="2207245">;</span>&nbsp;<span class="ident" id="2207247">i</span>&nbsp;<span class="op" id="2207249">&lt;</span>&nbsp;<span class="builtinfunc" id="2207251">len</span><span class="op" id="2207254">(</span><span class="ident" id="2207255">s</span><span class="op" id="2207256">)</span><span class="op" id="2207257">;</span>&nbsp;<span class="op" id="2207259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207263">wid</span>&nbsp;<span class="op" id="2207267">:=</span>&nbsp;<span class="num" id="2207270">1</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207274">r</span>&nbsp;<span class="op" id="2207276">:=</span>&nbsp;<span class="builtintype" id="2207279">rune</span><span class="op" id="2207283">(</span><span class="ident" id="2207284">s</span><span class="op" id="2207285">[</span><span class="ident" id="2207286">i</span><span class="op" id="2207287">]</span><span class="op" id="2207288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207292">if</span>&nbsp;<span class="ident" id="2207295">r</span>&nbsp;<span class="op" id="2207297">&gt;=</span>&nbsp;<span class="ident" id="2207300">utf8</span><span class="op" id="2207304">.</span><span class="ident" id="2207305">RuneSelf</span>&nbsp;<span class="op" id="2207314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207319">r</span><span class="op" id="2207320">,</span>&nbsp;<span class="ident" id="2207322">wid</span>&nbsp;<span class="op" id="2207326">=</span>&nbsp;<span class="ident" id="2207328">utf8</span><span class="op" id="2207332">.</span><span class="ident" id="2207333">DecodeRune</span><span class="op" id="2207343">(</span><span class="ident" id="2207344">s</span><span class="op" id="2207345">[</span><span class="ident" id="2207346">i</span><span class="op" id="2207347">:</span><span class="op" id="2207348">]</span><span class="op" id="2207349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2207353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207357">r</span>&nbsp;<span class="op" id="2207359">=</span>&nbsp;<span class="ident" id="2207361">mapping</span><span class="op" id="2207368">(</span><span class="ident" id="2207369">r</span><span class="op" id="2207370">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207374">if</span>&nbsp;<span class="ident" id="2207377">r</span>&nbsp;<span class="op" id="2207379">&gt;=</span>&nbsp;<span class="num" id="2207382">0</span>&nbsp;<span class="op" id="2207384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207389">rl</span>&nbsp;<span class="op" id="2207392">:=</span>&nbsp;<span class="ident" id="2207395">utf8</span><span class="op" id="2207399">.</span><span class="ident" id="2207400">RuneLen</span><span class="op" id="2207407">(</span><span class="ident" id="2207408">r</span><span class="op" id="2207409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207414">if</span>&nbsp;<span class="ident" id="2207417">rl</span>&nbsp;<span class="op" id="2207420">&lt;</span>&nbsp;<span class="num" id="2207422">0</span>&nbsp;<span class="op" id="2207424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207430">rl</span>&nbsp;<span class="op" id="2207433">=</span>&nbsp;<span class="builtinfunc" id="2207435">len</span><span class="op" id="2207438">(</span><span class="builtintype" id="2207439">string</span><span class="op" id="2207445">(</span><span class="ident" id="2207446">utf8</span><span class="op" id="2207450">.</span><span class="ident" id="2207451">RuneError</span><span class="op" id="2207460">)</span><span class="op" id="2207461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2207466">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207471">if</span>&nbsp;<span class="ident" id="2207474">nbytes</span><span class="op" id="2207480">+</span><span class="ident" id="2207481">rl</span>&nbsp;<span class="op" id="2207484">&gt;</span>&nbsp;<span class="ident" id="2207486">maxbytes</span>&nbsp;<span class="op" id="2207495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2207501">//&nbsp;Grow&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207525">maxbytes</span>&nbsp;<span class="op" id="2207534">=</span>&nbsp;<span class="ident" id="2207536">maxbytes</span><span class="op" id="2207544">*</span><span class="num" id="2207545">2</span>&nbsp;<span class="op" id="2207547">+</span>&nbsp;<span class="ident" id="2207549">utf8</span><span class="op" id="2207553">.</span><span class="ident" id="2207554">UTFMax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207565">nb</span>&nbsp;<span class="op" id="2207568">:=</span>&nbsp;<span class="builtinfunc" id="2207571">make</span><span class="op" id="2207575">(</span><span class="op" id="2207576">[</span><span class="op" id="2207577">]</span><span class="builtintype" id="2207578">byte</span><span class="op" id="2207582">,</span>&nbsp;<span class="ident" id="2207584">maxbytes</span><span class="op" id="2207592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2207598">copy</span><span class="op" id="2207602">(</span><span class="ident" id="2207603">nb</span><span class="op" id="2207605">,</span>&nbsp;<span class="ident" id="2207607">b</span><span class="op" id="2207608">[</span><span class="num" id="2207609">0</span><span class="op" id="2207610">:</span><span class="ident" id="2207611">nbytes</span><span class="op" id="2207617">]</span><span class="op" id="2207618">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207624">b</span>&nbsp;<span class="op" id="2207626">=</span>&nbsp;<span class="ident" id="2207628">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2207634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207639">nbytes</span>&nbsp;<span class="op" id="2207646">+=</span>&nbsp;<span class="ident" id="2207649">utf8</span><span class="op" id="2207653">.</span><span class="ident" id="2207654">EncodeRune</span><span class="op" id="2207664">(</span><span class="ident" id="2207665">b</span><span class="op" id="2207666">[</span><span class="ident" id="2207667">nbytes</span><span class="op" id="2207673">:</span><span class="ident" id="2207674">maxbytes</span><span class="op" id="2207682">]</span><span class="op" id="2207683">,</span>&nbsp;<span class="ident" id="2207685">r</span><span class="op" id="2207686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2207690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207694">i</span>&nbsp;<span class="op" id="2207696">+=</span>&nbsp;<span class="ident" id="2207699">wid</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2207704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207707">return</span>&nbsp;<span class="ident" id="2207714">b</span><span class="op" id="2207715">[</span><span class="num" id="2207716">0</span><span class="op" id="2207717">:</span><span class="ident" id="2207718">nbytes</span><span class="op" id="2207724">]</span><br>
<span class="lineno"></span><span class="op" id="2207726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2207729">//&nbsp;Repeat&nbsp;returns&nbsp;a&nbsp;new&nbsp;byte&nbsp;slice&nbsp;consisting&nbsp;of&nbsp;count&nbsp;copies&nbsp;of&nbsp;b.</span><br>
<span class="lineno">380</span><span class="keyword" id="2207797">func</span>&nbsp;<span class="ident" id="2207802">Repeat</span><span class="op" id="2207808">(</span><span class="ident" id="2207809">b</span>&nbsp;<span class="op" id="2207811">[</span><span class="op" id="2207812">]</span><span class="builtintype" id="2207813">byte</span><span class="op" id="2207817">,</span>&nbsp;<span class="ident" id="2207819">count</span>&nbsp;<span class="builtintype" id="2207825">int</span><span class="op" id="2207828">)</span>&nbsp;<span class="op" id="2207830">[</span><span class="op" id="2207831">]</span><span class="builtintype" id="2207832">byte</span>&nbsp;<span class="op" id="2207837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207840">nb</span>&nbsp;<span class="op" id="2207843">:=</span>&nbsp;<span class="builtinfunc" id="2207846">make</span><span class="op" id="2207850">(</span><span class="op" id="2207851">[</span><span class="op" id="2207852">]</span><span class="builtintype" id="2207853">byte</span><span class="op" id="2207857">,</span>&nbsp;<span class="builtinfunc" id="2207859">len</span><span class="op" id="2207862">(</span><span class="ident" id="2207863">b</span><span class="op" id="2207864">)</span><span class="op" id="2207865">*</span><span class="ident" id="2207866">count</span><span class="op" id="2207871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207874">bp</span>&nbsp;<span class="op" id="2207877">:=</span>&nbsp;<span class="builtinfunc" id="2207880">copy</span><span class="op" id="2207884">(</span><span class="ident" id="2207885">nb</span><span class="op" id="2207887">,</span>&nbsp;<span class="ident" id="2207889">b</span><span class="op" id="2207890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207893">for</span>&nbsp;<span class="ident" id="2207897">bp</span>&nbsp;<span class="op" id="2207900">&lt;</span>&nbsp;<span class="builtinfunc" id="2207902">len</span><span class="op" id="2207905">(</span><span class="ident" id="2207906">nb</span><span class="op" id="2207908">)</span>&nbsp;<span class="op" id="2207910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2207914">copy</span><span class="op" id="2207918">(</span><span class="ident" id="2207919">nb</span><span class="op" id="2207921">[</span><span class="ident" id="2207922">bp</span><span class="op" id="2207924">:</span><span class="op" id="2207925">]</span><span class="op" id="2207926">,</span>&nbsp;<span class="ident" id="2207928">nb</span><span class="op" id="2207930">[</span><span class="op" id="2207931">:</span><span class="ident" id="2207932">bp</span><span class="op" id="2207934">]</span><span class="op" id="2207935">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2207939">bp</span>&nbsp;<span class="op" id="2207942">*=</span>&nbsp;<span class="num" id="2207945">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2207948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2207951">return</span>&nbsp;<span class="ident" id="2207958">nb</span><br>
<span class="lineno"></span><span class="op" id="2207961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span><span class="comment" id="2207964">//&nbsp;ToUpper&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;upper&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2208063">func</span>&nbsp;<span class="ident" id="2208068">ToUpper</span><span class="op" id="2208075">(</span><span class="ident" id="2208076">s</span>&nbsp;<span class="op" id="2208078">[</span><span class="op" id="2208079">]</span><span class="builtintype" id="2208080">byte</span><span class="op" id="2208084">)</span>&nbsp;<span class="op" id="2208086">[</span><span class="op" id="2208087">]</span><span class="builtintype" id="2208088">byte</span>&nbsp;<span class="op" id="2208093">{</span>&nbsp;<span class="keyword" id="2208095">return</span>&nbsp;<span class="ident" id="2208102">Map</span><span class="op" id="2208105">(</span><span class="ident" id="2208106">unicode</span><span class="op" id="2208113">.</span><span class="ident" id="2208114">ToUpper</span><span class="op" id="2208121">,</span>&nbsp;<span class="ident" id="2208123">s</span><span class="op" id="2208124">)</span>&nbsp;<span class="op" id="2208126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2208129">//&nbsp;ToLower&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2208228">func</span>&nbsp;<span class="ident" id="2208233">ToLower</span><span class="op" id="2208240">(</span><span class="ident" id="2208241">s</span>&nbsp;<span class="op" id="2208243">[</span><span class="op" id="2208244">]</span><span class="builtintype" id="2208245">byte</span><span class="op" id="2208249">)</span>&nbsp;<span class="op" id="2208251">[</span><span class="op" id="2208252">]</span><span class="builtintype" id="2208253">byte</span>&nbsp;<span class="op" id="2208258">{</span>&nbsp;<span class="keyword" id="2208260">return</span>&nbsp;<span class="ident" id="2208267">Map</span><span class="op" id="2208270">(</span><span class="ident" id="2208271">unicode</span><span class="op" id="2208278">.</span><span class="ident" id="2208279">ToLower</span><span class="op" id="2208286">,</span>&nbsp;<span class="ident" id="2208288">s</span><span class="op" id="2208289">)</span>&nbsp;<span class="op" id="2208291">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="2208294">//&nbsp;ToTitle&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="keyword" id="2208393">func</span>&nbsp;<span class="ident" id="2208398">ToTitle</span><span class="op" id="2208405">(</span><span class="ident" id="2208406">s</span>&nbsp;<span class="op" id="2208408">[</span><span class="op" id="2208409">]</span><span class="builtintype" id="2208410">byte</span><span class="op" id="2208414">)</span>&nbsp;<span class="op" id="2208416">[</span><span class="op" id="2208417">]</span><span class="builtintype" id="2208418">byte</span>&nbsp;<span class="op" id="2208423">{</span>&nbsp;<span class="keyword" id="2208425">return</span>&nbsp;<span class="ident" id="2208432">Map</span><span class="op" id="2208435">(</span><span class="ident" id="2208436">unicode</span><span class="op" id="2208443">.</span><span class="ident" id="2208444">ToTitle</span><span class="op" id="2208451">,</span>&nbsp;<span class="ident" id="2208453">s</span><span class="op" id="2208454">)</span>&nbsp;<span class="op" id="2208456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2208459">//&nbsp;ToUpperSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno">400</span><span class="comment" id="2208553">//&nbsp;upper&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="2208613">func</span>&nbsp;<span class="ident" id="2208618">ToUpperSpecial</span><span class="op" id="2208632">(</span><span class="ident" id="2208633">_case</span>&nbsp;<span class="ident" id="2208639">unicode</span><span class="op" id="2208646">.</span><span class="ident" id="2208647">SpecialCase</span><span class="op" id="2208658">,</span>&nbsp;<span class="ident" id="2208660">s</span>&nbsp;<span class="op" id="2208662">[</span><span class="op" id="2208663">]</span><span class="builtintype" id="2208664">byte</span><span class="op" id="2208668">)</span>&nbsp;<span class="op" id="2208670">[</span><span class="op" id="2208671">]</span><span class="builtintype" id="2208672">byte</span>&nbsp;<span class="op" id="2208677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208680">return</span>&nbsp;<span class="ident" id="2208687">Map</span><span class="op" id="2208690">(</span><span class="keyword" id="2208691">func</span><span class="op" id="2208695">(</span><span class="ident" id="2208696">r</span>&nbsp;<span class="builtintype" id="2208698">rune</span><span class="op" id="2208702">)</span>&nbsp;<span class="builtintype" id="2208704">rune</span>&nbsp;<span class="op" id="2208709">{</span>&nbsp;<span class="keyword" id="2208711">return</span>&nbsp;<span class="ident" id="2208718">_case</span><span class="op" id="2208723">.</span><span class="ident" id="2208724">ToUpper</span><span class="op" id="2208731">(</span><span class="ident" id="2208732">r</span><span class="op" id="2208733">)</span>&nbsp;<span class="op" id="2208735">}</span><span class="op" id="2208736">,</span>&nbsp;<span class="ident" id="2208738">s</span><span class="op" id="2208739">)</span><br>
<span class="lineno"></span><span class="op" id="2208741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="comment" id="2208744">//&nbsp;ToLowerSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2208838">//&nbsp;lower&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="2208898">func</span>&nbsp;<span class="ident" id="2208903">ToLowerSpecial</span><span class="op" id="2208917">(</span><span class="ident" id="2208918">_case</span>&nbsp;<span class="ident" id="2208924">unicode</span><span class="op" id="2208931">.</span><span class="ident" id="2208932">SpecialCase</span><span class="op" id="2208943">,</span>&nbsp;<span class="ident" id="2208945">s</span>&nbsp;<span class="op" id="2208947">[</span><span class="op" id="2208948">]</span><span class="builtintype" id="2208949">byte</span><span class="op" id="2208953">)</span>&nbsp;<span class="op" id="2208955">[</span><span class="op" id="2208956">]</span><span class="builtintype" id="2208957">byte</span>&nbsp;<span class="op" id="2208962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208965">return</span>&nbsp;<span class="ident" id="2208972">Map</span><span class="op" id="2208975">(</span><span class="keyword" id="2208976">func</span><span class="op" id="2208980">(</span><span class="ident" id="2208981">r</span>&nbsp;<span class="builtintype" id="2208983">rune</span><span class="op" id="2208987">)</span>&nbsp;<span class="builtintype" id="2208989">rune</span>&nbsp;<span class="op" id="2208994">{</span>&nbsp;<span class="keyword" id="2208996">return</span>&nbsp;<span class="ident" id="2209003">_case</span><span class="op" id="2209008">.</span><span class="ident" id="2209009">ToLower</span><span class="op" id="2209016">(</span><span class="ident" id="2209017">r</span><span class="op" id="2209018">)</span>&nbsp;<span class="op" id="2209020">}</span><span class="op" id="2209021">,</span>&nbsp;<span class="ident" id="2209023">s</span><span class="op" id="2209024">)</span><br>
<span class="lineno"></span><span class="op" id="2209026">}</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span><span class="comment" id="2209029">//&nbsp;ToTitleSpecial&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;byte&nbsp;slice&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;mapped&nbsp;to&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="2209123">//&nbsp;title&nbsp;case,&nbsp;giving&nbsp;priority&nbsp;to&nbsp;the&nbsp;special&nbsp;casing&nbsp;rules.</span><br>
<span class="lineno"></span><span class="keyword" id="2209183">func</span>&nbsp;<span class="ident" id="2209188">ToTitleSpecial</span><span class="op" id="2209202">(</span><span class="ident" id="2209203">_case</span>&nbsp;<span class="ident" id="2209209">unicode</span><span class="op" id="2209216">.</span><span class="ident" id="2209217">SpecialCase</span><span class="op" id="2209228">,</span>&nbsp;<span class="ident" id="2209230">s</span>&nbsp;<span class="op" id="2209232">[</span><span class="op" id="2209233">]</span><span class="builtintype" id="2209234">byte</span><span class="op" id="2209238">)</span>&nbsp;<span class="op" id="2209240">[</span><span class="op" id="2209241">]</span><span class="builtintype" id="2209242">byte</span>&nbsp;<span class="op" id="2209247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209250">return</span>&nbsp;<span class="ident" id="2209257">Map</span><span class="op" id="2209260">(</span><span class="keyword" id="2209261">func</span><span class="op" id="2209265">(</span><span class="ident" id="2209266">r</span>&nbsp;<span class="builtintype" id="2209268">rune</span><span class="op" id="2209272">)</span>&nbsp;<span class="builtintype" id="2209274">rune</span>&nbsp;<span class="op" id="2209279">{</span>&nbsp;<span class="keyword" id="2209281">return</span>&nbsp;<span class="ident" id="2209288">_case</span><span class="op" id="2209293">.</span><span class="ident" id="2209294">ToTitle</span><span class="op" id="2209301">(</span><span class="ident" id="2209302">r</span><span class="op" id="2209303">)</span>&nbsp;<span class="op" id="2209305">}</span><span class="op" id="2209306">,</span>&nbsp;<span class="ident" id="2209308">s</span><span class="op" id="2209309">)</span><br>
<span class="lineno">415</span><span class="op" id="2209311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2209314">//&nbsp;isSeparator&nbsp;reports&nbsp;whether&nbsp;the&nbsp;rune&nbsp;could&nbsp;mark&nbsp;a&nbsp;word&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="comment" id="2209382">//&nbsp;TODO:&nbsp;update&nbsp;when&nbsp;package&nbsp;unicode&nbsp;captures&nbsp;more&nbsp;of&nbsp;the&nbsp;properties.</span><br>
<span class="lineno"></span><span class="keyword" id="2209452">func</span>&nbsp;<span class="ident" id="2209457">isSeparator</span><span class="op" id="2209468">(</span><span class="ident" id="2209469">r</span>&nbsp;<span class="builtintype" id="2209471">rune</span><span class="op" id="2209475">)</span>&nbsp;<span class="builtintype" id="2209477">bool</span>&nbsp;<span class="op" id="2209482">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2209485">//&nbsp;ASCII&nbsp;alphanumerics&nbsp;and&nbsp;underscore&nbsp;are&nbsp;not&nbsp;separators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209543">if</span>&nbsp;<span class="ident" id="2209546">r</span>&nbsp;<span class="op" id="2209548">&lt;=</span>&nbsp;<span class="num" id="2209551">0x7F</span>&nbsp;<span class="op" id="2209556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209560">switch</span>&nbsp;<span class="op" id="2209567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209571">case</span>&nbsp;<span class="string" id="2209576">&#39;0&#39;</span>&nbsp;<span class="op" id="2209580">&lt;=</span>&nbsp;<span class="ident" id="2209583">r</span>&nbsp;<span class="op" id="2209585">&amp;&amp;</span>&nbsp;<span class="ident" id="2209588">r</span>&nbsp;<span class="op" id="2209590">&lt;=</span>&nbsp;<span class="string" id="2209593">&#39;9&#39;</span><span class="op" id="2209596">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209601">return</span>&nbsp;<span class="builtintype" id="2209608">false</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209616">case</span>&nbsp;<span class="string" id="2209621">&#39;a&#39;</span>&nbsp;<span class="op" id="2209625">&lt;=</span>&nbsp;<span class="ident" id="2209628">r</span>&nbsp;<span class="op" id="2209630">&amp;&amp;</span>&nbsp;<span class="ident" id="2209633">r</span>&nbsp;<span class="op" id="2209635">&lt;=</span>&nbsp;<span class="string" id="2209638">&#39;z&#39;</span><span class="op" id="2209641">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209646">return</span>&nbsp;<span class="builtintype" id="2209653">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209661">case</span>&nbsp;<span class="string" id="2209666">&#39;A&#39;</span>&nbsp;<span class="op" id="2209670">&lt;=</span>&nbsp;<span class="ident" id="2209673">r</span>&nbsp;<span class="op" id="2209675">&amp;&amp;</span>&nbsp;<span class="ident" id="2209678">r</span>&nbsp;<span class="op" id="2209680">&lt;=</span>&nbsp;<span class="string" id="2209683">&#39;Z&#39;</span><span class="op" id="2209686">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209691">return</span>&nbsp;<span class="builtintype" id="2209698">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209706">case</span>&nbsp;<span class="ident" id="2209711">r</span>&nbsp;<span class="op" id="2209713">==</span>&nbsp;<span class="string" id="2209716">&#39;_&#39;</span><span class="op" id="2209719">:</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209724">return</span>&nbsp;<span class="builtintype" id="2209731">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2209739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209743">return</span>&nbsp;<span class="builtintype" id="2209750">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2209756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2209759">//&nbsp;Letters&nbsp;and&nbsp;digits&nbsp;are&nbsp;not&nbsp;separators</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209801">if</span>&nbsp;<span class="ident" id="2209804">unicode</span><span class="op" id="2209811">.</span><span class="ident" id="2209812">IsLetter</span><span class="op" id="2209820">(</span><span class="ident" id="2209821">r</span><span class="op" id="2209822">)</span>&nbsp;<span class="op" id="2209824">||</span>&nbsp;<span class="ident" id="2209827">unicode</span><span class="op" id="2209834">.</span><span class="ident" id="2209835">IsDigit</span><span class="op" id="2209842">(</span><span class="ident" id="2209843">r</span><span class="op" id="2209844">)</span>&nbsp;<span class="op" id="2209846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209850">return</span>&nbsp;<span class="builtintype" id="2209857">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2209864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2209867">//&nbsp;Otherwise,&nbsp;all&nbsp;we&nbsp;can&nbsp;do&nbsp;for&nbsp;now&nbsp;is&nbsp;treat&nbsp;spaces&nbsp;as&nbsp;separators.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209935">return</span>&nbsp;<span class="ident" id="2209942">unicode</span><span class="op" id="2209949">.</span><span class="ident" id="2209950">IsSpace</span><span class="op" id="2209957">(</span><span class="ident" id="2209958">r</span><span class="op" id="2209959">)</span><br>
<span class="lineno">440</span><span class="op" id="2209961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2209964">//&nbsp;Title&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;s&nbsp;with&nbsp;all&nbsp;Unicode&nbsp;letters&nbsp;that&nbsp;begin&nbsp;words</span><br>
<span class="lineno"></span><span class="comment" id="2210035">//&nbsp;mapped&nbsp;to&nbsp;their&nbsp;title&nbsp;case.</span><br>
<span class="lineno"></span><span class="comment" id="2210066">//</span><br>
<span class="lineno">445</span><span class="comment" id="2210069">//&nbsp;BUG:&nbsp;The&nbsp;rule&nbsp;Title&nbsp;uses&nbsp;for&nbsp;word&nbsp;boundaries&nbsp;does&nbsp;not&nbsp;handle&nbsp;Unicode&nbsp;punctuation&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2210163">func</span>&nbsp;<span class="ident" id="2210168">Title</span><span class="op" id="2210173">(</span><span class="ident" id="2210174">s</span>&nbsp;<span class="op" id="2210176">[</span><span class="op" id="2210177">]</span><span class="builtintype" id="2210178">byte</span><span class="op" id="2210182">)</span>&nbsp;<span class="op" id="2210184">[</span><span class="op" id="2210185">]</span><span class="builtintype" id="2210186">byte</span>&nbsp;<span class="op" id="2210191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2210194">//&nbsp;Use&nbsp;a&nbsp;closure&nbsp;here&nbsp;to&nbsp;remember&nbsp;state.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2210236">//&nbsp;Hackish&nbsp;but&nbsp;effective.&nbsp;Depends&nbsp;on&nbsp;Map&nbsp;scanning&nbsp;in&nbsp;order&nbsp;and&nbsp;calling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2210308">//&nbsp;the&nbsp;closure&nbsp;once&nbsp;per&nbsp;rune.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2210339">prev</span>&nbsp;<span class="op" id="2210344">:=</span>&nbsp;<span class="string" id="2210347">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210352">return</span>&nbsp;<span class="ident" id="2210359">Map</span><span class="op" id="2210362">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210366">func</span><span class="op" id="2210370">(</span><span class="ident" id="2210371">r</span>&nbsp;<span class="builtintype" id="2210373">rune</span><span class="op" id="2210377">)</span>&nbsp;<span class="builtintype" id="2210379">rune</span>&nbsp;<span class="op" id="2210384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210389">if</span>&nbsp;<span class="ident" id="2210392">isSeparator</span><span class="op" id="2210403">(</span><span class="ident" id="2210404">prev</span><span class="op" id="2210408">)</span>&nbsp;<span class="op" id="2210410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2210416">prev</span>&nbsp;<span class="op" id="2210421">=</span>&nbsp;<span class="ident" id="2210423">r</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210429">return</span>&nbsp;<span class="ident" id="2210436">unicode</span><span class="op" id="2210443">.</span><span class="ident" id="2210444">ToTitle</span><span class="op" id="2210451">(</span><span class="ident" id="2210452">r</span><span class="op" id="2210453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2210458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2210463">prev</span>&nbsp;<span class="op" id="2210468">=</span>&nbsp;<span class="ident" id="2210470">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210475">return</span>&nbsp;<span class="ident" id="2210482">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2210486">}</span><span class="op" id="2210487">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2210491">s</span><span class="op" id="2210492">)</span><br>
<span class="lineno"></span><span class="op" id="2210494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2210497">//&nbsp;TrimLeftFunc&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;leading&nbsp;UTF-8-encoded</span><br>
<span class="lineno"></span><span class="comment" id="2210578">//&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;that&nbsp;satisfy&nbsp;f(c).</span><br>
<span class="lineno">465</span><span class="keyword" id="2210622">func</span>&nbsp;<span class="ident" id="2210627">TrimLeftFunc</span><span class="op" id="2210639">(</span><span class="ident" id="2210640">s</span>&nbsp;<span class="op" id="2210642">[</span><span class="op" id="2210643">]</span><span class="builtintype" id="2210644">byte</span><span class="op" id="2210648">,</span>&nbsp;<span class="ident" id="2210650">f</span>&nbsp;<span class="keyword" id="2210652">func</span><span class="op" id="2210656">(</span><span class="ident" id="2210657">r</span>&nbsp;<span class="builtintype" id="2210659">rune</span><span class="op" id="2210663">)</span>&nbsp;<span class="builtintype" id="2210665">bool</span><span class="op" id="2210669">)</span>&nbsp;<span class="op" id="2210671">[</span><span class="op" id="2210672">]</span><span class="builtintype" id="2210673">byte</span>&nbsp;<span class="op" id="2210678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2210681">i</span>&nbsp;<span class="op" id="2210683">:=</span>&nbsp;<span class="ident" id="2210686">indexFunc</span><span class="op" id="2210695">(</span><span class="ident" id="2210696">s</span><span class="op" id="2210697">,</span>&nbsp;<span class="ident" id="2210699">f</span><span class="op" id="2210700">,</span>&nbsp;<span class="builtintype" id="2210702">false</span><span class="op" id="2210707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210710">if</span>&nbsp;<span class="ident" id="2210713">i</span>&nbsp;<span class="op" id="2210715">==</span>&nbsp;<span class="op" id="2210718">-</span><span class="num" id="2210719">1</span>&nbsp;<span class="op" id="2210721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210725">return</span>&nbsp;<span class="ident" id="2210732">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2210737">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210740">return</span>&nbsp;<span class="ident" id="2210747">s</span><span class="op" id="2210748">[</span><span class="ident" id="2210749">i</span><span class="op" id="2210750">:</span><span class="op" id="2210751">]</span><br>
<span class="lineno"></span><span class="op" id="2210753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2210756">//&nbsp;TrimRightFunc&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;trailing&nbsp;UTF-8</span><br>
<span class="lineno"></span><span class="comment" id="2210831">//&nbsp;encoded&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;that&nbsp;satisfy&nbsp;f(c).</span><br>
<span class="lineno">475</span><span class="keyword" id="2210883">func</span>&nbsp;<span class="ident" id="2210888">TrimRightFunc</span><span class="op" id="2210901">(</span><span class="ident" id="2210902">s</span>&nbsp;<span class="op" id="2210904">[</span><span class="op" id="2210905">]</span><span class="builtintype" id="2210906">byte</span><span class="op" id="2210910">,</span>&nbsp;<span class="ident" id="2210912">f</span>&nbsp;<span class="keyword" id="2210914">func</span><span class="op" id="2210918">(</span><span class="ident" id="2210919">r</span>&nbsp;<span class="builtintype" id="2210921">rune</span><span class="op" id="2210925">)</span>&nbsp;<span class="builtintype" id="2210927">bool</span><span class="op" id="2210931">)</span>&nbsp;<span class="op" id="2210933">[</span><span class="op" id="2210934">]</span><span class="builtintype" id="2210935">byte</span>&nbsp;<span class="op" id="2210940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2210943">i</span>&nbsp;<span class="op" id="2210945">:=</span>&nbsp;<span class="ident" id="2210948">lastIndexFunc</span><span class="op" id="2210961">(</span><span class="ident" id="2210962">s</span><span class="op" id="2210963">,</span>&nbsp;<span class="ident" id="2210965">f</span><span class="op" id="2210966">,</span>&nbsp;<span class="builtintype" id="2210968">false</span><span class="op" id="2210973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210976">if</span>&nbsp;<span class="ident" id="2210979">i</span>&nbsp;<span class="op" id="2210981">&gt;=</span>&nbsp;<span class="num" id="2210984">0</span>&nbsp;<span class="op" id="2210986">&amp;&amp;</span>&nbsp;<span class="ident" id="2210989">s</span><span class="op" id="2210990">[</span><span class="ident" id="2210991">i</span><span class="op" id="2210992">]</span>&nbsp;<span class="op" id="2210994">&gt;=</span>&nbsp;<span class="ident" id="2210997">utf8</span><span class="op" id="2211001">.</span><span class="ident" id="2211002">RuneSelf</span>&nbsp;<span class="op" id="2211011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211015">_</span><span class="op" id="2211016">,</span>&nbsp;<span class="ident" id="2211018">wid</span>&nbsp;<span class="op" id="2211022">:=</span>&nbsp;<span class="ident" id="2211025">utf8</span><span class="op" id="2211029">.</span><span class="ident" id="2211030">DecodeRune</span><span class="op" id="2211040">(</span><span class="ident" id="2211041">s</span><span class="op" id="2211042">[</span><span class="ident" id="2211043">i</span><span class="op" id="2211044">:</span><span class="op" id="2211045">]</span><span class="op" id="2211046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211050">i</span>&nbsp;<span class="op" id="2211052">+=</span>&nbsp;<span class="ident" id="2211055">wid</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211060">}</span>&nbsp;<span class="keyword" id="2211062">else</span>&nbsp;<span class="op" id="2211067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211071">i</span><span class="op" id="2211072">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211076">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211079">return</span>&nbsp;<span class="ident" id="2211086">s</span><span class="op" id="2211087">[</span><span class="num" id="2211088">0</span><span class="op" id="2211089">:</span><span class="ident" id="2211090">i</span><span class="op" id="2211091">]</span><br>
<span class="lineno"></span><span class="op" id="2211093">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span><span class="comment" id="2211096">//&nbsp;TrimFunc&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;leading&nbsp;and&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="2211172">//&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;c&nbsp;that&nbsp;satisfy&nbsp;f(c).</span><br>
<span class="lineno"></span><span class="keyword" id="2211230">func</span>&nbsp;<span class="ident" id="2211235">TrimFunc</span><span class="op" id="2211243">(</span><span class="ident" id="2211244">s</span>&nbsp;<span class="op" id="2211246">[</span><span class="op" id="2211247">]</span><span class="builtintype" id="2211248">byte</span><span class="op" id="2211252">,</span>&nbsp;<span class="ident" id="2211254">f</span>&nbsp;<span class="keyword" id="2211256">func</span><span class="op" id="2211260">(</span><span class="ident" id="2211261">r</span>&nbsp;<span class="builtintype" id="2211263">rune</span><span class="op" id="2211267">)</span>&nbsp;<span class="builtintype" id="2211269">bool</span><span class="op" id="2211273">)</span>&nbsp;<span class="op" id="2211275">[</span><span class="op" id="2211276">]</span><span class="builtintype" id="2211277">byte</span>&nbsp;<span class="op" id="2211282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211285">return</span>&nbsp;<span class="ident" id="2211292">TrimRightFunc</span><span class="op" id="2211305">(</span><span class="ident" id="2211306">TrimLeftFunc</span><span class="op" id="2211318">(</span><span class="ident" id="2211319">s</span><span class="op" id="2211320">,</span>&nbsp;<span class="ident" id="2211322">f</span><span class="op" id="2211323">)</span><span class="op" id="2211324">,</span>&nbsp;<span class="ident" id="2211326">f</span><span class="op" id="2211327">)</span><br>
<span class="lineno">490</span><span class="op" id="2211329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2211332">//&nbsp;TrimPrefix&nbsp;returns&nbsp;s&nbsp;without&nbsp;the&nbsp;provided&nbsp;leading&nbsp;prefix&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2211400">//&nbsp;If&nbsp;s&nbsp;doesn&#39;t&nbsp;start&nbsp;with&nbsp;prefix,&nbsp;s&nbsp;is&nbsp;returned&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="keyword" id="2211460">func</span>&nbsp;<span class="ident" id="2211465">TrimPrefix</span><span class="op" id="2211475">(</span><span class="ident" id="2211476">s</span><span class="op" id="2211477">,</span>&nbsp;<span class="ident" id="2211479">prefix</span>&nbsp;<span class="op" id="2211486">[</span><span class="op" id="2211487">]</span><span class="builtintype" id="2211488">byte</span><span class="op" id="2211492">)</span>&nbsp;<span class="op" id="2211494">[</span><span class="op" id="2211495">]</span><span class="builtintype" id="2211496">byte</span>&nbsp;<span class="op" id="2211501">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211504">if</span>&nbsp;<span class="ident" id="2211507">HasPrefix</span><span class="op" id="2211516">(</span><span class="ident" id="2211517">s</span><span class="op" id="2211518">,</span>&nbsp;<span class="ident" id="2211520">prefix</span><span class="op" id="2211526">)</span>&nbsp;<span class="op" id="2211528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211532">return</span>&nbsp;<span class="ident" id="2211539">s</span><span class="op" id="2211540">[</span><span class="builtinfunc" id="2211541">len</span><span class="op" id="2211544">(</span><span class="ident" id="2211545">prefix</span><span class="op" id="2211551">)</span><span class="op" id="2211552">:</span><span class="op" id="2211553">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211559">return</span>&nbsp;<span class="ident" id="2211566">s</span><br>
<span class="lineno"></span><span class="op" id="2211568">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="comment" id="2211571">//&nbsp;TrimSuffix&nbsp;returns&nbsp;s&nbsp;without&nbsp;the&nbsp;provided&nbsp;trailing&nbsp;suffix&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2211640">//&nbsp;If&nbsp;s&nbsp;doesn&#39;t&nbsp;end&nbsp;with&nbsp;suffix,&nbsp;s&nbsp;is&nbsp;returned&nbsp;unchanged.</span><br>
<span class="lineno"></span><span class="keyword" id="2211698">func</span>&nbsp;<span class="ident" id="2211703">TrimSuffix</span><span class="op" id="2211713">(</span><span class="ident" id="2211714">s</span><span class="op" id="2211715">,</span>&nbsp;<span class="ident" id="2211717">suffix</span>&nbsp;<span class="op" id="2211724">[</span><span class="op" id="2211725">]</span><span class="builtintype" id="2211726">byte</span><span class="op" id="2211730">)</span>&nbsp;<span class="op" id="2211732">[</span><span class="op" id="2211733">]</span><span class="builtintype" id="2211734">byte</span>&nbsp;<span class="op" id="2211739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211742">if</span>&nbsp;<span class="ident" id="2211745">HasSuffix</span><span class="op" id="2211754">(</span><span class="ident" id="2211755">s</span><span class="op" id="2211756">,</span>&nbsp;<span class="ident" id="2211758">suffix</span><span class="op" id="2211764">)</span>&nbsp;<span class="op" id="2211766">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211770">return</span>&nbsp;<span class="ident" id="2211777">s</span><span class="op" id="2211778">[</span><span class="op" id="2211779">:</span><span class="builtinfunc" id="2211780">len</span><span class="op" id="2211783">(</span><span class="ident" id="2211784">s</span><span class="op" id="2211785">)</span><span class="op" id="2211786">-</span><span class="builtinfunc" id="2211787">len</span><span class="op" id="2211790">(</span><span class="ident" id="2211791">suffix</span><span class="op" id="2211797">)</span><span class="op" id="2211798">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211804">return</span>&nbsp;<span class="ident" id="2211811">s</span><br>
<span class="lineno"></span><span class="op" id="2211813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">510</span><span class="comment" id="2211816">//&nbsp;IndexFunc&nbsp;interprets&nbsp;s&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="comment" id="2211894">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;byte&nbsp;index&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;first&nbsp;Unicode</span><br>
<span class="lineno"></span><span class="comment" id="2211949">//&nbsp;code&nbsp;point&nbsp;satisfying&nbsp;f(c),&nbsp;or&nbsp;-1&nbsp;if&nbsp;none&nbsp;do.</span><br>
<span class="lineno"></span><span class="keyword" id="2211998">func</span>&nbsp;<span class="ident" id="2212003">IndexFunc</span><span class="op" id="2212012">(</span><span class="ident" id="2212013">s</span>&nbsp;<span class="op" id="2212015">[</span><span class="op" id="2212016">]</span><span class="builtintype" id="2212017">byte</span><span class="op" id="2212021">,</span>&nbsp;<span class="ident" id="2212023">f</span>&nbsp;<span class="keyword" id="2212025">func</span><span class="op" id="2212029">(</span><span class="ident" id="2212030">r</span>&nbsp;<span class="builtintype" id="2212032">rune</span><span class="op" id="2212036">)</span>&nbsp;<span class="builtintype" id="2212038">bool</span><span class="op" id="2212042">)</span>&nbsp;<span class="builtintype" id="2212044">int</span>&nbsp;<span class="op" id="2212048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2212051">return</span>&nbsp;<span class="ident" id="2212058">indexFunc</span><span class="op" id="2212067">(</span><span class="ident" id="2212068">s</span><span class="op" id="2212069">,</span>&nbsp;<span class="ident" id="2212071">f</span><span class="op" id="2212072">,</span>&nbsp;<span class="builtintype" id="2212074">true</span><span class="op" id="2212078">)</span><br>
<span class="lineno">515</span><span class="op" id="2212080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2212083">//&nbsp;LastIndexFunc&nbsp;interprets&nbsp;s&nbsp;as&nbsp;a&nbsp;sequence&nbsp;of&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points.</span><br>
<span class="lineno"></span><span class="comment" id="2212165">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;byte&nbsp;index&nbsp;in&nbsp;s&nbsp;of&nbsp;the&nbsp;last&nbsp;Unicode</span><br>
<span class="lineno"></span><span class="comment" id="2212219">//&nbsp;code&nbsp;point&nbsp;satisfying&nbsp;f(c),&nbsp;or&nbsp;-1&nbsp;if&nbsp;none&nbsp;do.</span><br>
<span class="lineno">520</span><span class="keyword" id="2212268">func</span>&nbsp;<span class="ident" id="2212273">LastIndexFunc</span><span class="op" id="2212286">(</span><span class="ident" id="2212287">s</span>&nbsp;<span class="op" id="2212289">[</span><span class="op" id="2212290">]</span><span class="builtintype" id="2212291">byte</span><span class="op" id="2212295">,</span>&nbsp;<span class="ident" id="2212297">f</span>&nbsp;<span class="keyword" id="2212299">func</span><span class="op" id="2212303">(</span><span class="ident" id="2212304">r</span>&nbsp;<span class="builtintype" id="2212306">rune</span><span class="op" id="2212310">)</span>&nbsp;<span class="builtintype" id="2212312">bool</span><span class="op" id="2212316">)</span>&nbsp;<span class="builtintype" id="2212318">int</span>&nbsp;<span class="op" id="2212322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2212325">return</span>&nbsp;<span class="ident" id="2212332">lastIndexFunc</span><span class="op" id="2212345">(</span><span class="ident" id="2212346">s</span><span class="op" id="2212347">,</span>&nbsp;<span class="ident" id="2212349">f</span><span class="op" id="2212350">,</span>&nbsp;<span class="builtintype" id="2212352">true</span><span class="op" id="2212356">)</span><br>
<span class="lineno"></span><span class="op" id="2212358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2212361">//&nbsp;indexFunc&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;IndexFunc&nbsp;except&nbsp;that&nbsp;if</span><br>
<span class="lineno">525</span><span class="comment" id="2212414">//&nbsp;truth==false,&nbsp;the&nbsp;sense&nbsp;of&nbsp;the&nbsp;predicate&nbsp;function&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2212470">//&nbsp;inverted.</span><br>
<span class="lineno"></span><span class="keyword" id="2212483">func</span>&nbsp;<span class="ident" id="2212488">indexFunc</span><span class="op" id="2212497">(</span><span class="ident" id="2212498">s</span>&nbsp;<span class="op" id="2212500">[</span><span class="op" id="2212501">]</span><span class="builtintype" id="2212502">byte</span><span class="op" id="2212506">,</span>&nbsp;<span class="ident" id="2212508">f</span>&nbsp;<span class="keyword" id="2212510">func</span><span class="op" id="2212514">(</span><span class="ident" id="2212515">r</span>&nbsp;<span class="builtintype" id="2212517">rune</span><span class="op" id="2212521">)</span>&nbsp;<span class="builtintype" id="2212523">bool</span><span class="op" id="2212527">,</span>&nbsp;<span class="ident" id="2212529">truth</span>&nbsp;<span class="builtintype" id="2212535">bool</span><span class="op" id="2212539">)</span>&nbsp;<span class="builtintype" id="2212541">int</span>&nbsp;<span class="op" id="2212545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2212548">start</span>&nbsp;<span class="op" id="2212554">:=</span>&nbsp;<span class="num" id="2212557">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2212560">for</span>&nbsp;<span class="ident" id="2212564">start</span>&nbsp;<span class="op" id="2212570">&lt;</span>&nbsp;<span class="builtinfunc" id="2212572">len</span><span class="op" id="2212575">(</span><span class="ident" id="2212576">s</span><span class="op" id="2212577">)</span>&nbsp;<span class="op" id="2212579">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2212583">wid</span>&nbsp;<span class="op" id="2212587">:=</span>&nbsp;<span class="num" id="2212590">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2212594">r</span>&nbsp;<span class="op" id="2212596">:=</span>&nbsp;<span class="builtintype" id="2212599">rune</span><span class="op" id="2212603">(</span><span class="ident" id="2212604">s</span><span class="op" id="2212605">[</span><span class="ident" id="2212606">start</span><span class="op" id="2212611">]</span><span class="op" id="2212612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2212616">if</span>&nbsp;<span class="ident" id="2212619">r</span>&nbsp;<span class="op" id="2212621">&gt;=</span>&nbsp;<span class="ident" id="2212624">utf8</span><span class="op" id="2212628">.</span><span class="ident" id="2212629">RuneSelf</span>&nbsp;<span class="op" id="2212638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2212643">r</span><span class="op" id="2212644">,</span>&nbsp;<span class="ident" id="2212646">wid</span>&nbsp;<span class="op" id="2212650">=</span>&nbsp;<span class="ident" id="2212652">utf8</span><span class="op" id="2212656">.</span><span class="ident" id="2212657">DecodeRune</span><span class="op" id="2212667">(</span><span class="ident" id="2212668">s</span><span class="op" id="2212669">[</span><span class="ident" id="2212670">start</span><span class="op" id="2212675">:</span><span class="op" id="2212676">]</span><span class="op" id="2212677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2212681">}</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2212685">if</span>&nbsp;<span class="ident" id="2212688">f</span><span class="op" id="2212689">(</span><span class="ident" id="2212690">r</span><span class="op" id="2212691">)</span>&nbsp;<span class="op" id="2212693">==</span>&nbsp;<span class="ident" id="2212696">truth</span>&nbsp;<span class="op" id="2212702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2212707">return</span>&nbsp;<span class="ident" id="2212714">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2212722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2212726">start</span>&nbsp;<span class="op" id="2212732">+=</span>&nbsp;<span class="ident" id="2212735">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2212740">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2212743">return</span>&nbsp;<span class="op" id="2212750">-</span><span class="num" id="2212751">1</span><br>
<span class="lineno"></span><span class="op" id="2212753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2212756">//&nbsp;lastIndexFunc&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;LastIndexFunc&nbsp;except&nbsp;that&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="2212817">//&nbsp;truth==false,&nbsp;the&nbsp;sense&nbsp;of&nbsp;the&nbsp;predicate&nbsp;function&nbsp;is</span><br>
<span class="lineno">545</span><span class="comment" id="2212873">//&nbsp;inverted.</span><br>
<span class="lineno"></span><span class="keyword" id="2212886">func</span>&nbsp;<span class="ident" id="2212891">lastIndexFunc</span><span class="op" id="2212904">(</span><span class="ident" id="2212905">s</span>&nbsp;<span class="op" id="2212907">[</span><span class="op" id="2212908">]</span><span class="builtintype" id="2212909">byte</span><span class="op" id="2212913">,</span>&nbsp;<span class="ident" id="2212915">f</span>&nbsp;<span class="keyword" id="2212917">func</span><span class="op" id="2212921">(</span><span class="ident" id="2212922">r</span>&nbsp;<span class="builtintype" id="2212924">rune</span><span class="op" id="2212928">)</span>&nbsp;<span class="builtintype" id="2212930">bool</span><span class="op" id="2212934">,</span>&nbsp;<span class="ident" id="2212936">truth</span>&nbsp;<span class="builtintype" id="2212942">bool</span><span class="op" id="2212946">)</span>&nbsp;<span class="builtintype" id="2212948">int</span>&nbsp;<span class="op" id="2212952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2212955">for</span>&nbsp;<span class="ident" id="2212959">i</span>&nbsp;<span class="op" id="2212961">:=</span>&nbsp;<span class="builtinfunc" id="2212964">len</span><span class="op" id="2212967">(</span><span class="ident" id="2212968">s</span><span class="op" id="2212969">)</span><span class="op" id="2212970">;</span>&nbsp;<span class="ident" id="2212972">i</span>&nbsp;<span class="op" id="2212974">&gt;</span>&nbsp;<span class="num" id="2212976">0</span><span class="op" id="2212977">;</span>&nbsp;<span class="op" id="2212979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2212983">r</span><span class="op" id="2212984">,</span>&nbsp;<span class="ident" id="2212986">size</span>&nbsp;<span class="op" id="2212991">:=</span>&nbsp;<span class="builtintype" id="2212994">rune</span><span class="op" id="2212998">(</span><span class="ident" id="2212999">s</span><span class="op" id="2213000">[</span><span class="ident" id="2213001">i</span><span class="op" id="2213002">-</span><span class="num" id="2213003">1</span><span class="op" id="2213004">]</span><span class="op" id="2213005">)</span><span class="op" id="2213006">,</span>&nbsp;<span class="num" id="2213008">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2213012">if</span>&nbsp;<span class="ident" id="2213015">r</span>&nbsp;<span class="op" id="2213017">&gt;=</span>&nbsp;<span class="ident" id="2213020">utf8</span><span class="op" id="2213024">.</span><span class="ident" id="2213025">RuneSelf</span>&nbsp;<span class="op" id="2213034">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2213039">r</span><span class="op" id="2213040">,</span>&nbsp;<span class="ident" id="2213042">size</span>&nbsp;<span class="op" id="2213047">=</span>&nbsp;<span class="ident" id="2213049">utf8</span><span class="op" id="2213053">.</span><span class="ident" id="2213054">DecodeLastRune</span><span class="op" id="2213068">(</span><span class="ident" id="2213069">s</span><span class="op" id="2213070">[</span><span class="num" id="2213071">0</span><span class="op" id="2213072">:</span><span class="ident" id="2213073">i</span><span class="op" id="2213074">]</span><span class="op" id="2213075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2213079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2213083">i</span>&nbsp;<span class="op" id="2213085">-=</span>&nbsp;<span class="ident" id="2213088">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2213095">if</span>&nbsp;<span class="ident" id="2213098">f</span><span class="op" id="2213099">(</span><span class="ident" id="2213100">r</span><span class="op" id="2213101">)</span>&nbsp;<span class="op" id="2213103">==</span>&nbsp;<span class="ident" id="2213106">truth</span>&nbsp;<span class="op" id="2213112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2213117">return</span>&nbsp;<span class="ident" id="2213124">i</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2213128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2213131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2213134">return</span>&nbsp;<span class="op" id="2213141">-</span><span class="num" id="2213142">1</span><br>
<span class="lineno"></span><span class="op" id="2213144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">560</span><span class="keyword" id="2213147">func</span>&nbsp;<span class="ident" id="2213152">makeCutsetFunc</span><span class="op" id="2213166">(</span><span class="ident" id="2213167">cutset</span>&nbsp;<span class="builtintype" id="2213174">string</span><span class="op" id="2213180">)</span>&nbsp;<span class="keyword" id="2213182">func</span><span class="op" id="2213186">(</span><span class="ident" id="2213187">r</span>&nbsp;<span class="builtintype" id="2213189">rune</span><span class="op" id="2213193">)</span>&nbsp;<span class="builtintype" id="2213195">bool</span>&nbsp;<span class="op" id="2213200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2213203">return</span>&nbsp;<span class="keyword" id="2213210">func</span><span class="op" id="2213214">(</span><span class="ident" id="2213215">r</span>&nbsp;<span class="builtintype" id="2213217">rune</span><span class="op" id="2213221">)</span>&nbsp;<span class="builtintype" id="2213223">bool</span>&nbsp;<span class="op" id="2213228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2213232">for</span>&nbsp;<span class="ident" id="2213236">_</span><span class="op" id="2213237">,</span>&nbsp;<span class="ident" id="2213239">c</span>&nbsp;<span class="op" id="2213241">:=</span>&nbsp;<span class="keyword" id="2213244">range</span>&nbsp;<span class="ident" id="2213250">cutset</span>&nbsp;<span class="op" id="2213257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2213262">if</span>&nbsp;<span class="ident" id="2213265">c</span>&nbsp;<span class="op" id="2213267">==</span>&nbsp;<span class="ident" id="2213270">r</span>&nbsp;<span class="op" id="2213272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2213278">return</span>&nbsp;<span class="builtintype" id="2213285">true</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2213293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2213297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2213301">return</span>&nbsp;<span class="builtintype" id="2213308">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2213315">}</span><br>
<span class="lineno"></span><span class="op" id="2213317">}</span><br>
<span class="lineno">570</span><br>
<span class="lineno"></span><span class="comment" id="2213320">//&nbsp;Trim&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;leading&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2213383">//&nbsp;trailing&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset.</span><br>
<span class="lineno"></span><span class="keyword" id="2213450">func</span>&nbsp;<span class="ident" id="2213455">Trim</span><span class="op" id="2213459">(</span><span class="ident" id="2213460">s</span>&nbsp;<span class="op" id="2213462">[</span><span class="op" id="2213463">]</span><span class="builtintype" id="2213464">byte</span><span class="op" id="2213468">,</span>&nbsp;<span class="ident" id="2213470">cutset</span>&nbsp;<span class="builtintype" id="2213477">string</span><span class="op" id="2213483">)</span>&nbsp;<span class="op" id="2213485">[</span><span class="op" id="2213486">]</span><span class="builtintype" id="2213487">byte</span>&nbsp;<span class="op" id="2213492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2213495">return</span>&nbsp;<span class="ident" id="2213502">TrimFunc</span><span class="op" id="2213510">(</span><span class="ident" id="2213511">s</span><span class="op" id="2213512">,</span>&nbsp;<span class="ident" id="2213514">makeCutsetFunc</span><span class="op" id="2213528">(</span><span class="ident" id="2213529">cutset</span><span class="op" id="2213535">)</span><span class="op" id="2213536">)</span><br>
<span class="lineno">575</span><span class="op" id="2213538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2213541">//&nbsp;TrimLeft&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;leading</span><br>
<span class="lineno"></span><span class="comment" id="2213604">//&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;contained&nbsp;in&nbsp;cutset.</span><br>
<span class="lineno"></span><span class="keyword" id="2213662">func</span>&nbsp;<span class="ident" id="2213667">TrimLeft</span><span class="op" id="2213675">(</span><span class="ident" id="2213676">s</span>&nbsp;<span class="op" id="2213678">[</span><span class="op" id="2213679">]</span><span class="builtintype" id="2213680">byte</span><span class="op" id="2213684">,</span>&nbsp;<span class="ident" id="2213686">cutset</span>&nbsp;<span class="builtintype" id="2213693">string</span><span class="op" id="2213699">)</span>&nbsp;<span class="op" id="2213701">[</span><span class="op" id="2213702">]</span><span class="builtintype" id="2213703">byte</span>&nbsp;<span class="op" id="2213708">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2213711">return</span>&nbsp;<span class="ident" id="2213718">TrimLeftFunc</span><span class="op" id="2213730">(</span><span class="ident" id="2213731">s</span><span class="op" id="2213732">,</span>&nbsp;<span class="ident" id="2213734">makeCutsetFunc</span><span class="op" id="2213748">(</span><span class="ident" id="2213749">cutset</span><span class="op" id="2213755">)</span><span class="op" id="2213756">)</span><br>
<span class="lineno"></span><span class="op" id="2213758">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2213761">//&nbsp;TrimRight&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="2213826">//&nbsp;UTF-8-encoded&nbsp;Unicode&nbsp;code&nbsp;points&nbsp;that&nbsp;are&nbsp;contained&nbsp;in&nbsp;cutset.</span><br>
<span class="lineno">585</span><span class="keyword" id="2213893">func</span>&nbsp;<span class="ident" id="2213898">TrimRight</span><span class="op" id="2213907">(</span><span class="ident" id="2213908">s</span>&nbsp;<span class="op" id="2213910">[</span><span class="op" id="2213911">]</span><span class="builtintype" id="2213912">byte</span><span class="op" id="2213916">,</span>&nbsp;<span class="ident" id="2213918">cutset</span>&nbsp;<span class="builtintype" id="2213925">string</span><span class="op" id="2213931">)</span>&nbsp;<span class="op" id="2213933">[</span><span class="op" id="2213934">]</span><span class="builtintype" id="2213935">byte</span>&nbsp;<span class="op" id="2213940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2213943">return</span>&nbsp;<span class="ident" id="2213950">TrimRightFunc</span><span class="op" id="2213963">(</span><span class="ident" id="2213964">s</span><span class="op" id="2213965">,</span>&nbsp;<span class="ident" id="2213967">makeCutsetFunc</span><span class="op" id="2213981">(</span><span class="ident" id="2213982">cutset</span><span class="op" id="2213988">)</span><span class="op" id="2213989">)</span><br>
<span class="lineno"></span><span class="op" id="2213991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2213994">//&nbsp;TrimSpace&nbsp;returns&nbsp;a&nbsp;subslice&nbsp;of&nbsp;s&nbsp;by&nbsp;slicing&nbsp;off&nbsp;all&nbsp;leading&nbsp;and</span><br>
<span class="lineno">590</span><span class="comment" id="2214062">//&nbsp;trailing&nbsp;white&nbsp;space,&nbsp;as&nbsp;defined&nbsp;by&nbsp;Unicode.</span><br>
<span class="lineno"></span><span class="keyword" id="2214110">func</span>&nbsp;<span class="ident" id="2214115">TrimSpace</span><span class="op" id="2214124">(</span><span class="ident" id="2214125">s</span>&nbsp;<span class="op" id="2214127">[</span><span class="op" id="2214128">]</span><span class="builtintype" id="2214129">byte</span><span class="op" id="2214133">)</span>&nbsp;<span class="op" id="2214135">[</span><span class="op" id="2214136">]</span><span class="builtintype" id="2214137">byte</span>&nbsp;<span class="op" id="2214142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2214145">return</span>&nbsp;<span class="ident" id="2214152">TrimFunc</span><span class="op" id="2214160">(</span><span class="ident" id="2214161">s</span><span class="op" id="2214162">,</span>&nbsp;<span class="ident" id="2214164">unicode</span><span class="op" id="2214171">.</span><span class="ident" id="2214172">IsSpace</span><span class="op" id="2214179">)</span><br>
<span class="lineno"></span><span class="op" id="2214181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="comment" id="2214184">//&nbsp;Runes&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;runes&nbsp;(Unicode&nbsp;code&nbsp;points)&nbsp;equivalent&nbsp;to&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="2214257">func</span>&nbsp;<span class="ident" id="2214262">Runes</span><span class="op" id="2214267">(</span><span class="ident" id="2214268">s</span>&nbsp;<span class="op" id="2214270">[</span><span class="op" id="2214271">]</span><span class="builtintype" id="2214272">byte</span><span class="op" id="2214276">)</span>&nbsp;<span class="op" id="2214278">[</span><span class="op" id="2214279">]</span><span class="builtintype" id="2214280">rune</span>&nbsp;<span class="op" id="2214285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2214288">t</span>&nbsp;<span class="op" id="2214290">:=</span>&nbsp;<span class="builtinfunc" id="2214293">make</span><span class="op" id="2214297">(</span><span class="op" id="2214298">[</span><span class="op" id="2214299">]</span><span class="builtintype" id="2214300">rune</span><span class="op" id="2214304">,</span>&nbsp;<span class="ident" id="2214306">utf8</span><span class="op" id="2214310">.</span><span class="ident" id="2214311">RuneCount</span><span class="op" id="2214320">(</span><span class="ident" id="2214321">s</span><span class="op" id="2214322">)</span><span class="op" id="2214323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2214326">i</span>&nbsp;<span class="op" id="2214328">:=</span>&nbsp;<span class="num" id="2214331">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2214334">for</span>&nbsp;<span class="builtinfunc" id="2214338">len</span><span class="op" id="2214341">(</span><span class="ident" id="2214342">s</span><span class="op" id="2214343">)</span>&nbsp;<span class="op" id="2214345">&gt;</span>&nbsp;<span class="num" id="2214347">0</span>&nbsp;<span class="op" id="2214349">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2214353">r</span><span class="op" id="2214354">,</span>&nbsp;<span class="ident" id="2214356">l</span>&nbsp;<span class="op" id="2214358">:=</span>&nbsp;<span class="ident" id="2214361">utf8</span><span class="op" id="2214365">.</span><span class="ident" id="2214366">DecodeRune</span><span class="op" id="2214376">(</span><span class="ident" id="2214377">s</span><span class="op" id="2214378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2214382">t</span><span class="op" id="2214383">[</span><span class="ident" id="2214384">i</span><span class="op" id="2214385">]</span>&nbsp;<span class="op" id="2214387">=</span>&nbsp;<span class="ident" id="2214389">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2214393">i</span><span class="op" id="2214394">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2214399">s</span>&nbsp;<span class="op" id="2214401">=</span>&nbsp;<span class="ident" id="2214403">s</span><span class="op" id="2214404">[</span><span class="ident" id="2214405">l</span><span class="op" id="2214406">:</span><span class="op" id="2214407">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2214410">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2214413">return</span>&nbsp;<span class="ident" id="2214420">t</span><br>
<span class="lineno"></span><span class="op" id="2214422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2214425">//&nbsp;Replace&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;slice&nbsp;s&nbsp;with&nbsp;the&nbsp;first&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="2214483">//&nbsp;non-overlapping&nbsp;instances&nbsp;of&nbsp;old&nbsp;replaced&nbsp;by&nbsp;new.</span><br>
<span class="lineno">610</span><span class="comment" id="2214536">//&nbsp;If&nbsp;old&nbsp;is&nbsp;empty,&nbsp;it&nbsp;matches&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="2214597">//&nbsp;and&nbsp;after&nbsp;each&nbsp;UTF-8&nbsp;sequence,&nbsp;yielding&nbsp;up&nbsp;to&nbsp;k+1&nbsp;replacements</span><br>
<span class="lineno"></span><span class="comment" id="2214663">//&nbsp;for&nbsp;a&nbsp;k-rune&nbsp;slice.</span><br>
<span class="lineno"></span><span class="comment" id="2214686">//&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;there&nbsp;is&nbsp;no&nbsp;limit&nbsp;on&nbsp;the&nbsp;number&nbsp;of&nbsp;replacements.</span><br>
<span class="lineno"></span><span class="keyword" id="2214748">func</span>&nbsp;<span class="ident" id="2214753">Replace</span><span class="op" id="2214760">(</span><span class="ident" id="2214761">s</span><span class="op" id="2214762">,</span>&nbsp;<span class="ident" id="2214764">old</span><span class="op" id="2214767">,</span>&nbsp;<span class="builtinfunc" id="2214769">new</span>&nbsp;<span class="op" id="2214773">[</span><span class="op" id="2214774">]</span><span class="builtintype" id="2214775">byte</span><span class="op" id="2214779">,</span>&nbsp;<span class="ident" id="2214781">n</span>&nbsp;<span class="builtintype" id="2214783">int</span><span class="op" id="2214786">)</span>&nbsp;<span class="op" id="2214788">[</span><span class="op" id="2214789">]</span><span class="builtintype" id="2214790">byte</span>&nbsp;<span class="op" id="2214795">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2214798">m</span>&nbsp;<span class="op" id="2214800">:=</span>&nbsp;<span class="num" id="2214803">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2214806">if</span>&nbsp;<span class="ident" id="2214809">n</span>&nbsp;<span class="op" id="2214811">!=</span>&nbsp;<span class="num" id="2214814">0</span>&nbsp;<span class="op" id="2214816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2214820">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;replacements.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2214857">m</span>&nbsp;<span class="op" id="2214859">=</span>&nbsp;<span class="ident" id="2214861">Count</span><span class="op" id="2214866">(</span><span class="ident" id="2214867">s</span><span class="op" id="2214868">,</span>&nbsp;<span class="ident" id="2214870">old</span><span class="op" id="2214873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2214876">}</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2214879">if</span>&nbsp;<span class="ident" id="2214882">m</span>&nbsp;<span class="op" id="2214884">==</span>&nbsp;<span class="num" id="2214887">0</span>&nbsp;<span class="op" id="2214889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2214893">//&nbsp;Just&nbsp;return&nbsp;a&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2214918">return</span>&nbsp;<span class="builtinfunc" id="2214925">append</span><span class="op" id="2214931">(</span><span class="op" id="2214932">[</span><span class="op" id="2214933">]</span><span class="builtintype" id="2214934">byte</span><span class="op" id="2214938">(</span><span class="ident" id="2214939">nil</span><span class="op" id="2214942">)</span><span class="op" id="2214943">,</span>&nbsp;<span class="ident" id="2214945">s</span><span class="op" id="2214946">...</span><span class="op" id="2214949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2214952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2214955">if</span>&nbsp;<span class="ident" id="2214958">n</span>&nbsp;<span class="op" id="2214960">&lt;</span>&nbsp;<span class="num" id="2214962">0</span>&nbsp;<span class="op" id="2214964">||</span>&nbsp;<span class="ident" id="2214967">m</span>&nbsp;<span class="op" id="2214969">&lt;</span>&nbsp;<span class="ident" id="2214971">n</span>&nbsp;<span class="op" id="2214973">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2214977">n</span>&nbsp;<span class="op" id="2214979">=</span>&nbsp;<span class="ident" id="2214981">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2214984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2214988">//&nbsp;Apply&nbsp;replacements&nbsp;to&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2215022">t</span>&nbsp;<span class="op" id="2215024">:=</span>&nbsp;<span class="builtinfunc" id="2215027">make</span><span class="op" id="2215031">(</span><span class="op" id="2215032">[</span><span class="op" id="2215033">]</span><span class="builtintype" id="2215034">byte</span><span class="op" id="2215038">,</span>&nbsp;<span class="builtinfunc" id="2215040">len</span><span class="op" id="2215043">(</span><span class="ident" id="2215044">s</span><span class="op" id="2215045">)</span><span class="op" id="2215046">+</span><span class="ident" id="2215047">n</span><span class="op" id="2215048">*</span><span class="op" id="2215049">(</span><span class="builtinfunc" id="2215050">len</span><span class="op" id="2215053">(</span><span class="builtinfunc" id="2215054">new</span><span class="op" id="2215057">)</span><span class="op" id="2215058">-</span><span class="builtinfunc" id="2215059">len</span><span class="op" id="2215062">(</span><span class="ident" id="2215063">old</span><span class="op" id="2215066">)</span><span class="op" id="2215067">)</span><span class="op" id="2215068">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2215071">w</span>&nbsp;<span class="op" id="2215073">:=</span>&nbsp;<span class="num" id="2215076">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2215079">start</span>&nbsp;<span class="op" id="2215085">:=</span>&nbsp;<span class="num" id="2215088">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2215091">for</span>&nbsp;<span class="ident" id="2215095">i</span>&nbsp;<span class="op" id="2215097">:=</span>&nbsp;<span class="num" id="2215100">0</span><span class="op" id="2215101">;</span>&nbsp;<span class="ident" id="2215103">i</span>&nbsp;<span class="op" id="2215105">&lt;</span>&nbsp;<span class="ident" id="2215107">n</span><span class="op" id="2215108">;</span>&nbsp;<span class="ident" id="2215110">i</span><span class="op" id="2215111">++</span>&nbsp;<span class="op" id="2215114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2215118">j</span>&nbsp;<span class="op" id="2215120">:=</span>&nbsp;<span class="ident" id="2215123">start</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2215131">if</span>&nbsp;<span class="builtinfunc" id="2215134">len</span><span class="op" id="2215137">(</span><span class="ident" id="2215138">old</span><span class="op" id="2215141">)</span>&nbsp;<span class="op" id="2215143">==</span>&nbsp;<span class="num" id="2215146">0</span>&nbsp;<span class="op" id="2215148">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2215153">if</span>&nbsp;<span class="ident" id="2215156">i</span>&nbsp;<span class="op" id="2215158">&gt;</span>&nbsp;<span class="num" id="2215160">0</span>&nbsp;<span class="op" id="2215162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2215168">_</span><span class="op" id="2215169">,</span>&nbsp;<span class="ident" id="2215171">wid</span>&nbsp;<span class="op" id="2215175">:=</span>&nbsp;<span class="ident" id="2215178">utf8</span><span class="op" id="2215182">.</span><span class="ident" id="2215183">DecodeRune</span><span class="op" id="2215193">(</span><span class="ident" id="2215194">s</span><span class="op" id="2215195">[</span><span class="ident" id="2215196">start</span><span class="op" id="2215201">:</span><span class="op" id="2215202">]</span><span class="op" id="2215203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2215209">j</span>&nbsp;<span class="op" id="2215211">+=</span>&nbsp;<span class="ident" id="2215214">wid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2215221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2215225">}</span>&nbsp;<span class="keyword" id="2215227">else</span>&nbsp;<span class="op" id="2215232">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2215237">j</span>&nbsp;<span class="op" id="2215239">+=</span>&nbsp;<span class="ident" id="2215242">Index</span><span class="op" id="2215247">(</span><span class="ident" id="2215248">s</span><span class="op" id="2215249">[</span><span class="ident" id="2215250">start</span><span class="op" id="2215255">:</span><span class="op" id="2215256">]</span><span class="op" id="2215257">,</span>&nbsp;<span class="ident" id="2215259">old</span><span class="op" id="2215262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2215266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2215270">w</span>&nbsp;<span class="op" id="2215272">+=</span>&nbsp;<span class="builtinfunc" id="2215275">copy</span><span class="op" id="2215279">(</span><span class="ident" id="2215280">t</span><span class="op" id="2215281">[</span><span class="ident" id="2215282">w</span><span class="op" id="2215283">:</span><span class="op" id="2215284">]</span><span class="op" id="2215285">,</span>&nbsp;<span class="ident" id="2215287">s</span><span class="op" id="2215288">[</span><span class="ident" id="2215289">start</span><span class="op" id="2215294">:</span><span class="ident" id="2215295">j</span><span class="op" id="2215296">]</span><span class="op" id="2215297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2215301">w</span>&nbsp;<span class="op" id="2215303">+=</span>&nbsp;<span class="builtinfunc" id="2215306">copy</span><span class="op" id="2215310">(</span><span class="ident" id="2215311">t</span><span class="op" id="2215312">[</span><span class="ident" id="2215313">w</span><span class="op" id="2215314">:</span><span class="op" id="2215315">]</span><span class="op" id="2215316">,</span>&nbsp;<span class="builtinfunc" id="2215318">new</span><span class="op" id="2215321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2215325">start</span>&nbsp;<span class="op" id="2215331">=</span>&nbsp;<span class="ident" id="2215333">j</span>&nbsp;<span class="op" id="2215335">+</span>&nbsp;<span class="builtinfunc" id="2215337">len</span><span class="op" id="2215340">(</span><span class="ident" id="2215341">old</span><span class="op" id="2215344">)</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2215347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2215350">w</span>&nbsp;<span class="op" id="2215352">+=</span>&nbsp;<span class="builtinfunc" id="2215355">copy</span><span class="op" id="2215359">(</span><span class="ident" id="2215360">t</span><span class="op" id="2215361">[</span><span class="ident" id="2215362">w</span><span class="op" id="2215363">:</span><span class="op" id="2215364">]</span><span class="op" id="2215365">,</span>&nbsp;<span class="ident" id="2215367">s</span><span class="op" id="2215368">[</span><span class="ident" id="2215369">start</span><span class="op" id="2215374">:</span><span class="op" id="2215375">]</span><span class="op" id="2215376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2215379">return</span>&nbsp;<span class="ident" id="2215386">t</span><span class="op" id="2215387">[</span><span class="num" id="2215388">0</span><span class="op" id="2215389">:</span><span class="ident" id="2215390">w</span><span class="op" id="2215391">]</span><br>
<span class="lineno"></span><span class="op" id="2215393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">650</span><span class="comment" id="2215396">//&nbsp;EqualFold&nbsp;reports&nbsp;whether&nbsp;s&nbsp;and&nbsp;t,&nbsp;interpreted&nbsp;as&nbsp;UTF-8&nbsp;strings,</span><br>
<span class="lineno"></span><span class="comment" id="2215464">//&nbsp;are&nbsp;equal&nbsp;under&nbsp;Unicode&nbsp;case-folding.</span><br>
<span class="lineno"></span><span class="keyword" id="2215505">func</span>&nbsp;<span class="ident" id="2215510">EqualFold</span><span class="op" id="2215519">(</span><span class="ident" id="2215520">s</span><span class="op" id="2215521">,</span>&nbsp;<span class="ident" id="2215523">t</span>&nbsp;<span class="op" id="2215525">[</span><span class="op" id="2215526">]</span><span class="builtintype" id="2215527">byte</span><span class="op" id="2215531">)</span>&nbsp;<span class="builtintype" id="2215533">bool</span>&nbsp;<span class="op" id="2215538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2215541">for</span>&nbsp;<span class="builtinfunc" id="2215545">len</span><span class="op" id="2215548">(</span><span class="ident" id="2215549">s</span><span class="op" id="2215550">)</span>&nbsp;<span class="op" id="2215552">!=</span>&nbsp;<span class="num" id="2215555">0</span>&nbsp;<span class="op" id="2215557">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2215560">len</span><span class="op" id="2215563">(</span><span class="ident" id="2215564">t</span><span class="op" id="2215565">)</span>&nbsp;<span class="op" id="2215567">!=</span>&nbsp;<span class="num" id="2215570">0</span>&nbsp;<span class="op" id="2215572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2215576">//&nbsp;Extract&nbsp;first&nbsp;rune&nbsp;from&nbsp;each.</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2215611">var</span>&nbsp;<span class="ident" id="2215615">sr</span><span class="op" id="2215617">,</span>&nbsp;<span class="ident" id="2215619">tr</span>&nbsp;<span class="builtintype" id="2215622">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2215629">if</span>&nbsp;<span class="ident" id="2215632">s</span><span class="op" id="2215633">[</span><span class="num" id="2215634">0</span><span class="op" id="2215635">]</span>&nbsp;<span class="op" id="2215637">&lt;</span>&nbsp;<span class="ident" id="2215639">utf8</span><span class="op" id="2215643">.</span><span class="ident" id="2215644">RuneSelf</span>&nbsp;<span class="op" id="2215653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2215658">sr</span><span class="op" id="2215660">,</span>&nbsp;<span class="ident" id="2215662">s</span>&nbsp;<span class="op" id="2215664">=</span>&nbsp;<span class="builtintype" id="2215666">rune</span><span class="op" id="2215670">(</span><span class="ident" id="2215671">s</span><span class="op" id="2215672">[</span><span class="num" id="2215673">0</span><span class="op" id="2215674">]</span><span class="op" id="2215675">)</span><span class="op" id="2215676">,</span>&nbsp;<span class="ident" id="2215678">s</span><span class="op" id="2215679">[</span><span class="num" id="2215680">1</span><span class="op" id="2215681">:</span><span class="op" id="2215682">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2215686">}</span>&nbsp;<span class="keyword" id="2215688">else</span>&nbsp;<span class="op" id="2215693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2215698">r</span><span class="op" id="2215699">,</span>&nbsp;<span class="ident" id="2215701">size</span>&nbsp;<span class="op" id="2215706">:=</span>&nbsp;<span class="ident" id="2215709">utf8</span><span class="op" id="2215713">.</span><span class="ident" id="2215714">DecodeRune</span><span class="op" id="2215724">(</span><span class="ident" id="2215725">s</span><span class="op" id="2215726">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2215731">sr</span><span class="op" id="2215733">,</span>&nbsp;<span class="ident" id="2215735">s</span>&nbsp;<span class="op" id="2215737">=</span>&nbsp;<span class="ident" id="2215739">r</span><span class="op" id="2215740">,</span>&nbsp;<span class="ident" id="2215742">s</span><span class="op" id="2215743">[</span><span class="ident" id="2215744">size</span><span class="op" id="2215748">:</span><span class="op" id="2215749">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2215753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2215757">if</span>&nbsp;<span class="ident" id="2215760">t</span><span class="op" id="2215761">[</span><span class="num" id="2215762">0</span><span class="op" id="2215763">]</span>&nbsp;<span class="op" id="2215765">&lt;</span>&nbsp;<span class="ident" id="2215767">utf8</span><span class="op" id="2215771">.</span><span class="ident" id="2215772">RuneSelf</span>&nbsp;<span class="op" id="2215781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2215786">tr</span><span class="op" id="2215788">,</span>&nbsp;<span class="ident" id="2215790">t</span>&nbsp;<span class="op" id="2215792">=</span>&nbsp;<span class="builtintype" id="2215794">rune</span><span class="op" id="2215798">(</span><span class="ident" id="2215799">t</span><span class="op" id="2215800">[</span><span class="num" id="2215801">0</span><span class="op" id="2215802">]</span><span class="op" id="2215803">)</span><span class="op" id="2215804">,</span>&nbsp;<span class="ident" id="2215806">t</span><span class="op" id="2215807">[</span><span class="num" id="2215808">1</span><span class="op" id="2215809">:</span><span class="op" id="2215810">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2215814">}</span>&nbsp;<span class="keyword" id="2215816">else</span>&nbsp;<span class="op" id="2215821">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2215826">r</span><span class="op" id="2215827">,</span>&nbsp;<span class="ident" id="2215829">size</span>&nbsp;<span class="op" id="2215834">:=</span>&nbsp;<span class="ident" id="2215837">utf8</span><span class="op" id="2215841">.</span><span class="ident" id="2215842">DecodeRune</span><span class="op" id="2215852">(</span><span class="ident" id="2215853">t</span><span class="op" id="2215854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2215859">tr</span><span class="op" id="2215861">,</span>&nbsp;<span class="ident" id="2215863">t</span>&nbsp;<span class="op" id="2215865">=</span>&nbsp;<span class="ident" id="2215867">r</span><span class="op" id="2215868">,</span>&nbsp;<span class="ident" id="2215870">t</span><span class="op" id="2215871">[</span><span class="ident" id="2215872">size</span><span class="op" id="2215876">:</span><span class="op" id="2215877">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2215881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2215886">//&nbsp;If&nbsp;they&nbsp;match,&nbsp;keep&nbsp;going;&nbsp;if&nbsp;not,&nbsp;return&nbsp;false.</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2215941">//&nbsp;Easy&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2215957">if</span>&nbsp;<span class="ident" id="2215960">tr</span>&nbsp;<span class="op" id="2215963">==</span>&nbsp;<span class="ident" id="2215966">sr</span>&nbsp;<span class="op" id="2215969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2215974">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2215985">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2215990">//&nbsp;Make&nbsp;sr&nbsp;&lt;&nbsp;tr&nbsp;to&nbsp;simplify&nbsp;what&nbsp;follows.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216034">if</span>&nbsp;<span class="ident" id="2216037">tr</span>&nbsp;<span class="op" id="2216040">&lt;</span>&nbsp;<span class="ident" id="2216042">sr</span>&nbsp;<span class="op" id="2216045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2216050">tr</span><span class="op" id="2216052">,</span>&nbsp;<span class="ident" id="2216054">sr</span>&nbsp;<span class="op" id="2216057">=</span>&nbsp;<span class="ident" id="2216059">sr</span><span class="op" id="2216061">,</span>&nbsp;<span class="ident" id="2216063">tr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2216068">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2216072">//&nbsp;Fast&nbsp;check&nbsp;for&nbsp;ASCII.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216099">if</span>&nbsp;<span class="ident" id="2216102">tr</span>&nbsp;<span class="op" id="2216105">&lt;</span>&nbsp;<span class="ident" id="2216107">utf8</span><span class="op" id="2216111">.</span><span class="ident" id="2216112">RuneSelf</span>&nbsp;<span class="op" id="2216121">&amp;&amp;</span>&nbsp;<span class="string" id="2216124">&#39;A&#39;</span>&nbsp;<span class="op" id="2216128">&lt;=</span>&nbsp;<span class="ident" id="2216131">sr</span>&nbsp;<span class="op" id="2216134">&amp;&amp;</span>&nbsp;<span class="ident" id="2216137">sr</span>&nbsp;<span class="op" id="2216140">&lt;=</span>&nbsp;<span class="string" id="2216143">&#39;Z&#39;</span>&nbsp;<span class="op" id="2216147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2216152">//&nbsp;ASCII,&nbsp;and&nbsp;sr&nbsp;is&nbsp;upper&nbsp;case.&nbsp;&nbsp;tr&nbsp;must&nbsp;be&nbsp;lower&nbsp;case.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216211">if</span>&nbsp;<span class="ident" id="2216214">tr</span>&nbsp;<span class="op" id="2216217">==</span>&nbsp;<span class="ident" id="2216220">sr</span><span class="op" id="2216222">+</span><span class="string" id="2216223">&#39;a&#39;</span><span class="op" id="2216226">-</span><span class="string" id="2216227">&#39;A&#39;</span>&nbsp;<span class="op" id="2216231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216237">continue</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2216249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216254">return</span>&nbsp;<span class="builtintype" id="2216261">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2216269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2216274">//&nbsp;General&nbsp;case.&nbsp;&nbsp;SimpleFold(x)&nbsp;returns&nbsp;the&nbsp;next&nbsp;equivalent&nbsp;rune&nbsp;&gt;&nbsp;x</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2216345">//&nbsp;or&nbsp;wraps&nbsp;around&nbsp;to&nbsp;smaller&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2216385">r</span>&nbsp;<span class="op" id="2216387">:=</span>&nbsp;<span class="ident" id="2216390">unicode</span><span class="op" id="2216397">.</span><span class="ident" id="2216398">SimpleFold</span><span class="op" id="2216408">(</span><span class="ident" id="2216409">sr</span><span class="op" id="2216411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216415">for</span>&nbsp;<span class="ident" id="2216419">r</span>&nbsp;<span class="op" id="2216421">!=</span>&nbsp;<span class="ident" id="2216424">sr</span>&nbsp;<span class="op" id="2216427">&amp;&amp;</span>&nbsp;<span class="ident" id="2216430">r</span>&nbsp;<span class="op" id="2216432">&lt;</span>&nbsp;<span class="ident" id="2216434">tr</span>&nbsp;<span class="op" id="2216437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2216442">r</span>&nbsp;<span class="op" id="2216444">=</span>&nbsp;<span class="ident" id="2216446">unicode</span><span class="op" id="2216453">.</span><span class="ident" id="2216454">SimpleFold</span><span class="op" id="2216464">(</span><span class="ident" id="2216465">r</span><span class="op" id="2216466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2216470">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216474">if</span>&nbsp;<span class="ident" id="2216477">r</span>&nbsp;<span class="op" id="2216479">==</span>&nbsp;<span class="ident" id="2216482">tr</span>&nbsp;<span class="op" id="2216485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216490">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2216501">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216505">return</span>&nbsp;<span class="builtintype" id="2216512">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2216519">}</span><br>
<span class="lineno">700</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2216523">//&nbsp;One&nbsp;string&nbsp;is&nbsp;empty.&nbsp;&nbsp;Are&nbsp;both?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2216559">return</span>&nbsp;<span class="builtinfunc" id="2216566">len</span><span class="op" id="2216569">(</span><span class="ident" id="2216570">s</span><span class="op" id="2216571">)</span>&nbsp;<span class="op" id="2216573">==</span>&nbsp;<span class="builtinfunc" id="2216576">len</span><span class="op" id="2216579">(</span><span class="ident" id="2216580">t</span><span class="op" id="2216581">)</span><br>
<span class="lineno"></span><span class="op" id="2216583">}</span>
</div>
</body>
</html>
