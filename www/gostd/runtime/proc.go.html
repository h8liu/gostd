<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html" class="current">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1630040">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1630095">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1630149">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1630200">package</span>&nbsp;<span class="ident" id="1630208">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1630217">import</span>&nbsp;<span class="string" id="1630224">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1630234">func</span>&nbsp;<span class="ident" id="1630239">newsysmon</span><span class="op" id="1630248">(</span><span class="op" id="1630249">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1630252">func</span>&nbsp;<span class="ident" id="1630257">runtime_init</span><span class="op" id="1630269">(</span><span class="op" id="1630270">)</span><br>
<span class="lineno"></span><span class="keyword" id="1630272">func</span>&nbsp;<span class="ident" id="1630277">main_init</span><span class="op" id="1630286">(</span><span class="op" id="1630287">)</span><br>
<span class="lineno"></span><span class="keyword" id="1630289">func</span>&nbsp;<span class="ident" id="1630294">main_main</span><span class="op" id="1630303">(</span><span class="op" id="1630304">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="1630307">//&nbsp;The&nbsp;main&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="1630330">func</span>&nbsp;<span class="ident" id="1630335">main</span><span class="op" id="1630339">(</span><span class="op" id="1630340">)</span>&nbsp;<span class="op" id="1630342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1630345">g</span>&nbsp;<span class="op" id="1630347">:=</span>&nbsp;<span class="ident" id="1630350">getg</span><span class="op" id="1630354">(</span><span class="op" id="1630355">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1630359">//&nbsp;Racectx&nbsp;of&nbsp;m0-&gt;g0&nbsp;is&nbsp;used&nbsp;only&nbsp;as&nbsp;the&nbsp;parent&nbsp;of&nbsp;the&nbsp;main&nbsp;goroutine.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1630431">//&nbsp;It&nbsp;must&nbsp;not&nbsp;be&nbsp;used&nbsp;for&nbsp;anything&nbsp;else.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1630474">g</span><span class="op" id="1630475">.</span><span class="ident" id="1630476">m</span><span class="op" id="1630477">.</span><span class="ident" id="1630478">g0</span><span class="op" id="1630480">.</span><span class="ident" id="1630481">racectx</span>&nbsp;<span class="op" id="1630489">=</span>&nbsp;<span class="num" id="1630491">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1630495">//&nbsp;Max&nbsp;stack&nbsp;size&nbsp;is&nbsp;1&nbsp;GB&nbsp;on&nbsp;64-bit,&nbsp;250&nbsp;MB&nbsp;on&nbsp;32-bit.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1630551">//&nbsp;Using&nbsp;decimal&nbsp;instead&nbsp;of&nbsp;binary&nbsp;GB&nbsp;and&nbsp;MB&nbsp;because</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1630605">//&nbsp;they&nbsp;look&nbsp;nicer&nbsp;in&nbsp;the&nbsp;stack&nbsp;overflow&nbsp;failure&nbsp;message.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1630664">if</span>&nbsp;<span class="ident" id="1630667">ptrSize</span>&nbsp;<span class="op" id="1630675">==</span>&nbsp;<span class="num" id="1630678">8</span>&nbsp;<span class="op" id="1630680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1630684">maxstacksize</span>&nbsp;<span class="op" id="1630697">=</span>&nbsp;<span class="num" id="1630699">1000000000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1630711">}</span>&nbsp;<span class="keyword" id="1630713">else</span>&nbsp;<span class="op" id="1630718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1630722">maxstacksize</span>&nbsp;<span class="op" id="1630735">=</span>&nbsp;<span class="num" id="1630737">250000000</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1630748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1630752">onM</span><span class="op" id="1630755">(</span><span class="ident" id="1630756">newsysmon</span><span class="op" id="1630765">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1630769">//&nbsp;Lock&nbsp;the&nbsp;main&nbsp;goroutine&nbsp;onto&nbsp;this,&nbsp;the&nbsp;main&nbsp;OS&nbsp;thread,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1630828">//&nbsp;during&nbsp;initialization.&nbsp;&nbsp;Most&nbsp;programs&nbsp;won&#39;t&nbsp;care,&nbsp;but&nbsp;a&nbsp;few</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1630892">//&nbsp;do&nbsp;require&nbsp;certain&nbsp;calls&nbsp;to&nbsp;be&nbsp;made&nbsp;by&nbsp;the&nbsp;main&nbsp;thread.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1630952">//&nbsp;Those&nbsp;can&nbsp;arrange&nbsp;for&nbsp;main.main&nbsp;to&nbsp;run&nbsp;in&nbsp;the&nbsp;main&nbsp;thread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1631014">//&nbsp;by&nbsp;calling&nbsp;runtime.LockOSThread&nbsp;during&nbsp;initialization</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1631072">//&nbsp;to&nbsp;preserve&nbsp;the&nbsp;lock.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631098">lockOSThread</span><span class="op" id="1631110">(</span><span class="op" id="1631111">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1631115">if</span>&nbsp;<span class="ident" id="1631118">g</span><span class="op" id="1631119">.</span><span class="ident" id="1631120">m</span>&nbsp;<span class="op" id="1631122">!=</span>&nbsp;<span class="op" id="1631125">&amp;</span><span class="ident" id="1631126">m0</span>&nbsp;<span class="op" id="1631129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631133">gothrow</span><span class="op" id="1631140">(</span><span class="string" id="1631141">&#34;runtime.main&nbsp;not&nbsp;on&nbsp;m0&#34;</span><span class="op" id="1631165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1631168">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631172">runtime_init</span><span class="op" id="1631184">(</span><span class="op" id="1631185">)</span>&nbsp;<span class="comment" id="1631187">//&nbsp;must&nbsp;be&nbsp;before&nbsp;defer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1631213">//&nbsp;Defer&nbsp;unlock&nbsp;so&nbsp;that&nbsp;runtime.Goexit&nbsp;during&nbsp;init&nbsp;does&nbsp;the&nbsp;unlock&nbsp;too.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631286">needUnlock</span>&nbsp;<span class="op" id="1631297">:=</span>&nbsp;<span class="builtintype" id="1631300">true</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1631306">defer</span>&nbsp;<span class="keyword" id="1631312">func</span><span class="op" id="1631316">(</span><span class="op" id="1631317">)</span>&nbsp;<span class="op" id="1631319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1631323">if</span>&nbsp;<span class="ident" id="1631326">needUnlock</span>&nbsp;<span class="op" id="1631337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631342">unlockOSThread</span><span class="op" id="1631356">(</span><span class="op" id="1631357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1631361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1631364">}</span><span class="op" id="1631365">(</span><span class="op" id="1631366">)</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631370">memstats</span><span class="op" id="1631378">.</span><span class="ident" id="1631379">enablegc</span>&nbsp;<span class="op" id="1631388">=</span>&nbsp;<span class="builtintype" id="1631390">true</span>&nbsp;<span class="comment" id="1631395">//&nbsp;now&nbsp;that&nbsp;runtime&nbsp;is&nbsp;initialized,&nbsp;GC&nbsp;is&nbsp;okay</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631444">main_init</span><span class="op" id="1631453">(</span><span class="op" id="1631454">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631458">needUnlock</span>&nbsp;<span class="op" id="1631469">=</span>&nbsp;<span class="builtintype" id="1631471">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631478">unlockOSThread</span><span class="op" id="1631492">(</span><span class="op" id="1631493">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631497">main_main</span><span class="op" id="1631506">(</span><span class="op" id="1631507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1631510">if</span>&nbsp;<span class="ident" id="1631513">raceenabled</span>&nbsp;<span class="op" id="1631525">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631529">racefini</span><span class="op" id="1631537">(</span><span class="op" id="1631538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1631541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1631545">//&nbsp;Make&nbsp;racy&nbsp;client&nbsp;program&nbsp;work:&nbsp;if&nbsp;panicking&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1631596">//&nbsp;another&nbsp;goroutine&nbsp;at&nbsp;the&nbsp;same&nbsp;time&nbsp;as&nbsp;main&nbsp;returns,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1631652">//&nbsp;let&nbsp;the&nbsp;other&nbsp;goroutine&nbsp;finish&nbsp;printing&nbsp;the&nbsp;panic&nbsp;trace.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1631713">//&nbsp;Once&nbsp;it&nbsp;does,&nbsp;it&nbsp;will&nbsp;exit.&nbsp;See&nbsp;issue&nbsp;3934.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1631761">if</span>&nbsp;<span class="ident" id="1631764">panicking</span>&nbsp;<span class="op" id="1631774">!=</span>&nbsp;<span class="num" id="1631777">0</span>&nbsp;<span class="op" id="1631779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631783">gopark</span><span class="op" id="1631789">(</span><span class="builtintype" id="1631790">nil</span><span class="op" id="1631793">,</span>&nbsp;<span class="builtintype" id="1631795">nil</span><span class="op" id="1631798">,</span>&nbsp;<span class="string" id="1631800">&#34;panicwait&#34;</span><span class="op" id="1631811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1631814">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631818">exit</span><span class="op" id="1631822">(</span><span class="num" id="1631823">0</span><span class="op" id="1631824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1631827">for</span>&nbsp;<span class="op" id="1631831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1631835">var</span>&nbsp;<span class="ident" id="1631839">x</span>&nbsp;<span class="op" id="1631841">*</span><span class="builtintype" id="1631842">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1631850">*</span><span class="ident" id="1631851">x</span>&nbsp;<span class="op" id="1631853">=</span>&nbsp;<span class="num" id="1631855">0</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1631858">}</span><br>
<span class="lineno"></span><span class="op" id="1631860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1631863">var</span>&nbsp;<span class="ident" id="1631867">parkunlock_c</span>&nbsp;<span class="builtintype" id="1631880">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="1631886">//&nbsp;start&nbsp;forcegc&nbsp;helper&nbsp;goroutine</span><br>
<span class="lineno"></span><span class="keyword" id="1631920">func</span>&nbsp;<span class="ident" id="1631925">init</span><span class="op" id="1631929">(</span><span class="op" id="1631930">)</span>&nbsp;<span class="op" id="1631932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1631935">go</span>&nbsp;<span class="ident" id="1631938">forcegchelper</span><span class="op" id="1631951">(</span><span class="op" id="1631952">)</span><br>
<span class="lineno"></span><span class="op" id="1631954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="1631957">func</span>&nbsp;<span class="ident" id="1631962">forcegchelper</span><span class="op" id="1631975">(</span><span class="op" id="1631976">)</span>&nbsp;<span class="op" id="1631978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1631981">forcegc</span><span class="op" id="1631988">.</span><span class="ident" id="1631989">g</span>&nbsp;<span class="op" id="1631991">=</span>&nbsp;<span class="ident" id="1631993">getg</span><span class="op" id="1631997">(</span><span class="op" id="1631998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1632001">forcegc</span><span class="op" id="1632008">.</span><span class="ident" id="1632009">g</span><span class="op" id="1632010">.</span><span class="ident" id="1632011">issystem</span>&nbsp;<span class="op" id="1632020">=</span>&nbsp;<span class="builtintype" id="1632022">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1632028">for</span>&nbsp;<span class="op" id="1632032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1632036">lock</span><span class="op" id="1632040">(</span><span class="op" id="1632041">&amp;</span><span class="ident" id="1632042">forcegc</span><span class="op" id="1632049">.</span><span class="ident" id="1632050">lock</span><span class="op" id="1632054">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1632058">if</span>&nbsp;<span class="ident" id="1632061">forcegc</span><span class="op" id="1632068">.</span><span class="ident" id="1632069">idle</span>&nbsp;<span class="op" id="1632074">!=</span>&nbsp;<span class="num" id="1632077">0</span>&nbsp;<span class="op" id="1632079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1632084">gothrow</span><span class="op" id="1632091">(</span><span class="string" id="1632092">&#34;forcegc:&nbsp;phase&nbsp;error&#34;</span><span class="op" id="1632114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1632118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1632122">atomicstore</span><span class="op" id="1632133">(</span><span class="op" id="1632134">&amp;</span><span class="ident" id="1632135">forcegc</span><span class="op" id="1632142">.</span><span class="ident" id="1632143">idle</span><span class="op" id="1632147">,</span>&nbsp;<span class="num" id="1632149">1</span><span class="op" id="1632150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1632154">goparkunlock</span><span class="op" id="1632166">(</span><span class="op" id="1632167">&amp;</span><span class="ident" id="1632168">forcegc</span><span class="op" id="1632175">.</span><span class="ident" id="1632176">lock</span><span class="op" id="1632180">,</span>&nbsp;<span class="string" id="1632182">&#34;force&nbsp;gc&nbsp;(idle)&#34;</span><span class="op" id="1632199">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1632203">//&nbsp;this&nbsp;goroutine&nbsp;is&nbsp;explicitly&nbsp;resumed&nbsp;by&nbsp;sysmon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1632255">if</span>&nbsp;<span class="ident" id="1632258">debug</span><span class="op" id="1632263">.</span><span class="ident" id="1632264">gctrace</span>&nbsp;<span class="op" id="1632272">&gt;</span>&nbsp;<span class="num" id="1632274">0</span>&nbsp;<span class="op" id="1632276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1632281">println</span><span class="op" id="1632288">(</span><span class="string" id="1632289">&#34;GC&nbsp;forced&#34;</span><span class="op" id="1632300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1632304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1632308">gogc</span><span class="op" id="1632312">(</span><span class="num" id="1632313">1</span><span class="op" id="1632314">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1632317">}</span><br>
<span class="lineno"></span><span class="op" id="1632319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1632322">//go:nosplit</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="1632336">//&nbsp;Gosched&nbsp;yields&nbsp;the&nbsp;processor,&nbsp;allowing&nbsp;other&nbsp;goroutines&nbsp;to&nbsp;run.&nbsp;&nbsp;It&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="1632416">//&nbsp;suspend&nbsp;the&nbsp;current&nbsp;goroutine,&nbsp;so&nbsp;execution&nbsp;resumes&nbsp;automatically.</span><br>
<span class="lineno"></span><span class="keyword" id="1632486">func</span>&nbsp;<span class="ident" id="1632491">Gosched</span><span class="op" id="1632498">(</span><span class="op" id="1632499">)</span>&nbsp;<span class="op" id="1632501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1632504">mcall</span><span class="op" id="1632509">(</span><span class="ident" id="1632510">gosched_m</span><span class="op" id="1632519">)</span><br>
<span class="lineno"></span><span class="op" id="1632521">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="1632524">//&nbsp;Puts&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;into&nbsp;a&nbsp;waiting&nbsp;state&nbsp;and&nbsp;calls&nbsp;unlockf.</span><br>
<span class="lineno"></span><span class="comment" id="1632594">//&nbsp;If&nbsp;unlockf&nbsp;returns&nbsp;false,&nbsp;the&nbsp;goroutine&nbsp;is&nbsp;resumed.</span><br>
<span class="lineno"></span><span class="keyword" id="1632649">func</span>&nbsp;<span class="ident" id="1632654">gopark</span><span class="op" id="1632660">(</span><span class="ident" id="1632661">unlockf</span>&nbsp;<span class="ident" id="1632669">unsafe</span><span class="op" id="1632675">.</span><span class="ident" id="1632676">Pointer</span><span class="op" id="1632683">,</span>&nbsp;<span class="ident" id="1632685">lock</span>&nbsp;<span class="ident" id="1632690">unsafe</span><span class="op" id="1632696">.</span><span class="ident" id="1632697">Pointer</span><span class="op" id="1632704">,</span>&nbsp;<span class="ident" id="1632706">reason</span>&nbsp;<span class="builtintype" id="1632713">string</span><span class="op" id="1632719">)</span>&nbsp;<span class="op" id="1632721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1632724">mp</span>&nbsp;<span class="op" id="1632727">:=</span>&nbsp;<span class="ident" id="1632730">acquirem</span><span class="op" id="1632738">(</span><span class="op" id="1632739">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1632742">gp</span>&nbsp;<span class="op" id="1632745">:=</span>&nbsp;<span class="ident" id="1632748">mp</span><span class="op" id="1632750">.</span><span class="ident" id="1632751">curg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1632757">status</span>&nbsp;<span class="op" id="1632764">:=</span>&nbsp;<span class="ident" id="1632767">readgstatus</span><span class="op" id="1632778">(</span><span class="ident" id="1632779">gp</span><span class="op" id="1632781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1632784">if</span>&nbsp;<span class="ident" id="1632787">status</span>&nbsp;<span class="op" id="1632794">!=</span>&nbsp;<span class="ident" id="1632797">_Grunning</span>&nbsp;<span class="op" id="1632807">&amp;&amp;</span>&nbsp;<span class="ident" id="1632810">status</span>&nbsp;<span class="op" id="1632817">!=</span>&nbsp;<span class="ident" id="1632820">_Gscanrunning</span>&nbsp;<span class="op" id="1632834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1632838">gothrow</span><span class="op" id="1632845">(</span><span class="string" id="1632846">&#34;gopark:&nbsp;bad&nbsp;g&nbsp;status&#34;</span><span class="op" id="1632868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1632871">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1632874">mp</span><span class="op" id="1632876">.</span><span class="ident" id="1632877">waitlock</span>&nbsp;<span class="op" id="1632886">=</span>&nbsp;<span class="ident" id="1632888">lock</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1632894">mp</span><span class="op" id="1632896">.</span><span class="ident" id="1632897">waitunlockf</span>&nbsp;<span class="op" id="1632909">=</span>&nbsp;<span class="ident" id="1632911">unlockf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1632920">gp</span><span class="op" id="1632922">.</span><span class="ident" id="1632923">waitreason</span>&nbsp;<span class="op" id="1632934">=</span>&nbsp;<span class="ident" id="1632936">reason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1632944">releasem</span><span class="op" id="1632952">(</span><span class="ident" id="1632953">mp</span><span class="op" id="1632955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1632958">//&nbsp;can&#39;t&nbsp;do&nbsp;anything&nbsp;that&nbsp;might&nbsp;move&nbsp;the&nbsp;G&nbsp;between&nbsp;Ms&nbsp;here.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1633019">mcall</span><span class="op" id="1633024">(</span><span class="ident" id="1633025">park_m</span><span class="op" id="1633031">)</span><br>
<span class="lineno"></span><span class="op" id="1633033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1633036">//&nbsp;Puts&nbsp;the&nbsp;current&nbsp;goroutine&nbsp;into&nbsp;a&nbsp;waiting&nbsp;state&nbsp;and&nbsp;unlocks&nbsp;the&nbsp;lock.</span><br>
<span class="lineno"></span><span class="comment" id="1633109">//&nbsp;The&nbsp;goroutine&nbsp;can&nbsp;be&nbsp;made&nbsp;runnable&nbsp;again&nbsp;by&nbsp;calling&nbsp;goready(gp).</span><br>
<span class="lineno">135</span><span class="keyword" id="1633177">func</span>&nbsp;<span class="ident" id="1633182">goparkunlock</span><span class="op" id="1633194">(</span><span class="ident" id="1633195">lock</span>&nbsp;<span class="op" id="1633200">*</span><span class="ident" id="1633201">mutex</span><span class="op" id="1633206">,</span>&nbsp;<span class="ident" id="1633208">reason</span>&nbsp;<span class="builtintype" id="1633215">string</span><span class="op" id="1633221">)</span>&nbsp;<span class="op" id="1633223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1633226">gopark</span><span class="op" id="1633232">(</span><span class="ident" id="1633233">unsafe</span><span class="op" id="1633239">.</span><span class="ident" id="1633240">Pointer</span><span class="op" id="1633247">(</span><span class="op" id="1633248">&amp;</span><span class="ident" id="1633249">parkunlock_c</span><span class="op" id="1633261">)</span><span class="op" id="1633262">,</span>&nbsp;<span class="ident" id="1633264">unsafe</span><span class="op" id="1633270">.</span><span class="ident" id="1633271">Pointer</span><span class="op" id="1633278">(</span><span class="ident" id="1633279">lock</span><span class="op" id="1633283">)</span><span class="op" id="1633284">,</span>&nbsp;<span class="ident" id="1633286">reason</span><span class="op" id="1633292">)</span><br>
<span class="lineno"></span><span class="op" id="1633294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1633297">func</span>&nbsp;<span class="ident" id="1633302">goready</span><span class="op" id="1633309">(</span><span class="ident" id="1633310">gp</span>&nbsp;<span class="op" id="1633313">*</span><span class="ident" id="1633314">g</span><span class="op" id="1633315">)</span>&nbsp;<span class="op" id="1633317">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1633320">mp</span>&nbsp;<span class="op" id="1633323">:=</span>&nbsp;<span class="ident" id="1633326">acquirem</span><span class="op" id="1633334">(</span><span class="op" id="1633335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1633338">mp</span><span class="op" id="1633340">.</span><span class="ident" id="1633341">ptrarg</span><span class="op" id="1633347">[</span><span class="num" id="1633348">0</span><span class="op" id="1633349">]</span>&nbsp;<span class="op" id="1633351">=</span>&nbsp;<span class="ident" id="1633353">unsafe</span><span class="op" id="1633359">.</span><span class="ident" id="1633360">Pointer</span><span class="op" id="1633367">(</span><span class="ident" id="1633368">gp</span><span class="op" id="1633370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1633373">onM</span><span class="op" id="1633376">(</span><span class="ident" id="1633377">ready_m</span><span class="op" id="1633384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1633387">releasem</span><span class="op" id="1633395">(</span><span class="ident" id="1633396">mp</span><span class="op" id="1633398">)</span><br>
<span class="lineno"></span><span class="op" id="1633400">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="1633403">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1633416">func</span>&nbsp;<span class="ident" id="1633421">acquireSudog</span><span class="op" id="1633433">(</span><span class="op" id="1633434">)</span>&nbsp;<span class="op" id="1633436">*</span><span class="ident" id="1633437">sudog</span>&nbsp;<span class="op" id="1633443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1633446">c</span>&nbsp;<span class="op" id="1633448">:=</span>&nbsp;<span class="ident" id="1633451">gomcache</span><span class="op" id="1633459">(</span><span class="op" id="1633460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1633463">s</span>&nbsp;<span class="op" id="1633465">:=</span>&nbsp;<span class="ident" id="1633468">c</span><span class="op" id="1633469">.</span><span class="ident" id="1633470">sudogcache</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1633482">if</span>&nbsp;<span class="ident" id="1633485">s</span>&nbsp;<span class="op" id="1633487">!=</span>&nbsp;<span class="builtintype" id="1633490">nil</span>&nbsp;<span class="op" id="1633494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1633498">if</span>&nbsp;<span class="ident" id="1633501">s</span><span class="op" id="1633502">.</span><span class="ident" id="1633503">elem</span>&nbsp;<span class="op" id="1633508">!=</span>&nbsp;<span class="builtintype" id="1633511">nil</span>&nbsp;<span class="op" id="1633515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1633520">gothrow</span><span class="op" id="1633527">(</span><span class="string" id="1633528">&#34;acquireSudog:&nbsp;found&nbsp;s.elem&nbsp;!=&nbsp;nil&nbsp;in&nbsp;cache&#34;</span><span class="op" id="1633572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1633576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1633580">c</span><span class="op" id="1633581">.</span><span class="ident" id="1633582">sudogcache</span>&nbsp;<span class="op" id="1633593">=</span>&nbsp;<span class="ident" id="1633595">s</span><span class="op" id="1633596">.</span><span class="ident" id="1633597">next</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1633604">s</span><span class="op" id="1633605">.</span><span class="ident" id="1633606">next</span>&nbsp;<span class="op" id="1633611">=</span>&nbsp;<span class="builtintype" id="1633613">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1633619">return</span>&nbsp;<span class="ident" id="1633626">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1633629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1633633">//&nbsp;Delicate&nbsp;dance:&nbsp;the&nbsp;semaphore&nbsp;implementation&nbsp;calls</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1633688">//&nbsp;acquireSudog,&nbsp;acquireSudog&nbsp;calls&nbsp;new(sudog),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1633737">//&nbsp;new&nbsp;calls&nbsp;malloc,&nbsp;malloc&nbsp;can&nbsp;call&nbsp;the&nbsp;garbage&nbsp;collector,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1633798">//&nbsp;and&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;calls&nbsp;the&nbsp;semaphore&nbsp;implementation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1633863">//&nbsp;in&nbsp;stoptheworld.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1633884">//&nbsp;Break&nbsp;the&nbsp;cycle&nbsp;by&nbsp;doing&nbsp;acquirem/releasem&nbsp;around&nbsp;new(sudog).</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1633950">//&nbsp;The&nbsp;acquirem/releasem&nbsp;increments&nbsp;m.locks&nbsp;during&nbsp;new(sudog),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1634014">//&nbsp;which&nbsp;keeps&nbsp;the&nbsp;garbage&nbsp;collector&nbsp;from&nbsp;being&nbsp;invoked.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634072">mp</span>&nbsp;<span class="op" id="1634075">:=</span>&nbsp;<span class="ident" id="1634078">acquirem</span><span class="op" id="1634086">(</span><span class="op" id="1634087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634090">p</span>&nbsp;<span class="op" id="1634092">:=</span>&nbsp;<span class="builtinfunc" id="1634095">new</span><span class="op" id="1634098">(</span><span class="ident" id="1634099">sudog</span><span class="op" id="1634104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634107">releasem</span><span class="op" id="1634115">(</span><span class="ident" id="1634116">mp</span><span class="op" id="1634118">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1634121">return</span>&nbsp;<span class="ident" id="1634128">p</span><br>
<span class="lineno"></span><span class="op" id="1634130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1634133">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1634146">func</span>&nbsp;<span class="ident" id="1634151">releaseSudog</span><span class="op" id="1634163">(</span><span class="ident" id="1634164">s</span>&nbsp;<span class="op" id="1634166">*</span><span class="ident" id="1634167">sudog</span><span class="op" id="1634172">)</span>&nbsp;<span class="op" id="1634174">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1634177">if</span>&nbsp;<span class="ident" id="1634180">s</span><span class="op" id="1634181">.</span><span class="ident" id="1634182">elem</span>&nbsp;<span class="op" id="1634187">!=</span>&nbsp;<span class="builtintype" id="1634190">nil</span>&nbsp;<span class="op" id="1634194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634198">gothrow</span><span class="op" id="1634205">(</span><span class="string" id="1634206">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;elem&#34;</span><span class="op" id="1634240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1634243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1634246">if</span>&nbsp;<span class="ident" id="1634249">s</span><span class="op" id="1634250">.</span><span class="ident" id="1634251">selectdone</span>&nbsp;<span class="op" id="1634262">!=</span>&nbsp;<span class="builtintype" id="1634265">nil</span>&nbsp;<span class="op" id="1634269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634273">gothrow</span><span class="op" id="1634280">(</span><span class="string" id="1634281">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;selectdone&#34;</span><span class="op" id="1634321">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1634324">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1634327">if</span>&nbsp;<span class="ident" id="1634330">s</span><span class="op" id="1634331">.</span><span class="ident" id="1634332">next</span>&nbsp;<span class="op" id="1634337">!=</span>&nbsp;<span class="builtintype" id="1634340">nil</span>&nbsp;<span class="op" id="1634344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634348">gothrow</span><span class="op" id="1634355">(</span><span class="string" id="1634356">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;next&#34;</span><span class="op" id="1634390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1634393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1634396">if</span>&nbsp;<span class="ident" id="1634399">s</span><span class="op" id="1634400">.</span><span class="ident" id="1634401">prev</span>&nbsp;<span class="op" id="1634406">!=</span>&nbsp;<span class="builtintype" id="1634409">nil</span>&nbsp;<span class="op" id="1634413">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634417">gothrow</span><span class="op" id="1634424">(</span><span class="string" id="1634425">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;prev&#34;</span><span class="op" id="1634459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1634462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1634465">if</span>&nbsp;<span class="ident" id="1634468">s</span><span class="op" id="1634469">.</span><span class="ident" id="1634470">waitlink</span>&nbsp;<span class="op" id="1634479">!=</span>&nbsp;<span class="builtintype" id="1634482">nil</span>&nbsp;<span class="op" id="1634486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634490">gothrow</span><span class="op" id="1634497">(</span><span class="string" id="1634498">&#34;runtime:&nbsp;sudog&nbsp;with&nbsp;non-nil&nbsp;waitlink&#34;</span><span class="op" id="1634536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1634539">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634542">gp</span>&nbsp;<span class="op" id="1634545">:=</span>&nbsp;<span class="ident" id="1634548">getg</span><span class="op" id="1634552">(</span><span class="op" id="1634553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1634556">if</span>&nbsp;<span class="ident" id="1634559">gp</span><span class="op" id="1634561">.</span><span class="ident" id="1634562">param</span>&nbsp;<span class="op" id="1634568">!=</span>&nbsp;<span class="builtintype" id="1634571">nil</span>&nbsp;<span class="op" id="1634575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634579">gothrow</span><span class="op" id="1634586">(</span><span class="string" id="1634587">&#34;runtime:&nbsp;releaseSudog&nbsp;with&nbsp;non-nil&nbsp;gp.param&#34;</span><span class="op" id="1634632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1634635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634638">c</span>&nbsp;<span class="op" id="1634640">:=</span>&nbsp;<span class="ident" id="1634643">gomcache</span><span class="op" id="1634651">(</span><span class="op" id="1634652">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634655">s</span><span class="op" id="1634656">.</span><span class="ident" id="1634657">next</span>&nbsp;<span class="op" id="1634662">=</span>&nbsp;<span class="ident" id="1634664">c</span><span class="op" id="1634665">.</span><span class="ident" id="1634666">sudogcache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634678">c</span><span class="op" id="1634679">.</span><span class="ident" id="1634680">sudogcache</span>&nbsp;<span class="op" id="1634691">=</span>&nbsp;<span class="ident" id="1634693">s</span><br>
<span class="lineno"></span><span class="op" id="1634695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1634698">//&nbsp;funcPC&nbsp;returns&nbsp;the&nbsp;entry&nbsp;PC&nbsp;of&nbsp;the&nbsp;function&nbsp;f.</span><br>
<span class="lineno">200</span><span class="comment" id="1634748">//&nbsp;It&nbsp;assumes&nbsp;that&nbsp;f&nbsp;is&nbsp;a&nbsp;func&nbsp;value.&nbsp;Otherwise&nbsp;the&nbsp;behavior&nbsp;is&nbsp;undefined.</span><br>
<span class="lineno"></span><span class="comment" id="1634823">//go:nosplit</span><br>
<span class="lineno"></span><span class="keyword" id="1634836">func</span>&nbsp;<span class="ident" id="1634841">funcPC</span><span class="op" id="1634847">(</span><span class="ident" id="1634848">f</span>&nbsp;<span class="keyword" id="1634850">interface</span><span class="op" id="1634859">{</span><span class="op" id="1634860">}</span><span class="op" id="1634861">)</span>&nbsp;<span class="builtintype" id="1634863">uintptr</span>&nbsp;<span class="op" id="1634871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1634874">return</span>&nbsp;<span class="op" id="1634881">*</span><span class="op" id="1634882">*</span><span class="op" id="1634883">(</span><span class="op" id="1634884">*</span><span class="op" id="1634885">*</span><span class="builtintype" id="1634886">uintptr</span><span class="op" id="1634893">)</span><span class="op" id="1634894">(</span><span class="ident" id="1634895">add</span><span class="op" id="1634898">(</span><span class="ident" id="1634899">unsafe</span><span class="op" id="1634905">.</span><span class="ident" id="1634906">Pointer</span><span class="op" id="1634913">(</span><span class="op" id="1634914">&amp;</span><span class="ident" id="1634915">f</span><span class="op" id="1634916">)</span><span class="op" id="1634917">,</span>&nbsp;<span class="ident" id="1634919">ptrSize</span><span class="op" id="1634926">)</span><span class="op" id="1634927">)</span><br>
<span class="lineno"></span><span class="op" id="1634929">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="comment" id="1634932">//&nbsp;called&nbsp;from&nbsp;assembly</span><br>
<span class="lineno"></span><span class="keyword" id="1634956">func</span>&nbsp;<span class="ident" id="1634961">badmcall</span><span class="op" id="1634969">(</span><span class="ident" id="1634970">fn</span>&nbsp;<span class="keyword" id="1634973">func</span><span class="op" id="1634977">(</span><span class="op" id="1634978">*</span><span class="ident" id="1634979">g</span><span class="op" id="1634980">)</span><span class="op" id="1634981">)</span>&nbsp;<span class="op" id="1634983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1634986">gothrow</span><span class="op" id="1634993">(</span><span class="string" id="1634994">&#34;runtime:&nbsp;mcall&nbsp;called&nbsp;on&nbsp;m-&gt;g0&nbsp;stack&#34;</span><span class="op" id="1635032">)</span><br>
<span class="lineno"></span><span class="op" id="1635034">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span><span class="keyword" id="1635037">func</span>&nbsp;<span class="ident" id="1635042">badmcall2</span><span class="op" id="1635051">(</span><span class="ident" id="1635052">fn</span>&nbsp;<span class="keyword" id="1635055">func</span><span class="op" id="1635059">(</span><span class="op" id="1635060">*</span><span class="ident" id="1635061">g</span><span class="op" id="1635062">)</span><span class="op" id="1635063">)</span>&nbsp;<span class="op" id="1635065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635068">gothrow</span><span class="op" id="1635075">(</span><span class="string" id="1635076">&#34;runtime:&nbsp;mcall&nbsp;function&nbsp;returned&#34;</span><span class="op" id="1635110">)</span><br>
<span class="lineno"></span><span class="op" id="1635112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="1635115">func</span>&nbsp;<span class="ident" id="1635120">badreflectcall</span><span class="op" id="1635134">(</span><span class="op" id="1635135">)</span>&nbsp;<span class="op" id="1635137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1635140">panic</span><span class="op" id="1635145">(</span><span class="string" id="1635146">&#34;runtime:&nbsp;arg&nbsp;size&nbsp;to&nbsp;reflect.call&nbsp;more&nbsp;than&nbsp;1GB&#34;</span><span class="op" id="1635195">)</span><br>
<span class="lineno"></span><span class="op" id="1635197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1635200">func</span>&nbsp;<span class="ident" id="1635205">lockedOSThread</span><span class="op" id="1635219">(</span><span class="op" id="1635220">)</span>&nbsp;<span class="builtintype" id="1635222">bool</span>&nbsp;<span class="op" id="1635227">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635230">gp</span>&nbsp;<span class="op" id="1635233">:=</span>&nbsp;<span class="ident" id="1635236">getg</span><span class="op" id="1635240">(</span><span class="op" id="1635241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1635244">return</span>&nbsp;<span class="ident" id="1635251">gp</span><span class="op" id="1635253">.</span><span class="ident" id="1635254">lockedm</span>&nbsp;<span class="op" id="1635262">!=</span>&nbsp;<span class="builtintype" id="1635265">nil</span>&nbsp;<span class="op" id="1635269">&amp;&amp;</span>&nbsp;<span class="ident" id="1635272">gp</span><span class="op" id="1635274">.</span><span class="ident" id="1635275">m</span><span class="op" id="1635276">.</span><span class="ident" id="1635277">lockedg</span>&nbsp;<span class="op" id="1635285">!=</span>&nbsp;<span class="builtintype" id="1635288">nil</span><br>
<span class="lineno"></span><span class="op" id="1635292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1635295">func</span>&nbsp;<span class="ident" id="1635300">newP</span><span class="op" id="1635304">(</span><span class="op" id="1635305">)</span>&nbsp;<span class="op" id="1635307">*</span><span class="ident" id="1635308">p</span>&nbsp;<span class="op" id="1635310">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1635313">return</span>&nbsp;<span class="builtinfunc" id="1635320">new</span><span class="op" id="1635323">(</span><span class="ident" id="1635324">p</span><span class="op" id="1635325">)</span><br>
<span class="lineno"></span><span class="op" id="1635327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1635330">func</span>&nbsp;<span class="ident" id="1635335">newM</span><span class="op" id="1635339">(</span><span class="op" id="1635340">)</span>&nbsp;<span class="op" id="1635342">*</span><span class="ident" id="1635343">m</span>&nbsp;<span class="op" id="1635345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1635348">return</span>&nbsp;<span class="builtinfunc" id="1635355">new</span><span class="op" id="1635358">(</span><span class="ident" id="1635359">m</span><span class="op" id="1635360">)</span><br>
<span class="lineno">230</span><span class="op" id="1635362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1635365">func</span>&nbsp;<span class="ident" id="1635370">newG</span><span class="op" id="1635374">(</span><span class="op" id="1635375">)</span>&nbsp;<span class="op" id="1635377">*</span><span class="ident" id="1635378">g</span>&nbsp;<span class="op" id="1635380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1635383">return</span>&nbsp;<span class="builtinfunc" id="1635390">new</span><span class="op" id="1635393">(</span><span class="ident" id="1635394">g</span><span class="op" id="1635395">)</span><br>
<span class="lineno"></span><span class="op" id="1635397">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="keyword" id="1635400">func</span>&nbsp;<span class="ident" id="1635405">allgadd</span><span class="op" id="1635412">(</span><span class="ident" id="1635413">gp</span>&nbsp;<span class="op" id="1635416">*</span><span class="ident" id="1635417">g</span><span class="op" id="1635418">)</span>&nbsp;<span class="op" id="1635420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1635423">if</span>&nbsp;<span class="ident" id="1635426">readgstatus</span><span class="op" id="1635437">(</span><span class="ident" id="1635438">gp</span><span class="op" id="1635440">)</span>&nbsp;<span class="op" id="1635442">==</span>&nbsp;<span class="ident" id="1635445">_Gidle</span>&nbsp;<span class="op" id="1635452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635456">gothrow</span><span class="op" id="1635463">(</span><span class="string" id="1635464">&#34;allgadd:&nbsp;bad&nbsp;status&nbsp;Gidle&#34;</span><span class="op" id="1635491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1635494">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635498">lock</span><span class="op" id="1635502">(</span><span class="op" id="1635503">&amp;</span><span class="ident" id="1635504">allglock</span><span class="op" id="1635512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635515">allgs</span>&nbsp;<span class="op" id="1635521">=</span>&nbsp;<span class="builtinfunc" id="1635523">append</span><span class="op" id="1635529">(</span><span class="ident" id="1635530">allgs</span><span class="op" id="1635535">,</span>&nbsp;<span class="ident" id="1635537">gp</span><span class="op" id="1635539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635542">allg</span>&nbsp;<span class="op" id="1635547">=</span>&nbsp;<span class="op" id="1635549">&amp;</span><span class="ident" id="1635550">allgs</span><span class="op" id="1635555">[</span><span class="num" id="1635556">0</span><span class="op" id="1635557">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635560">allglen</span>&nbsp;<span class="op" id="1635568">=</span>&nbsp;<span class="builtintype" id="1635570">uintptr</span><span class="op" id="1635577">(</span><span class="builtinfunc" id="1635578">len</span><span class="op" id="1635581">(</span><span class="ident" id="1635582">allgs</span><span class="op" id="1635587">)</span><span class="op" id="1635588">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1635591">unlock</span><span class="op" id="1635597">(</span><span class="op" id="1635598">&amp;</span><span class="ident" id="1635599">allglock</span><span class="op" id="1635607">)</span><br>
<span class="lineno"></span><span class="op" id="1635609">}</span>
</div>
</body>
</html>
