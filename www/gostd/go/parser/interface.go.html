<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/parser</h2>
<ul>
<li><a href="/gostd/go/parser/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/go/parser/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/parser/interface.go.html" class="current">interface.go</a></li>
<li><a href="/gostd/go/parser/parser.go.html">parser.go</a></li>
<li><a href="/gostd/go/parser/parser_test.go.html">parser_test.go</a></li>
<li><a href="/gostd/go/parser/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/parser/short_test.go.html">short_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3688384">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3688439">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3688493">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3688544">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;the&nbsp;exported&nbsp;entry&nbsp;points&nbsp;for&nbsp;invoking&nbsp;the&nbsp;parser.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3688618">package</span>&nbsp;<span class="ident" id="3688626">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3688634">import</span>&nbsp;<span class="op" id="3688641">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3688644">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3688653">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3688663">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3688673">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3688685">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3688691">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3688704">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3688710">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3688727">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3688737">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="3688740">//&nbsp;If&nbsp;src&nbsp;!=&nbsp;nil,&nbsp;readSource&nbsp;converts&nbsp;src&nbsp;to&nbsp;a&nbsp;[]byte&nbsp;if&nbsp;possible;</span><br>
<span class="lineno"></span><span class="comment" id="3688807">//&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;an&nbsp;error.&nbsp;If&nbsp;src&nbsp;==&nbsp;nil,&nbsp;readSource&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3688875">//&nbsp;the&nbsp;result&nbsp;of&nbsp;reading&nbsp;the&nbsp;file&nbsp;specified&nbsp;by&nbsp;filename.</span><br>
<span class="lineno"></span><span class="comment" id="3688932">//</span><br>
<span class="lineno">25</span><span class="keyword" id="3688935">func</span>&nbsp;<span class="ident" id="3688940">readSource</span><span class="op" id="3688950">(</span><span class="ident" id="3688951">filename</span>&nbsp;<span class="builtintype" id="3688960">string</span><span class="op" id="3688966">,</span>&nbsp;<span class="ident" id="3688968">src</span>&nbsp;<span class="keyword" id="3688972">interface</span><span class="op" id="3688981">{</span><span class="op" id="3688982">}</span><span class="op" id="3688983">)</span>&nbsp;<span class="op" id="3688985">(</span><span class="op" id="3688986">[</span><span class="op" id="3688987">]</span><span class="builtintype" id="3688988">byte</span><span class="op" id="3688992">,</span>&nbsp;<span class="builtintype" id="3688994">error</span><span class="op" id="3688999">)</span>&nbsp;<span class="op" id="3689001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3689004">if</span>&nbsp;<span class="ident" id="3689007">src</span>&nbsp;<span class="op" id="3689011">!=</span>&nbsp;<span class="builtintype" id="3689014">nil</span>&nbsp;<span class="op" id="3689018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3689022">switch</span>&nbsp;<span class="ident" id="3689029">s</span>&nbsp;<span class="op" id="3689031">:=</span>&nbsp;<span class="ident" id="3689034">src</span><span class="op" id="3689037">.</span><span class="op" id="3689038">(</span><span class="keyword" id="3689039">type</span><span class="op" id="3689043">)</span>&nbsp;<span class="op" id="3689045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3689049">case</span>&nbsp;<span class="builtintype" id="3689054">string</span><span class="op" id="3689060">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3689065">return</span>&nbsp;<span class="op" id="3689072">[</span><span class="op" id="3689073">]</span><span class="builtintype" id="3689074">byte</span><span class="op" id="3689078">(</span><span class="ident" id="3689079">s</span><span class="op" id="3689080">)</span><span class="op" id="3689081">,</span>&nbsp;<span class="builtintype" id="3689083">nil</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3689089">case</span>&nbsp;<span class="op" id="3689094">[</span><span class="op" id="3689095">]</span><span class="builtintype" id="3689096">byte</span><span class="op" id="3689100">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3689105">return</span>&nbsp;<span class="ident" id="3689112">s</span><span class="op" id="3689113">,</span>&nbsp;<span class="builtintype" id="3689115">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3689121">case</span>&nbsp;<span class="op" id="3689126">*</span><span class="ident" id="3689127">bytes</span><span class="op" id="3689132">.</span><span class="ident" id="3689133">Buffer</span><span class="op" id="3689139">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3689144">//&nbsp;is&nbsp;io.Reader,&nbsp;but&nbsp;src&nbsp;is&nbsp;already&nbsp;available&nbsp;in&nbsp;[]byte&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3689208">if</span>&nbsp;<span class="ident" id="3689211">s</span>&nbsp;<span class="op" id="3689213">!=</span>&nbsp;<span class="builtintype" id="3689216">nil</span>&nbsp;<span class="op" id="3689220">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3689226">return</span>&nbsp;<span class="ident" id="3689233">s</span><span class="op" id="3689234">.</span><span class="ident" id="3689235">Bytes</span><span class="op" id="3689240">(</span><span class="op" id="3689241">)</span><span class="op" id="3689242">,</span>&nbsp;<span class="builtintype" id="3689244">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3689251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3689255">case</span>&nbsp;<span class="ident" id="3689260">io</span><span class="op" id="3689262">.</span><span class="ident" id="3689263">Reader</span><span class="op" id="3689269">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3689274">var</span>&nbsp;<span class="ident" id="3689278">buf</span>&nbsp;<span class="ident" id="3689282">bytes</span><span class="op" id="3689287">.</span><span class="ident" id="3689288">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3689298">if</span>&nbsp;<span class="ident" id="3689301">_</span><span class="op" id="3689302">,</span>&nbsp;<span class="ident" id="3689304">err</span>&nbsp;<span class="op" id="3689308">:=</span>&nbsp;<span class="ident" id="3689311">io</span><span class="op" id="3689313">.</span><span class="ident" id="3689314">Copy</span><span class="op" id="3689318">(</span><span class="op" id="3689319">&amp;</span><span class="ident" id="3689320">buf</span><span class="op" id="3689323">,</span>&nbsp;<span class="ident" id="3689325">s</span><span class="op" id="3689326">)</span><span class="op" id="3689327">;</span>&nbsp;<span class="ident" id="3689329">err</span>&nbsp;<span class="op" id="3689333">!=</span>&nbsp;<span class="builtintype" id="3689336">nil</span>&nbsp;<span class="op" id="3689340">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3689346">return</span>&nbsp;<span class="builtintype" id="3689353">nil</span><span class="op" id="3689356">,</span>&nbsp;<span class="ident" id="3689358">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3689365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3689370">return</span>&nbsp;<span class="ident" id="3689377">buf</span><span class="op" id="3689380">.</span><span class="ident" id="3689381">Bytes</span><span class="op" id="3689386">(</span><span class="op" id="3689387">)</span><span class="op" id="3689388">,</span>&nbsp;<span class="builtintype" id="3689390">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3689396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3689400">return</span>&nbsp;<span class="builtintype" id="3689407">nil</span><span class="op" id="3689410">,</span>&nbsp;<span class="ident" id="3689412">errors</span><span class="op" id="3689418">.</span><span class="ident" id="3689419">New</span><span class="op" id="3689422">(</span><span class="string" id="3689423">&#34;invalid&nbsp;source&#34;</span><span class="op" id="3689439">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3689442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3689445">return</span>&nbsp;<span class="ident" id="3689452">ioutil</span><span class="op" id="3689458">.</span><span class="ident" id="3689459">ReadFile</span><span class="op" id="3689467">(</span><span class="ident" id="3689468">filename</span><span class="op" id="3689476">)</span><br>
<span class="lineno"></span><span class="op" id="3689478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3689481">//&nbsp;A&nbsp;Mode&nbsp;value&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;flags&nbsp;(or&nbsp;0).</span><br>
<span class="lineno">50</span><span class="comment" id="3689523">//&nbsp;They&nbsp;control&nbsp;the&nbsp;amount&nbsp;of&nbsp;source&nbsp;code&nbsp;parsed&nbsp;and&nbsp;other&nbsp;optional</span><br>
<span class="lineno"></span><span class="comment" id="3689591">//&nbsp;parser&nbsp;functionality.</span><br>
<span class="lineno"></span><span class="comment" id="3689616">//</span><br>
<span class="lineno"></span><span class="keyword" id="3689619">type</span>&nbsp;<span class="ident" id="3689624">Mode</span>&nbsp;<span class="builtintype" id="3689629">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3689635">const</span>&nbsp;<span class="op" id="3689641">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3689644">PackageClauseOnly</span>&nbsp;<span class="ident" id="3689662">Mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3689679">=</span>&nbsp;<span class="num" id="3689681">1</span>&nbsp;<span class="op" id="3689683">&lt;&lt;</span>&nbsp;<span class="ident" id="3689686">iota</span>&nbsp;<span class="comment" id="3689691">//&nbsp;stop&nbsp;parsing&nbsp;after&nbsp;package&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3689729">ImportsOnly</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3689776">//&nbsp;stop&nbsp;parsing&nbsp;after&nbsp;import&nbsp;declarations</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3689819">ParseComments</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3689866">//&nbsp;parse&nbsp;comments&nbsp;and&nbsp;add&nbsp;them&nbsp;to&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3689905">Trace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3689952">//&nbsp;print&nbsp;a&nbsp;trace&nbsp;of&nbsp;parsed&nbsp;productions</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3689992">DeclarationErrors</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3690039">//&nbsp;report&nbsp;declaration&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3690069">SpuriousErrors</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3690116">//&nbsp;same&nbsp;as&nbsp;AllErrors,&nbsp;for&nbsp;backward-compatibility</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3690166">AllErrors</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3690184">=</span>&nbsp;<span class="ident" id="3690186">SpuriousErrors</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3690213">//&nbsp;report&nbsp;all&nbsp;errors&nbsp;(not&nbsp;just&nbsp;the&nbsp;first&nbsp;10&nbsp;on&nbsp;different&nbsp;lines)</span><br>
<span class="lineno"></span><span class="op" id="3690277">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3690280">//&nbsp;ParseFile&nbsp;parses&nbsp;the&nbsp;source&nbsp;code&nbsp;of&nbsp;a&nbsp;single&nbsp;Go&nbsp;source&nbsp;file&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="3690355">//&nbsp;the&nbsp;corresponding&nbsp;ast.File&nbsp;node.&nbsp;The&nbsp;source&nbsp;code&nbsp;may&nbsp;be&nbsp;provided&nbsp;via</span><br>
<span class="lineno"></span><span class="comment" id="3690427">//&nbsp;the&nbsp;filename&nbsp;of&nbsp;the&nbsp;source&nbsp;file,&nbsp;or&nbsp;via&nbsp;the&nbsp;src&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="3690489">//</span><br>
<span class="lineno"></span><span class="comment" id="3690492">//&nbsp;If&nbsp;src&nbsp;!=&nbsp;nil,&nbsp;ParseFile&nbsp;parses&nbsp;the&nbsp;source&nbsp;from&nbsp;src&nbsp;and&nbsp;the&nbsp;filename&nbsp;is</span><br>
<span class="lineno">70</span><span class="comment" id="3690567">//&nbsp;only&nbsp;used&nbsp;when&nbsp;recording&nbsp;position&nbsp;information.&nbsp;The&nbsp;type&nbsp;of&nbsp;the&nbsp;argument</span><br>
<span class="lineno"></span><span class="comment" id="3690642">//&nbsp;for&nbsp;the&nbsp;src&nbsp;parameter&nbsp;must&nbsp;be&nbsp;string,&nbsp;[]byte,&nbsp;or&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="comment" id="3690705">//&nbsp;If&nbsp;src&nbsp;==&nbsp;nil,&nbsp;ParseFile&nbsp;parses&nbsp;the&nbsp;file&nbsp;specified&nbsp;by&nbsp;filename.</span><br>
<span class="lineno"></span><span class="comment" id="3690772">//</span><br>
<span class="lineno"></span><span class="comment" id="3690775">//&nbsp;The&nbsp;mode&nbsp;parameter&nbsp;controls&nbsp;the&nbsp;amount&nbsp;of&nbsp;source&nbsp;text&nbsp;parsed&nbsp;and&nbsp;other</span><br>
<span class="lineno">75</span><span class="comment" id="3690849">//&nbsp;optional&nbsp;parser&nbsp;functionality.&nbsp;Position&nbsp;information&nbsp;is&nbsp;recorded&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3690923">//&nbsp;file&nbsp;set&nbsp;fset.</span><br>
<span class="lineno"></span><span class="comment" id="3690941">//</span><br>
<span class="lineno"></span><span class="comment" id="3690944">//&nbsp;If&nbsp;the&nbsp;source&nbsp;couldn&#39;t&nbsp;be&nbsp;read,&nbsp;the&nbsp;returned&nbsp;AST&nbsp;is&nbsp;nil&nbsp;and&nbsp;the&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="3691017">//&nbsp;indicates&nbsp;the&nbsp;specific&nbsp;failure.&nbsp;If&nbsp;the&nbsp;source&nbsp;was&nbsp;read&nbsp;but&nbsp;syntax</span><br>
<span class="lineno">80</span><span class="comment" id="3691086">//&nbsp;errors&nbsp;were&nbsp;found,&nbsp;the&nbsp;result&nbsp;is&nbsp;a&nbsp;partial&nbsp;AST&nbsp;(with&nbsp;ast.Bad*&nbsp;nodes</span><br>
<span class="lineno"></span><span class="comment" id="3691157">//&nbsp;representing&nbsp;the&nbsp;fragments&nbsp;of&nbsp;erroneous&nbsp;source&nbsp;code).&nbsp;Multiple&nbsp;errors</span><br>
<span class="lineno"></span><span class="comment" id="3691230">//&nbsp;are&nbsp;returned&nbsp;via&nbsp;a&nbsp;scanner.ErrorList&nbsp;which&nbsp;is&nbsp;sorted&nbsp;by&nbsp;file&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="3691304">//</span><br>
<span class="lineno"></span><span class="keyword" id="3691307">func</span>&nbsp;<span class="ident" id="3691312">ParseFile</span><span class="op" id="3691321">(</span><span class="ident" id="3691322">fset</span>&nbsp;<span class="op" id="3691327">*</span><span class="ident" id="3691328">token</span><span class="op" id="3691333">.</span><span class="ident" id="3691334">FileSet</span><span class="op" id="3691341">,</span>&nbsp;<span class="ident" id="3691343">filename</span>&nbsp;<span class="builtintype" id="3691352">string</span><span class="op" id="3691358">,</span>&nbsp;<span class="ident" id="3691360">src</span>&nbsp;<span class="keyword" id="3691364">interface</span><span class="op" id="3691373">{</span><span class="op" id="3691374">}</span><span class="op" id="3691375">,</span>&nbsp;<span class="ident" id="3691377">mode</span>&nbsp;<span class="ident" id="3691382">Mode</span><span class="op" id="3691386">)</span>&nbsp;<span class="op" id="3691388">(</span><span class="ident" id="3691389">f</span>&nbsp;<span class="op" id="3691391">*</span><span class="ident" id="3691392">ast</span><span class="op" id="3691395">.</span><span class="ident" id="3691396">File</span><span class="op" id="3691400">,</span>&nbsp;<span class="ident" id="3691402">err</span>&nbsp;<span class="builtintype" id="3691406">error</span><span class="op" id="3691411">)</span>&nbsp;<span class="op" id="3691413">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3691416">//&nbsp;get&nbsp;source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3691431">text</span><span class="op" id="3691435">,</span>&nbsp;<span class="ident" id="3691437">err</span>&nbsp;<span class="op" id="3691441">:=</span>&nbsp;<span class="ident" id="3691444">readSource</span><span class="op" id="3691454">(</span><span class="ident" id="3691455">filename</span><span class="op" id="3691463">,</span>&nbsp;<span class="ident" id="3691465">src</span><span class="op" id="3691468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3691471">if</span>&nbsp;<span class="ident" id="3691474">err</span>&nbsp;<span class="op" id="3691478">!=</span>&nbsp;<span class="builtintype" id="3691481">nil</span>&nbsp;<span class="op" id="3691485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3691489">return</span>&nbsp;<span class="builtintype" id="3691496">nil</span><span class="op" id="3691499">,</span>&nbsp;<span class="ident" id="3691501">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3691506">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3691510">var</span>&nbsp;<span class="ident" id="3691514">p</span>&nbsp;<span class="ident" id="3691516">parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3691524">defer</span>&nbsp;<span class="keyword" id="3691530">func</span><span class="op" id="3691534">(</span><span class="op" id="3691535">)</span>&nbsp;<span class="op" id="3691537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3691541">if</span>&nbsp;<span class="ident" id="3691544">e</span>&nbsp;<span class="op" id="3691546">:=</span>&nbsp;<span class="builtinfunc" id="3691549">recover</span><span class="op" id="3691556">(</span><span class="op" id="3691557">)</span><span class="op" id="3691558">;</span>&nbsp;<span class="ident" id="3691560">e</span>&nbsp;<span class="op" id="3691562">!=</span>&nbsp;<span class="builtintype" id="3691565">nil</span>&nbsp;<span class="op" id="3691569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3691574">_</span>&nbsp;<span class="op" id="3691576">=</span>&nbsp;<span class="ident" id="3691578">e</span><span class="op" id="3691579">.</span><span class="op" id="3691580">(</span><span class="ident" id="3691581">bailout</span><span class="op" id="3691588">)</span>&nbsp;<span class="comment" id="3691590">//&nbsp;re-panics&nbsp;if&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;bailout</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3691627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3691632">//&nbsp;set&nbsp;result&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3691655">if</span>&nbsp;<span class="ident" id="3691658">f</span>&nbsp;<span class="op" id="3691660">==</span>&nbsp;<span class="builtintype" id="3691663">nil</span>&nbsp;<span class="op" id="3691667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3691672">//&nbsp;source&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;Go&nbsp;source&nbsp;file&nbsp;-&nbsp;satisfy</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3691725">//&nbsp;ParseFile&nbsp;API&nbsp;and&nbsp;return&nbsp;a&nbsp;valid&nbsp;(but)&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3691776">//&nbsp;*ast.File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3691792">f</span>&nbsp;<span class="op" id="3691794">=</span>&nbsp;<span class="op" id="3691796">&amp;</span><span class="ident" id="3691797">ast</span><span class="op" id="3691800">.</span><span class="ident" id="3691801">File</span><span class="op" id="3691805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3691811">Name</span><span class="op" id="3691815">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="3691818">new</span><span class="op" id="3691821">(</span><span class="ident" id="3691822">ast</span><span class="op" id="3691825">.</span><span class="ident" id="3691826">Ident</span><span class="op" id="3691831">)</span><span class="op" id="3691832">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3691838">Scope</span><span class="op" id="3691843">:</span>&nbsp;<span class="ident" id="3691845">ast</span><span class="op" id="3691848">.</span><span class="ident" id="3691849">NewScope</span><span class="op" id="3691857">(</span><span class="builtintype" id="3691858">nil</span><span class="op" id="3691861">)</span><span class="op" id="3691862">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3691867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3691871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3691876">p</span><span class="op" id="3691877">.</span><span class="ident" id="3691878">errors</span><span class="op" id="3691884">.</span><span class="ident" id="3691885">Sort</span><span class="op" id="3691889">(</span><span class="op" id="3691890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3691894">err</span>&nbsp;<span class="op" id="3691898">=</span>&nbsp;<span class="ident" id="3691900">p</span><span class="op" id="3691901">.</span><span class="ident" id="3691902">errors</span><span class="op" id="3691908">.</span><span class="ident" id="3691909">Err</span><span class="op" id="3691912">(</span><span class="op" id="3691913">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3691916">}</span><span class="op" id="3691917">(</span><span class="op" id="3691918">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3691922">//&nbsp;parse&nbsp;source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3691939">p</span><span class="op" id="3691940">.</span><span class="ident" id="3691941">init</span><span class="op" id="3691945">(</span><span class="ident" id="3691946">fset</span><span class="op" id="3691950">,</span>&nbsp;<span class="ident" id="3691952">filename</span><span class="op" id="3691960">,</span>&nbsp;<span class="ident" id="3691962">text</span><span class="op" id="3691966">,</span>&nbsp;<span class="ident" id="3691968">mode</span><span class="op" id="3691972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3691975">f</span>&nbsp;<span class="op" id="3691977">=</span>&nbsp;<span class="ident" id="3691979">p</span><span class="op" id="3691980">.</span><span class="ident" id="3691981">parseFile</span><span class="op" id="3691990">(</span><span class="op" id="3691991">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3691995">return</span><br>
<span class="lineno"></span><span class="op" id="3692002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3692005">//&nbsp;ParseDir&nbsp;calls&nbsp;ParseFile&nbsp;for&nbsp;all&nbsp;files&nbsp;with&nbsp;names&nbsp;ending&nbsp;in&nbsp;&#34;.go&#34;&nbsp;in&nbsp;the</span><br>
<span class="lineno">120</span><span class="comment" id="3692081">//&nbsp;directory&nbsp;specified&nbsp;by&nbsp;path&nbsp;and&nbsp;returns&nbsp;a&nbsp;map&nbsp;of&nbsp;package&nbsp;name&nbsp;-&gt;&nbsp;package</span><br>
<span class="lineno"></span><span class="comment" id="3692157">//&nbsp;AST&nbsp;with&nbsp;all&nbsp;the&nbsp;packages&nbsp;found.</span><br>
<span class="lineno"></span><span class="comment" id="3692193">//</span><br>
<span class="lineno"></span><span class="comment" id="3692196">//&nbsp;If&nbsp;filter&nbsp;!=&nbsp;nil,&nbsp;only&nbsp;the&nbsp;files&nbsp;with&nbsp;os.FileInfo&nbsp;entries&nbsp;passing&nbsp;through</span><br>
<span class="lineno"></span><span class="comment" id="3692273">//&nbsp;the&nbsp;filter&nbsp;(and&nbsp;ending&nbsp;in&nbsp;&#34;.go&#34;)&nbsp;are&nbsp;considered.&nbsp;The&nbsp;mode&nbsp;bits&nbsp;are&nbsp;passed</span><br>
<span class="lineno">125</span><span class="comment" id="3692350">//&nbsp;to&nbsp;ParseFile&nbsp;unchanged.&nbsp;Position&nbsp;information&nbsp;is&nbsp;recorded&nbsp;in&nbsp;fset.</span><br>
<span class="lineno"></span><span class="comment" id="3692419">//</span><br>
<span class="lineno"></span><span class="comment" id="3692422">//&nbsp;If&nbsp;the&nbsp;directory&nbsp;couldn&#39;t&nbsp;be&nbsp;read,&nbsp;a&nbsp;nil&nbsp;map&nbsp;and&nbsp;the&nbsp;respective&nbsp;error&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3692499">//&nbsp;returned.&nbsp;If&nbsp;a&nbsp;parse&nbsp;error&nbsp;occurred,&nbsp;a&nbsp;non-nil&nbsp;but&nbsp;incomplete&nbsp;map&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3692576">//&nbsp;first&nbsp;error&nbsp;encountered&nbsp;are&nbsp;returned.</span><br>
<span class="lineno">130</span><span class="comment" id="3692617">//</span><br>
<span class="lineno"></span><span class="keyword" id="3692620">func</span>&nbsp;<span class="ident" id="3692625">ParseDir</span><span class="op" id="3692633">(</span><span class="ident" id="3692634">fset</span>&nbsp;<span class="op" id="3692639">*</span><span class="ident" id="3692640">token</span><span class="op" id="3692645">.</span><span class="ident" id="3692646">FileSet</span><span class="op" id="3692653">,</span>&nbsp;<span class="ident" id="3692655">path</span>&nbsp;<span class="builtintype" id="3692660">string</span><span class="op" id="3692666">,</span>&nbsp;<span class="ident" id="3692668">filter</span>&nbsp;<span class="keyword" id="3692675">func</span><span class="op" id="3692679">(</span><span class="ident" id="3692680">os</span><span class="op" id="3692682">.</span><span class="ident" id="3692683">FileInfo</span><span class="op" id="3692691">)</span>&nbsp;<span class="builtintype" id="3692693">bool</span><span class="op" id="3692697">,</span>&nbsp;<span class="ident" id="3692699">mode</span>&nbsp;<span class="ident" id="3692704">Mode</span><span class="op" id="3692708">)</span>&nbsp;<span class="op" id="3692710">(</span><span class="ident" id="3692711">pkgs</span>&nbsp;<span class="keyword" id="3692716">map</span><span class="op" id="3692719">[</span><span class="builtintype" id="3692720">string</span><span class="op" id="3692726">]</span><span class="op" id="3692727">*</span><span class="ident" id="3692728">ast</span><span class="op" id="3692731">.</span><span class="ident" id="3692732">Package</span><span class="op" id="3692739">,</span>&nbsp;<span class="ident" id="3692741">first</span>&nbsp;<span class="builtintype" id="3692747">error</span><span class="op" id="3692752">)</span>&nbsp;<span class="op" id="3692754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3692757">fd</span><span class="op" id="3692759">,</span>&nbsp;<span class="ident" id="3692761">err</span>&nbsp;<span class="op" id="3692765">:=</span>&nbsp;<span class="ident" id="3692768">os</span><span class="op" id="3692770">.</span><span class="ident" id="3692771">Open</span><span class="op" id="3692775">(</span><span class="ident" id="3692776">path</span><span class="op" id="3692780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3692783">if</span>&nbsp;<span class="ident" id="3692786">err</span>&nbsp;<span class="op" id="3692790">!=</span>&nbsp;<span class="builtintype" id="3692793">nil</span>&nbsp;<span class="op" id="3692797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3692801">return</span>&nbsp;<span class="builtintype" id="3692808">nil</span><span class="op" id="3692811">,</span>&nbsp;<span class="ident" id="3692813">err</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3692818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3692821">defer</span>&nbsp;<span class="ident" id="3692827">fd</span><span class="op" id="3692829">.</span><span class="ident" id="3692830">Close</span><span class="op" id="3692835">(</span><span class="op" id="3692836">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3692840">list</span><span class="op" id="3692844">,</span>&nbsp;<span class="ident" id="3692846">err</span>&nbsp;<span class="op" id="3692850">:=</span>&nbsp;<span class="ident" id="3692853">fd</span><span class="op" id="3692855">.</span><span class="ident" id="3692856">Readdir</span><span class="op" id="3692863">(</span><span class="op" id="3692864">-</span><span class="num" id="3692865">1</span><span class="op" id="3692866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3692869">if</span>&nbsp;<span class="ident" id="3692872">err</span>&nbsp;<span class="op" id="3692876">!=</span>&nbsp;<span class="builtintype" id="3692879">nil</span>&nbsp;<span class="op" id="3692883">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3692887">return</span>&nbsp;<span class="builtintype" id="3692894">nil</span><span class="op" id="3692897">,</span>&nbsp;<span class="ident" id="3692899">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3692904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3692908">pkgs</span>&nbsp;<span class="op" id="3692913">=</span>&nbsp;<span class="builtinfunc" id="3692915">make</span><span class="op" id="3692919">(</span><span class="keyword" id="3692920">map</span><span class="op" id="3692923">[</span><span class="builtintype" id="3692924">string</span><span class="op" id="3692930">]</span><span class="op" id="3692931">*</span><span class="ident" id="3692932">ast</span><span class="op" id="3692935">.</span><span class="ident" id="3692936">Package</span><span class="op" id="3692943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3692946">for</span>&nbsp;<span class="ident" id="3692950">_</span><span class="op" id="3692951">,</span>&nbsp;<span class="ident" id="3692953">d</span>&nbsp;<span class="op" id="3692955">:=</span>&nbsp;<span class="keyword" id="3692958">range</span>&nbsp;<span class="ident" id="3692964">list</span>&nbsp;<span class="op" id="3692969">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3692973">if</span>&nbsp;<span class="ident" id="3692976">strings</span><span class="op" id="3692983">.</span><span class="ident" id="3692984">HasSuffix</span><span class="op" id="3692993">(</span><span class="ident" id="3692994">d</span><span class="op" id="3692995">.</span><span class="ident" id="3692996">Name</span><span class="op" id="3693000">(</span><span class="op" id="3693001">)</span><span class="op" id="3693002">,</span>&nbsp;<span class="string" id="3693004">&#34;.go&#34;</span><span class="op" id="3693009">)</span>&nbsp;<span class="op" id="3693011">&amp;&amp;</span>&nbsp;<span class="op" id="3693014">(</span><span class="ident" id="3693015">filter</span>&nbsp;<span class="op" id="3693022">==</span>&nbsp;<span class="builtintype" id="3693025">nil</span>&nbsp;<span class="op" id="3693029">||</span>&nbsp;<span class="ident" id="3693032">filter</span><span class="op" id="3693038">(</span><span class="ident" id="3693039">d</span><span class="op" id="3693040">)</span><span class="op" id="3693041">)</span>&nbsp;<span class="op" id="3693043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3693048">filename</span>&nbsp;<span class="op" id="3693057">:=</span>&nbsp;<span class="ident" id="3693060">filepath</span><span class="op" id="3693068">.</span><span class="ident" id="3693069">Join</span><span class="op" id="3693073">(</span><span class="ident" id="3693074">path</span><span class="op" id="3693078">,</span>&nbsp;<span class="ident" id="3693080">d</span><span class="op" id="3693081">.</span><span class="ident" id="3693082">Name</span><span class="op" id="3693086">(</span><span class="op" id="3693087">)</span><span class="op" id="3693088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3693093">if</span>&nbsp;<span class="ident" id="3693096">src</span><span class="op" id="3693099">,</span>&nbsp;<span class="ident" id="3693101">err</span>&nbsp;<span class="op" id="3693105">:=</span>&nbsp;<span class="ident" id="3693108">ParseFile</span><span class="op" id="3693117">(</span><span class="ident" id="3693118">fset</span><span class="op" id="3693122">,</span>&nbsp;<span class="ident" id="3693124">filename</span><span class="op" id="3693132">,</span>&nbsp;<span class="builtintype" id="3693134">nil</span><span class="op" id="3693137">,</span>&nbsp;<span class="ident" id="3693139">mode</span><span class="op" id="3693143">)</span><span class="op" id="3693144">;</span>&nbsp;<span class="ident" id="3693146">err</span>&nbsp;<span class="op" id="3693150">==</span>&nbsp;<span class="builtintype" id="3693153">nil</span>&nbsp;<span class="op" id="3693157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3693163">name</span>&nbsp;<span class="op" id="3693168">:=</span>&nbsp;<span class="ident" id="3693171">src</span><span class="op" id="3693174">.</span><span class="ident" id="3693175">Name</span><span class="op" id="3693179">.</span><span class="ident" id="3693180">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3693189">pkg</span><span class="op" id="3693192">,</span>&nbsp;<span class="ident" id="3693194">found</span>&nbsp;<span class="op" id="3693200">:=</span>&nbsp;<span class="ident" id="3693203">pkgs</span><span class="op" id="3693207">[</span><span class="ident" id="3693208">name</span><span class="op" id="3693212">]</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3693218">if</span>&nbsp;<span class="op" id="3693221">!</span><span class="ident" id="3693222">found</span>&nbsp;<span class="op" id="3693228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3693235">pkg</span>&nbsp;<span class="op" id="3693239">=</span>&nbsp;<span class="op" id="3693241">&amp;</span><span class="ident" id="3693242">ast</span><span class="op" id="3693245">.</span><span class="ident" id="3693246">Package</span><span class="op" id="3693253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3693261">Name</span><span class="op" id="3693265">:</span>&nbsp;&nbsp;<span class="ident" id="3693268">name</span><span class="op" id="3693272">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3693280">Files</span><span class="op" id="3693285">:</span>&nbsp;<span class="builtinfunc" id="3693287">make</span><span class="op" id="3693291">(</span><span class="keyword" id="3693292">map</span><span class="op" id="3693295">[</span><span class="builtintype" id="3693296">string</span><span class="op" id="3693302">]</span><span class="op" id="3693303">*</span><span class="ident" id="3693304">ast</span><span class="op" id="3693307">.</span><span class="ident" id="3693308">File</span><span class="op" id="3693312">)</span><span class="op" id="3693313">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3693320">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3693327">pkgs</span><span class="op" id="3693331">[</span><span class="ident" id="3693332">name</span><span class="op" id="3693336">]</span>&nbsp;<span class="op" id="3693338">=</span>&nbsp;<span class="ident" id="3693340">pkg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3693348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3693354">pkg</span><span class="op" id="3693357">.</span><span class="ident" id="3693358">Files</span><span class="op" id="3693363">[</span><span class="ident" id="3693364">filename</span><span class="op" id="3693372">]</span>&nbsp;<span class="op" id="3693374">=</span>&nbsp;<span class="ident" id="3693376">src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3693383">}</span>&nbsp;<span class="keyword" id="3693385">else</span>&nbsp;<span class="keyword" id="3693390">if</span>&nbsp;<span class="ident" id="3693393">first</span>&nbsp;<span class="op" id="3693399">==</span>&nbsp;<span class="builtintype" id="3693402">nil</span>&nbsp;<span class="op" id="3693406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3693412">first</span>&nbsp;<span class="op" id="3693418">=</span>&nbsp;<span class="ident" id="3693420">err</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3693427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3693431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3693434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3693438">return</span><br>
<span class="lineno">165</span><span class="op" id="3693445">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3693448">//&nbsp;ParseExpr&nbsp;is&nbsp;a&nbsp;convenience&nbsp;function&nbsp;for&nbsp;obtaining&nbsp;the&nbsp;AST&nbsp;of&nbsp;an&nbsp;expression&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="3693529">//&nbsp;The&nbsp;position&nbsp;information&nbsp;recorded&nbsp;in&nbsp;the&nbsp;AST&nbsp;is&nbsp;undefined.&nbsp;The&nbsp;filename&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3693609">//&nbsp;in&nbsp;error&nbsp;messages&nbsp;is&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno">170</span><span class="comment" id="3693651">//</span><br>
<span class="lineno"></span><span class="keyword" id="3693654">func</span>&nbsp;<span class="ident" id="3693659">ParseExpr</span><span class="op" id="3693668">(</span><span class="ident" id="3693669">x</span>&nbsp;<span class="builtintype" id="3693671">string</span><span class="op" id="3693677">)</span>&nbsp;<span class="op" id="3693679">(</span><span class="ident" id="3693680">ast</span><span class="op" id="3693683">.</span><span class="ident" id="3693684">Expr</span><span class="op" id="3693688">,</span>&nbsp;<span class="builtintype" id="3693690">error</span><span class="op" id="3693695">)</span>&nbsp;<span class="op" id="3693697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3693700">var</span>&nbsp;<span class="ident" id="3693704">p</span>&nbsp;<span class="ident" id="3693706">parser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3693714">p</span><span class="op" id="3693715">.</span><span class="ident" id="3693716">init</span><span class="op" id="3693720">(</span><span class="ident" id="3693721">token</span><span class="op" id="3693726">.</span><span class="ident" id="3693727">NewFileSet</span><span class="op" id="3693737">(</span><span class="op" id="3693738">)</span><span class="op" id="3693739">,</span>&nbsp;<span class="string" id="3693741">&#34;&#34;</span><span class="op" id="3693743">,</span>&nbsp;<span class="op" id="3693745">[</span><span class="op" id="3693746">]</span><span class="builtintype" id="3693747">byte</span><span class="op" id="3693751">(</span><span class="ident" id="3693752">x</span><span class="op" id="3693753">)</span><span class="op" id="3693754">,</span>&nbsp;<span class="num" id="3693756">0</span><span class="op" id="3693757">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3693761">//&nbsp;Set&nbsp;up&nbsp;pkg-level&nbsp;scopes&nbsp;to&nbsp;avoid&nbsp;nil-pointer&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3693818">//&nbsp;This&nbsp;is&nbsp;not&nbsp;needed&nbsp;for&nbsp;a&nbsp;correct&nbsp;expression&nbsp;x&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3693875">//&nbsp;parser&nbsp;will&nbsp;be&nbsp;ok&nbsp;with&nbsp;a&nbsp;nil&nbsp;topScope,&nbsp;but&nbsp;be&nbsp;cautious</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3693934">//&nbsp;in&nbsp;case&nbsp;of&nbsp;an&nbsp;erroneous&nbsp;x.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3693965">p</span><span class="op" id="3693966">.</span><span class="ident" id="3693967">openScope</span><span class="op" id="3693976">(</span><span class="op" id="3693977">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3693980">p</span><span class="op" id="3693981">.</span><span class="ident" id="3693982">pkgScope</span>&nbsp;<span class="op" id="3693991">=</span>&nbsp;<span class="ident" id="3693993">p</span><span class="op" id="3693994">.</span><span class="ident" id="3693995">topScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3694005">e</span>&nbsp;<span class="op" id="3694007">:=</span>&nbsp;<span class="ident" id="3694010">p</span><span class="op" id="3694011">.</span><span class="ident" id="3694012">parseRhsOrType</span><span class="op" id="3694026">(</span><span class="op" id="3694027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3694030">p</span><span class="op" id="3694031">.</span><span class="ident" id="3694032">closeScope</span><span class="op" id="3694042">(</span><span class="op" id="3694043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3694046">assert</span><span class="op" id="3694052">(</span><span class="ident" id="3694053">p</span><span class="op" id="3694054">.</span><span class="ident" id="3694055">topScope</span>&nbsp;<span class="op" id="3694064">==</span>&nbsp;<span class="builtintype" id="3694067">nil</span><span class="op" id="3694070">,</span>&nbsp;<span class="string" id="3694072">&#34;unbalanced&nbsp;scopes&#34;</span><span class="op" id="3694091">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3694095">//&nbsp;If&nbsp;a&nbsp;semicolon&nbsp;was&nbsp;inserted,&nbsp;consume&nbsp;it;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3694140">//&nbsp;report&nbsp;an&nbsp;error&nbsp;if&nbsp;there&#39;s&nbsp;more&nbsp;tokens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3694184">if</span>&nbsp;<span class="ident" id="3694187">p</span><span class="op" id="3694188">.</span><span class="ident" id="3694189">tok</span>&nbsp;<span class="op" id="3694193">==</span>&nbsp;<span class="ident" id="3694196">token</span><span class="op" id="3694201">.</span><span class="ident" id="3694202">SEMICOLON</span>&nbsp;<span class="op" id="3694212">&amp;&amp;</span>&nbsp;<span class="ident" id="3694215">p</span><span class="op" id="3694216">.</span><span class="ident" id="3694217">lit</span>&nbsp;<span class="op" id="3694221">==</span>&nbsp;<span class="string" id="3694224">&#34;\n&#34;</span>&nbsp;<span class="op" id="3694229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3694233">p</span><span class="op" id="3694234">.</span><span class="ident" id="3694235">next</span><span class="op" id="3694239">(</span><span class="op" id="3694240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3694243">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3694246">p</span><span class="op" id="3694247">.</span><span class="ident" id="3694248">expect</span><span class="op" id="3694254">(</span><span class="ident" id="3694255">token</span><span class="op" id="3694260">.</span><span class="ident" id="3694261">EOF</span><span class="op" id="3694264">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3694268">if</span>&nbsp;<span class="ident" id="3694271">p</span><span class="op" id="3694272">.</span><span class="ident" id="3694273">errors</span><span class="op" id="3694279">.</span><span class="ident" id="3694280">Len</span><span class="op" id="3694283">(</span><span class="op" id="3694284">)</span>&nbsp;<span class="op" id="3694286">&gt;</span>&nbsp;<span class="num" id="3694288">0</span>&nbsp;<span class="op" id="3694290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3694294">p</span><span class="op" id="3694295">.</span><span class="ident" id="3694296">errors</span><span class="op" id="3694302">.</span><span class="ident" id="3694303">Sort</span><span class="op" id="3694307">(</span><span class="op" id="3694308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3694312">return</span>&nbsp;<span class="builtintype" id="3694319">nil</span><span class="op" id="3694322">,</span>&nbsp;<span class="ident" id="3694324">p</span><span class="op" id="3694325">.</span><span class="ident" id="3694326">errors</span><span class="op" id="3694332">.</span><span class="ident" id="3694333">Err</span><span class="op" id="3694336">(</span><span class="op" id="3694337">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3694340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3694344">return</span>&nbsp;<span class="ident" id="3694351">e</span><span class="op" id="3694352">,</span>&nbsp;<span class="builtintype" id="3694354">nil</span><br>
<span class="lineno"></span><span class="op" id="3694358">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
