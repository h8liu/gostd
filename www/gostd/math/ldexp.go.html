<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1604454">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1604509">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1604563">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1604614">package</span>&nbsp;<span class="ident" id="1604622">math</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1604628">//&nbsp;Ldexp&nbsp;is&nbsp;the&nbsp;inverse&nbsp;of&nbsp;Frexp.</span><br>
<span class="lineno"></span><span class="comment" id="1604662">//&nbsp;It&nbsp;returns&nbsp;frac&nbsp;×&nbsp;2**exp.</span><br>
<span class="lineno"></span><span class="comment" id="1604692">//</span><br>
<span class="lineno">10</span><span class="comment" id="1604695">//&nbsp;Special&nbsp;cases&nbsp;are:</span><br>
<span class="lineno"></span><span class="comment" id="1604717">//&nbsp;&nbsp;&nbsp;&nbspLdexp(±0,&nbsp;exp)&nbsp;=&nbsp;±0</span><br>
<span class="lineno"></span><span class="comment" id="1604742">//&nbsp;&nbsp;&nbsp;&nbspLdexp(±Inf,&nbsp;exp)&nbsp;=&nbsp;±Inf</span><br>
<span class="lineno"></span><span class="comment" id="1604771">//&nbsp;&nbsp;&nbsp;&nbspLdexp(NaN,&nbsp;exp)&nbsp;=&nbsp;NaN</span><br>
<span class="lineno"></span><span class="keyword" id="1604796">func</span>&nbsp;<span class="ident" id="1604801">Ldexp</span><span class="op" id="1604806">(</span><span class="ident" id="1604807">frac</span>&nbsp;<span class="builtintype" id="1604812">float64</span><span class="op" id="1604819">,</span>&nbsp;<span class="ident" id="1604821">exp</span>&nbsp;<span class="builtintype" id="1604825">int</span><span class="op" id="1604828">)</span>&nbsp;<span class="builtintype" id="1604830">float64</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="1604839">func</span>&nbsp;<span class="ident" id="1604844">ldexp</span><span class="op" id="1604849">(</span><span class="ident" id="1604850">frac</span>&nbsp;<span class="builtintype" id="1604855">float64</span><span class="op" id="1604862">,</span>&nbsp;<span class="ident" id="1604864">exp</span>&nbsp;<span class="builtintype" id="1604868">int</span><span class="op" id="1604871">)</span>&nbsp;<span class="builtintype" id="1604873">float64</span>&nbsp;<span class="op" id="1604881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1604884">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1604902">switch</span>&nbsp;<span class="op" id="1604909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1604912">case</span>&nbsp;<span class="ident" id="1604917">frac</span>&nbsp;<span class="op" id="1604922">==</span>&nbsp;<span class="num" id="1604925">0</span><span class="op" id="1604926">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1604930">return</span>&nbsp;<span class="ident" id="1604937">frac</span>&nbsp;<span class="comment" id="1604942">//&nbsp;correctly&nbsp;return&nbsp;-0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1604966">case</span>&nbsp;<span class="ident" id="1604971">IsInf</span><span class="op" id="1604976">(</span><span class="ident" id="1604977">frac</span><span class="op" id="1604981">,</span>&nbsp;<span class="num" id="1604983">0</span><span class="op" id="1604984">)</span>&nbsp;<span class="op" id="1604986">||</span>&nbsp;<span class="ident" id="1604989">IsNaN</span><span class="op" id="1604994">(</span><span class="ident" id="1604995">frac</span><span class="op" id="1604999">)</span><span class="op" id="1605000">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605004">return</span>&nbsp;<span class="ident" id="1605011">frac</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1605017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1605020">frac</span><span class="op" id="1605024">,</span>&nbsp;<span class="ident" id="1605026">e</span>&nbsp;<span class="op" id="1605028">:=</span>&nbsp;<span class="ident" id="1605031">normalize</span><span class="op" id="1605040">(</span><span class="ident" id="1605041">frac</span><span class="op" id="1605045">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1605048">exp</span>&nbsp;<span class="op" id="1605052">+=</span>&nbsp;<span class="ident" id="1605055">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1605058">x</span>&nbsp;<span class="op" id="1605060">:=</span>&nbsp;<span class="ident" id="1605063">Float64bits</span><span class="op" id="1605074">(</span><span class="ident" id="1605075">frac</span><span class="op" id="1605079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1605082">exp</span>&nbsp;<span class="op" id="1605086">+=</span>&nbsp;<span class="builtintype" id="1605089">int</span><span class="op" id="1605092">(</span><span class="ident" id="1605093">x</span><span class="op" id="1605094">&gt;&gt;</span><span class="ident" id="1605096">shift</span><span class="op" id="1605101">)</span><span class="op" id="1605102">&amp;</span><span class="ident" id="1605103">mask</span>&nbsp;<span class="op" id="1605108">-</span>&nbsp;<span class="ident" id="1605110">bias</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605116">if</span>&nbsp;<span class="ident" id="1605119">exp</span>&nbsp;<span class="op" id="1605123">&lt;</span>&nbsp;<span class="op" id="1605125">-</span><span class="num" id="1605126">1074</span>&nbsp;<span class="op" id="1605131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605135">return</span>&nbsp;<span class="ident" id="1605142">Copysign</span><span class="op" id="1605150">(</span><span class="num" id="1605151">0</span><span class="op" id="1605152">,</span>&nbsp;<span class="ident" id="1605154">frac</span><span class="op" id="1605158">)</span>&nbsp;<span class="comment" id="1605160">//&nbsp;underflow</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1605174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605177">if</span>&nbsp;<span class="ident" id="1605180">exp</span>&nbsp;<span class="op" id="1605184">&gt;</span>&nbsp;<span class="num" id="1605186">1023</span>&nbsp;<span class="op" id="1605191">{</span>&nbsp;<span class="comment" id="1605193">//&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605207">if</span>&nbsp;<span class="ident" id="1605210">frac</span>&nbsp;<span class="op" id="1605215">&lt;</span>&nbsp;<span class="num" id="1605217">0</span>&nbsp;<span class="op" id="1605219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605224">return</span>&nbsp;<span class="ident" id="1605231">Inf</span><span class="op" id="1605234">(</span><span class="op" id="1605235">-</span><span class="num" id="1605236">1</span><span class="op" id="1605237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1605241">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605245">return</span>&nbsp;<span class="ident" id="1605252">Inf</span><span class="op" id="1605255">(</span><span class="num" id="1605256">1</span><span class="op" id="1605257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1605260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605263">var</span>&nbsp;<span class="ident" id="1605267">m</span>&nbsp;<span class="builtintype" id="1605269">float64</span>&nbsp;<span class="op" id="1605277">=</span>&nbsp;<span class="num" id="1605279">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605282">if</span>&nbsp;<span class="ident" id="1605285">exp</span>&nbsp;<span class="op" id="1605289">&lt;</span>&nbsp;<span class="op" id="1605291">-</span><span class="num" id="1605292">1022</span>&nbsp;<span class="op" id="1605297">{</span>&nbsp;<span class="comment" id="1605299">//&nbsp;denormal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1605313">exp</span>&nbsp;<span class="op" id="1605317">+=</span>&nbsp;<span class="num" id="1605320">52</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1605325">m</span>&nbsp;<span class="op" id="1605327">=</span>&nbsp;<span class="num" id="1605329">1.0</span>&nbsp;<span class="op" id="1605333">/</span>&nbsp;<span class="op" id="1605335">(</span><span class="num" id="1605336">1</span>&nbsp;<span class="op" id="1605338">&lt;&lt;</span>&nbsp;<span class="num" id="1605341">52</span><span class="op" id="1605343">)</span>&nbsp;<span class="comment" id="1605345">//&nbsp;2**-52</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1605356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1605359">x</span>&nbsp;<span class="op" id="1605361">&amp;^=</span>&nbsp;<span class="ident" id="1605365">mask</span>&nbsp;<span class="op" id="1605370">&lt;&lt;</span>&nbsp;<span class="ident" id="1605373">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1605380">x</span>&nbsp;<span class="op" id="1605382">|=</span>&nbsp;<span class="ident" id="1605385">uint64</span><span class="op" id="1605391">(</span><span class="ident" id="1605392">exp</span><span class="op" id="1605395">+</span><span class="ident" id="1605396">bias</span><span class="op" id="1605400">)</span>&nbsp;<span class="op" id="1605402">&lt;&lt;</span>&nbsp;<span class="ident" id="1605405">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1605412">return</span>&nbsp;<span class="ident" id="1605419">m</span>&nbsp;<span class="op" id="1605421">*</span>&nbsp;<span class="ident" id="1605423">Float64frombits</span><span class="op" id="1605438">(</span><span class="ident" id="1605439">x</span><span class="op" id="1605440">)</span><br>
<span class="lineno">45</span><span class="op" id="1605442">}</span>
</div>
</body>
</html>
