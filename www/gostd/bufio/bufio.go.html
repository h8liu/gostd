<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>bufio</h2>
<ul>
<li><a href="/gostd/bufio/bufio.go.html" class="current">bufio.go</a></li>
<li><a href="/gostd/bufio/bufio_test.go.html">bufio_test.go</a></li>
<li><a href="/gostd/bufio/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/bufio/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/bufio/scan.go.html">scan.go</a></li>
<li><a href="/gostd/bufio/scan_test.go.html">scan_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2814648">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2814703">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2814757">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2814808">//&nbsp;Package&nbsp;bufio&nbsp;implements&nbsp;buffered&nbsp;I/O.&nbsp;&nbsp;It&nbsp;wraps&nbsp;an&nbsp;io.Reader&nbsp;or&nbsp;io.Writer</span><br>
<span class="lineno"></span><span class="comment" id="2814886">//&nbsp;object,&nbsp;creating&nbsp;another&nbsp;object&nbsp;(Reader&nbsp;or&nbsp;Writer)&nbsp;that&nbsp;also&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="2814961">//&nbsp;the&nbsp;interface&nbsp;but&nbsp;provides&nbsp;buffering&nbsp;and&nbsp;some&nbsp;help&nbsp;for&nbsp;textual&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="keyword" id="2815032">package</span>&nbsp;<span class="ident" id="2815040">bufio</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="2815047">import</span>&nbsp;<span class="op" id="2815054">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2815057">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2815066">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2815076">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2815082">&#34;unicode/utf8&#34;</span><br>
<span class="lineno">15</span><span class="op" id="2815097">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2815100">const</span>&nbsp;<span class="op" id="2815106">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2815109">defaultBufSize</span>&nbsp;<span class="op" id="2815124">=</span>&nbsp;<span class="num" id="2815126">4096</span><br>
<span class="lineno"></span><span class="op" id="2815131">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="2815134">var</span>&nbsp;<span class="op" id="2815138">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2815141">ErrInvalidUnreadByte</span>&nbsp;<span class="op" id="2815162">=</span>&nbsp;<span class="ident" id="2815164">errors</span><span class="op" id="2815170">.</span><span class="ident" id="2815171">New</span><span class="op" id="2815174">(</span><span class="string" id="2815175">&#34;bufio:&nbsp;invalid&nbsp;use&nbsp;of&nbsp;UnreadByte&#34;</span><span class="op" id="2815209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2815212">ErrInvalidUnreadRune</span>&nbsp;<span class="op" id="2815233">=</span>&nbsp;<span class="ident" id="2815235">errors</span><span class="op" id="2815241">.</span><span class="ident" id="2815242">New</span><span class="op" id="2815245">(</span><span class="string" id="2815246">&#34;bufio:&nbsp;invalid&nbsp;use&nbsp;of&nbsp;UnreadRune&#34;</span><span class="op" id="2815280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2815283">ErrBufferFull</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2815304">=</span>&nbsp;<span class="ident" id="2815306">errors</span><span class="op" id="2815312">.</span><span class="ident" id="2815313">New</span><span class="op" id="2815316">(</span><span class="string" id="2815317">&#34;bufio:&nbsp;buffer&nbsp;full&#34;</span><span class="op" id="2815337">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2815340">ErrNegativeCount</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2815361">=</span>&nbsp;<span class="ident" id="2815363">errors</span><span class="op" id="2815369">.</span><span class="ident" id="2815370">New</span><span class="op" id="2815373">(</span><span class="string" id="2815374">&#34;bufio:&nbsp;negative&nbsp;count&#34;</span><span class="op" id="2815397">)</span><br>
<span class="lineno"></span><span class="op" id="2815399">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2815402">//&nbsp;Buffered&nbsp;input.</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="2815422">//&nbsp;Reader&nbsp;implements&nbsp;buffering&nbsp;for&nbsp;an&nbsp;io.Reader&nbsp;object.</span><br>
<span class="lineno"></span><span class="keyword" id="2815478">type</span>&nbsp;<span class="ident" id="2815483">Reader</span>&nbsp;<span class="keyword" id="2815490">struct</span>&nbsp;<span class="op" id="2815497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2815500">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2815513">[</span><span class="op" id="2815514">]</span><span class="builtintype" id="2815515">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2815521">rd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2815534">io</span><span class="op" id="2815536">.</span><span class="ident" id="2815537">Reader</span>&nbsp;<span class="comment" id="2815544">//&nbsp;reader&nbsp;provided&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2815578">r</span><span class="op" id="2815579">,</span>&nbsp;<span class="ident" id="2815581">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2815591">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2815601">//&nbsp;buf&nbsp;read&nbsp;and&nbsp;write&nbsp;positions</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2815634">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2815647">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2815654">lastByte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2815667">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2815672">lastRuneSize</span>&nbsp;<span class="builtintype" id="2815685">int</span><br>
<span class="lineno"></span><span class="op" id="2815689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="2815692">const</span>&nbsp;<span class="ident" id="2815698">minReadBufferSize</span>&nbsp;<span class="op" id="2815716">=</span>&nbsp;<span class="num" id="2815718">16</span><br>
<span class="lineno"></span><span class="keyword" id="2815721">const</span>&nbsp;<span class="ident" id="2815727">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="2815752">=</span>&nbsp;<span class="num" id="2815754">100</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2815759">//&nbsp;NewReaderSize&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;the&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="2815837">//&nbsp;size.&nbsp;If&nbsp;the&nbsp;argument&nbsp;io.Reader&nbsp;is&nbsp;already&nbsp;a&nbsp;Reader&nbsp;with&nbsp;large&nbsp;enough</span><br>
<span class="lineno">45</span><span class="comment" id="2815910">//&nbsp;size,&nbsp;it&nbsp;returns&nbsp;the&nbsp;underlying&nbsp;Reader.</span><br>
<span class="lineno"></span><span class="keyword" id="2815953">func</span>&nbsp;<span class="ident" id="2815958">NewReaderSize</span><span class="op" id="2815971">(</span><span class="ident" id="2815972">rd</span>&nbsp;<span class="ident" id="2815975">io</span><span class="op" id="2815977">.</span><span class="ident" id="2815978">Reader</span><span class="op" id="2815984">,</span>&nbsp;<span class="ident" id="2815986">size</span>&nbsp;<span class="builtintype" id="2815991">int</span><span class="op" id="2815994">)</span>&nbsp;<span class="op" id="2815996">*</span><span class="ident" id="2815997">Reader</span>&nbsp;<span class="op" id="2816004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2816007">//&nbsp;Is&nbsp;it&nbsp;already&nbsp;a&nbsp;Reader?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2816035">b</span><span class="op" id="2816036">,</span>&nbsp;<span class="ident" id="2816038">ok</span>&nbsp;<span class="op" id="2816041">:=</span>&nbsp;<span class="ident" id="2816044">rd</span><span class="op" id="2816046">.</span><span class="op" id="2816047">(</span><span class="op" id="2816048">*</span><span class="ident" id="2816049">Reader</span><span class="op" id="2816055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2816058">if</span>&nbsp;<span class="ident" id="2816061">ok</span>&nbsp;<span class="op" id="2816064">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2816067">len</span><span class="op" id="2816070">(</span><span class="ident" id="2816071">b</span><span class="op" id="2816072">.</span><span class="ident" id="2816073">buf</span><span class="op" id="2816076">)</span>&nbsp;<span class="op" id="2816078">&gt;=</span>&nbsp;<span class="ident" id="2816081">size</span>&nbsp;<span class="op" id="2816086">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2816090">return</span>&nbsp;<span class="ident" id="2816097">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2816100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2816103">if</span>&nbsp;<span class="ident" id="2816106">size</span>&nbsp;<span class="op" id="2816111">&lt;</span>&nbsp;<span class="ident" id="2816113">minReadBufferSize</span>&nbsp;<span class="op" id="2816131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2816135">size</span>&nbsp;<span class="op" id="2816140">=</span>&nbsp;<span class="ident" id="2816142">minReadBufferSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2816161">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2816164">r</span>&nbsp;<span class="op" id="2816166">:=</span>&nbsp;<span class="builtinfunc" id="2816169">new</span><span class="op" id="2816172">(</span><span class="ident" id="2816173">Reader</span><span class="op" id="2816179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2816182">r</span><span class="op" id="2816183">.</span><span class="ident" id="2816184">reset</span><span class="op" id="2816189">(</span><span class="builtinfunc" id="2816190">make</span><span class="op" id="2816194">(</span><span class="op" id="2816195">[</span><span class="op" id="2816196">]</span><span class="builtintype" id="2816197">byte</span><span class="op" id="2816201">,</span>&nbsp;<span class="ident" id="2816203">size</span><span class="op" id="2816207">)</span><span class="op" id="2816208">,</span>&nbsp;<span class="ident" id="2816210">rd</span><span class="op" id="2816212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2816215">return</span>&nbsp;<span class="ident" id="2816222">r</span><br>
<span class="lineno"></span><span class="op" id="2816224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="2816227">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;the&nbsp;default&nbsp;size.</span><br>
<span class="lineno"></span><span class="keyword" id="2816296">func</span>&nbsp;<span class="ident" id="2816301">NewReader</span><span class="op" id="2816310">(</span><span class="ident" id="2816311">rd</span>&nbsp;<span class="ident" id="2816314">io</span><span class="op" id="2816316">.</span><span class="ident" id="2816317">Reader</span><span class="op" id="2816323">)</span>&nbsp;<span class="op" id="2816325">*</span><span class="ident" id="2816326">Reader</span>&nbsp;<span class="op" id="2816333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2816336">return</span>&nbsp;<span class="ident" id="2816343">NewReaderSize</span><span class="op" id="2816356">(</span><span class="ident" id="2816357">rd</span><span class="op" id="2816359">,</span>&nbsp;<span class="ident" id="2816361">defaultBufSize</span><span class="op" id="2816375">)</span><br>
<span class="lineno"></span><span class="op" id="2816377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="2816380">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;buffered&nbsp;data,&nbsp;resets&nbsp;all&nbsp;state,&nbsp;and&nbsp;switches</span><br>
<span class="lineno"></span><span class="comment" id="2816448">//&nbsp;the&nbsp;buffered&nbsp;reader&nbsp;to&nbsp;read&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="keyword" id="2816487">func</span>&nbsp;<span class="op" id="2816492">(</span><span class="ident" id="2816493">b</span>&nbsp;<span class="op" id="2816495">*</span><span class="ident" id="2816496">Reader</span><span class="op" id="2816502">)</span>&nbsp;<span class="ident" id="2816504">Reset</span><span class="op" id="2816509">(</span><span class="ident" id="2816510">r</span>&nbsp;<span class="ident" id="2816512">io</span><span class="op" id="2816514">.</span><span class="ident" id="2816515">Reader</span><span class="op" id="2816521">)</span>&nbsp;<span class="op" id="2816523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2816526">b</span><span class="op" id="2816527">.</span><span class="ident" id="2816528">reset</span><span class="op" id="2816533">(</span><span class="ident" id="2816534">b</span><span class="op" id="2816535">.</span><span class="ident" id="2816536">buf</span><span class="op" id="2816539">,</span>&nbsp;<span class="ident" id="2816541">r</span><span class="op" id="2816542">)</span><br>
<span class="lineno"></span><span class="op" id="2816544">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="2816547">func</span>&nbsp;<span class="op" id="2816552">(</span><span class="ident" id="2816553">b</span>&nbsp;<span class="op" id="2816555">*</span><span class="ident" id="2816556">Reader</span><span class="op" id="2816562">)</span>&nbsp;<span class="ident" id="2816564">reset</span><span class="op" id="2816569">(</span><span class="ident" id="2816570">buf</span>&nbsp;<span class="op" id="2816574">[</span><span class="op" id="2816575">]</span><span class="builtintype" id="2816576">byte</span><span class="op" id="2816580">,</span>&nbsp;<span class="ident" id="2816582">r</span>&nbsp;<span class="ident" id="2816584">io</span><span class="op" id="2816586">.</span><span class="ident" id="2816587">Reader</span><span class="op" id="2816593">)</span>&nbsp;<span class="op" id="2816595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2816598">*</span><span class="ident" id="2816599">b</span>&nbsp;<span class="op" id="2816601">=</span>&nbsp;<span class="ident" id="2816603">Reader</span><span class="op" id="2816609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2816613">buf</span><span class="op" id="2816616">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2816627">buf</span><span class="op" id="2816630">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2816634">rd</span><span class="op" id="2816636">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2816648">r</span><span class="op" id="2816649">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2816653">lastByte</span><span class="op" id="2816661">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2816667">-</span><span class="num" id="2816668">1</span><span class="op" id="2816669">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2816673">lastRuneSize</span><span class="op" id="2816685">:</span>&nbsp;<span class="op" id="2816687">-</span><span class="num" id="2816688">1</span><span class="op" id="2816689">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2816692">}</span><br>
<span class="lineno"></span><span class="op" id="2816694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="2816697">var</span>&nbsp;<span class="ident" id="2816701">errNegativeRead</span>&nbsp;<span class="op" id="2816717">=</span>&nbsp;<span class="ident" id="2816719">errors</span><span class="op" id="2816725">.</span><span class="ident" id="2816726">New</span><span class="op" id="2816729">(</span><span class="string" id="2816730">&#34;bufio:&nbsp;reader&nbsp;returned&nbsp;negative&nbsp;count&nbsp;from&nbsp;Read&#34;</span><span class="op" id="2816779">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2816782">//&nbsp;fill&nbsp;reads&nbsp;a&nbsp;new&nbsp;chunk&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2816825">func</span>&nbsp;<span class="op" id="2816830">(</span><span class="ident" id="2816831">b</span>&nbsp;<span class="op" id="2816833">*</span><span class="ident" id="2816834">Reader</span><span class="op" id="2816840">)</span>&nbsp;<span class="ident" id="2816842">fill</span><span class="op" id="2816846">(</span><span class="op" id="2816847">)</span>&nbsp;<span class="op" id="2816849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2816852">//&nbsp;Slide&nbsp;existing&nbsp;data&nbsp;to&nbsp;beginning.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2816890">if</span>&nbsp;<span class="ident" id="2816893">b</span><span class="op" id="2816894">.</span><span class="ident" id="2816895">r</span>&nbsp;<span class="op" id="2816897">&gt;</span>&nbsp;<span class="num" id="2816899">0</span>&nbsp;<span class="op" id="2816901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2816905">copy</span><span class="op" id="2816909">(</span><span class="ident" id="2816910">b</span><span class="op" id="2816911">.</span><span class="ident" id="2816912">buf</span><span class="op" id="2816915">,</span>&nbsp;<span class="ident" id="2816917">b</span><span class="op" id="2816918">.</span><span class="ident" id="2816919">buf</span><span class="op" id="2816922">[</span><span class="ident" id="2816923">b</span><span class="op" id="2816924">.</span><span class="ident" id="2816925">r</span><span class="op" id="2816926">:</span><span class="ident" id="2816927">b</span><span class="op" id="2816928">.</span><span class="ident" id="2816929">w</span><span class="op" id="2816930">]</span><span class="op" id="2816931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2816935">b</span><span class="op" id="2816936">.</span><span class="ident" id="2816937">w</span>&nbsp;<span class="op" id="2816939">-=</span>&nbsp;<span class="ident" id="2816942">b</span><span class="op" id="2816943">.</span><span class="ident" id="2816944">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2816948">b</span><span class="op" id="2816949">.</span><span class="ident" id="2816950">r</span>&nbsp;<span class="op" id="2816952">=</span>&nbsp;<span class="num" id="2816954">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2816957">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2816961">if</span>&nbsp;<span class="ident" id="2816964">b</span><span class="op" id="2816965">.</span><span class="ident" id="2816966">w</span>&nbsp;<span class="op" id="2816968">&gt;=</span>&nbsp;<span class="builtinfunc" id="2816971">len</span><span class="op" id="2816974">(</span><span class="ident" id="2816975">b</span><span class="op" id="2816976">.</span><span class="ident" id="2816977">buf</span><span class="op" id="2816980">)</span>&nbsp;<span class="op" id="2816982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2816986">panic</span><span class="op" id="2816991">(</span><span class="string" id="2816992">&#34;bufio:&nbsp;tried&nbsp;to&nbsp;fill&nbsp;full&nbsp;buffer&#34;</span><span class="op" id="2817026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2817029">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2817033">//&nbsp;Read&nbsp;new&nbsp;data:&nbsp;try&nbsp;a&nbsp;limited&nbsp;number&nbsp;of&nbsp;times.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2817083">for</span>&nbsp;<span class="ident" id="2817087">i</span>&nbsp;<span class="op" id="2817089">:=</span>&nbsp;<span class="ident" id="2817092">maxConsecutiveEmptyReads</span><span class="op" id="2817116">;</span>&nbsp;<span class="ident" id="2817118">i</span>&nbsp;<span class="op" id="2817120">&gt;</span>&nbsp;<span class="num" id="2817122">0</span><span class="op" id="2817123">;</span>&nbsp;<span class="ident" id="2817125">i</span><span class="op" id="2817126">--</span>&nbsp;<span class="op" id="2817129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2817133">n</span><span class="op" id="2817134">,</span>&nbsp;<span class="ident" id="2817136">err</span>&nbsp;<span class="op" id="2817140">:=</span>&nbsp;<span class="ident" id="2817143">b</span><span class="op" id="2817144">.</span><span class="ident" id="2817145">rd</span><span class="op" id="2817147">.</span><span class="ident" id="2817148">Read</span><span class="op" id="2817152">(</span><span class="ident" id="2817153">b</span><span class="op" id="2817154">.</span><span class="ident" id="2817155">buf</span><span class="op" id="2817158">[</span><span class="ident" id="2817159">b</span><span class="op" id="2817160">.</span><span class="ident" id="2817161">w</span><span class="op" id="2817162">:</span><span class="op" id="2817163">]</span><span class="op" id="2817164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2817168">if</span>&nbsp;<span class="ident" id="2817171">n</span>&nbsp;<span class="op" id="2817173">&lt;</span>&nbsp;<span class="num" id="2817175">0</span>&nbsp;<span class="op" id="2817177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2817182">panic</span><span class="op" id="2817187">(</span><span class="ident" id="2817188">errNegativeRead</span><span class="op" id="2817203">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2817207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2817211">b</span><span class="op" id="2817212">.</span><span class="ident" id="2817213">w</span>&nbsp;<span class="op" id="2817215">+=</span>&nbsp;<span class="ident" id="2817218">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2817222">if</span>&nbsp;<span class="ident" id="2817225">err</span>&nbsp;<span class="op" id="2817229">!=</span>&nbsp;<span class="builtintype" id="2817232">nil</span>&nbsp;<span class="op" id="2817236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2817241">b</span><span class="op" id="2817242">.</span><span class="ident" id="2817243">err</span>&nbsp;<span class="op" id="2817247">=</span>&nbsp;<span class="ident" id="2817249">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2817256">return</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2817265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2817269">if</span>&nbsp;<span class="ident" id="2817272">n</span>&nbsp;<span class="op" id="2817274">&gt;</span>&nbsp;<span class="num" id="2817276">0</span>&nbsp;<span class="op" id="2817278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2817283">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2817292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2817295">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2817298">b</span><span class="op" id="2817299">.</span><span class="ident" id="2817300">err</span>&nbsp;<span class="op" id="2817304">=</span>&nbsp;<span class="ident" id="2817306">io</span><span class="op" id="2817308">.</span><span class="ident" id="2817309">ErrNoProgress</span><br>
<span class="lineno"></span><span class="op" id="2817323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2817326">func</span>&nbsp;<span class="op" id="2817331">(</span><span class="ident" id="2817332">b</span>&nbsp;<span class="op" id="2817334">*</span><span class="ident" id="2817335">Reader</span><span class="op" id="2817341">)</span>&nbsp;<span class="ident" id="2817343">readErr</span><span class="op" id="2817350">(</span><span class="op" id="2817351">)</span>&nbsp;<span class="builtintype" id="2817353">error</span>&nbsp;<span class="op" id="2817359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2817362">err</span>&nbsp;<span class="op" id="2817366">:=</span>&nbsp;<span class="ident" id="2817369">b</span><span class="op" id="2817370">.</span><span class="ident" id="2817371">err</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2817376">b</span><span class="op" id="2817377">.</span><span class="ident" id="2817378">err</span>&nbsp;<span class="op" id="2817382">=</span>&nbsp;<span class="builtintype" id="2817384">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2817389">return</span>&nbsp;<span class="ident" id="2817396">err</span><br>
<span class="lineno"></span><span class="op" id="2817400">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2817403">//&nbsp;Peek&nbsp;returns&nbsp;the&nbsp;next&nbsp;n&nbsp;bytes&nbsp;without&nbsp;advancing&nbsp;the&nbsp;reader.&nbsp;The&nbsp;bytes&nbsp;stop</span><br>
<span class="lineno">120</span><span class="comment" id="2817481">//&nbsp;being&nbsp;valid&nbsp;at&nbsp;the&nbsp;next&nbsp;read&nbsp;call.&nbsp;If&nbsp;Peek&nbsp;returns&nbsp;fewer&nbsp;than&nbsp;n&nbsp;bytes,&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="2817558">//&nbsp;also&nbsp;returns&nbsp;an&nbsp;error&nbsp;explaining&nbsp;why&nbsp;the&nbsp;read&nbsp;is&nbsp;short.&nbsp;The&nbsp;error&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2817630">//&nbsp;ErrBufferFull&nbsp;if&nbsp;n&nbsp;is&nbsp;larger&nbsp;than&nbsp;b&#39;s&nbsp;buffer&nbsp;size.</span><br>
<span class="lineno"></span><span class="keyword" id="2817684">func</span>&nbsp;<span class="op" id="2817689">(</span><span class="ident" id="2817690">b</span>&nbsp;<span class="op" id="2817692">*</span><span class="ident" id="2817693">Reader</span><span class="op" id="2817699">)</span>&nbsp;<span class="ident" id="2817701">Peek</span><span class="op" id="2817705">(</span><span class="ident" id="2817706">n</span>&nbsp;<span class="builtintype" id="2817708">int</span><span class="op" id="2817711">)</span>&nbsp;<span class="op" id="2817713">(</span><span class="op" id="2817714">[</span><span class="op" id="2817715">]</span><span class="builtintype" id="2817716">byte</span><span class="op" id="2817720">,</span>&nbsp;<span class="builtintype" id="2817722">error</span><span class="op" id="2817727">)</span>&nbsp;<span class="op" id="2817729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2817732">if</span>&nbsp;<span class="ident" id="2817735">n</span>&nbsp;<span class="op" id="2817737">&lt;</span>&nbsp;<span class="num" id="2817739">0</span>&nbsp;<span class="op" id="2817741">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2817745">return</span>&nbsp;<span class="builtintype" id="2817752">nil</span><span class="op" id="2817755">,</span>&nbsp;<span class="ident" id="2817757">ErrNegativeCount</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2817775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2817778">if</span>&nbsp;<span class="ident" id="2817781">n</span>&nbsp;<span class="op" id="2817783">&gt;</span>&nbsp;<span class="builtinfunc" id="2817785">len</span><span class="op" id="2817788">(</span><span class="ident" id="2817789">b</span><span class="op" id="2817790">.</span><span class="ident" id="2817791">buf</span><span class="op" id="2817794">)</span>&nbsp;<span class="op" id="2817796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2817800">return</span>&nbsp;<span class="builtintype" id="2817807">nil</span><span class="op" id="2817810">,</span>&nbsp;<span class="ident" id="2817812">ErrBufferFull</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2817827">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2817830">//&nbsp;0&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;len(b.buf)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2817855">for</span>&nbsp;<span class="ident" id="2817859">b</span><span class="op" id="2817860">.</span><span class="ident" id="2817861">w</span><span class="op" id="2817862">-</span><span class="ident" id="2817863">b</span><span class="op" id="2817864">.</span><span class="ident" id="2817865">r</span>&nbsp;<span class="op" id="2817867">&lt;</span>&nbsp;<span class="ident" id="2817869">n</span>&nbsp;<span class="op" id="2817871">&amp;&amp;</span>&nbsp;<span class="ident" id="2817874">b</span><span class="op" id="2817875">.</span><span class="ident" id="2817876">err</span>&nbsp;<span class="op" id="2817880">==</span>&nbsp;<span class="builtintype" id="2817883">nil</span>&nbsp;<span class="op" id="2817887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2817891">b</span><span class="op" id="2817892">.</span><span class="ident" id="2817893">fill</span><span class="op" id="2817897">(</span><span class="op" id="2817898">)</span>&nbsp;<span class="comment" id="2817900">//&nbsp;b.w-b.r&nbsp;&lt;&nbsp;len(b.buf)&nbsp;=&gt;&nbsp;buffer&nbsp;is&nbsp;not&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2817947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2817951">var</span>&nbsp;<span class="ident" id="2817955">err</span>&nbsp;<span class="builtintype" id="2817959">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2817966">if</span>&nbsp;<span class="ident" id="2817969">avail</span>&nbsp;<span class="op" id="2817975">:=</span>&nbsp;<span class="ident" id="2817978">b</span><span class="op" id="2817979">.</span><span class="ident" id="2817980">w</span>&nbsp;<span class="op" id="2817982">-</span>&nbsp;<span class="ident" id="2817984">b</span><span class="op" id="2817985">.</span><span class="ident" id="2817986">r</span><span class="op" id="2817987">;</span>&nbsp;<span class="ident" id="2817989">avail</span>&nbsp;<span class="op" id="2817995">&lt;</span>&nbsp;<span class="ident" id="2817997">n</span>&nbsp;<span class="op" id="2817999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2818003">//&nbsp;not&nbsp;enough&nbsp;data&nbsp;in&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2818034">n</span>&nbsp;<span class="op" id="2818036">=</span>&nbsp;<span class="ident" id="2818038">avail</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2818046">err</span>&nbsp;<span class="op" id="2818050">=</span>&nbsp;<span class="ident" id="2818052">b</span><span class="op" id="2818053">.</span><span class="ident" id="2818054">readErr</span><span class="op" id="2818061">(</span><span class="op" id="2818062">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2818066">if</span>&nbsp;<span class="ident" id="2818069">err</span>&nbsp;<span class="op" id="2818073">==</span>&nbsp;<span class="builtintype" id="2818076">nil</span>&nbsp;<span class="op" id="2818080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2818085">err</span>&nbsp;<span class="op" id="2818089">=</span>&nbsp;<span class="ident" id="2818091">ErrBufferFull</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2818107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2818110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2818113">return</span>&nbsp;<span class="ident" id="2818120">b</span><span class="op" id="2818121">.</span><span class="ident" id="2818122">buf</span><span class="op" id="2818125">[</span><span class="ident" id="2818126">b</span><span class="op" id="2818127">.</span><span class="ident" id="2818128">r</span>&nbsp;<span class="op" id="2818130">:</span>&nbsp;<span class="ident" id="2818132">b</span><span class="op" id="2818133">.</span><span class="ident" id="2818134">r</span><span class="op" id="2818135">+</span><span class="ident" id="2818136">n</span><span class="op" id="2818137">]</span><span class="op" id="2818138">,</span>&nbsp;<span class="ident" id="2818140">err</span><br>
<span class="lineno">145</span><span class="op" id="2818144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2818147">//&nbsp;Read&nbsp;reads&nbsp;data&nbsp;into&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="2818174">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;read&nbsp;into&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="2818221">//&nbsp;It&nbsp;calls&nbsp;Read&nbsp;at&nbsp;most&nbsp;once&nbsp;on&nbsp;the&nbsp;underlying&nbsp;Reader,</span><br>
<span class="lineno">150</span><span class="comment" id="2818277">//&nbsp;hence&nbsp;n&nbsp;may&nbsp;be&nbsp;less&nbsp;than&nbsp;len(p).</span><br>
<span class="lineno"></span><span class="comment" id="2818313">//&nbsp;At&nbsp;EOF,&nbsp;the&nbsp;count&nbsp;will&nbsp;be&nbsp;zero&nbsp;and&nbsp;err&nbsp;will&nbsp;be&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="2818371">func</span>&nbsp;<span class="op" id="2818376">(</span><span class="ident" id="2818377">b</span>&nbsp;<span class="op" id="2818379">*</span><span class="ident" id="2818380">Reader</span><span class="op" id="2818386">)</span>&nbsp;<span class="ident" id="2818388">Read</span><span class="op" id="2818392">(</span><span class="ident" id="2818393">p</span>&nbsp;<span class="op" id="2818395">[</span><span class="op" id="2818396">]</span><span class="builtintype" id="2818397">byte</span><span class="op" id="2818401">)</span>&nbsp;<span class="op" id="2818403">(</span><span class="ident" id="2818404">n</span>&nbsp;<span class="builtintype" id="2818406">int</span><span class="op" id="2818409">,</span>&nbsp;<span class="ident" id="2818411">err</span>&nbsp;<span class="builtintype" id="2818415">error</span><span class="op" id="2818420">)</span>&nbsp;<span class="op" id="2818422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2818425">n</span>&nbsp;<span class="op" id="2818427">=</span>&nbsp;<span class="builtinfunc" id="2818429">len</span><span class="op" id="2818432">(</span><span class="ident" id="2818433">p</span><span class="op" id="2818434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2818437">if</span>&nbsp;<span class="ident" id="2818440">n</span>&nbsp;<span class="op" id="2818442">==</span>&nbsp;<span class="num" id="2818445">0</span>&nbsp;<span class="op" id="2818447">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2818451">return</span>&nbsp;<span class="num" id="2818458">0</span><span class="op" id="2818459">,</span>&nbsp;<span class="ident" id="2818461">b</span><span class="op" id="2818462">.</span><span class="ident" id="2818463">readErr</span><span class="op" id="2818470">(</span><span class="op" id="2818471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2818474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2818477">if</span>&nbsp;<span class="ident" id="2818480">b</span><span class="op" id="2818481">.</span><span class="ident" id="2818482">r</span>&nbsp;<span class="op" id="2818484">==</span>&nbsp;<span class="ident" id="2818487">b</span><span class="op" id="2818488">.</span><span class="ident" id="2818489">w</span>&nbsp;<span class="op" id="2818491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2818495">if</span>&nbsp;<span class="ident" id="2818498">b</span><span class="op" id="2818499">.</span><span class="ident" id="2818500">err</span>&nbsp;<span class="op" id="2818504">!=</span>&nbsp;<span class="builtintype" id="2818507">nil</span>&nbsp;<span class="op" id="2818511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2818516">return</span>&nbsp;<span class="num" id="2818523">0</span><span class="op" id="2818524">,</span>&nbsp;<span class="ident" id="2818526">b</span><span class="op" id="2818527">.</span><span class="ident" id="2818528">readErr</span><span class="op" id="2818535">(</span><span class="op" id="2818536">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2818540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2818544">if</span>&nbsp;<span class="builtinfunc" id="2818547">len</span><span class="op" id="2818550">(</span><span class="ident" id="2818551">p</span><span class="op" id="2818552">)</span>&nbsp;<span class="op" id="2818554">&gt;=</span>&nbsp;<span class="builtinfunc" id="2818557">len</span><span class="op" id="2818560">(</span><span class="ident" id="2818561">b</span><span class="op" id="2818562">.</span><span class="ident" id="2818563">buf</span><span class="op" id="2818566">)</span>&nbsp;<span class="op" id="2818568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2818573">//&nbsp;Large&nbsp;read,&nbsp;empty&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2818605">//&nbsp;Read&nbsp;directly&nbsp;into&nbsp;p&nbsp;to&nbsp;avoid&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2818647">n</span><span class="op" id="2818648">,</span>&nbsp;<span class="ident" id="2818650">b</span><span class="op" id="2818651">.</span><span class="ident" id="2818652">err</span>&nbsp;<span class="op" id="2818656">=</span>&nbsp;<span class="ident" id="2818658">b</span><span class="op" id="2818659">.</span><span class="ident" id="2818660">rd</span><span class="op" id="2818662">.</span><span class="ident" id="2818663">Read</span><span class="op" id="2818667">(</span><span class="ident" id="2818668">p</span><span class="op" id="2818669">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2818674">if</span>&nbsp;<span class="ident" id="2818677">n</span>&nbsp;<span class="op" id="2818679">&lt;</span>&nbsp;<span class="num" id="2818681">0</span>&nbsp;<span class="op" id="2818683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2818689">panic</span><span class="op" id="2818694">(</span><span class="ident" id="2818695">errNegativeRead</span><span class="op" id="2818710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2818715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2818720">if</span>&nbsp;<span class="ident" id="2818723">n</span>&nbsp;<span class="op" id="2818725">&gt;</span>&nbsp;<span class="num" id="2818727">0</span>&nbsp;<span class="op" id="2818729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2818735">b</span><span class="op" id="2818736">.</span><span class="ident" id="2818737">lastByte</span>&nbsp;<span class="op" id="2818746">=</span>&nbsp;<span class="builtintype" id="2818748">int</span><span class="op" id="2818751">(</span><span class="ident" id="2818752">p</span><span class="op" id="2818753">[</span><span class="ident" id="2818754">n</span><span class="op" id="2818755">-</span><span class="num" id="2818756">1</span><span class="op" id="2818757">]</span><span class="op" id="2818758">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2818764">b</span><span class="op" id="2818765">.</span><span class="ident" id="2818766">lastRuneSize</span>&nbsp;<span class="op" id="2818779">=</span>&nbsp;<span class="op" id="2818781">-</span><span class="num" id="2818782">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2818787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2818792">return</span>&nbsp;<span class="ident" id="2818799">n</span><span class="op" id="2818800">,</span>&nbsp;<span class="ident" id="2818802">b</span><span class="op" id="2818803">.</span><span class="ident" id="2818804">readErr</span><span class="op" id="2818811">(</span><span class="op" id="2818812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2818816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2818820">b</span><span class="op" id="2818821">.</span><span class="ident" id="2818822">fill</span><span class="op" id="2818826">(</span><span class="op" id="2818827">)</span>&nbsp;<span class="comment" id="2818829">//&nbsp;buffer&nbsp;is&nbsp;empty</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2818850">if</span>&nbsp;<span class="ident" id="2818853">b</span><span class="op" id="2818854">.</span><span class="ident" id="2818855">r</span>&nbsp;<span class="op" id="2818857">==</span>&nbsp;<span class="ident" id="2818860">b</span><span class="op" id="2818861">.</span><span class="ident" id="2818862">w</span>&nbsp;<span class="op" id="2818864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2818869">return</span>&nbsp;<span class="num" id="2818876">0</span><span class="op" id="2818877">,</span>&nbsp;<span class="ident" id="2818879">b</span><span class="op" id="2818880">.</span><span class="ident" id="2818881">readErr</span><span class="op" id="2818888">(</span><span class="op" id="2818889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2818893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2818896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2818900">//&nbsp;copy&nbsp;as&nbsp;much&nbsp;as&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2818927">n</span>&nbsp;<span class="op" id="2818929">=</span>&nbsp;<span class="builtinfunc" id="2818931">copy</span><span class="op" id="2818935">(</span><span class="ident" id="2818936">p</span><span class="op" id="2818937">,</span>&nbsp;<span class="ident" id="2818939">b</span><span class="op" id="2818940">.</span><span class="ident" id="2818941">buf</span><span class="op" id="2818944">[</span><span class="ident" id="2818945">b</span><span class="op" id="2818946">.</span><span class="ident" id="2818947">r</span><span class="op" id="2818948">:</span><span class="ident" id="2818949">b</span><span class="op" id="2818950">.</span><span class="ident" id="2818951">w</span><span class="op" id="2818952">]</span><span class="op" id="2818953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2818956">b</span><span class="op" id="2818957">.</span><span class="ident" id="2818958">r</span>&nbsp;<span class="op" id="2818960">+=</span>&nbsp;<span class="ident" id="2818963">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2818966">b</span><span class="op" id="2818967">.</span><span class="ident" id="2818968">lastByte</span>&nbsp;<span class="op" id="2818977">=</span>&nbsp;<span class="builtintype" id="2818979">int</span><span class="op" id="2818982">(</span><span class="ident" id="2818983">b</span><span class="op" id="2818984">.</span><span class="ident" id="2818985">buf</span><span class="op" id="2818988">[</span><span class="ident" id="2818989">b</span><span class="op" id="2818990">.</span><span class="ident" id="2818991">r</span><span class="op" id="2818992">-</span><span class="num" id="2818993">1</span><span class="op" id="2818994">]</span><span class="op" id="2818995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2818998">b</span><span class="op" id="2818999">.</span><span class="ident" id="2819000">lastRuneSize</span>&nbsp;<span class="op" id="2819013">=</span>&nbsp;<span class="op" id="2819015">-</span><span class="num" id="2819016">1</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2819019">return</span>&nbsp;<span class="ident" id="2819026">n</span><span class="op" id="2819027">,</span>&nbsp;<span class="builtintype" id="2819029">nil</span><br>
<span class="lineno"></span><span class="op" id="2819033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2819036">//&nbsp;ReadByte&nbsp;reads&nbsp;and&nbsp;returns&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span><span class="comment" id="2819081">//&nbsp;If&nbsp;no&nbsp;byte&nbsp;is&nbsp;available,&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno">190</span><span class="keyword" id="2819127">func</span>&nbsp;<span class="op" id="2819132">(</span><span class="ident" id="2819133">b</span>&nbsp;<span class="op" id="2819135">*</span><span class="ident" id="2819136">Reader</span><span class="op" id="2819142">)</span>&nbsp;<span class="ident" id="2819144">ReadByte</span><span class="op" id="2819152">(</span><span class="op" id="2819153">)</span>&nbsp;<span class="op" id="2819155">(</span><span class="ident" id="2819156">c</span>&nbsp;<span class="builtintype" id="2819158">byte</span><span class="op" id="2819162">,</span>&nbsp;<span class="ident" id="2819164">err</span>&nbsp;<span class="builtintype" id="2819168">error</span><span class="op" id="2819173">)</span>&nbsp;<span class="op" id="2819175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2819178">b</span><span class="op" id="2819179">.</span><span class="ident" id="2819180">lastRuneSize</span>&nbsp;<span class="op" id="2819193">=</span>&nbsp;<span class="op" id="2819195">-</span><span class="num" id="2819196">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2819199">for</span>&nbsp;<span class="ident" id="2819203">b</span><span class="op" id="2819204">.</span><span class="ident" id="2819205">r</span>&nbsp;<span class="op" id="2819207">==</span>&nbsp;<span class="ident" id="2819210">b</span><span class="op" id="2819211">.</span><span class="ident" id="2819212">w</span>&nbsp;<span class="op" id="2819214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2819218">if</span>&nbsp;<span class="ident" id="2819221">b</span><span class="op" id="2819222">.</span><span class="ident" id="2819223">err</span>&nbsp;<span class="op" id="2819227">!=</span>&nbsp;<span class="builtintype" id="2819230">nil</span>&nbsp;<span class="op" id="2819234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2819239">return</span>&nbsp;<span class="num" id="2819246">0</span><span class="op" id="2819247">,</span>&nbsp;<span class="ident" id="2819249">b</span><span class="op" id="2819250">.</span><span class="ident" id="2819251">readErr</span><span class="op" id="2819258">(</span><span class="op" id="2819259">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2819263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2819267">b</span><span class="op" id="2819268">.</span><span class="ident" id="2819269">fill</span><span class="op" id="2819273">(</span><span class="op" id="2819274">)</span>&nbsp;<span class="comment" id="2819276">//&nbsp;buffer&nbsp;is&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2819296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2819299">c</span>&nbsp;<span class="op" id="2819301">=</span>&nbsp;<span class="ident" id="2819303">b</span><span class="op" id="2819304">.</span><span class="ident" id="2819305">buf</span><span class="op" id="2819308">[</span><span class="ident" id="2819309">b</span><span class="op" id="2819310">.</span><span class="ident" id="2819311">r</span><span class="op" id="2819312">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2819315">b</span><span class="op" id="2819316">.</span><span class="ident" id="2819317">r</span><span class="op" id="2819318">++</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2819322">b</span><span class="op" id="2819323">.</span><span class="ident" id="2819324">lastByte</span>&nbsp;<span class="op" id="2819333">=</span>&nbsp;<span class="builtintype" id="2819335">int</span><span class="op" id="2819338">(</span><span class="ident" id="2819339">c</span><span class="op" id="2819340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2819343">return</span>&nbsp;<span class="ident" id="2819350">c</span><span class="op" id="2819351">,</span>&nbsp;<span class="builtintype" id="2819353">nil</span><br>
<span class="lineno"></span><span class="op" id="2819357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2819360">//&nbsp;UnreadByte&nbsp;unreads&nbsp;the&nbsp;last&nbsp;byte.&nbsp;&nbsp;Only&nbsp;the&nbsp;most&nbsp;recently&nbsp;read&nbsp;byte&nbsp;can&nbsp;be&nbsp;unread.</span><br>
<span class="lineno">205</span><span class="keyword" id="2819446">func</span>&nbsp;<span class="op" id="2819451">(</span><span class="ident" id="2819452">b</span>&nbsp;<span class="op" id="2819454">*</span><span class="ident" id="2819455">Reader</span><span class="op" id="2819461">)</span>&nbsp;<span class="ident" id="2819463">UnreadByte</span><span class="op" id="2819473">(</span><span class="op" id="2819474">)</span>&nbsp;<span class="builtintype" id="2819476">error</span>&nbsp;<span class="op" id="2819482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2819485">if</span>&nbsp;<span class="ident" id="2819488">b</span><span class="op" id="2819489">.</span><span class="ident" id="2819490">lastByte</span>&nbsp;<span class="op" id="2819499">&lt;</span>&nbsp;<span class="num" id="2819501">0</span>&nbsp;<span class="op" id="2819503">||</span>&nbsp;<span class="ident" id="2819506">b</span><span class="op" id="2819507">.</span><span class="ident" id="2819508">r</span>&nbsp;<span class="op" id="2819510">==</span>&nbsp;<span class="num" id="2819513">0</span>&nbsp;<span class="op" id="2819515">&amp;&amp;</span>&nbsp;<span class="ident" id="2819518">b</span><span class="op" id="2819519">.</span><span class="ident" id="2819520">w</span>&nbsp;<span class="op" id="2819522">&gt;</span>&nbsp;<span class="num" id="2819524">0</span>&nbsp;<span class="op" id="2819526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2819530">return</span>&nbsp;<span class="ident" id="2819537">ErrInvalidUnreadByte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2819559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2819562">//&nbsp;b.r&nbsp;&gt;&nbsp;0&nbsp;||&nbsp;b.w&nbsp;==&nbsp;0</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2819586">if</span>&nbsp;<span class="ident" id="2819589">b</span><span class="op" id="2819590">.</span><span class="ident" id="2819591">r</span>&nbsp;<span class="op" id="2819593">&gt;</span>&nbsp;<span class="num" id="2819595">0</span>&nbsp;<span class="op" id="2819597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2819601">b</span><span class="op" id="2819602">.</span><span class="ident" id="2819603">r</span><span class="op" id="2819604">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2819608">}</span>&nbsp;<span class="keyword" id="2819610">else</span>&nbsp;<span class="op" id="2819615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2819619">//&nbsp;b.r&nbsp;==&nbsp;0&nbsp;&amp;&amp;&nbsp;b.w&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2819645">b</span><span class="op" id="2819646">.</span><span class="ident" id="2819647">w</span>&nbsp;<span class="op" id="2819649">=</span>&nbsp;<span class="num" id="2819651">1</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2819654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2819657">b</span><span class="op" id="2819658">.</span><span class="ident" id="2819659">buf</span><span class="op" id="2819662">[</span><span class="ident" id="2819663">b</span><span class="op" id="2819664">.</span><span class="ident" id="2819665">r</span><span class="op" id="2819666">]</span>&nbsp;<span class="op" id="2819668">=</span>&nbsp;<span class="builtintype" id="2819670">byte</span><span class="op" id="2819674">(</span><span class="ident" id="2819675">b</span><span class="op" id="2819676">.</span><span class="ident" id="2819677">lastByte</span><span class="op" id="2819685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2819688">b</span><span class="op" id="2819689">.</span><span class="ident" id="2819690">lastByte</span>&nbsp;<span class="op" id="2819699">=</span>&nbsp;<span class="op" id="2819701">-</span><span class="num" id="2819702">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2819705">b</span><span class="op" id="2819706">.</span><span class="ident" id="2819707">lastRuneSize</span>&nbsp;<span class="op" id="2819720">=</span>&nbsp;<span class="op" id="2819722">-</span><span class="num" id="2819723">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2819726">return</span>&nbsp;<span class="builtintype" id="2819733">nil</span><br>
<span class="lineno">220</span><span class="op" id="2819737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2819740">//&nbsp;ReadRune&nbsp;reads&nbsp;a&nbsp;single&nbsp;UTF-8&nbsp;encoded&nbsp;Unicode&nbsp;character&nbsp;and&nbsp;returns&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2819815">//&nbsp;rune&nbsp;and&nbsp;its&nbsp;size&nbsp;in&nbsp;bytes.&nbsp;If&nbsp;the&nbsp;encoded&nbsp;rune&nbsp;is&nbsp;invalid,&nbsp;it&nbsp;consumes&nbsp;one&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="2819899">//&nbsp;and&nbsp;returns&nbsp;unicode.ReplacementChar&nbsp;(U+FFFD)&nbsp;with&nbsp;a&nbsp;size&nbsp;of&nbsp;1.</span><br>
<span class="lineno">225</span><span class="keyword" id="2819965">func</span>&nbsp;<span class="op" id="2819970">(</span><span class="ident" id="2819971">b</span>&nbsp;<span class="op" id="2819973">*</span><span class="ident" id="2819974">Reader</span><span class="op" id="2819980">)</span>&nbsp;<span class="ident" id="2819982">ReadRune</span><span class="op" id="2819990">(</span><span class="op" id="2819991">)</span>&nbsp;<span class="op" id="2819993">(</span><span class="ident" id="2819994">r</span>&nbsp;<span class="builtintype" id="2819996">rune</span><span class="op" id="2820000">,</span>&nbsp;<span class="ident" id="2820002">size</span>&nbsp;<span class="builtintype" id="2820007">int</span><span class="op" id="2820010">,</span>&nbsp;<span class="ident" id="2820012">err</span>&nbsp;<span class="builtintype" id="2820016">error</span><span class="op" id="2820021">)</span>&nbsp;<span class="op" id="2820023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2820026">for</span>&nbsp;<span class="ident" id="2820030">b</span><span class="op" id="2820031">.</span><span class="ident" id="2820032">r</span><span class="op" id="2820033">+</span><span class="ident" id="2820034">utf8</span><span class="op" id="2820038">.</span><span class="ident" id="2820039">UTFMax</span>&nbsp;<span class="op" id="2820046">&gt;</span>&nbsp;<span class="ident" id="2820048">b</span><span class="op" id="2820049">.</span><span class="ident" id="2820050">w</span>&nbsp;<span class="op" id="2820052">&amp;&amp;</span>&nbsp;<span class="op" id="2820055">!</span><span class="ident" id="2820056">utf8</span><span class="op" id="2820060">.</span><span class="ident" id="2820061">FullRune</span><span class="op" id="2820069">(</span><span class="ident" id="2820070">b</span><span class="op" id="2820071">.</span><span class="ident" id="2820072">buf</span><span class="op" id="2820075">[</span><span class="ident" id="2820076">b</span><span class="op" id="2820077">.</span><span class="ident" id="2820078">r</span><span class="op" id="2820079">:</span><span class="ident" id="2820080">b</span><span class="op" id="2820081">.</span><span class="ident" id="2820082">w</span><span class="op" id="2820083">]</span><span class="op" id="2820084">)</span>&nbsp;<span class="op" id="2820086">&amp;&amp;</span>&nbsp;<span class="ident" id="2820089">b</span><span class="op" id="2820090">.</span><span class="ident" id="2820091">err</span>&nbsp;<span class="op" id="2820095">==</span>&nbsp;<span class="builtintype" id="2820098">nil</span>&nbsp;<span class="op" id="2820102">&amp;&amp;</span>&nbsp;<span class="ident" id="2820105">b</span><span class="op" id="2820106">.</span><span class="ident" id="2820107">w</span><span class="op" id="2820108">-</span><span class="ident" id="2820109">b</span><span class="op" id="2820110">.</span><span class="ident" id="2820111">r</span>&nbsp;<span class="op" id="2820113">&lt;</span>&nbsp;<span class="builtinfunc" id="2820115">len</span><span class="op" id="2820118">(</span><span class="ident" id="2820119">b</span><span class="op" id="2820120">.</span><span class="ident" id="2820121">buf</span><span class="op" id="2820124">)</span>&nbsp;<span class="op" id="2820126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2820130">b</span><span class="op" id="2820131">.</span><span class="ident" id="2820132">fill</span><span class="op" id="2820136">(</span><span class="op" id="2820137">)</span>&nbsp;<span class="comment" id="2820139">//&nbsp;b.w-b.r&nbsp;&lt;&nbsp;len(buf)&nbsp;=&gt;&nbsp;buffer&nbsp;is&nbsp;not&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2820184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2820187">b</span><span class="op" id="2820188">.</span><span class="ident" id="2820189">lastRuneSize</span>&nbsp;<span class="op" id="2820202">=</span>&nbsp;<span class="op" id="2820204">-</span><span class="num" id="2820205">1</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2820208">if</span>&nbsp;<span class="ident" id="2820211">b</span><span class="op" id="2820212">.</span><span class="ident" id="2820213">r</span>&nbsp;<span class="op" id="2820215">==</span>&nbsp;<span class="ident" id="2820218">b</span><span class="op" id="2820219">.</span><span class="ident" id="2820220">w</span>&nbsp;<span class="op" id="2820222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2820226">return</span>&nbsp;<span class="num" id="2820233">0</span><span class="op" id="2820234">,</span>&nbsp;<span class="num" id="2820236">0</span><span class="op" id="2820237">,</span>&nbsp;<span class="ident" id="2820239">b</span><span class="op" id="2820240">.</span><span class="ident" id="2820241">readErr</span><span class="op" id="2820248">(</span><span class="op" id="2820249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2820252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2820255">r</span><span class="op" id="2820256">,</span>&nbsp;<span class="ident" id="2820258">size</span>&nbsp;<span class="op" id="2820263">=</span>&nbsp;<span class="builtintype" id="2820265">rune</span><span class="op" id="2820269">(</span><span class="ident" id="2820270">b</span><span class="op" id="2820271">.</span><span class="ident" id="2820272">buf</span><span class="op" id="2820275">[</span><span class="ident" id="2820276">b</span><span class="op" id="2820277">.</span><span class="ident" id="2820278">r</span><span class="op" id="2820279">]</span><span class="op" id="2820280">)</span><span class="op" id="2820281">,</span>&nbsp;<span class="num" id="2820283">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2820286">if</span>&nbsp;<span class="ident" id="2820289">r</span>&nbsp;<span class="op" id="2820291">&gt;=</span>&nbsp;<span class="num" id="2820294">0x80</span>&nbsp;<span class="op" id="2820299">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2820303">r</span><span class="op" id="2820304">,</span>&nbsp;<span class="ident" id="2820306">size</span>&nbsp;<span class="op" id="2820311">=</span>&nbsp;<span class="ident" id="2820313">utf8</span><span class="op" id="2820317">.</span><span class="ident" id="2820318">DecodeRune</span><span class="op" id="2820328">(</span><span class="ident" id="2820329">b</span><span class="op" id="2820330">.</span><span class="ident" id="2820331">buf</span><span class="op" id="2820334">[</span><span class="ident" id="2820335">b</span><span class="op" id="2820336">.</span><span class="ident" id="2820337">r</span><span class="op" id="2820338">:</span><span class="ident" id="2820339">b</span><span class="op" id="2820340">.</span><span class="ident" id="2820341">w</span><span class="op" id="2820342">]</span><span class="op" id="2820343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2820346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2820349">b</span><span class="op" id="2820350">.</span><span class="ident" id="2820351">r</span>&nbsp;<span class="op" id="2820353">+=</span>&nbsp;<span class="ident" id="2820356">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2820362">b</span><span class="op" id="2820363">.</span><span class="ident" id="2820364">lastByte</span>&nbsp;<span class="op" id="2820373">=</span>&nbsp;<span class="builtintype" id="2820375">int</span><span class="op" id="2820378">(</span><span class="ident" id="2820379">b</span><span class="op" id="2820380">.</span><span class="ident" id="2820381">buf</span><span class="op" id="2820384">[</span><span class="ident" id="2820385">b</span><span class="op" id="2820386">.</span><span class="ident" id="2820387">r</span><span class="op" id="2820388">-</span><span class="num" id="2820389">1</span><span class="op" id="2820390">]</span><span class="op" id="2820391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2820394">b</span><span class="op" id="2820395">.</span><span class="ident" id="2820396">lastRuneSize</span>&nbsp;<span class="op" id="2820409">=</span>&nbsp;<span class="ident" id="2820411">size</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2820417">return</span>&nbsp;<span class="ident" id="2820424">r</span><span class="op" id="2820425">,</span>&nbsp;<span class="ident" id="2820427">size</span><span class="op" id="2820431">,</span>&nbsp;<span class="builtintype" id="2820433">nil</span><br>
<span class="lineno"></span><span class="op" id="2820437">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2820440">//&nbsp;UnreadRune&nbsp;unreads&nbsp;the&nbsp;last&nbsp;rune.&nbsp;&nbsp;If&nbsp;the&nbsp;most&nbsp;recent&nbsp;read&nbsp;operation&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="2820515">//&nbsp;the&nbsp;buffer&nbsp;was&nbsp;not&nbsp;a&nbsp;ReadRune,&nbsp;UnreadRune&nbsp;returns&nbsp;an&nbsp;error.&nbsp;&nbsp;(In&nbsp;this</span><br>
<span class="lineno">245</span><span class="comment" id="2820588">//&nbsp;regard&nbsp;it&nbsp;is&nbsp;stricter&nbsp;than&nbsp;UnreadByte,&nbsp;which&nbsp;will&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="2820662">//&nbsp;from&nbsp;any&nbsp;read&nbsp;operation.)</span><br>
<span class="lineno"></span><span class="keyword" id="2820691">func</span>&nbsp;<span class="op" id="2820696">(</span><span class="ident" id="2820697">b</span>&nbsp;<span class="op" id="2820699">*</span><span class="ident" id="2820700">Reader</span><span class="op" id="2820706">)</span>&nbsp;<span class="ident" id="2820708">UnreadRune</span><span class="op" id="2820718">(</span><span class="op" id="2820719">)</span>&nbsp;<span class="builtintype" id="2820721">error</span>&nbsp;<span class="op" id="2820727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2820730">if</span>&nbsp;<span class="ident" id="2820733">b</span><span class="op" id="2820734">.</span><span class="ident" id="2820735">lastRuneSize</span>&nbsp;<span class="op" id="2820748">&lt;</span>&nbsp;<span class="num" id="2820750">0</span>&nbsp;<span class="op" id="2820752">||</span>&nbsp;<span class="ident" id="2820755">b</span><span class="op" id="2820756">.</span><span class="ident" id="2820757">r</span>&nbsp;<span class="op" id="2820759">&lt;</span>&nbsp;<span class="ident" id="2820761">b</span><span class="op" id="2820762">.</span><span class="ident" id="2820763">lastRuneSize</span>&nbsp;<span class="op" id="2820776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2820780">return</span>&nbsp;<span class="ident" id="2820787">ErrInvalidUnreadRune</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2820809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2820812">b</span><span class="op" id="2820813">.</span><span class="ident" id="2820814">r</span>&nbsp;<span class="op" id="2820816">-=</span>&nbsp;<span class="ident" id="2820819">b</span><span class="op" id="2820820">.</span><span class="ident" id="2820821">lastRuneSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2820835">b</span><span class="op" id="2820836">.</span><span class="ident" id="2820837">lastByte</span>&nbsp;<span class="op" id="2820846">=</span>&nbsp;<span class="op" id="2820848">-</span><span class="num" id="2820849">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2820852">b</span><span class="op" id="2820853">.</span><span class="ident" id="2820854">lastRuneSize</span>&nbsp;<span class="op" id="2820867">=</span>&nbsp;<span class="op" id="2820869">-</span><span class="num" id="2820870">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2820873">return</span>&nbsp;<span class="builtintype" id="2820880">nil</span><br>
<span class="lineno">255</span><span class="op" id="2820884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2820887">//&nbsp;Buffered&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;that&nbsp;can&nbsp;be&nbsp;read&nbsp;from&nbsp;the&nbsp;current&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2820969">func</span>&nbsp;<span class="op" id="2820974">(</span><span class="ident" id="2820975">b</span>&nbsp;<span class="op" id="2820977">*</span><span class="ident" id="2820978">Reader</span><span class="op" id="2820984">)</span>&nbsp;<span class="ident" id="2820986">Buffered</span><span class="op" id="2820994">(</span><span class="op" id="2820995">)</span>&nbsp;<span class="builtintype" id="2820997">int</span>&nbsp;<span class="op" id="2821001">{</span>&nbsp;<span class="keyword" id="2821003">return</span>&nbsp;<span class="ident" id="2821010">b</span><span class="op" id="2821011">.</span><span class="ident" id="2821012">w</span>&nbsp;<span class="op" id="2821014">-</span>&nbsp;<span class="ident" id="2821016">b</span><span class="op" id="2821017">.</span><span class="ident" id="2821018">r</span>&nbsp;<span class="op" id="2821020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="2821023">//&nbsp;ReadSlice&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="2821092">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;pointing&nbsp;at&nbsp;the&nbsp;bytes&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="2821150">//&nbsp;The&nbsp;bytes&nbsp;stop&nbsp;being&nbsp;valid&nbsp;at&nbsp;the&nbsp;next&nbsp;read.</span><br>
<span class="lineno"></span><span class="comment" id="2821198">//&nbsp;If&nbsp;ReadSlice&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="2821262">//&nbsp;it&nbsp;returns&nbsp;all&nbsp;the&nbsp;data&nbsp;in&nbsp;the&nbsp;buffer&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">265</span><span class="comment" id="2821340">//&nbsp;ReadSlice&nbsp;fails&nbsp;with&nbsp;error&nbsp;ErrBufferFull&nbsp;if&nbsp;the&nbsp;buffer&nbsp;fills&nbsp;without&nbsp;a&nbsp;delim.</span><br>
<span class="lineno"></span><span class="comment" id="2821421">//&nbsp;Because&nbsp;the&nbsp;data&nbsp;returned&nbsp;from&nbsp;ReadSlice&nbsp;will&nbsp;be&nbsp;overwritten</span><br>
<span class="lineno"></span><span class="comment" id="2821485">//&nbsp;by&nbsp;the&nbsp;next&nbsp;I/O&nbsp;operation,&nbsp;most&nbsp;clients&nbsp;should&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="2821539">//&nbsp;ReadBytes&nbsp;or&nbsp;ReadString&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="2821575">//&nbsp;ReadSlice&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;line&nbsp;does&nbsp;not&nbsp;end&nbsp;in&nbsp;delim.</span><br>
<span class="lineno">270</span><span class="keyword" id="2821650">func</span>&nbsp;<span class="op" id="2821655">(</span><span class="ident" id="2821656">b</span>&nbsp;<span class="op" id="2821658">*</span><span class="ident" id="2821659">Reader</span><span class="op" id="2821665">)</span>&nbsp;<span class="ident" id="2821667">ReadSlice</span><span class="op" id="2821676">(</span><span class="ident" id="2821677">delim</span>&nbsp;<span class="builtintype" id="2821683">byte</span><span class="op" id="2821687">)</span>&nbsp;<span class="op" id="2821689">(</span><span class="ident" id="2821690">line</span>&nbsp;<span class="op" id="2821695">[</span><span class="op" id="2821696">]</span><span class="builtintype" id="2821697">byte</span><span class="op" id="2821701">,</span>&nbsp;<span class="ident" id="2821703">err</span>&nbsp;<span class="builtintype" id="2821707">error</span><span class="op" id="2821712">)</span>&nbsp;<span class="op" id="2821714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2821717">for</span>&nbsp;<span class="op" id="2821721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2821725">//&nbsp;Search&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2821745">if</span>&nbsp;<span class="ident" id="2821748">i</span>&nbsp;<span class="op" id="2821750">:=</span>&nbsp;<span class="ident" id="2821753">bytes</span><span class="op" id="2821758">.</span><span class="ident" id="2821759">IndexByte</span><span class="op" id="2821768">(</span><span class="ident" id="2821769">b</span><span class="op" id="2821770">.</span><span class="ident" id="2821771">buf</span><span class="op" id="2821774">[</span><span class="ident" id="2821775">b</span><span class="op" id="2821776">.</span><span class="ident" id="2821777">r</span><span class="op" id="2821778">:</span><span class="ident" id="2821779">b</span><span class="op" id="2821780">.</span><span class="ident" id="2821781">w</span><span class="op" id="2821782">]</span><span class="op" id="2821783">,</span>&nbsp;<span class="ident" id="2821785">delim</span><span class="op" id="2821790">)</span><span class="op" id="2821791">;</span>&nbsp;<span class="ident" id="2821793">i</span>&nbsp;<span class="op" id="2821795">&gt;=</span>&nbsp;<span class="num" id="2821798">0</span>&nbsp;<span class="op" id="2821800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2821805">line</span>&nbsp;<span class="op" id="2821810">=</span>&nbsp;<span class="ident" id="2821812">b</span><span class="op" id="2821813">.</span><span class="ident" id="2821814">buf</span><span class="op" id="2821817">[</span><span class="ident" id="2821818">b</span><span class="op" id="2821819">.</span><span class="ident" id="2821820">r</span>&nbsp;<span class="op" id="2821822">:</span>&nbsp;<span class="ident" id="2821824">b</span><span class="op" id="2821825">.</span><span class="ident" id="2821826">r</span><span class="op" id="2821827">+</span><span class="ident" id="2821828">i</span><span class="op" id="2821829">+</span><span class="num" id="2821830">1</span><span class="op" id="2821831">]</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2821836">b</span><span class="op" id="2821837">.</span><span class="ident" id="2821838">r</span>&nbsp;<span class="op" id="2821840">+=</span>&nbsp;<span class="ident" id="2821843">i</span>&nbsp;<span class="op" id="2821845">+</span>&nbsp;<span class="num" id="2821847">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2821852">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2821860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2821865">//&nbsp;Pending&nbsp;error?</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2821885">if</span>&nbsp;<span class="ident" id="2821888">b</span><span class="op" id="2821889">.</span><span class="ident" id="2821890">err</span>&nbsp;<span class="op" id="2821894">!=</span>&nbsp;<span class="builtintype" id="2821897">nil</span>&nbsp;<span class="op" id="2821901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2821906">line</span>&nbsp;<span class="op" id="2821911">=</span>&nbsp;<span class="ident" id="2821913">b</span><span class="op" id="2821914">.</span><span class="ident" id="2821915">buf</span><span class="op" id="2821918">[</span><span class="ident" id="2821919">b</span><span class="op" id="2821920">.</span><span class="ident" id="2821921">r</span><span class="op" id="2821922">:</span><span class="ident" id="2821923">b</span><span class="op" id="2821924">.</span><span class="ident" id="2821925">w</span><span class="op" id="2821926">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2821931">b</span><span class="op" id="2821932">.</span><span class="ident" id="2821933">r</span>&nbsp;<span class="op" id="2821935">=</span>&nbsp;<span class="ident" id="2821937">b</span><span class="op" id="2821938">.</span><span class="ident" id="2821939">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2821944">err</span>&nbsp;<span class="op" id="2821948">=</span>&nbsp;<span class="ident" id="2821950">b</span><span class="op" id="2821951">.</span><span class="ident" id="2821952">readErr</span><span class="op" id="2821959">(</span><span class="op" id="2821960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2821965">break</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2821973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2821978">//&nbsp;Buffer&nbsp;full?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2821996">if</span>&nbsp;<span class="ident" id="2821999">b</span><span class="op" id="2822000">.</span><span class="ident" id="2822001">Buffered</span><span class="op" id="2822009">(</span><span class="op" id="2822010">)</span>&nbsp;<span class="op" id="2822012">&gt;=</span>&nbsp;<span class="builtinfunc" id="2822015">len</span><span class="op" id="2822018">(</span><span class="ident" id="2822019">b</span><span class="op" id="2822020">.</span><span class="ident" id="2822021">buf</span><span class="op" id="2822024">)</span>&nbsp;<span class="op" id="2822026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2822031">b</span><span class="op" id="2822032">.</span><span class="ident" id="2822033">r</span>&nbsp;<span class="op" id="2822035">=</span>&nbsp;<span class="ident" id="2822037">b</span><span class="op" id="2822038">.</span><span class="ident" id="2822039">w</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2822044">line</span>&nbsp;<span class="op" id="2822049">=</span>&nbsp;<span class="ident" id="2822051">b</span><span class="op" id="2822052">.</span><span class="ident" id="2822053">buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2822060">err</span>&nbsp;<span class="op" id="2822064">=</span>&nbsp;<span class="ident" id="2822066">ErrBufferFull</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2822083">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2822091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2822096">b</span><span class="op" id="2822097">.</span><span class="ident" id="2822098">fill</span><span class="op" id="2822102">(</span><span class="op" id="2822103">)</span>&nbsp;<span class="comment" id="2822105">//&nbsp;buffer&nbsp;is&nbsp;not&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2822128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2822132">//&nbsp;Handle&nbsp;last&nbsp;byte,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2822162">if</span>&nbsp;<span class="ident" id="2822165">i</span>&nbsp;<span class="op" id="2822167">:=</span>&nbsp;<span class="builtinfunc" id="2822170">len</span><span class="op" id="2822173">(</span><span class="ident" id="2822174">line</span><span class="op" id="2822178">)</span>&nbsp;<span class="op" id="2822180">-</span>&nbsp;<span class="num" id="2822182">1</span><span class="op" id="2822183">;</span>&nbsp;<span class="ident" id="2822185">i</span>&nbsp;<span class="op" id="2822187">&gt;=</span>&nbsp;<span class="num" id="2822190">0</span>&nbsp;<span class="op" id="2822192">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2822196">b</span><span class="op" id="2822197">.</span><span class="ident" id="2822198">lastByte</span>&nbsp;<span class="op" id="2822207">=</span>&nbsp;<span class="builtintype" id="2822209">int</span><span class="op" id="2822212">(</span><span class="ident" id="2822213">line</span><span class="op" id="2822217">[</span><span class="ident" id="2822218">i</span><span class="op" id="2822219">]</span><span class="op" id="2822220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2822224">b</span><span class="op" id="2822225">.</span><span class="ident" id="2822226">lastRuneSize</span>&nbsp;<span class="op" id="2822239">=</span>&nbsp;<span class="op" id="2822241">-</span><span class="num" id="2822242">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2822245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2822249">return</span><br>
<span class="lineno">305</span><span class="op" id="2822256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2822259">//&nbsp;ReadLine&nbsp;is&nbsp;a&nbsp;low-level&nbsp;line-reading&nbsp;primitive.&nbsp;Most&nbsp;callers&nbsp;should&nbsp;use</span><br>
<span class="lineno"></span><span class="comment" id="2822334">//&nbsp;ReadBytes(&#39;\n&#39;)&nbsp;or&nbsp;ReadString(&#39;\n&#39;)&nbsp;instead&nbsp;or&nbsp;use&nbsp;a&nbsp;Scanner.</span><br>
<span class="lineno"></span><span class="comment" id="2822399">//</span><br>
<span class="lineno">310</span><span class="comment" id="2822402">//&nbsp;ReadLine&nbsp;tries&nbsp;to&nbsp;return&nbsp;a&nbsp;single&nbsp;line,&nbsp;not&nbsp;including&nbsp;the&nbsp;end-of-line&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="2822482">//&nbsp;If&nbsp;the&nbsp;line&nbsp;was&nbsp;too&nbsp;long&nbsp;for&nbsp;the&nbsp;buffer&nbsp;then&nbsp;isPrefix&nbsp;is&nbsp;set&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2822554">//&nbsp;beginning&nbsp;of&nbsp;the&nbsp;line&nbsp;is&nbsp;returned.&nbsp;The&nbsp;rest&nbsp;of&nbsp;the&nbsp;line&nbsp;will&nbsp;be&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="2822630">//&nbsp;from&nbsp;future&nbsp;calls.&nbsp;isPrefix&nbsp;will&nbsp;be&nbsp;false&nbsp;when&nbsp;returning&nbsp;the&nbsp;last&nbsp;fragment</span><br>
<span class="lineno"></span><span class="comment" id="2822708">//&nbsp;of&nbsp;the&nbsp;line.&nbsp;The&nbsp;returned&nbsp;buffer&nbsp;is&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to</span><br>
<span class="lineno">315</span><span class="comment" id="2822781">//&nbsp;ReadLine.&nbsp;ReadLine&nbsp;either&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;line&nbsp;or&nbsp;it&nbsp;returns&nbsp;an&nbsp;error,</span><br>
<span class="lineno"></span><span class="comment" id="2822857">//&nbsp;never&nbsp;both.</span><br>
<span class="lineno"></span><span class="comment" id="2822872">//</span><br>
<span class="lineno"></span><span class="comment" id="2822875">//&nbsp;The&nbsp;text&nbsp;returned&nbsp;from&nbsp;ReadLine&nbsp;does&nbsp;not&nbsp;include&nbsp;the&nbsp;line&nbsp;end&nbsp;(&#34;\r\n&#34;&nbsp;or&nbsp;&#34;\n&#34;).</span><br>
<span class="lineno"></span><span class="comment" id="2822958">//&nbsp;No&nbsp;indication&nbsp;or&nbsp;error&nbsp;is&nbsp;given&nbsp;if&nbsp;the&nbsp;input&nbsp;ends&nbsp;without&nbsp;a&nbsp;final&nbsp;line&nbsp;end.</span><br>
<span class="lineno">320</span><span class="comment" id="2823037">//&nbsp;Calling&nbsp;UnreadByte&nbsp;after&nbsp;ReadLine&nbsp;will&nbsp;always&nbsp;unread&nbsp;the&nbsp;last&nbsp;byte&nbsp;read</span><br>
<span class="lineno"></span><span class="comment" id="2823112">//&nbsp;(possibly&nbsp;a&nbsp;character&nbsp;belonging&nbsp;to&nbsp;the&nbsp;line&nbsp;end)&nbsp;even&nbsp;if&nbsp;that&nbsp;byte&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="2823189">//&nbsp;part&nbsp;of&nbsp;the&nbsp;line&nbsp;returned&nbsp;by&nbsp;ReadLine.</span><br>
<span class="lineno"></span><span class="keyword" id="2823231">func</span>&nbsp;<span class="op" id="2823236">(</span><span class="ident" id="2823237">b</span>&nbsp;<span class="op" id="2823239">*</span><span class="ident" id="2823240">Reader</span><span class="op" id="2823246">)</span>&nbsp;<span class="ident" id="2823248">ReadLine</span><span class="op" id="2823256">(</span><span class="op" id="2823257">)</span>&nbsp;<span class="op" id="2823259">(</span><span class="ident" id="2823260">line</span>&nbsp;<span class="op" id="2823265">[</span><span class="op" id="2823266">]</span><span class="builtintype" id="2823267">byte</span><span class="op" id="2823271">,</span>&nbsp;<span class="ident" id="2823273">isPrefix</span>&nbsp;<span class="builtintype" id="2823282">bool</span><span class="op" id="2823286">,</span>&nbsp;<span class="ident" id="2823288">err</span>&nbsp;<span class="builtintype" id="2823292">error</span><span class="op" id="2823297">)</span>&nbsp;<span class="op" id="2823299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2823302">line</span><span class="op" id="2823306">,</span>&nbsp;<span class="ident" id="2823308">err</span>&nbsp;<span class="op" id="2823312">=</span>&nbsp;<span class="ident" id="2823314">b</span><span class="op" id="2823315">.</span><span class="ident" id="2823316">ReadSlice</span><span class="op" id="2823325">(</span><span class="string" id="2823326">&#39;\n&#39;</span><span class="op" id="2823330">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2823333">if</span>&nbsp;<span class="ident" id="2823336">err</span>&nbsp;<span class="op" id="2823340">==</span>&nbsp;<span class="ident" id="2823343">ErrBufferFull</span>&nbsp;<span class="op" id="2823357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2823361">//&nbsp;Handle&nbsp;the&nbsp;case&nbsp;where&nbsp;&#34;\r\n&#34;&nbsp;straddles&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2823417">if</span>&nbsp;<span class="builtinfunc" id="2823420">len</span><span class="op" id="2823423">(</span><span class="ident" id="2823424">line</span><span class="op" id="2823428">)</span>&nbsp;<span class="op" id="2823430">&gt;</span>&nbsp;<span class="num" id="2823432">0</span>&nbsp;<span class="op" id="2823434">&amp;&amp;</span>&nbsp;<span class="ident" id="2823437">line</span><span class="op" id="2823441">[</span><span class="builtinfunc" id="2823442">len</span><span class="op" id="2823445">(</span><span class="ident" id="2823446">line</span><span class="op" id="2823450">)</span><span class="op" id="2823451">-</span><span class="num" id="2823452">1</span><span class="op" id="2823453">]</span>&nbsp;<span class="op" id="2823455">==</span>&nbsp;<span class="string" id="2823458">&#39;\r&#39;</span>&nbsp;<span class="op" id="2823463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2823468">//&nbsp;Put&nbsp;the&nbsp;&#39;\r&#39;&nbsp;back&nbsp;on&nbsp;buf&nbsp;and&nbsp;drop&nbsp;it&nbsp;from&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2823522">//&nbsp;Let&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;ReadLine&nbsp;check&nbsp;for&nbsp;&#34;\r\n&#34;.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2823576">if</span>&nbsp;<span class="ident" id="2823579">b</span><span class="op" id="2823580">.</span><span class="ident" id="2823581">r</span>&nbsp;<span class="op" id="2823583">==</span>&nbsp;<span class="num" id="2823586">0</span>&nbsp;<span class="op" id="2823588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2823594">//&nbsp;should&nbsp;be&nbsp;unreachable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2823623">panic</span><span class="op" id="2823628">(</span><span class="string" id="2823629">&#34;bufio:&nbsp;tried&nbsp;to&nbsp;rewind&nbsp;past&nbsp;start&nbsp;of&nbsp;buffer&#34;</span><span class="op" id="2823674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2823679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2823684">b</span><span class="op" id="2823685">.</span><span class="ident" id="2823686">r</span><span class="op" id="2823687">--</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2823693">line</span>&nbsp;<span class="op" id="2823698">=</span>&nbsp;<span class="ident" id="2823700">line</span><span class="op" id="2823704">[</span><span class="op" id="2823705">:</span><span class="builtinfunc" id="2823706">len</span><span class="op" id="2823709">(</span><span class="ident" id="2823710">line</span><span class="op" id="2823714">)</span><span class="op" id="2823715">-</span><span class="num" id="2823716">1</span><span class="op" id="2823717">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2823721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2823725">return</span>&nbsp;<span class="ident" id="2823732">line</span><span class="op" id="2823736">,</span>&nbsp;<span class="builtintype" id="2823738">true</span><span class="op" id="2823742">,</span>&nbsp;<span class="builtintype" id="2823744">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2823749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2823753">if</span>&nbsp;<span class="builtinfunc" id="2823756">len</span><span class="op" id="2823759">(</span><span class="ident" id="2823760">line</span><span class="op" id="2823764">)</span>&nbsp;<span class="op" id="2823766">==</span>&nbsp;<span class="num" id="2823769">0</span>&nbsp;<span class="op" id="2823771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2823775">if</span>&nbsp;<span class="ident" id="2823778">err</span>&nbsp;<span class="op" id="2823782">!=</span>&nbsp;<span class="builtintype" id="2823785">nil</span>&nbsp;<span class="op" id="2823789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2823794">line</span>&nbsp;<span class="op" id="2823799">=</span>&nbsp;<span class="builtintype" id="2823801">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2823807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2823811">return</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2823819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2823822">err</span>&nbsp;<span class="op" id="2823826">=</span>&nbsp;<span class="builtintype" id="2823828">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2823834">if</span>&nbsp;<span class="ident" id="2823837">line</span><span class="op" id="2823841">[</span><span class="builtinfunc" id="2823842">len</span><span class="op" id="2823845">(</span><span class="ident" id="2823846">line</span><span class="op" id="2823850">)</span><span class="op" id="2823851">-</span><span class="num" id="2823852">1</span><span class="op" id="2823853">]</span>&nbsp;<span class="op" id="2823855">==</span>&nbsp;<span class="string" id="2823858">&#39;\n&#39;</span>&nbsp;<span class="op" id="2823863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2823867">drop</span>&nbsp;<span class="op" id="2823872">:=</span>&nbsp;<span class="num" id="2823875">1</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2823879">if</span>&nbsp;<span class="builtinfunc" id="2823882">len</span><span class="op" id="2823885">(</span><span class="ident" id="2823886">line</span><span class="op" id="2823890">)</span>&nbsp;<span class="op" id="2823892">&gt;</span>&nbsp;<span class="num" id="2823894">1</span>&nbsp;<span class="op" id="2823896">&amp;&amp;</span>&nbsp;<span class="ident" id="2823899">line</span><span class="op" id="2823903">[</span><span class="builtinfunc" id="2823904">len</span><span class="op" id="2823907">(</span><span class="ident" id="2823908">line</span><span class="op" id="2823912">)</span><span class="op" id="2823913">-</span><span class="num" id="2823914">2</span><span class="op" id="2823915">]</span>&nbsp;<span class="op" id="2823917">==</span>&nbsp;<span class="string" id="2823920">&#39;\r&#39;</span>&nbsp;<span class="op" id="2823925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2823930">drop</span>&nbsp;<span class="op" id="2823935">=</span>&nbsp;<span class="num" id="2823937">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2823941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2823945">line</span>&nbsp;<span class="op" id="2823950">=</span>&nbsp;<span class="ident" id="2823952">line</span><span class="op" id="2823956">[</span><span class="op" id="2823957">:</span><span class="builtinfunc" id="2823958">len</span><span class="op" id="2823961">(</span><span class="ident" id="2823962">line</span><span class="op" id="2823966">)</span><span class="op" id="2823967">-</span><span class="ident" id="2823968">drop</span><span class="op" id="2823972">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2823975">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2823978">return</span><br>
<span class="lineno"></span><span class="op" id="2823985">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2823988">//&nbsp;ReadBytes&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="2824057">//&nbsp;returning&nbsp;a&nbsp;slice&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno">360</span><span class="comment" id="2824133">//&nbsp;If&nbsp;ReadBytes&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="2824197">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno"></span><span class="comment" id="2824279">//&nbsp;ReadBytes&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="2824360">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="comment" id="2824370">//&nbsp;For&nbsp;simple&nbsp;uses,&nbsp;a&nbsp;Scanner&nbsp;may&nbsp;be&nbsp;more&nbsp;convenient.</span><br>
<span class="lineno">365</span><span class="keyword" id="2824424">func</span>&nbsp;<span class="op" id="2824429">(</span><span class="ident" id="2824430">b</span>&nbsp;<span class="op" id="2824432">*</span><span class="ident" id="2824433">Reader</span><span class="op" id="2824439">)</span>&nbsp;<span class="ident" id="2824441">ReadBytes</span><span class="op" id="2824450">(</span><span class="ident" id="2824451">delim</span>&nbsp;<span class="builtintype" id="2824457">byte</span><span class="op" id="2824461">)</span>&nbsp;<span class="op" id="2824463">(</span><span class="ident" id="2824464">line</span>&nbsp;<span class="op" id="2824469">[</span><span class="op" id="2824470">]</span><span class="builtintype" id="2824471">byte</span><span class="op" id="2824475">,</span>&nbsp;<span class="ident" id="2824477">err</span>&nbsp;<span class="builtintype" id="2824481">error</span><span class="op" id="2824486">)</span>&nbsp;<span class="op" id="2824488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2824491">//&nbsp;Use&nbsp;ReadSlice&nbsp;to&nbsp;look&nbsp;for&nbsp;array,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2824528">//&nbsp;accumulating&nbsp;full&nbsp;buffers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2824559">var</span>&nbsp;<span class="ident" id="2824563">frag</span>&nbsp;<span class="op" id="2824568">[</span><span class="op" id="2824569">]</span><span class="builtintype" id="2824570">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2824576">var</span>&nbsp;<span class="ident" id="2824580">full</span>&nbsp;<span class="op" id="2824585">[</span><span class="op" id="2824586">]</span><span class="op" id="2824587">[</span><span class="op" id="2824588">]</span><span class="builtintype" id="2824589">byte</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2824595">err</span>&nbsp;<span class="op" id="2824599">=</span>&nbsp;<span class="builtintype" id="2824601">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2824607">for</span>&nbsp;<span class="op" id="2824611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2824615">var</span>&nbsp;<span class="ident" id="2824619">e</span>&nbsp;<span class="builtintype" id="2824621">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2824629">frag</span><span class="op" id="2824633">,</span>&nbsp;<span class="ident" id="2824635">e</span>&nbsp;<span class="op" id="2824637">=</span>&nbsp;<span class="ident" id="2824639">b</span><span class="op" id="2824640">.</span><span class="ident" id="2824641">ReadSlice</span><span class="op" id="2824650">(</span><span class="ident" id="2824651">delim</span><span class="op" id="2824656">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2824660">if</span>&nbsp;<span class="ident" id="2824663">e</span>&nbsp;<span class="op" id="2824665">==</span>&nbsp;<span class="builtintype" id="2824668">nil</span>&nbsp;<span class="op" id="2824672">{</span>&nbsp;<span class="comment" id="2824674">//&nbsp;got&nbsp;final&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2824699">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2824707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2824711">if</span>&nbsp;<span class="ident" id="2824714">e</span>&nbsp;<span class="op" id="2824716">!=</span>&nbsp;<span class="ident" id="2824719">ErrBufferFull</span>&nbsp;<span class="op" id="2824733">{</span>&nbsp;<span class="comment" id="2824735">//&nbsp;unexpected&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2824758">err</span>&nbsp;<span class="op" id="2824762">=</span>&nbsp;<span class="ident" id="2824764">e</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2824769">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2824777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2824782">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2824814">buf</span>&nbsp;<span class="op" id="2824818">:=</span>&nbsp;<span class="builtinfunc" id="2824821">make</span><span class="op" id="2824825">(</span><span class="op" id="2824826">[</span><span class="op" id="2824827">]</span><span class="builtintype" id="2824828">byte</span><span class="op" id="2824832">,</span>&nbsp;<span class="builtinfunc" id="2824834">len</span><span class="op" id="2824837">(</span><span class="ident" id="2824838">frag</span><span class="op" id="2824842">)</span><span class="op" id="2824843">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2824847">copy</span><span class="op" id="2824851">(</span><span class="ident" id="2824852">buf</span><span class="op" id="2824855">,</span>&nbsp;<span class="ident" id="2824857">frag</span><span class="op" id="2824861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2824865">full</span>&nbsp;<span class="op" id="2824870">=</span>&nbsp;<span class="builtinfunc" id="2824872">append</span><span class="op" id="2824878">(</span><span class="ident" id="2824879">full</span><span class="op" id="2824883">,</span>&nbsp;<span class="ident" id="2824885">buf</span><span class="op" id="2824888">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2824891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2824895">//&nbsp;Allocate&nbsp;new&nbsp;buffer&nbsp;to&nbsp;hold&nbsp;the&nbsp;full&nbsp;pieces&nbsp;and&nbsp;the&nbsp;fragment.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2824961">n</span>&nbsp;<span class="op" id="2824963">:=</span>&nbsp;<span class="num" id="2824966">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2824969">for</span>&nbsp;<span class="ident" id="2824973">i</span>&nbsp;<span class="op" id="2824975">:=</span>&nbsp;<span class="keyword" id="2824978">range</span>&nbsp;<span class="ident" id="2824984">full</span>&nbsp;<span class="op" id="2824989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2824993">n</span>&nbsp;<span class="op" id="2824995">+=</span>&nbsp;<span class="builtinfunc" id="2824998">len</span><span class="op" id="2825001">(</span><span class="ident" id="2825002">full</span><span class="op" id="2825006">[</span><span class="ident" id="2825007">i</span><span class="op" id="2825008">]</span><span class="op" id="2825009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2825012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2825015">n</span>&nbsp;<span class="op" id="2825017">+=</span>&nbsp;<span class="builtinfunc" id="2825020">len</span><span class="op" id="2825023">(</span><span class="ident" id="2825024">frag</span><span class="op" id="2825028">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2825032">//&nbsp;Copy&nbsp;full&nbsp;pieces&nbsp;and&nbsp;fragment&nbsp;in.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2825070">buf</span>&nbsp;<span class="op" id="2825074">:=</span>&nbsp;<span class="builtinfunc" id="2825077">make</span><span class="op" id="2825081">(</span><span class="op" id="2825082">[</span><span class="op" id="2825083">]</span><span class="builtintype" id="2825084">byte</span><span class="op" id="2825088">,</span>&nbsp;<span class="ident" id="2825090">n</span><span class="op" id="2825091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2825094">n</span>&nbsp;<span class="op" id="2825096">=</span>&nbsp;<span class="num" id="2825098">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2825101">for</span>&nbsp;<span class="ident" id="2825105">i</span>&nbsp;<span class="op" id="2825107">:=</span>&nbsp;<span class="keyword" id="2825110">range</span>&nbsp;<span class="ident" id="2825116">full</span>&nbsp;<span class="op" id="2825121">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2825125">n</span>&nbsp;<span class="op" id="2825127">+=</span>&nbsp;<span class="builtinfunc" id="2825130">copy</span><span class="op" id="2825134">(</span><span class="ident" id="2825135">buf</span><span class="op" id="2825138">[</span><span class="ident" id="2825139">n</span><span class="op" id="2825140">:</span><span class="op" id="2825141">]</span><span class="op" id="2825142">,</span>&nbsp;<span class="ident" id="2825144">full</span><span class="op" id="2825148">[</span><span class="ident" id="2825149">i</span><span class="op" id="2825150">]</span><span class="op" id="2825151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2825154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2825157">copy</span><span class="op" id="2825161">(</span><span class="ident" id="2825162">buf</span><span class="op" id="2825165">[</span><span class="ident" id="2825166">n</span><span class="op" id="2825167">:</span><span class="op" id="2825168">]</span><span class="op" id="2825169">,</span>&nbsp;<span class="ident" id="2825171">frag</span><span class="op" id="2825175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2825178">return</span>&nbsp;<span class="ident" id="2825185">buf</span><span class="op" id="2825188">,</span>&nbsp;<span class="ident" id="2825190">err</span><br>
<span class="lineno"></span><span class="op" id="2825194">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="2825197">//&nbsp;ReadString&nbsp;reads&nbsp;until&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;delim&nbsp;in&nbsp;the&nbsp;input,</span><br>
<span class="lineno"></span><span class="comment" id="2825267">//&nbsp;returning&nbsp;a&nbsp;string&nbsp;containing&nbsp;the&nbsp;data&nbsp;up&nbsp;to&nbsp;and&nbsp;including&nbsp;the&nbsp;delimiter.</span><br>
<span class="lineno"></span><span class="comment" id="2825344">//&nbsp;If&nbsp;ReadString&nbsp;encounters&nbsp;an&nbsp;error&nbsp;before&nbsp;finding&nbsp;a&nbsp;delimiter,</span><br>
<span class="lineno"></span><span class="comment" id="2825409">//&nbsp;it&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;before&nbsp;the&nbsp;error&nbsp;and&nbsp;the&nbsp;error&nbsp;itself&nbsp;(often&nbsp;io.EOF).</span><br>
<span class="lineno">410</span><span class="comment" id="2825491">//&nbsp;ReadString&nbsp;returns&nbsp;err&nbsp;!=&nbsp;nil&nbsp;if&nbsp;and&nbsp;only&nbsp;if&nbsp;the&nbsp;returned&nbsp;data&nbsp;does&nbsp;not&nbsp;end&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="2825573">//&nbsp;delim.</span><br>
<span class="lineno"></span><span class="comment" id="2825583">//&nbsp;For&nbsp;simple&nbsp;uses,&nbsp;a&nbsp;Scanner&nbsp;may&nbsp;be&nbsp;more&nbsp;convenient.</span><br>
<span class="lineno"></span><span class="keyword" id="2825637">func</span>&nbsp;<span class="op" id="2825642">(</span><span class="ident" id="2825643">b</span>&nbsp;<span class="op" id="2825645">*</span><span class="ident" id="2825646">Reader</span><span class="op" id="2825652">)</span>&nbsp;<span class="ident" id="2825654">ReadString</span><span class="op" id="2825664">(</span><span class="ident" id="2825665">delim</span>&nbsp;<span class="builtintype" id="2825671">byte</span><span class="op" id="2825675">)</span>&nbsp;<span class="op" id="2825677">(</span><span class="ident" id="2825678">line</span>&nbsp;<span class="builtintype" id="2825683">string</span><span class="op" id="2825689">,</span>&nbsp;<span class="ident" id="2825691">err</span>&nbsp;<span class="builtintype" id="2825695">error</span><span class="op" id="2825700">)</span>&nbsp;<span class="op" id="2825702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2825705">bytes</span><span class="op" id="2825710">,</span>&nbsp;<span class="ident" id="2825712">err</span>&nbsp;<span class="op" id="2825716">:=</span>&nbsp;<span class="ident" id="2825719">b</span><span class="op" id="2825720">.</span><span class="ident" id="2825721">ReadBytes</span><span class="op" id="2825730">(</span><span class="ident" id="2825731">delim</span><span class="op" id="2825736">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2825739">line</span>&nbsp;<span class="op" id="2825744">=</span>&nbsp;<span class="builtintype" id="2825746">string</span><span class="op" id="2825752">(</span><span class="ident" id="2825753">bytes</span><span class="op" id="2825758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2825761">return</span>&nbsp;<span class="ident" id="2825768">line</span><span class="op" id="2825772">,</span>&nbsp;<span class="ident" id="2825774">err</span><br>
<span class="lineno"></span><span class="op" id="2825778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2825781">//&nbsp;WriteTo&nbsp;implements&nbsp;io.WriterTo.</span><br>
<span class="lineno">420</span><span class="keyword" id="2825816">func</span>&nbsp;<span class="op" id="2825821">(</span><span class="ident" id="2825822">b</span>&nbsp;<span class="op" id="2825824">*</span><span class="ident" id="2825825">Reader</span><span class="op" id="2825831">)</span>&nbsp;<span class="ident" id="2825833">WriteTo</span><span class="op" id="2825840">(</span><span class="ident" id="2825841">w</span>&nbsp;<span class="ident" id="2825843">io</span><span class="op" id="2825845">.</span><span class="ident" id="2825846">Writer</span><span class="op" id="2825852">)</span>&nbsp;<span class="op" id="2825854">(</span><span class="ident" id="2825855">n</span>&nbsp;<span class="ident" id="2825857">int64</span><span class="op" id="2825862">,</span>&nbsp;<span class="ident" id="2825864">err</span>&nbsp;<span class="builtintype" id="2825868">error</span><span class="op" id="2825873">)</span>&nbsp;<span class="op" id="2825875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2825878">n</span><span class="op" id="2825879">,</span>&nbsp;<span class="ident" id="2825881">err</span>&nbsp;<span class="op" id="2825885">=</span>&nbsp;<span class="ident" id="2825887">b</span><span class="op" id="2825888">.</span><span class="ident" id="2825889">writeBuf</span><span class="op" id="2825897">(</span><span class="ident" id="2825898">w</span><span class="op" id="2825899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2825902">if</span>&nbsp;<span class="ident" id="2825905">err</span>&nbsp;<span class="op" id="2825909">!=</span>&nbsp;<span class="builtintype" id="2825912">nil</span>&nbsp;<span class="op" id="2825916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2825920">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2825928">}</span><br>
<span class="lineno">425</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2825932">if</span>&nbsp;<span class="ident" id="2825935">r</span><span class="op" id="2825936">,</span>&nbsp;<span class="ident" id="2825938">ok</span>&nbsp;<span class="op" id="2825941">:=</span>&nbsp;<span class="ident" id="2825944">b</span><span class="op" id="2825945">.</span><span class="ident" id="2825946">rd</span><span class="op" id="2825948">.</span><span class="op" id="2825949">(</span><span class="ident" id="2825950">io</span><span class="op" id="2825952">.</span><span class="ident" id="2825953">WriterTo</span><span class="op" id="2825961">)</span><span class="op" id="2825962">;</span>&nbsp;<span class="ident" id="2825964">ok</span>&nbsp;<span class="op" id="2825967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2825971">m</span><span class="op" id="2825972">,</span>&nbsp;<span class="ident" id="2825974">err</span>&nbsp;<span class="op" id="2825978">:=</span>&nbsp;<span class="ident" id="2825981">r</span><span class="op" id="2825982">.</span><span class="ident" id="2825983">WriteTo</span><span class="op" id="2825990">(</span><span class="ident" id="2825991">w</span><span class="op" id="2825992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2825996">n</span>&nbsp;<span class="op" id="2825998">+=</span>&nbsp;<span class="ident" id="2826001">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2826005">return</span>&nbsp;<span class="ident" id="2826012">n</span><span class="op" id="2826013">,</span>&nbsp;<span class="ident" id="2826015">err</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2826020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2826024">if</span>&nbsp;<span class="ident" id="2826027">w</span><span class="op" id="2826028">,</span>&nbsp;<span class="ident" id="2826030">ok</span>&nbsp;<span class="op" id="2826033">:=</span>&nbsp;<span class="ident" id="2826036">w</span><span class="op" id="2826037">.</span><span class="op" id="2826038">(</span><span class="ident" id="2826039">io</span><span class="op" id="2826041">.</span><span class="ident" id="2826042">ReaderFrom</span><span class="op" id="2826052">)</span><span class="op" id="2826053">;</span>&nbsp;<span class="ident" id="2826055">ok</span>&nbsp;<span class="op" id="2826058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2826062">m</span><span class="op" id="2826063">,</span>&nbsp;<span class="ident" id="2826065">err</span>&nbsp;<span class="op" id="2826069">:=</span>&nbsp;<span class="ident" id="2826072">w</span><span class="op" id="2826073">.</span><span class="ident" id="2826074">ReadFrom</span><span class="op" id="2826082">(</span><span class="ident" id="2826083">b</span><span class="op" id="2826084">.</span><span class="ident" id="2826085">rd</span><span class="op" id="2826087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2826091">n</span>&nbsp;<span class="op" id="2826093">+=</span>&nbsp;<span class="ident" id="2826096">m</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2826100">return</span>&nbsp;<span class="ident" id="2826107">n</span><span class="op" id="2826108">,</span>&nbsp;<span class="ident" id="2826110">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2826115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2826119">if</span>&nbsp;<span class="ident" id="2826122">b</span><span class="op" id="2826123">.</span><span class="ident" id="2826124">w</span><span class="op" id="2826125">-</span><span class="ident" id="2826126">b</span><span class="op" id="2826127">.</span><span class="ident" id="2826128">r</span>&nbsp;<span class="op" id="2826130">&lt;</span>&nbsp;<span class="builtinfunc" id="2826132">len</span><span class="op" id="2826135">(</span><span class="ident" id="2826136">b</span><span class="op" id="2826137">.</span><span class="ident" id="2826138">buf</span><span class="op" id="2826141">)</span>&nbsp;<span class="op" id="2826143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2826147">b</span><span class="op" id="2826148">.</span><span class="ident" id="2826149">fill</span><span class="op" id="2826153">(</span><span class="op" id="2826154">)</span>&nbsp;<span class="comment" id="2826156">//&nbsp;buffer&nbsp;not&nbsp;full</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2826176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2826180">for</span>&nbsp;<span class="ident" id="2826184">b</span><span class="op" id="2826185">.</span><span class="ident" id="2826186">r</span>&nbsp;<span class="op" id="2826188">&lt;</span>&nbsp;<span class="ident" id="2826190">b</span><span class="op" id="2826191">.</span><span class="ident" id="2826192">w</span>&nbsp;<span class="op" id="2826194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2826198">//&nbsp;b.r&nbsp;&lt;&nbsp;b.w&nbsp;=&gt;&nbsp;buffer&nbsp;is&nbsp;not&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2826236">m</span><span class="op" id="2826237">,</span>&nbsp;<span class="ident" id="2826239">err</span>&nbsp;<span class="op" id="2826243">:=</span>&nbsp;<span class="ident" id="2826246">b</span><span class="op" id="2826247">.</span><span class="ident" id="2826248">writeBuf</span><span class="op" id="2826256">(</span><span class="ident" id="2826257">w</span><span class="op" id="2826258">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2826262">n</span>&nbsp;<span class="op" id="2826264">+=</span>&nbsp;<span class="ident" id="2826267">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2826271">if</span>&nbsp;<span class="ident" id="2826274">err</span>&nbsp;<span class="op" id="2826278">!=</span>&nbsp;<span class="builtintype" id="2826281">nil</span>&nbsp;<span class="op" id="2826285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2826290">return</span>&nbsp;<span class="ident" id="2826297">n</span><span class="op" id="2826298">,</span>&nbsp;<span class="ident" id="2826300">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2826306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2826310">b</span><span class="op" id="2826311">.</span><span class="ident" id="2826312">fill</span><span class="op" id="2826316">(</span><span class="op" id="2826317">)</span>&nbsp;<span class="comment" id="2826319">//&nbsp;buffer&nbsp;is&nbsp;empty</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2826339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2826343">if</span>&nbsp;<span class="ident" id="2826346">b</span><span class="op" id="2826347">.</span><span class="ident" id="2826348">err</span>&nbsp;<span class="op" id="2826352">==</span>&nbsp;<span class="ident" id="2826355">io</span><span class="op" id="2826357">.</span><span class="ident" id="2826358">EOF</span>&nbsp;<span class="op" id="2826362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2826366">b</span><span class="op" id="2826367">.</span><span class="ident" id="2826368">err</span>&nbsp;<span class="op" id="2826372">=</span>&nbsp;<span class="builtintype" id="2826374">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2826379">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2826383">return</span>&nbsp;<span class="ident" id="2826390">n</span><span class="op" id="2826391">,</span>&nbsp;<span class="ident" id="2826393">b</span><span class="op" id="2826394">.</span><span class="ident" id="2826395">readErr</span><span class="op" id="2826402">(</span><span class="op" id="2826403">)</span><br>
<span class="lineno"></span><span class="op" id="2826405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2826408">var</span>&nbsp;<span class="ident" id="2826412">errNegativeWrite</span>&nbsp;<span class="op" id="2826429">=</span>&nbsp;<span class="ident" id="2826431">errors</span><span class="op" id="2826437">.</span><span class="ident" id="2826438">New</span><span class="op" id="2826441">(</span><span class="string" id="2826442">&#34;bufio:&nbsp;writer&nbsp;returned&nbsp;negative&nbsp;count&nbsp;from&nbsp;Write&#34;</span><span class="op" id="2826492">)</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span><span class="comment" id="2826495">//&nbsp;writeBuf&nbsp;writes&nbsp;the&nbsp;Reader&#39;s&nbsp;buffer&nbsp;to&nbsp;the&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="2826549">func</span>&nbsp;<span class="op" id="2826554">(</span><span class="ident" id="2826555">b</span>&nbsp;<span class="op" id="2826557">*</span><span class="ident" id="2826558">Reader</span><span class="op" id="2826564">)</span>&nbsp;<span class="ident" id="2826566">writeBuf</span><span class="op" id="2826574">(</span><span class="ident" id="2826575">w</span>&nbsp;<span class="ident" id="2826577">io</span><span class="op" id="2826579">.</span><span class="ident" id="2826580">Writer</span><span class="op" id="2826586">)</span>&nbsp;<span class="op" id="2826588">(</span><span class="ident" id="2826589">int64</span><span class="op" id="2826594">,</span>&nbsp;<span class="builtintype" id="2826596">error</span><span class="op" id="2826601">)</span>&nbsp;<span class="op" id="2826603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2826606">n</span><span class="op" id="2826607">,</span>&nbsp;<span class="ident" id="2826609">err</span>&nbsp;<span class="op" id="2826613">:=</span>&nbsp;<span class="ident" id="2826616">w</span><span class="op" id="2826617">.</span><span class="ident" id="2826618">Write</span><span class="op" id="2826623">(</span><span class="ident" id="2826624">b</span><span class="op" id="2826625">.</span><span class="ident" id="2826626">buf</span><span class="op" id="2826629">[</span><span class="ident" id="2826630">b</span><span class="op" id="2826631">.</span><span class="ident" id="2826632">r</span><span class="op" id="2826633">:</span><span class="ident" id="2826634">b</span><span class="op" id="2826635">.</span><span class="ident" id="2826636">w</span><span class="op" id="2826637">]</span><span class="op" id="2826638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2826641">if</span>&nbsp;<span class="ident" id="2826644">n</span>&nbsp;<span class="op" id="2826646">&lt;</span>&nbsp;<span class="num" id="2826648">0</span>&nbsp;<span class="op" id="2826650">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2826654">panic</span><span class="op" id="2826659">(</span><span class="ident" id="2826660">errNegativeWrite</span><span class="op" id="2826676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2826679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2826682">b</span><span class="op" id="2826683">.</span><span class="ident" id="2826684">r</span>&nbsp;<span class="op" id="2826686">+=</span>&nbsp;<span class="ident" id="2826689">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2826692">return</span>&nbsp;<span class="ident" id="2826699">int64</span><span class="op" id="2826704">(</span><span class="ident" id="2826705">n</span><span class="op" id="2826706">)</span><span class="op" id="2826707">,</span>&nbsp;<span class="ident" id="2826709">err</span><br>
<span class="lineno"></span><span class="op" id="2826713">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="2826716">//&nbsp;buffered&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2826736">//&nbsp;Writer&nbsp;implements&nbsp;buffering&nbsp;for&nbsp;an&nbsp;io.Writer&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="2826792">//&nbsp;If&nbsp;an&nbsp;error&nbsp;occurs&nbsp;writing&nbsp;to&nbsp;a&nbsp;Writer,&nbsp;no&nbsp;more&nbsp;data&nbsp;will&nbsp;be</span><br>
<span class="lineno">475</span><span class="comment" id="2826856">//&nbsp;accepted&nbsp;and&nbsp;all&nbsp;subsequent&nbsp;writes&nbsp;will&nbsp;return&nbsp;the&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="2826917">//&nbsp;After&nbsp;all&nbsp;data&nbsp;has&nbsp;been&nbsp;written,&nbsp;the&nbsp;client&nbsp;should&nbsp;call&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2826980">//&nbsp;Flush&nbsp;method&nbsp;to&nbsp;guarantee&nbsp;all&nbsp;data&nbsp;has&nbsp;been&nbsp;forwarded&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2827040">//&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="2827069">type</span>&nbsp;<span class="ident" id="2827074">Writer</span>&nbsp;<span class="keyword" id="2827081">struct</span>&nbsp;<span class="op" id="2827088">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2827091">err</span>&nbsp;<span class="builtintype" id="2827095">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2827102">buf</span>&nbsp;<span class="op" id="2827106">[</span><span class="op" id="2827107">]</span><span class="builtintype" id="2827108">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2827114">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2827118">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2827123">wr</span>&nbsp;&nbsp;<span class="ident" id="2827127">io</span><span class="op" id="2827129">.</span><span class="ident" id="2827130">Writer</span><br>
<span class="lineno"></span><span class="op" id="2827137">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span><span class="comment" id="2827140">//&nbsp;NewWriterSize&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;at&nbsp;least&nbsp;the&nbsp;specified</span><br>
<span class="lineno"></span><span class="comment" id="2827218">//&nbsp;size.&nbsp;If&nbsp;the&nbsp;argument&nbsp;io.Writer&nbsp;is&nbsp;already&nbsp;a&nbsp;Writer&nbsp;with&nbsp;large&nbsp;enough</span><br>
<span class="lineno"></span><span class="comment" id="2827291">//&nbsp;size,&nbsp;it&nbsp;returns&nbsp;the&nbsp;underlying&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="2827334">func</span>&nbsp;<span class="ident" id="2827339">NewWriterSize</span><span class="op" id="2827352">(</span><span class="ident" id="2827353">w</span>&nbsp;<span class="ident" id="2827355">io</span><span class="op" id="2827357">.</span><span class="ident" id="2827358">Writer</span><span class="op" id="2827364">,</span>&nbsp;<span class="ident" id="2827366">size</span>&nbsp;<span class="builtintype" id="2827371">int</span><span class="op" id="2827374">)</span>&nbsp;<span class="op" id="2827376">*</span><span class="ident" id="2827377">Writer</span>&nbsp;<span class="op" id="2827384">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2827387">//&nbsp;Is&nbsp;it&nbsp;already&nbsp;a&nbsp;Writer?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2827415">b</span><span class="op" id="2827416">,</span>&nbsp;<span class="ident" id="2827418">ok</span>&nbsp;<span class="op" id="2827421">:=</span>&nbsp;<span class="ident" id="2827424">w</span><span class="op" id="2827425">.</span><span class="op" id="2827426">(</span><span class="op" id="2827427">*</span><span class="ident" id="2827428">Writer</span><span class="op" id="2827434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2827437">if</span>&nbsp;<span class="ident" id="2827440">ok</span>&nbsp;<span class="op" id="2827443">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2827446">len</span><span class="op" id="2827449">(</span><span class="ident" id="2827450">b</span><span class="op" id="2827451">.</span><span class="ident" id="2827452">buf</span><span class="op" id="2827455">)</span>&nbsp;<span class="op" id="2827457">&gt;=</span>&nbsp;<span class="ident" id="2827460">size</span>&nbsp;<span class="op" id="2827465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2827469">return</span>&nbsp;<span class="ident" id="2827476">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2827479">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2827482">if</span>&nbsp;<span class="ident" id="2827485">size</span>&nbsp;<span class="op" id="2827490">&lt;=</span>&nbsp;<span class="num" id="2827493">0</span>&nbsp;<span class="op" id="2827495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2827499">size</span>&nbsp;<span class="op" id="2827504">=</span>&nbsp;<span class="ident" id="2827506">defaultBufSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2827522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2827525">return</span>&nbsp;<span class="op" id="2827532">&amp;</span><span class="ident" id="2827533">Writer</span><span class="op" id="2827539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2827543">buf</span><span class="op" id="2827546">:</span>&nbsp;<span class="builtinfunc" id="2827548">make</span><span class="op" id="2827552">(</span><span class="op" id="2827553">[</span><span class="op" id="2827554">]</span><span class="builtintype" id="2827555">byte</span><span class="op" id="2827559">,</span>&nbsp;<span class="ident" id="2827561">size</span><span class="op" id="2827565">)</span><span class="op" id="2827566">,</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2827570">wr</span><span class="op" id="2827572">:</span>&nbsp;&nbsp;<span class="ident" id="2827575">w</span><span class="op" id="2827576">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2827579">}</span><br>
<span class="lineno"></span><span class="op" id="2827581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2827584">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer&nbsp;whose&nbsp;buffer&nbsp;has&nbsp;the&nbsp;default&nbsp;size.</span><br>
<span class="lineno">505</span><span class="keyword" id="2827653">func</span>&nbsp;<span class="ident" id="2827658">NewWriter</span><span class="op" id="2827667">(</span><span class="ident" id="2827668">w</span>&nbsp;<span class="ident" id="2827670">io</span><span class="op" id="2827672">.</span><span class="ident" id="2827673">Writer</span><span class="op" id="2827679">)</span>&nbsp;<span class="op" id="2827681">*</span><span class="ident" id="2827682">Writer</span>&nbsp;<span class="op" id="2827689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2827692">return</span>&nbsp;<span class="ident" id="2827699">NewWriterSize</span><span class="op" id="2827712">(</span><span class="ident" id="2827713">w</span><span class="op" id="2827714">,</span>&nbsp;<span class="ident" id="2827716">defaultBufSize</span><span class="op" id="2827730">)</span><br>
<span class="lineno"></span><span class="op" id="2827732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2827735">//&nbsp;Reset&nbsp;discards&nbsp;any&nbsp;unflushed&nbsp;buffered&nbsp;data,&nbsp;clears&nbsp;any&nbsp;error,&nbsp;and</span><br>
<span class="lineno">510</span><span class="comment" id="2827804">//&nbsp;resets&nbsp;b&nbsp;to&nbsp;write&nbsp;its&nbsp;output&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="2827842">func</span>&nbsp;<span class="op" id="2827847">(</span><span class="ident" id="2827848">b</span>&nbsp;<span class="op" id="2827850">*</span><span class="ident" id="2827851">Writer</span><span class="op" id="2827857">)</span>&nbsp;<span class="ident" id="2827859">Reset</span><span class="op" id="2827864">(</span><span class="ident" id="2827865">w</span>&nbsp;<span class="ident" id="2827867">io</span><span class="op" id="2827869">.</span><span class="ident" id="2827870">Writer</span><span class="op" id="2827876">)</span>&nbsp;<span class="op" id="2827878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2827881">b</span><span class="op" id="2827882">.</span><span class="ident" id="2827883">err</span>&nbsp;<span class="op" id="2827887">=</span>&nbsp;<span class="builtintype" id="2827889">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2827894">b</span><span class="op" id="2827895">.</span><span class="ident" id="2827896">n</span>&nbsp;<span class="op" id="2827898">=</span>&nbsp;<span class="num" id="2827900">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2827903">b</span><span class="op" id="2827904">.</span><span class="ident" id="2827905">wr</span>&nbsp;<span class="op" id="2827908">=</span>&nbsp;<span class="ident" id="2827910">w</span><br>
<span class="lineno">515</span><span class="op" id="2827912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2827915">//&nbsp;Flush&nbsp;writes&nbsp;any&nbsp;buffered&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="2827978">func</span>&nbsp;<span class="op" id="2827983">(</span><span class="ident" id="2827984">b</span>&nbsp;<span class="op" id="2827986">*</span><span class="ident" id="2827987">Writer</span><span class="op" id="2827993">)</span>&nbsp;<span class="ident" id="2827995">Flush</span><span class="op" id="2828000">(</span><span class="op" id="2828001">)</span>&nbsp;<span class="builtintype" id="2828003">error</span>&nbsp;<span class="op" id="2828009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2828012">err</span>&nbsp;<span class="op" id="2828016">:=</span>&nbsp;<span class="ident" id="2828019">b</span><span class="op" id="2828020">.</span><span class="ident" id="2828021">flush</span><span class="op" id="2828026">(</span><span class="op" id="2828027">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2828030">return</span>&nbsp;<span class="ident" id="2828037">err</span><br>
<span class="lineno"></span><span class="op" id="2828041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2828044">func</span>&nbsp;<span class="op" id="2828049">(</span><span class="ident" id="2828050">b</span>&nbsp;<span class="op" id="2828052">*</span><span class="ident" id="2828053">Writer</span><span class="op" id="2828059">)</span>&nbsp;<span class="ident" id="2828061">flush</span><span class="op" id="2828066">(</span><span class="op" id="2828067">)</span>&nbsp;<span class="builtintype" id="2828069">error</span>&nbsp;<span class="op" id="2828075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2828078">if</span>&nbsp;<span class="ident" id="2828081">b</span><span class="op" id="2828082">.</span><span class="ident" id="2828083">err</span>&nbsp;<span class="op" id="2828087">!=</span>&nbsp;<span class="builtintype" id="2828090">nil</span>&nbsp;<span class="op" id="2828094">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2828098">return</span>&nbsp;<span class="ident" id="2828105">b</span><span class="op" id="2828106">.</span><span class="ident" id="2828107">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2828112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2828115">if</span>&nbsp;<span class="ident" id="2828118">b</span><span class="op" id="2828119">.</span><span class="ident" id="2828120">n</span>&nbsp;<span class="op" id="2828122">==</span>&nbsp;<span class="num" id="2828125">0</span>&nbsp;<span class="op" id="2828127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2828131">return</span>&nbsp;<span class="builtintype" id="2828138">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2828143">}</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2828146">n</span><span class="op" id="2828147">,</span>&nbsp;<span class="ident" id="2828149">err</span>&nbsp;<span class="op" id="2828153">:=</span>&nbsp;<span class="ident" id="2828156">b</span><span class="op" id="2828157">.</span><span class="ident" id="2828158">wr</span><span class="op" id="2828160">.</span><span class="ident" id="2828161">Write</span><span class="op" id="2828166">(</span><span class="ident" id="2828167">b</span><span class="op" id="2828168">.</span><span class="ident" id="2828169">buf</span><span class="op" id="2828172">[</span><span class="num" id="2828173">0</span><span class="op" id="2828174">:</span><span class="ident" id="2828175">b</span><span class="op" id="2828176">.</span><span class="ident" id="2828177">n</span><span class="op" id="2828178">]</span><span class="op" id="2828179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2828182">if</span>&nbsp;<span class="ident" id="2828185">n</span>&nbsp;<span class="op" id="2828187">&lt;</span>&nbsp;<span class="ident" id="2828189">b</span><span class="op" id="2828190">.</span><span class="ident" id="2828191">n</span>&nbsp;<span class="op" id="2828193">&amp;&amp;</span>&nbsp;<span class="ident" id="2828196">err</span>&nbsp;<span class="op" id="2828200">==</span>&nbsp;<span class="builtintype" id="2828203">nil</span>&nbsp;<span class="op" id="2828207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2828211">err</span>&nbsp;<span class="op" id="2828215">=</span>&nbsp;<span class="ident" id="2828217">io</span><span class="op" id="2828219">.</span><span class="ident" id="2828220">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2828235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2828238">if</span>&nbsp;<span class="ident" id="2828241">err</span>&nbsp;<span class="op" id="2828245">!=</span>&nbsp;<span class="builtintype" id="2828248">nil</span>&nbsp;<span class="op" id="2828252">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2828256">if</span>&nbsp;<span class="ident" id="2828259">n</span>&nbsp;<span class="op" id="2828261">&gt;</span>&nbsp;<span class="num" id="2828263">0</span>&nbsp;<span class="op" id="2828265">&amp;&amp;</span>&nbsp;<span class="ident" id="2828268">n</span>&nbsp;<span class="op" id="2828270">&lt;</span>&nbsp;<span class="ident" id="2828272">b</span><span class="op" id="2828273">.</span><span class="ident" id="2828274">n</span>&nbsp;<span class="op" id="2828276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2828281">copy</span><span class="op" id="2828285">(</span><span class="ident" id="2828286">b</span><span class="op" id="2828287">.</span><span class="ident" id="2828288">buf</span><span class="op" id="2828291">[</span><span class="num" id="2828292">0</span><span class="op" id="2828293">:</span><span class="ident" id="2828294">b</span><span class="op" id="2828295">.</span><span class="ident" id="2828296">n</span><span class="op" id="2828297">-</span><span class="ident" id="2828298">n</span><span class="op" id="2828299">]</span><span class="op" id="2828300">,</span>&nbsp;<span class="ident" id="2828302">b</span><span class="op" id="2828303">.</span><span class="ident" id="2828304">buf</span><span class="op" id="2828307">[</span><span class="ident" id="2828308">n</span><span class="op" id="2828309">:</span><span class="ident" id="2828310">b</span><span class="op" id="2828311">.</span><span class="ident" id="2828312">n</span><span class="op" id="2828313">]</span><span class="op" id="2828314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2828318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2828322">b</span><span class="op" id="2828323">.</span><span class="ident" id="2828324">n</span>&nbsp;<span class="op" id="2828326">-=</span>&nbsp;<span class="ident" id="2828329">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2828333">b</span><span class="op" id="2828334">.</span><span class="ident" id="2828335">err</span>&nbsp;<span class="op" id="2828339">=</span>&nbsp;<span class="ident" id="2828341">err</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2828347">return</span>&nbsp;<span class="ident" id="2828354">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2828359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2828362">b</span><span class="op" id="2828363">.</span><span class="ident" id="2828364">n</span>&nbsp;<span class="op" id="2828366">=</span>&nbsp;<span class="num" id="2828368">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2828371">return</span>&nbsp;<span class="builtintype" id="2828378">nil</span><br>
<span class="lineno"></span><span class="op" id="2828382">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="2828385">//&nbsp;Available&nbsp;returns&nbsp;how&nbsp;many&nbsp;bytes&nbsp;are&nbsp;unused&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="2828447">func</span>&nbsp;<span class="op" id="2828452">(</span><span class="ident" id="2828453">b</span>&nbsp;<span class="op" id="2828455">*</span><span class="ident" id="2828456">Writer</span><span class="op" id="2828462">)</span>&nbsp;<span class="ident" id="2828464">Available</span><span class="op" id="2828473">(</span><span class="op" id="2828474">)</span>&nbsp;<span class="builtintype" id="2828476">int</span>&nbsp;<span class="op" id="2828480">{</span>&nbsp;<span class="keyword" id="2828482">return</span>&nbsp;<span class="builtinfunc" id="2828489">len</span><span class="op" id="2828492">(</span><span class="ident" id="2828493">b</span><span class="op" id="2828494">.</span><span class="ident" id="2828495">buf</span><span class="op" id="2828498">)</span>&nbsp;<span class="op" id="2828500">-</span>&nbsp;<span class="ident" id="2828502">b</span><span class="op" id="2828503">.</span><span class="ident" id="2828504">n</span>&nbsp;<span class="op" id="2828506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2828509">//&nbsp;Buffered&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;that&nbsp;have&nbsp;been&nbsp;written&nbsp;into&nbsp;the&nbsp;current&nbsp;buffer.</span><br>
<span class="lineno">550</span><span class="keyword" id="2828597">func</span>&nbsp;<span class="op" id="2828602">(</span><span class="ident" id="2828603">b</span>&nbsp;<span class="op" id="2828605">*</span><span class="ident" id="2828606">Writer</span><span class="op" id="2828612">)</span>&nbsp;<span class="ident" id="2828614">Buffered</span><span class="op" id="2828622">(</span><span class="op" id="2828623">)</span>&nbsp;<span class="builtintype" id="2828625">int</span>&nbsp;<span class="op" id="2828629">{</span>&nbsp;<span class="keyword" id="2828631">return</span>&nbsp;<span class="ident" id="2828638">b</span><span class="op" id="2828639">.</span><span class="ident" id="2828640">n</span>&nbsp;<span class="op" id="2828642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2828645">//&nbsp;Write&nbsp;writes&nbsp;the&nbsp;contents&nbsp;of&nbsp;p&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="2828696">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="2828739">//&nbsp;If&nbsp;nn&nbsp;&lt;&nbsp;len(p),&nbsp;it&nbsp;also&nbsp;returns&nbsp;an&nbsp;error&nbsp;explaining</span><br>
<span class="lineno">555</span><span class="comment" id="2828794">//&nbsp;why&nbsp;the&nbsp;write&nbsp;is&nbsp;short.</span><br>
<span class="lineno"></span><span class="keyword" id="2828821">func</span>&nbsp;<span class="op" id="2828826">(</span><span class="ident" id="2828827">b</span>&nbsp;<span class="op" id="2828829">*</span><span class="ident" id="2828830">Writer</span><span class="op" id="2828836">)</span>&nbsp;<span class="ident" id="2828838">Write</span><span class="op" id="2828843">(</span><span class="ident" id="2828844">p</span>&nbsp;<span class="op" id="2828846">[</span><span class="op" id="2828847">]</span><span class="builtintype" id="2828848">byte</span><span class="op" id="2828852">)</span>&nbsp;<span class="op" id="2828854">(</span><span class="ident" id="2828855">nn</span>&nbsp;<span class="builtintype" id="2828858">int</span><span class="op" id="2828861">,</span>&nbsp;<span class="ident" id="2828863">err</span>&nbsp;<span class="builtintype" id="2828867">error</span><span class="op" id="2828872">)</span>&nbsp;<span class="op" id="2828874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2828877">for</span>&nbsp;<span class="builtinfunc" id="2828881">len</span><span class="op" id="2828884">(</span><span class="ident" id="2828885">p</span><span class="op" id="2828886">)</span>&nbsp;<span class="op" id="2828888">&gt;</span>&nbsp;<span class="ident" id="2828890">b</span><span class="op" id="2828891">.</span><span class="ident" id="2828892">Available</span><span class="op" id="2828901">(</span><span class="op" id="2828902">)</span>&nbsp;<span class="op" id="2828904">&amp;&amp;</span>&nbsp;<span class="ident" id="2828907">b</span><span class="op" id="2828908">.</span><span class="ident" id="2828909">err</span>&nbsp;<span class="op" id="2828913">==</span>&nbsp;<span class="builtintype" id="2828916">nil</span>&nbsp;<span class="op" id="2828920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2828924">var</span>&nbsp;<span class="ident" id="2828928">n</span>&nbsp;<span class="builtintype" id="2828930">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2828936">if</span>&nbsp;<span class="ident" id="2828939">b</span><span class="op" id="2828940">.</span><span class="ident" id="2828941">Buffered</span><span class="op" id="2828949">(</span><span class="op" id="2828950">)</span>&nbsp;<span class="op" id="2828952">==</span>&nbsp;<span class="num" id="2828955">0</span>&nbsp;<span class="op" id="2828957">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2828962">//&nbsp;Large&nbsp;write,&nbsp;empty&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2828995">//&nbsp;Write&nbsp;directly&nbsp;from&nbsp;p&nbsp;to&nbsp;avoid&nbsp;copy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2829038">n</span><span class="op" id="2829039">,</span>&nbsp;<span class="ident" id="2829041">b</span><span class="op" id="2829042">.</span><span class="ident" id="2829043">err</span>&nbsp;<span class="op" id="2829047">=</span>&nbsp;<span class="ident" id="2829049">b</span><span class="op" id="2829050">.</span><span class="ident" id="2829051">wr</span><span class="op" id="2829053">.</span><span class="ident" id="2829054">Write</span><span class="op" id="2829059">(</span><span class="ident" id="2829060">p</span><span class="op" id="2829061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2829065">}</span>&nbsp;<span class="keyword" id="2829067">else</span>&nbsp;<span class="op" id="2829072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2829077">n</span>&nbsp;<span class="op" id="2829079">=</span>&nbsp;<span class="builtinfunc" id="2829081">copy</span><span class="op" id="2829085">(</span><span class="ident" id="2829086">b</span><span class="op" id="2829087">.</span><span class="ident" id="2829088">buf</span><span class="op" id="2829091">[</span><span class="ident" id="2829092">b</span><span class="op" id="2829093">.</span><span class="ident" id="2829094">n</span><span class="op" id="2829095">:</span><span class="op" id="2829096">]</span><span class="op" id="2829097">,</span>&nbsp;<span class="ident" id="2829099">p</span><span class="op" id="2829100">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2829105">b</span><span class="op" id="2829106">.</span><span class="ident" id="2829107">n</span>&nbsp;<span class="op" id="2829109">+=</span>&nbsp;<span class="ident" id="2829112">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2829117">b</span><span class="op" id="2829118">.</span><span class="ident" id="2829119">flush</span><span class="op" id="2829124">(</span><span class="op" id="2829125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2829129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2829133">nn</span>&nbsp;<span class="op" id="2829136">+=</span>&nbsp;<span class="ident" id="2829139">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2829143">p</span>&nbsp;<span class="op" id="2829145">=</span>&nbsp;<span class="ident" id="2829147">p</span><span class="op" id="2829148">[</span><span class="ident" id="2829149">n</span><span class="op" id="2829150">:</span><span class="op" id="2829151">]</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2829154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2829157">if</span>&nbsp;<span class="ident" id="2829160">b</span><span class="op" id="2829161">.</span><span class="ident" id="2829162">err</span>&nbsp;<span class="op" id="2829166">!=</span>&nbsp;<span class="builtintype" id="2829169">nil</span>&nbsp;<span class="op" id="2829173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2829177">return</span>&nbsp;<span class="ident" id="2829184">nn</span><span class="op" id="2829186">,</span>&nbsp;<span class="ident" id="2829188">b</span><span class="op" id="2829189">.</span><span class="ident" id="2829190">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2829195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2829198">n</span>&nbsp;<span class="op" id="2829200">:=</span>&nbsp;<span class="builtinfunc" id="2829203">copy</span><span class="op" id="2829207">(</span><span class="ident" id="2829208">b</span><span class="op" id="2829209">.</span><span class="ident" id="2829210">buf</span><span class="op" id="2829213">[</span><span class="ident" id="2829214">b</span><span class="op" id="2829215">.</span><span class="ident" id="2829216">n</span><span class="op" id="2829217">:</span><span class="op" id="2829218">]</span><span class="op" id="2829219">,</span>&nbsp;<span class="ident" id="2829221">p</span><span class="op" id="2829222">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2829225">b</span><span class="op" id="2829226">.</span><span class="ident" id="2829227">n</span>&nbsp;<span class="op" id="2829229">+=</span>&nbsp;<span class="ident" id="2829232">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2829235">nn</span>&nbsp;<span class="op" id="2829238">+=</span>&nbsp;<span class="ident" id="2829241">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2829244">return</span>&nbsp;<span class="ident" id="2829251">nn</span><span class="op" id="2829253">,</span>&nbsp;<span class="builtintype" id="2829255">nil</span><br>
<span class="lineno"></span><span class="op" id="2829259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span><span class="comment" id="2829262">//&nbsp;WriteByte&nbsp;writes&nbsp;a&nbsp;single&nbsp;byte.</span><br>
<span class="lineno"></span><span class="keyword" id="2829297">func</span>&nbsp;<span class="op" id="2829302">(</span><span class="ident" id="2829303">b</span>&nbsp;<span class="op" id="2829305">*</span><span class="ident" id="2829306">Writer</span><span class="op" id="2829312">)</span>&nbsp;<span class="ident" id="2829314">WriteByte</span><span class="op" id="2829323">(</span><span class="ident" id="2829324">c</span>&nbsp;<span class="builtintype" id="2829326">byte</span><span class="op" id="2829330">)</span>&nbsp;<span class="builtintype" id="2829332">error</span>&nbsp;<span class="op" id="2829338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2829341">if</span>&nbsp;<span class="ident" id="2829344">b</span><span class="op" id="2829345">.</span><span class="ident" id="2829346">err</span>&nbsp;<span class="op" id="2829350">!=</span>&nbsp;<span class="builtintype" id="2829353">nil</span>&nbsp;<span class="op" id="2829357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2829361">return</span>&nbsp;<span class="ident" id="2829368">b</span><span class="op" id="2829369">.</span><span class="ident" id="2829370">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2829375">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2829378">if</span>&nbsp;<span class="ident" id="2829381">b</span><span class="op" id="2829382">.</span><span class="ident" id="2829383">Available</span><span class="op" id="2829392">(</span><span class="op" id="2829393">)</span>&nbsp;<span class="op" id="2829395">&lt;=</span>&nbsp;<span class="num" id="2829398">0</span>&nbsp;<span class="op" id="2829400">&amp;&amp;</span>&nbsp;<span class="ident" id="2829403">b</span><span class="op" id="2829404">.</span><span class="ident" id="2829405">flush</span><span class="op" id="2829410">(</span><span class="op" id="2829411">)</span>&nbsp;<span class="op" id="2829413">!=</span>&nbsp;<span class="builtintype" id="2829416">nil</span>&nbsp;<span class="op" id="2829420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2829424">return</span>&nbsp;<span class="ident" id="2829431">b</span><span class="op" id="2829432">.</span><span class="ident" id="2829433">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2829438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2829441">b</span><span class="op" id="2829442">.</span><span class="ident" id="2829443">buf</span><span class="op" id="2829446">[</span><span class="ident" id="2829447">b</span><span class="op" id="2829448">.</span><span class="ident" id="2829449">n</span><span class="op" id="2829450">]</span>&nbsp;<span class="op" id="2829452">=</span>&nbsp;<span class="ident" id="2829454">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2829457">b</span><span class="op" id="2829458">.</span><span class="ident" id="2829459">n</span><span class="op" id="2829460">++</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2829464">return</span>&nbsp;<span class="builtintype" id="2829471">nil</span><br>
<span class="lineno"></span><span class="op" id="2829475">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2829478">//&nbsp;WriteRune&nbsp;writes&nbsp;a&nbsp;single&nbsp;Unicode&nbsp;code&nbsp;point,&nbsp;returning</span><br>
<span class="lineno"></span><span class="comment" id="2829537">//&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written&nbsp;and&nbsp;any&nbsp;error.</span><br>
<span class="lineno">595</span><span class="keyword" id="2829583">func</span>&nbsp;<span class="op" id="2829588">(</span><span class="ident" id="2829589">b</span>&nbsp;<span class="op" id="2829591">*</span><span class="ident" id="2829592">Writer</span><span class="op" id="2829598">)</span>&nbsp;<span class="ident" id="2829600">WriteRune</span><span class="op" id="2829609">(</span><span class="ident" id="2829610">r</span>&nbsp;<span class="builtintype" id="2829612">rune</span><span class="op" id="2829616">)</span>&nbsp;<span class="op" id="2829618">(</span><span class="ident" id="2829619">size</span>&nbsp;<span class="builtintype" id="2829624">int</span><span class="op" id="2829627">,</span>&nbsp;<span class="ident" id="2829629">err</span>&nbsp;<span class="builtintype" id="2829633">error</span><span class="op" id="2829638">)</span>&nbsp;<span class="op" id="2829640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2829643">if</span>&nbsp;<span class="ident" id="2829646">r</span>&nbsp;<span class="op" id="2829648">&lt;</span>&nbsp;<span class="ident" id="2829650">utf8</span><span class="op" id="2829654">.</span><span class="ident" id="2829655">RuneSelf</span>&nbsp;<span class="op" id="2829664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2829668">err</span>&nbsp;<span class="op" id="2829672">=</span>&nbsp;<span class="ident" id="2829674">b</span><span class="op" id="2829675">.</span><span class="ident" id="2829676">WriteByte</span><span class="op" id="2829685">(</span><span class="builtintype" id="2829686">byte</span><span class="op" id="2829690">(</span><span class="ident" id="2829691">r</span><span class="op" id="2829692">)</span><span class="op" id="2829693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2829697">if</span>&nbsp;<span class="ident" id="2829700">err</span>&nbsp;<span class="op" id="2829704">!=</span>&nbsp;<span class="builtintype" id="2829707">nil</span>&nbsp;<span class="op" id="2829711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2829716">return</span>&nbsp;<span class="num" id="2829723">0</span><span class="op" id="2829724">,</span>&nbsp;<span class="ident" id="2829726">err</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2829732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2829736">return</span>&nbsp;<span class="num" id="2829743">1</span><span class="op" id="2829744">,</span>&nbsp;<span class="builtintype" id="2829746">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2829751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2829754">if</span>&nbsp;<span class="ident" id="2829757">b</span><span class="op" id="2829758">.</span><span class="ident" id="2829759">err</span>&nbsp;<span class="op" id="2829763">!=</span>&nbsp;<span class="builtintype" id="2829766">nil</span>&nbsp;<span class="op" id="2829770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2829774">return</span>&nbsp;<span class="num" id="2829781">0</span><span class="op" id="2829782">,</span>&nbsp;<span class="ident" id="2829784">b</span><span class="op" id="2829785">.</span><span class="ident" id="2829786">err</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2829791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2829794">n</span>&nbsp;<span class="op" id="2829796">:=</span>&nbsp;<span class="ident" id="2829799">b</span><span class="op" id="2829800">.</span><span class="ident" id="2829801">Available</span><span class="op" id="2829810">(</span><span class="op" id="2829811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2829814">if</span>&nbsp;<span class="ident" id="2829817">n</span>&nbsp;<span class="op" id="2829819">&lt;</span>&nbsp;<span class="ident" id="2829821">utf8</span><span class="op" id="2829825">.</span><span class="ident" id="2829826">UTFMax</span>&nbsp;<span class="op" id="2829833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2829837">if</span>&nbsp;<span class="ident" id="2829840">b</span><span class="op" id="2829841">.</span><span class="ident" id="2829842">flush</span><span class="op" id="2829847">(</span><span class="op" id="2829848">)</span><span class="op" id="2829849">;</span>&nbsp;<span class="ident" id="2829851">b</span><span class="op" id="2829852">.</span><span class="ident" id="2829853">err</span>&nbsp;<span class="op" id="2829857">!=</span>&nbsp;<span class="builtintype" id="2829860">nil</span>&nbsp;<span class="op" id="2829864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2829869">return</span>&nbsp;<span class="num" id="2829876">0</span><span class="op" id="2829877">,</span>&nbsp;<span class="ident" id="2829879">b</span><span class="op" id="2829880">.</span><span class="ident" id="2829881">err</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2829887">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2829891">n</span>&nbsp;<span class="op" id="2829893">=</span>&nbsp;<span class="ident" id="2829895">b</span><span class="op" id="2829896">.</span><span class="ident" id="2829897">Available</span><span class="op" id="2829906">(</span><span class="op" id="2829907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2829911">if</span>&nbsp;<span class="ident" id="2829914">n</span>&nbsp;<span class="op" id="2829916">&lt;</span>&nbsp;<span class="ident" id="2829918">utf8</span><span class="op" id="2829922">.</span><span class="ident" id="2829923">UTFMax</span>&nbsp;<span class="op" id="2829930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2829935">//&nbsp;Can&nbsp;only&nbsp;happen&nbsp;if&nbsp;buffer&nbsp;is&nbsp;silly&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2829983">return</span>&nbsp;<span class="ident" id="2829990">b</span><span class="op" id="2829991">.</span><span class="ident" id="2829992">WriteString</span><span class="op" id="2830003">(</span><span class="builtintype" id="2830004">string</span><span class="op" id="2830010">(</span><span class="ident" id="2830011">r</span><span class="op" id="2830012">)</span><span class="op" id="2830013">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2830017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2830020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2830023">size</span>&nbsp;<span class="op" id="2830028">=</span>&nbsp;<span class="ident" id="2830030">utf8</span><span class="op" id="2830034">.</span><span class="ident" id="2830035">EncodeRune</span><span class="op" id="2830045">(</span><span class="ident" id="2830046">b</span><span class="op" id="2830047">.</span><span class="ident" id="2830048">buf</span><span class="op" id="2830051">[</span><span class="ident" id="2830052">b</span><span class="op" id="2830053">.</span><span class="ident" id="2830054">n</span><span class="op" id="2830055">:</span><span class="op" id="2830056">]</span><span class="op" id="2830057">,</span>&nbsp;<span class="ident" id="2830059">r</span><span class="op" id="2830060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2830063">b</span><span class="op" id="2830064">.</span><span class="ident" id="2830065">n</span>&nbsp;<span class="op" id="2830067">+=</span>&nbsp;<span class="ident" id="2830070">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2830076">return</span>&nbsp;<span class="ident" id="2830083">size</span><span class="op" id="2830087">,</span>&nbsp;<span class="builtintype" id="2830089">nil</span><br>
<span class="lineno">620</span><span class="op" id="2830093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2830096">//&nbsp;WriteString&nbsp;writes&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="2830128">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno"></span><span class="comment" id="2830171">//&nbsp;If&nbsp;the&nbsp;count&nbsp;is&nbsp;less&nbsp;than&nbsp;len(s),&nbsp;it&nbsp;also&nbsp;returns&nbsp;an&nbsp;error&nbsp;explaining</span><br>
<span class="lineno">625</span><span class="comment" id="2830244">//&nbsp;why&nbsp;the&nbsp;write&nbsp;is&nbsp;short.</span><br>
<span class="lineno"></span><span class="keyword" id="2830271">func</span>&nbsp;<span class="op" id="2830276">(</span><span class="ident" id="2830277">b</span>&nbsp;<span class="op" id="2830279">*</span><span class="ident" id="2830280">Writer</span><span class="op" id="2830286">)</span>&nbsp;<span class="ident" id="2830288">WriteString</span><span class="op" id="2830299">(</span><span class="ident" id="2830300">s</span>&nbsp;<span class="builtintype" id="2830302">string</span><span class="op" id="2830308">)</span>&nbsp;<span class="op" id="2830310">(</span><span class="builtintype" id="2830311">int</span><span class="op" id="2830314">,</span>&nbsp;<span class="builtintype" id="2830316">error</span><span class="op" id="2830321">)</span>&nbsp;<span class="op" id="2830323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2830326">nn</span>&nbsp;<span class="op" id="2830329">:=</span>&nbsp;<span class="num" id="2830332">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2830335">for</span>&nbsp;<span class="builtinfunc" id="2830339">len</span><span class="op" id="2830342">(</span><span class="ident" id="2830343">s</span><span class="op" id="2830344">)</span>&nbsp;<span class="op" id="2830346">&gt;</span>&nbsp;<span class="ident" id="2830348">b</span><span class="op" id="2830349">.</span><span class="ident" id="2830350">Available</span><span class="op" id="2830359">(</span><span class="op" id="2830360">)</span>&nbsp;<span class="op" id="2830362">&amp;&amp;</span>&nbsp;<span class="ident" id="2830365">b</span><span class="op" id="2830366">.</span><span class="ident" id="2830367">err</span>&nbsp;<span class="op" id="2830371">==</span>&nbsp;<span class="builtintype" id="2830374">nil</span>&nbsp;<span class="op" id="2830378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2830382">n</span>&nbsp;<span class="op" id="2830384">:=</span>&nbsp;<span class="builtinfunc" id="2830387">copy</span><span class="op" id="2830391">(</span><span class="ident" id="2830392">b</span><span class="op" id="2830393">.</span><span class="ident" id="2830394">buf</span><span class="op" id="2830397">[</span><span class="ident" id="2830398">b</span><span class="op" id="2830399">.</span><span class="ident" id="2830400">n</span><span class="op" id="2830401">:</span><span class="op" id="2830402">]</span><span class="op" id="2830403">,</span>&nbsp;<span class="ident" id="2830405">s</span><span class="op" id="2830406">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2830410">b</span><span class="op" id="2830411">.</span><span class="ident" id="2830412">n</span>&nbsp;<span class="op" id="2830414">+=</span>&nbsp;<span class="ident" id="2830417">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2830421">nn</span>&nbsp;<span class="op" id="2830424">+=</span>&nbsp;<span class="ident" id="2830427">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2830431">s</span>&nbsp;<span class="op" id="2830433">=</span>&nbsp;<span class="ident" id="2830435">s</span><span class="op" id="2830436">[</span><span class="ident" id="2830437">n</span><span class="op" id="2830438">:</span><span class="op" id="2830439">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2830443">b</span><span class="op" id="2830444">.</span><span class="ident" id="2830445">flush</span><span class="op" id="2830450">(</span><span class="op" id="2830451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2830454">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2830457">if</span>&nbsp;<span class="ident" id="2830460">b</span><span class="op" id="2830461">.</span><span class="ident" id="2830462">err</span>&nbsp;<span class="op" id="2830466">!=</span>&nbsp;<span class="builtintype" id="2830469">nil</span>&nbsp;<span class="op" id="2830473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2830477">return</span>&nbsp;<span class="ident" id="2830484">nn</span><span class="op" id="2830486">,</span>&nbsp;<span class="ident" id="2830488">b</span><span class="op" id="2830489">.</span><span class="ident" id="2830490">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2830495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2830498">n</span>&nbsp;<span class="op" id="2830500">:=</span>&nbsp;<span class="builtinfunc" id="2830503">copy</span><span class="op" id="2830507">(</span><span class="ident" id="2830508">b</span><span class="op" id="2830509">.</span><span class="ident" id="2830510">buf</span><span class="op" id="2830513">[</span><span class="ident" id="2830514">b</span><span class="op" id="2830515">.</span><span class="ident" id="2830516">n</span><span class="op" id="2830517">:</span><span class="op" id="2830518">]</span><span class="op" id="2830519">,</span>&nbsp;<span class="ident" id="2830521">s</span><span class="op" id="2830522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2830525">b</span><span class="op" id="2830526">.</span><span class="ident" id="2830527">n</span>&nbsp;<span class="op" id="2830529">+=</span>&nbsp;<span class="ident" id="2830532">n</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2830535">nn</span>&nbsp;<span class="op" id="2830538">+=</span>&nbsp;<span class="ident" id="2830541">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2830544">return</span>&nbsp;<span class="ident" id="2830551">nn</span><span class="op" id="2830553">,</span>&nbsp;<span class="builtintype" id="2830555">nil</span><br>
<span class="lineno"></span><span class="op" id="2830559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2830562">//&nbsp;ReadFrom&nbsp;implements&nbsp;io.ReaderFrom.</span><br>
<span class="lineno">645</span><span class="keyword" id="2830600">func</span>&nbsp;<span class="op" id="2830605">(</span><span class="ident" id="2830606">b</span>&nbsp;<span class="op" id="2830608">*</span><span class="ident" id="2830609">Writer</span><span class="op" id="2830615">)</span>&nbsp;<span class="ident" id="2830617">ReadFrom</span><span class="op" id="2830625">(</span><span class="ident" id="2830626">r</span>&nbsp;<span class="ident" id="2830628">io</span><span class="op" id="2830630">.</span><span class="ident" id="2830631">Reader</span><span class="op" id="2830637">)</span>&nbsp;<span class="op" id="2830639">(</span><span class="ident" id="2830640">n</span>&nbsp;<span class="ident" id="2830642">int64</span><span class="op" id="2830647">,</span>&nbsp;<span class="ident" id="2830649">err</span>&nbsp;<span class="builtintype" id="2830653">error</span><span class="op" id="2830658">)</span>&nbsp;<span class="op" id="2830660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2830663">if</span>&nbsp;<span class="ident" id="2830666">b</span><span class="op" id="2830667">.</span><span class="ident" id="2830668">Buffered</span><span class="op" id="2830676">(</span><span class="op" id="2830677">)</span>&nbsp;<span class="op" id="2830679">==</span>&nbsp;<span class="num" id="2830682">0</span>&nbsp;<span class="op" id="2830684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2830688">if</span>&nbsp;<span class="ident" id="2830691">w</span><span class="op" id="2830692">,</span>&nbsp;<span class="ident" id="2830694">ok</span>&nbsp;<span class="op" id="2830697">:=</span>&nbsp;<span class="ident" id="2830700">b</span><span class="op" id="2830701">.</span><span class="ident" id="2830702">wr</span><span class="op" id="2830704">.</span><span class="op" id="2830705">(</span><span class="ident" id="2830706">io</span><span class="op" id="2830708">.</span><span class="ident" id="2830709">ReaderFrom</span><span class="op" id="2830719">)</span><span class="op" id="2830720">;</span>&nbsp;<span class="ident" id="2830722">ok</span>&nbsp;<span class="op" id="2830725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2830730">return</span>&nbsp;<span class="ident" id="2830737">w</span><span class="op" id="2830738">.</span><span class="ident" id="2830739">ReadFrom</span><span class="op" id="2830747">(</span><span class="ident" id="2830748">r</span><span class="op" id="2830749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2830753">}</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2830756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2830759">var</span>&nbsp;<span class="ident" id="2830763">m</span>&nbsp;<span class="builtintype" id="2830765">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2830770">for</span>&nbsp;<span class="op" id="2830774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2830778">if</span>&nbsp;<span class="ident" id="2830781">b</span><span class="op" id="2830782">.</span><span class="ident" id="2830783">Available</span><span class="op" id="2830792">(</span><span class="op" id="2830793">)</span>&nbsp;<span class="op" id="2830795">==</span>&nbsp;<span class="num" id="2830798">0</span>&nbsp;<span class="op" id="2830800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2830805">if</span>&nbsp;<span class="ident" id="2830808">err1</span>&nbsp;<span class="op" id="2830813">:=</span>&nbsp;<span class="ident" id="2830816">b</span><span class="op" id="2830817">.</span><span class="ident" id="2830818">flush</span><span class="op" id="2830823">(</span><span class="op" id="2830824">)</span><span class="op" id="2830825">;</span>&nbsp;<span class="ident" id="2830827">err1</span>&nbsp;<span class="op" id="2830832">!=</span>&nbsp;<span class="builtintype" id="2830835">nil</span>&nbsp;<span class="op" id="2830839">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2830845">return</span>&nbsp;<span class="ident" id="2830852">n</span><span class="op" id="2830853">,</span>&nbsp;<span class="ident" id="2830855">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2830863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2830867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2830871">nr</span>&nbsp;<span class="op" id="2830874">:=</span>&nbsp;<span class="num" id="2830877">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2830881">for</span>&nbsp;<span class="ident" id="2830885">nr</span>&nbsp;<span class="op" id="2830888">&lt;</span>&nbsp;<span class="ident" id="2830890">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="2830915">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2830920">m</span><span class="op" id="2830921">,</span>&nbsp;<span class="ident" id="2830923">err</span>&nbsp;<span class="op" id="2830927">=</span>&nbsp;<span class="ident" id="2830929">r</span><span class="op" id="2830930">.</span><span class="ident" id="2830931">Read</span><span class="op" id="2830935">(</span><span class="ident" id="2830936">b</span><span class="op" id="2830937">.</span><span class="ident" id="2830938">buf</span><span class="op" id="2830941">[</span><span class="ident" id="2830942">b</span><span class="op" id="2830943">.</span><span class="ident" id="2830944">n</span><span class="op" id="2830945">:</span><span class="op" id="2830946">]</span><span class="op" id="2830947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2830952">if</span>&nbsp;<span class="ident" id="2830955">m</span>&nbsp;<span class="op" id="2830957">!=</span>&nbsp;<span class="num" id="2830960">0</span>&nbsp;<span class="op" id="2830962">||</span>&nbsp;<span class="ident" id="2830965">err</span>&nbsp;<span class="op" id="2830969">!=</span>&nbsp;<span class="builtintype" id="2830972">nil</span>&nbsp;<span class="op" id="2830976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2830982">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2830991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2830996">nr</span><span class="op" id="2830998">++</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2831003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2831007">if</span>&nbsp;<span class="ident" id="2831010">nr</span>&nbsp;<span class="op" id="2831013">==</span>&nbsp;<span class="ident" id="2831016">maxConsecutiveEmptyReads</span>&nbsp;<span class="op" id="2831041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2831046">return</span>&nbsp;<span class="ident" id="2831053">n</span><span class="op" id="2831054">,</span>&nbsp;<span class="ident" id="2831056">io</span><span class="op" id="2831058">.</span><span class="ident" id="2831059">ErrNoProgress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2831075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2831079">b</span><span class="op" id="2831080">.</span><span class="ident" id="2831081">n</span>&nbsp;<span class="op" id="2831083">+=</span>&nbsp;<span class="ident" id="2831086">m</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2831090">n</span>&nbsp;<span class="op" id="2831092">+=</span>&nbsp;<span class="ident" id="2831095">int64</span><span class="op" id="2831100">(</span><span class="ident" id="2831101">m</span><span class="op" id="2831102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2831106">if</span>&nbsp;<span class="ident" id="2831109">err</span>&nbsp;<span class="op" id="2831113">!=</span>&nbsp;<span class="builtintype" id="2831116">nil</span>&nbsp;<span class="op" id="2831120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2831125">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2831133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2831136">}</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2831139">if</span>&nbsp;<span class="ident" id="2831142">err</span>&nbsp;<span class="op" id="2831146">==</span>&nbsp;<span class="ident" id="2831149">io</span><span class="op" id="2831151">.</span><span class="ident" id="2831152">EOF</span>&nbsp;<span class="op" id="2831156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2831160">//&nbsp;If&nbsp;we&nbsp;filled&nbsp;the&nbsp;buffer&nbsp;exactly,&nbsp;flush&nbsp;pre-emptively.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2831219">if</span>&nbsp;<span class="ident" id="2831222">b</span><span class="op" id="2831223">.</span><span class="ident" id="2831224">Available</span><span class="op" id="2831233">(</span><span class="op" id="2831234">)</span>&nbsp;<span class="op" id="2831236">==</span>&nbsp;<span class="num" id="2831239">0</span>&nbsp;<span class="op" id="2831241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2831246">err</span>&nbsp;<span class="op" id="2831250">=</span>&nbsp;<span class="ident" id="2831252">b</span><span class="op" id="2831253">.</span><span class="ident" id="2831254">flush</span><span class="op" id="2831259">(</span><span class="op" id="2831260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2831264">}</span>&nbsp;<span class="keyword" id="2831266">else</span>&nbsp;<span class="op" id="2831271">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2831276">err</span>&nbsp;<span class="op" id="2831280">=</span>&nbsp;<span class="builtintype" id="2831282">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2831288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2831291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2831294">return</span>&nbsp;<span class="ident" id="2831301">n</span><span class="op" id="2831302">,</span>&nbsp;<span class="ident" id="2831304">err</span><br>
<span class="lineno"></span><span class="op" id="2831308">}</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span><span class="comment" id="2831311">//&nbsp;buffered&nbsp;input&nbsp;and&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2831341">//&nbsp;ReadWriter&nbsp;stores&nbsp;pointers&nbsp;to&nbsp;a&nbsp;Reader&nbsp;and&nbsp;a&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="2831397">//&nbsp;It&nbsp;implements&nbsp;io.ReadWriter.</span><br>
<span class="lineno">690</span><span class="keyword" id="2831429">type</span>&nbsp;<span class="ident" id="2831434">ReadWriter</span>&nbsp;<span class="keyword" id="2831445">struct</span>&nbsp;<span class="op" id="2831452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2831455">*</span><span class="ident" id="2831456">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2831464">*</span><span class="ident" id="2831465">Writer</span><br>
<span class="lineno"></span><span class="op" id="2831472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span><span class="comment" id="2831475">//&nbsp;NewReadWriter&nbsp;allocates&nbsp;a&nbsp;new&nbsp;ReadWriter&nbsp;that&nbsp;dispatches&nbsp;to&nbsp;r&nbsp;and&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="2831547">func</span>&nbsp;<span class="ident" id="2831552">NewReadWriter</span><span class="op" id="2831565">(</span><span class="ident" id="2831566">r</span>&nbsp;<span class="op" id="2831568">*</span><span class="ident" id="2831569">Reader</span><span class="op" id="2831575">,</span>&nbsp;<span class="ident" id="2831577">w</span>&nbsp;<span class="op" id="2831579">*</span><span class="ident" id="2831580">Writer</span><span class="op" id="2831586">)</span>&nbsp;<span class="op" id="2831588">*</span><span class="ident" id="2831589">ReadWriter</span>&nbsp;<span class="op" id="2831600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2831603">return</span>&nbsp;<span class="op" id="2831610">&amp;</span><span class="ident" id="2831611">ReadWriter</span><span class="op" id="2831621">{</span><span class="ident" id="2831622">r</span><span class="op" id="2831623">,</span>&nbsp;<span class="ident" id="2831625">w</span><span class="op" id="2831626">}</span><br>
<span class="lineno"></span><span class="op" id="2831628">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
