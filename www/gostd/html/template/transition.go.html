<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4610044">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4610099">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4610153">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4610204">package</span>&nbsp;<span class="ident" id="4610212">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4610222">import</span>&nbsp;<span class="op" id="4610229">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4610232">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4610241">&#34;strings&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4610251">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4610254">//&nbsp;transitionFunc&nbsp;is&nbsp;the&nbsp;array&nbsp;of&nbsp;context&nbsp;transition&nbsp;functions&nbsp;for&nbsp;text&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="comment" id="4610333">//&nbsp;A&nbsp;transition&nbsp;function&nbsp;takes&nbsp;a&nbsp;context&nbsp;and&nbsp;template&nbsp;text&nbsp;input,&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="4610411">//&nbsp;the&nbsp;updated&nbsp;context&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;consumed&nbsp;from&nbsp;the&nbsp;front&nbsp;of&nbsp;the</span><br>
<span class="lineno">15</span><span class="comment" id="4610489">//&nbsp;input.</span><br>
<span class="lineno"></span><span class="keyword" id="4610499">var</span>&nbsp;<span class="ident" id="4610503">transitionFunc</span>&nbsp;<span class="op" id="4610518">=</span>&nbsp;<span class="op" id="4610520">[</span><span class="op" id="4610521">...</span><span class="op" id="4610524">]</span><span class="keyword" id="4610525">func</span><span class="op" id="4610529">(</span><span class="ident" id="4610530">context</span><span class="op" id="4610537">,</span>&nbsp;<span class="op" id="4610539">[</span><span class="op" id="4610540">]</span><span class="builtintype" id="4610541">byte</span><span class="op" id="4610545">)</span>&nbsp;<span class="op" id="4610547">(</span><span class="ident" id="4610548">context</span><span class="op" id="4610555">,</span>&nbsp;<span class="builtintype" id="4610557">int</span><span class="op" id="4610560">)</span><span class="op" id="4610561">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4610564">stateText</span><span class="op" id="4610573">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4610582">tText</span><span class="op" id="4610587">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4610590">stateTag</span><span class="op" id="4610598">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4610608">tTag</span><span class="op" id="4610612">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4610615">stateAttrName</span><span class="op" id="4610628">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4610633">tAttrName</span><span class="op" id="4610642">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4610645">stateAfterName</span><span class="op" id="4610659">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4610663">tAfterName</span><span class="op" id="4610673">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4610676">stateBeforeValue</span><span class="op" id="4610692">:</span>&nbsp;<span class="ident" id="4610694">tBeforeValue</span><span class="op" id="4610706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4610709">stateHTMLCmt</span><span class="op" id="4610721">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4610727">tHTMLCmt</span><span class="op" id="4610735">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4610738">stateRCDATA</span><span class="op" id="4610749">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4610756">tSpecialTagEnd</span><span class="op" id="4610770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4610773">stateAttr</span><span class="op" id="4610782">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4610791">tAttr</span><span class="op" id="4610796">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4610799">stateURL</span><span class="op" id="4610807">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4610817">tURL</span><span class="op" id="4610821">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4610824">stateJS</span><span class="op" id="4610831">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4610842">tJS</span><span class="op" id="4610845">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4610848">stateJSDqStr</span><span class="op" id="4610860">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4610866">tJSDelimited</span><span class="op" id="4610878">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4610881">stateJSSqStr</span><span class="op" id="4610893">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4610899">tJSDelimited</span><span class="op" id="4610911">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4610914">stateJSRegexp</span><span class="op" id="4610927">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4610932">tJSDelimited</span><span class="op" id="4610944">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4610947">stateJSBlockCmt</span><span class="op" id="4610962">:</span>&nbsp;&nbsp;<span class="ident" id="4610965">tBlockCmt</span><span class="op" id="4610974">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4610977">stateJSLineCmt</span><span class="op" id="4610991">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4610995">tLineCmt</span><span class="op" id="4611003">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611006">stateCSS</span><span class="op" id="4611014">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4611024">tCSS</span><span class="op" id="4611028">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611031">stateCSSDqStr</span><span class="op" id="4611044">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4611049">tCSSStr</span><span class="op" id="4611056">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611059">stateCSSSqStr</span><span class="op" id="4611072">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4611077">tCSSStr</span><span class="op" id="4611084">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611087">stateCSSDqURL</span><span class="op" id="4611100">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4611105">tCSSStr</span><span class="op" id="4611112">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611115">stateCSSSqURL</span><span class="op" id="4611128">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4611133">tCSSStr</span><span class="op" id="4611140">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611143">stateCSSURL</span><span class="op" id="4611154">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4611161">tCSSStr</span><span class="op" id="4611168">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611171">stateCSSBlockCmt</span><span class="op" id="4611187">:</span>&nbsp;<span class="ident" id="4611189">tBlockCmt</span><span class="op" id="4611198">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611201">stateCSSLineCmt</span><span class="op" id="4611216">:</span>&nbsp;&nbsp;<span class="ident" id="4611219">tLineCmt</span><span class="op" id="4611227">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611230">stateError</span><span class="op" id="4611240">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4611248">tError</span><span class="op" id="4611254">,</span><br>
<span class="lineno"></span><span class="op" id="4611256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4611259">var</span>&nbsp;<span class="ident" id="4611263">commentStart</span>&nbsp;<span class="op" id="4611276">=</span>&nbsp;<span class="op" id="4611278">[</span><span class="op" id="4611279">]</span><span class="builtintype" id="4611280">byte</span><span class="op" id="4611284">(</span><span class="string" id="4611285">&#34;&lt;!--&#34;</span><span class="op" id="4611291">)</span><br>
<span class="lineno"></span><span class="keyword" id="4611293">var</span>&nbsp;<span class="ident" id="4611297">commentEnd</span>&nbsp;<span class="op" id="4611308">=</span>&nbsp;<span class="op" id="4611310">[</span><span class="op" id="4611311">]</span><span class="builtintype" id="4611312">byte</span><span class="op" id="4611316">(</span><span class="string" id="4611317">&#34;--&gt;&#34;</span><span class="op" id="4611322">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="4611325">//&nbsp;tText&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;text&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4611389">func</span>&nbsp;<span class="ident" id="4611394">tText</span><span class="op" id="4611399">(</span><span class="ident" id="4611400">c</span>&nbsp;<span class="ident" id="4611402">context</span><span class="op" id="4611409">,</span>&nbsp;<span class="ident" id="4611411">s</span>&nbsp;<span class="op" id="4611413">[</span><span class="op" id="4611414">]</span><span class="builtintype" id="4611415">byte</span><span class="op" id="4611419">)</span>&nbsp;<span class="op" id="4611421">(</span><span class="ident" id="4611422">context</span><span class="op" id="4611429">,</span>&nbsp;<span class="builtintype" id="4611431">int</span><span class="op" id="4611434">)</span>&nbsp;<span class="op" id="4611436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611439">k</span>&nbsp;<span class="op" id="4611441">:=</span>&nbsp;<span class="num" id="4611444">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4611447">for</span>&nbsp;<span class="op" id="4611451">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611455">i</span>&nbsp;<span class="op" id="4611457">:=</span>&nbsp;<span class="ident" id="4611460">k</span>&nbsp;<span class="op" id="4611462">+</span>&nbsp;<span class="ident" id="4611464">bytes</span><span class="op" id="4611469">.</span><span class="ident" id="4611470">IndexByte</span><span class="op" id="4611479">(</span><span class="ident" id="4611480">s</span><span class="op" id="4611481">[</span><span class="ident" id="4611482">k</span><span class="op" id="4611483">:</span><span class="op" id="4611484">]</span><span class="op" id="4611485">,</span>&nbsp;<span class="string" id="4611487">&#39;&lt;&#39;</span><span class="op" id="4611490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4611494">if</span>&nbsp;<span class="ident" id="4611497">i</span>&nbsp;<span class="op" id="4611499">&lt;</span>&nbsp;<span class="ident" id="4611501">k</span>&nbsp;<span class="op" id="4611503">||</span>&nbsp;<span class="ident" id="4611506">i</span><span class="op" id="4611507">+</span><span class="num" id="4611508">1</span>&nbsp;<span class="op" id="4611510">==</span>&nbsp;<span class="builtinfunc" id="4611513">len</span><span class="op" id="4611516">(</span><span class="ident" id="4611517">s</span><span class="op" id="4611518">)</span>&nbsp;<span class="op" id="4611520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4611525">return</span>&nbsp;<span class="ident" id="4611532">c</span><span class="op" id="4611533">,</span>&nbsp;<span class="builtinfunc" id="4611535">len</span><span class="op" id="4611538">(</span><span class="ident" id="4611539">s</span><span class="op" id="4611540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4611544">}</span>&nbsp;<span class="keyword" id="4611546">else</span>&nbsp;<span class="keyword" id="4611551">if</span>&nbsp;<span class="ident" id="4611554">i</span><span class="op" id="4611555">+</span><span class="num" id="4611556">4</span>&nbsp;<span class="op" id="4611558">&lt;=</span>&nbsp;<span class="builtinfunc" id="4611561">len</span><span class="op" id="4611564">(</span><span class="ident" id="4611565">s</span><span class="op" id="4611566">)</span>&nbsp;<span class="op" id="4611568">&amp;&amp;</span>&nbsp;<span class="ident" id="4611571">bytes</span><span class="op" id="4611576">.</span><span class="ident" id="4611577">Equal</span><span class="op" id="4611582">(</span><span class="ident" id="4611583">commentStart</span><span class="op" id="4611595">,</span>&nbsp;<span class="ident" id="4611597">s</span><span class="op" id="4611598">[</span><span class="ident" id="4611599">i</span><span class="op" id="4611600">:</span><span class="ident" id="4611601">i</span><span class="op" id="4611602">+</span><span class="num" id="4611603">4</span><span class="op" id="4611604">]</span><span class="op" id="4611605">)</span>&nbsp;<span class="op" id="4611607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4611612">return</span>&nbsp;<span class="ident" id="4611619">context</span><span class="op" id="4611626">{</span><span class="ident" id="4611627">state</span><span class="op" id="4611632">:</span>&nbsp;<span class="ident" id="4611634">stateHTMLCmt</span><span class="op" id="4611646">}</span><span class="op" id="4611647">,</span>&nbsp;<span class="ident" id="4611649">i</span>&nbsp;<span class="op" id="4611651">+</span>&nbsp;<span class="num" id="4611653">4</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4611657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611661">i</span><span class="op" id="4611662">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611667">end</span>&nbsp;<span class="op" id="4611671">:=</span>&nbsp;<span class="builtintype" id="4611674">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4611682">if</span>&nbsp;<span class="ident" id="4611685">s</span><span class="op" id="4611686">[</span><span class="ident" id="4611687">i</span><span class="op" id="4611688">]</span>&nbsp;<span class="op" id="4611690">==</span>&nbsp;<span class="string" id="4611693">&#39;/&#39;</span>&nbsp;<span class="op" id="4611697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4611702">if</span>&nbsp;<span class="ident" id="4611705">i</span><span class="op" id="4611706">+</span><span class="num" id="4611707">1</span>&nbsp;<span class="op" id="4611709">==</span>&nbsp;<span class="builtinfunc" id="4611712">len</span><span class="op" id="4611715">(</span><span class="ident" id="4611716">s</span><span class="op" id="4611717">)</span>&nbsp;<span class="op" id="4611719">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4611725">return</span>&nbsp;<span class="ident" id="4611732">c</span><span class="op" id="4611733">,</span>&nbsp;<span class="builtinfunc" id="4611735">len</span><span class="op" id="4611738">(</span><span class="ident" id="4611739">s</span><span class="op" id="4611740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4611745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611750">end</span><span class="op" id="4611753">,</span>&nbsp;<span class="ident" id="4611755">i</span>&nbsp;<span class="op" id="4611757">=</span>&nbsp;<span class="builtintype" id="4611759">true</span><span class="op" id="4611763">,</span>&nbsp;<span class="ident" id="4611765">i</span><span class="op" id="4611766">+</span><span class="num" id="4611767">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4611771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611775">j</span><span class="op" id="4611776">,</span>&nbsp;<span class="ident" id="4611778">e</span>&nbsp;<span class="op" id="4611780">:=</span>&nbsp;<span class="ident" id="4611783">eatTagName</span><span class="op" id="4611793">(</span><span class="ident" id="4611794">s</span><span class="op" id="4611795">,</span>&nbsp;<span class="ident" id="4611797">i</span><span class="op" id="4611798">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4611802">if</span>&nbsp;<span class="ident" id="4611805">j</span>&nbsp;<span class="op" id="4611807">!=</span>&nbsp;<span class="ident" id="4611810">i</span>&nbsp;<span class="op" id="4611812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4611817">if</span>&nbsp;<span class="ident" id="4611820">end</span>&nbsp;<span class="op" id="4611824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611830">e</span>&nbsp;<span class="op" id="4611832">=</span>&nbsp;<span class="ident" id="4611834">elementNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4611849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4611854">//&nbsp;We&#39;ve&nbsp;found&nbsp;an&nbsp;HTML&nbsp;tag.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4611885">return</span>&nbsp;<span class="ident" id="4611892">context</span><span class="op" id="4611899">{</span><span class="ident" id="4611900">state</span><span class="op" id="4611905">:</span>&nbsp;<span class="ident" id="4611907">stateTag</span><span class="op" id="4611915">,</span>&nbsp;<span class="ident" id="4611917">element</span><span class="op" id="4611924">:</span>&nbsp;<span class="ident" id="4611926">e</span><span class="op" id="4611927">}</span><span class="op" id="4611928">,</span>&nbsp;<span class="ident" id="4611930">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4611934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611938">k</span>&nbsp;<span class="op" id="4611940">=</span>&nbsp;<span class="ident" id="4611942">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4611945">}</span><br>
<span class="lineno"></span><span class="op" id="4611947">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span><span class="keyword" id="4611950">var</span>&nbsp;<span class="ident" id="4611954">elementContentType</span>&nbsp;<span class="op" id="4611973">=</span>&nbsp;<span class="op" id="4611975">[</span><span class="op" id="4611976">...</span><span class="op" id="4611979">]</span><span class="ident" id="4611980">state</span><span class="op" id="4611985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611988">elementNone</span><span class="op" id="4611999">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4612005">stateText</span><span class="op" id="4612014">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612017">elementScript</span><span class="op" id="4612030">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4612034">stateJS</span><span class="op" id="4612041">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612044">elementStyle</span><span class="op" id="4612056">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4612061">stateCSS</span><span class="op" id="4612069">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612072">elementTextarea</span><span class="op" id="4612087">:</span>&nbsp;<span class="ident" id="4612089">stateRCDATA</span><span class="op" id="4612100">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612103">elementTitle</span><span class="op" id="4612115">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4612120">stateRCDATA</span><span class="op" id="4612131">,</span><br>
<span class="lineno"></span><span class="op" id="4612133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4612136">//&nbsp;tTag&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;tag&nbsp;state.</span><br>
<span class="lineno">85</span><span class="keyword" id="4612198">func</span>&nbsp;<span class="ident" id="4612203">tTag</span><span class="op" id="4612207">(</span><span class="ident" id="4612208">c</span>&nbsp;<span class="ident" id="4612210">context</span><span class="op" id="4612217">,</span>&nbsp;<span class="ident" id="4612219">s</span>&nbsp;<span class="op" id="4612221">[</span><span class="op" id="4612222">]</span><span class="builtintype" id="4612223">byte</span><span class="op" id="4612227">)</span>&nbsp;<span class="op" id="4612229">(</span><span class="ident" id="4612230">context</span><span class="op" id="4612237">,</span>&nbsp;<span class="builtintype" id="4612239">int</span><span class="op" id="4612242">)</span>&nbsp;<span class="op" id="4612244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4612247">//&nbsp;Find&nbsp;the&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612276">i</span>&nbsp;<span class="op" id="4612278">:=</span>&nbsp;<span class="ident" id="4612281">eatWhiteSpace</span><span class="op" id="4612294">(</span><span class="ident" id="4612295">s</span><span class="op" id="4612296">,</span>&nbsp;<span class="num" id="4612298">0</span><span class="op" id="4612299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4612302">if</span>&nbsp;<span class="ident" id="4612305">i</span>&nbsp;<span class="op" id="4612307">==</span>&nbsp;<span class="builtinfunc" id="4612310">len</span><span class="op" id="4612313">(</span><span class="ident" id="4612314">s</span><span class="op" id="4612315">)</span>&nbsp;<span class="op" id="4612317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4612321">return</span>&nbsp;<span class="ident" id="4612328">c</span><span class="op" id="4612329">,</span>&nbsp;<span class="builtinfunc" id="4612331">len</span><span class="op" id="4612334">(</span><span class="ident" id="4612335">s</span><span class="op" id="4612336">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4612339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4612342">if</span>&nbsp;<span class="ident" id="4612345">s</span><span class="op" id="4612346">[</span><span class="ident" id="4612347">i</span><span class="op" id="4612348">]</span>&nbsp;<span class="op" id="4612350">==</span>&nbsp;<span class="string" id="4612353">&#39;&gt;&#39;</span>&nbsp;<span class="op" id="4612357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4612361">return</span>&nbsp;<span class="ident" id="4612368">context</span><span class="op" id="4612375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612380">state</span><span class="op" id="4612385">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4612389">elementContentType</span><span class="op" id="4612407">[</span><span class="ident" id="4612408">c</span><span class="op" id="4612409">.</span><span class="ident" id="4612410">element</span><span class="op" id="4612417">]</span><span class="op" id="4612418">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612423">element</span><span class="op" id="4612430">:</span>&nbsp;<span class="ident" id="4612432">c</span><span class="op" id="4612433">.</span><span class="ident" id="4612434">element</span><span class="op" id="4612441">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4612445">}</span><span class="op" id="4612446">,</span>&nbsp;<span class="ident" id="4612448">i</span>&nbsp;<span class="op" id="4612450">+</span>&nbsp;<span class="num" id="4612452">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4612455">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612458">j</span><span class="op" id="4612459">,</span>&nbsp;<span class="ident" id="4612461">err</span>&nbsp;<span class="op" id="4612465">:=</span>&nbsp;<span class="ident" id="4612468">eatAttrName</span><span class="op" id="4612479">(</span><span class="ident" id="4612480">s</span><span class="op" id="4612481">,</span>&nbsp;<span class="ident" id="4612483">i</span><span class="op" id="4612484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4612487">if</span>&nbsp;<span class="ident" id="4612490">err</span>&nbsp;<span class="op" id="4612494">!=</span>&nbsp;<span class="ident" id="4612497">nil</span>&nbsp;<span class="op" id="4612501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4612505">return</span>&nbsp;<span class="ident" id="4612512">context</span><span class="op" id="4612519">{</span><span class="ident" id="4612520">state</span><span class="op" id="4612525">:</span>&nbsp;<span class="ident" id="4612527">stateError</span><span class="op" id="4612537">,</span>&nbsp;<span class="ident" id="4612539">err</span><span class="op" id="4612542">:</span>&nbsp;<span class="ident" id="4612544">err</span><span class="op" id="4612547">}</span><span class="op" id="4612548">,</span>&nbsp;<span class="builtinfunc" id="4612550">len</span><span class="op" id="4612553">(</span><span class="ident" id="4612554">s</span><span class="op" id="4612555">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4612558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612561">state</span><span class="op" id="4612566">,</span>&nbsp;<span class="ident" id="4612568">attr</span>&nbsp;<span class="op" id="4612573">:=</span>&nbsp;<span class="ident" id="4612576">stateTag</span><span class="op" id="4612584">,</span>&nbsp;<span class="ident" id="4612586">attrNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4612596">if</span>&nbsp;<span class="ident" id="4612599">i</span>&nbsp;<span class="op" id="4612601">==</span>&nbsp;<span class="ident" id="4612604">j</span>&nbsp;<span class="op" id="4612606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4612610">return</span>&nbsp;<span class="ident" id="4612617">context</span><span class="op" id="4612624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612629">state</span><span class="op" id="4612634">:</span>&nbsp;<span class="ident" id="4612636">stateError</span><span class="op" id="4612646">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612651">err</span><span class="op" id="4612654">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4612658">errorf</span><span class="op" id="4612664">(</span><span class="ident" id="4612665">ErrBadHTML</span><span class="op" id="4612675">,</span>&nbsp;<span class="ident" id="4612677">nil</span><span class="op" id="4612680">,</span>&nbsp;<span class="num" id="4612682">0</span><span class="op" id="4612683">,</span>&nbsp;<span class="string" id="4612685">&#34;expected&nbsp;space,&nbsp;attr&nbsp;name,&nbsp;or&nbsp;end&nbsp;of&nbsp;tag,&nbsp;but&nbsp;got&nbsp;%q&#34;</span><span class="op" id="4612739">,</span>&nbsp;<span class="ident" id="4612741">s</span><span class="op" id="4612742">[</span><span class="ident" id="4612743">i</span><span class="op" id="4612744">:</span><span class="op" id="4612745">]</span><span class="op" id="4612746">)</span><span class="op" id="4612747">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4612751">}</span><span class="op" id="4612752">,</span>&nbsp;<span class="builtinfunc" id="4612754">len</span><span class="op" id="4612757">(</span><span class="ident" id="4612758">s</span><span class="op" id="4612759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4612762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4612765">switch</span>&nbsp;<span class="ident" id="4612772">attrType</span><span class="op" id="4612780">(</span><span class="builtintype" id="4612781">string</span><span class="op" id="4612787">(</span><span class="ident" id="4612788">s</span><span class="op" id="4612789">[</span><span class="ident" id="4612790">i</span><span class="op" id="4612791">:</span><span class="ident" id="4612792">j</span><span class="op" id="4612793">]</span><span class="op" id="4612794">)</span><span class="op" id="4612795">)</span>&nbsp;<span class="op" id="4612797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4612800">case</span>&nbsp;<span class="ident" id="4612805">contentTypeURL</span><span class="op" id="4612819">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612823">attr</span>&nbsp;<span class="op" id="4612828">=</span>&nbsp;<span class="ident" id="4612830">attrURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4612839">case</span>&nbsp;<span class="ident" id="4612844">contentTypeCSS</span><span class="op" id="4612858">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612862">attr</span>&nbsp;<span class="op" id="4612867">=</span>&nbsp;<span class="ident" id="4612869">attrStyle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4612880">case</span>&nbsp;<span class="ident" id="4612885">contentTypeJS</span><span class="op" id="4612898">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612902">attr</span>&nbsp;<span class="op" id="4612907">=</span>&nbsp;<span class="ident" id="4612909">attrScript</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4612921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4612924">if</span>&nbsp;<span class="ident" id="4612927">j</span>&nbsp;<span class="op" id="4612929">==</span>&nbsp;<span class="builtinfunc" id="4612932">len</span><span class="op" id="4612935">(</span><span class="ident" id="4612936">s</span><span class="op" id="4612937">)</span>&nbsp;<span class="op" id="4612939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612943">state</span>&nbsp;<span class="op" id="4612949">=</span>&nbsp;<span class="ident" id="4612951">stateAttrName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4612966">}</span>&nbsp;<span class="keyword" id="4612968">else</span>&nbsp;<span class="op" id="4612973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612977">state</span>&nbsp;<span class="op" id="4612983">=</span>&nbsp;<span class="ident" id="4612985">stateAfterName</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4613001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4613004">return</span>&nbsp;<span class="ident" id="4613011">context</span><span class="op" id="4613018">{</span><span class="ident" id="4613019">state</span><span class="op" id="4613024">:</span>&nbsp;<span class="ident" id="4613026">state</span><span class="op" id="4613031">,</span>&nbsp;<span class="ident" id="4613033">element</span><span class="op" id="4613040">:</span>&nbsp;<span class="ident" id="4613042">c</span><span class="op" id="4613043">.</span><span class="ident" id="4613044">element</span><span class="op" id="4613051">,</span>&nbsp;<span class="ident" id="4613053">attr</span><span class="op" id="4613057">:</span>&nbsp;<span class="ident" id="4613059">attr</span><span class="op" id="4613063">}</span><span class="op" id="4613064">,</span>&nbsp;<span class="ident" id="4613066">j</span><br>
<span class="lineno"></span><span class="op" id="4613068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4613071">//&nbsp;tAttrName&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateAttrName.</span><br>
<span class="lineno">125</span><span class="keyword" id="4613138">func</span>&nbsp;<span class="ident" id="4613143">tAttrName</span><span class="op" id="4613152">(</span><span class="ident" id="4613153">c</span>&nbsp;<span class="ident" id="4613155">context</span><span class="op" id="4613162">,</span>&nbsp;<span class="ident" id="4613164">s</span>&nbsp;<span class="op" id="4613166">[</span><span class="op" id="4613167">]</span><span class="builtintype" id="4613168">byte</span><span class="op" id="4613172">)</span>&nbsp;<span class="op" id="4613174">(</span><span class="ident" id="4613175">context</span><span class="op" id="4613182">,</span>&nbsp;<span class="builtintype" id="4613184">int</span><span class="op" id="4613187">)</span>&nbsp;<span class="op" id="4613189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4613192">i</span><span class="op" id="4613193">,</span>&nbsp;<span class="ident" id="4613195">err</span>&nbsp;<span class="op" id="4613199">:=</span>&nbsp;<span class="ident" id="4613202">eatAttrName</span><span class="op" id="4613213">(</span><span class="ident" id="4613214">s</span><span class="op" id="4613215">,</span>&nbsp;<span class="num" id="4613217">0</span><span class="op" id="4613218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4613221">if</span>&nbsp;<span class="ident" id="4613224">err</span>&nbsp;<span class="op" id="4613228">!=</span>&nbsp;<span class="ident" id="4613231">nil</span>&nbsp;<span class="op" id="4613235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4613239">return</span>&nbsp;<span class="ident" id="4613246">context</span><span class="op" id="4613253">{</span><span class="ident" id="4613254">state</span><span class="op" id="4613259">:</span>&nbsp;<span class="ident" id="4613261">stateError</span><span class="op" id="4613271">,</span>&nbsp;<span class="ident" id="4613273">err</span><span class="op" id="4613276">:</span>&nbsp;<span class="ident" id="4613278">err</span><span class="op" id="4613281">}</span><span class="op" id="4613282">,</span>&nbsp;<span class="builtinfunc" id="4613284">len</span><span class="op" id="4613287">(</span><span class="ident" id="4613288">s</span><span class="op" id="4613289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4613292">}</span>&nbsp;<span class="keyword" id="4613294">else</span>&nbsp;<span class="keyword" id="4613299">if</span>&nbsp;<span class="ident" id="4613302">i</span>&nbsp;<span class="op" id="4613304">!=</span>&nbsp;<span class="builtinfunc" id="4613307">len</span><span class="op" id="4613310">(</span><span class="ident" id="4613311">s</span><span class="op" id="4613312">)</span>&nbsp;<span class="op" id="4613314">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4613318">c</span><span class="op" id="4613319">.</span><span class="ident" id="4613320">state</span>&nbsp;<span class="op" id="4613326">=</span>&nbsp;<span class="ident" id="4613328">stateAfterName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4613344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4613347">return</span>&nbsp;<span class="ident" id="4613354">c</span><span class="op" id="4613355">,</span>&nbsp;<span class="ident" id="4613357">i</span><br>
<span class="lineno"></span><span class="op" id="4613359">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="4613362">//&nbsp;tAfterName&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateAfterName.</span><br>
<span class="lineno"></span><span class="keyword" id="4613431">func</span>&nbsp;<span class="ident" id="4613436">tAfterName</span><span class="op" id="4613446">(</span><span class="ident" id="4613447">c</span>&nbsp;<span class="ident" id="4613449">context</span><span class="op" id="4613456">,</span>&nbsp;<span class="ident" id="4613458">s</span>&nbsp;<span class="op" id="4613460">[</span><span class="op" id="4613461">]</span><span class="builtintype" id="4613462">byte</span><span class="op" id="4613466">)</span>&nbsp;<span class="op" id="4613468">(</span><span class="ident" id="4613469">context</span><span class="op" id="4613476">,</span>&nbsp;<span class="builtintype" id="4613478">int</span><span class="op" id="4613481">)</span>&nbsp;<span class="op" id="4613483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4613486">//&nbsp;Look&nbsp;for&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4613523">i</span>&nbsp;<span class="op" id="4613525">:=</span>&nbsp;<span class="ident" id="4613528">eatWhiteSpace</span><span class="op" id="4613541">(</span><span class="ident" id="4613542">s</span><span class="op" id="4613543">,</span>&nbsp;<span class="num" id="4613545">0</span><span class="op" id="4613546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4613549">if</span>&nbsp;<span class="ident" id="4613552">i</span>&nbsp;<span class="op" id="4613554">==</span>&nbsp;<span class="builtinfunc" id="4613557">len</span><span class="op" id="4613560">(</span><span class="ident" id="4613561">s</span><span class="op" id="4613562">)</span>&nbsp;<span class="op" id="4613564">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4613568">return</span>&nbsp;<span class="ident" id="4613575">c</span><span class="op" id="4613576">,</span>&nbsp;<span class="builtinfunc" id="4613578">len</span><span class="op" id="4613581">(</span><span class="ident" id="4613582">s</span><span class="op" id="4613583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4613586">}</span>&nbsp;<span class="keyword" id="4613588">else</span>&nbsp;<span class="keyword" id="4613593">if</span>&nbsp;<span class="ident" id="4613596">s</span><span class="op" id="4613597">[</span><span class="ident" id="4613598">i</span><span class="op" id="4613599">]</span>&nbsp;<span class="op" id="4613601">!=</span>&nbsp;<span class="string" id="4613604">&#39;=&#39;</span>&nbsp;<span class="op" id="4613608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4613612">//&nbsp;Occurs&nbsp;due&nbsp;to&nbsp;tag&nbsp;ending&nbsp;&#39;&gt;&#39;,&nbsp;and&nbsp;valueless&nbsp;attribute.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4613672">c</span><span class="op" id="4613673">.</span><span class="ident" id="4613674">state</span>&nbsp;<span class="op" id="4613680">=</span>&nbsp;<span class="ident" id="4613682">stateTag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4613693">return</span>&nbsp;<span class="ident" id="4613700">c</span><span class="op" id="4613701">,</span>&nbsp;<span class="ident" id="4613703">i</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4613706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4613709">c</span><span class="op" id="4613710">.</span><span class="ident" id="4613711">state</span>&nbsp;<span class="op" id="4613717">=</span>&nbsp;<span class="ident" id="4613719">stateBeforeValue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4613737">//&nbsp;Consume&nbsp;the&nbsp;&#34;=&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4613758">return</span>&nbsp;<span class="ident" id="4613765">c</span><span class="op" id="4613766">,</span>&nbsp;<span class="ident" id="4613768">i</span>&nbsp;<span class="op" id="4613770">+</span>&nbsp;<span class="num" id="4613772">1</span><br>
<span class="lineno"></span><span class="op" id="4613774">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="keyword" id="4613777">var</span>&nbsp;<span class="ident" id="4613781">attrStartStates</span>&nbsp;<span class="op" id="4613797">=</span>&nbsp;<span class="op" id="4613799">[</span><span class="op" id="4613800">...</span><span class="op" id="4613803">]</span><span class="ident" id="4613804">state</span><span class="op" id="4613809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4613812">attrNone</span><span class="op" id="4613820">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4613824">stateAttr</span><span class="op" id="4613833">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4613836">attrScript</span><span class="op" id="4613846">:</span>&nbsp;<span class="ident" id="4613848">stateJS</span><span class="op" id="4613855">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4613858">attrStyle</span><span class="op" id="4613867">:</span>&nbsp;&nbsp;<span class="ident" id="4613870">stateCSS</span><span class="op" id="4613878">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4613881">attrURL</span><span class="op" id="4613888">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4613893">stateURL</span><span class="op" id="4613901">,</span><br>
<span class="lineno"></span><span class="op" id="4613903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4613906">//&nbsp;tBeforeValue&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateBeforeValue.</span><br>
<span class="lineno"></span><span class="keyword" id="4613979">func</span>&nbsp;<span class="ident" id="4613984">tBeforeValue</span><span class="op" id="4613996">(</span><span class="ident" id="4613997">c</span>&nbsp;<span class="ident" id="4613999">context</span><span class="op" id="4614006">,</span>&nbsp;<span class="ident" id="4614008">s</span>&nbsp;<span class="op" id="4614010">[</span><span class="op" id="4614011">]</span><span class="builtintype" id="4614012">byte</span><span class="op" id="4614016">)</span>&nbsp;<span class="op" id="4614018">(</span><span class="ident" id="4614019">context</span><span class="op" id="4614026">,</span>&nbsp;<span class="builtintype" id="4614028">int</span><span class="op" id="4614031">)</span>&nbsp;<span class="op" id="4614033">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4614036">i</span>&nbsp;<span class="op" id="4614038">:=</span>&nbsp;<span class="ident" id="4614041">eatWhiteSpace</span><span class="op" id="4614054">(</span><span class="ident" id="4614055">s</span><span class="op" id="4614056">,</span>&nbsp;<span class="num" id="4614058">0</span><span class="op" id="4614059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4614062">if</span>&nbsp;<span class="ident" id="4614065">i</span>&nbsp;<span class="op" id="4614067">==</span>&nbsp;<span class="builtinfunc" id="4614070">len</span><span class="op" id="4614073">(</span><span class="ident" id="4614074">s</span><span class="op" id="4614075">)</span>&nbsp;<span class="op" id="4614077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4614081">return</span>&nbsp;<span class="ident" id="4614088">c</span><span class="op" id="4614089">,</span>&nbsp;<span class="builtinfunc" id="4614091">len</span><span class="op" id="4614094">(</span><span class="ident" id="4614095">s</span><span class="op" id="4614096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4614099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4614102">//&nbsp;Find&nbsp;the&nbsp;attribute&nbsp;delimiter.</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4614136">delim</span>&nbsp;<span class="op" id="4614142">:=</span>&nbsp;<span class="ident" id="4614145">delimSpaceOrTagEnd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4614165">switch</span>&nbsp;<span class="ident" id="4614172">s</span><span class="op" id="4614173">[</span><span class="ident" id="4614174">i</span><span class="op" id="4614175">]</span>&nbsp;<span class="op" id="4614177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4614180">case</span>&nbsp;<span class="string" id="4614185">&#39;\&#39;&#39;</span><span class="op" id="4614189">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4614193">delim</span><span class="op" id="4614198">,</span>&nbsp;<span class="ident" id="4614200">i</span>&nbsp;<span class="op" id="4614202">=</span>&nbsp;<span class="ident" id="4614204">delimSingleQuote</span><span class="op" id="4614220">,</span>&nbsp;<span class="ident" id="4614222">i</span><span class="op" id="4614223">+</span><span class="num" id="4614224">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4614227">case</span>&nbsp;<span class="string" id="4614232">&#39;&#34;&#39;</span><span class="op" id="4614235">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4614239">delim</span><span class="op" id="4614244">,</span>&nbsp;<span class="ident" id="4614246">i</span>&nbsp;<span class="op" id="4614248">=</span>&nbsp;<span class="ident" id="4614250">delimDoubleQuote</span><span class="op" id="4614266">,</span>&nbsp;<span class="ident" id="4614268">i</span><span class="op" id="4614269">+</span><span class="num" id="4614270">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4614273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4614276">c</span><span class="op" id="4614277">.</span><span class="ident" id="4614278">state</span><span class="op" id="4614283">,</span>&nbsp;<span class="ident" id="4614285">c</span><span class="op" id="4614286">.</span><span class="ident" id="4614287">delim</span><span class="op" id="4614292">,</span>&nbsp;<span class="ident" id="4614294">c</span><span class="op" id="4614295">.</span><span class="ident" id="4614296">attr</span>&nbsp;<span class="op" id="4614301">=</span>&nbsp;<span class="ident" id="4614303">attrStartStates</span><span class="op" id="4614318">[</span><span class="ident" id="4614319">c</span><span class="op" id="4614320">.</span><span class="ident" id="4614321">attr</span><span class="op" id="4614325">]</span><span class="op" id="4614326">,</span>&nbsp;<span class="ident" id="4614328">delim</span><span class="op" id="4614333">,</span>&nbsp;<span class="ident" id="4614335">attrNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4614345">return</span>&nbsp;<span class="ident" id="4614352">c</span><span class="op" id="4614353">,</span>&nbsp;<span class="ident" id="4614355">i</span><br>
<span class="lineno"></span><span class="op" id="4614357">}</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span><span class="comment" id="4614360">//&nbsp;tHTMLCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;stateHTMLCmt.</span><br>
<span class="lineno"></span><span class="keyword" id="4614425">func</span>&nbsp;<span class="ident" id="4614430">tHTMLCmt</span><span class="op" id="4614438">(</span><span class="ident" id="4614439">c</span>&nbsp;<span class="ident" id="4614441">context</span><span class="op" id="4614448">,</span>&nbsp;<span class="ident" id="4614450">s</span>&nbsp;<span class="op" id="4614452">[</span><span class="op" id="4614453">]</span><span class="builtintype" id="4614454">byte</span><span class="op" id="4614458">)</span>&nbsp;<span class="op" id="4614460">(</span><span class="ident" id="4614461">context</span><span class="op" id="4614468">,</span>&nbsp;<span class="builtintype" id="4614470">int</span><span class="op" id="4614473">)</span>&nbsp;<span class="op" id="4614475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4614478">if</span>&nbsp;<span class="ident" id="4614481">i</span>&nbsp;<span class="op" id="4614483">:=</span>&nbsp;<span class="ident" id="4614486">bytes</span><span class="op" id="4614491">.</span><span class="ident" id="4614492">Index</span><span class="op" id="4614497">(</span><span class="ident" id="4614498">s</span><span class="op" id="4614499">,</span>&nbsp;<span class="ident" id="4614501">commentEnd</span><span class="op" id="4614511">)</span><span class="op" id="4614512">;</span>&nbsp;<span class="ident" id="4614514">i</span>&nbsp;<span class="op" id="4614516">!=</span>&nbsp;<span class="op" id="4614519">-</span><span class="num" id="4614520">1</span>&nbsp;<span class="op" id="4614522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4614526">return</span>&nbsp;<span class="ident" id="4614533">context</span><span class="op" id="4614540">{</span><span class="op" id="4614541">}</span><span class="op" id="4614542">,</span>&nbsp;<span class="ident" id="4614544">i</span>&nbsp;<span class="op" id="4614546">+</span>&nbsp;<span class="num" id="4614548">3</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4614551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4614554">return</span>&nbsp;<span class="ident" id="4614561">c</span><span class="op" id="4614562">,</span>&nbsp;<span class="builtinfunc" id="4614564">len</span><span class="op" id="4614567">(</span><span class="ident" id="4614568">s</span><span class="op" id="4614569">)</span><br>
<span class="lineno"></span><span class="op" id="4614571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4614574">//&nbsp;specialTagEndMarkers&nbsp;maps&nbsp;element&nbsp;types&nbsp;to&nbsp;the&nbsp;character&nbsp;sequence&nbsp;that</span><br>
<span class="lineno">185</span><span class="comment" id="4614648">//&nbsp;case-insensitively&nbsp;signals&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;special&nbsp;tag&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="4614711">var</span>&nbsp;<span class="ident" id="4614715">specialTagEndMarkers</span>&nbsp;<span class="op" id="4614736">=</span>&nbsp;<span class="op" id="4614738">[</span><span class="op" id="4614739">...</span><span class="op" id="4614742">]</span><span class="builtintype" id="4614743">string</span><span class="op" id="4614749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4614752">elementScript</span><span class="op" id="4614765">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="4614769">&#34;&lt;/script&#34;</span><span class="op" id="4614779">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4614782">elementStyle</span><span class="op" id="4614794">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4614799">&#34;&lt;/style&#34;</span><span class="op" id="4614808">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4614811">elementTextarea</span><span class="op" id="4614826">:</span>&nbsp;<span class="string" id="4614828">&#34;&lt;/textarea&#34;</span><span class="op" id="4614840">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4614843">elementTitle</span><span class="op" id="4614855">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4614860">&#34;&lt;/title&#34;</span><span class="op" id="4614869">,</span><br>
<span class="lineno"></span><span class="op" id="4614871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4614874">//&nbsp;tSpecialTagEnd&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;raw&nbsp;text&nbsp;and&nbsp;RCDATA</span><br>
<span class="lineno"></span><span class="comment" id="4614951">//&nbsp;element&nbsp;states.</span><br>
<span class="lineno">195</span><span class="keyword" id="4614970">func</span>&nbsp;<span class="ident" id="4614975">tSpecialTagEnd</span><span class="op" id="4614989">(</span><span class="ident" id="4614990">c</span>&nbsp;<span class="ident" id="4614992">context</span><span class="op" id="4614999">,</span>&nbsp;<span class="ident" id="4615001">s</span>&nbsp;<span class="op" id="4615003">[</span><span class="op" id="4615004">]</span><span class="builtintype" id="4615005">byte</span><span class="op" id="4615009">)</span>&nbsp;<span class="op" id="4615011">(</span><span class="ident" id="4615012">context</span><span class="op" id="4615019">,</span>&nbsp;<span class="builtintype" id="4615021">int</span><span class="op" id="4615024">)</span>&nbsp;<span class="op" id="4615026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4615029">if</span>&nbsp;<span class="ident" id="4615032">c</span><span class="op" id="4615033">.</span><span class="ident" id="4615034">element</span>&nbsp;<span class="op" id="4615042">!=</span>&nbsp;<span class="ident" id="4615045">elementNone</span>&nbsp;<span class="op" id="4615057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4615061">if</span>&nbsp;<span class="ident" id="4615064">i</span>&nbsp;<span class="op" id="4615066">:=</span>&nbsp;<span class="ident" id="4615069">strings</span><span class="op" id="4615076">.</span><span class="ident" id="4615077">Index</span><span class="op" id="4615082">(</span><span class="ident" id="4615083">strings</span><span class="op" id="4615090">.</span><span class="ident" id="4615091">ToLower</span><span class="op" id="4615098">(</span><span class="builtintype" id="4615099">string</span><span class="op" id="4615105">(</span><span class="ident" id="4615106">s</span><span class="op" id="4615107">)</span><span class="op" id="4615108">)</span><span class="op" id="4615109">,</span>&nbsp;<span class="ident" id="4615111">specialTagEndMarkers</span><span class="op" id="4615131">[</span><span class="ident" id="4615132">c</span><span class="op" id="4615133">.</span><span class="ident" id="4615134">element</span><span class="op" id="4615141">]</span><span class="op" id="4615142">)</span><span class="op" id="4615143">;</span>&nbsp;<span class="ident" id="4615145">i</span>&nbsp;<span class="op" id="4615147">!=</span>&nbsp;<span class="op" id="4615150">-</span><span class="num" id="4615151">1</span>&nbsp;<span class="op" id="4615153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4615158">return</span>&nbsp;<span class="ident" id="4615165">context</span><span class="op" id="4615172">{</span><span class="op" id="4615173">}</span><span class="op" id="4615174">,</span>&nbsp;<span class="ident" id="4615176">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4615180">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4615183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4615186">return</span>&nbsp;<span class="ident" id="4615193">c</span><span class="op" id="4615194">,</span>&nbsp;<span class="builtinfunc" id="4615196">len</span><span class="op" id="4615199">(</span><span class="ident" id="4615200">s</span><span class="op" id="4615201">)</span><br>
<span class="lineno"></span><span class="op" id="4615203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4615206">//&nbsp;tAttr&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;attribute&nbsp;state.</span><br>
<span class="lineno">205</span><span class="keyword" id="4615275">func</span>&nbsp;<span class="ident" id="4615280">tAttr</span><span class="op" id="4615285">(</span><span class="ident" id="4615286">c</span>&nbsp;<span class="ident" id="4615288">context</span><span class="op" id="4615295">,</span>&nbsp;<span class="ident" id="4615297">s</span>&nbsp;<span class="op" id="4615299">[</span><span class="op" id="4615300">]</span><span class="builtintype" id="4615301">byte</span><span class="op" id="4615305">)</span>&nbsp;<span class="op" id="4615307">(</span><span class="ident" id="4615308">context</span><span class="op" id="4615315">,</span>&nbsp;<span class="builtintype" id="4615317">int</span><span class="op" id="4615320">)</span>&nbsp;<span class="op" id="4615322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4615325">return</span>&nbsp;<span class="ident" id="4615332">c</span><span class="op" id="4615333">,</span>&nbsp;<span class="builtinfunc" id="4615335">len</span><span class="op" id="4615338">(</span><span class="ident" id="4615339">s</span><span class="op" id="4615340">)</span><br>
<span class="lineno"></span><span class="op" id="4615342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4615345">//&nbsp;tURL&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;URL&nbsp;state.</span><br>
<span class="lineno">210</span><span class="keyword" id="4615407">func</span>&nbsp;<span class="ident" id="4615412">tURL</span><span class="op" id="4615416">(</span><span class="ident" id="4615417">c</span>&nbsp;<span class="ident" id="4615419">context</span><span class="op" id="4615426">,</span>&nbsp;<span class="ident" id="4615428">s</span>&nbsp;<span class="op" id="4615430">[</span><span class="op" id="4615431">]</span><span class="builtintype" id="4615432">byte</span><span class="op" id="4615436">)</span>&nbsp;<span class="op" id="4615438">(</span><span class="ident" id="4615439">context</span><span class="op" id="4615446">,</span>&nbsp;<span class="builtintype" id="4615448">int</span><span class="op" id="4615451">)</span>&nbsp;<span class="op" id="4615453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4615456">if</span>&nbsp;<span class="ident" id="4615459">bytes</span><span class="op" id="4615464">.</span><span class="ident" id="4615465">IndexAny</span><span class="op" id="4615473">(</span><span class="ident" id="4615474">s</span><span class="op" id="4615475">,</span>&nbsp;<span class="string" id="4615477">&#34;#?&#34;</span><span class="op" id="4615481">)</span>&nbsp;<span class="op" id="4615483">&gt;=</span>&nbsp;<span class="num" id="4615486">0</span>&nbsp;<span class="op" id="4615488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4615492">c</span><span class="op" id="4615493">.</span><span class="ident" id="4615494">urlPart</span>&nbsp;<span class="op" id="4615502">=</span>&nbsp;<span class="ident" id="4615504">urlPartQueryOrFrag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4615524">}</span>&nbsp;<span class="keyword" id="4615526">else</span>&nbsp;<span class="keyword" id="4615531">if</span>&nbsp;<span class="builtinfunc" id="4615534">len</span><span class="op" id="4615537">(</span><span class="ident" id="4615538">s</span><span class="op" id="4615539">)</span>&nbsp;<span class="op" id="4615541">!=</span>&nbsp;<span class="ident" id="4615544">eatWhiteSpace</span><span class="op" id="4615557">(</span><span class="ident" id="4615558">s</span><span class="op" id="4615559">,</span>&nbsp;<span class="num" id="4615561">0</span><span class="op" id="4615562">)</span>&nbsp;<span class="op" id="4615564">&amp;&amp;</span>&nbsp;<span class="ident" id="4615567">c</span><span class="op" id="4615568">.</span><span class="ident" id="4615569">urlPart</span>&nbsp;<span class="op" id="4615577">==</span>&nbsp;<span class="ident" id="4615580">urlPartNone</span>&nbsp;<span class="op" id="4615592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4615596">//&nbsp;HTML5&nbsp;uses&nbsp;&#34;Valid&nbsp;URL&nbsp;potentially&nbsp;surrounded&nbsp;by&nbsp;spaces&#34;&nbsp;for</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4615661">//&nbsp;attrs:&nbsp;http://www.w3.org/TR/html5/index.html#attributes-1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4615724">c</span><span class="op" id="4615725">.</span><span class="ident" id="4615726">urlPart</span>&nbsp;<span class="op" id="4615734">=</span>&nbsp;<span class="ident" id="4615736">urlPartPreQuery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4615753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4615756">return</span>&nbsp;<span class="ident" id="4615763">c</span><span class="op" id="4615764">,</span>&nbsp;<span class="builtinfunc" id="4615766">len</span><span class="op" id="4615769">(</span><span class="ident" id="4615770">s</span><span class="op" id="4615771">)</span><br>
<span class="lineno"></span><span class="op" id="4615773">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="4615776">//&nbsp;tJS&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;JS&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4615836">func</span>&nbsp;<span class="ident" id="4615841">tJS</span><span class="op" id="4615844">(</span><span class="ident" id="4615845">c</span>&nbsp;<span class="ident" id="4615847">context</span><span class="op" id="4615854">,</span>&nbsp;<span class="ident" id="4615856">s</span>&nbsp;<span class="op" id="4615858">[</span><span class="op" id="4615859">]</span><span class="builtintype" id="4615860">byte</span><span class="op" id="4615864">)</span>&nbsp;<span class="op" id="4615866">(</span><span class="ident" id="4615867">context</span><span class="op" id="4615874">,</span>&nbsp;<span class="builtintype" id="4615876">int</span><span class="op" id="4615879">)</span>&nbsp;<span class="op" id="4615881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4615884">i</span>&nbsp;<span class="op" id="4615886">:=</span>&nbsp;<span class="ident" id="4615889">bytes</span><span class="op" id="4615894">.</span><span class="ident" id="4615895">IndexAny</span><span class="op" id="4615903">(</span><span class="ident" id="4615904">s</span><span class="op" id="4615905">,</span>&nbsp;<span class="string" id="4615907">`&#34;&#39;/`</span><span class="op" id="4615912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4615915">if</span>&nbsp;<span class="ident" id="4615918">i</span>&nbsp;<span class="op" id="4615920">==</span>&nbsp;<span class="op" id="4615923">-</span><span class="num" id="4615924">1</span>&nbsp;<span class="op" id="4615926">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4615930">//&nbsp;Entire&nbsp;input&nbsp;is&nbsp;non&nbsp;string,&nbsp;comment,&nbsp;regexp&nbsp;tokens.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4615987">c</span><span class="op" id="4615988">.</span><span class="ident" id="4615989">jsCtx</span>&nbsp;<span class="op" id="4615995">=</span>&nbsp;<span class="ident" id="4615997">nextJSCtx</span><span class="op" id="4616006">(</span><span class="ident" id="4616007">s</span><span class="op" id="4616008">,</span>&nbsp;<span class="ident" id="4616010">c</span><span class="op" id="4616011">.</span><span class="ident" id="4616012">jsCtx</span><span class="op" id="4616017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4616021">return</span>&nbsp;<span class="ident" id="4616028">c</span><span class="op" id="4616029">,</span>&nbsp;<span class="builtinfunc" id="4616031">len</span><span class="op" id="4616034">(</span><span class="ident" id="4616035">s</span><span class="op" id="4616036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4616039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4616042">c</span><span class="op" id="4616043">.</span><span class="ident" id="4616044">jsCtx</span>&nbsp;<span class="op" id="4616050">=</span>&nbsp;<span class="ident" id="4616052">nextJSCtx</span><span class="op" id="4616061">(</span><span class="ident" id="4616062">s</span><span class="op" id="4616063">[</span><span class="op" id="4616064">:</span><span class="ident" id="4616065">i</span><span class="op" id="4616066">]</span><span class="op" id="4616067">,</span>&nbsp;<span class="ident" id="4616069">c</span><span class="op" id="4616070">.</span><span class="ident" id="4616071">jsCtx</span><span class="op" id="4616076">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4616079">switch</span>&nbsp;<span class="ident" id="4616086">s</span><span class="op" id="4616087">[</span><span class="ident" id="4616088">i</span><span class="op" id="4616089">]</span>&nbsp;<span class="op" id="4616091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4616094">case</span>&nbsp;<span class="string" id="4616099">&#39;&#34;&#39;</span><span class="op" id="4616102">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4616106">c</span><span class="op" id="4616107">.</span><span class="ident" id="4616108">state</span><span class="op" id="4616113">,</span>&nbsp;<span class="ident" id="4616115">c</span><span class="op" id="4616116">.</span><span class="ident" id="4616117">jsCtx</span>&nbsp;<span class="op" id="4616123">=</span>&nbsp;<span class="ident" id="4616125">stateJSDqStr</span><span class="op" id="4616137">,</span>&nbsp;<span class="ident" id="4616139">jsCtxRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4616152">case</span>&nbsp;<span class="string" id="4616157">&#39;\&#39;&#39;</span><span class="op" id="4616161">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4616165">c</span><span class="op" id="4616166">.</span><span class="ident" id="4616167">state</span><span class="op" id="4616172">,</span>&nbsp;<span class="ident" id="4616174">c</span><span class="op" id="4616175">.</span><span class="ident" id="4616176">jsCtx</span>&nbsp;<span class="op" id="4616182">=</span>&nbsp;<span class="ident" id="4616184">stateJSSqStr</span><span class="op" id="4616196">,</span>&nbsp;<span class="ident" id="4616198">jsCtxRegexp</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4616211">case</span>&nbsp;<span class="string" id="4616216">&#39;/&#39;</span><span class="op" id="4616219">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4616223">switch</span>&nbsp;<span class="op" id="4616230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4616234">case</span>&nbsp;<span class="ident" id="4616239">i</span><span class="op" id="4616240">+</span><span class="num" id="4616241">1</span>&nbsp;<span class="op" id="4616243">&lt;</span>&nbsp;<span class="builtinfunc" id="4616245">len</span><span class="op" id="4616248">(</span><span class="ident" id="4616249">s</span><span class="op" id="4616250">)</span>&nbsp;<span class="op" id="4616252">&amp;&amp;</span>&nbsp;<span class="ident" id="4616255">s</span><span class="op" id="4616256">[</span><span class="ident" id="4616257">i</span><span class="op" id="4616258">+</span><span class="num" id="4616259">1</span><span class="op" id="4616260">]</span>&nbsp;<span class="op" id="4616262">==</span>&nbsp;<span class="string" id="4616265">&#39;/&#39;</span><span class="op" id="4616268">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4616273">c</span><span class="op" id="4616274">.</span><span class="ident" id="4616275">state</span><span class="op" id="4616280">,</span>&nbsp;<span class="ident" id="4616282">i</span>&nbsp;<span class="op" id="4616284">=</span>&nbsp;<span class="ident" id="4616286">stateJSLineCmt</span><span class="op" id="4616300">,</span>&nbsp;<span class="ident" id="4616302">i</span><span class="op" id="4616303">+</span><span class="num" id="4616304">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4616308">case</span>&nbsp;<span class="ident" id="4616313">i</span><span class="op" id="4616314">+</span><span class="num" id="4616315">1</span>&nbsp;<span class="op" id="4616317">&lt;</span>&nbsp;<span class="builtinfunc" id="4616319">len</span><span class="op" id="4616322">(</span><span class="ident" id="4616323">s</span><span class="op" id="4616324">)</span>&nbsp;<span class="op" id="4616326">&amp;&amp;</span>&nbsp;<span class="ident" id="4616329">s</span><span class="op" id="4616330">[</span><span class="ident" id="4616331">i</span><span class="op" id="4616332">+</span><span class="num" id="4616333">1</span><span class="op" id="4616334">]</span>&nbsp;<span class="op" id="4616336">==</span>&nbsp;<span class="string" id="4616339">&#39;*&#39;</span><span class="op" id="4616342">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4616347">c</span><span class="op" id="4616348">.</span><span class="ident" id="4616349">state</span><span class="op" id="4616354">,</span>&nbsp;<span class="ident" id="4616356">i</span>&nbsp;<span class="op" id="4616358">=</span>&nbsp;<span class="ident" id="4616360">stateJSBlockCmt</span><span class="op" id="4616375">,</span>&nbsp;<span class="ident" id="4616377">i</span><span class="op" id="4616378">+</span><span class="num" id="4616379">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4616383">case</span>&nbsp;<span class="ident" id="4616388">c</span><span class="op" id="4616389">.</span><span class="ident" id="4616390">jsCtx</span>&nbsp;<span class="op" id="4616396">==</span>&nbsp;<span class="ident" id="4616399">jsCtxRegexp</span><span class="op" id="4616410">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4616415">c</span><span class="op" id="4616416">.</span><span class="ident" id="4616417">state</span>&nbsp;<span class="op" id="4616423">=</span>&nbsp;<span class="ident" id="4616425">stateJSRegexp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4616441">case</span>&nbsp;<span class="ident" id="4616446">c</span><span class="op" id="4616447">.</span><span class="ident" id="4616448">jsCtx</span>&nbsp;<span class="op" id="4616454">==</span>&nbsp;<span class="ident" id="4616457">jsCtxDivOp</span><span class="op" id="4616467">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4616472">c</span><span class="op" id="4616473">.</span><span class="ident" id="4616474">jsCtx</span>&nbsp;<span class="op" id="4616480">=</span>&nbsp;<span class="ident" id="4616482">jsCtxRegexp</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4616496">default</span><span class="op" id="4616503">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4616508">return</span>&nbsp;<span class="ident" id="4616515">context</span><span class="op" id="4616522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4616528">state</span><span class="op" id="4616533">:</span>&nbsp;<span class="ident" id="4616535">stateError</span><span class="op" id="4616545">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4616551">err</span><span class="op" id="4616554">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4616558">errorf</span><span class="op" id="4616564">(</span><span class="ident" id="4616565">ErrSlashAmbig</span><span class="op" id="4616578">,</span>&nbsp;<span class="ident" id="4616580">nil</span><span class="op" id="4616583">,</span>&nbsp;<span class="num" id="4616585">0</span><span class="op" id="4616586">,</span>&nbsp;<span class="string" id="4616588">&#34;&#39;/&#39;&nbsp;could&nbsp;start&nbsp;a&nbsp;division&nbsp;or&nbsp;regexp:&nbsp;%.32q&#34;</span><span class="op" id="4616633">,</span>&nbsp;<span class="ident" id="4616635">s</span><span class="op" id="4616636">[</span><span class="ident" id="4616637">i</span><span class="op" id="4616638">:</span><span class="op" id="4616639">]</span><span class="op" id="4616640">)</span><span class="op" id="4616641">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4616646">}</span><span class="op" id="4616647">,</span>&nbsp;<span class="builtinfunc" id="4616649">len</span><span class="op" id="4616652">(</span><span class="ident" id="4616653">s</span><span class="op" id="4616654">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4616658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4616661">default</span><span class="op" id="4616668">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4616672">panic</span><span class="op" id="4616677">(</span><span class="string" id="4616678">&#34;unreachable&#34;</span><span class="op" id="4616691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4616694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4616697">return</span>&nbsp;<span class="ident" id="4616704">c</span><span class="op" id="4616705">,</span>&nbsp;<span class="ident" id="4616707">i</span>&nbsp;<span class="op" id="4616709">+</span>&nbsp;<span class="num" id="4616711">1</span><br>
<span class="lineno">255</span><span class="op" id="4616713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4616716">//&nbsp;tJSDelimited&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;JS&nbsp;string&nbsp;and&nbsp;regexp</span><br>
<span class="lineno"></span><span class="comment" id="4616796">//&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="4616807">func</span>&nbsp;<span class="ident" id="4616812">tJSDelimited</span><span class="op" id="4616824">(</span><span class="ident" id="4616825">c</span>&nbsp;<span class="ident" id="4616827">context</span><span class="op" id="4616834">,</span>&nbsp;<span class="ident" id="4616836">s</span>&nbsp;<span class="op" id="4616838">[</span><span class="op" id="4616839">]</span><span class="builtintype" id="4616840">byte</span><span class="op" id="4616844">)</span>&nbsp;<span class="op" id="4616846">(</span><span class="ident" id="4616847">context</span><span class="op" id="4616854">,</span>&nbsp;<span class="builtintype" id="4616856">int</span><span class="op" id="4616859">)</span>&nbsp;<span class="op" id="4616861">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4616864">specials</span>&nbsp;<span class="op" id="4616873">:=</span>&nbsp;<span class="string" id="4616876">`\&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4616882">switch</span>&nbsp;<span class="ident" id="4616889">c</span><span class="op" id="4616890">.</span><span class="ident" id="4616891">state</span>&nbsp;<span class="op" id="4616897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4616900">case</span>&nbsp;<span class="ident" id="4616905">stateJSSqStr</span><span class="op" id="4616917">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4616921">specials</span>&nbsp;<span class="op" id="4616930">=</span>&nbsp;<span class="string" id="4616932">`\&#39;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4616938">case</span>&nbsp;<span class="ident" id="4616943">stateJSRegexp</span><span class="op" id="4616956">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4616960">specials</span>&nbsp;<span class="op" id="4616969">=</span>&nbsp;<span class="string" id="4616971">`\/[]`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4616979">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4616983">k</span><span class="op" id="4616984">,</span>&nbsp;<span class="ident" id="4616986">inCharset</span>&nbsp;<span class="op" id="4616996">:=</span>&nbsp;<span class="num" id="4616999">0</span><span class="op" id="4617000">,</span>&nbsp;<span class="builtintype" id="4617002">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4617009">for</span>&nbsp;<span class="op" id="4617013">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4617017">i</span>&nbsp;<span class="op" id="4617019">:=</span>&nbsp;<span class="ident" id="4617022">k</span>&nbsp;<span class="op" id="4617024">+</span>&nbsp;<span class="ident" id="4617026">bytes</span><span class="op" id="4617031">.</span><span class="ident" id="4617032">IndexAny</span><span class="op" id="4617040">(</span><span class="ident" id="4617041">s</span><span class="op" id="4617042">[</span><span class="ident" id="4617043">k</span><span class="op" id="4617044">:</span><span class="op" id="4617045">]</span><span class="op" id="4617046">,</span>&nbsp;<span class="ident" id="4617048">specials</span><span class="op" id="4617056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4617060">if</span>&nbsp;<span class="ident" id="4617063">i</span>&nbsp;<span class="op" id="4617065">&lt;</span>&nbsp;<span class="ident" id="4617067">k</span>&nbsp;<span class="op" id="4617069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4617074">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4617082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4617086">switch</span>&nbsp;<span class="ident" id="4617093">s</span><span class="op" id="4617094">[</span><span class="ident" id="4617095">i</span><span class="op" id="4617096">]</span>&nbsp;<span class="op" id="4617098">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4617102">case</span>&nbsp;<span class="string" id="4617107">&#39;\\&#39;</span><span class="op" id="4617111">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4617116">i</span><span class="op" id="4617117">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4617123">if</span>&nbsp;<span class="ident" id="4617126">i</span>&nbsp;<span class="op" id="4617128">==</span>&nbsp;<span class="builtinfunc" id="4617131">len</span><span class="op" id="4617134">(</span><span class="ident" id="4617135">s</span><span class="op" id="4617136">)</span>&nbsp;<span class="op" id="4617138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4617144">return</span>&nbsp;<span class="ident" id="4617151">context</span><span class="op" id="4617158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4617165">state</span><span class="op" id="4617170">:</span>&nbsp;<span class="ident" id="4617172">stateError</span><span class="op" id="4617182">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4617189">err</span><span class="op" id="4617192">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4617196">errorf</span><span class="op" id="4617202">(</span><span class="ident" id="4617203">ErrPartialEscape</span><span class="op" id="4617219">,</span>&nbsp;<span class="ident" id="4617221">nil</span><span class="op" id="4617224">,</span>&nbsp;<span class="num" id="4617226">0</span><span class="op" id="4617227">,</span>&nbsp;<span class="string" id="4617229">&#34;unfinished&nbsp;escape&nbsp;sequence&nbsp;in&nbsp;JS&nbsp;string:&nbsp;%q&#34;</span><span class="op" id="4617274">,</span>&nbsp;<span class="ident" id="4617276">s</span><span class="op" id="4617277">)</span><span class="op" id="4617278">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4617284">}</span><span class="op" id="4617285">,</span>&nbsp;<span class="builtinfunc" id="4617287">len</span><span class="op" id="4617290">(</span><span class="ident" id="4617291">s</span><span class="op" id="4617292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4617297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4617301">case</span>&nbsp;<span class="string" id="4617306">&#39;[&#39;</span><span class="op" id="4617309">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4617314">inCharset</span>&nbsp;<span class="op" id="4617324">=</span>&nbsp;<span class="builtintype" id="4617326">true</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4617333">case</span>&nbsp;<span class="string" id="4617338">&#39;]&#39;</span><span class="op" id="4617341">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4617346">inCharset</span>&nbsp;<span class="op" id="4617356">=</span>&nbsp;<span class="builtintype" id="4617358">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4617366">default</span><span class="op" id="4617373">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4617378">//&nbsp;end&nbsp;delimiter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4617398">if</span>&nbsp;<span class="op" id="4617401">!</span><span class="ident" id="4617402">inCharset</span>&nbsp;<span class="op" id="4617412">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4617418">c</span><span class="op" id="4617419">.</span><span class="ident" id="4617420">state</span><span class="op" id="4617425">,</span>&nbsp;<span class="ident" id="4617427">c</span><span class="op" id="4617428">.</span><span class="ident" id="4617429">jsCtx</span>&nbsp;<span class="op" id="4617435">=</span>&nbsp;<span class="ident" id="4617437">stateJS</span><span class="op" id="4617444">,</span>&nbsp;<span class="ident" id="4617446">jsCtxDivOp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4617461">return</span>&nbsp;<span class="ident" id="4617468">c</span><span class="op" id="4617469">,</span>&nbsp;<span class="ident" id="4617471">i</span>&nbsp;<span class="op" id="4617473">+</span>&nbsp;<span class="num" id="4617475">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4617480">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4617484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4617488">k</span>&nbsp;<span class="op" id="4617490">=</span>&nbsp;<span class="ident" id="4617492">i</span>&nbsp;<span class="op" id="4617494">+</span>&nbsp;<span class="num" id="4617496">1</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4617499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4617503">if</span>&nbsp;<span class="ident" id="4617506">inCharset</span>&nbsp;<span class="op" id="4617516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4617520">//&nbsp;This&nbsp;can&nbsp;be&nbsp;fixed&nbsp;by&nbsp;making&nbsp;context&nbsp;richer&nbsp;if&nbsp;interpolation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4617585">//&nbsp;into&nbsp;charsets&nbsp;is&nbsp;desired.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4617616">return</span>&nbsp;<span class="ident" id="4617623">context</span><span class="op" id="4617630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4617635">state</span><span class="op" id="4617640">:</span>&nbsp;<span class="ident" id="4617642">stateError</span><span class="op" id="4617652">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4617657">err</span><span class="op" id="4617660">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4617664">errorf</span><span class="op" id="4617670">(</span><span class="ident" id="4617671">ErrPartialCharset</span><span class="op" id="4617688">,</span>&nbsp;<span class="ident" id="4617690">nil</span><span class="op" id="4617693">,</span>&nbsp;<span class="num" id="4617695">0</span><span class="op" id="4617696">,</span>&nbsp;<span class="string" id="4617698">&#34;unfinished&nbsp;JS&nbsp;regexp&nbsp;charset:&nbsp;%q&#34;</span><span class="op" id="4617732">,</span>&nbsp;<span class="ident" id="4617734">s</span><span class="op" id="4617735">)</span><span class="op" id="4617736">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4617740">}</span><span class="op" id="4617741">,</span>&nbsp;<span class="builtinfunc" id="4617743">len</span><span class="op" id="4617746">(</span><span class="ident" id="4617747">s</span><span class="op" id="4617748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4617751">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4617755">return</span>&nbsp;<span class="ident" id="4617762">c</span><span class="op" id="4617763">,</span>&nbsp;<span class="builtinfunc" id="4617765">len</span><span class="op" id="4617768">(</span><span class="ident" id="4617769">s</span><span class="op" id="4617770">)</span><br>
<span class="lineno"></span><span class="op" id="4617772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4617775">var</span>&nbsp;<span class="ident" id="4617779">blockCommentEnd</span>&nbsp;<span class="op" id="4617795">=</span>&nbsp;<span class="op" id="4617797">[</span><span class="op" id="4617798">]</span><span class="builtintype" id="4617799">byte</span><span class="op" id="4617803">(</span><span class="string" id="4617804">&#34;*/&#34;</span><span class="op" id="4617808">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="comment" id="4617811">//&nbsp;tBlockCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;/*comment*/&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="4617883">func</span>&nbsp;<span class="ident" id="4617888">tBlockCmt</span><span class="op" id="4617897">(</span><span class="ident" id="4617898">c</span>&nbsp;<span class="ident" id="4617900">context</span><span class="op" id="4617907">,</span>&nbsp;<span class="ident" id="4617909">s</span>&nbsp;<span class="op" id="4617911">[</span><span class="op" id="4617912">]</span><span class="builtintype" id="4617913">byte</span><span class="op" id="4617917">)</span>&nbsp;<span class="op" id="4617919">(</span><span class="ident" id="4617920">context</span><span class="op" id="4617927">,</span>&nbsp;<span class="builtintype" id="4617929">int</span><span class="op" id="4617932">)</span>&nbsp;<span class="op" id="4617934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4617937">i</span>&nbsp;<span class="op" id="4617939">:=</span>&nbsp;<span class="ident" id="4617942">bytes</span><span class="op" id="4617947">.</span><span class="ident" id="4617948">Index</span><span class="op" id="4617953">(</span><span class="ident" id="4617954">s</span><span class="op" id="4617955">,</span>&nbsp;<span class="ident" id="4617957">blockCommentEnd</span><span class="op" id="4617972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4617975">if</span>&nbsp;<span class="ident" id="4617978">i</span>&nbsp;<span class="op" id="4617980">==</span>&nbsp;<span class="op" id="4617983">-</span><span class="num" id="4617984">1</span>&nbsp;<span class="op" id="4617986">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4617990">return</span>&nbsp;<span class="ident" id="4617997">c</span><span class="op" id="4617998">,</span>&nbsp;<span class="builtinfunc" id="4618000">len</span><span class="op" id="4618003">(</span><span class="ident" id="4618004">s</span><span class="op" id="4618005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4618008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4618011">switch</span>&nbsp;<span class="ident" id="4618018">c</span><span class="op" id="4618019">.</span><span class="ident" id="4618020">state</span>&nbsp;<span class="op" id="4618026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4618029">case</span>&nbsp;<span class="ident" id="4618034">stateJSBlockCmt</span><span class="op" id="4618049">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4618053">c</span><span class="op" id="4618054">.</span><span class="ident" id="4618055">state</span>&nbsp;<span class="op" id="4618061">=</span>&nbsp;<span class="ident" id="4618063">stateJS</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4618072">case</span>&nbsp;<span class="ident" id="4618077">stateCSSBlockCmt</span><span class="op" id="4618093">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4618097">c</span><span class="op" id="4618098">.</span><span class="ident" id="4618099">state</span>&nbsp;<span class="op" id="4618105">=</span>&nbsp;<span class="ident" id="4618107">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4618117">default</span><span class="op" id="4618124">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4618128">panic</span><span class="op" id="4618133">(</span><span class="ident" id="4618134">c</span><span class="op" id="4618135">.</span><span class="ident" id="4618136">state</span><span class="op" id="4618141">.</span><span class="ident" id="4618142">String</span><span class="op" id="4618148">(</span><span class="op" id="4618149">)</span><span class="op" id="4618150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4618153">}</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4618156">return</span>&nbsp;<span class="ident" id="4618163">c</span><span class="op" id="4618164">,</span>&nbsp;<span class="ident" id="4618166">i</span>&nbsp;<span class="op" id="4618168">+</span>&nbsp;<span class="num" id="4618170">2</span><br>
<span class="lineno"></span><span class="op" id="4618172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4618175">//&nbsp;tLineCmt&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;//comment&nbsp;states.</span><br>
<span class="lineno"></span><span class="keyword" id="4618244">func</span>&nbsp;<span class="ident" id="4618249">tLineCmt</span><span class="op" id="4618257">(</span><span class="ident" id="4618258">c</span>&nbsp;<span class="ident" id="4618260">context</span><span class="op" id="4618267">,</span>&nbsp;<span class="ident" id="4618269">s</span>&nbsp;<span class="op" id="4618271">[</span><span class="op" id="4618272">]</span><span class="builtintype" id="4618273">byte</span><span class="op" id="4618277">)</span>&nbsp;<span class="op" id="4618279">(</span><span class="ident" id="4618280">context</span><span class="op" id="4618287">,</span>&nbsp;<span class="builtintype" id="4618289">int</span><span class="op" id="4618292">)</span>&nbsp;<span class="op" id="4618294">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4618297">var</span>&nbsp;<span class="ident" id="4618301">lineTerminators</span>&nbsp;<span class="builtintype" id="4618317">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4618325">var</span>&nbsp;<span class="ident" id="4618329">endState</span>&nbsp;<span class="ident" id="4618338">state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4618345">switch</span>&nbsp;<span class="ident" id="4618352">c</span><span class="op" id="4618353">.</span><span class="ident" id="4618354">state</span>&nbsp;<span class="op" id="4618360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4618363">case</span>&nbsp;<span class="ident" id="4618368">stateJSLineCmt</span><span class="op" id="4618382">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4618386">lineTerminators</span><span class="op" id="4618401">,</span>&nbsp;<span class="ident" id="4618403">endState</span>&nbsp;<span class="op" id="4618412">=</span>&nbsp;<span class="string" id="4618414">&#34;\n\r\u2028\u2029&#34;</span><span class="op" id="4618432">,</span>&nbsp;<span class="ident" id="4618434">stateJS</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4618443">case</span>&nbsp;<span class="ident" id="4618448">stateCSSLineCmt</span><span class="op" id="4618463">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4618467">lineTerminators</span><span class="op" id="4618482">,</span>&nbsp;<span class="ident" id="4618484">endState</span>&nbsp;<span class="op" id="4618493">=</span>&nbsp;<span class="string" id="4618495">&#34;\n\f\r&#34;</span><span class="op" id="4618503">,</span>&nbsp;<span class="ident" id="4618505">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4618516">//&nbsp;Line&nbsp;comments&nbsp;are&nbsp;not&nbsp;part&nbsp;of&nbsp;any&nbsp;published&nbsp;CSS&nbsp;standard&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4618582">//&nbsp;are&nbsp;supported&nbsp;by&nbsp;the&nbsp;4&nbsp;major&nbsp;browsers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4618626">//&nbsp;This&nbsp;defines&nbsp;line&nbsp;comments&nbsp;as</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4618661">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LINECOMMENT&nbsp;::=&nbsp;&#34;//&#34;&nbsp;[^\n\f\d]*</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4618702">//&nbsp;since&nbsp;http://www.w3.org/TR/css3-syntax/#SUBTOK-nl&nbsp;defines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4618765">//&nbsp;newlines:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4618780">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nl&nbsp;::=&nbsp;#xA&nbsp;|&nbsp;#xD&nbsp;#xA&nbsp;|&nbsp;#xD&nbsp;|&nbsp;#xC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4618821">default</span><span class="op" id="4618828">:</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4618832">panic</span><span class="op" id="4618837">(</span><span class="ident" id="4618838">c</span><span class="op" id="4618839">.</span><span class="ident" id="4618840">state</span><span class="op" id="4618845">.</span><span class="ident" id="4618846">String</span><span class="op" id="4618852">(</span><span class="op" id="4618853">)</span><span class="op" id="4618854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4618857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4618861">i</span>&nbsp;<span class="op" id="4618863">:=</span>&nbsp;<span class="ident" id="4618866">bytes</span><span class="op" id="4618871">.</span><span class="ident" id="4618872">IndexAny</span><span class="op" id="4618880">(</span><span class="ident" id="4618881">s</span><span class="op" id="4618882">,</span>&nbsp;<span class="ident" id="4618884">lineTerminators</span><span class="op" id="4618899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4618902">if</span>&nbsp;<span class="ident" id="4618905">i</span>&nbsp;<span class="op" id="4618907">==</span>&nbsp;<span class="op" id="4618910">-</span><span class="num" id="4618911">1</span>&nbsp;<span class="op" id="4618913">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4618917">return</span>&nbsp;<span class="ident" id="4618924">c</span><span class="op" id="4618925">,</span>&nbsp;<span class="builtinfunc" id="4618927">len</span><span class="op" id="4618930">(</span><span class="ident" id="4618931">s</span><span class="op" id="4618932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4618935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4618938">c</span><span class="op" id="4618939">.</span><span class="ident" id="4618940">state</span>&nbsp;<span class="op" id="4618946">=</span>&nbsp;<span class="ident" id="4618948">endState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4618958">//&nbsp;Per&nbsp;section&nbsp;7.4&nbsp;of&nbsp;EcmaScript&nbsp;5&nbsp;:&nbsp;http://es5.github.com/#x7.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4619024">//&nbsp;&#34;However,&nbsp;the&nbsp;LineTerminator&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;is&nbsp;not</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4619087">//&nbsp;considered&nbsp;to&nbsp;be&nbsp;part&nbsp;of&nbsp;the&nbsp;single-line&nbsp;comment;&nbsp;it&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4619147">//&nbsp;recognized&nbsp;separately&nbsp;by&nbsp;the&nbsp;lexical&nbsp;grammar&nbsp;and&nbsp;becomes&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4619213">//&nbsp;of&nbsp;the&nbsp;stream&nbsp;of&nbsp;input&nbsp;elements&nbsp;for&nbsp;the&nbsp;syntactic&nbsp;grammar.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4619277">return</span>&nbsp;<span class="ident" id="4619284">c</span><span class="op" id="4619285">,</span>&nbsp;<span class="ident" id="4619287">i</span><br>
<span class="lineno"></span><span class="op" id="4619289">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span><span class="comment" id="4619292">//&nbsp;tCSS&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;CSS&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="4619354">func</span>&nbsp;<span class="ident" id="4619359">tCSS</span><span class="op" id="4619363">(</span><span class="ident" id="4619364">c</span>&nbsp;<span class="ident" id="4619366">context</span><span class="op" id="4619373">,</span>&nbsp;<span class="ident" id="4619375">s</span>&nbsp;<span class="op" id="4619377">[</span><span class="op" id="4619378">]</span><span class="builtintype" id="4619379">byte</span><span class="op" id="4619383">)</span>&nbsp;<span class="op" id="4619385">(</span><span class="ident" id="4619386">context</span><span class="op" id="4619393">,</span>&nbsp;<span class="builtintype" id="4619395">int</span><span class="op" id="4619398">)</span>&nbsp;<span class="op" id="4619400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4619403">//&nbsp;CSS&nbsp;quoted&nbsp;strings&nbsp;are&nbsp;almost&nbsp;never&nbsp;used&nbsp;except&nbsp;for:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4619460">//&nbsp;(1)&nbsp;URLs&nbsp;as&nbsp;in&nbsp;background:&nbsp;&#34;/foo.png&#34;</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4619502">//&nbsp;(2)&nbsp;Multiword&nbsp;font-names&nbsp;as&nbsp;in&nbsp;font-family:&nbsp;&#34;Times&nbsp;New&nbsp;Roman&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4619568">//&nbsp;(3)&nbsp;List&nbsp;separators&nbsp;in&nbsp;content&nbsp;values&nbsp;as&nbsp;in&nbsp;inline-lists:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4619630">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;style&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4619645">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;{&nbsp;list-style:&nbsp;none;&nbsp;padding:0&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4619698">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li&nbsp;{&nbsp;display:&nbsp;inline&nbsp;}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4619744">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li:before&nbsp;{&nbsp;content:&nbsp;&#34;,&nbsp;&#34;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4619795">//&nbsp;&nbsp;&nbsp;&nbsp;ul.inlineList&nbsp;&gt;&nbsp;li:first-child:before&nbsp;{&nbsp;content:&nbsp;&#34;&#34;&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4619856">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;/style&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4619872">//&nbsp;&nbsp;&nbsp;&nbsp;&lt;ul&nbsp;class=inlineList&gt;&lt;li&gt;One&lt;li&gt;Two&lt;li&gt;Three&lt;/ul&gt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4619929">//&nbsp;(4)&nbsp;Attribute&nbsp;value&nbsp;selectors&nbsp;as&nbsp;in&nbsp;a[href=&#34;http://example.com/&#34;]</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4619999">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4620003">//&nbsp;We&nbsp;conservatively&nbsp;treat&nbsp;all&nbsp;strings&nbsp;as&nbsp;URLs,&nbsp;but&nbsp;make&nbsp;some</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4620066">//&nbsp;allowances&nbsp;to&nbsp;avoid&nbsp;confusion.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4620101">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4620105">//&nbsp;In&nbsp;(1),&nbsp;our&nbsp;conservative&nbsp;assumption&nbsp;is&nbsp;justified.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4620159">//&nbsp;In&nbsp;(2),&nbsp;valid&nbsp;font&nbsp;names&nbsp;do&nbsp;not&nbsp;contain&nbsp;&#39;:&#39;,&nbsp;&#39;?&#39;,&nbsp;or&nbsp;&#39;#&#39;,&nbsp;so&nbsp;our</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4620228">//&nbsp;conservative&nbsp;assumption&nbsp;is&nbsp;fine&nbsp;since&nbsp;we&nbsp;will&nbsp;never&nbsp;transition&nbsp;past</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4620300">//&nbsp;urlPartPreQuery.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4620321">//&nbsp;In&nbsp;(3),&nbsp;our&nbsp;protocol&nbsp;heuristic&nbsp;should&nbsp;not&nbsp;be&nbsp;tripped,&nbsp;and&nbsp;there</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4620389">//&nbsp;should&nbsp;not&nbsp;be&nbsp;non-space&nbsp;content&nbsp;after&nbsp;a&nbsp;&#39;?&#39;&nbsp;or&nbsp;&#39;#&#39;,&nbsp;so&nbsp;as&nbsp;long&nbsp;as</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4620459">//&nbsp;we&nbsp;only&nbsp;%-encode&nbsp;RFC&nbsp;3986&nbsp;reserved&nbsp;characters&nbsp;we&nbsp;are&nbsp;ok.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4620520">//&nbsp;In&nbsp;(4),&nbsp;we&nbsp;should&nbsp;URL&nbsp;escape&nbsp;for&nbsp;URL&nbsp;attributes,&nbsp;and&nbsp;for&nbsp;others&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4620591">//&nbsp;have&nbsp;the&nbsp;attribute&nbsp;name&nbsp;available&nbsp;if&nbsp;our&nbsp;conservative&nbsp;assumption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4620660">//&nbsp;proves&nbsp;problematic&nbsp;for&nbsp;real&nbsp;code.</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4620699">k</span>&nbsp;<span class="op" id="4620701">:=</span>&nbsp;<span class="num" id="4620704">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4620707">for</span>&nbsp;<span class="op" id="4620711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4620715">i</span>&nbsp;<span class="op" id="4620717">:=</span>&nbsp;<span class="ident" id="4620720">k</span>&nbsp;<span class="op" id="4620722">+</span>&nbsp;<span class="ident" id="4620724">bytes</span><span class="op" id="4620729">.</span><span class="ident" id="4620730">IndexAny</span><span class="op" id="4620738">(</span><span class="ident" id="4620739">s</span><span class="op" id="4620740">[</span><span class="ident" id="4620741">k</span><span class="op" id="4620742">:</span><span class="op" id="4620743">]</span><span class="op" id="4620744">,</span>&nbsp;<span class="string" id="4620746">`(&#34;&#39;/`</span><span class="op" id="4620752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4620756">if</span>&nbsp;<span class="ident" id="4620759">i</span>&nbsp;<span class="op" id="4620761">&lt;</span>&nbsp;<span class="ident" id="4620763">k</span>&nbsp;<span class="op" id="4620765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4620770">return</span>&nbsp;<span class="ident" id="4620777">c</span><span class="op" id="4620778">,</span>&nbsp;<span class="builtinfunc" id="4620780">len</span><span class="op" id="4620783">(</span><span class="ident" id="4620784">s</span><span class="op" id="4620785">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4620789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4620793">switch</span>&nbsp;<span class="ident" id="4620800">s</span><span class="op" id="4620801">[</span><span class="ident" id="4620802">i</span><span class="op" id="4620803">]</span>&nbsp;<span class="op" id="4620805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4620809">case</span>&nbsp;<span class="string" id="4620814">&#39;(&#39;</span><span class="op" id="4620817">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4620822">//&nbsp;Look&nbsp;for&nbsp;url&nbsp;to&nbsp;the&nbsp;left.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4620854">p</span>&nbsp;<span class="op" id="4620856">:=</span>&nbsp;<span class="ident" id="4620859">bytes</span><span class="op" id="4620864">.</span><span class="ident" id="4620865">TrimRight</span><span class="op" id="4620874">(</span><span class="ident" id="4620875">s</span><span class="op" id="4620876">[</span><span class="op" id="4620877">:</span><span class="ident" id="4620878">i</span><span class="op" id="4620879">]</span><span class="op" id="4620880">,</span>&nbsp;<span class="string" id="4620882">&#34;\t\n\f\r&nbsp;&#34;</span><span class="op" id="4620893">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4620898">if</span>&nbsp;<span class="ident" id="4620901">endsWithCSSKeyword</span><span class="op" id="4620919">(</span><span class="ident" id="4620920">p</span><span class="op" id="4620921">,</span>&nbsp;<span class="string" id="4620923">&#34;url&#34;</span><span class="op" id="4620928">)</span>&nbsp;<span class="op" id="4620930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4620936">j</span>&nbsp;<span class="op" id="4620938">:=</span>&nbsp;<span class="builtinfunc" id="4620941">len</span><span class="op" id="4620944">(</span><span class="ident" id="4620945">s</span><span class="op" id="4620946">)</span>&nbsp;<span class="op" id="4620948">-</span>&nbsp;<span class="builtinfunc" id="4620950">len</span><span class="op" id="4620953">(</span><span class="ident" id="4620954">bytes</span><span class="op" id="4620959">.</span><span class="ident" id="4620960">TrimLeft</span><span class="op" id="4620968">(</span><span class="ident" id="4620969">s</span><span class="op" id="4620970">[</span><span class="ident" id="4620971">i</span><span class="op" id="4620972">+</span><span class="num" id="4620973">1</span><span class="op" id="4620974">:</span><span class="op" id="4620975">]</span><span class="op" id="4620976">,</span>&nbsp;<span class="string" id="4620978">&#34;\t\n\f\r&nbsp;&#34;</span><span class="op" id="4620989">)</span><span class="op" id="4620990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4620996">switch</span>&nbsp;<span class="op" id="4621003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621009">case</span>&nbsp;<span class="ident" id="4621014">j</span>&nbsp;<span class="op" id="4621016">!=</span>&nbsp;<span class="builtinfunc" id="4621019">len</span><span class="op" id="4621022">(</span><span class="ident" id="4621023">s</span><span class="op" id="4621024">)</span>&nbsp;<span class="op" id="4621026">&amp;&amp;</span>&nbsp;<span class="ident" id="4621029">s</span><span class="op" id="4621030">[</span><span class="ident" id="4621031">j</span><span class="op" id="4621032">]</span>&nbsp;<span class="op" id="4621034">==</span>&nbsp;<span class="string" id="4621037">&#39;&#34;&#39;</span><span class="op" id="4621040">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621047">c</span><span class="op" id="4621048">.</span><span class="ident" id="4621049">state</span><span class="op" id="4621054">,</span>&nbsp;<span class="ident" id="4621056">j</span>&nbsp;<span class="op" id="4621058">=</span>&nbsp;<span class="ident" id="4621060">stateCSSDqURL</span><span class="op" id="4621073">,</span>&nbsp;<span class="ident" id="4621075">j</span><span class="op" id="4621076">+</span><span class="num" id="4621077">1</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621083">case</span>&nbsp;<span class="ident" id="4621088">j</span>&nbsp;<span class="op" id="4621090">!=</span>&nbsp;<span class="builtinfunc" id="4621093">len</span><span class="op" id="4621096">(</span><span class="ident" id="4621097">s</span><span class="op" id="4621098">)</span>&nbsp;<span class="op" id="4621100">&amp;&amp;</span>&nbsp;<span class="ident" id="4621103">s</span><span class="op" id="4621104">[</span><span class="ident" id="4621105">j</span><span class="op" id="4621106">]</span>&nbsp;<span class="op" id="4621108">==</span>&nbsp;<span class="string" id="4621111">&#39;\&#39;&#39;</span><span class="op" id="4621115">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621122">c</span><span class="op" id="4621123">.</span><span class="ident" id="4621124">state</span><span class="op" id="4621129">,</span>&nbsp;<span class="ident" id="4621131">j</span>&nbsp;<span class="op" id="4621133">=</span>&nbsp;<span class="ident" id="4621135">stateCSSSqURL</span><span class="op" id="4621148">,</span>&nbsp;<span class="ident" id="4621150">j</span><span class="op" id="4621151">+</span><span class="num" id="4621152">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621158">default</span><span class="op" id="4621165">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621172">c</span><span class="op" id="4621173">.</span><span class="ident" id="4621174">state</span>&nbsp;<span class="op" id="4621180">=</span>&nbsp;<span class="ident" id="4621182">stateCSSURL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4621198">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621204">return</span>&nbsp;<span class="ident" id="4621211">c</span><span class="op" id="4621212">,</span>&nbsp;<span class="ident" id="4621214">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4621219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621223">case</span>&nbsp;<span class="string" id="4621228">&#39;/&#39;</span><span class="op" id="4621231">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621236">if</span>&nbsp;<span class="ident" id="4621239">i</span><span class="op" id="4621240">+</span><span class="num" id="4621241">1</span>&nbsp;<span class="op" id="4621243">&lt;</span>&nbsp;<span class="builtinfunc" id="4621245">len</span><span class="op" id="4621248">(</span><span class="ident" id="4621249">s</span><span class="op" id="4621250">)</span>&nbsp;<span class="op" id="4621252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621258">switch</span>&nbsp;<span class="ident" id="4621265">s</span><span class="op" id="4621266">[</span><span class="ident" id="4621267">i</span><span class="op" id="4621268">+</span><span class="num" id="4621269">1</span><span class="op" id="4621270">]</span>&nbsp;<span class="op" id="4621272">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621278">case</span>&nbsp;<span class="string" id="4621283">&#39;/&#39;</span><span class="op" id="4621286">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621293">c</span><span class="op" id="4621294">.</span><span class="ident" id="4621295">state</span>&nbsp;<span class="op" id="4621301">=</span>&nbsp;<span class="ident" id="4621303">stateCSSLineCmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621324">return</span>&nbsp;<span class="ident" id="4621331">c</span><span class="op" id="4621332">,</span>&nbsp;<span class="ident" id="4621334">i</span>&nbsp;<span class="op" id="4621336">+</span>&nbsp;<span class="num" id="4621338">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621344">case</span>&nbsp;<span class="string" id="4621349">&#39;*&#39;</span><span class="op" id="4621352">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621359">c</span><span class="op" id="4621360">.</span><span class="ident" id="4621361">state</span>&nbsp;<span class="op" id="4621367">=</span>&nbsp;<span class="ident" id="4621369">stateCSSBlockCmt</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621391">return</span>&nbsp;<span class="ident" id="4621398">c</span><span class="op" id="4621399">,</span>&nbsp;<span class="ident" id="4621401">i</span>&nbsp;<span class="op" id="4621403">+</span>&nbsp;<span class="num" id="4621405">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4621411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4621416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621420">case</span>&nbsp;<span class="string" id="4621425">&#39;&#34;&#39;</span><span class="op" id="4621428">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621433">c</span><span class="op" id="4621434">.</span><span class="ident" id="4621435">state</span>&nbsp;<span class="op" id="4621441">=</span>&nbsp;<span class="ident" id="4621443">stateCSSDqStr</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621460">return</span>&nbsp;<span class="ident" id="4621467">c</span><span class="op" id="4621468">,</span>&nbsp;<span class="ident" id="4621470">i</span>&nbsp;<span class="op" id="4621472">+</span>&nbsp;<span class="num" id="4621474">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621478">case</span>&nbsp;<span class="string" id="4621483">&#39;\&#39;&#39;</span><span class="op" id="4621487">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621492">c</span><span class="op" id="4621493">.</span><span class="ident" id="4621494">state</span>&nbsp;<span class="op" id="4621500">=</span>&nbsp;<span class="ident" id="4621502">stateCSSSqStr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621519">return</span>&nbsp;<span class="ident" id="4621526">c</span><span class="op" id="4621527">,</span>&nbsp;<span class="ident" id="4621529">i</span>&nbsp;<span class="op" id="4621531">+</span>&nbsp;<span class="num" id="4621533">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4621537">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621541">k</span>&nbsp;<span class="op" id="4621543">=</span>&nbsp;<span class="ident" id="4621545">i</span>&nbsp;<span class="op" id="4621547">+</span>&nbsp;<span class="num" id="4621549">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4621552">}</span><br>
<span class="lineno"></span><span class="op" id="4621554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4621557">//&nbsp;tCSSStr&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;CSS&nbsp;string&nbsp;and&nbsp;URL&nbsp;states.</span><br>
<span class="lineno">435</span><span class="keyword" id="4621638">func</span>&nbsp;<span class="ident" id="4621643">tCSSStr</span><span class="op" id="4621650">(</span><span class="ident" id="4621651">c</span>&nbsp;<span class="ident" id="4621653">context</span><span class="op" id="4621660">,</span>&nbsp;<span class="ident" id="4621662">s</span>&nbsp;<span class="op" id="4621664">[</span><span class="op" id="4621665">]</span><span class="builtintype" id="4621666">byte</span><span class="op" id="4621670">)</span>&nbsp;<span class="op" id="4621672">(</span><span class="ident" id="4621673">context</span><span class="op" id="4621680">,</span>&nbsp;<span class="builtintype" id="4621682">int</span><span class="op" id="4621685">)</span>&nbsp;<span class="op" id="4621687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621690">var</span>&nbsp;<span class="ident" id="4621694">endAndEsc</span>&nbsp;<span class="builtintype" id="4621704">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621712">switch</span>&nbsp;<span class="ident" id="4621719">c</span><span class="op" id="4621720">.</span><span class="ident" id="4621721">state</span>&nbsp;<span class="op" id="4621727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621730">case</span>&nbsp;<span class="ident" id="4621735">stateCSSDqStr</span><span class="op" id="4621748">,</span>&nbsp;<span class="ident" id="4621750">stateCSSDqURL</span><span class="op" id="4621763">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621767">endAndEsc</span>&nbsp;<span class="op" id="4621777">=</span>&nbsp;<span class="string" id="4621779">`\&#34;`</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621785">case</span>&nbsp;<span class="ident" id="4621790">stateCSSSqStr</span><span class="op" id="4621803">,</span>&nbsp;<span class="ident" id="4621805">stateCSSSqURL</span><span class="op" id="4621818">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621822">endAndEsc</span>&nbsp;<span class="op" id="4621832">=</span>&nbsp;<span class="string" id="4621834">`\&#39;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621840">case</span>&nbsp;<span class="ident" id="4621845">stateCSSURL</span><span class="op" id="4621856">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4621860">//&nbsp;Unquoted&nbsp;URLs&nbsp;end&nbsp;with&nbsp;a&nbsp;newline&nbsp;or&nbsp;close&nbsp;parenthesis.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4621920">//&nbsp;The&nbsp;below&nbsp;includes&nbsp;the&nbsp;wc&nbsp;(whitespace&nbsp;character)&nbsp;and&nbsp;nl.</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621982">endAndEsc</span>&nbsp;<span class="op" id="4621992">=</span>&nbsp;<span class="string" id="4621994">&#34;\\\t\n\f\r&nbsp;)&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4622010">default</span><span class="op" id="4622017">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4622021">panic</span><span class="op" id="4622026">(</span><span class="ident" id="4622027">c</span><span class="op" id="4622028">.</span><span class="ident" id="4622029">state</span><span class="op" id="4622034">.</span><span class="ident" id="4622035">String</span><span class="op" id="4622041">(</span><span class="op" id="4622042">)</span><span class="op" id="4622043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4622046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4622050">k</span>&nbsp;<span class="op" id="4622052">:=</span>&nbsp;<span class="num" id="4622055">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4622058">for</span>&nbsp;<span class="op" id="4622062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4622066">i</span>&nbsp;<span class="op" id="4622068">:=</span>&nbsp;<span class="ident" id="4622071">k</span>&nbsp;<span class="op" id="4622073">+</span>&nbsp;<span class="ident" id="4622075">bytes</span><span class="op" id="4622080">.</span><span class="ident" id="4622081">IndexAny</span><span class="op" id="4622089">(</span><span class="ident" id="4622090">s</span><span class="op" id="4622091">[</span><span class="ident" id="4622092">k</span><span class="op" id="4622093">:</span><span class="op" id="4622094">]</span><span class="op" id="4622095">,</span>&nbsp;<span class="ident" id="4622097">endAndEsc</span><span class="op" id="4622106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4622110">if</span>&nbsp;<span class="ident" id="4622113">i</span>&nbsp;<span class="op" id="4622115">&lt;</span>&nbsp;<span class="ident" id="4622117">k</span>&nbsp;<span class="op" id="4622119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4622124">c</span><span class="op" id="4622125">,</span>&nbsp;<span class="ident" id="4622127">nread</span>&nbsp;<span class="op" id="4622133">:=</span>&nbsp;<span class="ident" id="4622136">tURL</span><span class="op" id="4622140">(</span><span class="ident" id="4622141">c</span><span class="op" id="4622142">,</span>&nbsp;<span class="ident" id="4622144">decodeCSS</span><span class="op" id="4622153">(</span><span class="ident" id="4622154">s</span><span class="op" id="4622155">[</span><span class="ident" id="4622156">k</span><span class="op" id="4622157">:</span><span class="op" id="4622158">]</span><span class="op" id="4622159">)</span><span class="op" id="4622160">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4622165">return</span>&nbsp;<span class="ident" id="4622172">c</span><span class="op" id="4622173">,</span>&nbsp;<span class="ident" id="4622175">k</span>&nbsp;<span class="op" id="4622177">+</span>&nbsp;<span class="ident" id="4622179">nread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4622187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4622191">if</span>&nbsp;<span class="ident" id="4622194">s</span><span class="op" id="4622195">[</span><span class="ident" id="4622196">i</span><span class="op" id="4622197">]</span>&nbsp;<span class="op" id="4622199">==</span>&nbsp;<span class="string" id="4622202">&#39;\\&#39;</span>&nbsp;<span class="op" id="4622207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4622212">i</span><span class="op" id="4622213">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4622219">if</span>&nbsp;<span class="ident" id="4622222">i</span>&nbsp;<span class="op" id="4622224">==</span>&nbsp;<span class="builtinfunc" id="4622227">len</span><span class="op" id="4622230">(</span><span class="ident" id="4622231">s</span><span class="op" id="4622232">)</span>&nbsp;<span class="op" id="4622234">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4622240">return</span>&nbsp;<span class="ident" id="4622247">context</span><span class="op" id="4622254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4622261">state</span><span class="op" id="4622266">:</span>&nbsp;<span class="ident" id="4622268">stateError</span><span class="op" id="4622278">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4622285">err</span><span class="op" id="4622288">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4622292">errorf</span><span class="op" id="4622298">(</span><span class="ident" id="4622299">ErrPartialEscape</span><span class="op" id="4622315">,</span>&nbsp;<span class="ident" id="4622317">nil</span><span class="op" id="4622320">,</span>&nbsp;<span class="num" id="4622322">0</span><span class="op" id="4622323">,</span>&nbsp;<span class="string" id="4622325">&#34;unfinished&nbsp;escape&nbsp;sequence&nbsp;in&nbsp;CSS&nbsp;string:&nbsp;%q&#34;</span><span class="op" id="4622371">,</span>&nbsp;<span class="ident" id="4622373">s</span><span class="op" id="4622374">)</span><span class="op" id="4622375">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4622381">}</span><span class="op" id="4622382">,</span>&nbsp;<span class="builtinfunc" id="4622384">len</span><span class="op" id="4622387">(</span><span class="ident" id="4622388">s</span><span class="op" id="4622389">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4622394">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4622398">}</span>&nbsp;<span class="keyword" id="4622400">else</span>&nbsp;<span class="op" id="4622405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4622410">c</span><span class="op" id="4622411">.</span><span class="ident" id="4622412">state</span>&nbsp;<span class="op" id="4622418">=</span>&nbsp;<span class="ident" id="4622420">stateCSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4622432">return</span>&nbsp;<span class="ident" id="4622439">c</span><span class="op" id="4622440">,</span>&nbsp;<span class="ident" id="4622442">i</span>&nbsp;<span class="op" id="4622444">+</span>&nbsp;<span class="num" id="4622446">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4622450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4622454">c</span><span class="op" id="4622455">,</span>&nbsp;<span class="ident" id="4622457">_</span>&nbsp;<span class="op" id="4622459">=</span>&nbsp;<span class="ident" id="4622461">tURL</span><span class="op" id="4622465">(</span><span class="ident" id="4622466">c</span><span class="op" id="4622467">,</span>&nbsp;<span class="ident" id="4622469">decodeCSS</span><span class="op" id="4622478">(</span><span class="ident" id="4622479">s</span><span class="op" id="4622480">[</span><span class="op" id="4622481">:</span><span class="ident" id="4622482">i</span><span class="op" id="4622483">+</span><span class="num" id="4622484">1</span><span class="op" id="4622485">]</span><span class="op" id="4622486">)</span><span class="op" id="4622487">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4622491">k</span>&nbsp;<span class="op" id="4622493">=</span>&nbsp;<span class="ident" id="4622495">i</span>&nbsp;<span class="op" id="4622497">+</span>&nbsp;<span class="num" id="4622499">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4622502">}</span><br>
<span class="lineno"></span><span class="op" id="4622504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4622507">//&nbsp;tError&nbsp;is&nbsp;the&nbsp;context&nbsp;transition&nbsp;function&nbsp;for&nbsp;the&nbsp;error&nbsp;state.</span><br>
<span class="lineno">475</span><span class="keyword" id="4622573">func</span>&nbsp;<span class="ident" id="4622578">tError</span><span class="op" id="4622584">(</span><span class="ident" id="4622585">c</span>&nbsp;<span class="ident" id="4622587">context</span><span class="op" id="4622594">,</span>&nbsp;<span class="ident" id="4622596">s</span>&nbsp;<span class="op" id="4622598">[</span><span class="op" id="4622599">]</span><span class="builtintype" id="4622600">byte</span><span class="op" id="4622604">)</span>&nbsp;<span class="op" id="4622606">(</span><span class="ident" id="4622607">context</span><span class="op" id="4622614">,</span>&nbsp;<span class="builtintype" id="4622616">int</span><span class="op" id="4622619">)</span>&nbsp;<span class="op" id="4622621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4622624">return</span>&nbsp;<span class="ident" id="4622631">c</span><span class="op" id="4622632">,</span>&nbsp;<span class="builtinfunc" id="4622634">len</span><span class="op" id="4622637">(</span><span class="ident" id="4622638">s</span><span class="op" id="4622639">)</span><br>
<span class="lineno"></span><span class="op" id="4622641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4622644">//&nbsp;eatAttrName&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;an&nbsp;attribute&nbsp;name.</span><br>
<span class="lineno">480</span><span class="comment" id="4622720">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;s[i:]&nbsp;does&nbsp;not&nbsp;look&nbsp;like&nbsp;it&nbsp;begins&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="4622789">//&nbsp;attribute&nbsp;name,&nbsp;such&nbsp;as&nbsp;encountering&nbsp;a&nbsp;quote&nbsp;mark&nbsp;without&nbsp;a&nbsp;preceding</span><br>
<span class="lineno"></span><span class="comment" id="4622862">//&nbsp;equals&nbsp;sign.</span><br>
<span class="lineno"></span><span class="keyword" id="4622878">func</span>&nbsp;<span class="ident" id="4622883">eatAttrName</span><span class="op" id="4622894">(</span><span class="ident" id="4622895">s</span>&nbsp;<span class="op" id="4622897">[</span><span class="op" id="4622898">]</span><span class="builtintype" id="4622899">byte</span><span class="op" id="4622903">,</span>&nbsp;<span class="ident" id="4622905">i</span>&nbsp;<span class="builtintype" id="4622907">int</span><span class="op" id="4622910">)</span>&nbsp;<span class="op" id="4622912">(</span><span class="builtintype" id="4622913">int</span><span class="op" id="4622916">,</span>&nbsp;<span class="op" id="4622918">*</span><span class="ident" id="4622919">Error</span><span class="op" id="4622924">)</span>&nbsp;<span class="op" id="4622926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4622929">for</span>&nbsp;<span class="ident" id="4622933">j</span>&nbsp;<span class="op" id="4622935">:=</span>&nbsp;<span class="ident" id="4622938">i</span><span class="op" id="4622939">;</span>&nbsp;<span class="ident" id="4622941">j</span>&nbsp;<span class="op" id="4622943">&lt;</span>&nbsp;<span class="builtinfunc" id="4622945">len</span><span class="op" id="4622948">(</span><span class="ident" id="4622949">s</span><span class="op" id="4622950">)</span><span class="op" id="4622951">;</span>&nbsp;<span class="ident" id="4622953">j</span><span class="op" id="4622954">++</span>&nbsp;<span class="op" id="4622957">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4622961">switch</span>&nbsp;<span class="ident" id="4622968">s</span><span class="op" id="4622969">[</span><span class="ident" id="4622970">j</span><span class="op" id="4622971">]</span>&nbsp;<span class="op" id="4622973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4622977">case</span>&nbsp;<span class="string" id="4622982">&#39;&nbsp;&#39;</span><span class="op" id="4622985">,</span>&nbsp;<span class="string" id="4622987">&#39;\t&#39;</span><span class="op" id="4622991">,</span>&nbsp;<span class="string" id="4622993">&#39;\n&#39;</span><span class="op" id="4622997">,</span>&nbsp;<span class="string" id="4622999">&#39;\f&#39;</span><span class="op" id="4623003">,</span>&nbsp;<span class="string" id="4623005">&#39;\r&#39;</span><span class="op" id="4623009">,</span>&nbsp;<span class="string" id="4623011">&#39;=&#39;</span><span class="op" id="4623014">,</span>&nbsp;<span class="string" id="4623016">&#39;&gt;&#39;</span><span class="op" id="4623019">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623024">return</span>&nbsp;<span class="ident" id="4623031">j</span><span class="op" id="4623032">,</span>&nbsp;<span class="ident" id="4623034">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623040">case</span>&nbsp;<span class="string" id="4623045">&#39;\&#39;&#39;</span><span class="op" id="4623049">,</span>&nbsp;<span class="string" id="4623051">&#39;&#34;&#39;</span><span class="op" id="4623054">,</span>&nbsp;<span class="string" id="4623056">&#39;&lt;&#39;</span><span class="op" id="4623059">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4623064">//&nbsp;These&nbsp;result&nbsp;in&nbsp;a&nbsp;parse&nbsp;warning&nbsp;in&nbsp;HTML5&nbsp;and&nbsp;are</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4623119">//&nbsp;indicative&nbsp;of&nbsp;serious&nbsp;problems&nbsp;if&nbsp;seen&nbsp;in&nbsp;an&nbsp;attr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4623175">//&nbsp;name&nbsp;in&nbsp;a&nbsp;template.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623201">return</span>&nbsp;<span class="op" id="4623208">-</span><span class="num" id="4623209">1</span><span class="op" id="4623210">,</span>&nbsp;<span class="ident" id="4623212">errorf</span><span class="op" id="4623218">(</span><span class="ident" id="4623219">ErrBadHTML</span><span class="op" id="4623229">,</span>&nbsp;<span class="ident" id="4623231">nil</span><span class="op" id="4623234">,</span>&nbsp;<span class="num" id="4623236">0</span><span class="op" id="4623237">,</span>&nbsp;<span class="string" id="4623239">&#34;%q&nbsp;in&nbsp;attribute&nbsp;name:&nbsp;%.32q&#34;</span><span class="op" id="4623268">,</span>&nbsp;<span class="ident" id="4623270">s</span><span class="op" id="4623271">[</span><span class="ident" id="4623272">j</span><span class="op" id="4623273">:</span><span class="ident" id="4623274">j</span><span class="op" id="4623275">+</span><span class="num" id="4623276">1</span><span class="op" id="4623277">]</span><span class="op" id="4623278">,</span>&nbsp;<span class="ident" id="4623280">s</span><span class="op" id="4623281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623285">default</span><span class="op" id="4623292">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4623297">//&nbsp;No-op.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4623309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4623312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623315">return</span>&nbsp;<span class="builtinfunc" id="4623322">len</span><span class="op" id="4623325">(</span><span class="ident" id="4623326">s</span><span class="op" id="4623327">)</span><span class="op" id="4623328">,</span>&nbsp;<span class="ident" id="4623330">nil</span><br>
<span class="lineno"></span><span class="op" id="4623334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="4623337">var</span>&nbsp;<span class="ident" id="4623341">elementNameMap</span>&nbsp;<span class="op" id="4623356">=</span>&nbsp;<span class="keyword" id="4623358">map</span><span class="op" id="4623361">[</span><span class="builtintype" id="4623362">string</span><span class="op" id="4623368">]</span><span class="ident" id="4623369">element</span><span class="op" id="4623376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4623379">&#34;script&#34;</span><span class="op" id="4623387">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4623391">elementScript</span><span class="op" id="4623404">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4623407">&#34;style&#34;</span><span class="op" id="4623414">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623419">elementStyle</span><span class="op" id="4623431">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4623434">&#34;textarea&#34;</span><span class="op" id="4623444">:</span>&nbsp;<span class="ident" id="4623446">elementTextarea</span><span class="op" id="4623461">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4623464">&#34;title&#34;</span><span class="op" id="4623471">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4623476">elementTitle</span><span class="op" id="4623488">,</span><br>
<span class="lineno">505</span><span class="op" id="4623490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4623493">//&nbsp;asciiAlpha&nbsp;reports&nbsp;whether&nbsp;c&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;letter.</span><br>
<span class="lineno"></span><span class="keyword" id="4623545">func</span>&nbsp;<span class="ident" id="4623550">asciiAlpha</span><span class="op" id="4623560">(</span><span class="ident" id="4623561">c</span>&nbsp;<span class="builtintype" id="4623563">byte</span><span class="op" id="4623567">)</span>&nbsp;<span class="builtintype" id="4623569">bool</span>&nbsp;<span class="op" id="4623574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623577">return</span>&nbsp;<span class="string" id="4623584">&#39;A&#39;</span>&nbsp;<span class="op" id="4623588">&lt;=</span>&nbsp;<span class="ident" id="4623591">c</span>&nbsp;<span class="op" id="4623593">&amp;&amp;</span>&nbsp;<span class="ident" id="4623596">c</span>&nbsp;<span class="op" id="4623598">&lt;=</span>&nbsp;<span class="string" id="4623601">&#39;Z&#39;</span>&nbsp;<span class="op" id="4623605">||</span>&nbsp;<span class="string" id="4623608">&#39;a&#39;</span>&nbsp;<span class="op" id="4623612">&lt;=</span>&nbsp;<span class="ident" id="4623615">c</span>&nbsp;<span class="op" id="4623617">&amp;&amp;</span>&nbsp;<span class="ident" id="4623620">c</span>&nbsp;<span class="op" id="4623622">&lt;=</span>&nbsp;<span class="string" id="4623625">&#39;z&#39;</span><br>
<span class="lineno">510</span><span class="op" id="4623629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4623632">//&nbsp;asciiAlphaNum&nbsp;reports&nbsp;whether&nbsp;c&nbsp;is&nbsp;an&nbsp;ASCII&nbsp;letter&nbsp;or&nbsp;digit.</span><br>
<span class="lineno"></span><span class="keyword" id="4623696">func</span>&nbsp;<span class="ident" id="4623701">asciiAlphaNum</span><span class="op" id="4623714">(</span><span class="ident" id="4623715">c</span>&nbsp;<span class="builtintype" id="4623717">byte</span><span class="op" id="4623721">)</span>&nbsp;<span class="builtintype" id="4623723">bool</span>&nbsp;<span class="op" id="4623728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623731">return</span>&nbsp;<span class="ident" id="4623738">asciiAlpha</span><span class="op" id="4623748">(</span><span class="ident" id="4623749">c</span><span class="op" id="4623750">)</span>&nbsp;<span class="op" id="4623752">||</span>&nbsp;<span class="string" id="4623755">&#39;0&#39;</span>&nbsp;<span class="op" id="4623759">&lt;=</span>&nbsp;<span class="ident" id="4623762">c</span>&nbsp;<span class="op" id="4623764">&amp;&amp;</span>&nbsp;<span class="ident" id="4623767">c</span>&nbsp;<span class="op" id="4623769">&lt;=</span>&nbsp;<span class="string" id="4623772">&#39;9&#39;</span><br>
<span class="lineno">515</span><span class="op" id="4623776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4623779">//&nbsp;eatTagName&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;a&nbsp;tag&nbsp;name&nbsp;and&nbsp;the&nbsp;tag&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="4623864">func</span>&nbsp;<span class="ident" id="4623869">eatTagName</span><span class="op" id="4623879">(</span><span class="ident" id="4623880">s</span>&nbsp;<span class="op" id="4623882">[</span><span class="op" id="4623883">]</span><span class="builtintype" id="4623884">byte</span><span class="op" id="4623888">,</span>&nbsp;<span class="ident" id="4623890">i</span>&nbsp;<span class="builtintype" id="4623892">int</span><span class="op" id="4623895">)</span>&nbsp;<span class="op" id="4623897">(</span><span class="builtintype" id="4623898">int</span><span class="op" id="4623901">,</span>&nbsp;<span class="ident" id="4623903">element</span><span class="op" id="4623910">)</span>&nbsp;<span class="op" id="4623912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623915">if</span>&nbsp;<span class="ident" id="4623918">i</span>&nbsp;<span class="op" id="4623920">==</span>&nbsp;<span class="builtinfunc" id="4623923">len</span><span class="op" id="4623926">(</span><span class="ident" id="4623927">s</span><span class="op" id="4623928">)</span>&nbsp;<span class="op" id="4623930">||</span>&nbsp;<span class="op" id="4623933">!</span><span class="ident" id="4623934">asciiAlpha</span><span class="op" id="4623944">(</span><span class="ident" id="4623945">s</span><span class="op" id="4623946">[</span><span class="ident" id="4623947">i</span><span class="op" id="4623948">]</span><span class="op" id="4623949">)</span>&nbsp;<span class="op" id="4623951">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623955">return</span>&nbsp;<span class="ident" id="4623962">i</span><span class="op" id="4623963">,</span>&nbsp;<span class="ident" id="4623965">elementNone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4623978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4623981">j</span>&nbsp;<span class="op" id="4623983">:=</span>&nbsp;<span class="ident" id="4623986">i</span>&nbsp;<span class="op" id="4623988">+</span>&nbsp;<span class="num" id="4623990">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623993">for</span>&nbsp;<span class="ident" id="4623997">j</span>&nbsp;<span class="op" id="4623999">&lt;</span>&nbsp;<span class="builtinfunc" id="4624001">len</span><span class="op" id="4624004">(</span><span class="ident" id="4624005">s</span><span class="op" id="4624006">)</span>&nbsp;<span class="op" id="4624008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624012">x</span>&nbsp;<span class="op" id="4624014">:=</span>&nbsp;<span class="ident" id="4624017">s</span><span class="op" id="4624018">[</span><span class="ident" id="4624019">j</span><span class="op" id="4624020">]</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4624024">if</span>&nbsp;<span class="ident" id="4624027">asciiAlphaNum</span><span class="op" id="4624040">(</span><span class="ident" id="4624041">x</span><span class="op" id="4624042">)</span>&nbsp;<span class="op" id="4624044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624049">j</span><span class="op" id="4624050">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4624056">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4624067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4624071">//&nbsp;Allow&nbsp;&#34;x-y&#34;&nbsp;or&nbsp;&#34;x:y&#34;&nbsp;but&nbsp;not&nbsp;&#34;x-&#34;,&nbsp;&#34;-y&#34;,&nbsp;or&nbsp;&#34;x--y&#34;.</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4624128">if</span>&nbsp;<span class="op" id="4624131">(</span><span class="ident" id="4624132">x</span>&nbsp;<span class="op" id="4624134">==</span>&nbsp;<span class="string" id="4624137">&#39;:&#39;</span>&nbsp;<span class="op" id="4624141">||</span>&nbsp;<span class="ident" id="4624144">x</span>&nbsp;<span class="op" id="4624146">==</span>&nbsp;<span class="string" id="4624149">&#39;-&#39;</span><span class="op" id="4624152">)</span>&nbsp;<span class="op" id="4624154">&amp;&amp;</span>&nbsp;<span class="ident" id="4624157">j</span><span class="op" id="4624158">+</span><span class="num" id="4624159">1</span>&nbsp;<span class="op" id="4624161">&lt;</span>&nbsp;<span class="builtinfunc" id="4624163">len</span><span class="op" id="4624166">(</span><span class="ident" id="4624167">s</span><span class="op" id="4624168">)</span>&nbsp;<span class="op" id="4624170">&amp;&amp;</span>&nbsp;<span class="ident" id="4624173">asciiAlphaNum</span><span class="op" id="4624186">(</span><span class="ident" id="4624187">s</span><span class="op" id="4624188">[</span><span class="ident" id="4624189">j</span><span class="op" id="4624190">+</span><span class="num" id="4624191">1</span><span class="op" id="4624192">]</span><span class="op" id="4624193">)</span>&nbsp;<span class="op" id="4624195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624200">j</span>&nbsp;<span class="op" id="4624202">+=</span>&nbsp;<span class="num" id="4624205">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4624210">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4624221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4624225">break</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4624232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4624235">return</span>&nbsp;<span class="ident" id="4624242">j</span><span class="op" id="4624243">,</span>&nbsp;<span class="ident" id="4624245">elementNameMap</span><span class="op" id="4624259">[</span><span class="ident" id="4624260">strings</span><span class="op" id="4624267">.</span><span class="ident" id="4624268">ToLower</span><span class="op" id="4624275">(</span><span class="builtintype" id="4624276">string</span><span class="op" id="4624282">(</span><span class="ident" id="4624283">s</span><span class="op" id="4624284">[</span><span class="ident" id="4624285">i</span><span class="op" id="4624286">:</span><span class="ident" id="4624287">j</span><span class="op" id="4624288">]</span><span class="op" id="4624289">)</span><span class="op" id="4624290">)</span><span class="op" id="4624291">]</span><br>
<span class="lineno"></span><span class="op" id="4624293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4624296">//&nbsp;eatWhiteSpace&nbsp;returns&nbsp;the&nbsp;largest&nbsp;j&nbsp;such&nbsp;that&nbsp;s[i:j]&nbsp;is&nbsp;white&nbsp;space.</span><br>
<span class="lineno">540</span><span class="keyword" id="4624368">func</span>&nbsp;<span class="ident" id="4624373">eatWhiteSpace</span><span class="op" id="4624386">(</span><span class="ident" id="4624387">s</span>&nbsp;<span class="op" id="4624389">[</span><span class="op" id="4624390">]</span><span class="builtintype" id="4624391">byte</span><span class="op" id="4624395">,</span>&nbsp;<span class="ident" id="4624397">i</span>&nbsp;<span class="builtintype" id="4624399">int</span><span class="op" id="4624402">)</span>&nbsp;<span class="builtintype" id="4624404">int</span>&nbsp;<span class="op" id="4624408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4624411">for</span>&nbsp;<span class="ident" id="4624415">j</span>&nbsp;<span class="op" id="4624417">:=</span>&nbsp;<span class="ident" id="4624420">i</span><span class="op" id="4624421">;</span>&nbsp;<span class="ident" id="4624423">j</span>&nbsp;<span class="op" id="4624425">&lt;</span>&nbsp;<span class="builtinfunc" id="4624427">len</span><span class="op" id="4624430">(</span><span class="ident" id="4624431">s</span><span class="op" id="4624432">)</span><span class="op" id="4624433">;</span>&nbsp;<span class="ident" id="4624435">j</span><span class="op" id="4624436">++</span>&nbsp;<span class="op" id="4624439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4624443">switch</span>&nbsp;<span class="ident" id="4624450">s</span><span class="op" id="4624451">[</span><span class="ident" id="4624452">j</span><span class="op" id="4624453">]</span>&nbsp;<span class="op" id="4624455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4624459">case</span>&nbsp;<span class="string" id="4624464">&#39;&nbsp;&#39;</span><span class="op" id="4624467">,</span>&nbsp;<span class="string" id="4624469">&#39;\t&#39;</span><span class="op" id="4624473">,</span>&nbsp;<span class="string" id="4624475">&#39;\n&#39;</span><span class="op" id="4624479">,</span>&nbsp;<span class="string" id="4624481">&#39;\f&#39;</span><span class="op" id="4624485">,</span>&nbsp;<span class="string" id="4624487">&#39;\r&#39;</span><span class="op" id="4624491">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4624496">//&nbsp;No-op.</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4624508">default</span><span class="op" id="4624515">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4624520">return</span>&nbsp;<span class="ident" id="4624527">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4624531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4624534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4624537">return</span>&nbsp;<span class="builtinfunc" id="4624544">len</span><span class="op" id="4624547">(</span><span class="ident" id="4624548">s</span><span class="op" id="4624549">)</span><br>
<span class="lineno">550</span><span class="op" id="4624551">}</span>
</div>
</body>
</html>
