<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/build</h2>
<ul>
<li><a href="/gostd/go/build/build.go.html" class="current">build.go</a></li>
<li><a href="/gostd/go/build/build_test.go.html">build_test.go</a></li>
<li><a href="/gostd/go/build/deps_test.go.html">deps_test.go</a></li>
<li><a href="/gostd/go/build/doc.go.html">doc.go</a></li>
<li><a href="/gostd/go/build/read.go.html">read.go</a></li>
<li><a href="/gostd/go/build/read_test.go.html">read_test.go</a></li>
<li><a href="/gostd/go/build/syslist.go.html">syslist.go</a></li>
<li><a href="/gostd/go/build/syslist_test.go.html">syslist_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1329532">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1329588">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1329642">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1329693">package</span>&nbsp;<span class="ident" id="1329701">build</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1329708">import</span>&nbsp;<span class="op" id="1329715">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329718">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329727">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329737">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329744">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329754">&#34;go/doc&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329764">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329777">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329789">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329795">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329808">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329815">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1329821">pathpkg</span>&nbsp;<span class="string" id="1329829">&#34;path&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329837">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329854">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329865">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329873">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329884">&#34;strings&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329895">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329906">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="1329921">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1329924">//&nbsp;A&nbsp;Context&nbsp;specifies&nbsp;the&nbsp;supporting&nbsp;context&nbsp;for&nbsp;a&nbsp;build.</span><br>
<span class="lineno">30</span><span class="keyword" id="1329983">type</span>&nbsp;<span class="ident" id="1329988">Context</span>&nbsp;<span class="keyword" id="1329996">struct</span>&nbsp;<span class="op" id="1330003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330006">GOARCH</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1330018">string</span>&nbsp;<span class="comment" id="1330025">//&nbsp;target&nbsp;architecture</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330049">GOOS</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1330061">string</span>&nbsp;<span class="comment" id="1330068">//&nbsp;target&nbsp;operating&nbsp;system</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330096">GOROOT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1330108">string</span>&nbsp;<span class="comment" id="1330115">//&nbsp;Go&nbsp;root</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330127">GOPATH</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1330139">string</span>&nbsp;<span class="comment" id="1330146">//&nbsp;Go&nbsp;path</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330158">CgoEnabled</span>&nbsp;&nbsp;<span class="builtintype" id="1330170">bool</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1330177">//&nbsp;whether&nbsp;cgo&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330205">UseAllFiles</span>&nbsp;<span class="builtintype" id="1330217">bool</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1330224">//&nbsp;use&nbsp;files&nbsp;regardless&nbsp;of&nbsp;+build&nbsp;lines,&nbsp;file&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330277">Compiler</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1330289">string</span>&nbsp;<span class="comment" id="1330296">//&nbsp;compiler&nbsp;to&nbsp;assume&nbsp;when&nbsp;computing&nbsp;target&nbsp;paths</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330348">//&nbsp;The&nbsp;build&nbsp;and&nbsp;release&nbsp;tags&nbsp;specify&nbsp;build&nbsp;constraints</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330405">//&nbsp;that&nbsp;should&nbsp;be&nbsp;considered&nbsp;satisfied&nbsp;when&nbsp;processing&nbsp;+build&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330475">//&nbsp;Clients&nbsp;creating&nbsp;a&nbsp;new&nbsp;context&nbsp;may&nbsp;customize&nbsp;BuildTags,&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330541">//&nbsp;defaults&nbsp;to&nbsp;empty,&nbsp;but&nbsp;it&nbsp;is&nbsp;usually&nbsp;an&nbsp;error&nbsp;to&nbsp;customize&nbsp;ReleaseTags,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330617">//&nbsp;which&nbsp;defaults&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;Go&nbsp;releases&nbsp;the&nbsp;current&nbsp;release&nbsp;is&nbsp;compatible&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330703">//&nbsp;In&nbsp;addition&nbsp;to&nbsp;the&nbsp;BuildTags&nbsp;and&nbsp;ReleaseTags,&nbsp;build&nbsp;constraints</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330771">//&nbsp;consider&nbsp;the&nbsp;values&nbsp;of&nbsp;GOARCH&nbsp;and&nbsp;GOOS&nbsp;as&nbsp;satisfied&nbsp;tags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330833">BuildTags</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1330845">[</span><span class="op" id="1330846">]</span><span class="builtintype" id="1330847">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330855">ReleaseTags</span>&nbsp;<span class="op" id="1330867">[</span><span class="op" id="1330868">]</span><span class="builtintype" id="1330869">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330878">//&nbsp;The&nbsp;install&nbsp;suffix&nbsp;specifies&nbsp;a&nbsp;suffix&nbsp;to&nbsp;use&nbsp;in&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;installation</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330959">//&nbsp;directory.&nbsp;By&nbsp;default&nbsp;it&nbsp;is&nbsp;empty,&nbsp;but&nbsp;custom&nbsp;builds&nbsp;that&nbsp;need&nbsp;to&nbsp;keep</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331034">//&nbsp;their&nbsp;outputs&nbsp;separate&nbsp;can&nbsp;set&nbsp;InstallSuffix&nbsp;to&nbsp;do&nbsp;so.&nbsp;For&nbsp;example,&nbsp;when</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331111">//&nbsp;using&nbsp;the&nbsp;race&nbsp;detector,&nbsp;the&nbsp;go&nbsp;command&nbsp;uses&nbsp;InstallSuffix&nbsp;=&nbsp;&#34;race&#34;,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331187">//&nbsp;that&nbsp;on&nbsp;a&nbsp;Linux/386&nbsp;system,&nbsp;packages&nbsp;are&nbsp;written&nbsp;to&nbsp;a&nbsp;directory&nbsp;named</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331261">//&nbsp;&#34;linux_386_race&#34;&nbsp;instead&nbsp;of&nbsp;the&nbsp;usual&nbsp;&#34;linux_386&#34;.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331316">InstallSuffix</span>&nbsp;<span class="builtintype" id="1331330">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331339">//&nbsp;By&nbsp;default,&nbsp;Import&nbsp;uses&nbsp;the&nbsp;operating&nbsp;system&#39;s&nbsp;file&nbsp;system&nbsp;calls</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331408">//&nbsp;to&nbsp;read&nbsp;directories&nbsp;and&nbsp;files.&nbsp;&nbsp;To&nbsp;read&nbsp;from&nbsp;other&nbsp;sources,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331472">//&nbsp;callers&nbsp;can&nbsp;set&nbsp;the&nbsp;following&nbsp;functions.&nbsp;&nbsp;They&nbsp;all&nbsp;have&nbsp;default</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331540">//&nbsp;behaviors&nbsp;that&nbsp;use&nbsp;the&nbsp;local&nbsp;file&nbsp;system,&nbsp;so&nbsp;clients&nbsp;need&nbsp;only&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331611">//&nbsp;the&nbsp;functions&nbsp;whose&nbsp;behaviors&nbsp;they&nbsp;wish&nbsp;to&nbsp;change.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331667">//&nbsp;JoinPath&nbsp;joins&nbsp;the&nbsp;sequence&nbsp;of&nbsp;path&nbsp;fragments&nbsp;into&nbsp;a&nbsp;single&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331737">//&nbsp;If&nbsp;JoinPath&nbsp;is&nbsp;nil,&nbsp;Import&nbsp;uses&nbsp;filepath.Join.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331788">JoinPath</span>&nbsp;<span class="keyword" id="1331797">func</span><span class="op" id="1331801">(</span><span class="ident" id="1331802">elem</span>&nbsp;<span class="op" id="1331807">...</span><span class="builtintype" id="1331810">string</span><span class="op" id="1331816">)</span>&nbsp;<span class="builtintype" id="1331818">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331827">//&nbsp;SplitPathList&nbsp;splits&nbsp;the&nbsp;path&nbsp;list&nbsp;into&nbsp;a&nbsp;slice&nbsp;of&nbsp;individual&nbsp;paths.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331900">//&nbsp;If&nbsp;SplitPathList&nbsp;is&nbsp;nil,&nbsp;Import&nbsp;uses&nbsp;filepath.SplitList.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331961">SplitPathList</span>&nbsp;<span class="keyword" id="1331975">func</span><span class="op" id="1331979">(</span><span class="ident" id="1331980">list</span>&nbsp;<span class="builtintype" id="1331985">string</span><span class="op" id="1331991">)</span>&nbsp;<span class="op" id="1331993">[</span><span class="op" id="1331994">]</span><span class="builtintype" id="1331995">string</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332004">//&nbsp;IsAbsPath&nbsp;reports&nbsp;whether&nbsp;path&nbsp;is&nbsp;an&nbsp;absolute&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332060">//&nbsp;If&nbsp;IsAbsPath&nbsp;is&nbsp;nil,&nbsp;Import&nbsp;uses&nbsp;filepath.IsAbs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332113">IsAbsPath</span>&nbsp;<span class="keyword" id="1332123">func</span><span class="op" id="1332127">(</span><span class="ident" id="1332128">path</span>&nbsp;<span class="builtintype" id="1332133">string</span><span class="op" id="1332139">)</span>&nbsp;<span class="builtintype" id="1332141">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332148">//&nbsp;IsDir&nbsp;reports&nbsp;whether&nbsp;the&nbsp;path&nbsp;names&nbsp;a&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332202">//&nbsp;If&nbsp;IsDir&nbsp;is&nbsp;nil,&nbsp;Import&nbsp;calls&nbsp;os.Stat&nbsp;and&nbsp;uses&nbsp;the&nbsp;result&#39;s&nbsp;IsDir&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332280">IsDir</span>&nbsp;<span class="keyword" id="1332286">func</span><span class="op" id="1332290">(</span><span class="ident" id="1332291">path</span>&nbsp;<span class="builtintype" id="1332296">string</span><span class="op" id="1332302">)</span>&nbsp;<span class="builtintype" id="1332304">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332311">//&nbsp;HasSubdir&nbsp;reports&nbsp;whether&nbsp;dir&nbsp;is&nbsp;a&nbsp;subdirectory&nbsp;of</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332366">//&nbsp;(perhaps&nbsp;multiple&nbsp;levels&nbsp;below)&nbsp;root.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332408">//&nbsp;If&nbsp;so,&nbsp;HasSubdir&nbsp;sets&nbsp;rel&nbsp;to&nbsp;a&nbsp;slash-separated&nbsp;path&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332469">//&nbsp;can&nbsp;be&nbsp;joined&nbsp;to&nbsp;root&nbsp;to&nbsp;produce&nbsp;a&nbsp;path&nbsp;equivalent&nbsp;to&nbsp;dir.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332532">//&nbsp;If&nbsp;HasSubdir&nbsp;is&nbsp;nil,&nbsp;Import&nbsp;uses&nbsp;an&nbsp;implementation&nbsp;built&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332596">//&nbsp;filepath.EvalSymlinks.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332623">HasSubdir</span>&nbsp;<span class="keyword" id="1332633">func</span><span class="op" id="1332637">(</span><span class="ident" id="1332638">root</span><span class="op" id="1332642">,</span>&nbsp;<span class="ident" id="1332644">dir</span>&nbsp;<span class="builtintype" id="1332648">string</span><span class="op" id="1332654">)</span>&nbsp;<span class="op" id="1332656">(</span><span class="ident" id="1332657">rel</span>&nbsp;<span class="builtintype" id="1332661">string</span><span class="op" id="1332667">,</span>&nbsp;<span class="ident" id="1332669">ok</span>&nbsp;<span class="builtintype" id="1332672">bool</span><span class="op" id="1332676">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332680">//&nbsp;ReadDir&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;os.FileInfo,&nbsp;sorted&nbsp;by&nbsp;Name,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332740">//&nbsp;describing&nbsp;the&nbsp;content&nbsp;of&nbsp;the&nbsp;named&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332791">//&nbsp;If&nbsp;ReadDir&nbsp;is&nbsp;nil,&nbsp;Import&nbsp;uses&nbsp;ioutil.ReadDir.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332842">ReadDir</span>&nbsp;<span class="keyword" id="1332850">func</span><span class="op" id="1332854">(</span><span class="ident" id="1332855">dir</span>&nbsp;<span class="builtintype" id="1332859">string</span><span class="op" id="1332865">)</span>&nbsp;<span class="op" id="1332867">(</span><span class="ident" id="1332868">fi</span>&nbsp;<span class="op" id="1332871">[</span><span class="op" id="1332872">]</span><span class="ident" id="1332873">os</span><span class="op" id="1332875">.</span><span class="ident" id="1332876">FileInfo</span><span class="op" id="1332884">,</span>&nbsp;<span class="ident" id="1332886">err</span>&nbsp;<span class="builtintype" id="1332890">error</span><span class="op" id="1332895">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332899">//&nbsp;OpenFile&nbsp;opens&nbsp;a&nbsp;file&nbsp;(not&nbsp;a&nbsp;directory)&nbsp;for&nbsp;reading.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332956">//&nbsp;If&nbsp;OpenFile&nbsp;is&nbsp;nil,&nbsp;Import&nbsp;uses&nbsp;os.Open.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333001">OpenFile</span>&nbsp;<span class="keyword" id="1333010">func</span><span class="op" id="1333014">(</span><span class="ident" id="1333015">path</span>&nbsp;<span class="builtintype" id="1333020">string</span><span class="op" id="1333026">)</span>&nbsp;<span class="op" id="1333028">(</span><span class="ident" id="1333029">r</span>&nbsp;<span class="ident" id="1333031">io</span><span class="op" id="1333033">.</span><span class="ident" id="1333034">ReadCloser</span><span class="op" id="1333044">,</span>&nbsp;<span class="ident" id="1333046">err</span>&nbsp;<span class="builtintype" id="1333050">error</span><span class="op" id="1333055">)</span><br>
<span class="lineno">95</span><span class="op" id="1333057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1333060">//&nbsp;joinPath&nbsp;calls&nbsp;ctxt.JoinPath&nbsp;(if&nbsp;not&nbsp;nil)&nbsp;or&nbsp;else&nbsp;filepath.Join.</span><br>
<span class="lineno"></span><span class="keyword" id="1333128">func</span>&nbsp;<span class="op" id="1333133">(</span><span class="ident" id="1333134">ctxt</span>&nbsp;<span class="op" id="1333139">*</span><span class="ident" id="1333140">Context</span><span class="op" id="1333147">)</span>&nbsp;<span class="ident" id="1333149">joinPath</span><span class="op" id="1333157">(</span><span class="ident" id="1333158">elem</span>&nbsp;<span class="op" id="1333163">...</span><span class="builtintype" id="1333166">string</span><span class="op" id="1333172">)</span>&nbsp;<span class="builtintype" id="1333174">string</span>&nbsp;<span class="op" id="1333181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333184">if</span>&nbsp;<span class="ident" id="1333187">f</span>&nbsp;<span class="op" id="1333189">:=</span>&nbsp;<span class="ident" id="1333192">ctxt</span><span class="op" id="1333196">.</span><span class="ident" id="1333197">JoinPath</span><span class="op" id="1333205">;</span>&nbsp;<span class="ident" id="1333207">f</span>&nbsp;<span class="op" id="1333209">!=</span>&nbsp;<span class="ident" id="1333212">nil</span>&nbsp;<span class="op" id="1333216">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333220">return</span>&nbsp;<span class="ident" id="1333227">f</span><span class="op" id="1333228">(</span><span class="ident" id="1333229">elem</span><span class="op" id="1333233">...</span><span class="op" id="1333236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1333239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333242">return</span>&nbsp;<span class="ident" id="1333249">filepath</span><span class="op" id="1333257">.</span><span class="ident" id="1333258">Join</span><span class="op" id="1333262">(</span><span class="ident" id="1333263">elem</span><span class="op" id="1333267">...</span><span class="op" id="1333270">)</span><br>
<span class="lineno"></span><span class="op" id="1333272">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="1333275">//&nbsp;splitPathList&nbsp;calls&nbsp;ctxt.SplitPathList&nbsp;(if&nbsp;not&nbsp;nil)&nbsp;or&nbsp;else&nbsp;filepath.SplitList.</span><br>
<span class="lineno"></span><span class="keyword" id="1333358">func</span>&nbsp;<span class="op" id="1333363">(</span><span class="ident" id="1333364">ctxt</span>&nbsp;<span class="op" id="1333369">*</span><span class="ident" id="1333370">Context</span><span class="op" id="1333377">)</span>&nbsp;<span class="ident" id="1333379">splitPathList</span><span class="op" id="1333392">(</span><span class="ident" id="1333393">s</span>&nbsp;<span class="builtintype" id="1333395">string</span><span class="op" id="1333401">)</span>&nbsp;<span class="op" id="1333403">[</span><span class="op" id="1333404">]</span><span class="builtintype" id="1333405">string</span>&nbsp;<span class="op" id="1333412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333415">if</span>&nbsp;<span class="ident" id="1333418">f</span>&nbsp;<span class="op" id="1333420">:=</span>&nbsp;<span class="ident" id="1333423">ctxt</span><span class="op" id="1333427">.</span><span class="ident" id="1333428">SplitPathList</span><span class="op" id="1333441">;</span>&nbsp;<span class="ident" id="1333443">f</span>&nbsp;<span class="op" id="1333445">!=</span>&nbsp;<span class="ident" id="1333448">nil</span>&nbsp;<span class="op" id="1333452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333456">return</span>&nbsp;<span class="ident" id="1333463">f</span><span class="op" id="1333464">(</span><span class="ident" id="1333465">s</span><span class="op" id="1333466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1333469">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333472">return</span>&nbsp;<span class="ident" id="1333479">filepath</span><span class="op" id="1333487">.</span><span class="ident" id="1333488">SplitList</span><span class="op" id="1333497">(</span><span class="ident" id="1333498">s</span><span class="op" id="1333499">)</span><br>
<span class="lineno"></span><span class="op" id="1333501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1333504">//&nbsp;isAbsPath&nbsp;calls&nbsp;ctxt.IsAbsSPath&nbsp;(if&nbsp;not&nbsp;nil)&nbsp;or&nbsp;else&nbsp;filepath.IsAbs.</span><br>
<span class="lineno"></span><span class="keyword" id="1333576">func</span>&nbsp;<span class="op" id="1333581">(</span><span class="ident" id="1333582">ctxt</span>&nbsp;<span class="op" id="1333587">*</span><span class="ident" id="1333588">Context</span><span class="op" id="1333595">)</span>&nbsp;<span class="ident" id="1333597">isAbsPath</span><span class="op" id="1333606">(</span><span class="ident" id="1333607">path</span>&nbsp;<span class="builtintype" id="1333612">string</span><span class="op" id="1333618">)</span>&nbsp;<span class="builtintype" id="1333620">bool</span>&nbsp;<span class="op" id="1333625">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333628">if</span>&nbsp;<span class="ident" id="1333631">f</span>&nbsp;<span class="op" id="1333633">:=</span>&nbsp;<span class="ident" id="1333636">ctxt</span><span class="op" id="1333640">.</span><span class="ident" id="1333641">IsAbsPath</span><span class="op" id="1333650">;</span>&nbsp;<span class="ident" id="1333652">f</span>&nbsp;<span class="op" id="1333654">!=</span>&nbsp;<span class="ident" id="1333657">nil</span>&nbsp;<span class="op" id="1333661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333665">return</span>&nbsp;<span class="ident" id="1333672">f</span><span class="op" id="1333673">(</span><span class="ident" id="1333674">path</span><span class="op" id="1333678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1333681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333684">return</span>&nbsp;<span class="ident" id="1333691">filepath</span><span class="op" id="1333699">.</span><span class="ident" id="1333700">IsAbs</span><span class="op" id="1333705">(</span><span class="ident" id="1333706">path</span><span class="op" id="1333710">)</span><br>
<span class="lineno"></span><span class="op" id="1333712">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="1333715">//&nbsp;isDir&nbsp;calls&nbsp;ctxt.IsDir&nbsp;(if&nbsp;not&nbsp;nil)&nbsp;or&nbsp;else&nbsp;uses&nbsp;os.Stat.</span><br>
<span class="lineno"></span><span class="keyword" id="1333776">func</span>&nbsp;<span class="op" id="1333781">(</span><span class="ident" id="1333782">ctxt</span>&nbsp;<span class="op" id="1333787">*</span><span class="ident" id="1333788">Context</span><span class="op" id="1333795">)</span>&nbsp;<span class="ident" id="1333797">isDir</span><span class="op" id="1333802">(</span><span class="ident" id="1333803">path</span>&nbsp;<span class="builtintype" id="1333808">string</span><span class="op" id="1333814">)</span>&nbsp;<span class="builtintype" id="1333816">bool</span>&nbsp;<span class="op" id="1333821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333824">if</span>&nbsp;<span class="ident" id="1333827">f</span>&nbsp;<span class="op" id="1333829">:=</span>&nbsp;<span class="ident" id="1333832">ctxt</span><span class="op" id="1333836">.</span><span class="ident" id="1333837">IsDir</span><span class="op" id="1333842">;</span>&nbsp;<span class="ident" id="1333844">f</span>&nbsp;<span class="op" id="1333846">!=</span>&nbsp;<span class="ident" id="1333849">nil</span>&nbsp;<span class="op" id="1333853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333857">return</span>&nbsp;<span class="ident" id="1333864">f</span><span class="op" id="1333865">(</span><span class="ident" id="1333866">path</span><span class="op" id="1333870">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1333873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333876">fi</span><span class="op" id="1333878">,</span>&nbsp;<span class="ident" id="1333880">err</span>&nbsp;<span class="op" id="1333884">:=</span>&nbsp;<span class="ident" id="1333887">os</span><span class="op" id="1333889">.</span><span class="ident" id="1333890">Stat</span><span class="op" id="1333894">(</span><span class="ident" id="1333895">path</span><span class="op" id="1333899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333902">return</span>&nbsp;<span class="ident" id="1333909">err</span>&nbsp;<span class="op" id="1333913">==</span>&nbsp;<span class="ident" id="1333916">nil</span>&nbsp;<span class="op" id="1333920">&amp;&amp;</span>&nbsp;<span class="ident" id="1333923">fi</span><span class="op" id="1333925">.</span><span class="ident" id="1333926">IsDir</span><span class="op" id="1333931">(</span><span class="op" id="1333932">)</span><br>
<span class="lineno"></span><span class="op" id="1333934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="1333937">//&nbsp;hasSubdir&nbsp;calls&nbsp;ctxt.HasSubdir&nbsp;(if&nbsp;not&nbsp;nil)&nbsp;or&nbsp;else&nbsp;uses</span><br>
<span class="lineno"></span><span class="comment" id="1333997">//&nbsp;the&nbsp;local&nbsp;file&nbsp;system&nbsp;to&nbsp;answer&nbsp;the&nbsp;question.</span><br>
<span class="lineno"></span><span class="keyword" id="1334046">func</span>&nbsp;<span class="op" id="1334051">(</span><span class="ident" id="1334052">ctxt</span>&nbsp;<span class="op" id="1334057">*</span><span class="ident" id="1334058">Context</span><span class="op" id="1334065">)</span>&nbsp;<span class="ident" id="1334067">hasSubdir</span><span class="op" id="1334076">(</span><span class="ident" id="1334077">root</span><span class="op" id="1334081">,</span>&nbsp;<span class="ident" id="1334083">dir</span>&nbsp;<span class="builtintype" id="1334087">string</span><span class="op" id="1334093">)</span>&nbsp;<span class="op" id="1334095">(</span><span class="ident" id="1334096">rel</span>&nbsp;<span class="builtintype" id="1334100">string</span><span class="op" id="1334106">,</span>&nbsp;<span class="ident" id="1334108">ok</span>&nbsp;<span class="builtintype" id="1334111">bool</span><span class="op" id="1334115">)</span>&nbsp;<span class="op" id="1334117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334120">if</span>&nbsp;<span class="ident" id="1334123">f</span>&nbsp;<span class="op" id="1334125">:=</span>&nbsp;<span class="ident" id="1334128">ctxt</span><span class="op" id="1334132">.</span><span class="ident" id="1334133">HasSubdir</span><span class="op" id="1334142">;</span>&nbsp;<span class="ident" id="1334144">f</span>&nbsp;<span class="op" id="1334146">!=</span>&nbsp;<span class="ident" id="1334149">nil</span>&nbsp;<span class="op" id="1334153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334157">return</span>&nbsp;<span class="ident" id="1334164">f</span><span class="op" id="1334165">(</span><span class="ident" id="1334166">root</span><span class="op" id="1334170">,</span>&nbsp;<span class="ident" id="1334172">dir</span><span class="op" id="1334175">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1334178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1334182">//&nbsp;Try&nbsp;using&nbsp;paths&nbsp;we&nbsp;received.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334215">if</span>&nbsp;<span class="ident" id="1334218">rel</span><span class="op" id="1334221">,</span>&nbsp;<span class="ident" id="1334223">ok</span>&nbsp;<span class="op" id="1334226">=</span>&nbsp;<span class="ident" id="1334228">hasSubdir</span><span class="op" id="1334237">(</span><span class="ident" id="1334238">root</span><span class="op" id="1334242">,</span>&nbsp;<span class="ident" id="1334244">dir</span><span class="op" id="1334247">)</span><span class="op" id="1334248">;</span>&nbsp;<span class="ident" id="1334250">ok</span>&nbsp;<span class="op" id="1334253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334257">return</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1334265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1334269">//&nbsp;Try&nbsp;expanding&nbsp;symlinks&nbsp;and&nbsp;comparing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1334310">//&nbsp;expanded&nbsp;against&nbsp;unexpanded&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1334346">//&nbsp;expanded&nbsp;against&nbsp;expanded.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334377">rootSym</span><span class="op" id="1334384">,</span>&nbsp;<span class="ident" id="1334386">_</span>&nbsp;<span class="op" id="1334388">:=</span>&nbsp;<span class="ident" id="1334391">filepath</span><span class="op" id="1334399">.</span><span class="ident" id="1334400">EvalSymlinks</span><span class="op" id="1334412">(</span><span class="ident" id="1334413">root</span><span class="op" id="1334417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334420">dirSym</span><span class="op" id="1334426">,</span>&nbsp;<span class="ident" id="1334428">_</span>&nbsp;<span class="op" id="1334430">:=</span>&nbsp;<span class="ident" id="1334433">filepath</span><span class="op" id="1334441">.</span><span class="ident" id="1334442">EvalSymlinks</span><span class="op" id="1334454">(</span><span class="ident" id="1334455">dir</span><span class="op" id="1334458">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334462">if</span>&nbsp;<span class="ident" id="1334465">rel</span><span class="op" id="1334468">,</span>&nbsp;<span class="ident" id="1334470">ok</span>&nbsp;<span class="op" id="1334473">=</span>&nbsp;<span class="ident" id="1334475">hasSubdir</span><span class="op" id="1334484">(</span><span class="ident" id="1334485">rootSym</span><span class="op" id="1334492">,</span>&nbsp;<span class="ident" id="1334494">dir</span><span class="op" id="1334497">)</span><span class="op" id="1334498">;</span>&nbsp;<span class="ident" id="1334500">ok</span>&nbsp;<span class="op" id="1334503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334507">return</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1334515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334518">if</span>&nbsp;<span class="ident" id="1334521">rel</span><span class="op" id="1334524">,</span>&nbsp;<span class="ident" id="1334526">ok</span>&nbsp;<span class="op" id="1334529">=</span>&nbsp;<span class="ident" id="1334531">hasSubdir</span><span class="op" id="1334540">(</span><span class="ident" id="1334541">root</span><span class="op" id="1334545">,</span>&nbsp;<span class="ident" id="1334547">dirSym</span><span class="op" id="1334553">)</span><span class="op" id="1334554">;</span>&nbsp;<span class="ident" id="1334556">ok</span>&nbsp;<span class="op" id="1334559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334563">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1334571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334574">return</span>&nbsp;<span class="ident" id="1334581">hasSubdir</span><span class="op" id="1334590">(</span><span class="ident" id="1334591">rootSym</span><span class="op" id="1334598">,</span>&nbsp;<span class="ident" id="1334600">dirSym</span><span class="op" id="1334606">)</span><br>
<span class="lineno">155</span><span class="op" id="1334608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1334611">func</span>&nbsp;<span class="ident" id="1334616">hasSubdir</span><span class="op" id="1334625">(</span><span class="ident" id="1334626">root</span><span class="op" id="1334630">,</span>&nbsp;<span class="ident" id="1334632">dir</span>&nbsp;<span class="builtintype" id="1334636">string</span><span class="op" id="1334642">)</span>&nbsp;<span class="op" id="1334644">(</span><span class="ident" id="1334645">rel</span>&nbsp;<span class="builtintype" id="1334649">string</span><span class="op" id="1334655">,</span>&nbsp;<span class="ident" id="1334657">ok</span>&nbsp;<span class="builtintype" id="1334660">bool</span><span class="op" id="1334664">)</span>&nbsp;<span class="op" id="1334666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334669">const</span>&nbsp;<span class="ident" id="1334675">sep</span>&nbsp;<span class="op" id="1334679">=</span>&nbsp;<span class="builtintype" id="1334681">string</span><span class="op" id="1334687">(</span><span class="ident" id="1334688">filepath</span><span class="op" id="1334696">.</span><span class="ident" id="1334697">Separator</span><span class="op" id="1334706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334709">root</span>&nbsp;<span class="op" id="1334714">=</span>&nbsp;<span class="ident" id="1334716">filepath</span><span class="op" id="1334724">.</span><span class="ident" id="1334725">Clean</span><span class="op" id="1334730">(</span><span class="ident" id="1334731">root</span><span class="op" id="1334735">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334738">if</span>&nbsp;<span class="op" id="1334741">!</span><span class="ident" id="1334742">strings</span><span class="op" id="1334749">.</span><span class="ident" id="1334750">HasSuffix</span><span class="op" id="1334759">(</span><span class="ident" id="1334760">root</span><span class="op" id="1334764">,</span>&nbsp;<span class="ident" id="1334766">sep</span><span class="op" id="1334769">)</span>&nbsp;<span class="op" id="1334771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334775">root</span>&nbsp;<span class="op" id="1334780">+=</span>&nbsp;<span class="ident" id="1334783">sep</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1334788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334791">dir</span>&nbsp;<span class="op" id="1334795">=</span>&nbsp;<span class="ident" id="1334797">filepath</span><span class="op" id="1334805">.</span><span class="ident" id="1334806">Clean</span><span class="op" id="1334811">(</span><span class="ident" id="1334812">dir</span><span class="op" id="1334815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334818">if</span>&nbsp;<span class="op" id="1334821">!</span><span class="ident" id="1334822">strings</span><span class="op" id="1334829">.</span><span class="ident" id="1334830">HasPrefix</span><span class="op" id="1334839">(</span><span class="ident" id="1334840">dir</span><span class="op" id="1334843">,</span>&nbsp;<span class="ident" id="1334845">root</span><span class="op" id="1334849">)</span>&nbsp;<span class="op" id="1334851">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334855">return</span>&nbsp;<span class="string" id="1334862">&#34;&#34;</span><span class="op" id="1334864">,</span>&nbsp;<span class="builtintype" id="1334866">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1334873">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334876">return</span>&nbsp;<span class="ident" id="1334883">filepath</span><span class="op" id="1334891">.</span><span class="ident" id="1334892">ToSlash</span><span class="op" id="1334899">(</span><span class="ident" id="1334900">dir</span><span class="op" id="1334903">[</span><span class="builtinfunc" id="1334904">len</span><span class="op" id="1334907">(</span><span class="ident" id="1334908">root</span><span class="op" id="1334912">)</span><span class="op" id="1334913">:</span><span class="op" id="1334914">]</span><span class="op" id="1334915">)</span><span class="op" id="1334916">,</span>&nbsp;<span class="builtintype" id="1334918">true</span><br>
<span class="lineno"></span><span class="op" id="1334923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="1334926">//&nbsp;readDir&nbsp;calls&nbsp;ctxt.ReadDir&nbsp;(if&nbsp;not&nbsp;nil)&nbsp;or&nbsp;else&nbsp;ioutil.ReadDir.</span><br>
<span class="lineno"></span><span class="keyword" id="1334993">func</span>&nbsp;<span class="op" id="1334998">(</span><span class="ident" id="1334999">ctxt</span>&nbsp;<span class="op" id="1335004">*</span><span class="ident" id="1335005">Context</span><span class="op" id="1335012">)</span>&nbsp;<span class="ident" id="1335014">readDir</span><span class="op" id="1335021">(</span><span class="ident" id="1335022">path</span>&nbsp;<span class="builtintype" id="1335027">string</span><span class="op" id="1335033">)</span>&nbsp;<span class="op" id="1335035">(</span><span class="op" id="1335036">[</span><span class="op" id="1335037">]</span><span class="ident" id="1335038">os</span><span class="op" id="1335040">.</span><span class="ident" id="1335041">FileInfo</span><span class="op" id="1335049">,</span>&nbsp;<span class="builtintype" id="1335051">error</span><span class="op" id="1335056">)</span>&nbsp;<span class="op" id="1335058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335061">if</span>&nbsp;<span class="ident" id="1335064">f</span>&nbsp;<span class="op" id="1335066">:=</span>&nbsp;<span class="ident" id="1335069">ctxt</span><span class="op" id="1335073">.</span><span class="ident" id="1335074">ReadDir</span><span class="op" id="1335081">;</span>&nbsp;<span class="ident" id="1335083">f</span>&nbsp;<span class="op" id="1335085">!=</span>&nbsp;<span class="ident" id="1335088">nil</span>&nbsp;<span class="op" id="1335092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335096">return</span>&nbsp;<span class="ident" id="1335103">f</span><span class="op" id="1335104">(</span><span class="ident" id="1335105">path</span><span class="op" id="1335109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1335112">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335115">return</span>&nbsp;<span class="ident" id="1335122">ioutil</span><span class="op" id="1335128">.</span><span class="ident" id="1335129">ReadDir</span><span class="op" id="1335136">(</span><span class="ident" id="1335137">path</span><span class="op" id="1335141">)</span><br>
<span class="lineno"></span><span class="op" id="1335143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1335146">//&nbsp;openFile&nbsp;calls&nbsp;ctxt.OpenFile&nbsp;(if&nbsp;not&nbsp;nil)&nbsp;or&nbsp;else&nbsp;os.Open.</span><br>
<span class="lineno"></span><span class="keyword" id="1335208">func</span>&nbsp;<span class="op" id="1335213">(</span><span class="ident" id="1335214">ctxt</span>&nbsp;<span class="op" id="1335219">*</span><span class="ident" id="1335220">Context</span><span class="op" id="1335227">)</span>&nbsp;<span class="ident" id="1335229">openFile</span><span class="op" id="1335237">(</span><span class="ident" id="1335238">path</span>&nbsp;<span class="builtintype" id="1335243">string</span><span class="op" id="1335249">)</span>&nbsp;<span class="op" id="1335251">(</span><span class="ident" id="1335252">io</span><span class="op" id="1335254">.</span><span class="ident" id="1335255">ReadCloser</span><span class="op" id="1335265">,</span>&nbsp;<span class="builtintype" id="1335267">error</span><span class="op" id="1335272">)</span>&nbsp;<span class="op" id="1335274">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335277">if</span>&nbsp;<span class="ident" id="1335280">fn</span>&nbsp;<span class="op" id="1335283">:=</span>&nbsp;<span class="ident" id="1335286">ctxt</span><span class="op" id="1335290">.</span><span class="ident" id="1335291">OpenFile</span><span class="op" id="1335299">;</span>&nbsp;<span class="ident" id="1335301">fn</span>&nbsp;<span class="op" id="1335304">!=</span>&nbsp;<span class="ident" id="1335307">nil</span>&nbsp;<span class="op" id="1335311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335315">return</span>&nbsp;<span class="ident" id="1335322">fn</span><span class="op" id="1335324">(</span><span class="ident" id="1335325">path</span><span class="op" id="1335329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1335332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335336">f</span><span class="op" id="1335337">,</span>&nbsp;<span class="ident" id="1335339">err</span>&nbsp;<span class="op" id="1335343">:=</span>&nbsp;<span class="ident" id="1335346">os</span><span class="op" id="1335348">.</span><span class="ident" id="1335349">Open</span><span class="op" id="1335353">(</span><span class="ident" id="1335354">path</span><span class="op" id="1335358">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335361">if</span>&nbsp;<span class="ident" id="1335364">err</span>&nbsp;<span class="op" id="1335368">!=</span>&nbsp;<span class="ident" id="1335371">nil</span>&nbsp;<span class="op" id="1335375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335379">return</span>&nbsp;<span class="ident" id="1335386">nil</span><span class="op" id="1335389">,</span>&nbsp;<span class="ident" id="1335391">err</span>&nbsp;<span class="comment" id="1335395">//&nbsp;nil&nbsp;interface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1335413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335416">return</span>&nbsp;<span class="ident" id="1335423">f</span><span class="op" id="1335424">,</span>&nbsp;<span class="ident" id="1335426">nil</span><br>
<span class="lineno"></span><span class="op" id="1335430">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="1335433">//&nbsp;isFile&nbsp;determines&nbsp;whether&nbsp;path&nbsp;is&nbsp;a&nbsp;file&nbsp;by&nbsp;trying&nbsp;to&nbsp;open&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="1335499">//&nbsp;It&nbsp;reuses&nbsp;openFile&nbsp;instead&nbsp;of&nbsp;adding&nbsp;another&nbsp;function&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1335563">//&nbsp;list&nbsp;in&nbsp;Context.</span><br>
<span class="lineno"></span><span class="keyword" id="1335583">func</span>&nbsp;<span class="op" id="1335588">(</span><span class="ident" id="1335589">ctxt</span>&nbsp;<span class="op" id="1335594">*</span><span class="ident" id="1335595">Context</span><span class="op" id="1335602">)</span>&nbsp;<span class="ident" id="1335604">isFile</span><span class="op" id="1335610">(</span><span class="ident" id="1335611">path</span>&nbsp;<span class="builtintype" id="1335616">string</span><span class="op" id="1335622">)</span>&nbsp;<span class="builtintype" id="1335624">bool</span>&nbsp;<span class="op" id="1335629">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335632">f</span><span class="op" id="1335633">,</span>&nbsp;<span class="ident" id="1335635">err</span>&nbsp;<span class="op" id="1335639">:=</span>&nbsp;<span class="ident" id="1335642">ctxt</span><span class="op" id="1335646">.</span><span class="ident" id="1335647">openFile</span><span class="op" id="1335655">(</span><span class="ident" id="1335656">path</span><span class="op" id="1335660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335663">if</span>&nbsp;<span class="ident" id="1335666">err</span>&nbsp;<span class="op" id="1335670">!=</span>&nbsp;<span class="ident" id="1335673">nil</span>&nbsp;<span class="op" id="1335677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335681">return</span>&nbsp;<span class="builtintype" id="1335688">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1335695">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1335698">f</span><span class="op" id="1335699">.</span><span class="ident" id="1335700">Close</span><span class="op" id="1335705">(</span><span class="op" id="1335706">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335709">return</span>&nbsp;<span class="builtintype" id="1335716">true</span><br>
<span class="lineno"></span><span class="op" id="1335721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1335724">//&nbsp;gopath&nbsp;returns&nbsp;the&nbsp;list&nbsp;of&nbsp;Go&nbsp;path&nbsp;directories.</span><br>
<span class="lineno"></span><span class="keyword" id="1335775">func</span>&nbsp;<span class="op" id="1335780">(</span><span class="ident" id="1335781">ctxt</span>&nbsp;<span class="op" id="1335786">*</span><span class="ident" id="1335787">Context</span><span class="op" id="1335794">)</span>&nbsp;<span class="ident" id="1335796">gopath</span><span class="op" id="1335802">(</span><span class="op" id="1335803">)</span>&nbsp;<span class="op" id="1335805">[</span><span class="op" id="1335806">]</span><span class="builtintype" id="1335807">string</span>&nbsp;<span class="op" id="1335814">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335817">var</span>&nbsp;<span class="ident" id="1335821">all</span>&nbsp;<span class="op" id="1335825">[</span><span class="op" id="1335826">]</span><span class="builtintype" id="1335827">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335835">for</span>&nbsp;<span class="ident" id="1335839">_</span><span class="op" id="1335840">,</span>&nbsp;<span class="ident" id="1335842">p</span>&nbsp;<span class="op" id="1335844">:=</span>&nbsp;<span class="keyword" id="1335847">range</span>&nbsp;<span class="ident" id="1335853">ctxt</span><span class="op" id="1335857">.</span><span class="ident" id="1335858">splitPathList</span><span class="op" id="1335871">(</span><span class="ident" id="1335872">ctxt</span><span class="op" id="1335876">.</span><span class="ident" id="1335877">GOPATH</span><span class="op" id="1335883">)</span>&nbsp;<span class="op" id="1335885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335889">if</span>&nbsp;<span class="ident" id="1335892">p</span>&nbsp;<span class="op" id="1335894">==</span>&nbsp;<span class="string" id="1335897">&#34;&#34;</span>&nbsp;<span class="op" id="1335900">||</span>&nbsp;<span class="ident" id="1335903">p</span>&nbsp;<span class="op" id="1335905">==</span>&nbsp;<span class="ident" id="1335908">ctxt</span><span class="op" id="1335912">.</span><span class="ident" id="1335913">GOROOT</span>&nbsp;<span class="op" id="1335920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1335925">//&nbsp;Empty&nbsp;paths&nbsp;are&nbsp;uninteresting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1335962">//&nbsp;If&nbsp;the&nbsp;path&nbsp;is&nbsp;the&nbsp;GOROOT,&nbsp;ignore&nbsp;it.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1336006">//&nbsp;People&nbsp;sometimes&nbsp;set&nbsp;GOPATH=$GOROOT.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1336049">//&nbsp;Do&nbsp;not&nbsp;get&nbsp;confused&nbsp;by&nbsp;this&nbsp;common&nbsp;mistake.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336099">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1336110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336114">if</span>&nbsp;<span class="ident" id="1336117">strings</span><span class="op" id="1336124">.</span><span class="ident" id="1336125">HasPrefix</span><span class="op" id="1336134">(</span><span class="ident" id="1336135">p</span><span class="op" id="1336136">,</span>&nbsp;<span class="string" id="1336138">&#34;~&#34;</span><span class="op" id="1336141">)</span>&nbsp;<span class="op" id="1336143">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1336148">//&nbsp;Path&nbsp;segments&nbsp;starting&nbsp;with&nbsp;~&nbsp;on&nbsp;Unix&nbsp;are&nbsp;almost&nbsp;always</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1336210">//&nbsp;users&nbsp;who&nbsp;have&nbsp;incorrectly&nbsp;quoted&nbsp;~&nbsp;while&nbsp;setting&nbsp;GOPATH,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1336274">//&nbsp;preventing&nbsp;it&nbsp;from&nbsp;expanding&nbsp;to&nbsp;$HOME.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1336319">//&nbsp;The&nbsp;situation&nbsp;is&nbsp;made&nbsp;more&nbsp;confusing&nbsp;by&nbsp;the&nbsp;fact&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1336379">//&nbsp;bash&nbsp;allows&nbsp;quoted&nbsp;~&nbsp;in&nbsp;$PATH&nbsp;(most&nbsp;shells&nbsp;do&nbsp;not).</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1336437">//&nbsp;Do&nbsp;not&nbsp;get&nbsp;confused&nbsp;by&nbsp;this,&nbsp;and&nbsp;do&nbsp;not&nbsp;try&nbsp;to&nbsp;use&nbsp;the&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1336504">//&nbsp;It&nbsp;does&nbsp;not&nbsp;exist,&nbsp;and&nbsp;printing&nbsp;errors&nbsp;about&nbsp;it&nbsp;confuses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1336567">//&nbsp;those&nbsp;users&nbsp;even&nbsp;more,&nbsp;because&nbsp;they&nbsp;think&nbsp;&#34;sure&nbsp;~&nbsp;exists!&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1336633">//&nbsp;The&nbsp;go&nbsp;command&nbsp;diagnoses&nbsp;this&nbsp;situation&nbsp;and&nbsp;prints&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1336692">//&nbsp;useful&nbsp;error.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1336712">//&nbsp;On&nbsp;Windows,&nbsp;~&nbsp;is&nbsp;used&nbsp;in&nbsp;short&nbsp;names,&nbsp;such&nbsp;as&nbsp;c:\progra~1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1336776">//&nbsp;for&nbsp;c:\program&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336804">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1336815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336819">all</span>&nbsp;<span class="op" id="1336823">=</span>&nbsp;<span class="builtinfunc" id="1336825">append</span><span class="op" id="1336831">(</span><span class="ident" id="1336832">all</span><span class="op" id="1336835">,</span>&nbsp;<span class="ident" id="1336837">p</span><span class="op" id="1336838">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1336841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336844">return</span>&nbsp;<span class="ident" id="1336851">all</span><br>
<span class="lineno"></span><span class="op" id="1336855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1336858">//&nbsp;SrcDirs&nbsp;returns&nbsp;a&nbsp;list&nbsp;of&nbsp;package&nbsp;source&nbsp;root&nbsp;directories.</span><br>
<span class="lineno">235</span><span class="comment" id="1336920">//&nbsp;It&nbsp;draws&nbsp;from&nbsp;the&nbsp;current&nbsp;Go&nbsp;root&nbsp;and&nbsp;Go&nbsp;path&nbsp;but&nbsp;omits&nbsp;directories</span><br>
<span class="lineno"></span><span class="comment" id="1336991">//&nbsp;that&nbsp;do&nbsp;not&nbsp;exist.</span><br>
<span class="lineno"></span><span class="keyword" id="1337013">func</span>&nbsp;<span class="op" id="1337018">(</span><span class="ident" id="1337019">ctxt</span>&nbsp;<span class="op" id="1337024">*</span><span class="ident" id="1337025">Context</span><span class="op" id="1337032">)</span>&nbsp;<span class="ident" id="1337034">SrcDirs</span><span class="op" id="1337041">(</span><span class="op" id="1337042">)</span>&nbsp;<span class="op" id="1337044">[</span><span class="op" id="1337045">]</span><span class="builtintype" id="1337046">string</span>&nbsp;<span class="op" id="1337053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337056">var</span>&nbsp;<span class="ident" id="1337060">all</span>&nbsp;<span class="op" id="1337064">[</span><span class="op" id="1337065">]</span><span class="builtintype" id="1337066">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337074">if</span>&nbsp;<span class="ident" id="1337077">ctxt</span><span class="op" id="1337081">.</span><span class="ident" id="1337082">GOROOT</span>&nbsp;<span class="op" id="1337089">!=</span>&nbsp;<span class="string" id="1337092">&#34;&#34;</span>&nbsp;<span class="op" id="1337095">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337099">dir</span>&nbsp;<span class="op" id="1337103">:=</span>&nbsp;<span class="ident" id="1337106">ctxt</span><span class="op" id="1337110">.</span><span class="ident" id="1337111">joinPath</span><span class="op" id="1337119">(</span><span class="ident" id="1337120">ctxt</span><span class="op" id="1337124">.</span><span class="ident" id="1337125">GOROOT</span><span class="op" id="1337131">,</span>&nbsp;<span class="string" id="1337133">&#34;src&#34;</span><span class="op" id="1337138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337142">if</span>&nbsp;<span class="ident" id="1337145">ctxt</span><span class="op" id="1337149">.</span><span class="ident" id="1337150">isDir</span><span class="op" id="1337155">(</span><span class="ident" id="1337156">dir</span><span class="op" id="1337159">)</span>&nbsp;<span class="op" id="1337161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337166">all</span>&nbsp;<span class="op" id="1337170">=</span>&nbsp;<span class="builtinfunc" id="1337172">append</span><span class="op" id="1337178">(</span><span class="ident" id="1337179">all</span><span class="op" id="1337182">,</span>&nbsp;<span class="ident" id="1337184">dir</span><span class="op" id="1337187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1337191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1337194">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337197">for</span>&nbsp;<span class="ident" id="1337201">_</span><span class="op" id="1337202">,</span>&nbsp;<span class="ident" id="1337204">p</span>&nbsp;<span class="op" id="1337206">:=</span>&nbsp;<span class="keyword" id="1337209">range</span>&nbsp;<span class="ident" id="1337215">ctxt</span><span class="op" id="1337219">.</span><span class="ident" id="1337220">gopath</span><span class="op" id="1337226">(</span><span class="op" id="1337227">)</span>&nbsp;<span class="op" id="1337229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337233">dir</span>&nbsp;<span class="op" id="1337237">:=</span>&nbsp;<span class="ident" id="1337240">ctxt</span><span class="op" id="1337244">.</span><span class="ident" id="1337245">joinPath</span><span class="op" id="1337253">(</span><span class="ident" id="1337254">p</span><span class="op" id="1337255">,</span>&nbsp;<span class="string" id="1337257">&#34;src&#34;</span><span class="op" id="1337262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337266">if</span>&nbsp;<span class="ident" id="1337269">ctxt</span><span class="op" id="1337273">.</span><span class="ident" id="1337274">isDir</span><span class="op" id="1337279">(</span><span class="ident" id="1337280">dir</span><span class="op" id="1337283">)</span>&nbsp;<span class="op" id="1337285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337290">all</span>&nbsp;<span class="op" id="1337294">=</span>&nbsp;<span class="builtinfunc" id="1337296">append</span><span class="op" id="1337302">(</span><span class="ident" id="1337303">all</span><span class="op" id="1337306">,</span>&nbsp;<span class="ident" id="1337308">dir</span><span class="op" id="1337311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1337315">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1337318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337321">return</span>&nbsp;<span class="ident" id="1337328">all</span><br>
<span class="lineno"></span><span class="op" id="1337332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1337335">//&nbsp;Default&nbsp;is&nbsp;the&nbsp;default&nbsp;Context&nbsp;for&nbsp;builds.</span><br>
<span class="lineno">255</span><span class="comment" id="1337381">//&nbsp;It&nbsp;uses&nbsp;the&nbsp;GOARCH,&nbsp;GOOS,&nbsp;GOROOT,&nbsp;and&nbsp;GOPATH&nbsp;environment&nbsp;variables</span><br>
<span class="lineno"></span><span class="comment" id="1337451">//&nbsp;if&nbsp;set,&nbsp;or&nbsp;else&nbsp;the&nbsp;compiled&nbsp;code&#39;s&nbsp;GOARCH,&nbsp;GOOS,&nbsp;and&nbsp;GOROOT.</span><br>
<span class="lineno"></span><span class="keyword" id="1337516">var</span>&nbsp;<span class="ident" id="1337520">Default</span>&nbsp;<span class="ident" id="1337528">Context</span>&nbsp;<span class="op" id="1337536">=</span>&nbsp;<span class="ident" id="1337538">defaultContext</span><span class="op" id="1337552">(</span><span class="op" id="1337553">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1337556">var</span>&nbsp;<span class="ident" id="1337560">cgoEnabled</span>&nbsp;<span class="op" id="1337571">=</span>&nbsp;<span class="keyword" id="1337573">map</span><span class="op" id="1337576">[</span><span class="builtintype" id="1337577">string</span><span class="op" id="1337583">]</span><span class="builtintype" id="1337584">bool</span><span class="op" id="1337588">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1337591">&#34;darwin/386&#34;</span><span class="op" id="1337603">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1337610">true</span><span class="op" id="1337614">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1337617">&#34;darwin/amd64&#34;</span><span class="op" id="1337631">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1337636">true</span><span class="op" id="1337640">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1337643">&#34;dragonfly/386&#34;</span><span class="op" id="1337658">:</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1337662">true</span><span class="op" id="1337666">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1337669">&#34;dragonfly/amd64&#34;</span><span class="op" id="1337686">:</span>&nbsp;<span class="builtintype" id="1337688">true</span><span class="op" id="1337692">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1337695">&#34;freebsd/386&#34;</span><span class="op" id="1337708">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1337714">true</span><span class="op" id="1337718">,</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1337721">&#34;freebsd/amd64&#34;</span><span class="op" id="1337736">:</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1337740">true</span><span class="op" id="1337744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1337747">&#34;freebsd/arm&#34;</span><span class="op" id="1337760">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1337766">true</span><span class="op" id="1337770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1337773">&#34;linux/386&#34;</span><span class="op" id="1337784">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1337792">true</span><span class="op" id="1337796">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1337799">&#34;linux/amd64&#34;</span><span class="op" id="1337812">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1337818">true</span><span class="op" id="1337822">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1337825">&#34;linux/arm&#34;</span><span class="op" id="1337836">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1337844">true</span><span class="op" id="1337848">,</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1337851">&#34;android/386&#34;</span><span class="op" id="1337864">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1337870">true</span><span class="op" id="1337874">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1337877">&#34;android/amd64&#34;</span><span class="op" id="1337892">:</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1337896">true</span><span class="op" id="1337900">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1337903">&#34;android/arm&#34;</span><span class="op" id="1337916">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1337922">true</span><span class="op" id="1337926">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1337929">&#34;netbsd/386&#34;</span><span class="op" id="1337941">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1337948">true</span><span class="op" id="1337952">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1337955">&#34;netbsd/amd64&#34;</span><span class="op" id="1337969">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1337974">true</span><span class="op" id="1337978">,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1337981">&#34;netbsd/arm&#34;</span><span class="op" id="1337993">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1338000">true</span><span class="op" id="1338004">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1338007">&#34;openbsd/386&#34;</span><span class="op" id="1338020">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1338026">true</span><span class="op" id="1338030">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1338033">&#34;openbsd/amd64&#34;</span><span class="op" id="1338048">:</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1338052">true</span><span class="op" id="1338056">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1338059">&#34;windows/386&#34;</span><span class="op" id="1338072">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1338078">true</span><span class="op" id="1338082">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1338085">&#34;windows/amd64&#34;</span><span class="op" id="1338100">:</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1338104">true</span><span class="op" id="1338108">,</span><br>
<span class="lineno">280</span><span class="op" id="1338110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1338113">func</span>&nbsp;<span class="ident" id="1338118">defaultContext</span><span class="op" id="1338132">(</span><span class="op" id="1338133">)</span>&nbsp;<span class="ident" id="1338135">Context</span>&nbsp;<span class="op" id="1338143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338146">var</span>&nbsp;<span class="ident" id="1338150">c</span>&nbsp;<span class="ident" id="1338152">Context</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338162">c</span><span class="op" id="1338163">.</span><span class="ident" id="1338164">GOARCH</span>&nbsp;<span class="op" id="1338171">=</span>&nbsp;<span class="ident" id="1338173">envOr</span><span class="op" id="1338178">(</span><span class="string" id="1338179">&#34;GOARCH&#34;</span><span class="op" id="1338187">,</span>&nbsp;<span class="ident" id="1338189">runtime</span><span class="op" id="1338196">.</span><span class="ident" id="1338197">GOARCH</span><span class="op" id="1338203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338206">c</span><span class="op" id="1338207">.</span><span class="ident" id="1338208">GOOS</span>&nbsp;<span class="op" id="1338213">=</span>&nbsp;<span class="ident" id="1338215">envOr</span><span class="op" id="1338220">(</span><span class="string" id="1338221">&#34;GOOS&#34;</span><span class="op" id="1338227">,</span>&nbsp;<span class="ident" id="1338229">runtime</span><span class="op" id="1338236">.</span><span class="ident" id="1338237">GOOS</span><span class="op" id="1338241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338244">c</span><span class="op" id="1338245">.</span><span class="ident" id="1338246">GOROOT</span>&nbsp;<span class="op" id="1338253">=</span>&nbsp;<span class="ident" id="1338255">runtime</span><span class="op" id="1338262">.</span><span class="ident" id="1338263">GOROOT</span><span class="op" id="1338269">(</span><span class="op" id="1338270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338273">c</span><span class="op" id="1338274">.</span><span class="ident" id="1338275">GOPATH</span>&nbsp;<span class="op" id="1338282">=</span>&nbsp;<span class="ident" id="1338284">envOr</span><span class="op" id="1338289">(</span><span class="string" id="1338290">&#34;GOPATH&#34;</span><span class="op" id="1338298">,</span>&nbsp;<span class="string" id="1338300">&#34;&#34;</span><span class="op" id="1338302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338305">c</span><span class="op" id="1338306">.</span><span class="ident" id="1338307">Compiler</span>&nbsp;<span class="op" id="1338316">=</span>&nbsp;<span class="ident" id="1338318">runtime</span><span class="op" id="1338325">.</span><span class="ident" id="1338326">Compiler</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1338337">//&nbsp;Each&nbsp;major&nbsp;Go&nbsp;release&nbsp;in&nbsp;the&nbsp;Go&nbsp;1.x&nbsp;series&nbsp;should&nbsp;add&nbsp;a&nbsp;tag&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1338407">//&nbsp;Old&nbsp;tags&nbsp;should&nbsp;not&nbsp;be&nbsp;removed.&nbsp;That&nbsp;is,&nbsp;the&nbsp;go1.x&nbsp;tag&nbsp;is&nbsp;present</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1338477">//&nbsp;in&nbsp;all&nbsp;releases&nbsp;&gt;=&nbsp;Go&nbsp;1.x.&nbsp;Code&nbsp;that&nbsp;requires&nbsp;Go&nbsp;1.x&nbsp;or&nbsp;later&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1338550">//&nbsp;say&nbsp;&#34;+build&nbsp;go1.x&#34;,&nbsp;and&nbsp;code&nbsp;that&nbsp;should&nbsp;only&nbsp;be&nbsp;built&nbsp;before&nbsp;Go&nbsp;1.x</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1338623">//&nbsp;(perhaps&nbsp;it&nbsp;is&nbsp;the&nbsp;stub&nbsp;to&nbsp;use&nbsp;in&nbsp;that&nbsp;case)&nbsp;should&nbsp;say&nbsp;&#34;+build&nbsp;!go1.x&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1338700">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1338704">//&nbsp;When&nbsp;we&nbsp;reach&nbsp;Go&nbsp;1.5&nbsp;the&nbsp;line&nbsp;will&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1338748">//&nbsp;&nbsp;&nbsp;&nbspc.ReleaseTags&nbsp;=&nbsp;[]string{&#34;go1.1&#34;,&nbsp;&#34;go1.2&#34;,&nbsp;&#34;go1.3&#34;,&nbsp;&#34;go1.4&#34;,&nbsp;&#34;go1.5&#34;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1338822">//&nbsp;and&nbsp;so&nbsp;on.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338837">c</span><span class="op" id="1338838">.</span><span class="ident" id="1338839">ReleaseTags</span>&nbsp;<span class="op" id="1338851">=</span>&nbsp;<span class="op" id="1338853">[</span><span class="op" id="1338854">]</span><span class="builtintype" id="1338855">string</span><span class="op" id="1338861">{</span><span class="string" id="1338862">&#34;go1.1&#34;</span><span class="op" id="1338869">,</span>&nbsp;<span class="string" id="1338871">&#34;go1.2&#34;</span><span class="op" id="1338878">,</span>&nbsp;<span class="string" id="1338880">&#34;go1.3&#34;</span><span class="op" id="1338887">,</span>&nbsp;<span class="string" id="1338889">&#34;go1.4&#34;</span><span class="op" id="1338896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338900">switch</span>&nbsp;<span class="ident" id="1338907">os</span><span class="op" id="1338909">.</span><span class="ident" id="1338910">Getenv</span><span class="op" id="1338916">(</span><span class="string" id="1338917">&#34;CGO_ENABLED&#34;</span><span class="op" id="1338930">)</span>&nbsp;<span class="op" id="1338932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338935">case</span>&nbsp;<span class="string" id="1338940">&#34;1&#34;</span><span class="op" id="1338943">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338947">c</span><span class="op" id="1338948">.</span><span class="ident" id="1338949">CgoEnabled</span>&nbsp;<span class="op" id="1338960">=</span>&nbsp;<span class="builtintype" id="1338962">true</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338968">case</span>&nbsp;<span class="string" id="1338973">&#34;0&#34;</span><span class="op" id="1338976">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1338980">c</span><span class="op" id="1338981">.</span><span class="ident" id="1338982">CgoEnabled</span>&nbsp;<span class="op" id="1338993">=</span>&nbsp;<span class="builtintype" id="1338995">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339002">default</span><span class="op" id="1339009">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1339013">//&nbsp;cgo&nbsp;must&nbsp;be&nbsp;explicitly&nbsp;enabled&nbsp;for&nbsp;cross&nbsp;compilation&nbsp;builds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339078">if</span>&nbsp;<span class="ident" id="1339081">runtime</span><span class="op" id="1339088">.</span><span class="ident" id="1339089">GOARCH</span>&nbsp;<span class="op" id="1339096">==</span>&nbsp;<span class="ident" id="1339099">c</span><span class="op" id="1339100">.</span><span class="ident" id="1339101">GOARCH</span>&nbsp;<span class="op" id="1339108">&amp;&amp;</span>&nbsp;<span class="ident" id="1339111">runtime</span><span class="op" id="1339118">.</span><span class="ident" id="1339119">GOOS</span>&nbsp;<span class="op" id="1339124">==</span>&nbsp;<span class="ident" id="1339127">c</span><span class="op" id="1339128">.</span><span class="ident" id="1339129">GOOS</span>&nbsp;<span class="op" id="1339134">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339139">c</span><span class="op" id="1339140">.</span><span class="ident" id="1339141">CgoEnabled</span>&nbsp;<span class="op" id="1339152">=</span>&nbsp;<span class="ident" id="1339154">cgoEnabled</span><span class="op" id="1339164">[</span><span class="ident" id="1339165">c</span><span class="op" id="1339166">.</span><span class="ident" id="1339167">GOOS</span><span class="op" id="1339171">+</span><span class="string" id="1339172">&#34;/&#34;</span><span class="op" id="1339175">+</span><span class="ident" id="1339176">c</span><span class="op" id="1339177">.</span><span class="ident" id="1339178">GOARCH</span><span class="op" id="1339184">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339189">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1339197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339201">c</span><span class="op" id="1339202">.</span><span class="ident" id="1339203">CgoEnabled</span>&nbsp;<span class="op" id="1339214">=</span>&nbsp;<span class="builtintype" id="1339216">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1339223">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339227">return</span>&nbsp;<span class="ident" id="1339234">c</span><br>
<span class="lineno"></span><span class="op" id="1339236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1339239">func</span>&nbsp;<span class="ident" id="1339244">envOr</span><span class="op" id="1339249">(</span><span class="ident" id="1339250">name</span><span class="op" id="1339254">,</span>&nbsp;<span class="ident" id="1339256">def</span>&nbsp;<span class="builtintype" id="1339260">string</span><span class="op" id="1339266">)</span>&nbsp;<span class="builtintype" id="1339268">string</span>&nbsp;<span class="op" id="1339275">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339278">s</span>&nbsp;<span class="op" id="1339280">:=</span>&nbsp;<span class="ident" id="1339283">os</span><span class="op" id="1339285">.</span><span class="ident" id="1339286">Getenv</span><span class="op" id="1339292">(</span><span class="ident" id="1339293">name</span><span class="op" id="1339297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339300">if</span>&nbsp;<span class="ident" id="1339303">s</span>&nbsp;<span class="op" id="1339305">==</span>&nbsp;<span class="string" id="1339308">&#34;&#34;</span>&nbsp;<span class="op" id="1339311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339315">return</span>&nbsp;<span class="ident" id="1339322">def</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1339327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339330">return</span>&nbsp;<span class="ident" id="1339337">s</span><br>
<span class="lineno">325</span><span class="op" id="1339339">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1339342">//&nbsp;An&nbsp;ImportMode&nbsp;controls&nbsp;the&nbsp;behavior&nbsp;of&nbsp;the&nbsp;Import&nbsp;method.</span><br>
<span class="lineno"></span><span class="keyword" id="1339403">type</span>&nbsp;<span class="ident" id="1339408">ImportMode</span>&nbsp;<span class="builtintype" id="1339419">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span><span class="keyword" id="1339425">const</span>&nbsp;<span class="op" id="1339431">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1339434">//&nbsp;If&nbsp;FindOnly&nbsp;is&nbsp;set,&nbsp;Import&nbsp;stops&nbsp;after&nbsp;locating&nbsp;the&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1339500">//&nbsp;that&nbsp;should&nbsp;contain&nbsp;the&nbsp;sources&nbsp;for&nbsp;a&nbsp;package.&nbsp;&nbsp;It&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1339564">//&nbsp;read&nbsp;any&nbsp;files&nbsp;in&nbsp;the&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339601">FindOnly</span>&nbsp;<span class="ident" id="1339610">ImportMode</span>&nbsp;<span class="op" id="1339621">=</span>&nbsp;<span class="num" id="1339623">1</span>&nbsp;<span class="op" id="1339625">&lt;&lt;</span>&nbsp;<span class="ident" id="1339628">iota</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1339635">//&nbsp;If&nbsp;AllowBinary&nbsp;is&nbsp;set,&nbsp;Import&nbsp;can&nbsp;be&nbsp;satisfied&nbsp;by&nbsp;a&nbsp;compiled</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1339700">//&nbsp;package&nbsp;object&nbsp;without&nbsp;corresponding&nbsp;sources.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339750">AllowBinary</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1339764">//&nbsp;If&nbsp;ImportComment&nbsp;is&nbsp;set,&nbsp;parse&nbsp;import&nbsp;comments&nbsp;on&nbsp;package&nbsp;statements.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1339838">//&nbsp;Import&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;it&nbsp;finds&nbsp;a&nbsp;comment&nbsp;it&nbsp;cannot&nbsp;understand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1339909">//&nbsp;or&nbsp;finds&nbsp;conflicting&nbsp;comments&nbsp;in&nbsp;multiple&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1339969">//&nbsp;See&nbsp;golang.org/s/go14customimport&nbsp;for&nbsp;more&nbsp;information.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340029">ImportComment</span><br>
<span class="lineno">345</span><span class="op" id="1340043">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1340046">//&nbsp;A&nbsp;Package&nbsp;describes&nbsp;the&nbsp;Go&nbsp;package&nbsp;found&nbsp;in&nbsp;a&nbsp;directory.</span><br>
<span class="lineno"></span><span class="keyword" id="1340106">type</span>&nbsp;<span class="ident" id="1340111">Package</span>&nbsp;<span class="keyword" id="1340119">struct</span>&nbsp;<span class="op" id="1340126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340129">Dir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1340143">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1340152">//&nbsp;directory&nbsp;containing&nbsp;package&nbsp;sources</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340193">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1340207">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1340216">//&nbsp;package&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340233">ImportComment</span>&nbsp;<span class="builtintype" id="1340247">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1340256">//&nbsp;path&nbsp;in&nbsp;import&nbsp;comment&nbsp;on&nbsp;package&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340304">Doc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1340318">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1340327">//&nbsp;documentation&nbsp;synopsis</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340354">ImportPath</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1340368">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1340377">//&nbsp;import&nbsp;path&nbsp;of&nbsp;package&nbsp;(&#34;&#34;&nbsp;if&nbsp;unknown)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340420">Root</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1340434">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1340443">//&nbsp;root&nbsp;of&nbsp;Go&nbsp;tree&nbsp;where&nbsp;this&nbsp;package&nbsp;lives</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340488">SrcRoot</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1340502">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1340511">//&nbsp;package&nbsp;source&nbsp;root&nbsp;directory&nbsp;(&#34;&#34;&nbsp;if&nbsp;unknown)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340561">PkgRoot</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1340575">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1340584">//&nbsp;package&nbsp;install&nbsp;root&nbsp;directory&nbsp;(&#34;&#34;&nbsp;if&nbsp;unknown)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340635">BinDir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1340649">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1340658">//&nbsp;command&nbsp;install&nbsp;directory&nbsp;(&#34;&#34;&nbsp;if&nbsp;unknown)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340704">Goroot</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1340718">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1340727">//&nbsp;package&nbsp;found&nbsp;in&nbsp;Go&nbsp;root</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340756">PkgObj</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1340770">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1340779">//&nbsp;installed&nbsp;.a&nbsp;file</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340801">AllTags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1340815">[</span><span class="op" id="1340816">]</span><span class="builtintype" id="1340817">string</span>&nbsp;<span class="comment" id="1340824">//&nbsp;tags&nbsp;that&nbsp;can&nbsp;influence&nbsp;file&nbsp;selection&nbsp;in&nbsp;this&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340885">ConflictDir</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1340899">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1340908">//&nbsp;this&nbsp;directory&nbsp;shadows&nbsp;Dir&nbsp;in&nbsp;$GOPATH</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1340951">//&nbsp;Source&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340968">GoFiles</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1340983">[</span><span class="op" id="1340984">]</span><span class="builtintype" id="1340985">string</span>&nbsp;<span class="comment" id="1340992">//&nbsp;.go&nbsp;source&nbsp;files&nbsp;(excluding&nbsp;CgoFiles,&nbsp;TestGoFiles,&nbsp;XTestGoFiles)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341061">CgoFiles</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1341076">[</span><span class="op" id="1341077">]</span><span class="builtintype" id="1341078">string</span>&nbsp;<span class="comment" id="1341085">//&nbsp;.go&nbsp;source&nbsp;files&nbsp;that&nbsp;import&nbsp;&#34;C&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341122">IgnoredGoFiles</span>&nbsp;<span class="op" id="1341137">[</span><span class="op" id="1341138">]</span><span class="builtintype" id="1341139">string</span>&nbsp;<span class="comment" id="1341146">//&nbsp;.go&nbsp;source&nbsp;files&nbsp;ignored&nbsp;for&nbsp;this&nbsp;build</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341190">CFiles</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1341205">[</span><span class="op" id="1341206">]</span><span class="builtintype" id="1341207">string</span>&nbsp;<span class="comment" id="1341214">//&nbsp;.c&nbsp;source&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341234">CXXFiles</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1341249">[</span><span class="op" id="1341250">]</span><span class="builtintype" id="1341251">string</span>&nbsp;<span class="comment" id="1341258">//&nbsp;.cc,&nbsp;.cpp&nbsp;and&nbsp;.cxx&nbsp;source&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341294">MFiles</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1341309">[</span><span class="op" id="1341310">]</span><span class="builtintype" id="1341311">string</span>&nbsp;<span class="comment" id="1341318">//&nbsp;.m&nbsp;(Objective-C)&nbsp;source&nbsp;files</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341352">HFiles</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1341367">[</span><span class="op" id="1341368">]</span><span class="builtintype" id="1341369">string</span>&nbsp;<span class="comment" id="1341376">//&nbsp;.h,&nbsp;.hh,&nbsp;.hpp&nbsp;and&nbsp;.hxx&nbsp;source&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341416">SFiles</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1341431">[</span><span class="op" id="1341432">]</span><span class="builtintype" id="1341433">string</span>&nbsp;<span class="comment" id="1341440">//&nbsp;.s&nbsp;source&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341460">SwigFiles</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1341475">[</span><span class="op" id="1341476">]</span><span class="builtintype" id="1341477">string</span>&nbsp;<span class="comment" id="1341484">//&nbsp;.swig&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341500">SwigCXXFiles</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1341515">[</span><span class="op" id="1341516">]</span><span class="builtintype" id="1341517">string</span>&nbsp;<span class="comment" id="1341524">//&nbsp;.swigcxx&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341543">SysoFiles</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1341558">[</span><span class="op" id="1341559">]</span><span class="builtintype" id="1341560">string</span>&nbsp;<span class="comment" id="1341567">//&nbsp;.syso&nbsp;system&nbsp;object&nbsp;files&nbsp;to&nbsp;add&nbsp;to&nbsp;archive</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1341616">//&nbsp;Cgo&nbsp;directives</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341635">CgoCFLAGS</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1341648">[</span><span class="op" id="1341649">]</span><span class="builtintype" id="1341650">string</span>&nbsp;<span class="comment" id="1341657">//&nbsp;Cgo&nbsp;CFLAGS&nbsp;directives</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341683">CgoCPPFLAGS</span>&nbsp;&nbsp;<span class="op" id="1341696">[</span><span class="op" id="1341697">]</span><span class="builtintype" id="1341698">string</span>&nbsp;<span class="comment" id="1341705">//&nbsp;Cgo&nbsp;CPPFLAGS&nbsp;directives</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341733">CgoCXXFLAGS</span>&nbsp;&nbsp;<span class="op" id="1341746">[</span><span class="op" id="1341747">]</span><span class="builtintype" id="1341748">string</span>&nbsp;<span class="comment" id="1341755">//&nbsp;Cgo&nbsp;CXXFLAGS&nbsp;directives</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341783">CgoLDFLAGS</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1341796">[</span><span class="op" id="1341797">]</span><span class="builtintype" id="1341798">string</span>&nbsp;<span class="comment" id="1341805">//&nbsp;Cgo&nbsp;LDFLAGS&nbsp;directives</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341832">CgoPkgConfig</span>&nbsp;<span class="op" id="1341845">[</span><span class="op" id="1341846">]</span><span class="builtintype" id="1341847">string</span>&nbsp;<span class="comment" id="1341854">//&nbsp;Cgo&nbsp;pkg-config&nbsp;directives</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1341885">//&nbsp;Dependency&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341912">Imports</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1341922">[</span><span class="op" id="1341923">]</span><span class="builtintype" id="1341924">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1341950">//&nbsp;imports&nbsp;from&nbsp;GoFiles,&nbsp;CgoFiles</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341985">ImportPos</span>&nbsp;<span class="keyword" id="1341995">map</span><span class="op" id="1341998">[</span><span class="builtintype" id="1341999">string</span><span class="op" id="1342005">]</span><span class="op" id="1342006">[</span><span class="op" id="1342007">]</span><span class="ident" id="1342008">token</span><span class="op" id="1342013">.</span><span class="ident" id="1342014">Position</span>&nbsp;<span class="comment" id="1342023">//&nbsp;line&nbsp;information&nbsp;for&nbsp;Imports</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1342057">//&nbsp;Test&nbsp;information</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1342078">TestGoFiles</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1342093">[</span><span class="op" id="1342094">]</span><span class="builtintype" id="1342095">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1342121">//&nbsp;_test.go&nbsp;files&nbsp;in&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1342151">TestImports</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1342166">[</span><span class="op" id="1342167">]</span><span class="builtintype" id="1342168">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1342194">//&nbsp;imports&nbsp;from&nbsp;TestGoFiles</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1342223">TestImportPos</span>&nbsp;&nbsp;<span class="keyword" id="1342238">map</span><span class="op" id="1342241">[</span><span class="builtintype" id="1342242">string</span><span class="op" id="1342248">]</span><span class="op" id="1342249">[</span><span class="op" id="1342250">]</span><span class="ident" id="1342251">token</span><span class="op" id="1342256">.</span><span class="ident" id="1342257">Position</span>&nbsp;<span class="comment" id="1342266">//&nbsp;line&nbsp;information&nbsp;for&nbsp;TestImports</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1342303">XTestGoFiles</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1342318">[</span><span class="op" id="1342319">]</span><span class="builtintype" id="1342320">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1342346">//&nbsp;_test.go&nbsp;files&nbsp;outside&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1342381">XTestImports</span>&nbsp;&nbsp;&nbsp;<span class="op" id="1342396">[</span><span class="op" id="1342397">]</span><span class="builtintype" id="1342398">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1342424">//&nbsp;imports&nbsp;from&nbsp;XTestGoFiles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1342454">XTestImportPos</span>&nbsp;<span class="keyword" id="1342469">map</span><span class="op" id="1342472">[</span><span class="builtintype" id="1342473">string</span><span class="op" id="1342479">]</span><span class="op" id="1342480">[</span><span class="op" id="1342481">]</span><span class="ident" id="1342482">token</span><span class="op" id="1342487">.</span><span class="ident" id="1342488">Position</span>&nbsp;<span class="comment" id="1342497">//&nbsp;line&nbsp;information&nbsp;for&nbsp;XTestImports</span><br>
<span class="lineno"></span><span class="op" id="1342534">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="comment" id="1342537">//&nbsp;IsCommand&nbsp;reports&nbsp;whether&nbsp;the&nbsp;package&nbsp;is&nbsp;considered&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1342594">//&nbsp;command&nbsp;to&nbsp;be&nbsp;installed&nbsp;(not&nbsp;just&nbsp;a&nbsp;library).</span><br>
<span class="lineno"></span><span class="comment" id="1342643">//&nbsp;Packages&nbsp;named&nbsp;&#34;main&#34;&nbsp;are&nbsp;treated&nbsp;as&nbsp;commands.</span><br>
<span class="lineno"></span><span class="keyword" id="1342693">func</span>&nbsp;<span class="op" id="1342698">(</span><span class="ident" id="1342699">p</span>&nbsp;<span class="op" id="1342701">*</span><span class="ident" id="1342702">Package</span><span class="op" id="1342709">)</span>&nbsp;<span class="ident" id="1342711">IsCommand</span><span class="op" id="1342720">(</span><span class="op" id="1342721">)</span>&nbsp;<span class="builtintype" id="1342723">bool</span>&nbsp;<span class="op" id="1342728">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1342731">return</span>&nbsp;<span class="ident" id="1342738">p</span><span class="op" id="1342739">.</span><span class="ident" id="1342740">Name</span>&nbsp;<span class="op" id="1342745">==</span>&nbsp;<span class="string" id="1342748">&#34;main&#34;</span><br>
<span class="lineno"></span><span class="op" id="1342755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1342758">//&nbsp;ImportDir&nbsp;is&nbsp;like&nbsp;Import&nbsp;but&nbsp;processes&nbsp;the&nbsp;Go&nbsp;package&nbsp;found&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1342824">//&nbsp;the&nbsp;named&nbsp;directory.</span><br>
<span class="lineno">405</span><span class="keyword" id="1342848">func</span>&nbsp;<span class="op" id="1342853">(</span><span class="ident" id="1342854">ctxt</span>&nbsp;<span class="op" id="1342859">*</span><span class="ident" id="1342860">Context</span><span class="op" id="1342867">)</span>&nbsp;<span class="ident" id="1342869">ImportDir</span><span class="op" id="1342878">(</span><span class="ident" id="1342879">dir</span>&nbsp;<span class="builtintype" id="1342883">string</span><span class="op" id="1342889">,</span>&nbsp;<span class="ident" id="1342891">mode</span>&nbsp;<span class="ident" id="1342896">ImportMode</span><span class="op" id="1342906">)</span>&nbsp;<span class="op" id="1342908">(</span><span class="op" id="1342909">*</span><span class="ident" id="1342910">Package</span><span class="op" id="1342917">,</span>&nbsp;<span class="builtintype" id="1342919">error</span><span class="op" id="1342924">)</span>&nbsp;<span class="op" id="1342926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1342929">return</span>&nbsp;<span class="ident" id="1342936">ctxt</span><span class="op" id="1342940">.</span><span class="ident" id="1342941">Import</span><span class="op" id="1342947">(</span><span class="string" id="1342948">&#34;.&#34;</span><span class="op" id="1342951">,</span>&nbsp;<span class="ident" id="1342953">dir</span><span class="op" id="1342956">,</span>&nbsp;<span class="ident" id="1342958">mode</span><span class="op" id="1342962">)</span><br>
<span class="lineno"></span><span class="op" id="1342964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1342967">//&nbsp;NoGoError&nbsp;is&nbsp;the&nbsp;error&nbsp;used&nbsp;by&nbsp;Import&nbsp;to&nbsp;describe&nbsp;a&nbsp;directory</span><br>
<span class="lineno">410</span><span class="comment" id="1343032">//&nbsp;containing&nbsp;no&nbsp;buildable&nbsp;Go&nbsp;source&nbsp;files.&nbsp;(It&nbsp;may&nbsp;still&nbsp;contain</span><br>
<span class="lineno"></span><span class="comment" id="1343098">//&nbsp;test&nbsp;files,&nbsp;files&nbsp;hidden&nbsp;by&nbsp;build&nbsp;tags,&nbsp;and&nbsp;so&nbsp;on.)</span><br>
<span class="lineno"></span><span class="keyword" id="1343153">type</span>&nbsp;<span class="ident" id="1343158">NoGoError</span>&nbsp;<span class="keyword" id="1343168">struct</span>&nbsp;<span class="op" id="1343175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1343178">Dir</span>&nbsp;<span class="builtintype" id="1343182">string</span><br>
<span class="lineno"></span><span class="op" id="1343189">}</span><br>
<span class="lineno">415</span><br>
<span class="lineno"></span><span class="keyword" id="1343192">func</span>&nbsp;<span class="op" id="1343197">(</span><span class="ident" id="1343198">e</span>&nbsp;<span class="op" id="1343200">*</span><span class="ident" id="1343201">NoGoError</span><span class="op" id="1343210">)</span>&nbsp;<span class="ident" id="1343212">Error</span><span class="op" id="1343217">(</span><span class="op" id="1343218">)</span>&nbsp;<span class="builtintype" id="1343220">string</span>&nbsp;<span class="op" id="1343227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343230">return</span>&nbsp;<span class="string" id="1343237">&#34;no&nbsp;buildable&nbsp;Go&nbsp;source&nbsp;files&nbsp;in&nbsp;&#34;</span>&nbsp;<span class="op" id="1343272">+</span>&nbsp;<span class="ident" id="1343274">e</span><span class="op" id="1343275">.</span><span class="ident" id="1343276">Dir</span><br>
<span class="lineno"></span><span class="op" id="1343280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="comment" id="1343283">//&nbsp;MultiplePackageError&nbsp;describes&nbsp;a&nbsp;directory&nbsp;containing</span><br>
<span class="lineno"></span><span class="comment" id="1343340">//&nbsp;multiple&nbsp;buildable&nbsp;Go&nbsp;source&nbsp;files&nbsp;for&nbsp;multiple&nbsp;packages.</span><br>
<span class="lineno"></span><span class="keyword" id="1343401">type</span>&nbsp;<span class="ident" id="1343406">MultiplePackageError</span>&nbsp;<span class="keyword" id="1343427">struct</span>&nbsp;<span class="op" id="1343434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1343437">Dir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1343446">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="1343455">//&nbsp;directory&nbsp;containing&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1343486">Packages</span>&nbsp;<span class="op" id="1343495">[</span><span class="op" id="1343496">]</span><span class="builtintype" id="1343497">string</span>&nbsp;<span class="comment" id="1343504">//&nbsp;package&nbsp;names&nbsp;found</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1343528">Files</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1343537">[</span><span class="op" id="1343538">]</span><span class="builtintype" id="1343539">string</span>&nbsp;<span class="comment" id="1343546">//&nbsp;corresponding&nbsp;files:&nbsp;Files[i]&nbsp;declares&nbsp;package&nbsp;Packages[i]</span><br>
<span class="lineno"></span><span class="op" id="1343608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1343611">func</span>&nbsp;<span class="op" id="1343616">(</span><span class="ident" id="1343617">e</span>&nbsp;<span class="op" id="1343619">*</span><span class="ident" id="1343620">MultiplePackageError</span><span class="op" id="1343640">)</span>&nbsp;<span class="ident" id="1343642">Error</span><span class="op" id="1343647">(</span><span class="op" id="1343648">)</span>&nbsp;<span class="builtintype" id="1343650">string</span>&nbsp;<span class="op" id="1343657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1343660">//&nbsp;Error&nbsp;string&nbsp;limited&nbsp;to&nbsp;two&nbsp;entries&nbsp;for&nbsp;compatibility.</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343719">return</span>&nbsp;<span class="ident" id="1343726">fmt</span><span class="op" id="1343729">.</span><span class="ident" id="1343730">Sprintf</span><span class="op" id="1343737">(</span><span class="string" id="1343738">&#34;found&nbsp;packages&nbsp;%s&nbsp;(%s)&nbsp;and&nbsp;%s&nbsp;(%s)&nbsp;in&nbsp;%s&#34;</span><span class="op" id="1343780">,</span>&nbsp;<span class="ident" id="1343782">e</span><span class="op" id="1343783">.</span><span class="ident" id="1343784">Packages</span><span class="op" id="1343792">[</span><span class="num" id="1343793">0</span><span class="op" id="1343794">]</span><span class="op" id="1343795">,</span>&nbsp;<span class="ident" id="1343797">e</span><span class="op" id="1343798">.</span><span class="ident" id="1343799">Files</span><span class="op" id="1343804">[</span><span class="num" id="1343805">0</span><span class="op" id="1343806">]</span><span class="op" id="1343807">,</span>&nbsp;<span class="ident" id="1343809">e</span><span class="op" id="1343810">.</span><span class="ident" id="1343811">Packages</span><span class="op" id="1343819">[</span><span class="num" id="1343820">1</span><span class="op" id="1343821">]</span><span class="op" id="1343822">,</span>&nbsp;<span class="ident" id="1343824">e</span><span class="op" id="1343825">.</span><span class="ident" id="1343826">Files</span><span class="op" id="1343831">[</span><span class="num" id="1343832">1</span><span class="op" id="1343833">]</span><span class="op" id="1343834">,</span>&nbsp;<span class="ident" id="1343836">e</span><span class="op" id="1343837">.</span><span class="ident" id="1343838">Dir</span><span class="op" id="1343841">)</span><br>
<span class="lineno"></span><span class="op" id="1343843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1343846">func</span>&nbsp;<span class="ident" id="1343851">nameExt</span><span class="op" id="1343858">(</span><span class="ident" id="1343859">name</span>&nbsp;<span class="builtintype" id="1343864">string</span><span class="op" id="1343870">)</span>&nbsp;<span class="builtintype" id="1343872">string</span>&nbsp;<span class="op" id="1343879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1343882">i</span>&nbsp;<span class="op" id="1343884">:=</span>&nbsp;<span class="ident" id="1343887">strings</span><span class="op" id="1343894">.</span><span class="ident" id="1343895">LastIndex</span><span class="op" id="1343904">(</span><span class="ident" id="1343905">name</span><span class="op" id="1343909">,</span>&nbsp;<span class="string" id="1343911">&#34;.&#34;</span><span class="op" id="1343914">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343917">if</span>&nbsp;<span class="ident" id="1343920">i</span>&nbsp;<span class="op" id="1343922">&lt;</span>&nbsp;<span class="num" id="1343924">0</span>&nbsp;<span class="op" id="1343926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343930">return</span>&nbsp;<span class="string" id="1343937">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1343941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343944">return</span>&nbsp;<span class="ident" id="1343951">name</span><span class="op" id="1343955">[</span><span class="ident" id="1343956">i</span><span class="op" id="1343957">:</span><span class="op" id="1343958">]</span><br>
<span class="lineno"></span><span class="op" id="1343960">}</span><br>
<span class="lineno">440</span><br>
<span class="lineno"></span><span class="comment" id="1343963">//&nbsp;Import&nbsp;returns&nbsp;details&nbsp;about&nbsp;the&nbsp;Go&nbsp;package&nbsp;named&nbsp;by&nbsp;the&nbsp;import&nbsp;path,</span><br>
<span class="lineno"></span><span class="comment" id="1344036">//&nbsp;interpreting&nbsp;local&nbsp;import&nbsp;paths&nbsp;relative&nbsp;to&nbsp;the&nbsp;srcDir&nbsp;directory.</span><br>
<span class="lineno"></span><span class="comment" id="1344105">//&nbsp;If&nbsp;the&nbsp;path&nbsp;is&nbsp;a&nbsp;local&nbsp;import&nbsp;path&nbsp;naming&nbsp;a&nbsp;package&nbsp;that&nbsp;can&nbsp;be&nbsp;imported</span><br>
<span class="lineno"></span><span class="comment" id="1344181">//&nbsp;using&nbsp;a&nbsp;standard&nbsp;import&nbsp;path,&nbsp;the&nbsp;returned&nbsp;package&nbsp;will&nbsp;set&nbsp;p.ImportPath</span><br>
<span class="lineno">445</span><span class="comment" id="1344257">//&nbsp;to&nbsp;that&nbsp;path.</span><br>
<span class="lineno"></span><span class="comment" id="1344274">//</span><br>
<span class="lineno"></span><span class="comment" id="1344277">//&nbsp;In&nbsp;the&nbsp;directory&nbsp;containing&nbsp;the&nbsp;package,&nbsp;.go,&nbsp;.c,&nbsp;.h,&nbsp;and&nbsp;.s&nbsp;files&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="1344351">//&nbsp;considered&nbsp;part&nbsp;of&nbsp;the&nbsp;package&nbsp;except&nbsp;for:</span><br>
<span class="lineno"></span><span class="comment" id="1344397">//</span><br>
<span class="lineno">450</span><span class="comment" id="1344400">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;.go&nbsp;files&nbsp;in&nbsp;package&nbsp;documentation</span><br>
<span class="lineno"></span><span class="comment" id="1344440">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;files&nbsp;starting&nbsp;with&nbsp;_&nbsp;or&nbsp;.&nbsp;(likely&nbsp;editor&nbsp;temporary&nbsp;files)</span><br>
<span class="lineno"></span><span class="comment" id="1344504">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;files&nbsp;with&nbsp;build&nbsp;constraints&nbsp;not&nbsp;satisfied&nbsp;by&nbsp;the&nbsp;context</span><br>
<span class="lineno"></span><span class="comment" id="1344567">//</span><br>
<span class="lineno"></span><span class="comment" id="1344570">//&nbsp;If&nbsp;an&nbsp;error&nbsp;occurs,&nbsp;Import&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error&nbsp;and&nbsp;a&nbsp;non-nil</span><br>
<span class="lineno">455</span><span class="comment" id="1344638">//&nbsp;*Package&nbsp;containing&nbsp;partial&nbsp;information.</span><br>
<span class="lineno"></span><span class="comment" id="1344682">//</span><br>
<span class="lineno"></span><span class="keyword" id="1344685">func</span>&nbsp;<span class="op" id="1344690">(</span><span class="ident" id="1344691">ctxt</span>&nbsp;<span class="op" id="1344696">*</span><span class="ident" id="1344697">Context</span><span class="op" id="1344704">)</span>&nbsp;<span class="ident" id="1344706">Import</span><span class="op" id="1344712">(</span><span class="ident" id="1344713">path</span>&nbsp;<span class="builtintype" id="1344718">string</span><span class="op" id="1344724">,</span>&nbsp;<span class="ident" id="1344726">srcDir</span>&nbsp;<span class="builtintype" id="1344733">string</span><span class="op" id="1344739">,</span>&nbsp;<span class="ident" id="1344741">mode</span>&nbsp;<span class="ident" id="1344746">ImportMode</span><span class="op" id="1344756">)</span>&nbsp;<span class="op" id="1344758">(</span><span class="op" id="1344759">*</span><span class="ident" id="1344760">Package</span><span class="op" id="1344767">,</span>&nbsp;<span class="builtintype" id="1344769">error</span><span class="op" id="1344774">)</span>&nbsp;<span class="op" id="1344776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344779">p</span>&nbsp;<span class="op" id="1344781">:=</span>&nbsp;<span class="op" id="1344784">&amp;</span><span class="ident" id="1344785">Package</span><span class="op" id="1344792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344796">ImportPath</span><span class="op" id="1344806">:</span>&nbsp;<span class="ident" id="1344808">path</span><span class="op" id="1344812">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1344815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344818">if</span>&nbsp;<span class="ident" id="1344821">path</span>&nbsp;<span class="op" id="1344826">==</span>&nbsp;<span class="string" id="1344829">&#34;&#34;</span>&nbsp;<span class="op" id="1344832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344836">return</span>&nbsp;<span class="ident" id="1344843">p</span><span class="op" id="1344844">,</span>&nbsp;<span class="ident" id="1344846">fmt</span><span class="op" id="1344849">.</span><span class="ident" id="1344850">Errorf</span><span class="op" id="1344856">(</span><span class="string" id="1344857">&#34;import&nbsp;%q:&nbsp;invalid&nbsp;import&nbsp;path&#34;</span><span class="op" id="1344889">,</span>&nbsp;<span class="ident" id="1344891">path</span><span class="op" id="1344895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1344898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344902">var</span>&nbsp;<span class="ident" id="1344906">pkga</span>&nbsp;<span class="builtintype" id="1344911">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344919">var</span>&nbsp;<span class="ident" id="1344923">pkgerr</span>&nbsp;<span class="builtintype" id="1344930">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344937">switch</span>&nbsp;<span class="ident" id="1344944">ctxt</span><span class="op" id="1344948">.</span><span class="ident" id="1344949">Compiler</span>&nbsp;<span class="op" id="1344958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344961">case</span>&nbsp;<span class="string" id="1344966">&#34;gccgo&#34;</span><span class="op" id="1344973">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344977">dir</span><span class="op" id="1344980">,</span>&nbsp;<span class="ident" id="1344982">elem</span>&nbsp;<span class="op" id="1344987">:=</span>&nbsp;<span class="ident" id="1344990">pathpkg</span><span class="op" id="1344997">.</span><span class="ident" id="1344998">Split</span><span class="op" id="1345003">(</span><span class="ident" id="1345004">p</span><span class="op" id="1345005">.</span><span class="ident" id="1345006">ImportPath</span><span class="op" id="1345016">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345020">pkga</span>&nbsp;<span class="op" id="1345025">=</span>&nbsp;<span class="string" id="1345027">&#34;pkg/gccgo_&#34;</span>&nbsp;<span class="op" id="1345040">+</span>&nbsp;<span class="ident" id="1345042">ctxt</span><span class="op" id="1345046">.</span><span class="ident" id="1345047">GOOS</span>&nbsp;<span class="op" id="1345052">+</span>&nbsp;<span class="string" id="1345054">&#34;_&#34;</span>&nbsp;<span class="op" id="1345058">+</span>&nbsp;<span class="ident" id="1345060">ctxt</span><span class="op" id="1345064">.</span><span class="ident" id="1345065">GOARCH</span>&nbsp;<span class="op" id="1345072">+</span>&nbsp;<span class="string" id="1345074">&#34;/&#34;</span>&nbsp;<span class="op" id="1345078">+</span>&nbsp;<span class="ident" id="1345080">dir</span>&nbsp;<span class="op" id="1345084">+</span>&nbsp;<span class="string" id="1345086">&#34;lib&#34;</span>&nbsp;<span class="op" id="1345092">+</span>&nbsp;<span class="ident" id="1345094">elem</span>&nbsp;<span class="op" id="1345099">+</span>&nbsp;<span class="string" id="1345101">&#34;.a&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345107">case</span>&nbsp;<span class="string" id="1345112">&#34;gc&#34;</span><span class="op" id="1345116">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345120">suffix</span>&nbsp;<span class="op" id="1345127">:=</span>&nbsp;<span class="string" id="1345130">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345135">if</span>&nbsp;<span class="ident" id="1345138">ctxt</span><span class="op" id="1345142">.</span><span class="ident" id="1345143">InstallSuffix</span>&nbsp;<span class="op" id="1345157">!=</span>&nbsp;<span class="string" id="1345160">&#34;&#34;</span>&nbsp;<span class="op" id="1345163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345168">suffix</span>&nbsp;<span class="op" id="1345175">=</span>&nbsp;<span class="string" id="1345177">&#34;_&#34;</span>&nbsp;<span class="op" id="1345181">+</span>&nbsp;<span class="ident" id="1345183">ctxt</span><span class="op" id="1345187">.</span><span class="ident" id="1345188">InstallSuffix</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1345204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345208">pkga</span>&nbsp;<span class="op" id="1345213">=</span>&nbsp;<span class="string" id="1345215">&#34;pkg/&#34;</span>&nbsp;<span class="op" id="1345222">+</span>&nbsp;<span class="ident" id="1345224">ctxt</span><span class="op" id="1345228">.</span><span class="ident" id="1345229">GOOS</span>&nbsp;<span class="op" id="1345234">+</span>&nbsp;<span class="string" id="1345236">&#34;_&#34;</span>&nbsp;<span class="op" id="1345240">+</span>&nbsp;<span class="ident" id="1345242">ctxt</span><span class="op" id="1345246">.</span><span class="ident" id="1345247">GOARCH</span>&nbsp;<span class="op" id="1345254">+</span>&nbsp;<span class="ident" id="1345256">suffix</span>&nbsp;<span class="op" id="1345263">+</span>&nbsp;<span class="string" id="1345265">&#34;/&#34;</span>&nbsp;<span class="op" id="1345269">+</span>&nbsp;<span class="ident" id="1345271">p</span><span class="op" id="1345272">.</span><span class="ident" id="1345273">ImportPath</span>&nbsp;<span class="op" id="1345284">+</span>&nbsp;<span class="string" id="1345286">&#34;.a&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345292">default</span><span class="op" id="1345299">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1345303">//&nbsp;Save&nbsp;error&nbsp;for&nbsp;end&nbsp;of&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345340">pkgerr</span>&nbsp;<span class="op" id="1345347">=</span>&nbsp;<span class="ident" id="1345349">fmt</span><span class="op" id="1345352">.</span><span class="ident" id="1345353">Errorf</span><span class="op" id="1345359">(</span><span class="string" id="1345360">&#34;import&nbsp;%q:&nbsp;unknown&nbsp;compiler&nbsp;%q&#34;</span><span class="op" id="1345392">,</span>&nbsp;<span class="ident" id="1345394">path</span><span class="op" id="1345398">,</span>&nbsp;<span class="ident" id="1345400">ctxt</span><span class="op" id="1345404">.</span><span class="ident" id="1345405">Compiler</span><span class="op" id="1345413">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1345416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345420">binaryOnly</span>&nbsp;<span class="op" id="1345431">:=</span>&nbsp;<span class="builtintype" id="1345434">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345441">if</span>&nbsp;<span class="ident" id="1345444">IsLocalImport</span><span class="op" id="1345457">(</span><span class="ident" id="1345458">path</span><span class="op" id="1345462">)</span>&nbsp;<span class="op" id="1345464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345468">pkga</span>&nbsp;<span class="op" id="1345473">=</span>&nbsp;<span class="string" id="1345475">&#34;&#34;</span>&nbsp;<span class="comment" id="1345478">//&nbsp;local&nbsp;imports&nbsp;have&nbsp;no&nbsp;installed&nbsp;path</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345520">if</span>&nbsp;<span class="ident" id="1345523">srcDir</span>&nbsp;<span class="op" id="1345530">==</span>&nbsp;<span class="string" id="1345533">&#34;&#34;</span>&nbsp;<span class="op" id="1345536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345541">return</span>&nbsp;<span class="ident" id="1345548">p</span><span class="op" id="1345549">,</span>&nbsp;<span class="ident" id="1345551">fmt</span><span class="op" id="1345554">.</span><span class="ident" id="1345555">Errorf</span><span class="op" id="1345561">(</span><span class="string" id="1345562">&#34;import&nbsp;%q:&nbsp;import&nbsp;relative&nbsp;to&nbsp;unknown&nbsp;directory&#34;</span><span class="op" id="1345611">,</span>&nbsp;<span class="ident" id="1345613">path</span><span class="op" id="1345617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1345621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345625">if</span>&nbsp;<span class="op" id="1345628">!</span><span class="ident" id="1345629">ctxt</span><span class="op" id="1345633">.</span><span class="ident" id="1345634">isAbsPath</span><span class="op" id="1345643">(</span><span class="ident" id="1345644">path</span><span class="op" id="1345648">)</span>&nbsp;<span class="op" id="1345650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345655">p</span><span class="op" id="1345656">.</span><span class="ident" id="1345657">Dir</span>&nbsp;<span class="op" id="1345661">=</span>&nbsp;<span class="ident" id="1345663">ctxt</span><span class="op" id="1345667">.</span><span class="ident" id="1345668">joinPath</span><span class="op" id="1345676">(</span><span class="ident" id="1345677">srcDir</span><span class="op" id="1345683">,</span>&nbsp;<span class="ident" id="1345685">path</span><span class="op" id="1345689">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1345693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1345697">//&nbsp;Determine&nbsp;canonical&nbsp;import&nbsp;path,&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345743">if</span>&nbsp;<span class="ident" id="1345746">ctxt</span><span class="op" id="1345750">.</span><span class="ident" id="1345751">GOROOT</span>&nbsp;<span class="op" id="1345758">!=</span>&nbsp;<span class="string" id="1345761">&#34;&#34;</span>&nbsp;<span class="op" id="1345764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345769">root</span>&nbsp;<span class="op" id="1345774">:=</span>&nbsp;<span class="ident" id="1345777">ctxt</span><span class="op" id="1345781">.</span><span class="ident" id="1345782">joinPath</span><span class="op" id="1345790">(</span><span class="ident" id="1345791">ctxt</span><span class="op" id="1345795">.</span><span class="ident" id="1345796">GOROOT</span><span class="op" id="1345802">,</span>&nbsp;<span class="string" id="1345804">&#34;src&#34;</span><span class="op" id="1345809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345814">if</span>&nbsp;<span class="ident" id="1345817">sub</span><span class="op" id="1345820">,</span>&nbsp;<span class="ident" id="1345822">ok</span>&nbsp;<span class="op" id="1345825">:=</span>&nbsp;<span class="ident" id="1345828">ctxt</span><span class="op" id="1345832">.</span><span class="ident" id="1345833">hasSubdir</span><span class="op" id="1345842">(</span><span class="ident" id="1345843">root</span><span class="op" id="1345847">,</span>&nbsp;<span class="ident" id="1345849">p</span><span class="op" id="1345850">.</span><span class="ident" id="1345851">Dir</span><span class="op" id="1345854">)</span><span class="op" id="1345855">;</span>&nbsp;<span class="ident" id="1345857">ok</span>&nbsp;<span class="op" id="1345860">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345866">p</span><span class="op" id="1345867">.</span><span class="ident" id="1345868">Goroot</span>&nbsp;<span class="op" id="1345875">=</span>&nbsp;<span class="builtintype" id="1345877">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345886">p</span><span class="op" id="1345887">.</span><span class="ident" id="1345888">ImportPath</span>&nbsp;<span class="op" id="1345899">=</span>&nbsp;<span class="ident" id="1345901">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345909">p</span><span class="op" id="1345910">.</span><span class="ident" id="1345911">Root</span>&nbsp;<span class="op" id="1345916">=</span>&nbsp;<span class="ident" id="1345918">ctxt</span><span class="op" id="1345922">.</span><span class="ident" id="1345923">GOROOT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345934">goto</span>&nbsp;<span class="ident" id="1345939">Found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1345948">}</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1345952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345956">all</span>&nbsp;<span class="op" id="1345960">:=</span>&nbsp;<span class="ident" id="1345963">ctxt</span><span class="op" id="1345967">.</span><span class="ident" id="1345968">gopath</span><span class="op" id="1345974">(</span><span class="op" id="1345975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345979">for</span>&nbsp;<span class="ident" id="1345983">i</span><span class="op" id="1345984">,</span>&nbsp;<span class="ident" id="1345986">root</span>&nbsp;<span class="op" id="1345991">:=</span>&nbsp;<span class="keyword" id="1345994">range</span>&nbsp;<span class="ident" id="1346000">all</span>&nbsp;<span class="op" id="1346004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1346009">rootsrc</span>&nbsp;<span class="op" id="1346017">:=</span>&nbsp;<span class="ident" id="1346020">ctxt</span><span class="op" id="1346024">.</span><span class="ident" id="1346025">joinPath</span><span class="op" id="1346033">(</span><span class="ident" id="1346034">root</span><span class="op" id="1346038">,</span>&nbsp;<span class="string" id="1346040">&#34;src&#34;</span><span class="op" id="1346045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346050">if</span>&nbsp;<span class="ident" id="1346053">sub</span><span class="op" id="1346056">,</span>&nbsp;<span class="ident" id="1346058">ok</span>&nbsp;<span class="op" id="1346061">:=</span>&nbsp;<span class="ident" id="1346064">ctxt</span><span class="op" id="1346068">.</span><span class="ident" id="1346069">hasSubdir</span><span class="op" id="1346078">(</span><span class="ident" id="1346079">rootsrc</span><span class="op" id="1346086">,</span>&nbsp;<span class="ident" id="1346088">p</span><span class="op" id="1346089">.</span><span class="ident" id="1346090">Dir</span><span class="op" id="1346093">)</span><span class="op" id="1346094">;</span>&nbsp;<span class="ident" id="1346096">ok</span>&nbsp;<span class="op" id="1346099">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1346105">//&nbsp;We&nbsp;found&nbsp;a&nbsp;potential&nbsp;import&nbsp;path&nbsp;for&nbsp;dir,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1346154">//&nbsp;but&nbsp;check&nbsp;that&nbsp;using&nbsp;it&nbsp;wouldn&#39;t&nbsp;find&nbsp;something</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1346209">//&nbsp;else&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346228">if</span>&nbsp;<span class="ident" id="1346231">ctxt</span><span class="op" id="1346235">.</span><span class="ident" id="1346236">GOROOT</span>&nbsp;<span class="op" id="1346243">!=</span>&nbsp;<span class="string" id="1346246">&#34;&#34;</span>&nbsp;<span class="op" id="1346249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346256">if</span>&nbsp;<span class="ident" id="1346259">dir</span>&nbsp;<span class="op" id="1346263">:=</span>&nbsp;<span class="ident" id="1346266">ctxt</span><span class="op" id="1346270">.</span><span class="ident" id="1346271">joinPath</span><span class="op" id="1346279">(</span><span class="ident" id="1346280">ctxt</span><span class="op" id="1346284">.</span><span class="ident" id="1346285">GOROOT</span><span class="op" id="1346291">,</span>&nbsp;<span class="string" id="1346293">&#34;src&#34;</span><span class="op" id="1346298">,</span>&nbsp;<span class="ident" id="1346300">sub</span><span class="op" id="1346303">)</span><span class="op" id="1346304">;</span>&nbsp;<span class="ident" id="1346306">ctxt</span><span class="op" id="1346310">.</span><span class="ident" id="1346311">isDir</span><span class="op" id="1346316">(</span><span class="ident" id="1346317">dir</span><span class="op" id="1346320">)</span>&nbsp;<span class="op" id="1346322">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1346330">p</span><span class="op" id="1346331">.</span><span class="ident" id="1346332">ConflictDir</span>&nbsp;<span class="op" id="1346344">=</span>&nbsp;<span class="ident" id="1346346">dir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346356">goto</span>&nbsp;<span class="ident" id="1346361">Found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1346372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1346378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346384">for</span>&nbsp;<span class="ident" id="1346388">_</span><span class="op" id="1346389">,</span>&nbsp;<span class="ident" id="1346391">earlyRoot</span>&nbsp;<span class="op" id="1346401">:=</span>&nbsp;<span class="keyword" id="1346404">range</span>&nbsp;<span class="ident" id="1346410">all</span><span class="op" id="1346413">[</span><span class="op" id="1346414">:</span><span class="ident" id="1346415">i</span><span class="op" id="1346416">]</span>&nbsp;<span class="op" id="1346418">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346425">if</span>&nbsp;<span class="ident" id="1346428">dir</span>&nbsp;<span class="op" id="1346432">:=</span>&nbsp;<span class="ident" id="1346435">ctxt</span><span class="op" id="1346439">.</span><span class="ident" id="1346440">joinPath</span><span class="op" id="1346448">(</span><span class="ident" id="1346449">earlyRoot</span><span class="op" id="1346458">,</span>&nbsp;<span class="string" id="1346460">&#34;src&#34;</span><span class="op" id="1346465">,</span>&nbsp;<span class="ident" id="1346467">sub</span><span class="op" id="1346470">)</span><span class="op" id="1346471">;</span>&nbsp;<span class="ident" id="1346473">ctxt</span><span class="op" id="1346477">.</span><span class="ident" id="1346478">isDir</span><span class="op" id="1346483">(</span><span class="ident" id="1346484">dir</span><span class="op" id="1346487">)</span>&nbsp;<span class="op" id="1346489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1346497">p</span><span class="op" id="1346498">.</span><span class="ident" id="1346499">ConflictDir</span>&nbsp;<span class="op" id="1346511">=</span>&nbsp;<span class="ident" id="1346513">dir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346523">goto</span>&nbsp;<span class="ident" id="1346528">Found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1346539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1346545">}</span><br>
<span class="lineno">520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1346552">//&nbsp;sub&nbsp;would&nbsp;not&nbsp;name&nbsp;some&nbsp;other&nbsp;directory&nbsp;instead&nbsp;of&nbsp;this&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1346620">//&nbsp;Record&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1346638">p</span><span class="op" id="1346639">.</span><span class="ident" id="1346640">ImportPath</span>&nbsp;<span class="op" id="1346651">=</span>&nbsp;<span class="ident" id="1346653">sub</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1346661">p</span><span class="op" id="1346662">.</span><span class="ident" id="1346663">Root</span>&nbsp;<span class="op" id="1346668">=</span>&nbsp;<span class="ident" id="1346670">root</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346679">goto</span>&nbsp;<span class="ident" id="1346684">Found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1346693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1346697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1346701">//&nbsp;It&#39;s&nbsp;okay&nbsp;that&nbsp;we&nbsp;didn&#39;t&nbsp;find&nbsp;a&nbsp;root&nbsp;containing&nbsp;dir.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1346759">//&nbsp;Keep&nbsp;going&nbsp;with&nbsp;the&nbsp;information&nbsp;we&nbsp;have.</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1346804">}</span>&nbsp;<span class="keyword" id="1346806">else</span>&nbsp;<span class="op" id="1346811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346815">if</span>&nbsp;<span class="ident" id="1346818">strings</span><span class="op" id="1346825">.</span><span class="ident" id="1346826">HasPrefix</span><span class="op" id="1346835">(</span><span class="ident" id="1346836">path</span><span class="op" id="1346840">,</span>&nbsp;<span class="string" id="1346842">&#34;/&#34;</span><span class="op" id="1346845">)</span>&nbsp;<span class="op" id="1346847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346852">return</span>&nbsp;<span class="ident" id="1346859">p</span><span class="op" id="1346860">,</span>&nbsp;<span class="ident" id="1346862">fmt</span><span class="op" id="1346865">.</span><span class="ident" id="1346866">Errorf</span><span class="op" id="1346872">(</span><span class="string" id="1346873">&#34;import&nbsp;%q:&nbsp;cannot&nbsp;import&nbsp;absolute&nbsp;path&#34;</span><span class="op" id="1346913">,</span>&nbsp;<span class="ident" id="1346915">path</span><span class="op" id="1346919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1346923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1346928">//&nbsp;tried&nbsp;records&nbsp;the&nbsp;location&nbsp;of&nbsp;unsuccessful&nbsp;package&nbsp;lookups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1346992">var</span>&nbsp;<span class="ident" id="1346996">tried</span>&nbsp;<span class="keyword" id="1347002">struct</span>&nbsp;<span class="op" id="1347009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347014">goroot</span>&nbsp;<span class="builtintype" id="1347021">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347031">gopath</span>&nbsp;<span class="op" id="1347038">[</span><span class="op" id="1347039">]</span><span class="builtintype" id="1347040">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1347049">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1347054">//&nbsp;Determine&nbsp;directory&nbsp;from&nbsp;import&nbsp;path.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347097">if</span>&nbsp;<span class="ident" id="1347100">ctxt</span><span class="op" id="1347104">.</span><span class="ident" id="1347105">GOROOT</span>&nbsp;<span class="op" id="1347112">!=</span>&nbsp;<span class="string" id="1347115">&#34;&#34;</span>&nbsp;<span class="op" id="1347118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347123">dir</span>&nbsp;<span class="op" id="1347127">:=</span>&nbsp;<span class="ident" id="1347130">ctxt</span><span class="op" id="1347134">.</span><span class="ident" id="1347135">joinPath</span><span class="op" id="1347143">(</span><span class="ident" id="1347144">ctxt</span><span class="op" id="1347148">.</span><span class="ident" id="1347149">GOROOT</span><span class="op" id="1347155">,</span>&nbsp;<span class="string" id="1347157">&#34;src&#34;</span><span class="op" id="1347162">,</span>&nbsp;<span class="ident" id="1347164">path</span><span class="op" id="1347168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347173">isDir</span>&nbsp;<span class="op" id="1347179">:=</span>&nbsp;<span class="ident" id="1347182">ctxt</span><span class="op" id="1347186">.</span><span class="ident" id="1347187">isDir</span><span class="op" id="1347192">(</span><span class="ident" id="1347193">dir</span><span class="op" id="1347196">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347201">binaryOnly</span>&nbsp;<span class="op" id="1347212">=</span>&nbsp;<span class="op" id="1347214">!</span><span class="ident" id="1347215">isDir</span>&nbsp;<span class="op" id="1347221">&amp;&amp;</span>&nbsp;<span class="ident" id="1347224">mode</span><span class="op" id="1347228">&amp;</span><span class="ident" id="1347229">AllowBinary</span>&nbsp;<span class="op" id="1347241">!=</span>&nbsp;<span class="num" id="1347244">0</span>&nbsp;<span class="op" id="1347246">&amp;&amp;</span>&nbsp;<span class="ident" id="1347249">pkga</span>&nbsp;<span class="op" id="1347254">!=</span>&nbsp;<span class="string" id="1347257">&#34;&#34;</span>&nbsp;<span class="op" id="1347260">&amp;&amp;</span>&nbsp;<span class="ident" id="1347263">ctxt</span><span class="op" id="1347267">.</span><span class="ident" id="1347268">isFile</span><span class="op" id="1347274">(</span><span class="ident" id="1347275">ctxt</span><span class="op" id="1347279">.</span><span class="ident" id="1347280">joinPath</span><span class="op" id="1347288">(</span><span class="ident" id="1347289">ctxt</span><span class="op" id="1347293">.</span><span class="ident" id="1347294">GOROOT</span><span class="op" id="1347300">,</span>&nbsp;<span class="ident" id="1347302">pkga</span><span class="op" id="1347306">)</span><span class="op" id="1347307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347312">if</span>&nbsp;<span class="ident" id="1347315">isDir</span>&nbsp;<span class="op" id="1347321">||</span>&nbsp;<span class="ident" id="1347324">binaryOnly</span>&nbsp;<span class="op" id="1347335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347341">p</span><span class="op" id="1347342">.</span><span class="ident" id="1347343">Dir</span>&nbsp;<span class="op" id="1347347">=</span>&nbsp;<span class="ident" id="1347349">dir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347357">p</span><span class="op" id="1347358">.</span><span class="ident" id="1347359">Goroot</span>&nbsp;<span class="op" id="1347366">=</span>&nbsp;<span class="builtintype" id="1347368">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347377">p</span><span class="op" id="1347378">.</span><span class="ident" id="1347379">Root</span>&nbsp;<span class="op" id="1347384">=</span>&nbsp;<span class="ident" id="1347386">ctxt</span><span class="op" id="1347390">.</span><span class="ident" id="1347391">GOROOT</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347402">goto</span>&nbsp;<span class="ident" id="1347407">Found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1347416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347421">tried</span><span class="op" id="1347426">.</span><span class="ident" id="1347427">goroot</span>&nbsp;<span class="op" id="1347434">=</span>&nbsp;<span class="ident" id="1347436">dir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1347442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347446">for</span>&nbsp;<span class="ident" id="1347450">_</span><span class="op" id="1347451">,</span>&nbsp;<span class="ident" id="1347453">root</span>&nbsp;<span class="op" id="1347458">:=</span>&nbsp;<span class="keyword" id="1347461">range</span>&nbsp;<span class="ident" id="1347467">ctxt</span><span class="op" id="1347471">.</span><span class="ident" id="1347472">gopath</span><span class="op" id="1347478">(</span><span class="op" id="1347479">)</span>&nbsp;<span class="op" id="1347481">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347486">dir</span>&nbsp;<span class="op" id="1347490">:=</span>&nbsp;<span class="ident" id="1347493">ctxt</span><span class="op" id="1347497">.</span><span class="ident" id="1347498">joinPath</span><span class="op" id="1347506">(</span><span class="ident" id="1347507">root</span><span class="op" id="1347511">,</span>&nbsp;<span class="string" id="1347513">&#34;src&#34;</span><span class="op" id="1347518">,</span>&nbsp;<span class="ident" id="1347520">path</span><span class="op" id="1347524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347529">isDir</span>&nbsp;<span class="op" id="1347535">:=</span>&nbsp;<span class="ident" id="1347538">ctxt</span><span class="op" id="1347542">.</span><span class="ident" id="1347543">isDir</span><span class="op" id="1347548">(</span><span class="ident" id="1347549">dir</span><span class="op" id="1347552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347557">binaryOnly</span>&nbsp;<span class="op" id="1347568">=</span>&nbsp;<span class="op" id="1347570">!</span><span class="ident" id="1347571">isDir</span>&nbsp;<span class="op" id="1347577">&amp;&amp;</span>&nbsp;<span class="ident" id="1347580">mode</span><span class="op" id="1347584">&amp;</span><span class="ident" id="1347585">AllowBinary</span>&nbsp;<span class="op" id="1347597">!=</span>&nbsp;<span class="num" id="1347600">0</span>&nbsp;<span class="op" id="1347602">&amp;&amp;</span>&nbsp;<span class="ident" id="1347605">pkga</span>&nbsp;<span class="op" id="1347610">!=</span>&nbsp;<span class="string" id="1347613">&#34;&#34;</span>&nbsp;<span class="op" id="1347616">&amp;&amp;</span>&nbsp;<span class="ident" id="1347619">ctxt</span><span class="op" id="1347623">.</span><span class="ident" id="1347624">isFile</span><span class="op" id="1347630">(</span><span class="ident" id="1347631">ctxt</span><span class="op" id="1347635">.</span><span class="ident" id="1347636">joinPath</span><span class="op" id="1347644">(</span><span class="ident" id="1347645">root</span><span class="op" id="1347649">,</span>&nbsp;<span class="ident" id="1347651">pkga</span><span class="op" id="1347655">)</span><span class="op" id="1347656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347661">if</span>&nbsp;<span class="ident" id="1347664">isDir</span>&nbsp;<span class="op" id="1347670">||</span>&nbsp;<span class="ident" id="1347673">binaryOnly</span>&nbsp;<span class="op" id="1347684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347690">p</span><span class="op" id="1347691">.</span><span class="ident" id="1347692">Dir</span>&nbsp;<span class="op" id="1347696">=</span>&nbsp;<span class="ident" id="1347698">dir</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347706">p</span><span class="op" id="1347707">.</span><span class="ident" id="1347708">Root</span>&nbsp;<span class="op" id="1347713">=</span>&nbsp;<span class="ident" id="1347715">root</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347724">goto</span>&nbsp;<span class="ident" id="1347729">Found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1347738">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347743">tried</span><span class="op" id="1347748">.</span><span class="ident" id="1347749">gopath</span>&nbsp;<span class="op" id="1347756">=</span>&nbsp;<span class="builtinfunc" id="1347758">append</span><span class="op" id="1347764">(</span><span class="ident" id="1347765">tried</span><span class="op" id="1347770">.</span><span class="ident" id="1347771">gopath</span><span class="op" id="1347777">,</span>&nbsp;<span class="ident" id="1347779">dir</span><span class="op" id="1347782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1347786">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1347791">//&nbsp;package&nbsp;was&nbsp;not&nbsp;found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347818">var</span>&nbsp;<span class="ident" id="1347822">paths</span>&nbsp;<span class="op" id="1347828">[</span><span class="op" id="1347829">]</span><span class="builtintype" id="1347830">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1347839">if</span>&nbsp;<span class="ident" id="1347842">tried</span><span class="op" id="1347847">.</span><span class="ident" id="1347848">goroot</span>&nbsp;<span class="op" id="1347855">!=</span>&nbsp;<span class="string" id="1347858">&#34;&#34;</span>&nbsp;<span class="op" id="1347861">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347866">paths</span>&nbsp;<span class="op" id="1347872">=</span>&nbsp;<span class="builtinfunc" id="1347874">append</span><span class="op" id="1347880">(</span><span class="ident" id="1347881">paths</span><span class="op" id="1347886">,</span>&nbsp;<span class="ident" id="1347888">fmt</span><span class="op" id="1347891">.</span><span class="ident" id="1347892">Sprintf</span><span class="op" id="1347899">(</span><span class="string" id="1347900">&#34;\t%s&nbsp;(from&nbsp;$GOROOT)&#34;</span><span class="op" id="1347921">,</span>&nbsp;<span class="ident" id="1347923">tried</span><span class="op" id="1347928">.</span><span class="ident" id="1347929">goroot</span><span class="op" id="1347935">)</span><span class="op" id="1347936">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1347940">}</span>&nbsp;<span class="keyword" id="1347942">else</span>&nbsp;<span class="op" id="1347947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1347952">paths</span>&nbsp;<span class="op" id="1347958">=</span>&nbsp;<span class="builtinfunc" id="1347960">append</span><span class="op" id="1347966">(</span><span class="ident" id="1347967">paths</span><span class="op" id="1347972">,</span>&nbsp;<span class="string" id="1347974">&#34;\t($GOROOT&nbsp;not&nbsp;set)&#34;</span><span class="op" id="1347995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1347999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348003">var</span>&nbsp;<span class="ident" id="1348007">i</span>&nbsp;<span class="builtintype" id="1348009">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348015">var</span>&nbsp;<span class="ident" id="1348019">format</span>&nbsp;<span class="op" id="1348026">=</span>&nbsp;<span class="string" id="1348028">&#34;\t%s&nbsp;(from&nbsp;$GOPATH)&#34;</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348052">for</span>&nbsp;<span class="op" id="1348056">;</span>&nbsp;<span class="ident" id="1348058">i</span>&nbsp;<span class="op" id="1348060">&lt;</span>&nbsp;<span class="builtinfunc" id="1348062">len</span><span class="op" id="1348065">(</span><span class="ident" id="1348066">tried</span><span class="op" id="1348071">.</span><span class="ident" id="1348072">gopath</span><span class="op" id="1348078">)</span><span class="op" id="1348079">;</span>&nbsp;<span class="ident" id="1348081">i</span><span class="op" id="1348082">++</span>&nbsp;<span class="op" id="1348085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348090">if</span>&nbsp;<span class="ident" id="1348093">i</span>&nbsp;<span class="op" id="1348095">&gt;</span>&nbsp;<span class="num" id="1348097">0</span>&nbsp;<span class="op" id="1348099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348105">format</span>&nbsp;<span class="op" id="1348112">=</span>&nbsp;<span class="string" id="1348114">&#34;\t%s&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348129">paths</span>&nbsp;<span class="op" id="1348135">=</span>&nbsp;<span class="builtinfunc" id="1348137">append</span><span class="op" id="1348143">(</span><span class="ident" id="1348144">paths</span><span class="op" id="1348149">,</span>&nbsp;<span class="ident" id="1348151">fmt</span><span class="op" id="1348154">.</span><span class="ident" id="1348155">Sprintf</span><span class="op" id="1348162">(</span><span class="ident" id="1348163">format</span><span class="op" id="1348169">,</span>&nbsp;<span class="ident" id="1348171">tried</span><span class="op" id="1348176">.</span><span class="ident" id="1348177">gopath</span><span class="op" id="1348183">[</span><span class="ident" id="1348184">i</span><span class="op" id="1348185">]</span><span class="op" id="1348186">)</span><span class="op" id="1348187">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348195">if</span>&nbsp;<span class="ident" id="1348198">i</span>&nbsp;<span class="op" id="1348200">==</span>&nbsp;<span class="num" id="1348203">0</span>&nbsp;<span class="op" id="1348205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348210">paths</span>&nbsp;<span class="op" id="1348216">=</span>&nbsp;<span class="builtinfunc" id="1348218">append</span><span class="op" id="1348224">(</span><span class="ident" id="1348225">paths</span><span class="op" id="1348230">,</span>&nbsp;<span class="string" id="1348232">&#34;\t($GOPATH&nbsp;not&nbsp;set)&#34;</span><span class="op" id="1348253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348261">return</span>&nbsp;<span class="ident" id="1348268">p</span><span class="op" id="1348269">,</span>&nbsp;<span class="ident" id="1348271">fmt</span><span class="op" id="1348274">.</span><span class="ident" id="1348275">Errorf</span><span class="op" id="1348281">(</span><span class="string" id="1348282">&#34;cannot&nbsp;find&nbsp;package&nbsp;%q&nbsp;in&nbsp;any&nbsp;of:\n%s&#34;</span><span class="op" id="1348321">,</span>&nbsp;<span class="ident" id="1348323">path</span><span class="op" id="1348327">,</span>&nbsp;<span class="ident" id="1348329">strings</span><span class="op" id="1348336">.</span><span class="ident" id="1348337">Join</span><span class="op" id="1348341">(</span><span class="ident" id="1348342">paths</span><span class="op" id="1348347">,</span>&nbsp;<span class="string" id="1348349">&#34;\n&#34;</span><span class="op" id="1348353">)</span><span class="op" id="1348354">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="ident" id="1348360">Found</span><span class="op" id="1348365">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348368">if</span>&nbsp;<span class="ident" id="1348371">p</span><span class="op" id="1348372">.</span><span class="ident" id="1348373">Root</span>&nbsp;<span class="op" id="1348378">!=</span>&nbsp;<span class="string" id="1348381">&#34;&#34;</span>&nbsp;<span class="op" id="1348384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348388">p</span><span class="op" id="1348389">.</span><span class="ident" id="1348390">SrcRoot</span>&nbsp;<span class="op" id="1348398">=</span>&nbsp;<span class="ident" id="1348400">ctxt</span><span class="op" id="1348404">.</span><span class="ident" id="1348405">joinPath</span><span class="op" id="1348413">(</span><span class="ident" id="1348414">p</span><span class="op" id="1348415">.</span><span class="ident" id="1348416">Root</span><span class="op" id="1348420">,</span>&nbsp;<span class="string" id="1348422">&#34;src&#34;</span><span class="op" id="1348427">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348431">p</span><span class="op" id="1348432">.</span><span class="ident" id="1348433">PkgRoot</span>&nbsp;<span class="op" id="1348441">=</span>&nbsp;<span class="ident" id="1348443">ctxt</span><span class="op" id="1348447">.</span><span class="ident" id="1348448">joinPath</span><span class="op" id="1348456">(</span><span class="ident" id="1348457">p</span><span class="op" id="1348458">.</span><span class="ident" id="1348459">Root</span><span class="op" id="1348463">,</span>&nbsp;<span class="string" id="1348465">&#34;pkg&#34;</span><span class="op" id="1348470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348474">p</span><span class="op" id="1348475">.</span><span class="ident" id="1348476">BinDir</span>&nbsp;<span class="op" id="1348483">=</span>&nbsp;<span class="ident" id="1348485">ctxt</span><span class="op" id="1348489">.</span><span class="ident" id="1348490">joinPath</span><span class="op" id="1348498">(</span><span class="ident" id="1348499">p</span><span class="op" id="1348500">.</span><span class="ident" id="1348501">Root</span><span class="op" id="1348505">,</span>&nbsp;<span class="string" id="1348507">&#34;bin&#34;</span><span class="op" id="1348512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348516">if</span>&nbsp;<span class="ident" id="1348519">pkga</span>&nbsp;<span class="op" id="1348524">!=</span>&nbsp;<span class="string" id="1348527">&#34;&#34;</span>&nbsp;<span class="op" id="1348530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348535">p</span><span class="op" id="1348536">.</span><span class="ident" id="1348537">PkgObj</span>&nbsp;<span class="op" id="1348544">=</span>&nbsp;<span class="ident" id="1348546">ctxt</span><span class="op" id="1348550">.</span><span class="ident" id="1348551">joinPath</span><span class="op" id="1348559">(</span><span class="ident" id="1348560">p</span><span class="op" id="1348561">.</span><span class="ident" id="1348562">Root</span><span class="op" id="1348566">,</span>&nbsp;<span class="ident" id="1348568">pkga</span><span class="op" id="1348572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348576">}</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348583">if</span>&nbsp;<span class="ident" id="1348586">mode</span><span class="op" id="1348590">&amp;</span><span class="ident" id="1348591">FindOnly</span>&nbsp;<span class="op" id="1348600">!=</span>&nbsp;<span class="num" id="1348603">0</span>&nbsp;<span class="op" id="1348605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348609">return</span>&nbsp;<span class="ident" id="1348616">p</span><span class="op" id="1348617">,</span>&nbsp;<span class="ident" id="1348619">pkgerr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348627">}</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348630">if</span>&nbsp;<span class="ident" id="1348633">binaryOnly</span>&nbsp;<span class="op" id="1348644">&amp;&amp;</span>&nbsp;<span class="op" id="1348647">(</span><span class="ident" id="1348648">mode</span><span class="op" id="1348652">&amp;</span><span class="ident" id="1348653">AllowBinary</span><span class="op" id="1348664">)</span>&nbsp;<span class="op" id="1348666">!=</span>&nbsp;<span class="num" id="1348669">0</span>&nbsp;<span class="op" id="1348671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348675">return</span>&nbsp;<span class="ident" id="1348682">p</span><span class="op" id="1348683">,</span>&nbsp;<span class="ident" id="1348685">pkgerr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348697">dirs</span><span class="op" id="1348701">,</span>&nbsp;<span class="ident" id="1348703">err</span>&nbsp;<span class="op" id="1348707">:=</span>&nbsp;<span class="ident" id="1348710">ctxt</span><span class="op" id="1348714">.</span><span class="ident" id="1348715">readDir</span><span class="op" id="1348722">(</span><span class="ident" id="1348723">p</span><span class="op" id="1348724">.</span><span class="ident" id="1348725">Dir</span><span class="op" id="1348728">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348731">if</span>&nbsp;<span class="ident" id="1348734">err</span>&nbsp;<span class="op" id="1348738">!=</span>&nbsp;<span class="ident" id="1348741">nil</span>&nbsp;<span class="op" id="1348745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348749">return</span>&nbsp;<span class="ident" id="1348756">p</span><span class="op" id="1348757">,</span>&nbsp;<span class="ident" id="1348759">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1348764">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348768">var</span>&nbsp;<span class="ident" id="1348772">Sfiles</span>&nbsp;<span class="op" id="1348779">[</span><span class="op" id="1348780">]</span><span class="builtintype" id="1348781">string</span>&nbsp;<span class="comment" id="1348788">//&nbsp;files&nbsp;with&nbsp;&#34;.S&#34;&nbsp;(capital&nbsp;S)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1348820">var</span>&nbsp;<span class="ident" id="1348824">firstFile</span><span class="op" id="1348833">,</span>&nbsp;<span class="ident" id="1348835">firstCommentFile</span>&nbsp;<span class="builtintype" id="1348852">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348860">imported</span>&nbsp;<span class="op" id="1348869">:=</span>&nbsp;<span class="builtinfunc" id="1348872">make</span><span class="op" id="1348876">(</span><span class="keyword" id="1348877">map</span><span class="op" id="1348880">[</span><span class="builtintype" id="1348881">string</span><span class="op" id="1348887">]</span><span class="op" id="1348888">[</span><span class="op" id="1348889">]</span><span class="ident" id="1348890">token</span><span class="op" id="1348895">.</span><span class="ident" id="1348896">Position</span><span class="op" id="1348904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348907">testImported</span>&nbsp;<span class="op" id="1348920">:=</span>&nbsp;<span class="builtinfunc" id="1348923">make</span><span class="op" id="1348927">(</span><span class="keyword" id="1348928">map</span><span class="op" id="1348931">[</span><span class="builtintype" id="1348932">string</span><span class="op" id="1348938">]</span><span class="op" id="1348939">[</span><span class="op" id="1348940">]</span><span class="ident" id="1348941">token</span><span class="op" id="1348946">.</span><span class="ident" id="1348947">Position</span><span class="op" id="1348955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1348958">xTestImported</span>&nbsp;<span class="op" id="1348972">:=</span>&nbsp;<span class="builtinfunc" id="1348975">make</span><span class="op" id="1348979">(</span><span class="keyword" id="1348980">map</span><span class="op" id="1348983">[</span><span class="builtintype" id="1348984">string</span><span class="op" id="1348990">]</span><span class="op" id="1348991">[</span><span class="op" id="1348992">]</span><span class="ident" id="1348993">token</span><span class="op" id="1348998">.</span><span class="ident" id="1348999">Position</span><span class="op" id="1349007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349010">allTags</span>&nbsp;<span class="op" id="1349018">:=</span>&nbsp;<span class="builtinfunc" id="1349021">make</span><span class="op" id="1349025">(</span><span class="keyword" id="1349026">map</span><span class="op" id="1349029">[</span><span class="builtintype" id="1349030">string</span><span class="op" id="1349036">]</span><span class="builtintype" id="1349037">bool</span><span class="op" id="1349041">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349044">fset</span>&nbsp;<span class="op" id="1349049">:=</span>&nbsp;<span class="ident" id="1349052">token</span><span class="op" id="1349057">.</span><span class="ident" id="1349058">NewFileSet</span><span class="op" id="1349068">(</span><span class="op" id="1349069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349072">for</span>&nbsp;<span class="ident" id="1349076">_</span><span class="op" id="1349077">,</span>&nbsp;<span class="ident" id="1349079">d</span>&nbsp;<span class="op" id="1349081">:=</span>&nbsp;<span class="keyword" id="1349084">range</span>&nbsp;<span class="ident" id="1349090">dirs</span>&nbsp;<span class="op" id="1349095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349099">if</span>&nbsp;<span class="ident" id="1349102">d</span><span class="op" id="1349103">.</span><span class="ident" id="1349104">IsDir</span><span class="op" id="1349109">(</span><span class="op" id="1349110">)</span>&nbsp;<span class="op" id="1349112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349117">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1349128">}</span><br>
<span class="lineno">620</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349133">name</span>&nbsp;<span class="op" id="1349138">:=</span>&nbsp;<span class="ident" id="1349141">d</span><span class="op" id="1349142">.</span><span class="ident" id="1349143">Name</span><span class="op" id="1349147">(</span><span class="op" id="1349148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349152">ext</span>&nbsp;<span class="op" id="1349156">:=</span>&nbsp;<span class="ident" id="1349159">nameExt</span><span class="op" id="1349166">(</span><span class="ident" id="1349167">name</span><span class="op" id="1349171">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349176">match</span><span class="op" id="1349181">,</span>&nbsp;<span class="ident" id="1349183">data</span><span class="op" id="1349187">,</span>&nbsp;<span class="ident" id="1349189">filename</span><span class="op" id="1349197">,</span>&nbsp;<span class="ident" id="1349199">err</span>&nbsp;<span class="op" id="1349203">:=</span>&nbsp;<span class="ident" id="1349206">ctxt</span><span class="op" id="1349210">.</span><span class="ident" id="1349211">matchFile</span><span class="op" id="1349220">(</span><span class="ident" id="1349221">p</span><span class="op" id="1349222">.</span><span class="ident" id="1349223">Dir</span><span class="op" id="1349226">,</span>&nbsp;<span class="ident" id="1349228">name</span><span class="op" id="1349232">,</span>&nbsp;<span class="builtintype" id="1349234">true</span><span class="op" id="1349238">,</span>&nbsp;<span class="ident" id="1349240">allTags</span><span class="op" id="1349247">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349251">if</span>&nbsp;<span class="ident" id="1349254">err</span>&nbsp;<span class="op" id="1349258">!=</span>&nbsp;<span class="ident" id="1349261">nil</span>&nbsp;<span class="op" id="1349265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349270">return</span>&nbsp;<span class="ident" id="1349277">p</span><span class="op" id="1349278">,</span>&nbsp;<span class="ident" id="1349280">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1349286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349290">if</span>&nbsp;<span class="op" id="1349293">!</span><span class="ident" id="1349294">match</span>&nbsp;<span class="op" id="1349300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349305">if</span>&nbsp;<span class="ident" id="1349308">ext</span>&nbsp;<span class="op" id="1349312">==</span>&nbsp;<span class="string" id="1349315">&#34;.go&#34;</span>&nbsp;<span class="op" id="1349321">{</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349327">p</span><span class="op" id="1349328">.</span><span class="ident" id="1349329">IgnoredGoFiles</span>&nbsp;<span class="op" id="1349344">=</span>&nbsp;<span class="builtinfunc" id="1349346">append</span><span class="op" id="1349352">(</span><span class="ident" id="1349353">p</span><span class="op" id="1349354">.</span><span class="ident" id="1349355">IgnoredGoFiles</span><span class="op" id="1349369">,</span>&nbsp;<span class="ident" id="1349371">name</span><span class="op" id="1349375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1349380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349385">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1349396">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1349401">//&nbsp;Going&nbsp;to&nbsp;save&nbsp;the&nbsp;file.&nbsp;&nbsp;For&nbsp;non-Go&nbsp;files,&nbsp;can&nbsp;stop&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349464">switch</span>&nbsp;<span class="ident" id="1349471">ext</span>&nbsp;<span class="op" id="1349475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349479">case</span>&nbsp;<span class="string" id="1349484">&#34;.c&#34;</span><span class="op" id="1349488">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349493">p</span><span class="op" id="1349494">.</span><span class="ident" id="1349495">CFiles</span>&nbsp;<span class="op" id="1349502">=</span>&nbsp;<span class="builtinfunc" id="1349504">append</span><span class="op" id="1349510">(</span><span class="ident" id="1349511">p</span><span class="op" id="1349512">.</span><span class="ident" id="1349513">CFiles</span><span class="op" id="1349519">,</span>&nbsp;<span class="ident" id="1349521">name</span><span class="op" id="1349525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349530">continue</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349541">case</span>&nbsp;<span class="string" id="1349546">&#34;.cc&#34;</span><span class="op" id="1349551">,</span>&nbsp;<span class="string" id="1349553">&#34;.cpp&#34;</span><span class="op" id="1349559">,</span>&nbsp;<span class="string" id="1349561">&#34;.cxx&#34;</span><span class="op" id="1349567">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349572">p</span><span class="op" id="1349573">.</span><span class="ident" id="1349574">CXXFiles</span>&nbsp;<span class="op" id="1349583">=</span>&nbsp;<span class="builtinfunc" id="1349585">append</span><span class="op" id="1349591">(</span><span class="ident" id="1349592">p</span><span class="op" id="1349593">.</span><span class="ident" id="1349594">CXXFiles</span><span class="op" id="1349602">,</span>&nbsp;<span class="ident" id="1349604">name</span><span class="op" id="1349608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349613">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349624">case</span>&nbsp;<span class="string" id="1349629">&#34;.m&#34;</span><span class="op" id="1349633">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349638">p</span><span class="op" id="1349639">.</span><span class="ident" id="1349640">MFiles</span>&nbsp;<span class="op" id="1349647">=</span>&nbsp;<span class="builtinfunc" id="1349649">append</span><span class="op" id="1349655">(</span><span class="ident" id="1349656">p</span><span class="op" id="1349657">.</span><span class="ident" id="1349658">MFiles</span><span class="op" id="1349664">,</span>&nbsp;<span class="ident" id="1349666">name</span><span class="op" id="1349670">)</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349675">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349686">case</span>&nbsp;<span class="string" id="1349691">&#34;.h&#34;</span><span class="op" id="1349695">,</span>&nbsp;<span class="string" id="1349697">&#34;.hh&#34;</span><span class="op" id="1349702">,</span>&nbsp;<span class="string" id="1349704">&#34;.hpp&#34;</span><span class="op" id="1349710">,</span>&nbsp;<span class="string" id="1349712">&#34;.hxx&#34;</span><span class="op" id="1349718">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349723">p</span><span class="op" id="1349724">.</span><span class="ident" id="1349725">HFiles</span>&nbsp;<span class="op" id="1349732">=</span>&nbsp;<span class="builtinfunc" id="1349734">append</span><span class="op" id="1349740">(</span><span class="ident" id="1349741">p</span><span class="op" id="1349742">.</span><span class="ident" id="1349743">HFiles</span><span class="op" id="1349749">,</span>&nbsp;<span class="ident" id="1349751">name</span><span class="op" id="1349755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349760">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349771">case</span>&nbsp;<span class="string" id="1349776">&#34;.s&#34;</span><span class="op" id="1349780">:</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349785">p</span><span class="op" id="1349786">.</span><span class="ident" id="1349787">SFiles</span>&nbsp;<span class="op" id="1349794">=</span>&nbsp;<span class="builtinfunc" id="1349796">append</span><span class="op" id="1349802">(</span><span class="ident" id="1349803">p</span><span class="op" id="1349804">.</span><span class="ident" id="1349805">SFiles</span><span class="op" id="1349811">,</span>&nbsp;<span class="ident" id="1349813">name</span><span class="op" id="1349817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349822">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349833">case</span>&nbsp;<span class="string" id="1349838">&#34;.S&#34;</span><span class="op" id="1349842">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349847">Sfiles</span>&nbsp;<span class="op" id="1349854">=</span>&nbsp;<span class="builtinfunc" id="1349856">append</span><span class="op" id="1349862">(</span><span class="ident" id="1349863">Sfiles</span><span class="op" id="1349869">,</span>&nbsp;<span class="ident" id="1349871">name</span><span class="op" id="1349875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349880">continue</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349891">case</span>&nbsp;<span class="string" id="1349896">&#34;.swig&#34;</span><span class="op" id="1349903">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349908">p</span><span class="op" id="1349909">.</span><span class="ident" id="1349910">SwigFiles</span>&nbsp;<span class="op" id="1349920">=</span>&nbsp;<span class="builtinfunc" id="1349922">append</span><span class="op" id="1349928">(</span><span class="ident" id="1349929">p</span><span class="op" id="1349930">.</span><span class="ident" id="1349931">SwigFiles</span><span class="op" id="1349940">,</span>&nbsp;<span class="ident" id="1349942">name</span><span class="op" id="1349946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349951">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1349962">case</span>&nbsp;<span class="string" id="1349967">&#34;.swigcxx&#34;</span><span class="op" id="1349977">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1349982">p</span><span class="op" id="1349983">.</span><span class="ident" id="1349984">SwigCXXFiles</span>&nbsp;<span class="op" id="1349997">=</span>&nbsp;<span class="builtinfunc" id="1349999">append</span><span class="op" id="1350005">(</span><span class="ident" id="1350006">p</span><span class="op" id="1350007">.</span><span class="ident" id="1350008">SwigCXXFiles</span><span class="op" id="1350020">,</span>&nbsp;<span class="ident" id="1350022">name</span><span class="op" id="1350026">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350031">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350042">case</span>&nbsp;<span class="string" id="1350047">&#34;.syso&#34;</span><span class="op" id="1350054">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1350059">//&nbsp;binary&nbsp;objects&nbsp;to&nbsp;add&nbsp;to&nbsp;package&nbsp;archive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1350106">//&nbsp;Likely&nbsp;of&nbsp;the&nbsp;form&nbsp;foo_windows.syso,&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1350153">//&nbsp;the&nbsp;name&nbsp;was&nbsp;vetted&nbsp;above&nbsp;with&nbsp;goodOSArchFile.</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350206">p</span><span class="op" id="1350207">.</span><span class="ident" id="1350208">SysoFiles</span>&nbsp;<span class="op" id="1350218">=</span>&nbsp;<span class="builtinfunc" id="1350220">append</span><span class="op" id="1350226">(</span><span class="ident" id="1350227">p</span><span class="op" id="1350228">.</span><span class="ident" id="1350229">SysoFiles</span><span class="op" id="1350238">,</span>&nbsp;<span class="ident" id="1350240">name</span><span class="op" id="1350244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350249">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1350260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350265">pf</span><span class="op" id="1350267">,</span>&nbsp;<span class="ident" id="1350269">err</span>&nbsp;<span class="op" id="1350273">:=</span>&nbsp;<span class="ident" id="1350276">parser</span><span class="op" id="1350282">.</span><span class="ident" id="1350283">ParseFile</span><span class="op" id="1350292">(</span><span class="ident" id="1350293">fset</span><span class="op" id="1350297">,</span>&nbsp;<span class="ident" id="1350299">filename</span><span class="op" id="1350307">,</span>&nbsp;<span class="ident" id="1350309">data</span><span class="op" id="1350313">,</span>&nbsp;<span class="ident" id="1350315">parser</span><span class="op" id="1350321">.</span><span class="ident" id="1350322">ImportsOnly</span><span class="op" id="1350333">|</span><span class="ident" id="1350334">parser</span><span class="op" id="1350340">.</span><span class="ident" id="1350341">ParseComments</span><span class="op" id="1350354">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350358">if</span>&nbsp;<span class="ident" id="1350361">err</span>&nbsp;<span class="op" id="1350365">!=</span>&nbsp;<span class="ident" id="1350368">nil</span>&nbsp;<span class="op" id="1350372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350377">return</span>&nbsp;<span class="ident" id="1350384">p</span><span class="op" id="1350385">,</span>&nbsp;<span class="ident" id="1350387">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1350393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350398">pkg</span>&nbsp;<span class="op" id="1350402">:=</span>&nbsp;<span class="ident" id="1350405">pf</span><span class="op" id="1350407">.</span><span class="ident" id="1350408">Name</span><span class="op" id="1350412">.</span><span class="ident" id="1350413">Name</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350420">if</span>&nbsp;<span class="ident" id="1350423">pkg</span>&nbsp;<span class="op" id="1350427">==</span>&nbsp;<span class="string" id="1350430">&#34;documentation&#34;</span>&nbsp;<span class="op" id="1350446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350451">p</span><span class="op" id="1350452">.</span><span class="ident" id="1350453">IgnoredGoFiles</span>&nbsp;<span class="op" id="1350468">=</span>&nbsp;<span class="builtinfunc" id="1350470">append</span><span class="op" id="1350476">(</span><span class="ident" id="1350477">p</span><span class="op" id="1350478">.</span><span class="ident" id="1350479">IgnoredGoFiles</span><span class="op" id="1350493">,</span>&nbsp;<span class="ident" id="1350495">name</span><span class="op" id="1350499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350504">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1350515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350520">isTest</span>&nbsp;<span class="op" id="1350527">:=</span>&nbsp;<span class="ident" id="1350530">strings</span><span class="op" id="1350537">.</span><span class="ident" id="1350538">HasSuffix</span><span class="op" id="1350547">(</span><span class="ident" id="1350548">name</span><span class="op" id="1350552">,</span>&nbsp;<span class="string" id="1350554">&#34;_test.go&#34;</span><span class="op" id="1350564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350568">isXTest</span>&nbsp;<span class="op" id="1350576">:=</span>&nbsp;<span class="builtintype" id="1350579">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350587">if</span>&nbsp;<span class="ident" id="1350590">isTest</span>&nbsp;<span class="op" id="1350597">&amp;&amp;</span>&nbsp;<span class="ident" id="1350600">strings</span><span class="op" id="1350607">.</span><span class="ident" id="1350608">HasSuffix</span><span class="op" id="1350617">(</span><span class="ident" id="1350618">pkg</span><span class="op" id="1350621">,</span>&nbsp;<span class="string" id="1350623">&#34;_test&#34;</span><span class="op" id="1350630">)</span>&nbsp;<span class="op" id="1350632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350637">isXTest</span>&nbsp;<span class="op" id="1350645">=</span>&nbsp;<span class="builtintype" id="1350647">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350655">pkg</span>&nbsp;<span class="op" id="1350659">=</span>&nbsp;<span class="ident" id="1350661">pkg</span><span class="op" id="1350664">[</span><span class="op" id="1350665">:</span><span class="builtinfunc" id="1350666">len</span><span class="op" id="1350669">(</span><span class="ident" id="1350670">pkg</span><span class="op" id="1350673">)</span><span class="op" id="1350674">-</span><span class="builtinfunc" id="1350675">len</span><span class="op" id="1350678">(</span><span class="string" id="1350679">&#34;_test&#34;</span><span class="op" id="1350686">)</span><span class="op" id="1350687">]</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1350691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350696">if</span>&nbsp;<span class="ident" id="1350699">p</span><span class="op" id="1350700">.</span><span class="ident" id="1350701">Name</span>&nbsp;<span class="op" id="1350706">==</span>&nbsp;<span class="string" id="1350709">&#34;&#34;</span>&nbsp;<span class="op" id="1350712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350717">p</span><span class="op" id="1350718">.</span><span class="ident" id="1350719">Name</span>&nbsp;<span class="op" id="1350724">=</span>&nbsp;<span class="ident" id="1350726">pkg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350733">firstFile</span>&nbsp;<span class="op" id="1350743">=</span>&nbsp;<span class="ident" id="1350745">name</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1350752">}</span>&nbsp;<span class="keyword" id="1350754">else</span>&nbsp;<span class="keyword" id="1350759">if</span>&nbsp;<span class="ident" id="1350762">pkg</span>&nbsp;<span class="op" id="1350766">!=</span>&nbsp;<span class="ident" id="1350769">p</span><span class="op" id="1350770">.</span><span class="ident" id="1350771">Name</span>&nbsp;<span class="op" id="1350776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350781">return</span>&nbsp;<span class="ident" id="1350788">p</span><span class="op" id="1350789">,</span>&nbsp;<span class="op" id="1350791">&amp;</span><span class="ident" id="1350792">MultiplePackageError</span><span class="op" id="1350812">{</span><span class="ident" id="1350813">p</span><span class="op" id="1350814">.</span><span class="ident" id="1350815">Dir</span><span class="op" id="1350818">,</span>&nbsp;<span class="op" id="1350820">[</span><span class="op" id="1350821">]</span><span class="builtintype" id="1350822">string</span><span class="op" id="1350828">{</span><span class="ident" id="1350829">firstFile</span><span class="op" id="1350838">,</span>&nbsp;<span class="ident" id="1350840">name</span><span class="op" id="1350844">}</span><span class="op" id="1350845">,</span>&nbsp;<span class="op" id="1350847">[</span><span class="op" id="1350848">]</span><span class="builtintype" id="1350849">string</span><span class="op" id="1350855">{</span><span class="ident" id="1350856">p</span><span class="op" id="1350857">.</span><span class="ident" id="1350858">Name</span><span class="op" id="1350862">,</span>&nbsp;<span class="ident" id="1350864">pkg</span><span class="op" id="1350867">}</span><span class="op" id="1350868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1350872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350876">if</span>&nbsp;<span class="ident" id="1350879">pf</span><span class="op" id="1350881">.</span><span class="ident" id="1350882">Doc</span>&nbsp;<span class="op" id="1350886">!=</span>&nbsp;<span class="ident" id="1350889">nil</span>&nbsp;<span class="op" id="1350893">&amp;&amp;</span>&nbsp;<span class="ident" id="1350896">p</span><span class="op" id="1350897">.</span><span class="ident" id="1350898">Doc</span>&nbsp;<span class="op" id="1350902">==</span>&nbsp;<span class="string" id="1350905">&#34;&#34;</span>&nbsp;<span class="op" id="1350908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350913">p</span><span class="op" id="1350914">.</span><span class="ident" id="1350915">Doc</span>&nbsp;<span class="op" id="1350919">=</span>&nbsp;<span class="ident" id="1350921">doc</span><span class="op" id="1350924">.</span><span class="ident" id="1350925">Synopsis</span><span class="op" id="1350933">(</span><span class="ident" id="1350934">pf</span><span class="op" id="1350936">.</span><span class="ident" id="1350937">Doc</span><span class="op" id="1350940">.</span><span class="ident" id="1350941">Text</span><span class="op" id="1350945">(</span><span class="op" id="1350946">)</span><span class="op" id="1350947">)</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1350951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1350956">if</span>&nbsp;<span class="ident" id="1350959">mode</span><span class="op" id="1350963">&amp;</span><span class="ident" id="1350964">ImportComment</span>&nbsp;<span class="op" id="1350978">!=</span>&nbsp;<span class="num" id="1350981">0</span>&nbsp;<span class="op" id="1350983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1350988">qcom</span><span class="op" id="1350992">,</span>&nbsp;<span class="ident" id="1350994">line</span>&nbsp;<span class="op" id="1350999">:=</span>&nbsp;<span class="ident" id="1351002">findImportComment</span><span class="op" id="1351019">(</span><span class="ident" id="1351020">data</span><span class="op" id="1351024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351029">if</span>&nbsp;<span class="ident" id="1351032">line</span>&nbsp;<span class="op" id="1351037">!=</span>&nbsp;<span class="num" id="1351040">0</span>&nbsp;<span class="op" id="1351042">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351048">com</span><span class="op" id="1351051">,</span>&nbsp;<span class="ident" id="1351053">err</span>&nbsp;<span class="op" id="1351057">:=</span>&nbsp;<span class="ident" id="1351060">strconv</span><span class="op" id="1351067">.</span><span class="ident" id="1351068">Unquote</span><span class="op" id="1351075">(</span><span class="ident" id="1351076">qcom</span><span class="op" id="1351080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351086">if</span>&nbsp;<span class="ident" id="1351089">err</span>&nbsp;<span class="op" id="1351093">!=</span>&nbsp;<span class="ident" id="1351096">nil</span>&nbsp;<span class="op" id="1351100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351107">return</span>&nbsp;<span class="ident" id="1351114">p</span><span class="op" id="1351115">,</span>&nbsp;<span class="ident" id="1351117">fmt</span><span class="op" id="1351120">.</span><span class="ident" id="1351121">Errorf</span><span class="op" id="1351127">(</span><span class="string" id="1351128">&#34;%s:%d:&nbsp;cannot&nbsp;parse&nbsp;import&nbsp;comment&#34;</span><span class="op" id="1351164">,</span>&nbsp;<span class="ident" id="1351166">filename</span><span class="op" id="1351174">,</span>&nbsp;<span class="ident" id="1351176">line</span><span class="op" id="1351180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1351186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351192">if</span>&nbsp;<span class="ident" id="1351195">p</span><span class="op" id="1351196">.</span><span class="ident" id="1351197">ImportComment</span>&nbsp;<span class="op" id="1351211">==</span>&nbsp;<span class="string" id="1351214">&#34;&#34;</span>&nbsp;<span class="op" id="1351217">{</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351224">p</span><span class="op" id="1351225">.</span><span class="ident" id="1351226">ImportComment</span>&nbsp;<span class="op" id="1351240">=</span>&nbsp;<span class="ident" id="1351242">com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351251">firstCommentFile</span>&nbsp;<span class="op" id="1351268">=</span>&nbsp;<span class="ident" id="1351270">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1351279">}</span>&nbsp;<span class="keyword" id="1351281">else</span>&nbsp;<span class="keyword" id="1351286">if</span>&nbsp;<span class="ident" id="1351289">p</span><span class="op" id="1351290">.</span><span class="ident" id="1351291">ImportComment</span>&nbsp;<span class="op" id="1351305">!=</span>&nbsp;<span class="ident" id="1351308">com</span>&nbsp;<span class="op" id="1351312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351319">return</span>&nbsp;<span class="ident" id="1351326">p</span><span class="op" id="1351327">,</span>&nbsp;<span class="ident" id="1351329">fmt</span><span class="op" id="1351332">.</span><span class="ident" id="1351333">Errorf</span><span class="op" id="1351339">(</span><span class="string" id="1351340">&#34;found&nbsp;import&nbsp;comments&nbsp;%q&nbsp;(%s)&nbsp;and&nbsp;%q&nbsp;(%s)&nbsp;in&nbsp;%s&#34;</span><span class="op" id="1351389">,</span>&nbsp;<span class="ident" id="1351391">p</span><span class="op" id="1351392">.</span><span class="ident" id="1351393">ImportComment</span><span class="op" id="1351406">,</span>&nbsp;<span class="ident" id="1351408">firstCommentFile</span><span class="op" id="1351424">,</span>&nbsp;<span class="ident" id="1351426">com</span><span class="op" id="1351429">,</span>&nbsp;<span class="ident" id="1351431">name</span><span class="op" id="1351435">,</span>&nbsp;<span class="ident" id="1351437">p</span><span class="op" id="1351438">.</span><span class="ident" id="1351439">Dir</span><span class="op" id="1351442">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1351448">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1351453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1351457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1351462">//&nbsp;Record&nbsp;imports&nbsp;and&nbsp;information&nbsp;about&nbsp;cgo.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351509">isCgo</span>&nbsp;<span class="op" id="1351515">:=</span>&nbsp;<span class="builtintype" id="1351518">false</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351526">for</span>&nbsp;<span class="ident" id="1351530">_</span><span class="op" id="1351531">,</span>&nbsp;<span class="ident" id="1351533">decl</span>&nbsp;<span class="op" id="1351538">:=</span>&nbsp;<span class="keyword" id="1351541">range</span>&nbsp;<span class="ident" id="1351547">pf</span><span class="op" id="1351549">.</span><span class="ident" id="1351550">Decls</span>&nbsp;<span class="op" id="1351556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351561">d</span><span class="op" id="1351562">,</span>&nbsp;<span class="ident" id="1351564">ok</span>&nbsp;<span class="op" id="1351567">:=</span>&nbsp;<span class="ident" id="1351570">decl</span><span class="op" id="1351574">.</span><span class="op" id="1351575">(</span><span class="op" id="1351576">*</span><span class="ident" id="1351577">ast</span><span class="op" id="1351580">.</span><span class="ident" id="1351581">GenDecl</span><span class="op" id="1351588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351593">if</span>&nbsp;<span class="op" id="1351596">!</span><span class="ident" id="1351597">ok</span>&nbsp;<span class="op" id="1351600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351606">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1351618">}</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351623">for</span>&nbsp;<span class="ident" id="1351627">_</span><span class="op" id="1351628">,</span>&nbsp;<span class="ident" id="1351630">dspec</span>&nbsp;<span class="op" id="1351636">:=</span>&nbsp;<span class="keyword" id="1351639">range</span>&nbsp;<span class="ident" id="1351645">d</span><span class="op" id="1351646">.</span><span class="ident" id="1351647">Specs</span>&nbsp;<span class="op" id="1351653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351659">spec</span><span class="op" id="1351663">,</span>&nbsp;<span class="ident" id="1351665">ok</span>&nbsp;<span class="op" id="1351668">:=</span>&nbsp;<span class="ident" id="1351671">dspec</span><span class="op" id="1351676">.</span><span class="op" id="1351677">(</span><span class="op" id="1351678">*</span><span class="ident" id="1351679">ast</span><span class="op" id="1351682">.</span><span class="ident" id="1351683">ImportSpec</span><span class="op" id="1351693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351699">if</span>&nbsp;<span class="op" id="1351702">!</span><span class="ident" id="1351703">ok</span>&nbsp;<span class="op" id="1351706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351713">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1351726">}</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351732">quoted</span>&nbsp;<span class="op" id="1351739">:=</span>&nbsp;<span class="ident" id="1351742">spec</span><span class="op" id="1351746">.</span><span class="ident" id="1351747">Path</span><span class="op" id="1351751">.</span><span class="ident" id="1351752">Value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351762">path</span><span class="op" id="1351766">,</span>&nbsp;<span class="ident" id="1351768">err</span>&nbsp;<span class="op" id="1351772">:=</span>&nbsp;<span class="ident" id="1351775">strconv</span><span class="op" id="1351782">.</span><span class="ident" id="1351783">Unquote</span><span class="op" id="1351790">(</span><span class="ident" id="1351791">quoted</span><span class="op" id="1351797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351803">if</span>&nbsp;<span class="ident" id="1351806">err</span>&nbsp;<span class="op" id="1351810">!=</span>&nbsp;<span class="ident" id="1351813">nil</span>&nbsp;<span class="op" id="1351817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351824">log</span><span class="op" id="1351827">.</span><span class="ident" id="1351828">Panicf</span><span class="op" id="1351834">(</span><span class="string" id="1351835">&#34;%s:&nbsp;parser&nbsp;returned&nbsp;invalid&nbsp;quoted&nbsp;string:&nbsp;&lt;%s&gt;&#34;</span><span class="op" id="1351884">,</span>&nbsp;<span class="ident" id="1351886">filename</span><span class="op" id="1351894">,</span>&nbsp;<span class="ident" id="1351896">quoted</span><span class="op" id="1351902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1351908">}</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1351914">if</span>&nbsp;<span class="ident" id="1351917">isXTest</span>&nbsp;<span class="op" id="1351925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1351932">xTestImported</span><span class="op" id="1351945">[</span><span class="ident" id="1351946">path</span><span class="op" id="1351950">]</span>&nbsp;<span class="op" id="1351952">=</span>&nbsp;<span class="builtinfunc" id="1351954">append</span><span class="op" id="1351960">(</span><span class="ident" id="1351961">xTestImported</span><span class="op" id="1351974">[</span><span class="ident" id="1351975">path</span><span class="op" id="1351979">]</span><span class="op" id="1351980">,</span>&nbsp;<span class="ident" id="1351982">fset</span><span class="op" id="1351986">.</span><span class="ident" id="1351987">Position</span><span class="op" id="1351995">(</span><span class="ident" id="1351996">spec</span><span class="op" id="1352000">.</span><span class="ident" id="1352001">Pos</span><span class="op" id="1352004">(</span><span class="op" id="1352005">)</span><span class="op" id="1352006">)</span><span class="op" id="1352007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352013">}</span>&nbsp;<span class="keyword" id="1352015">else</span>&nbsp;<span class="keyword" id="1352020">if</span>&nbsp;<span class="ident" id="1352023">isTest</span>&nbsp;<span class="op" id="1352030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352037">testImported</span><span class="op" id="1352049">[</span><span class="ident" id="1352050">path</span><span class="op" id="1352054">]</span>&nbsp;<span class="op" id="1352056">=</span>&nbsp;<span class="builtinfunc" id="1352058">append</span><span class="op" id="1352064">(</span><span class="ident" id="1352065">testImported</span><span class="op" id="1352077">[</span><span class="ident" id="1352078">path</span><span class="op" id="1352082">]</span><span class="op" id="1352083">,</span>&nbsp;<span class="ident" id="1352085">fset</span><span class="op" id="1352089">.</span><span class="ident" id="1352090">Position</span><span class="op" id="1352098">(</span><span class="ident" id="1352099">spec</span><span class="op" id="1352103">.</span><span class="ident" id="1352104">Pos</span><span class="op" id="1352107">(</span><span class="op" id="1352108">)</span><span class="op" id="1352109">)</span><span class="op" id="1352110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352116">}</span>&nbsp;<span class="keyword" id="1352118">else</span>&nbsp;<span class="op" id="1352123">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352130">imported</span><span class="op" id="1352138">[</span><span class="ident" id="1352139">path</span><span class="op" id="1352143">]</span>&nbsp;<span class="op" id="1352145">=</span>&nbsp;<span class="builtinfunc" id="1352147">append</span><span class="op" id="1352153">(</span><span class="ident" id="1352154">imported</span><span class="op" id="1352162">[</span><span class="ident" id="1352163">path</span><span class="op" id="1352167">]</span><span class="op" id="1352168">,</span>&nbsp;<span class="ident" id="1352170">fset</span><span class="op" id="1352174">.</span><span class="ident" id="1352175">Position</span><span class="op" id="1352183">(</span><span class="ident" id="1352184">spec</span><span class="op" id="1352188">.</span><span class="ident" id="1352189">Pos</span><span class="op" id="1352192">(</span><span class="op" id="1352193">)</span><span class="op" id="1352194">)</span><span class="op" id="1352195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352207">if</span>&nbsp;<span class="ident" id="1352210">path</span>&nbsp;<span class="op" id="1352215">==</span>&nbsp;<span class="string" id="1352218">&#34;C&#34;</span>&nbsp;<span class="op" id="1352222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352229">if</span>&nbsp;<span class="ident" id="1352232">isTest</span>&nbsp;<span class="op" id="1352239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352247">return</span>&nbsp;<span class="ident" id="1352254">p</span><span class="op" id="1352255">,</span>&nbsp;<span class="ident" id="1352257">fmt</span><span class="op" id="1352260">.</span><span class="ident" id="1352261">Errorf</span><span class="op" id="1352267">(</span><span class="string" id="1352268">&#34;use&nbsp;of&nbsp;cgo&nbsp;in&nbsp;test&nbsp;%s&nbsp;not&nbsp;supported&#34;</span><span class="op" id="1352305">,</span>&nbsp;<span class="ident" id="1352307">filename</span><span class="op" id="1352315">)</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352329">cg</span>&nbsp;<span class="op" id="1352332">:=</span>&nbsp;<span class="ident" id="1352335">spec</span><span class="op" id="1352339">.</span><span class="ident" id="1352340">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352349">if</span>&nbsp;<span class="ident" id="1352352">cg</span>&nbsp;<span class="op" id="1352355">==</span>&nbsp;<span class="ident" id="1352358">nil</span>&nbsp;<span class="op" id="1352362">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="1352365">len</span><span class="op" id="1352368">(</span><span class="ident" id="1352369">d</span><span class="op" id="1352370">.</span><span class="ident" id="1352371">Specs</span><span class="op" id="1352376">)</span>&nbsp;<span class="op" id="1352378">==</span>&nbsp;<span class="num" id="1352381">1</span>&nbsp;<span class="op" id="1352383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352391">cg</span>&nbsp;<span class="op" id="1352394">=</span>&nbsp;<span class="ident" id="1352396">d</span><span class="op" id="1352397">.</span><span class="ident" id="1352398">Doc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352407">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352414">if</span>&nbsp;<span class="ident" id="1352417">cg</span>&nbsp;<span class="op" id="1352420">!=</span>&nbsp;<span class="ident" id="1352423">nil</span>&nbsp;<span class="op" id="1352427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352435">if</span>&nbsp;<span class="ident" id="1352438">err</span>&nbsp;<span class="op" id="1352442">:=</span>&nbsp;<span class="ident" id="1352445">ctxt</span><span class="op" id="1352449">.</span><span class="ident" id="1352450">saveCgo</span><span class="op" id="1352457">(</span><span class="ident" id="1352458">filename</span><span class="op" id="1352466">,</span>&nbsp;<span class="ident" id="1352468">p</span><span class="op" id="1352469">,</span>&nbsp;<span class="ident" id="1352471">cg</span><span class="op" id="1352473">)</span><span class="op" id="1352474">;</span>&nbsp;<span class="ident" id="1352476">err</span>&nbsp;<span class="op" id="1352480">!=</span>&nbsp;<span class="ident" id="1352483">nil</span>&nbsp;<span class="op" id="1352487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352496">return</span>&nbsp;<span class="ident" id="1352503">p</span><span class="op" id="1352504">,</span>&nbsp;<span class="ident" id="1352506">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352523">}</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352530">isCgo</span>&nbsp;<span class="op" id="1352536">=</span>&nbsp;<span class="builtintype" id="1352538">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352560">if</span>&nbsp;<span class="ident" id="1352563">isCgo</span>&nbsp;<span class="op" id="1352569">{</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352574">allTags</span><span class="op" id="1352581">[</span><span class="string" id="1352582">&#34;cgo&#34;</span><span class="op" id="1352587">]</span>&nbsp;<span class="op" id="1352589">=</span>&nbsp;<span class="builtintype" id="1352591">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352599">if</span>&nbsp;<span class="ident" id="1352602">ctxt</span><span class="op" id="1352606">.</span><span class="ident" id="1352607">CgoEnabled</span>&nbsp;<span class="op" id="1352618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352624">p</span><span class="op" id="1352625">.</span><span class="ident" id="1352626">CgoFiles</span>&nbsp;<span class="op" id="1352635">=</span>&nbsp;<span class="builtinfunc" id="1352637">append</span><span class="op" id="1352643">(</span><span class="ident" id="1352644">p</span><span class="op" id="1352645">.</span><span class="ident" id="1352646">CgoFiles</span><span class="op" id="1352654">,</span>&nbsp;<span class="ident" id="1352656">name</span><span class="op" id="1352660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352665">}</span>&nbsp;<span class="keyword" id="1352667">else</span>&nbsp;<span class="op" id="1352672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352678">p</span><span class="op" id="1352679">.</span><span class="ident" id="1352680">IgnoredGoFiles</span>&nbsp;<span class="op" id="1352695">=</span>&nbsp;<span class="builtinfunc" id="1352697">append</span><span class="op" id="1352703">(</span><span class="ident" id="1352704">p</span><span class="op" id="1352705">.</span><span class="ident" id="1352706">IgnoredGoFiles</span><span class="op" id="1352720">,</span>&nbsp;<span class="ident" id="1352722">name</span><span class="op" id="1352726">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352735">}</span>&nbsp;<span class="keyword" id="1352737">else</span>&nbsp;<span class="keyword" id="1352742">if</span>&nbsp;<span class="ident" id="1352745">isXTest</span>&nbsp;<span class="op" id="1352753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352758">p</span><span class="op" id="1352759">.</span><span class="ident" id="1352760">XTestGoFiles</span>&nbsp;<span class="op" id="1352773">=</span>&nbsp;<span class="builtinfunc" id="1352775">append</span><span class="op" id="1352781">(</span><span class="ident" id="1352782">p</span><span class="op" id="1352783">.</span><span class="ident" id="1352784">XTestGoFiles</span><span class="op" id="1352796">,</span>&nbsp;<span class="ident" id="1352798">name</span><span class="op" id="1352802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352806">}</span>&nbsp;<span class="keyword" id="1352808">else</span>&nbsp;<span class="keyword" id="1352813">if</span>&nbsp;<span class="ident" id="1352816">isTest</span>&nbsp;<span class="op" id="1352823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352828">p</span><span class="op" id="1352829">.</span><span class="ident" id="1352830">TestGoFiles</span>&nbsp;<span class="op" id="1352842">=</span>&nbsp;<span class="builtinfunc" id="1352844">append</span><span class="op" id="1352850">(</span><span class="ident" id="1352851">p</span><span class="op" id="1352852">.</span><span class="ident" id="1352853">TestGoFiles</span><span class="op" id="1352864">,</span>&nbsp;<span class="ident" id="1352866">name</span><span class="op" id="1352870">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352874">}</span>&nbsp;<span class="keyword" id="1352876">else</span>&nbsp;<span class="op" id="1352881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1352886">p</span><span class="op" id="1352887">.</span><span class="ident" id="1352888">GoFiles</span>&nbsp;<span class="op" id="1352896">=</span>&nbsp;<span class="builtinfunc" id="1352898">append</span><span class="op" id="1352904">(</span><span class="ident" id="1352905">p</span><span class="op" id="1352906">.</span><span class="ident" id="1352907">GoFiles</span><span class="op" id="1352914">,</span>&nbsp;<span class="ident" id="1352916">name</span><span class="op" id="1352920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1352927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1352930">if</span>&nbsp;<span class="builtinfunc" id="1352933">len</span><span class="op" id="1352936">(</span><span class="ident" id="1352937">p</span><span class="op" id="1352938">.</span><span class="ident" id="1352939">GoFiles</span><span class="op" id="1352946">)</span><span class="op" id="1352947">+</span><span class="builtinfunc" id="1352948">len</span><span class="op" id="1352951">(</span><span class="ident" id="1352952">p</span><span class="op" id="1352953">.</span><span class="ident" id="1352954">CgoFiles</span><span class="op" id="1352962">)</span><span class="op" id="1352963">+</span><span class="builtinfunc" id="1352964">len</span><span class="op" id="1352967">(</span><span class="ident" id="1352968">p</span><span class="op" id="1352969">.</span><span class="ident" id="1352970">TestGoFiles</span><span class="op" id="1352981">)</span><span class="op" id="1352982">+</span><span class="builtinfunc" id="1352983">len</span><span class="op" id="1352986">(</span><span class="ident" id="1352987">p</span><span class="op" id="1352988">.</span><span class="ident" id="1352989">XTestGoFiles</span><span class="op" id="1353001">)</span>&nbsp;<span class="op" id="1353003">==</span>&nbsp;<span class="num" id="1353006">0</span>&nbsp;<span class="op" id="1353008">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1353012">return</span>&nbsp;<span class="ident" id="1353019">p</span><span class="op" id="1353020">,</span>&nbsp;<span class="op" id="1353022">&amp;</span><span class="ident" id="1353023">NoGoError</span><span class="op" id="1353032">{</span><span class="ident" id="1353033">p</span><span class="op" id="1353034">.</span><span class="ident" id="1353035">Dir</span><span class="op" id="1353038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1353041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1353045">for</span>&nbsp;<span class="ident" id="1353049">tag</span>&nbsp;<span class="op" id="1353053">:=</span>&nbsp;<span class="keyword" id="1353056">range</span>&nbsp;<span class="ident" id="1353062">allTags</span>&nbsp;<span class="op" id="1353070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1353074">p</span><span class="op" id="1353075">.</span><span class="ident" id="1353076">AllTags</span>&nbsp;<span class="op" id="1353084">=</span>&nbsp;<span class="builtinfunc" id="1353086">append</span><span class="op" id="1353092">(</span><span class="ident" id="1353093">p</span><span class="op" id="1353094">.</span><span class="ident" id="1353095">AllTags</span><span class="op" id="1353102">,</span>&nbsp;<span class="ident" id="1353104">tag</span><span class="op" id="1353107">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1353110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1353113">sort</span><span class="op" id="1353117">.</span><span class="ident" id="1353118">Strings</span><span class="op" id="1353125">(</span><span class="ident" id="1353126">p</span><span class="op" id="1353127">.</span><span class="ident" id="1353128">AllTags</span><span class="op" id="1353135">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1353139">p</span><span class="op" id="1353140">.</span><span class="ident" id="1353141">Imports</span><span class="op" id="1353148">,</span>&nbsp;<span class="ident" id="1353150">p</span><span class="op" id="1353151">.</span><span class="ident" id="1353152">ImportPos</span>&nbsp;<span class="op" id="1353162">=</span>&nbsp;<span class="ident" id="1353164">cleanImports</span><span class="op" id="1353176">(</span><span class="ident" id="1353177">imported</span><span class="op" id="1353185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1353188">p</span><span class="op" id="1353189">.</span><span class="ident" id="1353190">TestImports</span><span class="op" id="1353201">,</span>&nbsp;<span class="ident" id="1353203">p</span><span class="op" id="1353204">.</span><span class="ident" id="1353205">TestImportPos</span>&nbsp;<span class="op" id="1353219">=</span>&nbsp;<span class="ident" id="1353221">cleanImports</span><span class="op" id="1353233">(</span><span class="ident" id="1353234">testImported</span><span class="op" id="1353246">)</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1353249">p</span><span class="op" id="1353250">.</span><span class="ident" id="1353251">XTestImports</span><span class="op" id="1353263">,</span>&nbsp;<span class="ident" id="1353265">p</span><span class="op" id="1353266">.</span><span class="ident" id="1353267">XTestImportPos</span>&nbsp;<span class="op" id="1353282">=</span>&nbsp;<span class="ident" id="1353284">cleanImports</span><span class="op" id="1353296">(</span><span class="ident" id="1353297">xTestImported</span><span class="op" id="1353310">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1353314">//&nbsp;add&nbsp;the&nbsp;.S&nbsp;files&nbsp;only&nbsp;if&nbsp;we&nbsp;are&nbsp;using&nbsp;cgo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1353360">//&nbsp;(which&nbsp;means&nbsp;gcc&nbsp;will&nbsp;compile&nbsp;them).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1353401">//&nbsp;The&nbsp;standard&nbsp;assemblers&nbsp;expect&nbsp;.s&nbsp;files.</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1353446">if</span>&nbsp;<span class="builtinfunc" id="1353449">len</span><span class="op" id="1353452">(</span><span class="ident" id="1353453">p</span><span class="op" id="1353454">.</span><span class="ident" id="1353455">CgoFiles</span><span class="op" id="1353463">)</span>&nbsp;<span class="op" id="1353465">&gt;</span>&nbsp;<span class="num" id="1353467">0</span>&nbsp;<span class="op" id="1353469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1353473">p</span><span class="op" id="1353474">.</span><span class="ident" id="1353475">SFiles</span>&nbsp;<span class="op" id="1353482">=</span>&nbsp;<span class="builtinfunc" id="1353484">append</span><span class="op" id="1353490">(</span><span class="ident" id="1353491">p</span><span class="op" id="1353492">.</span><span class="ident" id="1353493">SFiles</span><span class="op" id="1353499">,</span>&nbsp;<span class="ident" id="1353501">Sfiles</span><span class="op" id="1353507">...</span><span class="op" id="1353510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1353514">sort</span><span class="op" id="1353518">.</span><span class="ident" id="1353519">Strings</span><span class="op" id="1353526">(</span><span class="ident" id="1353527">p</span><span class="op" id="1353528">.</span><span class="ident" id="1353529">SFiles</span><span class="op" id="1353535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1353538">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1353542">return</span>&nbsp;<span class="ident" id="1353549">p</span><span class="op" id="1353550">,</span>&nbsp;<span class="ident" id="1353552">pkgerr</span><br>
<span class="lineno"></span><span class="op" id="1353559">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1353562">func</span>&nbsp;<span class="ident" id="1353567">findImportComment</span><span class="op" id="1353584">(</span><span class="ident" id="1353585">data</span>&nbsp;<span class="op" id="1353590">[</span><span class="op" id="1353591">]</span><span class="builtintype" id="1353592">byte</span><span class="op" id="1353596">)</span>&nbsp;<span class="op" id="1353598">(</span><span class="ident" id="1353599">s</span>&nbsp;<span class="builtintype" id="1353601">string</span><span class="op" id="1353607">,</span>&nbsp;<span class="ident" id="1353609">line</span>&nbsp;<span class="builtintype" id="1353614">int</span><span class="op" id="1353617">)</span>&nbsp;<span class="op" id="1353619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1353622">//&nbsp;expect&nbsp;keyword&nbsp;package</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1353649">word</span><span class="op" id="1353653">,</span>&nbsp;<span class="ident" id="1353655">data</span>&nbsp;<span class="op" id="1353660">:=</span>&nbsp;<span class="ident" id="1353663">parseWord</span><span class="op" id="1353672">(</span><span class="ident" id="1353673">data</span><span class="op" id="1353677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1353680">if</span>&nbsp;<span class="builtintype" id="1353683">string</span><span class="op" id="1353689">(</span><span class="ident" id="1353690">word</span><span class="op" id="1353694">)</span>&nbsp;<span class="op" id="1353696">!=</span>&nbsp;<span class="string" id="1353699">&#34;package&#34;</span>&nbsp;<span class="op" id="1353709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1353713">return</span>&nbsp;<span class="string" id="1353720">&#34;&#34;</span><span class="op" id="1353722">,</span>&nbsp;<span class="num" id="1353724">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1353727">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1353731">//&nbsp;expect&nbsp;package&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1353755">_</span><span class="op" id="1353756">,</span>&nbsp;<span class="ident" id="1353758">data</span>&nbsp;<span class="op" id="1353763">=</span>&nbsp;<span class="ident" id="1353765">parseWord</span><span class="op" id="1353774">(</span><span class="ident" id="1353775">data</span><span class="op" id="1353779">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1353783">//&nbsp;now&nbsp;ready&nbsp;for&nbsp;import&nbsp;comment,&nbsp;a&nbsp;//&nbsp;or&nbsp;/*&nbsp;*/&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1353839">//&nbsp;beginning&nbsp;and&nbsp;ending&nbsp;on&nbsp;the&nbsp;current&nbsp;line.</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1353885">for</span>&nbsp;<span class="builtinfunc" id="1353889">len</span><span class="op" id="1353892">(</span><span class="ident" id="1353893">data</span><span class="op" id="1353897">)</span>&nbsp;<span class="op" id="1353899">&gt;</span>&nbsp;<span class="num" id="1353901">0</span>&nbsp;<span class="op" id="1353903">&amp;&amp;</span>&nbsp;<span class="op" id="1353906">(</span><span class="ident" id="1353907">data</span><span class="op" id="1353911">[</span><span class="num" id="1353912">0</span><span class="op" id="1353913">]</span>&nbsp;<span class="op" id="1353915">==</span>&nbsp;<span class="string" id="1353918">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="1353922">||</span>&nbsp;<span class="ident" id="1353925">data</span><span class="op" id="1353929">[</span><span class="num" id="1353930">0</span><span class="op" id="1353931">]</span>&nbsp;<span class="op" id="1353933">==</span>&nbsp;<span class="string" id="1353936">&#39;\t&#39;</span>&nbsp;<span class="op" id="1353941">||</span>&nbsp;<span class="ident" id="1353944">data</span><span class="op" id="1353948">[</span><span class="num" id="1353949">0</span><span class="op" id="1353950">]</span>&nbsp;<span class="op" id="1353952">==</span>&nbsp;<span class="string" id="1353955">&#39;\r&#39;</span><span class="op" id="1353959">)</span>&nbsp;<span class="op" id="1353961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1353965">data</span>&nbsp;<span class="op" id="1353970">=</span>&nbsp;<span class="ident" id="1353972">data</span><span class="op" id="1353976">[</span><span class="num" id="1353977">1</span><span class="op" id="1353978">:</span><span class="op" id="1353979">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1353982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1353986">var</span>&nbsp;<span class="ident" id="1353990">comment</span>&nbsp;<span class="op" id="1353998">[</span><span class="op" id="1353999">]</span><span class="builtintype" id="1354000">byte</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354006">switch</span>&nbsp;<span class="op" id="1354013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354016">case</span>&nbsp;<span class="ident" id="1354021">bytes</span><span class="op" id="1354026">.</span><span class="ident" id="1354027">HasPrefix</span><span class="op" id="1354036">(</span><span class="ident" id="1354037">data</span><span class="op" id="1354041">,</span>&nbsp;<span class="ident" id="1354043">slashSlash</span><span class="op" id="1354053">)</span><span class="op" id="1354054">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354058">i</span>&nbsp;<span class="op" id="1354060">:=</span>&nbsp;<span class="ident" id="1354063">bytes</span><span class="op" id="1354068">.</span><span class="ident" id="1354069">Index</span><span class="op" id="1354074">(</span><span class="ident" id="1354075">data</span><span class="op" id="1354079">,</span>&nbsp;<span class="ident" id="1354081">newline</span><span class="op" id="1354088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354092">if</span>&nbsp;<span class="ident" id="1354095">i</span>&nbsp;<span class="op" id="1354097">&lt;</span>&nbsp;<span class="num" id="1354099">0</span>&nbsp;<span class="op" id="1354101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354106">i</span>&nbsp;<span class="op" id="1354108">=</span>&nbsp;<span class="builtinfunc" id="1354110">len</span><span class="op" id="1354113">(</span><span class="ident" id="1354114">data</span><span class="op" id="1354118">)</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1354122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354126">comment</span>&nbsp;<span class="op" id="1354134">=</span>&nbsp;<span class="ident" id="1354136">data</span><span class="op" id="1354140">[</span><span class="num" id="1354141">2</span><span class="op" id="1354142">:</span><span class="ident" id="1354143">i</span><span class="op" id="1354144">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354147">case</span>&nbsp;<span class="ident" id="1354152">bytes</span><span class="op" id="1354157">.</span><span class="ident" id="1354158">HasPrefix</span><span class="op" id="1354167">(</span><span class="ident" id="1354168">data</span><span class="op" id="1354172">,</span>&nbsp;<span class="ident" id="1354174">slashStar</span><span class="op" id="1354183">)</span><span class="op" id="1354184">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354188">data</span>&nbsp;<span class="op" id="1354193">=</span>&nbsp;<span class="ident" id="1354195">data</span><span class="op" id="1354199">[</span><span class="num" id="1354200">2</span><span class="op" id="1354201">:</span><span class="op" id="1354202">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354206">i</span>&nbsp;<span class="op" id="1354208">:=</span>&nbsp;<span class="ident" id="1354211">bytes</span><span class="op" id="1354216">.</span><span class="ident" id="1354217">Index</span><span class="op" id="1354222">(</span><span class="ident" id="1354223">data</span><span class="op" id="1354227">,</span>&nbsp;<span class="ident" id="1354229">starSlash</span><span class="op" id="1354238">)</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354242">if</span>&nbsp;<span class="ident" id="1354245">i</span>&nbsp;<span class="op" id="1354247">&lt;</span>&nbsp;<span class="num" id="1354249">0</span>&nbsp;<span class="op" id="1354251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1354256">//&nbsp;malformed&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354280">return</span>&nbsp;<span class="string" id="1354287">&#34;&#34;</span><span class="op" id="1354289">,</span>&nbsp;<span class="num" id="1354291">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1354295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354299">comment</span>&nbsp;<span class="op" id="1354307">=</span>&nbsp;<span class="ident" id="1354309">data</span><span class="op" id="1354313">[</span><span class="op" id="1354314">:</span><span class="ident" id="1354315">i</span><span class="op" id="1354316">]</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354320">if</span>&nbsp;<span class="ident" id="1354323">bytes</span><span class="op" id="1354328">.</span><span class="ident" id="1354329">Contains</span><span class="op" id="1354337">(</span><span class="ident" id="1354338">comment</span><span class="op" id="1354345">,</span>&nbsp;<span class="ident" id="1354347">newline</span><span class="op" id="1354354">)</span>&nbsp;<span class="op" id="1354356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354361">return</span>&nbsp;<span class="string" id="1354368">&#34;&#34;</span><span class="op" id="1354370">,</span>&nbsp;<span class="num" id="1354372">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1354376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1354379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354382">comment</span>&nbsp;<span class="op" id="1354390">=</span>&nbsp;<span class="ident" id="1354392">bytes</span><span class="op" id="1354397">.</span><span class="ident" id="1354398">TrimSpace</span><span class="op" id="1354407">(</span><span class="ident" id="1354408">comment</span><span class="op" id="1354415">)</span><br>
<span class="lineno">830</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1354419">//&nbsp;split&nbsp;comment&nbsp;into&nbsp;`import`,&nbsp;`&#34;pkg&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354460">word</span><span class="op" id="1354464">,</span>&nbsp;<span class="ident" id="1354466">arg</span>&nbsp;<span class="op" id="1354470">:=</span>&nbsp;<span class="ident" id="1354473">parseWord</span><span class="op" id="1354482">(</span><span class="ident" id="1354483">comment</span><span class="op" id="1354490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354493">if</span>&nbsp;<span class="builtintype" id="1354496">string</span><span class="op" id="1354502">(</span><span class="ident" id="1354503">word</span><span class="op" id="1354507">)</span>&nbsp;<span class="op" id="1354509">!=</span>&nbsp;<span class="string" id="1354512">&#34;import&#34;</span>&nbsp;<span class="op" id="1354521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354525">return</span>&nbsp;<span class="string" id="1354532">&#34;&#34;</span><span class="op" id="1354534">,</span>&nbsp;<span class="num" id="1354536">0</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1354539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354543">line</span>&nbsp;<span class="op" id="1354548">=</span>&nbsp;<span class="num" id="1354550">1</span>&nbsp;<span class="op" id="1354552">+</span>&nbsp;<span class="ident" id="1354554">bytes</span><span class="op" id="1354559">.</span><span class="ident" id="1354560">Count</span><span class="op" id="1354565">(</span><span class="ident" id="1354566">data</span><span class="op" id="1354570">[</span><span class="op" id="1354571">:</span><span class="builtinfunc" id="1354572">cap</span><span class="op" id="1354575">(</span><span class="ident" id="1354576">data</span><span class="op" id="1354580">)</span><span class="op" id="1354581">-</span><span class="builtinfunc" id="1354582">cap</span><span class="op" id="1354585">(</span><span class="ident" id="1354586">arg</span><span class="op" id="1354589">)</span><span class="op" id="1354590">]</span><span class="op" id="1354591">,</span>&nbsp;<span class="ident" id="1354593">newline</span><span class="op" id="1354600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354603">return</span>&nbsp;<span class="ident" id="1354610">strings</span><span class="op" id="1354617">.</span><span class="ident" id="1354618">TrimSpace</span><span class="op" id="1354627">(</span><span class="builtintype" id="1354628">string</span><span class="op" id="1354634">(</span><span class="ident" id="1354635">arg</span><span class="op" id="1354638">)</span><span class="op" id="1354639">)</span><span class="op" id="1354640">,</span>&nbsp;<span class="ident" id="1354642">line</span><br>
<span class="lineno"></span><span class="op" id="1354647">}</span><br>
<span class="lineno">840</span><br>
<span class="lineno"></span><span class="keyword" id="1354650">var</span>&nbsp;<span class="op" id="1354654">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354657">slashSlash</span>&nbsp;<span class="op" id="1354668">=</span>&nbsp;<span class="op" id="1354670">[</span><span class="op" id="1354671">]</span><span class="builtintype" id="1354672">byte</span><span class="op" id="1354676">(</span><span class="string" id="1354677">&#34;//&#34;</span><span class="op" id="1354681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354684">slashStar</span>&nbsp;&nbsp;<span class="op" id="1354695">=</span>&nbsp;<span class="op" id="1354697">[</span><span class="op" id="1354698">]</span><span class="builtintype" id="1354699">byte</span><span class="op" id="1354703">(</span><span class="string" id="1354704">&#34;/*&#34;</span><span class="op" id="1354708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354711">starSlash</span>&nbsp;&nbsp;<span class="op" id="1354722">=</span>&nbsp;<span class="op" id="1354724">[</span><span class="op" id="1354725">]</span><span class="builtintype" id="1354726">byte</span><span class="op" id="1354730">(</span><span class="string" id="1354731">&#34;*/&#34;</span><span class="op" id="1354735">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354738">newline</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1354749">=</span>&nbsp;<span class="op" id="1354751">[</span><span class="op" id="1354752">]</span><span class="builtintype" id="1354753">byte</span><span class="op" id="1354757">(</span><span class="string" id="1354758">&#34;\n&#34;</span><span class="op" id="1354762">)</span><br>
<span class="lineno"></span><span class="op" id="1354764">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1354767">//&nbsp;skipSpaceOrComment&nbsp;returns&nbsp;data&nbsp;with&nbsp;any&nbsp;leading&nbsp;spaces&nbsp;or&nbsp;comments&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="1354847">func</span>&nbsp;<span class="ident" id="1354852">skipSpaceOrComment</span><span class="op" id="1354870">(</span><span class="ident" id="1354871">data</span>&nbsp;<span class="op" id="1354876">[</span><span class="op" id="1354877">]</span><span class="builtintype" id="1354878">byte</span><span class="op" id="1354882">)</span>&nbsp;<span class="op" id="1354884">[</span><span class="op" id="1354885">]</span><span class="builtintype" id="1354886">byte</span>&nbsp;<span class="op" id="1354891">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354894">for</span>&nbsp;<span class="builtinfunc" id="1354898">len</span><span class="op" id="1354901">(</span><span class="ident" id="1354902">data</span><span class="op" id="1354906">)</span>&nbsp;<span class="op" id="1354908">&gt;</span>&nbsp;<span class="num" id="1354910">0</span>&nbsp;<span class="op" id="1354912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354916">switch</span>&nbsp;<span class="ident" id="1354923">data</span><span class="op" id="1354927">[</span><span class="num" id="1354928">0</span><span class="op" id="1354929">]</span>&nbsp;<span class="op" id="1354931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354935">case</span>&nbsp;<span class="string" id="1354940">&#39;&nbsp;&#39;</span><span class="op" id="1354943">,</span>&nbsp;<span class="string" id="1354945">&#39;\t&#39;</span><span class="op" id="1354949">,</span>&nbsp;<span class="string" id="1354951">&#39;\r&#39;</span><span class="op" id="1354955">,</span>&nbsp;<span class="string" id="1354957">&#39;\n&#39;</span><span class="op" id="1354961">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1354966">data</span>&nbsp;<span class="op" id="1354971">=</span>&nbsp;<span class="ident" id="1354973">data</span><span class="op" id="1354977">[</span><span class="num" id="1354978">1</span><span class="op" id="1354979">:</span><span class="op" id="1354980">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354985">continue</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1354996">case</span>&nbsp;<span class="string" id="1355001">&#39;/&#39;</span><span class="op" id="1355004">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355009">if</span>&nbsp;<span class="ident" id="1355012">bytes</span><span class="op" id="1355017">.</span><span class="ident" id="1355018">HasPrefix</span><span class="op" id="1355027">(</span><span class="ident" id="1355028">data</span><span class="op" id="1355032">,</span>&nbsp;<span class="ident" id="1355034">slashSlash</span><span class="op" id="1355044">)</span>&nbsp;<span class="op" id="1355046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355052">i</span>&nbsp;<span class="op" id="1355054">:=</span>&nbsp;<span class="ident" id="1355057">bytes</span><span class="op" id="1355062">.</span><span class="ident" id="1355063">Index</span><span class="op" id="1355068">(</span><span class="ident" id="1355069">data</span><span class="op" id="1355073">,</span>&nbsp;<span class="ident" id="1355075">newline</span><span class="op" id="1355082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355088">if</span>&nbsp;<span class="ident" id="1355091">i</span>&nbsp;<span class="op" id="1355093">&lt;</span>&nbsp;<span class="num" id="1355095">0</span>&nbsp;<span class="op" id="1355097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355104">return</span>&nbsp;<span class="ident" id="1355111">nil</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1355119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355125">data</span>&nbsp;<span class="op" id="1355130">=</span>&nbsp;<span class="ident" id="1355132">data</span><span class="op" id="1355136">[</span><span class="ident" id="1355137">i</span><span class="op" id="1355138">+</span><span class="num" id="1355139">1</span><span class="op" id="1355140">:</span><span class="op" id="1355141">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355147">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1355159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355164">if</span>&nbsp;<span class="ident" id="1355167">bytes</span><span class="op" id="1355172">.</span><span class="ident" id="1355173">HasPrefix</span><span class="op" id="1355182">(</span><span class="ident" id="1355183">data</span><span class="op" id="1355187">,</span>&nbsp;<span class="ident" id="1355189">slashStar</span><span class="op" id="1355198">)</span>&nbsp;<span class="op" id="1355200">{</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355206">data</span>&nbsp;<span class="op" id="1355211">=</span>&nbsp;<span class="ident" id="1355213">data</span><span class="op" id="1355217">[</span><span class="num" id="1355218">2</span><span class="op" id="1355219">:</span><span class="op" id="1355220">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355226">i</span>&nbsp;<span class="op" id="1355228">:=</span>&nbsp;<span class="ident" id="1355231">bytes</span><span class="op" id="1355236">.</span><span class="ident" id="1355237">Index</span><span class="op" id="1355242">(</span><span class="ident" id="1355243">data</span><span class="op" id="1355247">,</span>&nbsp;<span class="ident" id="1355249">starSlash</span><span class="op" id="1355258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355264">if</span>&nbsp;<span class="ident" id="1355267">i</span>&nbsp;<span class="op" id="1355269">&lt;</span>&nbsp;<span class="num" id="1355271">0</span>&nbsp;<span class="op" id="1355273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355280">return</span>&nbsp;<span class="ident" id="1355287">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1355295">}</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355301">data</span>&nbsp;<span class="op" id="1355306">=</span>&nbsp;<span class="ident" id="1355308">data</span><span class="op" id="1355312">[</span><span class="ident" id="1355313">i</span><span class="op" id="1355314">+</span><span class="num" id="1355315">2</span><span class="op" id="1355316">:</span><span class="op" id="1355317">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355323">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1355335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1355339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355343">break</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1355350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355353">return</span>&nbsp;<span class="ident" id="1355360">data</span><br>
<span class="lineno"></span><span class="op" id="1355365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1355368">//&nbsp;parseWord&nbsp;skips&nbsp;any&nbsp;leading&nbsp;spaces&nbsp;or&nbsp;comments&nbsp;in&nbsp;data</span><br>
<span class="lineno">880</span><span class="comment" id="1355426">//&nbsp;and&nbsp;then&nbsp;parses&nbsp;the&nbsp;beginning&nbsp;of&nbsp;data&nbsp;as&nbsp;an&nbsp;identifier&nbsp;or&nbsp;keyword,</span><br>
<span class="lineno"></span><span class="comment" id="1355496">//&nbsp;returning&nbsp;that&nbsp;word&nbsp;and&nbsp;what&nbsp;remains&nbsp;after&nbsp;the&nbsp;word.</span><br>
<span class="lineno"></span><span class="keyword" id="1355552">func</span>&nbsp;<span class="ident" id="1355557">parseWord</span><span class="op" id="1355566">(</span><span class="ident" id="1355567">data</span>&nbsp;<span class="op" id="1355572">[</span><span class="op" id="1355573">]</span><span class="builtintype" id="1355574">byte</span><span class="op" id="1355578">)</span>&nbsp;<span class="op" id="1355580">(</span><span class="ident" id="1355581">word</span><span class="op" id="1355585">,</span>&nbsp;<span class="ident" id="1355587">rest</span>&nbsp;<span class="op" id="1355592">[</span><span class="op" id="1355593">]</span><span class="builtintype" id="1355594">byte</span><span class="op" id="1355598">)</span>&nbsp;<span class="op" id="1355600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355603">data</span>&nbsp;<span class="op" id="1355608">=</span>&nbsp;<span class="ident" id="1355610">skipSpaceOrComment</span><span class="op" id="1355628">(</span><span class="ident" id="1355629">data</span><span class="op" id="1355633">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1355637">//&nbsp;Parse&nbsp;past&nbsp;leading&nbsp;word&nbsp;characters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355677">rest</span>&nbsp;<span class="op" id="1355682">=</span>&nbsp;<span class="ident" id="1355684">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355690">for</span>&nbsp;<span class="op" id="1355694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355698">r</span><span class="op" id="1355699">,</span>&nbsp;<span class="ident" id="1355701">size</span>&nbsp;<span class="op" id="1355706">:=</span>&nbsp;<span class="ident" id="1355709">utf8</span><span class="op" id="1355713">.</span><span class="ident" id="1355714">DecodeRune</span><span class="op" id="1355724">(</span><span class="ident" id="1355725">rest</span><span class="op" id="1355729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355733">if</span>&nbsp;<span class="ident" id="1355736">unicode</span><span class="op" id="1355743">.</span><span class="ident" id="1355744">IsLetter</span><span class="op" id="1355752">(</span><span class="ident" id="1355753">r</span><span class="op" id="1355754">)</span>&nbsp;<span class="op" id="1355756">||</span>&nbsp;<span class="string" id="1355759">&#39;0&#39;</span>&nbsp;<span class="op" id="1355763">&lt;=</span>&nbsp;<span class="ident" id="1355766">r</span>&nbsp;<span class="op" id="1355768">&amp;&amp;</span>&nbsp;<span class="ident" id="1355771">r</span>&nbsp;<span class="op" id="1355773">&lt;=</span>&nbsp;<span class="string" id="1355776">&#39;9&#39;</span>&nbsp;<span class="op" id="1355780">||</span>&nbsp;<span class="ident" id="1355783">r</span>&nbsp;<span class="op" id="1355785">==</span>&nbsp;<span class="string" id="1355788">&#39;_&#39;</span>&nbsp;<span class="op" id="1355792">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355797">rest</span>&nbsp;<span class="op" id="1355802">=</span>&nbsp;<span class="ident" id="1355804">rest</span><span class="op" id="1355808">[</span><span class="ident" id="1355809">size</span><span class="op" id="1355813">:</span><span class="op" id="1355814">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355819">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1355830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355834">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1355841">}</span><br>
<span class="lineno">895</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1355845">word</span>&nbsp;<span class="op" id="1355850">=</span>&nbsp;<span class="ident" id="1355852">data</span><span class="op" id="1355856">[</span><span class="op" id="1355857">:</span><span class="builtinfunc" id="1355858">len</span><span class="op" id="1355861">(</span><span class="ident" id="1355862">data</span><span class="op" id="1355866">)</span><span class="op" id="1355867">-</span><span class="builtinfunc" id="1355868">len</span><span class="op" id="1355871">(</span><span class="ident" id="1355872">rest</span><span class="op" id="1355876">)</span><span class="op" id="1355877">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355880">if</span>&nbsp;<span class="builtinfunc" id="1355883">len</span><span class="op" id="1355886">(</span><span class="ident" id="1355887">word</span><span class="op" id="1355891">)</span>&nbsp;<span class="op" id="1355893">==</span>&nbsp;<span class="num" id="1355896">0</span>&nbsp;<span class="op" id="1355898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355902">return</span>&nbsp;<span class="ident" id="1355909">nil</span><span class="op" id="1355912">,</span>&nbsp;<span class="ident" id="1355914">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1355919">}</span><br>
<span class="lineno">900</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1355923">return</span>&nbsp;<span class="ident" id="1355930">word</span><span class="op" id="1355934">,</span>&nbsp;<span class="ident" id="1355936">rest</span><br>
<span class="lineno"></span><span class="op" id="1355941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1355944">//&nbsp;MatchFile&nbsp;reports&nbsp;whether&nbsp;the&nbsp;file&nbsp;with&nbsp;the&nbsp;given&nbsp;name&nbsp;in&nbsp;the&nbsp;given&nbsp;directory</span><br>
<span class="lineno">905</span><span class="comment" id="1356025">//&nbsp;matches&nbsp;the&nbsp;context&nbsp;and&nbsp;would&nbsp;be&nbsp;included&nbsp;in&nbsp;a&nbsp;Package&nbsp;created&nbsp;by&nbsp;ImportDir</span><br>
<span class="lineno"></span><span class="comment" id="1356104">//&nbsp;of&nbsp;that&nbsp;directory.</span><br>
<span class="lineno"></span><span class="comment" id="1356126">//</span><br>
<span class="lineno"></span><span class="comment" id="1356129">//&nbsp;MatchFile&nbsp;considers&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;file&nbsp;and&nbsp;may&nbsp;use&nbsp;ctxt.OpenFile&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="1356202">//&nbsp;read&nbsp;some&nbsp;or&nbsp;all&nbsp;of&nbsp;the&nbsp;file&#39;s&nbsp;content.</span><br>
<span class="lineno">910</span><span class="keyword" id="1356245">func</span>&nbsp;<span class="op" id="1356250">(</span><span class="ident" id="1356251">ctxt</span>&nbsp;<span class="op" id="1356256">*</span><span class="ident" id="1356257">Context</span><span class="op" id="1356264">)</span>&nbsp;<span class="ident" id="1356266">MatchFile</span><span class="op" id="1356275">(</span><span class="ident" id="1356276">dir</span><span class="op" id="1356279">,</span>&nbsp;<span class="ident" id="1356281">name</span>&nbsp;<span class="builtintype" id="1356286">string</span><span class="op" id="1356292">)</span>&nbsp;<span class="op" id="1356294">(</span><span class="ident" id="1356295">match</span>&nbsp;<span class="builtintype" id="1356301">bool</span><span class="op" id="1356305">,</span>&nbsp;<span class="ident" id="1356307">err</span>&nbsp;<span class="builtintype" id="1356311">error</span><span class="op" id="1356316">)</span>&nbsp;<span class="op" id="1356318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1356321">match</span><span class="op" id="1356326">,</span>&nbsp;<span class="ident" id="1356328">_</span><span class="op" id="1356329">,</span>&nbsp;<span class="ident" id="1356331">_</span><span class="op" id="1356332">,</span>&nbsp;<span class="ident" id="1356334">err</span>&nbsp;<span class="op" id="1356338">=</span>&nbsp;<span class="ident" id="1356340">ctxt</span><span class="op" id="1356344">.</span><span class="ident" id="1356345">matchFile</span><span class="op" id="1356354">(</span><span class="ident" id="1356355">dir</span><span class="op" id="1356358">,</span>&nbsp;<span class="ident" id="1356360">name</span><span class="op" id="1356364">,</span>&nbsp;<span class="builtintype" id="1356366">false</span><span class="op" id="1356371">,</span>&nbsp;<span class="ident" id="1356373">nil</span><span class="op" id="1356376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1356379">return</span><br>
<span class="lineno"></span><span class="op" id="1356386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">915</span><span class="comment" id="1356389">//&nbsp;matchFile&nbsp;determines&nbsp;whether&nbsp;the&nbsp;file&nbsp;with&nbsp;the&nbsp;given&nbsp;name&nbsp;in&nbsp;the&nbsp;given&nbsp;directory</span><br>
<span class="lineno"></span><span class="comment" id="1356473">//&nbsp;should&nbsp;be&nbsp;included&nbsp;in&nbsp;the&nbsp;package&nbsp;being&nbsp;constructed.</span><br>
<span class="lineno"></span><span class="comment" id="1356529">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;data&nbsp;read&nbsp;from&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="1356572">//&nbsp;If&nbsp;returnImports&nbsp;is&nbsp;true&nbsp;and&nbsp;name&nbsp;denotes&nbsp;a&nbsp;Go&nbsp;program,&nbsp;matchFile&nbsp;reads</span><br>
<span class="lineno"></span><span class="comment" id="1356647">//&nbsp;until&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;imports&nbsp;(and&nbsp;returns&nbsp;that&nbsp;data)&nbsp;even&nbsp;though&nbsp;it&nbsp;only</span><br>
<span class="lineno">920</span><span class="comment" id="1356723">//&nbsp;considers&nbsp;text&nbsp;until&nbsp;the&nbsp;first&nbsp;non-comment.</span><br>
<span class="lineno"></span><span class="comment" id="1356770">//&nbsp;If&nbsp;allTags&nbsp;is&nbsp;non-nil,&nbsp;matchFile&nbsp;records&nbsp;any&nbsp;encountered&nbsp;build&nbsp;tag</span><br>
<span class="lineno"></span><span class="comment" id="1356840">//&nbsp;by&nbsp;setting&nbsp;allTags[tag]&nbsp;=&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="1356875">func</span>&nbsp;<span class="op" id="1356880">(</span><span class="ident" id="1356881">ctxt</span>&nbsp;<span class="op" id="1356886">*</span><span class="ident" id="1356887">Context</span><span class="op" id="1356894">)</span>&nbsp;<span class="ident" id="1356896">matchFile</span><span class="op" id="1356905">(</span><span class="ident" id="1356906">dir</span><span class="op" id="1356909">,</span>&nbsp;<span class="ident" id="1356911">name</span>&nbsp;<span class="builtintype" id="1356916">string</span><span class="op" id="1356922">,</span>&nbsp;<span class="ident" id="1356924">returnImports</span>&nbsp;<span class="builtintype" id="1356938">bool</span><span class="op" id="1356942">,</span>&nbsp;<span class="ident" id="1356944">allTags</span>&nbsp;<span class="keyword" id="1356952">map</span><span class="op" id="1356955">[</span><span class="builtintype" id="1356956">string</span><span class="op" id="1356962">]</span><span class="builtintype" id="1356963">bool</span><span class="op" id="1356967">)</span>&nbsp;<span class="op" id="1356969">(</span><span class="ident" id="1356970">match</span>&nbsp;<span class="builtintype" id="1356976">bool</span><span class="op" id="1356980">,</span>&nbsp;<span class="ident" id="1356982">data</span>&nbsp;<span class="op" id="1356987">[</span><span class="op" id="1356988">]</span><span class="builtintype" id="1356989">byte</span><span class="op" id="1356993">,</span>&nbsp;<span class="ident" id="1356995">filename</span>&nbsp;<span class="builtintype" id="1357004">string</span><span class="op" id="1357010">,</span>&nbsp;<span class="ident" id="1357012">err</span>&nbsp;<span class="builtintype" id="1357016">error</span><span class="op" id="1357021">)</span>&nbsp;<span class="op" id="1357023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357026">if</span>&nbsp;<span class="ident" id="1357029">strings</span><span class="op" id="1357036">.</span><span class="ident" id="1357037">HasPrefix</span><span class="op" id="1357046">(</span><span class="ident" id="1357047">name</span><span class="op" id="1357051">,</span>&nbsp;<span class="string" id="1357053">&#34;_&#34;</span><span class="op" id="1357056">)</span>&nbsp;<span class="op" id="1357058">||</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1357063">strings</span><span class="op" id="1357070">.</span><span class="ident" id="1357071">HasPrefix</span><span class="op" id="1357080">(</span><span class="ident" id="1357081">name</span><span class="op" id="1357085">,</span>&nbsp;<span class="string" id="1357087">&#34;.&#34;</span><span class="op" id="1357090">)</span>&nbsp;<span class="op" id="1357092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357096">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1357104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1357108">i</span>&nbsp;<span class="op" id="1357110">:=</span>&nbsp;<span class="ident" id="1357113">strings</span><span class="op" id="1357120">.</span><span class="ident" id="1357121">LastIndex</span><span class="op" id="1357130">(</span><span class="ident" id="1357131">name</span><span class="op" id="1357135">,</span>&nbsp;<span class="string" id="1357137">&#34;.&#34;</span><span class="op" id="1357140">)</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357143">if</span>&nbsp;<span class="ident" id="1357146">i</span>&nbsp;<span class="op" id="1357148">&lt;</span>&nbsp;<span class="num" id="1357150">0</span>&nbsp;<span class="op" id="1357152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1357156">i</span>&nbsp;<span class="op" id="1357158">=</span>&nbsp;<span class="builtinfunc" id="1357160">len</span><span class="op" id="1357163">(</span><span class="ident" id="1357164">name</span><span class="op" id="1357168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1357171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1357174">ext</span>&nbsp;<span class="op" id="1357178">:=</span>&nbsp;<span class="ident" id="1357181">name</span><span class="op" id="1357185">[</span><span class="ident" id="1357186">i</span><span class="op" id="1357187">:</span><span class="op" id="1357188">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357192">if</span>&nbsp;<span class="op" id="1357195">!</span><span class="ident" id="1357196">ctxt</span><span class="op" id="1357200">.</span><span class="ident" id="1357201">goodOSArchFile</span><span class="op" id="1357215">(</span><span class="ident" id="1357216">name</span><span class="op" id="1357220">,</span>&nbsp;<span class="ident" id="1357222">allTags</span><span class="op" id="1357229">)</span>&nbsp;<span class="op" id="1357231">&amp;&amp;</span>&nbsp;<span class="op" id="1357234">!</span><span class="ident" id="1357235">ctxt</span><span class="op" id="1357239">.</span><span class="ident" id="1357240">UseAllFiles</span>&nbsp;<span class="op" id="1357252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357256">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1357264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357268">switch</span>&nbsp;<span class="ident" id="1357275">ext</span>&nbsp;<span class="op" id="1357279">{</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357282">case</span>&nbsp;<span class="string" id="1357287">&#34;.go&#34;</span><span class="op" id="1357292">,</span>&nbsp;<span class="string" id="1357294">&#34;.c&#34;</span><span class="op" id="1357298">,</span>&nbsp;<span class="string" id="1357300">&#34;.cc&#34;</span><span class="op" id="1357305">,</span>&nbsp;<span class="string" id="1357307">&#34;.cxx&#34;</span><span class="op" id="1357313">,</span>&nbsp;<span class="string" id="1357315">&#34;.cpp&#34;</span><span class="op" id="1357321">,</span>&nbsp;<span class="string" id="1357323">&#34;.m&#34;</span><span class="op" id="1357327">,</span>&nbsp;<span class="string" id="1357329">&#34;.s&#34;</span><span class="op" id="1357333">,</span>&nbsp;<span class="string" id="1357335">&#34;.h&#34;</span><span class="op" id="1357339">,</span>&nbsp;<span class="string" id="1357341">&#34;.hh&#34;</span><span class="op" id="1357346">,</span>&nbsp;<span class="string" id="1357348">&#34;.hpp&#34;</span><span class="op" id="1357354">,</span>&nbsp;<span class="string" id="1357356">&#34;.hxx&#34;</span><span class="op" id="1357362">,</span>&nbsp;<span class="string" id="1357364">&#34;.S&#34;</span><span class="op" id="1357368">,</span>&nbsp;<span class="string" id="1357370">&#34;.swig&#34;</span><span class="op" id="1357377">,</span>&nbsp;<span class="string" id="1357379">&#34;.swigcxx&#34;</span><span class="op" id="1357389">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1357393">//&nbsp;tentatively&nbsp;okay&nbsp;-&nbsp;read&nbsp;to&nbsp;make&nbsp;sure</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357434">case</span>&nbsp;<span class="string" id="1357439">&#34;.syso&#34;</span><span class="op" id="1357446">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1357450">//&nbsp;binary,&nbsp;no&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1357474">match</span>&nbsp;<span class="op" id="1357480">=</span>&nbsp;<span class="builtintype" id="1357482">true</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357489">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357497">default</span><span class="op" id="1357504">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1357508">//&nbsp;skip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357518">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1357526">}</span><br>
<span class="lineno">950</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1357530">filename</span>&nbsp;<span class="op" id="1357539">=</span>&nbsp;<span class="ident" id="1357541">ctxt</span><span class="op" id="1357545">.</span><span class="ident" id="1357546">joinPath</span><span class="op" id="1357554">(</span><span class="ident" id="1357555">dir</span><span class="op" id="1357558">,</span>&nbsp;<span class="ident" id="1357560">name</span><span class="op" id="1357564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1357567">f</span><span class="op" id="1357568">,</span>&nbsp;<span class="ident" id="1357570">err</span>&nbsp;<span class="op" id="1357574">:=</span>&nbsp;<span class="ident" id="1357577">ctxt</span><span class="op" id="1357581">.</span><span class="ident" id="1357582">openFile</span><span class="op" id="1357590">(</span><span class="ident" id="1357591">filename</span><span class="op" id="1357599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357602">if</span>&nbsp;<span class="ident" id="1357605">err</span>&nbsp;<span class="op" id="1357609">!=</span>&nbsp;<span class="ident" id="1357612">nil</span>&nbsp;<span class="op" id="1357616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357620">return</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1357628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357632">if</span>&nbsp;<span class="ident" id="1357635">strings</span><span class="op" id="1357642">.</span><span class="ident" id="1357643">HasSuffix</span><span class="op" id="1357652">(</span><span class="ident" id="1357653">filename</span><span class="op" id="1357661">,</span>&nbsp;<span class="string" id="1357663">&#34;.go&#34;</span><span class="op" id="1357668">)</span>&nbsp;<span class="op" id="1357670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1357674">data</span><span class="op" id="1357678">,</span>&nbsp;<span class="ident" id="1357680">err</span>&nbsp;<span class="op" id="1357684">=</span>&nbsp;<span class="ident" id="1357686">readImports</span><span class="op" id="1357697">(</span><span class="ident" id="1357698">f</span><span class="op" id="1357699">,</span>&nbsp;<span class="builtintype" id="1357701">false</span><span class="op" id="1357706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1357709">}</span>&nbsp;<span class="keyword" id="1357711">else</span>&nbsp;<span class="op" id="1357716">{</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1357720">data</span><span class="op" id="1357724">,</span>&nbsp;<span class="ident" id="1357726">err</span>&nbsp;<span class="op" id="1357730">=</span>&nbsp;<span class="ident" id="1357732">readComments</span><span class="op" id="1357744">(</span><span class="ident" id="1357745">f</span><span class="op" id="1357746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1357749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1357752">f</span><span class="op" id="1357753">.</span><span class="ident" id="1357754">Close</span><span class="op" id="1357759">(</span><span class="op" id="1357760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357763">if</span>&nbsp;<span class="ident" id="1357766">err</span>&nbsp;<span class="op" id="1357770">!=</span>&nbsp;<span class="ident" id="1357773">nil</span>&nbsp;<span class="op" id="1357777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1357781">err</span>&nbsp;<span class="op" id="1357785">=</span>&nbsp;<span class="ident" id="1357787">fmt</span><span class="op" id="1357790">.</span><span class="ident" id="1357791">Errorf</span><span class="op" id="1357797">(</span><span class="string" id="1357798">&#34;read&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="1357811">,</span>&nbsp;<span class="ident" id="1357813">filename</span><span class="op" id="1357821">,</span>&nbsp;<span class="ident" id="1357823">err</span><span class="op" id="1357826">)</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357830">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1357838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1357842">//&nbsp;Look&nbsp;for&nbsp;+build&nbsp;comments&nbsp;to&nbsp;accept&nbsp;or&nbsp;reject&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357901">if</span>&nbsp;<span class="op" id="1357904">!</span><span class="ident" id="1357905">ctxt</span><span class="op" id="1357909">.</span><span class="ident" id="1357910">shouldBuild</span><span class="op" id="1357921">(</span><span class="ident" id="1357922">data</span><span class="op" id="1357926">,</span>&nbsp;<span class="ident" id="1357928">allTags</span><span class="op" id="1357935">)</span>&nbsp;<span class="op" id="1357937">&amp;&amp;</span>&nbsp;<span class="op" id="1357940">!</span><span class="ident" id="1357941">ctxt</span><span class="op" id="1357945">.</span><span class="ident" id="1357946">UseAllFiles</span>&nbsp;<span class="op" id="1357958">{</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357962">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1357970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1357974">match</span>&nbsp;<span class="op" id="1357980">=</span>&nbsp;<span class="builtintype" id="1357982">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1357988">return</span><br>
<span class="lineno">975</span><span class="op" id="1357995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1357998">func</span>&nbsp;<span class="ident" id="1358003">cleanImports</span><span class="op" id="1358015">(</span><span class="ident" id="1358016">m</span>&nbsp;<span class="keyword" id="1358018">map</span><span class="op" id="1358021">[</span><span class="builtintype" id="1358022">string</span><span class="op" id="1358028">]</span><span class="op" id="1358029">[</span><span class="op" id="1358030">]</span><span class="ident" id="1358031">token</span><span class="op" id="1358036">.</span><span class="ident" id="1358037">Position</span><span class="op" id="1358045">)</span>&nbsp;<span class="op" id="1358047">(</span><span class="op" id="1358048">[</span><span class="op" id="1358049">]</span><span class="builtintype" id="1358050">string</span><span class="op" id="1358056">,</span>&nbsp;<span class="keyword" id="1358058">map</span><span class="op" id="1358061">[</span><span class="builtintype" id="1358062">string</span><span class="op" id="1358068">]</span><span class="op" id="1358069">[</span><span class="op" id="1358070">]</span><span class="ident" id="1358071">token</span><span class="op" id="1358076">.</span><span class="ident" id="1358077">Position</span><span class="op" id="1358085">)</span>&nbsp;<span class="op" id="1358087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1358090">all</span>&nbsp;<span class="op" id="1358094">:=</span>&nbsp;<span class="builtinfunc" id="1358097">make</span><span class="op" id="1358101">(</span><span class="op" id="1358102">[</span><span class="op" id="1358103">]</span><span class="builtintype" id="1358104">string</span><span class="op" id="1358110">,</span>&nbsp;<span class="num" id="1358112">0</span><span class="op" id="1358113">,</span>&nbsp;<span class="builtinfunc" id="1358115">len</span><span class="op" id="1358118">(</span><span class="ident" id="1358119">m</span><span class="op" id="1358120">)</span><span class="op" id="1358121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1358124">for</span>&nbsp;<span class="ident" id="1358128">path</span>&nbsp;<span class="op" id="1358133">:=</span>&nbsp;<span class="keyword" id="1358136">range</span>&nbsp;<span class="ident" id="1358142">m</span>&nbsp;<span class="op" id="1358144">{</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1358148">all</span>&nbsp;<span class="op" id="1358152">=</span>&nbsp;<span class="builtinfunc" id="1358154">append</span><span class="op" id="1358160">(</span><span class="ident" id="1358161">all</span><span class="op" id="1358164">,</span>&nbsp;<span class="ident" id="1358166">path</span><span class="op" id="1358170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1358173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1358176">sort</span><span class="op" id="1358180">.</span><span class="ident" id="1358181">Strings</span><span class="op" id="1358188">(</span><span class="ident" id="1358189">all</span><span class="op" id="1358192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1358195">return</span>&nbsp;<span class="ident" id="1358202">all</span><span class="op" id="1358205">,</span>&nbsp;<span class="ident" id="1358207">m</span><br>
<span class="lineno"></span><span class="op" id="1358209">}</span><br>
<span class="lineno">985</span><br>
<span class="lineno"></span><span class="comment" id="1358212">//&nbsp;Import&nbsp;is&nbsp;shorthand&nbsp;for&nbsp;Default.Import.</span><br>
<span class="lineno"></span><span class="keyword" id="1358255">func</span>&nbsp;<span class="ident" id="1358260">Import</span><span class="op" id="1358266">(</span><span class="ident" id="1358267">path</span><span class="op" id="1358271">,</span>&nbsp;<span class="ident" id="1358273">srcDir</span>&nbsp;<span class="builtintype" id="1358280">string</span><span class="op" id="1358286">,</span>&nbsp;<span class="ident" id="1358288">mode</span>&nbsp;<span class="ident" id="1358293">ImportMode</span><span class="op" id="1358303">)</span>&nbsp;<span class="op" id="1358305">(</span><span class="op" id="1358306">*</span><span class="ident" id="1358307">Package</span><span class="op" id="1358314">,</span>&nbsp;<span class="builtintype" id="1358316">error</span><span class="op" id="1358321">)</span>&nbsp;<span class="op" id="1358323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1358326">return</span>&nbsp;<span class="ident" id="1358333">Default</span><span class="op" id="1358340">.</span><span class="ident" id="1358341">Import</span><span class="op" id="1358347">(</span><span class="ident" id="1358348">path</span><span class="op" id="1358352">,</span>&nbsp;<span class="ident" id="1358354">srcDir</span><span class="op" id="1358360">,</span>&nbsp;<span class="ident" id="1358362">mode</span><span class="op" id="1358366">)</span><br>
<span class="lineno"></span><span class="op" id="1358368">}</span><br>
<span class="lineno">990</span><br>
<span class="lineno"></span><span class="comment" id="1358371">//&nbsp;ImportDir&nbsp;is&nbsp;shorthand&nbsp;for&nbsp;Default.ImportDir.</span><br>
<span class="lineno"></span><span class="keyword" id="1358420">func</span>&nbsp;<span class="ident" id="1358425">ImportDir</span><span class="op" id="1358434">(</span><span class="ident" id="1358435">dir</span>&nbsp;<span class="builtintype" id="1358439">string</span><span class="op" id="1358445">,</span>&nbsp;<span class="ident" id="1358447">mode</span>&nbsp;<span class="ident" id="1358452">ImportMode</span><span class="op" id="1358462">)</span>&nbsp;<span class="op" id="1358464">(</span><span class="op" id="1358465">*</span><span class="ident" id="1358466">Package</span><span class="op" id="1358473">,</span>&nbsp;<span class="builtintype" id="1358475">error</span><span class="op" id="1358480">)</span>&nbsp;<span class="op" id="1358482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1358485">return</span>&nbsp;<span class="ident" id="1358492">Default</span><span class="op" id="1358499">.</span><span class="ident" id="1358500">ImportDir</span><span class="op" id="1358509">(</span><span class="ident" id="1358510">dir</span><span class="op" id="1358513">,</span>&nbsp;<span class="ident" id="1358515">mode</span><span class="op" id="1358519">)</span><br>
<span class="lineno"></span><span class="op" id="1358521">}</span><br>
<span class="lineno">995</span><br>
<span class="lineno"></span><span class="keyword" id="1358524">var</span>&nbsp;<span class="ident" id="1358528">slashslash</span>&nbsp;<span class="op" id="1358539">=</span>&nbsp;<span class="op" id="1358541">[</span><span class="op" id="1358542">]</span><span class="builtintype" id="1358543">byte</span><span class="op" id="1358547">(</span><span class="string" id="1358548">&#34;//&#34;</span><span class="op" id="1358552">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1358555">//&nbsp;shouldBuild&nbsp;reports&nbsp;whether&nbsp;it&nbsp;is&nbsp;okay&nbsp;to&nbsp;use&nbsp;this&nbsp;file,</span><br>
<span class="lineno"></span><span class="comment" id="1358615">//&nbsp;The&nbsp;rule&nbsp;is&nbsp;that&nbsp;in&nbsp;the&nbsp;file&#39;s&nbsp;leading&nbsp;run&nbsp;of&nbsp;//&nbsp;comments</span><br>
<span class="lineno">1000</span><span class="comment" id="1358676">//&nbsp;and&nbsp;blank&nbsp;lines,&nbsp;which&nbsp;must&nbsp;be&nbsp;followed&nbsp;by&nbsp;a&nbsp;blank&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="1358735">//&nbsp;(to&nbsp;avoid&nbsp;including&nbsp;a&nbsp;Go&nbsp;package&nbsp;clause&nbsp;doc&nbsp;comment),</span><br>
<span class="lineno"></span><span class="comment" id="1358792">//&nbsp;lines&nbsp;beginning&nbsp;with&nbsp;&#39;//&nbsp;+build&#39;&nbsp;are&nbsp;taken&nbsp;as&nbsp;build&nbsp;directives.</span><br>
<span class="lineno"></span><span class="comment" id="1358859">//</span><br>
<span class="lineno"></span><span class="comment" id="1358862">//&nbsp;The&nbsp;file&nbsp;is&nbsp;accepted&nbsp;only&nbsp;if&nbsp;each&nbsp;such&nbsp;line&nbsp;lists&nbsp;something</span><br>
<span class="lineno">1005</span><span class="comment" id="1358925">//&nbsp;matching&nbsp;the&nbsp;file.&nbsp;&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span><span class="comment" id="1358961">//</span><br>
<span class="lineno"></span><span class="comment" id="1358964">//&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;+build&nbsp;windows&nbsp;linux</span><br>
<span class="lineno"></span><span class="comment" id="1358991">//</span><br>
<span class="lineno"></span><span class="comment" id="1358994">//&nbsp;marks&nbsp;the&nbsp;file&nbsp;as&nbsp;applicable&nbsp;only&nbsp;on&nbsp;Windows&nbsp;and&nbsp;Linux.</span><br>
<span class="lineno">1010</span><span class="comment" id="1359053">//</span><br>
<span class="lineno"></span><span class="keyword" id="1359056">func</span>&nbsp;<span class="op" id="1359061">(</span><span class="ident" id="1359062">ctxt</span>&nbsp;<span class="op" id="1359067">*</span><span class="ident" id="1359068">Context</span><span class="op" id="1359075">)</span>&nbsp;<span class="ident" id="1359077">shouldBuild</span><span class="op" id="1359088">(</span><span class="ident" id="1359089">content</span>&nbsp;<span class="op" id="1359097">[</span><span class="op" id="1359098">]</span><span class="builtintype" id="1359099">byte</span><span class="op" id="1359103">,</span>&nbsp;<span class="ident" id="1359105">allTags</span>&nbsp;<span class="keyword" id="1359113">map</span><span class="op" id="1359116">[</span><span class="builtintype" id="1359117">string</span><span class="op" id="1359123">]</span><span class="builtintype" id="1359124">bool</span><span class="op" id="1359128">)</span>&nbsp;<span class="builtintype" id="1359130">bool</span>&nbsp;<span class="op" id="1359135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1359138">//&nbsp;Pass&nbsp;1.&nbsp;Identify&nbsp;leading&nbsp;run&nbsp;of&nbsp;//&nbsp;comments&nbsp;and&nbsp;blank&nbsp;lines,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1359203">//&nbsp;which&nbsp;must&nbsp;be&nbsp;followed&nbsp;by&nbsp;a&nbsp;blank&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1359247">end</span>&nbsp;<span class="op" id="1359251">:=</span>&nbsp;<span class="num" id="1359254">0</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1359257">p</span>&nbsp;<span class="op" id="1359259">:=</span>&nbsp;<span class="ident" id="1359262">content</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1359271">for</span>&nbsp;<span class="builtinfunc" id="1359275">len</span><span class="op" id="1359278">(</span><span class="ident" id="1359279">p</span><span class="op" id="1359280">)</span>&nbsp;<span class="op" id="1359282">&gt;</span>&nbsp;<span class="num" id="1359284">0</span>&nbsp;<span class="op" id="1359286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1359290">line</span>&nbsp;<span class="op" id="1359295">:=</span>&nbsp;<span class="ident" id="1359298">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1359302">if</span>&nbsp;<span class="ident" id="1359305">i</span>&nbsp;<span class="op" id="1359307">:=</span>&nbsp;<span class="ident" id="1359310">bytes</span><span class="op" id="1359315">.</span><span class="ident" id="1359316">IndexByte</span><span class="op" id="1359325">(</span><span class="ident" id="1359326">line</span><span class="op" id="1359330">,</span>&nbsp;<span class="string" id="1359332">&#39;\n&#39;</span><span class="op" id="1359336">)</span><span class="op" id="1359337">;</span>&nbsp;<span class="ident" id="1359339">i</span>&nbsp;<span class="op" id="1359341">&gt;=</span>&nbsp;<span class="num" id="1359344">0</span>&nbsp;<span class="op" id="1359346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1359351">line</span><span class="op" id="1359355">,</span>&nbsp;<span class="ident" id="1359357">p</span>&nbsp;<span class="op" id="1359359">=</span>&nbsp;<span class="ident" id="1359361">line</span><span class="op" id="1359365">[</span><span class="op" id="1359366">:</span><span class="ident" id="1359367">i</span><span class="op" id="1359368">]</span><span class="op" id="1359369">,</span>&nbsp;<span class="ident" id="1359371">p</span><span class="op" id="1359372">[</span><span class="ident" id="1359373">i</span><span class="op" id="1359374">+</span><span class="num" id="1359375">1</span><span class="op" id="1359376">:</span><span class="op" id="1359377">]</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1359381">}</span>&nbsp;<span class="keyword" id="1359383">else</span>&nbsp;<span class="op" id="1359388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1359393">p</span>&nbsp;<span class="op" id="1359395">=</span>&nbsp;<span class="ident" id="1359397">p</span><span class="op" id="1359398">[</span><span class="builtinfunc" id="1359399">len</span><span class="op" id="1359402">(</span><span class="ident" id="1359403">p</span><span class="op" id="1359404">)</span><span class="op" id="1359405">:</span><span class="op" id="1359406">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1359410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1359414">line</span>&nbsp;<span class="op" id="1359419">=</span>&nbsp;<span class="ident" id="1359421">bytes</span><span class="op" id="1359426">.</span><span class="ident" id="1359427">TrimSpace</span><span class="op" id="1359436">(</span><span class="ident" id="1359437">line</span><span class="op" id="1359441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1359445">if</span>&nbsp;<span class="builtinfunc" id="1359448">len</span><span class="op" id="1359451">(</span><span class="ident" id="1359452">line</span><span class="op" id="1359456">)</span>&nbsp;<span class="op" id="1359458">==</span>&nbsp;<span class="num" id="1359461">0</span>&nbsp;<span class="op" id="1359463">{</span>&nbsp;<span class="comment" id="1359465">//&nbsp;Blank&nbsp;line</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1359482">end</span>&nbsp;<span class="op" id="1359486">=</span>&nbsp;<span class="builtinfunc" id="1359488">len</span><span class="op" id="1359491">(</span><span class="ident" id="1359492">content</span><span class="op" id="1359499">)</span>&nbsp;<span class="op" id="1359501">-</span>&nbsp;<span class="builtinfunc" id="1359503">len</span><span class="op" id="1359506">(</span><span class="ident" id="1359507">p</span><span class="op" id="1359508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1359513">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1359524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1359528">if</span>&nbsp;<span class="op" id="1359531">!</span><span class="ident" id="1359532">bytes</span><span class="op" id="1359537">.</span><span class="ident" id="1359538">HasPrefix</span><span class="op" id="1359547">(</span><span class="ident" id="1359548">line</span><span class="op" id="1359552">,</span>&nbsp;<span class="ident" id="1359554">slashslash</span><span class="op" id="1359564">)</span>&nbsp;<span class="op" id="1359566">{</span>&nbsp;<span class="comment" id="1359568">//&nbsp;Not&nbsp;comment&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1359591">break</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1359599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1359602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1359605">content</span>&nbsp;<span class="op" id="1359613">=</span>&nbsp;<span class="ident" id="1359615">content</span><span class="op" id="1359622">[</span><span class="op" id="1359623">:</span><span class="ident" id="1359624">end</span><span class="op" id="1359627">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1359631">//&nbsp;Pass&nbsp;2.&nbsp;&nbsp;Process&nbsp;each&nbsp;line&nbsp;in&nbsp;the&nbsp;run.</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1359674">p</span>&nbsp;<span class="op" id="1359676">=</span>&nbsp;<span class="ident" id="1359678">content</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1359687">allok</span>&nbsp;<span class="op" id="1359693">:=</span>&nbsp;<span class="builtintype" id="1359696">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1359702">for</span>&nbsp;<span class="builtinfunc" id="1359706">len</span><span class="op" id="1359709">(</span><span class="ident" id="1359710">p</span><span class="op" id="1359711">)</span>&nbsp;<span class="op" id="1359713">&gt;</span>&nbsp;<span class="num" id="1359715">0</span>&nbsp;<span class="op" id="1359717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1359721">line</span>&nbsp;<span class="op" id="1359726">:=</span>&nbsp;<span class="ident" id="1359729">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1359733">if</span>&nbsp;<span class="ident" id="1359736">i</span>&nbsp;<span class="op" id="1359738">:=</span>&nbsp;<span class="ident" id="1359741">bytes</span><span class="op" id="1359746">.</span><span class="ident" id="1359747">IndexByte</span><span class="op" id="1359756">(</span><span class="ident" id="1359757">line</span><span class="op" id="1359761">,</span>&nbsp;<span class="string" id="1359763">&#39;\n&#39;</span><span class="op" id="1359767">)</span><span class="op" id="1359768">;</span>&nbsp;<span class="ident" id="1359770">i</span>&nbsp;<span class="op" id="1359772">&gt;=</span>&nbsp;<span class="num" id="1359775">0</span>&nbsp;<span class="op" id="1359777">{</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1359782">line</span><span class="op" id="1359786">,</span>&nbsp;<span class="ident" id="1359788">p</span>&nbsp;<span class="op" id="1359790">=</span>&nbsp;<span class="ident" id="1359792">line</span><span class="op" id="1359796">[</span><span class="op" id="1359797">:</span><span class="ident" id="1359798">i</span><span class="op" id="1359799">]</span><span class="op" id="1359800">,</span>&nbsp;<span class="ident" id="1359802">p</span><span class="op" id="1359803">[</span><span class="ident" id="1359804">i</span><span class="op" id="1359805">+</span><span class="num" id="1359806">1</span><span class="op" id="1359807">:</span><span class="op" id="1359808">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1359812">}</span>&nbsp;<span class="keyword" id="1359814">else</span>&nbsp;<span class="op" id="1359819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1359824">p</span>&nbsp;<span class="op" id="1359826">=</span>&nbsp;<span class="ident" id="1359828">p</span><span class="op" id="1359829">[</span><span class="builtinfunc" id="1359830">len</span><span class="op" id="1359833">(</span><span class="ident" id="1359834">p</span><span class="op" id="1359835">)</span><span class="op" id="1359836">:</span><span class="op" id="1359837">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1359841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1359845">line</span>&nbsp;<span class="op" id="1359850">=</span>&nbsp;<span class="ident" id="1359852">bytes</span><span class="op" id="1359857">.</span><span class="ident" id="1359858">TrimSpace</span><span class="op" id="1359867">(</span><span class="ident" id="1359868">line</span><span class="op" id="1359872">)</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1359876">if</span>&nbsp;<span class="ident" id="1359879">bytes</span><span class="op" id="1359884">.</span><span class="ident" id="1359885">HasPrefix</span><span class="op" id="1359894">(</span><span class="ident" id="1359895">line</span><span class="op" id="1359899">,</span>&nbsp;<span class="ident" id="1359901">slashslash</span><span class="op" id="1359911">)</span>&nbsp;<span class="op" id="1359913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1359918">line</span>&nbsp;<span class="op" id="1359923">=</span>&nbsp;<span class="ident" id="1359925">bytes</span><span class="op" id="1359930">.</span><span class="ident" id="1359931">TrimSpace</span><span class="op" id="1359940">(</span><span class="ident" id="1359941">line</span><span class="op" id="1359945">[</span><span class="builtinfunc" id="1359946">len</span><span class="op" id="1359949">(</span><span class="ident" id="1359950">slashslash</span><span class="op" id="1359960">)</span><span class="op" id="1359961">:</span><span class="op" id="1359962">]</span><span class="op" id="1359963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1359968">if</span>&nbsp;<span class="builtinfunc" id="1359971">len</span><span class="op" id="1359974">(</span><span class="ident" id="1359975">line</span><span class="op" id="1359979">)</span>&nbsp;<span class="op" id="1359981">&gt;</span>&nbsp;<span class="num" id="1359983">0</span>&nbsp;<span class="op" id="1359985">&amp;&amp;</span>&nbsp;<span class="ident" id="1359988">line</span><span class="op" id="1359992">[</span><span class="num" id="1359993">0</span><span class="op" id="1359994">]</span>&nbsp;<span class="op" id="1359996">==</span>&nbsp;<span class="string" id="1359999">&#39;+&#39;</span>&nbsp;<span class="op" id="1360003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1360009">//&nbsp;Looks&nbsp;like&nbsp;a&nbsp;comment&nbsp;+line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1360044">f</span>&nbsp;<span class="op" id="1360046">:=</span>&nbsp;<span class="ident" id="1360049">strings</span><span class="op" id="1360056">.</span><span class="ident" id="1360057">Fields</span><span class="op" id="1360063">(</span><span class="builtintype" id="1360064">string</span><span class="op" id="1360070">(</span><span class="ident" id="1360071">line</span><span class="op" id="1360075">)</span><span class="op" id="1360076">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1360082">if</span>&nbsp;<span class="ident" id="1360085">f</span><span class="op" id="1360086">[</span><span class="num" id="1360087">0</span><span class="op" id="1360088">]</span>&nbsp;<span class="op" id="1360090">==</span>&nbsp;<span class="string" id="1360093">&#34;+build&#34;</span>&nbsp;<span class="op" id="1360102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1360109">ok</span>&nbsp;<span class="op" id="1360112">:=</span>&nbsp;<span class="builtintype" id="1360115">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1360126">for</span>&nbsp;<span class="ident" id="1360130">_</span><span class="op" id="1360131">,</span>&nbsp;<span class="ident" id="1360133">tok</span>&nbsp;<span class="op" id="1360137">:=</span>&nbsp;<span class="keyword" id="1360140">range</span>&nbsp;<span class="ident" id="1360146">f</span><span class="op" id="1360147">[</span><span class="num" id="1360148">1</span><span class="op" id="1360149">:</span><span class="op" id="1360150">]</span>&nbsp;<span class="op" id="1360152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1360160">if</span>&nbsp;<span class="ident" id="1360163">ctxt</span><span class="op" id="1360167">.</span><span class="ident" id="1360168">match</span><span class="op" id="1360173">(</span><span class="ident" id="1360174">tok</span><span class="op" id="1360177">,</span>&nbsp;<span class="ident" id="1360179">allTags</span><span class="op" id="1360186">)</span>&nbsp;<span class="op" id="1360188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1360197">ok</span>&nbsp;<span class="op" id="1360200">=</span>&nbsp;<span class="builtintype" id="1360202">true</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1360213">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1360220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1360227">if</span>&nbsp;<span class="op" id="1360230">!</span><span class="ident" id="1360231">ok</span>&nbsp;<span class="op" id="1360234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1360242">allok</span>&nbsp;<span class="op" id="1360248">=</span>&nbsp;<span class="builtintype" id="1360250">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1360261">}</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1360267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1360272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1360276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1360279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1360283">return</span>&nbsp;<span class="ident" id="1360290">allok</span><br>
<span class="lineno"></span><span class="op" id="1360296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1360299">//&nbsp;saveCgo&nbsp;saves&nbsp;the&nbsp;information&nbsp;from&nbsp;the&nbsp;#cgo&nbsp;lines&nbsp;in&nbsp;the&nbsp;import&nbsp;&#34;C&#34;&nbsp;comment.</span><br>
<span class="lineno"></span><span class="comment" id="1360379">//&nbsp;These&nbsp;lines&nbsp;set&nbsp;CFLAGS,&nbsp;CPPFLAGS,&nbsp;CXXFLAGS&nbsp;and&nbsp;LDFLAGS&nbsp;and&nbsp;pkg-config&nbsp;directives</span><br>
<span class="lineno">1070</span><span class="comment" id="1360463">//&nbsp;that&nbsp;affect&nbsp;the&nbsp;way&nbsp;cgo&#39;s&nbsp;C&nbsp;code&nbsp;is&nbsp;built.</span><br>
<span class="lineno"></span><span class="comment" id="1360509">//</span><br>
<span class="lineno"></span><span class="comment" id="1360512">//&nbsp;TODO(rsc):&nbsp;This&nbsp;duplicates&nbsp;code&nbsp;in&nbsp;cgo.</span><br>
<span class="lineno"></span><span class="comment" id="1360555">//&nbsp;Once&nbsp;the&nbsp;dust&nbsp;settles,&nbsp;remove&nbsp;this&nbsp;code&nbsp;from&nbsp;cgo.</span><br>
<span class="lineno"></span><span class="keyword" id="1360608">func</span>&nbsp;<span class="op" id="1360613">(</span><span class="ident" id="1360614">ctxt</span>&nbsp;<span class="op" id="1360619">*</span><span class="ident" id="1360620">Context</span><span class="op" id="1360627">)</span>&nbsp;<span class="ident" id="1360629">saveCgo</span><span class="op" id="1360636">(</span><span class="ident" id="1360637">filename</span>&nbsp;<span class="builtintype" id="1360646">string</span><span class="op" id="1360652">,</span>&nbsp;<span class="ident" id="1360654">di</span>&nbsp;<span class="op" id="1360657">*</span><span class="ident" id="1360658">Package</span><span class="op" id="1360665">,</span>&nbsp;<span class="ident" id="1360667">cg</span>&nbsp;<span class="op" id="1360670">*</span><span class="ident" id="1360671">ast</span><span class="op" id="1360674">.</span><span class="ident" id="1360675">CommentGroup</span><span class="op" id="1360687">)</span>&nbsp;<span class="builtintype" id="1360689">error</span>&nbsp;<span class="op" id="1360695">{</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1360698">text</span>&nbsp;<span class="op" id="1360703">:=</span>&nbsp;<span class="ident" id="1360706">cg</span><span class="op" id="1360708">.</span><span class="ident" id="1360709">Text</span><span class="op" id="1360713">(</span><span class="op" id="1360714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1360717">for</span>&nbsp;<span class="ident" id="1360721">_</span><span class="op" id="1360722">,</span>&nbsp;<span class="ident" id="1360724">line</span>&nbsp;<span class="op" id="1360729">:=</span>&nbsp;<span class="keyword" id="1360732">range</span>&nbsp;<span class="ident" id="1360738">strings</span><span class="op" id="1360745">.</span><span class="ident" id="1360746">Split</span><span class="op" id="1360751">(</span><span class="ident" id="1360752">text</span><span class="op" id="1360756">,</span>&nbsp;<span class="string" id="1360758">&#34;\n&#34;</span><span class="op" id="1360762">)</span>&nbsp;<span class="op" id="1360764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1360768">orig</span>&nbsp;<span class="op" id="1360773">:=</span>&nbsp;<span class="ident" id="1360776">line</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1360784">//&nbsp;Line&nbsp;is</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1360797">//&nbsp;&nbsp;&nbsp;&nbsp#cgo&nbsp;[GOOS/GOARCH...]&nbsp;LDFLAGS:&nbsp;stuff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1360839">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1360844">line</span>&nbsp;<span class="op" id="1360849">=</span>&nbsp;<span class="ident" id="1360851">strings</span><span class="op" id="1360858">.</span><span class="ident" id="1360859">TrimSpace</span><span class="op" id="1360868">(</span><span class="ident" id="1360869">line</span><span class="op" id="1360873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1360877">if</span>&nbsp;<span class="builtinfunc" id="1360880">len</span><span class="op" id="1360883">(</span><span class="ident" id="1360884">line</span><span class="op" id="1360888">)</span>&nbsp;<span class="op" id="1360890">&lt;</span>&nbsp;<span class="num" id="1360892">5</span>&nbsp;<span class="op" id="1360894">||</span>&nbsp;<span class="ident" id="1360897">line</span><span class="op" id="1360901">[</span><span class="op" id="1360902">:</span><span class="num" id="1360903">4</span><span class="op" id="1360904">]</span>&nbsp;<span class="op" id="1360906">!=</span>&nbsp;<span class="string" id="1360909">&#34;#cgo&#34;</span>&nbsp;<span class="op" id="1360916">||</span>&nbsp;<span class="op" id="1360919">(</span><span class="ident" id="1360920">line</span><span class="op" id="1360924">[</span><span class="num" id="1360925">4</span><span class="op" id="1360926">]</span>&nbsp;<span class="op" id="1360928">!=</span>&nbsp;<span class="string" id="1360931">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="1360935">&amp;&amp;</span>&nbsp;<span class="ident" id="1360938">line</span><span class="op" id="1360942">[</span><span class="num" id="1360943">4</span><span class="op" id="1360944">]</span>&nbsp;<span class="op" id="1360946">!=</span>&nbsp;<span class="string" id="1360949">&#39;\t&#39;</span><span class="op" id="1360953">)</span>&nbsp;<span class="op" id="1360955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1360960">continue</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1360971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1360976">//&nbsp;Split&nbsp;at&nbsp;colon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1360997">line</span>&nbsp;<span class="op" id="1361002">=</span>&nbsp;<span class="ident" id="1361004">strings</span><span class="op" id="1361011">.</span><span class="ident" id="1361012">TrimSpace</span><span class="op" id="1361021">(</span><span class="ident" id="1361022">line</span><span class="op" id="1361026">[</span><span class="num" id="1361027">4</span><span class="op" id="1361028">:</span><span class="op" id="1361029">]</span><span class="op" id="1361030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1361034">i</span>&nbsp;<span class="op" id="1361036">:=</span>&nbsp;<span class="ident" id="1361039">strings</span><span class="op" id="1361046">.</span><span class="ident" id="1361047">Index</span><span class="op" id="1361052">(</span><span class="ident" id="1361053">line</span><span class="op" id="1361057">,</span>&nbsp;<span class="string" id="1361059">&#34;:&#34;</span><span class="op" id="1361062">)</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1361066">if</span>&nbsp;<span class="ident" id="1361069">i</span>&nbsp;<span class="op" id="1361071">&lt;</span>&nbsp;<span class="num" id="1361073">0</span>&nbsp;<span class="op" id="1361075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1361080">return</span>&nbsp;<span class="ident" id="1361087">fmt</span><span class="op" id="1361090">.</span><span class="ident" id="1361091">Errorf</span><span class="op" id="1361097">(</span><span class="string" id="1361098">&#34;%s:&nbsp;invalid&nbsp;#cgo&nbsp;line:&nbsp;%s&#34;</span><span class="op" id="1361125">,</span>&nbsp;<span class="ident" id="1361127">filename</span><span class="op" id="1361135">,</span>&nbsp;<span class="ident" id="1361137">orig</span><span class="op" id="1361141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1361145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1361149">line</span><span class="op" id="1361153">,</span>&nbsp;<span class="ident" id="1361155">argstr</span>&nbsp;<span class="op" id="1361162">:=</span>&nbsp;<span class="ident" id="1361165">line</span><span class="op" id="1361169">[</span><span class="op" id="1361170">:</span><span class="ident" id="1361171">i</span><span class="op" id="1361172">]</span><span class="op" id="1361173">,</span>&nbsp;<span class="ident" id="1361175">line</span><span class="op" id="1361179">[</span><span class="ident" id="1361180">i</span><span class="op" id="1361181">+</span><span class="num" id="1361182">1</span><span class="op" id="1361183">:</span><span class="op" id="1361184">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1361189">//&nbsp;Parse&nbsp;GOOS/GOARCH&nbsp;stuff.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1361219">f</span>&nbsp;<span class="op" id="1361221">:=</span>&nbsp;<span class="ident" id="1361224">strings</span><span class="op" id="1361231">.</span><span class="ident" id="1361232">Fields</span><span class="op" id="1361238">(</span><span class="ident" id="1361239">line</span><span class="op" id="1361243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1361247">if</span>&nbsp;<span class="builtinfunc" id="1361250">len</span><span class="op" id="1361253">(</span><span class="ident" id="1361254">f</span><span class="op" id="1361255">)</span>&nbsp;<span class="op" id="1361257">&lt;</span>&nbsp;<span class="num" id="1361259">1</span>&nbsp;<span class="op" id="1361261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1361266">return</span>&nbsp;<span class="ident" id="1361273">fmt</span><span class="op" id="1361276">.</span><span class="ident" id="1361277">Errorf</span><span class="op" id="1361283">(</span><span class="string" id="1361284">&#34;%s:&nbsp;invalid&nbsp;#cgo&nbsp;line:&nbsp;%s&#34;</span><span class="op" id="1361311">,</span>&nbsp;<span class="ident" id="1361313">filename</span><span class="op" id="1361321">,</span>&nbsp;<span class="ident" id="1361323">orig</span><span class="op" id="1361327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1361331">}</span><br>
<span class="lineno">1100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1361336">cond</span><span class="op" id="1361340">,</span>&nbsp;<span class="ident" id="1361342">verb</span>&nbsp;<span class="op" id="1361347">:=</span>&nbsp;<span class="ident" id="1361350">f</span><span class="op" id="1361351">[</span><span class="op" id="1361352">:</span><span class="builtinfunc" id="1361353">len</span><span class="op" id="1361356">(</span><span class="ident" id="1361357">f</span><span class="op" id="1361358">)</span><span class="op" id="1361359">-</span><span class="num" id="1361360">1</span><span class="op" id="1361361">]</span><span class="op" id="1361362">,</span>&nbsp;<span class="ident" id="1361364">f</span><span class="op" id="1361365">[</span><span class="builtinfunc" id="1361366">len</span><span class="op" id="1361369">(</span><span class="ident" id="1361370">f</span><span class="op" id="1361371">)</span><span class="op" id="1361372">-</span><span class="num" id="1361373">1</span><span class="op" id="1361374">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1361378">if</span>&nbsp;<span class="builtinfunc" id="1361381">len</span><span class="op" id="1361384">(</span><span class="ident" id="1361385">cond</span><span class="op" id="1361389">)</span>&nbsp;<span class="op" id="1361391">&gt;</span>&nbsp;<span class="num" id="1361393">0</span>&nbsp;<span class="op" id="1361395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1361400">ok</span>&nbsp;<span class="op" id="1361403">:=</span>&nbsp;<span class="builtintype" id="1361406">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1361415">for</span>&nbsp;<span class="ident" id="1361419">_</span><span class="op" id="1361420">,</span>&nbsp;<span class="ident" id="1361422">c</span>&nbsp;<span class="op" id="1361424">:=</span>&nbsp;<span class="keyword" id="1361427">range</span>&nbsp;<span class="ident" id="1361433">cond</span>&nbsp;<span class="op" id="1361438">{</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1361444">if</span>&nbsp;<span class="ident" id="1361447">ctxt</span><span class="op" id="1361451">.</span><span class="ident" id="1361452">match</span><span class="op" id="1361457">(</span><span class="ident" id="1361458">c</span><span class="op" id="1361459">,</span>&nbsp;<span class="ident" id="1361461">nil</span><span class="op" id="1361464">)</span>&nbsp;<span class="op" id="1361466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1361473">ok</span>&nbsp;<span class="op" id="1361476">=</span>&nbsp;<span class="builtintype" id="1361478">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1361488">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1361498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1361503">}</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1361508">if</span>&nbsp;<span class="op" id="1361511">!</span><span class="ident" id="1361512">ok</span>&nbsp;<span class="op" id="1361515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1361521">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1361533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1361537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1361542">args</span><span class="op" id="1361546">,</span>&nbsp;<span class="ident" id="1361548">err</span>&nbsp;<span class="op" id="1361552">:=</span>&nbsp;<span class="ident" id="1361555">splitQuoted</span><span class="op" id="1361566">(</span><span class="ident" id="1361567">argstr</span><span class="op" id="1361573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1361577">if</span>&nbsp;<span class="ident" id="1361580">err</span>&nbsp;<span class="op" id="1361584">!=</span>&nbsp;<span class="ident" id="1361587">nil</span>&nbsp;<span class="op" id="1361591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1361596">return</span>&nbsp;<span class="ident" id="1361603">fmt</span><span class="op" id="1361606">.</span><span class="ident" id="1361607">Errorf</span><span class="op" id="1361613">(</span><span class="string" id="1361614">&#34;%s:&nbsp;invalid&nbsp;#cgo&nbsp;line:&nbsp;%s&#34;</span><span class="op" id="1361641">,</span>&nbsp;<span class="ident" id="1361643">filename</span><span class="op" id="1361651">,</span>&nbsp;<span class="ident" id="1361653">orig</span><span class="op" id="1361657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1361661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1361665">for</span>&nbsp;<span class="ident" id="1361669">_</span><span class="op" id="1361670">,</span>&nbsp;<span class="ident" id="1361672">arg</span>&nbsp;<span class="op" id="1361676">:=</span>&nbsp;<span class="keyword" id="1361679">range</span>&nbsp;<span class="ident" id="1361685">args</span>&nbsp;<span class="op" id="1361690">{</span><br>
<span class="lineno">1120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1361695">if</span>&nbsp;<span class="op" id="1361698">!</span><span class="ident" id="1361699">safeCgoName</span><span class="op" id="1361710">(</span><span class="ident" id="1361711">arg</span><span class="op" id="1361714">)</span>&nbsp;<span class="op" id="1361716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1361722">return</span>&nbsp;<span class="ident" id="1361729">fmt</span><span class="op" id="1361732">.</span><span class="ident" id="1361733">Errorf</span><span class="op" id="1361739">(</span><span class="string" id="1361740">&#34;%s:&nbsp;malformed&nbsp;#cgo&nbsp;argument:&nbsp;%s&#34;</span><span class="op" id="1361773">,</span>&nbsp;<span class="ident" id="1361775">filename</span><span class="op" id="1361783">,</span>&nbsp;<span class="ident" id="1361785">arg</span><span class="op" id="1361788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1361793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1361797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1361802">switch</span>&nbsp;<span class="ident" id="1361809">verb</span>&nbsp;<span class="op" id="1361814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1361818">case</span>&nbsp;<span class="string" id="1361823">&#34;CFLAGS&#34;</span><span class="op" id="1361831">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1361836">di</span><span class="op" id="1361838">.</span><span class="ident" id="1361839">CgoCFLAGS</span>&nbsp;<span class="op" id="1361849">=</span>&nbsp;<span class="builtinfunc" id="1361851">append</span><span class="op" id="1361857">(</span><span class="ident" id="1361858">di</span><span class="op" id="1361860">.</span><span class="ident" id="1361861">CgoCFLAGS</span><span class="op" id="1361870">,</span>&nbsp;<span class="ident" id="1361872">args</span><span class="op" id="1361876">...</span><span class="op" id="1361879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1361883">case</span>&nbsp;<span class="string" id="1361888">&#34;CPPFLAGS&#34;</span><span class="op" id="1361898">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1361903">di</span><span class="op" id="1361905">.</span><span class="ident" id="1361906">CgoCPPFLAGS</span>&nbsp;<span class="op" id="1361918">=</span>&nbsp;<span class="builtinfunc" id="1361920">append</span><span class="op" id="1361926">(</span><span class="ident" id="1361927">di</span><span class="op" id="1361929">.</span><span class="ident" id="1361930">CgoCPPFLAGS</span><span class="op" id="1361941">,</span>&nbsp;<span class="ident" id="1361943">args</span><span class="op" id="1361947">...</span><span class="op" id="1361950">)</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1361954">case</span>&nbsp;<span class="string" id="1361959">&#34;CXXFLAGS&#34;</span><span class="op" id="1361969">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1361974">di</span><span class="op" id="1361976">.</span><span class="ident" id="1361977">CgoCXXFLAGS</span>&nbsp;<span class="op" id="1361989">=</span>&nbsp;<span class="builtinfunc" id="1361991">append</span><span class="op" id="1361997">(</span><span class="ident" id="1361998">di</span><span class="op" id="1362000">.</span><span class="ident" id="1362001">CgoCXXFLAGS</span><span class="op" id="1362012">,</span>&nbsp;<span class="ident" id="1362014">args</span><span class="op" id="1362018">...</span><span class="op" id="1362021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1362025">case</span>&nbsp;<span class="string" id="1362030">&#34;LDFLAGS&#34;</span><span class="op" id="1362039">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1362044">di</span><span class="op" id="1362046">.</span><span class="ident" id="1362047">CgoLDFLAGS</span>&nbsp;<span class="op" id="1362058">=</span>&nbsp;<span class="builtinfunc" id="1362060">append</span><span class="op" id="1362066">(</span><span class="ident" id="1362067">di</span><span class="op" id="1362069">.</span><span class="ident" id="1362070">CgoLDFLAGS</span><span class="op" id="1362080">,</span>&nbsp;<span class="ident" id="1362082">args</span><span class="op" id="1362086">...</span><span class="op" id="1362089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1362093">case</span>&nbsp;<span class="string" id="1362098">&#34;pkg-config&#34;</span><span class="op" id="1362110">:</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1362115">di</span><span class="op" id="1362117">.</span><span class="ident" id="1362118">CgoPkgConfig</span>&nbsp;<span class="op" id="1362131">=</span>&nbsp;<span class="builtinfunc" id="1362133">append</span><span class="op" id="1362139">(</span><span class="ident" id="1362140">di</span><span class="op" id="1362142">.</span><span class="ident" id="1362143">CgoPkgConfig</span><span class="op" id="1362155">,</span>&nbsp;<span class="ident" id="1362157">args</span><span class="op" id="1362161">...</span><span class="op" id="1362164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1362168">default</span><span class="op" id="1362175">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1362180">return</span>&nbsp;<span class="ident" id="1362187">fmt</span><span class="op" id="1362190">.</span><span class="ident" id="1362191">Errorf</span><span class="op" id="1362197">(</span><span class="string" id="1362198">&#34;%s:&nbsp;invalid&nbsp;#cgo&nbsp;verb:&nbsp;%s&#34;</span><span class="op" id="1362225">,</span>&nbsp;<span class="ident" id="1362227">filename</span><span class="op" id="1362235">,</span>&nbsp;<span class="ident" id="1362237">orig</span><span class="op" id="1362241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1362245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1362248">}</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1362251">return</span>&nbsp;<span class="ident" id="1362258">nil</span><br>
<span class="lineno"></span><span class="op" id="1362262">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1362265">//&nbsp;NOTE:&nbsp;$&nbsp;is&nbsp;not&nbsp;safe&nbsp;for&nbsp;the&nbsp;shell,&nbsp;but&nbsp;it&nbsp;is&nbsp;allowed&nbsp;here&nbsp;because&nbsp;of&nbsp;linker&nbsp;options&nbsp;like&nbsp;-Wl,$ORIGIN.</span><br>
<span class="lineno"></span><span class="comment" id="1362370">//&nbsp;We&nbsp;never&nbsp;pass&nbsp;these&nbsp;arguments&nbsp;to&nbsp;a&nbsp;shell&nbsp;(just&nbsp;to&nbsp;programs&nbsp;we&nbsp;construct&nbsp;argv&nbsp;for),&nbsp;so&nbsp;this&nbsp;should&nbsp;be&nbsp;okay.</span><br>
<span class="lineno">1145</span><span class="comment" id="1362480">//&nbsp;See&nbsp;golang.org/issue/6038.</span><br>
<span class="lineno"></span><span class="keyword" id="1362510">var</span>&nbsp;<span class="ident" id="1362514">safeBytes</span>&nbsp;<span class="op" id="1362524">=</span>&nbsp;<span class="op" id="1362526">[</span><span class="op" id="1362527">]</span><span class="builtintype" id="1362528">byte</span><span class="op" id="1362532">(</span><span class="string" id="1362533">&#34;+-.,/0123456789=ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz:$&#34;</span><span class="op" id="1362606">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1362609">func</span>&nbsp;<span class="ident" id="1362614">safeCgoName</span><span class="op" id="1362625">(</span><span class="ident" id="1362626">s</span>&nbsp;<span class="builtintype" id="1362628">string</span><span class="op" id="1362634">)</span>&nbsp;<span class="builtintype" id="1362636">bool</span>&nbsp;<span class="op" id="1362641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1362644">if</span>&nbsp;<span class="ident" id="1362647">s</span>&nbsp;<span class="op" id="1362649">==</span>&nbsp;<span class="string" id="1362652">&#34;&#34;</span>&nbsp;<span class="op" id="1362655">{</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1362659">return</span>&nbsp;<span class="builtintype" id="1362666">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1362673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1362676">for</span>&nbsp;<span class="ident" id="1362680">i</span>&nbsp;<span class="op" id="1362682">:=</span>&nbsp;<span class="num" id="1362685">0</span><span class="op" id="1362686">;</span>&nbsp;<span class="ident" id="1362688">i</span>&nbsp;<span class="op" id="1362690">&lt;</span>&nbsp;<span class="builtinfunc" id="1362692">len</span><span class="op" id="1362695">(</span><span class="ident" id="1362696">s</span><span class="op" id="1362697">)</span><span class="op" id="1362698">;</span>&nbsp;<span class="ident" id="1362700">i</span><span class="op" id="1362701">++</span>&nbsp;<span class="op" id="1362704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1362708">if</span>&nbsp;<span class="ident" id="1362711">c</span>&nbsp;<span class="op" id="1362713">:=</span>&nbsp;<span class="ident" id="1362716">s</span><span class="op" id="1362717">[</span><span class="ident" id="1362718">i</span><span class="op" id="1362719">]</span><span class="op" id="1362720">;</span>&nbsp;<span class="ident" id="1362722">c</span>&nbsp;<span class="op" id="1362724">&lt;</span>&nbsp;<span class="num" id="1362726">0x80</span>&nbsp;<span class="op" id="1362731">&amp;&amp;</span>&nbsp;<span class="ident" id="1362734">bytes</span><span class="op" id="1362739">.</span><span class="ident" id="1362740">IndexByte</span><span class="op" id="1362749">(</span><span class="ident" id="1362750">safeBytes</span><span class="op" id="1362759">,</span>&nbsp;<span class="ident" id="1362761">c</span><span class="op" id="1362762">)</span>&nbsp;<span class="op" id="1362764">&lt;</span>&nbsp;<span class="num" id="1362766">0</span>&nbsp;<span class="op" id="1362768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1362773">return</span>&nbsp;<span class="builtintype" id="1362780">false</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1362788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1362791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1362794">return</span>&nbsp;<span class="builtintype" id="1362801">true</span><br>
<span class="lineno"></span><span class="op" id="1362806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1160</span><span class="comment" id="1362809">//&nbsp;splitQuoted&nbsp;splits&nbsp;the&nbsp;string&nbsp;s&nbsp;around&nbsp;each&nbsp;instance&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;consecutive</span><br>
<span class="lineno"></span><span class="comment" id="1362892">//&nbsp;white&nbsp;space&nbsp;characters&nbsp;while&nbsp;taking&nbsp;into&nbsp;account&nbsp;quotes&nbsp;and&nbsp;escaping,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1362969">//&nbsp;returns&nbsp;an&nbsp;array&nbsp;of&nbsp;substrings&nbsp;of&nbsp;s&nbsp;or&nbsp;an&nbsp;empty&nbsp;list&nbsp;if&nbsp;s&nbsp;contains&nbsp;only&nbsp;white&nbsp;space.</span><br>
<span class="lineno"></span><span class="comment" id="1363057">//&nbsp;Single&nbsp;quotes&nbsp;and&nbsp;double&nbsp;quotes&nbsp;are&nbsp;recognized&nbsp;to&nbsp;prevent&nbsp;splitting&nbsp;within&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1363139">//&nbsp;quoted&nbsp;region,&nbsp;and&nbsp;are&nbsp;removed&nbsp;from&nbsp;the&nbsp;resulting&nbsp;substrings.&nbsp;If&nbsp;a&nbsp;quote&nbsp;in&nbsp;s</span><br>
<span class="lineno">1165</span><span class="comment" id="1363220">//&nbsp;isn&#39;t&nbsp;closed&nbsp;err&nbsp;will&nbsp;be&nbsp;set&nbsp;and&nbsp;r&nbsp;will&nbsp;have&nbsp;the&nbsp;unclosed&nbsp;argument&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1363297">//&nbsp;last&nbsp;element.&nbsp;&nbsp;The&nbsp;backslash&nbsp;is&nbsp;used&nbsp;for&nbsp;escaping.</span><br>
<span class="lineno"></span><span class="comment" id="1363351">//</span><br>
<span class="lineno"></span><span class="comment" id="1363354">//&nbsp;For&nbsp;example,&nbsp;the&nbsp;following&nbsp;string:</span><br>
<span class="lineno"></span><span class="comment" id="1363392">//</span><br>
<span class="lineno">1170</span><span class="comment" id="1363395">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;b:&#34;c&nbsp;d&#34;&nbsp;&#39;e&#39;&#39;f&#39;&nbsp;&nbsp;&#34;g\&#34;&#34;</span><br>
<span class="lineno"></span><span class="comment" id="1363426">//</span><br>
<span class="lineno"></span><span class="comment" id="1363429">//&nbsp;Would&nbsp;be&nbsp;parsed&nbsp;as:</span><br>
<span class="lineno"></span><span class="comment" id="1363452">//</span><br>
<span class="lineno"></span><span class="comment" id="1363455">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[]string{&#34;a&#34;,&nbsp;&#34;b:c&nbsp;d&#34;,&nbsp;&#34;ef&#34;,&nbsp;`g&#34;`}</span><br>
<span class="lineno">1175</span><span class="comment" id="1363497">//</span><br>
<span class="lineno"></span><span class="keyword" id="1363500">func</span>&nbsp;<span class="ident" id="1363505">splitQuoted</span><span class="op" id="1363516">(</span><span class="ident" id="1363517">s</span>&nbsp;<span class="builtintype" id="1363519">string</span><span class="op" id="1363525">)</span>&nbsp;<span class="op" id="1363527">(</span><span class="ident" id="1363528">r</span>&nbsp;<span class="op" id="1363530">[</span><span class="op" id="1363531">]</span><span class="builtintype" id="1363532">string</span><span class="op" id="1363538">,</span>&nbsp;<span class="ident" id="1363540">err</span>&nbsp;<span class="builtintype" id="1363544">error</span><span class="op" id="1363549">)</span>&nbsp;<span class="op" id="1363551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1363554">var</span>&nbsp;<span class="ident" id="1363558">args</span>&nbsp;<span class="op" id="1363563">[</span><span class="op" id="1363564">]</span><span class="builtintype" id="1363565">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1363573">arg</span>&nbsp;<span class="op" id="1363577">:=</span>&nbsp;<span class="builtinfunc" id="1363580">make</span><span class="op" id="1363584">(</span><span class="op" id="1363585">[</span><span class="op" id="1363586">]</span><span class="builtintype" id="1363587">rune</span><span class="op" id="1363591">,</span>&nbsp;<span class="builtinfunc" id="1363593">len</span><span class="op" id="1363596">(</span><span class="ident" id="1363597">s</span><span class="op" id="1363598">)</span><span class="op" id="1363599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1363602">escaped</span>&nbsp;<span class="op" id="1363610">:=</span>&nbsp;<span class="builtintype" id="1363613">false</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1363620">quoted</span>&nbsp;<span class="op" id="1363627">:=</span>&nbsp;<span class="builtintype" id="1363630">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1363637">quote</span>&nbsp;<span class="op" id="1363643">:=</span>&nbsp;<span class="string" id="1363646">&#39;\x00&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1363654">i</span>&nbsp;<span class="op" id="1363656">:=</span>&nbsp;<span class="num" id="1363659">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1363662">for</span>&nbsp;<span class="ident" id="1363666">_</span><span class="op" id="1363667">,</span>&nbsp;<span class="builtintype" id="1363669">rune</span>&nbsp;<span class="op" id="1363674">:=</span>&nbsp;<span class="keyword" id="1363677">range</span>&nbsp;<span class="ident" id="1363683">s</span>&nbsp;<span class="op" id="1363685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1363689">switch</span>&nbsp;<span class="op" id="1363696">{</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1363700">case</span>&nbsp;<span class="ident" id="1363705">escaped</span><span class="op" id="1363712">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1363717">escaped</span>&nbsp;<span class="op" id="1363725">=</span>&nbsp;<span class="builtintype" id="1363727">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1363735">case</span>&nbsp;<span class="builtintype" id="1363740">rune</span>&nbsp;<span class="op" id="1363745">==</span>&nbsp;<span class="string" id="1363748">&#39;\\&#39;</span><span class="op" id="1363752">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1363757">escaped</span>&nbsp;<span class="op" id="1363765">=</span>&nbsp;<span class="builtintype" id="1363767">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1363775">continue</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1363786">case</span>&nbsp;<span class="ident" id="1363791">quote</span>&nbsp;<span class="op" id="1363797">!=</span>&nbsp;<span class="string" id="1363800">&#39;\x00&#39;</span><span class="op" id="1363806">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1363811">if</span>&nbsp;<span class="builtintype" id="1363814">rune</span>&nbsp;<span class="op" id="1363819">==</span>&nbsp;<span class="ident" id="1363822">quote</span>&nbsp;<span class="op" id="1363828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1363834">quote</span>&nbsp;<span class="op" id="1363840">=</span>&nbsp;<span class="string" id="1363842">&#39;\x00&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1363853">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1363865">}</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1363869">case</span>&nbsp;<span class="builtintype" id="1363874">rune</span>&nbsp;<span class="op" id="1363879">==</span>&nbsp;<span class="string" id="1363882">&#39;&#34;&#39;</span>&nbsp;<span class="op" id="1363886">||</span>&nbsp;<span class="builtintype" id="1363889">rune</span>&nbsp;<span class="op" id="1363894">==</span>&nbsp;<span class="string" id="1363897">&#39;\&#39;&#39;</span><span class="op" id="1363901">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1363906">quoted</span>&nbsp;<span class="op" id="1363913">=</span>&nbsp;<span class="builtintype" id="1363915">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1363923">quote</span>&nbsp;<span class="op" id="1363929">=</span>&nbsp;<span class="builtintype" id="1363931">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1363939">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1363950">case</span>&nbsp;<span class="ident" id="1363955">unicode</span><span class="op" id="1363962">.</span><span class="ident" id="1363963">IsSpace</span><span class="op" id="1363970">(</span><span class="builtintype" id="1363971">rune</span><span class="op" id="1363975">)</span><span class="op" id="1363976">:</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1363981">if</span>&nbsp;<span class="ident" id="1363984">quoted</span>&nbsp;<span class="op" id="1363991">||</span>&nbsp;<span class="ident" id="1363994">i</span>&nbsp;<span class="op" id="1363996">&gt;</span>&nbsp;<span class="num" id="1363998">0</span>&nbsp;<span class="op" id="1364000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1364006">quoted</span>&nbsp;<span class="op" id="1364013">=</span>&nbsp;<span class="builtintype" id="1364015">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1364025">args</span>&nbsp;<span class="op" id="1364030">=</span>&nbsp;<span class="builtinfunc" id="1364032">append</span><span class="op" id="1364038">(</span><span class="ident" id="1364039">args</span><span class="op" id="1364043">,</span>&nbsp;<span class="builtintype" id="1364045">string</span><span class="op" id="1364051">(</span><span class="ident" id="1364052">arg</span><span class="op" id="1364055">[</span><span class="op" id="1364056">:</span><span class="ident" id="1364057">i</span><span class="op" id="1364058">]</span><span class="op" id="1364059">)</span><span class="op" id="1364060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1364066">i</span>&nbsp;<span class="op" id="1364068">=</span>&nbsp;<span class="num" id="1364070">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1364075">}</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1364080">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1364091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1364095">arg</span><span class="op" id="1364098">[</span><span class="ident" id="1364099">i</span><span class="op" id="1364100">]</span>&nbsp;<span class="op" id="1364102">=</span>&nbsp;<span class="builtintype" id="1364104">rune</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1364111">i</span><span class="op" id="1364112">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1364116">}</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1364119">if</span>&nbsp;<span class="ident" id="1364122">quoted</span>&nbsp;<span class="op" id="1364129">||</span>&nbsp;<span class="ident" id="1364132">i</span>&nbsp;<span class="op" id="1364134">&gt;</span>&nbsp;<span class="num" id="1364136">0</span>&nbsp;<span class="op" id="1364138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1364142">args</span>&nbsp;<span class="op" id="1364147">=</span>&nbsp;<span class="builtinfunc" id="1364149">append</span><span class="op" id="1364155">(</span><span class="ident" id="1364156">args</span><span class="op" id="1364160">,</span>&nbsp;<span class="builtintype" id="1364162">string</span><span class="op" id="1364168">(</span><span class="ident" id="1364169">arg</span><span class="op" id="1364172">[</span><span class="op" id="1364173">:</span><span class="ident" id="1364174">i</span><span class="op" id="1364175">]</span><span class="op" id="1364176">)</span><span class="op" id="1364177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1364180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1364183">if</span>&nbsp;<span class="ident" id="1364186">quote</span>&nbsp;<span class="op" id="1364192">!=</span>&nbsp;<span class="num" id="1364195">0</span>&nbsp;<span class="op" id="1364197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1364201">err</span>&nbsp;<span class="op" id="1364205">=</span>&nbsp;<span class="ident" id="1364207">errors</span><span class="op" id="1364213">.</span><span class="ident" id="1364214">New</span><span class="op" id="1364217">(</span><span class="string" id="1364218">&#34;unclosed&nbsp;quote&#34;</span><span class="op" id="1364234">)</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1364237">}</span>&nbsp;<span class="keyword" id="1364239">else</span>&nbsp;<span class="keyword" id="1364244">if</span>&nbsp;<span class="ident" id="1364247">escaped</span>&nbsp;<span class="op" id="1364255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1364259">err</span>&nbsp;<span class="op" id="1364263">=</span>&nbsp;<span class="ident" id="1364265">errors</span><span class="op" id="1364271">.</span><span class="ident" id="1364272">New</span><span class="op" id="1364275">(</span><span class="string" id="1364276">&#34;unfinished&nbsp;escaping&#34;</span><span class="op" id="1364297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1364300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1364303">return</span>&nbsp;<span class="ident" id="1364310">args</span><span class="op" id="1364314">,</span>&nbsp;<span class="ident" id="1364316">err</span><br>
<span class="lineno"></span><span class="op" id="1364320">}</span><br>
<span class="lineno">1220</span><br>
<span class="lineno"></span><span class="comment" id="1364323">//&nbsp;match&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;name&nbsp;is&nbsp;one&nbsp;of:</span><br>
<span class="lineno"></span><span class="comment" id="1364368">//</span><br>
<span class="lineno"></span><span class="comment" id="1364371">//&nbsp;&nbsp;&nbsp;&nbsp$GOOS</span><br>
<span class="lineno"></span><span class="comment" id="1364380">//&nbsp;&nbsp;&nbsp;&nbsp$GOARCH</span><br>
<span class="lineno">1225</span><span class="comment" id="1364391">//&nbsp;&nbsp;&nbsp;&nbspcgo&nbsp;(if&nbsp;cgo&nbsp;is&nbsp;enabled)</span><br>
<span class="lineno"></span><span class="comment" id="1364418">//&nbsp;&nbsp;&nbsp;&nbsp!cgo&nbsp;(if&nbsp;cgo&nbsp;is&nbsp;disabled)</span><br>
<span class="lineno"></span><span class="comment" id="1364447">//&nbsp;&nbsp;&nbsp;&nbspctxt.Compiler</span><br>
<span class="lineno"></span><span class="comment" id="1364464">//&nbsp;&nbsp;&nbsp;&nbsp!ctxt.Compiler</span><br>
<span class="lineno"></span><span class="comment" id="1364482">//&nbsp;&nbsp;&nbsp;&nbsptag&nbsp;(if&nbsp;tag&nbsp;is&nbsp;listed&nbsp;in&nbsp;ctxt.BuildTags&nbsp;or&nbsp;ctxt.ReleaseTags)</span><br>
<span class="lineno">1230</span><span class="comment" id="1364546">//&nbsp;&nbsp;&nbsp;&nbsp!tag&nbsp;(if&nbsp;tag&nbsp;is&nbsp;not&nbsp;listed&nbsp;in&nbsp;ctxt.BuildTags&nbsp;or&nbsp;ctxt.ReleaseTags)</span><br>
<span class="lineno"></span><span class="comment" id="1364615">//&nbsp;&nbsp;&nbsp;&nbspa&nbsp;comma-separated&nbsp;list&nbsp;of&nbsp;any&nbsp;of&nbsp;these</span><br>
<span class="lineno"></span><span class="comment" id="1364657">//</span><br>
<span class="lineno"></span><span class="keyword" id="1364660">func</span>&nbsp;<span class="op" id="1364665">(</span><span class="ident" id="1364666">ctxt</span>&nbsp;<span class="op" id="1364671">*</span><span class="ident" id="1364672">Context</span><span class="op" id="1364679">)</span>&nbsp;<span class="ident" id="1364681">match</span><span class="op" id="1364686">(</span><span class="ident" id="1364687">name</span>&nbsp;<span class="builtintype" id="1364692">string</span><span class="op" id="1364698">,</span>&nbsp;<span class="ident" id="1364700">allTags</span>&nbsp;<span class="keyword" id="1364708">map</span><span class="op" id="1364711">[</span><span class="builtintype" id="1364712">string</span><span class="op" id="1364718">]</span><span class="builtintype" id="1364719">bool</span><span class="op" id="1364723">)</span>&nbsp;<span class="builtintype" id="1364725">bool</span>&nbsp;<span class="op" id="1364730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1364733">if</span>&nbsp;<span class="ident" id="1364736">name</span>&nbsp;<span class="op" id="1364741">==</span>&nbsp;<span class="string" id="1364744">&#34;&#34;</span>&nbsp;<span class="op" id="1364747">{</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1364751">if</span>&nbsp;<span class="ident" id="1364754">allTags</span>&nbsp;<span class="op" id="1364762">!=</span>&nbsp;<span class="ident" id="1364765">nil</span>&nbsp;<span class="op" id="1364769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1364774">allTags</span><span class="op" id="1364781">[</span><span class="ident" id="1364782">name</span><span class="op" id="1364786">]</span>&nbsp;<span class="op" id="1364788">=</span>&nbsp;<span class="builtintype" id="1364790">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1364797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1364801">return</span>&nbsp;<span class="builtintype" id="1364808">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1364815">}</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1364818">if</span>&nbsp;<span class="ident" id="1364821">i</span>&nbsp;<span class="op" id="1364823">:=</span>&nbsp;<span class="ident" id="1364826">strings</span><span class="op" id="1364833">.</span><span class="ident" id="1364834">Index</span><span class="op" id="1364839">(</span><span class="ident" id="1364840">name</span><span class="op" id="1364844">,</span>&nbsp;<span class="string" id="1364846">&#34;,&#34;</span><span class="op" id="1364849">)</span><span class="op" id="1364850">;</span>&nbsp;<span class="ident" id="1364852">i</span>&nbsp;<span class="op" id="1364854">&gt;=</span>&nbsp;<span class="num" id="1364857">0</span>&nbsp;<span class="op" id="1364859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1364863">//&nbsp;comma-separated&nbsp;list</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1364889">ok1</span>&nbsp;<span class="op" id="1364893">:=</span>&nbsp;<span class="ident" id="1364896">ctxt</span><span class="op" id="1364900">.</span><span class="ident" id="1364901">match</span><span class="op" id="1364906">(</span><span class="ident" id="1364907">name</span><span class="op" id="1364911">[</span><span class="op" id="1364912">:</span><span class="ident" id="1364913">i</span><span class="op" id="1364914">]</span><span class="op" id="1364915">,</span>&nbsp;<span class="ident" id="1364917">allTags</span><span class="op" id="1364924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1364928">ok2</span>&nbsp;<span class="op" id="1364932">:=</span>&nbsp;<span class="ident" id="1364935">ctxt</span><span class="op" id="1364939">.</span><span class="ident" id="1364940">match</span><span class="op" id="1364945">(</span><span class="ident" id="1364946">name</span><span class="op" id="1364950">[</span><span class="ident" id="1364951">i</span><span class="op" id="1364952">+</span><span class="num" id="1364953">1</span><span class="op" id="1364954">:</span><span class="op" id="1364955">]</span><span class="op" id="1364956">,</span>&nbsp;<span class="ident" id="1364958">allTags</span><span class="op" id="1364965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1364969">return</span>&nbsp;<span class="ident" id="1364976">ok1</span>&nbsp;<span class="op" id="1364980">&amp;&amp;</span>&nbsp;<span class="ident" id="1364983">ok2</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1364988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1364991">if</span>&nbsp;<span class="ident" id="1364994">strings</span><span class="op" id="1365001">.</span><span class="ident" id="1365002">HasPrefix</span><span class="op" id="1365011">(</span><span class="ident" id="1365012">name</span><span class="op" id="1365016">,</span>&nbsp;<span class="string" id="1365018">&#34;!!&#34;</span><span class="op" id="1365022">)</span>&nbsp;<span class="op" id="1365024">{</span>&nbsp;<span class="comment" id="1365026">//&nbsp;bad&nbsp;syntax,&nbsp;reject&nbsp;always</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1365057">return</span>&nbsp;<span class="builtintype" id="1365064">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1365071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1365074">if</span>&nbsp;<span class="ident" id="1365077">strings</span><span class="op" id="1365084">.</span><span class="ident" id="1365085">HasPrefix</span><span class="op" id="1365094">(</span><span class="ident" id="1365095">name</span><span class="op" id="1365099">,</span>&nbsp;<span class="string" id="1365101">&#34;!&#34;</span><span class="op" id="1365104">)</span>&nbsp;<span class="op" id="1365106">{</span>&nbsp;<span class="comment" id="1365108">//&nbsp;negation</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1365122">return</span>&nbsp;<span class="builtinfunc" id="1365129">len</span><span class="op" id="1365132">(</span><span class="ident" id="1365133">name</span><span class="op" id="1365137">)</span>&nbsp;<span class="op" id="1365139">&gt;</span>&nbsp;<span class="num" id="1365141">1</span>&nbsp;<span class="op" id="1365143">&amp;&amp;</span>&nbsp;<span class="op" id="1365146">!</span><span class="ident" id="1365147">ctxt</span><span class="op" id="1365151">.</span><span class="ident" id="1365152">match</span><span class="op" id="1365157">(</span><span class="ident" id="1365158">name</span><span class="op" id="1365162">[</span><span class="num" id="1365163">1</span><span class="op" id="1365164">:</span><span class="op" id="1365165">]</span><span class="op" id="1365166">,</span>&nbsp;<span class="ident" id="1365168">allTags</span><span class="op" id="1365175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1365178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1365182">if</span>&nbsp;<span class="ident" id="1365185">allTags</span>&nbsp;<span class="op" id="1365193">!=</span>&nbsp;<span class="ident" id="1365196">nil</span>&nbsp;<span class="op" id="1365200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1365204">allTags</span><span class="op" id="1365211">[</span><span class="ident" id="1365212">name</span><span class="op" id="1365216">]</span>&nbsp;<span class="op" id="1365218">=</span>&nbsp;<span class="builtintype" id="1365220">true</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1365226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1365230">//&nbsp;Tags&nbsp;must&nbsp;be&nbsp;letters,&nbsp;digits,&nbsp;underscores&nbsp;or&nbsp;dots.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1365285">//&nbsp;Unlike&nbsp;in&nbsp;Go&nbsp;identifiers,&nbsp;all&nbsp;digits&nbsp;are&nbsp;fine&nbsp;(e.g.,&nbsp;&#34;386&#34;).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1365350">for</span>&nbsp;<span class="ident" id="1365354">_</span><span class="op" id="1365355">,</span>&nbsp;<span class="ident" id="1365357">c</span>&nbsp;<span class="op" id="1365359">:=</span>&nbsp;<span class="keyword" id="1365362">range</span>&nbsp;<span class="ident" id="1365368">name</span>&nbsp;<span class="op" id="1365373">{</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1365377">if</span>&nbsp;<span class="op" id="1365380">!</span><span class="ident" id="1365381">unicode</span><span class="op" id="1365388">.</span><span class="ident" id="1365389">IsLetter</span><span class="op" id="1365397">(</span><span class="ident" id="1365398">c</span><span class="op" id="1365399">)</span>&nbsp;<span class="op" id="1365401">&amp;&amp;</span>&nbsp;<span class="op" id="1365404">!</span><span class="ident" id="1365405">unicode</span><span class="op" id="1365412">.</span><span class="ident" id="1365413">IsDigit</span><span class="op" id="1365420">(</span><span class="ident" id="1365421">c</span><span class="op" id="1365422">)</span>&nbsp;<span class="op" id="1365424">&amp;&amp;</span>&nbsp;<span class="ident" id="1365427">c</span>&nbsp;<span class="op" id="1365429">!=</span>&nbsp;<span class="string" id="1365432">&#39;_&#39;</span>&nbsp;<span class="op" id="1365436">&amp;&amp;</span>&nbsp;<span class="ident" id="1365439">c</span>&nbsp;<span class="op" id="1365441">!=</span>&nbsp;<span class="string" id="1365444">&#39;.&#39;</span>&nbsp;<span class="op" id="1365448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1365453">return</span>&nbsp;<span class="builtintype" id="1365460">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1365468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1365471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1365475">//&nbsp;special&nbsp;tags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1365492">if</span>&nbsp;<span class="ident" id="1365495">ctxt</span><span class="op" id="1365499">.</span><span class="ident" id="1365500">CgoEnabled</span>&nbsp;<span class="op" id="1365511">&amp;&amp;</span>&nbsp;<span class="ident" id="1365514">name</span>&nbsp;<span class="op" id="1365519">==</span>&nbsp;<span class="string" id="1365522">&#34;cgo&#34;</span>&nbsp;<span class="op" id="1365528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1365532">return</span>&nbsp;<span class="builtintype" id="1365539">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1365545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1365548">if</span>&nbsp;<span class="ident" id="1365551">name</span>&nbsp;<span class="op" id="1365556">==</span>&nbsp;<span class="ident" id="1365559">ctxt</span><span class="op" id="1365563">.</span><span class="ident" id="1365564">GOOS</span>&nbsp;<span class="op" id="1365569">||</span>&nbsp;<span class="ident" id="1365572">name</span>&nbsp;<span class="op" id="1365577">==</span>&nbsp;<span class="ident" id="1365580">ctxt</span><span class="op" id="1365584">.</span><span class="ident" id="1365585">GOARCH</span>&nbsp;<span class="op" id="1365592">||</span>&nbsp;<span class="ident" id="1365595">name</span>&nbsp;<span class="op" id="1365600">==</span>&nbsp;<span class="ident" id="1365603">ctxt</span><span class="op" id="1365607">.</span><span class="ident" id="1365608">Compiler</span>&nbsp;<span class="op" id="1365617">{</span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1365621">return</span>&nbsp;<span class="builtintype" id="1365628">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1365634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1365637">if</span>&nbsp;<span class="ident" id="1365640">ctxt</span><span class="op" id="1365644">.</span><span class="ident" id="1365645">GOOS</span>&nbsp;<span class="op" id="1365650">==</span>&nbsp;<span class="string" id="1365653">&#34;android&#34;</span>&nbsp;<span class="op" id="1365663">&amp;&amp;</span>&nbsp;<span class="ident" id="1365666">name</span>&nbsp;<span class="op" id="1365671">==</span>&nbsp;<span class="string" id="1365674">&#34;linux&#34;</span>&nbsp;<span class="op" id="1365682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1365686">return</span>&nbsp;<span class="builtintype" id="1365693">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1365699">}</span><br>
<span class="lineno">1275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1365703">//&nbsp;other&nbsp;tags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1365718">for</span>&nbsp;<span class="ident" id="1365722">_</span><span class="op" id="1365723">,</span>&nbsp;<span class="ident" id="1365725">tag</span>&nbsp;<span class="op" id="1365729">:=</span>&nbsp;<span class="keyword" id="1365732">range</span>&nbsp;<span class="ident" id="1365738">ctxt</span><span class="op" id="1365742">.</span><span class="ident" id="1365743">BuildTags</span>&nbsp;<span class="op" id="1365753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1365757">if</span>&nbsp;<span class="ident" id="1365760">tag</span>&nbsp;<span class="op" id="1365764">==</span>&nbsp;<span class="ident" id="1365767">name</span>&nbsp;<span class="op" id="1365772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1365777">return</span>&nbsp;<span class="builtintype" id="1365784">true</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1365791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1365794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1365797">for</span>&nbsp;<span class="ident" id="1365801">_</span><span class="op" id="1365802">,</span>&nbsp;<span class="ident" id="1365804">tag</span>&nbsp;<span class="op" id="1365808">:=</span>&nbsp;<span class="keyword" id="1365811">range</span>&nbsp;<span class="ident" id="1365817">ctxt</span><span class="op" id="1365821">.</span><span class="ident" id="1365822">ReleaseTags</span>&nbsp;<span class="op" id="1365834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1365838">if</span>&nbsp;<span class="ident" id="1365841">tag</span>&nbsp;<span class="op" id="1365845">==</span>&nbsp;<span class="ident" id="1365848">name</span>&nbsp;<span class="op" id="1365853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1365858">return</span>&nbsp;<span class="builtintype" id="1365865">true</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1365872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1365875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1365879">return</span>&nbsp;<span class="builtintype" id="1365886">false</span><br>
<span class="lineno"></span><span class="op" id="1365892">}</span><br>
<span class="lineno">1290</span><br>
<span class="lineno"></span><span class="comment" id="1365895">//&nbsp;goodOSArchFile&nbsp;returns&nbsp;false&nbsp;if&nbsp;the&nbsp;name&nbsp;contains&nbsp;a&nbsp;$GOOS&nbsp;or&nbsp;$GOARCH</span><br>
<span class="lineno"></span><span class="comment" id="1365967">//&nbsp;suffix&nbsp;which&nbsp;does&nbsp;not&nbsp;match&nbsp;the&nbsp;current&nbsp;system.</span><br>
<span class="lineno"></span><span class="comment" id="1366018">//&nbsp;The&nbsp;recognized&nbsp;name&nbsp;formats&nbsp;are:</span><br>
<span class="lineno"></span><span class="comment" id="1366054">//</span><br>
<span class="lineno">1295</span><span class="comment" id="1366057">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name_$(GOOS).*</span><br>
<span class="lineno"></span><span class="comment" id="1366079">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name_$(GOARCH).*</span><br>
<span class="lineno"></span><span class="comment" id="1366103">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name_$(GOOS)_$(GOARCH).*</span><br>
<span class="lineno"></span><span class="comment" id="1366135">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name_$(GOOS)_test.*</span><br>
<span class="lineno"></span><span class="comment" id="1366162">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name_$(GOARCH)_test.*</span><br>
<span class="lineno">1300</span><span class="comment" id="1366191">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;name_$(GOOS)_$(GOARCH)_test.*</span><br>
<span class="lineno"></span><span class="comment" id="1366228">//</span><br>
<span class="lineno"></span><span class="comment" id="1366231">//&nbsp;An&nbsp;exception:&nbsp;if&nbsp;GOOS=android,&nbsp;then&nbsp;files&nbsp;with&nbsp;GOOS=linux&nbsp;are&nbsp;also&nbsp;matched.</span><br>
<span class="lineno"></span><span class="keyword" id="1366310">func</span>&nbsp;<span class="op" id="1366315">(</span><span class="ident" id="1366316">ctxt</span>&nbsp;<span class="op" id="1366321">*</span><span class="ident" id="1366322">Context</span><span class="op" id="1366329">)</span>&nbsp;<span class="ident" id="1366331">goodOSArchFile</span><span class="op" id="1366345">(</span><span class="ident" id="1366346">name</span>&nbsp;<span class="builtintype" id="1366351">string</span><span class="op" id="1366357">,</span>&nbsp;<span class="ident" id="1366359">allTags</span>&nbsp;<span class="keyword" id="1366367">map</span><span class="op" id="1366370">[</span><span class="builtintype" id="1366371">string</span><span class="op" id="1366377">]</span><span class="builtintype" id="1366378">bool</span><span class="op" id="1366382">)</span>&nbsp;<span class="builtintype" id="1366384">bool</span>&nbsp;<span class="op" id="1366389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1366392">if</span>&nbsp;<span class="ident" id="1366395">dot</span>&nbsp;<span class="op" id="1366399">:=</span>&nbsp;<span class="ident" id="1366402">strings</span><span class="op" id="1366409">.</span><span class="ident" id="1366410">Index</span><span class="op" id="1366415">(</span><span class="ident" id="1366416">name</span><span class="op" id="1366420">,</span>&nbsp;<span class="string" id="1366422">&#34;.&#34;</span><span class="op" id="1366425">)</span><span class="op" id="1366426">;</span>&nbsp;<span class="ident" id="1366428">dot</span>&nbsp;<span class="op" id="1366432">!=</span>&nbsp;<span class="op" id="1366435">-</span><span class="num" id="1366436">1</span>&nbsp;<span class="op" id="1366438">{</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1366442">name</span>&nbsp;<span class="op" id="1366447">=</span>&nbsp;<span class="ident" id="1366449">name</span><span class="op" id="1366453">[</span><span class="op" id="1366454">:</span><span class="ident" id="1366455">dot</span><span class="op" id="1366458">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1366461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1366465">//&nbsp;Before&nbsp;Go&nbsp;1.4,&nbsp;a&nbsp;file&nbsp;called&nbsp;&#34;linux.go&#34;&nbsp;would&nbsp;be&nbsp;equivalent&nbsp;to&nbsp;having&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1366541">//&nbsp;build&nbsp;tag&nbsp;&#34;linux&#34;&nbsp;in&nbsp;that&nbsp;file.&nbsp;For&nbsp;Go&nbsp;1.4&nbsp;and&nbsp;beyond,&nbsp;we&nbsp;require&nbsp;this</span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1366616">//&nbsp;auto-tagging&nbsp;to&nbsp;apply&nbsp;only&nbsp;to&nbsp;files&nbsp;with&nbsp;a&nbsp;non-empty&nbsp;prefix,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1366684">//&nbsp;&#34;foo_linux.go&#34;&nbsp;is&nbsp;tagged&nbsp;but&nbsp;&#34;linux.go&#34;&nbsp;is&nbsp;not.&nbsp;This&nbsp;allows&nbsp;new&nbsp;operating</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1366762">//&nbsp;sytems,&nbsp;such&nbsp;as&nbsp;android,&nbsp;to&nbsp;arrive&nbsp;without&nbsp;breaking&nbsp;existing&nbsp;code&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1366837">//&nbsp;innocuous&nbsp;source&nbsp;code&nbsp;in&nbsp;&#34;android.go&#34;.&nbsp;The&nbsp;easiest&nbsp;fix:&nbsp;cut&nbsp;everything</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1366912">//&nbsp;in&nbsp;the&nbsp;name&nbsp;before&nbsp;the&nbsp;initial&nbsp;_.</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1366950">i</span>&nbsp;<span class="op" id="1366952">:=</span>&nbsp;<span class="ident" id="1366955">strings</span><span class="op" id="1366962">.</span><span class="ident" id="1366963">Index</span><span class="op" id="1366968">(</span><span class="ident" id="1366969">name</span><span class="op" id="1366973">,</span>&nbsp;<span class="string" id="1366975">&#34;_&#34;</span><span class="op" id="1366978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1366981">if</span>&nbsp;<span class="ident" id="1366984">i</span>&nbsp;<span class="op" id="1366986">&lt;</span>&nbsp;<span class="num" id="1366988">0</span>&nbsp;<span class="op" id="1366990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1366994">return</span>&nbsp;<span class="builtintype" id="1367001">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1367007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1367010">name</span>&nbsp;<span class="op" id="1367015">=</span>&nbsp;<span class="ident" id="1367017">name</span><span class="op" id="1367021">[</span><span class="ident" id="1367022">i</span><span class="op" id="1367023">:</span><span class="op" id="1367024">]</span>&nbsp;<span class="comment" id="1367026">//&nbsp;ignore&nbsp;everything&nbsp;before&nbsp;first&nbsp;_</span><br>
<span class="lineno">1320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1367064">l</span>&nbsp;<span class="op" id="1367066">:=</span>&nbsp;<span class="ident" id="1367069">strings</span><span class="op" id="1367076">.</span><span class="ident" id="1367077">Split</span><span class="op" id="1367082">(</span><span class="ident" id="1367083">name</span><span class="op" id="1367087">,</span>&nbsp;<span class="string" id="1367089">&#34;_&#34;</span><span class="op" id="1367092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1367095">if</span>&nbsp;<span class="ident" id="1367098">n</span>&nbsp;<span class="op" id="1367100">:=</span>&nbsp;<span class="builtinfunc" id="1367103">len</span><span class="op" id="1367106">(</span><span class="ident" id="1367107">l</span><span class="op" id="1367108">)</span><span class="op" id="1367109">;</span>&nbsp;<span class="ident" id="1367111">n</span>&nbsp;<span class="op" id="1367113">&gt;</span>&nbsp;<span class="num" id="1367115">0</span>&nbsp;<span class="op" id="1367117">&amp;&amp;</span>&nbsp;<span class="ident" id="1367120">l</span><span class="op" id="1367121">[</span><span class="ident" id="1367122">n</span><span class="op" id="1367123">-</span><span class="num" id="1367124">1</span><span class="op" id="1367125">]</span>&nbsp;<span class="op" id="1367127">==</span>&nbsp;<span class="string" id="1367130">&#34;test&#34;</span>&nbsp;<span class="op" id="1367137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1367141">l</span>&nbsp;<span class="op" id="1367143">=</span>&nbsp;<span class="ident" id="1367145">l</span><span class="op" id="1367146">[</span><span class="op" id="1367147">:</span><span class="ident" id="1367148">n</span><span class="op" id="1367149">-</span><span class="num" id="1367150">1</span><span class="op" id="1367151">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1367154">}</span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1367157">n</span>&nbsp;<span class="op" id="1367159">:=</span>&nbsp;<span class="builtinfunc" id="1367162">len</span><span class="op" id="1367165">(</span><span class="ident" id="1367166">l</span><span class="op" id="1367167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1367170">if</span>&nbsp;<span class="ident" id="1367173">n</span>&nbsp;<span class="op" id="1367175">&gt;=</span>&nbsp;<span class="num" id="1367178">2</span>&nbsp;<span class="op" id="1367180">&amp;&amp;</span>&nbsp;<span class="ident" id="1367183">knownOS</span><span class="op" id="1367190">[</span><span class="ident" id="1367191">l</span><span class="op" id="1367192">[</span><span class="ident" id="1367193">n</span><span class="op" id="1367194">-</span><span class="num" id="1367195">2</span><span class="op" id="1367196">]</span><span class="op" id="1367197">]</span>&nbsp;<span class="op" id="1367199">&amp;&amp;</span>&nbsp;<span class="ident" id="1367202">knownArch</span><span class="op" id="1367211">[</span><span class="ident" id="1367212">l</span><span class="op" id="1367213">[</span><span class="ident" id="1367214">n</span><span class="op" id="1367215">-</span><span class="num" id="1367216">1</span><span class="op" id="1367217">]</span><span class="op" id="1367218">]</span>&nbsp;<span class="op" id="1367220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1367224">if</span>&nbsp;<span class="ident" id="1367227">allTags</span>&nbsp;<span class="op" id="1367235">!=</span>&nbsp;<span class="ident" id="1367238">nil</span>&nbsp;<span class="op" id="1367242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1367247">allTags</span><span class="op" id="1367254">[</span><span class="ident" id="1367255">l</span><span class="op" id="1367256">[</span><span class="ident" id="1367257">n</span><span class="op" id="1367258">-</span><span class="num" id="1367259">2</span><span class="op" id="1367260">]</span><span class="op" id="1367261">]</span>&nbsp;<span class="op" id="1367263">=</span>&nbsp;<span class="builtintype" id="1367265">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1367273">allTags</span><span class="op" id="1367280">[</span><span class="ident" id="1367281">l</span><span class="op" id="1367282">[</span><span class="ident" id="1367283">n</span><span class="op" id="1367284">-</span><span class="num" id="1367285">1</span><span class="op" id="1367286">]</span><span class="op" id="1367287">]</span>&nbsp;<span class="op" id="1367289">=</span>&nbsp;<span class="builtintype" id="1367291">true</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1367298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1367302">if</span>&nbsp;<span class="ident" id="1367305">l</span><span class="op" id="1367306">[</span><span class="ident" id="1367307">n</span><span class="op" id="1367308">-</span><span class="num" id="1367309">1</span><span class="op" id="1367310">]</span>&nbsp;<span class="op" id="1367312">!=</span>&nbsp;<span class="ident" id="1367315">ctxt</span><span class="op" id="1367319">.</span><span class="ident" id="1367320">GOARCH</span>&nbsp;<span class="op" id="1367327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1367332">return</span>&nbsp;<span class="builtintype" id="1367339">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1367347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1367351">if</span>&nbsp;<span class="ident" id="1367354">ctxt</span><span class="op" id="1367358">.</span><span class="ident" id="1367359">GOOS</span>&nbsp;<span class="op" id="1367364">==</span>&nbsp;<span class="string" id="1367367">&#34;android&#34;</span>&nbsp;<span class="op" id="1367377">&amp;&amp;</span>&nbsp;<span class="ident" id="1367380">l</span><span class="op" id="1367381">[</span><span class="ident" id="1367382">n</span><span class="op" id="1367383">-</span><span class="num" id="1367384">2</span><span class="op" id="1367385">]</span>&nbsp;<span class="op" id="1367387">==</span>&nbsp;<span class="string" id="1367390">&#34;linux&#34;</span>&nbsp;<span class="op" id="1367398">{</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1367403">return</span>&nbsp;<span class="builtintype" id="1367410">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1367417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1367421">return</span>&nbsp;<span class="ident" id="1367428">l</span><span class="op" id="1367429">[</span><span class="ident" id="1367430">n</span><span class="op" id="1367431">-</span><span class="num" id="1367432">2</span><span class="op" id="1367433">]</span>&nbsp;<span class="op" id="1367435">==</span>&nbsp;<span class="ident" id="1367438">ctxt</span><span class="op" id="1367442">.</span><span class="ident" id="1367443">GOOS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1367449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1367452">if</span>&nbsp;<span class="ident" id="1367455">n</span>&nbsp;<span class="op" id="1367457">&gt;=</span>&nbsp;<span class="num" id="1367460">1</span>&nbsp;<span class="op" id="1367462">&amp;&amp;</span>&nbsp;<span class="ident" id="1367465">knownOS</span><span class="op" id="1367472">[</span><span class="ident" id="1367473">l</span><span class="op" id="1367474">[</span><span class="ident" id="1367475">n</span><span class="op" id="1367476">-</span><span class="num" id="1367477">1</span><span class="op" id="1367478">]</span><span class="op" id="1367479">]</span>&nbsp;<span class="op" id="1367481">{</span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1367485">if</span>&nbsp;<span class="ident" id="1367488">allTags</span>&nbsp;<span class="op" id="1367496">!=</span>&nbsp;<span class="ident" id="1367499">nil</span>&nbsp;<span class="op" id="1367503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1367508">allTags</span><span class="op" id="1367515">[</span><span class="ident" id="1367516">l</span><span class="op" id="1367517">[</span><span class="ident" id="1367518">n</span><span class="op" id="1367519">-</span><span class="num" id="1367520">1</span><span class="op" id="1367521">]</span><span class="op" id="1367522">]</span>&nbsp;<span class="op" id="1367524">=</span>&nbsp;<span class="builtintype" id="1367526">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1367533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1367537">if</span>&nbsp;<span class="ident" id="1367540">ctxt</span><span class="op" id="1367544">.</span><span class="ident" id="1367545">GOOS</span>&nbsp;<span class="op" id="1367550">==</span>&nbsp;<span class="string" id="1367553">&#34;android&#34;</span>&nbsp;<span class="op" id="1367563">&amp;&amp;</span>&nbsp;<span class="ident" id="1367566">l</span><span class="op" id="1367567">[</span><span class="ident" id="1367568">n</span><span class="op" id="1367569">-</span><span class="num" id="1367570">1</span><span class="op" id="1367571">]</span>&nbsp;<span class="op" id="1367573">==</span>&nbsp;<span class="string" id="1367576">&#34;linux&#34;</span>&nbsp;<span class="op" id="1367584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1367589">return</span>&nbsp;<span class="builtintype" id="1367596">true</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1367603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1367607">return</span>&nbsp;<span class="ident" id="1367614">l</span><span class="op" id="1367615">[</span><span class="ident" id="1367616">n</span><span class="op" id="1367617">-</span><span class="num" id="1367618">1</span><span class="op" id="1367619">]</span>&nbsp;<span class="op" id="1367621">==</span>&nbsp;<span class="ident" id="1367624">ctxt</span><span class="op" id="1367628">.</span><span class="ident" id="1367629">GOOS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1367635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1367638">if</span>&nbsp;<span class="ident" id="1367641">n</span>&nbsp;<span class="op" id="1367643">&gt;=</span>&nbsp;<span class="num" id="1367646">1</span>&nbsp;<span class="op" id="1367648">&amp;&amp;</span>&nbsp;<span class="ident" id="1367651">knownArch</span><span class="op" id="1367660">[</span><span class="ident" id="1367661">l</span><span class="op" id="1367662">[</span><span class="ident" id="1367663">n</span><span class="op" id="1367664">-</span><span class="num" id="1367665">1</span><span class="op" id="1367666">]</span><span class="op" id="1367667">]</span>&nbsp;<span class="op" id="1367669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1367673">if</span>&nbsp;<span class="ident" id="1367676">allTags</span>&nbsp;<span class="op" id="1367684">!=</span>&nbsp;<span class="ident" id="1367687">nil</span>&nbsp;<span class="op" id="1367691">{</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1367696">allTags</span><span class="op" id="1367703">[</span><span class="ident" id="1367704">l</span><span class="op" id="1367705">[</span><span class="ident" id="1367706">n</span><span class="op" id="1367707">-</span><span class="num" id="1367708">1</span><span class="op" id="1367709">]</span><span class="op" id="1367710">]</span>&nbsp;<span class="op" id="1367712">=</span>&nbsp;<span class="builtintype" id="1367714">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1367721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1367725">return</span>&nbsp;<span class="ident" id="1367732">l</span><span class="op" id="1367733">[</span><span class="ident" id="1367734">n</span><span class="op" id="1367735">-</span><span class="num" id="1367736">1</span><span class="op" id="1367737">]</span>&nbsp;<span class="op" id="1367739">==</span>&nbsp;<span class="ident" id="1367742">ctxt</span><span class="op" id="1367746">.</span><span class="ident" id="1367747">GOARCH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1367755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1367758">return</span>&nbsp;<span class="builtintype" id="1367765">true</span><br>
<span class="lineno">1355</span><span class="op" id="1367770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1367773">var</span>&nbsp;<span class="ident" id="1367777">knownOS</span>&nbsp;<span class="op" id="1367785">=</span>&nbsp;<span class="builtinfunc" id="1367787">make</span><span class="op" id="1367791">(</span><span class="keyword" id="1367792">map</span><span class="op" id="1367795">[</span><span class="builtintype" id="1367796">string</span><span class="op" id="1367802">]</span><span class="builtintype" id="1367803">bool</span><span class="op" id="1367807">)</span><br>
<span class="lineno"></span><span class="keyword" id="1367809">var</span>&nbsp;<span class="ident" id="1367813">knownArch</span>&nbsp;<span class="op" id="1367823">=</span>&nbsp;<span class="builtinfunc" id="1367825">make</span><span class="op" id="1367829">(</span><span class="keyword" id="1367830">map</span><span class="op" id="1367833">[</span><span class="builtintype" id="1367834">string</span><span class="op" id="1367840">]</span><span class="builtintype" id="1367841">bool</span><span class="op" id="1367845">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1360</span><span class="keyword" id="1367848">func</span>&nbsp;<span class="ident" id="1367853">init</span><span class="op" id="1367857">(</span><span class="op" id="1367858">)</span>&nbsp;<span class="op" id="1367860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1367863">for</span>&nbsp;<span class="ident" id="1367867">_</span><span class="op" id="1367868">,</span>&nbsp;<span class="ident" id="1367870">v</span>&nbsp;<span class="op" id="1367872">:=</span>&nbsp;<span class="keyword" id="1367875">range</span>&nbsp;<span class="ident" id="1367881">strings</span><span class="op" id="1367888">.</span><span class="ident" id="1367889">Fields</span><span class="op" id="1367895">(</span><span class="ident" id="1367896">goosList</span><span class="op" id="1367904">)</span>&nbsp;<span class="op" id="1367906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1367910">knownOS</span><span class="op" id="1367917">[</span><span class="ident" id="1367918">v</span><span class="op" id="1367919">]</span>&nbsp;<span class="op" id="1367921">=</span>&nbsp;<span class="builtintype" id="1367923">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1367929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1367932">for</span>&nbsp;<span class="ident" id="1367936">_</span><span class="op" id="1367937">,</span>&nbsp;<span class="ident" id="1367939">v</span>&nbsp;<span class="op" id="1367941">:=</span>&nbsp;<span class="keyword" id="1367944">range</span>&nbsp;<span class="ident" id="1367950">strings</span><span class="op" id="1367957">.</span><span class="ident" id="1367958">Fields</span><span class="op" id="1367964">(</span><span class="ident" id="1367965">goarchList</span><span class="op" id="1367975">)</span>&nbsp;<span class="op" id="1367977">{</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1367981">knownArch</span><span class="op" id="1367990">[</span><span class="ident" id="1367991">v</span><span class="op" id="1367992">]</span>&nbsp;<span class="op" id="1367994">=</span>&nbsp;<span class="builtintype" id="1367996">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1368002">}</span><br>
<span class="lineno"></span><span class="op" id="1368004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1368007">//&nbsp;ToolDir&nbsp;is&nbsp;the&nbsp;directory&nbsp;containing&nbsp;build&nbsp;tools.</span><br>
<span class="lineno">1370</span><span class="keyword" id="1368059">var</span>&nbsp;<span class="ident" id="1368063">ToolDir</span>&nbsp;<span class="op" id="1368071">=</span>&nbsp;<span class="ident" id="1368073">filepath</span><span class="op" id="1368081">.</span><span class="ident" id="1368082">Join</span><span class="op" id="1368086">(</span><span class="ident" id="1368087">runtime</span><span class="op" id="1368094">.</span><span class="ident" id="1368095">GOROOT</span><span class="op" id="1368101">(</span><span class="op" id="1368102">)</span><span class="op" id="1368103">,</span>&nbsp;<span class="string" id="1368105">&#34;pkg/tool/&#34;</span><span class="op" id="1368116">+</span><span class="ident" id="1368117">runtime</span><span class="op" id="1368124">.</span><span class="ident" id="1368125">GOOS</span><span class="op" id="1368129">+</span><span class="string" id="1368130">&#34;_&#34;</span><span class="op" id="1368133">+</span><span class="ident" id="1368134">runtime</span><span class="op" id="1368141">.</span><span class="ident" id="1368142">GOARCH</span><span class="op" id="1368148">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1368151">//&nbsp;IsLocalImport&nbsp;reports&nbsp;whether&nbsp;the&nbsp;import&nbsp;path&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="1368203">//&nbsp;a&nbsp;local&nbsp;import&nbsp;path,&nbsp;like&nbsp;&#34;.&#34;,&nbsp;&#34;..&#34;,&nbsp;&#34;./foo&#34;,&nbsp;or&nbsp;&#34;../foo&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="1368265">func</span>&nbsp;<span class="ident" id="1368270">IsLocalImport</span><span class="op" id="1368283">(</span><span class="ident" id="1368284">path</span>&nbsp;<span class="builtintype" id="1368289">string</span><span class="op" id="1368295">)</span>&nbsp;<span class="builtintype" id="1368297">bool</span>&nbsp;<span class="op" id="1368302">{</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1368305">return</span>&nbsp;<span class="ident" id="1368312">path</span>&nbsp;<span class="op" id="1368317">==</span>&nbsp;<span class="string" id="1368320">&#34;.&#34;</span>&nbsp;<span class="op" id="1368324">||</span>&nbsp;<span class="ident" id="1368327">path</span>&nbsp;<span class="op" id="1368332">==</span>&nbsp;<span class="string" id="1368335">&#34;..&#34;</span>&nbsp;<span class="op" id="1368340">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1368345">strings</span><span class="op" id="1368352">.</span><span class="ident" id="1368353">HasPrefix</span><span class="op" id="1368362">(</span><span class="ident" id="1368363">path</span><span class="op" id="1368367">,</span>&nbsp;<span class="string" id="1368369">&#34;./&#34;</span><span class="op" id="1368373">)</span>&nbsp;<span class="op" id="1368375">||</span>&nbsp;<span class="ident" id="1368378">strings</span><span class="op" id="1368385">.</span><span class="ident" id="1368386">HasPrefix</span><span class="op" id="1368395">(</span><span class="ident" id="1368396">path</span><span class="op" id="1368400">,</span>&nbsp;<span class="string" id="1368402">&#34;../&#34;</span><span class="op" id="1368407">)</span><br>
<span class="lineno"></span><span class="op" id="1368409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1368412">//&nbsp;ArchChar&nbsp;returns&nbsp;the&nbsp;architecture&nbsp;character&nbsp;for&nbsp;the&nbsp;given&nbsp;goarch.</span><br>
<span class="lineno">1380</span><span class="comment" id="1368481">//&nbsp;For&nbsp;example,&nbsp;ArchChar(&#34;amd64&#34;)&nbsp;returns&nbsp;&#34;6&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="1368528">func</span>&nbsp;<span class="ident" id="1368533">ArchChar</span><span class="op" id="1368541">(</span><span class="ident" id="1368542">goarch</span>&nbsp;<span class="builtintype" id="1368549">string</span><span class="op" id="1368555">)</span>&nbsp;<span class="op" id="1368557">(</span><span class="builtintype" id="1368558">string</span><span class="op" id="1368564">,</span>&nbsp;<span class="builtintype" id="1368566">error</span><span class="op" id="1368571">)</span>&nbsp;<span class="op" id="1368573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1368576">switch</span>&nbsp;<span class="ident" id="1368583">goarch</span>&nbsp;<span class="op" id="1368590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1368593">case</span>&nbsp;<span class="string" id="1368598">&#34;386&#34;</span><span class="op" id="1368603">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1368607">return</span>&nbsp;<span class="string" id="1368614">&#34;8&#34;</span><span class="op" id="1368617">,</span>&nbsp;<span class="ident" id="1368619">nil</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1368624">case</span>&nbsp;<span class="string" id="1368629">&#34;amd64&#34;</span><span class="op" id="1368636">,</span>&nbsp;<span class="string" id="1368638">&#34;amd64p32&#34;</span><span class="op" id="1368648">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1368652">return</span>&nbsp;<span class="string" id="1368659">&#34;6&#34;</span><span class="op" id="1368662">,</span>&nbsp;<span class="ident" id="1368664">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1368669">case</span>&nbsp;<span class="string" id="1368674">&#34;arm&#34;</span><span class="op" id="1368679">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1368683">return</span>&nbsp;<span class="string" id="1368690">&#34;5&#34;</span><span class="op" id="1368693">,</span>&nbsp;<span class="ident" id="1368695">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1368700">}</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1368703">return</span>&nbsp;<span class="string" id="1368710">&#34;&#34;</span><span class="op" id="1368712">,</span>&nbsp;<span class="ident" id="1368714">errors</span><span class="op" id="1368720">.</span><span class="ident" id="1368721">New</span><span class="op" id="1368724">(</span><span class="string" id="1368725">&#34;unsupported&nbsp;GOARCH&nbsp;&#34;</span>&nbsp;<span class="op" id="1368747">+</span>&nbsp;<span class="ident" id="1368749">goarch</span><span class="op" id="1368755">)</span><br>
<span class="lineno"></span><span class="op" id="1368757">}</span>
</div>
</body>
</html>
