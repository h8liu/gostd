<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7443091">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7443146">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7443200">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7443251">package</span>&nbsp;<span class="ident" id="7443259">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7443268">import</span>&nbsp;<span class="op" id="7443275">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7443278">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7443287">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7443297">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7443305">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7443312">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7443322">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7443335">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7443347">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7443360">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7443377">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7443388">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7443395">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="7443398">const</span>&nbsp;<span class="op" id="7443404">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7443407">dataDir</span>&nbsp;&nbsp;<span class="op" id="7443416">=</span>&nbsp;<span class="string" id="7443418">&#34;testdata&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7443430">tabwidth</span>&nbsp;<span class="op" id="7443439">=</span>&nbsp;<span class="num" id="7443441">8</span><br>
<span class="lineno"></span><span class="op" id="7443443">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="7443446">var</span>&nbsp;<span class="ident" id="7443450">update</span>&nbsp;<span class="op" id="7443457">=</span>&nbsp;<span class="ident" id="7443459">flag</span><span class="op" id="7443463">.</span><span class="ident" id="7443464">Bool</span><span class="op" id="7443468">(</span><span class="string" id="7443469">&#34;update&#34;</span><span class="op" id="7443477">,</span>&nbsp;<span class="builtintype" id="7443479">false</span><span class="op" id="7443484">,</span>&nbsp;<span class="string" id="7443486">&#34;update&nbsp;golden&nbsp;files&#34;</span><span class="op" id="7443507">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7443510">var</span>&nbsp;<span class="ident" id="7443514">fset</span>&nbsp;<span class="op" id="7443519">=</span>&nbsp;<span class="ident" id="7443521">token</span><span class="op" id="7443526">.</span><span class="ident" id="7443527">NewFileSet</span><span class="op" id="7443537">(</span><span class="op" id="7443538">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7443541">type</span>&nbsp;<span class="ident" id="7443546">checkMode</span>&nbsp;<span class="builtintype" id="7443556">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7443562">const</span>&nbsp;<span class="op" id="7443568">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7443571">export</span>&nbsp;<span class="ident" id="7443578">checkMode</span>&nbsp;<span class="op" id="7443588">=</span>&nbsp;<span class="num" id="7443590">1</span>&nbsp;<span class="op" id="7443592">&lt;&lt;</span>&nbsp;<span class="ident" id="7443595">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7443601">rawFormat</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7443612">idempotent</span><br>
<span class="lineno"></span><span class="op" id="7443623">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7443626">//&nbsp;format&nbsp;parses&nbsp;src,&nbsp;prints&nbsp;the&nbsp;corresponding&nbsp;AST,&nbsp;verifies&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="7443701">//&nbsp;src&nbsp;is&nbsp;syntactically&nbsp;correct,&nbsp;and&nbsp;returns&nbsp;the&nbsp;resulting&nbsp;src&nbsp;or&nbsp;an&nbsp;error</span><br>
<span class="lineno">40</span><span class="comment" id="7443776">//&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="7443787">func</span>&nbsp;<span class="ident" id="7443792">format</span><span class="op" id="7443798">(</span><span class="ident" id="7443799">src</span>&nbsp;<span class="op" id="7443803">[</span><span class="op" id="7443804">]</span><span class="builtintype" id="7443805">byte</span><span class="op" id="7443809">,</span>&nbsp;<span class="ident" id="7443811">mode</span>&nbsp;<span class="ident" id="7443816">checkMode</span><span class="op" id="7443825">)</span>&nbsp;<span class="op" id="7443827">(</span><span class="op" id="7443828">[</span><span class="op" id="7443829">]</span><span class="builtintype" id="7443830">byte</span><span class="op" id="7443834">,</span>&nbsp;<span class="builtintype" id="7443836">error</span><span class="op" id="7443841">)</span>&nbsp;<span class="op" id="7443843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7443846">//&nbsp;parse&nbsp;src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7443860">f</span><span class="op" id="7443861">,</span>&nbsp;<span class="ident" id="7443863">err</span>&nbsp;<span class="op" id="7443867">:=</span>&nbsp;<span class="ident" id="7443870">parser</span><span class="op" id="7443876">.</span><span class="ident" id="7443877">ParseFile</span><span class="op" id="7443886">(</span><span class="ident" id="7443887">fset</span><span class="op" id="7443891">,</span>&nbsp;<span class="string" id="7443893">&#34;&#34;</span><span class="op" id="7443895">,</span>&nbsp;<span class="ident" id="7443897">src</span><span class="op" id="7443900">,</span>&nbsp;<span class="ident" id="7443902">parser</span><span class="op" id="7443908">.</span><span class="ident" id="7443909">ParseComments</span><span class="op" id="7443922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7443925">if</span>&nbsp;<span class="ident" id="7443928">err</span>&nbsp;<span class="op" id="7443932">!=</span>&nbsp;<span class="ident" id="7443935">nil</span>&nbsp;<span class="op" id="7443939">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7443943">return</span>&nbsp;<span class="ident" id="7443950">nil</span><span class="op" id="7443953">,</span>&nbsp;<span class="ident" id="7443955">fmt</span><span class="op" id="7443958">.</span><span class="ident" id="7443959">Errorf</span><span class="op" id="7443965">(</span><span class="string" id="7443966">&#34;parse:&nbsp;%s\n%s&#34;</span><span class="op" id="7443981">,</span>&nbsp;<span class="ident" id="7443983">err</span><span class="op" id="7443986">,</span>&nbsp;<span class="ident" id="7443988">src</span><span class="op" id="7443991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7443994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7443998">//&nbsp;filter&nbsp;exports&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7444030">if</span>&nbsp;<span class="ident" id="7444033">mode</span><span class="op" id="7444037">&amp;</span><span class="ident" id="7444038">export</span>&nbsp;<span class="op" id="7444045">!=</span>&nbsp;<span class="num" id="7444048">0</span>&nbsp;<span class="op" id="7444050">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444054">ast</span><span class="op" id="7444057">.</span><span class="ident" id="7444058">FileExports</span><span class="op" id="7444069">(</span><span class="ident" id="7444070">f</span><span class="op" id="7444071">)</span>&nbsp;<span class="comment" id="7444073">//&nbsp;ignore&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444092">f</span><span class="op" id="7444093">.</span><span class="ident" id="7444094">Comments</span>&nbsp;<span class="op" id="7444103">=</span>&nbsp;<span class="ident" id="7444105">nil</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="7444111">//&nbsp;don&#39;t&nbsp;print&nbsp;comments&nbsp;that&nbsp;are&nbsp;not&nbsp;in&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7444156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7444160">//&nbsp;determine&nbsp;printer&nbsp;configuration</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444196">cfg</span>&nbsp;<span class="op" id="7444200">:=</span>&nbsp;<span class="ident" id="7444203">Config</span><span class="op" id="7444209">{</span><span class="ident" id="7444210">Tabwidth</span><span class="op" id="7444218">:</span>&nbsp;<span class="ident" id="7444220">tabwidth</span><span class="op" id="7444228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7444231">if</span>&nbsp;<span class="ident" id="7444234">mode</span><span class="op" id="7444238">&amp;</span><span class="ident" id="7444239">rawFormat</span>&nbsp;<span class="op" id="7444249">!=</span>&nbsp;<span class="num" id="7444252">0</span>&nbsp;<span class="op" id="7444254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444258">cfg</span><span class="op" id="7444261">.</span><span class="ident" id="7444262">Mode</span>&nbsp;<span class="op" id="7444267">|=</span>&nbsp;<span class="ident" id="7444270">RawFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7444281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7444285">//&nbsp;print&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7444299">var</span>&nbsp;<span class="ident" id="7444303">buf</span>&nbsp;<span class="ident" id="7444307">bytes</span><span class="op" id="7444312">.</span><span class="ident" id="7444313">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7444321">if</span>&nbsp;<span class="ident" id="7444324">err</span>&nbsp;<span class="op" id="7444328">:=</span>&nbsp;<span class="ident" id="7444331">cfg</span><span class="op" id="7444334">.</span><span class="ident" id="7444335">Fprint</span><span class="op" id="7444341">(</span><span class="op" id="7444342">&amp;</span><span class="ident" id="7444343">buf</span><span class="op" id="7444346">,</span>&nbsp;<span class="ident" id="7444348">fset</span><span class="op" id="7444352">,</span>&nbsp;<span class="ident" id="7444354">f</span><span class="op" id="7444355">)</span><span class="op" id="7444356">;</span>&nbsp;<span class="ident" id="7444358">err</span>&nbsp;<span class="op" id="7444362">!=</span>&nbsp;<span class="ident" id="7444365">nil</span>&nbsp;<span class="op" id="7444369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7444373">return</span>&nbsp;<span class="ident" id="7444380">nil</span><span class="op" id="7444383">,</span>&nbsp;<span class="ident" id="7444385">fmt</span><span class="op" id="7444388">.</span><span class="ident" id="7444389">Errorf</span><span class="op" id="7444395">(</span><span class="string" id="7444396">&#34;print:&nbsp;%s&#34;</span><span class="op" id="7444407">,</span>&nbsp;<span class="ident" id="7444409">err</span><span class="op" id="7444412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7444415">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7444419">//&nbsp;make&nbsp;sure&nbsp;formatted&nbsp;output&nbsp;is&nbsp;syntactically&nbsp;correct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444475">res</span>&nbsp;<span class="op" id="7444479">:=</span>&nbsp;<span class="ident" id="7444482">buf</span><span class="op" id="7444485">.</span><span class="ident" id="7444486">Bytes</span><span class="op" id="7444491">(</span><span class="op" id="7444492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7444495">if</span>&nbsp;<span class="ident" id="7444498">_</span><span class="op" id="7444499">,</span>&nbsp;<span class="ident" id="7444501">err</span>&nbsp;<span class="op" id="7444505">:=</span>&nbsp;<span class="ident" id="7444508">parser</span><span class="op" id="7444514">.</span><span class="ident" id="7444515">ParseFile</span><span class="op" id="7444524">(</span><span class="ident" id="7444525">fset</span><span class="op" id="7444529">,</span>&nbsp;<span class="string" id="7444531">&#34;&#34;</span><span class="op" id="7444533">,</span>&nbsp;<span class="ident" id="7444535">res</span><span class="op" id="7444538">,</span>&nbsp;<span class="num" id="7444540">0</span><span class="op" id="7444541">)</span><span class="op" id="7444542">;</span>&nbsp;<span class="ident" id="7444544">err</span>&nbsp;<span class="op" id="7444548">!=</span>&nbsp;<span class="ident" id="7444551">nil</span>&nbsp;<span class="op" id="7444555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7444559">return</span>&nbsp;<span class="ident" id="7444566">nil</span><span class="op" id="7444569">,</span>&nbsp;<span class="ident" id="7444571">fmt</span><span class="op" id="7444574">.</span><span class="ident" id="7444575">Errorf</span><span class="op" id="7444581">(</span><span class="string" id="7444582">&#34;re-parse:&nbsp;%s\n%s&#34;</span><span class="op" id="7444600">,</span>&nbsp;<span class="ident" id="7444602">err</span><span class="op" id="7444605">,</span>&nbsp;<span class="ident" id="7444607">buf</span><span class="op" id="7444610">.</span><span class="ident" id="7444611">Bytes</span><span class="op" id="7444616">(</span><span class="op" id="7444617">)</span><span class="op" id="7444618">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7444621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7444625">return</span>&nbsp;<span class="ident" id="7444632">res</span><span class="op" id="7444635">,</span>&nbsp;<span class="ident" id="7444637">nil</span><br>
<span class="lineno"></span><span class="op" id="7444641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="7444644">//&nbsp;lineAt&nbsp;returns&nbsp;the&nbsp;line&nbsp;in&nbsp;text&nbsp;starting&nbsp;at&nbsp;offset&nbsp;offs.</span><br>
<span class="lineno"></span><span class="keyword" id="7444704">func</span>&nbsp;<span class="ident" id="7444709">lineAt</span><span class="op" id="7444715">(</span><span class="ident" id="7444716">text</span>&nbsp;<span class="op" id="7444721">[</span><span class="op" id="7444722">]</span><span class="builtintype" id="7444723">byte</span><span class="op" id="7444727">,</span>&nbsp;<span class="ident" id="7444729">offs</span>&nbsp;<span class="builtintype" id="7444734">int</span><span class="op" id="7444737">)</span>&nbsp;<span class="op" id="7444739">[</span><span class="op" id="7444740">]</span><span class="builtintype" id="7444741">byte</span>&nbsp;<span class="op" id="7444746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444749">i</span>&nbsp;<span class="op" id="7444751">:=</span>&nbsp;<span class="ident" id="7444754">offs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7444760">for</span>&nbsp;<span class="ident" id="7444764">i</span>&nbsp;<span class="op" id="7444766">&lt;</span>&nbsp;<span class="builtinfunc" id="7444768">len</span><span class="op" id="7444771">(</span><span class="ident" id="7444772">text</span><span class="op" id="7444776">)</span>&nbsp;<span class="op" id="7444778">&amp;&amp;</span>&nbsp;<span class="ident" id="7444781">text</span><span class="op" id="7444785">[</span><span class="ident" id="7444786">i</span><span class="op" id="7444787">]</span>&nbsp;<span class="op" id="7444789">!=</span>&nbsp;<span class="string" id="7444792">&#39;\n&#39;</span>&nbsp;<span class="op" id="7444797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7444801">i</span><span class="op" id="7444802">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7444806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7444809">return</span>&nbsp;<span class="ident" id="7444816">text</span><span class="op" id="7444820">[</span><span class="ident" id="7444821">offs</span><span class="op" id="7444825">:</span><span class="ident" id="7444826">i</span><span class="op" id="7444827">]</span><br>
<span class="lineno"></span><span class="op" id="7444829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7444832">//&nbsp;diff&nbsp;compares&nbsp;a&nbsp;and&nbsp;b.</span><br>
<span class="lineno">85</span><span class="keyword" id="7444858">func</span>&nbsp;<span class="ident" id="7444863">diff</span><span class="op" id="7444867">(</span><span class="ident" id="7444868">aname</span><span class="op" id="7444873">,</span>&nbsp;<span class="ident" id="7444875">bname</span>&nbsp;<span class="builtintype" id="7444881">string</span><span class="op" id="7444887">,</span>&nbsp;<span class="ident" id="7444889">a</span><span class="op" id="7444890">,</span>&nbsp;<span class="ident" id="7444892">b</span>&nbsp;<span class="op" id="7444894">[</span><span class="op" id="7444895">]</span><span class="builtintype" id="7444896">byte</span><span class="op" id="7444900">)</span>&nbsp;<span class="builtintype" id="7444902">error</span>&nbsp;<span class="op" id="7444908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7444911">var</span>&nbsp;<span class="ident" id="7444915">buf</span>&nbsp;<span class="ident" id="7444919">bytes</span><span class="op" id="7444924">.</span><span class="ident" id="7444925">Buffer</span>&nbsp;<span class="comment" id="7444932">//&nbsp;holding&nbsp;long&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7444964">//&nbsp;compare&nbsp;lengths</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7444984">if</span>&nbsp;<span class="builtinfunc" id="7444987">len</span><span class="op" id="7444990">(</span><span class="ident" id="7444991">a</span><span class="op" id="7444992">)</span>&nbsp;<span class="op" id="7444994">!=</span>&nbsp;<span class="builtinfunc" id="7444997">len</span><span class="op" id="7445000">(</span><span class="ident" id="7445001">b</span><span class="op" id="7445002">)</span>&nbsp;<span class="op" id="7445004">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445008">fmt</span><span class="op" id="7445011">.</span><span class="ident" id="7445012">Fprintf</span><span class="op" id="7445019">(</span><span class="op" id="7445020">&amp;</span><span class="ident" id="7445021">buf</span><span class="op" id="7445024">,</span>&nbsp;<span class="string" id="7445026">&#34;\nlength&nbsp;changed:&nbsp;len(%s)&nbsp;=&nbsp;%d,&nbsp;len(%s)&nbsp;=&nbsp;%d&#34;</span><span class="op" id="7445072">,</span>&nbsp;<span class="ident" id="7445074">aname</span><span class="op" id="7445079">,</span>&nbsp;<span class="builtinfunc" id="7445081">len</span><span class="op" id="7445084">(</span><span class="ident" id="7445085">a</span><span class="op" id="7445086">)</span><span class="op" id="7445087">,</span>&nbsp;<span class="ident" id="7445089">bname</span><span class="op" id="7445094">,</span>&nbsp;<span class="builtinfunc" id="7445096">len</span><span class="op" id="7445099">(</span><span class="ident" id="7445100">b</span><span class="op" id="7445101">)</span><span class="op" id="7445102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7445105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7445109">//&nbsp;compare&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445130">line</span>&nbsp;<span class="op" id="7445135">:=</span>&nbsp;<span class="num" id="7445138">1</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445141">offs</span>&nbsp;<span class="op" id="7445146">:=</span>&nbsp;<span class="num" id="7445149">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7445152">for</span>&nbsp;<span class="ident" id="7445156">i</span>&nbsp;<span class="op" id="7445158">:=</span>&nbsp;<span class="num" id="7445161">0</span><span class="op" id="7445162">;</span>&nbsp;<span class="ident" id="7445164">i</span>&nbsp;<span class="op" id="7445166">&lt;</span>&nbsp;<span class="builtinfunc" id="7445168">len</span><span class="op" id="7445171">(</span><span class="ident" id="7445172">a</span><span class="op" id="7445173">)</span>&nbsp;<span class="op" id="7445175">&amp;&amp;</span>&nbsp;<span class="ident" id="7445178">i</span>&nbsp;<span class="op" id="7445180">&lt;</span>&nbsp;<span class="builtinfunc" id="7445182">len</span><span class="op" id="7445185">(</span><span class="ident" id="7445186">b</span><span class="op" id="7445187">)</span><span class="op" id="7445188">;</span>&nbsp;<span class="ident" id="7445190">i</span><span class="op" id="7445191">++</span>&nbsp;<span class="op" id="7445194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445198">ch</span>&nbsp;<span class="op" id="7445201">:=</span>&nbsp;<span class="ident" id="7445204">a</span><span class="op" id="7445205">[</span><span class="ident" id="7445206">i</span><span class="op" id="7445207">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7445211">if</span>&nbsp;<span class="ident" id="7445214">ch</span>&nbsp;<span class="op" id="7445217">!=</span>&nbsp;<span class="ident" id="7445220">b</span><span class="op" id="7445221">[</span><span class="ident" id="7445222">i</span><span class="op" id="7445223">]</span>&nbsp;<span class="op" id="7445225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445230">fmt</span><span class="op" id="7445233">.</span><span class="ident" id="7445234">Fprintf</span><span class="op" id="7445241">(</span><span class="op" id="7445242">&amp;</span><span class="ident" id="7445243">buf</span><span class="op" id="7445246">,</span>&nbsp;<span class="string" id="7445248">&#34;\n%s:%d:%d:&nbsp;%s&#34;</span><span class="op" id="7445264">,</span>&nbsp;<span class="ident" id="7445266">aname</span><span class="op" id="7445271">,</span>&nbsp;<span class="ident" id="7445273">line</span><span class="op" id="7445277">,</span>&nbsp;<span class="ident" id="7445279">i</span><span class="op" id="7445280">-</span><span class="ident" id="7445281">offs</span><span class="op" id="7445285">+</span><span class="num" id="7445286">1</span><span class="op" id="7445287">,</span>&nbsp;<span class="ident" id="7445289">lineAt</span><span class="op" id="7445295">(</span><span class="ident" id="7445296">a</span><span class="op" id="7445297">,</span>&nbsp;<span class="ident" id="7445299">offs</span><span class="op" id="7445303">)</span><span class="op" id="7445304">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445309">fmt</span><span class="op" id="7445312">.</span><span class="ident" id="7445313">Fprintf</span><span class="op" id="7445320">(</span><span class="op" id="7445321">&amp;</span><span class="ident" id="7445322">buf</span><span class="op" id="7445325">,</span>&nbsp;<span class="string" id="7445327">&#34;\n%s:%d:%d:&nbsp;%s&#34;</span><span class="op" id="7445343">,</span>&nbsp;<span class="ident" id="7445345">bname</span><span class="op" id="7445350">,</span>&nbsp;<span class="ident" id="7445352">line</span><span class="op" id="7445356">,</span>&nbsp;<span class="ident" id="7445358">i</span><span class="op" id="7445359">-</span><span class="ident" id="7445360">offs</span><span class="op" id="7445364">+</span><span class="num" id="7445365">1</span><span class="op" id="7445366">,</span>&nbsp;<span class="ident" id="7445368">lineAt</span><span class="op" id="7445374">(</span><span class="ident" id="7445375">b</span><span class="op" id="7445376">,</span>&nbsp;<span class="ident" id="7445378">offs</span><span class="op" id="7445382">)</span><span class="op" id="7445383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445388">fmt</span><span class="op" id="7445391">.</span><span class="ident" id="7445392">Fprintf</span><span class="op" id="7445399">(</span><span class="op" id="7445400">&amp;</span><span class="ident" id="7445401">buf</span><span class="op" id="7445404">,</span>&nbsp;<span class="string" id="7445406">&#34;\n\n&#34;</span><span class="op" id="7445412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7445417">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7445425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7445429">if</span>&nbsp;<span class="ident" id="7445432">ch</span>&nbsp;<span class="op" id="7445435">==</span>&nbsp;<span class="string" id="7445438">&#39;\n&#39;</span>&nbsp;<span class="op" id="7445443">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445448">line</span><span class="op" id="7445452">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445458">offs</span>&nbsp;<span class="op" id="7445463">=</span>&nbsp;<span class="ident" id="7445465">i</span>&nbsp;<span class="op" id="7445467">+</span>&nbsp;<span class="num" id="7445469">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7445473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7445476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7445480">if</span>&nbsp;<span class="ident" id="7445483">buf</span><span class="op" id="7445486">.</span><span class="ident" id="7445487">Len</span><span class="op" id="7445490">(</span><span class="op" id="7445491">)</span>&nbsp;<span class="op" id="7445493">&gt;</span>&nbsp;<span class="num" id="7445495">0</span>&nbsp;<span class="op" id="7445497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7445501">return</span>&nbsp;<span class="ident" id="7445508">errors</span><span class="op" id="7445514">.</span><span class="ident" id="7445515">New</span><span class="op" id="7445518">(</span><span class="ident" id="7445519">buf</span><span class="op" id="7445522">.</span><span class="ident" id="7445523">String</span><span class="op" id="7445529">(</span><span class="op" id="7445530">)</span><span class="op" id="7445531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7445534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7445537">return</span>&nbsp;<span class="ident" id="7445544">nil</span><br>
<span class="lineno"></span><span class="op" id="7445548">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="7445551">func</span>&nbsp;<span class="ident" id="7445556">runcheck</span><span class="op" id="7445564">(</span><span class="ident" id="7445565">t</span>&nbsp;<span class="op" id="7445567">*</span><span class="ident" id="7445568">testing</span><span class="op" id="7445575">.</span><span class="ident" id="7445576">T</span><span class="op" id="7445577">,</span>&nbsp;<span class="ident" id="7445579">source</span><span class="op" id="7445585">,</span>&nbsp;<span class="ident" id="7445587">golden</span>&nbsp;<span class="builtintype" id="7445594">string</span><span class="op" id="7445600">,</span>&nbsp;<span class="ident" id="7445602">mode</span>&nbsp;<span class="ident" id="7445607">checkMode</span><span class="op" id="7445616">)</span>&nbsp;<span class="op" id="7445618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445621">src</span><span class="op" id="7445624">,</span>&nbsp;<span class="ident" id="7445626">err</span>&nbsp;<span class="op" id="7445630">:=</span>&nbsp;<span class="ident" id="7445633">ioutil</span><span class="op" id="7445639">.</span><span class="ident" id="7445640">ReadFile</span><span class="op" id="7445648">(</span><span class="ident" id="7445649">source</span><span class="op" id="7445655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7445658">if</span>&nbsp;<span class="ident" id="7445661">err</span>&nbsp;<span class="op" id="7445665">!=</span>&nbsp;<span class="ident" id="7445668">nil</span>&nbsp;<span class="op" id="7445672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445676">t</span><span class="op" id="7445677">.</span><span class="ident" id="7445678">Error</span><span class="op" id="7445683">(</span><span class="ident" id="7445684">err</span><span class="op" id="7445687">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7445691">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7445699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445703">res</span><span class="op" id="7445706">,</span>&nbsp;<span class="ident" id="7445708">err</span>&nbsp;<span class="op" id="7445712">:=</span>&nbsp;<span class="ident" id="7445715">format</span><span class="op" id="7445721">(</span><span class="ident" id="7445722">src</span><span class="op" id="7445725">,</span>&nbsp;<span class="ident" id="7445727">mode</span><span class="op" id="7445731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7445734">if</span>&nbsp;<span class="ident" id="7445737">err</span>&nbsp;<span class="op" id="7445741">!=</span>&nbsp;<span class="ident" id="7445744">nil</span>&nbsp;<span class="op" id="7445748">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445752">t</span><span class="op" id="7445753">.</span><span class="ident" id="7445754">Error</span><span class="op" id="7445759">(</span><span class="ident" id="7445760">err</span><span class="op" id="7445763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7445767">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7445775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7445779">//&nbsp;update&nbsp;golden&nbsp;files&nbsp;if&nbsp;necessary</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7445816">if</span>&nbsp;<span class="op" id="7445819">*</span><span class="ident" id="7445820">update</span>&nbsp;<span class="op" id="7445827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7445831">if</span>&nbsp;<span class="ident" id="7445834">err</span>&nbsp;<span class="op" id="7445838">:=</span>&nbsp;<span class="ident" id="7445841">ioutil</span><span class="op" id="7445847">.</span><span class="ident" id="7445848">WriteFile</span><span class="op" id="7445857">(</span><span class="ident" id="7445858">golden</span><span class="op" id="7445864">,</span>&nbsp;<span class="ident" id="7445866">res</span><span class="op" id="7445869">,</span>&nbsp;<span class="num" id="7445871">0644</span><span class="op" id="7445875">)</span><span class="op" id="7445876">;</span>&nbsp;<span class="ident" id="7445878">err</span>&nbsp;<span class="op" id="7445882">!=</span>&nbsp;<span class="ident" id="7445885">nil</span>&nbsp;<span class="op" id="7445889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445894">t</span><span class="op" id="7445895">.</span><span class="ident" id="7445896">Error</span><span class="op" id="7445901">(</span><span class="ident" id="7445902">err</span><span class="op" id="7445905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7445909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7445913">return</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7445921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7445925">//&nbsp;get&nbsp;golden</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445940">gld</span><span class="op" id="7445943">,</span>&nbsp;<span class="ident" id="7445945">err</span>&nbsp;<span class="op" id="7445949">:=</span>&nbsp;<span class="ident" id="7445952">ioutil</span><span class="op" id="7445958">.</span><span class="ident" id="7445959">ReadFile</span><span class="op" id="7445967">(</span><span class="ident" id="7445968">golden</span><span class="op" id="7445974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7445977">if</span>&nbsp;<span class="ident" id="7445980">err</span>&nbsp;<span class="op" id="7445984">!=</span>&nbsp;<span class="ident" id="7445987">nil</span>&nbsp;<span class="op" id="7445991">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7445995">t</span><span class="op" id="7445996">.</span><span class="ident" id="7445997">Error</span><span class="op" id="7446002">(</span><span class="ident" id="7446003">err</span><span class="op" id="7446006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7446010">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7446018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7446022">//&nbsp;formatted&nbsp;source&nbsp;and&nbsp;golden&nbsp;must&nbsp;be&nbsp;the&nbsp;same</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7446071">if</span>&nbsp;<span class="ident" id="7446074">err</span>&nbsp;<span class="op" id="7446078">:=</span>&nbsp;<span class="ident" id="7446081">diff</span><span class="op" id="7446085">(</span><span class="ident" id="7446086">source</span><span class="op" id="7446092">,</span>&nbsp;<span class="ident" id="7446094">golden</span><span class="op" id="7446100">,</span>&nbsp;<span class="ident" id="7446102">res</span><span class="op" id="7446105">,</span>&nbsp;<span class="ident" id="7446107">gld</span><span class="op" id="7446110">)</span><span class="op" id="7446111">;</span>&nbsp;<span class="ident" id="7446113">err</span>&nbsp;<span class="op" id="7446117">!=</span>&nbsp;<span class="ident" id="7446120">nil</span>&nbsp;<span class="op" id="7446124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446128">t</span><span class="op" id="7446129">.</span><span class="ident" id="7446130">Error</span><span class="op" id="7446135">(</span><span class="ident" id="7446136">err</span><span class="op" id="7446139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7446143">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7446151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7446155">if</span>&nbsp;<span class="ident" id="7446158">mode</span><span class="op" id="7446162">&amp;</span><span class="ident" id="7446163">idempotent</span>&nbsp;<span class="op" id="7446174">!=</span>&nbsp;<span class="num" id="7446177">0</span>&nbsp;<span class="op" id="7446179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7446183">//&nbsp;formatting&nbsp;golden&nbsp;must&nbsp;be&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7446225">//&nbsp;(This&nbsp;is&nbsp;very&nbsp;difficult&nbsp;to&nbsp;achieve&nbsp;in&nbsp;general&nbsp;and&nbsp;for&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7446288">//&nbsp;it&nbsp;is&nbsp;only&nbsp;checked&nbsp;for&nbsp;files&nbsp;explicitly&nbsp;marked&nbsp;as&nbsp;such.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446350">res</span><span class="op" id="7446353">,</span>&nbsp;<span class="ident" id="7446355">err</span>&nbsp;<span class="op" id="7446359">=</span>&nbsp;<span class="ident" id="7446361">format</span><span class="op" id="7446367">(</span><span class="ident" id="7446368">gld</span><span class="op" id="7446371">,</span>&nbsp;<span class="ident" id="7446373">mode</span><span class="op" id="7446377">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7446381">if</span>&nbsp;<span class="ident" id="7446384">err</span>&nbsp;<span class="op" id="7446388">:=</span>&nbsp;<span class="ident" id="7446391">diff</span><span class="op" id="7446395">(</span><span class="ident" id="7446396">golden</span><span class="op" id="7446402">,</span>&nbsp;<span class="ident" id="7446404">fmt</span><span class="op" id="7446407">.</span><span class="ident" id="7446408">Sprintf</span><span class="op" id="7446415">(</span><span class="string" id="7446416">&#34;format(%s)&#34;</span><span class="op" id="7446428">,</span>&nbsp;<span class="ident" id="7446430">golden</span><span class="op" id="7446436">)</span><span class="op" id="7446437">,</span>&nbsp;<span class="ident" id="7446439">gld</span><span class="op" id="7446442">,</span>&nbsp;<span class="ident" id="7446444">res</span><span class="op" id="7446447">)</span><span class="op" id="7446448">;</span>&nbsp;<span class="ident" id="7446450">err</span>&nbsp;<span class="op" id="7446454">!=</span>&nbsp;<span class="ident" id="7446457">nil</span>&nbsp;<span class="op" id="7446461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446466">t</span><span class="op" id="7446467">.</span><span class="ident" id="7446468">Errorf</span><span class="op" id="7446474">(</span><span class="string" id="7446475">&#34;golden&nbsp;is&nbsp;not&nbsp;idempotent:&nbsp;%s&#34;</span><span class="op" id="7446505">,</span>&nbsp;<span class="ident" id="7446507">err</span><span class="op" id="7446510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7446514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7446517">}</span><br>
<span class="lineno"></span><span class="op" id="7446519">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="7446522">func</span>&nbsp;<span class="ident" id="7446527">check</span><span class="op" id="7446532">(</span><span class="ident" id="7446533">t</span>&nbsp;<span class="op" id="7446535">*</span><span class="ident" id="7446536">testing</span><span class="op" id="7446543">.</span><span class="ident" id="7446544">T</span><span class="op" id="7446545">,</span>&nbsp;<span class="ident" id="7446547">source</span><span class="op" id="7446553">,</span>&nbsp;<span class="ident" id="7446555">golden</span>&nbsp;<span class="builtintype" id="7446562">string</span><span class="op" id="7446568">,</span>&nbsp;<span class="ident" id="7446570">mode</span>&nbsp;<span class="ident" id="7446575">checkMode</span><span class="op" id="7446584">)</span>&nbsp;<span class="op" id="7446586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7446589">//&nbsp;run&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446606">cc</span>&nbsp;<span class="op" id="7446609">:=</span>&nbsp;<span class="builtinfunc" id="7446612">make</span><span class="op" id="7446616">(</span><span class="keyword" id="7446617">chan</span>&nbsp;<span class="builtintype" id="7446622">int</span><span class="op" id="7446625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7446628">go</span>&nbsp;<span class="keyword" id="7446631">func</span><span class="op" id="7446635">(</span><span class="op" id="7446636">)</span>&nbsp;<span class="op" id="7446638">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446642">runcheck</span><span class="op" id="7446650">(</span><span class="ident" id="7446651">t</span><span class="op" id="7446652">,</span>&nbsp;<span class="ident" id="7446654">source</span><span class="op" id="7446660">,</span>&nbsp;<span class="ident" id="7446662">golden</span><span class="op" id="7446668">,</span>&nbsp;<span class="ident" id="7446670">mode</span><span class="op" id="7446674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446678">cc</span>&nbsp;<span class="op" id="7446681">&lt;-</span>&nbsp;<span class="num" id="7446684">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7446687">}</span><span class="op" id="7446688">(</span><span class="op" id="7446689">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7446693">//&nbsp;wait&nbsp;with&nbsp;timeout</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7446715">select</span>&nbsp;<span class="op" id="7446722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7446725">case</span>&nbsp;<span class="op" id="7446730">&lt;-</span><span class="ident" id="7446732">time</span><span class="op" id="7446736">.</span><span class="ident" id="7446737">After</span><span class="op" id="7446742">(</span><span class="num" id="7446743">10</span>&nbsp;<span class="op" id="7446746">*</span>&nbsp;<span class="ident" id="7446748">time</span><span class="op" id="7446752">.</span><span class="ident" id="7446753">Second</span><span class="op" id="7446759">)</span><span class="op" id="7446760">:</span>&nbsp;<span class="comment" id="7446762">//&nbsp;plenty&nbsp;of&nbsp;a&nbsp;safety&nbsp;margin,&nbsp;even&nbsp;for&nbsp;very&nbsp;slow&nbsp;machines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7446822">//&nbsp;test&nbsp;running&nbsp;past&nbsp;time&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446854">t</span><span class="op" id="7446855">.</span><span class="ident" id="7446856">Errorf</span><span class="op" id="7446862">(</span><span class="string" id="7446863">&#34;%s:&nbsp;running&nbsp;too&nbsp;slowly&#34;</span><span class="op" id="7446887">,</span>&nbsp;<span class="ident" id="7446889">source</span><span class="op" id="7446895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7446898">case</span>&nbsp;<span class="op" id="7446903">&lt;-</span><span class="ident" id="7446905">cc</span><span class="op" id="7446907">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7446911">//&nbsp;test&nbsp;finished&nbsp;within&nbsp;allotted&nbsp;time&nbsp;margin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7446957">}</span><br>
<span class="lineno"></span><span class="op" id="7446959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7446962">type</span>&nbsp;<span class="ident" id="7446967">entry</span>&nbsp;<span class="keyword" id="7446973">struct</span>&nbsp;<span class="op" id="7446980">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7446983">source</span><span class="op" id="7446989">,</span>&nbsp;<span class="ident" id="7446991">golden</span>&nbsp;<span class="builtintype" id="7446998">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7447006">mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7447021">checkMode</span><br>
<span class="lineno"></span><span class="op" id="7447031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7447034">//&nbsp;Use&nbsp;go&nbsp;test&nbsp;-update&nbsp;to&nbsp;create/update&nbsp;the&nbsp;respective&nbsp;golden&nbsp;files.</span><br>
<span class="lineno">185</span><span class="keyword" id="7447103">var</span>&nbsp;<span class="ident" id="7447107">data</span>&nbsp;<span class="op" id="7447112">=</span>&nbsp;<span class="op" id="7447114">[</span><span class="op" id="7447115">]</span><span class="ident" id="7447116">entry</span><span class="op" id="7447121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7447124">{</span><span class="string" id="7447125">&#34;empty.input&#34;</span><span class="op" id="7447138">,</span>&nbsp;<span class="string" id="7447140">&#34;empty.golden&#34;</span><span class="op" id="7447154">,</span>&nbsp;<span class="ident" id="7447156">idempotent</span><span class="op" id="7447166">}</span><span class="op" id="7447167">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7447170">{</span><span class="string" id="7447171">&#34;comments.input&#34;</span><span class="op" id="7447187">,</span>&nbsp;<span class="string" id="7447189">&#34;comments.golden&#34;</span><span class="op" id="7447206">,</span>&nbsp;<span class="num" id="7447208">0</span><span class="op" id="7447209">}</span><span class="op" id="7447210">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7447213">{</span><span class="string" id="7447214">&#34;comments.input&#34;</span><span class="op" id="7447230">,</span>&nbsp;<span class="string" id="7447232">&#34;comments.x&#34;</span><span class="op" id="7447244">,</span>&nbsp;<span class="ident" id="7447246">export</span><span class="op" id="7447252">}</span><span class="op" id="7447253">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7447256">{</span><span class="string" id="7447257">&#34;comments2.input&#34;</span><span class="op" id="7447274">,</span>&nbsp;<span class="string" id="7447276">&#34;comments2.golden&#34;</span><span class="op" id="7447294">,</span>&nbsp;<span class="ident" id="7447296">idempotent</span><span class="op" id="7447306">}</span><span class="op" id="7447307">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7447310">{</span><span class="string" id="7447311">&#34;linebreaks.input&#34;</span><span class="op" id="7447329">,</span>&nbsp;<span class="string" id="7447331">&#34;linebreaks.golden&#34;</span><span class="op" id="7447350">,</span>&nbsp;<span class="ident" id="7447352">idempotent</span><span class="op" id="7447362">}</span><span class="op" id="7447363">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7447366">{</span><span class="string" id="7447367">&#34;expressions.input&#34;</span><span class="op" id="7447386">,</span>&nbsp;<span class="string" id="7447388">&#34;expressions.golden&#34;</span><span class="op" id="7447408">,</span>&nbsp;<span class="ident" id="7447410">idempotent</span><span class="op" id="7447420">}</span><span class="op" id="7447421">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7447424">{</span><span class="string" id="7447425">&#34;expressions.input&#34;</span><span class="op" id="7447444">,</span>&nbsp;<span class="string" id="7447446">&#34;expressions.raw&#34;</span><span class="op" id="7447463">,</span>&nbsp;<span class="ident" id="7447465">rawFormat</span>&nbsp;<span class="op" id="7447475">|</span>&nbsp;<span class="ident" id="7447477">idempotent</span><span class="op" id="7447487">}</span><span class="op" id="7447488">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7447491">{</span><span class="string" id="7447492">&#34;declarations.input&#34;</span><span class="op" id="7447512">,</span>&nbsp;<span class="string" id="7447514">&#34;declarations.golden&#34;</span><span class="op" id="7447535">,</span>&nbsp;<span class="num" id="7447537">0</span><span class="op" id="7447538">}</span><span class="op" id="7447539">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7447542">{</span><span class="string" id="7447543">&#34;statements.input&#34;</span><span class="op" id="7447561">,</span>&nbsp;<span class="string" id="7447563">&#34;statements.golden&#34;</span><span class="op" id="7447582">,</span>&nbsp;<span class="num" id="7447584">0</span><span class="op" id="7447585">}</span><span class="op" id="7447586">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7447589">{</span><span class="string" id="7447590">&#34;slow.input&#34;</span><span class="op" id="7447602">,</span>&nbsp;<span class="string" id="7447604">&#34;slow.golden&#34;</span><span class="op" id="7447617">,</span>&nbsp;<span class="ident" id="7447619">idempotent</span><span class="op" id="7447629">}</span><span class="op" id="7447630">,</span><br>
<span class="lineno"></span><span class="op" id="7447632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7447635">func</span>&nbsp;<span class="ident" id="7447640">TestFiles</span><span class="op" id="7447649">(</span><span class="ident" id="7447650">t</span>&nbsp;<span class="op" id="7447652">*</span><span class="ident" id="7447653">testing</span><span class="op" id="7447660">.</span><span class="ident" id="7447661">T</span><span class="op" id="7447662">)</span>&nbsp;<span class="op" id="7447664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7447667">for</span>&nbsp;<span class="ident" id="7447671">_</span><span class="op" id="7447672">,</span>&nbsp;<span class="ident" id="7447674">e</span>&nbsp;<span class="op" id="7447676">:=</span>&nbsp;<span class="keyword" id="7447679">range</span>&nbsp;<span class="ident" id="7447685">data</span>&nbsp;<span class="op" id="7447690">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7447694">source</span>&nbsp;<span class="op" id="7447701">:=</span>&nbsp;<span class="ident" id="7447704">filepath</span><span class="op" id="7447712">.</span><span class="ident" id="7447713">Join</span><span class="op" id="7447717">(</span><span class="ident" id="7447718">dataDir</span><span class="op" id="7447725">,</span>&nbsp;<span class="ident" id="7447727">e</span><span class="op" id="7447728">.</span><span class="ident" id="7447729">source</span><span class="op" id="7447735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7447739">golden</span>&nbsp;<span class="op" id="7447746">:=</span>&nbsp;<span class="ident" id="7447749">filepath</span><span class="op" id="7447757">.</span><span class="ident" id="7447758">Join</span><span class="op" id="7447762">(</span><span class="ident" id="7447763">dataDir</span><span class="op" id="7447770">,</span>&nbsp;<span class="ident" id="7447772">e</span><span class="op" id="7447773">.</span><span class="ident" id="7447774">golden</span><span class="op" id="7447780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7447784">check</span><span class="op" id="7447789">(</span><span class="ident" id="7447790">t</span><span class="op" id="7447791">,</span>&nbsp;<span class="ident" id="7447793">source</span><span class="op" id="7447799">,</span>&nbsp;<span class="ident" id="7447801">golden</span><span class="op" id="7447807">,</span>&nbsp;<span class="ident" id="7447809">e</span><span class="op" id="7447810">.</span><span class="ident" id="7447811">mode</span><span class="op" id="7447815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7447819">//&nbsp;TODO(gri)&nbsp;check&nbsp;that&nbsp;golden&nbsp;is&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7447866">//check(t,&nbsp;golden,&nbsp;golden,&nbsp;e.mode)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7447902">}</span><br>
<span class="lineno"></span><span class="op" id="7447904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7447907">//&nbsp;TestLineComments,&nbsp;using&nbsp;a&nbsp;simple&nbsp;test&nbsp;case,&nbsp;checks&nbsp;that&nbsp;consecutive&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="7447983">//&nbsp;comments&nbsp;are&nbsp;properly&nbsp;terminated&nbsp;with&nbsp;a&nbsp;newline&nbsp;even&nbsp;if&nbsp;the&nbsp;AST&nbsp;position</span><br>
<span class="lineno">210</span><span class="comment" id="7448059">//&nbsp;information&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span><span class="comment" id="7448088">//</span><br>
<span class="lineno"></span><span class="keyword" id="7448091">func</span>&nbsp;<span class="ident" id="7448096">TestLineComments</span><span class="op" id="7448112">(</span><span class="ident" id="7448113">t</span>&nbsp;<span class="op" id="7448115">*</span><span class="ident" id="7448116">testing</span><span class="op" id="7448123">.</span><span class="ident" id="7448124">T</span><span class="op" id="7448125">)</span>&nbsp;<span class="op" id="7448127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7448130">const</span>&nbsp;<span class="ident" id="7448136">src</span>&nbsp;<span class="op" id="7448140">=</span>&nbsp;<span class="string" id="7448142">`//&nbsp;comment&nbsp;1<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;comment&nbsp;2<br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;comment&nbsp;3<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsppackage&nbsp;main<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448203">fset</span>&nbsp;<span class="op" id="7448208">:=</span>&nbsp;<span class="ident" id="7448211">token</span><span class="op" id="7448216">.</span><span class="ident" id="7448217">NewFileSet</span><span class="op" id="7448227">(</span><span class="op" id="7448228">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448231">f</span><span class="op" id="7448232">,</span>&nbsp;<span class="ident" id="7448234">err</span>&nbsp;<span class="op" id="7448238">:=</span>&nbsp;<span class="ident" id="7448241">parser</span><span class="op" id="7448247">.</span><span class="ident" id="7448248">ParseFile</span><span class="op" id="7448257">(</span><span class="ident" id="7448258">fset</span><span class="op" id="7448262">,</span>&nbsp;<span class="string" id="7448264">&#34;&#34;</span><span class="op" id="7448266">,</span>&nbsp;<span class="ident" id="7448268">src</span><span class="op" id="7448271">,</span>&nbsp;<span class="ident" id="7448273">parser</span><span class="op" id="7448279">.</span><span class="ident" id="7448280">ParseComments</span><span class="op" id="7448293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7448296">if</span>&nbsp;<span class="ident" id="7448299">err</span>&nbsp;<span class="op" id="7448303">!=</span>&nbsp;<span class="ident" id="7448306">nil</span>&nbsp;<span class="op" id="7448310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7448314">panic</span><span class="op" id="7448319">(</span><span class="ident" id="7448320">err</span><span class="op" id="7448323">)</span>&nbsp;<span class="comment" id="7448325">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7448343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7448347">var</span>&nbsp;<span class="ident" id="7448351">buf</span>&nbsp;<span class="ident" id="7448355">bytes</span><span class="op" id="7448360">.</span><span class="ident" id="7448361">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448369">fset</span>&nbsp;<span class="op" id="7448374">=</span>&nbsp;<span class="ident" id="7448376">token</span><span class="op" id="7448381">.</span><span class="ident" id="7448382">NewFileSet</span><span class="op" id="7448392">(</span><span class="op" id="7448393">)</span>&nbsp;<span class="comment" id="7448395">//&nbsp;use&nbsp;the&nbsp;wrong&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448422">Fprint</span><span class="op" id="7448428">(</span><span class="op" id="7448429">&amp;</span><span class="ident" id="7448430">buf</span><span class="op" id="7448433">,</span>&nbsp;<span class="ident" id="7448435">fset</span><span class="op" id="7448439">,</span>&nbsp;<span class="ident" id="7448441">f</span><span class="op" id="7448442">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448446">nlines</span>&nbsp;<span class="op" id="7448453">:=</span>&nbsp;<span class="num" id="7448456">0</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7448459">for</span>&nbsp;<span class="ident" id="7448463">_</span><span class="op" id="7448464">,</span>&nbsp;<span class="ident" id="7448466">ch</span>&nbsp;<span class="op" id="7448469">:=</span>&nbsp;<span class="keyword" id="7448472">range</span>&nbsp;<span class="ident" id="7448478">buf</span><span class="op" id="7448481">.</span><span class="ident" id="7448482">Bytes</span><span class="op" id="7448487">(</span><span class="op" id="7448488">)</span>&nbsp;<span class="op" id="7448490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7448494">if</span>&nbsp;<span class="ident" id="7448497">ch</span>&nbsp;<span class="op" id="7448500">==</span>&nbsp;<span class="string" id="7448503">&#39;\n&#39;</span>&nbsp;<span class="op" id="7448508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448513">nlines</span><span class="op" id="7448519">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7448524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7448527">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7448531">const</span>&nbsp;<span class="ident" id="7448537">expected</span>&nbsp;<span class="op" id="7448546">=</span>&nbsp;<span class="num" id="7448548">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7448551">if</span>&nbsp;<span class="ident" id="7448554">nlines</span>&nbsp;<span class="op" id="7448561">&lt;</span>&nbsp;<span class="ident" id="7448563">expected</span>&nbsp;<span class="op" id="7448572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448576">t</span><span class="op" id="7448577">.</span><span class="ident" id="7448578">Errorf</span><span class="op" id="7448584">(</span><span class="string" id="7448585">&#34;got&nbsp;%d,&nbsp;expected&nbsp;%d\n&#34;</span><span class="op" id="7448608">,</span>&nbsp;<span class="ident" id="7448610">nlines</span><span class="op" id="7448616">,</span>&nbsp;<span class="ident" id="7448618">expected</span><span class="op" id="7448626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7448630">t</span><span class="op" id="7448631">.</span><span class="ident" id="7448632">Errorf</span><span class="op" id="7448638">(</span><span class="string" id="7448639">&#34;result:\n%s&#34;</span><span class="op" id="7448652">,</span>&nbsp;<span class="ident" id="7448654">buf</span><span class="op" id="7448657">.</span><span class="ident" id="7448658">Bytes</span><span class="op" id="7448663">(</span><span class="op" id="7448664">)</span><span class="op" id="7448665">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7448668">}</span><br>
<span class="lineno"></span><span class="op" id="7448670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7448673">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;can&nbsp;be&nbsp;invoked&nbsp;during&nbsp;initialization.</span><br>
<span class="lineno"></span><span class="keyword" id="7448738">func</span>&nbsp;<span class="ident" id="7448743">init</span><span class="op" id="7448747">(</span><span class="op" id="7448748">)</span>&nbsp;<span class="op" id="7448750">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7448753">const</span>&nbsp;<span class="ident" id="7448759">name</span>&nbsp;<span class="op" id="7448764">=</span>&nbsp;<span class="string" id="7448766">&#34;foobar&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7448776">var</span>&nbsp;<span class="ident" id="7448780">buf</span>&nbsp;<span class="ident" id="7448784">bytes</span><span class="op" id="7448789">.</span><span class="ident" id="7448790">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7448798">if</span>&nbsp;<span class="ident" id="7448801">err</span>&nbsp;<span class="op" id="7448805">:=</span>&nbsp;<span class="ident" id="7448808">Fprint</span><span class="op" id="7448814">(</span><span class="op" id="7448815">&amp;</span><span class="ident" id="7448816">buf</span><span class="op" id="7448819">,</span>&nbsp;<span class="ident" id="7448821">fset</span><span class="op" id="7448825">,</span>&nbsp;<span class="op" id="7448827">&amp;</span><span class="ident" id="7448828">ast</span><span class="op" id="7448831">.</span><span class="ident" id="7448832">Ident</span><span class="op" id="7448837">{</span><span class="ident" id="7448838">Name</span><span class="op" id="7448842">:</span>&nbsp;<span class="ident" id="7448844">name</span><span class="op" id="7448848">}</span><span class="op" id="7448849">)</span><span class="op" id="7448850">;</span>&nbsp;<span class="ident" id="7448852">err</span>&nbsp;<span class="op" id="7448856">!=</span>&nbsp;<span class="ident" id="7448859">nil</span>&nbsp;<span class="op" id="7448863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7448867">panic</span><span class="op" id="7448872">(</span><span class="ident" id="7448873">err</span><span class="op" id="7448876">)</span>&nbsp;<span class="comment" id="7448878">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7448896">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7448899">//&nbsp;in&nbsp;debug&nbsp;mode,&nbsp;the&nbsp;result&nbsp;contains&nbsp;additional&nbsp;information;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7448962">//&nbsp;ignore&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7448976">if</span>&nbsp;<span class="ident" id="7448979">s</span>&nbsp;<span class="op" id="7448981">:=</span>&nbsp;<span class="ident" id="7448984">buf</span><span class="op" id="7448987">.</span><span class="ident" id="7448988">String</span><span class="op" id="7448994">(</span><span class="op" id="7448995">)</span><span class="op" id="7448996">;</span>&nbsp;<span class="op" id="7448998">!</span><span class="ident" id="7448999">debug</span>&nbsp;<span class="op" id="7449005">&amp;&amp;</span>&nbsp;<span class="ident" id="7449008">s</span>&nbsp;<span class="op" id="7449010">!=</span>&nbsp;<span class="ident" id="7449013">name</span>&nbsp;<span class="op" id="7449018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7449022">panic</span><span class="op" id="7449027">(</span><span class="string" id="7449028">&#34;got&nbsp;&#34;</span>&nbsp;<span class="op" id="7449035">+</span>&nbsp;<span class="ident" id="7449037">s</span>&nbsp;<span class="op" id="7449039">+</span>&nbsp;<span class="string" id="7449041">&#34;,&nbsp;want&nbsp;&#34;</span>&nbsp;<span class="op" id="7449051">+</span>&nbsp;<span class="ident" id="7449053">name</span><span class="op" id="7449057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7449060">}</span><br>
<span class="lineno">255</span><span class="op" id="7449062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7449065">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;doesn&#39;t&nbsp;crash&nbsp;if&nbsp;the&nbsp;AST&nbsp;contains&nbsp;BadXXX&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="7449140">func</span>&nbsp;<span class="ident" id="7449145">TestBadNodes</span><span class="op" id="7449157">(</span><span class="ident" id="7449158">t</span>&nbsp;<span class="op" id="7449160">*</span><span class="ident" id="7449161">testing</span><span class="op" id="7449168">.</span><span class="ident" id="7449169">T</span><span class="op" id="7449170">)</span>&nbsp;<span class="op" id="7449172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7449175">const</span>&nbsp;<span class="ident" id="7449181">src</span>&nbsp;<span class="op" id="7449185">=</span>&nbsp;<span class="string" id="7449187">&#34;package&nbsp;p\n(&#34;</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7449203">const</span>&nbsp;<span class="ident" id="7449209">res</span>&nbsp;<span class="op" id="7449213">=</span>&nbsp;<span class="string" id="7449215">&#34;package&nbsp;p\nBadDecl\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449239">f</span><span class="op" id="7449240">,</span>&nbsp;<span class="ident" id="7449242">err</span>&nbsp;<span class="op" id="7449246">:=</span>&nbsp;<span class="ident" id="7449249">parser</span><span class="op" id="7449255">.</span><span class="ident" id="7449256">ParseFile</span><span class="op" id="7449265">(</span><span class="ident" id="7449266">fset</span><span class="op" id="7449270">,</span>&nbsp;<span class="string" id="7449272">&#34;&#34;</span><span class="op" id="7449274">,</span>&nbsp;<span class="ident" id="7449276">src</span><span class="op" id="7449279">,</span>&nbsp;<span class="ident" id="7449281">parser</span><span class="op" id="7449287">.</span><span class="ident" id="7449288">ParseComments</span><span class="op" id="7449301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7449304">if</span>&nbsp;<span class="ident" id="7449307">err</span>&nbsp;<span class="op" id="7449311">==</span>&nbsp;<span class="ident" id="7449314">nil</span>&nbsp;<span class="op" id="7449318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449322">t</span><span class="op" id="7449323">.</span><span class="ident" id="7449324">Error</span><span class="op" id="7449329">(</span><span class="string" id="7449330">&#34;expected&nbsp;illegal&nbsp;program&#34;</span><span class="op" id="7449356">)</span>&nbsp;<span class="comment" id="7449358">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7449376">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7449379">var</span>&nbsp;<span class="ident" id="7449383">buf</span>&nbsp;<span class="ident" id="7449387">bytes</span><span class="op" id="7449392">.</span><span class="ident" id="7449393">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449401">Fprint</span><span class="op" id="7449407">(</span><span class="op" id="7449408">&amp;</span><span class="ident" id="7449409">buf</span><span class="op" id="7449412">,</span>&nbsp;<span class="ident" id="7449414">fset</span><span class="op" id="7449418">,</span>&nbsp;<span class="ident" id="7449420">f</span><span class="op" id="7449421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7449424">if</span>&nbsp;<span class="ident" id="7449427">buf</span><span class="op" id="7449430">.</span><span class="ident" id="7449431">String</span><span class="op" id="7449437">(</span><span class="op" id="7449438">)</span>&nbsp;<span class="op" id="7449440">!=</span>&nbsp;<span class="ident" id="7449443">res</span>&nbsp;<span class="op" id="7449447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449451">t</span><span class="op" id="7449452">.</span><span class="ident" id="7449453">Errorf</span><span class="op" id="7449459">(</span><span class="string" id="7449460">&#34;got&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="7449481">,</span>&nbsp;<span class="ident" id="7449483">buf</span><span class="op" id="7449486">.</span><span class="ident" id="7449487">String</span><span class="op" id="7449493">(</span><span class="op" id="7449494">)</span><span class="op" id="7449495">,</span>&nbsp;<span class="ident" id="7449497">res</span><span class="op" id="7449500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7449503">}</span><br>
<span class="lineno">270</span><span class="op" id="7449505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7449508">//&nbsp;testComment&nbsp;verifies&nbsp;that&nbsp;f&nbsp;can&nbsp;be&nbsp;parsed&nbsp;again&nbsp;after&nbsp;printing&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="7449577">//&nbsp;with&nbsp;its&nbsp;first&nbsp;comment&nbsp;set&nbsp;to&nbsp;comment&nbsp;at&nbsp;any&nbsp;possible&nbsp;source&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="7449649">func</span>&nbsp;<span class="ident" id="7449654">testComment</span><span class="op" id="7449665">(</span><span class="ident" id="7449666">t</span>&nbsp;<span class="op" id="7449668">*</span><span class="ident" id="7449669">testing</span><span class="op" id="7449676">.</span><span class="ident" id="7449677">T</span><span class="op" id="7449678">,</span>&nbsp;<span class="ident" id="7449680">f</span>&nbsp;<span class="op" id="7449682">*</span><span class="ident" id="7449683">ast</span><span class="op" id="7449686">.</span><span class="ident" id="7449687">File</span><span class="op" id="7449691">,</span>&nbsp;<span class="ident" id="7449693">srclen</span>&nbsp;<span class="builtintype" id="7449700">int</span><span class="op" id="7449703">,</span>&nbsp;<span class="ident" id="7449705">comment</span>&nbsp;<span class="op" id="7449713">*</span><span class="ident" id="7449714">ast</span><span class="op" id="7449717">.</span><span class="ident" id="7449718">Comment</span><span class="op" id="7449725">)</span>&nbsp;<span class="op" id="7449727">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449730">f</span><span class="op" id="7449731">.</span><span class="ident" id="7449732">Comments</span><span class="op" id="7449740">[</span><span class="num" id="7449741">0</span><span class="op" id="7449742">]</span><span class="op" id="7449743">.</span><span class="ident" id="7449744">List</span><span class="op" id="7449748">[</span><span class="num" id="7449749">0</span><span class="op" id="7449750">]</span>&nbsp;<span class="op" id="7449752">=</span>&nbsp;<span class="ident" id="7449754">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7449763">var</span>&nbsp;<span class="ident" id="7449767">buf</span>&nbsp;<span class="ident" id="7449771">bytes</span><span class="op" id="7449776">.</span><span class="ident" id="7449777">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7449785">for</span>&nbsp;<span class="ident" id="7449789">offs</span>&nbsp;<span class="op" id="7449794">:=</span>&nbsp;<span class="num" id="7449797">0</span><span class="op" id="7449798">;</span>&nbsp;<span class="ident" id="7449800">offs</span>&nbsp;<span class="op" id="7449805">&lt;=</span>&nbsp;<span class="ident" id="7449808">srclen</span><span class="op" id="7449814">;</span>&nbsp;<span class="ident" id="7449816">offs</span><span class="op" id="7449820">++</span>&nbsp;<span class="op" id="7449823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449827">buf</span><span class="op" id="7449830">.</span><span class="ident" id="7449831">Reset</span><span class="op" id="7449836">(</span><span class="op" id="7449837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7449841">//&nbsp;Printing&nbsp;f&nbsp;should&nbsp;result&nbsp;in&nbsp;a&nbsp;correct&nbsp;program&nbsp;no</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7449895">//&nbsp;matter&nbsp;what&nbsp;the&nbsp;(incorrect)&nbsp;comment&nbsp;position&nbsp;is.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7449949">if</span>&nbsp;<span class="ident" id="7449952">err</span>&nbsp;<span class="op" id="7449956">:=</span>&nbsp;<span class="ident" id="7449959">Fprint</span><span class="op" id="7449965">(</span><span class="op" id="7449966">&amp;</span><span class="ident" id="7449967">buf</span><span class="op" id="7449970">,</span>&nbsp;<span class="ident" id="7449972">fset</span><span class="op" id="7449976">,</span>&nbsp;<span class="ident" id="7449978">f</span><span class="op" id="7449979">)</span><span class="op" id="7449980">;</span>&nbsp;<span class="ident" id="7449982">err</span>&nbsp;<span class="op" id="7449986">!=</span>&nbsp;<span class="ident" id="7449989">nil</span>&nbsp;<span class="op" id="7449993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7449998">t</span><span class="op" id="7449999">.</span><span class="ident" id="7450000">Error</span><span class="op" id="7450005">(</span><span class="ident" id="7450006">err</span><span class="op" id="7450009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7450013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7450017">if</span>&nbsp;<span class="ident" id="7450020">_</span><span class="op" id="7450021">,</span>&nbsp;<span class="ident" id="7450023">err</span>&nbsp;<span class="op" id="7450027">:=</span>&nbsp;<span class="ident" id="7450030">parser</span><span class="op" id="7450036">.</span><span class="ident" id="7450037">ParseFile</span><span class="op" id="7450046">(</span><span class="ident" id="7450047">fset</span><span class="op" id="7450051">,</span>&nbsp;<span class="string" id="7450053">&#34;&#34;</span><span class="op" id="7450055">,</span>&nbsp;<span class="ident" id="7450057">buf</span><span class="op" id="7450060">.</span><span class="ident" id="7450061">Bytes</span><span class="op" id="7450066">(</span><span class="op" id="7450067">)</span><span class="op" id="7450068">,</span>&nbsp;<span class="num" id="7450070">0</span><span class="op" id="7450071">)</span><span class="op" id="7450072">;</span>&nbsp;<span class="ident" id="7450074">err</span>&nbsp;<span class="op" id="7450078">!=</span>&nbsp;<span class="ident" id="7450081">nil</span>&nbsp;<span class="op" id="7450085">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450090">t</span><span class="op" id="7450091">.</span><span class="ident" id="7450092">Fatalf</span><span class="op" id="7450098">(</span><span class="string" id="7450099">&#34;incorrect&nbsp;program&nbsp;for&nbsp;pos&nbsp;=&nbsp;%d:\n%s&#34;</span><span class="op" id="7450136">,</span>&nbsp;<span class="ident" id="7450138">comment</span><span class="op" id="7450145">.</span><span class="ident" id="7450146">Slash</span><span class="op" id="7450151">,</span>&nbsp;<span class="ident" id="7450153">buf</span><span class="op" id="7450156">.</span><span class="ident" id="7450157">String</span><span class="op" id="7450163">(</span><span class="op" id="7450164">)</span><span class="op" id="7450165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7450169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7450173">//&nbsp;Position&nbsp;information&nbsp;is&nbsp;just&nbsp;an&nbsp;offset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7450218">//&nbsp;Move&nbsp;comment&nbsp;one&nbsp;byte&nbsp;down&nbsp;in&nbsp;the&nbsp;source.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450265">comment</span><span class="op" id="7450272">.</span><span class="ident" id="7450273">Slash</span><span class="op" id="7450278">++</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7450282">}</span><br>
<span class="lineno"></span><span class="op" id="7450284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7450287">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;produces&nbsp;a&nbsp;correct&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="7450341">//&nbsp;even&nbsp;if&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;comments&nbsp;introducing&nbsp;newlines</span><br>
<span class="lineno">295</span><span class="comment" id="7450410">//&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span><span class="keyword" id="7450427">func</span>&nbsp;<span class="ident" id="7450432">TestBadComments</span><span class="op" id="7450447">(</span><span class="ident" id="7450448">t</span>&nbsp;<span class="op" id="7450450">*</span><span class="ident" id="7450451">testing</span><span class="op" id="7450458">.</span><span class="ident" id="7450459">T</span><span class="op" id="7450460">)</span>&nbsp;<span class="op" id="7450462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7450465">const</span>&nbsp;<span class="ident" id="7450471">src</span>&nbsp;<span class="op" id="7450475">=</span>&nbsp;<span class="string" id="7450477">`<br>
<span class="lineno"></span>//&nbsp;first&nbsp;comment&nbsp;-&nbsp;text&nbsp;and&nbsp;position&nbsp;changed&nbsp;by&nbsp;test<br>
<span class="lineno"></span>package&nbsp;p<br>
<span class="lineno">300</span>import&nbsp;&#34;fmt&#34;<br>
<span class="lineno"></span>const&nbsp;pi&nbsp;=&nbsp;3.14&nbsp;//&nbsp;rough&nbsp;circle<br>
<span class="lineno"></span>var&nbsp;(<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspx,&nbsp;y,&nbsp;z&nbsp;int&nbsp;=&nbsp;1,&nbsp;2,&nbsp;3<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspu,&nbsp;v&nbsp;float64<br>
<span class="lineno">305</span>)<br>
<span class="lineno"></span>func&nbsp;fibo(n&nbsp;int)&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspif&nbsp;n&nbsp;&lt;&nbsp;2&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;n&nbsp;/*&nbsp;seed&nbsp;values&nbsp;*/<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;fibo(n-1)&nbsp;+&nbsp;fibo(n-2)<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450731">f</span><span class="op" id="7450732">,</span>&nbsp;<span class="ident" id="7450734">err</span>&nbsp;<span class="op" id="7450738">:=</span>&nbsp;<span class="ident" id="7450741">parser</span><span class="op" id="7450747">.</span><span class="ident" id="7450748">ParseFile</span><span class="op" id="7450757">(</span><span class="ident" id="7450758">fset</span><span class="op" id="7450762">,</span>&nbsp;<span class="string" id="7450764">&#34;&#34;</span><span class="op" id="7450766">,</span>&nbsp;<span class="ident" id="7450768">src</span><span class="op" id="7450771">,</span>&nbsp;<span class="ident" id="7450773">parser</span><span class="op" id="7450779">.</span><span class="ident" id="7450780">ParseComments</span><span class="op" id="7450793">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7450796">if</span>&nbsp;<span class="ident" id="7450799">err</span>&nbsp;<span class="op" id="7450803">!=</span>&nbsp;<span class="ident" id="7450806">nil</span>&nbsp;<span class="op" id="7450810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450814">t</span><span class="op" id="7450815">.</span><span class="ident" id="7450816">Error</span><span class="op" id="7450821">(</span><span class="ident" id="7450822">err</span><span class="op" id="7450825">)</span>&nbsp;<span class="comment" id="7450827">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7450845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450849">comment</span>&nbsp;<span class="op" id="7450857">:=</span>&nbsp;<span class="ident" id="7450860">f</span><span class="op" id="7450861">.</span><span class="ident" id="7450862">Comments</span><span class="op" id="7450870">[</span><span class="num" id="7450871">0</span><span class="op" id="7450872">]</span><span class="op" id="7450873">.</span><span class="ident" id="7450874">List</span><span class="op" id="7450878">[</span><span class="num" id="7450879">0</span><span class="op" id="7450880">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450883">pos</span>&nbsp;<span class="op" id="7450887">:=</span>&nbsp;<span class="ident" id="7450890">comment</span><span class="op" id="7450897">.</span><span class="ident" id="7450898">Pos</span><span class="op" id="7450901">(</span><span class="op" id="7450902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7450905">if</span>&nbsp;<span class="ident" id="7450908">fset</span><span class="op" id="7450912">.</span><span class="ident" id="7450913">Position</span><span class="op" id="7450921">(</span><span class="ident" id="7450922">pos</span><span class="op" id="7450925">)</span><span class="op" id="7450926">.</span><span class="ident" id="7450927">Offset</span>&nbsp;<span class="op" id="7450934">!=</span>&nbsp;<span class="num" id="7450937">1</span>&nbsp;<span class="op" id="7450939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450943">t</span><span class="op" id="7450944">.</span><span class="ident" id="7450945">Error</span><span class="op" id="7450950">(</span><span class="string" id="7450951">&#34;expected&nbsp;offset&nbsp;1&#34;</span><span class="op" id="7450970">)</span>&nbsp;<span class="comment" id="7450972">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7450990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7450994">testComment</span><span class="op" id="7451005">(</span><span class="ident" id="7451006">t</span><span class="op" id="7451007">,</span>&nbsp;<span class="ident" id="7451009">f</span><span class="op" id="7451010">,</span>&nbsp;<span class="builtinfunc" id="7451012">len</span><span class="op" id="7451015">(</span><span class="ident" id="7451016">src</span><span class="op" id="7451019">)</span><span class="op" id="7451020">,</span>&nbsp;<span class="op" id="7451022">&amp;</span><span class="ident" id="7451023">ast</span><span class="op" id="7451026">.</span><span class="ident" id="7451027">Comment</span><span class="op" id="7451034">{</span><span class="ident" id="7451035">Slash</span><span class="op" id="7451040">:</span>&nbsp;<span class="ident" id="7451042">pos</span><span class="op" id="7451045">,</span>&nbsp;<span class="ident" id="7451047">Text</span><span class="op" id="7451051">:</span>&nbsp;<span class="string" id="7451053">&#34;//-style&nbsp;comment&#34;</span><span class="op" id="7451071">}</span><span class="op" id="7451072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451075">testComment</span><span class="op" id="7451086">(</span><span class="ident" id="7451087">t</span><span class="op" id="7451088">,</span>&nbsp;<span class="ident" id="7451090">f</span><span class="op" id="7451091">,</span>&nbsp;<span class="builtinfunc" id="7451093">len</span><span class="op" id="7451096">(</span><span class="ident" id="7451097">src</span><span class="op" id="7451100">)</span><span class="op" id="7451101">,</span>&nbsp;<span class="op" id="7451103">&amp;</span><span class="ident" id="7451104">ast</span><span class="op" id="7451107">.</span><span class="ident" id="7451108">Comment</span><span class="op" id="7451115">{</span><span class="ident" id="7451116">Slash</span><span class="op" id="7451121">:</span>&nbsp;<span class="ident" id="7451123">pos</span><span class="op" id="7451126">,</span>&nbsp;<span class="ident" id="7451128">Text</span><span class="op" id="7451132">:</span>&nbsp;<span class="string" id="7451134">&#34;/*-style&nbsp;comment&nbsp;*/&#34;</span><span class="op" id="7451155">}</span><span class="op" id="7451156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451159">testComment</span><span class="op" id="7451170">(</span><span class="ident" id="7451171">t</span><span class="op" id="7451172">,</span>&nbsp;<span class="ident" id="7451174">f</span><span class="op" id="7451175">,</span>&nbsp;<span class="builtinfunc" id="7451177">len</span><span class="op" id="7451180">(</span><span class="ident" id="7451181">src</span><span class="op" id="7451184">)</span><span class="op" id="7451185">,</span>&nbsp;<span class="op" id="7451187">&amp;</span><span class="ident" id="7451188">ast</span><span class="op" id="7451191">.</span><span class="ident" id="7451192">Comment</span><span class="op" id="7451199">{</span><span class="ident" id="7451200">Slash</span><span class="op" id="7451205">:</span>&nbsp;<span class="ident" id="7451207">pos</span><span class="op" id="7451210">,</span>&nbsp;<span class="ident" id="7451212">Text</span><span class="op" id="7451216">:</span>&nbsp;<span class="string" id="7451218">&#34;/*-style&nbsp;\n&nbsp;comment&nbsp;*/&#34;</span><span class="op" id="7451242">}</span><span class="op" id="7451243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451246">testComment</span><span class="op" id="7451257">(</span><span class="ident" id="7451258">t</span><span class="op" id="7451259">,</span>&nbsp;<span class="ident" id="7451261">f</span><span class="op" id="7451262">,</span>&nbsp;<span class="builtinfunc" id="7451264">len</span><span class="op" id="7451267">(</span><span class="ident" id="7451268">src</span><span class="op" id="7451271">)</span><span class="op" id="7451272">,</span>&nbsp;<span class="op" id="7451274">&amp;</span><span class="ident" id="7451275">ast</span><span class="op" id="7451278">.</span><span class="ident" id="7451279">Comment</span><span class="op" id="7451286">{</span><span class="ident" id="7451287">Slash</span><span class="op" id="7451292">:</span>&nbsp;<span class="ident" id="7451294">pos</span><span class="op" id="7451297">,</span>&nbsp;<span class="ident" id="7451299">Text</span><span class="op" id="7451303">:</span>&nbsp;<span class="string" id="7451305">&#34;/*-style&nbsp;comment&nbsp;\n\n\n&nbsp;*/&#34;</span><span class="op" id="7451333">}</span><span class="op" id="7451334">)</span><br>
<span class="lineno"></span><span class="op" id="7451336">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="7451339">type</span>&nbsp;<span class="ident" id="7451344">visitor</span>&nbsp;<span class="keyword" id="7451352">chan</span>&nbsp;<span class="op" id="7451357">*</span><span class="ident" id="7451358">ast</span><span class="op" id="7451361">.</span><span class="ident" id="7451362">Ident</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7451369">func</span>&nbsp;<span class="op" id="7451374">(</span><span class="ident" id="7451375">v</span>&nbsp;<span class="ident" id="7451377">visitor</span><span class="op" id="7451384">)</span>&nbsp;<span class="ident" id="7451386">Visit</span><span class="op" id="7451391">(</span><span class="ident" id="7451392">n</span>&nbsp;<span class="ident" id="7451394">ast</span><span class="op" id="7451397">.</span><span class="ident" id="7451398">Node</span><span class="op" id="7451402">)</span>&nbsp;<span class="op" id="7451404">(</span><span class="ident" id="7451405">w</span>&nbsp;<span class="ident" id="7451407">ast</span><span class="op" id="7451410">.</span><span class="ident" id="7451411">Visitor</span><span class="op" id="7451418">)</span>&nbsp;<span class="op" id="7451420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7451423">if</span>&nbsp;<span class="ident" id="7451426">ident</span><span class="op" id="7451431">,</span>&nbsp;<span class="ident" id="7451433">ok</span>&nbsp;<span class="op" id="7451436">:=</span>&nbsp;<span class="ident" id="7451439">n</span><span class="op" id="7451440">.</span><span class="op" id="7451441">(</span><span class="op" id="7451442">*</span><span class="ident" id="7451443">ast</span><span class="op" id="7451446">.</span><span class="ident" id="7451447">Ident</span><span class="op" id="7451452">)</span><span class="op" id="7451453">;</span>&nbsp;<span class="ident" id="7451455">ok</span>&nbsp;<span class="op" id="7451458">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451462">v</span>&nbsp;<span class="op" id="7451464">&lt;-</span>&nbsp;<span class="ident" id="7451467">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7451474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7451477">return</span>&nbsp;<span class="ident" id="7451484">v</span><br>
<span class="lineno"></span><span class="op" id="7451486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="7451489">//&nbsp;idents&nbsp;is&nbsp;an&nbsp;iterator&nbsp;that&nbsp;returns&nbsp;all&nbsp;idents&nbsp;in&nbsp;f&nbsp;via&nbsp;the&nbsp;result&nbsp;channel.</span><br>
<span class="lineno"></span><span class="keyword" id="7451567">func</span>&nbsp;<span class="ident" id="7451572">idents</span><span class="op" id="7451578">(</span><span class="ident" id="7451579">f</span>&nbsp;<span class="op" id="7451581">*</span><span class="ident" id="7451582">ast</span><span class="op" id="7451585">.</span><span class="ident" id="7451586">File</span><span class="op" id="7451590">)</span>&nbsp;<span class="op" id="7451592">&lt;-</span><span class="keyword" id="7451594">chan</span>&nbsp;<span class="op" id="7451599">*</span><span class="ident" id="7451600">ast</span><span class="op" id="7451603">.</span><span class="ident" id="7451604">Ident</span>&nbsp;<span class="op" id="7451610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451613">v</span>&nbsp;<span class="op" id="7451615">:=</span>&nbsp;<span class="builtinfunc" id="7451618">make</span><span class="op" id="7451622">(</span><span class="ident" id="7451623">visitor</span><span class="op" id="7451630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7451633">go</span>&nbsp;<span class="keyword" id="7451636">func</span><span class="op" id="7451640">(</span><span class="op" id="7451641">)</span>&nbsp;<span class="op" id="7451643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451647">ast</span><span class="op" id="7451650">.</span><span class="ident" id="7451651">Walk</span><span class="op" id="7451655">(</span><span class="ident" id="7451656">v</span><span class="op" id="7451657">,</span>&nbsp;<span class="ident" id="7451659">f</span><span class="op" id="7451660">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7451664">close</span><span class="op" id="7451669">(</span><span class="ident" id="7451670">v</span><span class="op" id="7451671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7451674">}</span><span class="op" id="7451675">(</span><span class="op" id="7451676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7451679">return</span>&nbsp;<span class="ident" id="7451686">v</span><br>
<span class="lineno"></span><span class="op" id="7451688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="comment" id="7451691">//&nbsp;identCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;identifiers&nbsp;found&nbsp;in&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="7451751">func</span>&nbsp;<span class="ident" id="7451756">identCount</span><span class="op" id="7451766">(</span><span class="ident" id="7451767">f</span>&nbsp;<span class="op" id="7451769">*</span><span class="ident" id="7451770">ast</span><span class="op" id="7451773">.</span><span class="ident" id="7451774">File</span><span class="op" id="7451778">)</span>&nbsp;<span class="builtintype" id="7451780">int</span>&nbsp;<span class="op" id="7451784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451787">n</span>&nbsp;<span class="op" id="7451789">:=</span>&nbsp;<span class="num" id="7451792">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7451795">for</span>&nbsp;<span class="keyword" id="7451799">range</span>&nbsp;<span class="ident" id="7451805">idents</span><span class="op" id="7451811">(</span><span class="ident" id="7451812">f</span><span class="op" id="7451813">)</span>&nbsp;<span class="op" id="7451815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7451819">n</span><span class="op" id="7451820">++</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7451824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7451827">return</span>&nbsp;<span class="ident" id="7451834">n</span><br>
<span class="lineno"></span><span class="op" id="7451836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7451839">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;SourcePos&nbsp;mode&nbsp;emits&nbsp;correct&nbsp;//line&nbsp;comments</span><br>
<span class="lineno">360</span><span class="comment" id="7451903">//&nbsp;by&nbsp;testing&nbsp;that&nbsp;position&nbsp;information&nbsp;for&nbsp;matching&nbsp;identifiers</span><br>
<span class="lineno"></span><span class="comment" id="7451968">//&nbsp;is&nbsp;maintained.</span><br>
<span class="lineno"></span><span class="keyword" id="7451986">func</span>&nbsp;<span class="ident" id="7451991">TestSourcePos</span><span class="op" id="7452004">(</span><span class="ident" id="7452005">t</span>&nbsp;<span class="op" id="7452007">*</span><span class="ident" id="7452008">testing</span><span class="op" id="7452015">.</span><span class="ident" id="7452016">T</span><span class="op" id="7452017">)</span>&nbsp;<span class="op" id="7452019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452022">const</span>&nbsp;<span class="ident" id="7452028">src</span>&nbsp;<span class="op" id="7452032">=</span>&nbsp;<span class="string" id="7452034">`<br>
<span class="lineno"></span>package&nbsp;p<br>
<span class="lineno">365</span>import&nbsp;(&nbsp;&#34;go/printer&#34;;&nbsp;&#34;math&#34;&nbsp;)<br>
<span class="lineno"></span>const&nbsp;pi&nbsp;=&nbsp;3.14;&nbsp;var&nbsp;x&nbsp;=&nbsp;0<br>
<span class="lineno"></span>type&nbsp;t&nbsp;struct{&nbsp;x,&nbsp;y,&nbsp;z&nbsp;int;&nbsp;u,&nbsp;v,&nbsp;w&nbsp;float32&nbsp;}<br>
<span class="lineno"></span>func&nbsp;(t&nbsp;*t)&nbsp;foo(a,&nbsp;b,&nbsp;c&nbsp;int)&nbsp;int&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;a*t.x&nbsp;+&nbsp;b*t.y&nbsp;+<br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;two&nbsp;extra&nbsp;lines&nbsp;here<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;...<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspc*t.z<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7452259">//&nbsp;parse&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452278">f1</span><span class="op" id="7452280">,</span>&nbsp;<span class="ident" id="7452282">err</span>&nbsp;<span class="op" id="7452286">:=</span>&nbsp;<span class="ident" id="7452289">parser</span><span class="op" id="7452295">.</span><span class="ident" id="7452296">ParseFile</span><span class="op" id="7452305">(</span><span class="ident" id="7452306">fset</span><span class="op" id="7452310">,</span>&nbsp;<span class="string" id="7452312">&#34;src&#34;</span><span class="op" id="7452317">,</span>&nbsp;<span class="ident" id="7452319">src</span><span class="op" id="7452322">,</span>&nbsp;<span class="ident" id="7452324">parser</span><span class="op" id="7452330">.</span><span class="ident" id="7452331">ParseComments</span><span class="op" id="7452344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452347">if</span>&nbsp;<span class="ident" id="7452350">err</span>&nbsp;<span class="op" id="7452354">!=</span>&nbsp;<span class="ident" id="7452357">nil</span>&nbsp;<span class="op" id="7452361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452365">t</span><span class="op" id="7452366">.</span><span class="ident" id="7452367">Fatal</span><span class="op" id="7452372">(</span><span class="ident" id="7452373">err</span><span class="op" id="7452376">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7452379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7452383">//&nbsp;pretty-print&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452409">var</span>&nbsp;<span class="ident" id="7452413">buf</span>&nbsp;<span class="ident" id="7452417">bytes</span><span class="op" id="7452422">.</span><span class="ident" id="7452423">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452431">err</span>&nbsp;<span class="op" id="7452435">=</span>&nbsp;<span class="op" id="7452437">(</span><span class="op" id="7452438">&amp;</span><span class="ident" id="7452439">Config</span><span class="op" id="7452445">{</span><span class="ident" id="7452446">Mode</span><span class="op" id="7452450">:</span>&nbsp;<span class="ident" id="7452452">UseSpaces</span>&nbsp;<span class="op" id="7452462">|</span>&nbsp;<span class="ident" id="7452464">SourcePos</span><span class="op" id="7452473">,</span>&nbsp;<span class="ident" id="7452475">Tabwidth</span><span class="op" id="7452483">:</span>&nbsp;<span class="num" id="7452485">8</span><span class="op" id="7452486">}</span><span class="op" id="7452487">)</span><span class="op" id="7452488">.</span><span class="ident" id="7452489">Fprint</span><span class="op" id="7452495">(</span><span class="op" id="7452496">&amp;</span><span class="ident" id="7452497">buf</span><span class="op" id="7452500">,</span>&nbsp;<span class="ident" id="7452502">fset</span><span class="op" id="7452506">,</span>&nbsp;<span class="ident" id="7452508">f1</span><span class="op" id="7452510">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452513">if</span>&nbsp;<span class="ident" id="7452516">err</span>&nbsp;<span class="op" id="7452520">!=</span>&nbsp;<span class="ident" id="7452523">nil</span>&nbsp;<span class="op" id="7452527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452531">t</span><span class="op" id="7452532">.</span><span class="ident" id="7452533">Fatal</span><span class="op" id="7452538">(</span><span class="ident" id="7452539">err</span><span class="op" id="7452542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7452545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7452549">//&nbsp;parse&nbsp;pretty&nbsp;printed&nbsp;original</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7452583">//&nbsp;(//line&nbsp;comments&nbsp;must&nbsp;be&nbsp;interpreted&nbsp;even&nbsp;w/o&nbsp;parser.ParseComments&nbsp;set)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452659">f2</span><span class="op" id="7452661">,</span>&nbsp;<span class="ident" id="7452663">err</span>&nbsp;<span class="op" id="7452667">:=</span>&nbsp;<span class="ident" id="7452670">parser</span><span class="op" id="7452676">.</span><span class="ident" id="7452677">ParseFile</span><span class="op" id="7452686">(</span><span class="ident" id="7452687">fset</span><span class="op" id="7452691">,</span>&nbsp;<span class="string" id="7452693">&#34;&#34;</span><span class="op" id="7452695">,</span>&nbsp;<span class="ident" id="7452697">buf</span><span class="op" id="7452700">.</span><span class="ident" id="7452701">Bytes</span><span class="op" id="7452706">(</span><span class="op" id="7452707">)</span><span class="op" id="7452708">,</span>&nbsp;<span class="num" id="7452710">0</span><span class="op" id="7452711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7452714">if</span>&nbsp;<span class="ident" id="7452717">err</span>&nbsp;<span class="op" id="7452721">!=</span>&nbsp;<span class="ident" id="7452724">nil</span>&nbsp;<span class="op" id="7452728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452732">t</span><span class="op" id="7452733">.</span><span class="ident" id="7452734">Fatalf</span><span class="op" id="7452740">(</span><span class="string" id="7452741">&#34;%s\n%s&#34;</span><span class="op" id="7452749">,</span>&nbsp;<span class="ident" id="7452751">err</span><span class="op" id="7452754">,</span>&nbsp;<span class="ident" id="7452756">buf</span><span class="op" id="7452759">.</span><span class="ident" id="7452760">Bytes</span><span class="op" id="7452765">(</span><span class="op" id="7452766">)</span><span class="op" id="7452767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7452770">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7452774">//&nbsp;At&nbsp;this&nbsp;point&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;identifiers&nbsp;in&nbsp;f2&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7452845">//&nbsp;match&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;corresponding&nbsp;identifiers&nbsp;in&nbsp;f1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7452917">//&nbsp;number&nbsp;of&nbsp;identifiers&nbsp;must&nbsp;be&nbsp;&gt;&nbsp;0&nbsp;(test&nbsp;should&nbsp;run)&nbsp;and&nbsp;must&nbsp;match</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7452988">n1</span>&nbsp;<span class="op" id="7452991">:=</span>&nbsp;<span class="ident" id="7452994">identCount</span><span class="op" id="7453004">(</span><span class="ident" id="7453005">f1</span><span class="op" id="7453007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453010">n2</span>&nbsp;<span class="op" id="7453013">:=</span>&nbsp;<span class="ident" id="7453016">identCount</span><span class="op" id="7453026">(</span><span class="ident" id="7453027">f2</span><span class="op" id="7453029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453032">if</span>&nbsp;<span class="ident" id="7453035">n1</span>&nbsp;<span class="op" id="7453038">==</span>&nbsp;<span class="num" id="7453041">0</span>&nbsp;<span class="op" id="7453043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453047">t</span><span class="op" id="7453048">.</span><span class="ident" id="7453049">Fatal</span><span class="op" id="7453054">(</span><span class="string" id="7453055">&#34;got&nbsp;no&nbsp;idents&#34;</span><span class="op" id="7453070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7453073">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453076">if</span>&nbsp;<span class="ident" id="7453079">n2</span>&nbsp;<span class="op" id="7453082">!=</span>&nbsp;<span class="ident" id="7453085">n1</span>&nbsp;<span class="op" id="7453088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453092">t</span><span class="op" id="7453093">.</span><span class="ident" id="7453094">Errorf</span><span class="op" id="7453100">(</span><span class="string" id="7453101">&#34;got&nbsp;%d&nbsp;idents;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7453125">,</span>&nbsp;<span class="ident" id="7453127">n2</span><span class="op" id="7453129">,</span>&nbsp;<span class="ident" id="7453131">n1</span><span class="op" id="7453133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7453136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7453140">//&nbsp;verify&nbsp;that&nbsp;all&nbsp;identifiers&nbsp;have&nbsp;correct&nbsp;line&nbsp;information</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453202">i2range</span>&nbsp;<span class="op" id="7453210">:=</span>&nbsp;<span class="ident" id="7453213">idents</span><span class="op" id="7453219">(</span><span class="ident" id="7453220">f2</span><span class="op" id="7453222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453225">for</span>&nbsp;<span class="ident" id="7453229">i1</span>&nbsp;<span class="op" id="7453232">:=</span>&nbsp;<span class="keyword" id="7453235">range</span>&nbsp;<span class="ident" id="7453241">idents</span><span class="op" id="7453247">(</span><span class="ident" id="7453248">f1</span><span class="op" id="7453250">)</span>&nbsp;<span class="op" id="7453252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453256">i2</span>&nbsp;<span class="op" id="7453259">:=</span>&nbsp;<span class="op" id="7453262">&lt;-</span><span class="ident" id="7453264">i2range</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453275">if</span>&nbsp;<span class="ident" id="7453278">i2</span><span class="op" id="7453280">.</span><span class="ident" id="7453281">Name</span>&nbsp;<span class="op" id="7453286">!=</span>&nbsp;<span class="ident" id="7453289">i1</span><span class="op" id="7453291">.</span><span class="ident" id="7453292">Name</span>&nbsp;<span class="op" id="7453297">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453302">t</span><span class="op" id="7453303">.</span><span class="ident" id="7453304">Errorf</span><span class="op" id="7453310">(</span><span class="string" id="7453311">&#34;got&nbsp;ident&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7453334">,</span>&nbsp;<span class="ident" id="7453336">i2</span><span class="op" id="7453338">.</span><span class="ident" id="7453339">Name</span><span class="op" id="7453343">,</span>&nbsp;<span class="ident" id="7453345">i1</span><span class="op" id="7453347">.</span><span class="ident" id="7453348">Name</span><span class="op" id="7453352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7453356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453361">l1</span>&nbsp;<span class="op" id="7453364">:=</span>&nbsp;<span class="ident" id="7453367">fset</span><span class="op" id="7453371">.</span><span class="ident" id="7453372">Position</span><span class="op" id="7453380">(</span><span class="ident" id="7453381">i1</span><span class="op" id="7453383">.</span><span class="ident" id="7453384">Pos</span><span class="op" id="7453387">(</span><span class="op" id="7453388">)</span><span class="op" id="7453389">)</span><span class="op" id="7453390">.</span><span class="ident" id="7453391">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453398">l2</span>&nbsp;<span class="op" id="7453401">:=</span>&nbsp;<span class="ident" id="7453404">fset</span><span class="op" id="7453408">.</span><span class="ident" id="7453409">Position</span><span class="op" id="7453417">(</span><span class="ident" id="7453418">i2</span><span class="op" id="7453420">.</span><span class="ident" id="7453421">Pos</span><span class="op" id="7453424">(</span><span class="op" id="7453425">)</span><span class="op" id="7453426">)</span><span class="op" id="7453427">.</span><span class="ident" id="7453428">Line</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453435">if</span>&nbsp;<span class="ident" id="7453438">l2</span>&nbsp;<span class="op" id="7453441">!=</span>&nbsp;<span class="ident" id="7453444">l1</span>&nbsp;<span class="op" id="7453447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453452">t</span><span class="op" id="7453453">.</span><span class="ident" id="7453454">Errorf</span><span class="op" id="7453460">(</span><span class="string" id="7453461">&#34;got&nbsp;line&nbsp;%d;&nbsp;want&nbsp;%d&nbsp;for&nbsp;%s&#34;</span><span class="op" id="7453490">,</span>&nbsp;<span class="ident" id="7453492">l2</span><span class="op" id="7453494">,</span>&nbsp;<span class="ident" id="7453496">l1</span><span class="op" id="7453498">,</span>&nbsp;<span class="ident" id="7453500">i1</span><span class="op" id="7453502">.</span><span class="ident" id="7453503">Name</span><span class="op" id="7453507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7453511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7453514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453518">if</span>&nbsp;<span class="ident" id="7453521">t</span><span class="op" id="7453522">.</span><span class="ident" id="7453523">Failed</span><span class="op" id="7453529">(</span><span class="op" id="7453530">)</span>&nbsp;<span class="op" id="7453532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453536">t</span><span class="op" id="7453537">.</span><span class="ident" id="7453538">Logf</span><span class="op" id="7453542">(</span><span class="string" id="7453543">&#34;\n%s&#34;</span><span class="op" id="7453549">,</span>&nbsp;<span class="ident" id="7453551">buf</span><span class="op" id="7453554">.</span><span class="ident" id="7453555">Bytes</span><span class="op" id="7453560">(</span><span class="op" id="7453561">)</span><span class="op" id="7453562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7453565">}</span><br>
<span class="lineno"></span><span class="op" id="7453567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="7453570">var</span>&nbsp;<span class="ident" id="7453574">decls</span>&nbsp;<span class="op" id="7453580">=</span>&nbsp;<span class="op" id="7453582">[</span><span class="op" id="7453583">]</span><span class="builtintype" id="7453584">string</span><span class="op" id="7453590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7453593">`import&nbsp;&#34;fmt&#34;`</span><span class="op" id="7453607">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7453610">&#34;const&nbsp;pi&nbsp;=&nbsp;3.1415\nconst&nbsp;e&nbsp;=&nbsp;2.71828\n\nvar&nbsp;x&nbsp;=&nbsp;pi&#34;</span><span class="op" id="7453662">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7453665">&#34;func&nbsp;sum(x,&nbsp;y&nbsp;int)&nbsp;int\t{&nbsp;return&nbsp;x&nbsp;+&nbsp;y&nbsp;}&#34;</span><span class="op" id="7453707">,</span><br>
<span class="lineno"></span><span class="op" id="7453709">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="keyword" id="7453712">func</span>&nbsp;<span class="ident" id="7453717">TestDeclLists</span><span class="op" id="7453730">(</span><span class="ident" id="7453731">t</span>&nbsp;<span class="op" id="7453733">*</span><span class="ident" id="7453734">testing</span><span class="op" id="7453741">.</span><span class="ident" id="7453742">T</span><span class="op" id="7453743">)</span>&nbsp;<span class="op" id="7453745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453748">for</span>&nbsp;<span class="ident" id="7453752">_</span><span class="op" id="7453753">,</span>&nbsp;<span class="ident" id="7453755">src</span>&nbsp;<span class="op" id="7453759">:=</span>&nbsp;<span class="keyword" id="7453762">range</span>&nbsp;<span class="ident" id="7453768">decls</span>&nbsp;<span class="op" id="7453774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453778">file</span><span class="op" id="7453782">,</span>&nbsp;<span class="ident" id="7453784">err</span>&nbsp;<span class="op" id="7453788">:=</span>&nbsp;<span class="ident" id="7453791">parser</span><span class="op" id="7453797">.</span><span class="ident" id="7453798">ParseFile</span><span class="op" id="7453807">(</span><span class="ident" id="7453808">fset</span><span class="op" id="7453812">,</span>&nbsp;<span class="string" id="7453814">&#34;&#34;</span><span class="op" id="7453816">,</span>&nbsp;<span class="string" id="7453818">&#34;package&nbsp;p;&#34;</span><span class="op" id="7453830">+</span><span class="ident" id="7453831">src</span><span class="op" id="7453834">,</span>&nbsp;<span class="ident" id="7453836">parser</span><span class="op" id="7453842">.</span><span class="ident" id="7453843">ParseComments</span><span class="op" id="7453856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453860">if</span>&nbsp;<span class="ident" id="7453863">err</span>&nbsp;<span class="op" id="7453867">!=</span>&nbsp;<span class="ident" id="7453870">nil</span>&nbsp;<span class="op" id="7453874">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7453879">panic</span><span class="op" id="7453884">(</span><span class="ident" id="7453885">err</span><span class="op" id="7453888">)</span>&nbsp;<span class="comment" id="7453890">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7453909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7453914">var</span>&nbsp;<span class="ident" id="7453918">buf</span>&nbsp;<span class="ident" id="7453922">bytes</span><span class="op" id="7453927">.</span><span class="ident" id="7453928">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7453937">err</span>&nbsp;<span class="op" id="7453941">=</span>&nbsp;<span class="ident" id="7453943">Fprint</span><span class="op" id="7453949">(</span><span class="op" id="7453950">&amp;</span><span class="ident" id="7453951">buf</span><span class="op" id="7453954">,</span>&nbsp;<span class="ident" id="7453956">fset</span><span class="op" id="7453960">,</span>&nbsp;<span class="ident" id="7453962">file</span><span class="op" id="7453966">.</span><span class="ident" id="7453967">Decls</span><span class="op" id="7453972">)</span>&nbsp;<span class="comment" id="7453974">//&nbsp;only&nbsp;print&nbsp;declarations</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7454003">if</span>&nbsp;<span class="ident" id="7454006">err</span>&nbsp;<span class="op" id="7454010">!=</span>&nbsp;<span class="ident" id="7454013">nil</span>&nbsp;<span class="op" id="7454017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7454022">panic</span><span class="op" id="7454027">(</span><span class="ident" id="7454028">err</span><span class="op" id="7454031">)</span>&nbsp;<span class="comment" id="7454033">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7454052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454057">out</span>&nbsp;<span class="op" id="7454061">:=</span>&nbsp;<span class="ident" id="7454064">buf</span><span class="op" id="7454067">.</span><span class="ident" id="7454068">String</span><span class="op" id="7454074">(</span><span class="op" id="7454075">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7454079">if</span>&nbsp;<span class="ident" id="7454082">out</span>&nbsp;<span class="op" id="7454086">!=</span>&nbsp;<span class="ident" id="7454089">src</span>&nbsp;<span class="op" id="7454093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454098">t</span><span class="op" id="7454099">.</span><span class="ident" id="7454100">Errorf</span><span class="op" id="7454106">(</span><span class="string" id="7454107">&#34;\ngot&nbsp;:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="7454131">,</span>&nbsp;<span class="ident" id="7454133">out</span><span class="op" id="7454136">,</span>&nbsp;<span class="ident" id="7454138">src</span><span class="op" id="7454141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7454145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7454148">}</span><br>
<span class="lineno"></span><span class="op" id="7454150">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="keyword" id="7454153">var</span>&nbsp;<span class="ident" id="7454157">stmts</span>&nbsp;<span class="op" id="7454163">=</span>&nbsp;<span class="op" id="7454165">[</span><span class="op" id="7454166">]</span><span class="builtintype" id="7454167">string</span><span class="op" id="7454173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7454176">&#34;i&nbsp;:=&nbsp;0&#34;</span><span class="op" id="7454184">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7454187">&#34;select&nbsp;{}\nvar&nbsp;a,&nbsp;b&nbsp;=&nbsp;1,&nbsp;2\nreturn&nbsp;a&nbsp;+&nbsp;b&#34;</span><span class="op" id="7454229">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7454232">&#34;go&nbsp;f()\ndefer&nbsp;func()&nbsp;{}()&#34;</span><span class="op" id="7454259">,</span><br>
<span class="lineno">460</span><span class="op" id="7454261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7454264">func</span>&nbsp;<span class="ident" id="7454269">TestStmtLists</span><span class="op" id="7454282">(</span><span class="ident" id="7454283">t</span>&nbsp;<span class="op" id="7454285">*</span><span class="ident" id="7454286">testing</span><span class="op" id="7454293">.</span><span class="ident" id="7454294">T</span><span class="op" id="7454295">)</span>&nbsp;<span class="op" id="7454297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7454300">for</span>&nbsp;<span class="ident" id="7454304">_</span><span class="op" id="7454305">,</span>&nbsp;<span class="ident" id="7454307">src</span>&nbsp;<span class="op" id="7454311">:=</span>&nbsp;<span class="keyword" id="7454314">range</span>&nbsp;<span class="ident" id="7454320">stmts</span>&nbsp;<span class="op" id="7454326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454330">file</span><span class="op" id="7454334">,</span>&nbsp;<span class="ident" id="7454336">err</span>&nbsp;<span class="op" id="7454340">:=</span>&nbsp;<span class="ident" id="7454343">parser</span><span class="op" id="7454349">.</span><span class="ident" id="7454350">ParseFile</span><span class="op" id="7454359">(</span><span class="ident" id="7454360">fset</span><span class="op" id="7454364">,</span>&nbsp;<span class="string" id="7454366">&#34;&#34;</span><span class="op" id="7454368">,</span>&nbsp;<span class="string" id="7454370">&#34;package&nbsp;p;&nbsp;func&nbsp;_()&nbsp;{&#34;</span><span class="op" id="7454393">+</span><span class="ident" id="7454394">src</span><span class="op" id="7454397">+</span><span class="string" id="7454398">&#34;}&#34;</span><span class="op" id="7454401">,</span>&nbsp;<span class="ident" id="7454403">parser</span><span class="op" id="7454409">.</span><span class="ident" id="7454410">ParseComments</span><span class="op" id="7454423">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7454427">if</span>&nbsp;<span class="ident" id="7454430">err</span>&nbsp;<span class="op" id="7454434">!=</span>&nbsp;<span class="ident" id="7454437">nil</span>&nbsp;<span class="op" id="7454441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7454446">panic</span><span class="op" id="7454451">(</span><span class="ident" id="7454452">err</span><span class="op" id="7454455">)</span>&nbsp;<span class="comment" id="7454457">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7454476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7454481">var</span>&nbsp;<span class="ident" id="7454485">buf</span>&nbsp;<span class="ident" id="7454489">bytes</span><span class="op" id="7454494">.</span><span class="ident" id="7454495">Buffer</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454504">err</span>&nbsp;<span class="op" id="7454508">=</span>&nbsp;<span class="ident" id="7454510">Fprint</span><span class="op" id="7454516">(</span><span class="op" id="7454517">&amp;</span><span class="ident" id="7454518">buf</span><span class="op" id="7454521">,</span>&nbsp;<span class="ident" id="7454523">fset</span><span class="op" id="7454527">,</span>&nbsp;<span class="ident" id="7454529">file</span><span class="op" id="7454533">.</span><span class="ident" id="7454534">Decls</span><span class="op" id="7454539">[</span><span class="num" id="7454540">0</span><span class="op" id="7454541">]</span><span class="op" id="7454542">.</span><span class="op" id="7454543">(</span><span class="op" id="7454544">*</span><span class="ident" id="7454545">ast</span><span class="op" id="7454548">.</span><span class="ident" id="7454549">FuncDecl</span><span class="op" id="7454557">)</span><span class="op" id="7454558">.</span><span class="ident" id="7454559">Body</span><span class="op" id="7454563">.</span><span class="ident" id="7454564">List</span><span class="op" id="7454568">)</span>&nbsp;<span class="comment" id="7454570">//&nbsp;only&nbsp;print&nbsp;statements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7454597">if</span>&nbsp;<span class="ident" id="7454600">err</span>&nbsp;<span class="op" id="7454604">!=</span>&nbsp;<span class="ident" id="7454607">nil</span>&nbsp;<span class="op" id="7454611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7454616">panic</span><span class="op" id="7454621">(</span><span class="ident" id="7454622">err</span><span class="op" id="7454625">)</span>&nbsp;<span class="comment" id="7454627">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7454646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454651">out</span>&nbsp;<span class="op" id="7454655">:=</span>&nbsp;<span class="ident" id="7454658">buf</span><span class="op" id="7454661">.</span><span class="ident" id="7454662">String</span><span class="op" id="7454668">(</span><span class="op" id="7454669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7454673">if</span>&nbsp;<span class="ident" id="7454676">out</span>&nbsp;<span class="op" id="7454680">!=</span>&nbsp;<span class="ident" id="7454683">src</span>&nbsp;<span class="op" id="7454687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454692">t</span><span class="op" id="7454693">.</span><span class="ident" id="7454694">Errorf</span><span class="op" id="7454700">(</span><span class="string" id="7454701">&#34;\ngot&nbsp;:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="7454725">,</span>&nbsp;<span class="ident" id="7454727">out</span><span class="op" id="7454730">,</span>&nbsp;<span class="ident" id="7454732">src</span><span class="op" id="7454735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7454739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7454742">}</span><br>
<span class="lineno">480</span><span class="op" id="7454744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7454747">func</span>&nbsp;<span class="ident" id="7454752">TestBaseIndent</span><span class="op" id="7454766">(</span><span class="ident" id="7454767">t</span>&nbsp;<span class="op" id="7454769">*</span><span class="ident" id="7454770">testing</span><span class="op" id="7454777">.</span><span class="ident" id="7454778">T</span><span class="op" id="7454779">)</span>&nbsp;<span class="op" id="7454781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7454784">//&nbsp;The&nbsp;testfile&nbsp;must&nbsp;not&nbsp;contain&nbsp;multi-line&nbsp;raw&nbsp;strings&nbsp;since&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7454853">//&nbsp;are&nbsp;not&nbsp;indented&nbsp;(because&nbsp;their&nbsp;values&nbsp;must&nbsp;not&nbsp;change)&nbsp;and&nbsp;make</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7454922">//&nbsp;this&nbsp;test&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7454942">const</span>&nbsp;<span class="ident" id="7454948">filename</span>&nbsp;<span class="op" id="7454957">=</span>&nbsp;<span class="string" id="7454959">&#34;printer.go&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7454973">src</span><span class="op" id="7454976">,</span>&nbsp;<span class="ident" id="7454978">err</span>&nbsp;<span class="op" id="7454982">:=</span>&nbsp;<span class="ident" id="7454985">ioutil</span><span class="op" id="7454991">.</span><span class="ident" id="7454992">ReadFile</span><span class="op" id="7455000">(</span><span class="ident" id="7455001">filename</span><span class="op" id="7455009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7455012">if</span>&nbsp;<span class="ident" id="7455015">err</span>&nbsp;<span class="op" id="7455019">!=</span>&nbsp;<span class="ident" id="7455022">nil</span>&nbsp;<span class="op" id="7455026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7455030">panic</span><span class="op" id="7455035">(</span><span class="ident" id="7455036">err</span><span class="op" id="7455039">)</span>&nbsp;<span class="comment" id="7455041">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7455059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455063">file</span><span class="op" id="7455067">,</span>&nbsp;<span class="ident" id="7455069">err</span>&nbsp;<span class="op" id="7455073">:=</span>&nbsp;<span class="ident" id="7455076">parser</span><span class="op" id="7455082">.</span><span class="ident" id="7455083">ParseFile</span><span class="op" id="7455092">(</span><span class="ident" id="7455093">fset</span><span class="op" id="7455097">,</span>&nbsp;<span class="ident" id="7455099">filename</span><span class="op" id="7455107">,</span>&nbsp;<span class="ident" id="7455109">src</span><span class="op" id="7455112">,</span>&nbsp;<span class="num" id="7455114">0</span><span class="op" id="7455115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7455118">if</span>&nbsp;<span class="ident" id="7455121">err</span>&nbsp;<span class="op" id="7455125">!=</span>&nbsp;<span class="ident" id="7455128">nil</span>&nbsp;<span class="op" id="7455132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7455136">panic</span><span class="op" id="7455141">(</span><span class="ident" id="7455142">err</span><span class="op" id="7455145">)</span>&nbsp;<span class="comment" id="7455147">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7455165">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7455169">var</span>&nbsp;<span class="ident" id="7455173">buf</span>&nbsp;<span class="ident" id="7455177">bytes</span><span class="op" id="7455182">.</span><span class="ident" id="7455183">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7455191">for</span>&nbsp;<span class="ident" id="7455195">indent</span>&nbsp;<span class="op" id="7455202">:=</span>&nbsp;<span class="num" id="7455205">0</span><span class="op" id="7455206">;</span>&nbsp;<span class="ident" id="7455208">indent</span>&nbsp;<span class="op" id="7455215">&lt;</span>&nbsp;<span class="num" id="7455217">4</span><span class="op" id="7455218">;</span>&nbsp;<span class="ident" id="7455220">indent</span><span class="op" id="7455226">++</span>&nbsp;<span class="op" id="7455229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455233">buf</span><span class="op" id="7455236">.</span><span class="ident" id="7455237">Reset</span><span class="op" id="7455242">(</span><span class="op" id="7455243">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7455247">(</span><span class="op" id="7455248">&amp;</span><span class="ident" id="7455249">Config</span><span class="op" id="7455255">{</span><span class="ident" id="7455256">Tabwidth</span><span class="op" id="7455264">:</span>&nbsp;<span class="ident" id="7455266">tabwidth</span><span class="op" id="7455274">,</span>&nbsp;<span class="ident" id="7455276">Indent</span><span class="op" id="7455282">:</span>&nbsp;<span class="ident" id="7455284">indent</span><span class="op" id="7455290">}</span><span class="op" id="7455291">)</span><span class="op" id="7455292">.</span><span class="ident" id="7455293">Fprint</span><span class="op" id="7455299">(</span><span class="op" id="7455300">&amp;</span><span class="ident" id="7455301">buf</span><span class="op" id="7455304">,</span>&nbsp;<span class="ident" id="7455306">fset</span><span class="op" id="7455310">,</span>&nbsp;<span class="ident" id="7455312">file</span><span class="op" id="7455316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7455320">//&nbsp;all&nbsp;code&nbsp;must&nbsp;be&nbsp;indented&nbsp;by&nbsp;at&nbsp;least&nbsp;&#39;indent&#39;&nbsp;tabs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455377">lines</span>&nbsp;<span class="op" id="7455383">:=</span>&nbsp;<span class="ident" id="7455386">bytes</span><span class="op" id="7455391">.</span><span class="ident" id="7455392">Split</span><span class="op" id="7455397">(</span><span class="ident" id="7455398">buf</span><span class="op" id="7455401">.</span><span class="ident" id="7455402">Bytes</span><span class="op" id="7455407">(</span><span class="op" id="7455408">)</span><span class="op" id="7455409">,</span>&nbsp;<span class="op" id="7455411">[</span><span class="op" id="7455412">]</span><span class="builtintype" id="7455413">byte</span><span class="op" id="7455417">{</span><span class="string" id="7455418">&#39;\n&#39;</span><span class="op" id="7455422">}</span><span class="op" id="7455423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7455427">for</span>&nbsp;<span class="ident" id="7455431">i</span><span class="op" id="7455432">,</span>&nbsp;<span class="ident" id="7455434">line</span>&nbsp;<span class="op" id="7455439">:=</span>&nbsp;<span class="keyword" id="7455442">range</span>&nbsp;<span class="ident" id="7455448">lines</span>&nbsp;<span class="op" id="7455454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7455459">if</span>&nbsp;<span class="builtinfunc" id="7455462">len</span><span class="op" id="7455465">(</span><span class="ident" id="7455466">line</span><span class="op" id="7455470">)</span>&nbsp;<span class="op" id="7455472">==</span>&nbsp;<span class="num" id="7455475">0</span>&nbsp;<span class="op" id="7455477">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7455483">continue</span>&nbsp;<span class="comment" id="7455492">//&nbsp;empty&nbsp;lines&nbsp;don&#39;t&nbsp;have&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7455533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455538">n</span>&nbsp;<span class="op" id="7455540">:=</span>&nbsp;<span class="num" id="7455543">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7455548">for</span>&nbsp;<span class="ident" id="7455552">j</span><span class="op" id="7455553">,</span>&nbsp;<span class="ident" id="7455555">b</span>&nbsp;<span class="op" id="7455557">:=</span>&nbsp;<span class="keyword" id="7455560">range</span>&nbsp;<span class="ident" id="7455566">line</span>&nbsp;<span class="op" id="7455571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7455577">if</span>&nbsp;<span class="ident" id="7455580">b</span>&nbsp;<span class="op" id="7455582">!=</span>&nbsp;<span class="string" id="7455585">&#39;\t&#39;</span>&nbsp;<span class="op" id="7455590">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7455597">//&nbsp;end&nbsp;of&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455624">n</span>&nbsp;<span class="op" id="7455626">=</span>&nbsp;<span class="ident" id="7455628">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7455635">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7455645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7455650">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7455655">if</span>&nbsp;<span class="ident" id="7455658">n</span>&nbsp;<span class="op" id="7455660">&lt;</span>&nbsp;<span class="ident" id="7455662">indent</span>&nbsp;<span class="op" id="7455669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455675">t</span><span class="op" id="7455676">.</span><span class="ident" id="7455677">Errorf</span><span class="op" id="7455683">(</span><span class="string" id="7455684">&#34;line&nbsp;%d:&nbsp;got&nbsp;only&nbsp;%d&nbsp;tabs;&nbsp;want&nbsp;at&nbsp;least&nbsp;%d:&nbsp;%q&#34;</span><span class="op" id="7455733">,</span>&nbsp;<span class="ident" id="7455735">i</span><span class="op" id="7455736">,</span>&nbsp;<span class="ident" id="7455738">n</span><span class="op" id="7455739">,</span>&nbsp;<span class="ident" id="7455741">indent</span><span class="op" id="7455747">,</span>&nbsp;<span class="ident" id="7455749">line</span><span class="op" id="7455753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7455758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7455762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7455765">}</span><br>
<span class="lineno">520</span><span class="op" id="7455767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7455770">//&nbsp;TestFuncType&nbsp;tests&nbsp;that&nbsp;an&nbsp;ast.FuncType&nbsp;with&nbsp;a&nbsp;nil&nbsp;Params&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="7455837">//&nbsp;can&nbsp;be&nbsp;printed&nbsp;(per&nbsp;go/ast&nbsp;specification).&nbsp;Test&nbsp;case&nbsp;for&nbsp;issue&nbsp;3870.</span><br>
<span class="lineno"></span><span class="keyword" id="7455909">func</span>&nbsp;<span class="ident" id="7455914">TestFuncType</span><span class="op" id="7455926">(</span><span class="ident" id="7455927">t</span>&nbsp;<span class="op" id="7455929">*</span><span class="ident" id="7455930">testing</span><span class="op" id="7455937">.</span><span class="ident" id="7455938">T</span><span class="op" id="7455939">)</span>&nbsp;<span class="op" id="7455941">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455944">src</span>&nbsp;<span class="op" id="7455948">:=</span>&nbsp;<span class="op" id="7455951">&amp;</span><span class="ident" id="7455952">ast</span><span class="op" id="7455955">.</span><span class="ident" id="7455956">File</span><span class="op" id="7455960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455964">Name</span><span class="op" id="7455968">:</span>&nbsp;<span class="op" id="7455970">&amp;</span><span class="ident" id="7455971">ast</span><span class="op" id="7455974">.</span><span class="ident" id="7455975">Ident</span><span class="op" id="7455980">{</span><span class="ident" id="7455981">Name</span><span class="op" id="7455985">:</span>&nbsp;<span class="string" id="7455987">&#34;p&#34;</span><span class="op" id="7455990">}</span><span class="op" id="7455991">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7455995">Decls</span><span class="op" id="7456000">:</span>&nbsp;<span class="op" id="7456002">[</span><span class="op" id="7456003">]</span><span class="ident" id="7456004">ast</span><span class="op" id="7456007">.</span><span class="ident" id="7456008">Decl</span><span class="op" id="7456012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7456017">&amp;</span><span class="ident" id="7456018">ast</span><span class="op" id="7456021">.</span><span class="ident" id="7456022">FuncDecl</span><span class="op" id="7456030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456036">Name</span><span class="op" id="7456040">:</span>&nbsp;<span class="op" id="7456042">&amp;</span><span class="ident" id="7456043">ast</span><span class="op" id="7456046">.</span><span class="ident" id="7456047">Ident</span><span class="op" id="7456052">{</span><span class="ident" id="7456053">Name</span><span class="op" id="7456057">:</span>&nbsp;<span class="string" id="7456059">&#34;f&#34;</span><span class="op" id="7456062">}</span><span class="op" id="7456063">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456069">Type</span><span class="op" id="7456073">:</span>&nbsp;<span class="op" id="7456075">&amp;</span><span class="ident" id="7456076">ast</span><span class="op" id="7456079">.</span><span class="ident" id="7456080">FuncType</span><span class="op" id="7456088">{</span><span class="op" id="7456089">}</span><span class="op" id="7456090">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7456095">}</span><span class="op" id="7456096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7456100">}</span><span class="op" id="7456101">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7456104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7456108">var</span>&nbsp;<span class="ident" id="7456112">buf</span>&nbsp;<span class="ident" id="7456116">bytes</span><span class="op" id="7456121">.</span><span class="ident" id="7456122">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7456130">if</span>&nbsp;<span class="ident" id="7456133">err</span>&nbsp;<span class="op" id="7456137">:=</span>&nbsp;<span class="ident" id="7456140">Fprint</span><span class="op" id="7456146">(</span><span class="op" id="7456147">&amp;</span><span class="ident" id="7456148">buf</span><span class="op" id="7456151">,</span>&nbsp;<span class="ident" id="7456153">fset</span><span class="op" id="7456157">,</span>&nbsp;<span class="ident" id="7456159">src</span><span class="op" id="7456162">)</span><span class="op" id="7456163">;</span>&nbsp;<span class="ident" id="7456165">err</span>&nbsp;<span class="op" id="7456169">!=</span>&nbsp;<span class="ident" id="7456172">nil</span>&nbsp;<span class="op" id="7456176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456180">t</span><span class="op" id="7456181">.</span><span class="ident" id="7456182">Fatal</span><span class="op" id="7456187">(</span><span class="ident" id="7456188">err</span><span class="op" id="7456191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7456194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456197">got</span>&nbsp;<span class="op" id="7456201">:=</span>&nbsp;<span class="ident" id="7456204">buf</span><span class="op" id="7456207">.</span><span class="ident" id="7456208">String</span><span class="op" id="7456214">(</span><span class="op" id="7456215">)</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7456219">const</span>&nbsp;<span class="ident" id="7456225">want</span>&nbsp;<span class="op" id="7456230">=</span>&nbsp;<span class="string" id="7456232">`package&nbsp;p<br>
<span class="lineno"></span><br>
<span class="lineno"></span>func&nbsp;f()<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7456257">if</span>&nbsp;<span class="ident" id="7456260">got</span>&nbsp;<span class="op" id="7456264">!=</span>&nbsp;<span class="ident" id="7456267">want</span>&nbsp;<span class="op" id="7456272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456276">t</span><span class="op" id="7456277">.</span><span class="ident" id="7456278">Fatalf</span><span class="op" id="7456284">(</span><span class="string" id="7456285">&#34;got:\n%s\nwant:\n%s\n&#34;</span><span class="op" id="7456308">,</span>&nbsp;<span class="ident" id="7456310">got</span><span class="op" id="7456313">,</span>&nbsp;<span class="ident" id="7456315">want</span><span class="op" id="7456319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7456322">}</span><br>
<span class="lineno"></span><span class="op" id="7456324">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="7456327">//&nbsp;TextX&nbsp;is&nbsp;a&nbsp;skeleton&nbsp;test&nbsp;that&nbsp;can&nbsp;be&nbsp;filled&nbsp;in&nbsp;for&nbsp;debugging&nbsp;one-off&nbsp;cases.</span><br>
<span class="lineno"></span><span class="comment" id="7456406">//&nbsp;Do&nbsp;not&nbsp;remove.</span><br>
<span class="lineno"></span><span class="keyword" id="7456424">func</span>&nbsp;<span class="ident" id="7456429">TestX</span><span class="op" id="7456434">(</span><span class="ident" id="7456435">t</span>&nbsp;<span class="op" id="7456437">*</span><span class="ident" id="7456438">testing</span><span class="op" id="7456445">.</span><span class="ident" id="7456446">T</span><span class="op" id="7456447">)</span>&nbsp;<span class="op" id="7456449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7456452">const</span>&nbsp;<span class="ident" id="7456458">src</span>&nbsp;<span class="op" id="7456462">=</span>&nbsp;<span class="string" id="7456464">`<br>
<span class="lineno">555</span>package&nbsp;p<br>
<span class="lineno"></span>func&nbsp;_()&nbsp;{}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456491">_</span><span class="op" id="7456492">,</span>&nbsp;<span class="ident" id="7456494">err</span>&nbsp;<span class="op" id="7456498">:=</span>&nbsp;<span class="ident" id="7456501">format</span><span class="op" id="7456507">(</span><span class="op" id="7456508">[</span><span class="op" id="7456509">]</span><span class="builtintype" id="7456510">byte</span><span class="op" id="7456514">(</span><span class="ident" id="7456515">src</span><span class="op" id="7456518">)</span><span class="op" id="7456519">,</span>&nbsp;<span class="num" id="7456521">0</span><span class="op" id="7456522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7456525">if</span>&nbsp;<span class="ident" id="7456528">err</span>&nbsp;<span class="op" id="7456532">!=</span>&nbsp;<span class="ident" id="7456535">nil</span>&nbsp;<span class="op" id="7456539">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7456543">t</span><span class="op" id="7456544">.</span><span class="ident" id="7456545">Error</span><span class="op" id="7456550">(</span><span class="ident" id="7456551">err</span><span class="op" id="7456554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7456557">}</span><br>
<span class="lineno"></span><span class="op" id="7456559">}</span>
</div>
</body>
</html>
