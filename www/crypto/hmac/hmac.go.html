<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4043813">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4043868">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4043922">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4043973">/*<br>
<span class="lineno"></span>Package&nbsp;hmac&nbsp;implements&nbsp;the&nbsp;Keyed-Hash&nbsp;Message&nbsp;Authentication&nbsp;Code&nbsp;(HMAC)&nbsp;as<br>
<span class="lineno"></span>defined&nbsp;in&nbsp;U.S.&nbsp;Federal&nbsp;Information&nbsp;Processing&nbsp;Standards&nbsp;Publication&nbsp;198.<br>
<span class="lineno"></span>An&nbsp;HMAC&nbsp;is&nbsp;a&nbsp;cryptographic&nbsp;hash&nbsp;that&nbsp;uses&nbsp;a&nbsp;key&nbsp;to&nbsp;sign&nbsp;a&nbsp;message.<br>
<span class="lineno"></span>The&nbsp;receiver&nbsp;verifies&nbsp;the&nbsp;hash&nbsp;by&nbsp;recomputing&nbsp;it&nbsp;using&nbsp;the&nbsp;same&nbsp;key.<br>
<span class="lineno">10</span><br>
<span class="lineno"></span>Receivers&nbsp;should&nbsp;be&nbsp;careful&nbsp;to&nbsp;use&nbsp;Equal&nbsp;to&nbsp;compare&nbsp;MACs&nbsp;in&nbsp;order&nbsp;to&nbsp;avoid<br>
<span class="lineno"></span>timing&nbsp;side-channels:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;CheckMAC&nbsp;returns&nbsp;true&nbsp;if&nbsp;messageMAC&nbsp;is&nbsp;a&nbsp;valid&nbsp;HMAC&nbsp;tag&nbsp;for&nbsp;message.<br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;CheckMAC(message,&nbsp;messageMAC,&nbsp;key&nbsp;[]byte)&nbsp;bool&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspmac&nbsp;:=&nbsp;hmac.New(sha256.New,&nbsp;key)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspmac.Write(message)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspexpectedMAC&nbsp;:=&nbsp;mac.Sum(nil)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;hmac.Equal(messageMAC,&nbsp;expectedMAC)<br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno"></span><span class="keyword" id="4044627">package</span>&nbsp;<span class="ident" id="4044635">hmac</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4044641">import</span>&nbsp;<span class="op" id="4044648">(</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4044651">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4044668">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="4044675">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4044678">//&nbsp;FIPS&nbsp;198:</span><br>
<span class="lineno">30</span><span class="comment" id="4044691">//&nbsp;http://csrc.nist.gov/publications/fips/fips198/fips-198a.pdf</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4044756">//&nbsp;key&nbsp;is&nbsp;zero&nbsp;padded&nbsp;to&nbsp;the&nbsp;block&nbsp;size&nbsp;of&nbsp;the&nbsp;hash&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="4044817">//&nbsp;ipad&nbsp;=&nbsp;0x36&nbsp;byte&nbsp;repeated&nbsp;for&nbsp;key&nbsp;length</span><br>
<span class="lineno"></span><span class="comment" id="4044861">//&nbsp;opad&nbsp;=&nbsp;0x5c&nbsp;byte&nbsp;repeated&nbsp;for&nbsp;key&nbsp;length</span><br>
<span class="lineno">35</span><span class="comment" id="4044905">//&nbsp;hmac&nbsp;=&nbsp;H([key&nbsp;^&nbsp;opad]&nbsp;H([key&nbsp;^&nbsp;ipad]&nbsp;text))</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4044953">type</span>&nbsp;<span class="ident" id="4044958">hmac</span>&nbsp;<span class="keyword" id="4044963">struct</span>&nbsp;<span class="op" id="4044970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4044973">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4044986">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4044991">blocksize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4045004">int</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4045009">key</span><span class="op" id="4045012">,</span>&nbsp;<span class="ident" id="4045014">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4045022">[</span><span class="op" id="4045023">]</span><span class="builtintype" id="4045024">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4045030">outer</span><span class="op" id="4045035">,</span>&nbsp;<span class="ident" id="4045037">inner</span>&nbsp;<span class="ident" id="4045043">hash</span><span class="op" id="4045047">.</span><span class="ident" id="4045048">Hash</span><br>
<span class="lineno"></span><span class="op" id="4045053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4045056">func</span>&nbsp;<span class="op" id="4045061">(</span><span class="ident" id="4045062">h</span>&nbsp;<span class="op" id="4045064">*</span><span class="ident" id="4045065">hmac</span><span class="op" id="4045069">)</span>&nbsp;<span class="ident" id="4045071">tmpPad</span><span class="op" id="4045077">(</span><span class="ident" id="4045078">xor</span>&nbsp;<span class="builtintype" id="4045082">byte</span><span class="op" id="4045086">)</span>&nbsp;<span class="op" id="4045088">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4045091">for</span>&nbsp;<span class="ident" id="4045095">i</span><span class="op" id="4045096">,</span>&nbsp;<span class="ident" id="4045098">k</span>&nbsp;<span class="op" id="4045100">:=</span>&nbsp;<span class="keyword" id="4045103">range</span>&nbsp;<span class="ident" id="4045109">h</span><span class="op" id="4045110">.</span><span class="ident" id="4045111">key</span>&nbsp;<span class="op" id="4045115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4045119">h</span><span class="op" id="4045120">.</span><span class="ident" id="4045121">tmp</span><span class="op" id="4045124">[</span><span class="ident" id="4045125">i</span><span class="op" id="4045126">]</span>&nbsp;<span class="op" id="4045128">=</span>&nbsp;<span class="ident" id="4045130">xor</span>&nbsp;<span class="op" id="4045134">^</span>&nbsp;<span class="ident" id="4045136">k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4045139">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4045142">for</span>&nbsp;<span class="ident" id="4045146">i</span>&nbsp;<span class="op" id="4045148">:=</span>&nbsp;<span class="builtinfunc" id="4045151">len</span><span class="op" id="4045154">(</span><span class="ident" id="4045155">h</span><span class="op" id="4045156">.</span><span class="ident" id="4045157">key</span><span class="op" id="4045160">)</span><span class="op" id="4045161">;</span>&nbsp;<span class="ident" id="4045163">i</span>&nbsp;<span class="op" id="4045165">&lt;</span>&nbsp;<span class="ident" id="4045167">h</span><span class="op" id="4045168">.</span><span class="ident" id="4045169">blocksize</span><span class="op" id="4045178">;</span>&nbsp;<span class="ident" id="4045180">i</span><span class="op" id="4045181">++</span>&nbsp;<span class="op" id="4045184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4045188">h</span><span class="op" id="4045189">.</span><span class="ident" id="4045190">tmp</span><span class="op" id="4045193">[</span><span class="ident" id="4045194">i</span><span class="op" id="4045195">]</span>&nbsp;<span class="op" id="4045197">=</span>&nbsp;<span class="ident" id="4045199">xor</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4045204">}</span><br>
<span class="lineno"></span><span class="op" id="4045206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4045209">func</span>&nbsp;<span class="op" id="4045214">(</span><span class="ident" id="4045215">h</span>&nbsp;<span class="op" id="4045217">*</span><span class="ident" id="4045218">hmac</span><span class="op" id="4045222">)</span>&nbsp;<span class="ident" id="4045224">Sum</span><span class="op" id="4045227">(</span><span class="ident" id="4045228">in</span>&nbsp;<span class="op" id="4045231">[</span><span class="op" id="4045232">]</span><span class="builtintype" id="4045233">byte</span><span class="op" id="4045237">)</span>&nbsp;<span class="op" id="4045239">[</span><span class="op" id="4045240">]</span><span class="builtintype" id="4045241">byte</span>&nbsp;<span class="op" id="4045246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4045249">origLen</span>&nbsp;<span class="op" id="4045257">:=</span>&nbsp;<span class="builtinfunc" id="4045260">len</span><span class="op" id="4045263">(</span><span class="ident" id="4045264">in</span><span class="op" id="4045266">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4045269">in</span>&nbsp;<span class="op" id="4045272">=</span>&nbsp;<span class="ident" id="4045274">h</span><span class="op" id="4045275">.</span><span class="ident" id="4045276">inner</span><span class="op" id="4045281">.</span><span class="ident" id="4045282">Sum</span><span class="op" id="4045285">(</span><span class="ident" id="4045286">in</span><span class="op" id="4045288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4045291">h</span><span class="op" id="4045292">.</span><span class="ident" id="4045293">tmpPad</span><span class="op" id="4045299">(</span><span class="num" id="4045300">0x5c</span><span class="op" id="4045304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4045307">copy</span><span class="op" id="4045311">(</span><span class="ident" id="4045312">h</span><span class="op" id="4045313">.</span><span class="ident" id="4045314">tmp</span><span class="op" id="4045317">[</span><span class="ident" id="4045318">h</span><span class="op" id="4045319">.</span><span class="ident" id="4045320">blocksize</span><span class="op" id="4045329">:</span><span class="op" id="4045330">]</span><span class="op" id="4045331">,</span>&nbsp;<span class="ident" id="4045333">in</span><span class="op" id="4045335">[</span><span class="ident" id="4045336">origLen</span><span class="op" id="4045343">:</span><span class="op" id="4045344">]</span><span class="op" id="4045345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4045348">h</span><span class="op" id="4045349">.</span><span class="ident" id="4045350">outer</span><span class="op" id="4045355">.</span><span class="ident" id="4045356">Reset</span><span class="op" id="4045361">(</span><span class="op" id="4045362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4045365">h</span><span class="op" id="4045366">.</span><span class="ident" id="4045367">outer</span><span class="op" id="4045372">.</span><span class="ident" id="4045373">Write</span><span class="op" id="4045378">(</span><span class="ident" id="4045379">h</span><span class="op" id="4045380">.</span><span class="ident" id="4045381">tmp</span><span class="op" id="4045384">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4045387">return</span>&nbsp;<span class="ident" id="4045394">h</span><span class="op" id="4045395">.</span><span class="ident" id="4045396">outer</span><span class="op" id="4045401">.</span><span class="ident" id="4045402">Sum</span><span class="op" id="4045405">(</span><span class="ident" id="4045406">in</span><span class="op" id="4045408">[</span><span class="op" id="4045409">:</span><span class="ident" id="4045410">origLen</span><span class="op" id="4045417">]</span><span class="op" id="4045418">)</span><br>
<span class="lineno"></span><span class="op" id="4045420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4045423">func</span>&nbsp;<span class="op" id="4045428">(</span><span class="ident" id="4045429">h</span>&nbsp;<span class="op" id="4045431">*</span><span class="ident" id="4045432">hmac</span><span class="op" id="4045436">)</span>&nbsp;<span class="ident" id="4045438">Write</span><span class="op" id="4045443">(</span><span class="ident" id="4045444">p</span>&nbsp;<span class="op" id="4045446">[</span><span class="op" id="4045447">]</span><span class="builtintype" id="4045448">byte</span><span class="op" id="4045452">)</span>&nbsp;<span class="op" id="4045454">(</span><span class="ident" id="4045455">n</span>&nbsp;<span class="builtintype" id="4045457">int</span><span class="op" id="4045460">,</span>&nbsp;<span class="ident" id="4045462">err</span>&nbsp;<span class="builtintype" id="4045466">error</span><span class="op" id="4045471">)</span>&nbsp;<span class="op" id="4045473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4045476">return</span>&nbsp;<span class="ident" id="4045483">h</span><span class="op" id="4045484">.</span><span class="ident" id="4045485">inner</span><span class="op" id="4045490">.</span><span class="ident" id="4045491">Write</span><span class="op" id="4045496">(</span><span class="ident" id="4045497">p</span><span class="op" id="4045498">)</span><br>
<span class="lineno">65</span><span class="op" id="4045500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4045503">func</span>&nbsp;<span class="op" id="4045508">(</span><span class="ident" id="4045509">h</span>&nbsp;<span class="op" id="4045511">*</span><span class="ident" id="4045512">hmac</span><span class="op" id="4045516">)</span>&nbsp;<span class="ident" id="4045518">Size</span><span class="op" id="4045522">(</span><span class="op" id="4045523">)</span>&nbsp;<span class="builtintype" id="4045525">int</span>&nbsp;<span class="op" id="4045529">{</span>&nbsp;<span class="keyword" id="4045531">return</span>&nbsp;<span class="ident" id="4045538">h</span><span class="op" id="4045539">.</span><span class="ident" id="4045540">size</span>&nbsp;<span class="op" id="4045545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4045548">func</span>&nbsp;<span class="op" id="4045553">(</span><span class="ident" id="4045554">h</span>&nbsp;<span class="op" id="4045556">*</span><span class="ident" id="4045557">hmac</span><span class="op" id="4045561">)</span>&nbsp;<span class="ident" id="4045563">BlockSize</span><span class="op" id="4045572">(</span><span class="op" id="4045573">)</span>&nbsp;<span class="builtintype" id="4045575">int</span>&nbsp;<span class="op" id="4045579">{</span>&nbsp;<span class="keyword" id="4045581">return</span>&nbsp;<span class="ident" id="4045588">h</span><span class="op" id="4045589">.</span><span class="ident" id="4045590">blocksize</span>&nbsp;<span class="op" id="4045600">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4045603">func</span>&nbsp;<span class="op" id="4045608">(</span><span class="ident" id="4045609">h</span>&nbsp;<span class="op" id="4045611">*</span><span class="ident" id="4045612">hmac</span><span class="op" id="4045616">)</span>&nbsp;<span class="ident" id="4045618">Reset</span><span class="op" id="4045623">(</span><span class="op" id="4045624">)</span>&nbsp;<span class="op" id="4045626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4045629">h</span><span class="op" id="4045630">.</span><span class="ident" id="4045631">inner</span><span class="op" id="4045636">.</span><span class="ident" id="4045637">Reset</span><span class="op" id="4045642">(</span><span class="op" id="4045643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4045646">h</span><span class="op" id="4045647">.</span><span class="ident" id="4045648">tmpPad</span><span class="op" id="4045654">(</span><span class="num" id="4045655">0x36</span><span class="op" id="4045659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4045662">h</span><span class="op" id="4045663">.</span><span class="ident" id="4045664">inner</span><span class="op" id="4045669">.</span><span class="ident" id="4045670">Write</span><span class="op" id="4045675">(</span><span class="ident" id="4045676">h</span><span class="op" id="4045677">.</span><span class="ident" id="4045678">tmp</span><span class="op" id="4045681">[</span><span class="op" id="4045682">:</span><span class="ident" id="4045683">h</span><span class="op" id="4045684">.</span><span class="ident" id="4045685">blocksize</span><span class="op" id="4045694">]</span><span class="op" id="4045695">)</span><br>
<span class="lineno">75</span><span class="op" id="4045697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4045700">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;HMAC&nbsp;hash&nbsp;using&nbsp;the&nbsp;given&nbsp;hash.Hash&nbsp;type&nbsp;and&nbsp;key.</span><br>
<span class="lineno"></span><span class="keyword" id="4045771">func</span>&nbsp;<span class="ident" id="4045776">New</span><span class="op" id="4045779">(</span><span class="ident" id="4045780">h</span>&nbsp;<span class="keyword" id="4045782">func</span><span class="op" id="4045786">(</span><span class="op" id="4045787">)</span>&nbsp;<span class="ident" id="4045789">hash</span><span class="op" id="4045793">.</span><span class="ident" id="4045794">Hash</span><span class="op" id="4045798">,</span>&nbsp;<span class="ident" id="4045800">key</span>&nbsp;<span class="op" id="4045804">[</span><span class="op" id="4045805">]</span><span class="builtintype" id="4045806">byte</span><span class="op" id="4045810">)</span>&nbsp;<span class="ident" id="4045812">hash</span><span class="op" id="4045816">.</span><span class="ident" id="4045817">Hash</span>&nbsp;<span class="op" id="4045822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4045825">hm</span>&nbsp;<span class="op" id="4045828">:=</span>&nbsp;<span class="builtinfunc" id="4045831">new</span><span class="op" id="4045834">(</span><span class="ident" id="4045835">hmac</span><span class="op" id="4045839">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4045842">hm</span><span class="op" id="4045844">.</span><span class="ident" id="4045845">outer</span>&nbsp;<span class="op" id="4045851">=</span>&nbsp;<span class="ident" id="4045853">h</span><span class="op" id="4045854">(</span><span class="op" id="4045855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4045858">hm</span><span class="op" id="4045860">.</span><span class="ident" id="4045861">inner</span>&nbsp;<span class="op" id="4045867">=</span>&nbsp;<span class="ident" id="4045869">h</span><span class="op" id="4045870">(</span><span class="op" id="4045871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4045874">hm</span><span class="op" id="4045876">.</span><span class="ident" id="4045877">size</span>&nbsp;<span class="op" id="4045882">=</span>&nbsp;<span class="ident" id="4045884">hm</span><span class="op" id="4045886">.</span><span class="ident" id="4045887">inner</span><span class="op" id="4045892">.</span><span class="ident" id="4045893">Size</span><span class="op" id="4045897">(</span><span class="op" id="4045898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4045901">hm</span><span class="op" id="4045903">.</span><span class="ident" id="4045904">blocksize</span>&nbsp;<span class="op" id="4045914">=</span>&nbsp;<span class="ident" id="4045916">hm</span><span class="op" id="4045918">.</span><span class="ident" id="4045919">inner</span><span class="op" id="4045924">.</span><span class="ident" id="4045925">BlockSize</span><span class="op" id="4045934">(</span><span class="op" id="4045935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4045938">hm</span><span class="op" id="4045940">.</span><span class="ident" id="4045941">tmp</span>&nbsp;<span class="op" id="4045945">=</span>&nbsp;<span class="builtinfunc" id="4045947">make</span><span class="op" id="4045951">(</span><span class="op" id="4045952">[</span><span class="op" id="4045953">]</span><span class="builtintype" id="4045954">byte</span><span class="op" id="4045958">,</span>&nbsp;<span class="ident" id="4045960">hm</span><span class="op" id="4045962">.</span><span class="ident" id="4045963">blocksize</span><span class="op" id="4045972">+</span><span class="ident" id="4045973">hm</span><span class="op" id="4045975">.</span><span class="ident" id="4045976">size</span><span class="op" id="4045980">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4045983">if</span>&nbsp;<span class="builtinfunc" id="4045986">len</span><span class="op" id="4045989">(</span><span class="ident" id="4045990">key</span><span class="op" id="4045993">)</span>&nbsp;<span class="op" id="4045995">&gt;</span>&nbsp;<span class="ident" id="4045997">hm</span><span class="op" id="4045999">.</span><span class="ident" id="4046000">blocksize</span>&nbsp;<span class="op" id="4046010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4046014">//&nbsp;If&nbsp;key&nbsp;is&nbsp;too&nbsp;big,&nbsp;hash&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4046047">hm</span><span class="op" id="4046049">.</span><span class="ident" id="4046050">outer</span><span class="op" id="4046055">.</span><span class="ident" id="4046056">Write</span><span class="op" id="4046061">(</span><span class="ident" id="4046062">key</span><span class="op" id="4046065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4046069">key</span>&nbsp;<span class="op" id="4046073">=</span>&nbsp;<span class="ident" id="4046075">hm</span><span class="op" id="4046077">.</span><span class="ident" id="4046078">outer</span><span class="op" id="4046083">.</span><span class="ident" id="4046084">Sum</span><span class="op" id="4046087">(</span><span class="ident" id="4046088">nil</span><span class="op" id="4046091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4046094">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4046097">hm</span><span class="op" id="4046099">.</span><span class="ident" id="4046100">key</span>&nbsp;<span class="op" id="4046104">=</span>&nbsp;<span class="builtinfunc" id="4046106">make</span><span class="op" id="4046110">(</span><span class="op" id="4046111">[</span><span class="op" id="4046112">]</span><span class="builtintype" id="4046113">byte</span><span class="op" id="4046117">,</span>&nbsp;<span class="builtinfunc" id="4046119">len</span><span class="op" id="4046122">(</span><span class="ident" id="4046123">key</span><span class="op" id="4046126">)</span><span class="op" id="4046127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4046130">copy</span><span class="op" id="4046134">(</span><span class="ident" id="4046135">hm</span><span class="op" id="4046137">.</span><span class="ident" id="4046138">key</span><span class="op" id="4046141">,</span>&nbsp;<span class="ident" id="4046143">key</span><span class="op" id="4046146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4046149">hm</span><span class="op" id="4046151">.</span><span class="ident" id="4046152">Reset</span><span class="op" id="4046157">(</span><span class="op" id="4046158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4046161">return</span>&nbsp;<span class="ident" id="4046168">hm</span><br>
<span class="lineno"></span><span class="op" id="4046171">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="4046174">//&nbsp;Equal&nbsp;compares&nbsp;two&nbsp;MACs&nbsp;for&nbsp;equality&nbsp;without&nbsp;leaking&nbsp;timing&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="4046250">func</span>&nbsp;<span class="ident" id="4046255">Equal</span><span class="op" id="4046260">(</span><span class="ident" id="4046261">mac1</span><span class="op" id="4046265">,</span>&nbsp;<span class="ident" id="4046267">mac2</span>&nbsp;<span class="op" id="4046272">[</span><span class="op" id="4046273">]</span><span class="builtintype" id="4046274">byte</span><span class="op" id="4046278">)</span>&nbsp;<span class="builtintype" id="4046280">bool</span>&nbsp;<span class="op" id="4046285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4046288">//&nbsp;We&nbsp;don&#39;t&nbsp;have&nbsp;to&nbsp;be&nbsp;constant&nbsp;time&nbsp;if&nbsp;the&nbsp;lengths&nbsp;of&nbsp;the&nbsp;MACs&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4046357">//&nbsp;different&nbsp;as&nbsp;that&nbsp;suggests&nbsp;that&nbsp;a&nbsp;completely&nbsp;different&nbsp;hash&nbsp;function</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4046430">//&nbsp;was&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4046444">return</span>&nbsp;<span class="builtinfunc" id="4046451">len</span><span class="op" id="4046454">(</span><span class="ident" id="4046455">mac1</span><span class="op" id="4046459">)</span>&nbsp;<span class="op" id="4046461">==</span>&nbsp;<span class="builtinfunc" id="4046464">len</span><span class="op" id="4046467">(</span><span class="ident" id="4046468">mac2</span><span class="op" id="4046472">)</span>&nbsp;<span class="op" id="4046474">&amp;&amp;</span>&nbsp;<span class="ident" id="4046477">subtle</span><span class="op" id="4046483">.</span><span class="ident" id="4046484">ConstantTimeCompare</span><span class="op" id="4046503">(</span><span class="ident" id="4046504">mac1</span><span class="op" id="4046508">,</span>&nbsp;<span class="ident" id="4046510">mac2</span><span class="op" id="4046514">)</span>&nbsp;<span class="op" id="4046516">==</span>&nbsp;<span class="num" id="4046519">1</span><br>
<span class="lineno"></span><span class="op" id="4046521">}</span>
</div>
</body>
</html>
