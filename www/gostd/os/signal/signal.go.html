<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5937570">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5937625">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5937679">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5937730">//&nbsp;Package&nbsp;signal&nbsp;implements&nbsp;access&nbsp;to&nbsp;incoming&nbsp;signals.</span><br>
<span class="lineno"></span><span class="keyword" id="5937787">package</span>&nbsp;<span class="ident" id="5937795">signal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5937803">//&nbsp;BUG(rsc):&nbsp;This&nbsp;package&nbsp;is&nbsp;not&nbsp;yet&nbsp;implemented&nbsp;on&nbsp;Plan&nbsp;9.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5937864">import</span>&nbsp;<span class="op" id="5937871">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5937874">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5937880">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5937887">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="5937890">var</span>&nbsp;<span class="ident" id="5937894">handlers</span>&nbsp;<span class="keyword" id="5937903">struct</span>&nbsp;<span class="op" id="5937910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937913">sync</span><span class="op" id="5937917">.</span><span class="ident" id="5937918">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937925">m</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="5937929">map</span><span class="op" id="5937932">[</span><span class="keyword" id="5937933">chan</span><span class="op" id="5937937">&lt;-</span>&nbsp;<span class="ident" id="5937940">os</span><span class="op" id="5937942">.</span><span class="ident" id="5937943">Signal</span><span class="op" id="5937949">]</span><span class="op" id="5937950">*</span><span class="ident" id="5937951">handler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5937960">ref</span>&nbsp;<span class="op" id="5937964">[</span><span class="ident" id="5937965">numSig</span><span class="op" id="5937971">]</span><span class="ident" id="5937972">int64</span><br>
<span class="lineno"></span><span class="op" id="5937978">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5937981">type</span>&nbsp;<span class="ident" id="5937986">handler</span>&nbsp;<span class="keyword" id="5937994">struct</span>&nbsp;<span class="op" id="5938001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938004">mask</span>&nbsp;<span class="op" id="5938009">[</span><span class="op" id="5938010">(</span><span class="ident" id="5938011">numSig</span>&nbsp;<span class="op" id="5938018">+</span>&nbsp;<span class="num" id="5938020">31</span><span class="op" id="5938022">)</span>&nbsp;<span class="op" id="5938024">/</span>&nbsp;<span class="num" id="5938026">32</span><span class="op" id="5938028">]</span><span class="builtintype" id="5938029">uint32</span><br>
<span class="lineno"></span><span class="op" id="5938036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5938039">func</span>&nbsp;<span class="op" id="5938044">(</span><span class="ident" id="5938045">h</span>&nbsp;<span class="op" id="5938047">*</span><span class="ident" id="5938048">handler</span><span class="op" id="5938055">)</span>&nbsp;<span class="ident" id="5938057">want</span><span class="op" id="5938061">(</span><span class="ident" id="5938062">sig</span>&nbsp;<span class="builtintype" id="5938066">int</span><span class="op" id="5938069">)</span>&nbsp;<span class="builtintype" id="5938071">bool</span>&nbsp;<span class="op" id="5938076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5938079">return</span>&nbsp;<span class="op" id="5938086">(</span><span class="ident" id="5938087">h</span><span class="op" id="5938088">.</span><span class="ident" id="5938089">mask</span><span class="op" id="5938093">[</span><span class="ident" id="5938094">sig</span><span class="op" id="5938097">/</span><span class="num" id="5938098">32</span><span class="op" id="5938100">]</span><span class="op" id="5938101">&gt;&gt;</span><span class="builtintype" id="5938103">uint</span><span class="op" id="5938107">(</span><span class="ident" id="5938108">sig</span><span class="op" id="5938111">&amp;</span><span class="num" id="5938112">31</span><span class="op" id="5938114">)</span><span class="op" id="5938115">)</span><span class="op" id="5938116">&amp;</span><span class="num" id="5938117">1</span>&nbsp;<span class="op" id="5938119">!=</span>&nbsp;<span class="num" id="5938122">0</span><br>
<span class="lineno"></span><span class="op" id="5938124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5938127">func</span>&nbsp;<span class="op" id="5938132">(</span><span class="ident" id="5938133">h</span>&nbsp;<span class="op" id="5938135">*</span><span class="ident" id="5938136">handler</span><span class="op" id="5938143">)</span>&nbsp;<span class="ident" id="5938145">set</span><span class="op" id="5938148">(</span><span class="ident" id="5938149">sig</span>&nbsp;<span class="builtintype" id="5938153">int</span><span class="op" id="5938156">)</span>&nbsp;<span class="op" id="5938158">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5938161">h</span><span class="op" id="5938162">.</span><span class="ident" id="5938163">mask</span><span class="op" id="5938167">[</span><span class="ident" id="5938168">sig</span><span class="op" id="5938171">/</span><span class="num" id="5938172">32</span><span class="op" id="5938174">]</span>&nbsp;<span class="op" id="5938176">|=</span>&nbsp;<span class="num" id="5938179">1</span>&nbsp;<span class="op" id="5938181">&lt;&lt;</span>&nbsp;<span class="builtintype" id="5938184">uint</span><span class="op" id="5938188">(</span><span class="ident" id="5938189">sig</span><span class="op" id="5938192">&amp;</span><span class="num" id="5938193">31</span><span class="op" id="5938195">)</span><br>
<span class="lineno"></span><span class="op" id="5938197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5938200">//&nbsp;Notify&nbsp;causes&nbsp;package&nbsp;signal&nbsp;to&nbsp;relay&nbsp;incoming&nbsp;signals&nbsp;to&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="5938264">//&nbsp;If&nbsp;no&nbsp;signals&nbsp;are&nbsp;listed,&nbsp;all&nbsp;incoming&nbsp;signals&nbsp;will&nbsp;be&nbsp;relayed&nbsp;to&nbsp;c.</span><br>
<span class="lineno">35</span><span class="comment" id="5938336">//&nbsp;Otherwise,&nbsp;just&nbsp;the&nbsp;listed&nbsp;signals&nbsp;will.</span><br>
<span class="lineno"></span><span class="comment" id="5938380">//</span><br>
<span class="lineno"></span><span class="comment" id="5938383">//&nbsp;Package&nbsp;signal&nbsp;will&nbsp;not&nbsp;block&nbsp;sending&nbsp;to&nbsp;c:&nbsp;the&nbsp;caller&nbsp;must&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="5938453">//&nbsp;that&nbsp;c&nbsp;has&nbsp;sufficient&nbsp;buffer&nbsp;space&nbsp;to&nbsp;keep&nbsp;up&nbsp;with&nbsp;the&nbsp;expected</span><br>
<span class="lineno"></span><span class="comment" id="5938520">//&nbsp;signal&nbsp;rate.&nbsp;&nbsp;For&nbsp;a&nbsp;channel&nbsp;used&nbsp;for&nbsp;notification&nbsp;of&nbsp;just&nbsp;one&nbsp;signal&nbsp;value,</span><br>
<span class="lineno">40</span><span class="comment" id="5938599">//&nbsp;a&nbsp;buffer&nbsp;of&nbsp;size&nbsp;1&nbsp;is&nbsp;sufficient.</span><br>
<span class="lineno"></span><span class="comment" id="5938636">//</span><br>
<span class="lineno"></span><span class="comment" id="5938639">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;Notify&nbsp;multiple&nbsp;times&nbsp;with&nbsp;the&nbsp;same&nbsp;channel:</span><br>
<span class="lineno"></span><span class="comment" id="5938709">//&nbsp;each&nbsp;call&nbsp;expands&nbsp;the&nbsp;set&nbsp;of&nbsp;signals&nbsp;sent&nbsp;to&nbsp;that&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="5938771">//&nbsp;The&nbsp;only&nbsp;way&nbsp;to&nbsp;remove&nbsp;signals&nbsp;from&nbsp;the&nbsp;set&nbsp;is&nbsp;to&nbsp;call&nbsp;Stop.</span><br>
<span class="lineno">45</span><span class="comment" id="5938835">//</span><br>
<span class="lineno"></span><span class="comment" id="5938838">//&nbsp;It&nbsp;is&nbsp;allowed&nbsp;to&nbsp;call&nbsp;Notify&nbsp;multiple&nbsp;times&nbsp;with&nbsp;different&nbsp;channels</span><br>
<span class="lineno"></span><span class="comment" id="5938909">//&nbsp;and&nbsp;the&nbsp;same&nbsp;signals:&nbsp;each&nbsp;channel&nbsp;receives&nbsp;copies&nbsp;of&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="5938975">//&nbsp;signals&nbsp;independently.</span><br>
<span class="lineno"></span><span class="keyword" id="5939001">func</span>&nbsp;<span class="ident" id="5939006">Notify</span><span class="op" id="5939012">(</span><span class="ident" id="5939013">c</span>&nbsp;<span class="keyword" id="5939015">chan</span><span class="op" id="5939019">&lt;-</span>&nbsp;<span class="ident" id="5939022">os</span><span class="op" id="5939024">.</span><span class="ident" id="5939025">Signal</span><span class="op" id="5939031">,</span>&nbsp;<span class="ident" id="5939033">sig</span>&nbsp;<span class="op" id="5939037">...</span><span class="ident" id="5939040">os</span><span class="op" id="5939042">.</span><span class="ident" id="5939043">Signal</span><span class="op" id="5939049">)</span>&nbsp;<span class="op" id="5939051">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939054">if</span>&nbsp;<span class="ident" id="5939057">c</span>&nbsp;<span class="op" id="5939059">==</span>&nbsp;<span class="ident" id="5939062">nil</span>&nbsp;<span class="op" id="5939066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5939070">panic</span><span class="op" id="5939075">(</span><span class="string" id="5939076">&#34;os/signal:&nbsp;Notify&nbsp;using&nbsp;nil&nbsp;channel&#34;</span><span class="op" id="5939113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5939116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939120">handlers</span><span class="op" id="5939128">.</span><span class="ident" id="5939129">Lock</span><span class="op" id="5939133">(</span><span class="op" id="5939134">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939137">defer</span>&nbsp;<span class="ident" id="5939143">handlers</span><span class="op" id="5939151">.</span><span class="ident" id="5939152">Unlock</span><span class="op" id="5939158">(</span><span class="op" id="5939159">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939163">h</span>&nbsp;<span class="op" id="5939165">:=</span>&nbsp;<span class="ident" id="5939168">handlers</span><span class="op" id="5939176">.</span><span class="ident" id="5939177">m</span><span class="op" id="5939178">[</span><span class="ident" id="5939179">c</span><span class="op" id="5939180">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939183">if</span>&nbsp;<span class="ident" id="5939186">h</span>&nbsp;<span class="op" id="5939188">==</span>&nbsp;<span class="ident" id="5939191">nil</span>&nbsp;<span class="op" id="5939195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939199">if</span>&nbsp;<span class="ident" id="5939202">handlers</span><span class="op" id="5939210">.</span><span class="ident" id="5939211">m</span>&nbsp;<span class="op" id="5939213">==</span>&nbsp;<span class="ident" id="5939216">nil</span>&nbsp;<span class="op" id="5939220">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939225">handlers</span><span class="op" id="5939233">.</span><span class="ident" id="5939234">m</span>&nbsp;<span class="op" id="5939236">=</span>&nbsp;<span class="builtinfunc" id="5939238">make</span><span class="op" id="5939242">(</span><span class="keyword" id="5939243">map</span><span class="op" id="5939246">[</span><span class="keyword" id="5939247">chan</span><span class="op" id="5939251">&lt;-</span>&nbsp;<span class="ident" id="5939254">os</span><span class="op" id="5939256">.</span><span class="ident" id="5939257">Signal</span><span class="op" id="5939263">]</span><span class="op" id="5939264">*</span><span class="ident" id="5939265">handler</span><span class="op" id="5939272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5939276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939280">h</span>&nbsp;<span class="op" id="5939282">=</span>&nbsp;<span class="builtinfunc" id="5939284">new</span><span class="op" id="5939287">(</span><span class="ident" id="5939288">handler</span><span class="op" id="5939295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939299">handlers</span><span class="op" id="5939307">.</span><span class="ident" id="5939308">m</span><span class="op" id="5939309">[</span><span class="ident" id="5939310">c</span><span class="op" id="5939311">]</span>&nbsp;<span class="op" id="5939313">=</span>&nbsp;<span class="ident" id="5939315">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5939318">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939322">add</span>&nbsp;<span class="op" id="5939326">:=</span>&nbsp;<span class="keyword" id="5939329">func</span><span class="op" id="5939333">(</span><span class="ident" id="5939334">n</span>&nbsp;<span class="builtintype" id="5939336">int</span><span class="op" id="5939339">)</span>&nbsp;<span class="op" id="5939341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939345">if</span>&nbsp;<span class="ident" id="5939348">n</span>&nbsp;<span class="op" id="5939350">&lt;</span>&nbsp;<span class="num" id="5939352">0</span>&nbsp;<span class="op" id="5939354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939359">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5939368">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939372">if</span>&nbsp;<span class="op" id="5939375">!</span><span class="ident" id="5939376">h</span><span class="op" id="5939377">.</span><span class="ident" id="5939378">want</span><span class="op" id="5939382">(</span><span class="ident" id="5939383">n</span><span class="op" id="5939384">)</span>&nbsp;<span class="op" id="5939386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939391">h</span><span class="op" id="5939392">.</span><span class="ident" id="5939393">set</span><span class="op" id="5939396">(</span><span class="ident" id="5939397">n</span><span class="op" id="5939398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939403">if</span>&nbsp;<span class="ident" id="5939406">handlers</span><span class="op" id="5939414">.</span><span class="ident" id="5939415">ref</span><span class="op" id="5939418">[</span><span class="ident" id="5939419">n</span><span class="op" id="5939420">]</span>&nbsp;<span class="op" id="5939422">==</span>&nbsp;<span class="num" id="5939425">0</span>&nbsp;<span class="op" id="5939427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939433">enableSignal</span><span class="op" id="5939445">(</span><span class="ident" id="5939446">n</span><span class="op" id="5939447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5939452">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939457">handlers</span><span class="op" id="5939465">.</span><span class="ident" id="5939466">ref</span><span class="op" id="5939469">[</span><span class="ident" id="5939470">n</span><span class="op" id="5939471">]</span><span class="op" id="5939472">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5939477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5939480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939484">if</span>&nbsp;<span class="builtinfunc" id="5939487">len</span><span class="op" id="5939490">(</span><span class="ident" id="5939491">sig</span><span class="op" id="5939494">)</span>&nbsp;<span class="op" id="5939496">==</span>&nbsp;<span class="num" id="5939499">0</span>&nbsp;<span class="op" id="5939501">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939505">for</span>&nbsp;<span class="ident" id="5939509">n</span>&nbsp;<span class="op" id="5939511">:=</span>&nbsp;<span class="num" id="5939514">0</span><span class="op" id="5939515">;</span>&nbsp;<span class="ident" id="5939517">n</span>&nbsp;<span class="op" id="5939519">&lt;</span>&nbsp;<span class="ident" id="5939521">numSig</span><span class="op" id="5939527">;</span>&nbsp;<span class="ident" id="5939529">n</span><span class="op" id="5939530">++</span>&nbsp;<span class="op" id="5939533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939538">add</span><span class="op" id="5939541">(</span><span class="ident" id="5939542">n</span><span class="op" id="5939543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5939547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5939550">}</span>&nbsp;<span class="keyword" id="5939552">else</span>&nbsp;<span class="op" id="5939557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939561">for</span>&nbsp;<span class="ident" id="5939565">_</span><span class="op" id="5939566">,</span>&nbsp;<span class="ident" id="5939568">s</span>&nbsp;<span class="op" id="5939570">:=</span>&nbsp;<span class="keyword" id="5939573">range</span>&nbsp;<span class="ident" id="5939579">sig</span>&nbsp;<span class="op" id="5939583">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939588">add</span><span class="op" id="5939591">(</span><span class="ident" id="5939592">signum</span><span class="op" id="5939598">(</span><span class="ident" id="5939599">s</span><span class="op" id="5939600">)</span><span class="op" id="5939601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5939605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5939608">}</span><br>
<span class="lineno"></span><span class="op" id="5939610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="5939613">//&nbsp;Stop&nbsp;causes&nbsp;package&nbsp;signal&nbsp;to&nbsp;stop&nbsp;relaying&nbsp;incoming&nbsp;signals&nbsp;to&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="5939683">//&nbsp;It&nbsp;undoes&nbsp;the&nbsp;effect&nbsp;of&nbsp;all&nbsp;prior&nbsp;calls&nbsp;to&nbsp;Notify&nbsp;using&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="5939745">//&nbsp;When&nbsp;Stop&nbsp;returns,&nbsp;it&nbsp;is&nbsp;guaranteed&nbsp;that&nbsp;c&nbsp;will&nbsp;receive&nbsp;no&nbsp;more&nbsp;signals.</span><br>
<span class="lineno"></span><span class="keyword" id="5939821">func</span>&nbsp;<span class="ident" id="5939826">Stop</span><span class="op" id="5939830">(</span><span class="ident" id="5939831">c</span>&nbsp;<span class="keyword" id="5939833">chan</span><span class="op" id="5939837">&lt;-</span>&nbsp;<span class="ident" id="5939840">os</span><span class="op" id="5939842">.</span><span class="ident" id="5939843">Signal</span><span class="op" id="5939849">)</span>&nbsp;<span class="op" id="5939851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939854">handlers</span><span class="op" id="5939862">.</span><span class="ident" id="5939863">Lock</span><span class="op" id="5939867">(</span><span class="op" id="5939868">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939871">defer</span>&nbsp;<span class="ident" id="5939877">handlers</span><span class="op" id="5939885">.</span><span class="ident" id="5939886">Unlock</span><span class="op" id="5939892">(</span><span class="op" id="5939893">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5939897">h</span>&nbsp;<span class="op" id="5939899">:=</span>&nbsp;<span class="ident" id="5939902">handlers</span><span class="op" id="5939910">.</span><span class="ident" id="5939911">m</span><span class="op" id="5939912">[</span><span class="ident" id="5939913">c</span><span class="op" id="5939914">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939917">if</span>&nbsp;<span class="ident" id="5939920">h</span>&nbsp;<span class="op" id="5939922">==</span>&nbsp;<span class="ident" id="5939925">nil</span>&nbsp;<span class="op" id="5939929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939933">return</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5939941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5939944">delete</span><span class="op" id="5939950">(</span><span class="ident" id="5939951">handlers</span><span class="op" id="5939959">.</span><span class="ident" id="5939960">m</span><span class="op" id="5939961">,</span>&nbsp;<span class="ident" id="5939963">c</span><span class="op" id="5939964">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5939968">for</span>&nbsp;<span class="ident" id="5939972">n</span>&nbsp;<span class="op" id="5939974">:=</span>&nbsp;<span class="num" id="5939977">0</span><span class="op" id="5939978">;</span>&nbsp;<span class="ident" id="5939980">n</span>&nbsp;<span class="op" id="5939982">&lt;</span>&nbsp;<span class="ident" id="5939984">numSig</span><span class="op" id="5939990">;</span>&nbsp;<span class="ident" id="5939992">n</span><span class="op" id="5939993">++</span>&nbsp;<span class="op" id="5939996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940000">if</span>&nbsp;<span class="ident" id="5940003">h</span><span class="op" id="5940004">.</span><span class="ident" id="5940005">want</span><span class="op" id="5940009">(</span><span class="ident" id="5940010">n</span><span class="op" id="5940011">)</span>&nbsp;<span class="op" id="5940013">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940018">handlers</span><span class="op" id="5940026">.</span><span class="ident" id="5940027">ref</span><span class="op" id="5940030">[</span><span class="ident" id="5940031">n</span><span class="op" id="5940032">]</span><span class="op" id="5940033">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940039">if</span>&nbsp;<span class="ident" id="5940042">handlers</span><span class="op" id="5940050">.</span><span class="ident" id="5940051">ref</span><span class="op" id="5940054">[</span><span class="ident" id="5940055">n</span><span class="op" id="5940056">]</span>&nbsp;<span class="op" id="5940058">==</span>&nbsp;<span class="num" id="5940061">0</span>&nbsp;<span class="op" id="5940063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940069">disableSignal</span><span class="op" id="5940082">(</span><span class="ident" id="5940083">n</span><span class="op" id="5940084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5940089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5940093">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5940096">}</span><br>
<span class="lineno"></span><span class="op" id="5940098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5940101">func</span>&nbsp;<span class="ident" id="5940106">process</span><span class="op" id="5940113">(</span><span class="ident" id="5940114">sig</span>&nbsp;<span class="ident" id="5940118">os</span><span class="op" id="5940120">.</span><span class="ident" id="5940121">Signal</span><span class="op" id="5940127">)</span>&nbsp;<span class="op" id="5940129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940132">n</span>&nbsp;<span class="op" id="5940134">:=</span>&nbsp;<span class="ident" id="5940137">signum</span><span class="op" id="5940143">(</span><span class="ident" id="5940144">sig</span><span class="op" id="5940147">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940150">if</span>&nbsp;<span class="ident" id="5940153">n</span>&nbsp;<span class="op" id="5940155">&lt;</span>&nbsp;<span class="num" id="5940157">0</span>&nbsp;<span class="op" id="5940159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940163">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5940171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5940175">handlers</span><span class="op" id="5940183">.</span><span class="ident" id="5940184">Lock</span><span class="op" id="5940188">(</span><span class="op" id="5940189">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940192">defer</span>&nbsp;<span class="ident" id="5940198">handlers</span><span class="op" id="5940206">.</span><span class="ident" id="5940207">Unlock</span><span class="op" id="5940213">(</span><span class="op" id="5940214">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940218">for</span>&nbsp;<span class="ident" id="5940222">c</span><span class="op" id="5940223">,</span>&nbsp;<span class="ident" id="5940225">h</span>&nbsp;<span class="op" id="5940227">:=</span>&nbsp;<span class="keyword" id="5940230">range</span>&nbsp;<span class="ident" id="5940236">handlers</span><span class="op" id="5940244">.</span><span class="ident" id="5940245">m</span>&nbsp;<span class="op" id="5940247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940251">if</span>&nbsp;<span class="ident" id="5940254">h</span><span class="op" id="5940255">.</span><span class="ident" id="5940256">want</span><span class="op" id="5940260">(</span><span class="ident" id="5940261">n</span><span class="op" id="5940262">)</span>&nbsp;<span class="op" id="5940264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5940269">//&nbsp;send&nbsp;but&nbsp;do&nbsp;not&nbsp;block&nbsp;for&nbsp;it</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940304">select</span>&nbsp;<span class="op" id="5940311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940316">case</span>&nbsp;<span class="ident" id="5940321">c</span>&nbsp;<span class="op" id="5940323">&lt;-</span>&nbsp;<span class="ident" id="5940326">sig</span><span class="op" id="5940329">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5940334">default</span><span class="op" id="5940341">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5940346">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5940350">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5940353">}</span><br>
<span class="lineno"></span><span class="op" id="5940355">}</span>
</div>
</body>
</html>
