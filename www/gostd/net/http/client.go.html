<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html" class="current">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1329532">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1329587">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1329641">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="1329692">//&nbsp;HTTP&nbsp;client.&nbsp;See&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="comment" id="1329722">//</span><br>
<span class="lineno"></span><span class="comment" id="1329725">//&nbsp;This&nbsp;is&nbsp;the&nbsp;high-level&nbsp;Client&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="1329769">//&nbsp;The&nbsp;low-level&nbsp;implementation&nbsp;is&nbsp;in&nbsp;transport.go.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="1329822">package</span>&nbsp;<span class="ident" id="1329830">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1329836">import</span>&nbsp;<span class="op" id="1329843">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329846">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329865">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329875">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329882">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329888">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329901">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329908">&#34;net/url&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329919">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329930">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1329938">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="1329945">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="1329948">//&nbsp;A&nbsp;Client&nbsp;is&nbsp;an&nbsp;HTTP&nbsp;client.&nbsp;Its&nbsp;zero&nbsp;value&nbsp;(DefaultClient)&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1330015">//&nbsp;usable&nbsp;client&nbsp;that&nbsp;uses&nbsp;DefaultTransport.</span><br>
<span class="lineno"></span><span class="comment" id="1330060">//</span><br>
<span class="lineno"></span><span class="comment" id="1330063">//&nbsp;The&nbsp;Client&#39;s&nbsp;Transport&nbsp;typically&nbsp;has&nbsp;internal&nbsp;state&nbsp;(cached&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="1330130">//&nbsp;connections),&nbsp;so&nbsp;Clients&nbsp;should&nbsp;be&nbsp;reused&nbsp;instead&nbsp;of&nbsp;created&nbsp;as</span><br>
<span class="lineno">30</span><span class="comment" id="1330197">//&nbsp;needed.&nbsp;Clients&nbsp;are&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="1330268">//</span><br>
<span class="lineno"></span><span class="comment" id="1330271">//&nbsp;A&nbsp;Client&nbsp;is&nbsp;higher-level&nbsp;than&nbsp;a&nbsp;RoundTripper&nbsp;(such&nbsp;as&nbsp;Transport)</span><br>
<span class="lineno"></span><span class="comment" id="1330339">//&nbsp;and&nbsp;additionally&nbsp;handles&nbsp;HTTP&nbsp;details&nbsp;such&nbsp;as&nbsp;cookies&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="1330400">//&nbsp;redirects.</span><br>
<span class="lineno">35</span><span class="keyword" id="1330414">type</span>&nbsp;<span class="ident" id="1330419">Client</span>&nbsp;<span class="keyword" id="1330426">struct</span>&nbsp;<span class="op" id="1330433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330436">//&nbsp;Transport&nbsp;specifies&nbsp;the&nbsp;mechanism&nbsp;by&nbsp;which&nbsp;individual</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330494">//&nbsp;HTTP&nbsp;requests&nbsp;are&nbsp;made.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330522">//&nbsp;If&nbsp;nil,&nbsp;DefaultTransport&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1330560">Transport</span>&nbsp;<span class="ident" id="1330570">RoundTripper</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330585">//&nbsp;CheckRedirect&nbsp;specifies&nbsp;the&nbsp;policy&nbsp;for&nbsp;handling&nbsp;redirects.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330648">//&nbsp;If&nbsp;CheckRedirect&nbsp;is&nbsp;not&nbsp;nil,&nbsp;the&nbsp;client&nbsp;calls&nbsp;it&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330708">//&nbsp;following&nbsp;an&nbsp;HTTP&nbsp;redirect.&nbsp;The&nbsp;arguments&nbsp;req&nbsp;and&nbsp;via&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330770">//&nbsp;the&nbsp;upcoming&nbsp;request&nbsp;and&nbsp;the&nbsp;requests&nbsp;made&nbsp;already,&nbsp;oldest</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330833">//&nbsp;first.&nbsp;If&nbsp;CheckRedirect&nbsp;returns&nbsp;an&nbsp;error,&nbsp;the&nbsp;Client&#39;s&nbsp;Get</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330896">//&nbsp;method&nbsp;returns&nbsp;both&nbsp;the&nbsp;previous&nbsp;Response&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1330946">//&nbsp;CheckRedirect&#39;s&nbsp;error&nbsp;(wrapped&nbsp;in&nbsp;a&nbsp;url.Error)&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331008">//&nbsp;issuing&nbsp;the&nbsp;Request&nbsp;req.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331037">//</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331041">//&nbsp;If&nbsp;CheckRedirect&nbsp;is&nbsp;nil,&nbsp;the&nbsp;Client&nbsp;uses&nbsp;its&nbsp;default&nbsp;policy,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331106">//&nbsp;which&nbsp;is&nbsp;to&nbsp;stop&nbsp;after&nbsp;10&nbsp;consecutive&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331158">CheckRedirect</span>&nbsp;<span class="keyword" id="1331172">func</span><span class="op" id="1331176">(</span><span class="ident" id="1331177">req</span>&nbsp;<span class="op" id="1331181">*</span><span class="ident" id="1331182">Request</span><span class="op" id="1331189">,</span>&nbsp;<span class="ident" id="1331191">via</span>&nbsp;<span class="op" id="1331195">[</span><span class="op" id="1331196">]</span><span class="op" id="1331197">*</span><span class="ident" id="1331198">Request</span><span class="op" id="1331205">)</span>&nbsp;<span class="builtintype" id="1331207">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331215">//&nbsp;Jar&nbsp;specifies&nbsp;the&nbsp;cookie&nbsp;jar.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331249">//&nbsp;If&nbsp;Jar&nbsp;is&nbsp;nil,&nbsp;cookies&nbsp;are&nbsp;not&nbsp;sent&nbsp;in&nbsp;requests&nbsp;and&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331313">//&nbsp;in&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331331">Jar</span>&nbsp;<span class="ident" id="1331335">CookieJar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331347">//&nbsp;Timeout&nbsp;specifies&nbsp;a&nbsp;time&nbsp;limit&nbsp;for&nbsp;requests&nbsp;made&nbsp;by&nbsp;this</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331408">//&nbsp;Client.&nbsp;The&nbsp;timeout&nbsp;includes&nbsp;connection&nbsp;time,&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331462">//&nbsp;redirects,&nbsp;and&nbsp;reading&nbsp;the&nbsp;response&nbsp;body.&nbsp;The&nbsp;timer&nbsp;remains</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331526">//&nbsp;running&nbsp;after&nbsp;Get,&nbsp;Head,&nbsp;Post,&nbsp;or&nbsp;Do&nbsp;return&nbsp;and&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331583">//&nbsp;interrupt&nbsp;reading&nbsp;of&nbsp;the&nbsp;Response.Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331627">//</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331631">//&nbsp;A&nbsp;Timeout&nbsp;of&nbsp;zero&nbsp;means&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331671">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331675">//&nbsp;The&nbsp;Client&#39;s&nbsp;Transport&nbsp;must&nbsp;support&nbsp;the&nbsp;CancelRequest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331733">//&nbsp;method&nbsp;or&nbsp;Client&nbsp;will&nbsp;return&nbsp;errors&nbsp;when&nbsp;attempting&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331797">//&nbsp;a&nbsp;request&nbsp;with&nbsp;Get,&nbsp;Head,&nbsp;Post,&nbsp;or&nbsp;Do.&nbsp;Client&#39;s&nbsp;default</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1331857">//&nbsp;Transport&nbsp;(DefaultTransport)&nbsp;supports&nbsp;CancelRequest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1331914">Timeout</span>&nbsp;<span class="ident" id="1331922">time</span><span class="op" id="1331926">.</span><span class="ident" id="1331927">Duration</span><br>
<span class="lineno"></span><span class="op" id="1331936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1331939">//&nbsp;DefaultClient&nbsp;is&nbsp;the&nbsp;default&nbsp;Client&nbsp;and&nbsp;is&nbsp;used&nbsp;by&nbsp;Get,&nbsp;Head,&nbsp;and&nbsp;Post.</span><br>
<span class="lineno">75</span><span class="keyword" id="1332014">var</span>&nbsp;<span class="ident" id="1332018">DefaultClient</span>&nbsp;<span class="op" id="1332032">=</span>&nbsp;<span class="op" id="1332034">&amp;</span><span class="ident" id="1332035">Client</span><span class="op" id="1332041">{</span><span class="op" id="1332042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1332045">//&nbsp;RoundTripper&nbsp;is&nbsp;an&nbsp;interface&nbsp;representing&nbsp;the&nbsp;ability&nbsp;to&nbsp;execute&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1332115">//&nbsp;single&nbsp;HTTP&nbsp;transaction,&nbsp;obtaining&nbsp;the&nbsp;Response&nbsp;for&nbsp;a&nbsp;given&nbsp;Request.</span><br>
<span class="lineno"></span><span class="comment" id="1332187">//</span><br>
<span class="lineno">80</span><span class="comment" id="1332190">//&nbsp;A&nbsp;RoundTripper&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple</span><br>
<span class="lineno"></span><span class="comment" id="1332252">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="1332267">type</span>&nbsp;<span class="ident" id="1332272">RoundTripper</span>&nbsp;<span class="keyword" id="1332285">interface</span>&nbsp;<span class="op" id="1332295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332298">//&nbsp;RoundTrip&nbsp;executes&nbsp;a&nbsp;single&nbsp;HTTP&nbsp;transaction,&nbsp;returning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332358">//&nbsp;the&nbsp;Response&nbsp;for&nbsp;the&nbsp;request&nbsp;req.&nbsp;&nbsp;RoundTrip&nbsp;should&nbsp;not</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332418">//&nbsp;attempt&nbsp;to&nbsp;interpret&nbsp;the&nbsp;response.&nbsp;&nbsp;In&nbsp;particular,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332473">//&nbsp;RoundTrip&nbsp;must&nbsp;return&nbsp;err&nbsp;==&nbsp;nil&nbsp;if&nbsp;it&nbsp;obtained&nbsp;a&nbsp;response,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332537">//&nbsp;regardless&nbsp;of&nbsp;the&nbsp;response&#39;s&nbsp;HTTP&nbsp;status&nbsp;code.&nbsp;&nbsp;A&nbsp;non-nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332599">//&nbsp;err&nbsp;should&nbsp;be&nbsp;reserved&nbsp;for&nbsp;failure&nbsp;to&nbsp;obtain&nbsp;a&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332660">//&nbsp;Similarly,&nbsp;RoundTrip&nbsp;should&nbsp;not&nbsp;attempt&nbsp;to&nbsp;handle</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332714">//&nbsp;higher-level&nbsp;protocol&nbsp;details&nbsp;such&nbsp;as&nbsp;redirects,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332767">//&nbsp;authentication,&nbsp;or&nbsp;cookies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332799">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332803">//&nbsp;RoundTrip&nbsp;should&nbsp;not&nbsp;modify&nbsp;the&nbsp;request,&nbsp;except&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332859">//&nbsp;consuming&nbsp;and&nbsp;closing&nbsp;the&nbsp;Body,&nbsp;including&nbsp;on&nbsp;errors.&nbsp;The</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332920">//&nbsp;request&#39;s&nbsp;URL&nbsp;and&nbsp;Header&nbsp;fields&nbsp;are&nbsp;guaranteed&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1332977">//&nbsp;initialized.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1332994">RoundTrip</span><span class="op" id="1333003">(</span><span class="op" id="1333004">*</span><span class="ident" id="1333005">Request</span><span class="op" id="1333012">)</span>&nbsp;<span class="op" id="1333014">(</span><span class="op" id="1333015">*</span><span class="ident" id="1333016">Response</span><span class="op" id="1333024">,</span>&nbsp;<span class="builtintype" id="1333026">error</span><span class="op" id="1333031">)</span><br>
<span class="lineno"></span><span class="op" id="1333033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="1333036">//&nbsp;Given&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host&#34;,&nbsp;&#34;host:port&#34;,&nbsp;or&nbsp;&#34;[ipv6::address]:port&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="1333114">//&nbsp;return&nbsp;true&nbsp;if&nbsp;the&nbsp;string&nbsp;includes&nbsp;a&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="1333160">func</span>&nbsp;<span class="ident" id="1333165">hasPort</span><span class="op" id="1333172">(</span><span class="ident" id="1333173">s</span>&nbsp;<span class="builtintype" id="1333175">string</span><span class="op" id="1333181">)</span>&nbsp;<span class="builtintype" id="1333183">bool</span>&nbsp;<span class="op" id="1333188">{</span>&nbsp;<span class="keyword" id="1333190">return</span>&nbsp;<span class="ident" id="1333197">strings</span><span class="op" id="1333204">.</span><span class="ident" id="1333205">LastIndex</span><span class="op" id="1333214">(</span><span class="ident" id="1333215">s</span><span class="op" id="1333216">,</span>&nbsp;<span class="string" id="1333218">&#34;:&#34;</span><span class="op" id="1333221">)</span>&nbsp;<span class="op" id="1333223">&gt;</span>&nbsp;<span class="ident" id="1333225">strings</span><span class="op" id="1333232">.</span><span class="ident" id="1333233">LastIndex</span><span class="op" id="1333242">(</span><span class="ident" id="1333243">s</span><span class="op" id="1333244">,</span>&nbsp;<span class="string" id="1333246">&#34;]&#34;</span><span class="op" id="1333249">)</span>&nbsp;<span class="op" id="1333251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1333254">//&nbsp;refererForURL&nbsp;returns&nbsp;a&nbsp;referer&nbsp;without&nbsp;any&nbsp;authentication&nbsp;info&nbsp;or</span><br>
<span class="lineno">105</span><span class="comment" id="1333324">//&nbsp;an&nbsp;empty&nbsp;string&nbsp;if&nbsp;lastReq&nbsp;scheme&nbsp;is&nbsp;https&nbsp;and&nbsp;newReq&nbsp;scheme&nbsp;is&nbsp;http.</span><br>
<span class="lineno"></span><span class="keyword" id="1333397">func</span>&nbsp;<span class="ident" id="1333402">refererForURL</span><span class="op" id="1333415">(</span><span class="ident" id="1333416">lastReq</span><span class="op" id="1333423">,</span>&nbsp;<span class="ident" id="1333425">newReq</span>&nbsp;<span class="op" id="1333432">*</span><span class="ident" id="1333433">url</span><span class="op" id="1333436">.</span><span class="ident" id="1333437">URL</span><span class="op" id="1333440">)</span>&nbsp;<span class="builtintype" id="1333442">string</span>&nbsp;<span class="op" id="1333449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1333452">//&nbsp;https://tools.ietf.org/html/rfc7231#section-5.5.2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1333506">//&nbsp;&nbsp;&nbsp;&#34;Clients&nbsp;SHOULD&nbsp;NOT&nbsp;include&nbsp;a&nbsp;Referer&nbsp;header&nbsp;field&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1333568">//&nbsp;&nbsp;&nbsp;&nbsp;(non-secure)&nbsp;HTTP&nbsp;request&nbsp;if&nbsp;the&nbsp;referring&nbsp;page&nbsp;was</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1333627">//&nbsp;&nbsp;&nbsp;&nbsp;transferred&nbsp;with&nbsp;a&nbsp;secure&nbsp;protocol.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333671">if</span>&nbsp;<span class="ident" id="1333674">lastReq</span><span class="op" id="1333681">.</span><span class="ident" id="1333682">Scheme</span>&nbsp;<span class="op" id="1333689">==</span>&nbsp;<span class="string" id="1333692">&#34;https&#34;</span>&nbsp;<span class="op" id="1333700">&amp;&amp;</span>&nbsp;<span class="ident" id="1333703">newReq</span><span class="op" id="1333709">.</span><span class="ident" id="1333710">Scheme</span>&nbsp;<span class="op" id="1333717">==</span>&nbsp;<span class="string" id="1333720">&#34;http&#34;</span>&nbsp;<span class="op" id="1333727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333731">return</span>&nbsp;<span class="string" id="1333738">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1333742">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1333745">referer</span>&nbsp;<span class="op" id="1333753">:=</span>&nbsp;<span class="ident" id="1333756">lastReq</span><span class="op" id="1333763">.</span><span class="ident" id="1333764">String</span><span class="op" id="1333770">(</span><span class="op" id="1333771">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1333774">if</span>&nbsp;<span class="ident" id="1333777">lastReq</span><span class="op" id="1333784">.</span><span class="ident" id="1333785">User</span>&nbsp;<span class="op" id="1333790">!=</span>&nbsp;<span class="ident" id="1333793">nil</span>&nbsp;<span class="op" id="1333797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1333801">//&nbsp;This&nbsp;is&nbsp;not&nbsp;very&nbsp;efficient,&nbsp;but&nbsp;is&nbsp;the&nbsp;best&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1333857">//&nbsp;do&nbsp;without:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1333874">//&nbsp;-&nbsp;introducing&nbsp;a&nbsp;new&nbsp;method&nbsp;on&nbsp;URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1333913">//&nbsp;-&nbsp;creating&nbsp;a&nbsp;race&nbsp;condition</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1333946">//&nbsp;-&nbsp;copying&nbsp;the&nbsp;URL&nbsp;struct&nbsp;manually,&nbsp;which&nbsp;would&nbsp;cause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1334004">//&nbsp;&nbsp;&nbsp;maintenance&nbsp;problems&nbsp;down&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334046">auth</span>&nbsp;<span class="op" id="1334051">:=</span>&nbsp;<span class="ident" id="1334054">lastReq</span><span class="op" id="1334061">.</span><span class="ident" id="1334062">User</span><span class="op" id="1334066">.</span><span class="ident" id="1334067">String</span><span class="op" id="1334073">(</span><span class="op" id="1334074">)</span>&nbsp;<span class="op" id="1334076">+</span>&nbsp;<span class="string" id="1334078">&#34;@&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334084">referer</span>&nbsp;<span class="op" id="1334092">=</span>&nbsp;<span class="ident" id="1334094">strings</span><span class="op" id="1334101">.</span><span class="ident" id="1334102">Replace</span><span class="op" id="1334109">(</span><span class="ident" id="1334110">referer</span><span class="op" id="1334117">,</span>&nbsp;<span class="ident" id="1334119">auth</span><span class="op" id="1334123">,</span>&nbsp;<span class="string" id="1334125">&#34;&#34;</span><span class="op" id="1334127">,</span>&nbsp;<span class="num" id="1334129">1</span><span class="op" id="1334130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1334133">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334136">return</span>&nbsp;<span class="ident" id="1334143">referer</span><br>
<span class="lineno"></span><span class="op" id="1334151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1334154">//&nbsp;Used&nbsp;in&nbsp;Send&nbsp;to&nbsp;implement&nbsp;io.ReadCloser&nbsp;by&nbsp;bundling&nbsp;together&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1334222">//&nbsp;bufio.Reader&nbsp;through&nbsp;which&nbsp;we&nbsp;read&nbsp;the&nbsp;response,&nbsp;and&nbsp;the&nbsp;underlying</span><br>
<span class="lineno">130</span><span class="comment" id="1334293">//&nbsp;network&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="1334316">type</span>&nbsp;<span class="ident" id="1334321">readClose</span>&nbsp;<span class="keyword" id="1334331">struct</span>&nbsp;<span class="op" id="1334338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334341">io</span><span class="op" id="1334343">.</span><span class="ident" id="1334344">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334352">io</span><span class="op" id="1334354">.</span><span class="ident" id="1334355">Closer</span><br>
<span class="lineno"></span><span class="op" id="1334362">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="1334365">func</span>&nbsp;<span class="op" id="1334370">(</span><span class="ident" id="1334371">c</span>&nbsp;<span class="op" id="1334373">*</span><span class="ident" id="1334374">Client</span><span class="op" id="1334380">)</span>&nbsp;<span class="ident" id="1334382">send</span><span class="op" id="1334386">(</span><span class="ident" id="1334387">req</span>&nbsp;<span class="op" id="1334391">*</span><span class="ident" id="1334392">Request</span><span class="op" id="1334399">)</span>&nbsp;<span class="op" id="1334401">(</span><span class="op" id="1334402">*</span><span class="ident" id="1334403">Response</span><span class="op" id="1334411">,</span>&nbsp;<span class="builtintype" id="1334413">error</span><span class="op" id="1334418">)</span>&nbsp;<span class="op" id="1334420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334423">if</span>&nbsp;<span class="ident" id="1334426">c</span><span class="op" id="1334427">.</span><span class="ident" id="1334428">Jar</span>&nbsp;<span class="op" id="1334432">!=</span>&nbsp;<span class="ident" id="1334435">nil</span>&nbsp;<span class="op" id="1334439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334443">for</span>&nbsp;<span class="ident" id="1334447">_</span><span class="op" id="1334448">,</span>&nbsp;<span class="ident" id="1334450">cookie</span>&nbsp;<span class="op" id="1334457">:=</span>&nbsp;<span class="keyword" id="1334460">range</span>&nbsp;<span class="ident" id="1334466">c</span><span class="op" id="1334467">.</span><span class="ident" id="1334468">Jar</span><span class="op" id="1334471">.</span><span class="ident" id="1334472">Cookies</span><span class="op" id="1334479">(</span><span class="ident" id="1334480">req</span><span class="op" id="1334483">.</span><span class="ident" id="1334484">URL</span><span class="op" id="1334487">)</span>&nbsp;<span class="op" id="1334489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334494">req</span><span class="op" id="1334497">.</span><span class="ident" id="1334498">AddCookie</span><span class="op" id="1334507">(</span><span class="ident" id="1334508">cookie</span><span class="op" id="1334514">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1334518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1334521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334524">resp</span><span class="op" id="1334528">,</span>&nbsp;<span class="ident" id="1334530">err</span>&nbsp;<span class="op" id="1334534">:=</span>&nbsp;<span class="ident" id="1334537">send</span><span class="op" id="1334541">(</span><span class="ident" id="1334542">req</span><span class="op" id="1334545">,</span>&nbsp;<span class="ident" id="1334547">c</span><span class="op" id="1334548">.</span><span class="ident" id="1334549">transport</span><span class="op" id="1334558">(</span><span class="op" id="1334559">)</span><span class="op" id="1334560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334563">if</span>&nbsp;<span class="ident" id="1334566">err</span>&nbsp;<span class="op" id="1334570">!=</span>&nbsp;<span class="ident" id="1334573">nil</span>&nbsp;<span class="op" id="1334577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334581">return</span>&nbsp;<span class="ident" id="1334588">nil</span><span class="op" id="1334591">,</span>&nbsp;<span class="ident" id="1334593">err</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1334598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334601">if</span>&nbsp;<span class="ident" id="1334604">c</span><span class="op" id="1334605">.</span><span class="ident" id="1334606">Jar</span>&nbsp;<span class="op" id="1334610">!=</span>&nbsp;<span class="ident" id="1334613">nil</span>&nbsp;<span class="op" id="1334617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334621">if</span>&nbsp;<span class="ident" id="1334624">rc</span>&nbsp;<span class="op" id="1334627">:=</span>&nbsp;<span class="ident" id="1334630">resp</span><span class="op" id="1334634">.</span><span class="ident" id="1334635">Cookies</span><span class="op" id="1334642">(</span><span class="op" id="1334643">)</span><span class="op" id="1334644">;</span>&nbsp;<span class="builtinfunc" id="1334646">len</span><span class="op" id="1334649">(</span><span class="ident" id="1334650">rc</span><span class="op" id="1334652">)</span>&nbsp;<span class="op" id="1334654">&gt;</span>&nbsp;<span class="num" id="1334656">0</span>&nbsp;<span class="op" id="1334658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1334663">c</span><span class="op" id="1334664">.</span><span class="ident" id="1334665">Jar</span><span class="op" id="1334668">.</span><span class="ident" id="1334669">SetCookies</span><span class="op" id="1334679">(</span><span class="ident" id="1334680">req</span><span class="op" id="1334683">.</span><span class="ident" id="1334684">URL</span><span class="op" id="1334687">,</span>&nbsp;<span class="ident" id="1334689">rc</span><span class="op" id="1334691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1334695">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1334698">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1334701">return</span>&nbsp;<span class="ident" id="1334708">resp</span><span class="op" id="1334712">,</span>&nbsp;<span class="ident" id="1334714">err</span><br>
<span class="lineno"></span><span class="op" id="1334718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1334721">//&nbsp;Do&nbsp;sends&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;and&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;response,&nbsp;following</span><br>
<span class="lineno">155</span><span class="comment" id="1334789">//&nbsp;policy&nbsp;(e.g.&nbsp;redirects,&nbsp;cookies,&nbsp;auth)&nbsp;as&nbsp;configured&nbsp;on&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="1334860">//</span><br>
<span class="lineno"></span><span class="comment" id="1334863">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;caused&nbsp;by&nbsp;client&nbsp;policy&nbsp;(such&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="1334923">//&nbsp;CheckRedirect),&nbsp;or&nbsp;if&nbsp;there&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="1334982">//&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t&nbsp;cause&nbsp;an&nbsp;error.</span><br>
<span class="lineno">160</span><span class="comment" id="1335028">//</span><br>
<span class="lineno"></span><span class="comment" id="1335031">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="1335093">//</span><br>
<span class="lineno"></span><span class="comment" id="1335096">//&nbsp;Callers&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="1335160">//&nbsp;resp.Body&nbsp;is&nbsp;not&nbsp;closed,&nbsp;the&nbsp;Client&#39;s&nbsp;underlying&nbsp;RoundTripper</span><br>
<span class="lineno">165</span><span class="comment" id="1335225">//&nbsp;(typically&nbsp;Transport)&nbsp;may&nbsp;not&nbsp;be&nbsp;able&nbsp;to&nbsp;re-use&nbsp;a&nbsp;persistent&nbsp;TCP</span><br>
<span class="lineno"></span><span class="comment" id="1335293">//&nbsp;connection&nbsp;to&nbsp;the&nbsp;server&nbsp;for&nbsp;a&nbsp;subsequent&nbsp;&#34;keep-alive&#34;&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="1335360">//</span><br>
<span class="lineno"></span><span class="comment" id="1335363">//&nbsp;The&nbsp;request&nbsp;Body,&nbsp;if&nbsp;non-nil,&nbsp;will&nbsp;be&nbsp;closed&nbsp;by&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="1335429">//&nbsp;Transport,&nbsp;even&nbsp;on&nbsp;errors.</span><br>
<span class="lineno">170</span><span class="comment" id="1335459">//</span><br>
<span class="lineno"></span><span class="comment" id="1335462">//&nbsp;Generally&nbsp;Get,&nbsp;Post,&nbsp;or&nbsp;PostForm&nbsp;will&nbsp;be&nbsp;used&nbsp;instead&nbsp;of&nbsp;Do.</span><br>
<span class="lineno"></span><span class="keyword" id="1335526">func</span>&nbsp;<span class="op" id="1335531">(</span><span class="ident" id="1335532">c</span>&nbsp;<span class="op" id="1335534">*</span><span class="ident" id="1335535">Client</span><span class="op" id="1335541">)</span>&nbsp;<span class="ident" id="1335543">Do</span><span class="op" id="1335545">(</span><span class="ident" id="1335546">req</span>&nbsp;<span class="op" id="1335550">*</span><span class="ident" id="1335551">Request</span><span class="op" id="1335558">)</span>&nbsp;<span class="op" id="1335560">(</span><span class="ident" id="1335561">resp</span>&nbsp;<span class="op" id="1335566">*</span><span class="ident" id="1335567">Response</span><span class="op" id="1335575">,</span>&nbsp;<span class="ident" id="1335577">err</span>&nbsp;<span class="builtintype" id="1335581">error</span><span class="op" id="1335586">)</span>&nbsp;<span class="op" id="1335588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335591">if</span>&nbsp;<span class="ident" id="1335594">req</span><span class="op" id="1335597">.</span><span class="ident" id="1335598">Method</span>&nbsp;<span class="op" id="1335605">==</span>&nbsp;<span class="string" id="1335608">&#34;GET&#34;</span>&nbsp;<span class="op" id="1335614">||</span>&nbsp;<span class="ident" id="1335617">req</span><span class="op" id="1335620">.</span><span class="ident" id="1335621">Method</span>&nbsp;<span class="op" id="1335628">==</span>&nbsp;<span class="string" id="1335631">&#34;HEAD&#34;</span>&nbsp;<span class="op" id="1335638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335642">return</span>&nbsp;<span class="ident" id="1335649">c</span><span class="op" id="1335650">.</span><span class="ident" id="1335651">doFollowingRedirects</span><span class="op" id="1335671">(</span><span class="ident" id="1335672">req</span><span class="op" id="1335675">,</span>&nbsp;<span class="ident" id="1335677">shouldRedirectGet</span><span class="op" id="1335694">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1335697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335700">if</span>&nbsp;<span class="ident" id="1335703">req</span><span class="op" id="1335706">.</span><span class="ident" id="1335707">Method</span>&nbsp;<span class="op" id="1335714">==</span>&nbsp;<span class="string" id="1335717">&#34;POST&#34;</span>&nbsp;<span class="op" id="1335724">||</span>&nbsp;<span class="ident" id="1335727">req</span><span class="op" id="1335730">.</span><span class="ident" id="1335731">Method</span>&nbsp;<span class="op" id="1335738">==</span>&nbsp;<span class="string" id="1335741">&#34;PUT&#34;</span>&nbsp;<span class="op" id="1335747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335751">return</span>&nbsp;<span class="ident" id="1335758">c</span><span class="op" id="1335759">.</span><span class="ident" id="1335760">doFollowingRedirects</span><span class="op" id="1335780">(</span><span class="ident" id="1335781">req</span><span class="op" id="1335784">,</span>&nbsp;<span class="ident" id="1335786">shouldRedirectPost</span><span class="op" id="1335804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1335807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335810">return</span>&nbsp;<span class="ident" id="1335817">c</span><span class="op" id="1335818">.</span><span class="ident" id="1335819">send</span><span class="op" id="1335823">(</span><span class="ident" id="1335824">req</span><span class="op" id="1335827">)</span><br>
<span class="lineno">180</span><span class="op" id="1335829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1335832">func</span>&nbsp;<span class="op" id="1335837">(</span><span class="ident" id="1335838">c</span>&nbsp;<span class="op" id="1335840">*</span><span class="ident" id="1335841">Client</span><span class="op" id="1335847">)</span>&nbsp;<span class="ident" id="1335849">transport</span><span class="op" id="1335858">(</span><span class="op" id="1335859">)</span>&nbsp;<span class="ident" id="1335861">RoundTripper</span>&nbsp;<span class="op" id="1335874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335877">if</span>&nbsp;<span class="ident" id="1335880">c</span><span class="op" id="1335881">.</span><span class="ident" id="1335882">Transport</span>&nbsp;<span class="op" id="1335892">!=</span>&nbsp;<span class="ident" id="1335895">nil</span>&nbsp;<span class="op" id="1335899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335903">return</span>&nbsp;<span class="ident" id="1335910">c</span><span class="op" id="1335911">.</span><span class="ident" id="1335912">Transport</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1335923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1335926">return</span>&nbsp;<span class="ident" id="1335933">DefaultTransport</span><br>
<span class="lineno"></span><span class="op" id="1335950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1335953">//&nbsp;send&nbsp;issues&nbsp;an&nbsp;HTTP&nbsp;request.</span><br>
<span class="lineno">190</span><span class="comment" id="1335985">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="1336045">func</span>&nbsp;<span class="ident" id="1336050">send</span><span class="op" id="1336054">(</span><span class="ident" id="1336055">req</span>&nbsp;<span class="op" id="1336059">*</span><span class="ident" id="1336060">Request</span><span class="op" id="1336067">,</span>&nbsp;<span class="ident" id="1336069">t</span>&nbsp;<span class="ident" id="1336071">RoundTripper</span><span class="op" id="1336083">)</span>&nbsp;<span class="op" id="1336085">(</span><span class="ident" id="1336086">resp</span>&nbsp;<span class="op" id="1336091">*</span><span class="ident" id="1336092">Response</span><span class="op" id="1336100">,</span>&nbsp;<span class="ident" id="1336102">err</span>&nbsp;<span class="builtintype" id="1336106">error</span><span class="op" id="1336111">)</span>&nbsp;<span class="op" id="1336113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336116">if</span>&nbsp;<span class="ident" id="1336119">t</span>&nbsp;<span class="op" id="1336121">==</span>&nbsp;<span class="ident" id="1336124">nil</span>&nbsp;<span class="op" id="1336128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336132">req</span><span class="op" id="1336135">.</span><span class="ident" id="1336136">closeBody</span><span class="op" id="1336145">(</span><span class="op" id="1336146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336150">return</span>&nbsp;<span class="ident" id="1336157">nil</span><span class="op" id="1336160">,</span>&nbsp;<span class="ident" id="1336162">errors</span><span class="op" id="1336168">.</span><span class="ident" id="1336169">New</span><span class="op" id="1336172">(</span><span class="string" id="1336173">&#34;http:&nbsp;no&nbsp;Client.Transport&nbsp;or&nbsp;DefaultTransport&#34;</span><span class="op" id="1336220">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1336223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336227">if</span>&nbsp;<span class="ident" id="1336230">req</span><span class="op" id="1336233">.</span><span class="ident" id="1336234">URL</span>&nbsp;<span class="op" id="1336238">==</span>&nbsp;<span class="ident" id="1336241">nil</span>&nbsp;<span class="op" id="1336245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336249">req</span><span class="op" id="1336252">.</span><span class="ident" id="1336253">closeBody</span><span class="op" id="1336262">(</span><span class="op" id="1336263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336267">return</span>&nbsp;<span class="ident" id="1336274">nil</span><span class="op" id="1336277">,</span>&nbsp;<span class="ident" id="1336279">errors</span><span class="op" id="1336285">.</span><span class="ident" id="1336286">New</span><span class="op" id="1336289">(</span><span class="string" id="1336290">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="1336313">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1336316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336320">if</span>&nbsp;<span class="ident" id="1336323">req</span><span class="op" id="1336326">.</span><span class="ident" id="1336327">RequestURI</span>&nbsp;<span class="op" id="1336338">!=</span>&nbsp;<span class="string" id="1336341">&#34;&#34;</span>&nbsp;<span class="op" id="1336344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336348">req</span><span class="op" id="1336351">.</span><span class="ident" id="1336352">closeBody</span><span class="op" id="1336361">(</span><span class="op" id="1336362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336366">return</span>&nbsp;<span class="ident" id="1336373">nil</span><span class="op" id="1336376">,</span>&nbsp;<span class="ident" id="1336378">errors</span><span class="op" id="1336384">.</span><span class="ident" id="1336385">New</span><span class="op" id="1336388">(</span><span class="string" id="1336389">&#34;http:&nbsp;Request.RequestURI&nbsp;can&#39;t&nbsp;be&nbsp;set&nbsp;in&nbsp;client&nbsp;requests.&#34;</span><span class="op" id="1336448">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1336451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1336455">//&nbsp;Most&nbsp;the&nbsp;callers&nbsp;of&nbsp;send&nbsp;(Get,&nbsp;Post,&nbsp;et&nbsp;al)&nbsp;don&#39;t&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1336514">//&nbsp;Headers,&nbsp;leaving&nbsp;it&nbsp;uninitialized.&nbsp;&nbsp;We&nbsp;guarantee&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1336574">//&nbsp;Transport&nbsp;that&nbsp;this&nbsp;has&nbsp;been&nbsp;initialized,&nbsp;though.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336628">if</span>&nbsp;<span class="ident" id="1336631">req</span><span class="op" id="1336634">.</span><span class="ident" id="1336635">Header</span>&nbsp;<span class="op" id="1336642">==</span>&nbsp;<span class="ident" id="1336645">nil</span>&nbsp;<span class="op" id="1336649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336653">req</span><span class="op" id="1336656">.</span><span class="ident" id="1336657">Header</span>&nbsp;<span class="op" id="1336664">=</span>&nbsp;<span class="builtinfunc" id="1336666">make</span><span class="op" id="1336670">(</span><span class="ident" id="1336671">Header</span><span class="op" id="1336677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1336680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336684">if</span>&nbsp;<span class="ident" id="1336687">u</span>&nbsp;<span class="op" id="1336689">:=</span>&nbsp;<span class="ident" id="1336692">req</span><span class="op" id="1336695">.</span><span class="ident" id="1336696">URL</span><span class="op" id="1336699">.</span><span class="ident" id="1336700">User</span><span class="op" id="1336704">;</span>&nbsp;<span class="ident" id="1336706">u</span>&nbsp;<span class="op" id="1336708">!=</span>&nbsp;<span class="ident" id="1336711">nil</span>&nbsp;<span class="op" id="1336715">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336719">username</span>&nbsp;<span class="op" id="1336728">:=</span>&nbsp;<span class="ident" id="1336731">u</span><span class="op" id="1336732">.</span><span class="ident" id="1336733">Username</span><span class="op" id="1336741">(</span><span class="op" id="1336742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336746">password</span><span class="op" id="1336754">,</span>&nbsp;<span class="ident" id="1336756">_</span>&nbsp;<span class="op" id="1336758">:=</span>&nbsp;<span class="ident" id="1336761">u</span><span class="op" id="1336762">.</span><span class="ident" id="1336763">Password</span><span class="op" id="1336771">(</span><span class="op" id="1336772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336776">req</span><span class="op" id="1336779">.</span><span class="ident" id="1336780">Header</span><span class="op" id="1336786">.</span><span class="ident" id="1336787">Set</span><span class="op" id="1336790">(</span><span class="string" id="1336791">&#34;Authorization&#34;</span><span class="op" id="1336806">,</span>&nbsp;<span class="string" id="1336808">&#34;Basic&nbsp;&#34;</span><span class="op" id="1336816">+</span><span class="ident" id="1336817">basicAuth</span><span class="op" id="1336826">(</span><span class="ident" id="1336827">username</span><span class="op" id="1336835">,</span>&nbsp;<span class="ident" id="1336837">password</span><span class="op" id="1336845">)</span><span class="op" id="1336846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1336849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336852">resp</span><span class="op" id="1336856">,</span>&nbsp;<span class="ident" id="1336858">err</span>&nbsp;<span class="op" id="1336862">=</span>&nbsp;<span class="ident" id="1336864">t</span><span class="op" id="1336865">.</span><span class="ident" id="1336866">RoundTrip</span><span class="op" id="1336875">(</span><span class="ident" id="1336876">req</span><span class="op" id="1336879">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336882">if</span>&nbsp;<span class="ident" id="1336885">err</span>&nbsp;<span class="op" id="1336889">!=</span>&nbsp;<span class="ident" id="1336892">nil</span>&nbsp;<span class="op" id="1336896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1336900">if</span>&nbsp;<span class="ident" id="1336903">resp</span>&nbsp;<span class="op" id="1336908">!=</span>&nbsp;<span class="ident" id="1336911">nil</span>&nbsp;<span class="op" id="1336915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1336920">log</span><span class="op" id="1336923">.</span><span class="ident" id="1336924">Printf</span><span class="op" id="1336930">(</span><span class="string" id="1336931">&#34;RoundTripper&nbsp;returned&nbsp;a&nbsp;response&nbsp;&amp;&nbsp;error;&nbsp;ignoring&nbsp;response&#34;</span><span class="op" id="1336992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1336996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337000">return</span>&nbsp;<span class="ident" id="1337007">nil</span><span class="op" id="1337010">,</span>&nbsp;<span class="ident" id="1337012">err</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1337017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337020">return</span>&nbsp;<span class="ident" id="1337027">resp</span><span class="op" id="1337031">,</span>&nbsp;<span class="ident" id="1337033">nil</span><br>
<span class="lineno"></span><span class="op" id="1337037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1337040">//&nbsp;See&nbsp;2&nbsp;(end&nbsp;of&nbsp;page&nbsp;4)&nbsp;http://www.ietf.org/rfc/rfc2617.txt</span><br>
<span class="lineno">230</span><span class="comment" id="1337101">//&nbsp;&#34;To&nbsp;receive&nbsp;authorization,&nbsp;the&nbsp;client&nbsp;sends&nbsp;the&nbsp;userid&nbsp;and&nbsp;password,</span><br>
<span class="lineno"></span><span class="comment" id="1337173">//&nbsp;separated&nbsp;by&nbsp;a&nbsp;single&nbsp;colon&nbsp;(&#34;:&#34;)&nbsp;character,&nbsp;within&nbsp;a&nbsp;base64</span><br>
<span class="lineno"></span><span class="comment" id="1337237">//&nbsp;encoded&nbsp;string&nbsp;in&nbsp;the&nbsp;credentials.&#34;</span><br>
<span class="lineno"></span><span class="comment" id="1337276">//&nbsp;It&nbsp;is&nbsp;not&nbsp;meant&nbsp;to&nbsp;be&nbsp;urlencoded.</span><br>
<span class="lineno"></span><span class="keyword" id="1337313">func</span>&nbsp;<span class="ident" id="1337318">basicAuth</span><span class="op" id="1337327">(</span><span class="ident" id="1337328">username</span><span class="op" id="1337336">,</span>&nbsp;<span class="ident" id="1337338">password</span>&nbsp;<span class="builtintype" id="1337347">string</span><span class="op" id="1337353">)</span>&nbsp;<span class="builtintype" id="1337355">string</span>&nbsp;<span class="op" id="1337362">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1337365">auth</span>&nbsp;<span class="op" id="1337370">:=</span>&nbsp;<span class="ident" id="1337373">username</span>&nbsp;<span class="op" id="1337382">+</span>&nbsp;<span class="string" id="1337384">&#34;:&#34;</span>&nbsp;<span class="op" id="1337388">+</span>&nbsp;<span class="ident" id="1337390">password</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337400">return</span>&nbsp;<span class="ident" id="1337407">base64</span><span class="op" id="1337413">.</span><span class="ident" id="1337414">StdEncoding</span><span class="op" id="1337425">.</span><span class="ident" id="1337426">EncodeToString</span><span class="op" id="1337440">(</span><span class="op" id="1337441">[</span><span class="op" id="1337442">]</span><span class="builtintype" id="1337443">byte</span><span class="op" id="1337447">(</span><span class="ident" id="1337448">auth</span><span class="op" id="1337452">)</span><span class="op" id="1337453">)</span><br>
<span class="lineno"></span><span class="op" id="1337455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1337458">//&nbsp;True&nbsp;if&nbsp;the&nbsp;specified&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;is&nbsp;one&nbsp;for&nbsp;which&nbsp;the&nbsp;Get&nbsp;utility&nbsp;should</span><br>
<span class="lineno">240</span><span class="comment" id="1337540">//&nbsp;automatically&nbsp;redirect.</span><br>
<span class="lineno"></span><span class="keyword" id="1337567">func</span>&nbsp;<span class="ident" id="1337572">shouldRedirectGet</span><span class="op" id="1337589">(</span><span class="ident" id="1337590">statusCode</span>&nbsp;<span class="builtintype" id="1337601">int</span><span class="op" id="1337604">)</span>&nbsp;<span class="builtintype" id="1337606">bool</span>&nbsp;<span class="op" id="1337611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337614">switch</span>&nbsp;<span class="ident" id="1337621">statusCode</span>&nbsp;<span class="op" id="1337632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337635">case</span>&nbsp;<span class="ident" id="1337640">StatusMovedPermanently</span><span class="op" id="1337662">,</span>&nbsp;<span class="ident" id="1337664">StatusFound</span><span class="op" id="1337675">,</span>&nbsp;<span class="ident" id="1337677">StatusSeeOther</span><span class="op" id="1337691">,</span>&nbsp;<span class="ident" id="1337693">StatusTemporaryRedirect</span><span class="op" id="1337716">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337720">return</span>&nbsp;<span class="builtintype" id="1337727">true</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1337733">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337736">return</span>&nbsp;<span class="builtintype" id="1337743">false</span><br>
<span class="lineno"></span><span class="op" id="1337749">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1337752">//&nbsp;True&nbsp;if&nbsp;the&nbsp;specified&nbsp;HTTP&nbsp;status&nbsp;code&nbsp;is&nbsp;one&nbsp;for&nbsp;which&nbsp;the&nbsp;Post&nbsp;utility&nbsp;should</span><br>
<span class="lineno">250</span><span class="comment" id="1337835">//&nbsp;automatically&nbsp;redirect.</span><br>
<span class="lineno"></span><span class="keyword" id="1337862">func</span>&nbsp;<span class="ident" id="1337867">shouldRedirectPost</span><span class="op" id="1337885">(</span><span class="ident" id="1337886">statusCode</span>&nbsp;<span class="builtintype" id="1337897">int</span><span class="op" id="1337900">)</span>&nbsp;<span class="builtintype" id="1337902">bool</span>&nbsp;<span class="op" id="1337907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337910">switch</span>&nbsp;<span class="ident" id="1337917">statusCode</span>&nbsp;<span class="op" id="1337928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337931">case</span>&nbsp;<span class="ident" id="1337936">StatusFound</span><span class="op" id="1337947">,</span>&nbsp;<span class="ident" id="1337949">StatusSeeOther</span><span class="op" id="1337963">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337967">return</span>&nbsp;<span class="builtintype" id="1337974">true</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1337980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1337983">return</span>&nbsp;<span class="builtintype" id="1337990">false</span><br>
<span class="lineno"></span><span class="op" id="1337996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1337999">//&nbsp;Get&nbsp;issues&nbsp;a&nbsp;GET&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;following</span><br>
<span class="lineno">260</span><span class="comment" id="1338082">//&nbsp;redirect&nbsp;codes,&nbsp;Get&nbsp;follows&nbsp;the&nbsp;redirect,&nbsp;up&nbsp;to&nbsp;a&nbsp;maximum&nbsp;of&nbsp;10&nbsp;redirects:</span><br>
<span class="lineno"></span><span class="comment" id="1338160">//</span><br>
<span class="lineno"></span><span class="comment" id="1338163">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="1338193">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno"></span><span class="comment" id="1338211">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno">265</span><span class="comment" id="1338233">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="1338264">//</span><br>
<span class="lineno"></span><span class="comment" id="1338267">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;there&nbsp;were&nbsp;too&nbsp;many&nbsp;redirects&nbsp;or&nbsp;if&nbsp;there</span><br>
<span class="lineno"></span><span class="comment" id="1338336">//&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t&nbsp;cause&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="1338403">//&nbsp;error.</span><br>
<span class="lineno">270</span><span class="comment" id="1338413">//</span><br>
<span class="lineno"></span><span class="comment" id="1338416">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="1338478">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="1338538">//</span><br>
<span class="lineno"></span><span class="comment" id="1338541">//&nbsp;Get&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Get.</span><br>
<span class="lineno">275</span><span class="keyword" id="1338587">func</span>&nbsp;<span class="ident" id="1338592">Get</span><span class="op" id="1338595">(</span><span class="ident" id="1338596">url</span>&nbsp;<span class="builtintype" id="1338600">string</span><span class="op" id="1338606">)</span>&nbsp;<span class="op" id="1338608">(</span><span class="ident" id="1338609">resp</span>&nbsp;<span class="op" id="1338614">*</span><span class="ident" id="1338615">Response</span><span class="op" id="1338623">,</span>&nbsp;<span class="ident" id="1338625">err</span>&nbsp;<span class="builtintype" id="1338629">error</span><span class="op" id="1338634">)</span>&nbsp;<span class="op" id="1338636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1338639">return</span>&nbsp;<span class="ident" id="1338646">DefaultClient</span><span class="op" id="1338659">.</span><span class="ident" id="1338660">Get</span><span class="op" id="1338663">(</span><span class="ident" id="1338664">url</span><span class="op" id="1338667">)</span><br>
<span class="lineno"></span><span class="op" id="1338669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1338672">//&nbsp;Get&nbsp;issues&nbsp;a&nbsp;GET&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno">280</span><span class="comment" id="1338745">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Get&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1338817">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="1338853">//</span><br>
<span class="lineno"></span><span class="comment" id="1338856">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="1338886">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno">285</span><span class="comment" id="1338904">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno"></span><span class="comment" id="1338926">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="1338957">//</span><br>
<span class="lineno"></span><span class="comment" id="1338960">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;the&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function&nbsp;fails</span><br>
<span class="lineno"></span><span class="comment" id="1339029">//&nbsp;or&nbsp;if&nbsp;there&nbsp;was&nbsp;an&nbsp;HTTP&nbsp;protocol&nbsp;error.&nbsp;A&nbsp;non-2xx&nbsp;response&nbsp;doesn&#39;t</span><br>
<span class="lineno">290</span><span class="comment" id="1339099">//&nbsp;cause&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="1339118">//</span><br>
<span class="lineno"></span><span class="comment" id="1339121">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="1339183">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="1339243">func</span>&nbsp;<span class="op" id="1339248">(</span><span class="ident" id="1339249">c</span>&nbsp;<span class="op" id="1339251">*</span><span class="ident" id="1339252">Client</span><span class="op" id="1339258">)</span>&nbsp;<span class="ident" id="1339260">Get</span><span class="op" id="1339263">(</span><span class="ident" id="1339264">url</span>&nbsp;<span class="builtintype" id="1339268">string</span><span class="op" id="1339274">)</span>&nbsp;<span class="op" id="1339276">(</span><span class="ident" id="1339277">resp</span>&nbsp;<span class="op" id="1339282">*</span><span class="ident" id="1339283">Response</span><span class="op" id="1339291">,</span>&nbsp;<span class="ident" id="1339293">err</span>&nbsp;<span class="builtintype" id="1339297">error</span><span class="op" id="1339302">)</span>&nbsp;<span class="op" id="1339304">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339307">req</span><span class="op" id="1339310">,</span>&nbsp;<span class="ident" id="1339312">err</span>&nbsp;<span class="op" id="1339316">:=</span>&nbsp;<span class="ident" id="1339319">NewRequest</span><span class="op" id="1339329">(</span><span class="string" id="1339330">&#34;GET&#34;</span><span class="op" id="1339335">,</span>&nbsp;<span class="ident" id="1339337">url</span><span class="op" id="1339340">,</span>&nbsp;<span class="ident" id="1339342">nil</span><span class="op" id="1339345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339348">if</span>&nbsp;<span class="ident" id="1339351">err</span>&nbsp;<span class="op" id="1339355">!=</span>&nbsp;<span class="ident" id="1339358">nil</span>&nbsp;<span class="op" id="1339362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339366">return</span>&nbsp;<span class="ident" id="1339373">nil</span><span class="op" id="1339376">,</span>&nbsp;<span class="ident" id="1339378">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1339383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339386">return</span>&nbsp;<span class="ident" id="1339393">c</span><span class="op" id="1339394">.</span><span class="ident" id="1339395">doFollowingRedirects</span><span class="op" id="1339415">(</span><span class="ident" id="1339416">req</span><span class="op" id="1339419">,</span>&nbsp;<span class="ident" id="1339421">shouldRedirectGet</span><span class="op" id="1339438">)</span><br>
<span class="lineno">300</span><span class="op" id="1339440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1339443">func</span>&nbsp;<span class="op" id="1339448">(</span><span class="ident" id="1339449">c</span>&nbsp;<span class="op" id="1339451">*</span><span class="ident" id="1339452">Client</span><span class="op" id="1339458">)</span>&nbsp;<span class="ident" id="1339460">doFollowingRedirects</span><span class="op" id="1339480">(</span><span class="ident" id="1339481">ireq</span>&nbsp;<span class="op" id="1339486">*</span><span class="ident" id="1339487">Request</span><span class="op" id="1339494">,</span>&nbsp;<span class="ident" id="1339496">shouldRedirect</span>&nbsp;<span class="keyword" id="1339511">func</span><span class="op" id="1339515">(</span><span class="builtintype" id="1339516">int</span><span class="op" id="1339519">)</span>&nbsp;<span class="builtintype" id="1339521">bool</span><span class="op" id="1339525">)</span>&nbsp;<span class="op" id="1339527">(</span><span class="ident" id="1339528">resp</span>&nbsp;<span class="op" id="1339533">*</span><span class="ident" id="1339534">Response</span><span class="op" id="1339542">,</span>&nbsp;<span class="ident" id="1339544">err</span>&nbsp;<span class="builtintype" id="1339548">error</span><span class="op" id="1339553">)</span>&nbsp;<span class="op" id="1339555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339558">var</span>&nbsp;<span class="ident" id="1339562">base</span>&nbsp;<span class="op" id="1339567">*</span><span class="ident" id="1339568">url</span><span class="op" id="1339571">.</span><span class="ident" id="1339572">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339577">redirectChecker</span>&nbsp;<span class="op" id="1339593">:=</span>&nbsp;<span class="ident" id="1339596">c</span><span class="op" id="1339597">.</span><span class="ident" id="1339598">CheckRedirect</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339613">if</span>&nbsp;<span class="ident" id="1339616">redirectChecker</span>&nbsp;<span class="op" id="1339632">==</span>&nbsp;<span class="ident" id="1339635">nil</span>&nbsp;<span class="op" id="1339639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339643">redirectChecker</span>&nbsp;<span class="op" id="1339659">=</span>&nbsp;<span class="ident" id="1339661">defaultCheckRedirect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1339683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339686">var</span>&nbsp;<span class="ident" id="1339690">via</span>&nbsp;<span class="op" id="1339694">[</span><span class="op" id="1339695">]</span><span class="op" id="1339696">*</span><span class="ident" id="1339697">Request</span><br>
<span class="lineno"></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339707">if</span>&nbsp;<span class="ident" id="1339710">ireq</span><span class="op" id="1339714">.</span><span class="ident" id="1339715">URL</span>&nbsp;<span class="op" id="1339719">==</span>&nbsp;<span class="ident" id="1339722">nil</span>&nbsp;<span class="op" id="1339726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339730">ireq</span><span class="op" id="1339734">.</span><span class="ident" id="1339735">closeBody</span><span class="op" id="1339744">(</span><span class="op" id="1339745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339749">return</span>&nbsp;<span class="ident" id="1339756">nil</span><span class="op" id="1339759">,</span>&nbsp;<span class="ident" id="1339761">errors</span><span class="op" id="1339767">.</span><span class="ident" id="1339768">New</span><span class="op" id="1339771">(</span><span class="string" id="1339772">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="1339795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1339798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339802">var</span>&nbsp;<span class="ident" id="1339806">reqmu</span>&nbsp;<span class="ident" id="1339812">sync</span><span class="op" id="1339816">.</span><span class="ident" id="1339817">Mutex</span>&nbsp;<span class="comment" id="1339823">//&nbsp;guards&nbsp;req</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339838">req</span>&nbsp;<span class="op" id="1339842">:=</span>&nbsp;<span class="ident" id="1339845">ireq</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339852">var</span>&nbsp;<span class="ident" id="1339856">timer</span>&nbsp;<span class="op" id="1339862">*</span><span class="ident" id="1339863">time</span><span class="op" id="1339867">.</span><span class="ident" id="1339868">Timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339875">if</span>&nbsp;<span class="ident" id="1339878">c</span><span class="op" id="1339879">.</span><span class="ident" id="1339880">Timeout</span>&nbsp;<span class="op" id="1339888">&gt;</span>&nbsp;<span class="num" id="1339890">0</span>&nbsp;<span class="op" id="1339892">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339896">type</span>&nbsp;<span class="ident" id="1339901">canceler</span>&nbsp;<span class="keyword" id="1339910">interface</span>&nbsp;<span class="op" id="1339920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339925">CancelRequest</span><span class="op" id="1339938">(</span><span class="op" id="1339939">*</span><span class="ident" id="1339940">Request</span><span class="op" id="1339947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1339951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1339955">tr</span><span class="op" id="1339957">,</span>&nbsp;<span class="ident" id="1339959">ok</span>&nbsp;<span class="op" id="1339962">:=</span>&nbsp;<span class="ident" id="1339965">c</span><span class="op" id="1339966">.</span><span class="ident" id="1339967">transport</span><span class="op" id="1339976">(</span><span class="op" id="1339977">)</span><span class="op" id="1339978">.</span><span class="op" id="1339979">(</span><span class="ident" id="1339980">canceler</span><span class="op" id="1339988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1339992">if</span>&nbsp;<span class="op" id="1339995">!</span><span class="ident" id="1339996">ok</span>&nbsp;<span class="op" id="1339999">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340004">return</span>&nbsp;<span class="ident" id="1340011">nil</span><span class="op" id="1340014">,</span>&nbsp;<span class="ident" id="1340016">fmt</span><span class="op" id="1340019">.</span><span class="ident" id="1340020">Errorf</span><span class="op" id="1340026">(</span><span class="string" id="1340027">&#34;net/http:&nbsp;Client&nbsp;Transport&nbsp;of&nbsp;type&nbsp;%T&nbsp;doesn&#39;t&nbsp;support&nbsp;CancelRequest;&nbsp;Timeout&nbsp;not&nbsp;supported&#34;</span><span class="op" id="1340119">,</span>&nbsp;<span class="ident" id="1340121">c</span><span class="op" id="1340122">.</span><span class="ident" id="1340123">transport</span><span class="op" id="1340132">(</span><span class="op" id="1340133">)</span><span class="op" id="1340134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1340138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340142">timer</span>&nbsp;<span class="op" id="1340148">=</span>&nbsp;<span class="ident" id="1340150">time</span><span class="op" id="1340154">.</span><span class="ident" id="1340155">AfterFunc</span><span class="op" id="1340164">(</span><span class="ident" id="1340165">c</span><span class="op" id="1340166">.</span><span class="ident" id="1340167">Timeout</span><span class="op" id="1340174">,</span>&nbsp;<span class="keyword" id="1340176">func</span><span class="op" id="1340180">(</span><span class="op" id="1340181">)</span>&nbsp;<span class="op" id="1340183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340188">reqmu</span><span class="op" id="1340193">.</span><span class="ident" id="1340194">Lock</span><span class="op" id="1340198">(</span><span class="op" id="1340199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340204">defer</span>&nbsp;<span class="ident" id="1340210">reqmu</span><span class="op" id="1340215">.</span><span class="ident" id="1340216">Unlock</span><span class="op" id="1340222">(</span><span class="op" id="1340223">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340228">tr</span><span class="op" id="1340230">.</span><span class="ident" id="1340231">CancelRequest</span><span class="op" id="1340244">(</span><span class="ident" id="1340245">req</span><span class="op" id="1340248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1340252">}</span><span class="op" id="1340253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1340256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340260">urlStr</span>&nbsp;<span class="op" id="1340267">:=</span>&nbsp;<span class="string" id="1340270">&#34;&#34;</span>&nbsp;<span class="comment" id="1340273">//&nbsp;next&nbsp;relative&nbsp;or&nbsp;absolute&nbsp;URL&nbsp;to&nbsp;fetch&nbsp;(after&nbsp;first&nbsp;request)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340338">redirectFailed</span>&nbsp;<span class="op" id="1340353">:=</span>&nbsp;<span class="builtintype" id="1340356">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340363">for</span>&nbsp;<span class="ident" id="1340367">redirect</span>&nbsp;<span class="op" id="1340376">:=</span>&nbsp;<span class="num" id="1340379">0</span><span class="op" id="1340380">;</span>&nbsp;<span class="op" id="1340382">;</span>&nbsp;<span class="ident" id="1340384">redirect</span><span class="op" id="1340392">++</span>&nbsp;<span class="op" id="1340395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340399">if</span>&nbsp;<span class="ident" id="1340402">redirect</span>&nbsp;<span class="op" id="1340411">!=</span>&nbsp;<span class="num" id="1340414">0</span>&nbsp;<span class="op" id="1340416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340421">nreq</span>&nbsp;<span class="op" id="1340426">:=</span>&nbsp;<span class="builtinfunc" id="1340429">new</span><span class="op" id="1340432">(</span><span class="ident" id="1340433">Request</span><span class="op" id="1340440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340445">nreq</span><span class="op" id="1340449">.</span><span class="ident" id="1340450">Method</span>&nbsp;<span class="op" id="1340457">=</span>&nbsp;<span class="ident" id="1340459">ireq</span><span class="op" id="1340463">.</span><span class="ident" id="1340464">Method</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340474">if</span>&nbsp;<span class="ident" id="1340477">ireq</span><span class="op" id="1340481">.</span><span class="ident" id="1340482">Method</span>&nbsp;<span class="op" id="1340489">==</span>&nbsp;<span class="string" id="1340492">&#34;POST&#34;</span>&nbsp;<span class="op" id="1340499">||</span>&nbsp;<span class="ident" id="1340502">ireq</span><span class="op" id="1340506">.</span><span class="ident" id="1340507">Method</span>&nbsp;<span class="op" id="1340514">==</span>&nbsp;<span class="string" id="1340517">&#34;PUT&#34;</span>&nbsp;<span class="op" id="1340523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340529">nreq</span><span class="op" id="1340533">.</span><span class="ident" id="1340534">Method</span>&nbsp;<span class="op" id="1340541">=</span>&nbsp;<span class="string" id="1340543">&#34;GET&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1340552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340557">nreq</span><span class="op" id="1340561">.</span><span class="ident" id="1340562">Header</span>&nbsp;<span class="op" id="1340569">=</span>&nbsp;<span class="builtinfunc" id="1340571">make</span><span class="op" id="1340575">(</span><span class="ident" id="1340576">Header</span><span class="op" id="1340582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340587">nreq</span><span class="op" id="1340591">.</span><span class="ident" id="1340592">URL</span><span class="op" id="1340595">,</span>&nbsp;<span class="ident" id="1340597">err</span>&nbsp;<span class="op" id="1340601">=</span>&nbsp;<span class="ident" id="1340603">base</span><span class="op" id="1340607">.</span><span class="ident" id="1340608">Parse</span><span class="op" id="1340613">(</span><span class="ident" id="1340614">urlStr</span><span class="op" id="1340620">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340625">if</span>&nbsp;<span class="ident" id="1340628">err</span>&nbsp;<span class="op" id="1340632">!=</span>&nbsp;<span class="ident" id="1340635">nil</span>&nbsp;<span class="op" id="1340639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340645">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1340654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340659">if</span>&nbsp;<span class="builtinfunc" id="1340662">len</span><span class="op" id="1340665">(</span><span class="ident" id="1340666">via</span><span class="op" id="1340669">)</span>&nbsp;<span class="op" id="1340671">&gt;</span>&nbsp;<span class="num" id="1340673">0</span>&nbsp;<span class="op" id="1340675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1340681">//&nbsp;Add&nbsp;the&nbsp;Referer&nbsp;header.</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340712">lastReq</span>&nbsp;<span class="op" id="1340720">:=</span>&nbsp;<span class="ident" id="1340723">via</span><span class="op" id="1340726">[</span><span class="builtinfunc" id="1340727">len</span><span class="op" id="1340730">(</span><span class="ident" id="1340731">via</span><span class="op" id="1340734">)</span><span class="op" id="1340735">-</span><span class="num" id="1340736">1</span><span class="op" id="1340737">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340743">if</span>&nbsp;<span class="ident" id="1340746">ref</span>&nbsp;<span class="op" id="1340750">:=</span>&nbsp;<span class="ident" id="1340753">refererForURL</span><span class="op" id="1340766">(</span><span class="ident" id="1340767">lastReq</span><span class="op" id="1340774">.</span><span class="ident" id="1340775">URL</span><span class="op" id="1340778">,</span>&nbsp;<span class="ident" id="1340780">nreq</span><span class="op" id="1340784">.</span><span class="ident" id="1340785">URL</span><span class="op" id="1340788">)</span><span class="op" id="1340789">;</span>&nbsp;<span class="ident" id="1340791">ref</span>&nbsp;<span class="op" id="1340795">!=</span>&nbsp;<span class="string" id="1340798">&#34;&#34;</span>&nbsp;<span class="op" id="1340801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340808">nreq</span><span class="op" id="1340812">.</span><span class="ident" id="1340813">Header</span><span class="op" id="1340819">.</span><span class="ident" id="1340820">Set</span><span class="op" id="1340823">(</span><span class="string" id="1340824">&#34;Referer&#34;</span><span class="op" id="1340833">,</span>&nbsp;<span class="ident" id="1340835">ref</span><span class="op" id="1340838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1340844">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340851">err</span>&nbsp;<span class="op" id="1340855">=</span>&nbsp;<span class="ident" id="1340857">redirectChecker</span><span class="op" id="1340872">(</span><span class="ident" id="1340873">nreq</span><span class="op" id="1340877">,</span>&nbsp;<span class="ident" id="1340879">via</span><span class="op" id="1340882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340888">if</span>&nbsp;<span class="ident" id="1340891">err</span>&nbsp;<span class="op" id="1340895">!=</span>&nbsp;<span class="ident" id="1340898">nil</span>&nbsp;<span class="op" id="1340902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340909">redirectFailed</span>&nbsp;<span class="op" id="1340924">=</span>&nbsp;<span class="builtintype" id="1340926">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1340936">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1340946">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1340951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340956">reqmu</span><span class="op" id="1340961">.</span><span class="ident" id="1340962">Lock</span><span class="op" id="1340966">(</span><span class="op" id="1340967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340972">req</span>&nbsp;<span class="op" id="1340976">=</span>&nbsp;<span class="ident" id="1340978">nreq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1340986">reqmu</span><span class="op" id="1340991">.</span><span class="ident" id="1340992">Unlock</span><span class="op" id="1340998">(</span><span class="op" id="1340999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1341003">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341008">urlStr</span>&nbsp;<span class="op" id="1341015">=</span>&nbsp;<span class="ident" id="1341017">req</span><span class="op" id="1341020">.</span><span class="ident" id="1341021">URL</span><span class="op" id="1341024">.</span><span class="ident" id="1341025">String</span><span class="op" id="1341031">(</span><span class="op" id="1341032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341036">if</span>&nbsp;<span class="ident" id="1341039">resp</span><span class="op" id="1341043">,</span>&nbsp;<span class="ident" id="1341045">err</span>&nbsp;<span class="op" id="1341049">=</span>&nbsp;<span class="ident" id="1341051">c</span><span class="op" id="1341052">.</span><span class="ident" id="1341053">send</span><span class="op" id="1341057">(</span><span class="ident" id="1341058">req</span><span class="op" id="1341061">)</span><span class="op" id="1341062">;</span>&nbsp;<span class="ident" id="1341064">err</span>&nbsp;<span class="op" id="1341068">!=</span>&nbsp;<span class="ident" id="1341071">nil</span>&nbsp;<span class="op" id="1341075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341080">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1341088">}</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341093">if</span>&nbsp;<span class="ident" id="1341096">shouldRedirect</span><span class="op" id="1341110">(</span><span class="ident" id="1341111">resp</span><span class="op" id="1341115">.</span><span class="ident" id="1341116">StatusCode</span><span class="op" id="1341126">)</span>&nbsp;<span class="op" id="1341128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1341133">//&nbsp;Read&nbsp;the&nbsp;body&nbsp;if&nbsp;small&nbsp;so&nbsp;underlying&nbsp;TCP&nbsp;connection&nbsp;will&nbsp;be&nbsp;re-used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1341208">//&nbsp;No&nbsp;need&nbsp;to&nbsp;check&nbsp;for&nbsp;errors:&nbsp;if&nbsp;it&nbsp;fails,&nbsp;Transport&nbsp;won&#39;t&nbsp;reuse&nbsp;it&nbsp;anyway.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341289">const</span>&nbsp;<span class="ident" id="1341295">maxBodySlurpSize</span>&nbsp;<span class="op" id="1341312">=</span>&nbsp;<span class="num" id="1341314">2</span>&nbsp;<span class="op" id="1341316">&lt;&lt;</span>&nbsp;<span class="num" id="1341319">10</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341325">if</span>&nbsp;<span class="ident" id="1341328">resp</span><span class="op" id="1341332">.</span><span class="ident" id="1341333">ContentLength</span>&nbsp;<span class="op" id="1341347">==</span>&nbsp;<span class="op" id="1341350">-</span><span class="num" id="1341351">1</span>&nbsp;<span class="op" id="1341353">||</span>&nbsp;<span class="ident" id="1341356">resp</span><span class="op" id="1341360">.</span><span class="ident" id="1341361">ContentLength</span>&nbsp;<span class="op" id="1341375">&lt;=</span>&nbsp;<span class="ident" id="1341378">maxBodySlurpSize</span>&nbsp;<span class="op" id="1341395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341401">io</span><span class="op" id="1341403">.</span><span class="ident" id="1341404">CopyN</span><span class="op" id="1341409">(</span><span class="ident" id="1341410">ioutil</span><span class="op" id="1341416">.</span><span class="ident" id="1341417">Discard</span><span class="op" id="1341424">,</span>&nbsp;<span class="ident" id="1341426">resp</span><span class="op" id="1341430">.</span><span class="ident" id="1341431">Body</span><span class="op" id="1341435">,</span>&nbsp;<span class="ident" id="1341437">maxBodySlurpSize</span><span class="op" id="1341453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1341458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341463">resp</span><span class="op" id="1341467">.</span><span class="ident" id="1341468">Body</span><span class="op" id="1341472">.</span><span class="ident" id="1341473">Close</span><span class="op" id="1341478">(</span><span class="op" id="1341479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341484">if</span>&nbsp;<span class="ident" id="1341487">urlStr</span>&nbsp;<span class="op" id="1341494">=</span>&nbsp;<span class="ident" id="1341496">resp</span><span class="op" id="1341500">.</span><span class="ident" id="1341501">Header</span><span class="op" id="1341507">.</span><span class="ident" id="1341508">Get</span><span class="op" id="1341511">(</span><span class="string" id="1341512">&#34;Location&#34;</span><span class="op" id="1341522">)</span><span class="op" id="1341523">;</span>&nbsp;<span class="ident" id="1341525">urlStr</span>&nbsp;<span class="op" id="1341532">==</span>&nbsp;<span class="string" id="1341535">&#34;&#34;</span>&nbsp;<span class="op" id="1341538">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341544">err</span>&nbsp;<span class="op" id="1341548">=</span>&nbsp;<span class="ident" id="1341550">errors</span><span class="op" id="1341556">.</span><span class="ident" id="1341557">New</span><span class="op" id="1341560">(</span><span class="ident" id="1341561">fmt</span><span class="op" id="1341564">.</span><span class="ident" id="1341565">Sprintf</span><span class="op" id="1341572">(</span><span class="string" id="1341573">&#34;%d&nbsp;response&nbsp;missing&nbsp;Location&nbsp;header&#34;</span><span class="op" id="1341610">,</span>&nbsp;<span class="ident" id="1341612">resp</span><span class="op" id="1341616">.</span><span class="ident" id="1341617">StatusCode</span><span class="op" id="1341627">)</span><span class="op" id="1341628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341634">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1341643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341648">base</span>&nbsp;<span class="op" id="1341653">=</span>&nbsp;<span class="ident" id="1341655">req</span><span class="op" id="1341658">.</span><span class="ident" id="1341659">URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341666">via</span>&nbsp;<span class="op" id="1341670">=</span>&nbsp;<span class="builtinfunc" id="1341672">append</span><span class="op" id="1341678">(</span><span class="ident" id="1341679">via</span><span class="op" id="1341682">,</span>&nbsp;<span class="ident" id="1341684">req</span><span class="op" id="1341687">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341692">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1341703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341707">if</span>&nbsp;<span class="ident" id="1341710">timer</span>&nbsp;<span class="op" id="1341716">!=</span>&nbsp;<span class="ident" id="1341719">nil</span>&nbsp;<span class="op" id="1341723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341728">resp</span><span class="op" id="1341732">.</span><span class="ident" id="1341733">Body</span>&nbsp;<span class="op" id="1341738">=</span>&nbsp;<span class="op" id="1341740">&amp;</span><span class="ident" id="1341741">cancelTimerBody</span><span class="op" id="1341756">{</span><span class="ident" id="1341757">timer</span><span class="op" id="1341762">,</span>&nbsp;<span class="ident" id="1341764">resp</span><span class="op" id="1341768">.</span><span class="ident" id="1341769">Body</span><span class="op" id="1341773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1341777">}</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341781">return</span>&nbsp;<span class="ident" id="1341788">resp</span><span class="op" id="1341792">,</span>&nbsp;<span class="ident" id="1341794">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1341799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341803">method</span>&nbsp;<span class="op" id="1341810">:=</span>&nbsp;<span class="ident" id="1341813">ireq</span><span class="op" id="1341817">.</span><span class="ident" id="1341818">Method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341826">urlErr</span>&nbsp;<span class="op" id="1341833">:=</span>&nbsp;<span class="op" id="1341836">&amp;</span><span class="ident" id="1341837">url</span><span class="op" id="1341840">.</span><span class="ident" id="1341841">Error</span><span class="op" id="1341846">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341850">Op</span><span class="op" id="1341852">:</span>&nbsp;&nbsp;<span class="ident" id="1341855">method</span><span class="op" id="1341861">[</span><span class="num" id="1341862">0</span><span class="op" id="1341863">:</span><span class="num" id="1341864">1</span><span class="op" id="1341865">]</span>&nbsp;<span class="op" id="1341867">+</span>&nbsp;<span class="ident" id="1341869">strings</span><span class="op" id="1341876">.</span><span class="ident" id="1341877">ToLower</span><span class="op" id="1341884">(</span><span class="ident" id="1341885">method</span><span class="op" id="1341891">[</span><span class="num" id="1341892">1</span><span class="op" id="1341893">:</span><span class="op" id="1341894">]</span><span class="op" id="1341895">)</span><span class="op" id="1341896">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341900">URL</span><span class="op" id="1341903">:</span>&nbsp;<span class="ident" id="1341905">urlStr</span><span class="op" id="1341911">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1341915">Err</span><span class="op" id="1341918">:</span>&nbsp;<span class="ident" id="1341920">err</span><span class="op" id="1341923">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1341926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1341930">if</span>&nbsp;<span class="ident" id="1341933">redirectFailed</span>&nbsp;<span class="op" id="1341948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1341952">//&nbsp;Special&nbsp;case&nbsp;for&nbsp;Go&nbsp;1&nbsp;compatibility:&nbsp;return&nbsp;both&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1342019">//&nbsp;and&nbsp;an&nbsp;error&nbsp;if&nbsp;the&nbsp;CheckRedirect&nbsp;function&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1342075">//&nbsp;See&nbsp;http://golang.org/issue/3795</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1342113">return</span>&nbsp;<span class="ident" id="1342120">resp</span><span class="op" id="1342124">,</span>&nbsp;<span class="ident" id="1342126">urlErr</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1342134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1342138">if</span>&nbsp;<span class="ident" id="1342141">resp</span>&nbsp;<span class="op" id="1342146">!=</span>&nbsp;<span class="ident" id="1342149">nil</span>&nbsp;<span class="op" id="1342153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1342157">resp</span><span class="op" id="1342161">.</span><span class="ident" id="1342162">Body</span><span class="op" id="1342166">.</span><span class="ident" id="1342167">Close</span><span class="op" id="1342172">(</span><span class="op" id="1342173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1342176">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1342179">return</span>&nbsp;<span class="ident" id="1342186">nil</span><span class="op" id="1342189">,</span>&nbsp;<span class="ident" id="1342191">urlErr</span><br>
<span class="lineno"></span><span class="op" id="1342198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1342201">func</span>&nbsp;<span class="ident" id="1342206">defaultCheckRedirect</span><span class="op" id="1342226">(</span><span class="ident" id="1342227">req</span>&nbsp;<span class="op" id="1342231">*</span><span class="ident" id="1342232">Request</span><span class="op" id="1342239">,</span>&nbsp;<span class="ident" id="1342241">via</span>&nbsp;<span class="op" id="1342245">[</span><span class="op" id="1342246">]</span><span class="op" id="1342247">*</span><span class="ident" id="1342248">Request</span><span class="op" id="1342255">)</span>&nbsp;<span class="builtintype" id="1342257">error</span>&nbsp;<span class="op" id="1342263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1342266">if</span>&nbsp;<span class="builtinfunc" id="1342269">len</span><span class="op" id="1342272">(</span><span class="ident" id="1342273">via</span><span class="op" id="1342276">)</span>&nbsp;<span class="op" id="1342278">&gt;=</span>&nbsp;<span class="num" id="1342281">10</span>&nbsp;<span class="op" id="1342284">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1342288">return</span>&nbsp;<span class="ident" id="1342295">errors</span><span class="op" id="1342301">.</span><span class="ident" id="1342302">New</span><span class="op" id="1342305">(</span><span class="string" id="1342306">&#34;stopped&nbsp;after&nbsp;10&nbsp;redirects&#34;</span><span class="op" id="1342334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1342337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1342340">return</span>&nbsp;<span class="ident" id="1342347">nil</span><br>
<span class="lineno"></span><span class="op" id="1342351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="comment" id="1342354">//&nbsp;Post&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.</span><br>
<span class="lineno"></span><span class="comment" id="1342398">//</span><br>
<span class="lineno"></span><span class="comment" id="1342401">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="1342461">//</span><br>
<span class="lineno"></span><span class="comment" id="1342464">//&nbsp;Post&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Post</span><br>
<span class="lineno">425</span><span class="keyword" id="1342511">func</span>&nbsp;<span class="ident" id="1342516">Post</span><span class="op" id="1342520">(</span><span class="ident" id="1342521">url</span>&nbsp;<span class="builtintype" id="1342525">string</span><span class="op" id="1342531">,</span>&nbsp;<span class="ident" id="1342533">bodyType</span>&nbsp;<span class="builtintype" id="1342542">string</span><span class="op" id="1342548">,</span>&nbsp;<span class="ident" id="1342550">body</span>&nbsp;<span class="ident" id="1342555">io</span><span class="op" id="1342557">.</span><span class="ident" id="1342558">Reader</span><span class="op" id="1342564">)</span>&nbsp;<span class="op" id="1342566">(</span><span class="ident" id="1342567">resp</span>&nbsp;<span class="op" id="1342572">*</span><span class="ident" id="1342573">Response</span><span class="op" id="1342581">,</span>&nbsp;<span class="ident" id="1342583">err</span>&nbsp;<span class="builtintype" id="1342587">error</span><span class="op" id="1342592">)</span>&nbsp;<span class="op" id="1342594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1342597">return</span>&nbsp;<span class="ident" id="1342604">DefaultClient</span><span class="op" id="1342617">.</span><span class="ident" id="1342618">Post</span><span class="op" id="1342622">(</span><span class="ident" id="1342623">url</span><span class="op" id="1342626">,</span>&nbsp;<span class="ident" id="1342628">bodyType</span><span class="op" id="1342636">,</span>&nbsp;<span class="ident" id="1342638">body</span><span class="op" id="1342642">)</span><br>
<span class="lineno"></span><span class="op" id="1342644">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1342647">//&nbsp;Post&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.</span><br>
<span class="lineno">430</span><span class="comment" id="1342691">//</span><br>
<span class="lineno"></span><span class="comment" id="1342694">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="1342754">//</span><br>
<span class="lineno"></span><span class="comment" id="1342757">//&nbsp;If&nbsp;the&nbsp;provided&nbsp;body&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer,&nbsp;it&nbsp;is&nbsp;closed&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1342826">//&nbsp;request.</span><br>
<span class="lineno">435</span><span class="keyword" id="1342838">func</span>&nbsp;<span class="op" id="1342843">(</span><span class="ident" id="1342844">c</span>&nbsp;<span class="op" id="1342846">*</span><span class="ident" id="1342847">Client</span><span class="op" id="1342853">)</span>&nbsp;<span class="ident" id="1342855">Post</span><span class="op" id="1342859">(</span><span class="ident" id="1342860">url</span>&nbsp;<span class="builtintype" id="1342864">string</span><span class="op" id="1342870">,</span>&nbsp;<span class="ident" id="1342872">bodyType</span>&nbsp;<span class="builtintype" id="1342881">string</span><span class="op" id="1342887">,</span>&nbsp;<span class="ident" id="1342889">body</span>&nbsp;<span class="ident" id="1342894">io</span><span class="op" id="1342896">.</span><span class="ident" id="1342897">Reader</span><span class="op" id="1342903">)</span>&nbsp;<span class="op" id="1342905">(</span><span class="ident" id="1342906">resp</span>&nbsp;<span class="op" id="1342911">*</span><span class="ident" id="1342912">Response</span><span class="op" id="1342920">,</span>&nbsp;<span class="ident" id="1342922">err</span>&nbsp;<span class="builtintype" id="1342926">error</span><span class="op" id="1342931">)</span>&nbsp;<span class="op" id="1342933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1342936">req</span><span class="op" id="1342939">,</span>&nbsp;<span class="ident" id="1342941">err</span>&nbsp;<span class="op" id="1342945">:=</span>&nbsp;<span class="ident" id="1342948">NewRequest</span><span class="op" id="1342958">(</span><span class="string" id="1342959">&#34;POST&#34;</span><span class="op" id="1342965">,</span>&nbsp;<span class="ident" id="1342967">url</span><span class="op" id="1342970">,</span>&nbsp;<span class="ident" id="1342972">body</span><span class="op" id="1342976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1342979">if</span>&nbsp;<span class="ident" id="1342982">err</span>&nbsp;<span class="op" id="1342986">!=</span>&nbsp;<span class="ident" id="1342989">nil</span>&nbsp;<span class="op" id="1342993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1342997">return</span>&nbsp;<span class="ident" id="1343004">nil</span><span class="op" id="1343007">,</span>&nbsp;<span class="ident" id="1343009">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1343014">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1343017">req</span><span class="op" id="1343020">.</span><span class="ident" id="1343021">Header</span><span class="op" id="1343027">.</span><span class="ident" id="1343028">Set</span><span class="op" id="1343031">(</span><span class="string" id="1343032">&#34;Content-Type&#34;</span><span class="op" id="1343046">,</span>&nbsp;<span class="ident" id="1343048">bodyType</span><span class="op" id="1343056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343059">return</span>&nbsp;<span class="ident" id="1343066">c</span><span class="op" id="1343067">.</span><span class="ident" id="1343068">doFollowingRedirects</span><span class="op" id="1343088">(</span><span class="ident" id="1343089">req</span><span class="op" id="1343092">,</span>&nbsp;<span class="ident" id="1343094">shouldRedirectPost</span><span class="op" id="1343112">)</span><br>
<span class="lineno"></span><span class="op" id="1343114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1343117">//&nbsp;PostForm&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL,&nbsp;with&nbsp;data&#39;s&nbsp;keys&nbsp;and</span><br>
<span class="lineno">445</span><span class="comment" id="1343186">//&nbsp;values&nbsp;URL-encoded&nbsp;as&nbsp;the&nbsp;request&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="1343229">//</span><br>
<span class="lineno"></span><span class="comment" id="1343232">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="1343294">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="1343354">//</span><br>
<span class="lineno">450</span><span class="comment" id="1343357">//&nbsp;PostForm&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.PostForm</span><br>
<span class="lineno"></span><span class="keyword" id="1343412">func</span>&nbsp;<span class="ident" id="1343417">PostForm</span><span class="op" id="1343425">(</span><span class="ident" id="1343426">url</span>&nbsp;<span class="builtintype" id="1343430">string</span><span class="op" id="1343436">,</span>&nbsp;<span class="ident" id="1343438">data</span>&nbsp;<span class="ident" id="1343443">url</span><span class="op" id="1343446">.</span><span class="ident" id="1343447">Values</span><span class="op" id="1343453">)</span>&nbsp;<span class="op" id="1343455">(</span><span class="ident" id="1343456">resp</span>&nbsp;<span class="op" id="1343461">*</span><span class="ident" id="1343462">Response</span><span class="op" id="1343470">,</span>&nbsp;<span class="ident" id="1343472">err</span>&nbsp;<span class="builtintype" id="1343476">error</span><span class="op" id="1343481">)</span>&nbsp;<span class="op" id="1343483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343486">return</span>&nbsp;<span class="ident" id="1343493">DefaultClient</span><span class="op" id="1343506">.</span><span class="ident" id="1343507">PostForm</span><span class="op" id="1343515">(</span><span class="ident" id="1343516">url</span><span class="op" id="1343519">,</span>&nbsp;<span class="ident" id="1343521">data</span><span class="op" id="1343525">)</span><br>
<span class="lineno"></span><span class="op" id="1343527">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span><span class="comment" id="1343530">//&nbsp;PostForm&nbsp;issues&nbsp;a&nbsp;POST&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL,</span><br>
<span class="lineno"></span><span class="comment" id="1343578">//&nbsp;with&nbsp;data&#39;s&nbsp;keys&nbsp;and&nbsp;values&nbsp;urlencoded&nbsp;as&nbsp;the&nbsp;request&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="1343641">//</span><br>
<span class="lineno"></span><span class="comment" id="1343644">//&nbsp;When&nbsp;err&nbsp;is&nbsp;nil,&nbsp;resp&nbsp;always&nbsp;contains&nbsp;a&nbsp;non-nil&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="1343706">//&nbsp;Caller&nbsp;should&nbsp;close&nbsp;resp.Body&nbsp;when&nbsp;done&nbsp;reading&nbsp;from&nbsp;it.</span><br>
<span class="lineno">460</span><span class="keyword" id="1343766">func</span>&nbsp;<span class="op" id="1343771">(</span><span class="ident" id="1343772">c</span>&nbsp;<span class="op" id="1343774">*</span><span class="ident" id="1343775">Client</span><span class="op" id="1343781">)</span>&nbsp;<span class="ident" id="1343783">PostForm</span><span class="op" id="1343791">(</span><span class="ident" id="1343792">url</span>&nbsp;<span class="builtintype" id="1343796">string</span><span class="op" id="1343802">,</span>&nbsp;<span class="ident" id="1343804">data</span>&nbsp;<span class="ident" id="1343809">url</span><span class="op" id="1343812">.</span><span class="ident" id="1343813">Values</span><span class="op" id="1343819">)</span>&nbsp;<span class="op" id="1343821">(</span><span class="ident" id="1343822">resp</span>&nbsp;<span class="op" id="1343827">*</span><span class="ident" id="1343828">Response</span><span class="op" id="1343836">,</span>&nbsp;<span class="ident" id="1343838">err</span>&nbsp;<span class="builtintype" id="1343842">error</span><span class="op" id="1343847">)</span>&nbsp;<span class="op" id="1343849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1343852">return</span>&nbsp;<span class="ident" id="1343859">c</span><span class="op" id="1343860">.</span><span class="ident" id="1343861">Post</span><span class="op" id="1343865">(</span><span class="ident" id="1343866">url</span><span class="op" id="1343869">,</span>&nbsp;<span class="string" id="1343871">&#34;application/x-www-form-urlencoded&#34;</span><span class="op" id="1343906">,</span>&nbsp;<span class="ident" id="1343908">strings</span><span class="op" id="1343915">.</span><span class="ident" id="1343916">NewReader</span><span class="op" id="1343925">(</span><span class="ident" id="1343926">data</span><span class="op" id="1343930">.</span><span class="ident" id="1343931">Encode</span><span class="op" id="1343937">(</span><span class="op" id="1343938">)</span><span class="op" id="1343939">)</span><span class="op" id="1343940">)</span><br>
<span class="lineno"></span><span class="op" id="1343942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1343945">//&nbsp;Head&nbsp;issues&nbsp;a&nbsp;HEAD&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno">465</span><span class="comment" id="1344020">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Head&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1344093">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="1344129">//</span><br>
<span class="lineno"></span><span class="comment" id="1344132">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="1344162">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno">470</span><span class="comment" id="1344180">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno"></span><span class="comment" id="1344202">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="comment" id="1344233">//</span><br>
<span class="lineno"></span><span class="comment" id="1344236">//&nbsp;Head&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;DefaultClient.Head</span><br>
<span class="lineno"></span><span class="keyword" id="1344283">func</span>&nbsp;<span class="ident" id="1344288">Head</span><span class="op" id="1344292">(</span><span class="ident" id="1344293">url</span>&nbsp;<span class="builtintype" id="1344297">string</span><span class="op" id="1344303">)</span>&nbsp;<span class="op" id="1344305">(</span><span class="ident" id="1344306">resp</span>&nbsp;<span class="op" id="1344311">*</span><span class="ident" id="1344312">Response</span><span class="op" id="1344320">,</span>&nbsp;<span class="ident" id="1344322">err</span>&nbsp;<span class="builtintype" id="1344326">error</span><span class="op" id="1344331">)</span>&nbsp;<span class="op" id="1344333">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344336">return</span>&nbsp;<span class="ident" id="1344343">DefaultClient</span><span class="op" id="1344356">.</span><span class="ident" id="1344357">Head</span><span class="op" id="1344361">(</span><span class="ident" id="1344362">url</span><span class="op" id="1344365">)</span><br>
<span class="lineno"></span><span class="op" id="1344367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1344370">//&nbsp;Head&nbsp;issues&nbsp;a&nbsp;HEAD&nbsp;to&nbsp;the&nbsp;specified&nbsp;URL.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;is&nbsp;one&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="1344445">//&nbsp;following&nbsp;redirect&nbsp;codes,&nbsp;Head&nbsp;follows&nbsp;the&nbsp;redirect&nbsp;after&nbsp;calling&nbsp;the</span><br>
<span class="lineno">480</span><span class="comment" id="1344518">//&nbsp;Client&#39;s&nbsp;CheckRedirect&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="1344554">//</span><br>
<span class="lineno"></span><span class="comment" id="1344557">//&nbsp;&nbsp;&nbsp;&nbsp;301&nbsp;(Moved&nbsp;Permanently)</span><br>
<span class="lineno"></span><span class="comment" id="1344587">//&nbsp;&nbsp;&nbsp;&nbsp;302&nbsp;(Found)</span><br>
<span class="lineno"></span><span class="comment" id="1344605">//&nbsp;&nbsp;&nbsp;&nbsp;303&nbsp;(See&nbsp;Other)</span><br>
<span class="lineno">485</span><span class="comment" id="1344627">//&nbsp;&nbsp;&nbsp;&nbsp;307&nbsp;(Temporary&nbsp;Redirect)</span><br>
<span class="lineno"></span><span class="keyword" id="1344658">func</span>&nbsp;<span class="op" id="1344663">(</span><span class="ident" id="1344664">c</span>&nbsp;<span class="op" id="1344666">*</span><span class="ident" id="1344667">Client</span><span class="op" id="1344673">)</span>&nbsp;<span class="ident" id="1344675">Head</span><span class="op" id="1344679">(</span><span class="ident" id="1344680">url</span>&nbsp;<span class="builtintype" id="1344684">string</span><span class="op" id="1344690">)</span>&nbsp;<span class="op" id="1344692">(</span><span class="ident" id="1344693">resp</span>&nbsp;<span class="op" id="1344698">*</span><span class="ident" id="1344699">Response</span><span class="op" id="1344707">,</span>&nbsp;<span class="ident" id="1344709">err</span>&nbsp;<span class="builtintype" id="1344713">error</span><span class="op" id="1344718">)</span>&nbsp;<span class="op" id="1344720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344723">req</span><span class="op" id="1344726">,</span>&nbsp;<span class="ident" id="1344728">err</span>&nbsp;<span class="op" id="1344732">:=</span>&nbsp;<span class="ident" id="1344735">NewRequest</span><span class="op" id="1344745">(</span><span class="string" id="1344746">&#34;HEAD&#34;</span><span class="op" id="1344752">,</span>&nbsp;<span class="ident" id="1344754">url</span><span class="op" id="1344757">,</span>&nbsp;<span class="ident" id="1344759">nil</span><span class="op" id="1344762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344765">if</span>&nbsp;<span class="ident" id="1344768">err</span>&nbsp;<span class="op" id="1344772">!=</span>&nbsp;<span class="ident" id="1344775">nil</span>&nbsp;<span class="op" id="1344779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344783">return</span>&nbsp;<span class="ident" id="1344790">nil</span><span class="op" id="1344793">,</span>&nbsp;<span class="ident" id="1344795">err</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1344800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1344803">return</span>&nbsp;<span class="ident" id="1344810">c</span><span class="op" id="1344811">.</span><span class="ident" id="1344812">doFollowingRedirects</span><span class="op" id="1344832">(</span><span class="ident" id="1344833">req</span><span class="op" id="1344836">,</span>&nbsp;<span class="ident" id="1344838">shouldRedirectGet</span><span class="op" id="1344855">)</span><br>
<span class="lineno"></span><span class="op" id="1344857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1344860">type</span>&nbsp;<span class="ident" id="1344865">cancelTimerBody</span>&nbsp;<span class="keyword" id="1344881">struct</span>&nbsp;<span class="op" id="1344888">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344891">t</span>&nbsp;&nbsp;<span class="op" id="1344894">*</span><span class="ident" id="1344895">time</span><span class="op" id="1344899">.</span><span class="ident" id="1344900">Timer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344907">rc</span>&nbsp;<span class="ident" id="1344910">io</span><span class="op" id="1344912">.</span><span class="ident" id="1344913">ReadCloser</span><br>
<span class="lineno"></span><span class="op" id="1344924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1344927">func</span>&nbsp;<span class="op" id="1344932">(</span><span class="ident" id="1344933">b</span>&nbsp;<span class="op" id="1344935">*</span><span class="ident" id="1344936">cancelTimerBody</span><span class="op" id="1344951">)</span>&nbsp;<span class="ident" id="1344953">Read</span><span class="op" id="1344957">(</span><span class="ident" id="1344958">p</span>&nbsp;<span class="op" id="1344960">[</span><span class="op" id="1344961">]</span><span class="builtintype" id="1344962">byte</span><span class="op" id="1344966">)</span>&nbsp;<span class="op" id="1344968">(</span><span class="ident" id="1344969">n</span>&nbsp;<span class="builtintype" id="1344971">int</span><span class="op" id="1344974">,</span>&nbsp;<span class="ident" id="1344976">err</span>&nbsp;<span class="builtintype" id="1344980">error</span><span class="op" id="1344985">)</span>&nbsp;<span class="op" id="1344987">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1344990">n</span><span class="op" id="1344991">,</span>&nbsp;<span class="ident" id="1344993">err</span>&nbsp;<span class="op" id="1344997">=</span>&nbsp;<span class="ident" id="1344999">b</span><span class="op" id="1345000">.</span><span class="ident" id="1345001">rc</span><span class="op" id="1345003">.</span><span class="ident" id="1345004">Read</span><span class="op" id="1345008">(</span><span class="ident" id="1345009">p</span><span class="op" id="1345010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345013">if</span>&nbsp;<span class="ident" id="1345016">err</span>&nbsp;<span class="op" id="1345020">==</span>&nbsp;<span class="ident" id="1345023">io</span><span class="op" id="1345025">.</span><span class="ident" id="1345026">EOF</span>&nbsp;<span class="op" id="1345030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345034">b</span><span class="op" id="1345035">.</span><span class="ident" id="1345036">t</span><span class="op" id="1345037">.</span><span class="ident" id="1345038">Stop</span><span class="op" id="1345042">(</span><span class="op" id="1345043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1345046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345049">return</span><br>
<span class="lineno">505</span><span class="op" id="1345056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1345059">func</span>&nbsp;<span class="op" id="1345064">(</span><span class="ident" id="1345065">b</span>&nbsp;<span class="op" id="1345067">*</span><span class="ident" id="1345068">cancelTimerBody</span><span class="op" id="1345083">)</span>&nbsp;<span class="ident" id="1345085">Close</span><span class="op" id="1345090">(</span><span class="op" id="1345091">)</span>&nbsp;<span class="builtintype" id="1345093">error</span>&nbsp;<span class="op" id="1345099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345102">err</span>&nbsp;<span class="op" id="1345106">:=</span>&nbsp;<span class="ident" id="1345109">b</span><span class="op" id="1345110">.</span><span class="ident" id="1345111">rc</span><span class="op" id="1345113">.</span><span class="ident" id="1345114">Close</span><span class="op" id="1345119">(</span><span class="op" id="1345120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1345123">b</span><span class="op" id="1345124">.</span><span class="ident" id="1345125">t</span><span class="op" id="1345126">.</span><span class="ident" id="1345127">Stop</span><span class="op" id="1345131">(</span><span class="op" id="1345132">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1345135">return</span>&nbsp;<span class="ident" id="1345142">err</span><br>
<span class="lineno"></span><span class="op" id="1345146">}</span>
</div>
</body>
</html>
