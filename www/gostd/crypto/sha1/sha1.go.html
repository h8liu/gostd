<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/sha1</h2>
<ul>
<li><a href="/gostd/crypto/sha1/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1.go.html" class="current">sha1.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1_test.go.html">sha1_test.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1block.go.html">sha1block.go</a></li>
<li><a href="/gostd/crypto/sha1/sha1block_decl.go.html">sha1block_decl.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3892838">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3892893">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3892947">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3892998">//&nbsp;Package&nbsp;sha1&nbsp;implements&nbsp;the&nbsp;SHA1&nbsp;hash&nbsp;algorithm&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;3174.</span><br>
<span class="lineno"></span><span class="keyword" id="3893073">package</span>&nbsp;<span class="ident" id="3893081">sha1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3893087">import</span>&nbsp;<span class="op" id="3893094">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3893097">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3893107">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="3893114">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3893117">func</span>&nbsp;<span class="ident" id="3893122">init</span><span class="op" id="3893126">(</span><span class="op" id="3893127">)</span>&nbsp;<span class="op" id="3893129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3893132">crypto</span><span class="op" id="3893138">.</span><span class="ident" id="3893139">RegisterHash</span><span class="op" id="3893151">(</span><span class="ident" id="3893152">crypto</span><span class="op" id="3893158">.</span><span class="ident" id="3893159">SHA1</span><span class="op" id="3893163">,</span>&nbsp;<span class="ident" id="3893165">New</span><span class="op" id="3893168">)</span><br>
<span class="lineno">15</span><span class="op" id="3893170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3893173">//&nbsp;The&nbsp;size&nbsp;of&nbsp;a&nbsp;SHA1&nbsp;checksum&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="3893214">const</span>&nbsp;<span class="ident" id="3893220">Size</span>&nbsp;<span class="op" id="3893225">=</span>&nbsp;<span class="num" id="3893227">20</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="3893231">//&nbsp;The&nbsp;blocksize&nbsp;of&nbsp;SHA1&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="3893266">const</span>&nbsp;<span class="ident" id="3893272">BlockSize</span>&nbsp;<span class="op" id="3893282">=</span>&nbsp;<span class="num" id="3893284">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3893288">const</span>&nbsp;<span class="op" id="3893294">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3893297">chunk</span>&nbsp;<span class="op" id="3893303">=</span>&nbsp;<span class="num" id="3893305">64</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3893309">init0</span>&nbsp;<span class="op" id="3893315">=</span>&nbsp;<span class="num" id="3893317">0x67452301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3893329">init1</span>&nbsp;<span class="op" id="3893335">=</span>&nbsp;<span class="num" id="3893337">0xEFCDAB89</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3893349">init2</span>&nbsp;<span class="op" id="3893355">=</span>&nbsp;<span class="num" id="3893357">0x98BADCFE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3893369">init3</span>&nbsp;<span class="op" id="3893375">=</span>&nbsp;<span class="num" id="3893377">0x10325476</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3893389">init4</span>&nbsp;<span class="op" id="3893395">=</span>&nbsp;<span class="num" id="3893397">0xC3D2E1F0</span><br>
<span class="lineno">30</span><span class="op" id="3893408">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3893411">//&nbsp;digest&nbsp;represents&nbsp;the&nbsp;partial&nbsp;evaluation&nbsp;of&nbsp;a&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="3893470">type</span>&nbsp;<span class="ident" id="3893475">digest</span>&nbsp;<span class="keyword" id="3893482">struct</span>&nbsp;<span class="op" id="3893489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3893492">h</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3893496">[</span><span class="num" id="3893497">5</span><span class="op" id="3893498">]</span><span class="builtintype" id="3893499">uint32</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3893507">x</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3893511">[</span><span class="ident" id="3893512">chunk</span><span class="op" id="3893517">]</span><span class="builtintype" id="3893518">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3893524">nx</span>&nbsp;&nbsp;<span class="builtintype" id="3893528">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3893533">len</span>&nbsp;<span class="ident" id="3893537">uint64</span><br>
<span class="lineno"></span><span class="op" id="3893544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="3893547">func</span>&nbsp;<span class="op" id="3893552">(</span><span class="ident" id="3893553">d</span>&nbsp;<span class="op" id="3893555">*</span><span class="ident" id="3893556">digest</span><span class="op" id="3893562">)</span>&nbsp;<span class="ident" id="3893564">Reset</span><span class="op" id="3893569">(</span><span class="op" id="3893570">)</span>&nbsp;<span class="op" id="3893572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3893575">d</span><span class="op" id="3893576">.</span><span class="ident" id="3893577">h</span><span class="op" id="3893578">[</span><span class="num" id="3893579">0</span><span class="op" id="3893580">]</span>&nbsp;<span class="op" id="3893582">=</span>&nbsp;<span class="ident" id="3893584">init0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3893591">d</span><span class="op" id="3893592">.</span><span class="ident" id="3893593">h</span><span class="op" id="3893594">[</span><span class="num" id="3893595">1</span><span class="op" id="3893596">]</span>&nbsp;<span class="op" id="3893598">=</span>&nbsp;<span class="ident" id="3893600">init1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3893607">d</span><span class="op" id="3893608">.</span><span class="ident" id="3893609">h</span><span class="op" id="3893610">[</span><span class="num" id="3893611">2</span><span class="op" id="3893612">]</span>&nbsp;<span class="op" id="3893614">=</span>&nbsp;<span class="ident" id="3893616">init2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3893623">d</span><span class="op" id="3893624">.</span><span class="ident" id="3893625">h</span><span class="op" id="3893626">[</span><span class="num" id="3893627">3</span><span class="op" id="3893628">]</span>&nbsp;<span class="op" id="3893630">=</span>&nbsp;<span class="ident" id="3893632">init3</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3893639">d</span><span class="op" id="3893640">.</span><span class="ident" id="3893641">h</span><span class="op" id="3893642">[</span><span class="num" id="3893643">4</span><span class="op" id="3893644">]</span>&nbsp;<span class="op" id="3893646">=</span>&nbsp;<span class="ident" id="3893648">init4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3893655">d</span><span class="op" id="3893656">.</span><span class="ident" id="3893657">nx</span>&nbsp;<span class="op" id="3893660">=</span>&nbsp;<span class="num" id="3893662">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3893665">d</span><span class="op" id="3893666">.</span><span class="builtinfunc" id="3893667">len</span>&nbsp;<span class="op" id="3893671">=</span>&nbsp;<span class="num" id="3893673">0</span><br>
<span class="lineno"></span><span class="op" id="3893675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="3893678">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;hash.Hash&nbsp;computing&nbsp;the&nbsp;SHA1&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="3893738">func</span>&nbsp;<span class="ident" id="3893743">New</span><span class="op" id="3893746">(</span><span class="op" id="3893747">)</span>&nbsp;<span class="ident" id="3893749">hash</span><span class="op" id="3893753">.</span><span class="ident" id="3893754">Hash</span>&nbsp;<span class="op" id="3893759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3893762">d</span>&nbsp;<span class="op" id="3893764">:=</span>&nbsp;<span class="builtinfunc" id="3893767">new</span><span class="op" id="3893770">(</span><span class="ident" id="3893771">digest</span><span class="op" id="3893777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3893780">d</span><span class="op" id="3893781">.</span><span class="ident" id="3893782">Reset</span><span class="op" id="3893787">(</span><span class="op" id="3893788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3893791">return</span>&nbsp;<span class="ident" id="3893798">d</span><br>
<span class="lineno">55</span><span class="op" id="3893800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3893803">func</span>&nbsp;<span class="op" id="3893808">(</span><span class="ident" id="3893809">d</span>&nbsp;<span class="op" id="3893811">*</span><span class="ident" id="3893812">digest</span><span class="op" id="3893818">)</span>&nbsp;<span class="ident" id="3893820">Size</span><span class="op" id="3893824">(</span><span class="op" id="3893825">)</span>&nbsp;<span class="builtintype" id="3893827">int</span>&nbsp;<span class="op" id="3893831">{</span>&nbsp;<span class="keyword" id="3893833">return</span>&nbsp;<span class="ident" id="3893840">Size</span>&nbsp;<span class="op" id="3893845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3893848">func</span>&nbsp;<span class="op" id="3893853">(</span><span class="ident" id="3893854">d</span>&nbsp;<span class="op" id="3893856">*</span><span class="ident" id="3893857">digest</span><span class="op" id="3893863">)</span>&nbsp;<span class="ident" id="3893865">BlockSize</span><span class="op" id="3893874">(</span><span class="op" id="3893875">)</span>&nbsp;<span class="builtintype" id="3893877">int</span>&nbsp;<span class="op" id="3893881">{</span>&nbsp;<span class="keyword" id="3893883">return</span>&nbsp;<span class="ident" id="3893890">BlockSize</span>&nbsp;<span class="op" id="3893900">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3893903">func</span>&nbsp;<span class="op" id="3893908">(</span><span class="ident" id="3893909">d</span>&nbsp;<span class="op" id="3893911">*</span><span class="ident" id="3893912">digest</span><span class="op" id="3893918">)</span>&nbsp;<span class="ident" id="3893920">Write</span><span class="op" id="3893925">(</span><span class="ident" id="3893926">p</span>&nbsp;<span class="op" id="3893928">[</span><span class="op" id="3893929">]</span><span class="builtintype" id="3893930">byte</span><span class="op" id="3893934">)</span>&nbsp;<span class="op" id="3893936">(</span><span class="ident" id="3893937">nn</span>&nbsp;<span class="builtintype" id="3893940">int</span><span class="op" id="3893943">,</span>&nbsp;<span class="ident" id="3893945">err</span>&nbsp;<span class="builtintype" id="3893949">error</span><span class="op" id="3893954">)</span>&nbsp;<span class="op" id="3893956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3893959">nn</span>&nbsp;<span class="op" id="3893962">=</span>&nbsp;<span class="builtinfunc" id="3893964">len</span><span class="op" id="3893967">(</span><span class="ident" id="3893968">p</span><span class="op" id="3893969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3893972">d</span><span class="op" id="3893973">.</span><span class="builtinfunc" id="3893974">len</span>&nbsp;<span class="op" id="3893978">+=</span>&nbsp;<span class="ident" id="3893981">uint64</span><span class="op" id="3893987">(</span><span class="ident" id="3893988">nn</span><span class="op" id="3893990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3893993">if</span>&nbsp;<span class="ident" id="3893996">d</span><span class="op" id="3893997">.</span><span class="ident" id="3893998">nx</span>&nbsp;<span class="op" id="3894001">&gt;</span>&nbsp;<span class="num" id="3894003">0</span>&nbsp;<span class="op" id="3894005">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3894009">n</span>&nbsp;<span class="op" id="3894011">:=</span>&nbsp;<span class="builtinfunc" id="3894014">copy</span><span class="op" id="3894018">(</span><span class="ident" id="3894019">d</span><span class="op" id="3894020">.</span><span class="ident" id="3894021">x</span><span class="op" id="3894022">[</span><span class="ident" id="3894023">d</span><span class="op" id="3894024">.</span><span class="ident" id="3894025">nx</span><span class="op" id="3894027">:</span><span class="op" id="3894028">]</span><span class="op" id="3894029">,</span>&nbsp;<span class="ident" id="3894031">p</span><span class="op" id="3894032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3894036">d</span><span class="op" id="3894037">.</span><span class="ident" id="3894038">nx</span>&nbsp;<span class="op" id="3894041">+=</span>&nbsp;<span class="ident" id="3894044">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3894048">if</span>&nbsp;<span class="ident" id="3894051">d</span><span class="op" id="3894052">.</span><span class="ident" id="3894053">nx</span>&nbsp;<span class="op" id="3894056">==</span>&nbsp;<span class="ident" id="3894059">chunk</span>&nbsp;<span class="op" id="3894065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3894070">block</span><span class="op" id="3894075">(</span><span class="ident" id="3894076">d</span><span class="op" id="3894077">,</span>&nbsp;<span class="ident" id="3894079">d</span><span class="op" id="3894080">.</span><span class="ident" id="3894081">x</span><span class="op" id="3894082">[</span><span class="op" id="3894083">:</span><span class="op" id="3894084">]</span><span class="op" id="3894085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3894090">d</span><span class="op" id="3894091">.</span><span class="ident" id="3894092">nx</span>&nbsp;<span class="op" id="3894095">=</span>&nbsp;<span class="num" id="3894097">0</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3894101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3894105">p</span>&nbsp;<span class="op" id="3894107">=</span>&nbsp;<span class="ident" id="3894109">p</span><span class="op" id="3894110">[</span><span class="ident" id="3894111">n</span><span class="op" id="3894112">:</span><span class="op" id="3894113">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3894116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3894119">if</span>&nbsp;<span class="builtinfunc" id="3894122">len</span><span class="op" id="3894125">(</span><span class="ident" id="3894126">p</span><span class="op" id="3894127">)</span>&nbsp;<span class="op" id="3894129">&gt;=</span>&nbsp;<span class="ident" id="3894132">chunk</span>&nbsp;<span class="op" id="3894138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3894142">n</span>&nbsp;<span class="op" id="3894144">:=</span>&nbsp;<span class="builtinfunc" id="3894147">len</span><span class="op" id="3894150">(</span><span class="ident" id="3894151">p</span><span class="op" id="3894152">)</span>&nbsp;<span class="op" id="3894154">&amp;^</span>&nbsp;<span class="op" id="3894157">(</span><span class="ident" id="3894158">chunk</span>&nbsp;<span class="op" id="3894164">-</span>&nbsp;<span class="num" id="3894166">1</span><span class="op" id="3894167">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3894171">block</span><span class="op" id="3894176">(</span><span class="ident" id="3894177">d</span><span class="op" id="3894178">,</span>&nbsp;<span class="ident" id="3894180">p</span><span class="op" id="3894181">[</span><span class="op" id="3894182">:</span><span class="ident" id="3894183">n</span><span class="op" id="3894184">]</span><span class="op" id="3894185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3894189">p</span>&nbsp;<span class="op" id="3894191">=</span>&nbsp;<span class="ident" id="3894193">p</span><span class="op" id="3894194">[</span><span class="ident" id="3894195">n</span><span class="op" id="3894196">:</span><span class="op" id="3894197">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3894200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3894203">if</span>&nbsp;<span class="builtinfunc" id="3894206">len</span><span class="op" id="3894209">(</span><span class="ident" id="3894210">p</span><span class="op" id="3894211">)</span>&nbsp;<span class="op" id="3894213">&gt;</span>&nbsp;<span class="num" id="3894215">0</span>&nbsp;<span class="op" id="3894217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3894221">d</span><span class="op" id="3894222">.</span><span class="ident" id="3894223">nx</span>&nbsp;<span class="op" id="3894226">=</span>&nbsp;<span class="builtinfunc" id="3894228">copy</span><span class="op" id="3894232">(</span><span class="ident" id="3894233">d</span><span class="op" id="3894234">.</span><span class="ident" id="3894235">x</span><span class="op" id="3894236">[</span><span class="op" id="3894237">:</span><span class="op" id="3894238">]</span><span class="op" id="3894239">,</span>&nbsp;<span class="ident" id="3894241">p</span><span class="op" id="3894242">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3894245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3894248">return</span><br>
<span class="lineno"></span><span class="op" id="3894255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3894258">func</span>&nbsp;<span class="op" id="3894263">(</span><span class="ident" id="3894264">d0</span>&nbsp;<span class="op" id="3894267">*</span><span class="ident" id="3894268">digest</span><span class="op" id="3894274">)</span>&nbsp;<span class="ident" id="3894276">Sum</span><span class="op" id="3894279">(</span><span class="ident" id="3894280">in</span>&nbsp;<span class="op" id="3894283">[</span><span class="op" id="3894284">]</span><span class="builtintype" id="3894285">byte</span><span class="op" id="3894289">)</span>&nbsp;<span class="op" id="3894291">[</span><span class="op" id="3894292">]</span><span class="builtintype" id="3894293">byte</span>&nbsp;<span class="op" id="3894298">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3894301">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;d0&nbsp;so&nbsp;that&nbsp;caller&nbsp;can&nbsp;keep&nbsp;writing&nbsp;and&nbsp;summing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3894368">d</span>&nbsp;<span class="op" id="3894370">:=</span>&nbsp;<span class="op" id="3894373">*</span><span class="ident" id="3894374">d0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3894378">hash</span>&nbsp;<span class="op" id="3894383">:=</span>&nbsp;<span class="ident" id="3894386">d</span><span class="op" id="3894387">.</span><span class="ident" id="3894388">checkSum</span><span class="op" id="3894396">(</span><span class="op" id="3894397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3894400">return</span>&nbsp;<span class="builtinfunc" id="3894407">append</span><span class="op" id="3894413">(</span><span class="ident" id="3894414">in</span><span class="op" id="3894416">,</span>&nbsp;<span class="ident" id="3894418">hash</span><span class="op" id="3894422">[</span><span class="op" id="3894423">:</span><span class="op" id="3894424">]</span><span class="op" id="3894425">...</span><span class="op" id="3894428">)</span><br>
<span class="lineno"></span><span class="op" id="3894430">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="3894433">func</span>&nbsp;<span class="op" id="3894438">(</span><span class="ident" id="3894439">d</span>&nbsp;<span class="op" id="3894441">*</span><span class="ident" id="3894442">digest</span><span class="op" id="3894448">)</span>&nbsp;<span class="ident" id="3894450">checkSum</span><span class="op" id="3894458">(</span><span class="op" id="3894459">)</span>&nbsp;<span class="op" id="3894461">[</span><span class="ident" id="3894462">Size</span><span class="op" id="3894466">]</span><span class="builtintype" id="3894467">byte</span>&nbsp;<span class="op" id="3894472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3894475">len</span>&nbsp;<span class="op" id="3894479">:=</span>&nbsp;<span class="ident" id="3894482">d</span><span class="op" id="3894483">.</span><span class="builtinfunc" id="3894484">len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3894489">//&nbsp;Padding.&nbsp;&nbsp;Add&nbsp;a&nbsp;1&nbsp;bit&nbsp;and&nbsp;0&nbsp;bits&nbsp;until&nbsp;56&nbsp;bytes&nbsp;mod&nbsp;64.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3894549">var</span>&nbsp;<span class="ident" id="3894553">tmp</span>&nbsp;<span class="op" id="3894557">[</span><span class="num" id="3894558">64</span><span class="op" id="3894560">]</span><span class="builtintype" id="3894561">byte</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3894567">tmp</span><span class="op" id="3894570">[</span><span class="num" id="3894571">0</span><span class="op" id="3894572">]</span>&nbsp;<span class="op" id="3894574">=</span>&nbsp;<span class="num" id="3894576">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3894582">if</span>&nbsp;<span class="builtinfunc" id="3894585">len</span><span class="op" id="3894588">%</span><span class="num" id="3894589">64</span>&nbsp;<span class="op" id="3894592">&lt;</span>&nbsp;<span class="num" id="3894594">56</span>&nbsp;<span class="op" id="3894597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3894601">d</span><span class="op" id="3894602">.</span><span class="ident" id="3894603">Write</span><span class="op" id="3894608">(</span><span class="ident" id="3894609">tmp</span><span class="op" id="3894612">[</span><span class="num" id="3894613">0</span>&nbsp;<span class="op" id="3894615">:</span>&nbsp;<span class="num" id="3894617">56</span><span class="op" id="3894619">-</span><span class="builtinfunc" id="3894620">len</span><span class="op" id="3894623">%</span><span class="num" id="3894624">64</span><span class="op" id="3894626">]</span><span class="op" id="3894627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3894630">}</span>&nbsp;<span class="keyword" id="3894632">else</span>&nbsp;<span class="op" id="3894637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3894641">d</span><span class="op" id="3894642">.</span><span class="ident" id="3894643">Write</span><span class="op" id="3894648">(</span><span class="ident" id="3894649">tmp</span><span class="op" id="3894652">[</span><span class="num" id="3894653">0</span>&nbsp;<span class="op" id="3894655">:</span>&nbsp;<span class="num" id="3894657">64</span><span class="op" id="3894659">+</span><span class="num" id="3894660">56</span><span class="op" id="3894662">-</span><span class="builtinfunc" id="3894663">len</span><span class="op" id="3894666">%</span><span class="num" id="3894667">64</span><span class="op" id="3894669">]</span><span class="op" id="3894670">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3894673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3894677">//&nbsp;Length&nbsp;in&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3894697">len</span>&nbsp;<span class="op" id="3894701">&lt;&lt;=</span>&nbsp;<span class="num" id="3894705">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3894708">for</span>&nbsp;<span class="ident" id="3894712">i</span>&nbsp;<span class="op" id="3894714">:=</span>&nbsp;<span class="builtintype" id="3894717">uint</span><span class="op" id="3894721">(</span><span class="num" id="3894722">0</span><span class="op" id="3894723">)</span><span class="op" id="3894724">;</span>&nbsp;<span class="ident" id="3894726">i</span>&nbsp;<span class="op" id="3894728">&lt;</span>&nbsp;<span class="num" id="3894730">8</span><span class="op" id="3894731">;</span>&nbsp;<span class="ident" id="3894733">i</span><span class="op" id="3894734">++</span>&nbsp;<span class="op" id="3894737">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3894741">tmp</span><span class="op" id="3894744">[</span><span class="ident" id="3894745">i</span><span class="op" id="3894746">]</span>&nbsp;<span class="op" id="3894748">=</span>&nbsp;<span class="builtintype" id="3894750">byte</span><span class="op" id="3894754">(</span><span class="builtinfunc" id="3894755">len</span>&nbsp;<span class="op" id="3894759">&gt;&gt;</span>&nbsp;<span class="op" id="3894762">(</span><span class="num" id="3894763">56</span>&nbsp;<span class="op" id="3894766">-</span>&nbsp;<span class="num" id="3894768">8</span><span class="op" id="3894769">*</span><span class="ident" id="3894770">i</span><span class="op" id="3894771">)</span><span class="op" id="3894772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3894775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3894778">d</span><span class="op" id="3894779">.</span><span class="ident" id="3894780">Write</span><span class="op" id="3894785">(</span><span class="ident" id="3894786">tmp</span><span class="op" id="3894789">[</span><span class="num" id="3894790">0</span><span class="op" id="3894791">:</span><span class="num" id="3894792">8</span><span class="op" id="3894793">]</span><span class="op" id="3894794">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3894798">if</span>&nbsp;<span class="ident" id="3894801">d</span><span class="op" id="3894802">.</span><span class="ident" id="3894803">nx</span>&nbsp;<span class="op" id="3894806">!=</span>&nbsp;<span class="num" id="3894809">0</span>&nbsp;<span class="op" id="3894811">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3894815">panic</span><span class="op" id="3894820">(</span><span class="string" id="3894821">&#34;d.nx&nbsp;!=&nbsp;0&#34;</span><span class="op" id="3894832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3894835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3894839">var</span>&nbsp;<span class="ident" id="3894843">digest</span>&nbsp;<span class="op" id="3894850">[</span><span class="ident" id="3894851">Size</span><span class="op" id="3894855">]</span><span class="builtintype" id="3894856">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3894862">for</span>&nbsp;<span class="ident" id="3894866">i</span><span class="op" id="3894867">,</span>&nbsp;<span class="ident" id="3894869">s</span>&nbsp;<span class="op" id="3894871">:=</span>&nbsp;<span class="keyword" id="3894874">range</span>&nbsp;<span class="ident" id="3894880">d</span><span class="op" id="3894881">.</span><span class="ident" id="3894882">h</span>&nbsp;<span class="op" id="3894884">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3894888">digest</span><span class="op" id="3894894">[</span><span class="ident" id="3894895">i</span><span class="op" id="3894896">*</span><span class="num" id="3894897">4</span><span class="op" id="3894898">]</span>&nbsp;<span class="op" id="3894900">=</span>&nbsp;<span class="builtintype" id="3894902">byte</span><span class="op" id="3894906">(</span><span class="ident" id="3894907">s</span>&nbsp;<span class="op" id="3894909">&gt;&gt;</span>&nbsp;<span class="num" id="3894912">24</span><span class="op" id="3894914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3894918">digest</span><span class="op" id="3894924">[</span><span class="ident" id="3894925">i</span><span class="op" id="3894926">*</span><span class="num" id="3894927">4</span><span class="op" id="3894928">+</span><span class="num" id="3894929">1</span><span class="op" id="3894930">]</span>&nbsp;<span class="op" id="3894932">=</span>&nbsp;<span class="builtintype" id="3894934">byte</span><span class="op" id="3894938">(</span><span class="ident" id="3894939">s</span>&nbsp;<span class="op" id="3894941">&gt;&gt;</span>&nbsp;<span class="num" id="3894944">16</span><span class="op" id="3894946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3894950">digest</span><span class="op" id="3894956">[</span><span class="ident" id="3894957">i</span><span class="op" id="3894958">*</span><span class="num" id="3894959">4</span><span class="op" id="3894960">+</span><span class="num" id="3894961">2</span><span class="op" id="3894962">]</span>&nbsp;<span class="op" id="3894964">=</span>&nbsp;<span class="builtintype" id="3894966">byte</span><span class="op" id="3894970">(</span><span class="ident" id="3894971">s</span>&nbsp;<span class="op" id="3894973">&gt;&gt;</span>&nbsp;<span class="num" id="3894976">8</span><span class="op" id="3894977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3894981">digest</span><span class="op" id="3894987">[</span><span class="ident" id="3894988">i</span><span class="op" id="3894989">*</span><span class="num" id="3894990">4</span><span class="op" id="3894991">+</span><span class="num" id="3894992">3</span><span class="op" id="3894993">]</span>&nbsp;<span class="op" id="3894995">=</span>&nbsp;<span class="builtintype" id="3894997">byte</span><span class="op" id="3895001">(</span><span class="ident" id="3895002">s</span><span class="op" id="3895003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3895006">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3895010">return</span>&nbsp;<span class="ident" id="3895017">digest</span><br>
<span class="lineno"></span><span class="op" id="3895024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3895027">//&nbsp;Sum&nbsp;returns&nbsp;the&nbsp;SHA1&nbsp;checksum&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno">125</span><span class="keyword" id="3895073">func</span>&nbsp;<span class="ident" id="3895078">Sum</span><span class="op" id="3895081">(</span><span class="ident" id="3895082">data</span>&nbsp;<span class="op" id="3895087">[</span><span class="op" id="3895088">]</span><span class="builtintype" id="3895089">byte</span><span class="op" id="3895093">)</span>&nbsp;<span class="op" id="3895095">[</span><span class="ident" id="3895096">Size</span><span class="op" id="3895100">]</span><span class="builtintype" id="3895101">byte</span>&nbsp;<span class="op" id="3895106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3895109">var</span>&nbsp;<span class="ident" id="3895113">d</span>&nbsp;<span class="ident" id="3895115">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3895123">d</span><span class="op" id="3895124">.</span><span class="ident" id="3895125">Reset</span><span class="op" id="3895130">(</span><span class="op" id="3895131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3895134">d</span><span class="op" id="3895135">.</span><span class="ident" id="3895136">Write</span><span class="op" id="3895141">(</span><span class="ident" id="3895142">data</span><span class="op" id="3895146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3895149">return</span>&nbsp;<span class="ident" id="3895156">d</span><span class="op" id="3895157">.</span><span class="ident" id="3895158">checkSum</span><span class="op" id="3895166">(</span><span class="op" id="3895167">)</span><br>
<span class="lineno">130</span><span class="op" id="3895169">}</span>
</div>
</body>
</html>
