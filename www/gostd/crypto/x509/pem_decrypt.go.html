<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4611044">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4611099">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4611153">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4611204">package</span>&nbsp;<span class="ident" id="4611212">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4611218">//&nbsp;RFC&nbsp;1423&nbsp;describes&nbsp;the&nbsp;encryption&nbsp;of&nbsp;PEM&nbsp;blocks.&nbsp;The&nbsp;algorithm&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4611292">//&nbsp;generate&nbsp;a&nbsp;key&nbsp;from&nbsp;the&nbsp;password&nbsp;was&nbsp;derived&nbsp;by&nbsp;looking&nbsp;at&nbsp;the&nbsp;OpenSSL</span><br>
<span class="lineno"></span><span class="comment" id="4611366">//&nbsp;implementation.</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="4611386">import</span>&nbsp;<span class="op" id="4611393">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4611396">&#34;crypto/aes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4611410">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4611427">&#34;crypto/des&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4611441">&#34;crypto/md5&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4611455">&#34;encoding/hex&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4611471">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4611487">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4611497">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4611503">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="4611513">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4611516">type</span>&nbsp;<span class="ident" id="4611521">PEMCipher</span>&nbsp;<span class="builtintype" id="4611531">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4611536">//&nbsp;Possible&nbsp;values&nbsp;for&nbsp;the&nbsp;EncryptPEMBlock&nbsp;encryption&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="4611601">const</span>&nbsp;<span class="op" id="4611607">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611610">_</span>&nbsp;<span class="ident" id="4611612">PEMCipher</span>&nbsp;<span class="op" id="4611622">=</span>&nbsp;<span class="ident" id="4611624">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611630">PEMCipherDES</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611644">PEMCipher3DES</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611659">PEMCipherAES128</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611676">PEMCipherAES192</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611693">PEMCipherAES256</span><br>
<span class="lineno"></span><span class="op" id="4611709">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4611712">//&nbsp;rfc1423Algo&nbsp;holds&nbsp;a&nbsp;method&nbsp;for&nbsp;enciphering&nbsp;a&nbsp;PEM&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="4611771">type</span>&nbsp;<span class="ident" id="4611776">rfc1423Algo</span>&nbsp;<span class="keyword" id="4611788">struct</span>&nbsp;<span class="op" id="4611795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611798">cipher</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4611809">PEMCipher</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611820">name</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4611831">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611839">cipherFunc</span>&nbsp;<span class="keyword" id="4611850">func</span><span class="op" id="4611854">(</span><span class="ident" id="4611855">key</span>&nbsp;<span class="op" id="4611859">[</span><span class="op" id="4611860">]</span><span class="builtintype" id="4611861">byte</span><span class="op" id="4611865">)</span>&nbsp;<span class="op" id="4611867">(</span><span class="ident" id="4611868">cipher</span><span class="op" id="4611874">.</span><span class="ident" id="4611875">Block</span><span class="op" id="4611880">,</span>&nbsp;<span class="builtintype" id="4611882">error</span><span class="op" id="4611887">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611890">keySize</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4611901">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4611906">blockSize</span>&nbsp;&nbsp;<span class="builtintype" id="4611917">int</span><br>
<span class="lineno"></span><span class="op" id="4611921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4611924">//&nbsp;rfc1423Algos&nbsp;holds&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;possible&nbsp;ways&nbsp;to&nbsp;encrypt&nbsp;a&nbsp;PEM</span><br>
<span class="lineno">45</span><span class="comment" id="4611992">//&nbsp;block.&nbsp;&nbsp;The&nbsp;ivSize&nbsp;numbers&nbsp;were&nbsp;taken&nbsp;from&nbsp;the&nbsp;OpenSSL&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="4612058">var</span>&nbsp;<span class="ident" id="4612062">rfc1423Algos</span>&nbsp;<span class="op" id="4612075">=</span>&nbsp;<span class="op" id="4612077">[</span><span class="op" id="4612078">]</span><span class="ident" id="4612079">rfc1423Algo</span><span class="op" id="4612090">{</span><span class="op" id="4612091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612094">cipher</span><span class="op" id="4612100">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4612106">PEMCipherDES</span><span class="op" id="4612118">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612121">name</span><span class="op" id="4612125">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4612133">&#34;DES-CBC&#34;</span><span class="op" id="4612142">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612145">cipherFunc</span><span class="op" id="4612155">:</span>&nbsp;<span class="ident" id="4612157">des</span><span class="op" id="4612160">.</span><span class="ident" id="4612161">NewCipher</span><span class="op" id="4612170">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612173">keySize</span><span class="op" id="4612180">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4612185">8</span><span class="op" id="4612186">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612189">blockSize</span><span class="op" id="4612198">:</span>&nbsp;&nbsp;<span class="ident" id="4612201">des</span><span class="op" id="4612204">.</span><span class="ident" id="4612205">BlockSize</span><span class="op" id="4612214">,</span><br>
<span class="lineno"></span><span class="op" id="4612216">}</span><span class="op" id="4612217">,</span>&nbsp;<span class="op" id="4612219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612222">cipher</span><span class="op" id="4612228">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4612234">PEMCipher3DES</span><span class="op" id="4612247">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612250">name</span><span class="op" id="4612254">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4612262">&#34;DES-EDE3-CBC&#34;</span><span class="op" id="4612276">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612279">cipherFunc</span><span class="op" id="4612289">:</span>&nbsp;<span class="ident" id="4612291">des</span><span class="op" id="4612294">.</span><span class="ident" id="4612295">NewTripleDESCipher</span><span class="op" id="4612313">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612316">keySize</span><span class="op" id="4612323">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4612328">24</span><span class="op" id="4612330">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612333">blockSize</span><span class="op" id="4612342">:</span>&nbsp;&nbsp;<span class="ident" id="4612345">des</span><span class="op" id="4612348">.</span><span class="ident" id="4612349">BlockSize</span><span class="op" id="4612358">,</span><br>
<span class="lineno"></span><span class="op" id="4612360">}</span><span class="op" id="4612361">,</span>&nbsp;<span class="op" id="4612363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612366">cipher</span><span class="op" id="4612372">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4612378">PEMCipherAES128</span><span class="op" id="4612393">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612396">name</span><span class="op" id="4612400">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4612408">&#34;AES-128-CBC&#34;</span><span class="op" id="4612421">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612424">cipherFunc</span><span class="op" id="4612434">:</span>&nbsp;<span class="ident" id="4612436">aes</span><span class="op" id="4612439">.</span><span class="ident" id="4612440">NewCipher</span><span class="op" id="4612449">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612452">keySize</span><span class="op" id="4612459">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4612464">16</span><span class="op" id="4612466">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612469">blockSize</span><span class="op" id="4612478">:</span>&nbsp;&nbsp;<span class="ident" id="4612481">aes</span><span class="op" id="4612484">.</span><span class="ident" id="4612485">BlockSize</span><span class="op" id="4612494">,</span><br>
<span class="lineno"></span><span class="op" id="4612496">}</span><span class="op" id="4612497">,</span>&nbsp;<span class="op" id="4612499">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612502">cipher</span><span class="op" id="4612508">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4612514">PEMCipherAES192</span><span class="op" id="4612529">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612532">name</span><span class="op" id="4612536">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4612544">&#34;AES-192-CBC&#34;</span><span class="op" id="4612557">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612560">cipherFunc</span><span class="op" id="4612570">:</span>&nbsp;<span class="ident" id="4612572">aes</span><span class="op" id="4612575">.</span><span class="ident" id="4612576">NewCipher</span><span class="op" id="4612585">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612588">keySize</span><span class="op" id="4612595">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4612600">24</span><span class="op" id="4612602">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612605">blockSize</span><span class="op" id="4612614">:</span>&nbsp;&nbsp;<span class="ident" id="4612617">aes</span><span class="op" id="4612620">.</span><span class="ident" id="4612621">BlockSize</span><span class="op" id="4612630">,</span><br>
<span class="lineno">70</span><span class="op" id="4612632">}</span><span class="op" id="4612633">,</span>&nbsp;<span class="op" id="4612635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612638">cipher</span><span class="op" id="4612644">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4612650">PEMCipherAES256</span><span class="op" id="4612665">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612668">name</span><span class="op" id="4612672">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4612680">&#34;AES-256-CBC&#34;</span><span class="op" id="4612693">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612696">cipherFunc</span><span class="op" id="4612706">:</span>&nbsp;<span class="ident" id="4612708">aes</span><span class="op" id="4612711">.</span><span class="ident" id="4612712">NewCipher</span><span class="op" id="4612721">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612724">keySize</span><span class="op" id="4612731">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="4612736">32</span><span class="op" id="4612738">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4612741">blockSize</span><span class="op" id="4612750">:</span>&nbsp;&nbsp;<span class="ident" id="4612753">aes</span><span class="op" id="4612756">.</span><span class="ident" id="4612757">BlockSize</span><span class="op" id="4612766">,</span><br>
<span class="lineno"></span><span class="op" id="4612768">}</span><span class="op" id="4612769">,</span><br>
<span class="lineno"></span><span class="op" id="4612771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4612774">//&nbsp;deriveKey&nbsp;uses&nbsp;a&nbsp;key&nbsp;derivation&nbsp;function&nbsp;to&nbsp;stretch&nbsp;the&nbsp;password&nbsp;into&nbsp;a&nbsp;key</span><br>
<span class="lineno">80</span><span class="comment" id="4612853">//&nbsp;with&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;our&nbsp;cipher&nbsp;requires.&nbsp;This&nbsp;algorithm&nbsp;was&nbsp;derived&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="4612933">//&nbsp;the&nbsp;OpenSSL&nbsp;source.</span><br>
<span class="lineno"></span><span class="keyword" id="4612956">func</span>&nbsp;<span class="op" id="4612961">(</span><span class="ident" id="4612962">c</span>&nbsp;<span class="ident" id="4612964">rfc1423Algo</span><span class="op" id="4612975">)</span>&nbsp;<span class="ident" id="4612977">deriveKey</span><span class="op" id="4612986">(</span><span class="ident" id="4612987">password</span><span class="op" id="4612995">,</span>&nbsp;<span class="ident" id="4612997">salt</span>&nbsp;<span class="op" id="4613002">[</span><span class="op" id="4613003">]</span><span class="builtintype" id="4613004">byte</span><span class="op" id="4613008">)</span>&nbsp;<span class="op" id="4613010">[</span><span class="op" id="4613011">]</span><span class="builtintype" id="4613012">byte</span>&nbsp;<span class="op" id="4613017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4613020">hash</span>&nbsp;<span class="op" id="4613025">:=</span>&nbsp;<span class="ident" id="4613028">md5</span><span class="op" id="4613031">.</span><span class="ident" id="4613032">New</span><span class="op" id="4613035">(</span><span class="op" id="4613036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4613039">out</span>&nbsp;<span class="op" id="4613043">:=</span>&nbsp;<span class="builtinfunc" id="4613046">make</span><span class="op" id="4613050">(</span><span class="op" id="4613051">[</span><span class="op" id="4613052">]</span><span class="builtintype" id="4613053">byte</span><span class="op" id="4613057">,</span>&nbsp;<span class="ident" id="4613059">c</span><span class="op" id="4613060">.</span><span class="ident" id="4613061">keySize</span><span class="op" id="4613068">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4613071">var</span>&nbsp;<span class="ident" id="4613075">digest</span>&nbsp;<span class="op" id="4613082">[</span><span class="op" id="4613083">]</span><span class="builtintype" id="4613084">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4613091">for</span>&nbsp;<span class="ident" id="4613095">i</span>&nbsp;<span class="op" id="4613097">:=</span>&nbsp;<span class="num" id="4613100">0</span><span class="op" id="4613101">;</span>&nbsp;<span class="ident" id="4613103">i</span>&nbsp;<span class="op" id="4613105">&lt;</span>&nbsp;<span class="builtinfunc" id="4613107">len</span><span class="op" id="4613110">(</span><span class="ident" id="4613111">out</span><span class="op" id="4613114">)</span><span class="op" id="4613115">;</span>&nbsp;<span class="ident" id="4613117">i</span>&nbsp;<span class="op" id="4613119">+=</span>&nbsp;<span class="builtinfunc" id="4613122">len</span><span class="op" id="4613125">(</span><span class="ident" id="4613126">digest</span><span class="op" id="4613132">)</span>&nbsp;<span class="op" id="4613134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4613138">hash</span><span class="op" id="4613142">.</span><span class="ident" id="4613143">Reset</span><span class="op" id="4613148">(</span><span class="op" id="4613149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4613153">hash</span><span class="op" id="4613157">.</span><span class="ident" id="4613158">Write</span><span class="op" id="4613163">(</span><span class="ident" id="4613164">digest</span><span class="op" id="4613170">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4613174">hash</span><span class="op" id="4613178">.</span><span class="ident" id="4613179">Write</span><span class="op" id="4613184">(</span><span class="ident" id="4613185">password</span><span class="op" id="4613193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4613197">hash</span><span class="op" id="4613201">.</span><span class="ident" id="4613202">Write</span><span class="op" id="4613207">(</span><span class="ident" id="4613208">salt</span><span class="op" id="4613212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4613216">digest</span>&nbsp;<span class="op" id="4613223">=</span>&nbsp;<span class="ident" id="4613225">hash</span><span class="op" id="4613229">.</span><span class="ident" id="4613230">Sum</span><span class="op" id="4613233">(</span><span class="ident" id="4613234">digest</span><span class="op" id="4613240">[</span><span class="op" id="4613241">:</span><span class="num" id="4613242">0</span><span class="op" id="4613243">]</span><span class="op" id="4613244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4613248">copy</span><span class="op" id="4613252">(</span><span class="ident" id="4613253">out</span><span class="op" id="4613256">[</span><span class="ident" id="4613257">i</span><span class="op" id="4613258">:</span><span class="op" id="4613259">]</span><span class="op" id="4613260">,</span>&nbsp;<span class="ident" id="4613262">digest</span><span class="op" id="4613268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4613271">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4613274">return</span>&nbsp;<span class="ident" id="4613281">out</span><br>
<span class="lineno"></span><span class="op" id="4613285">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4613288">//&nbsp;IsEncryptedPEMBlock&nbsp;returns&nbsp;if&nbsp;the&nbsp;PEM&nbsp;block&nbsp;is&nbsp;password&nbsp;encrypted.</span><br>
<span class="lineno"></span><span class="keyword" id="4613359">func</span>&nbsp;<span class="ident" id="4613364">IsEncryptedPEMBlock</span><span class="op" id="4613383">(</span><span class="ident" id="4613384">b</span>&nbsp;<span class="op" id="4613386">*</span><span class="ident" id="4613387">pem</span><span class="op" id="4613390">.</span><span class="ident" id="4613391">Block</span><span class="op" id="4613396">)</span>&nbsp;<span class="builtintype" id="4613398">bool</span>&nbsp;<span class="op" id="4613403">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4613406">_</span><span class="op" id="4613407">,</span>&nbsp;<span class="ident" id="4613409">ok</span>&nbsp;<span class="op" id="4613412">:=</span>&nbsp;<span class="ident" id="4613415">b</span><span class="op" id="4613416">.</span><span class="ident" id="4613417">Headers</span><span class="op" id="4613424">[</span><span class="string" id="4613425">&#34;DEK-Info&#34;</span><span class="op" id="4613435">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4613438">return</span>&nbsp;<span class="ident" id="4613445">ok</span><br>
<span class="lineno"></span><span class="op" id="4613448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4613451">//&nbsp;IncorrectPasswordError&nbsp;is&nbsp;returned&nbsp;when&nbsp;an&nbsp;incorrect&nbsp;password&nbsp;is&nbsp;detected.</span><br>
<span class="lineno">105</span><span class="keyword" id="4613529">var</span>&nbsp;<span class="ident" id="4613533">IncorrectPasswordError</span>&nbsp;<span class="op" id="4613556">=</span>&nbsp;<span class="ident" id="4613558">errors</span><span class="op" id="4613564">.</span><span class="ident" id="4613565">New</span><span class="op" id="4613568">(</span><span class="string" id="4613569">&#34;x509:&nbsp;decryption&nbsp;password&nbsp;incorrect&#34;</span><span class="op" id="4613606">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4613609">//&nbsp;DecryptPEMBlock&nbsp;takes&nbsp;a&nbsp;password&nbsp;encrypted&nbsp;PEM&nbsp;block&nbsp;and&nbsp;the&nbsp;password&nbsp;used&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4613690">//&nbsp;encrypt&nbsp;it&nbsp;and&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;decrypted&nbsp;DER&nbsp;encoded&nbsp;bytes.&nbsp;It&nbsp;inspects</span><br>
<span class="lineno"></span><span class="comment" id="4613768">//&nbsp;the&nbsp;DEK-Info&nbsp;header&nbsp;to&nbsp;determine&nbsp;the&nbsp;algorithm&nbsp;used&nbsp;for&nbsp;decryption.&nbsp;If&nbsp;no</span><br>
<span class="lineno">110</span><span class="comment" id="4613845">//&nbsp;DEK-Info&nbsp;header&nbsp;is&nbsp;present,&nbsp;an&nbsp;error&nbsp;is&nbsp;returned.&nbsp;If&nbsp;an&nbsp;incorrect&nbsp;password</span><br>
<span class="lineno"></span><span class="comment" id="4613923">//&nbsp;is&nbsp;detected&nbsp;an&nbsp;IncorrectPasswordError&nbsp;is&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="4613977">func</span>&nbsp;<span class="ident" id="4613982">DecryptPEMBlock</span><span class="op" id="4613997">(</span><span class="ident" id="4613998">b</span>&nbsp;<span class="op" id="4614000">*</span><span class="ident" id="4614001">pem</span><span class="op" id="4614004">.</span><span class="ident" id="4614005">Block</span><span class="op" id="4614010">,</span>&nbsp;<span class="ident" id="4614012">password</span>&nbsp;<span class="op" id="4614021">[</span><span class="op" id="4614022">]</span><span class="builtintype" id="4614023">byte</span><span class="op" id="4614027">)</span>&nbsp;<span class="op" id="4614029">(</span><span class="op" id="4614030">[</span><span class="op" id="4614031">]</span><span class="builtintype" id="4614032">byte</span><span class="op" id="4614036">,</span>&nbsp;<span class="builtintype" id="4614038">error</span><span class="op" id="4614043">)</span>&nbsp;<span class="op" id="4614045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4614048">dek</span><span class="op" id="4614051">,</span>&nbsp;<span class="ident" id="4614053">ok</span>&nbsp;<span class="op" id="4614056">:=</span>&nbsp;<span class="ident" id="4614059">b</span><span class="op" id="4614060">.</span><span class="ident" id="4614061">Headers</span><span class="op" id="4614068">[</span><span class="string" id="4614069">&#34;DEK-Info&#34;</span><span class="op" id="4614079">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4614082">if</span>&nbsp;<span class="op" id="4614085">!</span><span class="ident" id="4614086">ok</span>&nbsp;<span class="op" id="4614089">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4614093">return</span>&nbsp;<span class="ident" id="4614100">nil</span><span class="op" id="4614103">,</span>&nbsp;<span class="ident" id="4614105">errors</span><span class="op" id="4614111">.</span><span class="ident" id="4614112">New</span><span class="op" id="4614115">(</span><span class="string" id="4614116">&#34;x509:&nbsp;no&nbsp;DEK-Info&nbsp;header&nbsp;in&nbsp;block&#34;</span><span class="op" id="4614151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4614154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4614158">idx</span>&nbsp;<span class="op" id="4614162">:=</span>&nbsp;<span class="ident" id="4614165">strings</span><span class="op" id="4614172">.</span><span class="ident" id="4614173">Index</span><span class="op" id="4614178">(</span><span class="ident" id="4614179">dek</span><span class="op" id="4614182">,</span>&nbsp;<span class="string" id="4614184">&#34;,&#34;</span><span class="op" id="4614187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4614190">if</span>&nbsp;<span class="ident" id="4614193">idx</span>&nbsp;<span class="op" id="4614197">==</span>&nbsp;<span class="op" id="4614200">-</span><span class="num" id="4614201">1</span>&nbsp;<span class="op" id="4614203">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4614207">return</span>&nbsp;<span class="ident" id="4614214">nil</span><span class="op" id="4614217">,</span>&nbsp;<span class="ident" id="4614219">errors</span><span class="op" id="4614225">.</span><span class="ident" id="4614226">New</span><span class="op" id="4614229">(</span><span class="string" id="4614230">&#34;x509:&nbsp;malformed&nbsp;DEK-Info&nbsp;header&#34;</span><span class="op" id="4614263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4614266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4614270">mode</span><span class="op" id="4614274">,</span>&nbsp;<span class="ident" id="4614276">hexIV</span>&nbsp;<span class="op" id="4614282">:=</span>&nbsp;<span class="ident" id="4614285">dek</span><span class="op" id="4614288">[</span><span class="op" id="4614289">:</span><span class="ident" id="4614290">idx</span><span class="op" id="4614293">]</span><span class="op" id="4614294">,</span>&nbsp;<span class="ident" id="4614296">dek</span><span class="op" id="4614299">[</span><span class="ident" id="4614300">idx</span><span class="op" id="4614303">+</span><span class="num" id="4614304">1</span><span class="op" id="4614305">:</span><span class="op" id="4614306">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4614309">ciph</span>&nbsp;<span class="op" id="4614314">:=</span>&nbsp;<span class="ident" id="4614317">cipherByName</span><span class="op" id="4614329">(</span><span class="ident" id="4614330">mode</span><span class="op" id="4614334">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4614337">if</span>&nbsp;<span class="ident" id="4614340">ciph</span>&nbsp;<span class="op" id="4614345">==</span>&nbsp;<span class="ident" id="4614348">nil</span>&nbsp;<span class="op" id="4614352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4614356">return</span>&nbsp;<span class="ident" id="4614363">nil</span><span class="op" id="4614366">,</span>&nbsp;<span class="ident" id="4614368">errors</span><span class="op" id="4614374">.</span><span class="ident" id="4614375">New</span><span class="op" id="4614378">(</span><span class="string" id="4614379">&#34;x509:&nbsp;unknown&nbsp;encryption&nbsp;mode&#34;</span><span class="op" id="4614410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4614413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4614416">iv</span><span class="op" id="4614418">,</span>&nbsp;<span class="ident" id="4614420">err</span>&nbsp;<span class="op" id="4614424">:=</span>&nbsp;<span class="ident" id="4614427">hex</span><span class="op" id="4614430">.</span><span class="ident" id="4614431">DecodeString</span><span class="op" id="4614443">(</span><span class="ident" id="4614444">hexIV</span><span class="op" id="4614449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4614452">if</span>&nbsp;<span class="ident" id="4614455">err</span>&nbsp;<span class="op" id="4614459">!=</span>&nbsp;<span class="ident" id="4614462">nil</span>&nbsp;<span class="op" id="4614466">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4614470">return</span>&nbsp;<span class="ident" id="4614477">nil</span><span class="op" id="4614480">,</span>&nbsp;<span class="ident" id="4614482">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4614487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4614490">if</span>&nbsp;<span class="builtinfunc" id="4614493">len</span><span class="op" id="4614496">(</span><span class="ident" id="4614497">iv</span><span class="op" id="4614499">)</span>&nbsp;<span class="op" id="4614501">!=</span>&nbsp;<span class="ident" id="4614504">ciph</span><span class="op" id="4614508">.</span><span class="ident" id="4614509">blockSize</span>&nbsp;<span class="op" id="4614519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4614523">return</span>&nbsp;<span class="ident" id="4614530">nil</span><span class="op" id="4614533">,</span>&nbsp;<span class="ident" id="4614535">errors</span><span class="op" id="4614541">.</span><span class="ident" id="4614542">New</span><span class="op" id="4614545">(</span><span class="string" id="4614546">&#34;x509:&nbsp;incorrect&nbsp;IV&nbsp;size&#34;</span><span class="op" id="4614571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4614574">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4614578">//&nbsp;Based&nbsp;on&nbsp;the&nbsp;OpenSSL&nbsp;implementation.&nbsp;The&nbsp;salt&nbsp;is&nbsp;the&nbsp;first&nbsp;8&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4614649">//&nbsp;of&nbsp;the&nbsp;initialization&nbsp;vector.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4614683">key</span>&nbsp;<span class="op" id="4614687">:=</span>&nbsp;<span class="ident" id="4614690">ciph</span><span class="op" id="4614694">.</span><span class="ident" id="4614695">deriveKey</span><span class="op" id="4614704">(</span><span class="ident" id="4614705">password</span><span class="op" id="4614713">,</span>&nbsp;<span class="ident" id="4614715">iv</span><span class="op" id="4614717">[</span><span class="op" id="4614718">:</span><span class="num" id="4614719">8</span><span class="op" id="4614720">]</span><span class="op" id="4614721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4614724">block</span><span class="op" id="4614729">,</span>&nbsp;<span class="ident" id="4614731">err</span>&nbsp;<span class="op" id="4614735">:=</span>&nbsp;<span class="ident" id="4614738">ciph</span><span class="op" id="4614742">.</span><span class="ident" id="4614743">cipherFunc</span><span class="op" id="4614753">(</span><span class="ident" id="4614754">key</span><span class="op" id="4614757">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4614760">if</span>&nbsp;<span class="ident" id="4614763">err</span>&nbsp;<span class="op" id="4614767">!=</span>&nbsp;<span class="ident" id="4614770">nil</span>&nbsp;<span class="op" id="4614774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4614778">return</span>&nbsp;<span class="ident" id="4614785">nil</span><span class="op" id="4614788">,</span>&nbsp;<span class="ident" id="4614790">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4614795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4614799">data</span>&nbsp;<span class="op" id="4614804">:=</span>&nbsp;<span class="builtinfunc" id="4614807">make</span><span class="op" id="4614811">(</span><span class="op" id="4614812">[</span><span class="op" id="4614813">]</span><span class="builtintype" id="4614814">byte</span><span class="op" id="4614818">,</span>&nbsp;<span class="builtinfunc" id="4614820">len</span><span class="op" id="4614823">(</span><span class="ident" id="4614824">b</span><span class="op" id="4614825">.</span><span class="ident" id="4614826">Bytes</span><span class="op" id="4614831">)</span><span class="op" id="4614832">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4614835">dec</span>&nbsp;<span class="op" id="4614839">:=</span>&nbsp;<span class="ident" id="4614842">cipher</span><span class="op" id="4614848">.</span><span class="ident" id="4614849">NewCBCDecrypter</span><span class="op" id="4614864">(</span><span class="ident" id="4614865">block</span><span class="op" id="4614870">,</span>&nbsp;<span class="ident" id="4614872">iv</span><span class="op" id="4614874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4614877">dec</span><span class="op" id="4614880">.</span><span class="ident" id="4614881">CryptBlocks</span><span class="op" id="4614892">(</span><span class="ident" id="4614893">data</span><span class="op" id="4614897">,</span>&nbsp;<span class="ident" id="4614899">b</span><span class="op" id="4614900">.</span><span class="ident" id="4614901">Bytes</span><span class="op" id="4614906">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4614910">//&nbsp;Blocks&nbsp;are&nbsp;padded&nbsp;using&nbsp;a&nbsp;scheme&nbsp;where&nbsp;the&nbsp;last&nbsp;n&nbsp;bytes&nbsp;of&nbsp;padding&nbsp;are&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4614989">//&nbsp;equal&nbsp;to&nbsp;n.&nbsp;It&nbsp;can&nbsp;pad&nbsp;from&nbsp;1&nbsp;to&nbsp;blocksize&nbsp;bytes&nbsp;inclusive.&nbsp;See&nbsp;RFC&nbsp;1423.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4615067">//&nbsp;For&nbsp;example:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4615084">//&nbsp;&nbsp;&nbsp;&nbsp[x&nbsp;y&nbsp;z&nbsp;2&nbsp;2]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4615100">//&nbsp;&nbsp;&nbsp;&nbsp[x&nbsp;y&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7&nbsp;7]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4615124">//&nbsp;If&nbsp;we&nbsp;detect&nbsp;a&nbsp;bad&nbsp;padding,&nbsp;we&nbsp;assume&nbsp;it&nbsp;is&nbsp;an&nbsp;invalid&nbsp;password.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4615193">dlen</span>&nbsp;<span class="op" id="4615198">:=</span>&nbsp;<span class="builtinfunc" id="4615201">len</span><span class="op" id="4615204">(</span><span class="ident" id="4615205">data</span><span class="op" id="4615209">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4615212">if</span>&nbsp;<span class="ident" id="4615215">dlen</span>&nbsp;<span class="op" id="4615220">==</span>&nbsp;<span class="num" id="4615223">0</span>&nbsp;<span class="op" id="4615225">||</span>&nbsp;<span class="ident" id="4615228">dlen</span><span class="op" id="4615232">%</span><span class="ident" id="4615233">ciph</span><span class="op" id="4615237">.</span><span class="ident" id="4615238">blockSize</span>&nbsp;<span class="op" id="4615248">!=</span>&nbsp;<span class="num" id="4615251">0</span>&nbsp;<span class="op" id="4615253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4615257">return</span>&nbsp;<span class="ident" id="4615264">nil</span><span class="op" id="4615267">,</span>&nbsp;<span class="ident" id="4615269">errors</span><span class="op" id="4615275">.</span><span class="ident" id="4615276">New</span><span class="op" id="4615279">(</span><span class="string" id="4615280">&#34;x509:&nbsp;invalid&nbsp;padding&#34;</span><span class="op" id="4615303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4615306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4615309">last</span>&nbsp;<span class="op" id="4615314">:=</span>&nbsp;<span class="builtintype" id="4615317">int</span><span class="op" id="4615320">(</span><span class="ident" id="4615321">data</span><span class="op" id="4615325">[</span><span class="ident" id="4615326">dlen</span><span class="op" id="4615330">-</span><span class="num" id="4615331">1</span><span class="op" id="4615332">]</span><span class="op" id="4615333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4615336">if</span>&nbsp;<span class="ident" id="4615339">dlen</span>&nbsp;<span class="op" id="4615344">&lt;</span>&nbsp;<span class="ident" id="4615346">last</span>&nbsp;<span class="op" id="4615351">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4615355">return</span>&nbsp;<span class="ident" id="4615362">nil</span><span class="op" id="4615365">,</span>&nbsp;<span class="ident" id="4615367">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4615391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4615394">if</span>&nbsp;<span class="ident" id="4615397">last</span>&nbsp;<span class="op" id="4615402">==</span>&nbsp;<span class="num" id="4615405">0</span>&nbsp;<span class="op" id="4615407">||</span>&nbsp;<span class="ident" id="4615410">last</span>&nbsp;<span class="op" id="4615415">&gt;</span>&nbsp;<span class="ident" id="4615417">ciph</span><span class="op" id="4615421">.</span><span class="ident" id="4615422">blockSize</span>&nbsp;<span class="op" id="4615432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4615436">return</span>&nbsp;<span class="ident" id="4615443">nil</span><span class="op" id="4615446">,</span>&nbsp;<span class="ident" id="4615448">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4615472">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4615475">for</span>&nbsp;<span class="ident" id="4615479">_</span><span class="op" id="4615480">,</span>&nbsp;<span class="ident" id="4615482">val</span>&nbsp;<span class="op" id="4615486">:=</span>&nbsp;<span class="keyword" id="4615489">range</span>&nbsp;<span class="ident" id="4615495">data</span><span class="op" id="4615499">[</span><span class="ident" id="4615500">dlen</span><span class="op" id="4615504">-</span><span class="ident" id="4615505">last</span><span class="op" id="4615509">:</span><span class="op" id="4615510">]</span>&nbsp;<span class="op" id="4615512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4615516">if</span>&nbsp;<span class="builtintype" id="4615519">int</span><span class="op" id="4615522">(</span><span class="ident" id="4615523">val</span><span class="op" id="4615526">)</span>&nbsp;<span class="op" id="4615528">!=</span>&nbsp;<span class="ident" id="4615531">last</span>&nbsp;<span class="op" id="4615536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4615541">return</span>&nbsp;<span class="ident" id="4615548">nil</span><span class="op" id="4615551">,</span>&nbsp;<span class="ident" id="4615553">IncorrectPasswordError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4615578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4615581">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4615584">return</span>&nbsp;<span class="ident" id="4615591">data</span><span class="op" id="4615595">[</span><span class="op" id="4615596">:</span><span class="ident" id="4615597">dlen</span><span class="op" id="4615601">-</span><span class="ident" id="4615602">last</span><span class="op" id="4615606">]</span><span class="op" id="4615607">,</span>&nbsp;<span class="ident" id="4615609">nil</span><br>
<span class="lineno"></span><span class="op" id="4615613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4615616">//&nbsp;EncryptPEMBlock&nbsp;returns&nbsp;a&nbsp;PEM&nbsp;block&nbsp;of&nbsp;the&nbsp;specified&nbsp;type&nbsp;holding&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4615689">//&nbsp;given&nbsp;DER-encoded&nbsp;data&nbsp;encrypted&nbsp;with&nbsp;the&nbsp;specified&nbsp;algorithm&nbsp;and</span><br>
<span class="lineno">175</span><span class="comment" id="4615758">//&nbsp;password.</span><br>
<span class="lineno"></span><span class="keyword" id="4615771">func</span>&nbsp;<span class="ident" id="4615776">EncryptPEMBlock</span><span class="op" id="4615791">(</span><span class="ident" id="4615792">rand</span>&nbsp;<span class="ident" id="4615797">io</span><span class="op" id="4615799">.</span><span class="ident" id="4615800">Reader</span><span class="op" id="4615806">,</span>&nbsp;<span class="ident" id="4615808">blockType</span>&nbsp;<span class="builtintype" id="4615818">string</span><span class="op" id="4615824">,</span>&nbsp;<span class="ident" id="4615826">data</span><span class="op" id="4615830">,</span>&nbsp;<span class="ident" id="4615832">password</span>&nbsp;<span class="op" id="4615841">[</span><span class="op" id="4615842">]</span><span class="builtintype" id="4615843">byte</span><span class="op" id="4615847">,</span>&nbsp;<span class="ident" id="4615849">alg</span>&nbsp;<span class="ident" id="4615853">PEMCipher</span><span class="op" id="4615862">)</span>&nbsp;<span class="op" id="4615864">(</span><span class="op" id="4615865">*</span><span class="ident" id="4615866">pem</span><span class="op" id="4615869">.</span><span class="ident" id="4615870">Block</span><span class="op" id="4615875">,</span>&nbsp;<span class="builtintype" id="4615877">error</span><span class="op" id="4615882">)</span>&nbsp;<span class="op" id="4615884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4615887">ciph</span>&nbsp;<span class="op" id="4615892">:=</span>&nbsp;<span class="ident" id="4615895">cipherByKey</span><span class="op" id="4615906">(</span><span class="ident" id="4615907">alg</span><span class="op" id="4615910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4615913">if</span>&nbsp;<span class="ident" id="4615916">ciph</span>&nbsp;<span class="op" id="4615921">==</span>&nbsp;<span class="ident" id="4615924">nil</span>&nbsp;<span class="op" id="4615928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4615932">return</span>&nbsp;<span class="ident" id="4615939">nil</span><span class="op" id="4615942">,</span>&nbsp;<span class="ident" id="4615944">errors</span><span class="op" id="4615950">.</span><span class="ident" id="4615951">New</span><span class="op" id="4615954">(</span><span class="string" id="4615955">&#34;x509:&nbsp;unknown&nbsp;encryption&nbsp;mode&#34;</span><span class="op" id="4615986">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4615989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4615992">iv</span>&nbsp;<span class="op" id="4615995">:=</span>&nbsp;<span class="builtinfunc" id="4615998">make</span><span class="op" id="4616002">(</span><span class="op" id="4616003">[</span><span class="op" id="4616004">]</span><span class="builtintype" id="4616005">byte</span><span class="op" id="4616009">,</span>&nbsp;<span class="ident" id="4616011">ciph</span><span class="op" id="4616015">.</span><span class="ident" id="4616016">blockSize</span><span class="op" id="4616025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4616028">if</span>&nbsp;<span class="ident" id="4616031">_</span><span class="op" id="4616032">,</span>&nbsp;<span class="ident" id="4616034">err</span>&nbsp;<span class="op" id="4616038">:=</span>&nbsp;<span class="ident" id="4616041">io</span><span class="op" id="4616043">.</span><span class="ident" id="4616044">ReadFull</span><span class="op" id="4616052">(</span><span class="ident" id="4616053">rand</span><span class="op" id="4616057">,</span>&nbsp;<span class="ident" id="4616059">iv</span><span class="op" id="4616061">)</span><span class="op" id="4616062">;</span>&nbsp;<span class="ident" id="4616064">err</span>&nbsp;<span class="op" id="4616068">!=</span>&nbsp;<span class="ident" id="4616071">nil</span>&nbsp;<span class="op" id="4616075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4616079">return</span>&nbsp;<span class="ident" id="4616086">nil</span><span class="op" id="4616089">,</span>&nbsp;<span class="ident" id="4616091">errors</span><span class="op" id="4616097">.</span><span class="ident" id="4616098">New</span><span class="op" id="4616101">(</span><span class="string" id="4616102">&#34;x509:&nbsp;cannot&nbsp;generate&nbsp;IV:&nbsp;&#34;</span>&nbsp;<span class="op" id="4616131">+</span>&nbsp;<span class="ident" id="4616133">err</span><span class="op" id="4616136">.</span><span class="ident" id="4616137">Error</span><span class="op" id="4616142">(</span><span class="op" id="4616143">)</span><span class="op" id="4616144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4616147">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4616150">//&nbsp;The&nbsp;salt&nbsp;is&nbsp;the&nbsp;first&nbsp;8&nbsp;bytes&nbsp;of&nbsp;the&nbsp;initialization&nbsp;vector,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4616214">//&nbsp;matching&nbsp;the&nbsp;key&nbsp;derivation&nbsp;in&nbsp;DecryptPEMBlock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4616266">key</span>&nbsp;<span class="op" id="4616270">:=</span>&nbsp;<span class="ident" id="4616273">ciph</span><span class="op" id="4616277">.</span><span class="ident" id="4616278">deriveKey</span><span class="op" id="4616287">(</span><span class="ident" id="4616288">password</span><span class="op" id="4616296">,</span>&nbsp;<span class="ident" id="4616298">iv</span><span class="op" id="4616300">[</span><span class="op" id="4616301">:</span><span class="num" id="4616302">8</span><span class="op" id="4616303">]</span><span class="op" id="4616304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4616307">block</span><span class="op" id="4616312">,</span>&nbsp;<span class="ident" id="4616314">err</span>&nbsp;<span class="op" id="4616318">:=</span>&nbsp;<span class="ident" id="4616321">ciph</span><span class="op" id="4616325">.</span><span class="ident" id="4616326">cipherFunc</span><span class="op" id="4616336">(</span><span class="ident" id="4616337">key</span><span class="op" id="4616340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4616343">if</span>&nbsp;<span class="ident" id="4616346">err</span>&nbsp;<span class="op" id="4616350">!=</span>&nbsp;<span class="ident" id="4616353">nil</span>&nbsp;<span class="op" id="4616357">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4616361">return</span>&nbsp;<span class="ident" id="4616368">nil</span><span class="op" id="4616371">,</span>&nbsp;<span class="ident" id="4616373">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4616378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4616381">enc</span>&nbsp;<span class="op" id="4616385">:=</span>&nbsp;<span class="ident" id="4616388">cipher</span><span class="op" id="4616394">.</span><span class="ident" id="4616395">NewCBCEncrypter</span><span class="op" id="4616410">(</span><span class="ident" id="4616411">block</span><span class="op" id="4616416">,</span>&nbsp;<span class="ident" id="4616418">iv</span><span class="op" id="4616420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4616423">pad</span>&nbsp;<span class="op" id="4616427">:=</span>&nbsp;<span class="ident" id="4616430">ciph</span><span class="op" id="4616434">.</span><span class="ident" id="4616435">blockSize</span>&nbsp;<span class="op" id="4616445">-</span>&nbsp;<span class="builtinfunc" id="4616447">len</span><span class="op" id="4616450">(</span><span class="ident" id="4616451">data</span><span class="op" id="4616455">)</span><span class="op" id="4616456">%</span><span class="ident" id="4616457">ciph</span><span class="op" id="4616461">.</span><span class="ident" id="4616462">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4616473">encrypted</span>&nbsp;<span class="op" id="4616483">:=</span>&nbsp;<span class="builtinfunc" id="4616486">make</span><span class="op" id="4616490">(</span><span class="op" id="4616491">[</span><span class="op" id="4616492">]</span><span class="builtintype" id="4616493">byte</span><span class="op" id="4616497">,</span>&nbsp;<span class="builtinfunc" id="4616499">len</span><span class="op" id="4616502">(</span><span class="ident" id="4616503">data</span><span class="op" id="4616507">)</span><span class="op" id="4616508">,</span>&nbsp;<span class="builtinfunc" id="4616510">len</span><span class="op" id="4616513">(</span><span class="ident" id="4616514">data</span><span class="op" id="4616518">)</span><span class="op" id="4616519">+</span><span class="ident" id="4616520">pad</span><span class="op" id="4616523">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4616526">//&nbsp;We&nbsp;could&nbsp;save&nbsp;this&nbsp;copy&nbsp;by&nbsp;encrypting&nbsp;all&nbsp;the&nbsp;whole&nbsp;blocks&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4616592">//&nbsp;the&nbsp;data&nbsp;separately,&nbsp;but&nbsp;it&nbsp;doesn&#39;t&nbsp;seem&nbsp;worth&nbsp;the&nbsp;additional</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4616658">//&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4616668">copy</span><span class="op" id="4616672">(</span><span class="ident" id="4616673">encrypted</span><span class="op" id="4616682">,</span>&nbsp;<span class="ident" id="4616684">data</span><span class="op" id="4616688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4616691">//&nbsp;See&nbsp;RFC&nbsp;1423,&nbsp;section&nbsp;1.1</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4616721">for</span>&nbsp;<span class="ident" id="4616725">i</span>&nbsp;<span class="op" id="4616727">:=</span>&nbsp;<span class="num" id="4616730">0</span><span class="op" id="4616731">;</span>&nbsp;<span class="ident" id="4616733">i</span>&nbsp;<span class="op" id="4616735">&lt;</span>&nbsp;<span class="ident" id="4616737">pad</span><span class="op" id="4616740">;</span>&nbsp;<span class="ident" id="4616742">i</span><span class="op" id="4616743">++</span>&nbsp;<span class="op" id="4616746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4616750">encrypted</span>&nbsp;<span class="op" id="4616760">=</span>&nbsp;<span class="builtinfunc" id="4616762">append</span><span class="op" id="4616768">(</span><span class="ident" id="4616769">encrypted</span><span class="op" id="4616778">,</span>&nbsp;<span class="builtintype" id="4616780">byte</span><span class="op" id="4616784">(</span><span class="ident" id="4616785">pad</span><span class="op" id="4616788">)</span><span class="op" id="4616789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4616792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4616795">enc</span><span class="op" id="4616798">.</span><span class="ident" id="4616799">CryptBlocks</span><span class="op" id="4616810">(</span><span class="ident" id="4616811">encrypted</span><span class="op" id="4616820">,</span>&nbsp;<span class="ident" id="4616822">encrypted</span><span class="op" id="4616831">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4616835">return</span>&nbsp;<span class="op" id="4616842">&amp;</span><span class="ident" id="4616843">pem</span><span class="op" id="4616846">.</span><span class="ident" id="4616847">Block</span><span class="op" id="4616852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4616856">Type</span><span class="op" id="4616860">:</span>&nbsp;<span class="ident" id="4616862">blockType</span><span class="op" id="4616871">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4616875">Headers</span><span class="op" id="4616882">:</span>&nbsp;<span class="keyword" id="4616884">map</span><span class="op" id="4616887">[</span><span class="builtintype" id="4616888">string</span><span class="op" id="4616894">]</span><span class="builtintype" id="4616895">string</span><span class="op" id="4616901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4616906">&#34;Proc-Type&#34;</span><span class="op" id="4616917">:</span>&nbsp;<span class="string" id="4616919">&#34;4,ENCRYPTED&#34;</span><span class="op" id="4616932">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4616937">&#34;DEK-Info&#34;</span><span class="op" id="4616947">:</span>&nbsp;&nbsp;<span class="ident" id="4616950">ciph</span><span class="op" id="4616954">.</span><span class="ident" id="4616955">name</span>&nbsp;<span class="op" id="4616960">+</span>&nbsp;<span class="string" id="4616962">&#34;,&#34;</span>&nbsp;<span class="op" id="4616966">+</span>&nbsp;<span class="ident" id="4616968">hex</span><span class="op" id="4616971">.</span><span class="ident" id="4616972">EncodeToString</span><span class="op" id="4616986">(</span><span class="ident" id="4616987">iv</span><span class="op" id="4616989">)</span><span class="op" id="4616990">,</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4616994">}</span><span class="op" id="4616995">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4616999">Bytes</span><span class="op" id="4617004">:</span>&nbsp;<span class="ident" id="4617006">encrypted</span><span class="op" id="4617015">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4617018">}</span><span class="op" id="4617019">,</span>&nbsp;<span class="ident" id="4617021">nil</span><br>
<span class="lineno"></span><span class="op" id="4617025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="4617028">func</span>&nbsp;<span class="ident" id="4617033">cipherByName</span><span class="op" id="4617045">(</span><span class="ident" id="4617046">name</span>&nbsp;<span class="builtintype" id="4617051">string</span><span class="op" id="4617057">)</span>&nbsp;<span class="op" id="4617059">*</span><span class="ident" id="4617060">rfc1423Algo</span>&nbsp;<span class="op" id="4617072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4617075">for</span>&nbsp;<span class="ident" id="4617079">i</span>&nbsp;<span class="op" id="4617081">:=</span>&nbsp;<span class="keyword" id="4617084">range</span>&nbsp;<span class="ident" id="4617090">rfc1423Algos</span>&nbsp;<span class="op" id="4617103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4617107">alg</span>&nbsp;<span class="op" id="4617111">:=</span>&nbsp;<span class="op" id="4617114">&amp;</span><span class="ident" id="4617115">rfc1423Algos</span><span class="op" id="4617127">[</span><span class="ident" id="4617128">i</span><span class="op" id="4617129">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4617133">if</span>&nbsp;<span class="ident" id="4617136">alg</span><span class="op" id="4617139">.</span><span class="ident" id="4617140">name</span>&nbsp;<span class="op" id="4617145">==</span>&nbsp;<span class="ident" id="4617148">name</span>&nbsp;<span class="op" id="4617153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4617158">return</span>&nbsp;<span class="ident" id="4617165">alg</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4617171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4617174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4617177">return</span>&nbsp;<span class="ident" id="4617184">nil</span><br>
<span class="lineno"></span><span class="op" id="4617188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="keyword" id="4617191">func</span>&nbsp;<span class="ident" id="4617196">cipherByKey</span><span class="op" id="4617207">(</span><span class="ident" id="4617208">key</span>&nbsp;<span class="ident" id="4617212">PEMCipher</span><span class="op" id="4617221">)</span>&nbsp;<span class="op" id="4617223">*</span><span class="ident" id="4617224">rfc1423Algo</span>&nbsp;<span class="op" id="4617236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4617239">for</span>&nbsp;<span class="ident" id="4617243">i</span>&nbsp;<span class="op" id="4617245">:=</span>&nbsp;<span class="keyword" id="4617248">range</span>&nbsp;<span class="ident" id="4617254">rfc1423Algos</span>&nbsp;<span class="op" id="4617267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4617271">alg</span>&nbsp;<span class="op" id="4617275">:=</span>&nbsp;<span class="op" id="4617278">&amp;</span><span class="ident" id="4617279">rfc1423Algos</span><span class="op" id="4617291">[</span><span class="ident" id="4617292">i</span><span class="op" id="4617293">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4617297">if</span>&nbsp;<span class="ident" id="4617300">alg</span><span class="op" id="4617303">.</span><span class="ident" id="4617304">cipher</span>&nbsp;<span class="op" id="4617311">==</span>&nbsp;<span class="ident" id="4617314">key</span>&nbsp;<span class="op" id="4617318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4617323">return</span>&nbsp;<span class="ident" id="4617330">alg</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4617336">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4617339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4617342">return</span>&nbsp;<span class="ident" id="4617349">nil</span><br>
<span class="lineno"></span><span class="op" id="4617353">}</span>
</div>
</body>
</html>
