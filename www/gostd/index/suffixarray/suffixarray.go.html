<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5999736">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5999791">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5999845">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5999896">//&nbsp;Package&nbsp;suffixarray&nbsp;implements&nbsp;substring&nbsp;search&nbsp;in&nbsp;logarithmic&nbsp;time&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="5999973">//&nbsp;an&nbsp;in-memory&nbsp;suffix&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="6000003">//</span><br>
<span class="lineno"></span><span class="comment" id="6000006">//&nbsp;Example&nbsp;use:</span><br>
<span class="lineno"></span><span class="comment" id="6000022">//</span><br>
<span class="lineno">10</span><span class="comment" id="6000025">//&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;create&nbsp;index&nbsp;for&nbsp;some&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="6000058">//&nbsp;&nbsp;&nbsp;&nbspindex&nbsp;:=&nbsp;suffixarray.New(data)</span><br>
<span class="lineno"></span><span class="comment" id="6000092">//</span><br>
<span class="lineno"></span><span class="comment" id="6000095">//&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;lookup&nbsp;byte&nbsp;slice&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="6000121">//&nbsp;&nbsp;&nbsp;&nbspoffsets1&nbsp;:=&nbsp;index.Lookup(s,&nbsp;-1)&nbsp;//&nbsp;the&nbsp;list&nbsp;of&nbsp;all&nbsp;indices&nbsp;where&nbsp;s&nbsp;occurs&nbsp;in&nbsp;data</span><br>
<span class="lineno">15</span><span class="comment" id="6000206">//&nbsp;&nbsp;&nbsp;&nbspoffsets2&nbsp;:=&nbsp;index.Lookup(s,&nbsp;3)&nbsp;&nbsp;//&nbsp;the&nbsp;list&nbsp;of&nbsp;at&nbsp;most&nbsp;3&nbsp;indices&nbsp;where&nbsp;s&nbsp;occurs&nbsp;in&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="6000297">//</span><br>
<span class="lineno"></span><span class="keyword" id="6000300">package</span>&nbsp;<span class="ident" id="6000308">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6000321">import</span>&nbsp;<span class="op" id="6000328">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6000331">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6000340">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6000359">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6000365">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6000375">&#34;sort&#34;</span><br>
<span class="lineno">25</span><span class="op" id="6000382">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6000385">//&nbsp;Index&nbsp;implements&nbsp;a&nbsp;suffix&nbsp;array&nbsp;for&nbsp;fast&nbsp;substring&nbsp;search.</span><br>
<span class="lineno"></span><span class="keyword" id="6000447">type</span>&nbsp;<span class="ident" id="6000452">Index</span>&nbsp;<span class="keyword" id="6000458">struct</span>&nbsp;<span class="op" id="6000465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000468">data</span>&nbsp;<span class="op" id="6000473">[</span><span class="op" id="6000474">]</span><span class="builtintype" id="6000475">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000481">sa</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6000486">[</span><span class="op" id="6000487">]</span><span class="builtintype" id="6000488">int</span>&nbsp;<span class="comment" id="6000492">//&nbsp;suffix&nbsp;array&nbsp;for&nbsp;data;&nbsp;len(sa)&nbsp;==&nbsp;len(data)</span><br>
<span class="lineno"></span><span class="op" id="6000539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6000542">//&nbsp;New&nbsp;creates&nbsp;a&nbsp;new&nbsp;Index&nbsp;for&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="6000579">//&nbsp;Index&nbsp;creation&nbsp;time&nbsp;is&nbsp;O(N*log(N))&nbsp;for&nbsp;N&nbsp;=&nbsp;len(data).</span><br>
<span class="lineno">35</span><span class="keyword" id="6000636">func</span>&nbsp;<span class="ident" id="6000641">New</span><span class="op" id="6000644">(</span><span class="ident" id="6000645">data</span>&nbsp;<span class="op" id="6000650">[</span><span class="op" id="6000651">]</span><span class="builtintype" id="6000652">byte</span><span class="op" id="6000656">)</span>&nbsp;<span class="op" id="6000658">*</span><span class="ident" id="6000659">Index</span>&nbsp;<span class="op" id="6000665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000668">return</span>&nbsp;<span class="op" id="6000675">&amp;</span><span class="ident" id="6000676">Index</span><span class="op" id="6000681">{</span><span class="ident" id="6000682">data</span><span class="op" id="6000686">,</span>&nbsp;<span class="ident" id="6000688">qsufsort</span><span class="op" id="6000696">(</span><span class="ident" id="6000697">data</span><span class="op" id="6000701">)</span><span class="op" id="6000702">}</span><br>
<span class="lineno"></span><span class="op" id="6000704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6000707">//&nbsp;writeInt&nbsp;writes&nbsp;an&nbsp;int&nbsp;x&nbsp;to&nbsp;w&nbsp;using&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;write.</span><br>
<span class="lineno">40</span><span class="keyword" id="6000771">func</span>&nbsp;<span class="ident" id="6000776">writeInt</span><span class="op" id="6000784">(</span><span class="ident" id="6000785">w</span>&nbsp;<span class="ident" id="6000787">io</span><span class="op" id="6000789">.</span><span class="ident" id="6000790">Writer</span><span class="op" id="6000796">,</span>&nbsp;<span class="ident" id="6000798">buf</span>&nbsp;<span class="op" id="6000802">[</span><span class="op" id="6000803">]</span><span class="builtintype" id="6000804">byte</span><span class="op" id="6000808">,</span>&nbsp;<span class="ident" id="6000810">x</span>&nbsp;<span class="builtintype" id="6000812">int</span><span class="op" id="6000815">)</span>&nbsp;<span class="builtintype" id="6000817">error</span>&nbsp;<span class="op" id="6000823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000826">binary</span><span class="op" id="6000832">.</span><span class="ident" id="6000833">PutVarint</span><span class="op" id="6000842">(</span><span class="ident" id="6000843">buf</span><span class="op" id="6000846">,</span>&nbsp;<span class="ident" id="6000848">int64</span><span class="op" id="6000853">(</span><span class="ident" id="6000854">x</span><span class="op" id="6000855">)</span><span class="op" id="6000856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6000859">_</span><span class="op" id="6000860">,</span>&nbsp;<span class="ident" id="6000862">err</span>&nbsp;<span class="op" id="6000866">:=</span>&nbsp;<span class="ident" id="6000869">w</span><span class="op" id="6000870">.</span><span class="ident" id="6000871">Write</span><span class="op" id="6000876">(</span><span class="ident" id="6000877">buf</span><span class="op" id="6000880">[</span><span class="num" id="6000881">0</span><span class="op" id="6000882">:</span><span class="ident" id="6000883">binary</span><span class="op" id="6000889">.</span><span class="ident" id="6000890">MaxVarintLen64</span><span class="op" id="6000904">]</span><span class="op" id="6000905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6000908">return</span>&nbsp;<span class="ident" id="6000915">err</span><br>
<span class="lineno"></span><span class="op" id="6000919">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6000922">//&nbsp;readInt&nbsp;reads&nbsp;an&nbsp;int&nbsp;x&nbsp;from&nbsp;r&nbsp;using&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;read&nbsp;and&nbsp;returns&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="6000999">func</span>&nbsp;<span class="ident" id="6001004">readInt</span><span class="op" id="6001011">(</span><span class="ident" id="6001012">r</span>&nbsp;<span class="ident" id="6001014">io</span><span class="op" id="6001016">.</span><span class="ident" id="6001017">Reader</span><span class="op" id="6001023">,</span>&nbsp;<span class="ident" id="6001025">buf</span>&nbsp;<span class="op" id="6001029">[</span><span class="op" id="6001030">]</span><span class="builtintype" id="6001031">byte</span><span class="op" id="6001035">)</span>&nbsp;<span class="op" id="6001037">(</span><span class="builtintype" id="6001038">int</span><span class="op" id="6001041">,</span>&nbsp;<span class="builtintype" id="6001043">error</span><span class="op" id="6001048">)</span>&nbsp;<span class="op" id="6001050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001053">_</span><span class="op" id="6001054">,</span>&nbsp;<span class="ident" id="6001056">err</span>&nbsp;<span class="op" id="6001060">:=</span>&nbsp;<span class="ident" id="6001063">io</span><span class="op" id="6001065">.</span><span class="ident" id="6001066">ReadFull</span><span class="op" id="6001074">(</span><span class="ident" id="6001075">r</span><span class="op" id="6001076">,</span>&nbsp;<span class="ident" id="6001078">buf</span><span class="op" id="6001081">[</span><span class="num" id="6001082">0</span><span class="op" id="6001083">:</span><span class="ident" id="6001084">binary</span><span class="op" id="6001090">.</span><span class="ident" id="6001091">MaxVarintLen64</span><span class="op" id="6001105">]</span><span class="op" id="6001106">)</span>&nbsp;<span class="comment" id="6001108">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;with&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001138">x</span><span class="op" id="6001139">,</span>&nbsp;<span class="ident" id="6001141">_</span>&nbsp;<span class="op" id="6001143">:=</span>&nbsp;<span class="ident" id="6001146">binary</span><span class="op" id="6001152">.</span><span class="ident" id="6001153">Varint</span><span class="op" id="6001159">(</span><span class="ident" id="6001160">buf</span><span class="op" id="6001163">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001166">return</span>&nbsp;<span class="builtintype" id="6001173">int</span><span class="op" id="6001176">(</span><span class="ident" id="6001177">x</span><span class="op" id="6001178">)</span><span class="op" id="6001179">,</span>&nbsp;<span class="ident" id="6001181">err</span><br>
<span class="lineno"></span><span class="op" id="6001185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6001188">//&nbsp;writeSlice&nbsp;writes&nbsp;data[:n]&nbsp;to&nbsp;w&nbsp;and&nbsp;returns&nbsp;n.</span><br>
<span class="lineno"></span><span class="comment" id="6001238">//&nbsp;It&nbsp;uses&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;write.</span><br>
<span class="lineno">55</span><span class="keyword" id="6001274">func</span>&nbsp;<span class="ident" id="6001279">writeSlice</span><span class="op" id="6001289">(</span><span class="ident" id="6001290">w</span>&nbsp;<span class="ident" id="6001292">io</span><span class="op" id="6001294">.</span><span class="ident" id="6001295">Writer</span><span class="op" id="6001301">,</span>&nbsp;<span class="ident" id="6001303">buf</span>&nbsp;<span class="op" id="6001307">[</span><span class="op" id="6001308">]</span><span class="builtintype" id="6001309">byte</span><span class="op" id="6001313">,</span>&nbsp;<span class="ident" id="6001315">data</span>&nbsp;<span class="op" id="6001320">[</span><span class="op" id="6001321">]</span><span class="builtintype" id="6001322">int</span><span class="op" id="6001325">)</span>&nbsp;<span class="op" id="6001327">(</span><span class="ident" id="6001328">n</span>&nbsp;<span class="builtintype" id="6001330">int</span><span class="op" id="6001333">,</span>&nbsp;<span class="ident" id="6001335">err</span>&nbsp;<span class="builtintype" id="6001339">error</span><span class="op" id="6001344">)</span>&nbsp;<span class="op" id="6001346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6001349">//&nbsp;encode&nbsp;as&nbsp;many&nbsp;elements&nbsp;as&nbsp;fit&nbsp;into&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001393">p</span>&nbsp;<span class="op" id="6001395">:=</span>&nbsp;<span class="ident" id="6001398">binary</span><span class="op" id="6001404">.</span><span class="ident" id="6001405">MaxVarintLen64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001421">for</span>&nbsp;<span class="op" id="6001425">;</span>&nbsp;<span class="ident" id="6001427">n</span>&nbsp;<span class="op" id="6001429">&lt;</span>&nbsp;<span class="builtinfunc" id="6001431">len</span><span class="op" id="6001434">(</span><span class="ident" id="6001435">data</span><span class="op" id="6001439">)</span>&nbsp;<span class="op" id="6001441">&amp;&amp;</span>&nbsp;<span class="ident" id="6001444">p</span><span class="op" id="6001445">+</span><span class="ident" id="6001446">binary</span><span class="op" id="6001452">.</span><span class="ident" id="6001453">MaxVarintLen64</span>&nbsp;<span class="op" id="6001468">&lt;=</span>&nbsp;<span class="builtinfunc" id="6001471">len</span><span class="op" id="6001474">(</span><span class="ident" id="6001475">buf</span><span class="op" id="6001478">)</span><span class="op" id="6001479">;</span>&nbsp;<span class="ident" id="6001481">n</span><span class="op" id="6001482">++</span>&nbsp;<span class="op" id="6001485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001489">p</span>&nbsp;<span class="op" id="6001491">+=</span>&nbsp;<span class="ident" id="6001494">binary</span><span class="op" id="6001500">.</span><span class="ident" id="6001501">PutUvarint</span><span class="op" id="6001511">(</span><span class="ident" id="6001512">buf</span><span class="op" id="6001515">[</span><span class="ident" id="6001516">p</span><span class="op" id="6001517">:</span><span class="op" id="6001518">]</span><span class="op" id="6001519">,</span>&nbsp;<span class="ident" id="6001521">uint64</span><span class="op" id="6001527">(</span><span class="ident" id="6001528">data</span><span class="op" id="6001532">[</span><span class="ident" id="6001533">n</span><span class="op" id="6001534">]</span><span class="op" id="6001535">)</span><span class="op" id="6001536">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6001539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6001543">//&nbsp;update&nbsp;buffer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001566">binary</span><span class="op" id="6001572">.</span><span class="ident" id="6001573">PutVarint</span><span class="op" id="6001582">(</span><span class="ident" id="6001583">buf</span><span class="op" id="6001586">,</span>&nbsp;<span class="ident" id="6001588">int64</span><span class="op" id="6001593">(</span><span class="ident" id="6001594">p</span><span class="op" id="6001595">)</span><span class="op" id="6001596">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6001600">//&nbsp;write&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001617">_</span><span class="op" id="6001618">,</span>&nbsp;<span class="ident" id="6001620">err</span>&nbsp;<span class="op" id="6001624">=</span>&nbsp;<span class="ident" id="6001626">w</span><span class="op" id="6001627">.</span><span class="ident" id="6001628">Write</span><span class="op" id="6001633">(</span><span class="ident" id="6001634">buf</span><span class="op" id="6001637">[</span><span class="num" id="6001638">0</span><span class="op" id="6001639">:</span><span class="ident" id="6001640">p</span><span class="op" id="6001641">]</span><span class="op" id="6001642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001645">return</span><br>
<span class="lineno"></span><span class="op" id="6001652">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="6001655">//&nbsp;readSlice&nbsp;reads&nbsp;data[:n]&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;n.</span><br>
<span class="lineno"></span><span class="comment" id="6001705">//&nbsp;It&nbsp;uses&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="6001740">func</span>&nbsp;<span class="ident" id="6001745">readSlice</span><span class="op" id="6001754">(</span><span class="ident" id="6001755">r</span>&nbsp;<span class="ident" id="6001757">io</span><span class="op" id="6001759">.</span><span class="ident" id="6001760">Reader</span><span class="op" id="6001766">,</span>&nbsp;<span class="ident" id="6001768">buf</span>&nbsp;<span class="op" id="6001772">[</span><span class="op" id="6001773">]</span><span class="builtintype" id="6001774">byte</span><span class="op" id="6001778">,</span>&nbsp;<span class="ident" id="6001780">data</span>&nbsp;<span class="op" id="6001785">[</span><span class="op" id="6001786">]</span><span class="builtintype" id="6001787">int</span><span class="op" id="6001790">)</span>&nbsp;<span class="op" id="6001792">(</span><span class="ident" id="6001793">n</span>&nbsp;<span class="builtintype" id="6001795">int</span><span class="op" id="6001798">,</span>&nbsp;<span class="ident" id="6001800">err</span>&nbsp;<span class="builtintype" id="6001804">error</span><span class="op" id="6001809">)</span>&nbsp;<span class="op" id="6001811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6001814">//&nbsp;read&nbsp;buffer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001835">var</span>&nbsp;<span class="ident" id="6001839">size</span>&nbsp;<span class="builtintype" id="6001844">int</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6001849">size</span><span class="op" id="6001853">,</span>&nbsp;<span class="ident" id="6001855">err</span>&nbsp;<span class="op" id="6001859">=</span>&nbsp;<span class="ident" id="6001861">readInt</span><span class="op" id="6001868">(</span><span class="ident" id="6001869">r</span><span class="op" id="6001870">,</span>&nbsp;<span class="ident" id="6001872">buf</span><span class="op" id="6001875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001878">if</span>&nbsp;<span class="ident" id="6001881">err</span>&nbsp;<span class="op" id="6001885">!=</span>&nbsp;<span class="ident" id="6001888">nil</span>&nbsp;<span class="op" id="6001892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001896">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6001904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6001908">//&nbsp;read&nbsp;buffer&nbsp;w/o&nbsp;the&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6001937">if</span>&nbsp;<span class="ident" id="6001940">_</span><span class="op" id="6001941">,</span>&nbsp;<span class="ident" id="6001943">err</span>&nbsp;<span class="op" id="6001947">=</span>&nbsp;<span class="ident" id="6001949">io</span><span class="op" id="6001951">.</span><span class="ident" id="6001952">ReadFull</span><span class="op" id="6001960">(</span><span class="ident" id="6001961">r</span><span class="op" id="6001962">,</span>&nbsp;<span class="ident" id="6001964">buf</span><span class="op" id="6001967">[</span><span class="ident" id="6001968">binary</span><span class="op" id="6001974">.</span><span class="ident" id="6001975">MaxVarintLen64</span><span class="op" id="6001989">:</span><span class="ident" id="6001990">size</span><span class="op" id="6001994">]</span><span class="op" id="6001995">)</span><span class="op" id="6001996">;</span>&nbsp;<span class="ident" id="6001998">err</span>&nbsp;<span class="op" id="6002002">!=</span>&nbsp;<span class="ident" id="6002005">nil</span>&nbsp;<span class="op" id="6002009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002013">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002025">//&nbsp;decode&nbsp;as&nbsp;many&nbsp;elements&nbsp;as&nbsp;present&nbsp;in&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002071">for</span>&nbsp;<span class="ident" id="6002075">p</span>&nbsp;<span class="op" id="6002077">:=</span>&nbsp;<span class="ident" id="6002080">binary</span><span class="op" id="6002086">.</span><span class="ident" id="6002087">MaxVarintLen64</span><span class="op" id="6002101">;</span>&nbsp;<span class="ident" id="6002103">p</span>&nbsp;<span class="op" id="6002105">&lt;</span>&nbsp;<span class="ident" id="6002107">size</span><span class="op" id="6002111">;</span>&nbsp;<span class="ident" id="6002113">n</span><span class="op" id="6002114">++</span>&nbsp;<span class="op" id="6002117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002121">x</span><span class="op" id="6002122">,</span>&nbsp;<span class="ident" id="6002124">w</span>&nbsp;<span class="op" id="6002126">:=</span>&nbsp;<span class="ident" id="6002129">binary</span><span class="op" id="6002135">.</span><span class="ident" id="6002136">Uvarint</span><span class="op" id="6002143">(</span><span class="ident" id="6002144">buf</span><span class="op" id="6002147">[</span><span class="ident" id="6002148">p</span><span class="op" id="6002149">:</span><span class="op" id="6002150">]</span><span class="op" id="6002151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002155">data</span><span class="op" id="6002159">[</span><span class="ident" id="6002160">n</span><span class="op" id="6002161">]</span>&nbsp;<span class="op" id="6002163">=</span>&nbsp;<span class="builtintype" id="6002165">int</span><span class="op" id="6002168">(</span><span class="ident" id="6002169">x</span><span class="op" id="6002170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002174">p</span>&nbsp;<span class="op" id="6002176">+=</span>&nbsp;<span class="ident" id="6002179">w</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002186">return</span><br>
<span class="lineno"></span><span class="op" id="6002193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6002196">const</span>&nbsp;<span class="ident" id="6002202">bufSize</span>&nbsp;<span class="op" id="6002210">=</span>&nbsp;<span class="num" id="6002212">16</span>&nbsp;<span class="op" id="6002215">&lt;&lt;</span>&nbsp;<span class="num" id="6002218">10</span>&nbsp;<span class="comment" id="6002221">//&nbsp;reasonable&nbsp;for&nbsp;BenchmarkSaveRestore</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6002261">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;index&nbsp;from&nbsp;r&nbsp;into&nbsp;x;&nbsp;x&nbsp;must&nbsp;not&nbsp;be&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="6002319">func</span>&nbsp;<span class="op" id="6002324">(</span><span class="ident" id="6002325">x</span>&nbsp;<span class="op" id="6002327">*</span><span class="ident" id="6002328">Index</span><span class="op" id="6002333">)</span>&nbsp;<span class="ident" id="6002335">Read</span><span class="op" id="6002339">(</span><span class="ident" id="6002340">r</span>&nbsp;<span class="ident" id="6002342">io</span><span class="op" id="6002344">.</span><span class="ident" id="6002345">Reader</span><span class="op" id="6002351">)</span>&nbsp;<span class="builtintype" id="6002353">error</span>&nbsp;<span class="op" id="6002359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002362">//&nbsp;buffer&nbsp;for&nbsp;all&nbsp;reads</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002387">buf</span>&nbsp;<span class="op" id="6002391">:=</span>&nbsp;<span class="builtinfunc" id="6002394">make</span><span class="op" id="6002398">(</span><span class="op" id="6002399">[</span><span class="op" id="6002400">]</span><span class="builtintype" id="6002401">byte</span><span class="op" id="6002405">,</span>&nbsp;<span class="ident" id="6002407">bufSize</span><span class="op" id="6002414">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002418">//&nbsp;read&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002434">n</span><span class="op" id="6002435">,</span>&nbsp;<span class="ident" id="6002437">err</span>&nbsp;<span class="op" id="6002441">:=</span>&nbsp;<span class="ident" id="6002444">readInt</span><span class="op" id="6002451">(</span><span class="ident" id="6002452">r</span><span class="op" id="6002453">,</span>&nbsp;<span class="ident" id="6002455">buf</span><span class="op" id="6002458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002461">if</span>&nbsp;<span class="ident" id="6002464">err</span>&nbsp;<span class="op" id="6002468">!=</span>&nbsp;<span class="ident" id="6002471">nil</span>&nbsp;<span class="op" id="6002475">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002479">return</span>&nbsp;<span class="ident" id="6002486">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002495">//&nbsp;allocate&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002514">if</span>&nbsp;<span class="num" id="6002517">2</span><span class="op" id="6002518">*</span><span class="ident" id="6002519">n</span>&nbsp;<span class="op" id="6002521">&lt;</span>&nbsp;<span class="builtinfunc" id="6002523">cap</span><span class="op" id="6002526">(</span><span class="ident" id="6002527">x</span><span class="op" id="6002528">.</span><span class="ident" id="6002529">data</span><span class="op" id="6002533">)</span>&nbsp;<span class="op" id="6002535">||</span>&nbsp;<span class="builtinfunc" id="6002538">cap</span><span class="op" id="6002541">(</span><span class="ident" id="6002542">x</span><span class="op" id="6002543">.</span><span class="ident" id="6002544">data</span><span class="op" id="6002548">)</span>&nbsp;<span class="op" id="6002550">&lt;</span>&nbsp;<span class="ident" id="6002552">n</span>&nbsp;<span class="op" id="6002554">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002558">//&nbsp;new&nbsp;data&nbsp;is&nbsp;significantly&nbsp;smaller&nbsp;or&nbsp;larger&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002612">//&nbsp;existing&nbsp;buffers&nbsp;-&nbsp;allocate&nbsp;new&nbsp;ones</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002654">x</span><span class="op" id="6002655">.</span><span class="ident" id="6002656">data</span>&nbsp;<span class="op" id="6002661">=</span>&nbsp;<span class="builtinfunc" id="6002663">make</span><span class="op" id="6002667">(</span><span class="op" id="6002668">[</span><span class="op" id="6002669">]</span><span class="builtintype" id="6002670">byte</span><span class="op" id="6002674">,</span>&nbsp;<span class="ident" id="6002676">n</span><span class="op" id="6002677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002681">x</span><span class="op" id="6002682">.</span><span class="ident" id="6002683">sa</span>&nbsp;<span class="op" id="6002686">=</span>&nbsp;<span class="builtinfunc" id="6002688">make</span><span class="op" id="6002692">(</span><span class="op" id="6002693">[</span><span class="op" id="6002694">]</span><span class="builtintype" id="6002695">int</span><span class="op" id="6002698">,</span>&nbsp;<span class="ident" id="6002700">n</span><span class="op" id="6002701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002704">}</span>&nbsp;<span class="keyword" id="6002706">else</span>&nbsp;<span class="op" id="6002711">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002715">//&nbsp;re-use&nbsp;existing&nbsp;buffers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002744">x</span><span class="op" id="6002745">.</span><span class="ident" id="6002746">data</span>&nbsp;<span class="op" id="6002751">=</span>&nbsp;<span class="ident" id="6002753">x</span><span class="op" id="6002754">.</span><span class="ident" id="6002755">data</span><span class="op" id="6002759">[</span><span class="num" id="6002760">0</span><span class="op" id="6002761">:</span><span class="ident" id="6002762">n</span><span class="op" id="6002763">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002767">x</span><span class="op" id="6002768">.</span><span class="ident" id="6002769">sa</span>&nbsp;<span class="op" id="6002772">=</span>&nbsp;<span class="ident" id="6002774">x</span><span class="op" id="6002775">.</span><span class="ident" id="6002776">sa</span><span class="op" id="6002778">[</span><span class="num" id="6002779">0</span><span class="op" id="6002780">:</span><span class="ident" id="6002781">n</span><span class="op" id="6002782">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002789">//&nbsp;read&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002803">if</span>&nbsp;<span class="ident" id="6002806">_</span><span class="op" id="6002807">,</span>&nbsp;<span class="ident" id="6002809">err</span>&nbsp;<span class="op" id="6002813">:=</span>&nbsp;<span class="ident" id="6002816">io</span><span class="op" id="6002818">.</span><span class="ident" id="6002819">ReadFull</span><span class="op" id="6002827">(</span><span class="ident" id="6002828">r</span><span class="op" id="6002829">,</span>&nbsp;<span class="ident" id="6002831">x</span><span class="op" id="6002832">.</span><span class="ident" id="6002833">data</span><span class="op" id="6002837">)</span><span class="op" id="6002838">;</span>&nbsp;<span class="ident" id="6002840">err</span>&nbsp;<span class="op" id="6002844">!=</span>&nbsp;<span class="ident" id="6002847">nil</span>&nbsp;<span class="op" id="6002851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002855">return</span>&nbsp;<span class="ident" id="6002862">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6002871">//&nbsp;read&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002886">for</span>&nbsp;<span class="ident" id="6002890">sa</span>&nbsp;<span class="op" id="6002893">:=</span>&nbsp;<span class="ident" id="6002896">x</span><span class="op" id="6002897">.</span><span class="ident" id="6002898">sa</span><span class="op" id="6002900">;</span>&nbsp;<span class="builtinfunc" id="6002902">len</span><span class="op" id="6002905">(</span><span class="ident" id="6002906">sa</span><span class="op" id="6002908">)</span>&nbsp;<span class="op" id="6002910">&gt;</span>&nbsp;<span class="num" id="6002912">0</span><span class="op" id="6002913">;</span>&nbsp;<span class="op" id="6002915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002919">n</span><span class="op" id="6002920">,</span>&nbsp;<span class="ident" id="6002922">err</span>&nbsp;<span class="op" id="6002926">:=</span>&nbsp;<span class="ident" id="6002929">readSlice</span><span class="op" id="6002938">(</span><span class="ident" id="6002939">r</span><span class="op" id="6002940">,</span>&nbsp;<span class="ident" id="6002942">buf</span><span class="op" id="6002945">,</span>&nbsp;<span class="ident" id="6002947">sa</span><span class="op" id="6002949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002953">if</span>&nbsp;<span class="ident" id="6002956">err</span>&nbsp;<span class="op" id="6002960">!=</span>&nbsp;<span class="ident" id="6002963">nil</span>&nbsp;<span class="op" id="6002967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6002972">return</span>&nbsp;<span class="ident" id="6002979">err</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6002985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6002989">sa</span>&nbsp;<span class="op" id="6002992">=</span>&nbsp;<span class="ident" id="6002994">sa</span><span class="op" id="6002996">[</span><span class="ident" id="6002997">n</span><span class="op" id="6002998">:</span><span class="op" id="6002999">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6003002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003005">return</span>&nbsp;<span class="ident" id="6003012">nil</span><br>
<span class="lineno"></span><span class="op" id="6003016">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="comment" id="6003019">//&nbsp;Write&nbsp;writes&nbsp;the&nbsp;index&nbsp;x&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6003053">func</span>&nbsp;<span class="op" id="6003058">(</span><span class="ident" id="6003059">x</span>&nbsp;<span class="op" id="6003061">*</span><span class="ident" id="6003062">Index</span><span class="op" id="6003067">)</span>&nbsp;<span class="ident" id="6003069">Write</span><span class="op" id="6003074">(</span><span class="ident" id="6003075">w</span>&nbsp;<span class="ident" id="6003077">io</span><span class="op" id="6003079">.</span><span class="ident" id="6003080">Writer</span><span class="op" id="6003086">)</span>&nbsp;<span class="builtintype" id="6003088">error</span>&nbsp;<span class="op" id="6003094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003097">//&nbsp;buffer&nbsp;for&nbsp;all&nbsp;writes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003123">buf</span>&nbsp;<span class="op" id="6003127">:=</span>&nbsp;<span class="builtinfunc" id="6003130">make</span><span class="op" id="6003134">(</span><span class="op" id="6003135">[</span><span class="op" id="6003136">]</span><span class="builtintype" id="6003137">byte</span><span class="op" id="6003141">,</span>&nbsp;<span class="ident" id="6003143">bufSize</span><span class="op" id="6003150">)</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003154">//&nbsp;write&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003171">if</span>&nbsp;<span class="ident" id="6003174">err</span>&nbsp;<span class="op" id="6003178">:=</span>&nbsp;<span class="ident" id="6003181">writeInt</span><span class="op" id="6003189">(</span><span class="ident" id="6003190">w</span><span class="op" id="6003191">,</span>&nbsp;<span class="ident" id="6003193">buf</span><span class="op" id="6003196">,</span>&nbsp;<span class="builtinfunc" id="6003198">len</span><span class="op" id="6003201">(</span><span class="ident" id="6003202">x</span><span class="op" id="6003203">.</span><span class="ident" id="6003204">data</span><span class="op" id="6003208">)</span><span class="op" id="6003209">)</span><span class="op" id="6003210">;</span>&nbsp;<span class="ident" id="6003212">err</span>&nbsp;<span class="op" id="6003216">!=</span>&nbsp;<span class="ident" id="6003219">nil</span>&nbsp;<span class="op" id="6003223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003227">return</span>&nbsp;<span class="ident" id="6003234">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6003239">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003243">//&nbsp;write&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003258">if</span>&nbsp;<span class="ident" id="6003261">_</span><span class="op" id="6003262">,</span>&nbsp;<span class="ident" id="6003264">err</span>&nbsp;<span class="op" id="6003268">:=</span>&nbsp;<span class="ident" id="6003271">w</span><span class="op" id="6003272">.</span><span class="ident" id="6003273">Write</span><span class="op" id="6003278">(</span><span class="ident" id="6003279">x</span><span class="op" id="6003280">.</span><span class="ident" id="6003281">data</span><span class="op" id="6003285">)</span><span class="op" id="6003286">;</span>&nbsp;<span class="ident" id="6003288">err</span>&nbsp;<span class="op" id="6003292">!=</span>&nbsp;<span class="ident" id="6003295">nil</span>&nbsp;<span class="op" id="6003299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003303">return</span>&nbsp;<span class="ident" id="6003310">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6003315">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003319">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003335">for</span>&nbsp;<span class="ident" id="6003339">sa</span>&nbsp;<span class="op" id="6003342">:=</span>&nbsp;<span class="ident" id="6003345">x</span><span class="op" id="6003346">.</span><span class="ident" id="6003347">sa</span><span class="op" id="6003349">;</span>&nbsp;<span class="builtinfunc" id="6003351">len</span><span class="op" id="6003354">(</span><span class="ident" id="6003355">sa</span><span class="op" id="6003357">)</span>&nbsp;<span class="op" id="6003359">&gt;</span>&nbsp;<span class="num" id="6003361">0</span><span class="op" id="6003362">;</span>&nbsp;<span class="op" id="6003364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003368">n</span><span class="op" id="6003369">,</span>&nbsp;<span class="ident" id="6003371">err</span>&nbsp;<span class="op" id="6003375">:=</span>&nbsp;<span class="ident" id="6003378">writeSlice</span><span class="op" id="6003388">(</span><span class="ident" id="6003389">w</span><span class="op" id="6003390">,</span>&nbsp;<span class="ident" id="6003392">buf</span><span class="op" id="6003395">,</span>&nbsp;<span class="ident" id="6003397">sa</span><span class="op" id="6003399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003403">if</span>&nbsp;<span class="ident" id="6003406">err</span>&nbsp;<span class="op" id="6003410">!=</span>&nbsp;<span class="ident" id="6003413">nil</span>&nbsp;<span class="op" id="6003417">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003422">return</span>&nbsp;<span class="ident" id="6003429">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6003435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003439">sa</span>&nbsp;<span class="op" id="6003442">=</span>&nbsp;<span class="ident" id="6003444">sa</span><span class="op" id="6003446">[</span><span class="ident" id="6003447">n</span><span class="op" id="6003448">:</span><span class="op" id="6003449">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6003452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003455">return</span>&nbsp;<span class="ident" id="6003462">nil</span><br>
<span class="lineno">160</span><span class="op" id="6003466">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6003469">//&nbsp;Bytes&nbsp;returns&nbsp;the&nbsp;data&nbsp;over&nbsp;which&nbsp;the&nbsp;index&nbsp;was&nbsp;created.</span><br>
<span class="lineno"></span><span class="comment" id="6003529">//&nbsp;It&nbsp;must&nbsp;not&nbsp;be&nbsp;modified.</span><br>
<span class="lineno"></span><span class="comment" id="6003557">//</span><br>
<span class="lineno">165</span><span class="keyword" id="6003560">func</span>&nbsp;<span class="op" id="6003565">(</span><span class="ident" id="6003566">x</span>&nbsp;<span class="op" id="6003568">*</span><span class="ident" id="6003569">Index</span><span class="op" id="6003574">)</span>&nbsp;<span class="ident" id="6003576">Bytes</span><span class="op" id="6003581">(</span><span class="op" id="6003582">)</span>&nbsp;<span class="op" id="6003584">[</span><span class="op" id="6003585">]</span><span class="builtintype" id="6003586">byte</span>&nbsp;<span class="op" id="6003591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003594">return</span>&nbsp;<span class="ident" id="6003601">x</span><span class="op" id="6003602">.</span><span class="ident" id="6003603">data</span><br>
<span class="lineno"></span><span class="op" id="6003608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6003611">func</span>&nbsp;<span class="op" id="6003616">(</span><span class="ident" id="6003617">x</span>&nbsp;<span class="op" id="6003619">*</span><span class="ident" id="6003620">Index</span><span class="op" id="6003625">)</span>&nbsp;<span class="ident" id="6003627">at</span><span class="op" id="6003629">(</span><span class="ident" id="6003630">i</span>&nbsp;<span class="builtintype" id="6003632">int</span><span class="op" id="6003635">)</span>&nbsp;<span class="op" id="6003637">[</span><span class="op" id="6003638">]</span><span class="builtintype" id="6003639">byte</span>&nbsp;<span class="op" id="6003644">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6003647">return</span>&nbsp;<span class="ident" id="6003654">x</span><span class="op" id="6003655">.</span><span class="ident" id="6003656">data</span><span class="op" id="6003660">[</span><span class="ident" id="6003661">x</span><span class="op" id="6003662">.</span><span class="ident" id="6003663">sa</span><span class="op" id="6003665">[</span><span class="ident" id="6003666">i</span><span class="op" id="6003667">]</span><span class="op" id="6003668">:</span><span class="op" id="6003669">]</span><br>
<span class="lineno"></span><span class="op" id="6003671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6003674">//&nbsp;lookupAll&nbsp;returns&nbsp;a&nbsp;slice&nbsp;into&nbsp;the&nbsp;matching&nbsp;region&nbsp;of&nbsp;the&nbsp;index.</span><br>
<span class="lineno"></span><span class="comment" id="6003742">//&nbsp;The&nbsp;runtime&nbsp;is&nbsp;O(log(N)*len(s)).</span><br>
<span class="lineno">175</span><span class="keyword" id="6003778">func</span>&nbsp;<span class="op" id="6003783">(</span><span class="ident" id="6003784">x</span>&nbsp;<span class="op" id="6003786">*</span><span class="ident" id="6003787">Index</span><span class="op" id="6003792">)</span>&nbsp;<span class="ident" id="6003794">lookupAll</span><span class="op" id="6003803">(</span><span class="ident" id="6003804">s</span>&nbsp;<span class="op" id="6003806">[</span><span class="op" id="6003807">]</span><span class="builtintype" id="6003808">byte</span><span class="op" id="6003812">)</span>&nbsp;<span class="op" id="6003814">[</span><span class="op" id="6003815">]</span><span class="builtintype" id="6003816">int</span>&nbsp;<span class="op" id="6003820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003823">//&nbsp;find&nbsp;matching&nbsp;suffix&nbsp;index&nbsp;range&nbsp;[i:j]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6003866">//&nbsp;find&nbsp;the&nbsp;first&nbsp;index&nbsp;where&nbsp;s&nbsp;would&nbsp;be&nbsp;the&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6003919">i</span>&nbsp;<span class="op" id="6003921">:=</span>&nbsp;<span class="ident" id="6003924">sort</span><span class="op" id="6003928">.</span><span class="ident" id="6003929">Search</span><span class="op" id="6003935">(</span><span class="builtinfunc" id="6003936">len</span><span class="op" id="6003939">(</span><span class="ident" id="6003940">x</span><span class="op" id="6003941">.</span><span class="ident" id="6003942">sa</span><span class="op" id="6003944">)</span><span class="op" id="6003945">,</span>&nbsp;<span class="keyword" id="6003947">func</span><span class="op" id="6003951">(</span><span class="ident" id="6003952">i</span>&nbsp;<span class="builtintype" id="6003954">int</span><span class="op" id="6003957">)</span>&nbsp;<span class="builtintype" id="6003959">bool</span>&nbsp;<span class="op" id="6003964">{</span>&nbsp;<span class="keyword" id="6003966">return</span>&nbsp;<span class="ident" id="6003973">bytes</span><span class="op" id="6003978">.</span><span class="ident" id="6003979">Compare</span><span class="op" id="6003986">(</span><span class="ident" id="6003987">x</span><span class="op" id="6003988">.</span><span class="ident" id="6003989">at</span><span class="op" id="6003991">(</span><span class="ident" id="6003992">i</span><span class="op" id="6003993">)</span><span class="op" id="6003994">,</span>&nbsp;<span class="ident" id="6003996">s</span><span class="op" id="6003997">)</span>&nbsp;<span class="op" id="6003999">&gt;=</span>&nbsp;<span class="num" id="6004002">0</span>&nbsp;<span class="op" id="6004004">}</span><span class="op" id="6004005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6004008">//&nbsp;starting&nbsp;at&nbsp;i,&nbsp;find&nbsp;the&nbsp;first&nbsp;index&nbsp;at&nbsp;which&nbsp;s&nbsp;is&nbsp;not&nbsp;a&nbsp;prefix</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004075">j</span>&nbsp;<span class="op" id="6004077">:=</span>&nbsp;<span class="ident" id="6004080">i</span>&nbsp;<span class="op" id="6004082">+</span>&nbsp;<span class="ident" id="6004084">sort</span><span class="op" id="6004088">.</span><span class="ident" id="6004089">Search</span><span class="op" id="6004095">(</span><span class="builtinfunc" id="6004096">len</span><span class="op" id="6004099">(</span><span class="ident" id="6004100">x</span><span class="op" id="6004101">.</span><span class="ident" id="6004102">sa</span><span class="op" id="6004104">)</span><span class="op" id="6004105">-</span><span class="ident" id="6004106">i</span><span class="op" id="6004107">,</span>&nbsp;<span class="keyword" id="6004109">func</span><span class="op" id="6004113">(</span><span class="ident" id="6004114">j</span>&nbsp;<span class="builtintype" id="6004116">int</span><span class="op" id="6004119">)</span>&nbsp;<span class="builtintype" id="6004121">bool</span>&nbsp;<span class="op" id="6004126">{</span>&nbsp;<span class="keyword" id="6004128">return</span>&nbsp;<span class="op" id="6004135">!</span><span class="ident" id="6004136">bytes</span><span class="op" id="6004141">.</span><span class="ident" id="6004142">HasPrefix</span><span class="op" id="6004151">(</span><span class="ident" id="6004152">x</span><span class="op" id="6004153">.</span><span class="ident" id="6004154">at</span><span class="op" id="6004156">(</span><span class="ident" id="6004157">j</span><span class="op" id="6004158">+</span><span class="ident" id="6004159">i</span><span class="op" id="6004160">)</span><span class="op" id="6004161">,</span>&nbsp;<span class="ident" id="6004163">s</span><span class="op" id="6004164">)</span>&nbsp;<span class="op" id="6004166">}</span><span class="op" id="6004167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004170">return</span>&nbsp;<span class="ident" id="6004177">x</span><span class="op" id="6004178">.</span><span class="ident" id="6004179">sa</span><span class="op" id="6004181">[</span><span class="ident" id="6004182">i</span><span class="op" id="6004183">:</span><span class="ident" id="6004184">j</span><span class="op" id="6004185">]</span><br>
<span class="lineno"></span><span class="op" id="6004187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6004190">//&nbsp;Lookup&nbsp;returns&nbsp;an&nbsp;unsorted&nbsp;list&nbsp;of&nbsp;at&nbsp;most&nbsp;n&nbsp;indices&nbsp;where&nbsp;the&nbsp;byte&nbsp;string&nbsp;s</span><br>
<span class="lineno">185</span><span class="comment" id="6004270">//&nbsp;occurs&nbsp;in&nbsp;the&nbsp;indexed&nbsp;data.&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;all&nbsp;occurrences&nbsp;are&nbsp;returned.</span><br>
<span class="lineno"></span><span class="comment" id="6004341">//&nbsp;The&nbsp;result&nbsp;is&nbsp;nil&nbsp;if&nbsp;s&nbsp;is&nbsp;empty,&nbsp;s&nbsp;is&nbsp;not&nbsp;found,&nbsp;or&nbsp;n&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="6004404">//&nbsp;Lookup&nbsp;time&nbsp;is&nbsp;O(log(N)*len(s)&nbsp;+&nbsp;len(result))&nbsp;where&nbsp;N&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6004468">//&nbsp;size&nbsp;of&nbsp;the&nbsp;indexed&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="6004497">//</span><br>
<span class="lineno">190</span><span class="keyword" id="6004500">func</span>&nbsp;<span class="op" id="6004505">(</span><span class="ident" id="6004506">x</span>&nbsp;<span class="op" id="6004508">*</span><span class="ident" id="6004509">Index</span><span class="op" id="6004514">)</span>&nbsp;<span class="ident" id="6004516">Lookup</span><span class="op" id="6004522">(</span><span class="ident" id="6004523">s</span>&nbsp;<span class="op" id="6004525">[</span><span class="op" id="6004526">]</span><span class="builtintype" id="6004527">byte</span><span class="op" id="6004531">,</span>&nbsp;<span class="ident" id="6004533">n</span>&nbsp;<span class="builtintype" id="6004535">int</span><span class="op" id="6004538">)</span>&nbsp;<span class="op" id="6004540">(</span><span class="ident" id="6004541">result</span>&nbsp;<span class="op" id="6004548">[</span><span class="op" id="6004549">]</span><span class="builtintype" id="6004550">int</span><span class="op" id="6004553">)</span>&nbsp;<span class="op" id="6004555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004558">if</span>&nbsp;<span class="builtinfunc" id="6004561">len</span><span class="op" id="6004564">(</span><span class="ident" id="6004565">s</span><span class="op" id="6004566">)</span>&nbsp;<span class="op" id="6004568">&gt;</span>&nbsp;<span class="num" id="6004570">0</span>&nbsp;<span class="op" id="6004572">&amp;&amp;</span>&nbsp;<span class="ident" id="6004575">n</span>&nbsp;<span class="op" id="6004577">!=</span>&nbsp;<span class="num" id="6004580">0</span>&nbsp;<span class="op" id="6004582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004586">matches</span>&nbsp;<span class="op" id="6004594">:=</span>&nbsp;<span class="ident" id="6004597">x</span><span class="op" id="6004598">.</span><span class="ident" id="6004599">lookupAll</span><span class="op" id="6004608">(</span><span class="ident" id="6004609">s</span><span class="op" id="6004610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004614">if</span>&nbsp;<span class="ident" id="6004617">n</span>&nbsp;<span class="op" id="6004619">&lt;</span>&nbsp;<span class="num" id="6004621">0</span>&nbsp;<span class="op" id="6004623">||</span>&nbsp;<span class="builtinfunc" id="6004626">len</span><span class="op" id="6004629">(</span><span class="ident" id="6004630">matches</span><span class="op" id="6004637">)</span>&nbsp;<span class="op" id="6004639">&lt;</span>&nbsp;<span class="ident" id="6004641">n</span>&nbsp;<span class="op" id="6004643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004648">n</span>&nbsp;<span class="op" id="6004650">=</span>&nbsp;<span class="builtinfunc" id="6004652">len</span><span class="op" id="6004655">(</span><span class="ident" id="6004656">matches</span><span class="op" id="6004663">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6004667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6004671">//&nbsp;0&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;len(matches)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004699">if</span>&nbsp;<span class="ident" id="6004702">n</span>&nbsp;<span class="op" id="6004704">&gt;</span>&nbsp;<span class="num" id="6004706">0</span>&nbsp;<span class="op" id="6004708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6004713">result</span>&nbsp;<span class="op" id="6004720">=</span>&nbsp;<span class="builtinfunc" id="6004722">make</span><span class="op" id="6004726">(</span><span class="op" id="6004727">[</span><span class="op" id="6004728">]</span><span class="builtintype" id="6004729">int</span><span class="op" id="6004732">,</span>&nbsp;<span class="ident" id="6004734">n</span><span class="op" id="6004735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6004740">copy</span><span class="op" id="6004744">(</span><span class="ident" id="6004745">result</span><span class="op" id="6004751">,</span>&nbsp;<span class="ident" id="6004753">matches</span><span class="op" id="6004760">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6004764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6004767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6004770">return</span><br>
<span class="lineno"></span><span class="op" id="6004777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="6004780">//&nbsp;FindAllIndex&nbsp;returns&nbsp;a&nbsp;sorted&nbsp;list&nbsp;of&nbsp;non-overlapping&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6004852">//&nbsp;regular&nbsp;expression&nbsp;r,&nbsp;where&nbsp;a&nbsp;match&nbsp;is&nbsp;a&nbsp;pair&nbsp;of&nbsp;indices&nbsp;specifying</span><br>
<span class="lineno"></span><span class="comment" id="6004923">//&nbsp;the&nbsp;matched&nbsp;slice&nbsp;of&nbsp;x.Bytes().&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;all&nbsp;matches&nbsp;are&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="6004993">//&nbsp;in&nbsp;successive&nbsp;order.&nbsp;Otherwise,&nbsp;at&nbsp;most&nbsp;n&nbsp;matches&nbsp;are&nbsp;returned&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6005063">//&nbsp;they&nbsp;may&nbsp;not&nbsp;be&nbsp;successive.&nbsp;The&nbsp;result&nbsp;is&nbsp;nil&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;matches,</span><br>
<span class="lineno">210</span><span class="comment" id="6005137">//&nbsp;or&nbsp;if&nbsp;n&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="6005154">//</span><br>
<span class="lineno"></span><span class="keyword" id="6005157">func</span>&nbsp;<span class="op" id="6005162">(</span><span class="ident" id="6005163">x</span>&nbsp;<span class="op" id="6005165">*</span><span class="ident" id="6005166">Index</span><span class="op" id="6005171">)</span>&nbsp;<span class="ident" id="6005173">FindAllIndex</span><span class="op" id="6005185">(</span><span class="ident" id="6005186">r</span>&nbsp;<span class="op" id="6005188">*</span><span class="ident" id="6005189">regexp</span><span class="op" id="6005195">.</span><span class="ident" id="6005196">Regexp</span><span class="op" id="6005202">,</span>&nbsp;<span class="ident" id="6005204">n</span>&nbsp;<span class="builtintype" id="6005206">int</span><span class="op" id="6005209">)</span>&nbsp;<span class="op" id="6005211">(</span><span class="ident" id="6005212">result</span>&nbsp;<span class="op" id="6005219">[</span><span class="op" id="6005220">]</span><span class="op" id="6005221">[</span><span class="op" id="6005222">]</span><span class="builtintype" id="6005223">int</span><span class="op" id="6005226">)</span>&nbsp;<span class="op" id="6005228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6005231">//&nbsp;a&nbsp;non-empty&nbsp;literal&nbsp;prefix&nbsp;is&nbsp;used&nbsp;to&nbsp;determine&nbsp;possible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6005292">//&nbsp;match&nbsp;start&nbsp;indices&nbsp;with&nbsp;Lookup</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005328">prefix</span><span class="op" id="6005334">,</span>&nbsp;<span class="ident" id="6005336">complete</span>&nbsp;<span class="op" id="6005345">:=</span>&nbsp;<span class="ident" id="6005348">r</span><span class="op" id="6005349">.</span><span class="ident" id="6005350">LiteralPrefix</span><span class="op" id="6005363">(</span><span class="op" id="6005364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6005367">lit</span>&nbsp;<span class="op" id="6005371">:=</span>&nbsp;<span class="op" id="6005374">[</span><span class="op" id="6005375">]</span><span class="builtintype" id="6005376">byte</span><span class="op" id="6005380">(</span><span class="ident" id="6005381">prefix</span><span class="op" id="6005387">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6005391">//&nbsp;worst-case&nbsp;scenario:&nbsp;no&nbsp;literal&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005434">if</span>&nbsp;<span class="ident" id="6005437">prefix</span>&nbsp;<span class="op" id="6005444">==</span>&nbsp;<span class="string" id="6005447">&#34;&#34;</span>&nbsp;<span class="op" id="6005450">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005454">return</span>&nbsp;<span class="ident" id="6005461">r</span><span class="op" id="6005462">.</span><span class="ident" id="6005463">FindAllIndex</span><span class="op" id="6005475">(</span><span class="ident" id="6005476">x</span><span class="op" id="6005477">.</span><span class="ident" id="6005478">data</span><span class="op" id="6005482">,</span>&nbsp;<span class="ident" id="6005484">n</span><span class="op" id="6005485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6005488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6005492">//&nbsp;if&nbsp;regexp&nbsp;is&nbsp;a&nbsp;literal&nbsp;just&nbsp;use&nbsp;Lookup&nbsp;and&nbsp;convert&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6005551">//&nbsp;result&nbsp;into&nbsp;match&nbsp;pairs</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005579">if</span>&nbsp;<span class="ident" id="6005582">complete</span>&nbsp;<span class="op" id="6005591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6005595">//&nbsp;Lookup&nbsp;returns&nbsp;indices&nbsp;that&nbsp;may&nbsp;belong&nbsp;to&nbsp;overlapping&nbsp;matches.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6005663">//&nbsp;After&nbsp;eliminating&nbsp;them,&nbsp;we&nbsp;may&nbsp;end&nbsp;up&nbsp;with&nbsp;fewer&nbsp;than&nbsp;n&nbsp;matches.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6005733">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;enough&nbsp;at&nbsp;the&nbsp;end,&nbsp;redo&nbsp;the&nbsp;search&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6005798">//&nbsp;increased&nbsp;value&nbsp;n1,&nbsp;but&nbsp;only&nbsp;if&nbsp;Lookup&nbsp;returned&nbsp;all&nbsp;the&nbsp;requested</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6005869">//&nbsp;indices&nbsp;in&nbsp;the&nbsp;first&nbsp;place&nbsp;(if&nbsp;it&nbsp;returned&nbsp;fewer&nbsp;than&nbsp;that&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6005938">//&nbsp;there&nbsp;cannot&nbsp;be&nbsp;more).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6005966">for</span>&nbsp;<span class="ident" id="6005970">n1</span>&nbsp;<span class="op" id="6005973">:=</span>&nbsp;<span class="ident" id="6005976">n</span><span class="op" id="6005977">;</span>&nbsp;<span class="op" id="6005979">;</span>&nbsp;<span class="ident" id="6005981">n1</span>&nbsp;<span class="op" id="6005984">+=</span>&nbsp;<span class="num" id="6005987">2</span>&nbsp;<span class="op" id="6005989">*</span>&nbsp;<span class="op" id="6005991">(</span><span class="ident" id="6005992">n</span>&nbsp;<span class="op" id="6005994">-</span>&nbsp;<span class="builtinfunc" id="6005996">len</span><span class="op" id="6005999">(</span><span class="ident" id="6006000">result</span><span class="op" id="6006006">)</span><span class="op" id="6006007">)</span>&nbsp;<span class="comment" id="6006009">/*&nbsp;overflow&nbsp;ok&nbsp;*/</span>&nbsp;<span class="op" id="6006027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006032">indices</span>&nbsp;<span class="op" id="6006040">:=</span>&nbsp;<span class="ident" id="6006043">x</span><span class="op" id="6006044">.</span><span class="ident" id="6006045">Lookup</span><span class="op" id="6006051">(</span><span class="ident" id="6006052">lit</span><span class="op" id="6006055">,</span>&nbsp;<span class="ident" id="6006057">n1</span><span class="op" id="6006059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006064">if</span>&nbsp;<span class="builtinfunc" id="6006067">len</span><span class="op" id="6006070">(</span><span class="ident" id="6006071">indices</span><span class="op" id="6006078">)</span>&nbsp;<span class="op" id="6006080">==</span>&nbsp;<span class="num" id="6006083">0</span>&nbsp;<span class="op" id="6006085">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006091">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6006101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006106">sort</span><span class="op" id="6006110">.</span><span class="ident" id="6006111">Ints</span><span class="op" id="6006115">(</span><span class="ident" id="6006116">indices</span><span class="op" id="6006123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006128">pairs</span>&nbsp;<span class="op" id="6006134">:=</span>&nbsp;<span class="builtinfunc" id="6006137">make</span><span class="op" id="6006141">(</span><span class="op" id="6006142">[</span><span class="op" id="6006143">]</span><span class="builtintype" id="6006144">int</span><span class="op" id="6006147">,</span>&nbsp;<span class="num" id="6006149">2</span><span class="op" id="6006150">*</span><span class="builtinfunc" id="6006151">len</span><span class="op" id="6006154">(</span><span class="ident" id="6006155">indices</span><span class="op" id="6006162">)</span><span class="op" id="6006163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006168">result</span>&nbsp;<span class="op" id="6006175">=</span>&nbsp;<span class="builtinfunc" id="6006177">make</span><span class="op" id="6006181">(</span><span class="op" id="6006182">[</span><span class="op" id="6006183">]</span><span class="op" id="6006184">[</span><span class="op" id="6006185">]</span><span class="builtintype" id="6006186">int</span><span class="op" id="6006189">,</span>&nbsp;<span class="builtinfunc" id="6006191">len</span><span class="op" id="6006194">(</span><span class="ident" id="6006195">indices</span><span class="op" id="6006202">)</span><span class="op" id="6006203">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006208">count</span>&nbsp;<span class="op" id="6006214">:=</span>&nbsp;<span class="num" id="6006217">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006222">prev</span>&nbsp;<span class="op" id="6006227">:=</span>&nbsp;<span class="num" id="6006230">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006235">for</span>&nbsp;<span class="ident" id="6006239">_</span><span class="op" id="6006240">,</span>&nbsp;<span class="ident" id="6006242">i</span>&nbsp;<span class="op" id="6006244">:=</span>&nbsp;<span class="keyword" id="6006247">range</span>&nbsp;<span class="ident" id="6006253">indices</span>&nbsp;<span class="op" id="6006261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006267">if</span>&nbsp;<span class="ident" id="6006270">count</span>&nbsp;<span class="op" id="6006276">==</span>&nbsp;<span class="ident" id="6006279">n</span>&nbsp;<span class="op" id="6006281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006288">break</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6006298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006304">//&nbsp;ignore&nbsp;indices&nbsp;leading&nbsp;to&nbsp;overlapping&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006357">if</span>&nbsp;<span class="ident" id="6006360">prev</span>&nbsp;<span class="op" id="6006365">&lt;=</span>&nbsp;<span class="ident" id="6006368">i</span>&nbsp;<span class="op" id="6006370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006377">j</span>&nbsp;<span class="op" id="6006379">:=</span>&nbsp;<span class="num" id="6006382">2</span>&nbsp;<span class="op" id="6006384">*</span>&nbsp;<span class="ident" id="6006386">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006397">pairs</span><span class="op" id="6006402">[</span><span class="ident" id="6006403">j</span><span class="op" id="6006404">+</span><span class="num" id="6006405">0</span><span class="op" id="6006406">]</span>&nbsp;<span class="op" id="6006408">=</span>&nbsp;<span class="ident" id="6006410">i</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006417">pairs</span><span class="op" id="6006422">[</span><span class="ident" id="6006423">j</span><span class="op" id="6006424">+</span><span class="num" id="6006425">1</span><span class="op" id="6006426">]</span>&nbsp;<span class="op" id="6006428">=</span>&nbsp;<span class="ident" id="6006430">i</span>&nbsp;<span class="op" id="6006432">+</span>&nbsp;<span class="builtinfunc" id="6006434">len</span><span class="op" id="6006437">(</span><span class="ident" id="6006438">lit</span><span class="op" id="6006441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006448">result</span><span class="op" id="6006454">[</span><span class="ident" id="6006455">count</span><span class="op" id="6006460">]</span>&nbsp;<span class="op" id="6006462">=</span>&nbsp;<span class="ident" id="6006464">pairs</span><span class="op" id="6006469">[</span><span class="ident" id="6006470">j</span>&nbsp;<span class="op" id="6006472">:</span>&nbsp;<span class="ident" id="6006474">j</span><span class="op" id="6006475">+</span><span class="num" id="6006476">2</span><span class="op" id="6006477">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006484">count</span><span class="op" id="6006489">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006497">prev</span>&nbsp;<span class="op" id="6006502">=</span>&nbsp;<span class="ident" id="6006504">i</span>&nbsp;<span class="op" id="6006506">+</span>&nbsp;<span class="builtinfunc" id="6006508">len</span><span class="op" id="6006511">(</span><span class="ident" id="6006512">lit</span><span class="op" id="6006515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6006521">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6006526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006531">result</span>&nbsp;<span class="op" id="6006538">=</span>&nbsp;<span class="ident" id="6006540">result</span><span class="op" id="6006546">[</span><span class="num" id="6006547">0</span><span class="op" id="6006548">:</span><span class="ident" id="6006549">count</span><span class="op" id="6006554">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006559">if</span>&nbsp;<span class="builtinfunc" id="6006562">len</span><span class="op" id="6006565">(</span><span class="ident" id="6006566">result</span><span class="op" id="6006572">)</span>&nbsp;<span class="op" id="6006574">&gt;=</span>&nbsp;<span class="ident" id="6006577">n</span>&nbsp;<span class="op" id="6006579">||</span>&nbsp;<span class="builtinfunc" id="6006582">len</span><span class="op" id="6006585">(</span><span class="ident" id="6006586">indices</span><span class="op" id="6006593">)</span>&nbsp;<span class="op" id="6006595">!=</span>&nbsp;<span class="ident" id="6006598">n1</span>&nbsp;<span class="op" id="6006601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006607">//&nbsp;found&nbsp;all&nbsp;matches&nbsp;or&nbsp;there&#39;s&nbsp;no&nbsp;chance&nbsp;to&nbsp;find&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006666">//&nbsp;(n&nbsp;and&nbsp;n1&nbsp;can&nbsp;be&nbsp;negative)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006700">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6006709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6006713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006717">if</span>&nbsp;<span class="builtinfunc" id="6006720">len</span><span class="op" id="6006723">(</span><span class="ident" id="6006724">result</span><span class="op" id="6006730">)</span>&nbsp;<span class="op" id="6006732">==</span>&nbsp;<span class="num" id="6006735">0</span>&nbsp;<span class="op" id="6006737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6006742">result</span>&nbsp;<span class="op" id="6006749">=</span>&nbsp;<span class="ident" id="6006751">nil</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6006757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6006761">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6006769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006773">//&nbsp;regexp&nbsp;has&nbsp;a&nbsp;non-empty&nbsp;literal&nbsp;prefix;&nbsp;Lookup(lit)&nbsp;computes</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006837">//&nbsp;the&nbsp;indices&nbsp;of&nbsp;possible&nbsp;complete&nbsp;matches;&nbsp;use&nbsp;these&nbsp;as&nbsp;starting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006905">//&nbsp;points&nbsp;for&nbsp;anchored&nbsp;searches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6006938">//&nbsp;(regexp&nbsp;&#34;^&#34;&nbsp;matches&nbsp;beginning&nbsp;of&nbsp;input,&nbsp;not&nbsp;beginning&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007005">r</span>&nbsp;<span class="op" id="6007007">=</span>&nbsp;<span class="ident" id="6007009">regexp</span><span class="op" id="6007015">.</span><span class="ident" id="6007016">MustCompile</span><span class="op" id="6007027">(</span><span class="string" id="6007028">&#34;^&#34;</span>&nbsp;<span class="op" id="6007032">+</span>&nbsp;<span class="ident" id="6007034">r</span><span class="op" id="6007035">.</span><span class="ident" id="6007036">String</span><span class="op" id="6007042">(</span><span class="op" id="6007043">)</span><span class="op" id="6007044">)</span>&nbsp;<span class="comment" id="6007046">//&nbsp;compiles&nbsp;because&nbsp;r&nbsp;compiled</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6007079">//&nbsp;same&nbsp;comment&nbsp;about&nbsp;Lookup&nbsp;applies&nbsp;here&nbsp;as&nbsp;in&nbsp;the&nbsp;loop&nbsp;above</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007143">for</span>&nbsp;<span class="ident" id="6007147">n1</span>&nbsp;<span class="op" id="6007150">:=</span>&nbsp;<span class="ident" id="6007153">n</span><span class="op" id="6007154">;</span>&nbsp;<span class="op" id="6007156">;</span>&nbsp;<span class="ident" id="6007158">n1</span>&nbsp;<span class="op" id="6007161">+=</span>&nbsp;<span class="num" id="6007164">2</span>&nbsp;<span class="op" id="6007166">*</span>&nbsp;<span class="op" id="6007168">(</span><span class="ident" id="6007169">n</span>&nbsp;<span class="op" id="6007171">-</span>&nbsp;<span class="builtinfunc" id="6007173">len</span><span class="op" id="6007176">(</span><span class="ident" id="6007177">result</span><span class="op" id="6007183">)</span><span class="op" id="6007184">)</span>&nbsp;<span class="comment" id="6007186">/*&nbsp;overflow&nbsp;ok&nbsp;*/</span>&nbsp;<span class="op" id="6007204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007208">indices</span>&nbsp;<span class="op" id="6007216">:=</span>&nbsp;<span class="ident" id="6007219">x</span><span class="op" id="6007220">.</span><span class="ident" id="6007221">Lookup</span><span class="op" id="6007227">(</span><span class="ident" id="6007228">lit</span><span class="op" id="6007231">,</span>&nbsp;<span class="ident" id="6007233">n1</span><span class="op" id="6007235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007239">if</span>&nbsp;<span class="builtinfunc" id="6007242">len</span><span class="op" id="6007245">(</span><span class="ident" id="6007246">indices</span><span class="op" id="6007253">)</span>&nbsp;<span class="op" id="6007255">==</span>&nbsp;<span class="num" id="6007258">0</span>&nbsp;<span class="op" id="6007260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007265">return</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6007274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007278">sort</span><span class="op" id="6007282">.</span><span class="ident" id="6007283">Ints</span><span class="op" id="6007287">(</span><span class="ident" id="6007288">indices</span><span class="op" id="6007295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007299">result</span>&nbsp;<span class="op" id="6007306">=</span>&nbsp;<span class="ident" id="6007308">result</span><span class="op" id="6007314">[</span><span class="num" id="6007315">0</span><span class="op" id="6007316">:</span><span class="num" id="6007317">0</span><span class="op" id="6007318">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007322">prev</span>&nbsp;<span class="op" id="6007327">:=</span>&nbsp;<span class="num" id="6007330">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007334">for</span>&nbsp;<span class="ident" id="6007338">_</span><span class="op" id="6007339">,</span>&nbsp;<span class="ident" id="6007341">i</span>&nbsp;<span class="op" id="6007343">:=</span>&nbsp;<span class="keyword" id="6007346">range</span>&nbsp;<span class="ident" id="6007352">indices</span>&nbsp;<span class="op" id="6007360">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007365">if</span>&nbsp;<span class="builtinfunc" id="6007368">len</span><span class="op" id="6007371">(</span><span class="ident" id="6007372">result</span><span class="op" id="6007378">)</span>&nbsp;<span class="op" id="6007380">==</span>&nbsp;<span class="ident" id="6007383">n</span>&nbsp;<span class="op" id="6007385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007391">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6007400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007405">m</span>&nbsp;<span class="op" id="6007407">:=</span>&nbsp;<span class="ident" id="6007410">r</span><span class="op" id="6007411">.</span><span class="ident" id="6007412">FindIndex</span><span class="op" id="6007421">(</span><span class="ident" id="6007422">x</span><span class="op" id="6007423">.</span><span class="ident" id="6007424">data</span><span class="op" id="6007428">[</span><span class="ident" id="6007429">i</span><span class="op" id="6007430">:</span><span class="op" id="6007431">]</span><span class="op" id="6007432">)</span>&nbsp;<span class="comment" id="6007434">//&nbsp;anchored&nbsp;search&nbsp;-&nbsp;will&nbsp;not&nbsp;run&nbsp;off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6007475">//&nbsp;ignore&nbsp;indices&nbsp;leading&nbsp;to&nbsp;overlapping&nbsp;matches</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007527">if</span>&nbsp;<span class="ident" id="6007530">m</span>&nbsp;<span class="op" id="6007532">!=</span>&nbsp;<span class="ident" id="6007535">nil</span>&nbsp;<span class="op" id="6007539">&amp;&amp;</span>&nbsp;<span class="ident" id="6007542">prev</span>&nbsp;<span class="op" id="6007547">&lt;=</span>&nbsp;<span class="ident" id="6007550">i</span>&nbsp;<span class="op" id="6007552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007558">m</span><span class="op" id="6007559">[</span><span class="num" id="6007560">0</span><span class="op" id="6007561">]</span>&nbsp;<span class="op" id="6007563">=</span>&nbsp;<span class="ident" id="6007565">i</span>&nbsp;<span class="comment" id="6007567">//&nbsp;correct&nbsp;m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007584">m</span><span class="op" id="6007585">[</span><span class="num" id="6007586">1</span><span class="op" id="6007587">]</span>&nbsp;<span class="op" id="6007589">+=</span>&nbsp;<span class="ident" id="6007592">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007598">result</span>&nbsp;<span class="op" id="6007605">=</span>&nbsp;<span class="builtinfunc" id="6007607">append</span><span class="op" id="6007613">(</span><span class="ident" id="6007614">result</span><span class="op" id="6007620">,</span>&nbsp;<span class="ident" id="6007622">m</span><span class="op" id="6007623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007629">prev</span>&nbsp;<span class="op" id="6007634">=</span>&nbsp;<span class="ident" id="6007636">m</span><span class="op" id="6007637">[</span><span class="num" id="6007638">1</span><span class="op" id="6007639">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6007644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6007648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007652">if</span>&nbsp;<span class="builtinfunc" id="6007655">len</span><span class="op" id="6007658">(</span><span class="ident" id="6007659">result</span><span class="op" id="6007665">)</span>&nbsp;<span class="op" id="6007667">&gt;=</span>&nbsp;<span class="ident" id="6007670">n</span>&nbsp;<span class="op" id="6007672">||</span>&nbsp;<span class="builtinfunc" id="6007675">len</span><span class="op" id="6007678">(</span><span class="ident" id="6007679">indices</span><span class="op" id="6007686">)</span>&nbsp;<span class="op" id="6007688">!=</span>&nbsp;<span class="ident" id="6007691">n1</span>&nbsp;<span class="op" id="6007694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6007699">//&nbsp;found&nbsp;all&nbsp;matches&nbsp;or&nbsp;there&#39;s&nbsp;no&nbsp;chance&nbsp;to&nbsp;find&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6007757">//&nbsp;(n&nbsp;and&nbsp;n1&nbsp;can&nbsp;be&nbsp;negative)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007790">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6007798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6007801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007804">if</span>&nbsp;<span class="builtinfunc" id="6007807">len</span><span class="op" id="6007810">(</span><span class="ident" id="6007811">result</span><span class="op" id="6007817">)</span>&nbsp;<span class="op" id="6007819">==</span>&nbsp;<span class="num" id="6007822">0</span>&nbsp;<span class="op" id="6007824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6007828">result</span>&nbsp;<span class="op" id="6007835">=</span>&nbsp;<span class="ident" id="6007837">nil</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6007842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6007845">return</span><br>
<span class="lineno"></span><span class="op" id="6007852">}</span>
</div>
</body>
</html>
