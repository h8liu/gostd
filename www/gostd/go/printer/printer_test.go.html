<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8062242">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8062297">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8062351">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8062402">package</span>&nbsp;<span class="ident" id="8062410">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8062419">import</span>&nbsp;<span class="op" id="8062426">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8062429">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8062438">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8062448">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8062456">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8062463">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8062473">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8062486">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8062498">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8062511">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8062528">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8062539">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8062546">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="8062549">const</span>&nbsp;<span class="op" id="8062555">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8062558">dataDir</span>&nbsp;&nbsp;<span class="op" id="8062567">=</span>&nbsp;<span class="string" id="8062569">&#34;testdata&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8062581">tabwidth</span>&nbsp;<span class="op" id="8062590">=</span>&nbsp;<span class="num" id="8062592">8</span><br>
<span class="lineno"></span><span class="op" id="8062594">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="8062597">var</span>&nbsp;<span class="ident" id="8062601">update</span>&nbsp;<span class="op" id="8062608">=</span>&nbsp;<span class="ident" id="8062610">flag</span><span class="op" id="8062614">.</span><span class="ident" id="8062615">Bool</span><span class="op" id="8062619">(</span><span class="string" id="8062620">&#34;update&#34;</span><span class="op" id="8062628">,</span>&nbsp;<span class="builtintype" id="8062630">false</span><span class="op" id="8062635">,</span>&nbsp;<span class="string" id="8062637">&#34;update&nbsp;golden&nbsp;files&#34;</span><span class="op" id="8062658">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8062661">var</span>&nbsp;<span class="ident" id="8062665">fset</span>&nbsp;<span class="op" id="8062670">=</span>&nbsp;<span class="ident" id="8062672">token</span><span class="op" id="8062677">.</span><span class="ident" id="8062678">NewFileSet</span><span class="op" id="8062688">(</span><span class="op" id="8062689">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="8062692">type</span>&nbsp;<span class="ident" id="8062697">checkMode</span>&nbsp;<span class="builtintype" id="8062707">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8062713">const</span>&nbsp;<span class="op" id="8062719">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8062722">export</span>&nbsp;<span class="ident" id="8062729">checkMode</span>&nbsp;<span class="op" id="8062739">=</span>&nbsp;<span class="num" id="8062741">1</span>&nbsp;<span class="op" id="8062743">&lt;&lt;</span>&nbsp;<span class="ident" id="8062746">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8062752">rawFormat</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8062763">idempotent</span><br>
<span class="lineno"></span><span class="op" id="8062774">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8062777">//&nbsp;format&nbsp;parses&nbsp;src,&nbsp;prints&nbsp;the&nbsp;corresponding&nbsp;AST,&nbsp;verifies&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="8062852">//&nbsp;src&nbsp;is&nbsp;syntactically&nbsp;correct,&nbsp;and&nbsp;returns&nbsp;the&nbsp;resulting&nbsp;src&nbsp;or&nbsp;an&nbsp;error</span><br>
<span class="lineno">40</span><span class="comment" id="8062927">//&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="8062938">func</span>&nbsp;<span class="ident" id="8062943">format</span><span class="op" id="8062949">(</span><span class="ident" id="8062950">src</span>&nbsp;<span class="op" id="8062954">[</span><span class="op" id="8062955">]</span><span class="builtintype" id="8062956">byte</span><span class="op" id="8062960">,</span>&nbsp;<span class="ident" id="8062962">mode</span>&nbsp;<span class="ident" id="8062967">checkMode</span><span class="op" id="8062976">)</span>&nbsp;<span class="op" id="8062978">(</span><span class="op" id="8062979">[</span><span class="op" id="8062980">]</span><span class="builtintype" id="8062981">byte</span><span class="op" id="8062985">,</span>&nbsp;<span class="builtintype" id="8062987">error</span><span class="op" id="8062992">)</span>&nbsp;<span class="op" id="8062994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8062997">//&nbsp;parse&nbsp;src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8063011">f</span><span class="op" id="8063012">,</span>&nbsp;<span class="ident" id="8063014">err</span>&nbsp;<span class="op" id="8063018">:=</span>&nbsp;<span class="ident" id="8063021">parser</span><span class="op" id="8063027">.</span><span class="ident" id="8063028">ParseFile</span><span class="op" id="8063037">(</span><span class="ident" id="8063038">fset</span><span class="op" id="8063042">,</span>&nbsp;<span class="string" id="8063044">&#34;&#34;</span><span class="op" id="8063046">,</span>&nbsp;<span class="ident" id="8063048">src</span><span class="op" id="8063051">,</span>&nbsp;<span class="ident" id="8063053">parser</span><span class="op" id="8063059">.</span><span class="ident" id="8063060">ParseComments</span><span class="op" id="8063073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8063076">if</span>&nbsp;<span class="ident" id="8063079">err</span>&nbsp;<span class="op" id="8063083">!=</span>&nbsp;<span class="ident" id="8063086">nil</span>&nbsp;<span class="op" id="8063090">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8063094">return</span>&nbsp;<span class="ident" id="8063101">nil</span><span class="op" id="8063104">,</span>&nbsp;<span class="ident" id="8063106">fmt</span><span class="op" id="8063109">.</span><span class="ident" id="8063110">Errorf</span><span class="op" id="8063116">(</span><span class="string" id="8063117">&#34;parse:&nbsp;%s\n%s&#34;</span><span class="op" id="8063132">,</span>&nbsp;<span class="ident" id="8063134">err</span><span class="op" id="8063137">,</span>&nbsp;<span class="ident" id="8063139">src</span><span class="op" id="8063142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8063145">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8063149">//&nbsp;filter&nbsp;exports&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8063181">if</span>&nbsp;<span class="ident" id="8063184">mode</span><span class="op" id="8063188">&amp;</span><span class="ident" id="8063189">export</span>&nbsp;<span class="op" id="8063196">!=</span>&nbsp;<span class="num" id="8063199">0</span>&nbsp;<span class="op" id="8063201">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8063205">ast</span><span class="op" id="8063208">.</span><span class="ident" id="8063209">FileExports</span><span class="op" id="8063220">(</span><span class="ident" id="8063221">f</span><span class="op" id="8063222">)</span>&nbsp;<span class="comment" id="8063224">//&nbsp;ignore&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8063243">f</span><span class="op" id="8063244">.</span><span class="ident" id="8063245">Comments</span>&nbsp;<span class="op" id="8063254">=</span>&nbsp;<span class="ident" id="8063256">nil</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="8063262">//&nbsp;don&#39;t&nbsp;print&nbsp;comments&nbsp;that&nbsp;are&nbsp;not&nbsp;in&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8063307">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8063311">//&nbsp;determine&nbsp;printer&nbsp;configuration</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8063347">cfg</span>&nbsp;<span class="op" id="8063351">:=</span>&nbsp;<span class="ident" id="8063354">Config</span><span class="op" id="8063360">{</span><span class="ident" id="8063361">Tabwidth</span><span class="op" id="8063369">:</span>&nbsp;<span class="ident" id="8063371">tabwidth</span><span class="op" id="8063379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8063382">if</span>&nbsp;<span class="ident" id="8063385">mode</span><span class="op" id="8063389">&amp;</span><span class="ident" id="8063390">rawFormat</span>&nbsp;<span class="op" id="8063400">!=</span>&nbsp;<span class="num" id="8063403">0</span>&nbsp;<span class="op" id="8063405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8063409">cfg</span><span class="op" id="8063412">.</span><span class="ident" id="8063413">Mode</span>&nbsp;<span class="op" id="8063418">|=</span>&nbsp;<span class="ident" id="8063421">RawFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8063432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8063436">//&nbsp;print&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8063450">var</span>&nbsp;<span class="ident" id="8063454">buf</span>&nbsp;<span class="ident" id="8063458">bytes</span><span class="op" id="8063463">.</span><span class="ident" id="8063464">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8063472">if</span>&nbsp;<span class="ident" id="8063475">err</span>&nbsp;<span class="op" id="8063479">:=</span>&nbsp;<span class="ident" id="8063482">cfg</span><span class="op" id="8063485">.</span><span class="ident" id="8063486">Fprint</span><span class="op" id="8063492">(</span><span class="op" id="8063493">&amp;</span><span class="ident" id="8063494">buf</span><span class="op" id="8063497">,</span>&nbsp;<span class="ident" id="8063499">fset</span><span class="op" id="8063503">,</span>&nbsp;<span class="ident" id="8063505">f</span><span class="op" id="8063506">)</span><span class="op" id="8063507">;</span>&nbsp;<span class="ident" id="8063509">err</span>&nbsp;<span class="op" id="8063513">!=</span>&nbsp;<span class="ident" id="8063516">nil</span>&nbsp;<span class="op" id="8063520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8063524">return</span>&nbsp;<span class="ident" id="8063531">nil</span><span class="op" id="8063534">,</span>&nbsp;<span class="ident" id="8063536">fmt</span><span class="op" id="8063539">.</span><span class="ident" id="8063540">Errorf</span><span class="op" id="8063546">(</span><span class="string" id="8063547">&#34;print:&nbsp;%s&#34;</span><span class="op" id="8063558">,</span>&nbsp;<span class="ident" id="8063560">err</span><span class="op" id="8063563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8063566">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8063570">//&nbsp;make&nbsp;sure&nbsp;formatted&nbsp;output&nbsp;is&nbsp;syntactically&nbsp;correct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8063626">res</span>&nbsp;<span class="op" id="8063630">:=</span>&nbsp;<span class="ident" id="8063633">buf</span><span class="op" id="8063636">.</span><span class="ident" id="8063637">Bytes</span><span class="op" id="8063642">(</span><span class="op" id="8063643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8063646">if</span>&nbsp;<span class="ident" id="8063649">_</span><span class="op" id="8063650">,</span>&nbsp;<span class="ident" id="8063652">err</span>&nbsp;<span class="op" id="8063656">:=</span>&nbsp;<span class="ident" id="8063659">parser</span><span class="op" id="8063665">.</span><span class="ident" id="8063666">ParseFile</span><span class="op" id="8063675">(</span><span class="ident" id="8063676">fset</span><span class="op" id="8063680">,</span>&nbsp;<span class="string" id="8063682">&#34;&#34;</span><span class="op" id="8063684">,</span>&nbsp;<span class="ident" id="8063686">res</span><span class="op" id="8063689">,</span>&nbsp;<span class="num" id="8063691">0</span><span class="op" id="8063692">)</span><span class="op" id="8063693">;</span>&nbsp;<span class="ident" id="8063695">err</span>&nbsp;<span class="op" id="8063699">!=</span>&nbsp;<span class="ident" id="8063702">nil</span>&nbsp;<span class="op" id="8063706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8063710">return</span>&nbsp;<span class="ident" id="8063717">nil</span><span class="op" id="8063720">,</span>&nbsp;<span class="ident" id="8063722">fmt</span><span class="op" id="8063725">.</span><span class="ident" id="8063726">Errorf</span><span class="op" id="8063732">(</span><span class="string" id="8063733">&#34;re-parse:&nbsp;%s\n%s&#34;</span><span class="op" id="8063751">,</span>&nbsp;<span class="ident" id="8063753">err</span><span class="op" id="8063756">,</span>&nbsp;<span class="ident" id="8063758">buf</span><span class="op" id="8063761">.</span><span class="ident" id="8063762">Bytes</span><span class="op" id="8063767">(</span><span class="op" id="8063768">)</span><span class="op" id="8063769">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8063772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8063776">return</span>&nbsp;<span class="ident" id="8063783">res</span><span class="op" id="8063786">,</span>&nbsp;<span class="ident" id="8063788">nil</span><br>
<span class="lineno"></span><span class="op" id="8063792">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="8063795">//&nbsp;lineAt&nbsp;returns&nbsp;the&nbsp;line&nbsp;in&nbsp;text&nbsp;starting&nbsp;at&nbsp;offset&nbsp;offs.</span><br>
<span class="lineno"></span><span class="keyword" id="8063855">func</span>&nbsp;<span class="ident" id="8063860">lineAt</span><span class="op" id="8063866">(</span><span class="ident" id="8063867">text</span>&nbsp;<span class="op" id="8063872">[</span><span class="op" id="8063873">]</span><span class="builtintype" id="8063874">byte</span><span class="op" id="8063878">,</span>&nbsp;<span class="ident" id="8063880">offs</span>&nbsp;<span class="builtintype" id="8063885">int</span><span class="op" id="8063888">)</span>&nbsp;<span class="op" id="8063890">[</span><span class="op" id="8063891">]</span><span class="builtintype" id="8063892">byte</span>&nbsp;<span class="op" id="8063897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8063900">i</span>&nbsp;<span class="op" id="8063902">:=</span>&nbsp;<span class="ident" id="8063905">offs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8063911">for</span>&nbsp;<span class="ident" id="8063915">i</span>&nbsp;<span class="op" id="8063917">&lt;</span>&nbsp;<span class="builtinfunc" id="8063919">len</span><span class="op" id="8063922">(</span><span class="ident" id="8063923">text</span><span class="op" id="8063927">)</span>&nbsp;<span class="op" id="8063929">&amp;&amp;</span>&nbsp;<span class="ident" id="8063932">text</span><span class="op" id="8063936">[</span><span class="ident" id="8063937">i</span><span class="op" id="8063938">]</span>&nbsp;<span class="op" id="8063940">!=</span>&nbsp;<span class="string" id="8063943">&#39;\n&#39;</span>&nbsp;<span class="op" id="8063948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8063952">i</span><span class="op" id="8063953">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8063957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8063960">return</span>&nbsp;<span class="ident" id="8063967">text</span><span class="op" id="8063971">[</span><span class="ident" id="8063972">offs</span><span class="op" id="8063976">:</span><span class="ident" id="8063977">i</span><span class="op" id="8063978">]</span><br>
<span class="lineno"></span><span class="op" id="8063980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8063983">//&nbsp;diff&nbsp;compares&nbsp;a&nbsp;and&nbsp;b.</span><br>
<span class="lineno">85</span><span class="keyword" id="8064009">func</span>&nbsp;<span class="ident" id="8064014">diff</span><span class="op" id="8064018">(</span><span class="ident" id="8064019">aname</span><span class="op" id="8064024">,</span>&nbsp;<span class="ident" id="8064026">bname</span>&nbsp;<span class="builtintype" id="8064032">string</span><span class="op" id="8064038">,</span>&nbsp;<span class="ident" id="8064040">a</span><span class="op" id="8064041">,</span>&nbsp;<span class="ident" id="8064043">b</span>&nbsp;<span class="op" id="8064045">[</span><span class="op" id="8064046">]</span><span class="builtintype" id="8064047">byte</span><span class="op" id="8064051">)</span>&nbsp;<span class="builtintype" id="8064053">error</span>&nbsp;<span class="op" id="8064059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8064062">var</span>&nbsp;<span class="ident" id="8064066">buf</span>&nbsp;<span class="ident" id="8064070">bytes</span><span class="op" id="8064075">.</span><span class="ident" id="8064076">Buffer</span>&nbsp;<span class="comment" id="8064083">//&nbsp;holding&nbsp;long&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8064115">//&nbsp;compare&nbsp;lengths</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8064135">if</span>&nbsp;<span class="builtinfunc" id="8064138">len</span><span class="op" id="8064141">(</span><span class="ident" id="8064142">a</span><span class="op" id="8064143">)</span>&nbsp;<span class="op" id="8064145">!=</span>&nbsp;<span class="builtinfunc" id="8064148">len</span><span class="op" id="8064151">(</span><span class="ident" id="8064152">b</span><span class="op" id="8064153">)</span>&nbsp;<span class="op" id="8064155">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8064159">fmt</span><span class="op" id="8064162">.</span><span class="ident" id="8064163">Fprintf</span><span class="op" id="8064170">(</span><span class="op" id="8064171">&amp;</span><span class="ident" id="8064172">buf</span><span class="op" id="8064175">,</span>&nbsp;<span class="string" id="8064177">&#34;\nlength&nbsp;changed:&nbsp;len(%s)&nbsp;=&nbsp;%d,&nbsp;len(%s)&nbsp;=&nbsp;%d&#34;</span><span class="op" id="8064223">,</span>&nbsp;<span class="ident" id="8064225">aname</span><span class="op" id="8064230">,</span>&nbsp;<span class="builtinfunc" id="8064232">len</span><span class="op" id="8064235">(</span><span class="ident" id="8064236">a</span><span class="op" id="8064237">)</span><span class="op" id="8064238">,</span>&nbsp;<span class="ident" id="8064240">bname</span><span class="op" id="8064245">,</span>&nbsp;<span class="builtinfunc" id="8064247">len</span><span class="op" id="8064250">(</span><span class="ident" id="8064251">b</span><span class="op" id="8064252">)</span><span class="op" id="8064253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8064256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8064260">//&nbsp;compare&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8064281">line</span>&nbsp;<span class="op" id="8064286">:=</span>&nbsp;<span class="num" id="8064289">1</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8064292">offs</span>&nbsp;<span class="op" id="8064297">:=</span>&nbsp;<span class="num" id="8064300">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8064303">for</span>&nbsp;<span class="ident" id="8064307">i</span>&nbsp;<span class="op" id="8064309">:=</span>&nbsp;<span class="num" id="8064312">0</span><span class="op" id="8064313">;</span>&nbsp;<span class="ident" id="8064315">i</span>&nbsp;<span class="op" id="8064317">&lt;</span>&nbsp;<span class="builtinfunc" id="8064319">len</span><span class="op" id="8064322">(</span><span class="ident" id="8064323">a</span><span class="op" id="8064324">)</span>&nbsp;<span class="op" id="8064326">&amp;&amp;</span>&nbsp;<span class="ident" id="8064329">i</span>&nbsp;<span class="op" id="8064331">&lt;</span>&nbsp;<span class="builtinfunc" id="8064333">len</span><span class="op" id="8064336">(</span><span class="ident" id="8064337">b</span><span class="op" id="8064338">)</span><span class="op" id="8064339">;</span>&nbsp;<span class="ident" id="8064341">i</span><span class="op" id="8064342">++</span>&nbsp;<span class="op" id="8064345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8064349">ch</span>&nbsp;<span class="op" id="8064352">:=</span>&nbsp;<span class="ident" id="8064355">a</span><span class="op" id="8064356">[</span><span class="ident" id="8064357">i</span><span class="op" id="8064358">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8064362">if</span>&nbsp;<span class="ident" id="8064365">ch</span>&nbsp;<span class="op" id="8064368">!=</span>&nbsp;<span class="ident" id="8064371">b</span><span class="op" id="8064372">[</span><span class="ident" id="8064373">i</span><span class="op" id="8064374">]</span>&nbsp;<span class="op" id="8064376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8064381">fmt</span><span class="op" id="8064384">.</span><span class="ident" id="8064385">Fprintf</span><span class="op" id="8064392">(</span><span class="op" id="8064393">&amp;</span><span class="ident" id="8064394">buf</span><span class="op" id="8064397">,</span>&nbsp;<span class="string" id="8064399">&#34;\n%s:%d:%d:&nbsp;%s&#34;</span><span class="op" id="8064415">,</span>&nbsp;<span class="ident" id="8064417">aname</span><span class="op" id="8064422">,</span>&nbsp;<span class="ident" id="8064424">line</span><span class="op" id="8064428">,</span>&nbsp;<span class="ident" id="8064430">i</span><span class="op" id="8064431">-</span><span class="ident" id="8064432">offs</span><span class="op" id="8064436">+</span><span class="num" id="8064437">1</span><span class="op" id="8064438">,</span>&nbsp;<span class="ident" id="8064440">lineAt</span><span class="op" id="8064446">(</span><span class="ident" id="8064447">a</span><span class="op" id="8064448">,</span>&nbsp;<span class="ident" id="8064450">offs</span><span class="op" id="8064454">)</span><span class="op" id="8064455">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8064460">fmt</span><span class="op" id="8064463">.</span><span class="ident" id="8064464">Fprintf</span><span class="op" id="8064471">(</span><span class="op" id="8064472">&amp;</span><span class="ident" id="8064473">buf</span><span class="op" id="8064476">,</span>&nbsp;<span class="string" id="8064478">&#34;\n%s:%d:%d:&nbsp;%s&#34;</span><span class="op" id="8064494">,</span>&nbsp;<span class="ident" id="8064496">bname</span><span class="op" id="8064501">,</span>&nbsp;<span class="ident" id="8064503">line</span><span class="op" id="8064507">,</span>&nbsp;<span class="ident" id="8064509">i</span><span class="op" id="8064510">-</span><span class="ident" id="8064511">offs</span><span class="op" id="8064515">+</span><span class="num" id="8064516">1</span><span class="op" id="8064517">,</span>&nbsp;<span class="ident" id="8064519">lineAt</span><span class="op" id="8064525">(</span><span class="ident" id="8064526">b</span><span class="op" id="8064527">,</span>&nbsp;<span class="ident" id="8064529">offs</span><span class="op" id="8064533">)</span><span class="op" id="8064534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8064539">fmt</span><span class="op" id="8064542">.</span><span class="ident" id="8064543">Fprintf</span><span class="op" id="8064550">(</span><span class="op" id="8064551">&amp;</span><span class="ident" id="8064552">buf</span><span class="op" id="8064555">,</span>&nbsp;<span class="string" id="8064557">&#34;\n\n&#34;</span><span class="op" id="8064563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8064568">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8064576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8064580">if</span>&nbsp;<span class="ident" id="8064583">ch</span>&nbsp;<span class="op" id="8064586">==</span>&nbsp;<span class="string" id="8064589">&#39;\n&#39;</span>&nbsp;<span class="op" id="8064594">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8064599">line</span><span class="op" id="8064603">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8064609">offs</span>&nbsp;<span class="op" id="8064614">=</span>&nbsp;<span class="ident" id="8064616">i</span>&nbsp;<span class="op" id="8064618">+</span>&nbsp;<span class="num" id="8064620">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8064624">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8064627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8064631">if</span>&nbsp;<span class="ident" id="8064634">buf</span><span class="op" id="8064637">.</span><span class="ident" id="8064638">Len</span><span class="op" id="8064641">(</span><span class="op" id="8064642">)</span>&nbsp;<span class="op" id="8064644">&gt;</span>&nbsp;<span class="num" id="8064646">0</span>&nbsp;<span class="op" id="8064648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8064652">return</span>&nbsp;<span class="ident" id="8064659">errors</span><span class="op" id="8064665">.</span><span class="ident" id="8064666">New</span><span class="op" id="8064669">(</span><span class="ident" id="8064670">buf</span><span class="op" id="8064673">.</span><span class="ident" id="8064674">String</span><span class="op" id="8064680">(</span><span class="op" id="8064681">)</span><span class="op" id="8064682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8064685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8064688">return</span>&nbsp;<span class="ident" id="8064695">nil</span><br>
<span class="lineno"></span><span class="op" id="8064699">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="8064702">func</span>&nbsp;<span class="ident" id="8064707">runcheck</span><span class="op" id="8064715">(</span><span class="ident" id="8064716">t</span>&nbsp;<span class="op" id="8064718">*</span><span class="ident" id="8064719">testing</span><span class="op" id="8064726">.</span><span class="ident" id="8064727">T</span><span class="op" id="8064728">,</span>&nbsp;<span class="ident" id="8064730">source</span><span class="op" id="8064736">,</span>&nbsp;<span class="ident" id="8064738">golden</span>&nbsp;<span class="builtintype" id="8064745">string</span><span class="op" id="8064751">,</span>&nbsp;<span class="ident" id="8064753">mode</span>&nbsp;<span class="ident" id="8064758">checkMode</span><span class="op" id="8064767">)</span>&nbsp;<span class="op" id="8064769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8064772">src</span><span class="op" id="8064775">,</span>&nbsp;<span class="ident" id="8064777">err</span>&nbsp;<span class="op" id="8064781">:=</span>&nbsp;<span class="ident" id="8064784">ioutil</span><span class="op" id="8064790">.</span><span class="ident" id="8064791">ReadFile</span><span class="op" id="8064799">(</span><span class="ident" id="8064800">source</span><span class="op" id="8064806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8064809">if</span>&nbsp;<span class="ident" id="8064812">err</span>&nbsp;<span class="op" id="8064816">!=</span>&nbsp;<span class="ident" id="8064819">nil</span>&nbsp;<span class="op" id="8064823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8064827">t</span><span class="op" id="8064828">.</span><span class="ident" id="8064829">Error</span><span class="op" id="8064834">(</span><span class="ident" id="8064835">err</span><span class="op" id="8064838">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8064842">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8064850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8064854">res</span><span class="op" id="8064857">,</span>&nbsp;<span class="ident" id="8064859">err</span>&nbsp;<span class="op" id="8064863">:=</span>&nbsp;<span class="ident" id="8064866">format</span><span class="op" id="8064872">(</span><span class="ident" id="8064873">src</span><span class="op" id="8064876">,</span>&nbsp;<span class="ident" id="8064878">mode</span><span class="op" id="8064882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8064885">if</span>&nbsp;<span class="ident" id="8064888">err</span>&nbsp;<span class="op" id="8064892">!=</span>&nbsp;<span class="ident" id="8064895">nil</span>&nbsp;<span class="op" id="8064899">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8064903">t</span><span class="op" id="8064904">.</span><span class="ident" id="8064905">Error</span><span class="op" id="8064910">(</span><span class="ident" id="8064911">err</span><span class="op" id="8064914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8064918">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8064926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8064930">//&nbsp;update&nbsp;golden&nbsp;files&nbsp;if&nbsp;necessary</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8064967">if</span>&nbsp;<span class="op" id="8064970">*</span><span class="ident" id="8064971">update</span>&nbsp;<span class="op" id="8064978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8064982">if</span>&nbsp;<span class="ident" id="8064985">err</span>&nbsp;<span class="op" id="8064989">:=</span>&nbsp;<span class="ident" id="8064992">ioutil</span><span class="op" id="8064998">.</span><span class="ident" id="8064999">WriteFile</span><span class="op" id="8065008">(</span><span class="ident" id="8065009">golden</span><span class="op" id="8065015">,</span>&nbsp;<span class="ident" id="8065017">res</span><span class="op" id="8065020">,</span>&nbsp;<span class="num" id="8065022">0644</span><span class="op" id="8065026">)</span><span class="op" id="8065027">;</span>&nbsp;<span class="ident" id="8065029">err</span>&nbsp;<span class="op" id="8065033">!=</span>&nbsp;<span class="ident" id="8065036">nil</span>&nbsp;<span class="op" id="8065040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8065045">t</span><span class="op" id="8065046">.</span><span class="ident" id="8065047">Error</span><span class="op" id="8065052">(</span><span class="ident" id="8065053">err</span><span class="op" id="8065056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8065060">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8065064">return</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8065072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8065076">//&nbsp;get&nbsp;golden</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8065091">gld</span><span class="op" id="8065094">,</span>&nbsp;<span class="ident" id="8065096">err</span>&nbsp;<span class="op" id="8065100">:=</span>&nbsp;<span class="ident" id="8065103">ioutil</span><span class="op" id="8065109">.</span><span class="ident" id="8065110">ReadFile</span><span class="op" id="8065118">(</span><span class="ident" id="8065119">golden</span><span class="op" id="8065125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8065128">if</span>&nbsp;<span class="ident" id="8065131">err</span>&nbsp;<span class="op" id="8065135">!=</span>&nbsp;<span class="ident" id="8065138">nil</span>&nbsp;<span class="op" id="8065142">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8065146">t</span><span class="op" id="8065147">.</span><span class="ident" id="8065148">Error</span><span class="op" id="8065153">(</span><span class="ident" id="8065154">err</span><span class="op" id="8065157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8065161">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8065169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8065173">//&nbsp;formatted&nbsp;source&nbsp;and&nbsp;golden&nbsp;must&nbsp;be&nbsp;the&nbsp;same</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8065222">if</span>&nbsp;<span class="ident" id="8065225">err</span>&nbsp;<span class="op" id="8065229">:=</span>&nbsp;<span class="ident" id="8065232">diff</span><span class="op" id="8065236">(</span><span class="ident" id="8065237">source</span><span class="op" id="8065243">,</span>&nbsp;<span class="ident" id="8065245">golden</span><span class="op" id="8065251">,</span>&nbsp;<span class="ident" id="8065253">res</span><span class="op" id="8065256">,</span>&nbsp;<span class="ident" id="8065258">gld</span><span class="op" id="8065261">)</span><span class="op" id="8065262">;</span>&nbsp;<span class="ident" id="8065264">err</span>&nbsp;<span class="op" id="8065268">!=</span>&nbsp;<span class="ident" id="8065271">nil</span>&nbsp;<span class="op" id="8065275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8065279">t</span><span class="op" id="8065280">.</span><span class="ident" id="8065281">Error</span><span class="op" id="8065286">(</span><span class="ident" id="8065287">err</span><span class="op" id="8065290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8065294">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8065302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8065306">if</span>&nbsp;<span class="ident" id="8065309">mode</span><span class="op" id="8065313">&amp;</span><span class="ident" id="8065314">idempotent</span>&nbsp;<span class="op" id="8065325">!=</span>&nbsp;<span class="num" id="8065328">0</span>&nbsp;<span class="op" id="8065330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8065334">//&nbsp;formatting&nbsp;golden&nbsp;must&nbsp;be&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8065376">//&nbsp;(This&nbsp;is&nbsp;very&nbsp;difficult&nbsp;to&nbsp;achieve&nbsp;in&nbsp;general&nbsp;and&nbsp;for&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8065439">//&nbsp;it&nbsp;is&nbsp;only&nbsp;checked&nbsp;for&nbsp;files&nbsp;explicitly&nbsp;marked&nbsp;as&nbsp;such.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8065501">res</span><span class="op" id="8065504">,</span>&nbsp;<span class="ident" id="8065506">err</span>&nbsp;<span class="op" id="8065510">=</span>&nbsp;<span class="ident" id="8065512">format</span><span class="op" id="8065518">(</span><span class="ident" id="8065519">gld</span><span class="op" id="8065522">,</span>&nbsp;<span class="ident" id="8065524">mode</span><span class="op" id="8065528">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8065532">if</span>&nbsp;<span class="ident" id="8065535">err</span>&nbsp;<span class="op" id="8065539">:=</span>&nbsp;<span class="ident" id="8065542">diff</span><span class="op" id="8065546">(</span><span class="ident" id="8065547">golden</span><span class="op" id="8065553">,</span>&nbsp;<span class="ident" id="8065555">fmt</span><span class="op" id="8065558">.</span><span class="ident" id="8065559">Sprintf</span><span class="op" id="8065566">(</span><span class="string" id="8065567">&#34;format(%s)&#34;</span><span class="op" id="8065579">,</span>&nbsp;<span class="ident" id="8065581">golden</span><span class="op" id="8065587">)</span><span class="op" id="8065588">,</span>&nbsp;<span class="ident" id="8065590">gld</span><span class="op" id="8065593">,</span>&nbsp;<span class="ident" id="8065595">res</span><span class="op" id="8065598">)</span><span class="op" id="8065599">;</span>&nbsp;<span class="ident" id="8065601">err</span>&nbsp;<span class="op" id="8065605">!=</span>&nbsp;<span class="ident" id="8065608">nil</span>&nbsp;<span class="op" id="8065612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8065617">t</span><span class="op" id="8065618">.</span><span class="ident" id="8065619">Errorf</span><span class="op" id="8065625">(</span><span class="string" id="8065626">&#34;golden&nbsp;is&nbsp;not&nbsp;idempotent:&nbsp;%s&#34;</span><span class="op" id="8065656">,</span>&nbsp;<span class="ident" id="8065658">err</span><span class="op" id="8065661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8065665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8065668">}</span><br>
<span class="lineno"></span><span class="op" id="8065670">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="8065673">func</span>&nbsp;<span class="ident" id="8065678">check</span><span class="op" id="8065683">(</span><span class="ident" id="8065684">t</span>&nbsp;<span class="op" id="8065686">*</span><span class="ident" id="8065687">testing</span><span class="op" id="8065694">.</span><span class="ident" id="8065695">T</span><span class="op" id="8065696">,</span>&nbsp;<span class="ident" id="8065698">source</span><span class="op" id="8065704">,</span>&nbsp;<span class="ident" id="8065706">golden</span>&nbsp;<span class="builtintype" id="8065713">string</span><span class="op" id="8065719">,</span>&nbsp;<span class="ident" id="8065721">mode</span>&nbsp;<span class="ident" id="8065726">checkMode</span><span class="op" id="8065735">)</span>&nbsp;<span class="op" id="8065737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8065740">//&nbsp;run&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8065757">cc</span>&nbsp;<span class="op" id="8065760">:=</span>&nbsp;<span class="builtinfunc" id="8065763">make</span><span class="op" id="8065767">(</span><span class="keyword" id="8065768">chan</span>&nbsp;<span class="builtintype" id="8065773">int</span><span class="op" id="8065776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8065779">go</span>&nbsp;<span class="keyword" id="8065782">func</span><span class="op" id="8065786">(</span><span class="op" id="8065787">)</span>&nbsp;<span class="op" id="8065789">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8065793">runcheck</span><span class="op" id="8065801">(</span><span class="ident" id="8065802">t</span><span class="op" id="8065803">,</span>&nbsp;<span class="ident" id="8065805">source</span><span class="op" id="8065811">,</span>&nbsp;<span class="ident" id="8065813">golden</span><span class="op" id="8065819">,</span>&nbsp;<span class="ident" id="8065821">mode</span><span class="op" id="8065825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8065829">cc</span>&nbsp;<span class="op" id="8065832">&lt;-</span>&nbsp;<span class="num" id="8065835">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8065838">}</span><span class="op" id="8065839">(</span><span class="op" id="8065840">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8065844">//&nbsp;wait&nbsp;with&nbsp;timeout</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8065866">select</span>&nbsp;<span class="op" id="8065873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8065876">case</span>&nbsp;<span class="op" id="8065881">&lt;-</span><span class="ident" id="8065883">time</span><span class="op" id="8065887">.</span><span class="ident" id="8065888">After</span><span class="op" id="8065893">(</span><span class="num" id="8065894">10</span>&nbsp;<span class="op" id="8065897">*</span>&nbsp;<span class="ident" id="8065899">time</span><span class="op" id="8065903">.</span><span class="ident" id="8065904">Second</span><span class="op" id="8065910">)</span><span class="op" id="8065911">:</span>&nbsp;<span class="comment" id="8065913">//&nbsp;plenty&nbsp;of&nbsp;a&nbsp;safety&nbsp;margin,&nbsp;even&nbsp;for&nbsp;very&nbsp;slow&nbsp;machines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8065973">//&nbsp;test&nbsp;running&nbsp;past&nbsp;time&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8066005">t</span><span class="op" id="8066006">.</span><span class="ident" id="8066007">Errorf</span><span class="op" id="8066013">(</span><span class="string" id="8066014">&#34;%s:&nbsp;running&nbsp;too&nbsp;slowly&#34;</span><span class="op" id="8066038">,</span>&nbsp;<span class="ident" id="8066040">source</span><span class="op" id="8066046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8066049">case</span>&nbsp;<span class="op" id="8066054">&lt;-</span><span class="ident" id="8066056">cc</span><span class="op" id="8066058">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8066062">//&nbsp;test&nbsp;finished&nbsp;within&nbsp;allotted&nbsp;time&nbsp;margin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8066108">}</span><br>
<span class="lineno"></span><span class="op" id="8066110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8066113">type</span>&nbsp;<span class="ident" id="8066118">entry</span>&nbsp;<span class="keyword" id="8066124">struct</span>&nbsp;<span class="op" id="8066131">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8066134">source</span><span class="op" id="8066140">,</span>&nbsp;<span class="ident" id="8066142">golden</span>&nbsp;<span class="builtintype" id="8066149">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8066157">mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8066172">checkMode</span><br>
<span class="lineno"></span><span class="op" id="8066182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8066185">//&nbsp;Use&nbsp;go&nbsp;test&nbsp;-update&nbsp;to&nbsp;create/update&nbsp;the&nbsp;respective&nbsp;golden&nbsp;files.</span><br>
<span class="lineno">185</span><span class="keyword" id="8066254">var</span>&nbsp;<span class="ident" id="8066258">data</span>&nbsp;<span class="op" id="8066263">=</span>&nbsp;<span class="op" id="8066265">[</span><span class="op" id="8066266">]</span><span class="ident" id="8066267">entry</span><span class="op" id="8066272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8066275">{</span><span class="string" id="8066276">&#34;empty.input&#34;</span><span class="op" id="8066289">,</span>&nbsp;<span class="string" id="8066291">&#34;empty.golden&#34;</span><span class="op" id="8066305">,</span>&nbsp;<span class="ident" id="8066307">idempotent</span><span class="op" id="8066317">}</span><span class="op" id="8066318">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8066321">{</span><span class="string" id="8066322">&#34;comments.input&#34;</span><span class="op" id="8066338">,</span>&nbsp;<span class="string" id="8066340">&#34;comments.golden&#34;</span><span class="op" id="8066357">,</span>&nbsp;<span class="num" id="8066359">0</span><span class="op" id="8066360">}</span><span class="op" id="8066361">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8066364">{</span><span class="string" id="8066365">&#34;comments.input&#34;</span><span class="op" id="8066381">,</span>&nbsp;<span class="string" id="8066383">&#34;comments.x&#34;</span><span class="op" id="8066395">,</span>&nbsp;<span class="ident" id="8066397">export</span><span class="op" id="8066403">}</span><span class="op" id="8066404">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8066407">{</span><span class="string" id="8066408">&#34;comments2.input&#34;</span><span class="op" id="8066425">,</span>&nbsp;<span class="string" id="8066427">&#34;comments2.golden&#34;</span><span class="op" id="8066445">,</span>&nbsp;<span class="ident" id="8066447">idempotent</span><span class="op" id="8066457">}</span><span class="op" id="8066458">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8066461">{</span><span class="string" id="8066462">&#34;linebreaks.input&#34;</span><span class="op" id="8066480">,</span>&nbsp;<span class="string" id="8066482">&#34;linebreaks.golden&#34;</span><span class="op" id="8066501">,</span>&nbsp;<span class="ident" id="8066503">idempotent</span><span class="op" id="8066513">}</span><span class="op" id="8066514">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8066517">{</span><span class="string" id="8066518">&#34;expressions.input&#34;</span><span class="op" id="8066537">,</span>&nbsp;<span class="string" id="8066539">&#34;expressions.golden&#34;</span><span class="op" id="8066559">,</span>&nbsp;<span class="ident" id="8066561">idempotent</span><span class="op" id="8066571">}</span><span class="op" id="8066572">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8066575">{</span><span class="string" id="8066576">&#34;expressions.input&#34;</span><span class="op" id="8066595">,</span>&nbsp;<span class="string" id="8066597">&#34;expressions.raw&#34;</span><span class="op" id="8066614">,</span>&nbsp;<span class="ident" id="8066616">rawFormat</span>&nbsp;<span class="op" id="8066626">|</span>&nbsp;<span class="ident" id="8066628">idempotent</span><span class="op" id="8066638">}</span><span class="op" id="8066639">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8066642">{</span><span class="string" id="8066643">&#34;declarations.input&#34;</span><span class="op" id="8066663">,</span>&nbsp;<span class="string" id="8066665">&#34;declarations.golden&#34;</span><span class="op" id="8066686">,</span>&nbsp;<span class="num" id="8066688">0</span><span class="op" id="8066689">}</span><span class="op" id="8066690">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8066693">{</span><span class="string" id="8066694">&#34;statements.input&#34;</span><span class="op" id="8066712">,</span>&nbsp;<span class="string" id="8066714">&#34;statements.golden&#34;</span><span class="op" id="8066733">,</span>&nbsp;<span class="num" id="8066735">0</span><span class="op" id="8066736">}</span><span class="op" id="8066737">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8066740">{</span><span class="string" id="8066741">&#34;slow.input&#34;</span><span class="op" id="8066753">,</span>&nbsp;<span class="string" id="8066755">&#34;slow.golden&#34;</span><span class="op" id="8066768">,</span>&nbsp;<span class="ident" id="8066770">idempotent</span><span class="op" id="8066780">}</span><span class="op" id="8066781">,</span><br>
<span class="lineno"></span><span class="op" id="8066783">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8066786">func</span>&nbsp;<span class="ident" id="8066791">TestFiles</span><span class="op" id="8066800">(</span><span class="ident" id="8066801">t</span>&nbsp;<span class="op" id="8066803">*</span><span class="ident" id="8066804">testing</span><span class="op" id="8066811">.</span><span class="ident" id="8066812">T</span><span class="op" id="8066813">)</span>&nbsp;<span class="op" id="8066815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8066818">for</span>&nbsp;<span class="ident" id="8066822">_</span><span class="op" id="8066823">,</span>&nbsp;<span class="ident" id="8066825">e</span>&nbsp;<span class="op" id="8066827">:=</span>&nbsp;<span class="keyword" id="8066830">range</span>&nbsp;<span class="ident" id="8066836">data</span>&nbsp;<span class="op" id="8066841">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8066845">source</span>&nbsp;<span class="op" id="8066852">:=</span>&nbsp;<span class="ident" id="8066855">filepath</span><span class="op" id="8066863">.</span><span class="ident" id="8066864">Join</span><span class="op" id="8066868">(</span><span class="ident" id="8066869">dataDir</span><span class="op" id="8066876">,</span>&nbsp;<span class="ident" id="8066878">e</span><span class="op" id="8066879">.</span><span class="ident" id="8066880">source</span><span class="op" id="8066886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8066890">golden</span>&nbsp;<span class="op" id="8066897">:=</span>&nbsp;<span class="ident" id="8066900">filepath</span><span class="op" id="8066908">.</span><span class="ident" id="8066909">Join</span><span class="op" id="8066913">(</span><span class="ident" id="8066914">dataDir</span><span class="op" id="8066921">,</span>&nbsp;<span class="ident" id="8066923">e</span><span class="op" id="8066924">.</span><span class="ident" id="8066925">golden</span><span class="op" id="8066931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8066935">check</span><span class="op" id="8066940">(</span><span class="ident" id="8066941">t</span><span class="op" id="8066942">,</span>&nbsp;<span class="ident" id="8066944">source</span><span class="op" id="8066950">,</span>&nbsp;<span class="ident" id="8066952">golden</span><span class="op" id="8066958">,</span>&nbsp;<span class="ident" id="8066960">e</span><span class="op" id="8066961">.</span><span class="ident" id="8066962">mode</span><span class="op" id="8066966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8066970">//&nbsp;TODO(gri)&nbsp;check&nbsp;that&nbsp;golden&nbsp;is&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8067017">//check(t,&nbsp;golden,&nbsp;golden,&nbsp;e.mode)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8067053">}</span><br>
<span class="lineno"></span><span class="op" id="8067055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8067058">//&nbsp;TestLineComments,&nbsp;using&nbsp;a&nbsp;simple&nbsp;test&nbsp;case,&nbsp;checks&nbsp;that&nbsp;consecutive&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="8067134">//&nbsp;comments&nbsp;are&nbsp;properly&nbsp;terminated&nbsp;with&nbsp;a&nbsp;newline&nbsp;even&nbsp;if&nbsp;the&nbsp;AST&nbsp;position</span><br>
<span class="lineno">210</span><span class="comment" id="8067210">//&nbsp;information&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span><span class="comment" id="8067239">//</span><br>
<span class="lineno"></span><span class="keyword" id="8067242">func</span>&nbsp;<span class="ident" id="8067247">TestLineComments</span><span class="op" id="8067263">(</span><span class="ident" id="8067264">t</span>&nbsp;<span class="op" id="8067266">*</span><span class="ident" id="8067267">testing</span><span class="op" id="8067274">.</span><span class="ident" id="8067275">T</span><span class="op" id="8067276">)</span>&nbsp;<span class="op" id="8067278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8067281">const</span>&nbsp;<span class="ident" id="8067287">src</span>&nbsp;<span class="op" id="8067291">=</span>&nbsp;<span class="string" id="8067293">`//&nbsp;comment&nbsp;1<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;comment&nbsp;2<br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;comment&nbsp;3<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsppackage&nbsp;main<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8067354">fset</span>&nbsp;<span class="op" id="8067359">:=</span>&nbsp;<span class="ident" id="8067362">token</span><span class="op" id="8067367">.</span><span class="ident" id="8067368">NewFileSet</span><span class="op" id="8067378">(</span><span class="op" id="8067379">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8067382">f</span><span class="op" id="8067383">,</span>&nbsp;<span class="ident" id="8067385">err</span>&nbsp;<span class="op" id="8067389">:=</span>&nbsp;<span class="ident" id="8067392">parser</span><span class="op" id="8067398">.</span><span class="ident" id="8067399">ParseFile</span><span class="op" id="8067408">(</span><span class="ident" id="8067409">fset</span><span class="op" id="8067413">,</span>&nbsp;<span class="string" id="8067415">&#34;&#34;</span><span class="op" id="8067417">,</span>&nbsp;<span class="ident" id="8067419">src</span><span class="op" id="8067422">,</span>&nbsp;<span class="ident" id="8067424">parser</span><span class="op" id="8067430">.</span><span class="ident" id="8067431">ParseComments</span><span class="op" id="8067444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8067447">if</span>&nbsp;<span class="ident" id="8067450">err</span>&nbsp;<span class="op" id="8067454">!=</span>&nbsp;<span class="ident" id="8067457">nil</span>&nbsp;<span class="op" id="8067461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8067465">panic</span><span class="op" id="8067470">(</span><span class="ident" id="8067471">err</span><span class="op" id="8067474">)</span>&nbsp;<span class="comment" id="8067476">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8067494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8067498">var</span>&nbsp;<span class="ident" id="8067502">buf</span>&nbsp;<span class="ident" id="8067506">bytes</span><span class="op" id="8067511">.</span><span class="ident" id="8067512">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8067520">fset</span>&nbsp;<span class="op" id="8067525">=</span>&nbsp;<span class="ident" id="8067527">token</span><span class="op" id="8067532">.</span><span class="ident" id="8067533">NewFileSet</span><span class="op" id="8067543">(</span><span class="op" id="8067544">)</span>&nbsp;<span class="comment" id="8067546">//&nbsp;use&nbsp;the&nbsp;wrong&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8067573">Fprint</span><span class="op" id="8067579">(</span><span class="op" id="8067580">&amp;</span><span class="ident" id="8067581">buf</span><span class="op" id="8067584">,</span>&nbsp;<span class="ident" id="8067586">fset</span><span class="op" id="8067590">,</span>&nbsp;<span class="ident" id="8067592">f</span><span class="op" id="8067593">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8067597">nlines</span>&nbsp;<span class="op" id="8067604">:=</span>&nbsp;<span class="num" id="8067607">0</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8067610">for</span>&nbsp;<span class="ident" id="8067614">_</span><span class="op" id="8067615">,</span>&nbsp;<span class="ident" id="8067617">ch</span>&nbsp;<span class="op" id="8067620">:=</span>&nbsp;<span class="keyword" id="8067623">range</span>&nbsp;<span class="ident" id="8067629">buf</span><span class="op" id="8067632">.</span><span class="ident" id="8067633">Bytes</span><span class="op" id="8067638">(</span><span class="op" id="8067639">)</span>&nbsp;<span class="op" id="8067641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8067645">if</span>&nbsp;<span class="ident" id="8067648">ch</span>&nbsp;<span class="op" id="8067651">==</span>&nbsp;<span class="string" id="8067654">&#39;\n&#39;</span>&nbsp;<span class="op" id="8067659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8067664">nlines</span><span class="op" id="8067670">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8067675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8067678">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8067682">const</span>&nbsp;<span class="ident" id="8067688">expected</span>&nbsp;<span class="op" id="8067697">=</span>&nbsp;<span class="num" id="8067699">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8067702">if</span>&nbsp;<span class="ident" id="8067705">nlines</span>&nbsp;<span class="op" id="8067712">&lt;</span>&nbsp;<span class="ident" id="8067714">expected</span>&nbsp;<span class="op" id="8067723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8067727">t</span><span class="op" id="8067728">.</span><span class="ident" id="8067729">Errorf</span><span class="op" id="8067735">(</span><span class="string" id="8067736">&#34;got&nbsp;%d,&nbsp;expected&nbsp;%d\n&#34;</span><span class="op" id="8067759">,</span>&nbsp;<span class="ident" id="8067761">nlines</span><span class="op" id="8067767">,</span>&nbsp;<span class="ident" id="8067769">expected</span><span class="op" id="8067777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8067781">t</span><span class="op" id="8067782">.</span><span class="ident" id="8067783">Errorf</span><span class="op" id="8067789">(</span><span class="string" id="8067790">&#34;result:\n%s&#34;</span><span class="op" id="8067803">,</span>&nbsp;<span class="ident" id="8067805">buf</span><span class="op" id="8067808">.</span><span class="ident" id="8067809">Bytes</span><span class="op" id="8067814">(</span><span class="op" id="8067815">)</span><span class="op" id="8067816">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8067819">}</span><br>
<span class="lineno"></span><span class="op" id="8067821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8067824">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;can&nbsp;be&nbsp;invoked&nbsp;during&nbsp;initialization.</span><br>
<span class="lineno"></span><span class="keyword" id="8067889">func</span>&nbsp;<span class="ident" id="8067894">init</span><span class="op" id="8067898">(</span><span class="op" id="8067899">)</span>&nbsp;<span class="op" id="8067901">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8067904">const</span>&nbsp;<span class="ident" id="8067910">name</span>&nbsp;<span class="op" id="8067915">=</span>&nbsp;<span class="string" id="8067917">&#34;foobar&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8067927">var</span>&nbsp;<span class="ident" id="8067931">buf</span>&nbsp;<span class="ident" id="8067935">bytes</span><span class="op" id="8067940">.</span><span class="ident" id="8067941">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8067949">if</span>&nbsp;<span class="ident" id="8067952">err</span>&nbsp;<span class="op" id="8067956">:=</span>&nbsp;<span class="ident" id="8067959">Fprint</span><span class="op" id="8067965">(</span><span class="op" id="8067966">&amp;</span><span class="ident" id="8067967">buf</span><span class="op" id="8067970">,</span>&nbsp;<span class="ident" id="8067972">fset</span><span class="op" id="8067976">,</span>&nbsp;<span class="op" id="8067978">&amp;</span><span class="ident" id="8067979">ast</span><span class="op" id="8067982">.</span><span class="ident" id="8067983">Ident</span><span class="op" id="8067988">{</span><span class="ident" id="8067989">Name</span><span class="op" id="8067993">:</span>&nbsp;<span class="ident" id="8067995">name</span><span class="op" id="8067999">}</span><span class="op" id="8068000">)</span><span class="op" id="8068001">;</span>&nbsp;<span class="ident" id="8068003">err</span>&nbsp;<span class="op" id="8068007">!=</span>&nbsp;<span class="ident" id="8068010">nil</span>&nbsp;<span class="op" id="8068014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8068018">panic</span><span class="op" id="8068023">(</span><span class="ident" id="8068024">err</span><span class="op" id="8068027">)</span>&nbsp;<span class="comment" id="8068029">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8068047">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8068050">//&nbsp;in&nbsp;debug&nbsp;mode,&nbsp;the&nbsp;result&nbsp;contains&nbsp;additional&nbsp;information;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8068113">//&nbsp;ignore&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068127">if</span>&nbsp;<span class="ident" id="8068130">s</span>&nbsp;<span class="op" id="8068132">:=</span>&nbsp;<span class="ident" id="8068135">buf</span><span class="op" id="8068138">.</span><span class="ident" id="8068139">String</span><span class="op" id="8068145">(</span><span class="op" id="8068146">)</span><span class="op" id="8068147">;</span>&nbsp;<span class="op" id="8068149">!</span><span class="ident" id="8068150">debug</span>&nbsp;<span class="op" id="8068156">&amp;&amp;</span>&nbsp;<span class="ident" id="8068159">s</span>&nbsp;<span class="op" id="8068161">!=</span>&nbsp;<span class="ident" id="8068164">name</span>&nbsp;<span class="op" id="8068169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8068173">panic</span><span class="op" id="8068178">(</span><span class="string" id="8068179">&#34;got&nbsp;&#34;</span>&nbsp;<span class="op" id="8068186">+</span>&nbsp;<span class="ident" id="8068188">s</span>&nbsp;<span class="op" id="8068190">+</span>&nbsp;<span class="string" id="8068192">&#34;,&nbsp;want&nbsp;&#34;</span>&nbsp;<span class="op" id="8068202">+</span>&nbsp;<span class="ident" id="8068204">name</span><span class="op" id="8068208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8068211">}</span><br>
<span class="lineno">255</span><span class="op" id="8068213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8068216">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;doesn&#39;t&nbsp;crash&nbsp;if&nbsp;the&nbsp;AST&nbsp;contains&nbsp;BadXXX&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="8068291">func</span>&nbsp;<span class="ident" id="8068296">TestBadNodes</span><span class="op" id="8068308">(</span><span class="ident" id="8068309">t</span>&nbsp;<span class="op" id="8068311">*</span><span class="ident" id="8068312">testing</span><span class="op" id="8068319">.</span><span class="ident" id="8068320">T</span><span class="op" id="8068321">)</span>&nbsp;<span class="op" id="8068323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068326">const</span>&nbsp;<span class="ident" id="8068332">src</span>&nbsp;<span class="op" id="8068336">=</span>&nbsp;<span class="string" id="8068338">&#34;package&nbsp;p\n(&#34;</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068354">const</span>&nbsp;<span class="ident" id="8068360">res</span>&nbsp;<span class="op" id="8068364">=</span>&nbsp;<span class="string" id="8068366">&#34;package&nbsp;p\nBadDecl\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068390">f</span><span class="op" id="8068391">,</span>&nbsp;<span class="ident" id="8068393">err</span>&nbsp;<span class="op" id="8068397">:=</span>&nbsp;<span class="ident" id="8068400">parser</span><span class="op" id="8068406">.</span><span class="ident" id="8068407">ParseFile</span><span class="op" id="8068416">(</span><span class="ident" id="8068417">fset</span><span class="op" id="8068421">,</span>&nbsp;<span class="string" id="8068423">&#34;&#34;</span><span class="op" id="8068425">,</span>&nbsp;<span class="ident" id="8068427">src</span><span class="op" id="8068430">,</span>&nbsp;<span class="ident" id="8068432">parser</span><span class="op" id="8068438">.</span><span class="ident" id="8068439">ParseComments</span><span class="op" id="8068452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068455">if</span>&nbsp;<span class="ident" id="8068458">err</span>&nbsp;<span class="op" id="8068462">==</span>&nbsp;<span class="ident" id="8068465">nil</span>&nbsp;<span class="op" id="8068469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068473">t</span><span class="op" id="8068474">.</span><span class="ident" id="8068475">Error</span><span class="op" id="8068480">(</span><span class="string" id="8068481">&#34;expected&nbsp;illegal&nbsp;program&#34;</span><span class="op" id="8068507">)</span>&nbsp;<span class="comment" id="8068509">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8068527">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068530">var</span>&nbsp;<span class="ident" id="8068534">buf</span>&nbsp;<span class="ident" id="8068538">bytes</span><span class="op" id="8068543">.</span><span class="ident" id="8068544">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068552">Fprint</span><span class="op" id="8068558">(</span><span class="op" id="8068559">&amp;</span><span class="ident" id="8068560">buf</span><span class="op" id="8068563">,</span>&nbsp;<span class="ident" id="8068565">fset</span><span class="op" id="8068569">,</span>&nbsp;<span class="ident" id="8068571">f</span><span class="op" id="8068572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068575">if</span>&nbsp;<span class="ident" id="8068578">buf</span><span class="op" id="8068581">.</span><span class="ident" id="8068582">String</span><span class="op" id="8068588">(</span><span class="op" id="8068589">)</span>&nbsp;<span class="op" id="8068591">!=</span>&nbsp;<span class="ident" id="8068594">res</span>&nbsp;<span class="op" id="8068598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068602">t</span><span class="op" id="8068603">.</span><span class="ident" id="8068604">Errorf</span><span class="op" id="8068610">(</span><span class="string" id="8068611">&#34;got&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="8068632">,</span>&nbsp;<span class="ident" id="8068634">buf</span><span class="op" id="8068637">.</span><span class="ident" id="8068638">String</span><span class="op" id="8068644">(</span><span class="op" id="8068645">)</span><span class="op" id="8068646">,</span>&nbsp;<span class="ident" id="8068648">res</span><span class="op" id="8068651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8068654">}</span><br>
<span class="lineno">270</span><span class="op" id="8068656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8068659">//&nbsp;testComment&nbsp;verifies&nbsp;that&nbsp;f&nbsp;can&nbsp;be&nbsp;parsed&nbsp;again&nbsp;after&nbsp;printing&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="8068728">//&nbsp;with&nbsp;its&nbsp;first&nbsp;comment&nbsp;set&nbsp;to&nbsp;comment&nbsp;at&nbsp;any&nbsp;possible&nbsp;source&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="8068800">func</span>&nbsp;<span class="ident" id="8068805">testComment</span><span class="op" id="8068816">(</span><span class="ident" id="8068817">t</span>&nbsp;<span class="op" id="8068819">*</span><span class="ident" id="8068820">testing</span><span class="op" id="8068827">.</span><span class="ident" id="8068828">T</span><span class="op" id="8068829">,</span>&nbsp;<span class="ident" id="8068831">f</span>&nbsp;<span class="op" id="8068833">*</span><span class="ident" id="8068834">ast</span><span class="op" id="8068837">.</span><span class="ident" id="8068838">File</span><span class="op" id="8068842">,</span>&nbsp;<span class="ident" id="8068844">srclen</span>&nbsp;<span class="builtintype" id="8068851">int</span><span class="op" id="8068854">,</span>&nbsp;<span class="ident" id="8068856">comment</span>&nbsp;<span class="op" id="8068864">*</span><span class="ident" id="8068865">ast</span><span class="op" id="8068868">.</span><span class="ident" id="8068869">Comment</span><span class="op" id="8068876">)</span>&nbsp;<span class="op" id="8068878">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068881">f</span><span class="op" id="8068882">.</span><span class="ident" id="8068883">Comments</span><span class="op" id="8068891">[</span><span class="num" id="8068892">0</span><span class="op" id="8068893">]</span><span class="op" id="8068894">.</span><span class="ident" id="8068895">List</span><span class="op" id="8068899">[</span><span class="num" id="8068900">0</span><span class="op" id="8068901">]</span>&nbsp;<span class="op" id="8068903">=</span>&nbsp;<span class="ident" id="8068905">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068914">var</span>&nbsp;<span class="ident" id="8068918">buf</span>&nbsp;<span class="ident" id="8068922">bytes</span><span class="op" id="8068927">.</span><span class="ident" id="8068928">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8068936">for</span>&nbsp;<span class="ident" id="8068940">offs</span>&nbsp;<span class="op" id="8068945">:=</span>&nbsp;<span class="num" id="8068948">0</span><span class="op" id="8068949">;</span>&nbsp;<span class="ident" id="8068951">offs</span>&nbsp;<span class="op" id="8068956">&lt;=</span>&nbsp;<span class="ident" id="8068959">srclen</span><span class="op" id="8068965">;</span>&nbsp;<span class="ident" id="8068967">offs</span><span class="op" id="8068971">++</span>&nbsp;<span class="op" id="8068974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8068978">buf</span><span class="op" id="8068981">.</span><span class="ident" id="8068982">Reset</span><span class="op" id="8068987">(</span><span class="op" id="8068988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8068992">//&nbsp;Printing&nbsp;f&nbsp;should&nbsp;result&nbsp;in&nbsp;a&nbsp;correct&nbsp;program&nbsp;no</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8069046">//&nbsp;matter&nbsp;what&nbsp;the&nbsp;(incorrect)&nbsp;comment&nbsp;position&nbsp;is.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8069100">if</span>&nbsp;<span class="ident" id="8069103">err</span>&nbsp;<span class="op" id="8069107">:=</span>&nbsp;<span class="ident" id="8069110">Fprint</span><span class="op" id="8069116">(</span><span class="op" id="8069117">&amp;</span><span class="ident" id="8069118">buf</span><span class="op" id="8069121">,</span>&nbsp;<span class="ident" id="8069123">fset</span><span class="op" id="8069127">,</span>&nbsp;<span class="ident" id="8069129">f</span><span class="op" id="8069130">)</span><span class="op" id="8069131">;</span>&nbsp;<span class="ident" id="8069133">err</span>&nbsp;<span class="op" id="8069137">!=</span>&nbsp;<span class="ident" id="8069140">nil</span>&nbsp;<span class="op" id="8069144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8069149">t</span><span class="op" id="8069150">.</span><span class="ident" id="8069151">Error</span><span class="op" id="8069156">(</span><span class="ident" id="8069157">err</span><span class="op" id="8069160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8069164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8069168">if</span>&nbsp;<span class="ident" id="8069171">_</span><span class="op" id="8069172">,</span>&nbsp;<span class="ident" id="8069174">err</span>&nbsp;<span class="op" id="8069178">:=</span>&nbsp;<span class="ident" id="8069181">parser</span><span class="op" id="8069187">.</span><span class="ident" id="8069188">ParseFile</span><span class="op" id="8069197">(</span><span class="ident" id="8069198">fset</span><span class="op" id="8069202">,</span>&nbsp;<span class="string" id="8069204">&#34;&#34;</span><span class="op" id="8069206">,</span>&nbsp;<span class="ident" id="8069208">buf</span><span class="op" id="8069211">.</span><span class="ident" id="8069212">Bytes</span><span class="op" id="8069217">(</span><span class="op" id="8069218">)</span><span class="op" id="8069219">,</span>&nbsp;<span class="num" id="8069221">0</span><span class="op" id="8069222">)</span><span class="op" id="8069223">;</span>&nbsp;<span class="ident" id="8069225">err</span>&nbsp;<span class="op" id="8069229">!=</span>&nbsp;<span class="ident" id="8069232">nil</span>&nbsp;<span class="op" id="8069236">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8069241">t</span><span class="op" id="8069242">.</span><span class="ident" id="8069243">Fatalf</span><span class="op" id="8069249">(</span><span class="string" id="8069250">&#34;incorrect&nbsp;program&nbsp;for&nbsp;pos&nbsp;=&nbsp;%d:\n%s&#34;</span><span class="op" id="8069287">,</span>&nbsp;<span class="ident" id="8069289">comment</span><span class="op" id="8069296">.</span><span class="ident" id="8069297">Slash</span><span class="op" id="8069302">,</span>&nbsp;<span class="ident" id="8069304">buf</span><span class="op" id="8069307">.</span><span class="ident" id="8069308">String</span><span class="op" id="8069314">(</span><span class="op" id="8069315">)</span><span class="op" id="8069316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8069320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8069324">//&nbsp;Position&nbsp;information&nbsp;is&nbsp;just&nbsp;an&nbsp;offset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8069369">//&nbsp;Move&nbsp;comment&nbsp;one&nbsp;byte&nbsp;down&nbsp;in&nbsp;the&nbsp;source.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8069416">comment</span><span class="op" id="8069423">.</span><span class="ident" id="8069424">Slash</span><span class="op" id="8069429">++</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8069433">}</span><br>
<span class="lineno"></span><span class="op" id="8069435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8069438">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;produces&nbsp;a&nbsp;correct&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="8069492">//&nbsp;even&nbsp;if&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;comments&nbsp;introducing&nbsp;newlines</span><br>
<span class="lineno">295</span><span class="comment" id="8069561">//&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span><span class="keyword" id="8069578">func</span>&nbsp;<span class="ident" id="8069583">TestBadComments</span><span class="op" id="8069598">(</span><span class="ident" id="8069599">t</span>&nbsp;<span class="op" id="8069601">*</span><span class="ident" id="8069602">testing</span><span class="op" id="8069609">.</span><span class="ident" id="8069610">T</span><span class="op" id="8069611">)</span>&nbsp;<span class="op" id="8069613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8069616">const</span>&nbsp;<span class="ident" id="8069622">src</span>&nbsp;<span class="op" id="8069626">=</span>&nbsp;<span class="string" id="8069628">`<br>
<span class="lineno"></span>//&nbsp;first&nbsp;comment&nbsp;-&nbsp;text&nbsp;and&nbsp;position&nbsp;changed&nbsp;by&nbsp;test<br>
<span class="lineno"></span>package&nbsp;p<br>
<span class="lineno">300</span>import&nbsp;&#34;fmt&#34;<br>
<span class="lineno"></span>const&nbsp;pi&nbsp;=&nbsp;3.14&nbsp;//&nbsp;rough&nbsp;circle<br>
<span class="lineno"></span>var&nbsp;(<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspx,&nbsp;y,&nbsp;z&nbsp;int&nbsp;=&nbsp;1,&nbsp;2,&nbsp;3<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspu,&nbsp;v&nbsp;float64<br>
<span class="lineno">305</span>)<br>
<span class="lineno"></span>func&nbsp;fibo(n&nbsp;int)&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspif&nbsp;n&nbsp;&lt;&nbsp;2&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;n&nbsp;/*&nbsp;seed&nbsp;values&nbsp;*/<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;fibo(n-1)&nbsp;+&nbsp;fibo(n-2)<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8069882">f</span><span class="op" id="8069883">,</span>&nbsp;<span class="ident" id="8069885">err</span>&nbsp;<span class="op" id="8069889">:=</span>&nbsp;<span class="ident" id="8069892">parser</span><span class="op" id="8069898">.</span><span class="ident" id="8069899">ParseFile</span><span class="op" id="8069908">(</span><span class="ident" id="8069909">fset</span><span class="op" id="8069913">,</span>&nbsp;<span class="string" id="8069915">&#34;&#34;</span><span class="op" id="8069917">,</span>&nbsp;<span class="ident" id="8069919">src</span><span class="op" id="8069922">,</span>&nbsp;<span class="ident" id="8069924">parser</span><span class="op" id="8069930">.</span><span class="ident" id="8069931">ParseComments</span><span class="op" id="8069944">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8069947">if</span>&nbsp;<span class="ident" id="8069950">err</span>&nbsp;<span class="op" id="8069954">!=</span>&nbsp;<span class="ident" id="8069957">nil</span>&nbsp;<span class="op" id="8069961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8069965">t</span><span class="op" id="8069966">.</span><span class="ident" id="8069967">Error</span><span class="op" id="8069972">(</span><span class="ident" id="8069973">err</span><span class="op" id="8069976">)</span>&nbsp;<span class="comment" id="8069978">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8069996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070000">comment</span>&nbsp;<span class="op" id="8070008">:=</span>&nbsp;<span class="ident" id="8070011">f</span><span class="op" id="8070012">.</span><span class="ident" id="8070013">Comments</span><span class="op" id="8070021">[</span><span class="num" id="8070022">0</span><span class="op" id="8070023">]</span><span class="op" id="8070024">.</span><span class="ident" id="8070025">List</span><span class="op" id="8070029">[</span><span class="num" id="8070030">0</span><span class="op" id="8070031">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070034">pos</span>&nbsp;<span class="op" id="8070038">:=</span>&nbsp;<span class="ident" id="8070041">comment</span><span class="op" id="8070048">.</span><span class="ident" id="8070049">Pos</span><span class="op" id="8070052">(</span><span class="op" id="8070053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8070056">if</span>&nbsp;<span class="ident" id="8070059">fset</span><span class="op" id="8070063">.</span><span class="ident" id="8070064">Position</span><span class="op" id="8070072">(</span><span class="ident" id="8070073">pos</span><span class="op" id="8070076">)</span><span class="op" id="8070077">.</span><span class="ident" id="8070078">Offset</span>&nbsp;<span class="op" id="8070085">!=</span>&nbsp;<span class="num" id="8070088">1</span>&nbsp;<span class="op" id="8070090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070094">t</span><span class="op" id="8070095">.</span><span class="ident" id="8070096">Error</span><span class="op" id="8070101">(</span><span class="string" id="8070102">&#34;expected&nbsp;offset&nbsp;1&#34;</span><span class="op" id="8070121">)</span>&nbsp;<span class="comment" id="8070123">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8070141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070145">testComment</span><span class="op" id="8070156">(</span><span class="ident" id="8070157">t</span><span class="op" id="8070158">,</span>&nbsp;<span class="ident" id="8070160">f</span><span class="op" id="8070161">,</span>&nbsp;<span class="builtinfunc" id="8070163">len</span><span class="op" id="8070166">(</span><span class="ident" id="8070167">src</span><span class="op" id="8070170">)</span><span class="op" id="8070171">,</span>&nbsp;<span class="op" id="8070173">&amp;</span><span class="ident" id="8070174">ast</span><span class="op" id="8070177">.</span><span class="ident" id="8070178">Comment</span><span class="op" id="8070185">{</span><span class="ident" id="8070186">Slash</span><span class="op" id="8070191">:</span>&nbsp;<span class="ident" id="8070193">pos</span><span class="op" id="8070196">,</span>&nbsp;<span class="ident" id="8070198">Text</span><span class="op" id="8070202">:</span>&nbsp;<span class="string" id="8070204">&#34;//-style&nbsp;comment&#34;</span><span class="op" id="8070222">}</span><span class="op" id="8070223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070226">testComment</span><span class="op" id="8070237">(</span><span class="ident" id="8070238">t</span><span class="op" id="8070239">,</span>&nbsp;<span class="ident" id="8070241">f</span><span class="op" id="8070242">,</span>&nbsp;<span class="builtinfunc" id="8070244">len</span><span class="op" id="8070247">(</span><span class="ident" id="8070248">src</span><span class="op" id="8070251">)</span><span class="op" id="8070252">,</span>&nbsp;<span class="op" id="8070254">&amp;</span><span class="ident" id="8070255">ast</span><span class="op" id="8070258">.</span><span class="ident" id="8070259">Comment</span><span class="op" id="8070266">{</span><span class="ident" id="8070267">Slash</span><span class="op" id="8070272">:</span>&nbsp;<span class="ident" id="8070274">pos</span><span class="op" id="8070277">,</span>&nbsp;<span class="ident" id="8070279">Text</span><span class="op" id="8070283">:</span>&nbsp;<span class="string" id="8070285">&#34;/*-style&nbsp;comment&nbsp;*/&#34;</span><span class="op" id="8070306">}</span><span class="op" id="8070307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070310">testComment</span><span class="op" id="8070321">(</span><span class="ident" id="8070322">t</span><span class="op" id="8070323">,</span>&nbsp;<span class="ident" id="8070325">f</span><span class="op" id="8070326">,</span>&nbsp;<span class="builtinfunc" id="8070328">len</span><span class="op" id="8070331">(</span><span class="ident" id="8070332">src</span><span class="op" id="8070335">)</span><span class="op" id="8070336">,</span>&nbsp;<span class="op" id="8070338">&amp;</span><span class="ident" id="8070339">ast</span><span class="op" id="8070342">.</span><span class="ident" id="8070343">Comment</span><span class="op" id="8070350">{</span><span class="ident" id="8070351">Slash</span><span class="op" id="8070356">:</span>&nbsp;<span class="ident" id="8070358">pos</span><span class="op" id="8070361">,</span>&nbsp;<span class="ident" id="8070363">Text</span><span class="op" id="8070367">:</span>&nbsp;<span class="string" id="8070369">&#34;/*-style&nbsp;\n&nbsp;comment&nbsp;*/&#34;</span><span class="op" id="8070393">}</span><span class="op" id="8070394">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070397">testComment</span><span class="op" id="8070408">(</span><span class="ident" id="8070409">t</span><span class="op" id="8070410">,</span>&nbsp;<span class="ident" id="8070412">f</span><span class="op" id="8070413">,</span>&nbsp;<span class="builtinfunc" id="8070415">len</span><span class="op" id="8070418">(</span><span class="ident" id="8070419">src</span><span class="op" id="8070422">)</span><span class="op" id="8070423">,</span>&nbsp;<span class="op" id="8070425">&amp;</span><span class="ident" id="8070426">ast</span><span class="op" id="8070429">.</span><span class="ident" id="8070430">Comment</span><span class="op" id="8070437">{</span><span class="ident" id="8070438">Slash</span><span class="op" id="8070443">:</span>&nbsp;<span class="ident" id="8070445">pos</span><span class="op" id="8070448">,</span>&nbsp;<span class="ident" id="8070450">Text</span><span class="op" id="8070454">:</span>&nbsp;<span class="string" id="8070456">&#34;/*-style&nbsp;comment&nbsp;\n\n\n&nbsp;*/&#34;</span><span class="op" id="8070484">}</span><span class="op" id="8070485">)</span><br>
<span class="lineno"></span><span class="op" id="8070487">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="8070490">type</span>&nbsp;<span class="ident" id="8070495">visitor</span>&nbsp;<span class="keyword" id="8070503">chan</span>&nbsp;<span class="op" id="8070508">*</span><span class="ident" id="8070509">ast</span><span class="op" id="8070512">.</span><span class="ident" id="8070513">Ident</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8070520">func</span>&nbsp;<span class="op" id="8070525">(</span><span class="ident" id="8070526">v</span>&nbsp;<span class="ident" id="8070528">visitor</span><span class="op" id="8070535">)</span>&nbsp;<span class="ident" id="8070537">Visit</span><span class="op" id="8070542">(</span><span class="ident" id="8070543">n</span>&nbsp;<span class="ident" id="8070545">ast</span><span class="op" id="8070548">.</span><span class="ident" id="8070549">Node</span><span class="op" id="8070553">)</span>&nbsp;<span class="op" id="8070555">(</span><span class="ident" id="8070556">w</span>&nbsp;<span class="ident" id="8070558">ast</span><span class="op" id="8070561">.</span><span class="ident" id="8070562">Visitor</span><span class="op" id="8070569">)</span>&nbsp;<span class="op" id="8070571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8070574">if</span>&nbsp;<span class="ident" id="8070577">ident</span><span class="op" id="8070582">,</span>&nbsp;<span class="ident" id="8070584">ok</span>&nbsp;<span class="op" id="8070587">:=</span>&nbsp;<span class="ident" id="8070590">n</span><span class="op" id="8070591">.</span><span class="op" id="8070592">(</span><span class="op" id="8070593">*</span><span class="ident" id="8070594">ast</span><span class="op" id="8070597">.</span><span class="ident" id="8070598">Ident</span><span class="op" id="8070603">)</span><span class="op" id="8070604">;</span>&nbsp;<span class="ident" id="8070606">ok</span>&nbsp;<span class="op" id="8070609">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070613">v</span>&nbsp;<span class="op" id="8070615">&lt;-</span>&nbsp;<span class="ident" id="8070618">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8070625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8070628">return</span>&nbsp;<span class="ident" id="8070635">v</span><br>
<span class="lineno"></span><span class="op" id="8070637">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="8070640">//&nbsp;idents&nbsp;is&nbsp;an&nbsp;iterator&nbsp;that&nbsp;returns&nbsp;all&nbsp;idents&nbsp;in&nbsp;f&nbsp;via&nbsp;the&nbsp;result&nbsp;channel.</span><br>
<span class="lineno"></span><span class="keyword" id="8070718">func</span>&nbsp;<span class="ident" id="8070723">idents</span><span class="op" id="8070729">(</span><span class="ident" id="8070730">f</span>&nbsp;<span class="op" id="8070732">*</span><span class="ident" id="8070733">ast</span><span class="op" id="8070736">.</span><span class="ident" id="8070737">File</span><span class="op" id="8070741">)</span>&nbsp;<span class="op" id="8070743">&lt;-</span><span class="keyword" id="8070745">chan</span>&nbsp;<span class="op" id="8070750">*</span><span class="ident" id="8070751">ast</span><span class="op" id="8070754">.</span><span class="ident" id="8070755">Ident</span>&nbsp;<span class="op" id="8070761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070764">v</span>&nbsp;<span class="op" id="8070766">:=</span>&nbsp;<span class="builtinfunc" id="8070769">make</span><span class="op" id="8070773">(</span><span class="ident" id="8070774">visitor</span><span class="op" id="8070781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8070784">go</span>&nbsp;<span class="keyword" id="8070787">func</span><span class="op" id="8070791">(</span><span class="op" id="8070792">)</span>&nbsp;<span class="op" id="8070794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070798">ast</span><span class="op" id="8070801">.</span><span class="ident" id="8070802">Walk</span><span class="op" id="8070806">(</span><span class="ident" id="8070807">v</span><span class="op" id="8070808">,</span>&nbsp;<span class="ident" id="8070810">f</span><span class="op" id="8070811">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8070815">close</span><span class="op" id="8070820">(</span><span class="ident" id="8070821">v</span><span class="op" id="8070822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8070825">}</span><span class="op" id="8070826">(</span><span class="op" id="8070827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8070830">return</span>&nbsp;<span class="ident" id="8070837">v</span><br>
<span class="lineno"></span><span class="op" id="8070839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="comment" id="8070842">//&nbsp;identCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;identifiers&nbsp;found&nbsp;in&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="8070902">func</span>&nbsp;<span class="ident" id="8070907">identCount</span><span class="op" id="8070917">(</span><span class="ident" id="8070918">f</span>&nbsp;<span class="op" id="8070920">*</span><span class="ident" id="8070921">ast</span><span class="op" id="8070924">.</span><span class="ident" id="8070925">File</span><span class="op" id="8070929">)</span>&nbsp;<span class="builtintype" id="8070931">int</span>&nbsp;<span class="op" id="8070935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070938">n</span>&nbsp;<span class="op" id="8070940">:=</span>&nbsp;<span class="num" id="8070943">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8070946">for</span>&nbsp;<span class="keyword" id="8070950">range</span>&nbsp;<span class="ident" id="8070956">idents</span><span class="op" id="8070962">(</span><span class="ident" id="8070963">f</span><span class="op" id="8070964">)</span>&nbsp;<span class="op" id="8070966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8070970">n</span><span class="op" id="8070971">++</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8070975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8070978">return</span>&nbsp;<span class="ident" id="8070985">n</span><br>
<span class="lineno"></span><span class="op" id="8070987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8070990">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;SourcePos&nbsp;mode&nbsp;emits&nbsp;correct&nbsp;//line&nbsp;comments</span><br>
<span class="lineno">360</span><span class="comment" id="8071054">//&nbsp;by&nbsp;testing&nbsp;that&nbsp;position&nbsp;information&nbsp;for&nbsp;matching&nbsp;identifiers</span><br>
<span class="lineno"></span><span class="comment" id="8071119">//&nbsp;is&nbsp;maintained.</span><br>
<span class="lineno"></span><span class="keyword" id="8071137">func</span>&nbsp;<span class="ident" id="8071142">TestSourcePos</span><span class="op" id="8071155">(</span><span class="ident" id="8071156">t</span>&nbsp;<span class="op" id="8071158">*</span><span class="ident" id="8071159">testing</span><span class="op" id="8071166">.</span><span class="ident" id="8071167">T</span><span class="op" id="8071168">)</span>&nbsp;<span class="op" id="8071170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8071173">const</span>&nbsp;<span class="ident" id="8071179">src</span>&nbsp;<span class="op" id="8071183">=</span>&nbsp;<span class="string" id="8071185">`<br>
<span class="lineno"></span>package&nbsp;p<br>
<span class="lineno">365</span>import&nbsp;(&nbsp;&#34;go/printer&#34;;&nbsp;&#34;math&#34;&nbsp;)<br>
<span class="lineno"></span>const&nbsp;pi&nbsp;=&nbsp;3.14;&nbsp;var&nbsp;x&nbsp;=&nbsp;0<br>
<span class="lineno"></span>type&nbsp;t&nbsp;struct{&nbsp;x,&nbsp;y,&nbsp;z&nbsp;int;&nbsp;u,&nbsp;v,&nbsp;w&nbsp;float32&nbsp;}<br>
<span class="lineno"></span>func&nbsp;(t&nbsp;*t)&nbsp;foo(a,&nbsp;b,&nbsp;c&nbsp;int)&nbsp;int&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspreturn&nbsp;a*t.x&nbsp;+&nbsp;b*t.y&nbsp;+<br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;two&nbsp;extra&nbsp;lines&nbsp;here<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;...<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspc*t.z<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8071410">//&nbsp;parse&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071429">f1</span><span class="op" id="8071431">,</span>&nbsp;<span class="ident" id="8071433">err</span>&nbsp;<span class="op" id="8071437">:=</span>&nbsp;<span class="ident" id="8071440">parser</span><span class="op" id="8071446">.</span><span class="ident" id="8071447">ParseFile</span><span class="op" id="8071456">(</span><span class="ident" id="8071457">fset</span><span class="op" id="8071461">,</span>&nbsp;<span class="string" id="8071463">&#34;src&#34;</span><span class="op" id="8071468">,</span>&nbsp;<span class="ident" id="8071470">src</span><span class="op" id="8071473">,</span>&nbsp;<span class="ident" id="8071475">parser</span><span class="op" id="8071481">.</span><span class="ident" id="8071482">ParseComments</span><span class="op" id="8071495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8071498">if</span>&nbsp;<span class="ident" id="8071501">err</span>&nbsp;<span class="op" id="8071505">!=</span>&nbsp;<span class="ident" id="8071508">nil</span>&nbsp;<span class="op" id="8071512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071516">t</span><span class="op" id="8071517">.</span><span class="ident" id="8071518">Fatal</span><span class="op" id="8071523">(</span><span class="ident" id="8071524">err</span><span class="op" id="8071527">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8071530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8071534">//&nbsp;pretty-print&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8071560">var</span>&nbsp;<span class="ident" id="8071564">buf</span>&nbsp;<span class="ident" id="8071568">bytes</span><span class="op" id="8071573">.</span><span class="ident" id="8071574">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071582">err</span>&nbsp;<span class="op" id="8071586">=</span>&nbsp;<span class="op" id="8071588">(</span><span class="op" id="8071589">&amp;</span><span class="ident" id="8071590">Config</span><span class="op" id="8071596">{</span><span class="ident" id="8071597">Mode</span><span class="op" id="8071601">:</span>&nbsp;<span class="ident" id="8071603">UseSpaces</span>&nbsp;<span class="op" id="8071613">|</span>&nbsp;<span class="ident" id="8071615">SourcePos</span><span class="op" id="8071624">,</span>&nbsp;<span class="ident" id="8071626">Tabwidth</span><span class="op" id="8071634">:</span>&nbsp;<span class="num" id="8071636">8</span><span class="op" id="8071637">}</span><span class="op" id="8071638">)</span><span class="op" id="8071639">.</span><span class="ident" id="8071640">Fprint</span><span class="op" id="8071646">(</span><span class="op" id="8071647">&amp;</span><span class="ident" id="8071648">buf</span><span class="op" id="8071651">,</span>&nbsp;<span class="ident" id="8071653">fset</span><span class="op" id="8071657">,</span>&nbsp;<span class="ident" id="8071659">f1</span><span class="op" id="8071661">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8071664">if</span>&nbsp;<span class="ident" id="8071667">err</span>&nbsp;<span class="op" id="8071671">!=</span>&nbsp;<span class="ident" id="8071674">nil</span>&nbsp;<span class="op" id="8071678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071682">t</span><span class="op" id="8071683">.</span><span class="ident" id="8071684">Fatal</span><span class="op" id="8071689">(</span><span class="ident" id="8071690">err</span><span class="op" id="8071693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8071696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8071700">//&nbsp;parse&nbsp;pretty&nbsp;printed&nbsp;original</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8071734">//&nbsp;(//line&nbsp;comments&nbsp;must&nbsp;be&nbsp;interpreted&nbsp;even&nbsp;w/o&nbsp;parser.ParseComments&nbsp;set)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071810">f2</span><span class="op" id="8071812">,</span>&nbsp;<span class="ident" id="8071814">err</span>&nbsp;<span class="op" id="8071818">:=</span>&nbsp;<span class="ident" id="8071821">parser</span><span class="op" id="8071827">.</span><span class="ident" id="8071828">ParseFile</span><span class="op" id="8071837">(</span><span class="ident" id="8071838">fset</span><span class="op" id="8071842">,</span>&nbsp;<span class="string" id="8071844">&#34;&#34;</span><span class="op" id="8071846">,</span>&nbsp;<span class="ident" id="8071848">buf</span><span class="op" id="8071851">.</span><span class="ident" id="8071852">Bytes</span><span class="op" id="8071857">(</span><span class="op" id="8071858">)</span><span class="op" id="8071859">,</span>&nbsp;<span class="num" id="8071861">0</span><span class="op" id="8071862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8071865">if</span>&nbsp;<span class="ident" id="8071868">err</span>&nbsp;<span class="op" id="8071872">!=</span>&nbsp;<span class="ident" id="8071875">nil</span>&nbsp;<span class="op" id="8071879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8071883">t</span><span class="op" id="8071884">.</span><span class="ident" id="8071885">Fatalf</span><span class="op" id="8071891">(</span><span class="string" id="8071892">&#34;%s\n%s&#34;</span><span class="op" id="8071900">,</span>&nbsp;<span class="ident" id="8071902">err</span><span class="op" id="8071905">,</span>&nbsp;<span class="ident" id="8071907">buf</span><span class="op" id="8071910">.</span><span class="ident" id="8071911">Bytes</span><span class="op" id="8071916">(</span><span class="op" id="8071917">)</span><span class="op" id="8071918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8071921">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8071925">//&nbsp;At&nbsp;this&nbsp;point&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;identifiers&nbsp;in&nbsp;f2&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8071996">//&nbsp;match&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;corresponding&nbsp;identifiers&nbsp;in&nbsp;f1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8072068">//&nbsp;number&nbsp;of&nbsp;identifiers&nbsp;must&nbsp;be&nbsp;&gt;&nbsp;0&nbsp;(test&nbsp;should&nbsp;run)&nbsp;and&nbsp;must&nbsp;match</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072139">n1</span>&nbsp;<span class="op" id="8072142">:=</span>&nbsp;<span class="ident" id="8072145">identCount</span><span class="op" id="8072155">(</span><span class="ident" id="8072156">f1</span><span class="op" id="8072158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072161">n2</span>&nbsp;<span class="op" id="8072164">:=</span>&nbsp;<span class="ident" id="8072167">identCount</span><span class="op" id="8072177">(</span><span class="ident" id="8072178">f2</span><span class="op" id="8072180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8072183">if</span>&nbsp;<span class="ident" id="8072186">n1</span>&nbsp;<span class="op" id="8072189">==</span>&nbsp;<span class="num" id="8072192">0</span>&nbsp;<span class="op" id="8072194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072198">t</span><span class="op" id="8072199">.</span><span class="ident" id="8072200">Fatal</span><span class="op" id="8072205">(</span><span class="string" id="8072206">&#34;got&nbsp;no&nbsp;idents&#34;</span><span class="op" id="8072221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8072224">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8072227">if</span>&nbsp;<span class="ident" id="8072230">n2</span>&nbsp;<span class="op" id="8072233">!=</span>&nbsp;<span class="ident" id="8072236">n1</span>&nbsp;<span class="op" id="8072239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072243">t</span><span class="op" id="8072244">.</span><span class="ident" id="8072245">Errorf</span><span class="op" id="8072251">(</span><span class="string" id="8072252">&#34;got&nbsp;%d&nbsp;idents;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8072276">,</span>&nbsp;<span class="ident" id="8072278">n2</span><span class="op" id="8072280">,</span>&nbsp;<span class="ident" id="8072282">n1</span><span class="op" id="8072284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8072287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8072291">//&nbsp;verify&nbsp;that&nbsp;all&nbsp;identifiers&nbsp;have&nbsp;correct&nbsp;line&nbsp;information</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072353">i2range</span>&nbsp;<span class="op" id="8072361">:=</span>&nbsp;<span class="ident" id="8072364">idents</span><span class="op" id="8072370">(</span><span class="ident" id="8072371">f2</span><span class="op" id="8072373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8072376">for</span>&nbsp;<span class="ident" id="8072380">i1</span>&nbsp;<span class="op" id="8072383">:=</span>&nbsp;<span class="keyword" id="8072386">range</span>&nbsp;<span class="ident" id="8072392">idents</span><span class="op" id="8072398">(</span><span class="ident" id="8072399">f1</span><span class="op" id="8072401">)</span>&nbsp;<span class="op" id="8072403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072407">i2</span>&nbsp;<span class="op" id="8072410">:=</span>&nbsp;<span class="op" id="8072413">&lt;-</span><span class="ident" id="8072415">i2range</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8072426">if</span>&nbsp;<span class="ident" id="8072429">i2</span><span class="op" id="8072431">.</span><span class="ident" id="8072432">Name</span>&nbsp;<span class="op" id="8072437">!=</span>&nbsp;<span class="ident" id="8072440">i1</span><span class="op" id="8072442">.</span><span class="ident" id="8072443">Name</span>&nbsp;<span class="op" id="8072448">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072453">t</span><span class="op" id="8072454">.</span><span class="ident" id="8072455">Errorf</span><span class="op" id="8072461">(</span><span class="string" id="8072462">&#34;got&nbsp;ident&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8072485">,</span>&nbsp;<span class="ident" id="8072487">i2</span><span class="op" id="8072489">.</span><span class="ident" id="8072490">Name</span><span class="op" id="8072494">,</span>&nbsp;<span class="ident" id="8072496">i1</span><span class="op" id="8072498">.</span><span class="ident" id="8072499">Name</span><span class="op" id="8072503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8072507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072512">l1</span>&nbsp;<span class="op" id="8072515">:=</span>&nbsp;<span class="ident" id="8072518">fset</span><span class="op" id="8072522">.</span><span class="ident" id="8072523">Position</span><span class="op" id="8072531">(</span><span class="ident" id="8072532">i1</span><span class="op" id="8072534">.</span><span class="ident" id="8072535">Pos</span><span class="op" id="8072538">(</span><span class="op" id="8072539">)</span><span class="op" id="8072540">)</span><span class="op" id="8072541">.</span><span class="ident" id="8072542">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072549">l2</span>&nbsp;<span class="op" id="8072552">:=</span>&nbsp;<span class="ident" id="8072555">fset</span><span class="op" id="8072559">.</span><span class="ident" id="8072560">Position</span><span class="op" id="8072568">(</span><span class="ident" id="8072569">i2</span><span class="op" id="8072571">.</span><span class="ident" id="8072572">Pos</span><span class="op" id="8072575">(</span><span class="op" id="8072576">)</span><span class="op" id="8072577">)</span><span class="op" id="8072578">.</span><span class="ident" id="8072579">Line</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8072586">if</span>&nbsp;<span class="ident" id="8072589">l2</span>&nbsp;<span class="op" id="8072592">!=</span>&nbsp;<span class="ident" id="8072595">l1</span>&nbsp;<span class="op" id="8072598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072603">t</span><span class="op" id="8072604">.</span><span class="ident" id="8072605">Errorf</span><span class="op" id="8072611">(</span><span class="string" id="8072612">&#34;got&nbsp;line&nbsp;%d;&nbsp;want&nbsp;%d&nbsp;for&nbsp;%s&#34;</span><span class="op" id="8072641">,</span>&nbsp;<span class="ident" id="8072643">l2</span><span class="op" id="8072645">,</span>&nbsp;<span class="ident" id="8072647">l1</span><span class="op" id="8072649">,</span>&nbsp;<span class="ident" id="8072651">i1</span><span class="op" id="8072653">.</span><span class="ident" id="8072654">Name</span><span class="op" id="8072658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8072662">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8072665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8072669">if</span>&nbsp;<span class="ident" id="8072672">t</span><span class="op" id="8072673">.</span><span class="ident" id="8072674">Failed</span><span class="op" id="8072680">(</span><span class="op" id="8072681">)</span>&nbsp;<span class="op" id="8072683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072687">t</span><span class="op" id="8072688">.</span><span class="ident" id="8072689">Logf</span><span class="op" id="8072693">(</span><span class="string" id="8072694">&#34;\n%s&#34;</span><span class="op" id="8072700">,</span>&nbsp;<span class="ident" id="8072702">buf</span><span class="op" id="8072705">.</span><span class="ident" id="8072706">Bytes</span><span class="op" id="8072711">(</span><span class="op" id="8072712">)</span><span class="op" id="8072713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8072716">}</span><br>
<span class="lineno"></span><span class="op" id="8072718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="8072721">var</span>&nbsp;<span class="ident" id="8072725">decls</span>&nbsp;<span class="op" id="8072731">=</span>&nbsp;<span class="op" id="8072733">[</span><span class="op" id="8072734">]</span><span class="builtintype" id="8072735">string</span><span class="op" id="8072741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8072744">`import&nbsp;&#34;fmt&#34;`</span><span class="op" id="8072758">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8072761">&#34;const&nbsp;pi&nbsp;=&nbsp;3.1415\nconst&nbsp;e&nbsp;=&nbsp;2.71828\n\nvar&nbsp;x&nbsp;=&nbsp;pi&#34;</span><span class="op" id="8072813">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8072816">&#34;func&nbsp;sum(x,&nbsp;y&nbsp;int)&nbsp;int\t{&nbsp;return&nbsp;x&nbsp;+&nbsp;y&nbsp;}&#34;</span><span class="op" id="8072858">,</span><br>
<span class="lineno"></span><span class="op" id="8072860">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="keyword" id="8072863">func</span>&nbsp;<span class="ident" id="8072868">TestDeclLists</span><span class="op" id="8072881">(</span><span class="ident" id="8072882">t</span>&nbsp;<span class="op" id="8072884">*</span><span class="ident" id="8072885">testing</span><span class="op" id="8072892">.</span><span class="ident" id="8072893">T</span><span class="op" id="8072894">)</span>&nbsp;<span class="op" id="8072896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8072899">for</span>&nbsp;<span class="ident" id="8072903">_</span><span class="op" id="8072904">,</span>&nbsp;<span class="ident" id="8072906">src</span>&nbsp;<span class="op" id="8072910">:=</span>&nbsp;<span class="keyword" id="8072913">range</span>&nbsp;<span class="ident" id="8072919">decls</span>&nbsp;<span class="op" id="8072925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8072929">file</span><span class="op" id="8072933">,</span>&nbsp;<span class="ident" id="8072935">err</span>&nbsp;<span class="op" id="8072939">:=</span>&nbsp;<span class="ident" id="8072942">parser</span><span class="op" id="8072948">.</span><span class="ident" id="8072949">ParseFile</span><span class="op" id="8072958">(</span><span class="ident" id="8072959">fset</span><span class="op" id="8072963">,</span>&nbsp;<span class="string" id="8072965">&#34;&#34;</span><span class="op" id="8072967">,</span>&nbsp;<span class="string" id="8072969">&#34;package&nbsp;p;&#34;</span><span class="op" id="8072981">+</span><span class="ident" id="8072982">src</span><span class="op" id="8072985">,</span>&nbsp;<span class="ident" id="8072987">parser</span><span class="op" id="8072993">.</span><span class="ident" id="8072994">ParseComments</span><span class="op" id="8073007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8073011">if</span>&nbsp;<span class="ident" id="8073014">err</span>&nbsp;<span class="op" id="8073018">!=</span>&nbsp;<span class="ident" id="8073021">nil</span>&nbsp;<span class="op" id="8073025">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8073030">panic</span><span class="op" id="8073035">(</span><span class="ident" id="8073036">err</span><span class="op" id="8073039">)</span>&nbsp;<span class="comment" id="8073041">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8073060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8073065">var</span>&nbsp;<span class="ident" id="8073069">buf</span>&nbsp;<span class="ident" id="8073073">bytes</span><span class="op" id="8073078">.</span><span class="ident" id="8073079">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073088">err</span>&nbsp;<span class="op" id="8073092">=</span>&nbsp;<span class="ident" id="8073094">Fprint</span><span class="op" id="8073100">(</span><span class="op" id="8073101">&amp;</span><span class="ident" id="8073102">buf</span><span class="op" id="8073105">,</span>&nbsp;<span class="ident" id="8073107">fset</span><span class="op" id="8073111">,</span>&nbsp;<span class="ident" id="8073113">file</span><span class="op" id="8073117">.</span><span class="ident" id="8073118">Decls</span><span class="op" id="8073123">)</span>&nbsp;<span class="comment" id="8073125">//&nbsp;only&nbsp;print&nbsp;declarations</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8073154">if</span>&nbsp;<span class="ident" id="8073157">err</span>&nbsp;<span class="op" id="8073161">!=</span>&nbsp;<span class="ident" id="8073164">nil</span>&nbsp;<span class="op" id="8073168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8073173">panic</span><span class="op" id="8073178">(</span><span class="ident" id="8073179">err</span><span class="op" id="8073182">)</span>&nbsp;<span class="comment" id="8073184">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8073203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073208">out</span>&nbsp;<span class="op" id="8073212">:=</span>&nbsp;<span class="ident" id="8073215">buf</span><span class="op" id="8073218">.</span><span class="ident" id="8073219">String</span><span class="op" id="8073225">(</span><span class="op" id="8073226">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8073230">if</span>&nbsp;<span class="ident" id="8073233">out</span>&nbsp;<span class="op" id="8073237">!=</span>&nbsp;<span class="ident" id="8073240">src</span>&nbsp;<span class="op" id="8073244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073249">t</span><span class="op" id="8073250">.</span><span class="ident" id="8073251">Errorf</span><span class="op" id="8073257">(</span><span class="string" id="8073258">&#34;\ngot&nbsp;:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="8073282">,</span>&nbsp;<span class="ident" id="8073284">out</span><span class="op" id="8073287">,</span>&nbsp;<span class="ident" id="8073289">src</span><span class="op" id="8073292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8073296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8073299">}</span><br>
<span class="lineno"></span><span class="op" id="8073301">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="keyword" id="8073304">var</span>&nbsp;<span class="ident" id="8073308">stmts</span>&nbsp;<span class="op" id="8073314">=</span>&nbsp;<span class="op" id="8073316">[</span><span class="op" id="8073317">]</span><span class="builtintype" id="8073318">string</span><span class="op" id="8073324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8073327">&#34;i&nbsp;:=&nbsp;0&#34;</span><span class="op" id="8073335">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8073338">&#34;select&nbsp;{}\nvar&nbsp;a,&nbsp;b&nbsp;=&nbsp;1,&nbsp;2\nreturn&nbsp;a&nbsp;+&nbsp;b&#34;</span><span class="op" id="8073380">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8073383">&#34;go&nbsp;f()\ndefer&nbsp;func()&nbsp;{}()&#34;</span><span class="op" id="8073410">,</span><br>
<span class="lineno">460</span><span class="op" id="8073412">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8073415">func</span>&nbsp;<span class="ident" id="8073420">TestStmtLists</span><span class="op" id="8073433">(</span><span class="ident" id="8073434">t</span>&nbsp;<span class="op" id="8073436">*</span><span class="ident" id="8073437">testing</span><span class="op" id="8073444">.</span><span class="ident" id="8073445">T</span><span class="op" id="8073446">)</span>&nbsp;<span class="op" id="8073448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8073451">for</span>&nbsp;<span class="ident" id="8073455">_</span><span class="op" id="8073456">,</span>&nbsp;<span class="ident" id="8073458">src</span>&nbsp;<span class="op" id="8073462">:=</span>&nbsp;<span class="keyword" id="8073465">range</span>&nbsp;<span class="ident" id="8073471">stmts</span>&nbsp;<span class="op" id="8073477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073481">file</span><span class="op" id="8073485">,</span>&nbsp;<span class="ident" id="8073487">err</span>&nbsp;<span class="op" id="8073491">:=</span>&nbsp;<span class="ident" id="8073494">parser</span><span class="op" id="8073500">.</span><span class="ident" id="8073501">ParseFile</span><span class="op" id="8073510">(</span><span class="ident" id="8073511">fset</span><span class="op" id="8073515">,</span>&nbsp;<span class="string" id="8073517">&#34;&#34;</span><span class="op" id="8073519">,</span>&nbsp;<span class="string" id="8073521">&#34;package&nbsp;p;&nbsp;func&nbsp;_()&nbsp;{&#34;</span><span class="op" id="8073544">+</span><span class="ident" id="8073545">src</span><span class="op" id="8073548">+</span><span class="string" id="8073549">&#34;}&#34;</span><span class="op" id="8073552">,</span>&nbsp;<span class="ident" id="8073554">parser</span><span class="op" id="8073560">.</span><span class="ident" id="8073561">ParseComments</span><span class="op" id="8073574">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8073578">if</span>&nbsp;<span class="ident" id="8073581">err</span>&nbsp;<span class="op" id="8073585">!=</span>&nbsp;<span class="ident" id="8073588">nil</span>&nbsp;<span class="op" id="8073592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8073597">panic</span><span class="op" id="8073602">(</span><span class="ident" id="8073603">err</span><span class="op" id="8073606">)</span>&nbsp;<span class="comment" id="8073608">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8073627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8073632">var</span>&nbsp;<span class="ident" id="8073636">buf</span>&nbsp;<span class="ident" id="8073640">bytes</span><span class="op" id="8073645">.</span><span class="ident" id="8073646">Buffer</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073655">err</span>&nbsp;<span class="op" id="8073659">=</span>&nbsp;<span class="ident" id="8073661">Fprint</span><span class="op" id="8073667">(</span><span class="op" id="8073668">&amp;</span><span class="ident" id="8073669">buf</span><span class="op" id="8073672">,</span>&nbsp;<span class="ident" id="8073674">fset</span><span class="op" id="8073678">,</span>&nbsp;<span class="ident" id="8073680">file</span><span class="op" id="8073684">.</span><span class="ident" id="8073685">Decls</span><span class="op" id="8073690">[</span><span class="num" id="8073691">0</span><span class="op" id="8073692">]</span><span class="op" id="8073693">.</span><span class="op" id="8073694">(</span><span class="op" id="8073695">*</span><span class="ident" id="8073696">ast</span><span class="op" id="8073699">.</span><span class="ident" id="8073700">FuncDecl</span><span class="op" id="8073708">)</span><span class="op" id="8073709">.</span><span class="ident" id="8073710">Body</span><span class="op" id="8073714">.</span><span class="ident" id="8073715">List</span><span class="op" id="8073719">)</span>&nbsp;<span class="comment" id="8073721">//&nbsp;only&nbsp;print&nbsp;statements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8073748">if</span>&nbsp;<span class="ident" id="8073751">err</span>&nbsp;<span class="op" id="8073755">!=</span>&nbsp;<span class="ident" id="8073758">nil</span>&nbsp;<span class="op" id="8073762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8073767">panic</span><span class="op" id="8073772">(</span><span class="ident" id="8073773">err</span><span class="op" id="8073776">)</span>&nbsp;<span class="comment" id="8073778">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8073797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073802">out</span>&nbsp;<span class="op" id="8073806">:=</span>&nbsp;<span class="ident" id="8073809">buf</span><span class="op" id="8073812">.</span><span class="ident" id="8073813">String</span><span class="op" id="8073819">(</span><span class="op" id="8073820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8073824">if</span>&nbsp;<span class="ident" id="8073827">out</span>&nbsp;<span class="op" id="8073831">!=</span>&nbsp;<span class="ident" id="8073834">src</span>&nbsp;<span class="op" id="8073838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8073843">t</span><span class="op" id="8073844">.</span><span class="ident" id="8073845">Errorf</span><span class="op" id="8073851">(</span><span class="string" id="8073852">&#34;\ngot&nbsp;:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="8073876">,</span>&nbsp;<span class="ident" id="8073878">out</span><span class="op" id="8073881">,</span>&nbsp;<span class="ident" id="8073883">src</span><span class="op" id="8073886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8073890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8073893">}</span><br>
<span class="lineno">480</span><span class="op" id="8073895">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8073898">func</span>&nbsp;<span class="ident" id="8073903">TestBaseIndent</span><span class="op" id="8073917">(</span><span class="ident" id="8073918">t</span>&nbsp;<span class="op" id="8073920">*</span><span class="ident" id="8073921">testing</span><span class="op" id="8073928">.</span><span class="ident" id="8073929">T</span><span class="op" id="8073930">)</span>&nbsp;<span class="op" id="8073932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8073935">//&nbsp;The&nbsp;testfile&nbsp;must&nbsp;not&nbsp;contain&nbsp;multi-line&nbsp;raw&nbsp;strings&nbsp;since&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8074004">//&nbsp;are&nbsp;not&nbsp;indented&nbsp;(because&nbsp;their&nbsp;values&nbsp;must&nbsp;not&nbsp;change)&nbsp;and&nbsp;make</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8074073">//&nbsp;this&nbsp;test&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8074093">const</span>&nbsp;<span class="ident" id="8074099">filename</span>&nbsp;<span class="op" id="8074108">=</span>&nbsp;<span class="string" id="8074110">&#34;printer.go&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8074124">src</span><span class="op" id="8074127">,</span>&nbsp;<span class="ident" id="8074129">err</span>&nbsp;<span class="op" id="8074133">:=</span>&nbsp;<span class="ident" id="8074136">ioutil</span><span class="op" id="8074142">.</span><span class="ident" id="8074143">ReadFile</span><span class="op" id="8074151">(</span><span class="ident" id="8074152">filename</span><span class="op" id="8074160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8074163">if</span>&nbsp;<span class="ident" id="8074166">err</span>&nbsp;<span class="op" id="8074170">!=</span>&nbsp;<span class="ident" id="8074173">nil</span>&nbsp;<span class="op" id="8074177">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8074181">panic</span><span class="op" id="8074186">(</span><span class="ident" id="8074187">err</span><span class="op" id="8074190">)</span>&nbsp;<span class="comment" id="8074192">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8074210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8074214">file</span><span class="op" id="8074218">,</span>&nbsp;<span class="ident" id="8074220">err</span>&nbsp;<span class="op" id="8074224">:=</span>&nbsp;<span class="ident" id="8074227">parser</span><span class="op" id="8074233">.</span><span class="ident" id="8074234">ParseFile</span><span class="op" id="8074243">(</span><span class="ident" id="8074244">fset</span><span class="op" id="8074248">,</span>&nbsp;<span class="ident" id="8074250">filename</span><span class="op" id="8074258">,</span>&nbsp;<span class="ident" id="8074260">src</span><span class="op" id="8074263">,</span>&nbsp;<span class="num" id="8074265">0</span><span class="op" id="8074266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8074269">if</span>&nbsp;<span class="ident" id="8074272">err</span>&nbsp;<span class="op" id="8074276">!=</span>&nbsp;<span class="ident" id="8074279">nil</span>&nbsp;<span class="op" id="8074283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8074287">panic</span><span class="op" id="8074292">(</span><span class="ident" id="8074293">err</span><span class="op" id="8074296">)</span>&nbsp;<span class="comment" id="8074298">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8074316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8074320">var</span>&nbsp;<span class="ident" id="8074324">buf</span>&nbsp;<span class="ident" id="8074328">bytes</span><span class="op" id="8074333">.</span><span class="ident" id="8074334">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8074342">for</span>&nbsp;<span class="ident" id="8074346">indent</span>&nbsp;<span class="op" id="8074353">:=</span>&nbsp;<span class="num" id="8074356">0</span><span class="op" id="8074357">;</span>&nbsp;<span class="ident" id="8074359">indent</span>&nbsp;<span class="op" id="8074366">&lt;</span>&nbsp;<span class="num" id="8074368">4</span><span class="op" id="8074369">;</span>&nbsp;<span class="ident" id="8074371">indent</span><span class="op" id="8074377">++</span>&nbsp;<span class="op" id="8074380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8074384">buf</span><span class="op" id="8074387">.</span><span class="ident" id="8074388">Reset</span><span class="op" id="8074393">(</span><span class="op" id="8074394">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8074398">(</span><span class="op" id="8074399">&amp;</span><span class="ident" id="8074400">Config</span><span class="op" id="8074406">{</span><span class="ident" id="8074407">Tabwidth</span><span class="op" id="8074415">:</span>&nbsp;<span class="ident" id="8074417">tabwidth</span><span class="op" id="8074425">,</span>&nbsp;<span class="ident" id="8074427">Indent</span><span class="op" id="8074433">:</span>&nbsp;<span class="ident" id="8074435">indent</span><span class="op" id="8074441">}</span><span class="op" id="8074442">)</span><span class="op" id="8074443">.</span><span class="ident" id="8074444">Fprint</span><span class="op" id="8074450">(</span><span class="op" id="8074451">&amp;</span><span class="ident" id="8074452">buf</span><span class="op" id="8074455">,</span>&nbsp;<span class="ident" id="8074457">fset</span><span class="op" id="8074461">,</span>&nbsp;<span class="ident" id="8074463">file</span><span class="op" id="8074467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8074471">//&nbsp;all&nbsp;code&nbsp;must&nbsp;be&nbsp;indented&nbsp;by&nbsp;at&nbsp;least&nbsp;&#39;indent&#39;&nbsp;tabs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8074528">lines</span>&nbsp;<span class="op" id="8074534">:=</span>&nbsp;<span class="ident" id="8074537">bytes</span><span class="op" id="8074542">.</span><span class="ident" id="8074543">Split</span><span class="op" id="8074548">(</span><span class="ident" id="8074549">buf</span><span class="op" id="8074552">.</span><span class="ident" id="8074553">Bytes</span><span class="op" id="8074558">(</span><span class="op" id="8074559">)</span><span class="op" id="8074560">,</span>&nbsp;<span class="op" id="8074562">[</span><span class="op" id="8074563">]</span><span class="builtintype" id="8074564">byte</span><span class="op" id="8074568">{</span><span class="string" id="8074569">&#39;\n&#39;</span><span class="op" id="8074573">}</span><span class="op" id="8074574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8074578">for</span>&nbsp;<span class="ident" id="8074582">i</span><span class="op" id="8074583">,</span>&nbsp;<span class="ident" id="8074585">line</span>&nbsp;<span class="op" id="8074590">:=</span>&nbsp;<span class="keyword" id="8074593">range</span>&nbsp;<span class="ident" id="8074599">lines</span>&nbsp;<span class="op" id="8074605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8074610">if</span>&nbsp;<span class="builtinfunc" id="8074613">len</span><span class="op" id="8074616">(</span><span class="ident" id="8074617">line</span><span class="op" id="8074621">)</span>&nbsp;<span class="op" id="8074623">==</span>&nbsp;<span class="num" id="8074626">0</span>&nbsp;<span class="op" id="8074628">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8074634">continue</span>&nbsp;<span class="comment" id="8074643">//&nbsp;empty&nbsp;lines&nbsp;don&#39;t&nbsp;have&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8074684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8074689">n</span>&nbsp;<span class="op" id="8074691">:=</span>&nbsp;<span class="num" id="8074694">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8074699">for</span>&nbsp;<span class="ident" id="8074703">j</span><span class="op" id="8074704">,</span>&nbsp;<span class="ident" id="8074706">b</span>&nbsp;<span class="op" id="8074708">:=</span>&nbsp;<span class="keyword" id="8074711">range</span>&nbsp;<span class="ident" id="8074717">line</span>&nbsp;<span class="op" id="8074722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8074728">if</span>&nbsp;<span class="ident" id="8074731">b</span>&nbsp;<span class="op" id="8074733">!=</span>&nbsp;<span class="string" id="8074736">&#39;\t&#39;</span>&nbsp;<span class="op" id="8074741">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8074748">//&nbsp;end&nbsp;of&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8074775">n</span>&nbsp;<span class="op" id="8074777">=</span>&nbsp;<span class="ident" id="8074779">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8074786">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8074796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8074801">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8074806">if</span>&nbsp;<span class="ident" id="8074809">n</span>&nbsp;<span class="op" id="8074811">&lt;</span>&nbsp;<span class="ident" id="8074813">indent</span>&nbsp;<span class="op" id="8074820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8074826">t</span><span class="op" id="8074827">.</span><span class="ident" id="8074828">Errorf</span><span class="op" id="8074834">(</span><span class="string" id="8074835">&#34;line&nbsp;%d:&nbsp;got&nbsp;only&nbsp;%d&nbsp;tabs;&nbsp;want&nbsp;at&nbsp;least&nbsp;%d:&nbsp;%q&#34;</span><span class="op" id="8074884">,</span>&nbsp;<span class="ident" id="8074886">i</span><span class="op" id="8074887">,</span>&nbsp;<span class="ident" id="8074889">n</span><span class="op" id="8074890">,</span>&nbsp;<span class="ident" id="8074892">indent</span><span class="op" id="8074898">,</span>&nbsp;<span class="ident" id="8074900">line</span><span class="op" id="8074904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8074909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8074913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8074916">}</span><br>
<span class="lineno">520</span><span class="op" id="8074918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8074921">//&nbsp;TestFuncType&nbsp;tests&nbsp;that&nbsp;an&nbsp;ast.FuncType&nbsp;with&nbsp;a&nbsp;nil&nbsp;Params&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="8074988">//&nbsp;can&nbsp;be&nbsp;printed&nbsp;(per&nbsp;go/ast&nbsp;specification).&nbsp;Test&nbsp;case&nbsp;for&nbsp;issue&nbsp;3870.</span><br>
<span class="lineno"></span><span class="keyword" id="8075060">func</span>&nbsp;<span class="ident" id="8075065">TestFuncType</span><span class="op" id="8075077">(</span><span class="ident" id="8075078">t</span>&nbsp;<span class="op" id="8075080">*</span><span class="ident" id="8075081">testing</span><span class="op" id="8075088">.</span><span class="ident" id="8075089">T</span><span class="op" id="8075090">)</span>&nbsp;<span class="op" id="8075092">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8075095">src</span>&nbsp;<span class="op" id="8075099">:=</span>&nbsp;<span class="op" id="8075102">&amp;</span><span class="ident" id="8075103">ast</span><span class="op" id="8075106">.</span><span class="ident" id="8075107">File</span><span class="op" id="8075111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8075115">Name</span><span class="op" id="8075119">:</span>&nbsp;<span class="op" id="8075121">&amp;</span><span class="ident" id="8075122">ast</span><span class="op" id="8075125">.</span><span class="ident" id="8075126">Ident</span><span class="op" id="8075131">{</span><span class="ident" id="8075132">Name</span><span class="op" id="8075136">:</span>&nbsp;<span class="string" id="8075138">&#34;p&#34;</span><span class="op" id="8075141">}</span><span class="op" id="8075142">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8075146">Decls</span><span class="op" id="8075151">:</span>&nbsp;<span class="op" id="8075153">[</span><span class="op" id="8075154">]</span><span class="ident" id="8075155">ast</span><span class="op" id="8075158">.</span><span class="ident" id="8075159">Decl</span><span class="op" id="8075163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8075168">&amp;</span><span class="ident" id="8075169">ast</span><span class="op" id="8075172">.</span><span class="ident" id="8075173">FuncDecl</span><span class="op" id="8075181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8075187">Name</span><span class="op" id="8075191">:</span>&nbsp;<span class="op" id="8075193">&amp;</span><span class="ident" id="8075194">ast</span><span class="op" id="8075197">.</span><span class="ident" id="8075198">Ident</span><span class="op" id="8075203">{</span><span class="ident" id="8075204">Name</span><span class="op" id="8075208">:</span>&nbsp;<span class="string" id="8075210">&#34;f&#34;</span><span class="op" id="8075213">}</span><span class="op" id="8075214">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8075220">Type</span><span class="op" id="8075224">:</span>&nbsp;<span class="op" id="8075226">&amp;</span><span class="ident" id="8075227">ast</span><span class="op" id="8075230">.</span><span class="ident" id="8075231">FuncType</span><span class="op" id="8075239">{</span><span class="op" id="8075240">}</span><span class="op" id="8075241">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8075246">}</span><span class="op" id="8075247">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8075251">}</span><span class="op" id="8075252">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8075255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8075259">var</span>&nbsp;<span class="ident" id="8075263">buf</span>&nbsp;<span class="ident" id="8075267">bytes</span><span class="op" id="8075272">.</span><span class="ident" id="8075273">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8075281">if</span>&nbsp;<span class="ident" id="8075284">err</span>&nbsp;<span class="op" id="8075288">:=</span>&nbsp;<span class="ident" id="8075291">Fprint</span><span class="op" id="8075297">(</span><span class="op" id="8075298">&amp;</span><span class="ident" id="8075299">buf</span><span class="op" id="8075302">,</span>&nbsp;<span class="ident" id="8075304">fset</span><span class="op" id="8075308">,</span>&nbsp;<span class="ident" id="8075310">src</span><span class="op" id="8075313">)</span><span class="op" id="8075314">;</span>&nbsp;<span class="ident" id="8075316">err</span>&nbsp;<span class="op" id="8075320">!=</span>&nbsp;<span class="ident" id="8075323">nil</span>&nbsp;<span class="op" id="8075327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8075331">t</span><span class="op" id="8075332">.</span><span class="ident" id="8075333">Fatal</span><span class="op" id="8075338">(</span><span class="ident" id="8075339">err</span><span class="op" id="8075342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8075345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8075348">got</span>&nbsp;<span class="op" id="8075352">:=</span>&nbsp;<span class="ident" id="8075355">buf</span><span class="op" id="8075358">.</span><span class="ident" id="8075359">String</span><span class="op" id="8075365">(</span><span class="op" id="8075366">)</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8075370">const</span>&nbsp;<span class="ident" id="8075376">want</span>&nbsp;<span class="op" id="8075381">=</span>&nbsp;<span class="string" id="8075383">`package&nbsp;p<br>
<span class="lineno"></span><br>
<span class="lineno"></span>func&nbsp;f()<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8075408">if</span>&nbsp;<span class="ident" id="8075411">got</span>&nbsp;<span class="op" id="8075415">!=</span>&nbsp;<span class="ident" id="8075418">want</span>&nbsp;<span class="op" id="8075423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8075427">t</span><span class="op" id="8075428">.</span><span class="ident" id="8075429">Fatalf</span><span class="op" id="8075435">(</span><span class="string" id="8075436">&#34;got:\n%s\nwant:\n%s\n&#34;</span><span class="op" id="8075459">,</span>&nbsp;<span class="ident" id="8075461">got</span><span class="op" id="8075464">,</span>&nbsp;<span class="ident" id="8075466">want</span><span class="op" id="8075470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8075473">}</span><br>
<span class="lineno"></span><span class="op" id="8075475">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="8075478">//&nbsp;TextX&nbsp;is&nbsp;a&nbsp;skeleton&nbsp;test&nbsp;that&nbsp;can&nbsp;be&nbsp;filled&nbsp;in&nbsp;for&nbsp;debugging&nbsp;one-off&nbsp;cases.</span><br>
<span class="lineno"></span><span class="comment" id="8075557">//&nbsp;Do&nbsp;not&nbsp;remove.</span><br>
<span class="lineno"></span><span class="keyword" id="8075575">func</span>&nbsp;<span class="ident" id="8075580">TestX</span><span class="op" id="8075585">(</span><span class="ident" id="8075586">t</span>&nbsp;<span class="op" id="8075588">*</span><span class="ident" id="8075589">testing</span><span class="op" id="8075596">.</span><span class="ident" id="8075597">T</span><span class="op" id="8075598">)</span>&nbsp;<span class="op" id="8075600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8075603">const</span>&nbsp;<span class="ident" id="8075609">src</span>&nbsp;<span class="op" id="8075613">=</span>&nbsp;<span class="string" id="8075615">`<br>
<span class="lineno">555</span>package&nbsp;p<br>
<span class="lineno"></span>func&nbsp;_()&nbsp;{}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8075642">_</span><span class="op" id="8075643">,</span>&nbsp;<span class="ident" id="8075645">err</span>&nbsp;<span class="op" id="8075649">:=</span>&nbsp;<span class="ident" id="8075652">format</span><span class="op" id="8075658">(</span><span class="op" id="8075659">[</span><span class="op" id="8075660">]</span><span class="builtintype" id="8075661">byte</span><span class="op" id="8075665">(</span><span class="ident" id="8075666">src</span><span class="op" id="8075669">)</span><span class="op" id="8075670">,</span>&nbsp;<span class="num" id="8075672">0</span><span class="op" id="8075673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8075676">if</span>&nbsp;<span class="ident" id="8075679">err</span>&nbsp;<span class="op" id="8075683">!=</span>&nbsp;<span class="ident" id="8075686">nil</span>&nbsp;<span class="op" id="8075690">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8075694">t</span><span class="op" id="8075695">.</span><span class="ident" id="8075696">Error</span><span class="op" id="8075701">(</span><span class="ident" id="8075702">err</span><span class="op" id="8075705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8075708">}</span><br>
<span class="lineno"></span><span class="op" id="8075710">}</span>
</div>
</body>
</html>
