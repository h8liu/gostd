<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>text/template</h2>
<ul>
<li><a href="/gostd/text/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/text/template/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/text/template/examplefiles_test.go.html">examplefiles_test.go</a></li>
<li><a href="/gostd/text/template/examplefunc_test.go.html">examplefunc_test.go</a></li>
<li><a href="/gostd/text/template/exec.go.html">exec.go</a></li>
<li><a href="/gostd/text/template/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/text/template/funcs.go.html">funcs.go</a></li>
<li><a href="/gostd/text/template/helper.go.html">helper.go</a></li>
<li><a href="/gostd/text/template/multi_test.go.html">multi_test.go</a></li>
<li><a href="/gostd/text/template/template.go.html">template.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3452465">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3452520">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3452574">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3452625">package</span>&nbsp;<span class="ident" id="3452633">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3452643">import</span>&nbsp;<span class="op" id="3452650">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3452653">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3452660">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3452671">&#34;text/template/parse&#34;</span><br>
<span class="lineno"></span><span class="op" id="3452693">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3452696">//&nbsp;common&nbsp;holds&nbsp;the&nbsp;information&nbsp;shared&nbsp;by&nbsp;related&nbsp;templates.</span><br>
<span class="lineno"></span><span class="keyword" id="3452757">type</span>&nbsp;<span class="ident" id="3452762">common</span>&nbsp;<span class="keyword" id="3452769">struct</span>&nbsp;<span class="op" id="3452776">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3452779">tmpl</span>&nbsp;<span class="keyword" id="3452784">map</span><span class="op" id="3452787">[</span><span class="builtintype" id="3452788">string</span><span class="op" id="3452794">]</span><span class="op" id="3452795">*</span><span class="ident" id="3452796">Template</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3452806">//&nbsp;We&nbsp;use&nbsp;two&nbsp;maps,&nbsp;one&nbsp;for&nbsp;parsing&nbsp;and&nbsp;one&nbsp;for&nbsp;execution.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3452866">//&nbsp;This&nbsp;separation&nbsp;makes&nbsp;the&nbsp;API&nbsp;cleaner&nbsp;since&nbsp;it&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3452925">//&nbsp;expose&nbsp;reflection&nbsp;to&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3452962">parseFuncs</span>&nbsp;<span class="ident" id="3452973">FuncMap</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3452982">execFuncs</span>&nbsp;&nbsp;<span class="keyword" id="3452993">map</span><span class="op" id="3452996">[</span><span class="builtintype" id="3452997">string</span><span class="op" id="3453003">]</span><span class="ident" id="3453004">reflect</span><span class="op" id="3453011">.</span><span class="ident" id="3453012">Value</span><br>
<span class="lineno"></span><span class="op" id="3453018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3453021">//&nbsp;Template&nbsp;is&nbsp;the&nbsp;representation&nbsp;of&nbsp;a&nbsp;parsed&nbsp;template.&nbsp;The&nbsp;*parse.Tree</span><br>
<span class="lineno"></span><span class="comment" id="3453093">//&nbsp;field&nbsp;is&nbsp;exported&nbsp;only&nbsp;for&nbsp;use&nbsp;by&nbsp;html/template&nbsp;and&nbsp;should&nbsp;be&nbsp;treated</span><br>
<span class="lineno">25</span><span class="comment" id="3453166">//&nbsp;as&nbsp;unexported&nbsp;by&nbsp;all&nbsp;other&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="3453205">type</span>&nbsp;<span class="ident" id="3453210">Template</span>&nbsp;<span class="keyword" id="3453219">struct</span>&nbsp;<span class="op" id="3453226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3453229">name</span>&nbsp;<span class="builtintype" id="3453234">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3453242">*</span><span class="ident" id="3453243">parse</span><span class="op" id="3453248">.</span><span class="ident" id="3453249">Tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3453255">*</span><span class="ident" id="3453256">common</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3453264">leftDelim</span>&nbsp;&nbsp;<span class="builtintype" id="3453275">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3453283">rightDelim</span>&nbsp;<span class="builtintype" id="3453294">string</span><br>
<span class="lineno"></span><span class="op" id="3453301">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3453304">//&nbsp;New&nbsp;allocates&nbsp;a&nbsp;new&nbsp;template&nbsp;with&nbsp;the&nbsp;given&nbsp;name.</span><br>
<span class="lineno">35</span><span class="keyword" id="3453357">func</span>&nbsp;<span class="ident" id="3453362">New</span><span class="op" id="3453365">(</span><span class="ident" id="3453366">name</span>&nbsp;<span class="builtintype" id="3453371">string</span><span class="op" id="3453377">)</span>&nbsp;<span class="op" id="3453379">*</span><span class="ident" id="3453380">Template</span>&nbsp;<span class="op" id="3453389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3453392">return</span>&nbsp;<span class="op" id="3453399">&amp;</span><span class="ident" id="3453400">Template</span><span class="op" id="3453408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3453412">name</span><span class="op" id="3453416">:</span>&nbsp;<span class="ident" id="3453418">name</span><span class="op" id="3453422">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3453425">}</span><br>
<span class="lineno"></span><span class="op" id="3453427">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="3453430">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;template.</span><br>
<span class="lineno"></span><span class="keyword" id="3453472">func</span>&nbsp;<span class="op" id="3453477">(</span><span class="ident" id="3453478">t</span>&nbsp;<span class="op" id="3453480">*</span><span class="ident" id="3453481">Template</span><span class="op" id="3453489">)</span>&nbsp;<span class="ident" id="3453491">Name</span><span class="op" id="3453495">(</span><span class="op" id="3453496">)</span>&nbsp;<span class="builtintype" id="3453498">string</span>&nbsp;<span class="op" id="3453505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3453508">return</span>&nbsp;<span class="ident" id="3453515">t</span><span class="op" id="3453516">.</span><span class="ident" id="3453517">name</span><br>
<span class="lineno"></span><span class="op" id="3453522">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="3453525">//&nbsp;New&nbsp;allocates&nbsp;a&nbsp;new&nbsp;template&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;one&nbsp;and&nbsp;with&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="3453605">//&nbsp;delimiters.&nbsp;The&nbsp;association,&nbsp;which&nbsp;is&nbsp;transitive,&nbsp;allows&nbsp;one&nbsp;template&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3453681">//&nbsp;invoke&nbsp;another&nbsp;with&nbsp;a&nbsp;{{template}}&nbsp;action.</span><br>
<span class="lineno"></span><span class="keyword" id="3453727">func</span>&nbsp;<span class="op" id="3453732">(</span><span class="ident" id="3453733">t</span>&nbsp;<span class="op" id="3453735">*</span><span class="ident" id="3453736">Template</span><span class="op" id="3453744">)</span>&nbsp;<span class="ident" id="3453746">New</span><span class="op" id="3453749">(</span><span class="ident" id="3453750">name</span>&nbsp;<span class="builtintype" id="3453755">string</span><span class="op" id="3453761">)</span>&nbsp;<span class="op" id="3453763">*</span><span class="ident" id="3453764">Template</span>&nbsp;<span class="op" id="3453773">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3453776">t</span><span class="op" id="3453777">.</span><span class="ident" id="3453778">init</span><span class="op" id="3453782">(</span><span class="op" id="3453783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3453786">return</span>&nbsp;<span class="op" id="3453793">&amp;</span><span class="ident" id="3453794">Template</span><span class="op" id="3453802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3453806">name</span><span class="op" id="3453810">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3453818">name</span><span class="op" id="3453822">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3453826">common</span><span class="op" id="3453832">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3453838">t</span><span class="op" id="3453839">.</span><span class="ident" id="3453840">common</span><span class="op" id="3453846">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3453850">leftDelim</span><span class="op" id="3453859">:</span>&nbsp;&nbsp;<span class="ident" id="3453862">t</span><span class="op" id="3453863">.</span><span class="ident" id="3453864">leftDelim</span><span class="op" id="3453873">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3453877">rightDelim</span><span class="op" id="3453887">:</span>&nbsp;<span class="ident" id="3453889">t</span><span class="op" id="3453890">.</span><span class="ident" id="3453891">rightDelim</span><span class="op" id="3453901">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3453904">}</span><br>
<span class="lineno"></span><span class="op" id="3453906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3453909">func</span>&nbsp;<span class="op" id="3453914">(</span><span class="ident" id="3453915">t</span>&nbsp;<span class="op" id="3453917">*</span><span class="ident" id="3453918">Template</span><span class="op" id="3453926">)</span>&nbsp;<span class="ident" id="3453928">init</span><span class="op" id="3453932">(</span><span class="op" id="3453933">)</span>&nbsp;<span class="op" id="3453935">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3453938">if</span>&nbsp;<span class="ident" id="3453941">t</span><span class="op" id="3453942">.</span><span class="ident" id="3453943">common</span>&nbsp;<span class="op" id="3453950">==</span>&nbsp;<span class="ident" id="3453953">nil</span>&nbsp;<span class="op" id="3453957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3453961">t</span><span class="op" id="3453962">.</span><span class="ident" id="3453963">common</span>&nbsp;<span class="op" id="3453970">=</span>&nbsp;<span class="builtinfunc" id="3453972">new</span><span class="op" id="3453975">(</span><span class="ident" id="3453976">common</span><span class="op" id="3453982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3453986">t</span><span class="op" id="3453987">.</span><span class="ident" id="3453988">tmpl</span>&nbsp;<span class="op" id="3453993">=</span>&nbsp;<span class="builtinfunc" id="3453995">make</span><span class="op" id="3453999">(</span><span class="keyword" id="3454000">map</span><span class="op" id="3454003">[</span><span class="builtintype" id="3454004">string</span><span class="op" id="3454010">]</span><span class="op" id="3454011">*</span><span class="ident" id="3454012">Template</span><span class="op" id="3454020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3454024">t</span><span class="op" id="3454025">.</span><span class="ident" id="3454026">parseFuncs</span>&nbsp;<span class="op" id="3454037">=</span>&nbsp;<span class="builtinfunc" id="3454039">make</span><span class="op" id="3454043">(</span><span class="ident" id="3454044">FuncMap</span><span class="op" id="3454051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3454055">t</span><span class="op" id="3454056">.</span><span class="ident" id="3454057">execFuncs</span>&nbsp;<span class="op" id="3454067">=</span>&nbsp;<span class="builtinfunc" id="3454069">make</span><span class="op" id="3454073">(</span><span class="keyword" id="3454074">map</span><span class="op" id="3454077">[</span><span class="builtintype" id="3454078">string</span><span class="op" id="3454084">]</span><span class="ident" id="3454085">reflect</span><span class="op" id="3454092">.</span><span class="ident" id="3454093">Value</span><span class="op" id="3454098">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3454101">}</span><br>
<span class="lineno"></span><span class="op" id="3454103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3454106">//&nbsp;Clone&nbsp;returns&nbsp;a&nbsp;duplicate&nbsp;of&nbsp;the&nbsp;template,&nbsp;including&nbsp;all&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="3454177">//&nbsp;templates.&nbsp;The&nbsp;actual&nbsp;representation&nbsp;is&nbsp;not&nbsp;copied,&nbsp;but&nbsp;the&nbsp;name&nbsp;space&nbsp;of</span><br>
<span class="lineno">70</span><span class="comment" id="3454254">//&nbsp;associated&nbsp;templates&nbsp;is,&nbsp;so&nbsp;further&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;in&nbsp;the&nbsp;copy&nbsp;will&nbsp;add</span><br>
<span class="lineno"></span><span class="comment" id="3454329">//&nbsp;templates&nbsp;to&nbsp;the&nbsp;copy&nbsp;but&nbsp;not&nbsp;to&nbsp;the&nbsp;original.&nbsp;Clone&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;prepare</span><br>
<span class="lineno"></span><span class="comment" id="3454408">//&nbsp;common&nbsp;templates&nbsp;and&nbsp;use&nbsp;them&nbsp;with&nbsp;variant&nbsp;definitions&nbsp;for&nbsp;other&nbsp;templates</span><br>
<span class="lineno"></span><span class="comment" id="3454486">//&nbsp;by&nbsp;adding&nbsp;the&nbsp;variants&nbsp;after&nbsp;the&nbsp;clone&nbsp;is&nbsp;made.</span><br>
<span class="lineno"></span><span class="keyword" id="3454537">func</span>&nbsp;<span class="op" id="3454542">(</span><span class="ident" id="3454543">t</span>&nbsp;<span class="op" id="3454545">*</span><span class="ident" id="3454546">Template</span><span class="op" id="3454554">)</span>&nbsp;<span class="ident" id="3454556">Clone</span><span class="op" id="3454561">(</span><span class="op" id="3454562">)</span>&nbsp;<span class="op" id="3454564">(</span><span class="op" id="3454565">*</span><span class="ident" id="3454566">Template</span><span class="op" id="3454574">,</span>&nbsp;<span class="builtintype" id="3454576">error</span><span class="op" id="3454581">)</span>&nbsp;<span class="op" id="3454583">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3454586">nt</span>&nbsp;<span class="op" id="3454589">:=</span>&nbsp;<span class="ident" id="3454592">t</span><span class="op" id="3454593">.</span><span class="builtinfunc" id="3454594">copy</span><span class="op" id="3454598">(</span><span class="ident" id="3454599">nil</span><span class="op" id="3454602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3454605">nt</span><span class="op" id="3454607">.</span><span class="ident" id="3454608">init</span><span class="op" id="3454612">(</span><span class="op" id="3454613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3454616">nt</span><span class="op" id="3454618">.</span><span class="ident" id="3454619">tmpl</span><span class="op" id="3454623">[</span><span class="ident" id="3454624">t</span><span class="op" id="3454625">.</span><span class="ident" id="3454626">name</span><span class="op" id="3454630">]</span>&nbsp;<span class="op" id="3454632">=</span>&nbsp;<span class="ident" id="3454634">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3454638">for</span>&nbsp;<span class="ident" id="3454642">k</span><span class="op" id="3454643">,</span>&nbsp;<span class="ident" id="3454645">v</span>&nbsp;<span class="op" id="3454647">:=</span>&nbsp;<span class="keyword" id="3454650">range</span>&nbsp;<span class="ident" id="3454656">t</span><span class="op" id="3454657">.</span><span class="ident" id="3454658">tmpl</span>&nbsp;<span class="op" id="3454663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3454667">if</span>&nbsp;<span class="ident" id="3454670">k</span>&nbsp;<span class="op" id="3454672">==</span>&nbsp;<span class="ident" id="3454675">t</span><span class="op" id="3454676">.</span><span class="ident" id="3454677">name</span>&nbsp;<span class="op" id="3454682">{</span>&nbsp;<span class="comment" id="3454684">//&nbsp;Already&nbsp;installed.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3454709">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3454720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3454724">//&nbsp;The&nbsp;associated&nbsp;templates&nbsp;share&nbsp;nt&#39;s&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3454783">tmpl</span>&nbsp;<span class="op" id="3454788">:=</span>&nbsp;<span class="ident" id="3454791">v</span><span class="op" id="3454792">.</span><span class="builtinfunc" id="3454793">copy</span><span class="op" id="3454797">(</span><span class="ident" id="3454798">nt</span><span class="op" id="3454800">.</span><span class="ident" id="3454801">common</span><span class="op" id="3454807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3454811">nt</span><span class="op" id="3454813">.</span><span class="ident" id="3454814">tmpl</span><span class="op" id="3454818">[</span><span class="ident" id="3454819">k</span><span class="op" id="3454820">]</span>&nbsp;<span class="op" id="3454822">=</span>&nbsp;<span class="ident" id="3454824">tmpl</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3454830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3454833">for</span>&nbsp;<span class="ident" id="3454837">k</span><span class="op" id="3454838">,</span>&nbsp;<span class="ident" id="3454840">v</span>&nbsp;<span class="op" id="3454842">:=</span>&nbsp;<span class="keyword" id="3454845">range</span>&nbsp;<span class="ident" id="3454851">t</span><span class="op" id="3454852">.</span><span class="ident" id="3454853">parseFuncs</span>&nbsp;<span class="op" id="3454864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3454868">nt</span><span class="op" id="3454870">.</span><span class="ident" id="3454871">parseFuncs</span><span class="op" id="3454881">[</span><span class="ident" id="3454882">k</span><span class="op" id="3454883">]</span>&nbsp;<span class="op" id="3454885">=</span>&nbsp;<span class="ident" id="3454887">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3454890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3454893">for</span>&nbsp;<span class="ident" id="3454897">k</span><span class="op" id="3454898">,</span>&nbsp;<span class="ident" id="3454900">v</span>&nbsp;<span class="op" id="3454902">:=</span>&nbsp;<span class="keyword" id="3454905">range</span>&nbsp;<span class="ident" id="3454911">t</span><span class="op" id="3454912">.</span><span class="ident" id="3454913">execFuncs</span>&nbsp;<span class="op" id="3454923">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3454927">nt</span><span class="op" id="3454929">.</span><span class="ident" id="3454930">execFuncs</span><span class="op" id="3454939">[</span><span class="ident" id="3454940">k</span><span class="op" id="3454941">]</span>&nbsp;<span class="op" id="3454943">=</span>&nbsp;<span class="ident" id="3454945">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3454948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3454951">return</span>&nbsp;<span class="ident" id="3454958">nt</span><span class="op" id="3454960">,</span>&nbsp;<span class="ident" id="3454962">nil</span><br>
<span class="lineno"></span><span class="op" id="3454966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="3454969">//&nbsp;copy&nbsp;returns&nbsp;a&nbsp;shallow&nbsp;copy&nbsp;of&nbsp;t,&nbsp;with&nbsp;common&nbsp;set&nbsp;to&nbsp;the&nbsp;argument.</span><br>
<span class="lineno"></span><span class="keyword" id="3455039">func</span>&nbsp;<span class="op" id="3455044">(</span><span class="ident" id="3455045">t</span>&nbsp;<span class="op" id="3455047">*</span><span class="ident" id="3455048">Template</span><span class="op" id="3455056">)</span>&nbsp;<span class="builtinfunc" id="3455058">copy</span><span class="op" id="3455062">(</span><span class="ident" id="3455063">c</span>&nbsp;<span class="op" id="3455065">*</span><span class="ident" id="3455066">common</span><span class="op" id="3455072">)</span>&nbsp;<span class="op" id="3455074">*</span><span class="ident" id="3455075">Template</span>&nbsp;<span class="op" id="3455084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3455087">nt</span>&nbsp;<span class="op" id="3455090">:=</span>&nbsp;<span class="ident" id="3455093">New</span><span class="op" id="3455096">(</span><span class="ident" id="3455097">t</span><span class="op" id="3455098">.</span><span class="ident" id="3455099">name</span><span class="op" id="3455103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3455106">nt</span><span class="op" id="3455108">.</span><span class="ident" id="3455109">Tree</span>&nbsp;<span class="op" id="3455114">=</span>&nbsp;<span class="ident" id="3455116">t</span><span class="op" id="3455117">.</span><span class="ident" id="3455118">Tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3455124">nt</span><span class="op" id="3455126">.</span><span class="ident" id="3455127">common</span>&nbsp;<span class="op" id="3455134">=</span>&nbsp;<span class="ident" id="3455136">c</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3455139">nt</span><span class="op" id="3455141">.</span><span class="ident" id="3455142">leftDelim</span>&nbsp;<span class="op" id="3455152">=</span>&nbsp;<span class="ident" id="3455154">t</span><span class="op" id="3455155">.</span><span class="ident" id="3455156">leftDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3455167">nt</span><span class="op" id="3455169">.</span><span class="ident" id="3455170">rightDelim</span>&nbsp;<span class="op" id="3455181">=</span>&nbsp;<span class="ident" id="3455183">t</span><span class="op" id="3455184">.</span><span class="ident" id="3455185">rightDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3455197">return</span>&nbsp;<span class="ident" id="3455204">nt</span><br>
<span class="lineno"></span><span class="op" id="3455207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="3455210">//&nbsp;AddParseTree&nbsp;creates&nbsp;a&nbsp;new&nbsp;template&nbsp;with&nbsp;the&nbsp;name&nbsp;and&nbsp;parse&nbsp;tree</span><br>
<span class="lineno"></span><span class="comment" id="3455278">//&nbsp;and&nbsp;associates&nbsp;it&nbsp;with&nbsp;t.</span><br>
<span class="lineno"></span><span class="keyword" id="3455307">func</span>&nbsp;<span class="op" id="3455312">(</span><span class="ident" id="3455313">t</span>&nbsp;<span class="op" id="3455315">*</span><span class="ident" id="3455316">Template</span><span class="op" id="3455324">)</span>&nbsp;<span class="ident" id="3455326">AddParseTree</span><span class="op" id="3455338">(</span><span class="ident" id="3455339">name</span>&nbsp;<span class="builtintype" id="3455344">string</span><span class="op" id="3455350">,</span>&nbsp;<span class="ident" id="3455352">tree</span>&nbsp;<span class="op" id="3455357">*</span><span class="ident" id="3455358">parse</span><span class="op" id="3455363">.</span><span class="ident" id="3455364">Tree</span><span class="op" id="3455368">)</span>&nbsp;<span class="op" id="3455370">(</span><span class="op" id="3455371">*</span><span class="ident" id="3455372">Template</span><span class="op" id="3455380">,</span>&nbsp;<span class="builtintype" id="3455382">error</span><span class="op" id="3455387">)</span>&nbsp;<span class="op" id="3455389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3455392">if</span>&nbsp;<span class="ident" id="3455395">t</span><span class="op" id="3455396">.</span><span class="ident" id="3455397">common</span>&nbsp;<span class="op" id="3455404">!=</span>&nbsp;<span class="ident" id="3455407">nil</span>&nbsp;<span class="op" id="3455411">&amp;&amp;</span>&nbsp;<span class="ident" id="3455414">t</span><span class="op" id="3455415">.</span><span class="ident" id="3455416">tmpl</span><span class="op" id="3455420">[</span><span class="ident" id="3455421">name</span><span class="op" id="3455425">]</span>&nbsp;<span class="op" id="3455427">!=</span>&nbsp;<span class="ident" id="3455430">nil</span>&nbsp;<span class="op" id="3455434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3455438">return</span>&nbsp;<span class="ident" id="3455445">nil</span><span class="op" id="3455448">,</span>&nbsp;<span class="ident" id="3455450">fmt</span><span class="op" id="3455453">.</span><span class="ident" id="3455454">Errorf</span><span class="op" id="3455460">(</span><span class="string" id="3455461">&#34;template:&nbsp;redefinition&nbsp;of&nbsp;template&nbsp;%q&#34;</span><span class="op" id="3455500">,</span>&nbsp;<span class="ident" id="3455502">name</span><span class="op" id="3455506">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3455509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3455512">nt</span>&nbsp;<span class="op" id="3455515">:=</span>&nbsp;<span class="ident" id="3455518">t</span><span class="op" id="3455519">.</span><span class="ident" id="3455520">New</span><span class="op" id="3455523">(</span><span class="ident" id="3455524">name</span><span class="op" id="3455528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3455531">nt</span><span class="op" id="3455533">.</span><span class="ident" id="3455534">Tree</span>&nbsp;<span class="op" id="3455539">=</span>&nbsp;<span class="ident" id="3455541">tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3455547">t</span><span class="op" id="3455548">.</span><span class="ident" id="3455549">tmpl</span><span class="op" id="3455553">[</span><span class="ident" id="3455554">name</span><span class="op" id="3455558">]</span>&nbsp;<span class="op" id="3455560">=</span>&nbsp;<span class="ident" id="3455562">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3455566">return</span>&nbsp;<span class="ident" id="3455573">nt</span><span class="op" id="3455575">,</span>&nbsp;<span class="ident" id="3455577">nil</span><br>
<span class="lineno">115</span><span class="op" id="3455581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3455584">//&nbsp;Templates&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;templates&nbsp;associated&nbsp;with&nbsp;t,&nbsp;including&nbsp;t</span><br>
<span class="lineno"></span><span class="comment" id="3455661">//&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="3455672">func</span>&nbsp;<span class="op" id="3455677">(</span><span class="ident" id="3455678">t</span>&nbsp;<span class="op" id="3455680">*</span><span class="ident" id="3455681">Template</span><span class="op" id="3455689">)</span>&nbsp;<span class="ident" id="3455691">Templates</span><span class="op" id="3455700">(</span><span class="op" id="3455701">)</span>&nbsp;<span class="op" id="3455703">[</span><span class="op" id="3455704">]</span><span class="op" id="3455705">*</span><span class="ident" id="3455706">Template</span>&nbsp;<span class="op" id="3455715">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3455718">if</span>&nbsp;<span class="ident" id="3455721">t</span><span class="op" id="3455722">.</span><span class="ident" id="3455723">common</span>&nbsp;<span class="op" id="3455730">==</span>&nbsp;<span class="ident" id="3455733">nil</span>&nbsp;<span class="op" id="3455737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3455741">return</span>&nbsp;<span class="ident" id="3455748">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3455753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3455756">//&nbsp;Return&nbsp;a&nbsp;slice&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;expose&nbsp;the&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3455803">m</span>&nbsp;<span class="op" id="3455805">:=</span>&nbsp;<span class="builtinfunc" id="3455808">make</span><span class="op" id="3455812">(</span><span class="op" id="3455813">[</span><span class="op" id="3455814">]</span><span class="op" id="3455815">*</span><span class="ident" id="3455816">Template</span><span class="op" id="3455824">,</span>&nbsp;<span class="num" id="3455826">0</span><span class="op" id="3455827">,</span>&nbsp;<span class="builtinfunc" id="3455829">len</span><span class="op" id="3455832">(</span><span class="ident" id="3455833">t</span><span class="op" id="3455834">.</span><span class="ident" id="3455835">tmpl</span><span class="op" id="3455839">)</span><span class="op" id="3455840">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3455843">for</span>&nbsp;<span class="ident" id="3455847">_</span><span class="op" id="3455848">,</span>&nbsp;<span class="ident" id="3455850">v</span>&nbsp;<span class="op" id="3455852">:=</span>&nbsp;<span class="keyword" id="3455855">range</span>&nbsp;<span class="ident" id="3455861">t</span><span class="op" id="3455862">.</span><span class="ident" id="3455863">tmpl</span>&nbsp;<span class="op" id="3455868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3455872">m</span>&nbsp;<span class="op" id="3455874">=</span>&nbsp;<span class="builtinfunc" id="3455876">append</span><span class="op" id="3455882">(</span><span class="ident" id="3455883">m</span><span class="op" id="3455884">,</span>&nbsp;<span class="ident" id="3455886">v</span><span class="op" id="3455887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3455890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3455893">return</span>&nbsp;<span class="ident" id="3455900">m</span><br>
<span class="lineno"></span><span class="op" id="3455902">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="3455905">//&nbsp;Delims&nbsp;sets&nbsp;the&nbsp;action&nbsp;delimiters&nbsp;to&nbsp;the&nbsp;specified&nbsp;strings,&nbsp;to&nbsp;be&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3455982">//&nbsp;subsequent&nbsp;calls&nbsp;to&nbsp;Parse,&nbsp;ParseFiles,&nbsp;or&nbsp;ParseGlob.&nbsp;Nested&nbsp;template</span><br>
<span class="lineno"></span><span class="comment" id="3456054">//&nbsp;definitions&nbsp;will&nbsp;inherit&nbsp;the&nbsp;settings.&nbsp;An&nbsp;empty&nbsp;delimiter&nbsp;stands&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3456130">//&nbsp;corresponding&nbsp;default:&nbsp;{{&nbsp;or&nbsp;}}.</span><br>
<span class="lineno">135</span><span class="comment" id="3456166">//&nbsp;The&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;template,&nbsp;so&nbsp;calls&nbsp;can&nbsp;be&nbsp;chained.</span><br>
<span class="lineno"></span><span class="keyword" id="3456228">func</span>&nbsp;<span class="op" id="3456233">(</span><span class="ident" id="3456234">t</span>&nbsp;<span class="op" id="3456236">*</span><span class="ident" id="3456237">Template</span><span class="op" id="3456245">)</span>&nbsp;<span class="ident" id="3456247">Delims</span><span class="op" id="3456253">(</span><span class="ident" id="3456254">left</span><span class="op" id="3456258">,</span>&nbsp;<span class="ident" id="3456260">right</span>&nbsp;<span class="builtintype" id="3456266">string</span><span class="op" id="3456272">)</span>&nbsp;<span class="op" id="3456274">*</span><span class="ident" id="3456275">Template</span>&nbsp;<span class="op" id="3456284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3456287">t</span><span class="op" id="3456288">.</span><span class="ident" id="3456289">leftDelim</span>&nbsp;<span class="op" id="3456299">=</span>&nbsp;<span class="ident" id="3456301">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3456307">t</span><span class="op" id="3456308">.</span><span class="ident" id="3456309">rightDelim</span>&nbsp;<span class="op" id="3456320">=</span>&nbsp;<span class="ident" id="3456322">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3456329">return</span>&nbsp;<span class="ident" id="3456336">t</span><br>
<span class="lineno">140</span><span class="op" id="3456338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3456341">//&nbsp;Funcs&nbsp;adds&nbsp;the&nbsp;elements&nbsp;of&nbsp;the&nbsp;argument&nbsp;map&nbsp;to&nbsp;the&nbsp;template&#39;s&nbsp;function&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="3456420">//&nbsp;It&nbsp;panics&nbsp;if&nbsp;a&nbsp;value&nbsp;in&nbsp;the&nbsp;map&nbsp;is&nbsp;not&nbsp;a&nbsp;function&nbsp;with&nbsp;appropriate&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="3456497">//&nbsp;type.&nbsp;However,&nbsp;it&nbsp;is&nbsp;legal&nbsp;to&nbsp;overwrite&nbsp;elements&nbsp;of&nbsp;the&nbsp;map.&nbsp;The&nbsp;return</span><br>
<span class="lineno">145</span><span class="comment" id="3456572">//&nbsp;value&nbsp;is&nbsp;the&nbsp;template,&nbsp;so&nbsp;calls&nbsp;can&nbsp;be&nbsp;chained.</span><br>
<span class="lineno"></span><span class="keyword" id="3456623">func</span>&nbsp;<span class="op" id="3456628">(</span><span class="ident" id="3456629">t</span>&nbsp;<span class="op" id="3456631">*</span><span class="ident" id="3456632">Template</span><span class="op" id="3456640">)</span>&nbsp;<span class="ident" id="3456642">Funcs</span><span class="op" id="3456647">(</span><span class="ident" id="3456648">funcMap</span>&nbsp;<span class="ident" id="3456656">FuncMap</span><span class="op" id="3456663">)</span>&nbsp;<span class="op" id="3456665">*</span><span class="ident" id="3456666">Template</span>&nbsp;<span class="op" id="3456675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3456678">t</span><span class="op" id="3456679">.</span><span class="ident" id="3456680">init</span><span class="op" id="3456684">(</span><span class="op" id="3456685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3456688">addValueFuncs</span><span class="op" id="3456701">(</span><span class="ident" id="3456702">t</span><span class="op" id="3456703">.</span><span class="ident" id="3456704">execFuncs</span><span class="op" id="3456713">,</span>&nbsp;<span class="ident" id="3456715">funcMap</span><span class="op" id="3456722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3456725">addFuncs</span><span class="op" id="3456733">(</span><span class="ident" id="3456734">t</span><span class="op" id="3456735">.</span><span class="ident" id="3456736">parseFuncs</span><span class="op" id="3456746">,</span>&nbsp;<span class="ident" id="3456748">funcMap</span><span class="op" id="3456755">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3456758">return</span>&nbsp;<span class="ident" id="3456765">t</span><br>
<span class="lineno"></span><span class="op" id="3456767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3456770">//&nbsp;Lookup&nbsp;returns&nbsp;the&nbsp;template&nbsp;with&nbsp;the&nbsp;given&nbsp;name&nbsp;that&nbsp;is&nbsp;associated&nbsp;with&nbsp;t,</span><br>
<span class="lineno"></span><span class="comment" id="3456848">//&nbsp;or&nbsp;nil&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;such&nbsp;template.</span><br>
<span class="lineno">155</span><span class="keyword" id="3456888">func</span>&nbsp;<span class="op" id="3456893">(</span><span class="ident" id="3456894">t</span>&nbsp;<span class="op" id="3456896">*</span><span class="ident" id="3456897">Template</span><span class="op" id="3456905">)</span>&nbsp;<span class="ident" id="3456907">Lookup</span><span class="op" id="3456913">(</span><span class="ident" id="3456914">name</span>&nbsp;<span class="builtintype" id="3456919">string</span><span class="op" id="3456925">)</span>&nbsp;<span class="op" id="3456927">*</span><span class="ident" id="3456928">Template</span>&nbsp;<span class="op" id="3456937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3456940">if</span>&nbsp;<span class="ident" id="3456943">t</span><span class="op" id="3456944">.</span><span class="ident" id="3456945">common</span>&nbsp;<span class="op" id="3456952">==</span>&nbsp;<span class="ident" id="3456955">nil</span>&nbsp;<span class="op" id="3456959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3456963">return</span>&nbsp;<span class="ident" id="3456970">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3456975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3456978">return</span>&nbsp;<span class="ident" id="3456985">t</span><span class="op" id="3456986">.</span><span class="ident" id="3456987">tmpl</span><span class="op" id="3456991">[</span><span class="ident" id="3456992">name</span><span class="op" id="3456996">]</span><br>
<span class="lineno">160</span><span class="op" id="3456998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3457001">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;string&nbsp;into&nbsp;a&nbsp;template.&nbsp;Nested&nbsp;template&nbsp;definitions&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3457079">//&nbsp;associated&nbsp;with&nbsp;the&nbsp;top-level&nbsp;template&nbsp;t.&nbsp;Parse&nbsp;may&nbsp;be&nbsp;called&nbsp;multiple&nbsp;times</span><br>
<span class="lineno"></span><span class="comment" id="3457159">//&nbsp;to&nbsp;parse&nbsp;definitions&nbsp;of&nbsp;templates&nbsp;to&nbsp;associate&nbsp;with&nbsp;t.&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;if&nbsp;a</span><br>
<span class="lineno">165</span><span class="comment" id="3457237">//&nbsp;resulting&nbsp;template&nbsp;is&nbsp;non-empty&nbsp;(contains&nbsp;content&nbsp;other&nbsp;than&nbsp;template</span><br>
<span class="lineno"></span><span class="comment" id="3457310">//&nbsp;definitions)&nbsp;and&nbsp;would&nbsp;replace&nbsp;a&nbsp;non-empty&nbsp;template&nbsp;with&nbsp;the&nbsp;same&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="3457385">//&nbsp;(In&nbsp;multiple&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;with&nbsp;the&nbsp;same&nbsp;receiver&nbsp;template,&nbsp;only&nbsp;one&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="3457463">//&nbsp;can&nbsp;contain&nbsp;text&nbsp;other&nbsp;than&nbsp;space,&nbsp;comments,&nbsp;and&nbsp;template&nbsp;definitions.)</span><br>
<span class="lineno"></span><span class="keyword" id="3457538">func</span>&nbsp;<span class="op" id="3457543">(</span><span class="ident" id="3457544">t</span>&nbsp;<span class="op" id="3457546">*</span><span class="ident" id="3457547">Template</span><span class="op" id="3457555">)</span>&nbsp;<span class="ident" id="3457557">Parse</span><span class="op" id="3457562">(</span><span class="ident" id="3457563">text</span>&nbsp;<span class="builtintype" id="3457568">string</span><span class="op" id="3457574">)</span>&nbsp;<span class="op" id="3457576">(</span><span class="op" id="3457577">*</span><span class="ident" id="3457578">Template</span><span class="op" id="3457586">,</span>&nbsp;<span class="builtintype" id="3457588">error</span><span class="op" id="3457593">)</span>&nbsp;<span class="op" id="3457595">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3457598">t</span><span class="op" id="3457599">.</span><span class="ident" id="3457600">init</span><span class="op" id="3457604">(</span><span class="op" id="3457605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3457608">trees</span><span class="op" id="3457613">,</span>&nbsp;<span class="ident" id="3457615">err</span>&nbsp;<span class="op" id="3457619">:=</span>&nbsp;<span class="ident" id="3457622">parse</span><span class="op" id="3457627">.</span><span class="ident" id="3457628">Parse</span><span class="op" id="3457633">(</span><span class="ident" id="3457634">t</span><span class="op" id="3457635">.</span><span class="ident" id="3457636">name</span><span class="op" id="3457640">,</span>&nbsp;<span class="ident" id="3457642">text</span><span class="op" id="3457646">,</span>&nbsp;<span class="ident" id="3457648">t</span><span class="op" id="3457649">.</span><span class="ident" id="3457650">leftDelim</span><span class="op" id="3457659">,</span>&nbsp;<span class="ident" id="3457661">t</span><span class="op" id="3457662">.</span><span class="ident" id="3457663">rightDelim</span><span class="op" id="3457673">,</span>&nbsp;<span class="ident" id="3457675">t</span><span class="op" id="3457676">.</span><span class="ident" id="3457677">parseFuncs</span><span class="op" id="3457687">,</span>&nbsp;<span class="ident" id="3457689">builtins</span><span class="op" id="3457697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3457700">if</span>&nbsp;<span class="ident" id="3457703">err</span>&nbsp;<span class="op" id="3457707">!=</span>&nbsp;<span class="ident" id="3457710">nil</span>&nbsp;<span class="op" id="3457714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3457718">return</span>&nbsp;<span class="ident" id="3457725">nil</span><span class="op" id="3457728">,</span>&nbsp;<span class="ident" id="3457730">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3457735">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3457738">//&nbsp;Add&nbsp;the&nbsp;newly&nbsp;parsed&nbsp;trees,&nbsp;including&nbsp;the&nbsp;one&nbsp;for&nbsp;t,&nbsp;into&nbsp;our&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3457822">for</span>&nbsp;<span class="ident" id="3457826">name</span><span class="op" id="3457830">,</span>&nbsp;<span class="ident" id="3457832">tree</span>&nbsp;<span class="op" id="3457837">:=</span>&nbsp;<span class="keyword" id="3457840">range</span>&nbsp;<span class="ident" id="3457846">trees</span>&nbsp;<span class="op" id="3457852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3457856">//&nbsp;If&nbsp;the&nbsp;name&nbsp;we&nbsp;parsed&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;this&nbsp;template,&nbsp;overwrite&nbsp;this&nbsp;template.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3457938">//&nbsp;The&nbsp;associate&nbsp;method&nbsp;checks&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;redefinition.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3457996">tmpl</span>&nbsp;<span class="op" id="3458001">:=</span>&nbsp;<span class="ident" id="3458004">t</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3458008">if</span>&nbsp;<span class="ident" id="3458011">name</span>&nbsp;<span class="op" id="3458016">!=</span>&nbsp;<span class="ident" id="3458019">t</span><span class="op" id="3458020">.</span><span class="ident" id="3458021">name</span>&nbsp;<span class="op" id="3458026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3458031">tmpl</span>&nbsp;<span class="op" id="3458036">=</span>&nbsp;<span class="ident" id="3458038">t</span><span class="op" id="3458039">.</span><span class="ident" id="3458040">New</span><span class="op" id="3458043">(</span><span class="ident" id="3458044">name</span><span class="op" id="3458048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3458052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3458056">//&nbsp;Even&nbsp;if&nbsp;t&nbsp;==&nbsp;tmpl,&nbsp;we&nbsp;need&nbsp;to&nbsp;install&nbsp;it&nbsp;in&nbsp;the&nbsp;common.tmpl&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3458126">if</span>&nbsp;<span class="ident" id="3458129">replace</span><span class="op" id="3458136">,</span>&nbsp;<span class="ident" id="3458138">err</span>&nbsp;<span class="op" id="3458142">:=</span>&nbsp;<span class="ident" id="3458145">t</span><span class="op" id="3458146">.</span><span class="ident" id="3458147">associate</span><span class="op" id="3458156">(</span><span class="ident" id="3458157">tmpl</span><span class="op" id="3458161">,</span>&nbsp;<span class="ident" id="3458163">tree</span><span class="op" id="3458167">)</span><span class="op" id="3458168">;</span>&nbsp;<span class="ident" id="3458170">err</span>&nbsp;<span class="op" id="3458174">!=</span>&nbsp;<span class="ident" id="3458177">nil</span>&nbsp;<span class="op" id="3458181">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3458186">return</span>&nbsp;<span class="ident" id="3458193">nil</span><span class="op" id="3458196">,</span>&nbsp;<span class="ident" id="3458198">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3458204">}</span>&nbsp;<span class="keyword" id="3458206">else</span>&nbsp;<span class="keyword" id="3458211">if</span>&nbsp;<span class="ident" id="3458214">replace</span>&nbsp;<span class="op" id="3458222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3458227">tmpl</span><span class="op" id="3458231">.</span><span class="ident" id="3458232">Tree</span>&nbsp;<span class="op" id="3458237">=</span>&nbsp;<span class="ident" id="3458239">tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3458246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3458250">tmpl</span><span class="op" id="3458254">.</span><span class="ident" id="3458255">leftDelim</span>&nbsp;<span class="op" id="3458265">=</span>&nbsp;<span class="ident" id="3458267">t</span><span class="op" id="3458268">.</span><span class="ident" id="3458269">leftDelim</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3458281">tmpl</span><span class="op" id="3458285">.</span><span class="ident" id="3458286">rightDelim</span>&nbsp;<span class="op" id="3458297">=</span>&nbsp;<span class="ident" id="3458299">t</span><span class="op" id="3458300">.</span><span class="ident" id="3458301">rightDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3458313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3458316">return</span>&nbsp;<span class="ident" id="3458323">t</span><span class="op" id="3458324">,</span>&nbsp;<span class="ident" id="3458326">nil</span><br>
<span class="lineno"></span><span class="op" id="3458330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="comment" id="3458333">//&nbsp;associate&nbsp;installs&nbsp;the&nbsp;new&nbsp;template&nbsp;into&nbsp;the&nbsp;group&nbsp;of&nbsp;templates&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="3458411">//&nbsp;with&nbsp;t.&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;reuse&nbsp;a&nbsp;name&nbsp;except&nbsp;to&nbsp;overwrite&nbsp;an&nbsp;empty</span><br>
<span class="lineno"></span><span class="comment" id="3458482">//&nbsp;template.&nbsp;The&nbsp;two&nbsp;are&nbsp;already&nbsp;known&nbsp;to&nbsp;share&nbsp;the&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="3458552">//&nbsp;The&nbsp;boolean&nbsp;return&nbsp;value&nbsp;reports&nbsp;wither&nbsp;to&nbsp;store&nbsp;this&nbsp;tree&nbsp;as&nbsp;t.Tree.</span><br>
<span class="lineno"></span><span class="keyword" id="3458625">func</span>&nbsp;<span class="op" id="3458630">(</span><span class="ident" id="3458631">t</span>&nbsp;<span class="op" id="3458633">*</span><span class="ident" id="3458634">Template</span><span class="op" id="3458642">)</span>&nbsp;<span class="ident" id="3458644">associate</span><span class="op" id="3458653">(</span><span class="builtinfunc" id="3458654">new</span>&nbsp;<span class="op" id="3458658">*</span><span class="ident" id="3458659">Template</span><span class="op" id="3458667">,</span>&nbsp;<span class="ident" id="3458669">tree</span>&nbsp;<span class="op" id="3458674">*</span><span class="ident" id="3458675">parse</span><span class="op" id="3458680">.</span><span class="ident" id="3458681">Tree</span><span class="op" id="3458685">)</span>&nbsp;<span class="op" id="3458687">(</span><span class="builtintype" id="3458688">bool</span><span class="op" id="3458692">,</span>&nbsp;<span class="builtintype" id="3458694">error</span><span class="op" id="3458699">)</span>&nbsp;<span class="op" id="3458701">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3458704">if</span>&nbsp;<span class="builtinfunc" id="3458707">new</span><span class="op" id="3458710">.</span><span class="ident" id="3458711">common</span>&nbsp;<span class="op" id="3458718">!=</span>&nbsp;<span class="ident" id="3458721">t</span><span class="op" id="3458722">.</span><span class="ident" id="3458723">common</span>&nbsp;<span class="op" id="3458730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3458734">panic</span><span class="op" id="3458739">(</span><span class="string" id="3458740">&#34;internal&nbsp;error:&nbsp;associate&nbsp;not&nbsp;common&#34;</span><span class="op" id="3458778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3458781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3458784">name</span>&nbsp;<span class="op" id="3458789">:=</span>&nbsp;<span class="builtinfunc" id="3458792">new</span><span class="op" id="3458795">.</span><span class="ident" id="3458796">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3458802">if</span>&nbsp;<span class="ident" id="3458805">old</span>&nbsp;<span class="op" id="3458809">:=</span>&nbsp;<span class="ident" id="3458812">t</span><span class="op" id="3458813">.</span><span class="ident" id="3458814">tmpl</span><span class="op" id="3458818">[</span><span class="ident" id="3458819">name</span><span class="op" id="3458823">]</span><span class="op" id="3458824">;</span>&nbsp;<span class="ident" id="3458826">old</span>&nbsp;<span class="op" id="3458830">!=</span>&nbsp;<span class="ident" id="3458833">nil</span>&nbsp;<span class="op" id="3458837">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3458841">oldIsEmpty</span>&nbsp;<span class="op" id="3458852">:=</span>&nbsp;<span class="ident" id="3458855">parse</span><span class="op" id="3458860">.</span><span class="ident" id="3458861">IsEmptyTree</span><span class="op" id="3458872">(</span><span class="ident" id="3458873">old</span><span class="op" id="3458876">.</span><span class="ident" id="3458877">Root</span><span class="op" id="3458881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3458885">newIsEmpty</span>&nbsp;<span class="op" id="3458896">:=</span>&nbsp;<span class="ident" id="3458899">parse</span><span class="op" id="3458904">.</span><span class="ident" id="3458905">IsEmptyTree</span><span class="op" id="3458916">(</span><span class="ident" id="3458917">tree</span><span class="op" id="3458921">.</span><span class="ident" id="3458922">Root</span><span class="op" id="3458926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3458930">if</span>&nbsp;<span class="ident" id="3458933">newIsEmpty</span>&nbsp;<span class="op" id="3458944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3458949">//&nbsp;Whether&nbsp;old&nbsp;is&nbsp;empty&nbsp;or&nbsp;not,&nbsp;new&nbsp;is&nbsp;empty;&nbsp;no&nbsp;reason&nbsp;to&nbsp;replace&nbsp;old.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3459024">return</span>&nbsp;<span class="builtintype" id="3459031">false</span><span class="op" id="3459036">,</span>&nbsp;<span class="ident" id="3459038">nil</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3459044">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3459048">if</span>&nbsp;<span class="op" id="3459051">!</span><span class="ident" id="3459052">oldIsEmpty</span>&nbsp;<span class="op" id="3459063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3459068">return</span>&nbsp;<span class="builtintype" id="3459075">false</span><span class="op" id="3459080">,</span>&nbsp;<span class="ident" id="3459082">fmt</span><span class="op" id="3459085">.</span><span class="ident" id="3459086">Errorf</span><span class="op" id="3459092">(</span><span class="string" id="3459093">&#34;template:&nbsp;redefinition&nbsp;of&nbsp;template&nbsp;%q&#34;</span><span class="op" id="3459132">,</span>&nbsp;<span class="ident" id="3459134">name</span><span class="op" id="3459138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3459142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3459145">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3459148">t</span><span class="op" id="3459149">.</span><span class="ident" id="3459150">tmpl</span><span class="op" id="3459154">[</span><span class="ident" id="3459155">name</span><span class="op" id="3459159">]</span>&nbsp;<span class="op" id="3459161">=</span>&nbsp;<span class="builtinfunc" id="3459163">new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3459168">return</span>&nbsp;<span class="builtintype" id="3459175">true</span><span class="op" id="3459179">,</span>&nbsp;<span class="ident" id="3459181">nil</span><br>
<span class="lineno"></span><span class="op" id="3459185">}</span>
</div>
</body>
</html>
