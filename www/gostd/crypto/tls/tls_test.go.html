<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html" class="current">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7120616">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7120671">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7120725">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7120776">package</span>&nbsp;<span class="ident" id="7120784">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7120789">import</span>&nbsp;<span class="op" id="7120796">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7120799">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7120808">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7120815">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7120821">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7120828">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7120839">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7120850">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="7120857">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7120860">var</span>&nbsp;<span class="ident" id="7120864">rsaCertPEM</span>&nbsp;<span class="op" id="7120875">=</span>&nbsp;<span class="string" id="7120877">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB0zCCAX2gAwIBAgIJAI/M7BYjwB+uMA0GCSqGSIb3DQEBBQUAMEUxCzAJBgNV<br>
<span class="lineno"></span>BAYTAkFVMRMwEQYDVQQIDApTb21lLVN0YXRlMSEwHwYDVQQKDBhJbnRlcm5ldCBX<br>
<span class="lineno">20</span>aWRnaXRzIFB0eSBMdGQwHhcNMTIwOTEyMjE1MjAyWhcNMTUwOTEyMjE1MjAyWjBF<br>
<span class="lineno"></span>MQswCQYDVQQGEwJBVTETMBEGA1UECAwKU29tZS1TdGF0ZTEhMB8GA1UECgwYSW50<br>
<span class="lineno"></span>ZXJuZXQgV2lkZ2l0cyBQdHkgTHRkMFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBANLJ<br>
<span class="lineno"></span>hPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wok/4xIA+ui35/MmNa<br>
<span class="lineno"></span>rtNuC+BdZ1tMuVCPFZcCAwEAAaNQME4wHQYDVR0OBBYEFJvKs8RfJaXTH08W+SGv<br>
<span class="lineno">25</span>zQyKn0H8MB8GA1UdIwQYMBaAFJvKs8RfJaXTH08W+SGvzQyKn0H8MAwGA1UdEwQF<br>
<span class="lineno"></span>MAMBAf8wDQYJKoZIhvcNAQEFBQADQQBJlffJHybjDGxRMqaRmDhX0+6v02TUKZsW<br>
<span class="lineno"></span>r5QuVbpQhH6u+0UgcW0jp9QwpxoPTLTWGXEWBBBurxFwiCBhkQ+V<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="7121573">var</span>&nbsp;<span class="ident" id="7121577">rsaKeyPEM</span>&nbsp;<span class="op" id="7121587">=</span>&nbsp;<span class="string" id="7121589">`-----BEGIN&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIIBOwIBAAJBANLJhPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wo<br>
<span class="lineno"></span>k/4xIA+ui35/MmNartNuC+BdZ1tMuVCPFZcCAwEAAQJAEJ2N+zsR0Xn8/Q6twa4G<br>
<span class="lineno"></span>6OB1M1WO+k+ztnX/1SvNeWu8D6GImtupLTYgjZcHufykj09jiHmjHx8u8ZZB/o1N<br>
<span class="lineno">35</span>MQIhAPW+eyZo7ay3lMz1V01WVjNKK9QSn1MJlb06h/LuYv9FAiEA25WPedKgVyCW<br>
<span class="lineno"></span>SmUwbPw8fnTcpqDWE3yTO3vKcebqMSsCIBF3UmVue8YU3jybC3NxuXq3wNm34R8T<br>
<span class="lineno"></span>xVLHwDXh/6NJAiEAl2oHGGLz64BuAfjKrqwz7qMYr9HCLIe/YsoWq/olzScCIQDi<br>
<span class="lineno"></span>D2lWusoe2/nEqfDVVWGWlyJ7yOmqaVm/iNUN9B2N2g==<br>
<span class="lineno"></span>-----END&nbsp;RSA&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">40</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7122090">//&nbsp;keyPEM&nbsp;is&nbsp;the&nbsp;same&nbsp;as&nbsp;rsaKeyPEM,&nbsp;but&nbsp;declares&nbsp;itself&nbsp;as&nbsp;just</span><br>
<span class="lineno"></span><span class="comment" id="7122154">//&nbsp;&#34;PRIVATE&nbsp;KEY&#34;,&nbsp;not&nbsp;&#34;RSA&nbsp;PRIVATE&nbsp;KEY&#34;.&nbsp;&nbsp;http://golang.org/issue/4477</span><br>
<span class="lineno"></span><span class="keyword" id="7122225">var</span>&nbsp;<span class="ident" id="7122229">keyPEM</span>&nbsp;<span class="op" id="7122236">=</span>&nbsp;<span class="string" id="7122238">`-----BEGIN&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">45</span>MIIBOwIBAAJBANLJhPHhITqQbPklG3ibCVxwGMRfp/v4XqhfdQHdcVfHap6NQ5Wo<br>
<span class="lineno"></span>k/4xIA+ui35/MmNartNuC+BdZ1tMuVCPFZcCAwEAAQJAEJ2N+zsR0Xn8/Q6twa4G<br>
<span class="lineno"></span>6OB1M1WO+k+ztnX/1SvNeWu8D6GImtupLTYgjZcHufykj09jiHmjHx8u8ZZB/o1N<br>
<span class="lineno"></span>MQIhAPW+eyZo7ay3lMz1V01WVjNKK9QSn1MJlb06h/LuYv9FAiEA25WPedKgVyCW<br>
<span class="lineno"></span>SmUwbPw8fnTcpqDWE3yTO3vKcebqMSsCIBF3UmVue8YU3jybC3NxuXq3wNm34R8T<br>
<span class="lineno">50</span>xVLHwDXh/6NJAiEAl2oHGGLz64BuAfjKrqwz7qMYr9HCLIe/YsoWq/olzScCIQDi<br>
<span class="lineno"></span>D2lWusoe2/nEqfDVVWGWlyJ7yOmqaVm/iNUN9B2N2g==<br>
<span class="lineno"></span>-----END&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="7122731">var</span>&nbsp;<span class="ident" id="7122735">ecdsaCertPEM</span>&nbsp;<span class="op" id="7122748">=</span>&nbsp;<span class="string" id="7122750">`-----BEGIN&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>MIIB/jCCAWICCQDscdUxw16XFDAJBgcqhkjOPQQBMEUxCzAJBgNVBAYTAkFVMRMw<br>
<span class="lineno"></span>EQYDVQQIEwpTb21lLVN0YXRlMSEwHwYDVQQKExhJbnRlcm5ldCBXaWRnaXRzIFB0<br>
<span class="lineno"></span>eSBMdGQwHhcNMTIxMTE0MTI0MDQ4WhcNMTUxMTE0MTI0MDQ4WjBFMQswCQYDVQQG<br>
<span class="lineno"></span>EwJBVTETMBEGA1UECBMKU29tZS1TdGF0ZTEhMB8GA1UEChMYSW50ZXJuZXQgV2lk<br>
<span class="lineno">60</span>Z2l0cyBQdHkgTHRkMIGbMBAGByqGSM49AgEGBSuBBAAjA4GGAAQBY9+my9OoeSUR<br>
<span class="lineno"></span>lDQdV/x8LsOuLilthhiS1Tz4aGDHIPwC1mlvnf7fg5lecYpMCrLLhauAc1UJXcgl<br>
<span class="lineno"></span>01xoLuzgtAEAgv2P/jgytzRSpUYvgLBt1UA0leLYBy6mQQbrNEuqT3INapKIcUv8<br>
<span class="lineno"></span>XxYP0xMEUksLPq6Ca+CRSqTtrd/23uTnapkwCQYHKoZIzj0EAQOBigAwgYYCQXJo<br>
<span class="lineno"></span>A7Sl2nLVf+4Iu/tAX/IF4MavARKC4PPHK3zfuGfPR3oCCcsAoz3kAzOeijvd0iXb<br>
<span class="lineno">65</span>H5jBImIxPL4WxQNiBTexAkF8D1EtpYuWdlVQ80/h/f4pBcGiXPqX5h2PQSQY7hP1<br>
<span class="lineno"></span>+jwM1FGS4fREIOvlBYr/SzzQRtwrvrzGYxDEDbsC0ZGRnA==<br>
<span class="lineno"></span>-----END&nbsp;CERTIFICATE-----<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="7123507">var</span>&nbsp;<span class="ident" id="7123511">ecdsaKeyPEM</span>&nbsp;<span class="op" id="7123523">=</span>&nbsp;<span class="string" id="7123525">`-----BEGIN&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>BgUrgQQAIw==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PARAMETERS-----<br>
<span class="lineno"></span>-----BEGIN&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno"></span>MIHcAgEBBEIBrsoKp0oqcv6/JovJJDoDVSGWdirrkgCWxrprGlzB9o0X8fV675X0<br>
<span class="lineno">75</span>NwuBenXFfeZvVcwluO7/Q9wkYoPd/t3jGImgBwYFK4EEACOhgYkDgYYABAFj36bL<br>
<span class="lineno"></span>06h5JRGUNB1X/Hwuw64uKW2GGJLVPPhoYMcg/ALWaW+d/t+DmV5xikwKssuFq4Bz<br>
<span class="lineno"></span>VQldyCXTXGgu7OC0AQCC/Y/+ODK3NFKlRi+AsG3VQDSV4tgHLqZBBus0S6pPcg1q<br>
<span class="lineno"></span>kohxS/xfFg/TEwRSSws+roJr4JFKpO2t3/be5OdqmQ==<br>
<span class="lineno"></span>-----END&nbsp;EC&nbsp;PRIVATE&nbsp;KEY-----<br>
<span class="lineno">80</span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7123965">var</span>&nbsp;<span class="ident" id="7123969">keyPairTests</span>&nbsp;<span class="op" id="7123982">=</span>&nbsp;<span class="op" id="7123984">[</span><span class="op" id="7123985">]</span><span class="keyword" id="7123986">struct</span>&nbsp;<span class="op" id="7123993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7123996">algo</span>&nbsp;<span class="builtintype" id="7124001">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7124009">cert</span>&nbsp;<span class="builtintype" id="7124014">string</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7124022">key</span>&nbsp;&nbsp;<span class="builtintype" id="7124027">string</span><br>
<span class="lineno"></span><span class="op" id="7124034">}</span><span class="op" id="7124035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7124038">{</span><span class="string" id="7124039">&#34;ECDSA&#34;</span><span class="op" id="7124046">,</span>&nbsp;<span class="ident" id="7124048">ecdsaCertPEM</span><span class="op" id="7124060">,</span>&nbsp;<span class="ident" id="7124062">ecdsaKeyPEM</span><span class="op" id="7124073">}</span><span class="op" id="7124074">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7124077">{</span><span class="string" id="7124078">&#34;RSA&#34;</span><span class="op" id="7124083">,</span>&nbsp;<span class="ident" id="7124085">rsaCertPEM</span><span class="op" id="7124095">,</span>&nbsp;<span class="ident" id="7124097">rsaKeyPEM</span><span class="op" id="7124106">}</span><span class="op" id="7124107">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7124110">{</span><span class="string" id="7124111">&#34;RSA-untyped&#34;</span><span class="op" id="7124124">,</span>&nbsp;<span class="ident" id="7124126">rsaCertPEM</span><span class="op" id="7124136">,</span>&nbsp;<span class="ident" id="7124138">keyPEM</span><span class="op" id="7124144">}</span><span class="op" id="7124145">,</span>&nbsp;<span class="comment" id="7124147">//&nbsp;golang.org/issue/4477</span><br>
<span class="lineno">90</span><span class="op" id="7124172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7124175">func</span>&nbsp;<span class="ident" id="7124180">TestX509KeyPair</span><span class="op" id="7124195">(</span><span class="ident" id="7124196">t</span>&nbsp;<span class="op" id="7124198">*</span><span class="ident" id="7124199">testing</span><span class="op" id="7124206">.</span><span class="ident" id="7124207">T</span><span class="op" id="7124208">)</span>&nbsp;<span class="op" id="7124210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7124213">var</span>&nbsp;<span class="ident" id="7124217">pem</span>&nbsp;<span class="op" id="7124221">[</span><span class="op" id="7124222">]</span><span class="builtintype" id="7124223">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7124229">for</span>&nbsp;<span class="ident" id="7124233">_</span><span class="op" id="7124234">,</span>&nbsp;<span class="ident" id="7124236">test</span>&nbsp;<span class="op" id="7124241">:=</span>&nbsp;<span class="keyword" id="7124244">range</span>&nbsp;<span class="ident" id="7124250">keyPairTests</span>&nbsp;<span class="op" id="7124263">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7124267">pem</span>&nbsp;<span class="op" id="7124271">=</span>&nbsp;<span class="op" id="7124273">[</span><span class="op" id="7124274">]</span><span class="builtintype" id="7124275">byte</span><span class="op" id="7124279">(</span><span class="ident" id="7124280">test</span><span class="op" id="7124284">.</span><span class="ident" id="7124285">cert</span>&nbsp;<span class="op" id="7124290">+</span>&nbsp;<span class="ident" id="7124292">test</span><span class="op" id="7124296">.</span><span class="ident" id="7124297">key</span><span class="op" id="7124300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7124304">if</span>&nbsp;<span class="ident" id="7124307">_</span><span class="op" id="7124308">,</span>&nbsp;<span class="ident" id="7124310">err</span>&nbsp;<span class="op" id="7124314">:=</span>&nbsp;<span class="ident" id="7124317">X509KeyPair</span><span class="op" id="7124328">(</span><span class="ident" id="7124329">pem</span><span class="op" id="7124332">,</span>&nbsp;<span class="ident" id="7124334">pem</span><span class="op" id="7124337">)</span><span class="op" id="7124338">;</span>&nbsp;<span class="ident" id="7124340">err</span>&nbsp;<span class="op" id="7124344">!=</span>&nbsp;<span class="builtintype" id="7124347">nil</span>&nbsp;<span class="op" id="7124351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7124356">t</span><span class="op" id="7124357">.</span><span class="ident" id="7124358">Errorf</span><span class="op" id="7124364">(</span><span class="string" id="7124365">&#34;Failed&nbsp;to&nbsp;load&nbsp;%s&nbsp;cert&nbsp;followed&nbsp;by&nbsp;%s&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="7124412">,</span>&nbsp;<span class="ident" id="7124414">test</span><span class="op" id="7124418">.</span><span class="ident" id="7124419">algo</span><span class="op" id="7124423">,</span>&nbsp;<span class="ident" id="7124425">test</span><span class="op" id="7124429">.</span><span class="ident" id="7124430">algo</span><span class="op" id="7124434">,</span>&nbsp;<span class="ident" id="7124436">err</span><span class="op" id="7124439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7124443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7124447">pem</span>&nbsp;<span class="op" id="7124451">=</span>&nbsp;<span class="op" id="7124453">[</span><span class="op" id="7124454">]</span><span class="builtintype" id="7124455">byte</span><span class="op" id="7124459">(</span><span class="ident" id="7124460">test</span><span class="op" id="7124464">.</span><span class="ident" id="7124465">key</span>&nbsp;<span class="op" id="7124469">+</span>&nbsp;<span class="ident" id="7124471">test</span><span class="op" id="7124475">.</span><span class="ident" id="7124476">cert</span><span class="op" id="7124480">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7124484">if</span>&nbsp;<span class="ident" id="7124487">_</span><span class="op" id="7124488">,</span>&nbsp;<span class="ident" id="7124490">err</span>&nbsp;<span class="op" id="7124494">:=</span>&nbsp;<span class="ident" id="7124497">X509KeyPair</span><span class="op" id="7124508">(</span><span class="ident" id="7124509">pem</span><span class="op" id="7124512">,</span>&nbsp;<span class="ident" id="7124514">pem</span><span class="op" id="7124517">)</span><span class="op" id="7124518">;</span>&nbsp;<span class="ident" id="7124520">err</span>&nbsp;<span class="op" id="7124524">!=</span>&nbsp;<span class="builtintype" id="7124527">nil</span>&nbsp;<span class="op" id="7124531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7124536">t</span><span class="op" id="7124537">.</span><span class="ident" id="7124538">Errorf</span><span class="op" id="7124544">(</span><span class="string" id="7124545">&#34;Failed&nbsp;to&nbsp;load&nbsp;%s&nbsp;key&nbsp;followed&nbsp;by&nbsp;%s&nbsp;cert:&nbsp;%s&#34;</span><span class="op" id="7124592">,</span>&nbsp;<span class="ident" id="7124594">test</span><span class="op" id="7124598">.</span><span class="ident" id="7124599">algo</span><span class="op" id="7124603">,</span>&nbsp;<span class="ident" id="7124605">test</span><span class="op" id="7124609">.</span><span class="ident" id="7124610">algo</span><span class="op" id="7124614">,</span>&nbsp;<span class="ident" id="7124616">err</span><span class="op" id="7124619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7124623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7124626">}</span><br>
<span class="lineno"></span><span class="op" id="7124628">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="7124631">func</span>&nbsp;<span class="ident" id="7124636">TestX509MixedKeyPair</span><span class="op" id="7124656">(</span><span class="ident" id="7124657">t</span>&nbsp;<span class="op" id="7124659">*</span><span class="ident" id="7124660">testing</span><span class="op" id="7124667">.</span><span class="ident" id="7124668">T</span><span class="op" id="7124669">)</span>&nbsp;<span class="op" id="7124671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7124674">if</span>&nbsp;<span class="ident" id="7124677">_</span><span class="op" id="7124678">,</span>&nbsp;<span class="ident" id="7124680">err</span>&nbsp;<span class="op" id="7124684">:=</span>&nbsp;<span class="ident" id="7124687">X509KeyPair</span><span class="op" id="7124698">(</span><span class="op" id="7124699">[</span><span class="op" id="7124700">]</span><span class="builtintype" id="7124701">byte</span><span class="op" id="7124705">(</span><span class="ident" id="7124706">rsaCertPEM</span><span class="op" id="7124716">)</span><span class="op" id="7124717">,</span>&nbsp;<span class="op" id="7124719">[</span><span class="op" id="7124720">]</span><span class="builtintype" id="7124721">byte</span><span class="op" id="7124725">(</span><span class="ident" id="7124726">ecdsaKeyPEM</span><span class="op" id="7124737">)</span><span class="op" id="7124738">)</span><span class="op" id="7124739">;</span>&nbsp;<span class="ident" id="7124741">err</span>&nbsp;<span class="op" id="7124745">==</span>&nbsp;<span class="builtintype" id="7124748">nil</span>&nbsp;<span class="op" id="7124752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7124756">t</span><span class="op" id="7124757">.</span><span class="ident" id="7124758">Error</span><span class="op" id="7124763">(</span><span class="string" id="7124764">&#34;Load&nbsp;of&nbsp;RSA&nbsp;certificate&nbsp;succeeded&nbsp;with&nbsp;ECDSA&nbsp;private&nbsp;key&#34;</span><span class="op" id="7124822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7124825">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7124828">if</span>&nbsp;<span class="ident" id="7124831">_</span><span class="op" id="7124832">,</span>&nbsp;<span class="ident" id="7124834">err</span>&nbsp;<span class="op" id="7124838">:=</span>&nbsp;<span class="ident" id="7124841">X509KeyPair</span><span class="op" id="7124852">(</span><span class="op" id="7124853">[</span><span class="op" id="7124854">]</span><span class="builtintype" id="7124855">byte</span><span class="op" id="7124859">(</span><span class="ident" id="7124860">ecdsaCertPEM</span><span class="op" id="7124872">)</span><span class="op" id="7124873">,</span>&nbsp;<span class="op" id="7124875">[</span><span class="op" id="7124876">]</span><span class="builtintype" id="7124877">byte</span><span class="op" id="7124881">(</span><span class="ident" id="7124882">rsaKeyPEM</span><span class="op" id="7124891">)</span><span class="op" id="7124892">)</span><span class="op" id="7124893">;</span>&nbsp;<span class="ident" id="7124895">err</span>&nbsp;<span class="op" id="7124899">==</span>&nbsp;<span class="builtintype" id="7124902">nil</span>&nbsp;<span class="op" id="7124906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7124910">t</span><span class="op" id="7124911">.</span><span class="ident" id="7124912">Error</span><span class="op" id="7124917">(</span><span class="string" id="7124918">&#34;Load&nbsp;of&nbsp;ECDSA&nbsp;certificate&nbsp;succeeded&nbsp;with&nbsp;RSA&nbsp;private&nbsp;key&#34;</span><span class="op" id="7124976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7124979">}</span><br>
<span class="lineno"></span><span class="op" id="7124981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="7124984">func</span>&nbsp;<span class="ident" id="7124989">newLocalListener</span><span class="op" id="7125005">(</span><span class="ident" id="7125006">t</span>&nbsp;<span class="op" id="7125008">*</span><span class="ident" id="7125009">testing</span><span class="op" id="7125016">.</span><span class="ident" id="7125017">T</span><span class="op" id="7125018">)</span>&nbsp;<span class="ident" id="7125020">net</span><span class="op" id="7125023">.</span><span class="ident" id="7125024">Listener</span>&nbsp;<span class="op" id="7125033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7125036">ln</span><span class="op" id="7125038">,</span>&nbsp;<span class="ident" id="7125040">err</span>&nbsp;<span class="op" id="7125044">:=</span>&nbsp;<span class="ident" id="7125047">net</span><span class="op" id="7125050">.</span><span class="ident" id="7125051">Listen</span><span class="op" id="7125057">(</span><span class="string" id="7125058">&#34;tcp&#34;</span><span class="op" id="7125063">,</span>&nbsp;<span class="string" id="7125065">&#34;127.0.0.1:0&#34;</span><span class="op" id="7125078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7125081">if</span>&nbsp;<span class="ident" id="7125084">err</span>&nbsp;<span class="op" id="7125088">!=</span>&nbsp;<span class="builtintype" id="7125091">nil</span>&nbsp;<span class="op" id="7125095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7125099">ln</span><span class="op" id="7125101">,</span>&nbsp;<span class="ident" id="7125103">err</span>&nbsp;<span class="op" id="7125107">=</span>&nbsp;<span class="ident" id="7125109">net</span><span class="op" id="7125112">.</span><span class="ident" id="7125113">Listen</span><span class="op" id="7125119">(</span><span class="string" id="7125120">&#34;tcp6&#34;</span><span class="op" id="7125126">,</span>&nbsp;<span class="string" id="7125128">&#34;[::1]:0&#34;</span><span class="op" id="7125137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7125140">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7125143">if</span>&nbsp;<span class="ident" id="7125146">err</span>&nbsp;<span class="op" id="7125150">!=</span>&nbsp;<span class="builtintype" id="7125153">nil</span>&nbsp;<span class="op" id="7125157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7125161">t</span><span class="op" id="7125162">.</span><span class="ident" id="7125163">Fatal</span><span class="op" id="7125168">(</span><span class="ident" id="7125169">err</span><span class="op" id="7125172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7125175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7125178">return</span>&nbsp;<span class="ident" id="7125185">ln</span><br>
<span class="lineno"></span><span class="op" id="7125188">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="7125191">func</span>&nbsp;<span class="ident" id="7125196">TestDialTimeout</span><span class="op" id="7125211">(</span><span class="ident" id="7125212">t</span>&nbsp;<span class="op" id="7125214">*</span><span class="ident" id="7125215">testing</span><span class="op" id="7125222">.</span><span class="ident" id="7125223">T</span><span class="op" id="7125224">)</span>&nbsp;<span class="op" id="7125226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7125229">if</span>&nbsp;<span class="ident" id="7125232">testing</span><span class="op" id="7125239">.</span><span class="ident" id="7125240">Short</span><span class="op" id="7125245">(</span><span class="op" id="7125246">)</span>&nbsp;<span class="op" id="7125248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7125252">t</span><span class="op" id="7125253">.</span><span class="ident" id="7125254">Skip</span><span class="op" id="7125258">(</span><span class="string" id="7125259">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7125283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7125286">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7125289">listener</span>&nbsp;<span class="op" id="7125298">:=</span>&nbsp;<span class="ident" id="7125301">newLocalListener</span><span class="op" id="7125317">(</span><span class="ident" id="7125318">t</span><span class="op" id="7125319">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7125323">addr</span>&nbsp;<span class="op" id="7125328">:=</span>&nbsp;<span class="ident" id="7125331">listener</span><span class="op" id="7125339">.</span><span class="ident" id="7125340">Addr</span><span class="op" id="7125344">(</span><span class="op" id="7125345">)</span><span class="op" id="7125346">.</span><span class="ident" id="7125347">String</span><span class="op" id="7125353">(</span><span class="op" id="7125354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7125357">defer</span>&nbsp;<span class="ident" id="7125363">listener</span><span class="op" id="7125371">.</span><span class="ident" id="7125372">Close</span><span class="op" id="7125377">(</span><span class="op" id="7125378">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7125382">complete</span>&nbsp;<span class="op" id="7125391">:=</span>&nbsp;<span class="builtinfunc" id="7125394">make</span><span class="op" id="7125398">(</span><span class="keyword" id="7125399">chan</span>&nbsp;<span class="builtintype" id="7125404">bool</span><span class="op" id="7125408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7125411">defer</span>&nbsp;<span class="builtinfunc" id="7125417">close</span><span class="op" id="7125422">(</span><span class="ident" id="7125423">complete</span><span class="op" id="7125431">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7125435">go</span>&nbsp;<span class="keyword" id="7125438">func</span><span class="op" id="7125442">(</span><span class="op" id="7125443">)</span>&nbsp;<span class="op" id="7125445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7125449">conn</span><span class="op" id="7125453">,</span>&nbsp;<span class="ident" id="7125455">err</span>&nbsp;<span class="op" id="7125459">:=</span>&nbsp;<span class="ident" id="7125462">listener</span><span class="op" id="7125470">.</span><span class="ident" id="7125471">Accept</span><span class="op" id="7125477">(</span><span class="op" id="7125478">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7125482">if</span>&nbsp;<span class="ident" id="7125485">err</span>&nbsp;<span class="op" id="7125489">!=</span>&nbsp;<span class="builtintype" id="7125492">nil</span>&nbsp;<span class="op" id="7125496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7125501">t</span><span class="op" id="7125502">.</span><span class="ident" id="7125503">Error</span><span class="op" id="7125508">(</span><span class="ident" id="7125509">err</span><span class="op" id="7125512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7125517">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7125526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7125530">&lt;-</span><span class="ident" id="7125532">complete</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7125543">conn</span><span class="op" id="7125547">.</span><span class="ident" id="7125548">Close</span><span class="op" id="7125553">(</span><span class="op" id="7125554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7125557">}</span><span class="op" id="7125558">(</span><span class="op" id="7125559">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7125563">dialer</span>&nbsp;<span class="op" id="7125570">:=</span>&nbsp;<span class="op" id="7125573">&amp;</span><span class="ident" id="7125574">net</span><span class="op" id="7125577">.</span><span class="ident" id="7125578">Dialer</span><span class="op" id="7125584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7125588">Timeout</span><span class="op" id="7125595">:</span>&nbsp;<span class="num" id="7125597">10</span>&nbsp;<span class="op" id="7125600">*</span>&nbsp;<span class="ident" id="7125602">time</span><span class="op" id="7125606">.</span><span class="ident" id="7125607">Millisecond</span><span class="op" id="7125618">,</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7125621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7125625">var</span>&nbsp;<span class="ident" id="7125629">err</span>&nbsp;<span class="builtintype" id="7125633">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7125640">if</span>&nbsp;<span class="ident" id="7125643">_</span><span class="op" id="7125644">,</span>&nbsp;<span class="ident" id="7125646">err</span>&nbsp;<span class="op" id="7125650">=</span>&nbsp;<span class="ident" id="7125652">DialWithDialer</span><span class="op" id="7125666">(</span><span class="ident" id="7125667">dialer</span><span class="op" id="7125673">,</span>&nbsp;<span class="string" id="7125675">&#34;tcp&#34;</span><span class="op" id="7125680">,</span>&nbsp;<span class="ident" id="7125682">addr</span><span class="op" id="7125686">,</span>&nbsp;<span class="builtintype" id="7125688">nil</span><span class="op" id="7125691">)</span><span class="op" id="7125692">;</span>&nbsp;<span class="ident" id="7125694">err</span>&nbsp;<span class="op" id="7125698">==</span>&nbsp;<span class="builtintype" id="7125701">nil</span>&nbsp;<span class="op" id="7125705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7125709">t</span><span class="op" id="7125710">.</span><span class="ident" id="7125711">Fatal</span><span class="op" id="7125716">(</span><span class="string" id="7125717">&#34;DialWithTimeout&nbsp;completed&nbsp;successfully&#34;</span><span class="op" id="7125757">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7125760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7125764">if</span>&nbsp;<span class="op" id="7125767">!</span><span class="ident" id="7125768">strings</span><span class="op" id="7125775">.</span><span class="ident" id="7125776">Contains</span><span class="op" id="7125784">(</span><span class="ident" id="7125785">err</span><span class="op" id="7125788">.</span><span class="ident" id="7125789">Error</span><span class="op" id="7125794">(</span><span class="op" id="7125795">)</span><span class="op" id="7125796">,</span>&nbsp;<span class="string" id="7125798">&#34;timed&nbsp;out&#34;</span><span class="op" id="7125809">)</span>&nbsp;<span class="op" id="7125811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7125815">t</span><span class="op" id="7125816">.</span><span class="ident" id="7125817">Errorf</span><span class="op" id="7125823">(</span><span class="string" id="7125824">&#34;resulting&nbsp;error&nbsp;not&nbsp;a&nbsp;timeout:&nbsp;%s&#34;</span><span class="op" id="7125859">,</span>&nbsp;<span class="ident" id="7125861">err</span><span class="op" id="7125864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7125867">}</span><br>
<span class="lineno">160</span><span class="op" id="7125869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7125872">//&nbsp;tests&nbsp;that&nbsp;Conn.Read&nbsp;returns&nbsp;(non-zero,&nbsp;io.EOF)&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="7125934">//&nbsp;(non-zero,&nbsp;nil)&nbsp;when&nbsp;a&nbsp;Close&nbsp;(alertCloseNotify)&nbsp;is&nbsp;sitting&nbsp;right</span><br>
<span class="lineno"></span><span class="comment" id="7126002">//&nbsp;behind&nbsp;the&nbsp;application&nbsp;data&nbsp;in&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">165</span><span class="keyword" id="7126048">func</span>&nbsp;<span class="ident" id="7126053">TestConnReadNonzeroAndEOF</span><span class="op" id="7126078">(</span><span class="ident" id="7126079">t</span>&nbsp;<span class="op" id="7126081">*</span><span class="ident" id="7126082">testing</span><span class="op" id="7126089">.</span><span class="ident" id="7126090">T</span><span class="op" id="7126091">)</span>&nbsp;<span class="op" id="7126093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7126096">//&nbsp;This&nbsp;test&nbsp;is&nbsp;racy:&nbsp;it&nbsp;assumes&nbsp;that&nbsp;after&nbsp;a&nbsp;write&nbsp;to&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7126154">//&nbsp;localhost&nbsp;TCP&nbsp;connection,&nbsp;the&nbsp;peer&nbsp;TCP&nbsp;connection&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7126212">//&nbsp;immediately&nbsp;read&nbsp;it.&nbsp;&nbsp;Because&nbsp;it&#39;s&nbsp;racy,&nbsp;we&nbsp;skip&nbsp;this&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7126275">//&nbsp;in&nbsp;short&nbsp;mode,&nbsp;and&nbsp;then&nbsp;retry&nbsp;it&nbsp;several&nbsp;times&nbsp;with&nbsp;an</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7126334">//&nbsp;increasing&nbsp;sleep&nbsp;in&nbsp;between&nbsp;our&nbsp;final&nbsp;write&nbsp;(via&nbsp;srv.Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7126397">//&nbsp;below)&nbsp;and&nbsp;the&nbsp;following&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7126432">if</span>&nbsp;<span class="ident" id="7126435">testing</span><span class="op" id="7126442">.</span><span class="ident" id="7126443">Short</span><span class="op" id="7126448">(</span><span class="op" id="7126449">)</span>&nbsp;<span class="op" id="7126451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7126455">t</span><span class="op" id="7126456">.</span><span class="ident" id="7126457">Skip</span><span class="op" id="7126461">(</span><span class="string" id="7126462">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7126486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7126489">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7126492">var</span>&nbsp;<span class="ident" id="7126496">err</span>&nbsp;<span class="builtintype" id="7126500">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7126507">for</span>&nbsp;<span class="ident" id="7126511">delay</span>&nbsp;<span class="op" id="7126517">:=</span>&nbsp;<span class="ident" id="7126520">time</span><span class="op" id="7126524">.</span><span class="ident" id="7126525">Millisecond</span><span class="op" id="7126536">;</span>&nbsp;<span class="ident" id="7126538">delay</span>&nbsp;<span class="op" id="7126544">&lt;=</span>&nbsp;<span class="num" id="7126547">64</span><span class="op" id="7126549">*</span><span class="ident" id="7126550">time</span><span class="op" id="7126554">.</span><span class="ident" id="7126555">Millisecond</span><span class="op" id="7126566">;</span>&nbsp;<span class="ident" id="7126568">delay</span>&nbsp;<span class="op" id="7126574">*=</span>&nbsp;<span class="num" id="7126577">2</span>&nbsp;<span class="op" id="7126579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7126583">if</span>&nbsp;<span class="ident" id="7126586">err</span>&nbsp;<span class="op" id="7126590">=</span>&nbsp;<span class="ident" id="7126592">testConnReadNonzeroAndEOF</span><span class="op" id="7126617">(</span><span class="ident" id="7126618">t</span><span class="op" id="7126619">,</span>&nbsp;<span class="ident" id="7126621">delay</span><span class="op" id="7126626">)</span><span class="op" id="7126627">;</span>&nbsp;<span class="ident" id="7126629">err</span>&nbsp;<span class="op" id="7126633">==</span>&nbsp;<span class="builtintype" id="7126636">nil</span>&nbsp;<span class="op" id="7126640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7126645">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7126654">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7126657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7126660">t</span><span class="op" id="7126661">.</span><span class="ident" id="7126662">Error</span><span class="op" id="7126667">(</span><span class="ident" id="7126668">err</span><span class="op" id="7126671">)</span><br>
<span class="lineno"></span><span class="op" id="7126673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7126676">func</span>&nbsp;<span class="ident" id="7126681">testConnReadNonzeroAndEOF</span><span class="op" id="7126706">(</span><span class="ident" id="7126707">t</span>&nbsp;<span class="op" id="7126709">*</span><span class="ident" id="7126710">testing</span><span class="op" id="7126717">.</span><span class="ident" id="7126718">T</span><span class="op" id="7126719">,</span>&nbsp;<span class="ident" id="7126721">delay</span>&nbsp;<span class="ident" id="7126727">time</span><span class="op" id="7126731">.</span><span class="ident" id="7126732">Duration</span><span class="op" id="7126740">)</span>&nbsp;<span class="builtintype" id="7126742">error</span>&nbsp;<span class="op" id="7126748">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7126751">ln</span>&nbsp;<span class="op" id="7126754">:=</span>&nbsp;<span class="ident" id="7126757">newLocalListener</span><span class="op" id="7126773">(</span><span class="ident" id="7126774">t</span><span class="op" id="7126775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7126778">defer</span>&nbsp;<span class="ident" id="7126784">ln</span><span class="op" id="7126786">.</span><span class="ident" id="7126787">Close</span><span class="op" id="7126792">(</span><span class="op" id="7126793">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7126797">srvCh</span>&nbsp;<span class="op" id="7126803">:=</span>&nbsp;<span class="builtinfunc" id="7126806">make</span><span class="op" id="7126810">(</span><span class="keyword" id="7126811">chan</span>&nbsp;<span class="op" id="7126816">*</span><span class="ident" id="7126817">Conn</span><span class="op" id="7126821">,</span>&nbsp;<span class="num" id="7126823">1</span><span class="op" id="7126824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7126827">var</span>&nbsp;<span class="ident" id="7126831">serr</span>&nbsp;<span class="builtintype" id="7126836">error</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7126843">go</span>&nbsp;<span class="keyword" id="7126846">func</span><span class="op" id="7126850">(</span><span class="op" id="7126851">)</span>&nbsp;<span class="op" id="7126853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7126857">sconn</span><span class="op" id="7126862">,</span>&nbsp;<span class="ident" id="7126864">err</span>&nbsp;<span class="op" id="7126868">:=</span>&nbsp;<span class="ident" id="7126871">ln</span><span class="op" id="7126873">.</span><span class="ident" id="7126874">Accept</span><span class="op" id="7126880">(</span><span class="op" id="7126881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7126885">if</span>&nbsp;<span class="ident" id="7126888">err</span>&nbsp;<span class="op" id="7126892">!=</span>&nbsp;<span class="builtintype" id="7126895">nil</span>&nbsp;<span class="op" id="7126899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7126904">serr</span>&nbsp;<span class="op" id="7126909">=</span>&nbsp;<span class="ident" id="7126911">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7126918">srvCh</span>&nbsp;<span class="op" id="7126924">&lt;-</span>&nbsp;<span class="builtintype" id="7126927">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7126934">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7126943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7126947">serverConfig</span>&nbsp;<span class="op" id="7126960">:=</span>&nbsp;<span class="op" id="7126963">*</span><span class="ident" id="7126964">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7126977">srv</span>&nbsp;<span class="op" id="7126981">:=</span>&nbsp;<span class="ident" id="7126984">Server</span><span class="op" id="7126990">(</span><span class="ident" id="7126991">sconn</span><span class="op" id="7126996">,</span>&nbsp;<span class="op" id="7126998">&amp;</span><span class="ident" id="7126999">serverConfig</span><span class="op" id="7127011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7127015">if</span>&nbsp;<span class="ident" id="7127018">err</span>&nbsp;<span class="op" id="7127022">:=</span>&nbsp;<span class="ident" id="7127025">srv</span><span class="op" id="7127028">.</span><span class="ident" id="7127029">Handshake</span><span class="op" id="7127038">(</span><span class="op" id="7127039">)</span><span class="op" id="7127040">;</span>&nbsp;<span class="ident" id="7127042">err</span>&nbsp;<span class="op" id="7127046">!=</span>&nbsp;<span class="builtintype" id="7127049">nil</span>&nbsp;<span class="op" id="7127053">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7127058">serr</span>&nbsp;<span class="op" id="7127063">=</span>&nbsp;<span class="ident" id="7127065">fmt</span><span class="op" id="7127068">.</span><span class="ident" id="7127069">Errorf</span><span class="op" id="7127075">(</span><span class="string" id="7127076">&#34;handshake:&nbsp;%v&#34;</span><span class="op" id="7127091">,</span>&nbsp;<span class="ident" id="7127093">err</span><span class="op" id="7127096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7127101">srvCh</span>&nbsp;<span class="op" id="7127107">&lt;-</span>&nbsp;<span class="builtintype" id="7127110">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7127117">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7127126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7127130">srvCh</span>&nbsp;<span class="op" id="7127136">&lt;-</span>&nbsp;<span class="ident" id="7127139">srv</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7127144">}</span><span class="op" id="7127145">(</span><span class="op" id="7127146">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7127150">clientConfig</span>&nbsp;<span class="op" id="7127163">:=</span>&nbsp;<span class="op" id="7127166">*</span><span class="ident" id="7127167">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7127179">conn</span><span class="op" id="7127183">,</span>&nbsp;<span class="ident" id="7127185">err</span>&nbsp;<span class="op" id="7127189">:=</span>&nbsp;<span class="ident" id="7127192">Dial</span><span class="op" id="7127196">(</span><span class="string" id="7127197">&#34;tcp&#34;</span><span class="op" id="7127202">,</span>&nbsp;<span class="ident" id="7127204">ln</span><span class="op" id="7127206">.</span><span class="ident" id="7127207">Addr</span><span class="op" id="7127211">(</span><span class="op" id="7127212">)</span><span class="op" id="7127213">.</span><span class="ident" id="7127214">String</span><span class="op" id="7127220">(</span><span class="op" id="7127221">)</span><span class="op" id="7127222">,</span>&nbsp;<span class="op" id="7127224">&amp;</span><span class="ident" id="7127225">clientConfig</span><span class="op" id="7127237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7127240">if</span>&nbsp;<span class="ident" id="7127243">err</span>&nbsp;<span class="op" id="7127247">!=</span>&nbsp;<span class="builtintype" id="7127250">nil</span>&nbsp;<span class="op" id="7127254">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7127258">t</span><span class="op" id="7127259">.</span><span class="ident" id="7127260">Fatal</span><span class="op" id="7127265">(</span><span class="ident" id="7127266">err</span><span class="op" id="7127269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7127272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7127275">defer</span>&nbsp;<span class="ident" id="7127281">conn</span><span class="op" id="7127285">.</span><span class="ident" id="7127286">Close</span><span class="op" id="7127291">(</span><span class="op" id="7127292">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7127296">srv</span>&nbsp;<span class="op" id="7127300">:=</span>&nbsp;<span class="op" id="7127303">&lt;-</span><span class="ident" id="7127305">srvCh</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7127312">if</span>&nbsp;<span class="ident" id="7127315">srv</span>&nbsp;<span class="op" id="7127319">==</span>&nbsp;<span class="builtintype" id="7127322">nil</span>&nbsp;<span class="op" id="7127326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7127330">return</span>&nbsp;<span class="ident" id="7127337">serr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7127343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7127347">buf</span>&nbsp;<span class="op" id="7127351">:=</span>&nbsp;<span class="builtinfunc" id="7127354">make</span><span class="op" id="7127358">(</span><span class="op" id="7127359">[</span><span class="op" id="7127360">]</span><span class="builtintype" id="7127361">byte</span><span class="op" id="7127365">,</span>&nbsp;<span class="num" id="7127367">6</span><span class="op" id="7127368">)</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7127372">srv</span><span class="op" id="7127375">.</span><span class="ident" id="7127376">Write</span><span class="op" id="7127381">(</span><span class="op" id="7127382">[</span><span class="op" id="7127383">]</span><span class="builtintype" id="7127384">byte</span><span class="op" id="7127388">(</span><span class="string" id="7127389">&#34;foobar&#34;</span><span class="op" id="7127397">)</span><span class="op" id="7127398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7127401">n</span><span class="op" id="7127402">,</span>&nbsp;<span class="ident" id="7127404">err</span>&nbsp;<span class="op" id="7127408">:=</span>&nbsp;<span class="ident" id="7127411">conn</span><span class="op" id="7127415">.</span><span class="ident" id="7127416">Read</span><span class="op" id="7127420">(</span><span class="ident" id="7127421">buf</span><span class="op" id="7127424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7127427">if</span>&nbsp;<span class="ident" id="7127430">n</span>&nbsp;<span class="op" id="7127432">!=</span>&nbsp;<span class="num" id="7127435">6</span>&nbsp;<span class="op" id="7127437">||</span>&nbsp;<span class="ident" id="7127440">err</span>&nbsp;<span class="op" id="7127444">!=</span>&nbsp;<span class="builtintype" id="7127447">nil</span>&nbsp;<span class="op" id="7127451">||</span>&nbsp;<span class="builtintype" id="7127454">string</span><span class="op" id="7127460">(</span><span class="ident" id="7127461">buf</span><span class="op" id="7127464">)</span>&nbsp;<span class="op" id="7127466">!=</span>&nbsp;<span class="string" id="7127469">&#34;foobar&#34;</span>&nbsp;<span class="op" id="7127478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7127482">return</span>&nbsp;<span class="ident" id="7127489">fmt</span><span class="op" id="7127492">.</span><span class="ident" id="7127493">Errorf</span><span class="op" id="7127499">(</span><span class="string" id="7127500">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;data&nbsp;%q;&nbsp;want&nbsp;6,&nbsp;nil,&nbsp;foobar&#34;</span><span class="op" id="7127545">,</span>&nbsp;<span class="ident" id="7127547">n</span><span class="op" id="7127548">,</span>&nbsp;<span class="ident" id="7127550">err</span><span class="op" id="7127553">,</span>&nbsp;<span class="ident" id="7127555">buf</span><span class="op" id="7127558">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7127561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7127565">srv</span><span class="op" id="7127568">.</span><span class="ident" id="7127569">Write</span><span class="op" id="7127574">(</span><span class="op" id="7127575">[</span><span class="op" id="7127576">]</span><span class="builtintype" id="7127577">byte</span><span class="op" id="7127581">(</span><span class="string" id="7127582">&#34;abcdef&#34;</span><span class="op" id="7127590">)</span><span class="op" id="7127591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7127594">srv</span><span class="op" id="7127597">.</span><span class="ident" id="7127598">Close</span><span class="op" id="7127603">(</span><span class="op" id="7127604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7127607">time</span><span class="op" id="7127611">.</span><span class="ident" id="7127612">Sleep</span><span class="op" id="7127617">(</span><span class="ident" id="7127618">delay</span><span class="op" id="7127623">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7127626">n</span><span class="op" id="7127627">,</span>&nbsp;<span class="ident" id="7127629">err</span>&nbsp;<span class="op" id="7127633">=</span>&nbsp;<span class="ident" id="7127635">conn</span><span class="op" id="7127639">.</span><span class="ident" id="7127640">Read</span><span class="op" id="7127644">(</span><span class="ident" id="7127645">buf</span><span class="op" id="7127648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7127651">if</span>&nbsp;<span class="ident" id="7127654">n</span>&nbsp;<span class="op" id="7127656">!=</span>&nbsp;<span class="num" id="7127659">6</span>&nbsp;<span class="op" id="7127661">||</span>&nbsp;<span class="builtintype" id="7127664">string</span><span class="op" id="7127670">(</span><span class="ident" id="7127671">buf</span><span class="op" id="7127674">)</span>&nbsp;<span class="op" id="7127676">!=</span>&nbsp;<span class="string" id="7127679">&#34;abcdef&#34;</span>&nbsp;<span class="op" id="7127688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7127692">return</span>&nbsp;<span class="ident" id="7127699">fmt</span><span class="op" id="7127702">.</span><span class="ident" id="7127703">Errorf</span><span class="op" id="7127709">(</span><span class="string" id="7127710">&#34;Read&nbsp;=&nbsp;%d,&nbsp;buf=&nbsp;%q;&nbsp;want&nbsp;6,&nbsp;abcdef&#34;</span><span class="op" id="7127746">,</span>&nbsp;<span class="ident" id="7127748">n</span><span class="op" id="7127749">,</span>&nbsp;<span class="ident" id="7127751">buf</span><span class="op" id="7127754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7127757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7127760">if</span>&nbsp;<span class="ident" id="7127763">err</span>&nbsp;<span class="op" id="7127767">!=</span>&nbsp;<span class="ident" id="7127770">io</span><span class="op" id="7127772">.</span><span class="ident" id="7127773">EOF</span>&nbsp;<span class="op" id="7127777">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7127781">return</span>&nbsp;<span class="ident" id="7127788">fmt</span><span class="op" id="7127791">.</span><span class="ident" id="7127792">Errorf</span><span class="op" id="7127798">(</span><span class="string" id="7127799">&#34;Second&nbsp;Read&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="7127836">,</span>&nbsp;<span class="ident" id="7127838">err</span><span class="op" id="7127841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7127844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7127847">return</span>&nbsp;<span class="builtintype" id="7127854">nil</span><br>
<span class="lineno"></span><span class="op" id="7127858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="7127861">func</span>&nbsp;<span class="ident" id="7127866">TestTLSUniqueMatches</span><span class="op" id="7127886">(</span><span class="ident" id="7127887">t</span>&nbsp;<span class="op" id="7127889">*</span><span class="ident" id="7127890">testing</span><span class="op" id="7127897">.</span><span class="ident" id="7127898">T</span><span class="op" id="7127899">)</span>&nbsp;<span class="op" id="7127901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7127904">ln</span>&nbsp;<span class="op" id="7127907">:=</span>&nbsp;<span class="ident" id="7127910">newLocalListener</span><span class="op" id="7127926">(</span><span class="ident" id="7127927">t</span><span class="op" id="7127928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7127931">defer</span>&nbsp;<span class="ident" id="7127937">ln</span><span class="op" id="7127939">.</span><span class="ident" id="7127940">Close</span><span class="op" id="7127945">(</span><span class="op" id="7127946">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7127950">serverTLSUniques</span>&nbsp;<span class="op" id="7127967">:=</span>&nbsp;<span class="builtinfunc" id="7127970">make</span><span class="op" id="7127974">(</span><span class="keyword" id="7127975">chan</span>&nbsp;<span class="op" id="7127980">[</span><span class="op" id="7127981">]</span><span class="builtintype" id="7127982">byte</span><span class="op" id="7127986">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7127989">go</span>&nbsp;<span class="keyword" id="7127992">func</span><span class="op" id="7127996">(</span><span class="op" id="7127997">)</span>&nbsp;<span class="op" id="7127999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7128003">for</span>&nbsp;<span class="ident" id="7128007">i</span>&nbsp;<span class="op" id="7128009">:=</span>&nbsp;<span class="num" id="7128012">0</span><span class="op" id="7128013">;</span>&nbsp;<span class="ident" id="7128015">i</span>&nbsp;<span class="op" id="7128017">&lt;</span>&nbsp;<span class="num" id="7128019">2</span><span class="op" id="7128020">;</span>&nbsp;<span class="ident" id="7128022">i</span><span class="op" id="7128023">++</span>&nbsp;<span class="op" id="7128026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7128031">sconn</span><span class="op" id="7128036">,</span>&nbsp;<span class="ident" id="7128038">err</span>&nbsp;<span class="op" id="7128042">:=</span>&nbsp;<span class="ident" id="7128045">ln</span><span class="op" id="7128047">.</span><span class="ident" id="7128048">Accept</span><span class="op" id="7128054">(</span><span class="op" id="7128055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7128060">if</span>&nbsp;<span class="ident" id="7128063">err</span>&nbsp;<span class="op" id="7128067">!=</span>&nbsp;<span class="builtintype" id="7128070">nil</span>&nbsp;<span class="op" id="7128074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7128080">t</span><span class="op" id="7128081">.</span><span class="ident" id="7128082">Fatal</span><span class="op" id="7128087">(</span><span class="ident" id="7128088">err</span><span class="op" id="7128091">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7128096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7128101">serverConfig</span>&nbsp;<span class="op" id="7128114">:=</span>&nbsp;<span class="op" id="7128117">*</span><span class="ident" id="7128118">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7128132">srv</span>&nbsp;<span class="op" id="7128136">:=</span>&nbsp;<span class="ident" id="7128139">Server</span><span class="op" id="7128145">(</span><span class="ident" id="7128146">sconn</span><span class="op" id="7128151">,</span>&nbsp;<span class="op" id="7128153">&amp;</span><span class="ident" id="7128154">serverConfig</span><span class="op" id="7128166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7128171">if</span>&nbsp;<span class="ident" id="7128174">err</span>&nbsp;<span class="op" id="7128178">:=</span>&nbsp;<span class="ident" id="7128181">srv</span><span class="op" id="7128184">.</span><span class="ident" id="7128185">Handshake</span><span class="op" id="7128194">(</span><span class="op" id="7128195">)</span><span class="op" id="7128196">;</span>&nbsp;<span class="ident" id="7128198">err</span>&nbsp;<span class="op" id="7128202">!=</span>&nbsp;<span class="builtintype" id="7128205">nil</span>&nbsp;<span class="op" id="7128209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7128215">t</span><span class="op" id="7128216">.</span><span class="ident" id="7128217">Fatal</span><span class="op" id="7128222">(</span><span class="ident" id="7128223">err</span><span class="op" id="7128226">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7128231">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7128236">serverTLSUniques</span>&nbsp;<span class="op" id="7128253">&lt;-</span>&nbsp;<span class="ident" id="7128256">srv</span><span class="op" id="7128259">.</span><span class="ident" id="7128260">ConnectionState</span><span class="op" id="7128275">(</span><span class="op" id="7128276">)</span><span class="op" id="7128277">.</span><span class="ident" id="7128278">TLSUnique</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7128290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7128293">}</span><span class="op" id="7128294">(</span><span class="op" id="7128295">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7128299">clientConfig</span>&nbsp;<span class="op" id="7128312">:=</span>&nbsp;<span class="op" id="7128315">*</span><span class="ident" id="7128316">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7128328">clientConfig</span><span class="op" id="7128340">.</span><span class="ident" id="7128341">ClientSessionCache</span>&nbsp;<span class="op" id="7128360">=</span>&nbsp;<span class="ident" id="7128362">NewLRUClientSessionCache</span><span class="op" id="7128386">(</span><span class="num" id="7128387">1</span><span class="op" id="7128388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7128391">conn</span><span class="op" id="7128395">,</span>&nbsp;<span class="ident" id="7128397">err</span>&nbsp;<span class="op" id="7128401">:=</span>&nbsp;<span class="ident" id="7128404">Dial</span><span class="op" id="7128408">(</span><span class="string" id="7128409">&#34;tcp&#34;</span><span class="op" id="7128414">,</span>&nbsp;<span class="ident" id="7128416">ln</span><span class="op" id="7128418">.</span><span class="ident" id="7128419">Addr</span><span class="op" id="7128423">(</span><span class="op" id="7128424">)</span><span class="op" id="7128425">.</span><span class="ident" id="7128426">String</span><span class="op" id="7128432">(</span><span class="op" id="7128433">)</span><span class="op" id="7128434">,</span>&nbsp;<span class="op" id="7128436">&amp;</span><span class="ident" id="7128437">clientConfig</span><span class="op" id="7128449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7128452">if</span>&nbsp;<span class="ident" id="7128455">err</span>&nbsp;<span class="op" id="7128459">!=</span>&nbsp;<span class="builtintype" id="7128462">nil</span>&nbsp;<span class="op" id="7128466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7128470">t</span><span class="op" id="7128471">.</span><span class="ident" id="7128472">Fatal</span><span class="op" id="7128477">(</span><span class="ident" id="7128478">err</span><span class="op" id="7128481">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7128484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7128487">if</span>&nbsp;<span class="op" id="7128490">!</span><span class="ident" id="7128491">bytes</span><span class="op" id="7128496">.</span><span class="ident" id="7128497">Equal</span><span class="op" id="7128502">(</span><span class="ident" id="7128503">conn</span><span class="op" id="7128507">.</span><span class="ident" id="7128508">ConnectionState</span><span class="op" id="7128523">(</span><span class="op" id="7128524">)</span><span class="op" id="7128525">.</span><span class="ident" id="7128526">TLSUnique</span><span class="op" id="7128535">,</span>&nbsp;<span class="op" id="7128537">&lt;-</span><span class="ident" id="7128539">serverTLSUniques</span><span class="op" id="7128555">)</span>&nbsp;<span class="op" id="7128557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7128561">t</span><span class="op" id="7128562">.</span><span class="ident" id="7128563">Error</span><span class="op" id="7128568">(</span><span class="string" id="7128569">&#34;client&nbsp;and&nbsp;server&nbsp;channel&nbsp;bindings&nbsp;differ&#34;</span><span class="op" id="7128612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7128615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7128618">conn</span><span class="op" id="7128622">.</span><span class="ident" id="7128623">Close</span><span class="op" id="7128628">(</span><span class="op" id="7128629">)</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7128633">conn</span><span class="op" id="7128637">,</span>&nbsp;<span class="ident" id="7128639">err</span>&nbsp;<span class="op" id="7128643">=</span>&nbsp;<span class="ident" id="7128645">Dial</span><span class="op" id="7128649">(</span><span class="string" id="7128650">&#34;tcp&#34;</span><span class="op" id="7128655">,</span>&nbsp;<span class="ident" id="7128657">ln</span><span class="op" id="7128659">.</span><span class="ident" id="7128660">Addr</span><span class="op" id="7128664">(</span><span class="op" id="7128665">)</span><span class="op" id="7128666">.</span><span class="ident" id="7128667">String</span><span class="op" id="7128673">(</span><span class="op" id="7128674">)</span><span class="op" id="7128675">,</span>&nbsp;<span class="op" id="7128677">&amp;</span><span class="ident" id="7128678">clientConfig</span><span class="op" id="7128690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7128693">if</span>&nbsp;<span class="ident" id="7128696">err</span>&nbsp;<span class="op" id="7128700">!=</span>&nbsp;<span class="builtintype" id="7128703">nil</span>&nbsp;<span class="op" id="7128707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7128711">t</span><span class="op" id="7128712">.</span><span class="ident" id="7128713">Fatal</span><span class="op" id="7128718">(</span><span class="ident" id="7128719">err</span><span class="op" id="7128722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7128725">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7128728">defer</span>&nbsp;<span class="ident" id="7128734">conn</span><span class="op" id="7128738">.</span><span class="ident" id="7128739">Close</span><span class="op" id="7128744">(</span><span class="op" id="7128745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7128748">if</span>&nbsp;<span class="op" id="7128751">!</span><span class="ident" id="7128752">conn</span><span class="op" id="7128756">.</span><span class="ident" id="7128757">ConnectionState</span><span class="op" id="7128772">(</span><span class="op" id="7128773">)</span><span class="op" id="7128774">.</span><span class="ident" id="7128775">DidResume</span>&nbsp;<span class="op" id="7128785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7128789">t</span><span class="op" id="7128790">.</span><span class="ident" id="7128791">Error</span><span class="op" id="7128796">(</span><span class="string" id="7128797">&#34;second&nbsp;session&nbsp;did&nbsp;not&nbsp;use&nbsp;resumption&#34;</span><span class="op" id="7128836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7128839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7128842">if</span>&nbsp;<span class="op" id="7128845">!</span><span class="ident" id="7128846">bytes</span><span class="op" id="7128851">.</span><span class="ident" id="7128852">Equal</span><span class="op" id="7128857">(</span><span class="ident" id="7128858">conn</span><span class="op" id="7128862">.</span><span class="ident" id="7128863">ConnectionState</span><span class="op" id="7128878">(</span><span class="op" id="7128879">)</span><span class="op" id="7128880">.</span><span class="ident" id="7128881">TLSUnique</span><span class="op" id="7128890">,</span>&nbsp;<span class="op" id="7128892">&lt;-</span><span class="ident" id="7128894">serverTLSUniques</span><span class="op" id="7128910">)</span>&nbsp;<span class="op" id="7128912">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7128916">t</span><span class="op" id="7128917">.</span><span class="ident" id="7128918">Error</span><span class="op" id="7128923">(</span><span class="string" id="7128924">&#34;client&nbsp;and&nbsp;server&nbsp;channel&nbsp;bindings&nbsp;differ&nbsp;when&nbsp;session&nbsp;resumption&nbsp;is&nbsp;used&#34;</span><span class="op" id="7128999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7129002">}</span><br>
<span class="lineno"></span><span class="op" id="7129004">}</span>
</div>
</body>
</html>
