<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7520633">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7520688">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7520742">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7520793">package</span>&nbsp;<span class="ident" id="7520801">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7520806">import</span>&nbsp;<span class="op" id="7520813">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7520816">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7520824">&#34;io&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7520830">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7520836">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7520847">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7520858">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7520865">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="7520868">func</span>&nbsp;<span class="ident" id="7520873">skipServerTest</span><span class="op" id="7520887">(</span><span class="ident" id="7520888">net</span><span class="op" id="7520891">,</span>&nbsp;<span class="ident" id="7520893">unixsotype</span><span class="op" id="7520903">,</span>&nbsp;<span class="ident" id="7520905">addr</span>&nbsp;<span class="builtintype" id="7520910">string</span><span class="op" id="7520916">,</span>&nbsp;<span class="ident" id="7520918">ipv6</span><span class="op" id="7520922">,</span>&nbsp;<span class="ident" id="7520924">ipv4map</span><span class="op" id="7520931">,</span>&nbsp;<span class="ident" id="7520933">linuxOnly</span>&nbsp;<span class="builtintype" id="7520943">bool</span><span class="op" id="7520947">)</span>&nbsp;<span class="builtintype" id="7520949">bool</span>&nbsp;<span class="op" id="7520954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7520957">switch</span>&nbsp;<span class="ident" id="7520964">runtime</span><span class="op" id="7520971">.</span><span class="ident" id="7520972">GOOS</span>&nbsp;<span class="op" id="7520977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7520980">case</span>&nbsp;<span class="string" id="7520985">&#34;linux&#34;</span><span class="op" id="7520992">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7520995">case</span>&nbsp;<span class="string" id="7521000">&#34;nacl&#34;</span><span class="op" id="7521006">,</span>&nbsp;<span class="string" id="7521008">&#34;plan9&#34;</span><span class="op" id="7521015">,</span>&nbsp;<span class="string" id="7521017">&#34;windows&#34;</span><span class="op" id="7521026">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7521030">//&nbsp;&#34;unix&#34;&nbsp;sockets&nbsp;are&nbsp;not&nbsp;supported&nbsp;on&nbsp;Windows&nbsp;and&nbsp;Plan&nbsp;9.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521091">if</span>&nbsp;<span class="ident" id="7521094">net</span>&nbsp;<span class="op" id="7521098">==</span>&nbsp;<span class="ident" id="7521101">unixsotype</span>&nbsp;<span class="op" id="7521112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521117">return</span>&nbsp;<span class="ident" id="7521124">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7521131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521134">default</span><span class="op" id="7521141">:</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521145">if</span>&nbsp;<span class="ident" id="7521148">net</span>&nbsp;<span class="op" id="7521152">==</span>&nbsp;<span class="ident" id="7521155">unixsotype</span>&nbsp;<span class="op" id="7521166">&amp;&amp;</span>&nbsp;<span class="ident" id="7521169">linuxOnly</span>&nbsp;<span class="op" id="7521179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521184">return</span>&nbsp;<span class="ident" id="7521191">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7521198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7521201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521204">switch</span>&nbsp;<span class="ident" id="7521211">addr</span>&nbsp;<span class="op" id="7521216">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521219">case</span>&nbsp;<span class="string" id="7521224">&#34;&#34;</span><span class="op" id="7521226">,</span>&nbsp;<span class="string" id="7521228">&#34;0.0.0.0&#34;</span><span class="op" id="7521237">,</span>&nbsp;<span class="string" id="7521239">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7521257">,</span>&nbsp;<span class="string" id="7521259">&#34;[::]&#34;</span><span class="op" id="7521265">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521269">if</span>&nbsp;<span class="ident" id="7521272">testing</span><span class="op" id="7521279">.</span><span class="ident" id="7521280">Short</span><span class="op" id="7521285">(</span><span class="op" id="7521286">)</span>&nbsp;<span class="op" id="7521288">||</span>&nbsp;<span class="op" id="7521291">!</span><span class="op" id="7521292">*</span><span class="ident" id="7521293">testExternal</span>&nbsp;<span class="op" id="7521306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521311">return</span>&nbsp;<span class="ident" id="7521318">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7521325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7521328">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521331">if</span>&nbsp;<span class="ident" id="7521334">ipv6</span>&nbsp;<span class="op" id="7521339">&amp;&amp;</span>&nbsp;<span class="op" id="7521342">!</span><span class="ident" id="7521343">supportsIPv6</span>&nbsp;<span class="op" id="7521356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521360">return</span>&nbsp;<span class="ident" id="7521367">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7521373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521376">if</span>&nbsp;<span class="ident" id="7521379">ipv4map</span>&nbsp;<span class="op" id="7521387">&amp;&amp;</span>&nbsp;<span class="op" id="7521390">!</span><span class="ident" id="7521391">supportsIPv4map</span>&nbsp;<span class="op" id="7521407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521411">return</span>&nbsp;<span class="ident" id="7521418">true</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7521424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7521427">return</span>&nbsp;<span class="ident" id="7521434">false</span><br>
<span class="lineno"></span><span class="op" id="7521440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7521443">var</span>&nbsp;<span class="ident" id="7521447">streamConnServerTests</span>&nbsp;<span class="op" id="7521469">=</span>&nbsp;<span class="op" id="7521471">[</span><span class="op" id="7521472">]</span><span class="keyword" id="7521473">struct</span>&nbsp;<span class="op" id="7521480">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521483">snet</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7521493">string</span>&nbsp;<span class="comment" id="7521500">//&nbsp;server&nbsp;side</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521516">saddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7521526">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521534">cnet</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7521544">string</span>&nbsp;<span class="comment" id="7521551">//&nbsp;client&nbsp;side</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521567">caddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7521577">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521585">ipv6</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7521595">bool</span>&nbsp;<span class="comment" id="7521600">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521641">ipv4map</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7521651">bool</span>&nbsp;<span class="comment" id="7521656">//&nbsp;test&nbsp;with&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;functionality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521702">empty</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7521712">bool</span>&nbsp;<span class="comment" id="7521717">//&nbsp;test&nbsp;with&nbsp;empty&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7521742">linuxOnly</span>&nbsp;<span class="builtintype" id="7521752">bool</span>&nbsp;<span class="comment" id="7521757">//&nbsp;test&nbsp;with&nbsp;abstract&nbsp;unix&nbsp;domain&nbsp;socket,&nbsp;a&nbsp;Linux-ism</span><br>
<span class="lineno"></span><span class="op" id="7521811">}</span><span class="op" id="7521812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7521815">{</span><span class="ident" id="7521816">snet</span><span class="op" id="7521820">:</span>&nbsp;<span class="string" id="7521822">&#34;tcp&#34;</span><span class="op" id="7521827">,</span>&nbsp;<span class="ident" id="7521829">saddr</span><span class="op" id="7521834">:</span>&nbsp;<span class="string" id="7521836">&#34;&#34;</span><span class="op" id="7521838">,</span>&nbsp;<span class="ident" id="7521840">cnet</span><span class="op" id="7521844">:</span>&nbsp;<span class="string" id="7521846">&#34;tcp&#34;</span><span class="op" id="7521851">,</span>&nbsp;<span class="ident" id="7521853">caddr</span><span class="op" id="7521858">:</span>&nbsp;<span class="string" id="7521860">&#34;127.0.0.1&#34;</span><span class="op" id="7521871">}</span><span class="op" id="7521872">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7521875">{</span><span class="ident" id="7521876">snet</span><span class="op" id="7521880">:</span>&nbsp;<span class="string" id="7521882">&#34;tcp&#34;</span><span class="op" id="7521887">,</span>&nbsp;<span class="ident" id="7521889">saddr</span><span class="op" id="7521894">:</span>&nbsp;<span class="string" id="7521896">&#34;0.0.0.0&#34;</span><span class="op" id="7521905">,</span>&nbsp;<span class="ident" id="7521907">cnet</span><span class="op" id="7521911">:</span>&nbsp;<span class="string" id="7521913">&#34;tcp&#34;</span><span class="op" id="7521918">,</span>&nbsp;<span class="ident" id="7521920">caddr</span><span class="op" id="7521925">:</span>&nbsp;<span class="string" id="7521927">&#34;127.0.0.1&#34;</span><span class="op" id="7521938">}</span><span class="op" id="7521939">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7521942">{</span><span class="ident" id="7521943">snet</span><span class="op" id="7521947">:</span>&nbsp;<span class="string" id="7521949">&#34;tcp&#34;</span><span class="op" id="7521954">,</span>&nbsp;<span class="ident" id="7521956">saddr</span><span class="op" id="7521961">:</span>&nbsp;<span class="string" id="7521963">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7521981">,</span>&nbsp;<span class="ident" id="7521983">cnet</span><span class="op" id="7521987">:</span>&nbsp;<span class="string" id="7521989">&#34;tcp&#34;</span><span class="op" id="7521994">,</span>&nbsp;<span class="ident" id="7521996">caddr</span><span class="op" id="7522001">:</span>&nbsp;<span class="string" id="7522003">&#34;127.0.0.1&#34;</span><span class="op" id="7522014">}</span><span class="op" id="7522015">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522018">{</span><span class="ident" id="7522019">snet</span><span class="op" id="7522023">:</span>&nbsp;<span class="string" id="7522025">&#34;tcp&#34;</span><span class="op" id="7522030">,</span>&nbsp;<span class="ident" id="7522032">saddr</span><span class="op" id="7522037">:</span>&nbsp;<span class="string" id="7522039">&#34;[::]&#34;</span><span class="op" id="7522045">,</span>&nbsp;<span class="ident" id="7522047">cnet</span><span class="op" id="7522051">:</span>&nbsp;<span class="string" id="7522053">&#34;tcp&#34;</span><span class="op" id="7522058">,</span>&nbsp;<span class="ident" id="7522060">caddr</span><span class="op" id="7522065">:</span>&nbsp;<span class="string" id="7522067">&#34;[::1]&#34;</span><span class="op" id="7522074">,</span>&nbsp;<span class="ident" id="7522076">ipv6</span><span class="op" id="7522080">:</span>&nbsp;<span class="ident" id="7522082">true</span><span class="op" id="7522086">}</span><span class="op" id="7522087">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522091">{</span><span class="ident" id="7522092">snet</span><span class="op" id="7522096">:</span>&nbsp;<span class="string" id="7522098">&#34;tcp&#34;</span><span class="op" id="7522103">,</span>&nbsp;<span class="ident" id="7522105">saddr</span><span class="op" id="7522110">:</span>&nbsp;<span class="string" id="7522112">&#34;&#34;</span><span class="op" id="7522114">,</span>&nbsp;<span class="ident" id="7522116">cnet</span><span class="op" id="7522120">:</span>&nbsp;<span class="string" id="7522122">&#34;tcp&#34;</span><span class="op" id="7522127">,</span>&nbsp;<span class="ident" id="7522129">caddr</span><span class="op" id="7522134">:</span>&nbsp;<span class="string" id="7522136">&#34;[::1]&#34;</span><span class="op" id="7522143">,</span>&nbsp;<span class="ident" id="7522145">ipv4map</span><span class="op" id="7522152">:</span>&nbsp;<span class="ident" id="7522154">true</span><span class="op" id="7522158">}</span><span class="op" id="7522159">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522162">{</span><span class="ident" id="7522163">snet</span><span class="op" id="7522167">:</span>&nbsp;<span class="string" id="7522169">&#34;tcp&#34;</span><span class="op" id="7522174">,</span>&nbsp;<span class="ident" id="7522176">saddr</span><span class="op" id="7522181">:</span>&nbsp;<span class="string" id="7522183">&#34;0.0.0.0&#34;</span><span class="op" id="7522192">,</span>&nbsp;<span class="ident" id="7522194">cnet</span><span class="op" id="7522198">:</span>&nbsp;<span class="string" id="7522200">&#34;tcp&#34;</span><span class="op" id="7522205">,</span>&nbsp;<span class="ident" id="7522207">caddr</span><span class="op" id="7522212">:</span>&nbsp;<span class="string" id="7522214">&#34;[::1]&#34;</span><span class="op" id="7522221">,</span>&nbsp;<span class="ident" id="7522223">ipv4map</span><span class="op" id="7522230">:</span>&nbsp;<span class="ident" id="7522232">true</span><span class="op" id="7522236">}</span><span class="op" id="7522237">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522240">{</span><span class="ident" id="7522241">snet</span><span class="op" id="7522245">:</span>&nbsp;<span class="string" id="7522247">&#34;tcp&#34;</span><span class="op" id="7522252">,</span>&nbsp;<span class="ident" id="7522254">saddr</span><span class="op" id="7522259">:</span>&nbsp;<span class="string" id="7522261">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7522279">,</span>&nbsp;<span class="ident" id="7522281">cnet</span><span class="op" id="7522285">:</span>&nbsp;<span class="string" id="7522287">&#34;tcp&#34;</span><span class="op" id="7522292">,</span>&nbsp;<span class="ident" id="7522294">caddr</span><span class="op" id="7522299">:</span>&nbsp;<span class="string" id="7522301">&#34;[::1]&#34;</span><span class="op" id="7522308">,</span>&nbsp;<span class="ident" id="7522310">ipv4map</span><span class="op" id="7522317">:</span>&nbsp;<span class="ident" id="7522319">true</span><span class="op" id="7522323">}</span><span class="op" id="7522324">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522327">{</span><span class="ident" id="7522328">snet</span><span class="op" id="7522332">:</span>&nbsp;<span class="string" id="7522334">&#34;tcp&#34;</span><span class="op" id="7522339">,</span>&nbsp;<span class="ident" id="7522341">saddr</span><span class="op" id="7522346">:</span>&nbsp;<span class="string" id="7522348">&#34;[::]&#34;</span><span class="op" id="7522354">,</span>&nbsp;<span class="ident" id="7522356">cnet</span><span class="op" id="7522360">:</span>&nbsp;<span class="string" id="7522362">&#34;tcp&#34;</span><span class="op" id="7522367">,</span>&nbsp;<span class="ident" id="7522369">caddr</span><span class="op" id="7522374">:</span>&nbsp;<span class="string" id="7522376">&#34;127.0.0.1&#34;</span><span class="op" id="7522387">,</span>&nbsp;<span class="ident" id="7522389">ipv4map</span><span class="op" id="7522396">:</span>&nbsp;<span class="ident" id="7522398">true</span><span class="op" id="7522402">}</span><span class="op" id="7522403">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522407">{</span><span class="ident" id="7522408">snet</span><span class="op" id="7522412">:</span>&nbsp;<span class="string" id="7522414">&#34;tcp&#34;</span><span class="op" id="7522419">,</span>&nbsp;<span class="ident" id="7522421">saddr</span><span class="op" id="7522426">:</span>&nbsp;<span class="string" id="7522428">&#34;&#34;</span><span class="op" id="7522430">,</span>&nbsp;<span class="ident" id="7522432">cnet</span><span class="op" id="7522436">:</span>&nbsp;<span class="string" id="7522438">&#34;tcp4&#34;</span><span class="op" id="7522444">,</span>&nbsp;<span class="ident" id="7522446">caddr</span><span class="op" id="7522451">:</span>&nbsp;<span class="string" id="7522453">&#34;127.0.0.1&#34;</span><span class="op" id="7522464">}</span><span class="op" id="7522465">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522468">{</span><span class="ident" id="7522469">snet</span><span class="op" id="7522473">:</span>&nbsp;<span class="string" id="7522475">&#34;tcp&#34;</span><span class="op" id="7522480">,</span>&nbsp;<span class="ident" id="7522482">saddr</span><span class="op" id="7522487">:</span>&nbsp;<span class="string" id="7522489">&#34;0.0.0.0&#34;</span><span class="op" id="7522498">,</span>&nbsp;<span class="ident" id="7522500">cnet</span><span class="op" id="7522504">:</span>&nbsp;<span class="string" id="7522506">&#34;tcp4&#34;</span><span class="op" id="7522512">,</span>&nbsp;<span class="ident" id="7522514">caddr</span><span class="op" id="7522519">:</span>&nbsp;<span class="string" id="7522521">&#34;127.0.0.1&#34;</span><span class="op" id="7522532">}</span><span class="op" id="7522533">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522536">{</span><span class="ident" id="7522537">snet</span><span class="op" id="7522541">:</span>&nbsp;<span class="string" id="7522543">&#34;tcp&#34;</span><span class="op" id="7522548">,</span>&nbsp;<span class="ident" id="7522550">saddr</span><span class="op" id="7522555">:</span>&nbsp;<span class="string" id="7522557">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7522575">,</span>&nbsp;<span class="ident" id="7522577">cnet</span><span class="op" id="7522581">:</span>&nbsp;<span class="string" id="7522583">&#34;tcp4&#34;</span><span class="op" id="7522589">,</span>&nbsp;<span class="ident" id="7522591">caddr</span><span class="op" id="7522596">:</span>&nbsp;<span class="string" id="7522598">&#34;127.0.0.1&#34;</span><span class="op" id="7522609">}</span><span class="op" id="7522610">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522613">{</span><span class="ident" id="7522614">snet</span><span class="op" id="7522618">:</span>&nbsp;<span class="string" id="7522620">&#34;tcp&#34;</span><span class="op" id="7522625">,</span>&nbsp;<span class="ident" id="7522627">saddr</span><span class="op" id="7522632">:</span>&nbsp;<span class="string" id="7522634">&#34;[::]&#34;</span><span class="op" id="7522640">,</span>&nbsp;<span class="ident" id="7522642">cnet</span><span class="op" id="7522646">:</span>&nbsp;<span class="string" id="7522648">&#34;tcp6&#34;</span><span class="op" id="7522654">,</span>&nbsp;<span class="ident" id="7522656">caddr</span><span class="op" id="7522661">:</span>&nbsp;<span class="string" id="7522663">&#34;[::1]&#34;</span><span class="op" id="7522670">,</span>&nbsp;<span class="ident" id="7522672">ipv6</span><span class="op" id="7522676">:</span>&nbsp;<span class="ident" id="7522678">true</span><span class="op" id="7522682">}</span><span class="op" id="7522683">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522687">{</span><span class="ident" id="7522688">snet</span><span class="op" id="7522692">:</span>&nbsp;<span class="string" id="7522694">&#34;tcp&#34;</span><span class="op" id="7522699">,</span>&nbsp;<span class="ident" id="7522701">saddr</span><span class="op" id="7522706">:</span>&nbsp;<span class="string" id="7522708">&#34;&#34;</span><span class="op" id="7522710">,</span>&nbsp;<span class="ident" id="7522712">cnet</span><span class="op" id="7522716">:</span>&nbsp;<span class="string" id="7522718">&#34;tcp6&#34;</span><span class="op" id="7522724">,</span>&nbsp;<span class="ident" id="7522726">caddr</span><span class="op" id="7522731">:</span>&nbsp;<span class="string" id="7522733">&#34;[::1]&#34;</span><span class="op" id="7522740">,</span>&nbsp;<span class="ident" id="7522742">ipv4map</span><span class="op" id="7522749">:</span>&nbsp;<span class="ident" id="7522751">true</span><span class="op" id="7522755">}</span><span class="op" id="7522756">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522759">{</span><span class="ident" id="7522760">snet</span><span class="op" id="7522764">:</span>&nbsp;<span class="string" id="7522766">&#34;tcp&#34;</span><span class="op" id="7522771">,</span>&nbsp;<span class="ident" id="7522773">saddr</span><span class="op" id="7522778">:</span>&nbsp;<span class="string" id="7522780">&#34;0.0.0.0&#34;</span><span class="op" id="7522789">,</span>&nbsp;<span class="ident" id="7522791">cnet</span><span class="op" id="7522795">:</span>&nbsp;<span class="string" id="7522797">&#34;tcp6&#34;</span><span class="op" id="7522803">,</span>&nbsp;<span class="ident" id="7522805">caddr</span><span class="op" id="7522810">:</span>&nbsp;<span class="string" id="7522812">&#34;[::1]&#34;</span><span class="op" id="7522819">,</span>&nbsp;<span class="ident" id="7522821">ipv4map</span><span class="op" id="7522828">:</span>&nbsp;<span class="ident" id="7522830">true</span><span class="op" id="7522834">}</span><span class="op" id="7522835">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522838">{</span><span class="ident" id="7522839">snet</span><span class="op" id="7522843">:</span>&nbsp;<span class="string" id="7522845">&#34;tcp&#34;</span><span class="op" id="7522850">,</span>&nbsp;<span class="ident" id="7522852">saddr</span><span class="op" id="7522857">:</span>&nbsp;<span class="string" id="7522859">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7522877">,</span>&nbsp;<span class="ident" id="7522879">cnet</span><span class="op" id="7522883">:</span>&nbsp;<span class="string" id="7522885">&#34;tcp6&#34;</span><span class="op" id="7522891">,</span>&nbsp;<span class="ident" id="7522893">caddr</span><span class="op" id="7522898">:</span>&nbsp;<span class="string" id="7522900">&#34;[::1]&#34;</span><span class="op" id="7522907">,</span>&nbsp;<span class="ident" id="7522909">ipv4map</span><span class="op" id="7522916">:</span>&nbsp;<span class="ident" id="7522918">true</span><span class="op" id="7522922">}</span><span class="op" id="7522923">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7522926">{</span><span class="ident" id="7522927">snet</span><span class="op" id="7522931">:</span>&nbsp;<span class="string" id="7522933">&#34;tcp&#34;</span><span class="op" id="7522938">,</span>&nbsp;<span class="ident" id="7522940">saddr</span><span class="op" id="7522945">:</span>&nbsp;<span class="string" id="7522947">&#34;[::]&#34;</span><span class="op" id="7522953">,</span>&nbsp;<span class="ident" id="7522955">cnet</span><span class="op" id="7522959">:</span>&nbsp;<span class="string" id="7522961">&#34;tcp4&#34;</span><span class="op" id="7522967">,</span>&nbsp;<span class="ident" id="7522969">caddr</span><span class="op" id="7522974">:</span>&nbsp;<span class="string" id="7522976">&#34;127.0.0.1&#34;</span><span class="op" id="7522987">,</span>&nbsp;<span class="ident" id="7522989">ipv4map</span><span class="op" id="7522996">:</span>&nbsp;<span class="ident" id="7522998">true</span><span class="op" id="7523002">}</span><span class="op" id="7523003">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523007">{</span><span class="ident" id="7523008">snet</span><span class="op" id="7523012">:</span>&nbsp;<span class="string" id="7523014">&#34;tcp&#34;</span><span class="op" id="7523019">,</span>&nbsp;<span class="ident" id="7523021">saddr</span><span class="op" id="7523026">:</span>&nbsp;<span class="string" id="7523028">&#34;127.0.0.1&#34;</span><span class="op" id="7523039">,</span>&nbsp;<span class="ident" id="7523041">cnet</span><span class="op" id="7523045">:</span>&nbsp;<span class="string" id="7523047">&#34;tcp&#34;</span><span class="op" id="7523052">,</span>&nbsp;<span class="ident" id="7523054">caddr</span><span class="op" id="7523059">:</span>&nbsp;<span class="string" id="7523061">&#34;127.0.0.1&#34;</span><span class="op" id="7523072">}</span><span class="op" id="7523073">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523076">{</span><span class="ident" id="7523077">snet</span><span class="op" id="7523081">:</span>&nbsp;<span class="string" id="7523083">&#34;tcp&#34;</span><span class="op" id="7523088">,</span>&nbsp;<span class="ident" id="7523090">saddr</span><span class="op" id="7523095">:</span>&nbsp;<span class="string" id="7523097">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="7523117">,</span>&nbsp;<span class="ident" id="7523119">cnet</span><span class="op" id="7523123">:</span>&nbsp;<span class="string" id="7523125">&#34;tcp&#34;</span><span class="op" id="7523130">,</span>&nbsp;<span class="ident" id="7523132">caddr</span><span class="op" id="7523137">:</span>&nbsp;<span class="string" id="7523139">&#34;127.0.0.1&#34;</span><span class="op" id="7523150">}</span><span class="op" id="7523151">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523154">{</span><span class="ident" id="7523155">snet</span><span class="op" id="7523159">:</span>&nbsp;<span class="string" id="7523161">&#34;tcp&#34;</span><span class="op" id="7523166">,</span>&nbsp;<span class="ident" id="7523168">saddr</span><span class="op" id="7523173">:</span>&nbsp;<span class="string" id="7523175">&#34;[::1]&#34;</span><span class="op" id="7523182">,</span>&nbsp;<span class="ident" id="7523184">cnet</span><span class="op" id="7523188">:</span>&nbsp;<span class="string" id="7523190">&#34;tcp&#34;</span><span class="op" id="7523195">,</span>&nbsp;<span class="ident" id="7523197">caddr</span><span class="op" id="7523202">:</span>&nbsp;<span class="string" id="7523204">&#34;[::1]&#34;</span><span class="op" id="7523211">,</span>&nbsp;<span class="ident" id="7523213">ipv6</span><span class="op" id="7523217">:</span>&nbsp;<span class="ident" id="7523219">true</span><span class="op" id="7523223">}</span><span class="op" id="7523224">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523228">{</span><span class="ident" id="7523229">snet</span><span class="op" id="7523233">:</span>&nbsp;<span class="string" id="7523235">&#34;tcp4&#34;</span><span class="op" id="7523241">,</span>&nbsp;<span class="ident" id="7523243">saddr</span><span class="op" id="7523248">:</span>&nbsp;<span class="string" id="7523250">&#34;&#34;</span><span class="op" id="7523252">,</span>&nbsp;<span class="ident" id="7523254">cnet</span><span class="op" id="7523258">:</span>&nbsp;<span class="string" id="7523260">&#34;tcp4&#34;</span><span class="op" id="7523266">,</span>&nbsp;<span class="ident" id="7523268">caddr</span><span class="op" id="7523273">:</span>&nbsp;<span class="string" id="7523275">&#34;127.0.0.1&#34;</span><span class="op" id="7523286">}</span><span class="op" id="7523287">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523290">{</span><span class="ident" id="7523291">snet</span><span class="op" id="7523295">:</span>&nbsp;<span class="string" id="7523297">&#34;tcp4&#34;</span><span class="op" id="7523303">,</span>&nbsp;<span class="ident" id="7523305">saddr</span><span class="op" id="7523310">:</span>&nbsp;<span class="string" id="7523312">&#34;0.0.0.0&#34;</span><span class="op" id="7523321">,</span>&nbsp;<span class="ident" id="7523323">cnet</span><span class="op" id="7523327">:</span>&nbsp;<span class="string" id="7523329">&#34;tcp4&#34;</span><span class="op" id="7523335">,</span>&nbsp;<span class="ident" id="7523337">caddr</span><span class="op" id="7523342">:</span>&nbsp;<span class="string" id="7523344">&#34;127.0.0.1&#34;</span><span class="op" id="7523355">}</span><span class="op" id="7523356">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523359">{</span><span class="ident" id="7523360">snet</span><span class="op" id="7523364">:</span>&nbsp;<span class="string" id="7523366">&#34;tcp4&#34;</span><span class="op" id="7523372">,</span>&nbsp;<span class="ident" id="7523374">saddr</span><span class="op" id="7523379">:</span>&nbsp;<span class="string" id="7523381">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7523399">,</span>&nbsp;<span class="ident" id="7523401">cnet</span><span class="op" id="7523405">:</span>&nbsp;<span class="string" id="7523407">&#34;tcp4&#34;</span><span class="op" id="7523413">,</span>&nbsp;<span class="ident" id="7523415">caddr</span><span class="op" id="7523420">:</span>&nbsp;<span class="string" id="7523422">&#34;127.0.0.1&#34;</span><span class="op" id="7523433">}</span><span class="op" id="7523434">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523438">{</span><span class="ident" id="7523439">snet</span><span class="op" id="7523443">:</span>&nbsp;<span class="string" id="7523445">&#34;tcp4&#34;</span><span class="op" id="7523451">,</span>&nbsp;<span class="ident" id="7523453">saddr</span><span class="op" id="7523458">:</span>&nbsp;<span class="string" id="7523460">&#34;127.0.0.1&#34;</span><span class="op" id="7523471">,</span>&nbsp;<span class="ident" id="7523473">cnet</span><span class="op" id="7523477">:</span>&nbsp;<span class="string" id="7523479">&#34;tcp4&#34;</span><span class="op" id="7523485">,</span>&nbsp;<span class="ident" id="7523487">caddr</span><span class="op" id="7523492">:</span>&nbsp;<span class="string" id="7523494">&#34;127.0.0.1&#34;</span><span class="op" id="7523505">}</span><span class="op" id="7523506">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523510">{</span><span class="ident" id="7523511">snet</span><span class="op" id="7523515">:</span>&nbsp;<span class="string" id="7523517">&#34;tcp6&#34;</span><span class="op" id="7523523">,</span>&nbsp;<span class="ident" id="7523525">saddr</span><span class="op" id="7523530">:</span>&nbsp;<span class="string" id="7523532">&#34;&#34;</span><span class="op" id="7523534">,</span>&nbsp;<span class="ident" id="7523536">cnet</span><span class="op" id="7523540">:</span>&nbsp;<span class="string" id="7523542">&#34;tcp6&#34;</span><span class="op" id="7523548">,</span>&nbsp;<span class="ident" id="7523550">caddr</span><span class="op" id="7523555">:</span>&nbsp;<span class="string" id="7523557">&#34;[::1]&#34;</span><span class="op" id="7523564">,</span>&nbsp;<span class="ident" id="7523566">ipv6</span><span class="op" id="7523570">:</span>&nbsp;<span class="ident" id="7523572">true</span><span class="op" id="7523576">}</span><span class="op" id="7523577">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523580">{</span><span class="ident" id="7523581">snet</span><span class="op" id="7523585">:</span>&nbsp;<span class="string" id="7523587">&#34;tcp6&#34;</span><span class="op" id="7523593">,</span>&nbsp;<span class="ident" id="7523595">saddr</span><span class="op" id="7523600">:</span>&nbsp;<span class="string" id="7523602">&#34;[::]&#34;</span><span class="op" id="7523608">,</span>&nbsp;<span class="ident" id="7523610">cnet</span><span class="op" id="7523614">:</span>&nbsp;<span class="string" id="7523616">&#34;tcp6&#34;</span><span class="op" id="7523622">,</span>&nbsp;<span class="ident" id="7523624">caddr</span><span class="op" id="7523629">:</span>&nbsp;<span class="string" id="7523631">&#34;[::1]&#34;</span><span class="op" id="7523638">,</span>&nbsp;<span class="ident" id="7523640">ipv6</span><span class="op" id="7523644">:</span>&nbsp;<span class="ident" id="7523646">true</span><span class="op" id="7523650">}</span><span class="op" id="7523651">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523655">{</span><span class="ident" id="7523656">snet</span><span class="op" id="7523660">:</span>&nbsp;<span class="string" id="7523662">&#34;tcp6&#34;</span><span class="op" id="7523668">,</span>&nbsp;<span class="ident" id="7523670">saddr</span><span class="op" id="7523675">:</span>&nbsp;<span class="string" id="7523677">&#34;[::1]&#34;</span><span class="op" id="7523684">,</span>&nbsp;<span class="ident" id="7523686">cnet</span><span class="op" id="7523690">:</span>&nbsp;<span class="string" id="7523692">&#34;tcp6&#34;</span><span class="op" id="7523698">,</span>&nbsp;<span class="ident" id="7523700">caddr</span><span class="op" id="7523705">:</span>&nbsp;<span class="string" id="7523707">&#34;[::1]&#34;</span><span class="op" id="7523714">,</span>&nbsp;<span class="ident" id="7523716">ipv6</span><span class="op" id="7523720">:</span>&nbsp;<span class="ident" id="7523722">true</span><span class="op" id="7523726">}</span><span class="op" id="7523727">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523731">{</span><span class="ident" id="7523732">snet</span><span class="op" id="7523736">:</span>&nbsp;<span class="string" id="7523738">&#34;unix&#34;</span><span class="op" id="7523744">,</span>&nbsp;<span class="ident" id="7523746">saddr</span><span class="op" id="7523751">:</span>&nbsp;<span class="ident" id="7523753">testUnixAddr</span><span class="op" id="7523765">(</span><span class="op" id="7523766">)</span><span class="op" id="7523767">,</span>&nbsp;<span class="ident" id="7523769">cnet</span><span class="op" id="7523773">:</span>&nbsp;<span class="string" id="7523775">&#34;unix&#34;</span><span class="op" id="7523781">,</span>&nbsp;<span class="ident" id="7523783">caddr</span><span class="op" id="7523788">:</span>&nbsp;<span class="ident" id="7523790">testUnixAddr</span><span class="op" id="7523802">(</span><span class="op" id="7523803">)</span><span class="op" id="7523804">}</span><span class="op" id="7523805">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7523808">{</span><span class="ident" id="7523809">snet</span><span class="op" id="7523813">:</span>&nbsp;<span class="string" id="7523815">&#34;unix&#34;</span><span class="op" id="7523821">,</span>&nbsp;<span class="ident" id="7523823">saddr</span><span class="op" id="7523828">:</span>&nbsp;<span class="string" id="7523830">&#34;@gotest2/net&#34;</span><span class="op" id="7523844">,</span>&nbsp;<span class="ident" id="7523846">cnet</span><span class="op" id="7523850">:</span>&nbsp;<span class="string" id="7523852">&#34;unix&#34;</span><span class="op" id="7523858">,</span>&nbsp;<span class="ident" id="7523860">caddr</span><span class="op" id="7523865">:</span>&nbsp;<span class="string" id="7523867">&#34;@gotest2/net.local&#34;</span><span class="op" id="7523887">,</span>&nbsp;<span class="ident" id="7523889">linuxOnly</span><span class="op" id="7523898">:</span>&nbsp;<span class="ident" id="7523900">true</span><span class="op" id="7523904">}</span><span class="op" id="7523905">,</span><br>
<span class="lineno"></span><span class="op" id="7523907">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7523910">func</span>&nbsp;<span class="ident" id="7523915">TestStreamConnServer</span><span class="op" id="7523935">(</span><span class="ident" id="7523936">t</span>&nbsp;<span class="op" id="7523938">*</span><span class="ident" id="7523939">testing</span><span class="op" id="7523946">.</span><span class="ident" id="7523947">T</span><span class="op" id="7523948">)</span>&nbsp;<span class="op" id="7523950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7523953">for</span>&nbsp;<span class="ident" id="7523957">_</span><span class="op" id="7523958">,</span>&nbsp;<span class="ident" id="7523960">tt</span>&nbsp;<span class="op" id="7523963">:=</span>&nbsp;<span class="keyword" id="7523966">range</span>&nbsp;<span class="ident" id="7523972">streamConnServerTests</span>&nbsp;<span class="op" id="7523994">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7523998">if</span>&nbsp;<span class="ident" id="7524001">skipServerTest</span><span class="op" id="7524015">(</span><span class="ident" id="7524016">tt</span><span class="op" id="7524018">.</span><span class="ident" id="7524019">snet</span><span class="op" id="7524023">,</span>&nbsp;<span class="string" id="7524025">&#34;unix&#34;</span><span class="op" id="7524031">,</span>&nbsp;<span class="ident" id="7524033">tt</span><span class="op" id="7524035">.</span><span class="ident" id="7524036">saddr</span><span class="op" id="7524041">,</span>&nbsp;<span class="ident" id="7524043">tt</span><span class="op" id="7524045">.</span><span class="ident" id="7524046">ipv6</span><span class="op" id="7524050">,</span>&nbsp;<span class="ident" id="7524052">tt</span><span class="op" id="7524054">.</span><span class="ident" id="7524055">ipv4map</span><span class="op" id="7524062">,</span>&nbsp;<span class="ident" id="7524064">tt</span><span class="op" id="7524066">.</span><span class="ident" id="7524067">linuxOnly</span><span class="op" id="7524076">)</span>&nbsp;<span class="op" id="7524078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524083">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7524094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524099">listening</span>&nbsp;<span class="op" id="7524109">:=</span>&nbsp;<span class="builtinfunc" id="7524112">make</span><span class="op" id="7524116">(</span><span class="keyword" id="7524117">chan</span>&nbsp;<span class="builtintype" id="7524122">string</span><span class="op" id="7524128">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524132">done</span>&nbsp;<span class="op" id="7524137">:=</span>&nbsp;<span class="builtinfunc" id="7524140">make</span><span class="op" id="7524144">(</span><span class="keyword" id="7524145">chan</span>&nbsp;<span class="builtintype" id="7524150">int</span><span class="op" id="7524153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524157">switch</span>&nbsp;<span class="ident" id="7524164">tt</span><span class="op" id="7524166">.</span><span class="ident" id="7524167">snet</span>&nbsp;<span class="op" id="7524172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524176">case</span>&nbsp;<span class="string" id="7524181">&#34;tcp&#34;</span><span class="op" id="7524186">,</span>&nbsp;<span class="string" id="7524188">&#34;tcp4&#34;</span><span class="op" id="7524194">,</span>&nbsp;<span class="string" id="7524196">&#34;tcp6&#34;</span><span class="op" id="7524202">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524207">tt</span><span class="op" id="7524209">.</span><span class="ident" id="7524210">saddr</span>&nbsp;<span class="op" id="7524216">+=</span>&nbsp;<span class="string" id="7524219">&#34;:0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524226">case</span>&nbsp;<span class="string" id="7524231">&#34;unix&#34;</span><span class="op" id="7524237">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524242">os</span><span class="op" id="7524244">.</span><span class="ident" id="7524245">Remove</span><span class="op" id="7524251">(</span><span class="ident" id="7524252">tt</span><span class="op" id="7524254">.</span><span class="ident" id="7524255">saddr</span><span class="op" id="7524260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524265">os</span><span class="op" id="7524267">.</span><span class="ident" id="7524268">Remove</span><span class="op" id="7524274">(</span><span class="ident" id="7524275">tt</span><span class="op" id="7524277">.</span><span class="ident" id="7524278">caddr</span><span class="op" id="7524283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7524287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524292">go</span>&nbsp;<span class="ident" id="7524295">runStreamConnServer</span><span class="op" id="7524314">(</span><span class="ident" id="7524315">t</span><span class="op" id="7524316">,</span>&nbsp;<span class="ident" id="7524318">tt</span><span class="op" id="7524320">.</span><span class="ident" id="7524321">snet</span><span class="op" id="7524325">,</span>&nbsp;<span class="ident" id="7524327">tt</span><span class="op" id="7524329">.</span><span class="ident" id="7524330">saddr</span><span class="op" id="7524335">,</span>&nbsp;<span class="ident" id="7524337">listening</span><span class="op" id="7524346">,</span>&nbsp;<span class="ident" id="7524348">done</span><span class="op" id="7524352">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524356">taddr</span>&nbsp;<span class="op" id="7524362">:=</span>&nbsp;<span class="op" id="7524365">&lt;-</span><span class="ident" id="7524367">listening</span>&nbsp;<span class="comment" id="7524377">//&nbsp;wait&nbsp;for&nbsp;server&nbsp;to&nbsp;start</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524408">switch</span>&nbsp;<span class="ident" id="7524415">tt</span><span class="op" id="7524417">.</span><span class="ident" id="7524418">cnet</span>&nbsp;<span class="op" id="7524423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524427">case</span>&nbsp;<span class="string" id="7524432">&#34;tcp&#34;</span><span class="op" id="7524437">,</span>&nbsp;<span class="string" id="7524439">&#34;tcp4&#34;</span><span class="op" id="7524445">,</span>&nbsp;<span class="string" id="7524447">&#34;tcp6&#34;</span><span class="op" id="7524453">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524458">_</span><span class="op" id="7524459">,</span>&nbsp;<span class="ident" id="7524461">port</span><span class="op" id="7524465">,</span>&nbsp;<span class="ident" id="7524467">err</span>&nbsp;<span class="op" id="7524471">:=</span>&nbsp;<span class="ident" id="7524474">SplitHostPort</span><span class="op" id="7524487">(</span><span class="ident" id="7524488">taddr</span><span class="op" id="7524493">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524498">if</span>&nbsp;<span class="ident" id="7524501">err</span>&nbsp;<span class="op" id="7524505">!=</span>&nbsp;<span class="ident" id="7524508">nil</span>&nbsp;<span class="op" id="7524512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524518">t</span><span class="op" id="7524519">.</span><span class="ident" id="7524520">Fatalf</span><span class="op" id="7524526">(</span><span class="string" id="7524527">&#34;SplitHostPort(%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7524557">,</span>&nbsp;<span class="ident" id="7524559">taddr</span><span class="op" id="7524564">,</span>&nbsp;<span class="ident" id="7524566">err</span><span class="op" id="7524569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7524574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524579">taddr</span>&nbsp;<span class="op" id="7524585">=</span>&nbsp;<span class="ident" id="7524587">tt</span><span class="op" id="7524589">.</span><span class="ident" id="7524590">caddr</span>&nbsp;<span class="op" id="7524596">+</span>&nbsp;<span class="string" id="7524598">&#34;:&#34;</span>&nbsp;<span class="op" id="7524602">+</span>&nbsp;<span class="ident" id="7524604">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7524611">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524616">runStreamConnClient</span><span class="op" id="7524635">(</span><span class="ident" id="7524636">t</span><span class="op" id="7524637">,</span>&nbsp;<span class="ident" id="7524639">tt</span><span class="op" id="7524641">.</span><span class="ident" id="7524642">cnet</span><span class="op" id="7524646">,</span>&nbsp;<span class="ident" id="7524648">taddr</span><span class="op" id="7524653">,</span>&nbsp;<span class="ident" id="7524655">tt</span><span class="op" id="7524657">.</span><span class="ident" id="7524658">empty</span><span class="op" id="7524663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7524667">&lt;-</span><span class="ident" id="7524669">done</span>&nbsp;<span class="comment" id="7524674">//&nbsp;make&nbsp;sure&nbsp;server&nbsp;stopped</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524705">switch</span>&nbsp;<span class="ident" id="7524712">tt</span><span class="op" id="7524714">.</span><span class="ident" id="7524715">snet</span>&nbsp;<span class="op" id="7524720">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7524724">case</span>&nbsp;<span class="string" id="7524729">&#34;unix&#34;</span><span class="op" id="7524735">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524740">os</span><span class="op" id="7524742">.</span><span class="ident" id="7524743">Remove</span><span class="op" id="7524749">(</span><span class="ident" id="7524750">tt</span><span class="op" id="7524752">.</span><span class="ident" id="7524753">saddr</span><span class="op" id="7524758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524763">os</span><span class="op" id="7524765">.</span><span class="ident" id="7524766">Remove</span><span class="op" id="7524772">(</span><span class="ident" id="7524773">tt</span><span class="op" id="7524775">.</span><span class="ident" id="7524776">caddr</span><span class="op" id="7524781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7524785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7524788">}</span><br>
<span class="lineno">130</span><span class="op" id="7524790">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7524793">var</span>&nbsp;<span class="ident" id="7524797">seqpacketConnServerTests</span>&nbsp;<span class="op" id="7524822">=</span>&nbsp;<span class="op" id="7524824">[</span><span class="op" id="7524825">]</span><span class="keyword" id="7524826">struct</span>&nbsp;<span class="op" id="7524833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524836">net</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7524846">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524854">saddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7524864">string</span>&nbsp;<span class="comment" id="7524871">//&nbsp;server&nbsp;address</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524890">caddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7524900">string</span>&nbsp;<span class="comment" id="7524907">//&nbsp;client&nbsp;address</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524926">empty</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7524936">bool</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="7524943">//&nbsp;test&nbsp;with&nbsp;empty&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7524968">linuxOnly</span>&nbsp;<span class="builtintype" id="7524978">bool</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="7524985">//&nbsp;test&nbsp;with&nbsp;abstract&nbsp;unix&nbsp;domain&nbsp;socket,&nbsp;a&nbsp;Linux-ism</span><br>
<span class="lineno"></span><span class="op" id="7525039">}</span><span class="op" id="7525040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7525043">{</span><span class="ident" id="7525044">net</span><span class="op" id="7525047">:</span>&nbsp;<span class="string" id="7525049">&#34;unixpacket&#34;</span><span class="op" id="7525061">,</span>&nbsp;<span class="ident" id="7525063">saddr</span><span class="op" id="7525068">:</span>&nbsp;<span class="ident" id="7525070">testUnixAddr</span><span class="op" id="7525082">(</span><span class="op" id="7525083">)</span><span class="op" id="7525084">,</span>&nbsp;<span class="ident" id="7525086">caddr</span><span class="op" id="7525091">:</span>&nbsp;<span class="ident" id="7525093">testUnixAddr</span><span class="op" id="7525105">(</span><span class="op" id="7525106">)</span><span class="op" id="7525107">}</span><span class="op" id="7525108">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7525111">{</span><span class="ident" id="7525112">net</span><span class="op" id="7525115">:</span>&nbsp;<span class="string" id="7525117">&#34;unixpacket&#34;</span><span class="op" id="7525129">,</span>&nbsp;<span class="ident" id="7525131">saddr</span><span class="op" id="7525136">:</span>&nbsp;<span class="string" id="7525138">&#34;@gotest4/net&#34;</span><span class="op" id="7525152">,</span>&nbsp;<span class="ident" id="7525154">caddr</span><span class="op" id="7525159">:</span>&nbsp;<span class="string" id="7525161">&#34;@gotest4/net.local&#34;</span><span class="op" id="7525181">,</span>&nbsp;<span class="ident" id="7525183">linuxOnly</span><span class="op" id="7525192">:</span>&nbsp;<span class="ident" id="7525194">true</span><span class="op" id="7525198">}</span><span class="op" id="7525199">,</span><br>
<span class="lineno"></span><span class="op" id="7525201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7525204">func</span>&nbsp;<span class="ident" id="7525209">TestSeqpacketConnServer</span><span class="op" id="7525232">(</span><span class="ident" id="7525233">t</span>&nbsp;<span class="op" id="7525235">*</span><span class="ident" id="7525236">testing</span><span class="op" id="7525243">.</span><span class="ident" id="7525244">T</span><span class="op" id="7525245">)</span>&nbsp;<span class="op" id="7525247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7525250">switch</span>&nbsp;<span class="ident" id="7525257">runtime</span><span class="op" id="7525264">.</span><span class="ident" id="7525265">GOOS</span>&nbsp;<span class="op" id="7525270">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7525273">case</span>&nbsp;<span class="string" id="7525278">&#34;darwin&#34;</span><span class="op" id="7525286">,</span>&nbsp;<span class="string" id="7525288">&#34;nacl&#34;</span><span class="op" id="7525294">,</span>&nbsp;<span class="string" id="7525296">&#34;openbsd&#34;</span><span class="op" id="7525305">,</span>&nbsp;<span class="string" id="7525307">&#34;plan9&#34;</span><span class="op" id="7525314">,</span>&nbsp;<span class="string" id="7525316">&#34;windows&#34;</span><span class="op" id="7525325">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7525329">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7525342">case</span>&nbsp;<span class="string" id="7525347">&#34;freebsd&#34;</span><span class="op" id="7525356">:</span>&nbsp;<span class="comment" id="7525358">//&nbsp;FreeBSD&nbsp;8&nbsp;doesn&#39;t&nbsp;support&nbsp;unixpacket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525400">t</span><span class="op" id="7525401">.</span><span class="ident" id="7525402">Skipf</span><span class="op" id="7525407">(</span><span class="string" id="7525408">&#34;skipping&nbsp;test&nbsp;on&nbsp;%q&#34;</span><span class="op" id="7525429">,</span>&nbsp;<span class="ident" id="7525431">runtime</span><span class="op" id="7525438">.</span><span class="ident" id="7525439">GOOS</span><span class="op" id="7525443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7525446">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7525450">for</span>&nbsp;<span class="ident" id="7525454">_</span><span class="op" id="7525455">,</span>&nbsp;<span class="ident" id="7525457">tt</span>&nbsp;<span class="op" id="7525460">:=</span>&nbsp;<span class="keyword" id="7525463">range</span>&nbsp;<span class="ident" id="7525469">seqpacketConnServerTests</span>&nbsp;<span class="op" id="7525494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7525498">if</span>&nbsp;<span class="ident" id="7525501">runtime</span><span class="op" id="7525508">.</span><span class="ident" id="7525509">GOOS</span>&nbsp;<span class="op" id="7525514">!=</span>&nbsp;<span class="string" id="7525517">&#34;linux&#34;</span>&nbsp;<span class="op" id="7525525">&amp;&amp;</span>&nbsp;<span class="ident" id="7525528">tt</span><span class="op" id="7525530">.</span><span class="ident" id="7525531">linuxOnly</span>&nbsp;<span class="op" id="7525541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7525546">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7525557">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525561">listening</span>&nbsp;<span class="op" id="7525571">:=</span>&nbsp;<span class="builtinfunc" id="7525574">make</span><span class="op" id="7525578">(</span><span class="keyword" id="7525579">chan</span>&nbsp;<span class="builtintype" id="7525584">string</span><span class="op" id="7525590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525594">done</span>&nbsp;<span class="op" id="7525599">:=</span>&nbsp;<span class="builtinfunc" id="7525602">make</span><span class="op" id="7525606">(</span><span class="keyword" id="7525607">chan</span>&nbsp;<span class="builtintype" id="7525612">int</span><span class="op" id="7525615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7525619">switch</span>&nbsp;<span class="ident" id="7525626">tt</span><span class="op" id="7525628">.</span><span class="ident" id="7525629">net</span>&nbsp;<span class="op" id="7525633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7525637">case</span>&nbsp;<span class="string" id="7525642">&#34;unixpacket&#34;</span><span class="op" id="7525654">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525659">os</span><span class="op" id="7525661">.</span><span class="ident" id="7525662">Remove</span><span class="op" id="7525668">(</span><span class="ident" id="7525669">tt</span><span class="op" id="7525671">.</span><span class="ident" id="7525672">saddr</span><span class="op" id="7525677">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525682">os</span><span class="op" id="7525684">.</span><span class="ident" id="7525685">Remove</span><span class="op" id="7525691">(</span><span class="ident" id="7525692">tt</span><span class="op" id="7525694">.</span><span class="ident" id="7525695">caddr</span><span class="op" id="7525700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7525704">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7525709">go</span>&nbsp;<span class="ident" id="7525712">runStreamConnServer</span><span class="op" id="7525731">(</span><span class="ident" id="7525732">t</span><span class="op" id="7525733">,</span>&nbsp;<span class="ident" id="7525735">tt</span><span class="op" id="7525737">.</span><span class="ident" id="7525738">net</span><span class="op" id="7525741">,</span>&nbsp;<span class="ident" id="7525743">tt</span><span class="op" id="7525745">.</span><span class="ident" id="7525746">saddr</span><span class="op" id="7525751">,</span>&nbsp;<span class="ident" id="7525753">listening</span><span class="op" id="7525762">,</span>&nbsp;<span class="ident" id="7525764">done</span><span class="op" id="7525768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525772">taddr</span>&nbsp;<span class="op" id="7525778">:=</span>&nbsp;<span class="op" id="7525781">&lt;-</span><span class="ident" id="7525783">listening</span>&nbsp;<span class="comment" id="7525793">//&nbsp;wait&nbsp;for&nbsp;server&nbsp;to&nbsp;start</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525824">runStreamConnClient</span><span class="op" id="7525843">(</span><span class="ident" id="7525844">t</span><span class="op" id="7525845">,</span>&nbsp;<span class="ident" id="7525847">tt</span><span class="op" id="7525849">.</span><span class="ident" id="7525850">net</span><span class="op" id="7525853">,</span>&nbsp;<span class="ident" id="7525855">taddr</span><span class="op" id="7525860">,</span>&nbsp;<span class="ident" id="7525862">tt</span><span class="op" id="7525864">.</span><span class="ident" id="7525865">empty</span><span class="op" id="7525870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7525874">&lt;-</span><span class="ident" id="7525876">done</span>&nbsp;<span class="comment" id="7525881">//&nbsp;make&nbsp;sure&nbsp;server&nbsp;stopped</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7525912">switch</span>&nbsp;<span class="ident" id="7525919">tt</span><span class="op" id="7525921">.</span><span class="ident" id="7525922">net</span>&nbsp;<span class="op" id="7525926">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7525930">case</span>&nbsp;<span class="string" id="7525935">&#34;unixpacket&#34;</span><span class="op" id="7525947">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525952">os</span><span class="op" id="7525954">.</span><span class="ident" id="7525955">Remove</span><span class="op" id="7525961">(</span><span class="ident" id="7525962">tt</span><span class="op" id="7525964">.</span><span class="ident" id="7525965">saddr</span><span class="op" id="7525970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7525975">os</span><span class="op" id="7525977">.</span><span class="ident" id="7525978">Remove</span><span class="op" id="7525984">(</span><span class="ident" id="7525985">tt</span><span class="op" id="7525987">.</span><span class="ident" id="7525988">caddr</span><span class="op" id="7525993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7525997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7526000">}</span><br>
<span class="lineno">175</span><span class="op" id="7526002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7526005">func</span>&nbsp;<span class="ident" id="7526010">runStreamConnServer</span><span class="op" id="7526029">(</span><span class="ident" id="7526030">t</span>&nbsp;<span class="op" id="7526032">*</span><span class="ident" id="7526033">testing</span><span class="op" id="7526040">.</span><span class="ident" id="7526041">T</span><span class="op" id="7526042">,</span>&nbsp;<span class="ident" id="7526044">net</span><span class="op" id="7526047">,</span>&nbsp;<span class="ident" id="7526049">laddr</span>&nbsp;<span class="builtintype" id="7526055">string</span><span class="op" id="7526061">,</span>&nbsp;<span class="ident" id="7526063">listening</span>&nbsp;<span class="keyword" id="7526073">chan</span><span class="op" id="7526077">&lt;-</span>&nbsp;<span class="builtintype" id="7526080">string</span><span class="op" id="7526086">,</span>&nbsp;<span class="ident" id="7526088">done</span>&nbsp;<span class="keyword" id="7526093">chan</span><span class="op" id="7526097">&lt;-</span>&nbsp;<span class="builtintype" id="7526100">int</span><span class="op" id="7526103">)</span>&nbsp;<span class="op" id="7526105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7526108">defer</span>&nbsp;<span class="builtinfunc" id="7526114">close</span><span class="op" id="7526119">(</span><span class="ident" id="7526120">done</span><span class="op" id="7526124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7526127">l</span><span class="op" id="7526128">,</span>&nbsp;<span class="ident" id="7526130">err</span>&nbsp;<span class="op" id="7526134">:=</span>&nbsp;<span class="ident" id="7526137">Listen</span><span class="op" id="7526143">(</span><span class="ident" id="7526144">net</span><span class="op" id="7526147">,</span>&nbsp;<span class="ident" id="7526149">laddr</span><span class="op" id="7526154">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7526157">if</span>&nbsp;<span class="ident" id="7526160">err</span>&nbsp;<span class="op" id="7526164">!=</span>&nbsp;<span class="ident" id="7526167">nil</span>&nbsp;<span class="op" id="7526171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7526175">t</span><span class="op" id="7526176">.</span><span class="ident" id="7526177">Errorf</span><span class="op" id="7526183">(</span><span class="string" id="7526184">&#34;Listen(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7526211">,</span>&nbsp;<span class="ident" id="7526213">net</span><span class="op" id="7526216">,</span>&nbsp;<span class="ident" id="7526218">laddr</span><span class="op" id="7526223">,</span>&nbsp;<span class="ident" id="7526225">err</span><span class="op" id="7526228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7526232">listening</span>&nbsp;<span class="op" id="7526242">&lt;-</span>&nbsp;<span class="string" id="7526245">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7526255">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7526263">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7526266">defer</span>&nbsp;<span class="ident" id="7526272">l</span><span class="op" id="7526273">.</span><span class="ident" id="7526274">Close</span><span class="op" id="7526279">(</span><span class="op" id="7526280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7526283">listening</span>&nbsp;<span class="op" id="7526293">&lt;-</span>&nbsp;<span class="ident" id="7526296">l</span><span class="op" id="7526297">.</span><span class="ident" id="7526298">Addr</span><span class="op" id="7526302">(</span><span class="op" id="7526303">)</span><span class="op" id="7526304">.</span><span class="ident" id="7526305">String</span><span class="op" id="7526311">(</span><span class="op" id="7526312">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7526316">echo</span>&nbsp;<span class="op" id="7526321">:=</span>&nbsp;<span class="keyword" id="7526324">func</span><span class="op" id="7526328">(</span><span class="ident" id="7526329">rw</span>&nbsp;<span class="ident" id="7526332">io</span><span class="op" id="7526334">.</span><span class="ident" id="7526335">ReadWriter</span><span class="op" id="7526345">,</span>&nbsp;<span class="ident" id="7526347">done</span>&nbsp;<span class="keyword" id="7526352">chan</span><span class="op" id="7526356">&lt;-</span>&nbsp;<span class="builtintype" id="7526359">int</span><span class="op" id="7526362">)</span>&nbsp;<span class="op" id="7526364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7526368">buf</span>&nbsp;<span class="op" id="7526372">:=</span>&nbsp;<span class="builtinfunc" id="7526375">make</span><span class="op" id="7526379">(</span><span class="op" id="7526380">[</span><span class="op" id="7526381">]</span><span class="builtintype" id="7526382">byte</span><span class="op" id="7526386">,</span>&nbsp;<span class="num" id="7526388">1024</span><span class="op" id="7526392">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7526396">for</span>&nbsp;<span class="op" id="7526400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7526405">n</span><span class="op" id="7526406">,</span>&nbsp;<span class="ident" id="7526408">err</span>&nbsp;<span class="op" id="7526412">:=</span>&nbsp;<span class="ident" id="7526415">rw</span><span class="op" id="7526417">.</span><span class="ident" id="7526418">Read</span><span class="op" id="7526422">(</span><span class="ident" id="7526423">buf</span><span class="op" id="7526426">[</span><span class="num" id="7526427">0</span><span class="op" id="7526428">:</span><span class="op" id="7526429">]</span><span class="op" id="7526430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7526435">if</span>&nbsp;<span class="ident" id="7526438">err</span>&nbsp;<span class="op" id="7526442">!=</span>&nbsp;<span class="ident" id="7526445">nil</span>&nbsp;<span class="op" id="7526449">||</span>&nbsp;<span class="ident" id="7526452">n</span>&nbsp;<span class="op" id="7526454">==</span>&nbsp;<span class="num" id="7526457">0</span>&nbsp;<span class="op" id="7526459">||</span>&nbsp;<span class="builtintype" id="7526462">string</span><span class="op" id="7526468">(</span><span class="ident" id="7526469">buf</span><span class="op" id="7526472">[</span><span class="op" id="7526473">:</span><span class="ident" id="7526474">n</span><span class="op" id="7526475">]</span><span class="op" id="7526476">)</span>&nbsp;<span class="op" id="7526478">==</span>&nbsp;<span class="string" id="7526481">&#34;END&#34;</span>&nbsp;<span class="op" id="7526487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7526493">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7526502">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7526507">rw</span><span class="op" id="7526509">.</span><span class="ident" id="7526510">Write</span><span class="op" id="7526515">(</span><span class="ident" id="7526516">buf</span><span class="op" id="7526519">[</span><span class="num" id="7526520">0</span><span class="op" id="7526521">:</span><span class="ident" id="7526522">n</span><span class="op" id="7526523">]</span><span class="op" id="7526524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7526528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7526532">close</span><span class="op" id="7526537">(</span><span class="ident" id="7526538">done</span><span class="op" id="7526542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7526545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="ident" id="7526548">run</span><span class="op" id="7526551">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7526554">for</span>&nbsp;<span class="op" id="7526558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7526562">c</span><span class="op" id="7526563">,</span>&nbsp;<span class="ident" id="7526565">err</span>&nbsp;<span class="op" id="7526569">:=</span>&nbsp;<span class="ident" id="7526572">l</span><span class="op" id="7526573">.</span><span class="ident" id="7526574">Accept</span><span class="op" id="7526580">(</span><span class="op" id="7526581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7526585">if</span>&nbsp;<span class="ident" id="7526588">err</span>&nbsp;<span class="op" id="7526592">!=</span>&nbsp;<span class="ident" id="7526595">nil</span>&nbsp;<span class="op" id="7526599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7526604">t</span><span class="op" id="7526605">.</span><span class="ident" id="7526606">Logf</span><span class="op" id="7526610">(</span><span class="string" id="7526611">&#34;Accept&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7526630">,</span>&nbsp;<span class="ident" id="7526632">err</span><span class="op" id="7526635">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7526640">continue</span>&nbsp;<span class="ident" id="7526649">run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7526655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7526659">echodone</span>&nbsp;<span class="op" id="7526668">:=</span>&nbsp;<span class="builtinfunc" id="7526671">make</span><span class="op" id="7526675">(</span><span class="keyword" id="7526676">chan</span>&nbsp;<span class="builtintype" id="7526681">int</span><span class="op" id="7526684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7526688">go</span>&nbsp;<span class="ident" id="7526691">echo</span><span class="op" id="7526695">(</span><span class="ident" id="7526696">c</span><span class="op" id="7526697">,</span>&nbsp;<span class="ident" id="7526699">echodone</span><span class="op" id="7526707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7526711">&lt;-</span><span class="ident" id="7526713">echodone</span>&nbsp;<span class="comment" id="7526722">//&nbsp;make&nbsp;sure&nbsp;echo&nbsp;stopped</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7526750">c</span><span class="op" id="7526751">.</span><span class="ident" id="7526752">Close</span><span class="op" id="7526757">(</span><span class="op" id="7526758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7526762">break</span>&nbsp;<span class="ident" id="7526768">run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7526773">}</span><br>
<span class="lineno"></span><span class="op" id="7526775">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="7526778">func</span>&nbsp;<span class="ident" id="7526783">runStreamConnClient</span><span class="op" id="7526802">(</span><span class="ident" id="7526803">t</span>&nbsp;<span class="op" id="7526805">*</span><span class="ident" id="7526806">testing</span><span class="op" id="7526813">.</span><span class="ident" id="7526814">T</span><span class="op" id="7526815">,</span>&nbsp;<span class="ident" id="7526817">net</span><span class="op" id="7526820">,</span>&nbsp;<span class="ident" id="7526822">taddr</span>&nbsp;<span class="builtintype" id="7526828">string</span><span class="op" id="7526834">,</span>&nbsp;<span class="ident" id="7526836">isEmpty</span>&nbsp;<span class="builtintype" id="7526844">bool</span><span class="op" id="7526848">)</span>&nbsp;<span class="op" id="7526850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7526853">c</span><span class="op" id="7526854">,</span>&nbsp;<span class="ident" id="7526856">err</span>&nbsp;<span class="op" id="7526860">:=</span>&nbsp;<span class="ident" id="7526863">Dial</span><span class="op" id="7526867">(</span><span class="ident" id="7526868">net</span><span class="op" id="7526871">,</span>&nbsp;<span class="ident" id="7526873">taddr</span><span class="op" id="7526878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7526881">if</span>&nbsp;<span class="ident" id="7526884">err</span>&nbsp;<span class="op" id="7526888">!=</span>&nbsp;<span class="ident" id="7526891">nil</span>&nbsp;<span class="op" id="7526895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7526899">t</span><span class="op" id="7526900">.</span><span class="ident" id="7526901">Fatalf</span><span class="op" id="7526907">(</span><span class="string" id="7526908">&#34;Dial(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7526933">,</span>&nbsp;<span class="ident" id="7526935">net</span><span class="op" id="7526938">,</span>&nbsp;<span class="ident" id="7526940">taddr</span><span class="op" id="7526945">,</span>&nbsp;<span class="ident" id="7526947">err</span><span class="op" id="7526950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7526953">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7526956">defer</span>&nbsp;<span class="ident" id="7526962">c</span><span class="op" id="7526963">.</span><span class="ident" id="7526964">Close</span><span class="op" id="7526969">(</span><span class="op" id="7526970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7526973">c</span><span class="op" id="7526974">.</span><span class="ident" id="7526975">SetReadDeadline</span><span class="op" id="7526990">(</span><span class="ident" id="7526991">time</span><span class="op" id="7526995">.</span><span class="ident" id="7526996">Now</span><span class="op" id="7526999">(</span><span class="op" id="7527000">)</span><span class="op" id="7527001">.</span><span class="ident" id="7527002">Add</span><span class="op" id="7527005">(</span><span class="num" id="7527006">1</span>&nbsp;<span class="op" id="7527008">*</span>&nbsp;<span class="ident" id="7527010">time</span><span class="op" id="7527014">.</span><span class="ident" id="7527015">Second</span><span class="op" id="7527021">)</span><span class="op" id="7527022">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7527026">var</span>&nbsp;<span class="ident" id="7527030">wb</span>&nbsp;<span class="op" id="7527033">[</span><span class="op" id="7527034">]</span><span class="builtintype" id="7527035">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7527041">if</span>&nbsp;<span class="op" id="7527044">!</span><span class="ident" id="7527045">isEmpty</span>&nbsp;<span class="op" id="7527053">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7527057">wb</span>&nbsp;<span class="op" id="7527060">=</span>&nbsp;<span class="op" id="7527062">[</span><span class="op" id="7527063">]</span><span class="builtintype" id="7527064">byte</span><span class="op" id="7527068">(</span><span class="string" id="7527069">&#34;StreamConnClient&nbsp;by&nbsp;Dial\n&#34;</span><span class="op" id="7527097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7527100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7527103">if</span>&nbsp;<span class="ident" id="7527106">n</span><span class="op" id="7527107">,</span>&nbsp;<span class="ident" id="7527109">err</span>&nbsp;<span class="op" id="7527113">:=</span>&nbsp;<span class="ident" id="7527116">c</span><span class="op" id="7527117">.</span><span class="ident" id="7527118">Write</span><span class="op" id="7527123">(</span><span class="ident" id="7527124">wb</span><span class="op" id="7527126">)</span><span class="op" id="7527127">;</span>&nbsp;<span class="ident" id="7527129">err</span>&nbsp;<span class="op" id="7527133">!=</span>&nbsp;<span class="ident" id="7527136">nil</span>&nbsp;<span class="op" id="7527140">||</span>&nbsp;<span class="ident" id="7527143">n</span>&nbsp;<span class="op" id="7527145">!=</span>&nbsp;<span class="builtinfunc" id="7527148">len</span><span class="op" id="7527151">(</span><span class="ident" id="7527152">wb</span><span class="op" id="7527154">)</span>&nbsp;<span class="op" id="7527156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7527160">t</span><span class="op" id="7527161">.</span><span class="ident" id="7527162">Fatalf</span><span class="op" id="7527168">(</span><span class="string" id="7527169">&#34;Write&nbsp;failed:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v,&nbsp;&lt;nil&gt;&#34;</span><span class="op" id="7527207">,</span>&nbsp;<span class="ident" id="7527209">n</span><span class="op" id="7527210">,</span>&nbsp;<span class="ident" id="7527212">err</span><span class="op" id="7527215">,</span>&nbsp;<span class="builtinfunc" id="7527217">len</span><span class="op" id="7527220">(</span><span class="ident" id="7527221">wb</span><span class="op" id="7527223">)</span><span class="op" id="7527224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7527227">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7527231">rb</span>&nbsp;<span class="op" id="7527234">:=</span>&nbsp;<span class="builtinfunc" id="7527237">make</span><span class="op" id="7527241">(</span><span class="op" id="7527242">[</span><span class="op" id="7527243">]</span><span class="builtintype" id="7527244">byte</span><span class="op" id="7527248">,</span>&nbsp;<span class="num" id="7527250">1024</span><span class="op" id="7527254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7527257">if</span>&nbsp;<span class="ident" id="7527260">n</span><span class="op" id="7527261">,</span>&nbsp;<span class="ident" id="7527263">err</span>&nbsp;<span class="op" id="7527267">:=</span>&nbsp;<span class="ident" id="7527270">c</span><span class="op" id="7527271">.</span><span class="ident" id="7527272">Read</span><span class="op" id="7527276">(</span><span class="ident" id="7527277">rb</span><span class="op" id="7527279">[</span><span class="num" id="7527280">0</span><span class="op" id="7527281">:</span><span class="op" id="7527282">]</span><span class="op" id="7527283">)</span><span class="op" id="7527284">;</span>&nbsp;<span class="ident" id="7527286">err</span>&nbsp;<span class="op" id="7527290">!=</span>&nbsp;<span class="ident" id="7527293">nil</span>&nbsp;<span class="op" id="7527297">||</span>&nbsp;<span class="ident" id="7527300">n</span>&nbsp;<span class="op" id="7527302">!=</span>&nbsp;<span class="builtinfunc" id="7527305">len</span><span class="op" id="7527308">(</span><span class="ident" id="7527309">wb</span><span class="op" id="7527311">)</span>&nbsp;<span class="op" id="7527313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7527317">t</span><span class="op" id="7527318">.</span><span class="ident" id="7527319">Fatalf</span><span class="op" id="7527325">(</span><span class="string" id="7527326">&#34;Read&nbsp;failed:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v,&nbsp;&lt;nil&gt;&#34;</span><span class="op" id="7527363">,</span>&nbsp;<span class="ident" id="7527365">n</span><span class="op" id="7527366">,</span>&nbsp;<span class="ident" id="7527368">err</span><span class="op" id="7527371">,</span>&nbsp;<span class="builtinfunc" id="7527373">len</span><span class="op" id="7527376">(</span><span class="ident" id="7527377">wb</span><span class="op" id="7527379">)</span><span class="op" id="7527380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7527383">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7527387">//&nbsp;Send&nbsp;explicit&nbsp;ending&nbsp;for&nbsp;unixpacket.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7527428">//&nbsp;Older&nbsp;Linux&nbsp;kernels&nbsp;do&nbsp;not&nbsp;stop&nbsp;reads&nbsp;on&nbsp;close.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7527480">switch</span>&nbsp;<span class="ident" id="7527487">net</span>&nbsp;<span class="op" id="7527491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7527494">case</span>&nbsp;<span class="string" id="7527499">&#34;unixpacket&#34;</span><span class="op" id="7527511">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7527515">c</span><span class="op" id="7527516">.</span><span class="ident" id="7527517">Write</span><span class="op" id="7527522">(</span><span class="op" id="7527523">[</span><span class="op" id="7527524">]</span><span class="builtintype" id="7527525">byte</span><span class="op" id="7527529">(</span><span class="string" id="7527530">&#34;END&#34;</span><span class="op" id="7527535">)</span><span class="op" id="7527536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7527539">}</span><br>
<span class="lineno"></span><span class="op" id="7527541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7527544">//&nbsp;Do&nbsp;not&nbsp;test&nbsp;empty&nbsp;datagrams&nbsp;by&nbsp;default.</span><br>
<span class="lineno">245</span><span class="comment" id="7527587">//&nbsp;It&nbsp;causes&nbsp;unexplained&nbsp;timeouts&nbsp;on&nbsp;some&nbsp;systems,</span><br>
<span class="lineno"></span><span class="comment" id="7527638">//&nbsp;including&nbsp;Snow&nbsp;Leopard.&nbsp;&nbsp;I&nbsp;think&nbsp;that&nbsp;the&nbsp;kernel</span><br>
<span class="lineno"></span><span class="comment" id="7527690">//&nbsp;doesn&#39;t&nbsp;quite&nbsp;expect&nbsp;them.</span><br>
<span class="lineno"></span><span class="keyword" id="7527720">var</span>&nbsp;<span class="ident" id="7527724">testDatagram</span>&nbsp;<span class="op" id="7527737">=</span>&nbsp;<span class="ident" id="7527739">flag</span><span class="op" id="7527743">.</span><span class="ident" id="7527744">Bool</span><span class="op" id="7527748">(</span><span class="string" id="7527749">&#34;datagram&#34;</span><span class="op" id="7527759">,</span>&nbsp;<span class="ident" id="7527761">false</span><span class="op" id="7527766">,</span>&nbsp;<span class="string" id="7527768">&#34;whether&nbsp;to&nbsp;test&nbsp;udp&nbsp;and&nbsp;unixgram&#34;</span><span class="op" id="7527802">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="7527805">var</span>&nbsp;<span class="ident" id="7527809">datagramPacketConnServerTests</span>&nbsp;<span class="op" id="7527839">=</span>&nbsp;<span class="op" id="7527841">[</span><span class="op" id="7527842">]</span><span class="keyword" id="7527843">struct</span>&nbsp;<span class="op" id="7527850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7527853">snet</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7527863">string</span>&nbsp;<span class="comment" id="7527870">//&nbsp;server&nbsp;side</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7527886">saddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7527896">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7527904">cnet</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7527914">string</span>&nbsp;<span class="comment" id="7527921">//&nbsp;client&nbsp;side</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7527937">caddr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7527947">string</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7527955">ipv6</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7527965">bool</span>&nbsp;<span class="comment" id="7527970">//&nbsp;test&nbsp;with&nbsp;underlying&nbsp;AF_INET6&nbsp;socket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7528011">ipv4map</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7528021">bool</span>&nbsp;<span class="comment" id="7528026">//&nbsp;test&nbsp;with&nbsp;IPv6&nbsp;IPv4-mapping&nbsp;functionality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7528072">dial</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7528082">bool</span>&nbsp;<span class="comment" id="7528087">//&nbsp;test&nbsp;with&nbsp;Dial&nbsp;or&nbsp;DialUnix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7528118">empty</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7528128">bool</span>&nbsp;<span class="comment" id="7528133">//&nbsp;test&nbsp;with&nbsp;empty&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7528158">linuxOnly</span>&nbsp;<span class="builtintype" id="7528168">bool</span>&nbsp;<span class="comment" id="7528173">//&nbsp;test&nbsp;with&nbsp;abstract&nbsp;unix&nbsp;domain&nbsp;socket,&nbsp;a&nbsp;Linux-ism</span><br>
<span class="lineno">260</span><span class="op" id="7528227">}</span><span class="op" id="7528228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7528231">{</span><span class="ident" id="7528232">snet</span><span class="op" id="7528236">:</span>&nbsp;<span class="string" id="7528238">&#34;udp&#34;</span><span class="op" id="7528243">,</span>&nbsp;<span class="ident" id="7528245">saddr</span><span class="op" id="7528250">:</span>&nbsp;<span class="string" id="7528252">&#34;&#34;</span><span class="op" id="7528254">,</span>&nbsp;<span class="ident" id="7528256">cnet</span><span class="op" id="7528260">:</span>&nbsp;<span class="string" id="7528262">&#34;udp&#34;</span><span class="op" id="7528267">,</span>&nbsp;<span class="ident" id="7528269">caddr</span><span class="op" id="7528274">:</span>&nbsp;<span class="string" id="7528276">&#34;127.0.0.1&#34;</span><span class="op" id="7528287">}</span><span class="op" id="7528288">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7528291">{</span><span class="ident" id="7528292">snet</span><span class="op" id="7528296">:</span>&nbsp;<span class="string" id="7528298">&#34;udp&#34;</span><span class="op" id="7528303">,</span>&nbsp;<span class="ident" id="7528305">saddr</span><span class="op" id="7528310">:</span>&nbsp;<span class="string" id="7528312">&#34;0.0.0.0&#34;</span><span class="op" id="7528321">,</span>&nbsp;<span class="ident" id="7528323">cnet</span><span class="op" id="7528327">:</span>&nbsp;<span class="string" id="7528329">&#34;udp&#34;</span><span class="op" id="7528334">,</span>&nbsp;<span class="ident" id="7528336">caddr</span><span class="op" id="7528341">:</span>&nbsp;<span class="string" id="7528343">&#34;127.0.0.1&#34;</span><span class="op" id="7528354">}</span><span class="op" id="7528355">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7528358">{</span><span class="ident" id="7528359">snet</span><span class="op" id="7528363">:</span>&nbsp;<span class="string" id="7528365">&#34;udp&#34;</span><span class="op" id="7528370">,</span>&nbsp;<span class="ident" id="7528372">saddr</span><span class="op" id="7528377">:</span>&nbsp;<span class="string" id="7528379">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7528397">,</span>&nbsp;<span class="ident" id="7528399">cnet</span><span class="op" id="7528403">:</span>&nbsp;<span class="string" id="7528405">&#34;udp&#34;</span><span class="op" id="7528410">,</span>&nbsp;<span class="ident" id="7528412">caddr</span><span class="op" id="7528417">:</span>&nbsp;<span class="string" id="7528419">&#34;127.0.0.1&#34;</span><span class="op" id="7528430">}</span><span class="op" id="7528431">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7528434">{</span><span class="ident" id="7528435">snet</span><span class="op" id="7528439">:</span>&nbsp;<span class="string" id="7528441">&#34;udp&#34;</span><span class="op" id="7528446">,</span>&nbsp;<span class="ident" id="7528448">saddr</span><span class="op" id="7528453">:</span>&nbsp;<span class="string" id="7528455">&#34;[::]&#34;</span><span class="op" id="7528461">,</span>&nbsp;<span class="ident" id="7528463">cnet</span><span class="op" id="7528467">:</span>&nbsp;<span class="string" id="7528469">&#34;udp&#34;</span><span class="op" id="7528474">,</span>&nbsp;<span class="ident" id="7528476">caddr</span><span class="op" id="7528481">:</span>&nbsp;<span class="string" id="7528483">&#34;[::1]&#34;</span><span class="op" id="7528490">,</span>&nbsp;<span class="ident" id="7528492">ipv6</span><span class="op" id="7528496">:</span>&nbsp;<span class="ident" id="7528498">true</span><span class="op" id="7528502">}</span><span class="op" id="7528503">,</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7528507">{</span><span class="ident" id="7528508">snet</span><span class="op" id="7528512">:</span>&nbsp;<span class="string" id="7528514">&#34;udp&#34;</span><span class="op" id="7528519">,</span>&nbsp;<span class="ident" id="7528521">saddr</span><span class="op" id="7528526">:</span>&nbsp;<span class="string" id="7528528">&#34;&#34;</span><span class="op" id="7528530">,</span>&nbsp;<span class="ident" id="7528532">cnet</span><span class="op" id="7528536">:</span>&nbsp;<span class="string" id="7528538">&#34;udp&#34;</span><span class="op" id="7528543">,</span>&nbsp;<span class="ident" id="7528545">caddr</span><span class="op" id="7528550">:</span>&nbsp;<span class="string" id="7528552">&#34;[::1]&#34;</span><span class="op" id="7528559">,</span>&nbsp;<span class="ident" id="7528561">ipv4map</span><span class="op" id="7528568">:</span>&nbsp;<span class="ident" id="7528570">true</span><span class="op" id="7528574">}</span><span class="op" id="7528575">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7528578">{</span><span class="ident" id="7528579">snet</span><span class="op" id="7528583">:</span>&nbsp;<span class="string" id="7528585">&#34;udp&#34;</span><span class="op" id="7528590">,</span>&nbsp;<span class="ident" id="7528592">saddr</span><span class="op" id="7528597">:</span>&nbsp;<span class="string" id="7528599">&#34;0.0.0.0&#34;</span><span class="op" id="7528608">,</span>&nbsp;<span class="ident" id="7528610">cnet</span><span class="op" id="7528614">:</span>&nbsp;<span class="string" id="7528616">&#34;udp&#34;</span><span class="op" id="7528621">,</span>&nbsp;<span class="ident" id="7528623">caddr</span><span class="op" id="7528628">:</span>&nbsp;<span class="string" id="7528630">&#34;[::1]&#34;</span><span class="op" id="7528637">,</span>&nbsp;<span class="ident" id="7528639">ipv4map</span><span class="op" id="7528646">:</span>&nbsp;<span class="ident" id="7528648">true</span><span class="op" id="7528652">}</span><span class="op" id="7528653">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7528656">{</span><span class="ident" id="7528657">snet</span><span class="op" id="7528661">:</span>&nbsp;<span class="string" id="7528663">&#34;udp&#34;</span><span class="op" id="7528668">,</span>&nbsp;<span class="ident" id="7528670">saddr</span><span class="op" id="7528675">:</span>&nbsp;<span class="string" id="7528677">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7528695">,</span>&nbsp;<span class="ident" id="7528697">cnet</span><span class="op" id="7528701">:</span>&nbsp;<span class="string" id="7528703">&#34;udp&#34;</span><span class="op" id="7528708">,</span>&nbsp;<span class="ident" id="7528710">caddr</span><span class="op" id="7528715">:</span>&nbsp;<span class="string" id="7528717">&#34;[::1]&#34;</span><span class="op" id="7528724">,</span>&nbsp;<span class="ident" id="7528726">ipv4map</span><span class="op" id="7528733">:</span>&nbsp;<span class="ident" id="7528735">true</span><span class="op" id="7528739">}</span><span class="op" id="7528740">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7528743">{</span><span class="ident" id="7528744">snet</span><span class="op" id="7528748">:</span>&nbsp;<span class="string" id="7528750">&#34;udp&#34;</span><span class="op" id="7528755">,</span>&nbsp;<span class="ident" id="7528757">saddr</span><span class="op" id="7528762">:</span>&nbsp;<span class="string" id="7528764">&#34;[::]&#34;</span><span class="op" id="7528770">,</span>&nbsp;<span class="ident" id="7528772">cnet</span><span class="op" id="7528776">:</span>&nbsp;<span class="string" id="7528778">&#34;udp&#34;</span><span class="op" id="7528783">,</span>&nbsp;<span class="ident" id="7528785">caddr</span><span class="op" id="7528790">:</span>&nbsp;<span class="string" id="7528792">&#34;127.0.0.1&#34;</span><span class="op" id="7528803">,</span>&nbsp;<span class="ident" id="7528805">ipv4map</span><span class="op" id="7528812">:</span>&nbsp;<span class="ident" id="7528814">true</span><span class="op" id="7528818">}</span><span class="op" id="7528819">,</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7528823">{</span><span class="ident" id="7528824">snet</span><span class="op" id="7528828">:</span>&nbsp;<span class="string" id="7528830">&#34;udp&#34;</span><span class="op" id="7528835">,</span>&nbsp;<span class="ident" id="7528837">saddr</span><span class="op" id="7528842">:</span>&nbsp;<span class="string" id="7528844">&#34;&#34;</span><span class="op" id="7528846">,</span>&nbsp;<span class="ident" id="7528848">cnet</span><span class="op" id="7528852">:</span>&nbsp;<span class="string" id="7528854">&#34;udp4&#34;</span><span class="op" id="7528860">,</span>&nbsp;<span class="ident" id="7528862">caddr</span><span class="op" id="7528867">:</span>&nbsp;<span class="string" id="7528869">&#34;127.0.0.1&#34;</span><span class="op" id="7528880">}</span><span class="op" id="7528881">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7528884">{</span><span class="ident" id="7528885">snet</span><span class="op" id="7528889">:</span>&nbsp;<span class="string" id="7528891">&#34;udp&#34;</span><span class="op" id="7528896">,</span>&nbsp;<span class="ident" id="7528898">saddr</span><span class="op" id="7528903">:</span>&nbsp;<span class="string" id="7528905">&#34;0.0.0.0&#34;</span><span class="op" id="7528914">,</span>&nbsp;<span class="ident" id="7528916">cnet</span><span class="op" id="7528920">:</span>&nbsp;<span class="string" id="7528922">&#34;udp4&#34;</span><span class="op" id="7528928">,</span>&nbsp;<span class="ident" id="7528930">caddr</span><span class="op" id="7528935">:</span>&nbsp;<span class="string" id="7528937">&#34;127.0.0.1&#34;</span><span class="op" id="7528948">}</span><span class="op" id="7528949">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7528952">{</span><span class="ident" id="7528953">snet</span><span class="op" id="7528957">:</span>&nbsp;<span class="string" id="7528959">&#34;udp&#34;</span><span class="op" id="7528964">,</span>&nbsp;<span class="ident" id="7528966">saddr</span><span class="op" id="7528971">:</span>&nbsp;<span class="string" id="7528973">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7528991">,</span>&nbsp;<span class="ident" id="7528993">cnet</span><span class="op" id="7528997">:</span>&nbsp;<span class="string" id="7528999">&#34;udp4&#34;</span><span class="op" id="7529005">,</span>&nbsp;<span class="ident" id="7529007">caddr</span><span class="op" id="7529012">:</span>&nbsp;<span class="string" id="7529014">&#34;127.0.0.1&#34;</span><span class="op" id="7529025">}</span><span class="op" id="7529026">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529029">{</span><span class="ident" id="7529030">snet</span><span class="op" id="7529034">:</span>&nbsp;<span class="string" id="7529036">&#34;udp&#34;</span><span class="op" id="7529041">,</span>&nbsp;<span class="ident" id="7529043">saddr</span><span class="op" id="7529048">:</span>&nbsp;<span class="string" id="7529050">&#34;[::]&#34;</span><span class="op" id="7529056">,</span>&nbsp;<span class="ident" id="7529058">cnet</span><span class="op" id="7529062">:</span>&nbsp;<span class="string" id="7529064">&#34;udp6&#34;</span><span class="op" id="7529070">,</span>&nbsp;<span class="ident" id="7529072">caddr</span><span class="op" id="7529077">:</span>&nbsp;<span class="string" id="7529079">&#34;[::1]&#34;</span><span class="op" id="7529086">,</span>&nbsp;<span class="ident" id="7529088">ipv6</span><span class="op" id="7529092">:</span>&nbsp;<span class="ident" id="7529094">true</span><span class="op" id="7529098">}</span><span class="op" id="7529099">,</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529103">{</span><span class="ident" id="7529104">snet</span><span class="op" id="7529108">:</span>&nbsp;<span class="string" id="7529110">&#34;udp&#34;</span><span class="op" id="7529115">,</span>&nbsp;<span class="ident" id="7529117">saddr</span><span class="op" id="7529122">:</span>&nbsp;<span class="string" id="7529124">&#34;&#34;</span><span class="op" id="7529126">,</span>&nbsp;<span class="ident" id="7529128">cnet</span><span class="op" id="7529132">:</span>&nbsp;<span class="string" id="7529134">&#34;udp6&#34;</span><span class="op" id="7529140">,</span>&nbsp;<span class="ident" id="7529142">caddr</span><span class="op" id="7529147">:</span>&nbsp;<span class="string" id="7529149">&#34;[::1]&#34;</span><span class="op" id="7529156">,</span>&nbsp;<span class="ident" id="7529158">ipv4map</span><span class="op" id="7529165">:</span>&nbsp;<span class="ident" id="7529167">true</span><span class="op" id="7529171">}</span><span class="op" id="7529172">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529175">{</span><span class="ident" id="7529176">snet</span><span class="op" id="7529180">:</span>&nbsp;<span class="string" id="7529182">&#34;udp&#34;</span><span class="op" id="7529187">,</span>&nbsp;<span class="ident" id="7529189">saddr</span><span class="op" id="7529194">:</span>&nbsp;<span class="string" id="7529196">&#34;0.0.0.0&#34;</span><span class="op" id="7529205">,</span>&nbsp;<span class="ident" id="7529207">cnet</span><span class="op" id="7529211">:</span>&nbsp;<span class="string" id="7529213">&#34;udp6&#34;</span><span class="op" id="7529219">,</span>&nbsp;<span class="ident" id="7529221">caddr</span><span class="op" id="7529226">:</span>&nbsp;<span class="string" id="7529228">&#34;[::1]&#34;</span><span class="op" id="7529235">,</span>&nbsp;<span class="ident" id="7529237">ipv4map</span><span class="op" id="7529244">:</span>&nbsp;<span class="ident" id="7529246">true</span><span class="op" id="7529250">}</span><span class="op" id="7529251">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529254">{</span><span class="ident" id="7529255">snet</span><span class="op" id="7529259">:</span>&nbsp;<span class="string" id="7529261">&#34;udp&#34;</span><span class="op" id="7529266">,</span>&nbsp;<span class="ident" id="7529268">saddr</span><span class="op" id="7529273">:</span>&nbsp;<span class="string" id="7529275">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7529293">,</span>&nbsp;<span class="ident" id="7529295">cnet</span><span class="op" id="7529299">:</span>&nbsp;<span class="string" id="7529301">&#34;udp6&#34;</span><span class="op" id="7529307">,</span>&nbsp;<span class="ident" id="7529309">caddr</span><span class="op" id="7529314">:</span>&nbsp;<span class="string" id="7529316">&#34;[::1]&#34;</span><span class="op" id="7529323">,</span>&nbsp;<span class="ident" id="7529325">ipv4map</span><span class="op" id="7529332">:</span>&nbsp;<span class="ident" id="7529334">true</span><span class="op" id="7529338">}</span><span class="op" id="7529339">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529342">{</span><span class="ident" id="7529343">snet</span><span class="op" id="7529347">:</span>&nbsp;<span class="string" id="7529349">&#34;udp&#34;</span><span class="op" id="7529354">,</span>&nbsp;<span class="ident" id="7529356">saddr</span><span class="op" id="7529361">:</span>&nbsp;<span class="string" id="7529363">&#34;[::]&#34;</span><span class="op" id="7529369">,</span>&nbsp;<span class="ident" id="7529371">cnet</span><span class="op" id="7529375">:</span>&nbsp;<span class="string" id="7529377">&#34;udp4&#34;</span><span class="op" id="7529383">,</span>&nbsp;<span class="ident" id="7529385">caddr</span><span class="op" id="7529390">:</span>&nbsp;<span class="string" id="7529392">&#34;127.0.0.1&#34;</span><span class="op" id="7529403">,</span>&nbsp;<span class="ident" id="7529405">ipv4map</span><span class="op" id="7529412">:</span>&nbsp;<span class="ident" id="7529414">true</span><span class="op" id="7529418">}</span><span class="op" id="7529419">,</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529423">{</span><span class="ident" id="7529424">snet</span><span class="op" id="7529428">:</span>&nbsp;<span class="string" id="7529430">&#34;udp&#34;</span><span class="op" id="7529435">,</span>&nbsp;<span class="ident" id="7529437">saddr</span><span class="op" id="7529442">:</span>&nbsp;<span class="string" id="7529444">&#34;127.0.0.1&#34;</span><span class="op" id="7529455">,</span>&nbsp;<span class="ident" id="7529457">cnet</span><span class="op" id="7529461">:</span>&nbsp;<span class="string" id="7529463">&#34;udp&#34;</span><span class="op" id="7529468">,</span>&nbsp;<span class="ident" id="7529470">caddr</span><span class="op" id="7529475">:</span>&nbsp;<span class="string" id="7529477">&#34;127.0.0.1&#34;</span><span class="op" id="7529488">}</span><span class="op" id="7529489">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529492">{</span><span class="ident" id="7529493">snet</span><span class="op" id="7529497">:</span>&nbsp;<span class="string" id="7529499">&#34;udp&#34;</span><span class="op" id="7529504">,</span>&nbsp;<span class="ident" id="7529506">saddr</span><span class="op" id="7529511">:</span>&nbsp;<span class="string" id="7529513">&#34;[::ffff:127.0.0.1]&#34;</span><span class="op" id="7529533">,</span>&nbsp;<span class="ident" id="7529535">cnet</span><span class="op" id="7529539">:</span>&nbsp;<span class="string" id="7529541">&#34;udp&#34;</span><span class="op" id="7529546">,</span>&nbsp;<span class="ident" id="7529548">caddr</span><span class="op" id="7529553">:</span>&nbsp;<span class="string" id="7529555">&#34;127.0.0.1&#34;</span><span class="op" id="7529566">}</span><span class="op" id="7529567">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529570">{</span><span class="ident" id="7529571">snet</span><span class="op" id="7529575">:</span>&nbsp;<span class="string" id="7529577">&#34;udp&#34;</span><span class="op" id="7529582">,</span>&nbsp;<span class="ident" id="7529584">saddr</span><span class="op" id="7529589">:</span>&nbsp;<span class="string" id="7529591">&#34;[::1]&#34;</span><span class="op" id="7529598">,</span>&nbsp;<span class="ident" id="7529600">cnet</span><span class="op" id="7529604">:</span>&nbsp;<span class="string" id="7529606">&#34;udp&#34;</span><span class="op" id="7529611">,</span>&nbsp;<span class="ident" id="7529613">caddr</span><span class="op" id="7529618">:</span>&nbsp;<span class="string" id="7529620">&#34;[::1]&#34;</span><span class="op" id="7529627">,</span>&nbsp;<span class="ident" id="7529629">ipv6</span><span class="op" id="7529633">:</span>&nbsp;<span class="ident" id="7529635">true</span><span class="op" id="7529639">}</span><span class="op" id="7529640">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529644">{</span><span class="ident" id="7529645">snet</span><span class="op" id="7529649">:</span>&nbsp;<span class="string" id="7529651">&#34;udp4&#34;</span><span class="op" id="7529657">,</span>&nbsp;<span class="ident" id="7529659">saddr</span><span class="op" id="7529664">:</span>&nbsp;<span class="string" id="7529666">&#34;&#34;</span><span class="op" id="7529668">,</span>&nbsp;<span class="ident" id="7529670">cnet</span><span class="op" id="7529674">:</span>&nbsp;<span class="string" id="7529676">&#34;udp4&#34;</span><span class="op" id="7529682">,</span>&nbsp;<span class="ident" id="7529684">caddr</span><span class="op" id="7529689">:</span>&nbsp;<span class="string" id="7529691">&#34;127.0.0.1&#34;</span><span class="op" id="7529702">}</span><span class="op" id="7529703">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529706">{</span><span class="ident" id="7529707">snet</span><span class="op" id="7529711">:</span>&nbsp;<span class="string" id="7529713">&#34;udp4&#34;</span><span class="op" id="7529719">,</span>&nbsp;<span class="ident" id="7529721">saddr</span><span class="op" id="7529726">:</span>&nbsp;<span class="string" id="7529728">&#34;0.0.0.0&#34;</span><span class="op" id="7529737">,</span>&nbsp;<span class="ident" id="7529739">cnet</span><span class="op" id="7529743">:</span>&nbsp;<span class="string" id="7529745">&#34;udp4&#34;</span><span class="op" id="7529751">,</span>&nbsp;<span class="ident" id="7529753">caddr</span><span class="op" id="7529758">:</span>&nbsp;<span class="string" id="7529760">&#34;127.0.0.1&#34;</span><span class="op" id="7529771">}</span><span class="op" id="7529772">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529775">{</span><span class="ident" id="7529776">snet</span><span class="op" id="7529780">:</span>&nbsp;<span class="string" id="7529782">&#34;udp4&#34;</span><span class="op" id="7529788">,</span>&nbsp;<span class="ident" id="7529790">saddr</span><span class="op" id="7529795">:</span>&nbsp;<span class="string" id="7529797">&#34;[::ffff:0.0.0.0]&#34;</span><span class="op" id="7529815">,</span>&nbsp;<span class="ident" id="7529817">cnet</span><span class="op" id="7529821">:</span>&nbsp;<span class="string" id="7529823">&#34;udp4&#34;</span><span class="op" id="7529829">,</span>&nbsp;<span class="ident" id="7529831">caddr</span><span class="op" id="7529836">:</span>&nbsp;<span class="string" id="7529838">&#34;127.0.0.1&#34;</span><span class="op" id="7529849">}</span><span class="op" id="7529850">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529854">{</span><span class="ident" id="7529855">snet</span><span class="op" id="7529859">:</span>&nbsp;<span class="string" id="7529861">&#34;udp4&#34;</span><span class="op" id="7529867">,</span>&nbsp;<span class="ident" id="7529869">saddr</span><span class="op" id="7529874">:</span>&nbsp;<span class="string" id="7529876">&#34;127.0.0.1&#34;</span><span class="op" id="7529887">,</span>&nbsp;<span class="ident" id="7529889">cnet</span><span class="op" id="7529893">:</span>&nbsp;<span class="string" id="7529895">&#34;udp4&#34;</span><span class="op" id="7529901">,</span>&nbsp;<span class="ident" id="7529903">caddr</span><span class="op" id="7529908">:</span>&nbsp;<span class="string" id="7529910">&#34;127.0.0.1&#34;</span><span class="op" id="7529921">}</span><span class="op" id="7529922">,</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529926">{</span><span class="ident" id="7529927">snet</span><span class="op" id="7529931">:</span>&nbsp;<span class="string" id="7529933">&#34;udp6&#34;</span><span class="op" id="7529939">,</span>&nbsp;<span class="ident" id="7529941">saddr</span><span class="op" id="7529946">:</span>&nbsp;<span class="string" id="7529948">&#34;&#34;</span><span class="op" id="7529950">,</span>&nbsp;<span class="ident" id="7529952">cnet</span><span class="op" id="7529956">:</span>&nbsp;<span class="string" id="7529958">&#34;udp6&#34;</span><span class="op" id="7529964">,</span>&nbsp;<span class="ident" id="7529966">caddr</span><span class="op" id="7529971">:</span>&nbsp;<span class="string" id="7529973">&#34;[::1]&#34;</span><span class="op" id="7529980">,</span>&nbsp;<span class="ident" id="7529982">ipv6</span><span class="op" id="7529986">:</span>&nbsp;<span class="ident" id="7529988">true</span><span class="op" id="7529992">}</span><span class="op" id="7529993">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7529996">{</span><span class="ident" id="7529997">snet</span><span class="op" id="7530001">:</span>&nbsp;<span class="string" id="7530003">&#34;udp6&#34;</span><span class="op" id="7530009">,</span>&nbsp;<span class="ident" id="7530011">saddr</span><span class="op" id="7530016">:</span>&nbsp;<span class="string" id="7530018">&#34;[::]&#34;</span><span class="op" id="7530024">,</span>&nbsp;<span class="ident" id="7530026">cnet</span><span class="op" id="7530030">:</span>&nbsp;<span class="string" id="7530032">&#34;udp6&#34;</span><span class="op" id="7530038">,</span>&nbsp;<span class="ident" id="7530040">caddr</span><span class="op" id="7530045">:</span>&nbsp;<span class="string" id="7530047">&#34;[::1]&#34;</span><span class="op" id="7530054">,</span>&nbsp;<span class="ident" id="7530056">ipv6</span><span class="op" id="7530060">:</span>&nbsp;<span class="ident" id="7530062">true</span><span class="op" id="7530066">}</span><span class="op" id="7530067">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7530071">{</span><span class="ident" id="7530072">snet</span><span class="op" id="7530076">:</span>&nbsp;<span class="string" id="7530078">&#34;udp6&#34;</span><span class="op" id="7530084">,</span>&nbsp;<span class="ident" id="7530086">saddr</span><span class="op" id="7530091">:</span>&nbsp;<span class="string" id="7530093">&#34;[::1]&#34;</span><span class="op" id="7530100">,</span>&nbsp;<span class="ident" id="7530102">cnet</span><span class="op" id="7530106">:</span>&nbsp;<span class="string" id="7530108">&#34;udp6&#34;</span><span class="op" id="7530114">,</span>&nbsp;<span class="ident" id="7530116">caddr</span><span class="op" id="7530121">:</span>&nbsp;<span class="string" id="7530123">&#34;[::1]&#34;</span><span class="op" id="7530130">,</span>&nbsp;<span class="ident" id="7530132">ipv6</span><span class="op" id="7530136">:</span>&nbsp;<span class="ident" id="7530138">true</span><span class="op" id="7530142">}</span><span class="op" id="7530143">,</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7530147">{</span><span class="ident" id="7530148">snet</span><span class="op" id="7530152">:</span>&nbsp;<span class="string" id="7530154">&#34;udp&#34;</span><span class="op" id="7530159">,</span>&nbsp;<span class="ident" id="7530161">saddr</span><span class="op" id="7530166">:</span>&nbsp;<span class="string" id="7530168">&#34;127.0.0.1&#34;</span><span class="op" id="7530179">,</span>&nbsp;<span class="ident" id="7530181">cnet</span><span class="op" id="7530185">:</span>&nbsp;<span class="string" id="7530187">&#34;udp&#34;</span><span class="op" id="7530192">,</span>&nbsp;<span class="ident" id="7530194">caddr</span><span class="op" id="7530199">:</span>&nbsp;<span class="string" id="7530201">&#34;127.0.0.1&#34;</span><span class="op" id="7530212">,</span>&nbsp;<span class="ident" id="7530214">dial</span><span class="op" id="7530218">:</span>&nbsp;<span class="ident" id="7530220">true</span><span class="op" id="7530224">}</span><span class="op" id="7530225">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7530228">{</span><span class="ident" id="7530229">snet</span><span class="op" id="7530233">:</span>&nbsp;<span class="string" id="7530235">&#34;udp&#34;</span><span class="op" id="7530240">,</span>&nbsp;<span class="ident" id="7530242">saddr</span><span class="op" id="7530247">:</span>&nbsp;<span class="string" id="7530249">&#34;127.0.0.1&#34;</span><span class="op" id="7530260">,</span>&nbsp;<span class="ident" id="7530262">cnet</span><span class="op" id="7530266">:</span>&nbsp;<span class="string" id="7530268">&#34;udp&#34;</span><span class="op" id="7530273">,</span>&nbsp;<span class="ident" id="7530275">caddr</span><span class="op" id="7530280">:</span>&nbsp;<span class="string" id="7530282">&#34;127.0.0.1&#34;</span><span class="op" id="7530293">,</span>&nbsp;<span class="ident" id="7530295">empty</span><span class="op" id="7530300">:</span>&nbsp;<span class="ident" id="7530302">true</span><span class="op" id="7530306">}</span><span class="op" id="7530307">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7530310">{</span><span class="ident" id="7530311">snet</span><span class="op" id="7530315">:</span>&nbsp;<span class="string" id="7530317">&#34;udp&#34;</span><span class="op" id="7530322">,</span>&nbsp;<span class="ident" id="7530324">saddr</span><span class="op" id="7530329">:</span>&nbsp;<span class="string" id="7530331">&#34;127.0.0.1&#34;</span><span class="op" id="7530342">,</span>&nbsp;<span class="ident" id="7530344">cnet</span><span class="op" id="7530348">:</span>&nbsp;<span class="string" id="7530350">&#34;udp&#34;</span><span class="op" id="7530355">,</span>&nbsp;<span class="ident" id="7530357">caddr</span><span class="op" id="7530362">:</span>&nbsp;<span class="string" id="7530364">&#34;127.0.0.1&#34;</span><span class="op" id="7530375">,</span>&nbsp;<span class="ident" id="7530377">dial</span><span class="op" id="7530381">:</span>&nbsp;<span class="ident" id="7530383">true</span><span class="op" id="7530387">,</span>&nbsp;<span class="ident" id="7530389">empty</span><span class="op" id="7530394">:</span>&nbsp;<span class="ident" id="7530396">true</span><span class="op" id="7530400">}</span><span class="op" id="7530401">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7530405">{</span><span class="ident" id="7530406">snet</span><span class="op" id="7530410">:</span>&nbsp;<span class="string" id="7530412">&#34;udp&#34;</span><span class="op" id="7530417">,</span>&nbsp;<span class="ident" id="7530419">saddr</span><span class="op" id="7530424">:</span>&nbsp;<span class="string" id="7530426">&#34;[::1]&#34;</span><span class="op" id="7530433">,</span>&nbsp;<span class="ident" id="7530435">cnet</span><span class="op" id="7530439">:</span>&nbsp;<span class="string" id="7530441">&#34;udp&#34;</span><span class="op" id="7530446">,</span>&nbsp;<span class="ident" id="7530448">caddr</span><span class="op" id="7530453">:</span>&nbsp;<span class="string" id="7530455">&#34;[::1]&#34;</span><span class="op" id="7530462">,</span>&nbsp;<span class="ident" id="7530464">ipv6</span><span class="op" id="7530468">:</span>&nbsp;<span class="ident" id="7530470">true</span><span class="op" id="7530474">,</span>&nbsp;<span class="ident" id="7530476">dial</span><span class="op" id="7530480">:</span>&nbsp;<span class="ident" id="7530482">true</span><span class="op" id="7530486">}</span><span class="op" id="7530487">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7530490">{</span><span class="ident" id="7530491">snet</span><span class="op" id="7530495">:</span>&nbsp;<span class="string" id="7530497">&#34;udp&#34;</span><span class="op" id="7530502">,</span>&nbsp;<span class="ident" id="7530504">saddr</span><span class="op" id="7530509">:</span>&nbsp;<span class="string" id="7530511">&#34;[::1]&#34;</span><span class="op" id="7530518">,</span>&nbsp;<span class="ident" id="7530520">cnet</span><span class="op" id="7530524">:</span>&nbsp;<span class="string" id="7530526">&#34;udp&#34;</span><span class="op" id="7530531">,</span>&nbsp;<span class="ident" id="7530533">caddr</span><span class="op" id="7530538">:</span>&nbsp;<span class="string" id="7530540">&#34;[::1]&#34;</span><span class="op" id="7530547">,</span>&nbsp;<span class="ident" id="7530549">ipv6</span><span class="op" id="7530553">:</span>&nbsp;<span class="ident" id="7530555">true</span><span class="op" id="7530559">,</span>&nbsp;<span class="ident" id="7530561">empty</span><span class="op" id="7530566">:</span>&nbsp;<span class="ident" id="7530568">true</span><span class="op" id="7530572">}</span><span class="op" id="7530573">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7530576">{</span><span class="ident" id="7530577">snet</span><span class="op" id="7530581">:</span>&nbsp;<span class="string" id="7530583">&#34;udp&#34;</span><span class="op" id="7530588">,</span>&nbsp;<span class="ident" id="7530590">saddr</span><span class="op" id="7530595">:</span>&nbsp;<span class="string" id="7530597">&#34;[::1]&#34;</span><span class="op" id="7530604">,</span>&nbsp;<span class="ident" id="7530606">cnet</span><span class="op" id="7530610">:</span>&nbsp;<span class="string" id="7530612">&#34;udp&#34;</span><span class="op" id="7530617">,</span>&nbsp;<span class="ident" id="7530619">caddr</span><span class="op" id="7530624">:</span>&nbsp;<span class="string" id="7530626">&#34;[::1]&#34;</span><span class="op" id="7530633">,</span>&nbsp;<span class="ident" id="7530635">ipv6</span><span class="op" id="7530639">:</span>&nbsp;<span class="ident" id="7530641">true</span><span class="op" id="7530645">,</span>&nbsp;<span class="ident" id="7530647">dial</span><span class="op" id="7530651">:</span>&nbsp;<span class="ident" id="7530653">true</span><span class="op" id="7530657">,</span>&nbsp;<span class="ident" id="7530659">empty</span><span class="op" id="7530664">:</span>&nbsp;<span class="ident" id="7530666">true</span><span class="op" id="7530670">}</span><span class="op" id="7530671">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7530675">{</span><span class="ident" id="7530676">snet</span><span class="op" id="7530680">:</span>&nbsp;<span class="string" id="7530682">&#34;unixgram&#34;</span><span class="op" id="7530692">,</span>&nbsp;<span class="ident" id="7530694">saddr</span><span class="op" id="7530699">:</span>&nbsp;<span class="ident" id="7530701">testUnixAddr</span><span class="op" id="7530713">(</span><span class="op" id="7530714">)</span><span class="op" id="7530715">,</span>&nbsp;<span class="ident" id="7530717">cnet</span><span class="op" id="7530721">:</span>&nbsp;<span class="string" id="7530723">&#34;unixgram&#34;</span><span class="op" id="7530733">,</span>&nbsp;<span class="ident" id="7530735">caddr</span><span class="op" id="7530740">:</span>&nbsp;<span class="ident" id="7530742">testUnixAddr</span><span class="op" id="7530754">(</span><span class="op" id="7530755">)</span><span class="op" id="7530756">}</span><span class="op" id="7530757">,</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7530760">{</span><span class="ident" id="7530761">snet</span><span class="op" id="7530765">:</span>&nbsp;<span class="string" id="7530767">&#34;unixgram&#34;</span><span class="op" id="7530777">,</span>&nbsp;<span class="ident" id="7530779">saddr</span><span class="op" id="7530784">:</span>&nbsp;<span class="ident" id="7530786">testUnixAddr</span><span class="op" id="7530798">(</span><span class="op" id="7530799">)</span><span class="op" id="7530800">,</span>&nbsp;<span class="ident" id="7530802">cnet</span><span class="op" id="7530806">:</span>&nbsp;<span class="string" id="7530808">&#34;unixgram&#34;</span><span class="op" id="7530818">,</span>&nbsp;<span class="ident" id="7530820">caddr</span><span class="op" id="7530825">:</span>&nbsp;<span class="ident" id="7530827">testUnixAddr</span><span class="op" id="7530839">(</span><span class="op" id="7530840">)</span><span class="op" id="7530841">,</span>&nbsp;<span class="ident" id="7530843">dial</span><span class="op" id="7530847">:</span>&nbsp;<span class="ident" id="7530849">true</span><span class="op" id="7530853">}</span><span class="op" id="7530854">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7530857">{</span><span class="ident" id="7530858">snet</span><span class="op" id="7530862">:</span>&nbsp;<span class="string" id="7530864">&#34;unixgram&#34;</span><span class="op" id="7530874">,</span>&nbsp;<span class="ident" id="7530876">saddr</span><span class="op" id="7530881">:</span>&nbsp;<span class="ident" id="7530883">testUnixAddr</span><span class="op" id="7530895">(</span><span class="op" id="7530896">)</span><span class="op" id="7530897">,</span>&nbsp;<span class="ident" id="7530899">cnet</span><span class="op" id="7530903">:</span>&nbsp;<span class="string" id="7530905">&#34;unixgram&#34;</span><span class="op" id="7530915">,</span>&nbsp;<span class="ident" id="7530917">caddr</span><span class="op" id="7530922">:</span>&nbsp;<span class="ident" id="7530924">testUnixAddr</span><span class="op" id="7530936">(</span><span class="op" id="7530937">)</span><span class="op" id="7530938">,</span>&nbsp;<span class="ident" id="7530940">empty</span><span class="op" id="7530945">:</span>&nbsp;<span class="ident" id="7530947">true</span><span class="op" id="7530951">}</span><span class="op" id="7530952">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7530955">{</span><span class="ident" id="7530956">snet</span><span class="op" id="7530960">:</span>&nbsp;<span class="string" id="7530962">&#34;unixgram&#34;</span><span class="op" id="7530972">,</span>&nbsp;<span class="ident" id="7530974">saddr</span><span class="op" id="7530979">:</span>&nbsp;<span class="ident" id="7530981">testUnixAddr</span><span class="op" id="7530993">(</span><span class="op" id="7530994">)</span><span class="op" id="7530995">,</span>&nbsp;<span class="ident" id="7530997">cnet</span><span class="op" id="7531001">:</span>&nbsp;<span class="string" id="7531003">&#34;unixgram&#34;</span><span class="op" id="7531013">,</span>&nbsp;<span class="ident" id="7531015">caddr</span><span class="op" id="7531020">:</span>&nbsp;<span class="ident" id="7531022">testUnixAddr</span><span class="op" id="7531034">(</span><span class="op" id="7531035">)</span><span class="op" id="7531036">,</span>&nbsp;<span class="ident" id="7531038">dial</span><span class="op" id="7531042">:</span>&nbsp;<span class="ident" id="7531044">true</span><span class="op" id="7531048">,</span>&nbsp;<span class="ident" id="7531050">empty</span><span class="op" id="7531055">:</span>&nbsp;<span class="ident" id="7531057">true</span><span class="op" id="7531061">}</span><span class="op" id="7531062">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531066">{</span><span class="ident" id="7531067">snet</span><span class="op" id="7531071">:</span>&nbsp;<span class="string" id="7531073">&#34;unixgram&#34;</span><span class="op" id="7531083">,</span>&nbsp;<span class="ident" id="7531085">saddr</span><span class="op" id="7531090">:</span>&nbsp;<span class="string" id="7531092">&#34;@gotest6/net&#34;</span><span class="op" id="7531106">,</span>&nbsp;<span class="ident" id="7531108">cnet</span><span class="op" id="7531112">:</span>&nbsp;<span class="string" id="7531114">&#34;unixgram&#34;</span><span class="op" id="7531124">,</span>&nbsp;<span class="ident" id="7531126">caddr</span><span class="op" id="7531131">:</span>&nbsp;<span class="string" id="7531133">&#34;@gotest6/net.local&#34;</span><span class="op" id="7531153">,</span>&nbsp;<span class="ident" id="7531155">linuxOnly</span><span class="op" id="7531164">:</span>&nbsp;<span class="ident" id="7531166">true</span><span class="op" id="7531170">}</span><span class="op" id="7531171">,</span><br>
<span class="lineno">310</span><span class="op" id="7531173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7531176">func</span>&nbsp;<span class="ident" id="7531181">TestDatagramPacketConnServer</span><span class="op" id="7531209">(</span><span class="ident" id="7531210">t</span>&nbsp;<span class="op" id="7531212">*</span><span class="ident" id="7531213">testing</span><span class="op" id="7531220">.</span><span class="ident" id="7531221">T</span><span class="op" id="7531222">)</span>&nbsp;<span class="op" id="7531224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7531227">if</span>&nbsp;<span class="op" id="7531230">!</span><span class="op" id="7531231">*</span><span class="ident" id="7531232">testDatagram</span>&nbsp;<span class="op" id="7531245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7531249">return</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7531261">for</span>&nbsp;<span class="ident" id="7531265">_</span><span class="op" id="7531266">,</span>&nbsp;<span class="ident" id="7531268">tt</span>&nbsp;<span class="op" id="7531271">:=</span>&nbsp;<span class="keyword" id="7531274">range</span>&nbsp;<span class="ident" id="7531280">datagramPacketConnServerTests</span>&nbsp;<span class="op" id="7531310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7531314">if</span>&nbsp;<span class="ident" id="7531317">skipServerTest</span><span class="op" id="7531331">(</span><span class="ident" id="7531332">tt</span><span class="op" id="7531334">.</span><span class="ident" id="7531335">snet</span><span class="op" id="7531339">,</span>&nbsp;<span class="string" id="7531341">&#34;unixgram&#34;</span><span class="op" id="7531351">,</span>&nbsp;<span class="ident" id="7531353">tt</span><span class="op" id="7531355">.</span><span class="ident" id="7531356">saddr</span><span class="op" id="7531361">,</span>&nbsp;<span class="ident" id="7531363">tt</span><span class="op" id="7531365">.</span><span class="ident" id="7531366">ipv6</span><span class="op" id="7531370">,</span>&nbsp;<span class="ident" id="7531372">tt</span><span class="op" id="7531374">.</span><span class="ident" id="7531375">ipv4map</span><span class="op" id="7531382">,</span>&nbsp;<span class="ident" id="7531384">tt</span><span class="op" id="7531386">.</span><span class="ident" id="7531387">linuxOnly</span><span class="op" id="7531396">)</span>&nbsp;<span class="op" id="7531398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7531403">continue</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531419">listening</span>&nbsp;<span class="op" id="7531429">:=</span>&nbsp;<span class="builtinfunc" id="7531432">make</span><span class="op" id="7531436">(</span><span class="keyword" id="7531437">chan</span>&nbsp;<span class="builtintype" id="7531442">string</span><span class="op" id="7531448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531452">done</span>&nbsp;<span class="op" id="7531457">:=</span>&nbsp;<span class="builtinfunc" id="7531460">make</span><span class="op" id="7531464">(</span><span class="keyword" id="7531465">chan</span>&nbsp;<span class="builtintype" id="7531470">int</span><span class="op" id="7531473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7531477">switch</span>&nbsp;<span class="ident" id="7531484">tt</span><span class="op" id="7531486">.</span><span class="ident" id="7531487">snet</span>&nbsp;<span class="op" id="7531492">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7531496">case</span>&nbsp;<span class="string" id="7531501">&#34;udp&#34;</span><span class="op" id="7531506">,</span>&nbsp;<span class="string" id="7531508">&#34;udp4&#34;</span><span class="op" id="7531514">,</span>&nbsp;<span class="string" id="7531516">&#34;udp6&#34;</span><span class="op" id="7531522">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531527">tt</span><span class="op" id="7531529">.</span><span class="ident" id="7531530">saddr</span>&nbsp;<span class="op" id="7531536">+=</span>&nbsp;<span class="string" id="7531539">&#34;:0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7531546">case</span>&nbsp;<span class="string" id="7531551">&#34;unixgram&#34;</span><span class="op" id="7531561">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531566">os</span><span class="op" id="7531568">.</span><span class="ident" id="7531569">Remove</span><span class="op" id="7531575">(</span><span class="ident" id="7531576">tt</span><span class="op" id="7531578">.</span><span class="ident" id="7531579">saddr</span><span class="op" id="7531584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531589">os</span><span class="op" id="7531591">.</span><span class="ident" id="7531592">Remove</span><span class="op" id="7531598">(</span><span class="ident" id="7531599">tt</span><span class="op" id="7531601">.</span><span class="ident" id="7531602">caddr</span><span class="op" id="7531607">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7531616">go</span>&nbsp;<span class="ident" id="7531619">runDatagramPacketConnServer</span><span class="op" id="7531646">(</span><span class="ident" id="7531647">t</span><span class="op" id="7531648">,</span>&nbsp;<span class="ident" id="7531650">tt</span><span class="op" id="7531652">.</span><span class="ident" id="7531653">snet</span><span class="op" id="7531657">,</span>&nbsp;<span class="ident" id="7531659">tt</span><span class="op" id="7531661">.</span><span class="ident" id="7531662">saddr</span><span class="op" id="7531667">,</span>&nbsp;<span class="ident" id="7531669">listening</span><span class="op" id="7531678">,</span>&nbsp;<span class="ident" id="7531680">done</span><span class="op" id="7531684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531688">taddr</span>&nbsp;<span class="op" id="7531694">:=</span>&nbsp;<span class="op" id="7531697">&lt;-</span><span class="ident" id="7531699">listening</span>&nbsp;<span class="comment" id="7531709">//&nbsp;wait&nbsp;for&nbsp;server&nbsp;to&nbsp;start</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7531740">switch</span>&nbsp;<span class="ident" id="7531747">tt</span><span class="op" id="7531749">.</span><span class="ident" id="7531750">cnet</span>&nbsp;<span class="op" id="7531755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7531759">case</span>&nbsp;<span class="string" id="7531764">&#34;udp&#34;</span><span class="op" id="7531769">,</span>&nbsp;<span class="string" id="7531771">&#34;udp4&#34;</span><span class="op" id="7531777">,</span>&nbsp;<span class="string" id="7531779">&#34;udp6&#34;</span><span class="op" id="7531785">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531790">_</span><span class="op" id="7531791">,</span>&nbsp;<span class="ident" id="7531793">port</span><span class="op" id="7531797">,</span>&nbsp;<span class="ident" id="7531799">err</span>&nbsp;<span class="op" id="7531803">:=</span>&nbsp;<span class="ident" id="7531806">SplitHostPort</span><span class="op" id="7531819">(</span><span class="ident" id="7531820">taddr</span><span class="op" id="7531825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7531830">if</span>&nbsp;<span class="ident" id="7531833">err</span>&nbsp;<span class="op" id="7531837">!=</span>&nbsp;<span class="ident" id="7531840">nil</span>&nbsp;<span class="op" id="7531844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531850">t</span><span class="op" id="7531851">.</span><span class="ident" id="7531852">Fatalf</span><span class="op" id="7531858">(</span><span class="string" id="7531859">&#34;SplitHostPort(%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7531889">,</span>&nbsp;<span class="ident" id="7531891">taddr</span><span class="op" id="7531896">,</span>&nbsp;<span class="ident" id="7531898">err</span><span class="op" id="7531901">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531911">taddr</span>&nbsp;<span class="op" id="7531917">=</span>&nbsp;<span class="ident" id="7531919">tt</span><span class="op" id="7531921">.</span><span class="ident" id="7531922">caddr</span>&nbsp;<span class="op" id="7531928">+</span>&nbsp;<span class="string" id="7531930">&#34;:&#34;</span>&nbsp;<span class="op" id="7531934">+</span>&nbsp;<span class="ident" id="7531936">port</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531944">tt</span><span class="op" id="7531946">.</span><span class="ident" id="7531947">caddr</span>&nbsp;<span class="op" id="7531953">+=</span>&nbsp;<span class="string" id="7531956">&#34;:0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7531963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7531967">if</span>&nbsp;<span class="ident" id="7531970">tt</span><span class="op" id="7531972">.</span><span class="ident" id="7531973">dial</span>&nbsp;<span class="op" id="7531978">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7531983">runDatagramConnClient</span><span class="op" id="7532004">(</span><span class="ident" id="7532005">t</span><span class="op" id="7532006">,</span>&nbsp;<span class="ident" id="7532008">tt</span><span class="op" id="7532010">.</span><span class="ident" id="7532011">cnet</span><span class="op" id="7532015">,</span>&nbsp;<span class="ident" id="7532017">tt</span><span class="op" id="7532019">.</span><span class="ident" id="7532020">caddr</span><span class="op" id="7532025">,</span>&nbsp;<span class="ident" id="7532027">taddr</span><span class="op" id="7532032">,</span>&nbsp;<span class="ident" id="7532034">tt</span><span class="op" id="7532036">.</span><span class="ident" id="7532037">empty</span><span class="op" id="7532042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532046">}</span>&nbsp;<span class="keyword" id="7532048">else</span>&nbsp;<span class="op" id="7532053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532058">runDatagramPacketConnClient</span><span class="op" id="7532085">(</span><span class="ident" id="7532086">t</span><span class="op" id="7532087">,</span>&nbsp;<span class="ident" id="7532089">tt</span><span class="op" id="7532091">.</span><span class="ident" id="7532092">cnet</span><span class="op" id="7532096">,</span>&nbsp;<span class="ident" id="7532098">tt</span><span class="op" id="7532100">.</span><span class="ident" id="7532101">caddr</span><span class="op" id="7532106">,</span>&nbsp;<span class="ident" id="7532108">taddr</span><span class="op" id="7532113">,</span>&nbsp;<span class="ident" id="7532115">tt</span><span class="op" id="7532117">.</span><span class="ident" id="7532118">empty</span><span class="op" id="7532123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532131">&lt;-</span><span class="ident" id="7532133">done</span>&nbsp;<span class="comment" id="7532138">//&nbsp;tell&nbsp;server&nbsp;to&nbsp;stop</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532163">&lt;-</span><span class="ident" id="7532165">done</span>&nbsp;<span class="comment" id="7532170">//&nbsp;make&nbsp;sure&nbsp;server&nbsp;stopped</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7532201">switch</span>&nbsp;<span class="ident" id="7532208">tt</span><span class="op" id="7532210">.</span><span class="ident" id="7532211">snet</span>&nbsp;<span class="op" id="7532216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7532220">case</span>&nbsp;<span class="string" id="7532225">&#34;unixgram&#34;</span><span class="op" id="7532235">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532240">os</span><span class="op" id="7532242">.</span><span class="ident" id="7532243">Remove</span><span class="op" id="7532249">(</span><span class="ident" id="7532250">tt</span><span class="op" id="7532252">.</span><span class="ident" id="7532253">saddr</span><span class="op" id="7532258">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532263">os</span><span class="op" id="7532265">.</span><span class="ident" id="7532266">Remove</span><span class="op" id="7532272">(</span><span class="ident" id="7532273">tt</span><span class="op" id="7532275">.</span><span class="ident" id="7532276">caddr</span><span class="op" id="7532281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532288">}</span><br>
<span class="lineno"></span><span class="op" id="7532290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="keyword" id="7532293">func</span>&nbsp;<span class="ident" id="7532298">runDatagramPacketConnServer</span><span class="op" id="7532325">(</span><span class="ident" id="7532326">t</span>&nbsp;<span class="op" id="7532328">*</span><span class="ident" id="7532329">testing</span><span class="op" id="7532336">.</span><span class="ident" id="7532337">T</span><span class="op" id="7532338">,</span>&nbsp;<span class="ident" id="7532340">net</span><span class="op" id="7532343">,</span>&nbsp;<span class="ident" id="7532345">laddr</span>&nbsp;<span class="builtintype" id="7532351">string</span><span class="op" id="7532357">,</span>&nbsp;<span class="ident" id="7532359">listening</span>&nbsp;<span class="keyword" id="7532369">chan</span><span class="op" id="7532373">&lt;-</span>&nbsp;<span class="builtintype" id="7532376">string</span><span class="op" id="7532382">,</span>&nbsp;<span class="ident" id="7532384">done</span>&nbsp;<span class="keyword" id="7532389">chan</span><span class="op" id="7532393">&lt;-</span>&nbsp;<span class="builtintype" id="7532396">int</span><span class="op" id="7532399">)</span>&nbsp;<span class="op" id="7532401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532404">c</span><span class="op" id="7532405">,</span>&nbsp;<span class="ident" id="7532407">err</span>&nbsp;<span class="op" id="7532411">:=</span>&nbsp;<span class="ident" id="7532414">ListenPacket</span><span class="op" id="7532426">(</span><span class="ident" id="7532427">net</span><span class="op" id="7532430">,</span>&nbsp;<span class="ident" id="7532432">laddr</span><span class="op" id="7532437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7532440">if</span>&nbsp;<span class="ident" id="7532443">err</span>&nbsp;<span class="op" id="7532447">!=</span>&nbsp;<span class="ident" id="7532450">nil</span>&nbsp;<span class="op" id="7532454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532458">t</span><span class="op" id="7532459">.</span><span class="ident" id="7532460">Errorf</span><span class="op" id="7532466">(</span><span class="string" id="7532467">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7532500">,</span>&nbsp;<span class="ident" id="7532502">net</span><span class="op" id="7532505">,</span>&nbsp;<span class="ident" id="7532507">laddr</span><span class="op" id="7532512">,</span>&nbsp;<span class="ident" id="7532514">err</span><span class="op" id="7532517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532521">listening</span>&nbsp;<span class="op" id="7532531">&lt;-</span>&nbsp;<span class="string" id="7532534">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532544">done</span>&nbsp;<span class="op" id="7532549">&lt;-</span>&nbsp;<span class="num" id="7532552">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7532556">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7532567">defer</span>&nbsp;<span class="ident" id="7532573">c</span><span class="op" id="7532574">.</span><span class="ident" id="7532575">Close</span><span class="op" id="7532580">(</span><span class="op" id="7532581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532584">listening</span>&nbsp;<span class="op" id="7532594">&lt;-</span>&nbsp;<span class="ident" id="7532597">c</span><span class="op" id="7532598">.</span><span class="ident" id="7532599">LocalAddr</span><span class="op" id="7532608">(</span><span class="op" id="7532609">)</span><span class="op" id="7532610">.</span><span class="ident" id="7532611">String</span><span class="op" id="7532617">(</span><span class="op" id="7532618">)</span><br>
<span class="lineno">370</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532622">buf</span>&nbsp;<span class="op" id="7532626">:=</span>&nbsp;<span class="builtinfunc" id="7532629">make</span><span class="op" id="7532633">(</span><span class="op" id="7532634">[</span><span class="op" id="7532635">]</span><span class="builtintype" id="7532636">byte</span><span class="op" id="7532640">,</span>&nbsp;<span class="num" id="7532642">1024</span><span class="op" id="7532646">)</span><br>
<span class="lineno"></span><span class="ident" id="7532648">run</span><span class="op" id="7532651">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7532654">for</span>&nbsp;<span class="op" id="7532658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532662">c</span><span class="op" id="7532663">.</span><span class="ident" id="7532664">SetReadDeadline</span><span class="op" id="7532679">(</span><span class="ident" id="7532680">time</span><span class="op" id="7532684">.</span><span class="ident" id="7532685">Now</span><span class="op" id="7532688">(</span><span class="op" id="7532689">)</span><span class="op" id="7532690">.</span><span class="ident" id="7532691">Add</span><span class="op" id="7532694">(</span><span class="num" id="7532695">10</span>&nbsp;<span class="op" id="7532698">*</span>&nbsp;<span class="ident" id="7532700">time</span><span class="op" id="7532704">.</span><span class="ident" id="7532705">Millisecond</span><span class="op" id="7532716">)</span><span class="op" id="7532717">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532721">n</span><span class="op" id="7532722">,</span>&nbsp;<span class="ident" id="7532724">ra</span><span class="op" id="7532726">,</span>&nbsp;<span class="ident" id="7532728">err</span>&nbsp;<span class="op" id="7532732">:=</span>&nbsp;<span class="ident" id="7532735">c</span><span class="op" id="7532736">.</span><span class="ident" id="7532737">ReadFrom</span><span class="op" id="7532745">(</span><span class="ident" id="7532746">buf</span><span class="op" id="7532749">[</span><span class="num" id="7532750">0</span><span class="op" id="7532751">:</span><span class="op" id="7532752">]</span><span class="op" id="7532753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7532757">if</span>&nbsp;<span class="ident" id="7532760">nerr</span><span class="op" id="7532764">,</span>&nbsp;<span class="ident" id="7532766">ok</span>&nbsp;<span class="op" id="7532769">:=</span>&nbsp;<span class="ident" id="7532772">err</span><span class="op" id="7532775">.</span><span class="op" id="7532776">(</span><span class="ident" id="7532777">Error</span><span class="op" id="7532782">)</span><span class="op" id="7532783">;</span>&nbsp;<span class="ident" id="7532785">ok</span>&nbsp;<span class="op" id="7532788">&amp;&amp;</span>&nbsp;<span class="ident" id="7532791">nerr</span><span class="op" id="7532795">.</span><span class="ident" id="7532796">Timeout</span><span class="op" id="7532803">(</span><span class="op" id="7532804">)</span>&nbsp;<span class="op" id="7532806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7532811">select</span>&nbsp;<span class="op" id="7532818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7532823">case</span>&nbsp;<span class="ident" id="7532828">done</span>&nbsp;<span class="op" id="7532833">&lt;-</span>&nbsp;<span class="num" id="7532836">1</span><span class="op" id="7532837">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7532843">break</span>&nbsp;<span class="ident" id="7532849">run</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7532856">default</span><span class="op" id="7532863">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7532869">continue</span>&nbsp;<span class="ident" id="7532878">run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7532893">if</span>&nbsp;<span class="ident" id="7532896">err</span>&nbsp;<span class="op" id="7532900">!=</span>&nbsp;<span class="ident" id="7532903">nil</span>&nbsp;<span class="op" id="7532907">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7532912">break</span>&nbsp;<span class="ident" id="7532918">run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7532924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7532928">if</span>&nbsp;<span class="ident" id="7532931">_</span><span class="op" id="7532932">,</span>&nbsp;<span class="ident" id="7532934">err</span>&nbsp;<span class="op" id="7532938">=</span>&nbsp;<span class="ident" id="7532940">c</span><span class="op" id="7532941">.</span><span class="ident" id="7532942">WriteTo</span><span class="op" id="7532949">(</span><span class="ident" id="7532950">buf</span><span class="op" id="7532953">[</span><span class="num" id="7532954">0</span><span class="op" id="7532955">:</span><span class="ident" id="7532956">n</span><span class="op" id="7532957">]</span><span class="op" id="7532958">,</span>&nbsp;<span class="ident" id="7532960">ra</span><span class="op" id="7532962">)</span><span class="op" id="7532963">;</span>&nbsp;<span class="ident" id="7532965">err</span>&nbsp;<span class="op" id="7532969">!=</span>&nbsp;<span class="ident" id="7532972">nil</span>&nbsp;<span class="op" id="7532976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7532981">t</span><span class="op" id="7532982">.</span><span class="ident" id="7532983">Errorf</span><span class="op" id="7532989">(</span><span class="string" id="7532990">&#34;WriteTo(%v)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7533014">,</span>&nbsp;<span class="ident" id="7533016">ra</span><span class="op" id="7533018">,</span>&nbsp;<span class="ident" id="7533020">err</span><span class="op" id="7533023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7533028">break</span>&nbsp;<span class="ident" id="7533034">run</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533046">done</span>&nbsp;<span class="op" id="7533051">&lt;-</span>&nbsp;<span class="num" id="7533054">1</span><br>
<span class="lineno"></span><span class="op" id="7533056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span><span class="keyword" id="7533059">func</span>&nbsp;<span class="ident" id="7533064">runDatagramConnClient</span><span class="op" id="7533085">(</span><span class="ident" id="7533086">t</span>&nbsp;<span class="op" id="7533088">*</span><span class="ident" id="7533089">testing</span><span class="op" id="7533096">.</span><span class="ident" id="7533097">T</span><span class="op" id="7533098">,</span>&nbsp;<span class="ident" id="7533100">net</span><span class="op" id="7533103">,</span>&nbsp;<span class="ident" id="7533105">laddr</span><span class="op" id="7533110">,</span>&nbsp;<span class="ident" id="7533112">taddr</span>&nbsp;<span class="builtintype" id="7533118">string</span><span class="op" id="7533124">,</span>&nbsp;<span class="ident" id="7533126">isEmpty</span>&nbsp;<span class="builtintype" id="7533134">bool</span><span class="op" id="7533138">)</span>&nbsp;<span class="op" id="7533140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7533143">var</span>&nbsp;<span class="ident" id="7533147">c</span>&nbsp;<span class="ident" id="7533149">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7533155">var</span>&nbsp;<span class="ident" id="7533159">err</span>&nbsp;<span class="builtintype" id="7533163">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7533170">switch</span>&nbsp;<span class="ident" id="7533177">net</span>&nbsp;<span class="op" id="7533181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7533184">case</span>&nbsp;<span class="string" id="7533189">&#34;udp&#34;</span><span class="op" id="7533194">,</span>&nbsp;<span class="string" id="7533196">&#34;udp4&#34;</span><span class="op" id="7533202">,</span>&nbsp;<span class="string" id="7533204">&#34;udp6&#34;</span><span class="op" id="7533210">:</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533214">c</span><span class="op" id="7533215">,</span>&nbsp;<span class="ident" id="7533217">err</span>&nbsp;<span class="op" id="7533221">=</span>&nbsp;<span class="ident" id="7533223">Dial</span><span class="op" id="7533227">(</span><span class="ident" id="7533228">net</span><span class="op" id="7533231">,</span>&nbsp;<span class="ident" id="7533233">taddr</span><span class="op" id="7533238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7533242">if</span>&nbsp;<span class="ident" id="7533245">err</span>&nbsp;<span class="op" id="7533249">!=</span>&nbsp;<span class="ident" id="7533252">nil</span>&nbsp;<span class="op" id="7533256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533261">t</span><span class="op" id="7533262">.</span><span class="ident" id="7533263">Fatalf</span><span class="op" id="7533269">(</span><span class="string" id="7533270">&#34;Dial(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7533295">,</span>&nbsp;<span class="ident" id="7533297">net</span><span class="op" id="7533300">,</span>&nbsp;<span class="ident" id="7533302">taddr</span><span class="op" id="7533307">,</span>&nbsp;<span class="ident" id="7533309">err</span><span class="op" id="7533312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7533319">case</span>&nbsp;<span class="string" id="7533324">&#34;unixgram&#34;</span><span class="op" id="7533334">:</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533338">c</span><span class="op" id="7533339">,</span>&nbsp;<span class="ident" id="7533341">err</span>&nbsp;<span class="op" id="7533345">=</span>&nbsp;<span class="ident" id="7533347">DialUnix</span><span class="op" id="7533355">(</span><span class="ident" id="7533356">net</span><span class="op" id="7533359">,</span>&nbsp;<span class="op" id="7533361">&amp;</span><span class="ident" id="7533362">UnixAddr</span><span class="op" id="7533370">{</span><span class="ident" id="7533371">Name</span><span class="op" id="7533375">:</span>&nbsp;<span class="ident" id="7533377">laddr</span><span class="op" id="7533382">,</span>&nbsp;<span class="ident" id="7533384">Net</span><span class="op" id="7533387">:</span>&nbsp;<span class="ident" id="7533389">net</span><span class="op" id="7533392">}</span><span class="op" id="7533393">,</span>&nbsp;<span class="op" id="7533395">&amp;</span><span class="ident" id="7533396">UnixAddr</span><span class="op" id="7533404">{</span><span class="ident" id="7533405">Name</span><span class="op" id="7533409">:</span>&nbsp;<span class="ident" id="7533411">taddr</span><span class="op" id="7533416">,</span>&nbsp;<span class="ident" id="7533418">Net</span><span class="op" id="7533421">:</span>&nbsp;<span class="ident" id="7533423">net</span><span class="op" id="7533426">}</span><span class="op" id="7533427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7533431">if</span>&nbsp;<span class="ident" id="7533434">err</span>&nbsp;<span class="op" id="7533438">!=</span>&nbsp;<span class="ident" id="7533441">nil</span>&nbsp;<span class="op" id="7533445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533450">t</span><span class="op" id="7533451">.</span><span class="ident" id="7533452">Fatalf</span><span class="op" id="7533458">(</span><span class="string" id="7533459">&#34;DialUnix(%q,&nbsp;{%q,&nbsp;%q})&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7533494">,</span>&nbsp;<span class="ident" id="7533496">net</span><span class="op" id="7533499">,</span>&nbsp;<span class="ident" id="7533501">laddr</span><span class="op" id="7533506">,</span>&nbsp;<span class="ident" id="7533508">taddr</span><span class="op" id="7533513">,</span>&nbsp;<span class="ident" id="7533515">err</span><span class="op" id="7533518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533525">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7533528">defer</span>&nbsp;<span class="ident" id="7533534">c</span><span class="op" id="7533535">.</span><span class="ident" id="7533536">Close</span><span class="op" id="7533541">(</span><span class="op" id="7533542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533545">c</span><span class="op" id="7533546">.</span><span class="ident" id="7533547">SetReadDeadline</span><span class="op" id="7533562">(</span><span class="ident" id="7533563">time</span><span class="op" id="7533567">.</span><span class="ident" id="7533568">Now</span><span class="op" id="7533571">(</span><span class="op" id="7533572">)</span><span class="op" id="7533573">.</span><span class="ident" id="7533574">Add</span><span class="op" id="7533577">(</span><span class="num" id="7533578">1</span>&nbsp;<span class="op" id="7533580">*</span>&nbsp;<span class="ident" id="7533582">time</span><span class="op" id="7533586">.</span><span class="ident" id="7533587">Second</span><span class="op" id="7533593">)</span><span class="op" id="7533594">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7533598">var</span>&nbsp;<span class="ident" id="7533602">wb</span>&nbsp;<span class="op" id="7533605">[</span><span class="op" id="7533606">]</span><span class="builtintype" id="7533607">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7533613">if</span>&nbsp;<span class="op" id="7533616">!</span><span class="ident" id="7533617">isEmpty</span>&nbsp;<span class="op" id="7533625">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533629">wb</span>&nbsp;<span class="op" id="7533632">=</span>&nbsp;<span class="op" id="7533634">[</span><span class="op" id="7533635">]</span><span class="builtintype" id="7533636">byte</span><span class="op" id="7533640">(</span><span class="string" id="7533641">&#34;DatagramConnClient&nbsp;by&nbsp;Dial\n&#34;</span><span class="op" id="7533671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7533677">if</span>&nbsp;<span class="ident" id="7533680">n</span><span class="op" id="7533681">,</span>&nbsp;<span class="ident" id="7533683">err</span>&nbsp;<span class="op" id="7533687">:=</span>&nbsp;<span class="ident" id="7533690">c</span><span class="op" id="7533691">.</span><span class="ident" id="7533692">Write</span><span class="op" id="7533697">(</span><span class="ident" id="7533698">wb</span><span class="op" id="7533700">[</span><span class="num" id="7533701">0</span><span class="op" id="7533702">:</span><span class="op" id="7533703">]</span><span class="op" id="7533704">)</span><span class="op" id="7533705">;</span>&nbsp;<span class="ident" id="7533707">err</span>&nbsp;<span class="op" id="7533711">!=</span>&nbsp;<span class="ident" id="7533714">nil</span>&nbsp;<span class="op" id="7533718">||</span>&nbsp;<span class="ident" id="7533721">n</span>&nbsp;<span class="op" id="7533723">!=</span>&nbsp;<span class="builtinfunc" id="7533726">len</span><span class="op" id="7533729">(</span><span class="ident" id="7533730">wb</span><span class="op" id="7533732">)</span>&nbsp;<span class="op" id="7533734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533738">t</span><span class="op" id="7533739">.</span><span class="ident" id="7533740">Fatalf</span><span class="op" id="7533746">(</span><span class="string" id="7533747">&#34;Write&nbsp;failed:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v,&nbsp;&lt;nil&gt;&#34;</span><span class="op" id="7533785">,</span>&nbsp;<span class="ident" id="7533787">n</span><span class="op" id="7533788">,</span>&nbsp;<span class="ident" id="7533790">err</span><span class="op" id="7533793">,</span>&nbsp;<span class="builtinfunc" id="7533795">len</span><span class="op" id="7533798">(</span><span class="ident" id="7533799">wb</span><span class="op" id="7533801">)</span><span class="op" id="7533802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533805">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533809">rb</span>&nbsp;<span class="op" id="7533812">:=</span>&nbsp;<span class="builtinfunc" id="7533815">make</span><span class="op" id="7533819">(</span><span class="op" id="7533820">[</span><span class="op" id="7533821">]</span><span class="builtintype" id="7533822">byte</span><span class="op" id="7533826">,</span>&nbsp;<span class="num" id="7533828">1024</span><span class="op" id="7533832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7533835">if</span>&nbsp;<span class="ident" id="7533838">n</span><span class="op" id="7533839">,</span>&nbsp;<span class="ident" id="7533841">err</span>&nbsp;<span class="op" id="7533845">:=</span>&nbsp;<span class="ident" id="7533848">c</span><span class="op" id="7533849">.</span><span class="ident" id="7533850">Read</span><span class="op" id="7533854">(</span><span class="ident" id="7533855">rb</span><span class="op" id="7533857">[</span><span class="num" id="7533858">0</span><span class="op" id="7533859">:</span><span class="op" id="7533860">]</span><span class="op" id="7533861">)</span><span class="op" id="7533862">;</span>&nbsp;<span class="ident" id="7533864">err</span>&nbsp;<span class="op" id="7533868">!=</span>&nbsp;<span class="ident" id="7533871">nil</span>&nbsp;<span class="op" id="7533875">||</span>&nbsp;<span class="ident" id="7533878">n</span>&nbsp;<span class="op" id="7533880">!=</span>&nbsp;<span class="builtinfunc" id="7533883">len</span><span class="op" id="7533886">(</span><span class="ident" id="7533887">wb</span><span class="op" id="7533889">)</span>&nbsp;<span class="op" id="7533891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7533895">t</span><span class="op" id="7533896">.</span><span class="ident" id="7533897">Fatalf</span><span class="op" id="7533903">(</span><span class="string" id="7533904">&#34;Read&nbsp;failed:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v,&nbsp;&lt;nil&gt;&#34;</span><span class="op" id="7533941">,</span>&nbsp;<span class="ident" id="7533943">n</span><span class="op" id="7533944">,</span>&nbsp;<span class="ident" id="7533946">err</span><span class="op" id="7533949">,</span>&nbsp;<span class="builtinfunc" id="7533951">len</span><span class="op" id="7533954">(</span><span class="ident" id="7533955">wb</span><span class="op" id="7533957">)</span><span class="op" id="7533958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7533961">}</span><br>
<span class="lineno">425</span><span class="op" id="7533963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7533966">func</span>&nbsp;<span class="ident" id="7533971">runDatagramPacketConnClient</span><span class="op" id="7533998">(</span><span class="ident" id="7533999">t</span>&nbsp;<span class="op" id="7534001">*</span><span class="ident" id="7534002">testing</span><span class="op" id="7534009">.</span><span class="ident" id="7534010">T</span><span class="op" id="7534011">,</span>&nbsp;<span class="ident" id="7534013">net</span><span class="op" id="7534016">,</span>&nbsp;<span class="ident" id="7534018">laddr</span><span class="op" id="7534023">,</span>&nbsp;<span class="ident" id="7534025">taddr</span>&nbsp;<span class="builtintype" id="7534031">string</span><span class="op" id="7534037">,</span>&nbsp;<span class="ident" id="7534039">isEmpty</span>&nbsp;<span class="builtintype" id="7534047">bool</span><span class="op" id="7534051">)</span>&nbsp;<span class="op" id="7534053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7534056">var</span>&nbsp;<span class="ident" id="7534060">ra</span>&nbsp;<span class="ident" id="7534063">Addr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7534069">var</span>&nbsp;<span class="ident" id="7534073">err</span>&nbsp;<span class="builtintype" id="7534077">error</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7534084">switch</span>&nbsp;<span class="ident" id="7534091">net</span>&nbsp;<span class="op" id="7534095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7534098">case</span>&nbsp;<span class="string" id="7534103">&#34;udp&#34;</span><span class="op" id="7534108">,</span>&nbsp;<span class="string" id="7534110">&#34;udp4&#34;</span><span class="op" id="7534116">,</span>&nbsp;<span class="string" id="7534118">&#34;udp6&#34;</span><span class="op" id="7534124">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534128">ra</span><span class="op" id="7534130">,</span>&nbsp;<span class="ident" id="7534132">err</span>&nbsp;<span class="op" id="7534136">=</span>&nbsp;<span class="ident" id="7534138">ResolveUDPAddr</span><span class="op" id="7534152">(</span><span class="ident" id="7534153">net</span><span class="op" id="7534156">,</span>&nbsp;<span class="ident" id="7534158">taddr</span><span class="op" id="7534163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7534167">if</span>&nbsp;<span class="ident" id="7534170">err</span>&nbsp;<span class="op" id="7534174">!=</span>&nbsp;<span class="ident" id="7534177">nil</span>&nbsp;<span class="op" id="7534181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534186">t</span><span class="op" id="7534187">.</span><span class="ident" id="7534188">Fatalf</span><span class="op" id="7534194">(</span><span class="string" id="7534195">&#34;ResolveUDPAddr(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7534230">,</span>&nbsp;<span class="ident" id="7534232">net</span><span class="op" id="7534235">,</span>&nbsp;<span class="ident" id="7534237">taddr</span><span class="op" id="7534242">,</span>&nbsp;<span class="ident" id="7534244">err</span><span class="op" id="7534247">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7534254">case</span>&nbsp;<span class="string" id="7534259">&#34;unixgram&#34;</span><span class="op" id="7534269">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534273">ra</span><span class="op" id="7534275">,</span>&nbsp;<span class="ident" id="7534277">err</span>&nbsp;<span class="op" id="7534281">=</span>&nbsp;<span class="ident" id="7534283">ResolveUnixAddr</span><span class="op" id="7534298">(</span><span class="ident" id="7534299">net</span><span class="op" id="7534302">,</span>&nbsp;<span class="ident" id="7534304">taddr</span><span class="op" id="7534309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7534313">if</span>&nbsp;<span class="ident" id="7534316">err</span>&nbsp;<span class="op" id="7534320">!=</span>&nbsp;<span class="ident" id="7534323">nil</span>&nbsp;<span class="op" id="7534327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534332">t</span><span class="op" id="7534333">.</span><span class="ident" id="7534334">Fatalf</span><span class="op" id="7534340">(</span><span class="string" id="7534341">&#34;ResolveUxixAddr(%q,&nbsp;%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7534377">,</span>&nbsp;<span class="ident" id="7534379">net</span><span class="op" id="7534382">,</span>&nbsp;<span class="ident" id="7534384">taddr</span><span class="op" id="7534389">,</span>&nbsp;<span class="ident" id="7534391">err</span><span class="op" id="7534394">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534398">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534404">c</span><span class="op" id="7534405">,</span>&nbsp;<span class="ident" id="7534407">err</span>&nbsp;<span class="op" id="7534411">:=</span>&nbsp;<span class="ident" id="7534414">ListenPacket</span><span class="op" id="7534426">(</span><span class="ident" id="7534427">net</span><span class="op" id="7534430">,</span>&nbsp;<span class="ident" id="7534432">laddr</span><span class="op" id="7534437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7534440">if</span>&nbsp;<span class="ident" id="7534443">err</span>&nbsp;<span class="op" id="7534447">!=</span>&nbsp;<span class="ident" id="7534450">nil</span>&nbsp;<span class="op" id="7534454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534458">t</span><span class="op" id="7534459">.</span><span class="ident" id="7534460">Fatalf</span><span class="op" id="7534466">(</span><span class="string" id="7534467">&#34;ListenPacket(%q,&nbsp;%q)&nbsp;faild:&nbsp;%v&#34;</span><span class="op" id="7534499">,</span>&nbsp;<span class="ident" id="7534501">net</span><span class="op" id="7534504">,</span>&nbsp;<span class="ident" id="7534506">laddr</span><span class="op" id="7534511">,</span>&nbsp;<span class="ident" id="7534513">err</span><span class="op" id="7534516">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534519">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7534522">defer</span>&nbsp;<span class="ident" id="7534528">c</span><span class="op" id="7534529">.</span><span class="ident" id="7534530">Close</span><span class="op" id="7534535">(</span><span class="op" id="7534536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534539">c</span><span class="op" id="7534540">.</span><span class="ident" id="7534541">SetReadDeadline</span><span class="op" id="7534556">(</span><span class="ident" id="7534557">time</span><span class="op" id="7534561">.</span><span class="ident" id="7534562">Now</span><span class="op" id="7534565">(</span><span class="op" id="7534566">)</span><span class="op" id="7534567">.</span><span class="ident" id="7534568">Add</span><span class="op" id="7534571">(</span><span class="num" id="7534572">1</span>&nbsp;<span class="op" id="7534574">*</span>&nbsp;<span class="ident" id="7534576">time</span><span class="op" id="7534580">.</span><span class="ident" id="7534581">Second</span><span class="op" id="7534587">)</span><span class="op" id="7534588">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7534592">var</span>&nbsp;<span class="ident" id="7534596">wb</span>&nbsp;<span class="op" id="7534599">[</span><span class="op" id="7534600">]</span><span class="builtintype" id="7534601">byte</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7534607">if</span>&nbsp;<span class="op" id="7534610">!</span><span class="ident" id="7534611">isEmpty</span>&nbsp;<span class="op" id="7534619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534623">wb</span>&nbsp;<span class="op" id="7534626">=</span>&nbsp;<span class="op" id="7534628">[</span><span class="op" id="7534629">]</span><span class="builtintype" id="7534630">byte</span><span class="op" id="7534634">(</span><span class="string" id="7534635">&#34;DatagramPacketConnClient&nbsp;by&nbsp;ListenPacket\n&#34;</span><span class="op" id="7534679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7534685">if</span>&nbsp;<span class="ident" id="7534688">n</span><span class="op" id="7534689">,</span>&nbsp;<span class="ident" id="7534691">err</span>&nbsp;<span class="op" id="7534695">:=</span>&nbsp;<span class="ident" id="7534698">c</span><span class="op" id="7534699">.</span><span class="ident" id="7534700">WriteTo</span><span class="op" id="7534707">(</span><span class="ident" id="7534708">wb</span><span class="op" id="7534710">[</span><span class="num" id="7534711">0</span><span class="op" id="7534712">:</span><span class="op" id="7534713">]</span><span class="op" id="7534714">,</span>&nbsp;<span class="ident" id="7534716">ra</span><span class="op" id="7534718">)</span><span class="op" id="7534719">;</span>&nbsp;<span class="ident" id="7534721">err</span>&nbsp;<span class="op" id="7534725">!=</span>&nbsp;<span class="ident" id="7534728">nil</span>&nbsp;<span class="op" id="7534732">||</span>&nbsp;<span class="ident" id="7534735">n</span>&nbsp;<span class="op" id="7534737">!=</span>&nbsp;<span class="builtinfunc" id="7534740">len</span><span class="op" id="7534743">(</span><span class="ident" id="7534744">wb</span><span class="op" id="7534746">)</span>&nbsp;<span class="op" id="7534748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534752">t</span><span class="op" id="7534753">.</span><span class="ident" id="7534754">Fatalf</span><span class="op" id="7534760">(</span><span class="string" id="7534761">&#34;WriteTo(%v)&nbsp;failed:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v,&nbsp;&lt;nil&gt;&#34;</span><span class="op" id="7534805">,</span>&nbsp;<span class="ident" id="7534807">ra</span><span class="op" id="7534809">,</span>&nbsp;<span class="ident" id="7534811">n</span><span class="op" id="7534812">,</span>&nbsp;<span class="ident" id="7534814">err</span><span class="op" id="7534817">,</span>&nbsp;<span class="builtinfunc" id="7534819">len</span><span class="op" id="7534822">(</span><span class="ident" id="7534823">wb</span><span class="op" id="7534825">)</span><span class="op" id="7534826">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534833">rb</span>&nbsp;<span class="op" id="7534836">:=</span>&nbsp;<span class="builtinfunc" id="7534839">make</span><span class="op" id="7534843">(</span><span class="op" id="7534844">[</span><span class="op" id="7534845">]</span><span class="builtintype" id="7534846">byte</span><span class="op" id="7534850">,</span>&nbsp;<span class="num" id="7534852">1024</span><span class="op" id="7534856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7534859">if</span>&nbsp;<span class="ident" id="7534862">n</span><span class="op" id="7534863">,</span>&nbsp;<span class="ident" id="7534865">_</span><span class="op" id="7534866">,</span>&nbsp;<span class="ident" id="7534868">err</span>&nbsp;<span class="op" id="7534872">:=</span>&nbsp;<span class="ident" id="7534875">c</span><span class="op" id="7534876">.</span><span class="ident" id="7534877">ReadFrom</span><span class="op" id="7534885">(</span><span class="ident" id="7534886">rb</span><span class="op" id="7534888">[</span><span class="num" id="7534889">0</span><span class="op" id="7534890">:</span><span class="op" id="7534891">]</span><span class="op" id="7534892">)</span><span class="op" id="7534893">;</span>&nbsp;<span class="ident" id="7534895">err</span>&nbsp;<span class="op" id="7534899">!=</span>&nbsp;<span class="ident" id="7534902">nil</span>&nbsp;<span class="op" id="7534906">||</span>&nbsp;<span class="ident" id="7534909">n</span>&nbsp;<span class="op" id="7534911">!=</span>&nbsp;<span class="builtinfunc" id="7534914">len</span><span class="op" id="7534917">(</span><span class="ident" id="7534918">wb</span><span class="op" id="7534920">)</span>&nbsp;<span class="op" id="7534922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7534926">t</span><span class="op" id="7534927">.</span><span class="ident" id="7534928">Fatalf</span><span class="op" id="7534934">(</span><span class="string" id="7534935">&#34;ReadFrom&nbsp;failed:&nbsp;%v,&nbsp;%v;&nbsp;want&nbsp;%v,&nbsp;&lt;nil&gt;&#34;</span><span class="op" id="7534976">,</span>&nbsp;<span class="ident" id="7534978">n</span><span class="op" id="7534979">,</span>&nbsp;<span class="ident" id="7534981">err</span><span class="op" id="7534984">,</span>&nbsp;<span class="builtinfunc" id="7534986">len</span><span class="op" id="7534989">(</span><span class="ident" id="7534990">wb</span><span class="op" id="7534992">)</span><span class="op" id="7534993">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7534996">}</span><br>
<span class="lineno"></span><span class="op" id="7534998">}</span>
</div>
</body>
</html>
