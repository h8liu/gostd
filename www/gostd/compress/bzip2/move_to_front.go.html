<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/bzip2</h2>
<ul>
<li><a href="/gostd/compress/bzip2/bit_reader.go.html">bit_reader.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2.go.html">bzip2.go</a></li>
<li><a href="/gostd/compress/bzip2/bzip2_test.go.html">bzip2_test.go</a></li>
<li><a href="/gostd/compress/bzip2/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/compress/bzip2/move_to_front.go.html" class="current">move_to_front.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5987749">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5987804">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5987858">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5987909">package</span>&nbsp;<span class="ident" id="5987917">bzip2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5987924">//&nbsp;moveToFrontDecoder&nbsp;implements&nbsp;a&nbsp;move-to-front&nbsp;list.&nbsp;Such&nbsp;a&nbsp;list&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5987997">//&nbsp;efficient&nbsp;way&nbsp;to&nbsp;transform&nbsp;a&nbsp;string&nbsp;with&nbsp;repeating&nbsp;elements&nbsp;into&nbsp;one&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5988074">//&nbsp;many&nbsp;small&nbsp;valued&nbsp;numbers,&nbsp;which&nbsp;is&nbsp;suitable&nbsp;for&nbsp;entropy&nbsp;encoding.&nbsp;It&nbsp;works</span><br>
<span class="lineno">10</span><span class="comment" id="5988153">//&nbsp;by&nbsp;starting&nbsp;with&nbsp;an&nbsp;initial&nbsp;list&nbsp;of&nbsp;symbols&nbsp;and&nbsp;references&nbsp;symbols&nbsp;by&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="5988232">//&nbsp;index&nbsp;into&nbsp;that&nbsp;list.&nbsp;When&nbsp;a&nbsp;symbol&nbsp;is&nbsp;referenced,&nbsp;it&#39;s&nbsp;moved&nbsp;to&nbsp;the&nbsp;front</span><br>
<span class="lineno"></span><span class="comment" id="5988310">//&nbsp;of&nbsp;the&nbsp;list.&nbsp;Thus,&nbsp;a&nbsp;repeated&nbsp;symbol&nbsp;ends&nbsp;up&nbsp;being&nbsp;encoded&nbsp;with&nbsp;many&nbsp;zeros,</span><br>
<span class="lineno"></span><span class="comment" id="5988389">//&nbsp;as&nbsp;the&nbsp;symbol&nbsp;will&nbsp;be&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list&nbsp;after&nbsp;the&nbsp;first&nbsp;access.</span><br>
<span class="lineno"></span><span class="keyword" id="5988463">type</span>&nbsp;<span class="ident" id="5988468">moveToFrontDecoder</span>&nbsp;<span class="op" id="5988487">[</span><span class="op" id="5988488">]</span><span class="builtintype" id="5988489">byte</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5988495">//&nbsp;newMTFDecoder&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;explicit&nbsp;initial&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="5988574">//&nbsp;of&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="keyword" id="5988589">func</span>&nbsp;<span class="ident" id="5988594">newMTFDecoder</span><span class="op" id="5988607">(</span><span class="ident" id="5988608">symbols</span>&nbsp;<span class="op" id="5988616">[</span><span class="op" id="5988617">]</span><span class="builtintype" id="5988618">byte</span><span class="op" id="5988622">)</span>&nbsp;<span class="ident" id="5988624">moveToFrontDecoder</span>&nbsp;<span class="op" id="5988643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5988646">if</span>&nbsp;<span class="builtinfunc" id="5988649">len</span><span class="op" id="5988652">(</span><span class="ident" id="5988653">symbols</span><span class="op" id="5988660">)</span>&nbsp;<span class="op" id="5988662">&gt;</span>&nbsp;<span class="num" id="5988664">256</span>&nbsp;<span class="op" id="5988668">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5988672">panic</span><span class="op" id="5988677">(</span><span class="string" id="5988678">&#34;too&nbsp;many&nbsp;symbols&#34;</span><span class="op" id="5988696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5988699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5988702">return</span>&nbsp;<span class="ident" id="5988709">moveToFrontDecoder</span><span class="op" id="5988727">(</span><span class="ident" id="5988728">symbols</span><span class="op" id="5988735">)</span><br>
<span class="lineno"></span><span class="op" id="5988737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5988740">//&nbsp;newMTFDecoderWithRange&nbsp;creates&nbsp;a&nbsp;move-to-front&nbsp;decoder&nbsp;with&nbsp;an&nbsp;initial</span><br>
<span class="lineno"></span><span class="comment" id="5988814">//&nbsp;symbol&nbsp;list&nbsp;of&nbsp;0...n-1.</span><br>
<span class="lineno"></span><span class="keyword" id="5988841">func</span>&nbsp;<span class="ident" id="5988846">newMTFDecoderWithRange</span><span class="op" id="5988868">(</span><span class="ident" id="5988869">n</span>&nbsp;<span class="builtintype" id="5988871">int</span><span class="op" id="5988874">)</span>&nbsp;<span class="ident" id="5988876">moveToFrontDecoder</span>&nbsp;<span class="op" id="5988895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5988898">if</span>&nbsp;<span class="ident" id="5988901">n</span>&nbsp;<span class="op" id="5988903">&gt;</span>&nbsp;<span class="num" id="5988905">256</span>&nbsp;<span class="op" id="5988909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5988913">panic</span><span class="op" id="5988918">(</span><span class="string" id="5988919">&#34;newMTFDecoderWithRange:&nbsp;cannot&nbsp;have&nbsp;&gt;&nbsp;256&nbsp;symbols&#34;</span><span class="op" id="5988970">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5988973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5988977">m</span>&nbsp;<span class="op" id="5988979">:=</span>&nbsp;<span class="builtinfunc" id="5988982">make</span><span class="op" id="5988986">(</span><span class="op" id="5988987">[</span><span class="op" id="5988988">]</span><span class="builtintype" id="5988989">byte</span><span class="op" id="5988993">,</span>&nbsp;<span class="ident" id="5988995">n</span><span class="op" id="5988996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5988999">for</span>&nbsp;<span class="ident" id="5989003">i</span>&nbsp;<span class="op" id="5989005">:=</span>&nbsp;<span class="num" id="5989008">0</span><span class="op" id="5989009">;</span>&nbsp;<span class="ident" id="5989011">i</span>&nbsp;<span class="op" id="5989013">&lt;</span>&nbsp;<span class="ident" id="5989015">n</span><span class="op" id="5989016">;</span>&nbsp;<span class="ident" id="5989018">i</span><span class="op" id="5989019">++</span>&nbsp;<span class="op" id="5989022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989026">m</span><span class="op" id="5989027">[</span><span class="ident" id="5989028">i</span><span class="op" id="5989029">]</span>&nbsp;<span class="op" id="5989031">=</span>&nbsp;<span class="builtintype" id="5989033">byte</span><span class="op" id="5989037">(</span><span class="ident" id="5989038">i</span><span class="op" id="5989039">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5989042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5989045">return</span>&nbsp;<span class="ident" id="5989052">moveToFrontDecoder</span><span class="op" id="5989070">(</span><span class="ident" id="5989071">m</span><span class="op" id="5989072">)</span><br>
<span class="lineno"></span><span class="op" id="5989074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5989077">func</span>&nbsp;<span class="op" id="5989082">(</span><span class="ident" id="5989083">m</span>&nbsp;<span class="ident" id="5989085">moveToFrontDecoder</span><span class="op" id="5989103">)</span>&nbsp;<span class="ident" id="5989105">Decode</span><span class="op" id="5989111">(</span><span class="ident" id="5989112">n</span>&nbsp;<span class="builtintype" id="5989114">int</span><span class="op" id="5989117">)</span>&nbsp;<span class="op" id="5989119">(</span><span class="ident" id="5989120">b</span>&nbsp;<span class="builtintype" id="5989122">byte</span><span class="op" id="5989126">)</span>&nbsp;<span class="op" id="5989128">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5989131">//&nbsp;Implement&nbsp;move-to-front&nbsp;with&nbsp;a&nbsp;simple&nbsp;copy.&nbsp;This&nbsp;approach</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5989193">//&nbsp;beats&nbsp;more&nbsp;sophisticated&nbsp;approaches&nbsp;in&nbsp;benchmarking,&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5989259">//&nbsp;because&nbsp;it&nbsp;has&nbsp;high&nbsp;locality&nbsp;of&nbsp;reference&nbsp;inside&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5989317">//&nbsp;single&nbsp;cache&nbsp;line&nbsp;(most&nbsp;move-to-front&nbsp;operations&nbsp;have&nbsp;n&nbsp;&lt;&nbsp;64).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989384">b</span>&nbsp;<span class="op" id="5989386">=</span>&nbsp;<span class="ident" id="5989388">m</span><span class="op" id="5989389">[</span><span class="ident" id="5989390">n</span><span class="op" id="5989391">]</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5989394">copy</span><span class="op" id="5989398">(</span><span class="ident" id="5989399">m</span><span class="op" id="5989400">[</span><span class="num" id="5989401">1</span><span class="op" id="5989402">:</span><span class="op" id="5989403">]</span><span class="op" id="5989404">,</span>&nbsp;<span class="ident" id="5989406">m</span><span class="op" id="5989407">[</span><span class="op" id="5989408">:</span><span class="ident" id="5989409">n</span><span class="op" id="5989410">]</span><span class="op" id="5989411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5989414">m</span><span class="op" id="5989415">[</span><span class="num" id="5989416">0</span><span class="op" id="5989417">]</span>&nbsp;<span class="op" id="5989419">=</span>&nbsp;<span class="ident" id="5989421">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5989424">return</span><br>
<span class="lineno"></span><span class="op" id="5989431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5989434">//&nbsp;First&nbsp;returns&nbsp;the&nbsp;symbol&nbsp;at&nbsp;the&nbsp;front&nbsp;of&nbsp;the&nbsp;list.</span><br>
<span class="lineno"></span><span class="keyword" id="5989488">func</span>&nbsp;<span class="op" id="5989493">(</span><span class="ident" id="5989494">m</span>&nbsp;<span class="ident" id="5989496">moveToFrontDecoder</span><span class="op" id="5989514">)</span>&nbsp;<span class="ident" id="5989516">First</span><span class="op" id="5989521">(</span><span class="op" id="5989522">)</span>&nbsp;<span class="builtintype" id="5989524">byte</span>&nbsp;<span class="op" id="5989529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5989532">return</span>&nbsp;<span class="ident" id="5989539">m</span><span class="op" id="5989540">[</span><span class="num" id="5989541">0</span><span class="op" id="5989542">]</span><br>
<span class="lineno"></span><span class="op" id="5989544">}</span>
</div>
</body>
</html>
