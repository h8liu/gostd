<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4015239">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4015294">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4015348">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4015399">package</span>&nbsp;<span class="ident" id="4015407">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4015412">import</span>&nbsp;<span class="op" id="4015419">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4015422">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4015434">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4015444">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4015451">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4015457">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4015468">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4015476">&#34;sync/atomic&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4015491">&#34;unicode&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4015502">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4015517">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4015520">//&nbsp;userTypeInfo&nbsp;stores&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;a&nbsp;type&nbsp;the&nbsp;user&nbsp;has&nbsp;handed</span><br>
<span class="lineno">20</span><span class="comment" id="4015602">//&nbsp;to&nbsp;the&nbsp;package.&nbsp;&nbsp;It&#39;s&nbsp;computed&nbsp;once&nbsp;and&nbsp;stored&nbsp;in&nbsp;a&nbsp;map&nbsp;keyed&nbsp;by&nbsp;reflection</span><br>
<span class="lineno"></span><span class="comment" id="4015681">//&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="4015690">type</span>&nbsp;<span class="ident" id="4015695">userTypeInfo</span>&nbsp;<span class="keyword" id="4015708">struct</span>&nbsp;<span class="op" id="4015715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015718">user</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4015730">reflect</span><span class="op" id="4015737">.</span><span class="ident" id="4015738">Type</span>&nbsp;<span class="comment" id="4015743">//&nbsp;the&nbsp;type&nbsp;the&nbsp;user&nbsp;handed&nbsp;us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015775">base</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4015787">reflect</span><span class="op" id="4015794">.</span><span class="ident" id="4015795">Type</span>&nbsp;<span class="comment" id="4015800">//&nbsp;the&nbsp;base&nbsp;type&nbsp;after&nbsp;all&nbsp;indirections</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015841">indir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4015853">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4015866">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;base&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015916">externalEnc</span>&nbsp;<span class="builtintype" id="4015928">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4015941">//&nbsp;xGob,&nbsp;xBinary,&nbsp;or&nbsp;xText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4015969">externalDec</span>&nbsp;<span class="builtintype" id="4015981">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4015994">//&nbsp;xGob,&nbsp;xBinary&nbsp;or&nbsp;xText</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016021">encIndir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4016033">int8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4016046">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;receiver&nbsp;type;&nbsp;may&nbsp;be&nbsp;negative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016117">decIndir</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4016129">int8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4016142">//&nbsp;number&nbsp;of&nbsp;indirections&nbsp;to&nbsp;reach&nbsp;the&nbsp;receiver&nbsp;type;&nbsp;may&nbsp;be&nbsp;negative</span><br>
<span class="lineno">30</span><span class="op" id="4016212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4016215">//&nbsp;externalEncoding&nbsp;bits</span><br>
<span class="lineno"></span><span class="keyword" id="4016240">const</span>&nbsp;<span class="op" id="4016246">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016249">xGob</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4016257">=</span>&nbsp;<span class="num" id="4016259">1</span>&nbsp;<span class="op" id="4016261">+</span>&nbsp;<span class="ident" id="4016263">iota</span>&nbsp;<span class="comment" id="4016268">//&nbsp;GobEncoder&nbsp;or&nbsp;GobDecoder</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016297">xBinary</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4016316">//&nbsp;encoding.BinaryMarshaler&nbsp;or&nbsp;encoding.BinaryUnmarshaler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016375">xText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4016394">//&nbsp;encoding.TextMarshaler&nbsp;or&nbsp;encoding.TextUnmarshaler</span><br>
<span class="lineno"></span><span class="op" id="4016448">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4016451">var</span>&nbsp;<span class="op" id="4016455">(</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4016458">//&nbsp;Protected&nbsp;by&nbsp;an&nbsp;RWMutex&nbsp;because&nbsp;we&nbsp;read&nbsp;it&nbsp;a&nbsp;lot&nbsp;and&nbsp;write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4016521">//&nbsp;it&nbsp;only&nbsp;when&nbsp;we&nbsp;see&nbsp;a&nbsp;new&nbsp;type,&nbsp;typically&nbsp;when&nbsp;compiling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016583">userTypeLock</span>&nbsp;&nbsp;<span class="ident" id="4016597">sync</span><span class="op" id="4016601">.</span><span class="ident" id="4016602">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016611">userTypeCache</span>&nbsp;<span class="op" id="4016625">=</span>&nbsp;<span class="builtinfunc" id="4016627">make</span><span class="op" id="4016631">(</span><span class="keyword" id="4016632">map</span><span class="op" id="4016635">[</span><span class="ident" id="4016636">reflect</span><span class="op" id="4016643">.</span><span class="ident" id="4016644">Type</span><span class="op" id="4016648">]</span><span class="op" id="4016649">*</span><span class="ident" id="4016650">userTypeInfo</span><span class="op" id="4016662">)</span><br>
<span class="lineno"></span><span class="op" id="4016664">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="4016667">//&nbsp;validType&nbsp;returns,&nbsp;and&nbsp;saves,&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;user-provided&nbsp;type&nbsp;rt.</span><br>
<span class="lineno"></span><span class="comment" id="4016755">//&nbsp;If&nbsp;the&nbsp;user&nbsp;type&nbsp;is&nbsp;not&nbsp;valid,&nbsp;err&nbsp;will&nbsp;be&nbsp;non-nil.&nbsp;&nbsp;To&nbsp;be&nbsp;used&nbsp;when&nbsp;the&nbsp;error&nbsp;handler</span><br>
<span class="lineno"></span><span class="comment" id="4016845">//&nbsp;is&nbsp;not&nbsp;set&nbsp;up.</span><br>
<span class="lineno"></span><span class="keyword" id="4016863">func</span>&nbsp;<span class="ident" id="4016868">validUserType</span><span class="op" id="4016881">(</span><span class="ident" id="4016882">rt</span>&nbsp;<span class="ident" id="4016885">reflect</span><span class="op" id="4016892">.</span><span class="ident" id="4016893">Type</span><span class="op" id="4016897">)</span>&nbsp;<span class="op" id="4016899">(</span><span class="ident" id="4016900">ut</span>&nbsp;<span class="op" id="4016903">*</span><span class="ident" id="4016904">userTypeInfo</span><span class="op" id="4016916">,</span>&nbsp;<span class="ident" id="4016918">err</span>&nbsp;<span class="builtintype" id="4016922">error</span><span class="op" id="4016927">)</span>&nbsp;<span class="op" id="4016929">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016932">userTypeLock</span><span class="op" id="4016944">.</span><span class="ident" id="4016945">RLock</span><span class="op" id="4016950">(</span><span class="op" id="4016951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016954">ut</span>&nbsp;<span class="op" id="4016957">=</span>&nbsp;<span class="ident" id="4016959">userTypeCache</span><span class="op" id="4016972">[</span><span class="ident" id="4016973">rt</span><span class="op" id="4016975">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4016978">userTypeLock</span><span class="op" id="4016990">.</span><span class="ident" id="4016991">RUnlock</span><span class="op" id="4016998">(</span><span class="op" id="4016999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017002">if</span>&nbsp;<span class="ident" id="4017005">ut</span>&nbsp;<span class="op" id="4017008">!=</span>&nbsp;<span class="ident" id="4017011">nil</span>&nbsp;<span class="op" id="4017015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017019">return</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4017027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4017030">//&nbsp;Now&nbsp;set&nbsp;the&nbsp;value&nbsp;under&nbsp;the&nbsp;write&nbsp;lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017074">userTypeLock</span><span class="op" id="4017086">.</span><span class="ident" id="4017087">Lock</span><span class="op" id="4017091">(</span><span class="op" id="4017092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017095">defer</span>&nbsp;<span class="ident" id="4017101">userTypeLock</span><span class="op" id="4017113">.</span><span class="ident" id="4017114">Unlock</span><span class="op" id="4017120">(</span><span class="op" id="4017121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017124">if</span>&nbsp;<span class="ident" id="4017127">ut</span>&nbsp;<span class="op" id="4017130">=</span>&nbsp;<span class="ident" id="4017132">userTypeCache</span><span class="op" id="4017145">[</span><span class="ident" id="4017146">rt</span><span class="op" id="4017148">]</span><span class="op" id="4017149">;</span>&nbsp;<span class="ident" id="4017151">ut</span>&nbsp;<span class="op" id="4017154">!=</span>&nbsp;<span class="ident" id="4017157">nil</span>&nbsp;<span class="op" id="4017161">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4017165">//&nbsp;Lost&nbsp;the&nbsp;race;&nbsp;not&nbsp;a&nbsp;problem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017200">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4017208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017211">ut</span>&nbsp;<span class="op" id="4017214">=</span>&nbsp;<span class="builtinfunc" id="4017216">new</span><span class="op" id="4017219">(</span><span class="ident" id="4017220">userTypeInfo</span><span class="op" id="4017232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017235">ut</span><span class="op" id="4017237">.</span><span class="ident" id="4017238">base</span>&nbsp;<span class="op" id="4017243">=</span>&nbsp;<span class="ident" id="4017245">rt</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017249">ut</span><span class="op" id="4017251">.</span><span class="ident" id="4017252">user</span>&nbsp;<span class="op" id="4017257">=</span>&nbsp;<span class="ident" id="4017259">rt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4017263">//&nbsp;A&nbsp;type&nbsp;that&nbsp;is&nbsp;just&nbsp;a&nbsp;cycle&nbsp;of&nbsp;pointers&nbsp;(such&nbsp;as&nbsp;type&nbsp;T&nbsp;*T)&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4017334">//&nbsp;be&nbsp;represented&nbsp;in&nbsp;gobs,&nbsp;which&nbsp;need&nbsp;some&nbsp;concrete&nbsp;data.&nbsp;&nbsp;We&nbsp;use&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4017403">//&nbsp;cycle&nbsp;detection&nbsp;algorithm&nbsp;from&nbsp;Knuth,&nbsp;Vol&nbsp;2,&nbsp;Section&nbsp;3.1,&nbsp;Ex&nbsp;6,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4017471">//&nbsp;pp&nbsp;539-540.&nbsp;&nbsp;As&nbsp;we&nbsp;step&nbsp;through&nbsp;indirections,&nbsp;run&nbsp;another&nbsp;type&nbsp;at</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4017541">//&nbsp;half&nbsp;speed.&nbsp;If&nbsp;they&nbsp;meet&nbsp;up,&nbsp;there&#39;s&nbsp;a&nbsp;cycle.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017591">slowpoke</span>&nbsp;<span class="op" id="4017600">:=</span>&nbsp;<span class="ident" id="4017603">ut</span><span class="op" id="4017605">.</span><span class="ident" id="4017606">base</span>&nbsp;<span class="comment" id="4017611">//&nbsp;walks&nbsp;half&nbsp;as&nbsp;fast&nbsp;as&nbsp;ut.base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017645">for</span>&nbsp;<span class="op" id="4017649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017653">pt</span>&nbsp;<span class="op" id="4017656">:=</span>&nbsp;<span class="ident" id="4017659">ut</span><span class="op" id="4017661">.</span><span class="ident" id="4017662">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017669">if</span>&nbsp;<span class="ident" id="4017672">pt</span><span class="op" id="4017674">.</span><span class="ident" id="4017675">Kind</span><span class="op" id="4017679">(</span><span class="op" id="4017680">)</span>&nbsp;<span class="op" id="4017682">!=</span>&nbsp;<span class="ident" id="4017685">reflect</span><span class="op" id="4017692">.</span><span class="ident" id="4017693">Ptr</span>&nbsp;<span class="op" id="4017697">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017702">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4017710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017714">ut</span><span class="op" id="4017716">.</span><span class="ident" id="4017717">base</span>&nbsp;<span class="op" id="4017722">=</span>&nbsp;<span class="ident" id="4017724">pt</span><span class="op" id="4017726">.</span><span class="ident" id="4017727">Elem</span><span class="op" id="4017731">(</span><span class="op" id="4017732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017736">if</span>&nbsp;<span class="ident" id="4017739">ut</span><span class="op" id="4017741">.</span><span class="ident" id="4017742">base</span>&nbsp;<span class="op" id="4017747">==</span>&nbsp;<span class="ident" id="4017750">slowpoke</span>&nbsp;<span class="op" id="4017759">{</span>&nbsp;<span class="comment" id="4017761">//&nbsp;ut.base&nbsp;lapped&nbsp;slowpoke</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4017791">//&nbsp;recursive&nbsp;pointer&nbsp;type.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017821">return</span>&nbsp;<span class="ident" id="4017828">nil</span><span class="op" id="4017831">,</span>&nbsp;<span class="ident" id="4017833">errors</span><span class="op" id="4017839">.</span><span class="ident" id="4017840">New</span><span class="op" id="4017843">(</span><span class="string" id="4017844">&#34;can&#39;t&nbsp;represent&nbsp;recursive&nbsp;pointer&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="4017886">+</span>&nbsp;<span class="ident" id="4017888">ut</span><span class="op" id="4017890">.</span><span class="ident" id="4017891">base</span><span class="op" id="4017895">.</span><span class="ident" id="4017896">String</span><span class="op" id="4017902">(</span><span class="op" id="4017903">)</span><span class="op" id="4017904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4017908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017912">if</span>&nbsp;<span class="ident" id="4017915">ut</span><span class="op" id="4017917">.</span><span class="ident" id="4017918">indir</span><span class="op" id="4017923">%</span><span class="num" id="4017924">2</span>&nbsp;<span class="op" id="4017926">==</span>&nbsp;<span class="num" id="4017929">0</span>&nbsp;<span class="op" id="4017931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017936">slowpoke</span>&nbsp;<span class="op" id="4017945">=</span>&nbsp;<span class="ident" id="4017947">slowpoke</span><span class="op" id="4017955">.</span><span class="ident" id="4017956">Elem</span><span class="op" id="4017960">(</span><span class="op" id="4017961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4017965">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4017969">ut</span><span class="op" id="4017971">.</span><span class="ident" id="4017972">indir</span><span class="op" id="4017977">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4017981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4017985">if</span>&nbsp;<span class="ident" id="4017988">ok</span><span class="op" id="4017990">,</span>&nbsp;<span class="ident" id="4017992">indir</span>&nbsp;<span class="op" id="4017998">:=</span>&nbsp;<span class="ident" id="4018001">implementsInterface</span><span class="op" id="4018020">(</span><span class="ident" id="4018021">ut</span><span class="op" id="4018023">.</span><span class="ident" id="4018024">user</span><span class="op" id="4018028">,</span>&nbsp;<span class="ident" id="4018030">gobEncoderInterfaceType</span><span class="op" id="4018053">)</span><span class="op" id="4018054">;</span>&nbsp;<span class="ident" id="4018056">ok</span>&nbsp;<span class="op" id="4018059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018063">ut</span><span class="op" id="4018065">.</span><span class="ident" id="4018066">externalEnc</span><span class="op" id="4018077">,</span>&nbsp;<span class="ident" id="4018079">ut</span><span class="op" id="4018081">.</span><span class="ident" id="4018082">encIndir</span>&nbsp;<span class="op" id="4018091">=</span>&nbsp;<span class="ident" id="4018093">xGob</span><span class="op" id="4018097">,</span>&nbsp;<span class="ident" id="4018099">indir</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4018106">}</span>&nbsp;<span class="keyword" id="4018108">else</span>&nbsp;<span class="keyword" id="4018113">if</span>&nbsp;<span class="ident" id="4018116">ok</span><span class="op" id="4018118">,</span>&nbsp;<span class="ident" id="4018120">indir</span>&nbsp;<span class="op" id="4018126">:=</span>&nbsp;<span class="ident" id="4018129">implementsInterface</span><span class="op" id="4018148">(</span><span class="ident" id="4018149">ut</span><span class="op" id="4018151">.</span><span class="ident" id="4018152">user</span><span class="op" id="4018156">,</span>&nbsp;<span class="ident" id="4018158">binaryMarshalerInterfaceType</span><span class="op" id="4018186">)</span><span class="op" id="4018187">;</span>&nbsp;<span class="ident" id="4018189">ok</span>&nbsp;<span class="op" id="4018192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018196">ut</span><span class="op" id="4018198">.</span><span class="ident" id="4018199">externalEnc</span><span class="op" id="4018210">,</span>&nbsp;<span class="ident" id="4018212">ut</span><span class="op" id="4018214">.</span><span class="ident" id="4018215">encIndir</span>&nbsp;<span class="op" id="4018224">=</span>&nbsp;<span class="ident" id="4018226">xBinary</span><span class="op" id="4018233">,</span>&nbsp;<span class="ident" id="4018235">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4018242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4018246">//&nbsp;NOTE(rsc):&nbsp;Would&nbsp;like&nbsp;to&nbsp;allow&nbsp;MarshalText&nbsp;here,&nbsp;but&nbsp;results&nbsp;in&nbsp;incompatibility</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4018330">//&nbsp;with&nbsp;older&nbsp;encodings&nbsp;for&nbsp;net.IP.&nbsp;See&nbsp;golang.org/issue/6760.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4018394">//&nbsp;}&nbsp;else&nbsp;if&nbsp;ok,&nbsp;indir&nbsp;:=&nbsp;implementsInterface(ut.user,&nbsp;textMarshalerInterfaceType);&nbsp;ok&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4018484">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsput.externalEnc,&nbsp;ut.encIndir&nbsp;=&nbsp;xText,&nbsp;indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4018532">//&nbsp;}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4018539">if</span>&nbsp;<span class="ident" id="4018542">ok</span><span class="op" id="4018544">,</span>&nbsp;<span class="ident" id="4018546">indir</span>&nbsp;<span class="op" id="4018552">:=</span>&nbsp;<span class="ident" id="4018555">implementsInterface</span><span class="op" id="4018574">(</span><span class="ident" id="4018575">ut</span><span class="op" id="4018577">.</span><span class="ident" id="4018578">user</span><span class="op" id="4018582">,</span>&nbsp;<span class="ident" id="4018584">gobDecoderInterfaceType</span><span class="op" id="4018607">)</span><span class="op" id="4018608">;</span>&nbsp;<span class="ident" id="4018610">ok</span>&nbsp;<span class="op" id="4018613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018617">ut</span><span class="op" id="4018619">.</span><span class="ident" id="4018620">externalDec</span><span class="op" id="4018631">,</span>&nbsp;<span class="ident" id="4018633">ut</span><span class="op" id="4018635">.</span><span class="ident" id="4018636">decIndir</span>&nbsp;<span class="op" id="4018645">=</span>&nbsp;<span class="ident" id="4018647">xGob</span><span class="op" id="4018651">,</span>&nbsp;<span class="ident" id="4018653">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4018660">}</span>&nbsp;<span class="keyword" id="4018662">else</span>&nbsp;<span class="keyword" id="4018667">if</span>&nbsp;<span class="ident" id="4018670">ok</span><span class="op" id="4018672">,</span>&nbsp;<span class="ident" id="4018674">indir</span>&nbsp;<span class="op" id="4018680">:=</span>&nbsp;<span class="ident" id="4018683">implementsInterface</span><span class="op" id="4018702">(</span><span class="ident" id="4018703">ut</span><span class="op" id="4018705">.</span><span class="ident" id="4018706">user</span><span class="op" id="4018710">,</span>&nbsp;<span class="ident" id="4018712">binaryUnmarshalerInterfaceType</span><span class="op" id="4018742">)</span><span class="op" id="4018743">;</span>&nbsp;<span class="ident" id="4018745">ok</span>&nbsp;<span class="op" id="4018748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018752">ut</span><span class="op" id="4018754">.</span><span class="ident" id="4018755">externalDec</span><span class="op" id="4018766">,</span>&nbsp;<span class="ident" id="4018768">ut</span><span class="op" id="4018770">.</span><span class="ident" id="4018771">decIndir</span>&nbsp;<span class="op" id="4018780">=</span>&nbsp;<span class="ident" id="4018782">xBinary</span><span class="op" id="4018789">,</span>&nbsp;<span class="ident" id="4018791">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4018798">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4018802">//&nbsp;See&nbsp;note&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4018822">//&nbsp;}&nbsp;else&nbsp;if&nbsp;ok,&nbsp;indir&nbsp;:=&nbsp;implementsInterface(ut.user,&nbsp;textUnmarshalerInterfaceType);&nbsp;ok&nbsp;{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4018914">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsput.externalDec,&nbsp;ut.decIndir&nbsp;=&nbsp;xText,&nbsp;indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4018962">//&nbsp;}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4018969">userTypeCache</span><span class="op" id="4018982">[</span><span class="ident" id="4018983">rt</span><span class="op" id="4018985">]</span>&nbsp;<span class="op" id="4018987">=</span>&nbsp;<span class="ident" id="4018989">ut</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4018993">return</span><br>
<span class="lineno"></span><span class="op" id="4019000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="4019003">var</span>&nbsp;<span class="op" id="4019007">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4019010">gobEncoderInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4019041">=</span>&nbsp;<span class="ident" id="4019043">reflect</span><span class="op" id="4019050">.</span><span class="ident" id="4019051">TypeOf</span><span class="op" id="4019057">(</span><span class="op" id="4019058">(</span><span class="op" id="4019059">*</span><span class="ident" id="4019060">GobEncoder</span><span class="op" id="4019070">)</span><span class="op" id="4019071">(</span><span class="ident" id="4019072">nil</span><span class="op" id="4019075">)</span><span class="op" id="4019076">)</span><span class="op" id="4019077">.</span><span class="ident" id="4019078">Elem</span><span class="op" id="4019082">(</span><span class="op" id="4019083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4019086">gobDecoderInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4019117">=</span>&nbsp;<span class="ident" id="4019119">reflect</span><span class="op" id="4019126">.</span><span class="ident" id="4019127">TypeOf</span><span class="op" id="4019133">(</span><span class="op" id="4019134">(</span><span class="op" id="4019135">*</span><span class="ident" id="4019136">GobDecoder</span><span class="op" id="4019146">)</span><span class="op" id="4019147">(</span><span class="ident" id="4019148">nil</span><span class="op" id="4019151">)</span><span class="op" id="4019152">)</span><span class="op" id="4019153">.</span><span class="ident" id="4019154">Elem</span><span class="op" id="4019158">(</span><span class="op" id="4019159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4019162">binaryMarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4019193">=</span>&nbsp;<span class="ident" id="4019195">reflect</span><span class="op" id="4019202">.</span><span class="ident" id="4019203">TypeOf</span><span class="op" id="4019209">(</span><span class="op" id="4019210">(</span><span class="op" id="4019211">*</span><span class="ident" id="4019212">encoding</span><span class="op" id="4019220">.</span><span class="ident" id="4019221">BinaryMarshaler</span><span class="op" id="4019236">)</span><span class="op" id="4019237">(</span><span class="ident" id="4019238">nil</span><span class="op" id="4019241">)</span><span class="op" id="4019242">)</span><span class="op" id="4019243">.</span><span class="ident" id="4019244">Elem</span><span class="op" id="4019248">(</span><span class="op" id="4019249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4019252">binaryUnmarshalerInterfaceType</span>&nbsp;<span class="op" id="4019283">=</span>&nbsp;<span class="ident" id="4019285">reflect</span><span class="op" id="4019292">.</span><span class="ident" id="4019293">TypeOf</span><span class="op" id="4019299">(</span><span class="op" id="4019300">(</span><span class="op" id="4019301">*</span><span class="ident" id="4019302">encoding</span><span class="op" id="4019310">.</span><span class="ident" id="4019311">BinaryUnmarshaler</span><span class="op" id="4019328">)</span><span class="op" id="4019329">(</span><span class="ident" id="4019330">nil</span><span class="op" id="4019333">)</span><span class="op" id="4019334">)</span><span class="op" id="4019335">.</span><span class="ident" id="4019336">Elem</span><span class="op" id="4019340">(</span><span class="op" id="4019341">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4019344">textMarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4019375">=</span>&nbsp;<span class="ident" id="4019377">reflect</span><span class="op" id="4019384">.</span><span class="ident" id="4019385">TypeOf</span><span class="op" id="4019391">(</span><span class="op" id="4019392">(</span><span class="op" id="4019393">*</span><span class="ident" id="4019394">encoding</span><span class="op" id="4019402">.</span><span class="ident" id="4019403">TextMarshaler</span><span class="op" id="4019416">)</span><span class="op" id="4019417">(</span><span class="ident" id="4019418">nil</span><span class="op" id="4019421">)</span><span class="op" id="4019422">)</span><span class="op" id="4019423">.</span><span class="ident" id="4019424">Elem</span><span class="op" id="4019428">(</span><span class="op" id="4019429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4019432">textUnmarshalerInterfaceType</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4019463">=</span>&nbsp;<span class="ident" id="4019465">reflect</span><span class="op" id="4019472">.</span><span class="ident" id="4019473">TypeOf</span><span class="op" id="4019479">(</span><span class="op" id="4019480">(</span><span class="op" id="4019481">*</span><span class="ident" id="4019482">encoding</span><span class="op" id="4019490">.</span><span class="ident" id="4019491">TextUnmarshaler</span><span class="op" id="4019506">)</span><span class="op" id="4019507">(</span><span class="ident" id="4019508">nil</span><span class="op" id="4019511">)</span><span class="op" id="4019512">)</span><span class="op" id="4019513">.</span><span class="ident" id="4019514">Elem</span><span class="op" id="4019518">(</span><span class="op" id="4019519">)</span><br>
<span class="lineno"></span><span class="op" id="4019521">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4019524">//&nbsp;implementsInterface&nbsp;reports&nbsp;whether&nbsp;the&nbsp;type&nbsp;implements&nbsp;the</span><br>
<span class="lineno">125</span><span class="comment" id="4019587">//&nbsp;gobEncoder/gobDecoder&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="4019623">//&nbsp;It&nbsp;also&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;indirections&nbsp;required&nbsp;to&nbsp;get&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4019692">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="4019711">func</span>&nbsp;<span class="ident" id="4019716">implementsInterface</span><span class="op" id="4019735">(</span><span class="ident" id="4019736">typ</span><span class="op" id="4019739">,</span>&nbsp;<span class="ident" id="4019741">gobEncDecType</span>&nbsp;<span class="ident" id="4019755">reflect</span><span class="op" id="4019762">.</span><span class="ident" id="4019763">Type</span><span class="op" id="4019767">)</span>&nbsp;<span class="op" id="4019769">(</span><span class="ident" id="4019770">success</span>&nbsp;<span class="builtintype" id="4019778">bool</span><span class="op" id="4019782">,</span>&nbsp;<span class="ident" id="4019784">indir</span>&nbsp;<span class="builtintype" id="4019790">int8</span><span class="op" id="4019794">)</span>&nbsp;<span class="op" id="4019796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4019799">if</span>&nbsp;<span class="ident" id="4019802">typ</span>&nbsp;<span class="op" id="4019806">==</span>&nbsp;<span class="ident" id="4019809">nil</span>&nbsp;<span class="op" id="4019813">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4019817">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4019825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4019828">rt</span>&nbsp;<span class="op" id="4019831">:=</span>&nbsp;<span class="ident" id="4019834">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4019839">//&nbsp;The&nbsp;type&nbsp;might&nbsp;be&nbsp;a&nbsp;pointer&nbsp;and&nbsp;we&nbsp;need&nbsp;to&nbsp;keep</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4019891">//&nbsp;dereferencing&nbsp;to&nbsp;the&nbsp;base&nbsp;type&nbsp;until&nbsp;we&nbsp;find&nbsp;an&nbsp;implementation.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4019959">for</span>&nbsp;<span class="op" id="4019963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4019967">if</span>&nbsp;<span class="ident" id="4019970">rt</span><span class="op" id="4019972">.</span><span class="ident" id="4019973">Implements</span><span class="op" id="4019983">(</span><span class="ident" id="4019984">gobEncDecType</span><span class="op" id="4019997">)</span>&nbsp;<span class="op" id="4019999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4020004">return</span>&nbsp;<span class="builtintype" id="4020011">true</span><span class="op" id="4020015">,</span>&nbsp;<span class="ident" id="4020017">indir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4020025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4020029">if</span>&nbsp;<span class="ident" id="4020032">p</span>&nbsp;<span class="op" id="4020034">:=</span>&nbsp;<span class="ident" id="4020037">rt</span><span class="op" id="4020039">;</span>&nbsp;<span class="ident" id="4020041">p</span><span class="op" id="4020042">.</span><span class="ident" id="4020043">Kind</span><span class="op" id="4020047">(</span><span class="op" id="4020048">)</span>&nbsp;<span class="op" id="4020050">==</span>&nbsp;<span class="ident" id="4020053">reflect</span><span class="op" id="4020060">.</span><span class="ident" id="4020061">Ptr</span>&nbsp;<span class="op" id="4020065">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4020070">indir</span><span class="op" id="4020075">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4020081">if</span>&nbsp;<span class="ident" id="4020084">indir</span>&nbsp;<span class="op" id="4020090">&gt;</span>&nbsp;<span class="num" id="4020092">100</span>&nbsp;<span class="op" id="4020096">{</span>&nbsp;<span class="comment" id="4020098">//&nbsp;insane&nbsp;number&nbsp;of&nbsp;indirections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4020135">return</span>&nbsp;<span class="builtintype" id="4020142">false</span><span class="op" id="4020147">,</span>&nbsp;<span class="num" id="4020149">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4020154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4020159">rt</span>&nbsp;<span class="op" id="4020162">=</span>&nbsp;<span class="ident" id="4020164">p</span><span class="op" id="4020165">.</span><span class="ident" id="4020166">Elem</span><span class="op" id="4020170">(</span><span class="op" id="4020171">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4020176">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4020187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4020191">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4020198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4020201">//&nbsp;No&nbsp;luck&nbsp;yet,&nbsp;but&nbsp;if&nbsp;this&nbsp;is&nbsp;a&nbsp;base&nbsp;type&nbsp;(non-pointer),&nbsp;the&nbsp;pointer&nbsp;might&nbsp;satisfy.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4020287">if</span>&nbsp;<span class="ident" id="4020290">typ</span><span class="op" id="4020293">.</span><span class="ident" id="4020294">Kind</span><span class="op" id="4020298">(</span><span class="op" id="4020299">)</span>&nbsp;<span class="op" id="4020301">!=</span>&nbsp;<span class="ident" id="4020304">reflect</span><span class="op" id="4020311">.</span><span class="ident" id="4020312">Ptr</span>&nbsp;<span class="op" id="4020316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4020320">//&nbsp;Not&nbsp;a&nbsp;pointer,&nbsp;but&nbsp;does&nbsp;the&nbsp;pointer&nbsp;work?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4020367">if</span>&nbsp;<span class="ident" id="4020370">reflect</span><span class="op" id="4020377">.</span><span class="ident" id="4020378">PtrTo</span><span class="op" id="4020383">(</span><span class="ident" id="4020384">typ</span><span class="op" id="4020387">)</span><span class="op" id="4020388">.</span><span class="ident" id="4020389">Implements</span><span class="op" id="4020399">(</span><span class="ident" id="4020400">gobEncDecType</span><span class="op" id="4020413">)</span>&nbsp;<span class="op" id="4020415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4020420">return</span>&nbsp;<span class="builtintype" id="4020427">true</span><span class="op" id="4020431">,</span>&nbsp;<span class="op" id="4020433">-</span><span class="num" id="4020434">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4020438">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4020441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4020444">return</span>&nbsp;<span class="builtintype" id="4020451">false</span><span class="op" id="4020456">,</span>&nbsp;<span class="num" id="4020458">0</span><br>
<span class="lineno"></span><span class="op" id="4020460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4020463">//&nbsp;userType&nbsp;returns,&nbsp;and&nbsp;saves,&nbsp;the&nbsp;information&nbsp;associated&nbsp;with&nbsp;user-provided&nbsp;type&nbsp;rt.</span><br>
<span class="lineno">160</span><span class="comment" id="4020550">//&nbsp;If&nbsp;the&nbsp;user&nbsp;type&nbsp;is&nbsp;not&nbsp;valid,&nbsp;it&nbsp;calls&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="4020600">func</span>&nbsp;<span class="ident" id="4020605">userType</span><span class="op" id="4020613">(</span><span class="ident" id="4020614">rt</span>&nbsp;<span class="ident" id="4020617">reflect</span><span class="op" id="4020624">.</span><span class="ident" id="4020625">Type</span><span class="op" id="4020629">)</span>&nbsp;<span class="op" id="4020631">*</span><span class="ident" id="4020632">userTypeInfo</span>&nbsp;<span class="op" id="4020645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4020648">ut</span><span class="op" id="4020650">,</span>&nbsp;<span class="ident" id="4020652">err</span>&nbsp;<span class="op" id="4020656">:=</span>&nbsp;<span class="ident" id="4020659">validUserType</span><span class="op" id="4020672">(</span><span class="ident" id="4020673">rt</span><span class="op" id="4020675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4020678">if</span>&nbsp;<span class="ident" id="4020681">err</span>&nbsp;<span class="op" id="4020685">!=</span>&nbsp;<span class="ident" id="4020688">nil</span>&nbsp;<span class="op" id="4020692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4020696">error_</span><span class="op" id="4020702">(</span><span class="ident" id="4020703">err</span><span class="op" id="4020706">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4020709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4020712">return</span>&nbsp;<span class="ident" id="4020719">ut</span><br>
<span class="lineno"></span><span class="op" id="4020722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4020725">//&nbsp;A&nbsp;typeId&nbsp;represents&nbsp;a&nbsp;gob&nbsp;Type&nbsp;as&nbsp;an&nbsp;integer&nbsp;that&nbsp;can&nbsp;be&nbsp;passed&nbsp;on&nbsp;the&nbsp;wire.</span><br>
<span class="lineno">170</span><span class="comment" id="4020805">//&nbsp;Internally,&nbsp;typeIds&nbsp;are&nbsp;used&nbsp;as&nbsp;keys&nbsp;to&nbsp;a&nbsp;map&nbsp;to&nbsp;recover&nbsp;the&nbsp;underlying&nbsp;type&nbsp;info.</span><br>
<span class="lineno"></span><span class="keyword" id="4020891">type</span>&nbsp;<span class="ident" id="4020896">typeId</span>&nbsp;<span class="builtintype" id="4020903">int32</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4020910">var</span>&nbsp;<span class="ident" id="4020914">nextId</span>&nbsp;<span class="ident" id="4020921">typeId</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4020934">//&nbsp;incremented&nbsp;for&nbsp;each&nbsp;new&nbsp;type&nbsp;we&nbsp;build</span><br>
<span class="lineno"></span><span class="keyword" id="4020976">var</span>&nbsp;<span class="ident" id="4020980">typeLock</span>&nbsp;<span class="ident" id="4020989">sync</span><span class="op" id="4020993">.</span><span class="ident" id="4020994">Mutex</span>&nbsp;<span class="comment" id="4021000">//&nbsp;set&nbsp;while&nbsp;building&nbsp;a&nbsp;type</span><br>
<span class="lineno">175</span><span class="keyword" id="4021029">const</span>&nbsp;<span class="ident" id="4021035">firstUserId</span>&nbsp;<span class="op" id="4021047">=</span>&nbsp;<span class="num" id="4021049">64</span>&nbsp;&nbsp;<span class="comment" id="4021053">//&nbsp;lowest&nbsp;id&nbsp;number&nbsp;granted&nbsp;to&nbsp;user</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4021090">type</span>&nbsp;<span class="ident" id="4021095">gobType</span>&nbsp;<span class="keyword" id="4021103">interface</span>&nbsp;<span class="op" id="4021113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4021116">id</span><span class="op" id="4021118">(</span><span class="op" id="4021119">)</span>&nbsp;<span class="ident" id="4021121">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4021129">setId</span><span class="op" id="4021134">(</span><span class="ident" id="4021135">id</span>&nbsp;<span class="ident" id="4021138">typeId</span><span class="op" id="4021144">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4021147">name</span><span class="op" id="4021151">(</span><span class="op" id="4021152">)</span>&nbsp;<span class="builtintype" id="4021154">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4021162">string</span><span class="op" id="4021168">(</span><span class="op" id="4021169">)</span>&nbsp;<span class="builtintype" id="4021171">string</span>&nbsp;<span class="comment" id="4021178">//&nbsp;not&nbsp;public;&nbsp;only&nbsp;for&nbsp;debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4021213">safeString</span><span class="op" id="4021223">(</span><span class="ident" id="4021224">seen</span>&nbsp;<span class="keyword" id="4021229">map</span><span class="op" id="4021232">[</span><span class="ident" id="4021233">typeId</span><span class="op" id="4021239">]</span><span class="builtintype" id="4021240">bool</span><span class="op" id="4021244">)</span>&nbsp;<span class="builtintype" id="4021246">string</span><br>
<span class="lineno"></span><span class="op" id="4021253">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="4021256">var</span>&nbsp;<span class="ident" id="4021260">types</span>&nbsp;<span class="op" id="4021266">=</span>&nbsp;<span class="builtinfunc" id="4021268">make</span><span class="op" id="4021272">(</span><span class="keyword" id="4021273">map</span><span class="op" id="4021276">[</span><span class="ident" id="4021277">reflect</span><span class="op" id="4021284">.</span><span class="ident" id="4021285">Type</span><span class="op" id="4021289">]</span><span class="ident" id="4021290">gobType</span><span class="op" id="4021297">)</span><br>
<span class="lineno"></span><span class="keyword" id="4021299">var</span>&nbsp;<span class="ident" id="4021303">idToType</span>&nbsp;<span class="op" id="4021312">=</span>&nbsp;<span class="builtinfunc" id="4021314">make</span><span class="op" id="4021318">(</span><span class="keyword" id="4021319">map</span><span class="op" id="4021322">[</span><span class="ident" id="4021323">typeId</span><span class="op" id="4021329">]</span><span class="ident" id="4021330">gobType</span><span class="op" id="4021337">)</span><br>
<span class="lineno"></span><span class="keyword" id="4021339">var</span>&nbsp;<span class="ident" id="4021343">builtinIdToType</span>&nbsp;<span class="keyword" id="4021359">map</span><span class="op" id="4021362">[</span><span class="ident" id="4021363">typeId</span><span class="op" id="4021369">]</span><span class="ident" id="4021370">gobType</span>&nbsp;<span class="comment" id="4021378">//&nbsp;set&nbsp;in&nbsp;init()&nbsp;after&nbsp;builtins&nbsp;are&nbsp;established</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4021427">func</span>&nbsp;<span class="ident" id="4021432">setTypeId</span><span class="op" id="4021441">(</span><span class="ident" id="4021442">typ</span>&nbsp;<span class="ident" id="4021446">gobType</span><span class="op" id="4021453">)</span>&nbsp;<span class="op" id="4021455">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4021458">//&nbsp;When&nbsp;building&nbsp;recursive&nbsp;types,&nbsp;someone&nbsp;may&nbsp;get&nbsp;there&nbsp;before&nbsp;us.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4021526">if</span>&nbsp;<span class="ident" id="4021529">typ</span><span class="op" id="4021532">.</span><span class="ident" id="4021533">id</span><span class="op" id="4021535">(</span><span class="op" id="4021536">)</span>&nbsp;<span class="op" id="4021538">!=</span>&nbsp;<span class="num" id="4021541">0</span>&nbsp;<span class="op" id="4021543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4021547">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4021555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4021558">nextId</span><span class="op" id="4021564">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4021568">typ</span><span class="op" id="4021571">.</span><span class="ident" id="4021572">setId</span><span class="op" id="4021577">(</span><span class="ident" id="4021578">nextId</span><span class="op" id="4021584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4021587">idToType</span><span class="op" id="4021595">[</span><span class="ident" id="4021596">nextId</span><span class="op" id="4021602">]</span>&nbsp;<span class="op" id="4021604">=</span>&nbsp;<span class="ident" id="4021606">typ</span><br>
<span class="lineno"></span><span class="op" id="4021610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4021613">func</span>&nbsp;<span class="op" id="4021618">(</span><span class="ident" id="4021619">t</span>&nbsp;<span class="ident" id="4021621">typeId</span><span class="op" id="4021627">)</span>&nbsp;<span class="ident" id="4021629">gobType</span><span class="op" id="4021636">(</span><span class="op" id="4021637">)</span>&nbsp;<span class="ident" id="4021639">gobType</span>&nbsp;<span class="op" id="4021647">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4021650">if</span>&nbsp;<span class="ident" id="4021653">t</span>&nbsp;<span class="op" id="4021655">==</span>&nbsp;<span class="num" id="4021658">0</span>&nbsp;<span class="op" id="4021660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4021664">return</span>&nbsp;<span class="ident" id="4021671">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4021676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4021679">return</span>&nbsp;<span class="ident" id="4021686">idToType</span><span class="op" id="4021694">[</span><span class="ident" id="4021695">t</span><span class="op" id="4021696">]</span><br>
<span class="lineno"></span><span class="op" id="4021698">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span><span class="comment" id="4021701">//&nbsp;string&nbsp;returns&nbsp;the&nbsp;string&nbsp;representation&nbsp;of&nbsp;the&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;typeId.</span><br>
<span class="lineno"></span><span class="keyword" id="4021785">func</span>&nbsp;<span class="op" id="4021790">(</span><span class="ident" id="4021791">t</span>&nbsp;<span class="ident" id="4021793">typeId</span><span class="op" id="4021799">)</span>&nbsp;<span class="builtintype" id="4021801">string</span><span class="op" id="4021807">(</span><span class="op" id="4021808">)</span>&nbsp;<span class="builtintype" id="4021810">string</span>&nbsp;<span class="op" id="4021817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4021820">if</span>&nbsp;<span class="ident" id="4021823">t</span><span class="op" id="4021824">.</span><span class="ident" id="4021825">gobType</span><span class="op" id="4021832">(</span><span class="op" id="4021833">)</span>&nbsp;<span class="op" id="4021835">==</span>&nbsp;<span class="ident" id="4021838">nil</span>&nbsp;<span class="op" id="4021842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4021846">return</span>&nbsp;<span class="string" id="4021853">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4021862">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4021865">return</span>&nbsp;<span class="ident" id="4021872">t</span><span class="op" id="4021873">.</span><span class="ident" id="4021874">gobType</span><span class="op" id="4021881">(</span><span class="op" id="4021882">)</span><span class="op" id="4021883">.</span><span class="builtintype" id="4021884">string</span><span class="op" id="4021890">(</span><span class="op" id="4021891">)</span><br>
<span class="lineno"></span><span class="op" id="4021893">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4021896">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;type&nbsp;associated&nbsp;with&nbsp;the&nbsp;typeId.</span><br>
<span class="lineno">215</span><span class="keyword" id="4021961">func</span>&nbsp;<span class="op" id="4021966">(</span><span class="ident" id="4021967">t</span>&nbsp;<span class="ident" id="4021969">typeId</span><span class="op" id="4021975">)</span>&nbsp;<span class="ident" id="4021977">name</span><span class="op" id="4021981">(</span><span class="op" id="4021982">)</span>&nbsp;<span class="builtintype" id="4021984">string</span>&nbsp;<span class="op" id="4021991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4021994">if</span>&nbsp;<span class="ident" id="4021997">t</span><span class="op" id="4021998">.</span><span class="ident" id="4021999">gobType</span><span class="op" id="4022006">(</span><span class="op" id="4022007">)</span>&nbsp;<span class="op" id="4022009">==</span>&nbsp;<span class="ident" id="4022012">nil</span>&nbsp;<span class="op" id="4022016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4022020">return</span>&nbsp;<span class="string" id="4022027">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4022036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4022039">return</span>&nbsp;<span class="ident" id="4022046">t</span><span class="op" id="4022047">.</span><span class="ident" id="4022048">gobType</span><span class="op" id="4022055">(</span><span class="op" id="4022056">)</span><span class="op" id="4022057">.</span><span class="ident" id="4022058">name</span><span class="op" id="4022062">(</span><span class="op" id="4022063">)</span><br>
<span class="lineno">220</span><span class="op" id="4022065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4022068">//&nbsp;CommonType&nbsp;holds&nbsp;elements&nbsp;of&nbsp;all&nbsp;types.</span><br>
<span class="lineno"></span><span class="comment" id="4022111">//&nbsp;It&nbsp;is&nbsp;a&nbsp;historical&nbsp;artifact,&nbsp;kept&nbsp;for&nbsp;binary&nbsp;compatibility&nbsp;and&nbsp;exported</span><br>
<span class="lineno"></span><span class="comment" id="4022186">//&nbsp;only&nbsp;for&nbsp;the&nbsp;benefit&nbsp;of&nbsp;the&nbsp;package&#39;s&nbsp;encoding&nbsp;of&nbsp;type&nbsp;descriptors.&nbsp;It&nbsp;is</span><br>
<span class="lineno">225</span><span class="comment" id="4022263">//&nbsp;not&nbsp;intended&nbsp;for&nbsp;direct&nbsp;use&nbsp;by&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="4022306">type</span>&nbsp;<span class="ident" id="4022311">CommonType</span>&nbsp;<span class="keyword" id="4022322">struct</span>&nbsp;<span class="op" id="4022329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4022332">Name</span>&nbsp;<span class="builtintype" id="4022337">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4022345">Id</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4022350">typeId</span><br>
<span class="lineno"></span><span class="op" id="4022357">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="4022360">func</span>&nbsp;<span class="op" id="4022365">(</span><span class="ident" id="4022366">t</span>&nbsp;<span class="op" id="4022368">*</span><span class="ident" id="4022369">CommonType</span><span class="op" id="4022379">)</span>&nbsp;<span class="ident" id="4022381">id</span><span class="op" id="4022383">(</span><span class="op" id="4022384">)</span>&nbsp;<span class="ident" id="4022386">typeId</span>&nbsp;<span class="op" id="4022393">{</span>&nbsp;<span class="keyword" id="4022395">return</span>&nbsp;<span class="ident" id="4022402">t</span><span class="op" id="4022403">.</span><span class="ident" id="4022404">Id</span>&nbsp;<span class="op" id="4022407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4022410">func</span>&nbsp;<span class="op" id="4022415">(</span><span class="ident" id="4022416">t</span>&nbsp;<span class="op" id="4022418">*</span><span class="ident" id="4022419">CommonType</span><span class="op" id="4022429">)</span>&nbsp;<span class="ident" id="4022431">setId</span><span class="op" id="4022436">(</span><span class="ident" id="4022437">id</span>&nbsp;<span class="ident" id="4022440">typeId</span><span class="op" id="4022446">)</span>&nbsp;<span class="op" id="4022448">{</span>&nbsp;<span class="ident" id="4022450">t</span><span class="op" id="4022451">.</span><span class="ident" id="4022452">Id</span>&nbsp;<span class="op" id="4022455">=</span>&nbsp;<span class="ident" id="4022457">id</span>&nbsp;<span class="op" id="4022460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="4022463">func</span>&nbsp;<span class="op" id="4022468">(</span><span class="ident" id="4022469">t</span>&nbsp;<span class="op" id="4022471">*</span><span class="ident" id="4022472">CommonType</span><span class="op" id="4022482">)</span>&nbsp;<span class="builtintype" id="4022484">string</span><span class="op" id="4022490">(</span><span class="op" id="4022491">)</span>&nbsp;<span class="builtintype" id="4022493">string</span>&nbsp;<span class="op" id="4022500">{</span>&nbsp;<span class="keyword" id="4022502">return</span>&nbsp;<span class="ident" id="4022509">t</span><span class="op" id="4022510">.</span><span class="ident" id="4022511">Name</span>&nbsp;<span class="op" id="4022516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4022519">func</span>&nbsp;<span class="op" id="4022524">(</span><span class="ident" id="4022525">t</span>&nbsp;<span class="op" id="4022527">*</span><span class="ident" id="4022528">CommonType</span><span class="op" id="4022538">)</span>&nbsp;<span class="ident" id="4022540">safeString</span><span class="op" id="4022550">(</span><span class="ident" id="4022551">seen</span>&nbsp;<span class="keyword" id="4022556">map</span><span class="op" id="4022559">[</span><span class="ident" id="4022560">typeId</span><span class="op" id="4022566">]</span><span class="builtintype" id="4022567">bool</span><span class="op" id="4022571">)</span>&nbsp;<span class="builtintype" id="4022573">string</span>&nbsp;<span class="op" id="4022580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4022583">return</span>&nbsp;<span class="ident" id="4022590">t</span><span class="op" id="4022591">.</span><span class="ident" id="4022592">Name</span><br>
<span class="lineno"></span><span class="op" id="4022597">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="4022600">func</span>&nbsp;<span class="op" id="4022605">(</span><span class="ident" id="4022606">t</span>&nbsp;<span class="op" id="4022608">*</span><span class="ident" id="4022609">CommonType</span><span class="op" id="4022619">)</span>&nbsp;<span class="ident" id="4022621">name</span><span class="op" id="4022625">(</span><span class="op" id="4022626">)</span>&nbsp;<span class="builtintype" id="4022628">string</span>&nbsp;<span class="op" id="4022635">{</span>&nbsp;<span class="keyword" id="4022637">return</span>&nbsp;<span class="ident" id="4022644">t</span><span class="op" id="4022645">.</span><span class="ident" id="4022646">Name</span>&nbsp;<span class="op" id="4022651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4022654">//&nbsp;Create&nbsp;and&nbsp;check&nbsp;predefined&nbsp;types</span><br>
<span class="lineno"></span><span class="comment" id="4022691">//&nbsp;The&nbsp;string&nbsp;for&nbsp;tBytes&nbsp;is&nbsp;&#34;bytes&#34;&nbsp;not&nbsp;&#34;[]byte&#34;&nbsp;to&nbsp;signify&nbsp;its&nbsp;specialness.</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="4022769">var</span>&nbsp;<span class="op" id="4022773">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4022776">//&nbsp;Primordial&nbsp;types,&nbsp;needed&nbsp;during&nbsp;initialization.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4022828">//&nbsp;Always&nbsp;passed&nbsp;as&nbsp;pointers&nbsp;so&nbsp;the&nbsp;interface{}&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4022882">//&nbsp;goes&nbsp;through&nbsp;without&nbsp;losing&nbsp;its&nbsp;interfaceness.</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4022933">tBool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4022944">=</span>&nbsp;<span class="ident" id="4022946">bootstrapType</span><span class="op" id="4022959">(</span><span class="string" id="4022960">&#34;bool&#34;</span><span class="op" id="4022966">,</span>&nbsp;<span class="op" id="4022968">(</span><span class="op" id="4022969">*</span><span class="builtintype" id="4022970">bool</span><span class="op" id="4022974">)</span><span class="op" id="4022975">(</span><span class="ident" id="4022976">nil</span><span class="op" id="4022979">)</span><span class="op" id="4022980">,</span>&nbsp;<span class="num" id="4022982">1</span><span class="op" id="4022983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4022986">tInt</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4022997">=</span>&nbsp;<span class="ident" id="4022999">bootstrapType</span><span class="op" id="4023012">(</span><span class="string" id="4023013">&#34;int&#34;</span><span class="op" id="4023018">,</span>&nbsp;<span class="op" id="4023020">(</span><span class="op" id="4023021">*</span><span class="builtintype" id="4023022">int</span><span class="op" id="4023025">)</span><span class="op" id="4023026">(</span><span class="ident" id="4023027">nil</span><span class="op" id="4023030">)</span><span class="op" id="4023031">,</span>&nbsp;<span class="num" id="4023033">2</span><span class="op" id="4023034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4023037">tUint</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4023048">=</span>&nbsp;<span class="ident" id="4023050">bootstrapType</span><span class="op" id="4023063">(</span><span class="string" id="4023064">&#34;uint&#34;</span><span class="op" id="4023070">,</span>&nbsp;<span class="op" id="4023072">(</span><span class="op" id="4023073">*</span><span class="builtintype" id="4023074">uint</span><span class="op" id="4023078">)</span><span class="op" id="4023079">(</span><span class="ident" id="4023080">nil</span><span class="op" id="4023083">)</span><span class="op" id="4023084">,</span>&nbsp;<span class="num" id="4023086">3</span><span class="op" id="4023087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4023090">tFloat</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4023101">=</span>&nbsp;<span class="ident" id="4023103">bootstrapType</span><span class="op" id="4023116">(</span><span class="string" id="4023117">&#34;float&#34;</span><span class="op" id="4023124">,</span>&nbsp;<span class="op" id="4023126">(</span><span class="op" id="4023127">*</span><span class="builtintype" id="4023128">float64</span><span class="op" id="4023135">)</span><span class="op" id="4023136">(</span><span class="ident" id="4023137">nil</span><span class="op" id="4023140">)</span><span class="op" id="4023141">,</span>&nbsp;<span class="num" id="4023143">4</span><span class="op" id="4023144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4023147">tBytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4023158">=</span>&nbsp;<span class="ident" id="4023160">bootstrapType</span><span class="op" id="4023173">(</span><span class="string" id="4023174">&#34;bytes&#34;</span><span class="op" id="4023181">,</span>&nbsp;<span class="op" id="4023183">(</span><span class="op" id="4023184">*</span><span class="op" id="4023185">[</span><span class="op" id="4023186">]</span><span class="builtintype" id="4023187">byte</span><span class="op" id="4023191">)</span><span class="op" id="4023192">(</span><span class="ident" id="4023193">nil</span><span class="op" id="4023196">)</span><span class="op" id="4023197">,</span>&nbsp;<span class="num" id="4023199">5</span><span class="op" id="4023200">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4023203">tString</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4023214">=</span>&nbsp;<span class="ident" id="4023216">bootstrapType</span><span class="op" id="4023229">(</span><span class="string" id="4023230">&#34;string&#34;</span><span class="op" id="4023238">,</span>&nbsp;<span class="op" id="4023240">(</span><span class="op" id="4023241">*</span><span class="builtintype" id="4023242">string</span><span class="op" id="4023248">)</span><span class="op" id="4023249">(</span><span class="ident" id="4023250">nil</span><span class="op" id="4023253">)</span><span class="op" id="4023254">,</span>&nbsp;<span class="num" id="4023256">6</span><span class="op" id="4023257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4023260">tComplex</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4023271">=</span>&nbsp;<span class="ident" id="4023273">bootstrapType</span><span class="op" id="4023286">(</span><span class="string" id="4023287">&#34;complex&#34;</span><span class="op" id="4023296">,</span>&nbsp;<span class="op" id="4023298">(</span><span class="op" id="4023299">*</span><span class="builtintype" id="4023300">complex128</span><span class="op" id="4023310">)</span><span class="op" id="4023311">(</span><span class="ident" id="4023312">nil</span><span class="op" id="4023315">)</span><span class="op" id="4023316">,</span>&nbsp;<span class="num" id="4023318">7</span><span class="op" id="4023319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4023322">tInterface</span>&nbsp;<span class="op" id="4023333">=</span>&nbsp;<span class="ident" id="4023335">bootstrapType</span><span class="op" id="4023348">(</span><span class="string" id="4023349">&#34;interface&#34;</span><span class="op" id="4023360">,</span>&nbsp;<span class="op" id="4023362">(</span><span class="op" id="4023363">*</span><span class="keyword" id="4023364">interface</span><span class="op" id="4023373">{</span><span class="op" id="4023374">}</span><span class="op" id="4023375">)</span><span class="op" id="4023376">(</span><span class="ident" id="4023377">nil</span><span class="op" id="4023380">)</span><span class="op" id="4023381">,</span>&nbsp;<span class="num" id="4023383">8</span><span class="op" id="4023384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4023387">//&nbsp;Reserve&nbsp;some&nbsp;Ids&nbsp;for&nbsp;compatible&nbsp;expansion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4023433">tReserved7</span>&nbsp;<span class="op" id="4023444">=</span>&nbsp;<span class="ident" id="4023446">bootstrapType</span><span class="op" id="4023459">(</span><span class="string" id="4023460">&#34;_reserved1&#34;</span><span class="op" id="4023472">,</span>&nbsp;<span class="op" id="4023474">(</span><span class="op" id="4023475">*</span><span class="keyword" id="4023476">struct</span><span class="op" id="4023482">{</span>&nbsp;<span class="ident" id="4023484">r7</span>&nbsp;<span class="builtintype" id="4023487">int</span>&nbsp;<span class="op" id="4023491">}</span><span class="op" id="4023492">)</span><span class="op" id="4023493">(</span><span class="ident" id="4023494">nil</span><span class="op" id="4023497">)</span><span class="op" id="4023498">,</span>&nbsp;<span class="num" id="4023500">9</span><span class="op" id="4023501">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4023504">tReserved6</span>&nbsp;<span class="op" id="4023515">=</span>&nbsp;<span class="ident" id="4023517">bootstrapType</span><span class="op" id="4023530">(</span><span class="string" id="4023531">&#34;_reserved1&#34;</span><span class="op" id="4023543">,</span>&nbsp;<span class="op" id="4023545">(</span><span class="op" id="4023546">*</span><span class="keyword" id="4023547">struct</span><span class="op" id="4023553">{</span>&nbsp;<span class="ident" id="4023555">r6</span>&nbsp;<span class="builtintype" id="4023558">int</span>&nbsp;<span class="op" id="4023562">}</span><span class="op" id="4023563">)</span><span class="op" id="4023564">(</span><span class="ident" id="4023565">nil</span><span class="op" id="4023568">)</span><span class="op" id="4023569">,</span>&nbsp;<span class="num" id="4023571">10</span><span class="op" id="4023573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4023576">tReserved5</span>&nbsp;<span class="op" id="4023587">=</span>&nbsp;<span class="ident" id="4023589">bootstrapType</span><span class="op" id="4023602">(</span><span class="string" id="4023603">&#34;_reserved1&#34;</span><span class="op" id="4023615">,</span>&nbsp;<span class="op" id="4023617">(</span><span class="op" id="4023618">*</span><span class="keyword" id="4023619">struct</span><span class="op" id="4023625">{</span>&nbsp;<span class="ident" id="4023627">r5</span>&nbsp;<span class="builtintype" id="4023630">int</span>&nbsp;<span class="op" id="4023634">}</span><span class="op" id="4023635">)</span><span class="op" id="4023636">(</span><span class="ident" id="4023637">nil</span><span class="op" id="4023640">)</span><span class="op" id="4023641">,</span>&nbsp;<span class="num" id="4023643">11</span><span class="op" id="4023645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4023648">tReserved4</span>&nbsp;<span class="op" id="4023659">=</span>&nbsp;<span class="ident" id="4023661">bootstrapType</span><span class="op" id="4023674">(</span><span class="string" id="4023675">&#34;_reserved1&#34;</span><span class="op" id="4023687">,</span>&nbsp;<span class="op" id="4023689">(</span><span class="op" id="4023690">*</span><span class="keyword" id="4023691">struct</span><span class="op" id="4023697">{</span>&nbsp;<span class="ident" id="4023699">r4</span>&nbsp;<span class="builtintype" id="4023702">int</span>&nbsp;<span class="op" id="4023706">}</span><span class="op" id="4023707">)</span><span class="op" id="4023708">(</span><span class="ident" id="4023709">nil</span><span class="op" id="4023712">)</span><span class="op" id="4023713">,</span>&nbsp;<span class="num" id="4023715">12</span><span class="op" id="4023717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4023720">tReserved3</span>&nbsp;<span class="op" id="4023731">=</span>&nbsp;<span class="ident" id="4023733">bootstrapType</span><span class="op" id="4023746">(</span><span class="string" id="4023747">&#34;_reserved1&#34;</span><span class="op" id="4023759">,</span>&nbsp;<span class="op" id="4023761">(</span><span class="op" id="4023762">*</span><span class="keyword" id="4023763">struct</span><span class="op" id="4023769">{</span>&nbsp;<span class="ident" id="4023771">r3</span>&nbsp;<span class="builtintype" id="4023774">int</span>&nbsp;<span class="op" id="4023778">}</span><span class="op" id="4023779">)</span><span class="op" id="4023780">(</span><span class="ident" id="4023781">nil</span><span class="op" id="4023784">)</span><span class="op" id="4023785">,</span>&nbsp;<span class="num" id="4023787">13</span><span class="op" id="4023789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4023792">tReserved2</span>&nbsp;<span class="op" id="4023803">=</span>&nbsp;<span class="ident" id="4023805">bootstrapType</span><span class="op" id="4023818">(</span><span class="string" id="4023819">&#34;_reserved1&#34;</span><span class="op" id="4023831">,</span>&nbsp;<span class="op" id="4023833">(</span><span class="op" id="4023834">*</span><span class="keyword" id="4023835">struct</span><span class="op" id="4023841">{</span>&nbsp;<span class="ident" id="4023843">r2</span>&nbsp;<span class="builtintype" id="4023846">int</span>&nbsp;<span class="op" id="4023850">}</span><span class="op" id="4023851">)</span><span class="op" id="4023852">(</span><span class="ident" id="4023853">nil</span><span class="op" id="4023856">)</span><span class="op" id="4023857">,</span>&nbsp;<span class="num" id="4023859">14</span><span class="op" id="4023861">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4023864">tReserved1</span>&nbsp;<span class="op" id="4023875">=</span>&nbsp;<span class="ident" id="4023877">bootstrapType</span><span class="op" id="4023890">(</span><span class="string" id="4023891">&#34;_reserved1&#34;</span><span class="op" id="4023903">,</span>&nbsp;<span class="op" id="4023905">(</span><span class="op" id="4023906">*</span><span class="keyword" id="4023907">struct</span><span class="op" id="4023913">{</span>&nbsp;<span class="ident" id="4023915">r1</span>&nbsp;<span class="builtintype" id="4023918">int</span>&nbsp;<span class="op" id="4023922">}</span><span class="op" id="4023923">)</span><span class="op" id="4023924">(</span><span class="ident" id="4023925">nil</span><span class="op" id="4023928">)</span><span class="op" id="4023929">,</span>&nbsp;<span class="num" id="4023931">15</span><span class="op" id="4023933">)</span><br>
<span class="lineno"></span><span class="op" id="4023935">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4023938">//&nbsp;Predefined&nbsp;because&nbsp;it&#39;s&nbsp;needed&nbsp;by&nbsp;the&nbsp;Decoder</span><br>
<span class="lineno"></span><span class="keyword" id="4023987">var</span>&nbsp;<span class="ident" id="4023991">tWireType</span>&nbsp;<span class="op" id="4024001">=</span>&nbsp;<span class="ident" id="4024003">mustGetTypeInfo</span><span class="op" id="4024018">(</span><span class="ident" id="4024019">reflect</span><span class="op" id="4024026">.</span><span class="ident" id="4024027">TypeOf</span><span class="op" id="4024033">(</span><span class="ident" id="4024034">wireType</span><span class="op" id="4024042">{</span><span class="op" id="4024043">}</span><span class="op" id="4024044">)</span><span class="op" id="4024045">)</span><span class="op" id="4024046">.</span><span class="ident" id="4024047">id</span><br>
<span class="lineno">270</span><span class="keyword" id="4024050">var</span>&nbsp;<span class="ident" id="4024054">wireTypeUserInfo</span>&nbsp;<span class="op" id="4024071">*</span><span class="ident" id="4024072">userTypeInfo</span>&nbsp;<span class="comment" id="4024085">//&nbsp;userTypeInfo&nbsp;of&nbsp;(*wireType)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4024117">func</span>&nbsp;<span class="ident" id="4024122">init</span><span class="op" id="4024126">(</span><span class="op" id="4024127">)</span>&nbsp;<span class="op" id="4024129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4024132">//&nbsp;Some&nbsp;magic&nbsp;numbers&nbsp;to&nbsp;make&nbsp;sure&nbsp;there&nbsp;are&nbsp;no&nbsp;surprises.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4024192">checkId</span><span class="op" id="4024199">(</span><span class="num" id="4024200">16</span><span class="op" id="4024202">,</span>&nbsp;<span class="ident" id="4024204">tWireType</span><span class="op" id="4024213">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4024216">checkId</span><span class="op" id="4024223">(</span><span class="num" id="4024224">17</span><span class="op" id="4024226">,</span>&nbsp;<span class="ident" id="4024228">mustGetTypeInfo</span><span class="op" id="4024243">(</span><span class="ident" id="4024244">reflect</span><span class="op" id="4024251">.</span><span class="ident" id="4024252">TypeOf</span><span class="op" id="4024258">(</span><span class="ident" id="4024259">arrayType</span><span class="op" id="4024268">{</span><span class="op" id="4024269">}</span><span class="op" id="4024270">)</span><span class="op" id="4024271">)</span><span class="op" id="4024272">.</span><span class="ident" id="4024273">id</span><span class="op" id="4024275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4024278">checkId</span><span class="op" id="4024285">(</span><span class="num" id="4024286">18</span><span class="op" id="4024288">,</span>&nbsp;<span class="ident" id="4024290">mustGetTypeInfo</span><span class="op" id="4024305">(</span><span class="ident" id="4024306">reflect</span><span class="op" id="4024313">.</span><span class="ident" id="4024314">TypeOf</span><span class="op" id="4024320">(</span><span class="ident" id="4024321">CommonType</span><span class="op" id="4024331">{</span><span class="op" id="4024332">}</span><span class="op" id="4024333">)</span><span class="op" id="4024334">)</span><span class="op" id="4024335">.</span><span class="ident" id="4024336">id</span><span class="op" id="4024338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4024341">checkId</span><span class="op" id="4024348">(</span><span class="num" id="4024349">19</span><span class="op" id="4024351">,</span>&nbsp;<span class="ident" id="4024353">mustGetTypeInfo</span><span class="op" id="4024368">(</span><span class="ident" id="4024369">reflect</span><span class="op" id="4024376">.</span><span class="ident" id="4024377">TypeOf</span><span class="op" id="4024383">(</span><span class="ident" id="4024384">sliceType</span><span class="op" id="4024393">{</span><span class="op" id="4024394">}</span><span class="op" id="4024395">)</span><span class="op" id="4024396">)</span><span class="op" id="4024397">.</span><span class="ident" id="4024398">id</span><span class="op" id="4024400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4024403">checkId</span><span class="op" id="4024410">(</span><span class="num" id="4024411">20</span><span class="op" id="4024413">,</span>&nbsp;<span class="ident" id="4024415">mustGetTypeInfo</span><span class="op" id="4024430">(</span><span class="ident" id="4024431">reflect</span><span class="op" id="4024438">.</span><span class="ident" id="4024439">TypeOf</span><span class="op" id="4024445">(</span><span class="ident" id="4024446">structType</span><span class="op" id="4024456">{</span><span class="op" id="4024457">}</span><span class="op" id="4024458">)</span><span class="op" id="4024459">)</span><span class="op" id="4024460">.</span><span class="ident" id="4024461">id</span><span class="op" id="4024463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4024466">checkId</span><span class="op" id="4024473">(</span><span class="num" id="4024474">21</span><span class="op" id="4024476">,</span>&nbsp;<span class="ident" id="4024478">mustGetTypeInfo</span><span class="op" id="4024493">(</span><span class="ident" id="4024494">reflect</span><span class="op" id="4024501">.</span><span class="ident" id="4024502">TypeOf</span><span class="op" id="4024508">(</span><span class="ident" id="4024509">fieldType</span><span class="op" id="4024518">{</span><span class="op" id="4024519">}</span><span class="op" id="4024520">)</span><span class="op" id="4024521">)</span><span class="op" id="4024522">.</span><span class="ident" id="4024523">id</span><span class="op" id="4024525">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4024528">checkId</span><span class="op" id="4024535">(</span><span class="num" id="4024536">23</span><span class="op" id="4024538">,</span>&nbsp;<span class="ident" id="4024540">mustGetTypeInfo</span><span class="op" id="4024555">(</span><span class="ident" id="4024556">reflect</span><span class="op" id="4024563">.</span><span class="ident" id="4024564">TypeOf</span><span class="op" id="4024570">(</span><span class="ident" id="4024571">mapType</span><span class="op" id="4024578">{</span><span class="op" id="4024579">}</span><span class="op" id="4024580">)</span><span class="op" id="4024581">)</span><span class="op" id="4024582">.</span><span class="ident" id="4024583">id</span><span class="op" id="4024585">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4024589">builtinIdToType</span>&nbsp;<span class="op" id="4024605">=</span>&nbsp;<span class="builtinfunc" id="4024607">make</span><span class="op" id="4024611">(</span><span class="keyword" id="4024612">map</span><span class="op" id="4024615">[</span><span class="ident" id="4024616">typeId</span><span class="op" id="4024622">]</span><span class="ident" id="4024623">gobType</span><span class="op" id="4024630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4024633">for</span>&nbsp;<span class="ident" id="4024637">k</span><span class="op" id="4024638">,</span>&nbsp;<span class="ident" id="4024640">v</span>&nbsp;<span class="op" id="4024642">:=</span>&nbsp;<span class="keyword" id="4024645">range</span>&nbsp;<span class="ident" id="4024651">idToType</span>&nbsp;<span class="op" id="4024660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4024664">builtinIdToType</span><span class="op" id="4024679">[</span><span class="ident" id="4024680">k</span><span class="op" id="4024681">]</span>&nbsp;<span class="op" id="4024683">=</span>&nbsp;<span class="ident" id="4024685">v</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4024688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4024692">//&nbsp;Move&nbsp;the&nbsp;id&nbsp;space&nbsp;upwards&nbsp;to&nbsp;allow&nbsp;for&nbsp;growth&nbsp;in&nbsp;the&nbsp;predefined&nbsp;world</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4024766">//&nbsp;without&nbsp;breaking&nbsp;existing&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4024803">if</span>&nbsp;<span class="ident" id="4024806">nextId</span>&nbsp;<span class="op" id="4024813">&gt;</span>&nbsp;<span class="ident" id="4024815">firstUserId</span>&nbsp;<span class="op" id="4024827">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4024831">panic</span><span class="op" id="4024836">(</span><span class="ident" id="4024837">fmt</span><span class="op" id="4024840">.</span><span class="ident" id="4024841">Sprintln</span><span class="op" id="4024849">(</span><span class="string" id="4024850">&#34;nextId&nbsp;too&nbsp;large:&#34;</span><span class="op" id="4024869">,</span>&nbsp;<span class="ident" id="4024871">nextId</span><span class="op" id="4024877">)</span><span class="op" id="4024878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4024881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4024884">nextId</span>&nbsp;<span class="op" id="4024891">=</span>&nbsp;<span class="ident" id="4024893">firstUserId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4024906">registerBasics</span><span class="op" id="4024920">(</span><span class="op" id="4024921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4024924">wireTypeUserInfo</span>&nbsp;<span class="op" id="4024941">=</span>&nbsp;<span class="ident" id="4024943">userType</span><span class="op" id="4024951">(</span><span class="ident" id="4024952">reflect</span><span class="op" id="4024959">.</span><span class="ident" id="4024960">TypeOf</span><span class="op" id="4024966">(</span><span class="op" id="4024967">(</span><span class="op" id="4024968">*</span><span class="ident" id="4024969">wireType</span><span class="op" id="4024977">)</span><span class="op" id="4024978">(</span><span class="ident" id="4024979">nil</span><span class="op" id="4024982">)</span><span class="op" id="4024983">)</span><span class="op" id="4024984">)</span><br>
<span class="lineno">295</span><span class="op" id="4024986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4024989">//&nbsp;Array&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="4025003">type</span>&nbsp;<span class="ident" id="4025008">arrayType</span>&nbsp;<span class="keyword" id="4025018">struct</span>&nbsp;<span class="op" id="4025025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4025028">CommonType</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4025040">Elem</span>&nbsp;<span class="ident" id="4025045">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4025053">Len</span>&nbsp;&nbsp;<span class="builtintype" id="4025058">int</span><br>
<span class="lineno"></span><span class="op" id="4025062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4025065">func</span>&nbsp;<span class="ident" id="4025070">newArrayType</span><span class="op" id="4025082">(</span><span class="ident" id="4025083">name</span>&nbsp;<span class="builtintype" id="4025088">string</span><span class="op" id="4025094">)</span>&nbsp;<span class="op" id="4025096">*</span><span class="ident" id="4025097">arrayType</span>&nbsp;<span class="op" id="4025107">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4025110">a</span>&nbsp;<span class="op" id="4025112">:=</span>&nbsp;<span class="op" id="4025115">&amp;</span><span class="ident" id="4025116">arrayType</span><span class="op" id="4025125">{</span><span class="ident" id="4025126">CommonType</span><span class="op" id="4025136">{</span><span class="ident" id="4025137">Name</span><span class="op" id="4025141">:</span>&nbsp;<span class="ident" id="4025143">name</span><span class="op" id="4025147">}</span><span class="op" id="4025148">,</span>&nbsp;<span class="num" id="4025150">0</span><span class="op" id="4025151">,</span>&nbsp;<span class="num" id="4025153">0</span><span class="op" id="4025154">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4025157">return</span>&nbsp;<span class="ident" id="4025164">a</span><br>
<span class="lineno"></span><span class="op" id="4025166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4025169">func</span>&nbsp;<span class="op" id="4025174">(</span><span class="ident" id="4025175">a</span>&nbsp;<span class="op" id="4025177">*</span><span class="ident" id="4025178">arrayType</span><span class="op" id="4025187">)</span>&nbsp;<span class="ident" id="4025189">init</span><span class="op" id="4025193">(</span><span class="ident" id="4025194">elem</span>&nbsp;<span class="ident" id="4025199">gobType</span><span class="op" id="4025206">,</span>&nbsp;<span class="builtinfunc" id="4025208">len</span>&nbsp;<span class="builtintype" id="4025212">int</span><span class="op" id="4025215">)</span>&nbsp;<span class="op" id="4025217">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4025220">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4025295">setTypeId</span><span class="op" id="4025304">(</span><span class="ident" id="4025305">a</span><span class="op" id="4025306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4025309">a</span><span class="op" id="4025310">.</span><span class="ident" id="4025311">Elem</span>&nbsp;<span class="op" id="4025316">=</span>&nbsp;<span class="ident" id="4025318">elem</span><span class="op" id="4025322">.</span><span class="ident" id="4025323">id</span><span class="op" id="4025325">(</span><span class="op" id="4025326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4025329">a</span><span class="op" id="4025330">.</span><span class="ident" id="4025331">Len</span>&nbsp;<span class="op" id="4025335">=</span>&nbsp;<span class="builtinfunc" id="4025337">len</span><br>
<span class="lineno"></span><span class="op" id="4025341">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span><span class="keyword" id="4025344">func</span>&nbsp;<span class="op" id="4025349">(</span><span class="ident" id="4025350">a</span>&nbsp;<span class="op" id="4025352">*</span><span class="ident" id="4025353">arrayType</span><span class="op" id="4025362">)</span>&nbsp;<span class="ident" id="4025364">safeString</span><span class="op" id="4025374">(</span><span class="ident" id="4025375">seen</span>&nbsp;<span class="keyword" id="4025380">map</span><span class="op" id="4025383">[</span><span class="ident" id="4025384">typeId</span><span class="op" id="4025390">]</span><span class="builtintype" id="4025391">bool</span><span class="op" id="4025395">)</span>&nbsp;<span class="builtintype" id="4025397">string</span>&nbsp;<span class="op" id="4025404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4025407">if</span>&nbsp;<span class="ident" id="4025410">seen</span><span class="op" id="4025414">[</span><span class="ident" id="4025415">a</span><span class="op" id="4025416">.</span><span class="ident" id="4025417">Id</span><span class="op" id="4025419">]</span>&nbsp;<span class="op" id="4025421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4025425">return</span>&nbsp;<span class="ident" id="4025432">a</span><span class="op" id="4025433">.</span><span class="ident" id="4025434">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4025440">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4025443">seen</span><span class="op" id="4025447">[</span><span class="ident" id="4025448">a</span><span class="op" id="4025449">.</span><span class="ident" id="4025450">Id</span><span class="op" id="4025452">]</span>&nbsp;<span class="op" id="4025454">=</span>&nbsp;<span class="builtintype" id="4025456">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4025462">return</span>&nbsp;<span class="ident" id="4025469">fmt</span><span class="op" id="4025472">.</span><span class="ident" id="4025473">Sprintf</span><span class="op" id="4025480">(</span><span class="string" id="4025481">&#34;[%d]%s&#34;</span><span class="op" id="4025489">,</span>&nbsp;<span class="ident" id="4025491">a</span><span class="op" id="4025492">.</span><span class="ident" id="4025493">Len</span><span class="op" id="4025496">,</span>&nbsp;<span class="ident" id="4025498">a</span><span class="op" id="4025499">.</span><span class="ident" id="4025500">Elem</span><span class="op" id="4025504">.</span><span class="ident" id="4025505">gobType</span><span class="op" id="4025512">(</span><span class="op" id="4025513">)</span><span class="op" id="4025514">.</span><span class="ident" id="4025515">safeString</span><span class="op" id="4025525">(</span><span class="ident" id="4025526">seen</span><span class="op" id="4025530">)</span><span class="op" id="4025531">)</span><br>
<span class="lineno"></span><span class="op" id="4025533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4025536">func</span>&nbsp;<span class="op" id="4025541">(</span><span class="ident" id="4025542">a</span>&nbsp;<span class="op" id="4025544">*</span><span class="ident" id="4025545">arrayType</span><span class="op" id="4025554">)</span>&nbsp;<span class="builtintype" id="4025556">string</span><span class="op" id="4025562">(</span><span class="op" id="4025563">)</span>&nbsp;<span class="builtintype" id="4025565">string</span>&nbsp;<span class="op" id="4025572">{</span>&nbsp;<span class="keyword" id="4025574">return</span>&nbsp;<span class="ident" id="4025581">a</span><span class="op" id="4025582">.</span><span class="ident" id="4025583">safeString</span><span class="op" id="4025593">(</span><span class="builtinfunc" id="4025594">make</span><span class="op" id="4025598">(</span><span class="keyword" id="4025599">map</span><span class="op" id="4025602">[</span><span class="ident" id="4025603">typeId</span><span class="op" id="4025609">]</span><span class="builtintype" id="4025610">bool</span><span class="op" id="4025614">)</span><span class="op" id="4025615">)</span>&nbsp;<span class="op" id="4025617">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="comment" id="4025620">//&nbsp;GobEncoder&nbsp;type&nbsp;(something&nbsp;that&nbsp;implements&nbsp;the&nbsp;GobEncoder&nbsp;interface)</span><br>
<span class="lineno"></span><span class="keyword" id="4025692">type</span>&nbsp;<span class="ident" id="4025697">gobEncoderType</span>&nbsp;<span class="keyword" id="4025712">struct</span>&nbsp;<span class="op" id="4025719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4025722">CommonType</span><br>
<span class="lineno"></span><span class="op" id="4025733">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="4025736">func</span>&nbsp;<span class="ident" id="4025741">newGobEncoderType</span><span class="op" id="4025758">(</span><span class="ident" id="4025759">name</span>&nbsp;<span class="builtintype" id="4025764">string</span><span class="op" id="4025770">)</span>&nbsp;<span class="op" id="4025772">*</span><span class="ident" id="4025773">gobEncoderType</span>&nbsp;<span class="op" id="4025788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4025791">g</span>&nbsp;<span class="op" id="4025793">:=</span>&nbsp;<span class="op" id="4025796">&amp;</span><span class="ident" id="4025797">gobEncoderType</span><span class="op" id="4025811">{</span><span class="ident" id="4025812">CommonType</span><span class="op" id="4025822">{</span><span class="ident" id="4025823">Name</span><span class="op" id="4025827">:</span>&nbsp;<span class="ident" id="4025829">name</span><span class="op" id="4025833">}</span><span class="op" id="4025834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4025837">setTypeId</span><span class="op" id="4025846">(</span><span class="ident" id="4025847">g</span><span class="op" id="4025848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4025851">return</span>&nbsp;<span class="ident" id="4025858">g</span><br>
<span class="lineno">335</span><span class="op" id="4025860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4025863">func</span>&nbsp;<span class="op" id="4025868">(</span><span class="ident" id="4025869">g</span>&nbsp;<span class="op" id="4025871">*</span><span class="ident" id="4025872">gobEncoderType</span><span class="op" id="4025886">)</span>&nbsp;<span class="ident" id="4025888">safeString</span><span class="op" id="4025898">(</span><span class="ident" id="4025899">seen</span>&nbsp;<span class="keyword" id="4025904">map</span><span class="op" id="4025907">[</span><span class="ident" id="4025908">typeId</span><span class="op" id="4025914">]</span><span class="builtintype" id="4025915">bool</span><span class="op" id="4025919">)</span>&nbsp;<span class="builtintype" id="4025921">string</span>&nbsp;<span class="op" id="4025928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4025931">return</span>&nbsp;<span class="ident" id="4025938">g</span><span class="op" id="4025939">.</span><span class="ident" id="4025940">Name</span><br>
<span class="lineno"></span><span class="op" id="4025945">}</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span><span class="keyword" id="4025948">func</span>&nbsp;<span class="op" id="4025953">(</span><span class="ident" id="4025954">g</span>&nbsp;<span class="op" id="4025956">*</span><span class="ident" id="4025957">gobEncoderType</span><span class="op" id="4025971">)</span>&nbsp;<span class="builtintype" id="4025973">string</span><span class="op" id="4025979">(</span><span class="op" id="4025980">)</span>&nbsp;<span class="builtintype" id="4025982">string</span>&nbsp;<span class="op" id="4025989">{</span>&nbsp;<span class="keyword" id="4025991">return</span>&nbsp;<span class="ident" id="4025998">g</span><span class="op" id="4025999">.</span><span class="ident" id="4026000">Name</span>&nbsp;<span class="op" id="4026005">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4026008">//&nbsp;Map&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="4026020">type</span>&nbsp;<span class="ident" id="4026025">mapType</span>&nbsp;<span class="keyword" id="4026033">struct</span>&nbsp;<span class="op" id="4026040">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026043">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026055">Key</span>&nbsp;&nbsp;<span class="ident" id="4026060">typeId</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026068">Elem</span>&nbsp;<span class="ident" id="4026073">typeId</span><br>
<span class="lineno"></span><span class="op" id="4026080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="keyword" id="4026083">func</span>&nbsp;<span class="ident" id="4026088">newMapType</span><span class="op" id="4026098">(</span><span class="ident" id="4026099">name</span>&nbsp;<span class="builtintype" id="4026104">string</span><span class="op" id="4026110">)</span>&nbsp;<span class="op" id="4026112">*</span><span class="ident" id="4026113">mapType</span>&nbsp;<span class="op" id="4026121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026124">m</span>&nbsp;<span class="op" id="4026126">:=</span>&nbsp;<span class="op" id="4026129">&amp;</span><span class="ident" id="4026130">mapType</span><span class="op" id="4026137">{</span><span class="ident" id="4026138">CommonType</span><span class="op" id="4026148">{</span><span class="ident" id="4026149">Name</span><span class="op" id="4026153">:</span>&nbsp;<span class="ident" id="4026155">name</span><span class="op" id="4026159">}</span><span class="op" id="4026160">,</span>&nbsp;<span class="num" id="4026162">0</span><span class="op" id="4026163">,</span>&nbsp;<span class="num" id="4026165">0</span><span class="op" id="4026166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4026169">return</span>&nbsp;<span class="ident" id="4026176">m</span><br>
<span class="lineno"></span><span class="op" id="4026178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="keyword" id="4026181">func</span>&nbsp;<span class="op" id="4026186">(</span><span class="ident" id="4026187">m</span>&nbsp;<span class="op" id="4026189">*</span><span class="ident" id="4026190">mapType</span><span class="op" id="4026197">)</span>&nbsp;<span class="ident" id="4026199">init</span><span class="op" id="4026203">(</span><span class="ident" id="4026204">key</span><span class="op" id="4026207">,</span>&nbsp;<span class="ident" id="4026209">elem</span>&nbsp;<span class="ident" id="4026214">gobType</span><span class="op" id="4026221">)</span>&nbsp;<span class="op" id="4026223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4026226">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026301">setTypeId</span><span class="op" id="4026310">(</span><span class="ident" id="4026311">m</span><span class="op" id="4026312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026315">m</span><span class="op" id="4026316">.</span><span class="ident" id="4026317">Key</span>&nbsp;<span class="op" id="4026321">=</span>&nbsp;<span class="ident" id="4026323">key</span><span class="op" id="4026326">.</span><span class="ident" id="4026327">id</span><span class="op" id="4026329">(</span><span class="op" id="4026330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026333">m</span><span class="op" id="4026334">.</span><span class="ident" id="4026335">Elem</span>&nbsp;<span class="op" id="4026340">=</span>&nbsp;<span class="ident" id="4026342">elem</span><span class="op" id="4026346">.</span><span class="ident" id="4026347">id</span><span class="op" id="4026349">(</span><span class="op" id="4026350">)</span><br>
<span class="lineno">360</span><span class="op" id="4026352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4026355">func</span>&nbsp;<span class="op" id="4026360">(</span><span class="ident" id="4026361">m</span>&nbsp;<span class="op" id="4026363">*</span><span class="ident" id="4026364">mapType</span><span class="op" id="4026371">)</span>&nbsp;<span class="ident" id="4026373">safeString</span><span class="op" id="4026383">(</span><span class="ident" id="4026384">seen</span>&nbsp;<span class="keyword" id="4026389">map</span><span class="op" id="4026392">[</span><span class="ident" id="4026393">typeId</span><span class="op" id="4026399">]</span><span class="builtintype" id="4026400">bool</span><span class="op" id="4026404">)</span>&nbsp;<span class="builtintype" id="4026406">string</span>&nbsp;<span class="op" id="4026413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4026416">if</span>&nbsp;<span class="ident" id="4026419">seen</span><span class="op" id="4026423">[</span><span class="ident" id="4026424">m</span><span class="op" id="4026425">.</span><span class="ident" id="4026426">Id</span><span class="op" id="4026428">]</span>&nbsp;<span class="op" id="4026430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4026434">return</span>&nbsp;<span class="ident" id="4026441">m</span><span class="op" id="4026442">.</span><span class="ident" id="4026443">Name</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4026449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026452">seen</span><span class="op" id="4026456">[</span><span class="ident" id="4026457">m</span><span class="op" id="4026458">.</span><span class="ident" id="4026459">Id</span><span class="op" id="4026461">]</span>&nbsp;<span class="op" id="4026463">=</span>&nbsp;<span class="builtintype" id="4026465">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026471">key</span>&nbsp;<span class="op" id="4026475">:=</span>&nbsp;<span class="ident" id="4026478">m</span><span class="op" id="4026479">.</span><span class="ident" id="4026480">Key</span><span class="op" id="4026483">.</span><span class="ident" id="4026484">gobType</span><span class="op" id="4026491">(</span><span class="op" id="4026492">)</span><span class="op" id="4026493">.</span><span class="ident" id="4026494">safeString</span><span class="op" id="4026504">(</span><span class="ident" id="4026505">seen</span><span class="op" id="4026509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026512">elem</span>&nbsp;<span class="op" id="4026517">:=</span>&nbsp;<span class="ident" id="4026520">m</span><span class="op" id="4026521">.</span><span class="ident" id="4026522">Elem</span><span class="op" id="4026526">.</span><span class="ident" id="4026527">gobType</span><span class="op" id="4026534">(</span><span class="op" id="4026535">)</span><span class="op" id="4026536">.</span><span class="ident" id="4026537">safeString</span><span class="op" id="4026547">(</span><span class="ident" id="4026548">seen</span><span class="op" id="4026552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4026555">return</span>&nbsp;<span class="ident" id="4026562">fmt</span><span class="op" id="4026565">.</span><span class="ident" id="4026566">Sprintf</span><span class="op" id="4026573">(</span><span class="string" id="4026574">&#34;map[%s]%s&#34;</span><span class="op" id="4026585">,</span>&nbsp;<span class="ident" id="4026587">key</span><span class="op" id="4026590">,</span>&nbsp;<span class="ident" id="4026592">elem</span><span class="op" id="4026596">)</span><br>
<span class="lineno">370</span><span class="op" id="4026598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4026601">func</span>&nbsp;<span class="op" id="4026606">(</span><span class="ident" id="4026607">m</span>&nbsp;<span class="op" id="4026609">*</span><span class="ident" id="4026610">mapType</span><span class="op" id="4026617">)</span>&nbsp;<span class="builtintype" id="4026619">string</span><span class="op" id="4026625">(</span><span class="op" id="4026626">)</span>&nbsp;<span class="builtintype" id="4026628">string</span>&nbsp;<span class="op" id="4026635">{</span>&nbsp;<span class="keyword" id="4026637">return</span>&nbsp;<span class="ident" id="4026644">m</span><span class="op" id="4026645">.</span><span class="ident" id="4026646">safeString</span><span class="op" id="4026656">(</span><span class="builtinfunc" id="4026657">make</span><span class="op" id="4026661">(</span><span class="keyword" id="4026662">map</span><span class="op" id="4026665">[</span><span class="ident" id="4026666">typeId</span><span class="op" id="4026672">]</span><span class="builtintype" id="4026673">bool</span><span class="op" id="4026677">)</span><span class="op" id="4026678">)</span>&nbsp;<span class="op" id="4026680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4026683">//&nbsp;Slice&nbsp;type</span><br>
<span class="lineno">375</span><span class="keyword" id="4026697">type</span>&nbsp;<span class="ident" id="4026702">sliceType</span>&nbsp;<span class="keyword" id="4026712">struct</span>&nbsp;<span class="op" id="4026719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026722">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026734">Elem</span>&nbsp;<span class="ident" id="4026739">typeId</span><br>
<span class="lineno"></span><span class="op" id="4026746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">380</span><span class="keyword" id="4026749">func</span>&nbsp;<span class="ident" id="4026754">newSliceType</span><span class="op" id="4026766">(</span><span class="ident" id="4026767">name</span>&nbsp;<span class="builtintype" id="4026772">string</span><span class="op" id="4026778">)</span>&nbsp;<span class="op" id="4026780">*</span><span class="ident" id="4026781">sliceType</span>&nbsp;<span class="op" id="4026791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026794">s</span>&nbsp;<span class="op" id="4026796">:=</span>&nbsp;<span class="op" id="4026799">&amp;</span><span class="ident" id="4026800">sliceType</span><span class="op" id="4026809">{</span><span class="ident" id="4026810">CommonType</span><span class="op" id="4026820">{</span><span class="ident" id="4026821">Name</span><span class="op" id="4026825">:</span>&nbsp;<span class="ident" id="4026827">name</span><span class="op" id="4026831">}</span><span class="op" id="4026832">,</span>&nbsp;<span class="num" id="4026834">0</span><span class="op" id="4026835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4026838">return</span>&nbsp;<span class="ident" id="4026845">s</span><br>
<span class="lineno"></span><span class="op" id="4026847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="keyword" id="4026850">func</span>&nbsp;<span class="op" id="4026855">(</span><span class="ident" id="4026856">s</span>&nbsp;<span class="op" id="4026858">*</span><span class="ident" id="4026859">sliceType</span><span class="op" id="4026868">)</span>&nbsp;<span class="ident" id="4026870">init</span><span class="op" id="4026874">(</span><span class="ident" id="4026875">elem</span>&nbsp;<span class="ident" id="4026880">gobType</span><span class="op" id="4026887">)</span>&nbsp;<span class="op" id="4026889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4026892">//&nbsp;Set&nbsp;our&nbsp;type&nbsp;id&nbsp;before&nbsp;evaluating&nbsp;the&nbsp;element&#39;s,&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;our&nbsp;own.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4026967">setTypeId</span><span class="op" id="4026976">(</span><span class="ident" id="4026977">s</span><span class="op" id="4026978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4026981">//&nbsp;See&nbsp;the&nbsp;comments&nbsp;about&nbsp;ids&nbsp;in&nbsp;newTypeObject.&nbsp;Only&nbsp;slices&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4027046">//&nbsp;structs&nbsp;have&nbsp;mutual&nbsp;recursion.</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4027081">if</span>&nbsp;<span class="ident" id="4027084">elem</span><span class="op" id="4027088">.</span><span class="ident" id="4027089">id</span><span class="op" id="4027091">(</span><span class="op" id="4027092">)</span>&nbsp;<span class="op" id="4027094">==</span>&nbsp;<span class="num" id="4027097">0</span>&nbsp;<span class="op" id="4027099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4027103">setTypeId</span><span class="op" id="4027112">(</span><span class="ident" id="4027113">elem</span><span class="op" id="4027117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4027120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4027123">s</span><span class="op" id="4027124">.</span><span class="ident" id="4027125">Elem</span>&nbsp;<span class="op" id="4027130">=</span>&nbsp;<span class="ident" id="4027132">elem</span><span class="op" id="4027136">.</span><span class="ident" id="4027137">id</span><span class="op" id="4027139">(</span><span class="op" id="4027140">)</span><br>
<span class="lineno"></span><span class="op" id="4027142">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="4027145">func</span>&nbsp;<span class="op" id="4027150">(</span><span class="ident" id="4027151">s</span>&nbsp;<span class="op" id="4027153">*</span><span class="ident" id="4027154">sliceType</span><span class="op" id="4027163">)</span>&nbsp;<span class="ident" id="4027165">safeString</span><span class="op" id="4027175">(</span><span class="ident" id="4027176">seen</span>&nbsp;<span class="keyword" id="4027181">map</span><span class="op" id="4027184">[</span><span class="ident" id="4027185">typeId</span><span class="op" id="4027191">]</span><span class="builtintype" id="4027192">bool</span><span class="op" id="4027196">)</span>&nbsp;<span class="builtintype" id="4027198">string</span>&nbsp;<span class="op" id="4027205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4027208">if</span>&nbsp;<span class="ident" id="4027211">seen</span><span class="op" id="4027215">[</span><span class="ident" id="4027216">s</span><span class="op" id="4027217">.</span><span class="ident" id="4027218">Id</span><span class="op" id="4027220">]</span>&nbsp;<span class="op" id="4027222">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4027226">return</span>&nbsp;<span class="ident" id="4027233">s</span><span class="op" id="4027234">.</span><span class="ident" id="4027235">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4027241">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4027244">seen</span><span class="op" id="4027248">[</span><span class="ident" id="4027249">s</span><span class="op" id="4027250">.</span><span class="ident" id="4027251">Id</span><span class="op" id="4027253">]</span>&nbsp;<span class="op" id="4027255">=</span>&nbsp;<span class="builtintype" id="4027257">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4027263">return</span>&nbsp;<span class="ident" id="4027270">fmt</span><span class="op" id="4027273">.</span><span class="ident" id="4027274">Sprintf</span><span class="op" id="4027281">(</span><span class="string" id="4027282">&#34;[]%s&#34;</span><span class="op" id="4027288">,</span>&nbsp;<span class="ident" id="4027290">s</span><span class="op" id="4027291">.</span><span class="ident" id="4027292">Elem</span><span class="op" id="4027296">.</span><span class="ident" id="4027297">gobType</span><span class="op" id="4027304">(</span><span class="op" id="4027305">)</span><span class="op" id="4027306">.</span><span class="ident" id="4027307">safeString</span><span class="op" id="4027317">(</span><span class="ident" id="4027318">seen</span><span class="op" id="4027322">)</span><span class="op" id="4027323">)</span><br>
<span class="lineno"></span><span class="op" id="4027325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4027328">func</span>&nbsp;<span class="op" id="4027333">(</span><span class="ident" id="4027334">s</span>&nbsp;<span class="op" id="4027336">*</span><span class="ident" id="4027337">sliceType</span><span class="op" id="4027346">)</span>&nbsp;<span class="builtintype" id="4027348">string</span><span class="op" id="4027354">(</span><span class="op" id="4027355">)</span>&nbsp;<span class="builtintype" id="4027357">string</span>&nbsp;<span class="op" id="4027364">{</span>&nbsp;<span class="keyword" id="4027366">return</span>&nbsp;<span class="ident" id="4027373">s</span><span class="op" id="4027374">.</span><span class="ident" id="4027375">safeString</span><span class="op" id="4027385">(</span><span class="builtinfunc" id="4027386">make</span><span class="op" id="4027390">(</span><span class="keyword" id="4027391">map</span><span class="op" id="4027394">[</span><span class="ident" id="4027395">typeId</span><span class="op" id="4027401">]</span><span class="builtintype" id="4027402">bool</span><span class="op" id="4027406">)</span><span class="op" id="4027407">)</span>&nbsp;<span class="op" id="4027409">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="comment" id="4027412">//&nbsp;Struct&nbsp;type</span><br>
<span class="lineno"></span><span class="keyword" id="4027427">type</span>&nbsp;<span class="ident" id="4027432">fieldType</span>&nbsp;<span class="keyword" id="4027442">struct</span>&nbsp;<span class="op" id="4027449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4027452">Name</span>&nbsp;<span class="builtintype" id="4027457">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4027465">Id</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4027470">typeId</span><br>
<span class="lineno">410</span><span class="op" id="4027477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4027480">type</span>&nbsp;<span class="ident" id="4027485">structType</span>&nbsp;<span class="keyword" id="4027496">struct</span>&nbsp;<span class="op" id="4027503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4027506">CommonType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4027518">Field</span>&nbsp;<span class="op" id="4027524">[</span><span class="op" id="4027525">]</span><span class="op" id="4027526">*</span><span class="ident" id="4027527">fieldType</span><br>
<span class="lineno">415</span><span class="op" id="4027537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4027540">func</span>&nbsp;<span class="op" id="4027545">(</span><span class="ident" id="4027546">s</span>&nbsp;<span class="op" id="4027548">*</span><span class="ident" id="4027549">structType</span><span class="op" id="4027559">)</span>&nbsp;<span class="ident" id="4027561">safeString</span><span class="op" id="4027571">(</span><span class="ident" id="4027572">seen</span>&nbsp;<span class="keyword" id="4027577">map</span><span class="op" id="4027580">[</span><span class="ident" id="4027581">typeId</span><span class="op" id="4027587">]</span><span class="builtintype" id="4027588">bool</span><span class="op" id="4027592">)</span>&nbsp;<span class="builtintype" id="4027594">string</span>&nbsp;<span class="op" id="4027601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4027604">if</span>&nbsp;<span class="ident" id="4027607">s</span>&nbsp;<span class="op" id="4027609">==</span>&nbsp;<span class="ident" id="4027612">nil</span>&nbsp;<span class="op" id="4027616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4027620">return</span>&nbsp;<span class="string" id="4027627">&#34;&lt;nil&gt;&#34;</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4027636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4027639">if</span>&nbsp;<span class="ident" id="4027642">_</span><span class="op" id="4027643">,</span>&nbsp;<span class="ident" id="4027645">ok</span>&nbsp;<span class="op" id="4027648">:=</span>&nbsp;<span class="ident" id="4027651">seen</span><span class="op" id="4027655">[</span><span class="ident" id="4027656">s</span><span class="op" id="4027657">.</span><span class="ident" id="4027658">Id</span><span class="op" id="4027660">]</span><span class="op" id="4027661">;</span>&nbsp;<span class="ident" id="4027663">ok</span>&nbsp;<span class="op" id="4027666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4027670">return</span>&nbsp;<span class="ident" id="4027677">s</span><span class="op" id="4027678">.</span><span class="ident" id="4027679">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4027685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4027688">seen</span><span class="op" id="4027692">[</span><span class="ident" id="4027693">s</span><span class="op" id="4027694">.</span><span class="ident" id="4027695">Id</span><span class="op" id="4027697">]</span>&nbsp;<span class="op" id="4027699">=</span>&nbsp;<span class="builtintype" id="4027701">true</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4027707">str</span>&nbsp;<span class="op" id="4027711">:=</span>&nbsp;<span class="ident" id="4027714">s</span><span class="op" id="4027715">.</span><span class="ident" id="4027716">Name</span>&nbsp;<span class="op" id="4027721">+</span>&nbsp;<span class="string" id="4027723">&#34;&nbsp;=&nbsp;struct&nbsp;{&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4027739">for</span>&nbsp;<span class="ident" id="4027743">_</span><span class="op" id="4027744">,</span>&nbsp;<span class="ident" id="4027746">f</span>&nbsp;<span class="op" id="4027748">:=</span>&nbsp;<span class="keyword" id="4027751">range</span>&nbsp;<span class="ident" id="4027757">s</span><span class="op" id="4027758">.</span><span class="ident" id="4027759">Field</span>&nbsp;<span class="op" id="4027765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4027769">str</span>&nbsp;<span class="op" id="4027773">+=</span>&nbsp;<span class="ident" id="4027776">fmt</span><span class="op" id="4027779">.</span><span class="ident" id="4027780">Sprintf</span><span class="op" id="4027787">(</span><span class="string" id="4027788">&#34;%s&nbsp;%s;&nbsp;&#34;</span><span class="op" id="4027797">,</span>&nbsp;<span class="ident" id="4027799">f</span><span class="op" id="4027800">.</span><span class="ident" id="4027801">Name</span><span class="op" id="4027805">,</span>&nbsp;<span class="ident" id="4027807">f</span><span class="op" id="4027808">.</span><span class="ident" id="4027809">Id</span><span class="op" id="4027811">.</span><span class="ident" id="4027812">gobType</span><span class="op" id="4027819">(</span><span class="op" id="4027820">)</span><span class="op" id="4027821">.</span><span class="ident" id="4027822">safeString</span><span class="op" id="4027832">(</span><span class="ident" id="4027833">seen</span><span class="op" id="4027837">)</span><span class="op" id="4027838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4027841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4027844">str</span>&nbsp;<span class="op" id="4027848">+=</span>&nbsp;<span class="string" id="4027851">&#34;}&#34;</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4027856">return</span>&nbsp;<span class="ident" id="4027863">str</span><br>
<span class="lineno"></span><span class="op" id="4027867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4027870">func</span>&nbsp;<span class="op" id="4027875">(</span><span class="ident" id="4027876">s</span>&nbsp;<span class="op" id="4027878">*</span><span class="ident" id="4027879">structType</span><span class="op" id="4027889">)</span>&nbsp;<span class="builtintype" id="4027891">string</span><span class="op" id="4027897">(</span><span class="op" id="4027898">)</span>&nbsp;<span class="builtintype" id="4027900">string</span>&nbsp;<span class="op" id="4027907">{</span>&nbsp;<span class="keyword" id="4027909">return</span>&nbsp;<span class="ident" id="4027916">s</span><span class="op" id="4027917">.</span><span class="ident" id="4027918">safeString</span><span class="op" id="4027928">(</span><span class="builtinfunc" id="4027929">make</span><span class="op" id="4027933">(</span><span class="keyword" id="4027934">map</span><span class="op" id="4027937">[</span><span class="ident" id="4027938">typeId</span><span class="op" id="4027944">]</span><span class="builtintype" id="4027945">bool</span><span class="op" id="4027949">)</span><span class="op" id="4027950">)</span>&nbsp;<span class="op" id="4027952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="4027955">func</span>&nbsp;<span class="ident" id="4027960">newStructType</span><span class="op" id="4027973">(</span><span class="ident" id="4027974">name</span>&nbsp;<span class="builtintype" id="4027979">string</span><span class="op" id="4027985">)</span>&nbsp;<span class="op" id="4027987">*</span><span class="ident" id="4027988">structType</span>&nbsp;<span class="op" id="4027999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4028002">s</span>&nbsp;<span class="op" id="4028004">:=</span>&nbsp;<span class="op" id="4028007">&amp;</span><span class="ident" id="4028008">structType</span><span class="op" id="4028018">{</span><span class="ident" id="4028019">CommonType</span><span class="op" id="4028029">{</span><span class="ident" id="4028030">Name</span><span class="op" id="4028034">:</span>&nbsp;<span class="ident" id="4028036">name</span><span class="op" id="4028040">}</span><span class="op" id="4028041">,</span>&nbsp;<span class="ident" id="4028043">nil</span><span class="op" id="4028046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4028049">//&nbsp;For&nbsp;historical&nbsp;reasons&nbsp;we&nbsp;set&nbsp;the&nbsp;id&nbsp;here&nbsp;rather&nbsp;than&nbsp;init.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4028113">//&nbsp;See&nbsp;the&nbsp;comment&nbsp;in&nbsp;newTypeObject&nbsp;for&nbsp;details.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4028163">setTypeId</span><span class="op" id="4028172">(</span><span class="ident" id="4028173">s</span><span class="op" id="4028174">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4028177">return</span>&nbsp;<span class="ident" id="4028184">s</span><br>
<span class="lineno"></span><span class="op" id="4028186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4028189">//&nbsp;newTypeObject&nbsp;allocates&nbsp;a&nbsp;gobType&nbsp;for&nbsp;the&nbsp;reflection&nbsp;type&nbsp;rt.</span><br>
<span class="lineno"></span><span class="comment" id="4028254">//&nbsp;Unless&nbsp;ut&nbsp;represents&nbsp;a&nbsp;GobEncoder,&nbsp;rt&nbsp;should&nbsp;be&nbsp;the&nbsp;base&nbsp;type</span><br>
<span class="lineno">445</span><span class="comment" id="4028319">//&nbsp;of&nbsp;ut.</span><br>
<span class="lineno"></span><span class="comment" id="4028329">//&nbsp;This&nbsp;is&nbsp;only&nbsp;called&nbsp;from&nbsp;the&nbsp;encoding&nbsp;side.&nbsp;The&nbsp;decoding&nbsp;side</span><br>
<span class="lineno"></span><span class="comment" id="4028394">//&nbsp;works&nbsp;through&nbsp;typeIds&nbsp;and&nbsp;userTypeInfos&nbsp;alone.</span><br>
<span class="lineno"></span><span class="keyword" id="4028444">func</span>&nbsp;<span class="ident" id="4028449">newTypeObject</span><span class="op" id="4028462">(</span><span class="ident" id="4028463">name</span>&nbsp;<span class="builtintype" id="4028468">string</span><span class="op" id="4028474">,</span>&nbsp;<span class="ident" id="4028476">ut</span>&nbsp;<span class="op" id="4028479">*</span><span class="ident" id="4028480">userTypeInfo</span><span class="op" id="4028492">,</span>&nbsp;<span class="ident" id="4028494">rt</span>&nbsp;<span class="ident" id="4028497">reflect</span><span class="op" id="4028504">.</span><span class="ident" id="4028505">Type</span><span class="op" id="4028509">)</span>&nbsp;<span class="op" id="4028511">(</span><span class="ident" id="4028512">gobType</span><span class="op" id="4028519">,</span>&nbsp;<span class="builtintype" id="4028521">error</span><span class="op" id="4028526">)</span>&nbsp;<span class="op" id="4028528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4028531">//&nbsp;Does&nbsp;this&nbsp;type&nbsp;implement&nbsp;GobEncoder?</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4028572">if</span>&nbsp;<span class="ident" id="4028575">ut</span><span class="op" id="4028577">.</span><span class="ident" id="4028578">externalEnc</span>&nbsp;<span class="op" id="4028590">!=</span>&nbsp;<span class="num" id="4028593">0</span>&nbsp;<span class="op" id="4028595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4028599">return</span>&nbsp;<span class="ident" id="4028606">newGobEncoderType</span><span class="op" id="4028623">(</span><span class="ident" id="4028624">name</span><span class="op" id="4028628">)</span><span class="op" id="4028629">,</span>&nbsp;<span class="ident" id="4028631">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4028636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4028639">var</span>&nbsp;<span class="ident" id="4028643">err</span>&nbsp;<span class="builtintype" id="4028647">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4028654">var</span>&nbsp;<span class="ident" id="4028658">type0</span><span class="op" id="4028663">,</span>&nbsp;<span class="ident" id="4028665">type1</span>&nbsp;<span class="ident" id="4028671">gobType</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4028680">defer</span>&nbsp;<span class="keyword" id="4028686">func</span><span class="op" id="4028690">(</span><span class="op" id="4028691">)</span>&nbsp;<span class="op" id="4028693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4028697">if</span>&nbsp;<span class="ident" id="4028700">err</span>&nbsp;<span class="op" id="4028704">!=</span>&nbsp;<span class="ident" id="4028707">nil</span>&nbsp;<span class="op" id="4028711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4028716">delete</span><span class="op" id="4028722">(</span><span class="ident" id="4028723">types</span><span class="op" id="4028728">,</span>&nbsp;<span class="ident" id="4028730">rt</span><span class="op" id="4028732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4028736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4028739">}</span><span class="op" id="4028740">(</span><span class="op" id="4028741">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4028744">//&nbsp;Install&nbsp;the&nbsp;top-level&nbsp;type&nbsp;before&nbsp;the&nbsp;subtypes&nbsp;(e.g.&nbsp;struct&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4028815">//&nbsp;fields)&nbsp;so&nbsp;recursive&nbsp;types&nbsp;can&nbsp;be&nbsp;constructed&nbsp;safely.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4028873">switch</span>&nbsp;<span class="ident" id="4028880">t</span>&nbsp;<span class="op" id="4028882">:=</span>&nbsp;<span class="ident" id="4028885">rt</span><span class="op" id="4028887">;</span>&nbsp;<span class="ident" id="4028889">t</span><span class="op" id="4028890">.</span><span class="ident" id="4028891">Kind</span><span class="op" id="4028895">(</span><span class="op" id="4028896">)</span>&nbsp;<span class="op" id="4028898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4028901">//&nbsp;All&nbsp;basic&nbsp;types&nbsp;are&nbsp;easy:&nbsp;they&nbsp;are&nbsp;predefined.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4028952">case</span>&nbsp;<span class="ident" id="4028957">reflect</span><span class="op" id="4028964">.</span><span class="ident" id="4028965">Bool</span><span class="op" id="4028969">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4028973">return</span>&nbsp;<span class="ident" id="4028980">tBool</span><span class="op" id="4028985">.</span><span class="ident" id="4028986">gobType</span><span class="op" id="4028993">(</span><span class="op" id="4028994">)</span><span class="op" id="4028995">,</span>&nbsp;<span class="ident" id="4028997">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4029003">case</span>&nbsp;<span class="ident" id="4029008">reflect</span><span class="op" id="4029015">.</span><span class="ident" id="4029016">Int</span><span class="op" id="4029019">,</span>&nbsp;<span class="ident" id="4029021">reflect</span><span class="op" id="4029028">.</span><span class="ident" id="4029029">Int8</span><span class="op" id="4029033">,</span>&nbsp;<span class="ident" id="4029035">reflect</span><span class="op" id="4029042">.</span><span class="ident" id="4029043">Int16</span><span class="op" id="4029048">,</span>&nbsp;<span class="ident" id="4029050">reflect</span><span class="op" id="4029057">.</span><span class="ident" id="4029058">Int32</span><span class="op" id="4029063">,</span>&nbsp;<span class="ident" id="4029065">reflect</span><span class="op" id="4029072">.</span><span class="ident" id="4029073">Int64</span><span class="op" id="4029078">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4029082">return</span>&nbsp;<span class="ident" id="4029089">tInt</span><span class="op" id="4029093">.</span><span class="ident" id="4029094">gobType</span><span class="op" id="4029101">(</span><span class="op" id="4029102">)</span><span class="op" id="4029103">,</span>&nbsp;<span class="ident" id="4029105">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4029111">case</span>&nbsp;<span class="ident" id="4029116">reflect</span><span class="op" id="4029123">.</span><span class="ident" id="4029124">Uint</span><span class="op" id="4029128">,</span>&nbsp;<span class="ident" id="4029130">reflect</span><span class="op" id="4029137">.</span><span class="ident" id="4029138">Uint8</span><span class="op" id="4029143">,</span>&nbsp;<span class="ident" id="4029145">reflect</span><span class="op" id="4029152">.</span><span class="ident" id="4029153">Uint16</span><span class="op" id="4029159">,</span>&nbsp;<span class="ident" id="4029161">reflect</span><span class="op" id="4029168">.</span><span class="ident" id="4029169">Uint32</span><span class="op" id="4029175">,</span>&nbsp;<span class="ident" id="4029177">reflect</span><span class="op" id="4029184">.</span><span class="ident" id="4029185">Uint64</span><span class="op" id="4029191">,</span>&nbsp;<span class="ident" id="4029193">reflect</span><span class="op" id="4029200">.</span><span class="ident" id="4029201">Uintptr</span><span class="op" id="4029208">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4029212">return</span>&nbsp;<span class="ident" id="4029219">tUint</span><span class="op" id="4029224">.</span><span class="ident" id="4029225">gobType</span><span class="op" id="4029232">(</span><span class="op" id="4029233">)</span><span class="op" id="4029234">,</span>&nbsp;<span class="ident" id="4029236">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4029242">case</span>&nbsp;<span class="ident" id="4029247">reflect</span><span class="op" id="4029254">.</span><span class="ident" id="4029255">Float32</span><span class="op" id="4029262">,</span>&nbsp;<span class="ident" id="4029264">reflect</span><span class="op" id="4029271">.</span><span class="ident" id="4029272">Float64</span><span class="op" id="4029279">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4029283">return</span>&nbsp;<span class="ident" id="4029290">tFloat</span><span class="op" id="4029296">.</span><span class="ident" id="4029297">gobType</span><span class="op" id="4029304">(</span><span class="op" id="4029305">)</span><span class="op" id="4029306">,</span>&nbsp;<span class="ident" id="4029308">nil</span><br>
<span class="lineno">475</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4029314">case</span>&nbsp;<span class="ident" id="4029319">reflect</span><span class="op" id="4029326">.</span><span class="ident" id="4029327">Complex64</span><span class="op" id="4029336">,</span>&nbsp;<span class="ident" id="4029338">reflect</span><span class="op" id="4029345">.</span><span class="ident" id="4029346">Complex128</span><span class="op" id="4029356">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4029360">return</span>&nbsp;<span class="ident" id="4029367">tComplex</span><span class="op" id="4029375">.</span><span class="ident" id="4029376">gobType</span><span class="op" id="4029383">(</span><span class="op" id="4029384">)</span><span class="op" id="4029385">,</span>&nbsp;<span class="ident" id="4029387">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4029393">case</span>&nbsp;<span class="ident" id="4029398">reflect</span><span class="op" id="4029405">.</span><span class="ident" id="4029406">String</span><span class="op" id="4029412">:</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4029416">return</span>&nbsp;<span class="ident" id="4029423">tString</span><span class="op" id="4029430">.</span><span class="ident" id="4029431">gobType</span><span class="op" id="4029438">(</span><span class="op" id="4029439">)</span><span class="op" id="4029440">,</span>&nbsp;<span class="ident" id="4029442">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4029448">case</span>&nbsp;<span class="ident" id="4029453">reflect</span><span class="op" id="4029460">.</span><span class="ident" id="4029461">Interface</span><span class="op" id="4029470">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4029474">return</span>&nbsp;<span class="ident" id="4029481">tInterface</span><span class="op" id="4029491">.</span><span class="ident" id="4029492">gobType</span><span class="op" id="4029499">(</span><span class="op" id="4029500">)</span><span class="op" id="4029501">,</span>&nbsp;<span class="ident" id="4029503">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4029509">case</span>&nbsp;<span class="ident" id="4029514">reflect</span><span class="op" id="4029521">.</span><span class="ident" id="4029522">Array</span><span class="op" id="4029527">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4029531">at</span>&nbsp;<span class="op" id="4029534">:=</span>&nbsp;<span class="ident" id="4029537">newArrayType</span><span class="op" id="4029549">(</span><span class="ident" id="4029550">name</span><span class="op" id="4029554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4029558">types</span><span class="op" id="4029563">[</span><span class="ident" id="4029564">rt</span><span class="op" id="4029566">]</span>&nbsp;<span class="op" id="4029568">=</span>&nbsp;<span class="ident" id="4029570">at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4029575">type0</span><span class="op" id="4029580">,</span>&nbsp;<span class="ident" id="4029582">err</span>&nbsp;<span class="op" id="4029586">=</span>&nbsp;<span class="ident" id="4029588">getBaseType</span><span class="op" id="4029599">(</span><span class="string" id="4029600">&#34;&#34;</span><span class="op" id="4029602">,</span>&nbsp;<span class="ident" id="4029604">t</span><span class="op" id="4029605">.</span><span class="ident" id="4029606">Elem</span><span class="op" id="4029610">(</span><span class="op" id="4029611">)</span><span class="op" id="4029612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4029616">if</span>&nbsp;<span class="ident" id="4029619">err</span>&nbsp;<span class="op" id="4029623">!=</span>&nbsp;<span class="ident" id="4029626">nil</span>&nbsp;<span class="op" id="4029630">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4029635">return</span>&nbsp;<span class="ident" id="4029642">nil</span><span class="op" id="4029645">,</span>&nbsp;<span class="ident" id="4029647">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4029653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4029657">//&nbsp;Historical&nbsp;aside:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4029680">//&nbsp;For&nbsp;arrays,&nbsp;maps,&nbsp;and&nbsp;slices,&nbsp;we&nbsp;set&nbsp;the&nbsp;type&nbsp;id&nbsp;after&nbsp;the&nbsp;elements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4029753">//&nbsp;are&nbsp;constructed.&nbsp;This&nbsp;is&nbsp;to&nbsp;retain&nbsp;the&nbsp;order&nbsp;of&nbsp;type&nbsp;id&nbsp;allocation&nbsp;after</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4029831">//&nbsp;a&nbsp;fix&nbsp;made&nbsp;to&nbsp;handle&nbsp;recursive&nbsp;types,&nbsp;which&nbsp;changed&nbsp;the&nbsp;order&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4029901">//&nbsp;which&nbsp;types&nbsp;are&nbsp;built.&nbsp;&nbsp;Delaying&nbsp;the&nbsp;setting&nbsp;in&nbsp;this&nbsp;way&nbsp;preserves</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4029973">//&nbsp;type&nbsp;ids&nbsp;while&nbsp;allowing&nbsp;recursive&nbsp;types&nbsp;to&nbsp;be&nbsp;described.&nbsp;Structs,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4030044">//&nbsp;done&nbsp;below,&nbsp;were&nbsp;already&nbsp;handling&nbsp;recursion&nbsp;correctly&nbsp;so&nbsp;they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4030111">//&nbsp;assign&nbsp;the&nbsp;top-level&nbsp;id&nbsp;before&nbsp;those&nbsp;of&nbsp;the&nbsp;field.</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4030167">at</span><span class="op" id="4030169">.</span><span class="ident" id="4030170">init</span><span class="op" id="4030174">(</span><span class="ident" id="4030175">type0</span><span class="op" id="4030180">,</span>&nbsp;<span class="ident" id="4030182">t</span><span class="op" id="4030183">.</span><span class="ident" id="4030184">Len</span><span class="op" id="4030187">(</span><span class="op" id="4030188">)</span><span class="op" id="4030189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4030193">return</span>&nbsp;<span class="ident" id="4030200">at</span><span class="op" id="4030202">,</span>&nbsp;<span class="ident" id="4030204">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4030210">case</span>&nbsp;<span class="ident" id="4030215">reflect</span><span class="op" id="4030222">.</span><span class="ident" id="4030223">Map</span><span class="op" id="4030226">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4030230">mt</span>&nbsp;<span class="op" id="4030233">:=</span>&nbsp;<span class="ident" id="4030236">newMapType</span><span class="op" id="4030246">(</span><span class="ident" id="4030247">name</span><span class="op" id="4030251">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4030255">types</span><span class="op" id="4030260">[</span><span class="ident" id="4030261">rt</span><span class="op" id="4030263">]</span>&nbsp;<span class="op" id="4030265">=</span>&nbsp;<span class="ident" id="4030267">mt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4030272">type0</span><span class="op" id="4030277">,</span>&nbsp;<span class="ident" id="4030279">err</span>&nbsp;<span class="op" id="4030283">=</span>&nbsp;<span class="ident" id="4030285">getBaseType</span><span class="op" id="4030296">(</span><span class="string" id="4030297">&#34;&#34;</span><span class="op" id="4030299">,</span>&nbsp;<span class="ident" id="4030301">t</span><span class="op" id="4030302">.</span><span class="ident" id="4030303">Key</span><span class="op" id="4030306">(</span><span class="op" id="4030307">)</span><span class="op" id="4030308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4030312">if</span>&nbsp;<span class="ident" id="4030315">err</span>&nbsp;<span class="op" id="4030319">!=</span>&nbsp;<span class="ident" id="4030322">nil</span>&nbsp;<span class="op" id="4030326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4030331">return</span>&nbsp;<span class="ident" id="4030338">nil</span><span class="op" id="4030341">,</span>&nbsp;<span class="ident" id="4030343">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4030349">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4030353">type1</span><span class="op" id="4030358">,</span>&nbsp;<span class="ident" id="4030360">err</span>&nbsp;<span class="op" id="4030364">=</span>&nbsp;<span class="ident" id="4030366">getBaseType</span><span class="op" id="4030377">(</span><span class="string" id="4030378">&#34;&#34;</span><span class="op" id="4030380">,</span>&nbsp;<span class="ident" id="4030382">t</span><span class="op" id="4030383">.</span><span class="ident" id="4030384">Elem</span><span class="op" id="4030388">(</span><span class="op" id="4030389">)</span><span class="op" id="4030390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4030394">if</span>&nbsp;<span class="ident" id="4030397">err</span>&nbsp;<span class="op" id="4030401">!=</span>&nbsp;<span class="ident" id="4030404">nil</span>&nbsp;<span class="op" id="4030408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4030413">return</span>&nbsp;<span class="ident" id="4030420">nil</span><span class="op" id="4030423">,</span>&nbsp;<span class="ident" id="4030425">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4030431">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4030435">mt</span><span class="op" id="4030437">.</span><span class="ident" id="4030438">init</span><span class="op" id="4030442">(</span><span class="ident" id="4030443">type0</span><span class="op" id="4030448">,</span>&nbsp;<span class="ident" id="4030450">type1</span><span class="op" id="4030455">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4030459">return</span>&nbsp;<span class="ident" id="4030466">mt</span><span class="op" id="4030468">,</span>&nbsp;<span class="ident" id="4030470">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4030476">case</span>&nbsp;<span class="ident" id="4030481">reflect</span><span class="op" id="4030488">.</span><span class="ident" id="4030489">Slice</span><span class="op" id="4030494">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4030498">//&nbsp;[]byte&nbsp;==&nbsp;[]uint8&nbsp;is&nbsp;a&nbsp;special&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4030539">if</span>&nbsp;<span class="ident" id="4030542">t</span><span class="op" id="4030543">.</span><span class="ident" id="4030544">Elem</span><span class="op" id="4030548">(</span><span class="op" id="4030549">)</span><span class="op" id="4030550">.</span><span class="ident" id="4030551">Kind</span><span class="op" id="4030555">(</span><span class="op" id="4030556">)</span>&nbsp;<span class="op" id="4030558">==</span>&nbsp;<span class="ident" id="4030561">reflect</span><span class="op" id="4030568">.</span><span class="ident" id="4030569">Uint8</span>&nbsp;<span class="op" id="4030575">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4030580">return</span>&nbsp;<span class="ident" id="4030587">tBytes</span><span class="op" id="4030593">.</span><span class="ident" id="4030594">gobType</span><span class="op" id="4030601">(</span><span class="op" id="4030602">)</span><span class="op" id="4030603">,</span>&nbsp;<span class="ident" id="4030605">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4030611">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4030615">st</span>&nbsp;<span class="op" id="4030618">:=</span>&nbsp;<span class="ident" id="4030621">newSliceType</span><span class="op" id="4030633">(</span><span class="ident" id="4030634">name</span><span class="op" id="4030638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4030642">types</span><span class="op" id="4030647">[</span><span class="ident" id="4030648">rt</span><span class="op" id="4030650">]</span>&nbsp;<span class="op" id="4030652">=</span>&nbsp;<span class="ident" id="4030654">st</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4030659">type0</span><span class="op" id="4030664">,</span>&nbsp;<span class="ident" id="4030666">err</span>&nbsp;<span class="op" id="4030670">=</span>&nbsp;<span class="ident" id="4030672">getBaseType</span><span class="op" id="4030683">(</span><span class="ident" id="4030684">t</span><span class="op" id="4030685">.</span><span class="ident" id="4030686">Elem</span><span class="op" id="4030690">(</span><span class="op" id="4030691">)</span><span class="op" id="4030692">.</span><span class="ident" id="4030693">Name</span><span class="op" id="4030697">(</span><span class="op" id="4030698">)</span><span class="op" id="4030699">,</span>&nbsp;<span class="ident" id="4030701">t</span><span class="op" id="4030702">.</span><span class="ident" id="4030703">Elem</span><span class="op" id="4030707">(</span><span class="op" id="4030708">)</span><span class="op" id="4030709">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4030713">if</span>&nbsp;<span class="ident" id="4030716">err</span>&nbsp;<span class="op" id="4030720">!=</span>&nbsp;<span class="ident" id="4030723">nil</span>&nbsp;<span class="op" id="4030727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4030732">return</span>&nbsp;<span class="ident" id="4030739">nil</span><span class="op" id="4030742">,</span>&nbsp;<span class="ident" id="4030744">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4030750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4030754">st</span><span class="op" id="4030756">.</span><span class="ident" id="4030757">init</span><span class="op" id="4030761">(</span><span class="ident" id="4030762">type0</span><span class="op" id="4030767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4030771">return</span>&nbsp;<span class="ident" id="4030778">st</span><span class="op" id="4030780">,</span>&nbsp;<span class="ident" id="4030782">nil</span><br>
<span class="lineno">530</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4030788">case</span>&nbsp;<span class="ident" id="4030793">reflect</span><span class="op" id="4030800">.</span><span class="ident" id="4030801">Struct</span><span class="op" id="4030807">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4030811">st</span>&nbsp;<span class="op" id="4030814">:=</span>&nbsp;<span class="ident" id="4030817">newStructType</span><span class="op" id="4030830">(</span><span class="ident" id="4030831">name</span><span class="op" id="4030835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4030839">types</span><span class="op" id="4030844">[</span><span class="ident" id="4030845">rt</span><span class="op" id="4030847">]</span>&nbsp;<span class="op" id="4030849">=</span>&nbsp;<span class="ident" id="4030851">st</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4030856">idToType</span><span class="op" id="4030864">[</span><span class="ident" id="4030865">st</span><span class="op" id="4030867">.</span><span class="ident" id="4030868">id</span><span class="op" id="4030870">(</span><span class="op" id="4030871">)</span><span class="op" id="4030872">]</span>&nbsp;<span class="op" id="4030874">=</span>&nbsp;<span class="ident" id="4030876">st</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4030881">for</span>&nbsp;<span class="ident" id="4030885">i</span>&nbsp;<span class="op" id="4030887">:=</span>&nbsp;<span class="num" id="4030890">0</span><span class="op" id="4030891">;</span>&nbsp;<span class="ident" id="4030893">i</span>&nbsp;<span class="op" id="4030895">&lt;</span>&nbsp;<span class="ident" id="4030897">t</span><span class="op" id="4030898">.</span><span class="ident" id="4030899">NumField</span><span class="op" id="4030907">(</span><span class="op" id="4030908">)</span><span class="op" id="4030909">;</span>&nbsp;<span class="ident" id="4030911">i</span><span class="op" id="4030912">++</span>&nbsp;<span class="op" id="4030915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4030920">f</span>&nbsp;<span class="op" id="4030922">:=</span>&nbsp;<span class="ident" id="4030925">t</span><span class="op" id="4030926">.</span><span class="ident" id="4030927">Field</span><span class="op" id="4030932">(</span><span class="ident" id="4030933">i</span><span class="op" id="4030934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4030939">if</span>&nbsp;<span class="op" id="4030942">!</span><span class="ident" id="4030943">isSent</span><span class="op" id="4030949">(</span><span class="op" id="4030950">&amp;</span><span class="ident" id="4030951">f</span><span class="op" id="4030952">)</span>&nbsp;<span class="op" id="4030954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4030960">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4030972">}</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4030977">typ</span>&nbsp;<span class="op" id="4030981">:=</span>&nbsp;<span class="ident" id="4030984">userType</span><span class="op" id="4030992">(</span><span class="ident" id="4030993">f</span><span class="op" id="4030994">.</span><span class="ident" id="4030995">Type</span><span class="op" id="4030999">)</span><span class="op" id="4031000">.</span><span class="ident" id="4031001">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4031009">tname</span>&nbsp;<span class="op" id="4031015">:=</span>&nbsp;<span class="ident" id="4031018">typ</span><span class="op" id="4031021">.</span><span class="ident" id="4031022">Name</span><span class="op" id="4031026">(</span><span class="op" id="4031027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4031032">if</span>&nbsp;<span class="ident" id="4031035">tname</span>&nbsp;<span class="op" id="4031041">==</span>&nbsp;<span class="string" id="4031044">&#34;&#34;</span>&nbsp;<span class="op" id="4031047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4031053">t</span>&nbsp;<span class="op" id="4031055">:=</span>&nbsp;<span class="ident" id="4031058">userType</span><span class="op" id="4031066">(</span><span class="ident" id="4031067">f</span><span class="op" id="4031068">.</span><span class="ident" id="4031069">Type</span><span class="op" id="4031073">)</span><span class="op" id="4031074">.</span><span class="ident" id="4031075">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4031084">tname</span>&nbsp;<span class="op" id="4031090">=</span>&nbsp;<span class="ident" id="4031092">t</span><span class="op" id="4031093">.</span><span class="ident" id="4031094">String</span><span class="op" id="4031100">(</span><span class="op" id="4031101">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4031106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4031111">gt</span><span class="op" id="4031113">,</span>&nbsp;<span class="ident" id="4031115">err</span>&nbsp;<span class="op" id="4031119">:=</span>&nbsp;<span class="ident" id="4031122">getBaseType</span><span class="op" id="4031133">(</span><span class="ident" id="4031134">tname</span><span class="op" id="4031139">,</span>&nbsp;<span class="ident" id="4031141">f</span><span class="op" id="4031142">.</span><span class="ident" id="4031143">Type</span><span class="op" id="4031147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4031152">if</span>&nbsp;<span class="ident" id="4031155">err</span>&nbsp;<span class="op" id="4031159">!=</span>&nbsp;<span class="ident" id="4031162">nil</span>&nbsp;<span class="op" id="4031166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4031172">return</span>&nbsp;<span class="ident" id="4031179">nil</span><span class="op" id="4031182">,</span>&nbsp;<span class="ident" id="4031184">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4031191">}</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4031196">//&nbsp;Some&nbsp;mutually&nbsp;recursive&nbsp;types&nbsp;can&nbsp;cause&nbsp;us&nbsp;to&nbsp;be&nbsp;here&nbsp;while</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4031262">//&nbsp;still&nbsp;defining&nbsp;the&nbsp;element.&nbsp;Fix&nbsp;the&nbsp;element&nbsp;type&nbsp;id&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4031326">//&nbsp;We&nbsp;could&nbsp;do&nbsp;this&nbsp;more&nbsp;neatly&nbsp;by&nbsp;setting&nbsp;the&nbsp;id&nbsp;at&nbsp;the&nbsp;start&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4031395">//&nbsp;building&nbsp;every&nbsp;type,&nbsp;but&nbsp;that&nbsp;would&nbsp;break&nbsp;binary&nbsp;compatibility.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4031465">if</span>&nbsp;<span class="ident" id="4031468">gt</span><span class="op" id="4031470">.</span><span class="ident" id="4031471">id</span><span class="op" id="4031473">(</span><span class="op" id="4031474">)</span>&nbsp;<span class="op" id="4031476">==</span>&nbsp;<span class="num" id="4031479">0</span>&nbsp;<span class="op" id="4031481">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4031487">setTypeId</span><span class="op" id="4031496">(</span><span class="ident" id="4031497">gt</span><span class="op" id="4031499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4031504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4031509">st</span><span class="op" id="4031511">.</span><span class="ident" id="4031512">Field</span>&nbsp;<span class="op" id="4031518">=</span>&nbsp;<span class="builtinfunc" id="4031520">append</span><span class="op" id="4031526">(</span><span class="ident" id="4031527">st</span><span class="op" id="4031529">.</span><span class="ident" id="4031530">Field</span><span class="op" id="4031535">,</span>&nbsp;<span class="op" id="4031537">&amp;</span><span class="ident" id="4031538">fieldType</span><span class="op" id="4031547">{</span><span class="ident" id="4031548">f</span><span class="op" id="4031549">.</span><span class="ident" id="4031550">Name</span><span class="op" id="4031554">,</span>&nbsp;<span class="ident" id="4031556">gt</span><span class="op" id="4031558">.</span><span class="ident" id="4031559">id</span><span class="op" id="4031561">(</span><span class="op" id="4031562">)</span><span class="op" id="4031563">}</span><span class="op" id="4031564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4031568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4031572">return</span>&nbsp;<span class="ident" id="4031579">st</span><span class="op" id="4031581">,</span>&nbsp;<span class="ident" id="4031583">nil</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4031589">default</span><span class="op" id="4031596">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4031600">return</span>&nbsp;<span class="ident" id="4031607">nil</span><span class="op" id="4031610">,</span>&nbsp;<span class="ident" id="4031612">errors</span><span class="op" id="4031618">.</span><span class="ident" id="4031619">New</span><span class="op" id="4031622">(</span><span class="string" id="4031623">&#34;gob&nbsp;NewTypeObject&nbsp;can&#39;t&nbsp;handle&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="4031663">+</span>&nbsp;<span class="ident" id="4031665">rt</span><span class="op" id="4031667">.</span><span class="ident" id="4031668">String</span><span class="op" id="4031674">(</span><span class="op" id="4031675">)</span><span class="op" id="4031676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4031679">}</span><br>
<span class="lineno"></span><span class="op" id="4031681">}</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span><span class="comment" id="4031684">//&nbsp;isExported&nbsp;reports&nbsp;whether&nbsp;this&nbsp;is&nbsp;an&nbsp;exported&nbsp;-&nbsp;upper&nbsp;case&nbsp;-&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="4031755">func</span>&nbsp;<span class="ident" id="4031760">isExported</span><span class="op" id="4031770">(</span><span class="ident" id="4031771">name</span>&nbsp;<span class="builtintype" id="4031776">string</span><span class="op" id="4031782">)</span>&nbsp;<span class="builtintype" id="4031784">bool</span>&nbsp;<span class="op" id="4031789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4031792">rune</span><span class="op" id="4031796">,</span>&nbsp;<span class="ident" id="4031798">_</span>&nbsp;<span class="op" id="4031800">:=</span>&nbsp;<span class="ident" id="4031803">utf8</span><span class="op" id="4031807">.</span><span class="ident" id="4031808">DecodeRuneInString</span><span class="op" id="4031826">(</span><span class="ident" id="4031827">name</span><span class="op" id="4031831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4031834">return</span>&nbsp;<span class="ident" id="4031841">unicode</span><span class="op" id="4031848">.</span><span class="ident" id="4031849">IsUpper</span><span class="op" id="4031856">(</span><span class="builtintype" id="4031857">rune</span><span class="op" id="4031861">)</span><br>
<span class="lineno">570</span><span class="op" id="4031863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4031866">//&nbsp;isSent&nbsp;reports&nbsp;whether&nbsp;this&nbsp;struct&nbsp;field&nbsp;is&nbsp;to&nbsp;be&nbsp;transmitted.</span><br>
<span class="lineno"></span><span class="comment" id="4031932">//&nbsp;It&nbsp;will&nbsp;be&nbsp;transmitted&nbsp;only&nbsp;if&nbsp;it&nbsp;is&nbsp;exported&nbsp;and&nbsp;not&nbsp;a&nbsp;chan&nbsp;or&nbsp;func&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="4032010">//&nbsp;or&nbsp;pointer&nbsp;to&nbsp;chan&nbsp;or&nbsp;func.</span><br>
<span class="lineno">575</span><span class="keyword" id="4032041">func</span>&nbsp;<span class="ident" id="4032046">isSent</span><span class="op" id="4032052">(</span><span class="ident" id="4032053">field</span>&nbsp;<span class="op" id="4032059">*</span><span class="ident" id="4032060">reflect</span><span class="op" id="4032067">.</span><span class="ident" id="4032068">StructField</span><span class="op" id="4032079">)</span>&nbsp;<span class="builtintype" id="4032081">bool</span>&nbsp;<span class="op" id="4032086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4032089">if</span>&nbsp;<span class="op" id="4032092">!</span><span class="ident" id="4032093">isExported</span><span class="op" id="4032103">(</span><span class="ident" id="4032104">field</span><span class="op" id="4032109">.</span><span class="ident" id="4032110">Name</span><span class="op" id="4032114">)</span>&nbsp;<span class="op" id="4032116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4032120">return</span>&nbsp;<span class="builtintype" id="4032127">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4032134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4032137">//&nbsp;If&nbsp;the&nbsp;field&nbsp;is&nbsp;a&nbsp;chan&nbsp;or&nbsp;func&nbsp;or&nbsp;pointer&nbsp;thereto,&nbsp;don&#39;t&nbsp;send&nbsp;it.</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4032207">//&nbsp;That&nbsp;is,&nbsp;treat&nbsp;it&nbsp;like&nbsp;an&nbsp;unexported&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4032255">typ</span>&nbsp;<span class="op" id="4032259">:=</span>&nbsp;<span class="ident" id="4032262">field</span><span class="op" id="4032267">.</span><span class="ident" id="4032268">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4032274">for</span>&nbsp;<span class="ident" id="4032278">typ</span><span class="op" id="4032281">.</span><span class="ident" id="4032282">Kind</span><span class="op" id="4032286">(</span><span class="op" id="4032287">)</span>&nbsp;<span class="op" id="4032289">==</span>&nbsp;<span class="ident" id="4032292">reflect</span><span class="op" id="4032299">.</span><span class="ident" id="4032300">Ptr</span>&nbsp;<span class="op" id="4032304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4032308">typ</span>&nbsp;<span class="op" id="4032312">=</span>&nbsp;<span class="ident" id="4032314">typ</span><span class="op" id="4032317">.</span><span class="ident" id="4032318">Elem</span><span class="op" id="4032322">(</span><span class="op" id="4032323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4032326">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4032329">if</span>&nbsp;<span class="ident" id="4032332">typ</span><span class="op" id="4032335">.</span><span class="ident" id="4032336">Kind</span><span class="op" id="4032340">(</span><span class="op" id="4032341">)</span>&nbsp;<span class="op" id="4032343">==</span>&nbsp;<span class="ident" id="4032346">reflect</span><span class="op" id="4032353">.</span><span class="ident" id="4032354">Chan</span>&nbsp;<span class="op" id="4032359">||</span>&nbsp;<span class="ident" id="4032362">typ</span><span class="op" id="4032365">.</span><span class="ident" id="4032366">Kind</span><span class="op" id="4032370">(</span><span class="op" id="4032371">)</span>&nbsp;<span class="op" id="4032373">==</span>&nbsp;<span class="ident" id="4032376">reflect</span><span class="op" id="4032383">.</span><span class="ident" id="4032384">Func</span>&nbsp;<span class="op" id="4032389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4032393">return</span>&nbsp;<span class="builtintype" id="4032400">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4032407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4032410">return</span>&nbsp;<span class="builtintype" id="4032417">true</span><br>
<span class="lineno"></span><span class="op" id="4032422">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span><span class="comment" id="4032425">//&nbsp;getBaseType&nbsp;returns&nbsp;the&nbsp;Gob&nbsp;type&nbsp;describing&nbsp;the&nbsp;given&nbsp;reflect.Type&#39;s&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="4032508">//&nbsp;typeLock&nbsp;must&nbsp;be&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="4032534">func</span>&nbsp;<span class="ident" id="4032539">getBaseType</span><span class="op" id="4032550">(</span><span class="ident" id="4032551">name</span>&nbsp;<span class="builtintype" id="4032556">string</span><span class="op" id="4032562">,</span>&nbsp;<span class="ident" id="4032564">rt</span>&nbsp;<span class="ident" id="4032567">reflect</span><span class="op" id="4032574">.</span><span class="ident" id="4032575">Type</span><span class="op" id="4032579">)</span>&nbsp;<span class="op" id="4032581">(</span><span class="ident" id="4032582">gobType</span><span class="op" id="4032589">,</span>&nbsp;<span class="builtintype" id="4032591">error</span><span class="op" id="4032596">)</span>&nbsp;<span class="op" id="4032598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4032601">ut</span>&nbsp;<span class="op" id="4032604">:=</span>&nbsp;<span class="ident" id="4032607">userType</span><span class="op" id="4032615">(</span><span class="ident" id="4032616">rt</span><span class="op" id="4032618">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4032621">return</span>&nbsp;<span class="ident" id="4032628">getType</span><span class="op" id="4032635">(</span><span class="ident" id="4032636">name</span><span class="op" id="4032640">,</span>&nbsp;<span class="ident" id="4032642">ut</span><span class="op" id="4032644">,</span>&nbsp;<span class="ident" id="4032646">ut</span><span class="op" id="4032648">.</span><span class="ident" id="4032649">base</span><span class="op" id="4032653">)</span><br>
<span class="lineno"></span><span class="op" id="4032655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4032658">//&nbsp;getType&nbsp;returns&nbsp;the&nbsp;Gob&nbsp;type&nbsp;describing&nbsp;the&nbsp;given&nbsp;reflect.Type.</span><br>
<span class="lineno"></span><span class="comment" id="4032725">//&nbsp;Should&nbsp;be&nbsp;called&nbsp;only&nbsp;when&nbsp;handling&nbsp;GobEncoders/Decoders,</span><br>
<span class="lineno">600</span><span class="comment" id="4032786">//&nbsp;which&nbsp;may&nbsp;be&nbsp;pointers.&nbsp;&nbsp;All&nbsp;other&nbsp;types&nbsp;are&nbsp;handled&nbsp;through&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4032853">//&nbsp;base&nbsp;type,&nbsp;never&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span><span class="comment" id="4032884">//&nbsp;typeLock&nbsp;must&nbsp;be&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="4032910">func</span>&nbsp;<span class="ident" id="4032915">getType</span><span class="op" id="4032922">(</span><span class="ident" id="4032923">name</span>&nbsp;<span class="builtintype" id="4032928">string</span><span class="op" id="4032934">,</span>&nbsp;<span class="ident" id="4032936">ut</span>&nbsp;<span class="op" id="4032939">*</span><span class="ident" id="4032940">userTypeInfo</span><span class="op" id="4032952">,</span>&nbsp;<span class="ident" id="4032954">rt</span>&nbsp;<span class="ident" id="4032957">reflect</span><span class="op" id="4032964">.</span><span class="ident" id="4032965">Type</span><span class="op" id="4032969">)</span>&nbsp;<span class="op" id="4032971">(</span><span class="ident" id="4032972">gobType</span><span class="op" id="4032979">,</span>&nbsp;<span class="builtintype" id="4032981">error</span><span class="op" id="4032986">)</span>&nbsp;<span class="op" id="4032988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4032991">typ</span><span class="op" id="4032994">,</span>&nbsp;<span class="ident" id="4032996">present</span>&nbsp;<span class="op" id="4033004">:=</span>&nbsp;<span class="ident" id="4033007">types</span><span class="op" id="4033012">[</span><span class="ident" id="4033013">rt</span><span class="op" id="4033015">]</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4033018">if</span>&nbsp;<span class="ident" id="4033021">present</span>&nbsp;<span class="op" id="4033029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4033033">return</span>&nbsp;<span class="ident" id="4033040">typ</span><span class="op" id="4033043">,</span>&nbsp;<span class="ident" id="4033045">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4033050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4033053">typ</span><span class="op" id="4033056">,</span>&nbsp;<span class="ident" id="4033058">err</span>&nbsp;<span class="op" id="4033062">:=</span>&nbsp;<span class="ident" id="4033065">newTypeObject</span><span class="op" id="4033078">(</span><span class="ident" id="4033079">name</span><span class="op" id="4033083">,</span>&nbsp;<span class="ident" id="4033085">ut</span><span class="op" id="4033087">,</span>&nbsp;<span class="ident" id="4033089">rt</span><span class="op" id="4033091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4033094">if</span>&nbsp;<span class="ident" id="4033097">err</span>&nbsp;<span class="op" id="4033101">==</span>&nbsp;<span class="ident" id="4033104">nil</span>&nbsp;<span class="op" id="4033108">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4033112">types</span><span class="op" id="4033117">[</span><span class="ident" id="4033118">rt</span><span class="op" id="4033120">]</span>&nbsp;<span class="op" id="4033122">=</span>&nbsp;<span class="ident" id="4033124">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4033129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4033132">return</span>&nbsp;<span class="ident" id="4033139">typ</span><span class="op" id="4033142">,</span>&nbsp;<span class="ident" id="4033144">err</span><br>
<span class="lineno"></span><span class="op" id="4033148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span><span class="keyword" id="4033151">func</span>&nbsp;<span class="ident" id="4033156">checkId</span><span class="op" id="4033163">(</span><span class="ident" id="4033164">want</span><span class="op" id="4033168">,</span>&nbsp;<span class="ident" id="4033170">got</span>&nbsp;<span class="ident" id="4033174">typeId</span><span class="op" id="4033180">)</span>&nbsp;<span class="op" id="4033182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4033185">if</span>&nbsp;<span class="ident" id="4033188">want</span>&nbsp;<span class="op" id="4033193">!=</span>&nbsp;<span class="ident" id="4033196">got</span>&nbsp;<span class="op" id="4033200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4033204">fmt</span><span class="op" id="4033207">.</span><span class="ident" id="4033208">Fprintf</span><span class="op" id="4033215">(</span><span class="ident" id="4033216">os</span><span class="op" id="4033218">.</span><span class="ident" id="4033219">Stderr</span><span class="op" id="4033225">,</span>&nbsp;<span class="string" id="4033227">&#34;checkId:&nbsp;%d&nbsp;should&nbsp;be&nbsp;%d\n&#34;</span><span class="op" id="4033255">,</span>&nbsp;<span class="builtintype" id="4033257">int</span><span class="op" id="4033260">(</span><span class="ident" id="4033261">got</span><span class="op" id="4033264">)</span><span class="op" id="4033265">,</span>&nbsp;<span class="builtintype" id="4033267">int</span><span class="op" id="4033270">(</span><span class="ident" id="4033271">want</span><span class="op" id="4033275">)</span><span class="op" id="4033276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4033280">panic</span><span class="op" id="4033285">(</span><span class="string" id="4033286">&#34;bootstrap&nbsp;type&nbsp;wrong&nbsp;id:&nbsp;&#34;</span>&nbsp;<span class="op" id="4033314">+</span>&nbsp;<span class="ident" id="4033316">got</span><span class="op" id="4033319">.</span><span class="ident" id="4033320">name</span><span class="op" id="4033324">(</span><span class="op" id="4033325">)</span>&nbsp;<span class="op" id="4033327">+</span>&nbsp;<span class="string" id="4033329">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="4033333">+</span>&nbsp;<span class="ident" id="4033335">got</span><span class="op" id="4033338">.</span><span class="builtintype" id="4033339">string</span><span class="op" id="4033345">(</span><span class="op" id="4033346">)</span>&nbsp;<span class="op" id="4033348">+</span>&nbsp;<span class="string" id="4033350">&#34;&nbsp;not&nbsp;&#34;</span>&nbsp;<span class="op" id="4033358">+</span>&nbsp;<span class="ident" id="4033360">want</span><span class="op" id="4033364">.</span><span class="builtintype" id="4033365">string</span><span class="op" id="4033371">(</span><span class="op" id="4033372">)</span><span class="op" id="4033373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4033376">}</span><br>
<span class="lineno">620</span><span class="op" id="4033378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4033381">//&nbsp;used&nbsp;for&nbsp;building&nbsp;the&nbsp;basic&nbsp;types;&nbsp;called&nbsp;only&nbsp;from&nbsp;init().&nbsp;&nbsp;the&nbsp;incoming</span><br>
<span class="lineno"></span><span class="comment" id="4033458">//&nbsp;interface&nbsp;always&nbsp;refers&nbsp;to&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span><span class="keyword" id="4033499">func</span>&nbsp;<span class="ident" id="4033504">bootstrapType</span><span class="op" id="4033517">(</span><span class="ident" id="4033518">name</span>&nbsp;<span class="builtintype" id="4033523">string</span><span class="op" id="4033529">,</span>&nbsp;<span class="ident" id="4033531">e</span>&nbsp;<span class="keyword" id="4033533">interface</span><span class="op" id="4033542">{</span><span class="op" id="4033543">}</span><span class="op" id="4033544">,</span>&nbsp;<span class="ident" id="4033546">expect</span>&nbsp;<span class="ident" id="4033553">typeId</span><span class="op" id="4033559">)</span>&nbsp;<span class="ident" id="4033561">typeId</span>&nbsp;<span class="op" id="4033568">{</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4033571">rt</span>&nbsp;<span class="op" id="4033574">:=</span>&nbsp;<span class="ident" id="4033577">reflect</span><span class="op" id="4033584">.</span><span class="ident" id="4033585">TypeOf</span><span class="op" id="4033591">(</span><span class="ident" id="4033592">e</span><span class="op" id="4033593">)</span><span class="op" id="4033594">.</span><span class="ident" id="4033595">Elem</span><span class="op" id="4033599">(</span><span class="op" id="4033600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4033603">_</span><span class="op" id="4033604">,</span>&nbsp;<span class="ident" id="4033606">present</span>&nbsp;<span class="op" id="4033614">:=</span>&nbsp;<span class="ident" id="4033617">types</span><span class="op" id="4033622">[</span><span class="ident" id="4033623">rt</span><span class="op" id="4033625">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4033628">if</span>&nbsp;<span class="ident" id="4033631">present</span>&nbsp;<span class="op" id="4033639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4033643">panic</span><span class="op" id="4033648">(</span><span class="string" id="4033649">&#34;bootstrap&nbsp;type&nbsp;already&nbsp;present:&nbsp;&#34;</span>&nbsp;<span class="op" id="4033684">+</span>&nbsp;<span class="ident" id="4033686">name</span>&nbsp;<span class="op" id="4033691">+</span>&nbsp;<span class="string" id="4033693">&#34;,&nbsp;&#34;</span>&nbsp;<span class="op" id="4033698">+</span>&nbsp;<span class="ident" id="4033700">rt</span><span class="op" id="4033702">.</span><span class="ident" id="4033703">String</span><span class="op" id="4033709">(</span><span class="op" id="4033710">)</span><span class="op" id="4033711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4033714">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4033717">typ</span>&nbsp;<span class="op" id="4033721">:=</span>&nbsp;<span class="op" id="4033724">&amp;</span><span class="ident" id="4033725">CommonType</span><span class="op" id="4033735">{</span><span class="ident" id="4033736">Name</span><span class="op" id="4033740">:</span>&nbsp;<span class="ident" id="4033742">name</span><span class="op" id="4033746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4033749">types</span><span class="op" id="4033754">[</span><span class="ident" id="4033755">rt</span><span class="op" id="4033757">]</span>&nbsp;<span class="op" id="4033759">=</span>&nbsp;<span class="ident" id="4033761">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4033766">setTypeId</span><span class="op" id="4033775">(</span><span class="ident" id="4033776">typ</span><span class="op" id="4033779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4033782">checkId</span><span class="op" id="4033789">(</span><span class="ident" id="4033790">expect</span><span class="op" id="4033796">,</span>&nbsp;<span class="ident" id="4033798">nextId</span><span class="op" id="4033804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4033807">userType</span><span class="op" id="4033815">(</span><span class="ident" id="4033816">rt</span><span class="op" id="4033818">)</span>&nbsp;<span class="comment" id="4033820">//&nbsp;might&nbsp;as&nbsp;well&nbsp;cache&nbsp;it&nbsp;now</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4033851">return</span>&nbsp;<span class="ident" id="4033858">nextId</span><br>
<span class="lineno"></span><span class="op" id="4033865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4033868">//&nbsp;Representation&nbsp;of&nbsp;the&nbsp;information&nbsp;we&nbsp;send&nbsp;and&nbsp;receive&nbsp;about&nbsp;this&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="4033942">//&nbsp;Each&nbsp;value&nbsp;we&nbsp;send&nbsp;is&nbsp;preceded&nbsp;by&nbsp;its&nbsp;type&nbsp;definition:&nbsp;an&nbsp;encoded&nbsp;int.</span><br>
<span class="lineno">640</span><span class="comment" id="4034016">//&nbsp;However,&nbsp;the&nbsp;very&nbsp;first&nbsp;time&nbsp;we&nbsp;send&nbsp;the&nbsp;value,&nbsp;we&nbsp;first&nbsp;send&nbsp;the&nbsp;pair</span><br>
<span class="lineno"></span><span class="comment" id="4034090">//&nbsp;(-id,&nbsp;wireType).</span><br>
<span class="lineno"></span><span class="comment" id="4034110">//&nbsp;For&nbsp;bootstrapping&nbsp;purposes,&nbsp;we&nbsp;assume&nbsp;that&nbsp;the&nbsp;recipient&nbsp;knows&nbsp;how</span><br>
<span class="lineno"></span><span class="comment" id="4034180">//&nbsp;to&nbsp;decode&nbsp;a&nbsp;wireType;&nbsp;it&nbsp;is&nbsp;exactly&nbsp;the&nbsp;wireType&nbsp;struct&nbsp;here,&nbsp;interpreted</span><br>
<span class="lineno"></span><span class="comment" id="4034257">//&nbsp;using&nbsp;the&nbsp;gob&nbsp;rules&nbsp;for&nbsp;sending&nbsp;a&nbsp;structure,&nbsp;except&nbsp;that&nbsp;we&nbsp;assume&nbsp;the</span><br>
<span class="lineno">645</span><span class="comment" id="4034331">//&nbsp;ids&nbsp;for&nbsp;wireType&nbsp;and&nbsp;structType&nbsp;etc.&nbsp;are&nbsp;known.&nbsp;&nbsp;The&nbsp;relevant&nbsp;pieces</span><br>
<span class="lineno"></span><span class="comment" id="4034403">//&nbsp;are&nbsp;built&nbsp;in&nbsp;encode.go&#39;s&nbsp;init()&nbsp;function.</span><br>
<span class="lineno"></span><span class="comment" id="4034448">//&nbsp;To&nbsp;maintain&nbsp;binary&nbsp;compatibility,&nbsp;if&nbsp;you&nbsp;extend&nbsp;this&nbsp;type,&nbsp;always&nbsp;put</span><br>
<span class="lineno"></span><span class="comment" id="4034521">//&nbsp;the&nbsp;new&nbsp;fields&nbsp;last.</span><br>
<span class="lineno"></span><span class="keyword" id="4034545">type</span>&nbsp;<span class="ident" id="4034550">wireType</span>&nbsp;<span class="keyword" id="4034559">struct</span>&nbsp;<span class="op" id="4034566">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4034569">ArrayT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4034586">*</span><span class="ident" id="4034587">arrayType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4034598">SliceT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4034615">*</span><span class="ident" id="4034616">sliceType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4034627">StructT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4034644">*</span><span class="ident" id="4034645">structType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4034657">MapT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4034674">*</span><span class="ident" id="4034675">mapType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4034684">GobEncoderT</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4034701">*</span><span class="ident" id="4034702">gobEncoderType</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4034718">BinaryMarshalerT</span>&nbsp;<span class="op" id="4034735">*</span><span class="ident" id="4034736">gobEncoderType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4034752">TextMarshalerT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4034769">*</span><span class="ident" id="4034770">gobEncoderType</span><br>
<span class="lineno"></span><span class="op" id="4034785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4034788">func</span>&nbsp;<span class="op" id="4034793">(</span><span class="ident" id="4034794">w</span>&nbsp;<span class="op" id="4034796">*</span><span class="ident" id="4034797">wireType</span><span class="op" id="4034805">)</span>&nbsp;<span class="builtintype" id="4034807">string</span><span class="op" id="4034813">(</span><span class="op" id="4034814">)</span>&nbsp;<span class="builtintype" id="4034816">string</span>&nbsp;<span class="op" id="4034823">{</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4034826">const</span>&nbsp;<span class="ident" id="4034832">unknown</span>&nbsp;<span class="op" id="4034840">=</span>&nbsp;<span class="string" id="4034842">&#34;unknown&nbsp;type&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4034858">if</span>&nbsp;<span class="ident" id="4034861">w</span>&nbsp;<span class="op" id="4034863">==</span>&nbsp;<span class="ident" id="4034866">nil</span>&nbsp;<span class="op" id="4034870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4034874">return</span>&nbsp;<span class="ident" id="4034881">unknown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4034890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4034893">switch</span>&nbsp;<span class="op" id="4034900">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4034903">case</span>&nbsp;<span class="ident" id="4034908">w</span><span class="op" id="4034909">.</span><span class="ident" id="4034910">ArrayT</span>&nbsp;<span class="op" id="4034917">!=</span>&nbsp;<span class="ident" id="4034920">nil</span><span class="op" id="4034923">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4034927">return</span>&nbsp;<span class="ident" id="4034934">w</span><span class="op" id="4034935">.</span><span class="ident" id="4034936">ArrayT</span><span class="op" id="4034942">.</span><span class="ident" id="4034943">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4034949">case</span>&nbsp;<span class="ident" id="4034954">w</span><span class="op" id="4034955">.</span><span class="ident" id="4034956">SliceT</span>&nbsp;<span class="op" id="4034963">!=</span>&nbsp;<span class="ident" id="4034966">nil</span><span class="op" id="4034969">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4034973">return</span>&nbsp;<span class="ident" id="4034980">w</span><span class="op" id="4034981">.</span><span class="ident" id="4034982">SliceT</span><span class="op" id="4034988">.</span><span class="ident" id="4034989">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4034995">case</span>&nbsp;<span class="ident" id="4035000">w</span><span class="op" id="4035001">.</span><span class="ident" id="4035002">StructT</span>&nbsp;<span class="op" id="4035010">!=</span>&nbsp;<span class="ident" id="4035013">nil</span><span class="op" id="4035016">:</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4035020">return</span>&nbsp;<span class="ident" id="4035027">w</span><span class="op" id="4035028">.</span><span class="ident" id="4035029">StructT</span><span class="op" id="4035036">.</span><span class="ident" id="4035037">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4035043">case</span>&nbsp;<span class="ident" id="4035048">w</span><span class="op" id="4035049">.</span><span class="ident" id="4035050">MapT</span>&nbsp;<span class="op" id="4035055">!=</span>&nbsp;<span class="ident" id="4035058">nil</span><span class="op" id="4035061">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4035065">return</span>&nbsp;<span class="ident" id="4035072">w</span><span class="op" id="4035073">.</span><span class="ident" id="4035074">MapT</span><span class="op" id="4035078">.</span><span class="ident" id="4035079">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4035085">case</span>&nbsp;<span class="ident" id="4035090">w</span><span class="op" id="4035091">.</span><span class="ident" id="4035092">GobEncoderT</span>&nbsp;<span class="op" id="4035104">!=</span>&nbsp;<span class="ident" id="4035107">nil</span><span class="op" id="4035110">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4035114">return</span>&nbsp;<span class="ident" id="4035121">w</span><span class="op" id="4035122">.</span><span class="ident" id="4035123">GobEncoderT</span><span class="op" id="4035134">.</span><span class="ident" id="4035135">Name</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4035141">case</span>&nbsp;<span class="ident" id="4035146">w</span><span class="op" id="4035147">.</span><span class="ident" id="4035148">BinaryMarshalerT</span>&nbsp;<span class="op" id="4035165">!=</span>&nbsp;<span class="ident" id="4035168">nil</span><span class="op" id="4035171">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4035175">return</span>&nbsp;<span class="ident" id="4035182">w</span><span class="op" id="4035183">.</span><span class="ident" id="4035184">BinaryMarshalerT</span><span class="op" id="4035200">.</span><span class="ident" id="4035201">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4035207">case</span>&nbsp;<span class="ident" id="4035212">w</span><span class="op" id="4035213">.</span><span class="ident" id="4035214">TextMarshalerT</span>&nbsp;<span class="op" id="4035229">!=</span>&nbsp;<span class="ident" id="4035232">nil</span><span class="op" id="4035235">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4035239">return</span>&nbsp;<span class="ident" id="4035246">w</span><span class="op" id="4035247">.</span><span class="ident" id="4035248">TextMarshalerT</span><span class="op" id="4035262">.</span><span class="ident" id="4035263">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4035269">}</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4035272">return</span>&nbsp;<span class="ident" id="4035279">unknown</span><br>
<span class="lineno"></span><span class="op" id="4035287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4035290">type</span>&nbsp;<span class="ident" id="4035295">typeInfo</span>&nbsp;<span class="keyword" id="4035304">struct</span>&nbsp;<span class="op" id="4035311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4035314">id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4035322">typeId</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4035330">encInit</span>&nbsp;<span class="ident" id="4035338">sync</span><span class="op" id="4035342">.</span><span class="ident" id="4035343">Mutex</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4035351">//&nbsp;protects&nbsp;creation&nbsp;of&nbsp;encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4035384">encoder</span>&nbsp;<span class="ident" id="4035392">atomic</span><span class="op" id="4035398">.</span><span class="ident" id="4035399">Value</span>&nbsp;<span class="comment" id="4035405">//&nbsp;*encEngine</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4035420">wire</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4035428">*</span><span class="ident" id="4035429">wireType</span><br>
<span class="lineno"></span><span class="op" id="4035438">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">690</span><span class="comment" id="4035441">//&nbsp;typeInfoMap&nbsp;is&nbsp;an&nbsp;atomic&nbsp;pointer&nbsp;to&nbsp;map[reflect.Type]*typeInfo.</span><br>
<span class="lineno"></span><span class="comment" id="4035508">//&nbsp;It&#39;s&nbsp;updated&nbsp;copy-on-write.&nbsp;Readers&nbsp;just&nbsp;do&nbsp;an&nbsp;atomic&nbsp;load</span><br>
<span class="lineno"></span><span class="comment" id="4035570">//&nbsp;to&nbsp;get&nbsp;the&nbsp;current&nbsp;version&nbsp;of&nbsp;the&nbsp;map.&nbsp;Writers&nbsp;make&nbsp;a&nbsp;full&nbsp;copy&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4035640">//&nbsp;the&nbsp;map&nbsp;and&nbsp;atomically&nbsp;update&nbsp;the&nbsp;pointer&nbsp;to&nbsp;point&nbsp;to&nbsp;the&nbsp;new&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="4035710">//&nbsp;Under&nbsp;heavy&nbsp;read&nbsp;contention,&nbsp;this&nbsp;is&nbsp;significantly&nbsp;faster&nbsp;than&nbsp;a&nbsp;map</span><br>
<span class="lineno">695</span><span class="comment" id="4035782">//&nbsp;protected&nbsp;by&nbsp;a&nbsp;mutex.</span><br>
<span class="lineno"></span><span class="keyword" id="4035807">var</span>&nbsp;<span class="ident" id="4035811">typeInfoMap</span>&nbsp;<span class="ident" id="4035823">atomic</span><span class="op" id="4035829">.</span><span class="ident" id="4035830">Value</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4035837">func</span>&nbsp;<span class="ident" id="4035842">lookupTypeInfo</span><span class="op" id="4035856">(</span><span class="ident" id="4035857">rt</span>&nbsp;<span class="ident" id="4035860">reflect</span><span class="op" id="4035867">.</span><span class="ident" id="4035868">Type</span><span class="op" id="4035872">)</span>&nbsp;<span class="op" id="4035874">*</span><span class="ident" id="4035875">typeInfo</span>&nbsp;<span class="op" id="4035884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4035887">m</span><span class="op" id="4035888">,</span>&nbsp;<span class="ident" id="4035890">_</span>&nbsp;<span class="op" id="4035892">:=</span>&nbsp;<span class="ident" id="4035895">typeInfoMap</span><span class="op" id="4035906">.</span><span class="ident" id="4035907">Load</span><span class="op" id="4035911">(</span><span class="op" id="4035912">)</span><span class="op" id="4035913">.</span><span class="op" id="4035914">(</span><span class="keyword" id="4035915">map</span><span class="op" id="4035918">[</span><span class="ident" id="4035919">reflect</span><span class="op" id="4035926">.</span><span class="ident" id="4035927">Type</span><span class="op" id="4035931">]</span><span class="op" id="4035932">*</span><span class="ident" id="4035933">typeInfo</span><span class="op" id="4035941">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4035944">return</span>&nbsp;<span class="ident" id="4035951">m</span><span class="op" id="4035952">[</span><span class="ident" id="4035953">rt</span><span class="op" id="4035955">]</span><br>
<span class="lineno"></span><span class="op" id="4035957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4035960">func</span>&nbsp;<span class="ident" id="4035965">getTypeInfo</span><span class="op" id="4035976">(</span><span class="ident" id="4035977">ut</span>&nbsp;<span class="op" id="4035980">*</span><span class="ident" id="4035981">userTypeInfo</span><span class="op" id="4035993">)</span>&nbsp;<span class="op" id="4035995">(</span><span class="op" id="4035996">*</span><span class="ident" id="4035997">typeInfo</span><span class="op" id="4036005">,</span>&nbsp;<span class="builtintype" id="4036007">error</span><span class="op" id="4036012">)</span>&nbsp;<span class="op" id="4036014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036017">rt</span>&nbsp;<span class="op" id="4036020">:=</span>&nbsp;<span class="ident" id="4036023">ut</span><span class="op" id="4036025">.</span><span class="ident" id="4036026">base</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4036032">if</span>&nbsp;<span class="ident" id="4036035">ut</span><span class="op" id="4036037">.</span><span class="ident" id="4036038">externalEnc</span>&nbsp;<span class="op" id="4036050">!=</span>&nbsp;<span class="num" id="4036053">0</span>&nbsp;<span class="op" id="4036055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4036059">//&nbsp;We&nbsp;want&nbsp;the&nbsp;user&nbsp;type,&nbsp;not&nbsp;the&nbsp;base&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036106">rt</span>&nbsp;<span class="op" id="4036109">=</span>&nbsp;<span class="ident" id="4036111">ut</span><span class="op" id="4036113">.</span><span class="ident" id="4036114">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4036120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4036123">if</span>&nbsp;<span class="ident" id="4036126">info</span>&nbsp;<span class="op" id="4036131">:=</span>&nbsp;<span class="ident" id="4036134">lookupTypeInfo</span><span class="op" id="4036148">(</span><span class="ident" id="4036149">rt</span><span class="op" id="4036151">)</span><span class="op" id="4036152">;</span>&nbsp;<span class="ident" id="4036154">info</span>&nbsp;<span class="op" id="4036159">!=</span>&nbsp;<span class="ident" id="4036162">nil</span>&nbsp;<span class="op" id="4036166">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4036170">return</span>&nbsp;<span class="ident" id="4036177">info</span><span class="op" id="4036181">,</span>&nbsp;<span class="ident" id="4036183">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4036188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4036191">return</span>&nbsp;<span class="ident" id="4036198">buildTypeInfo</span><span class="op" id="4036211">(</span><span class="ident" id="4036212">ut</span><span class="op" id="4036214">,</span>&nbsp;<span class="ident" id="4036216">rt</span><span class="op" id="4036218">)</span><br>
<span class="lineno"></span><span class="op" id="4036220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">715</span><span class="comment" id="4036223">//&nbsp;buildTypeInfo&nbsp;constructs&nbsp;the&nbsp;type&nbsp;information&nbsp;for&nbsp;the&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="4036285">//&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;the&nbsp;type&nbsp;info&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="4036324">func</span>&nbsp;<span class="ident" id="4036329">buildTypeInfo</span><span class="op" id="4036342">(</span><span class="ident" id="4036343">ut</span>&nbsp;<span class="op" id="4036346">*</span><span class="ident" id="4036347">userTypeInfo</span><span class="op" id="4036359">,</span>&nbsp;<span class="ident" id="4036361">rt</span>&nbsp;<span class="ident" id="4036364">reflect</span><span class="op" id="4036371">.</span><span class="ident" id="4036372">Type</span><span class="op" id="4036376">)</span>&nbsp;<span class="op" id="4036378">(</span><span class="op" id="4036379">*</span><span class="ident" id="4036380">typeInfo</span><span class="op" id="4036388">,</span>&nbsp;<span class="builtintype" id="4036390">error</span><span class="op" id="4036395">)</span>&nbsp;<span class="op" id="4036397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036400">typeLock</span><span class="op" id="4036408">.</span><span class="ident" id="4036409">Lock</span><span class="op" id="4036413">(</span><span class="op" id="4036414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4036417">defer</span>&nbsp;<span class="ident" id="4036423">typeLock</span><span class="op" id="4036431">.</span><span class="ident" id="4036432">Unlock</span><span class="op" id="4036438">(</span><span class="op" id="4036439">)</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4036443">if</span>&nbsp;<span class="ident" id="4036446">info</span>&nbsp;<span class="op" id="4036451">:=</span>&nbsp;<span class="ident" id="4036454">lookupTypeInfo</span><span class="op" id="4036468">(</span><span class="ident" id="4036469">rt</span><span class="op" id="4036471">)</span><span class="op" id="4036472">;</span>&nbsp;<span class="ident" id="4036474">info</span>&nbsp;<span class="op" id="4036479">!=</span>&nbsp;<span class="ident" id="4036482">nil</span>&nbsp;<span class="op" id="4036486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4036490">return</span>&nbsp;<span class="ident" id="4036497">info</span><span class="op" id="4036501">,</span>&nbsp;<span class="ident" id="4036503">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4036508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036512">gt</span><span class="op" id="4036514">,</span>&nbsp;<span class="ident" id="4036516">err</span>&nbsp;<span class="op" id="4036520">:=</span>&nbsp;<span class="ident" id="4036523">getBaseType</span><span class="op" id="4036534">(</span><span class="ident" id="4036535">rt</span><span class="op" id="4036537">.</span><span class="ident" id="4036538">Name</span><span class="op" id="4036542">(</span><span class="op" id="4036543">)</span><span class="op" id="4036544">,</span>&nbsp;<span class="ident" id="4036546">rt</span><span class="op" id="4036548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4036551">if</span>&nbsp;<span class="ident" id="4036554">err</span>&nbsp;<span class="op" id="4036558">!=</span>&nbsp;<span class="ident" id="4036561">nil</span>&nbsp;<span class="op" id="4036565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4036569">return</span>&nbsp;<span class="ident" id="4036576">nil</span><span class="op" id="4036579">,</span>&nbsp;<span class="ident" id="4036581">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4036586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036589">info</span>&nbsp;<span class="op" id="4036594">:=</span>&nbsp;<span class="op" id="4036597">&amp;</span><span class="ident" id="4036598">typeInfo</span><span class="op" id="4036606">{</span><span class="ident" id="4036607">id</span><span class="op" id="4036609">:</span>&nbsp;<span class="ident" id="4036611">gt</span><span class="op" id="4036613">.</span><span class="ident" id="4036614">id</span><span class="op" id="4036616">(</span><span class="op" id="4036617">)</span><span class="op" id="4036618">}</span><br>
<span class="lineno">730</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4036622">if</span>&nbsp;<span class="ident" id="4036625">ut</span><span class="op" id="4036627">.</span><span class="ident" id="4036628">externalEnc</span>&nbsp;<span class="op" id="4036640">!=</span>&nbsp;<span class="num" id="4036643">0</span>&nbsp;<span class="op" id="4036645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036649">userType</span><span class="op" id="4036657">,</span>&nbsp;<span class="ident" id="4036659">err</span>&nbsp;<span class="op" id="4036663">:=</span>&nbsp;<span class="ident" id="4036666">getType</span><span class="op" id="4036673">(</span><span class="ident" id="4036674">rt</span><span class="op" id="4036676">.</span><span class="ident" id="4036677">Name</span><span class="op" id="4036681">(</span><span class="op" id="4036682">)</span><span class="op" id="4036683">,</span>&nbsp;<span class="ident" id="4036685">ut</span><span class="op" id="4036687">,</span>&nbsp;<span class="ident" id="4036689">rt</span><span class="op" id="4036691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4036695">if</span>&nbsp;<span class="ident" id="4036698">err</span>&nbsp;<span class="op" id="4036702">!=</span>&nbsp;<span class="ident" id="4036705">nil</span>&nbsp;<span class="op" id="4036709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4036714">return</span>&nbsp;<span class="ident" id="4036721">nil</span><span class="op" id="4036724">,</span>&nbsp;<span class="ident" id="4036726">err</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4036732">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036736">gt</span>&nbsp;<span class="op" id="4036739">:=</span>&nbsp;<span class="ident" id="4036742">userType</span><span class="op" id="4036750">.</span><span class="ident" id="4036751">id</span><span class="op" id="4036753">(</span><span class="op" id="4036754">)</span><span class="op" id="4036755">.</span><span class="ident" id="4036756">gobType</span><span class="op" id="4036763">(</span><span class="op" id="4036764">)</span><span class="op" id="4036765">.</span><span class="op" id="4036766">(</span><span class="op" id="4036767">*</span><span class="ident" id="4036768">gobEncoderType</span><span class="op" id="4036782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4036786">switch</span>&nbsp;<span class="ident" id="4036793">ut</span><span class="op" id="4036795">.</span><span class="ident" id="4036796">externalEnc</span>&nbsp;<span class="op" id="4036808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4036812">case</span>&nbsp;<span class="ident" id="4036817">xGob</span><span class="op" id="4036821">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036826">info</span><span class="op" id="4036830">.</span><span class="ident" id="4036831">wire</span>&nbsp;<span class="op" id="4036836">=</span>&nbsp;<span class="op" id="4036838">&amp;</span><span class="ident" id="4036839">wireType</span><span class="op" id="4036847">{</span><span class="ident" id="4036848">GobEncoderT</span><span class="op" id="4036859">:</span>&nbsp;<span class="ident" id="4036861">gt</span><span class="op" id="4036863">}</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4036867">case</span>&nbsp;<span class="ident" id="4036872">xBinary</span><span class="op" id="4036879">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036884">info</span><span class="op" id="4036888">.</span><span class="ident" id="4036889">wire</span>&nbsp;<span class="op" id="4036894">=</span>&nbsp;<span class="op" id="4036896">&amp;</span><span class="ident" id="4036897">wireType</span><span class="op" id="4036905">{</span><span class="ident" id="4036906">BinaryMarshalerT</span><span class="op" id="4036922">:</span>&nbsp;<span class="ident" id="4036924">gt</span><span class="op" id="4036926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4036930">case</span>&nbsp;<span class="ident" id="4036935">xText</span><span class="op" id="4036940">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036945">info</span><span class="op" id="4036949">.</span><span class="ident" id="4036950">wire</span>&nbsp;<span class="op" id="4036955">=</span>&nbsp;<span class="op" id="4036957">&amp;</span><span class="ident" id="4036958">wireType</span><span class="op" id="4036966">{</span><span class="ident" id="4036967">TextMarshalerT</span><span class="op" id="4036981">:</span>&nbsp;<span class="ident" id="4036983">gt</span><span class="op" id="4036985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4036989">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036993">rt</span>&nbsp;<span class="op" id="4036996">=</span>&nbsp;<span class="ident" id="4036998">ut</span><span class="op" id="4037000">.</span><span class="ident" id="4037001">user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4037007">}</span>&nbsp;<span class="keyword" id="4037009">else</span>&nbsp;<span class="op" id="4037014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037018">t</span>&nbsp;<span class="op" id="4037020">:=</span>&nbsp;<span class="ident" id="4037023">info</span><span class="op" id="4037027">.</span><span class="ident" id="4037028">id</span><span class="op" id="4037030">.</span><span class="ident" id="4037031">gobType</span><span class="op" id="4037038">(</span><span class="op" id="4037039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4037043">switch</span>&nbsp;<span class="ident" id="4037050">typ</span>&nbsp;<span class="op" id="4037054">:=</span>&nbsp;<span class="ident" id="4037057">rt</span><span class="op" id="4037059">;</span>&nbsp;<span class="ident" id="4037061">typ</span><span class="op" id="4037064">.</span><span class="ident" id="4037065">Kind</span><span class="op" id="4037069">(</span><span class="op" id="4037070">)</span>&nbsp;<span class="op" id="4037072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4037076">case</span>&nbsp;<span class="ident" id="4037081">reflect</span><span class="op" id="4037088">.</span><span class="ident" id="4037089">Array</span><span class="op" id="4037094">:</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037099">info</span><span class="op" id="4037103">.</span><span class="ident" id="4037104">wire</span>&nbsp;<span class="op" id="4037109">=</span>&nbsp;<span class="op" id="4037111">&amp;</span><span class="ident" id="4037112">wireType</span><span class="op" id="4037120">{</span><span class="ident" id="4037121">ArrayT</span><span class="op" id="4037127">:</span>&nbsp;<span class="ident" id="4037129">t</span><span class="op" id="4037130">.</span><span class="op" id="4037131">(</span><span class="op" id="4037132">*</span><span class="ident" id="4037133">arrayType</span><span class="op" id="4037142">)</span><span class="op" id="4037143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4037147">case</span>&nbsp;<span class="ident" id="4037152">reflect</span><span class="op" id="4037159">.</span><span class="ident" id="4037160">Map</span><span class="op" id="4037163">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037168">info</span><span class="op" id="4037172">.</span><span class="ident" id="4037173">wire</span>&nbsp;<span class="op" id="4037178">=</span>&nbsp;<span class="op" id="4037180">&amp;</span><span class="ident" id="4037181">wireType</span><span class="op" id="4037189">{</span><span class="ident" id="4037190">MapT</span><span class="op" id="4037194">:</span>&nbsp;<span class="ident" id="4037196">t</span><span class="op" id="4037197">.</span><span class="op" id="4037198">(</span><span class="op" id="4037199">*</span><span class="ident" id="4037200">mapType</span><span class="op" id="4037207">)</span><span class="op" id="4037208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4037212">case</span>&nbsp;<span class="ident" id="4037217">reflect</span><span class="op" id="4037224">.</span><span class="ident" id="4037225">Slice</span><span class="op" id="4037230">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4037235">//&nbsp;[]byte&nbsp;==&nbsp;[]uint8&nbsp;is&nbsp;a&nbsp;special&nbsp;case&nbsp;handled&nbsp;separately</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4037296">if</span>&nbsp;<span class="ident" id="4037299">typ</span><span class="op" id="4037302">.</span><span class="ident" id="4037303">Elem</span><span class="op" id="4037307">(</span><span class="op" id="4037308">)</span><span class="op" id="4037309">.</span><span class="ident" id="4037310">Kind</span><span class="op" id="4037314">(</span><span class="op" id="4037315">)</span>&nbsp;<span class="op" id="4037317">!=</span>&nbsp;<span class="ident" id="4037320">reflect</span><span class="op" id="4037327">.</span><span class="ident" id="4037328">Uint8</span>&nbsp;<span class="op" id="4037334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037340">info</span><span class="op" id="4037344">.</span><span class="ident" id="4037345">wire</span>&nbsp;<span class="op" id="4037350">=</span>&nbsp;<span class="op" id="4037352">&amp;</span><span class="ident" id="4037353">wireType</span><span class="op" id="4037361">{</span><span class="ident" id="4037362">SliceT</span><span class="op" id="4037368">:</span>&nbsp;<span class="ident" id="4037370">t</span><span class="op" id="4037371">.</span><span class="op" id="4037372">(</span><span class="op" id="4037373">*</span><span class="ident" id="4037374">sliceType</span><span class="op" id="4037383">)</span><span class="op" id="4037384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4037389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4037393">case</span>&nbsp;<span class="ident" id="4037398">reflect</span><span class="op" id="4037405">.</span><span class="ident" id="4037406">Struct</span><span class="op" id="4037412">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037417">info</span><span class="op" id="4037421">.</span><span class="ident" id="4037422">wire</span>&nbsp;<span class="op" id="4037427">=</span>&nbsp;<span class="op" id="4037429">&amp;</span><span class="ident" id="4037430">wireType</span><span class="op" id="4037438">{</span><span class="ident" id="4037439">StructT</span><span class="op" id="4037446">:</span>&nbsp;<span class="ident" id="4037448">t</span><span class="op" id="4037449">.</span><span class="op" id="4037450">(</span><span class="op" id="4037451">*</span><span class="ident" id="4037452">structType</span><span class="op" id="4037462">)</span><span class="op" id="4037463">}</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4037467">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4037470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4037474">//&nbsp;Create&nbsp;new&nbsp;map&nbsp;with&nbsp;old&nbsp;contents&nbsp;plus&nbsp;new&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037527">newm</span>&nbsp;<span class="op" id="4037532">:=</span>&nbsp;<span class="builtinfunc" id="4037535">make</span><span class="op" id="4037539">(</span><span class="keyword" id="4037540">map</span><span class="op" id="4037543">[</span><span class="ident" id="4037544">reflect</span><span class="op" id="4037551">.</span><span class="ident" id="4037552">Type</span><span class="op" id="4037556">]</span><span class="op" id="4037557">*</span><span class="ident" id="4037558">typeInfo</span><span class="op" id="4037566">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037569">m</span><span class="op" id="4037570">,</span>&nbsp;<span class="ident" id="4037572">_</span>&nbsp;<span class="op" id="4037574">:=</span>&nbsp;<span class="ident" id="4037577">typeInfoMap</span><span class="op" id="4037588">.</span><span class="ident" id="4037589">Load</span><span class="op" id="4037593">(</span><span class="op" id="4037594">)</span><span class="op" id="4037595">.</span><span class="op" id="4037596">(</span><span class="keyword" id="4037597">map</span><span class="op" id="4037600">[</span><span class="ident" id="4037601">reflect</span><span class="op" id="4037608">.</span><span class="ident" id="4037609">Type</span><span class="op" id="4037613">]</span><span class="op" id="4037614">*</span><span class="ident" id="4037615">typeInfo</span><span class="op" id="4037623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4037626">for</span>&nbsp;<span class="ident" id="4037630">k</span><span class="op" id="4037631">,</span>&nbsp;<span class="ident" id="4037633">v</span>&nbsp;<span class="op" id="4037635">:=</span>&nbsp;<span class="keyword" id="4037638">range</span>&nbsp;<span class="ident" id="4037644">m</span>&nbsp;<span class="op" id="4037646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037650">newm</span><span class="op" id="4037654">[</span><span class="ident" id="4037655">k</span><span class="op" id="4037656">]</span>&nbsp;<span class="op" id="4037658">=</span>&nbsp;<span class="ident" id="4037660">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4037663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037666">newm</span><span class="op" id="4037670">[</span><span class="ident" id="4037671">rt</span><span class="op" id="4037673">]</span>&nbsp;<span class="op" id="4037675">=</span>&nbsp;<span class="ident" id="4037677">info</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037683">typeInfoMap</span><span class="op" id="4037694">.</span><span class="ident" id="4037695">Store</span><span class="op" id="4037700">(</span><span class="ident" id="4037701">newm</span><span class="op" id="4037705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4037708">return</span>&nbsp;<span class="ident" id="4037715">info</span><span class="op" id="4037719">,</span>&nbsp;<span class="ident" id="4037721">nil</span><br>
<span class="lineno"></span><span class="op" id="4037725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4037728">//&nbsp;Called&nbsp;only&nbsp;when&nbsp;a&nbsp;panic&nbsp;is&nbsp;acceptable&nbsp;and&nbsp;unexpected.</span><br>
<span class="lineno">775</span><span class="keyword" id="4037786">func</span>&nbsp;<span class="ident" id="4037791">mustGetTypeInfo</span><span class="op" id="4037806">(</span><span class="ident" id="4037807">rt</span>&nbsp;<span class="ident" id="4037810">reflect</span><span class="op" id="4037817">.</span><span class="ident" id="4037818">Type</span><span class="op" id="4037822">)</span>&nbsp;<span class="op" id="4037824">*</span><span class="ident" id="4037825">typeInfo</span>&nbsp;<span class="op" id="4037834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037837">t</span><span class="op" id="4037838">,</span>&nbsp;<span class="ident" id="4037840">err</span>&nbsp;<span class="op" id="4037844">:=</span>&nbsp;<span class="ident" id="4037847">getTypeInfo</span><span class="op" id="4037858">(</span><span class="ident" id="4037859">userType</span><span class="op" id="4037867">(</span><span class="ident" id="4037868">rt</span><span class="op" id="4037870">)</span><span class="op" id="4037871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4037874">if</span>&nbsp;<span class="ident" id="4037877">err</span>&nbsp;<span class="op" id="4037881">!=</span>&nbsp;<span class="ident" id="4037884">nil</span>&nbsp;<span class="op" id="4037888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4037892">panic</span><span class="op" id="4037897">(</span><span class="string" id="4037898">&#34;getTypeInfo:&nbsp;&#34;</span>&nbsp;<span class="op" id="4037914">+</span>&nbsp;<span class="ident" id="4037916">err</span><span class="op" id="4037919">.</span><span class="ident" id="4037920">Error</span><span class="op" id="4037925">(</span><span class="op" id="4037926">)</span><span class="op" id="4037927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4037930">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4037933">return</span>&nbsp;<span class="ident" id="4037940">t</span><br>
<span class="lineno"></span><span class="op" id="4037942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4037945">//&nbsp;GobEncoder&nbsp;is&nbsp;the&nbsp;interface&nbsp;describing&nbsp;data&nbsp;that&nbsp;provides&nbsp;its&nbsp;own</span><br>
<span class="lineno"></span><span class="comment" id="4038014">//&nbsp;representation&nbsp;for&nbsp;encoding&nbsp;values&nbsp;for&nbsp;transmission&nbsp;to&nbsp;a&nbsp;GobDecoder.</span><br>
<span class="lineno">785</span><span class="comment" id="4038086">//&nbsp;A&nbsp;type&nbsp;that&nbsp;implements&nbsp;GobEncoder&nbsp;and&nbsp;GobDecoder&nbsp;has&nbsp;complete</span><br>
<span class="lineno"></span><span class="comment" id="4038151">//&nbsp;control&nbsp;over&nbsp;the&nbsp;representation&nbsp;of&nbsp;its&nbsp;data&nbsp;and&nbsp;may&nbsp;therefore</span><br>
<span class="lineno"></span><span class="comment" id="4038216">//&nbsp;contain&nbsp;things&nbsp;such&nbsp;as&nbsp;private&nbsp;fields,&nbsp;channels,&nbsp;and&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="4038283">//&nbsp;which&nbsp;are&nbsp;not&nbsp;usually&nbsp;transmissible&nbsp;in&nbsp;gob&nbsp;streams.</span><br>
<span class="lineno"></span><span class="comment" id="4038338">//</span><br>
<span class="lineno">790</span><span class="comment" id="4038341">//&nbsp;Note:&nbsp;Since&nbsp;gobs&nbsp;can&nbsp;be&nbsp;stored&nbsp;permanently,&nbsp;It&nbsp;is&nbsp;good&nbsp;design</span><br>
<span class="lineno"></span><span class="comment" id="4038406">//&nbsp;to&nbsp;guarantee&nbsp;the&nbsp;encoding&nbsp;used&nbsp;by&nbsp;a&nbsp;GobEncoder&nbsp;is&nbsp;stable&nbsp;as&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4038473">//&nbsp;software&nbsp;evolves.&nbsp;&nbsp;For&nbsp;instance,&nbsp;it&nbsp;might&nbsp;make&nbsp;sense&nbsp;for&nbsp;GobEncode</span><br>
<span class="lineno"></span><span class="comment" id="4038543">//&nbsp;to&nbsp;include&nbsp;a&nbsp;version&nbsp;number&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="4038591">type</span>&nbsp;<span class="ident" id="4038596">GobEncoder</span>&nbsp;<span class="keyword" id="4038607">interface</span>&nbsp;<span class="op" id="4038617">{</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4038620">//&nbsp;GobEncode&nbsp;returns&nbsp;a&nbsp;byte&nbsp;slice&nbsp;representing&nbsp;the&nbsp;encoding&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4038688">//&nbsp;receiver&nbsp;for&nbsp;transmission&nbsp;to&nbsp;a&nbsp;GobDecoder,&nbsp;usually&nbsp;of&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4038755">//&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4038774">GobEncode</span><span class="op" id="4038783">(</span><span class="op" id="4038784">)</span>&nbsp;<span class="op" id="4038786">(</span><span class="op" id="4038787">[</span><span class="op" id="4038788">]</span><span class="builtintype" id="4038789">byte</span><span class="op" id="4038793">,</span>&nbsp;<span class="builtintype" id="4038795">error</span><span class="op" id="4038800">)</span><br>
<span class="lineno"></span><span class="op" id="4038802">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span><span class="comment" id="4038805">//&nbsp;GobDecoder&nbsp;is&nbsp;the&nbsp;interface&nbsp;describing&nbsp;data&nbsp;that&nbsp;provides&nbsp;its&nbsp;own</span><br>
<span class="lineno"></span><span class="comment" id="4038874">//&nbsp;routine&nbsp;for&nbsp;decoding&nbsp;transmitted&nbsp;values&nbsp;sent&nbsp;by&nbsp;a&nbsp;GobEncoder.</span><br>
<span class="lineno"></span><span class="keyword" id="4038939">type</span>&nbsp;<span class="ident" id="4038944">GobDecoder</span>&nbsp;<span class="keyword" id="4038955">interface</span>&nbsp;<span class="op" id="4038965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4038968">//&nbsp;GobDecode&nbsp;overwrites&nbsp;the&nbsp;receiver,&nbsp;which&nbsp;must&nbsp;be&nbsp;a&nbsp;pointer,</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4039032">//&nbsp;with&nbsp;the&nbsp;value&nbsp;represented&nbsp;by&nbsp;the&nbsp;byte&nbsp;slice,&nbsp;which&nbsp;was&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4039100">//&nbsp;by&nbsp;GobEncode,&nbsp;usually&nbsp;for&nbsp;the&nbsp;same&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4039154">GobDecode</span><span class="op" id="4039163">(</span><span class="op" id="4039164">[</span><span class="op" id="4039165">]</span><span class="builtintype" id="4039166">byte</span><span class="op" id="4039170">)</span>&nbsp;<span class="builtintype" id="4039172">error</span><br>
<span class="lineno"></span><span class="op" id="4039178">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">810</span><span class="keyword" id="4039181">var</span>&nbsp;<span class="op" id="4039185">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4039188">registerLock</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4039207">sync</span><span class="op" id="4039211">.</span><span class="ident" id="4039212">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4039221">nameToConcreteType</span>&nbsp;<span class="op" id="4039240">=</span>&nbsp;<span class="builtinfunc" id="4039242">make</span><span class="op" id="4039246">(</span><span class="keyword" id="4039247">map</span><span class="op" id="4039250">[</span><span class="builtintype" id="4039251">string</span><span class="op" id="4039257">]</span><span class="ident" id="4039258">reflect</span><span class="op" id="4039265">.</span><span class="ident" id="4039266">Type</span><span class="op" id="4039270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4039273">concreteTypeToName</span>&nbsp;<span class="op" id="4039292">=</span>&nbsp;<span class="builtinfunc" id="4039294">make</span><span class="op" id="4039298">(</span><span class="keyword" id="4039299">map</span><span class="op" id="4039302">[</span><span class="ident" id="4039303">reflect</span><span class="op" id="4039310">.</span><span class="ident" id="4039311">Type</span><span class="op" id="4039315">]</span><span class="builtintype" id="4039316">string</span><span class="op" id="4039322">)</span><br>
<span class="lineno"></span><span class="op" id="4039324">)</span><br>
<span class="lineno">815</span><br>
<span class="lineno"></span><span class="comment" id="4039327">//&nbsp;RegisterName&nbsp;is&nbsp;like&nbsp;Register&nbsp;but&nbsp;uses&nbsp;the&nbsp;provided&nbsp;name&nbsp;rather&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4039403">//&nbsp;type&#39;s&nbsp;default.</span><br>
<span class="lineno"></span><span class="keyword" id="4039422">func</span>&nbsp;<span class="ident" id="4039427">RegisterName</span><span class="op" id="4039439">(</span><span class="ident" id="4039440">name</span>&nbsp;<span class="builtintype" id="4039445">string</span><span class="op" id="4039451">,</span>&nbsp;<span class="ident" id="4039453">value</span>&nbsp;<span class="keyword" id="4039459">interface</span><span class="op" id="4039468">{</span><span class="op" id="4039469">}</span><span class="op" id="4039470">)</span>&nbsp;<span class="op" id="4039472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4039475">if</span>&nbsp;<span class="ident" id="4039478">name</span>&nbsp;<span class="op" id="4039483">==</span>&nbsp;<span class="string" id="4039486">&#34;&#34;</span>&nbsp;<span class="op" id="4039489">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4039493">//&nbsp;reserved&nbsp;for&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4039515">panic</span><span class="op" id="4039520">(</span><span class="string" id="4039521">&#34;attempt&nbsp;to&nbsp;register&nbsp;empty&nbsp;name&#34;</span><span class="op" id="4039553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4039556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4039559">registerLock</span><span class="op" id="4039571">.</span><span class="ident" id="4039572">Lock</span><span class="op" id="4039576">(</span><span class="op" id="4039577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4039580">defer</span>&nbsp;<span class="ident" id="4039586">registerLock</span><span class="op" id="4039598">.</span><span class="ident" id="4039599">Unlock</span><span class="op" id="4039605">(</span><span class="op" id="4039606">)</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4039609">ut</span>&nbsp;<span class="op" id="4039612">:=</span>&nbsp;<span class="ident" id="4039615">userType</span><span class="op" id="4039623">(</span><span class="ident" id="4039624">reflect</span><span class="op" id="4039631">.</span><span class="ident" id="4039632">TypeOf</span><span class="op" id="4039638">(</span><span class="ident" id="4039639">value</span><span class="op" id="4039644">)</span><span class="op" id="4039645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4039648">//&nbsp;Check&nbsp;for&nbsp;incompatible&nbsp;duplicates.&nbsp;The&nbsp;name&nbsp;must&nbsp;refer&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4039714">//&nbsp;same&nbsp;user&nbsp;type,&nbsp;and&nbsp;vice&nbsp;versa.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4039750">if</span>&nbsp;<span class="ident" id="4039753">t</span><span class="op" id="4039754">,</span>&nbsp;<span class="ident" id="4039756">ok</span>&nbsp;<span class="op" id="4039759">:=</span>&nbsp;<span class="ident" id="4039762">nameToConcreteType</span><span class="op" id="4039780">[</span><span class="ident" id="4039781">name</span><span class="op" id="4039785">]</span><span class="op" id="4039786">;</span>&nbsp;<span class="ident" id="4039788">ok</span>&nbsp;<span class="op" id="4039791">&amp;&amp;</span>&nbsp;<span class="ident" id="4039794">t</span>&nbsp;<span class="op" id="4039796">!=</span>&nbsp;<span class="ident" id="4039799">ut</span><span class="op" id="4039801">.</span><span class="ident" id="4039802">user</span>&nbsp;<span class="op" id="4039807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4039811">panic</span><span class="op" id="4039816">(</span><span class="ident" id="4039817">fmt</span><span class="op" id="4039820">.</span><span class="ident" id="4039821">Sprintf</span><span class="op" id="4039828">(</span><span class="string" id="4039829">&#34;gob:&nbsp;registering&nbsp;duplicate&nbsp;types&nbsp;for&nbsp;%q:&nbsp;%s&nbsp;!=&nbsp;%s&#34;</span><span class="op" id="4039880">,</span>&nbsp;<span class="ident" id="4039882">name</span><span class="op" id="4039886">,</span>&nbsp;<span class="ident" id="4039888">t</span><span class="op" id="4039889">,</span>&nbsp;<span class="ident" id="4039891">ut</span><span class="op" id="4039893">.</span><span class="ident" id="4039894">user</span><span class="op" id="4039898">)</span><span class="op" id="4039899">)</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4039902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4039905">if</span>&nbsp;<span class="ident" id="4039908">n</span><span class="op" id="4039909">,</span>&nbsp;<span class="ident" id="4039911">ok</span>&nbsp;<span class="op" id="4039914">:=</span>&nbsp;<span class="ident" id="4039917">concreteTypeToName</span><span class="op" id="4039935">[</span><span class="ident" id="4039936">ut</span><span class="op" id="4039938">.</span><span class="ident" id="4039939">base</span><span class="op" id="4039943">]</span><span class="op" id="4039944">;</span>&nbsp;<span class="ident" id="4039946">ok</span>&nbsp;<span class="op" id="4039949">&amp;&amp;</span>&nbsp;<span class="ident" id="4039952">n</span>&nbsp;<span class="op" id="4039954">!=</span>&nbsp;<span class="ident" id="4039957">name</span>&nbsp;<span class="op" id="4039962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4039966">panic</span><span class="op" id="4039971">(</span><span class="ident" id="4039972">fmt</span><span class="op" id="4039975">.</span><span class="ident" id="4039976">Sprintf</span><span class="op" id="4039983">(</span><span class="string" id="4039984">&#34;gob:&nbsp;registering&nbsp;duplicate&nbsp;names&nbsp;for&nbsp;%s:&nbsp;%q&nbsp;!=&nbsp;%q&#34;</span><span class="op" id="4040035">,</span>&nbsp;<span class="ident" id="4040037">ut</span><span class="op" id="4040039">.</span><span class="ident" id="4040040">user</span><span class="op" id="4040044">,</span>&nbsp;<span class="ident" id="4040046">n</span><span class="op" id="4040047">,</span>&nbsp;<span class="ident" id="4040049">name</span><span class="op" id="4040053">)</span><span class="op" id="4040054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4040057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4040060">//&nbsp;Store&nbsp;the&nbsp;name&nbsp;and&nbsp;type&nbsp;provided&nbsp;by&nbsp;the&nbsp;user....</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4040113">nameToConcreteType</span><span class="op" id="4040131">[</span><span class="ident" id="4040132">name</span><span class="op" id="4040136">]</span>&nbsp;<span class="op" id="4040138">=</span>&nbsp;<span class="ident" id="4040140">reflect</span><span class="op" id="4040147">.</span><span class="ident" id="4040148">TypeOf</span><span class="op" id="4040154">(</span><span class="ident" id="4040155">value</span><span class="op" id="4040160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4040163">//&nbsp;but&nbsp;the&nbsp;flattened&nbsp;type&nbsp;in&nbsp;the&nbsp;type&nbsp;table,&nbsp;since&nbsp;that&#39;s&nbsp;what&nbsp;decode&nbsp;needs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4040241">concreteTypeToName</span><span class="op" id="4040259">[</span><span class="ident" id="4040260">ut</span><span class="op" id="4040262">.</span><span class="ident" id="4040263">base</span><span class="op" id="4040267">]</span>&nbsp;<span class="op" id="4040269">=</span>&nbsp;<span class="ident" id="4040271">name</span><br>
<span class="lineno"></span><span class="op" id="4040276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">840</span><span class="comment" id="4040279">//&nbsp;Register&nbsp;records&nbsp;a&nbsp;type,&nbsp;identified&nbsp;by&nbsp;a&nbsp;value&nbsp;for&nbsp;that&nbsp;type,&nbsp;under&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="4040354">//&nbsp;internal&nbsp;type&nbsp;name.&nbsp;&nbsp;That&nbsp;name&nbsp;will&nbsp;identify&nbsp;the&nbsp;concrete&nbsp;type&nbsp;of&nbsp;a&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="4040431">//&nbsp;sent&nbsp;or&nbsp;received&nbsp;as&nbsp;an&nbsp;interface&nbsp;variable.&nbsp;&nbsp;Only&nbsp;types&nbsp;that&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4040502">//&nbsp;transferred&nbsp;as&nbsp;implementations&nbsp;of&nbsp;interface&nbsp;values&nbsp;need&nbsp;to&nbsp;be&nbsp;registered.</span><br>
<span class="lineno"></span><span class="comment" id="4040579">//&nbsp;Expecting&nbsp;to&nbsp;be&nbsp;used&nbsp;only&nbsp;during&nbsp;initialization,&nbsp;it&nbsp;panics&nbsp;if&nbsp;the&nbsp;mapping</span><br>
<span class="lineno">845</span><span class="comment" id="4040656">//&nbsp;between&nbsp;types&nbsp;and&nbsp;names&nbsp;is&nbsp;not&nbsp;a&nbsp;bijection.</span><br>
<span class="lineno"></span><span class="keyword" id="4040703">func</span>&nbsp;<span class="ident" id="4040708">Register</span><span class="op" id="4040716">(</span><span class="ident" id="4040717">value</span>&nbsp;<span class="keyword" id="4040723">interface</span><span class="op" id="4040732">{</span><span class="op" id="4040733">}</span><span class="op" id="4040734">)</span>&nbsp;<span class="op" id="4040736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4040739">//&nbsp;Default&nbsp;to&nbsp;printed&nbsp;representation&nbsp;for&nbsp;unnamed&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4040795">rt</span>&nbsp;<span class="op" id="4040798">:=</span>&nbsp;<span class="ident" id="4040801">reflect</span><span class="op" id="4040808">.</span><span class="ident" id="4040809">TypeOf</span><span class="op" id="4040815">(</span><span class="ident" id="4040816">value</span><span class="op" id="4040821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4040824">name</span>&nbsp;<span class="op" id="4040829">:=</span>&nbsp;<span class="ident" id="4040832">rt</span><span class="op" id="4040834">.</span><span class="ident" id="4040835">String</span><span class="op" id="4040841">(</span><span class="op" id="4040842">)</span><br>
<span class="lineno">850</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4040846">//&nbsp;But&nbsp;for&nbsp;named&nbsp;types&nbsp;(or&nbsp;pointers&nbsp;to&nbsp;them),&nbsp;qualify&nbsp;with&nbsp;import&nbsp;path&nbsp;(but&nbsp;see&nbsp;inner&nbsp;comment).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4040943">//&nbsp;Dereference&nbsp;one&nbsp;pointer&nbsp;looking&nbsp;for&nbsp;a&nbsp;named&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4040997">star</span>&nbsp;<span class="op" id="4041002">:=</span>&nbsp;<span class="string" id="4041005">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4041009">if</span>&nbsp;<span class="ident" id="4041012">rt</span><span class="op" id="4041014">.</span><span class="ident" id="4041015">Name</span><span class="op" id="4041019">(</span><span class="op" id="4041020">)</span>&nbsp;<span class="op" id="4041022">==</span>&nbsp;<span class="string" id="4041025">&#34;&#34;</span>&nbsp;<span class="op" id="4041028">{</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4041032">if</span>&nbsp;<span class="ident" id="4041035">pt</span>&nbsp;<span class="op" id="4041038">:=</span>&nbsp;<span class="ident" id="4041041">rt</span><span class="op" id="4041043">;</span>&nbsp;<span class="ident" id="4041045">pt</span><span class="op" id="4041047">.</span><span class="ident" id="4041048">Kind</span><span class="op" id="4041052">(</span><span class="op" id="4041053">)</span>&nbsp;<span class="op" id="4041055">==</span>&nbsp;<span class="ident" id="4041058">reflect</span><span class="op" id="4041065">.</span><span class="ident" id="4041066">Ptr</span>&nbsp;<span class="op" id="4041070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4041075">star</span>&nbsp;<span class="op" id="4041080">=</span>&nbsp;<span class="string" id="4041082">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4041089">//&nbsp;NOTE:&nbsp;The&nbsp;following&nbsp;line&nbsp;should&nbsp;be&nbsp;rt&nbsp;=&nbsp;pt.Elem()&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4041158">//&nbsp;what&nbsp;the&nbsp;comment&nbsp;above&nbsp;claims,&nbsp;but&nbsp;fixing&nbsp;it&nbsp;would&nbsp;break&nbsp;compatibility</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4041235">//&nbsp;with&nbsp;existing&nbsp;gobs.</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4041261">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4041267">//&nbsp;Given&nbsp;package&nbsp;p&nbsp;imported&nbsp;as&nbsp;&#34;full/p&#34;&nbsp;with&nbsp;these&nbsp;definitions:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4041334">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4041354">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;T1&nbsp;struct&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4041387">//&nbsp;this&nbsp;table&nbsp;shows&nbsp;the&nbsp;intended&nbsp;and&nbsp;actual&nbsp;strings&nbsp;used&nbsp;by&nbsp;gob&nbsp;to</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4041457">//&nbsp;name&nbsp;the&nbsp;types:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4041479">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4041485">//&nbsp;Type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Correct&nbsp;string&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Actual&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4041534">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4041540">//&nbsp;T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;full/p.T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;full/p.T1</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4041585">//&nbsp;*T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*full/p.T1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*p.T1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4041626">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4041632">//&nbsp;The&nbsp;missing&nbsp;full&nbsp;path&nbsp;cannot&nbsp;be&nbsp;fixed&nbsp;without&nbsp;breaking&nbsp;existing&nbsp;gob&nbsp;decoders.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4041716">rt</span>&nbsp;<span class="op" id="4041719">=</span>&nbsp;<span class="ident" id="4041721">pt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4041726">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4041729">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4041732">if</span>&nbsp;<span class="ident" id="4041735">rt</span><span class="op" id="4041737">.</span><span class="ident" id="4041738">Name</span><span class="op" id="4041742">(</span><span class="op" id="4041743">)</span>&nbsp;<span class="op" id="4041745">!=</span>&nbsp;<span class="string" id="4041748">&#34;&#34;</span>&nbsp;<span class="op" id="4041751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4041755">if</span>&nbsp;<span class="ident" id="4041758">rt</span><span class="op" id="4041760">.</span><span class="ident" id="4041761">PkgPath</span><span class="op" id="4041768">(</span><span class="op" id="4041769">)</span>&nbsp;<span class="op" id="4041771">==</span>&nbsp;<span class="string" id="4041774">&#34;&#34;</span>&nbsp;<span class="op" id="4041777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4041782">name</span>&nbsp;<span class="op" id="4041787">=</span>&nbsp;<span class="ident" id="4041789">star</span>&nbsp;<span class="op" id="4041794">+</span>&nbsp;<span class="ident" id="4041796">rt</span><span class="op" id="4041798">.</span><span class="ident" id="4041799">Name</span><span class="op" id="4041803">(</span><span class="op" id="4041804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4041808">}</span>&nbsp;<span class="keyword" id="4041810">else</span>&nbsp;<span class="op" id="4041815">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4041820">name</span>&nbsp;<span class="op" id="4041825">=</span>&nbsp;<span class="ident" id="4041827">star</span>&nbsp;<span class="op" id="4041832">+</span>&nbsp;<span class="ident" id="4041834">rt</span><span class="op" id="4041836">.</span><span class="ident" id="4041837">PkgPath</span><span class="op" id="4041844">(</span><span class="op" id="4041845">)</span>&nbsp;<span class="op" id="4041847">+</span>&nbsp;<span class="string" id="4041849">&#34;.&#34;</span>&nbsp;<span class="op" id="4041853">+</span>&nbsp;<span class="ident" id="4041855">rt</span><span class="op" id="4041857">.</span><span class="ident" id="4041858">Name</span><span class="op" id="4041862">(</span><span class="op" id="4041863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4041867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4041870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4041874">RegisterName</span><span class="op" id="4041886">(</span><span class="ident" id="4041887">name</span><span class="op" id="4041891">,</span>&nbsp;<span class="ident" id="4041893">value</span><span class="op" id="4041898">)</span><br>
<span class="lineno">885</span><span class="op" id="4041900">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4041903">func</span>&nbsp;<span class="ident" id="4041908">registerBasics</span><span class="op" id="4041922">(</span><span class="op" id="4041923">)</span>&nbsp;<span class="op" id="4041925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4041928">Register</span><span class="op" id="4041936">(</span><span class="builtintype" id="4041937">int</span><span class="op" id="4041940">(</span><span class="num" id="4041941">0</span><span class="op" id="4041942">)</span><span class="op" id="4041943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4041946">Register</span><span class="op" id="4041954">(</span><span class="builtintype" id="4041955">int8</span><span class="op" id="4041959">(</span><span class="num" id="4041960">0</span><span class="op" id="4041961">)</span><span class="op" id="4041962">)</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4041965">Register</span><span class="op" id="4041973">(</span><span class="builtintype" id="4041974">int16</span><span class="op" id="4041979">(</span><span class="num" id="4041980">0</span><span class="op" id="4041981">)</span><span class="op" id="4041982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4041985">Register</span><span class="op" id="4041993">(</span><span class="builtintype" id="4041994">int32</span><span class="op" id="4041999">(</span><span class="num" id="4042000">0</span><span class="op" id="4042001">)</span><span class="op" id="4042002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042005">Register</span><span class="op" id="4042013">(</span><span class="ident" id="4042014">int64</span><span class="op" id="4042019">(</span><span class="num" id="4042020">0</span><span class="op" id="4042021">)</span><span class="op" id="4042022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042025">Register</span><span class="op" id="4042033">(</span><span class="builtintype" id="4042034">uint</span><span class="op" id="4042038">(</span><span class="num" id="4042039">0</span><span class="op" id="4042040">)</span><span class="op" id="4042041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042044">Register</span><span class="op" id="4042052">(</span><span class="builtintype" id="4042053">uint8</span><span class="op" id="4042058">(</span><span class="num" id="4042059">0</span><span class="op" id="4042060">)</span><span class="op" id="4042061">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042064">Register</span><span class="op" id="4042072">(</span><span class="builtintype" id="4042073">uint16</span><span class="op" id="4042079">(</span><span class="num" id="4042080">0</span><span class="op" id="4042081">)</span><span class="op" id="4042082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042085">Register</span><span class="op" id="4042093">(</span><span class="builtintype" id="4042094">uint32</span><span class="op" id="4042100">(</span><span class="num" id="4042101">0</span><span class="op" id="4042102">)</span><span class="op" id="4042103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042106">Register</span><span class="op" id="4042114">(</span><span class="ident" id="4042115">uint64</span><span class="op" id="4042121">(</span><span class="num" id="4042122">0</span><span class="op" id="4042123">)</span><span class="op" id="4042124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042127">Register</span><span class="op" id="4042135">(</span><span class="builtintype" id="4042136">float32</span><span class="op" id="4042143">(</span><span class="num" id="4042144">0</span><span class="op" id="4042145">)</span><span class="op" id="4042146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042149">Register</span><span class="op" id="4042157">(</span><span class="builtintype" id="4042158">float64</span><span class="op" id="4042165">(</span><span class="num" id="4042166">0</span><span class="op" id="4042167">)</span><span class="op" id="4042168">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042171">Register</span><span class="op" id="4042179">(</span><span class="builtintype" id="4042180">complex64</span><span class="op" id="4042189">(</span><span class="num" id="4042190">0i</span><span class="op" id="4042192">)</span><span class="op" id="4042193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042196">Register</span><span class="op" id="4042204">(</span><span class="builtintype" id="4042205">complex128</span><span class="op" id="4042215">(</span><span class="num" id="4042216">0i</span><span class="op" id="4042218">)</span><span class="op" id="4042219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042222">Register</span><span class="op" id="4042230">(</span><span class="builtintype" id="4042231">uintptr</span><span class="op" id="4042238">(</span><span class="num" id="4042239">0</span><span class="op" id="4042240">)</span><span class="op" id="4042241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042244">Register</span><span class="op" id="4042252">(</span><span class="builtintype" id="4042253">false</span><span class="op" id="4042258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042261">Register</span><span class="op" id="4042269">(</span><span class="string" id="4042270">&#34;&#34;</span><span class="op" id="4042272">)</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042275">Register</span><span class="op" id="4042283">(</span><span class="op" id="4042284">[</span><span class="op" id="4042285">]</span><span class="builtintype" id="4042286">byte</span><span class="op" id="4042290">(</span><span class="ident" id="4042291">nil</span><span class="op" id="4042294">)</span><span class="op" id="4042295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042298">Register</span><span class="op" id="4042306">(</span><span class="op" id="4042307">[</span><span class="op" id="4042308">]</span><span class="builtintype" id="4042309">int</span><span class="op" id="4042312">(</span><span class="ident" id="4042313">nil</span><span class="op" id="4042316">)</span><span class="op" id="4042317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042320">Register</span><span class="op" id="4042328">(</span><span class="op" id="4042329">[</span><span class="op" id="4042330">]</span><span class="builtintype" id="4042331">int8</span><span class="op" id="4042335">(</span><span class="ident" id="4042336">nil</span><span class="op" id="4042339">)</span><span class="op" id="4042340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042343">Register</span><span class="op" id="4042351">(</span><span class="op" id="4042352">[</span><span class="op" id="4042353">]</span><span class="builtintype" id="4042354">int16</span><span class="op" id="4042359">(</span><span class="ident" id="4042360">nil</span><span class="op" id="4042363">)</span><span class="op" id="4042364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042367">Register</span><span class="op" id="4042375">(</span><span class="op" id="4042376">[</span><span class="op" id="4042377">]</span><span class="builtintype" id="4042378">int32</span><span class="op" id="4042383">(</span><span class="ident" id="4042384">nil</span><span class="op" id="4042387">)</span><span class="op" id="4042388">)</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042391">Register</span><span class="op" id="4042399">(</span><span class="op" id="4042400">[</span><span class="op" id="4042401">]</span><span class="ident" id="4042402">int64</span><span class="op" id="4042407">(</span><span class="ident" id="4042408">nil</span><span class="op" id="4042411">)</span><span class="op" id="4042412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042415">Register</span><span class="op" id="4042423">(</span><span class="op" id="4042424">[</span><span class="op" id="4042425">]</span><span class="builtintype" id="4042426">uint</span><span class="op" id="4042430">(</span><span class="ident" id="4042431">nil</span><span class="op" id="4042434">)</span><span class="op" id="4042435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042438">Register</span><span class="op" id="4042446">(</span><span class="op" id="4042447">[</span><span class="op" id="4042448">]</span><span class="builtintype" id="4042449">uint8</span><span class="op" id="4042454">(</span><span class="ident" id="4042455">nil</span><span class="op" id="4042458">)</span><span class="op" id="4042459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042462">Register</span><span class="op" id="4042470">(</span><span class="op" id="4042471">[</span><span class="op" id="4042472">]</span><span class="builtintype" id="4042473">uint16</span><span class="op" id="4042479">(</span><span class="ident" id="4042480">nil</span><span class="op" id="4042483">)</span><span class="op" id="4042484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042487">Register</span><span class="op" id="4042495">(</span><span class="op" id="4042496">[</span><span class="op" id="4042497">]</span><span class="builtintype" id="4042498">uint32</span><span class="op" id="4042504">(</span><span class="ident" id="4042505">nil</span><span class="op" id="4042508">)</span><span class="op" id="4042509">)</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042512">Register</span><span class="op" id="4042520">(</span><span class="op" id="4042521">[</span><span class="op" id="4042522">]</span><span class="ident" id="4042523">uint64</span><span class="op" id="4042529">(</span><span class="ident" id="4042530">nil</span><span class="op" id="4042533">)</span><span class="op" id="4042534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042537">Register</span><span class="op" id="4042545">(</span><span class="op" id="4042546">[</span><span class="op" id="4042547">]</span><span class="builtintype" id="4042548">float32</span><span class="op" id="4042555">(</span><span class="ident" id="4042556">nil</span><span class="op" id="4042559">)</span><span class="op" id="4042560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042563">Register</span><span class="op" id="4042571">(</span><span class="op" id="4042572">[</span><span class="op" id="4042573">]</span><span class="builtintype" id="4042574">float64</span><span class="op" id="4042581">(</span><span class="ident" id="4042582">nil</span><span class="op" id="4042585">)</span><span class="op" id="4042586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042589">Register</span><span class="op" id="4042597">(</span><span class="op" id="4042598">[</span><span class="op" id="4042599">]</span><span class="builtintype" id="4042600">complex64</span><span class="op" id="4042609">(</span><span class="ident" id="4042610">nil</span><span class="op" id="4042613">)</span><span class="op" id="4042614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042617">Register</span><span class="op" id="4042625">(</span><span class="op" id="4042626">[</span><span class="op" id="4042627">]</span><span class="builtintype" id="4042628">complex128</span><span class="op" id="4042638">(</span><span class="ident" id="4042639">nil</span><span class="op" id="4042642">)</span><span class="op" id="4042643">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042646">Register</span><span class="op" id="4042654">(</span><span class="op" id="4042655">[</span><span class="op" id="4042656">]</span><span class="builtintype" id="4042657">uintptr</span><span class="op" id="4042664">(</span><span class="ident" id="4042665">nil</span><span class="op" id="4042668">)</span><span class="op" id="4042669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042672">Register</span><span class="op" id="4042680">(</span><span class="op" id="4042681">[</span><span class="op" id="4042682">]</span><span class="builtintype" id="4042683">bool</span><span class="op" id="4042687">(</span><span class="ident" id="4042688">nil</span><span class="op" id="4042691">)</span><span class="op" id="4042692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4042695">Register</span><span class="op" id="4042703">(</span><span class="op" id="4042704">[</span><span class="op" id="4042705">]</span><span class="builtintype" id="4042706">string</span><span class="op" id="4042712">(</span><span class="ident" id="4042713">nil</span><span class="op" id="4042716">)</span><span class="op" id="4042717">)</span><br>
<span class="lineno"></span><span class="op" id="4042719">}</span>
</div>
</body>
</html>
