<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing</h2>
<ul>
<li><a href="/gostd/testing/allocs.go.html">allocs.go</a></li>
<li><a href="/gostd/testing/allocs_test.go.html">allocs_test.go</a></li>
<li><a href="/gostd/testing/benchmark.go.html" class="current">benchmark.go</a></li>
<li><a href="/gostd/testing/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/testing/cover.go.html">cover.go</a></li>
<li><a href="/gostd/testing/example.go.html">example.go</a></li>
<li><a href="/gostd/testing/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/testing/testing.go.html">testing.go</a></li>
<li><a href="/gostd/testing/testing_test.go.html">testing_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6135636">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6135691">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6135745">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6135796">package</span>&nbsp;<span class="ident" id="6135804">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6135813">import</span>&nbsp;<span class="op" id="6135820">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6135823">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6135831">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6135838">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6135844">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6135855">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6135863">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6135878">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6135885">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6135888">var</span>&nbsp;<span class="ident" id="6135892">matchBenchmarks</span>&nbsp;<span class="op" id="6135908">=</span>&nbsp;<span class="ident" id="6135910">flag</span><span class="op" id="6135914">.</span><span class="ident" id="6135915">String</span><span class="op" id="6135921">(</span><span class="string" id="6135922">&#34;test.bench&#34;</span><span class="op" id="6135934">,</span>&nbsp;<span class="string" id="6135936">&#34;&#34;</span><span class="op" id="6135938">,</span>&nbsp;<span class="string" id="6135940">&#34;regular&nbsp;expression&nbsp;to&nbsp;select&nbsp;benchmarks&nbsp;to&nbsp;run&#34;</span><span class="op" id="6135988">)</span><br>
<span class="lineno"></span><span class="keyword" id="6135990">var</span>&nbsp;<span class="ident" id="6135994">benchTime</span>&nbsp;<span class="op" id="6136004">=</span>&nbsp;<span class="ident" id="6136006">flag</span><span class="op" id="6136010">.</span><span class="ident" id="6136011">Duration</span><span class="op" id="6136019">(</span><span class="string" id="6136020">&#34;test.benchtime&#34;</span><span class="op" id="6136036">,</span>&nbsp;<span class="num" id="6136038">1</span><span class="op" id="6136039">*</span><span class="ident" id="6136040">time</span><span class="op" id="6136044">.</span><span class="ident" id="6136045">Second</span><span class="op" id="6136051">,</span>&nbsp;<span class="string" id="6136053">&#34;approximate&nbsp;run&nbsp;time&nbsp;for&nbsp;each&nbsp;benchmark&#34;</span><span class="op" id="6136094">)</span><br>
<span class="lineno"></span><span class="keyword" id="6136096">var</span>&nbsp;<span class="ident" id="6136100">benchmarkMemory</span>&nbsp;<span class="op" id="6136116">=</span>&nbsp;<span class="ident" id="6136118">flag</span><span class="op" id="6136122">.</span><span class="ident" id="6136123">Bool</span><span class="op" id="6136127">(</span><span class="string" id="6136128">&#34;test.benchmem&#34;</span><span class="op" id="6136143">,</span>&nbsp;<span class="builtintype" id="6136145">false</span><span class="op" id="6136150">,</span>&nbsp;<span class="string" id="6136152">&#34;print&nbsp;memory&nbsp;allocations&nbsp;for&nbsp;benchmarks&#34;</span><span class="op" id="6136193">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="6136196">//&nbsp;Global&nbsp;lock&nbsp;to&nbsp;ensure&nbsp;only&nbsp;one&nbsp;benchmark&nbsp;runs&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="6136256">var</span>&nbsp;<span class="ident" id="6136260">benchmarkLock</span>&nbsp;<span class="ident" id="6136274">sync</span><span class="op" id="6136278">.</span><span class="ident" id="6136279">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6136286">//&nbsp;Used&nbsp;for&nbsp;every&nbsp;benchmark&nbsp;for&nbsp;measuring&nbsp;memory.</span><br>
<span class="lineno">25</span><span class="keyword" id="6136336">var</span>&nbsp;<span class="ident" id="6136340">memStats</span>&nbsp;<span class="ident" id="6136349">runtime</span><span class="op" id="6136356">.</span><span class="ident" id="6136357">MemStats</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6136367">//&nbsp;An&nbsp;internal&nbsp;type&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6136456">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6136485">type</span>&nbsp;<span class="ident" id="6136490">InternalBenchmark</span>&nbsp;<span class="keyword" id="6136508">struct</span>&nbsp;<span class="op" id="6136515">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6136518">Name</span>&nbsp;<span class="builtintype" id="6136523">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6136531">F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6136536">func</span><span class="op" id="6136540">(</span><span class="ident" id="6136541">b</span>&nbsp;<span class="op" id="6136543">*</span><span class="ident" id="6136544">B</span><span class="op" id="6136545">)</span><br>
<span class="lineno"></span><span class="op" id="6136547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6136550">//&nbsp;B&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;Benchmark&nbsp;functions&nbsp;to&nbsp;manage&nbsp;benchmark</span><br>
<span class="lineno">35</span><span class="comment" id="6136615">//&nbsp;timing&nbsp;and&nbsp;to&nbsp;specify&nbsp;the&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="6136673">type</span>&nbsp;<span class="ident" id="6136678">B</span>&nbsp;<span class="keyword" id="6136680">struct</span>&nbsp;<span class="op" id="6136687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6136690">common</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6136698">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6136715">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6136720">previousN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6136737">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6136751">//&nbsp;number&nbsp;of&nbsp;iterations&nbsp;in&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6136796">previousDuration</span>&nbsp;<span class="ident" id="6136813">time</span><span class="op" id="6136817">.</span><span class="ident" id="6136818">Duration</span>&nbsp;<span class="comment" id="6136827">//&nbsp;total&nbsp;duration&nbsp;of&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6136866">benchmark</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6136883">InternalBenchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6136902">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6136919">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6136926">timerOn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6136943">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6136949">showAllocResult</span>&nbsp;&nbsp;<span class="builtintype" id="6136966">bool</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6136972">result</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6136989">BenchmarkResult</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137006">parallelism</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6137023">int</span>&nbsp;<span class="comment" id="6137027">//&nbsp;RunParallel&nbsp;creates&nbsp;parallelism*GOMAXPROCS&nbsp;goroutines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6137085">//&nbsp;The&nbsp;initial&nbsp;states&nbsp;of&nbsp;memStats.Mallocs&nbsp;and&nbsp;memStats.TotalAlloc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137153">startAllocs</span>&nbsp;<span class="ident" id="6137165">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137173">startBytes</span>&nbsp;&nbsp;<span class="ident" id="6137185">uint64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6137193">//&nbsp;The&nbsp;net&nbsp;total&nbsp;of&nbsp;this&nbsp;test&nbsp;after&nbsp;being&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137241">netAllocs</span>&nbsp;<span class="ident" id="6137251">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137259">netBytes</span>&nbsp;&nbsp;<span class="ident" id="6137269">uint64</span><br>
<span class="lineno"></span><span class="op" id="6137276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="6137279">//&nbsp;StartTimer&nbsp;starts&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;function&nbsp;is&nbsp;called&nbsp;automatically</span><br>
<span class="lineno"></span><span class="comment" id="6137354">//&nbsp;before&nbsp;a&nbsp;benchmark&nbsp;starts,&nbsp;but&nbsp;it&nbsp;can&nbsp;also&nbsp;used&nbsp;to&nbsp;resume&nbsp;timing&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="6137428">//&nbsp;a&nbsp;call&nbsp;to&nbsp;StopTimer.</span><br>
<span class="lineno"></span><span class="keyword" id="6137452">func</span>&nbsp;<span class="op" id="6137457">(</span><span class="ident" id="6137458">b</span>&nbsp;<span class="op" id="6137460">*</span><span class="ident" id="6137461">B</span><span class="op" id="6137462">)</span>&nbsp;<span class="ident" id="6137464">StartTimer</span><span class="op" id="6137474">(</span><span class="op" id="6137475">)</span>&nbsp;<span class="op" id="6137477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6137480">if</span>&nbsp;<span class="op" id="6137483">!</span><span class="ident" id="6137484">b</span><span class="op" id="6137485">.</span><span class="ident" id="6137486">timerOn</span>&nbsp;<span class="op" id="6137494">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137498">runtime</span><span class="op" id="6137505">.</span><span class="ident" id="6137506">ReadMemStats</span><span class="op" id="6137518">(</span><span class="op" id="6137519">&amp;</span><span class="ident" id="6137520">memStats</span><span class="op" id="6137528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137532">b</span><span class="op" id="6137533">.</span><span class="ident" id="6137534">startAllocs</span>&nbsp;<span class="op" id="6137546">=</span>&nbsp;<span class="ident" id="6137548">memStats</span><span class="op" id="6137556">.</span><span class="ident" id="6137557">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137567">b</span><span class="op" id="6137568">.</span><span class="ident" id="6137569">startBytes</span>&nbsp;<span class="op" id="6137580">=</span>&nbsp;<span class="ident" id="6137582">memStats</span><span class="op" id="6137590">.</span><span class="ident" id="6137591">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137604">b</span><span class="op" id="6137605">.</span><span class="ident" id="6137606">start</span>&nbsp;<span class="op" id="6137612">=</span>&nbsp;<span class="ident" id="6137614">time</span><span class="op" id="6137618">.</span><span class="ident" id="6137619">Now</span><span class="op" id="6137622">(</span><span class="op" id="6137623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137627">b</span><span class="op" id="6137628">.</span><span class="ident" id="6137629">timerOn</span>&nbsp;<span class="op" id="6137637">=</span>&nbsp;<span class="builtintype" id="6137639">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6137645">}</span><br>
<span class="lineno"></span><span class="op" id="6137647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6137650">//&nbsp;StopTimer&nbsp;stops&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;pause&nbsp;the&nbsp;timer</span><br>
<span class="lineno"></span><span class="comment" id="6137721">//&nbsp;while&nbsp;performing&nbsp;complex&nbsp;initialization&nbsp;that&nbsp;you&nbsp;don&#39;t</span><br>
<span class="lineno">70</span><span class="comment" id="6137779">//&nbsp;want&nbsp;to&nbsp;measure.</span><br>
<span class="lineno"></span><span class="keyword" id="6137799">func</span>&nbsp;<span class="op" id="6137804">(</span><span class="ident" id="6137805">b</span>&nbsp;<span class="op" id="6137807">*</span><span class="ident" id="6137808">B</span><span class="op" id="6137809">)</span>&nbsp;<span class="ident" id="6137811">StopTimer</span><span class="op" id="6137820">(</span><span class="op" id="6137821">)</span>&nbsp;<span class="op" id="6137823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6137826">if</span>&nbsp;<span class="ident" id="6137829">b</span><span class="op" id="6137830">.</span><span class="ident" id="6137831">timerOn</span>&nbsp;<span class="op" id="6137839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137843">b</span><span class="op" id="6137844">.</span><span class="ident" id="6137845">duration</span>&nbsp;<span class="op" id="6137854">+=</span>&nbsp;<span class="ident" id="6137857">time</span><span class="op" id="6137861">.</span><span class="ident" id="6137862">Now</span><span class="op" id="6137865">(</span><span class="op" id="6137866">)</span><span class="op" id="6137867">.</span><span class="ident" id="6137868">Sub</span><span class="op" id="6137871">(</span><span class="ident" id="6137872">b</span><span class="op" id="6137873">.</span><span class="ident" id="6137874">start</span><span class="op" id="6137879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137883">runtime</span><span class="op" id="6137890">.</span><span class="ident" id="6137891">ReadMemStats</span><span class="op" id="6137903">(</span><span class="op" id="6137904">&amp;</span><span class="ident" id="6137905">memStats</span><span class="op" id="6137913">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137917">b</span><span class="op" id="6137918">.</span><span class="ident" id="6137919">netAllocs</span>&nbsp;<span class="op" id="6137929">+=</span>&nbsp;<span class="ident" id="6137932">memStats</span><span class="op" id="6137940">.</span><span class="ident" id="6137941">Mallocs</span>&nbsp;<span class="op" id="6137949">-</span>&nbsp;<span class="ident" id="6137951">b</span><span class="op" id="6137952">.</span><span class="ident" id="6137953">startAllocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6137967">b</span><span class="op" id="6137968">.</span><span class="ident" id="6137969">netBytes</span>&nbsp;<span class="op" id="6137978">+=</span>&nbsp;<span class="ident" id="6137981">memStats</span><span class="op" id="6137989">.</span><span class="ident" id="6137990">TotalAlloc</span>&nbsp;<span class="op" id="6138001">-</span>&nbsp;<span class="ident" id="6138003">b</span><span class="op" id="6138004">.</span><span class="ident" id="6138005">startBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6138018">b</span><span class="op" id="6138019">.</span><span class="ident" id="6138020">timerOn</span>&nbsp;<span class="op" id="6138028">=</span>&nbsp;<span class="builtintype" id="6138030">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6138037">}</span><br>
<span class="lineno"></span><span class="op" id="6138039">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="6138042">//&nbsp;ResetTimer&nbsp;zeros&nbsp;the&nbsp;elapsed&nbsp;benchmark&nbsp;time&nbsp;and&nbsp;memory&nbsp;allocation&nbsp;counters.</span><br>
<span class="lineno"></span><span class="comment" id="6138121">//&nbsp;It&nbsp;does&nbsp;not&nbsp;affect&nbsp;whether&nbsp;the&nbsp;timer&nbsp;is&nbsp;running.</span><br>
<span class="lineno"></span><span class="keyword" id="6138173">func</span>&nbsp;<span class="op" id="6138178">(</span><span class="ident" id="6138179">b</span>&nbsp;<span class="op" id="6138181">*</span><span class="ident" id="6138182">B</span><span class="op" id="6138183">)</span>&nbsp;<span class="ident" id="6138185">ResetTimer</span><span class="op" id="6138195">(</span><span class="op" id="6138196">)</span>&nbsp;<span class="op" id="6138198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6138201">if</span>&nbsp;<span class="ident" id="6138204">b</span><span class="op" id="6138205">.</span><span class="ident" id="6138206">timerOn</span>&nbsp;<span class="op" id="6138214">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6138218">runtime</span><span class="op" id="6138225">.</span><span class="ident" id="6138226">ReadMemStats</span><span class="op" id="6138238">(</span><span class="op" id="6138239">&amp;</span><span class="ident" id="6138240">memStats</span><span class="op" id="6138248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6138252">b</span><span class="op" id="6138253">.</span><span class="ident" id="6138254">startAllocs</span>&nbsp;<span class="op" id="6138266">=</span>&nbsp;<span class="ident" id="6138268">memStats</span><span class="op" id="6138276">.</span><span class="ident" id="6138277">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6138287">b</span><span class="op" id="6138288">.</span><span class="ident" id="6138289">startBytes</span>&nbsp;<span class="op" id="6138300">=</span>&nbsp;<span class="ident" id="6138302">memStats</span><span class="op" id="6138310">.</span><span class="ident" id="6138311">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6138324">b</span><span class="op" id="6138325">.</span><span class="ident" id="6138326">start</span>&nbsp;<span class="op" id="6138332">=</span>&nbsp;<span class="ident" id="6138334">time</span><span class="op" id="6138338">.</span><span class="ident" id="6138339">Now</span><span class="op" id="6138342">(</span><span class="op" id="6138343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6138346">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6138349">b</span><span class="op" id="6138350">.</span><span class="ident" id="6138351">duration</span>&nbsp;<span class="op" id="6138360">=</span>&nbsp;<span class="num" id="6138362">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6138365">b</span><span class="op" id="6138366">.</span><span class="ident" id="6138367">netAllocs</span>&nbsp;<span class="op" id="6138377">=</span>&nbsp;<span class="num" id="6138379">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6138382">b</span><span class="op" id="6138383">.</span><span class="ident" id="6138384">netBytes</span>&nbsp;<span class="op" id="6138393">=</span>&nbsp;<span class="num" id="6138395">0</span><br>
<span class="lineno"></span><span class="op" id="6138397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="6138400">//&nbsp;SetBytes&nbsp;records&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;processed&nbsp;in&nbsp;a&nbsp;single&nbsp;operation.</span><br>
<span class="lineno"></span><span class="comment" id="6138473">//&nbsp;If&nbsp;this&nbsp;is&nbsp;called,&nbsp;the&nbsp;benchmark&nbsp;will&nbsp;report&nbsp;ns/op&nbsp;and&nbsp;MB/s.</span><br>
<span class="lineno"></span><span class="keyword" id="6138537">func</span>&nbsp;<span class="op" id="6138542">(</span><span class="ident" id="6138543">b</span>&nbsp;<span class="op" id="6138545">*</span><span class="ident" id="6138546">B</span><span class="op" id="6138547">)</span>&nbsp;<span class="ident" id="6138549">SetBytes</span><span class="op" id="6138557">(</span><span class="ident" id="6138558">n</span>&nbsp;<span class="ident" id="6138560">int64</span><span class="op" id="6138565">)</span>&nbsp;<span class="op" id="6138567">{</span>&nbsp;<span class="ident" id="6138569">b</span><span class="op" id="6138570">.</span><span class="ident" id="6138571">bytes</span>&nbsp;<span class="op" id="6138577">=</span>&nbsp;<span class="ident" id="6138579">n</span>&nbsp;<span class="op" id="6138581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6138584">//&nbsp;ReportAllocs&nbsp;enables&nbsp;malloc&nbsp;statistics&nbsp;for&nbsp;this&nbsp;benchmark.</span><br>
<span class="lineno">100</span><span class="comment" id="6138646">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;setting&nbsp;-test.benchmem,&nbsp;but&nbsp;it&nbsp;only&nbsp;affects&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6138717">//&nbsp;benchmark&nbsp;function&nbsp;that&nbsp;calls&nbsp;ReportAllocs.</span><br>
<span class="lineno"></span><span class="keyword" id="6138764">func</span>&nbsp;<span class="op" id="6138769">(</span><span class="ident" id="6138770">b</span>&nbsp;<span class="op" id="6138772">*</span><span class="ident" id="6138773">B</span><span class="op" id="6138774">)</span>&nbsp;<span class="ident" id="6138776">ReportAllocs</span><span class="op" id="6138788">(</span><span class="op" id="6138789">)</span>&nbsp;<span class="op" id="6138791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6138794">b</span><span class="op" id="6138795">.</span><span class="ident" id="6138796">showAllocResult</span>&nbsp;<span class="op" id="6138812">=</span>&nbsp;<span class="builtintype" id="6138814">true</span><br>
<span class="lineno"></span><span class="op" id="6138819">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6138822">func</span>&nbsp;<span class="op" id="6138827">(</span><span class="ident" id="6138828">b</span>&nbsp;<span class="op" id="6138830">*</span><span class="ident" id="6138831">B</span><span class="op" id="6138832">)</span>&nbsp;<span class="ident" id="6138834">nsPerOp</span><span class="op" id="6138841">(</span><span class="op" id="6138842">)</span>&nbsp;<span class="ident" id="6138844">int64</span>&nbsp;<span class="op" id="6138850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6138853">if</span>&nbsp;<span class="ident" id="6138856">b</span><span class="op" id="6138857">.</span><span class="ident" id="6138858">N</span>&nbsp;<span class="op" id="6138860">&lt;=</span>&nbsp;<span class="num" id="6138863">0</span>&nbsp;<span class="op" id="6138865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6138869">return</span>&nbsp;<span class="num" id="6138876">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6138879">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6138882">return</span>&nbsp;<span class="ident" id="6138889">b</span><span class="op" id="6138890">.</span><span class="ident" id="6138891">duration</span><span class="op" id="6138899">.</span><span class="ident" id="6138900">Nanoseconds</span><span class="op" id="6138911">(</span><span class="op" id="6138912">)</span>&nbsp;<span class="op" id="6138914">/</span>&nbsp;<span class="ident" id="6138916">int64</span><span class="op" id="6138921">(</span><span class="ident" id="6138922">b</span><span class="op" id="6138923">.</span><span class="ident" id="6138924">N</span><span class="op" id="6138925">)</span><br>
<span class="lineno"></span><span class="op" id="6138927">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6138930">//&nbsp;runN&nbsp;runs&nbsp;a&nbsp;single&nbsp;benchmark&nbsp;for&nbsp;the&nbsp;specified&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span><span class="keyword" id="6139002">func</span>&nbsp;<span class="op" id="6139007">(</span><span class="ident" id="6139008">b</span>&nbsp;<span class="op" id="6139010">*</span><span class="ident" id="6139011">B</span><span class="op" id="6139012">)</span>&nbsp;<span class="ident" id="6139014">runN</span><span class="op" id="6139018">(</span><span class="ident" id="6139019">n</span>&nbsp;<span class="builtintype" id="6139021">int</span><span class="op" id="6139024">)</span>&nbsp;<span class="op" id="6139026">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6139029">benchmarkLock</span><span class="op" id="6139042">.</span><span class="ident" id="6139043">Lock</span><span class="op" id="6139047">(</span><span class="op" id="6139048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6139051">defer</span>&nbsp;<span class="ident" id="6139057">benchmarkLock</span><span class="op" id="6139070">.</span><span class="ident" id="6139071">Unlock</span><span class="op" id="6139077">(</span><span class="op" id="6139078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6139081">//&nbsp;Try&nbsp;to&nbsp;get&nbsp;a&nbsp;comparable&nbsp;environment&nbsp;for&nbsp;each&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6139134">//&nbsp;by&nbsp;clearing&nbsp;garbage&nbsp;from&nbsp;previous&nbsp;runs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6139178">runtime</span><span class="op" id="6139185">.</span><span class="ident" id="6139186">GC</span><span class="op" id="6139188">(</span><span class="op" id="6139189">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6139192">b</span><span class="op" id="6139193">.</span><span class="ident" id="6139194">N</span>&nbsp;<span class="op" id="6139196">=</span>&nbsp;<span class="ident" id="6139198">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6139201">b</span><span class="op" id="6139202">.</span><span class="ident" id="6139203">parallelism</span>&nbsp;<span class="op" id="6139215">=</span>&nbsp;<span class="num" id="6139217">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6139220">b</span><span class="op" id="6139221">.</span><span class="ident" id="6139222">ResetTimer</span><span class="op" id="6139232">(</span><span class="op" id="6139233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6139236">b</span><span class="op" id="6139237">.</span><span class="ident" id="6139238">StartTimer</span><span class="op" id="6139248">(</span><span class="op" id="6139249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6139252">b</span><span class="op" id="6139253">.</span><span class="ident" id="6139254">benchmark</span><span class="op" id="6139263">.</span><span class="ident" id="6139264">F</span><span class="op" id="6139265">(</span><span class="ident" id="6139266">b</span><span class="op" id="6139267">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6139270">b</span><span class="op" id="6139271">.</span><span class="ident" id="6139272">StopTimer</span><span class="op" id="6139281">(</span><span class="op" id="6139282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6139285">b</span><span class="op" id="6139286">.</span><span class="ident" id="6139287">previousN</span>&nbsp;<span class="op" id="6139297">=</span>&nbsp;<span class="ident" id="6139299">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6139302">b</span><span class="op" id="6139303">.</span><span class="ident" id="6139304">previousDuration</span>&nbsp;<span class="op" id="6139321">=</span>&nbsp;<span class="ident" id="6139323">b</span><span class="op" id="6139324">.</span><span class="ident" id="6139325">duration</span><br>
<span class="lineno"></span><span class="op" id="6139334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="6139337">func</span>&nbsp;<span class="ident" id="6139342">min</span><span class="op" id="6139345">(</span><span class="ident" id="6139346">x</span><span class="op" id="6139347">,</span>&nbsp;<span class="ident" id="6139349">y</span>&nbsp;<span class="builtintype" id="6139351">int</span><span class="op" id="6139354">)</span>&nbsp;<span class="builtintype" id="6139356">int</span>&nbsp;<span class="op" id="6139360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6139363">if</span>&nbsp;<span class="ident" id="6139366">x</span>&nbsp;<span class="op" id="6139368">&gt;</span>&nbsp;<span class="ident" id="6139370">y</span>&nbsp;<span class="op" id="6139372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6139376">return</span>&nbsp;<span class="ident" id="6139383">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6139386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6139389">return</span>&nbsp;<span class="ident" id="6139396">x</span><br>
<span class="lineno">135</span><span class="op" id="6139398">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6139401">func</span>&nbsp;<span class="ident" id="6139406">max</span><span class="op" id="6139409">(</span><span class="ident" id="6139410">x</span><span class="op" id="6139411">,</span>&nbsp;<span class="ident" id="6139413">y</span>&nbsp;<span class="builtintype" id="6139415">int</span><span class="op" id="6139418">)</span>&nbsp;<span class="builtintype" id="6139420">int</span>&nbsp;<span class="op" id="6139424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6139427">if</span>&nbsp;<span class="ident" id="6139430">x</span>&nbsp;<span class="op" id="6139432">&lt;</span>&nbsp;<span class="ident" id="6139434">y</span>&nbsp;<span class="op" id="6139436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6139440">return</span>&nbsp;<span class="ident" id="6139447">y</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6139450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6139453">return</span>&nbsp;<span class="ident" id="6139460">x</span><br>
<span class="lineno"></span><span class="op" id="6139462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6139465">//&nbsp;roundDown10&nbsp;rounds&nbsp;a&nbsp;number&nbsp;down&nbsp;to&nbsp;the&nbsp;nearest&nbsp;power&nbsp;of&nbsp;10.</span><br>
<span class="lineno">145</span><span class="keyword" id="6139529">func</span>&nbsp;<span class="ident" id="6139534">roundDown10</span><span class="op" id="6139545">(</span><span class="ident" id="6139546">n</span>&nbsp;<span class="builtintype" id="6139548">int</span><span class="op" id="6139551">)</span>&nbsp;<span class="builtintype" id="6139553">int</span>&nbsp;<span class="op" id="6139557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6139560">var</span>&nbsp;<span class="ident" id="6139564">tens</span>&nbsp;<span class="op" id="6139569">=</span>&nbsp;<span class="num" id="6139571">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6139574">//&nbsp;tens&nbsp;=&nbsp;floor(log_10(n))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6139602">for</span>&nbsp;<span class="ident" id="6139606">n</span>&nbsp;<span class="op" id="6139608">&gt;=</span>&nbsp;<span class="num" id="6139611">10</span>&nbsp;<span class="op" id="6139614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6139618">n</span>&nbsp;<span class="op" id="6139620">=</span>&nbsp;<span class="ident" id="6139622">n</span>&nbsp;<span class="op" id="6139624">/</span>&nbsp;<span class="num" id="6139626">10</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6139631">tens</span><span class="op" id="6139635">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6139639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6139642">//&nbsp;result&nbsp;=&nbsp;10^tens</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6139663">result</span>&nbsp;<span class="op" id="6139670">:=</span>&nbsp;<span class="num" id="6139673">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6139676">for</span>&nbsp;<span class="ident" id="6139680">i</span>&nbsp;<span class="op" id="6139682">:=</span>&nbsp;<span class="num" id="6139685">0</span><span class="op" id="6139686">;</span>&nbsp;<span class="ident" id="6139688">i</span>&nbsp;<span class="op" id="6139690">&lt;</span>&nbsp;<span class="ident" id="6139692">tens</span><span class="op" id="6139696">;</span>&nbsp;<span class="ident" id="6139698">i</span><span class="op" id="6139699">++</span>&nbsp;<span class="op" id="6139702">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6139706">result</span>&nbsp;<span class="op" id="6139713">*=</span>&nbsp;<span class="num" id="6139716">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6139720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6139723">return</span>&nbsp;<span class="ident" id="6139730">result</span><br>
<span class="lineno"></span><span class="op" id="6139737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="6139740">//&nbsp;roundUp&nbsp;rounds&nbsp;x&nbsp;up&nbsp;to&nbsp;a&nbsp;number&nbsp;of&nbsp;the&nbsp;form&nbsp;[1eX,&nbsp;2eX,&nbsp;3eX,&nbsp;5eX].</span><br>
<span class="lineno"></span><span class="keyword" id="6139809">func</span>&nbsp;<span class="ident" id="6139814">roundUp</span><span class="op" id="6139821">(</span><span class="ident" id="6139822">n</span>&nbsp;<span class="builtintype" id="6139824">int</span><span class="op" id="6139827">)</span>&nbsp;<span class="builtintype" id="6139829">int</span>&nbsp;<span class="op" id="6139833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6139836">base</span>&nbsp;<span class="op" id="6139841">:=</span>&nbsp;<span class="ident" id="6139844">roundDown10</span><span class="op" id="6139855">(</span><span class="ident" id="6139856">n</span><span class="op" id="6139857">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6139860">switch</span>&nbsp;<span class="op" id="6139867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6139870">case</span>&nbsp;<span class="ident" id="6139875">n</span>&nbsp;<span class="op" id="6139877">&lt;=</span>&nbsp;<span class="ident" id="6139880">base</span><span class="op" id="6139884">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6139888">return</span>&nbsp;<span class="ident" id="6139895">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6139901">case</span>&nbsp;<span class="ident" id="6139906">n</span>&nbsp;<span class="op" id="6139908">&lt;=</span>&nbsp;<span class="op" id="6139911">(</span><span class="num" id="6139912">2</span>&nbsp;<span class="op" id="6139914">*</span>&nbsp;<span class="ident" id="6139916">base</span><span class="op" id="6139920">)</span><span class="op" id="6139921">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6139925">return</span>&nbsp;<span class="num" id="6139932">2</span>&nbsp;<span class="op" id="6139934">*</span>&nbsp;<span class="ident" id="6139936">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6139942">case</span>&nbsp;<span class="ident" id="6139947">n</span>&nbsp;<span class="op" id="6139949">&lt;=</span>&nbsp;<span class="op" id="6139952">(</span><span class="num" id="6139953">3</span>&nbsp;<span class="op" id="6139955">*</span>&nbsp;<span class="ident" id="6139957">base</span><span class="op" id="6139961">)</span><span class="op" id="6139962">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6139966">return</span>&nbsp;<span class="num" id="6139973">3</span>&nbsp;<span class="op" id="6139975">*</span>&nbsp;<span class="ident" id="6139977">base</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6139983">case</span>&nbsp;<span class="ident" id="6139988">n</span>&nbsp;<span class="op" id="6139990">&lt;=</span>&nbsp;<span class="op" id="6139993">(</span><span class="num" id="6139994">5</span>&nbsp;<span class="op" id="6139996">*</span>&nbsp;<span class="ident" id="6139998">base</span><span class="op" id="6140002">)</span><span class="op" id="6140003">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6140007">return</span>&nbsp;<span class="num" id="6140014">5</span>&nbsp;<span class="op" id="6140016">*</span>&nbsp;<span class="ident" id="6140018">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6140024">default</span><span class="op" id="6140031">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6140035">return</span>&nbsp;<span class="num" id="6140042">10</span>&nbsp;<span class="op" id="6140045">*</span>&nbsp;<span class="ident" id="6140047">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6140053">}</span><br>
<span class="lineno">175</span><span class="op" id="6140055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6140058">//&nbsp;run&nbsp;times&nbsp;the&nbsp;benchmark&nbsp;function&nbsp;in&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="6140119">func</span>&nbsp;<span class="op" id="6140124">(</span><span class="ident" id="6140125">b</span>&nbsp;<span class="op" id="6140127">*</span><span class="ident" id="6140128">B</span><span class="op" id="6140129">)</span>&nbsp;<span class="ident" id="6140131">run</span><span class="op" id="6140134">(</span><span class="op" id="6140135">)</span>&nbsp;<span class="ident" id="6140137">BenchmarkResult</span>&nbsp;<span class="op" id="6140153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6140156">go</span>&nbsp;<span class="ident" id="6140159">b</span><span class="op" id="6140160">.</span><span class="ident" id="6140161">launch</span><span class="op" id="6140167">(</span><span class="op" id="6140168">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6140171">&lt;-</span><span class="ident" id="6140173">b</span><span class="op" id="6140174">.</span><span class="ident" id="6140175">signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6140183">return</span>&nbsp;<span class="ident" id="6140190">b</span><span class="op" id="6140191">.</span><span class="ident" id="6140192">result</span><br>
<span class="lineno"></span><span class="op" id="6140199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6140202">//&nbsp;launch&nbsp;launches&nbsp;the&nbsp;benchmark&nbsp;function.&nbsp;&nbsp;It&nbsp;gradually&nbsp;increases&nbsp;the&nbsp;number</span><br>
<span class="lineno">185</span><span class="comment" id="6140280">//&nbsp;of&nbsp;benchmark&nbsp;iterations&nbsp;until&nbsp;the&nbsp;benchmark&nbsp;runs&nbsp;for&nbsp;the&nbsp;requested&nbsp;benchtime.</span><br>
<span class="lineno"></span><span class="comment" id="6140361">//&nbsp;It&nbsp;prints&nbsp;timing&nbsp;information&nbsp;in&nbsp;this&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="6140406">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;testing.BenchmarkHello&nbsp;&nbsp;&nbsp;&nbsp;100000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;19&nbsp;ns/op</span><br>
<span class="lineno"></span><span class="comment" id="6140450">//&nbsp;launch&nbsp;is&nbsp;run&nbsp;by&nbsp;the&nbsp;run&nbsp;function&nbsp;as&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="6140512">func</span>&nbsp;<span class="op" id="6140517">(</span><span class="ident" id="6140518">b</span>&nbsp;<span class="op" id="6140520">*</span><span class="ident" id="6140521">B</span><span class="op" id="6140522">)</span>&nbsp;<span class="ident" id="6140524">launch</span><span class="op" id="6140530">(</span><span class="op" id="6140531">)</span>&nbsp;<span class="op" id="6140533">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6140536">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;a&nbsp;single&nbsp;iteration&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;expensive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6140605">n</span>&nbsp;<span class="op" id="6140607">:=</span>&nbsp;<span class="num" id="6140610">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6140614">//&nbsp;Signal&nbsp;that&nbsp;we&#39;re&nbsp;done&nbsp;whether&nbsp;we&nbsp;return&nbsp;normally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6140668">//&nbsp;or&nbsp;by&nbsp;FailNow&#39;s&nbsp;runtime.Goexit.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6140704">defer</span>&nbsp;<span class="keyword" id="6140710">func</span><span class="op" id="6140714">(</span><span class="op" id="6140715">)</span>&nbsp;<span class="op" id="6140717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6140721">b</span><span class="op" id="6140722">.</span><span class="ident" id="6140723">signal</span>&nbsp;<span class="op" id="6140730">&lt;-</span>&nbsp;<span class="ident" id="6140733">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6140736">}</span><span class="op" id="6140737">(</span><span class="op" id="6140738">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6140742">b</span><span class="op" id="6140743">.</span><span class="ident" id="6140744">runN</span><span class="op" id="6140748">(</span><span class="ident" id="6140749">n</span><span class="op" id="6140750">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6140753">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;at&nbsp;least&nbsp;the&nbsp;specified&nbsp;amount&nbsp;of&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6140818">d</span>&nbsp;<span class="op" id="6140820">:=</span>&nbsp;<span class="op" id="6140823">*</span><span class="ident" id="6140824">benchTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6140835">for</span>&nbsp;<span class="op" id="6140839">!</span><span class="ident" id="6140840">b</span><span class="op" id="6140841">.</span><span class="ident" id="6140842">failed</span>&nbsp;<span class="op" id="6140849">&amp;&amp;</span>&nbsp;<span class="ident" id="6140852">b</span><span class="op" id="6140853">.</span><span class="ident" id="6140854">duration</span>&nbsp;<span class="op" id="6140863">&lt;</span>&nbsp;<span class="ident" id="6140865">d</span>&nbsp;<span class="op" id="6140867">&amp;&amp;</span>&nbsp;<span class="ident" id="6140870">n</span>&nbsp;<span class="op" id="6140872">&lt;</span>&nbsp;<span class="num" id="6140874">1e9</span>&nbsp;<span class="op" id="6140878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6140882">last</span>&nbsp;<span class="op" id="6140887">:=</span>&nbsp;<span class="ident" id="6140890">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6140894">//&nbsp;Predict&nbsp;required&nbsp;iterations.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6140928">if</span>&nbsp;<span class="ident" id="6140931">b</span><span class="op" id="6140932">.</span><span class="ident" id="6140933">nsPerOp</span><span class="op" id="6140940">(</span><span class="op" id="6140941">)</span>&nbsp;<span class="op" id="6140943">==</span>&nbsp;<span class="num" id="6140946">0</span>&nbsp;<span class="op" id="6140948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6140953">n</span>&nbsp;<span class="op" id="6140955">=</span>&nbsp;<span class="num" id="6140957">1e9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6140963">}</span>&nbsp;<span class="keyword" id="6140965">else</span>&nbsp;<span class="op" id="6140970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6140975">n</span>&nbsp;<span class="op" id="6140977">=</span>&nbsp;<span class="builtintype" id="6140979">int</span><span class="op" id="6140982">(</span><span class="ident" id="6140983">d</span><span class="op" id="6140984">.</span><span class="ident" id="6140985">Nanoseconds</span><span class="op" id="6140996">(</span><span class="op" id="6140997">)</span>&nbsp;<span class="op" id="6140999">/</span>&nbsp;<span class="ident" id="6141001">b</span><span class="op" id="6141002">.</span><span class="ident" id="6141003">nsPerOp</span><span class="op" id="6141010">(</span><span class="op" id="6141011">)</span><span class="op" id="6141012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6141016">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6141020">//&nbsp;Run&nbsp;more&nbsp;iterations&nbsp;than&nbsp;we&nbsp;think&nbsp;we&#39;ll&nbsp;need&nbsp;(1.2x).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6141078">//&nbsp;Don&#39;t&nbsp;grow&nbsp;too&nbsp;fast&nbsp;in&nbsp;case&nbsp;we&nbsp;had&nbsp;timing&nbsp;errors&nbsp;previously.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6141144">//&nbsp;Be&nbsp;sure&nbsp;to&nbsp;run&nbsp;at&nbsp;least&nbsp;one&nbsp;more&nbsp;than&nbsp;last&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6141198">n</span>&nbsp;<span class="op" id="6141200">=</span>&nbsp;<span class="ident" id="6141202">max</span><span class="op" id="6141205">(</span><span class="ident" id="6141206">min</span><span class="op" id="6141209">(</span><span class="ident" id="6141210">n</span><span class="op" id="6141211">+</span><span class="ident" id="6141212">n</span><span class="op" id="6141213">/</span><span class="num" id="6141214">5</span><span class="op" id="6141215">,</span>&nbsp;<span class="num" id="6141217">100</span><span class="op" id="6141220">*</span><span class="ident" id="6141221">last</span><span class="op" id="6141225">)</span><span class="op" id="6141226">,</span>&nbsp;<span class="ident" id="6141228">last</span><span class="op" id="6141232">+</span><span class="num" id="6141233">1</span><span class="op" id="6141234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6141238">//&nbsp;Round&nbsp;up&nbsp;to&nbsp;something&nbsp;easy&nbsp;to&nbsp;read.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6141279">n</span>&nbsp;<span class="op" id="6141281">=</span>&nbsp;<span class="ident" id="6141283">roundUp</span><span class="op" id="6141290">(</span><span class="ident" id="6141291">n</span><span class="op" id="6141292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6141296">b</span><span class="op" id="6141297">.</span><span class="ident" id="6141298">runN</span><span class="op" id="6141302">(</span><span class="ident" id="6141303">n</span><span class="op" id="6141304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6141307">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6141310">b</span><span class="op" id="6141311">.</span><span class="ident" id="6141312">result</span>&nbsp;<span class="op" id="6141319">=</span>&nbsp;<span class="ident" id="6141321">BenchmarkResult</span><span class="op" id="6141336">{</span><span class="ident" id="6141337">b</span><span class="op" id="6141338">.</span><span class="ident" id="6141339">N</span><span class="op" id="6141340">,</span>&nbsp;<span class="ident" id="6141342">b</span><span class="op" id="6141343">.</span><span class="ident" id="6141344">duration</span><span class="op" id="6141352">,</span>&nbsp;<span class="ident" id="6141354">b</span><span class="op" id="6141355">.</span><span class="ident" id="6141356">bytes</span><span class="op" id="6141361">,</span>&nbsp;<span class="ident" id="6141363">b</span><span class="op" id="6141364">.</span><span class="ident" id="6141365">netAllocs</span><span class="op" id="6141374">,</span>&nbsp;<span class="ident" id="6141376">b</span><span class="op" id="6141377">.</span><span class="ident" id="6141378">netBytes</span><span class="op" id="6141386">}</span><br>
<span class="lineno"></span><span class="op" id="6141388">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="6141391">//&nbsp;The&nbsp;results&nbsp;of&nbsp;a&nbsp;benchmark&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="6141426">type</span>&nbsp;<span class="ident" id="6141431">BenchmarkResult</span>&nbsp;<span class="keyword" id="6141447">struct</span>&nbsp;<span class="op" id="6141454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6141457">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6141467">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6141481">//&nbsp;The&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6141511">T</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6141521">time</span><span class="op" id="6141525">.</span><span class="ident" id="6141526">Duration</span>&nbsp;<span class="comment" id="6141535">//&nbsp;The&nbsp;total&nbsp;time&nbsp;taken.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6141561">Bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6141571">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6141585">//&nbsp;Bytes&nbsp;processed&nbsp;in&nbsp;one&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6141623">MemAllocs</span>&nbsp;<span class="ident" id="6141633">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6141647">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;memory&nbsp;allocations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6141691">MemBytes</span>&nbsp;&nbsp;<span class="ident" id="6141701">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6141715">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;bytes&nbsp;allocated.</span><br>
<span class="lineno"></span><span class="op" id="6141755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="6141758">func</span>&nbsp;<span class="op" id="6141763">(</span><span class="ident" id="6141764">r</span>&nbsp;<span class="ident" id="6141766">BenchmarkResult</span><span class="op" id="6141781">)</span>&nbsp;<span class="ident" id="6141783">NsPerOp</span><span class="op" id="6141790">(</span><span class="op" id="6141791">)</span>&nbsp;<span class="ident" id="6141793">int64</span>&nbsp;<span class="op" id="6141799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6141802">if</span>&nbsp;<span class="ident" id="6141805">r</span><span class="op" id="6141806">.</span><span class="ident" id="6141807">N</span>&nbsp;<span class="op" id="6141809">&lt;=</span>&nbsp;<span class="num" id="6141812">0</span>&nbsp;<span class="op" id="6141814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6141818">return</span>&nbsp;<span class="num" id="6141825">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6141828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6141831">return</span>&nbsp;<span class="ident" id="6141838">r</span><span class="op" id="6141839">.</span><span class="ident" id="6141840">T</span><span class="op" id="6141841">.</span><span class="ident" id="6141842">Nanoseconds</span><span class="op" id="6141853">(</span><span class="op" id="6141854">)</span>&nbsp;<span class="op" id="6141856">/</span>&nbsp;<span class="ident" id="6141858">int64</span><span class="op" id="6141863">(</span><span class="ident" id="6141864">r</span><span class="op" id="6141865">.</span><span class="ident" id="6141866">N</span><span class="op" id="6141867">)</span><br>
<span class="lineno">235</span><span class="op" id="6141869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6141872">func</span>&nbsp;<span class="op" id="6141877">(</span><span class="ident" id="6141878">r</span>&nbsp;<span class="ident" id="6141880">BenchmarkResult</span><span class="op" id="6141895">)</span>&nbsp;<span class="ident" id="6141897">mbPerSec</span><span class="op" id="6141905">(</span><span class="op" id="6141906">)</span>&nbsp;<span class="builtintype" id="6141908">float64</span>&nbsp;<span class="op" id="6141916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6141919">if</span>&nbsp;<span class="ident" id="6141922">r</span><span class="op" id="6141923">.</span><span class="ident" id="6141924">Bytes</span>&nbsp;<span class="op" id="6141930">&lt;=</span>&nbsp;<span class="num" id="6141933">0</span>&nbsp;<span class="op" id="6141935">||</span>&nbsp;<span class="ident" id="6141938">r</span><span class="op" id="6141939">.</span><span class="ident" id="6141940">T</span>&nbsp;<span class="op" id="6141942">&lt;=</span>&nbsp;<span class="num" id="6141945">0</span>&nbsp;<span class="op" id="6141947">||</span>&nbsp;<span class="ident" id="6141950">r</span><span class="op" id="6141951">.</span><span class="ident" id="6141952">N</span>&nbsp;<span class="op" id="6141954">&lt;=</span>&nbsp;<span class="num" id="6141957">0</span>&nbsp;<span class="op" id="6141959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6141963">return</span>&nbsp;<span class="num" id="6141970">0</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6141973">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6141976">return</span>&nbsp;<span class="op" id="6141983">(</span><span class="builtintype" id="6141984">float64</span><span class="op" id="6141991">(</span><span class="ident" id="6141992">r</span><span class="op" id="6141993">.</span><span class="ident" id="6141994">Bytes</span><span class="op" id="6141999">)</span>&nbsp;<span class="op" id="6142001">*</span>&nbsp;<span class="builtintype" id="6142003">float64</span><span class="op" id="6142010">(</span><span class="ident" id="6142011">r</span><span class="op" id="6142012">.</span><span class="ident" id="6142013">N</span><span class="op" id="6142014">)</span>&nbsp;<span class="op" id="6142016">/</span>&nbsp;<span class="num" id="6142018">1e6</span><span class="op" id="6142021">)</span>&nbsp;<span class="op" id="6142023">/</span>&nbsp;<span class="ident" id="6142025">r</span><span class="op" id="6142026">.</span><span class="ident" id="6142027">T</span><span class="op" id="6142028">.</span><span class="ident" id="6142029">Seconds</span><span class="op" id="6142036">(</span><span class="op" id="6142037">)</span><br>
<span class="lineno"></span><span class="op" id="6142039">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6142042">func</span>&nbsp;<span class="op" id="6142047">(</span><span class="ident" id="6142048">r</span>&nbsp;<span class="ident" id="6142050">BenchmarkResult</span><span class="op" id="6142065">)</span>&nbsp;<span class="ident" id="6142067">AllocsPerOp</span><span class="op" id="6142078">(</span><span class="op" id="6142079">)</span>&nbsp;<span class="ident" id="6142081">int64</span>&nbsp;<span class="op" id="6142087">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6142090">if</span>&nbsp;<span class="ident" id="6142093">r</span><span class="op" id="6142094">.</span><span class="ident" id="6142095">N</span>&nbsp;<span class="op" id="6142097">&lt;=</span>&nbsp;<span class="num" id="6142100">0</span>&nbsp;<span class="op" id="6142102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6142106">return</span>&nbsp;<span class="num" id="6142113">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6142116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6142119">return</span>&nbsp;<span class="ident" id="6142126">int64</span><span class="op" id="6142131">(</span><span class="ident" id="6142132">r</span><span class="op" id="6142133">.</span><span class="ident" id="6142134">MemAllocs</span><span class="op" id="6142143">)</span>&nbsp;<span class="op" id="6142145">/</span>&nbsp;<span class="ident" id="6142147">int64</span><span class="op" id="6142152">(</span><span class="ident" id="6142153">r</span><span class="op" id="6142154">.</span><span class="ident" id="6142155">N</span><span class="op" id="6142156">)</span><br>
<span class="lineno"></span><span class="op" id="6142158">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="6142161">func</span>&nbsp;<span class="op" id="6142166">(</span><span class="ident" id="6142167">r</span>&nbsp;<span class="ident" id="6142169">BenchmarkResult</span><span class="op" id="6142184">)</span>&nbsp;<span class="ident" id="6142186">AllocedBytesPerOp</span><span class="op" id="6142203">(</span><span class="op" id="6142204">)</span>&nbsp;<span class="ident" id="6142206">int64</span>&nbsp;<span class="op" id="6142212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6142215">if</span>&nbsp;<span class="ident" id="6142218">r</span><span class="op" id="6142219">.</span><span class="ident" id="6142220">N</span>&nbsp;<span class="op" id="6142222">&lt;=</span>&nbsp;<span class="num" id="6142225">0</span>&nbsp;<span class="op" id="6142227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6142231">return</span>&nbsp;<span class="num" id="6142238">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6142241">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6142244">return</span>&nbsp;<span class="ident" id="6142251">int64</span><span class="op" id="6142256">(</span><span class="ident" id="6142257">r</span><span class="op" id="6142258">.</span><span class="ident" id="6142259">MemBytes</span><span class="op" id="6142267">)</span>&nbsp;<span class="op" id="6142269">/</span>&nbsp;<span class="ident" id="6142271">int64</span><span class="op" id="6142276">(</span><span class="ident" id="6142277">r</span><span class="op" id="6142278">.</span><span class="ident" id="6142279">N</span><span class="op" id="6142280">)</span><br>
<span class="lineno"></span><span class="op" id="6142282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6142285">func</span>&nbsp;<span class="op" id="6142290">(</span><span class="ident" id="6142291">r</span>&nbsp;<span class="ident" id="6142293">BenchmarkResult</span><span class="op" id="6142308">)</span>&nbsp;<span class="ident" id="6142310">String</span><span class="op" id="6142316">(</span><span class="op" id="6142317">)</span>&nbsp;<span class="builtintype" id="6142319">string</span>&nbsp;<span class="op" id="6142326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6142329">mbs</span>&nbsp;<span class="op" id="6142333">:=</span>&nbsp;<span class="ident" id="6142336">r</span><span class="op" id="6142337">.</span><span class="ident" id="6142338">mbPerSec</span><span class="op" id="6142346">(</span><span class="op" id="6142347">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6142350">mb</span>&nbsp;<span class="op" id="6142353">:=</span>&nbsp;<span class="string" id="6142356">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6142360">if</span>&nbsp;<span class="ident" id="6142363">mbs</span>&nbsp;<span class="op" id="6142367">!=</span>&nbsp;<span class="num" id="6142370">0</span>&nbsp;<span class="op" id="6142372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6142376">mb</span>&nbsp;<span class="op" id="6142379">=</span>&nbsp;<span class="ident" id="6142381">fmt</span><span class="op" id="6142384">.</span><span class="ident" id="6142385">Sprintf</span><span class="op" id="6142392">(</span><span class="string" id="6142393">&#34;\t%7.2f&nbsp;MB/s&#34;</span><span class="op" id="6142407">,</span>&nbsp;<span class="ident" id="6142409">mbs</span><span class="op" id="6142412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6142415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6142418">nsop</span>&nbsp;<span class="op" id="6142423">:=</span>&nbsp;<span class="ident" id="6142426">r</span><span class="op" id="6142427">.</span><span class="ident" id="6142428">NsPerOp</span><span class="op" id="6142435">(</span><span class="op" id="6142436">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6142439">ns</span>&nbsp;<span class="op" id="6142442">:=</span>&nbsp;<span class="ident" id="6142445">fmt</span><span class="op" id="6142448">.</span><span class="ident" id="6142449">Sprintf</span><span class="op" id="6142456">(</span><span class="string" id="6142457">&#34;%10d&nbsp;ns/op&#34;</span><span class="op" id="6142469">,</span>&nbsp;<span class="ident" id="6142471">nsop</span><span class="op" id="6142475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6142478">if</span>&nbsp;<span class="ident" id="6142481">r</span><span class="op" id="6142482">.</span><span class="ident" id="6142483">N</span>&nbsp;<span class="op" id="6142485">&gt;</span>&nbsp;<span class="num" id="6142487">0</span>&nbsp;<span class="op" id="6142489">&amp;&amp;</span>&nbsp;<span class="ident" id="6142492">nsop</span>&nbsp;<span class="op" id="6142497">&lt;</span>&nbsp;<span class="num" id="6142499">100</span>&nbsp;<span class="op" id="6142503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6142507">//&nbsp;The&nbsp;format&nbsp;specifiers&nbsp;here&nbsp;make&nbsp;sure&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6142554">//&nbsp;the&nbsp;ones&nbsp;digits&nbsp;line&nbsp;up&nbsp;for&nbsp;all&nbsp;three&nbsp;possible&nbsp;formats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6142615">if</span>&nbsp;<span class="ident" id="6142618">nsop</span>&nbsp;<span class="op" id="6142623">&lt;</span>&nbsp;<span class="num" id="6142625">10</span>&nbsp;<span class="op" id="6142628">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6142633">ns</span>&nbsp;<span class="op" id="6142636">=</span>&nbsp;<span class="ident" id="6142638">fmt</span><span class="op" id="6142641">.</span><span class="ident" id="6142642">Sprintf</span><span class="op" id="6142649">(</span><span class="string" id="6142650">&#34;%13.2f&nbsp;ns/op&#34;</span><span class="op" id="6142664">,</span>&nbsp;<span class="builtintype" id="6142666">float64</span><span class="op" id="6142673">(</span><span class="ident" id="6142674">r</span><span class="op" id="6142675">.</span><span class="ident" id="6142676">T</span><span class="op" id="6142677">.</span><span class="ident" id="6142678">Nanoseconds</span><span class="op" id="6142689">(</span><span class="op" id="6142690">)</span><span class="op" id="6142691">)</span><span class="op" id="6142692">/</span><span class="builtintype" id="6142693">float64</span><span class="op" id="6142700">(</span><span class="ident" id="6142701">r</span><span class="op" id="6142702">.</span><span class="ident" id="6142703">N</span><span class="op" id="6142704">)</span><span class="op" id="6142705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6142709">}</span>&nbsp;<span class="keyword" id="6142711">else</span>&nbsp;<span class="op" id="6142716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6142721">ns</span>&nbsp;<span class="op" id="6142724">=</span>&nbsp;<span class="ident" id="6142726">fmt</span><span class="op" id="6142729">.</span><span class="ident" id="6142730">Sprintf</span><span class="op" id="6142737">(</span><span class="string" id="6142738">&#34;%12.1f&nbsp;ns/op&#34;</span><span class="op" id="6142752">,</span>&nbsp;<span class="builtintype" id="6142754">float64</span><span class="op" id="6142761">(</span><span class="ident" id="6142762">r</span><span class="op" id="6142763">.</span><span class="ident" id="6142764">T</span><span class="op" id="6142765">.</span><span class="ident" id="6142766">Nanoseconds</span><span class="op" id="6142777">(</span><span class="op" id="6142778">)</span><span class="op" id="6142779">)</span><span class="op" id="6142780">/</span><span class="builtintype" id="6142781">float64</span><span class="op" id="6142788">(</span><span class="ident" id="6142789">r</span><span class="op" id="6142790">.</span><span class="ident" id="6142791">N</span><span class="op" id="6142792">)</span><span class="op" id="6142793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6142797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6142800">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6142803">return</span>&nbsp;<span class="ident" id="6142810">fmt</span><span class="op" id="6142813">.</span><span class="ident" id="6142814">Sprintf</span><span class="op" id="6142821">(</span><span class="string" id="6142822">&#34;%8d\t%s%s&#34;</span><span class="op" id="6142833">,</span>&nbsp;<span class="ident" id="6142835">r</span><span class="op" id="6142836">.</span><span class="ident" id="6142837">N</span><span class="op" id="6142838">,</span>&nbsp;<span class="ident" id="6142840">ns</span><span class="op" id="6142842">,</span>&nbsp;<span class="ident" id="6142844">mb</span><span class="op" id="6142846">)</span><br>
<span class="lineno"></span><span class="op" id="6142848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6142851">func</span>&nbsp;<span class="op" id="6142856">(</span><span class="ident" id="6142857">r</span>&nbsp;<span class="ident" id="6142859">BenchmarkResult</span><span class="op" id="6142874">)</span>&nbsp;<span class="ident" id="6142876">MemString</span><span class="op" id="6142885">(</span><span class="op" id="6142886">)</span>&nbsp;<span class="builtintype" id="6142888">string</span>&nbsp;<span class="op" id="6142895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6142898">return</span>&nbsp;<span class="ident" id="6142905">fmt</span><span class="op" id="6142908">.</span><span class="ident" id="6142909">Sprintf</span><span class="op" id="6142916">(</span><span class="string" id="6142917">&#34;%8d&nbsp;B/op\t%8d&nbsp;allocs/op&#34;</span><span class="op" id="6142942">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6142946">r</span><span class="op" id="6142947">.</span><span class="ident" id="6142948">AllocedBytesPerOp</span><span class="op" id="6142965">(</span><span class="op" id="6142966">)</span><span class="op" id="6142967">,</span>&nbsp;<span class="ident" id="6142969">r</span><span class="op" id="6142970">.</span><span class="ident" id="6142971">AllocsPerOp</span><span class="op" id="6142982">(</span><span class="op" id="6142983">)</span><span class="op" id="6142984">)</span><br>
<span class="lineno"></span><span class="op" id="6142986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6142989">//&nbsp;An&nbsp;internal&nbsp;function&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6143082">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno">285</span><span class="keyword" id="6143111">func</span>&nbsp;<span class="ident" id="6143116">RunBenchmarks</span><span class="op" id="6143129">(</span><span class="ident" id="6143130">matchString</span>&nbsp;<span class="keyword" id="6143142">func</span><span class="op" id="6143146">(</span><span class="ident" id="6143147">pat</span><span class="op" id="6143150">,</span>&nbsp;<span class="ident" id="6143152">str</span>&nbsp;<span class="builtintype" id="6143156">string</span><span class="op" id="6143162">)</span>&nbsp;<span class="op" id="6143164">(</span><span class="builtintype" id="6143165">bool</span><span class="op" id="6143169">,</span>&nbsp;<span class="builtintype" id="6143171">error</span><span class="op" id="6143176">)</span><span class="op" id="6143177">,</span>&nbsp;<span class="ident" id="6143179">benchmarks</span>&nbsp;<span class="op" id="6143190">[</span><span class="op" id="6143191">]</span><span class="ident" id="6143192">InternalBenchmark</span><span class="op" id="6143209">)</span>&nbsp;<span class="op" id="6143211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6143214">//&nbsp;If&nbsp;no&nbsp;flag&nbsp;was&nbsp;specified,&nbsp;don&#39;t&nbsp;run&nbsp;benchmarks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6143266">if</span>&nbsp;<span class="builtinfunc" id="6143269">len</span><span class="op" id="6143272">(</span><span class="op" id="6143273">*</span><span class="ident" id="6143274">matchBenchmarks</span><span class="op" id="6143289">)</span>&nbsp;<span class="op" id="6143291">==</span>&nbsp;<span class="num" id="6143294">0</span>&nbsp;<span class="op" id="6143296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6143300">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6143308">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6143311">for</span>&nbsp;<span class="ident" id="6143315">_</span><span class="op" id="6143316">,</span>&nbsp;<span class="ident" id="6143318">Benchmark</span>&nbsp;<span class="op" id="6143328">:=</span>&nbsp;<span class="keyword" id="6143331">range</span>&nbsp;<span class="ident" id="6143337">benchmarks</span>&nbsp;<span class="op" id="6143348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6143352">matched</span><span class="op" id="6143359">,</span>&nbsp;<span class="ident" id="6143361">err</span>&nbsp;<span class="op" id="6143365">:=</span>&nbsp;<span class="ident" id="6143368">matchString</span><span class="op" id="6143379">(</span><span class="op" id="6143380">*</span><span class="ident" id="6143381">matchBenchmarks</span><span class="op" id="6143396">,</span>&nbsp;<span class="ident" id="6143398">Benchmark</span><span class="op" id="6143407">.</span><span class="ident" id="6143408">Name</span><span class="op" id="6143412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6143416">if</span>&nbsp;<span class="ident" id="6143419">err</span>&nbsp;<span class="op" id="6143423">!=</span>&nbsp;<span class="builtintype" id="6143426">nil</span>&nbsp;<span class="op" id="6143430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6143435">fmt</span><span class="op" id="6143438">.</span><span class="ident" id="6143439">Fprintf</span><span class="op" id="6143446">(</span><span class="ident" id="6143447">os</span><span class="op" id="6143449">.</span><span class="ident" id="6143450">Stderr</span><span class="op" id="6143456">,</span>&nbsp;<span class="string" id="6143458">&#34;testing:&nbsp;invalid&nbsp;regexp&nbsp;for&nbsp;-test.bench:&nbsp;%s\n&#34;</span><span class="op" id="6143505">,</span>&nbsp;<span class="ident" id="6143507">err</span><span class="op" id="6143510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6143515">os</span><span class="op" id="6143517">.</span><span class="ident" id="6143518">Exit</span><span class="op" id="6143522">(</span><span class="num" id="6143523">1</span><span class="op" id="6143524">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6143528">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6143532">if</span>&nbsp;<span class="op" id="6143535">!</span><span class="ident" id="6143536">matched</span>&nbsp;<span class="op" id="6143544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6143549">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6143560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6143564">for</span>&nbsp;<span class="ident" id="6143568">_</span><span class="op" id="6143569">,</span>&nbsp;<span class="ident" id="6143571">procs</span>&nbsp;<span class="op" id="6143577">:=</span>&nbsp;<span class="keyword" id="6143580">range</span>&nbsp;<span class="ident" id="6143586">cpuList</span>&nbsp;<span class="op" id="6143594">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6143599">runtime</span><span class="op" id="6143606">.</span><span class="ident" id="6143607">GOMAXPROCS</span><span class="op" id="6143617">(</span><span class="ident" id="6143618">procs</span><span class="op" id="6143623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6143628">b</span>&nbsp;<span class="op" id="6143630">:=</span>&nbsp;<span class="op" id="6143633">&amp;</span><span class="ident" id="6143634">B</span><span class="op" id="6143635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6143641">common</span><span class="op" id="6143647">:</span>&nbsp;<span class="ident" id="6143649">common</span><span class="op" id="6143655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6143662">signal</span><span class="op" id="6143668">:</span>&nbsp;<span class="builtinfunc" id="6143670">make</span><span class="op" id="6143674">(</span><span class="keyword" id="6143675">chan</span>&nbsp;<span class="keyword" id="6143680">interface</span><span class="op" id="6143689">{</span><span class="op" id="6143690">}</span><span class="op" id="6143691">)</span><span class="op" id="6143692">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6143698">}</span><span class="op" id="6143699">,</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6143705">benchmark</span><span class="op" id="6143714">:</span>&nbsp;<span class="ident" id="6143716">Benchmark</span><span class="op" id="6143725">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6143730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6143735">benchName</span>&nbsp;<span class="op" id="6143745">:=</span>&nbsp;<span class="ident" id="6143748">Benchmark</span><span class="op" id="6143757">.</span><span class="ident" id="6143758">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6143766">if</span>&nbsp;<span class="ident" id="6143769">procs</span>&nbsp;<span class="op" id="6143775">!=</span>&nbsp;<span class="num" id="6143778">1</span>&nbsp;<span class="op" id="6143780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6143786">benchName</span>&nbsp;<span class="op" id="6143796">=</span>&nbsp;<span class="ident" id="6143798">fmt</span><span class="op" id="6143801">.</span><span class="ident" id="6143802">Sprintf</span><span class="op" id="6143809">(</span><span class="string" id="6143810">&#34;%s-%d&#34;</span><span class="op" id="6143817">,</span>&nbsp;<span class="ident" id="6143819">Benchmark</span><span class="op" id="6143828">.</span><span class="ident" id="6143829">Name</span><span class="op" id="6143833">,</span>&nbsp;<span class="ident" id="6143835">procs</span><span class="op" id="6143840">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6143845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6143850">fmt</span><span class="op" id="6143853">.</span><span class="ident" id="6143854">Printf</span><span class="op" id="6143860">(</span><span class="string" id="6143861">&#34;%s\t&#34;</span><span class="op" id="6143867">,</span>&nbsp;<span class="ident" id="6143869">benchName</span><span class="op" id="6143878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6143883">r</span>&nbsp;<span class="op" id="6143885">:=</span>&nbsp;<span class="ident" id="6143888">b</span><span class="op" id="6143889">.</span><span class="ident" id="6143890">run</span><span class="op" id="6143893">(</span><span class="op" id="6143894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6143899">if</span>&nbsp;<span class="ident" id="6143902">b</span><span class="op" id="6143903">.</span><span class="ident" id="6143904">failed</span>&nbsp;<span class="op" id="6143911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6143917">//&nbsp;The&nbsp;output&nbsp;could&nbsp;be&nbsp;very&nbsp;long&nbsp;here,&nbsp;but&nbsp;probably&nbsp;isn&#39;t.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6143980">//&nbsp;We&nbsp;print&nbsp;it&nbsp;all,&nbsp;regardless,&nbsp;because&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;trim&nbsp;the&nbsp;reason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6144057">//&nbsp;the&nbsp;benchmark&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6144086">fmt</span><span class="op" id="6144089">.</span><span class="ident" id="6144090">Printf</span><span class="op" id="6144096">(</span><span class="string" id="6144097">&#34;---&nbsp;FAIL:&nbsp;%s\n%s&#34;</span><span class="op" id="6144115">,</span>&nbsp;<span class="ident" id="6144117">benchName</span><span class="op" id="6144126">,</span>&nbsp;<span class="ident" id="6144128">b</span><span class="op" id="6144129">.</span><span class="ident" id="6144130">output</span><span class="op" id="6144136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6144142">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6144154">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6144159">results</span>&nbsp;<span class="op" id="6144167">:=</span>&nbsp;<span class="ident" id="6144170">r</span><span class="op" id="6144171">.</span><span class="ident" id="6144172">String</span><span class="op" id="6144178">(</span><span class="op" id="6144179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6144184">if</span>&nbsp;<span class="op" id="6144187">*</span><span class="ident" id="6144188">benchmarkMemory</span>&nbsp;<span class="op" id="6144204">||</span>&nbsp;<span class="ident" id="6144207">b</span><span class="op" id="6144208">.</span><span class="ident" id="6144209">showAllocResult</span>&nbsp;<span class="op" id="6144225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6144231">results</span>&nbsp;<span class="op" id="6144239">+=</span>&nbsp;<span class="string" id="6144242">&#34;\t&#34;</span>&nbsp;<span class="op" id="6144247">+</span>&nbsp;<span class="ident" id="6144249">r</span><span class="op" id="6144250">.</span><span class="ident" id="6144251">MemString</span><span class="op" id="6144260">(</span><span class="op" id="6144261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6144266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6144271">fmt</span><span class="op" id="6144274">.</span><span class="ident" id="6144275">Println</span><span class="op" id="6144282">(</span><span class="ident" id="6144283">results</span><span class="op" id="6144290">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6144295">//&nbsp;Unlike&nbsp;with&nbsp;tests,&nbsp;we&nbsp;ignore&nbsp;the&nbsp;-chatty&nbsp;flag&nbsp;and&nbsp;always&nbsp;print&nbsp;output&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6144375">//&nbsp;benchmarks&nbsp;since&nbsp;the&nbsp;output&nbsp;generation&nbsp;time&nbsp;will&nbsp;skew&nbsp;the&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6144448">if</span>&nbsp;<span class="builtinfunc" id="6144451">len</span><span class="op" id="6144454">(</span><span class="ident" id="6144455">b</span><span class="op" id="6144456">.</span><span class="ident" id="6144457">output</span><span class="op" id="6144463">)</span>&nbsp;<span class="op" id="6144465">&gt;</span>&nbsp;<span class="num" id="6144467">0</span>&nbsp;<span class="op" id="6144469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6144475">b</span><span class="op" id="6144476">.</span><span class="ident" id="6144477">trimOutput</span><span class="op" id="6144487">(</span><span class="op" id="6144488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6144494">fmt</span><span class="op" id="6144497">.</span><span class="ident" id="6144498">Printf</span><span class="op" id="6144504">(</span><span class="string" id="6144505">&#34;---&nbsp;BENCH:&nbsp;%s\n%s&#34;</span><span class="op" id="6144524">,</span>&nbsp;<span class="ident" id="6144526">benchName</span><span class="op" id="6144535">,</span>&nbsp;<span class="ident" id="6144537">b</span><span class="op" id="6144538">.</span><span class="ident" id="6144539">output</span><span class="op" id="6144545">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6144550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6144555">if</span>&nbsp;<span class="ident" id="6144558">p</span>&nbsp;<span class="op" id="6144560">:=</span>&nbsp;<span class="ident" id="6144563">runtime</span><span class="op" id="6144570">.</span><span class="ident" id="6144571">GOMAXPROCS</span><span class="op" id="6144581">(</span><span class="op" id="6144582">-</span><span class="num" id="6144583">1</span><span class="op" id="6144584">)</span><span class="op" id="6144585">;</span>&nbsp;<span class="ident" id="6144587">p</span>&nbsp;<span class="op" id="6144589">!=</span>&nbsp;<span class="ident" id="6144592">procs</span>&nbsp;<span class="op" id="6144598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6144604">fmt</span><span class="op" id="6144607">.</span><span class="ident" id="6144608">Fprintf</span><span class="op" id="6144615">(</span><span class="ident" id="6144616">os</span><span class="op" id="6144618">.</span><span class="ident" id="6144619">Stderr</span><span class="op" id="6144625">,</span>&nbsp;<span class="string" id="6144627">&#34;testing:&nbsp;%s&nbsp;left&nbsp;GOMAXPROCS&nbsp;set&nbsp;to&nbsp;%d\n&#34;</span><span class="op" id="6144668">,</span>&nbsp;<span class="ident" id="6144670">benchName</span><span class="op" id="6144679">,</span>&nbsp;<span class="ident" id="6144681">p</span><span class="op" id="6144682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6144687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6144691">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6144694">}</span><br>
<span class="lineno"></span><span class="op" id="6144696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6144699">//&nbsp;trimOutput&nbsp;shortens&nbsp;the&nbsp;output&nbsp;from&nbsp;a&nbsp;benchmark,&nbsp;which&nbsp;can&nbsp;be&nbsp;very&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="6144775">func</span>&nbsp;<span class="op" id="6144780">(</span><span class="ident" id="6144781">b</span>&nbsp;<span class="op" id="6144783">*</span><span class="ident" id="6144784">B</span><span class="op" id="6144785">)</span>&nbsp;<span class="ident" id="6144787">trimOutput</span><span class="op" id="6144797">(</span><span class="op" id="6144798">)</span>&nbsp;<span class="op" id="6144800">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6144803">//&nbsp;The&nbsp;output&nbsp;is&nbsp;likely&nbsp;to&nbsp;appear&nbsp;multiple&nbsp;times&nbsp;because&nbsp;the&nbsp;benchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6144875">//&nbsp;is&nbsp;run&nbsp;multiple&nbsp;times,&nbsp;but&nbsp;at&nbsp;least&nbsp;it&nbsp;will&nbsp;be&nbsp;seen.&nbsp;This&nbsp;is&nbsp;not&nbsp;a&nbsp;big&nbsp;deal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6144955">//&nbsp;because&nbsp;benchmarks&nbsp;rarely&nbsp;print,&nbsp;but&nbsp;just&nbsp;in&nbsp;case,&nbsp;we&nbsp;trim&nbsp;it&nbsp;if&nbsp;it&#39;s&nbsp;too&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6145039">const</span>&nbsp;<span class="ident" id="6145045">maxNewlines</span>&nbsp;<span class="op" id="6145057">=</span>&nbsp;<span class="num" id="6145059">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6145063">for</span>&nbsp;<span class="ident" id="6145067">nlCount</span><span class="op" id="6145074">,</span>&nbsp;<span class="ident" id="6145076">j</span>&nbsp;<span class="op" id="6145078">:=</span>&nbsp;<span class="num" id="6145081">0</span><span class="op" id="6145082">,</span>&nbsp;<span class="num" id="6145084">0</span><span class="op" id="6145085">;</span>&nbsp;<span class="ident" id="6145087">j</span>&nbsp;<span class="op" id="6145089">&lt;</span>&nbsp;<span class="builtinfunc" id="6145091">len</span><span class="op" id="6145094">(</span><span class="ident" id="6145095">b</span><span class="op" id="6145096">.</span><span class="ident" id="6145097">output</span><span class="op" id="6145103">)</span><span class="op" id="6145104">;</span>&nbsp;<span class="ident" id="6145106">j</span><span class="op" id="6145107">++</span>&nbsp;<span class="op" id="6145110">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6145114">if</span>&nbsp;<span class="ident" id="6145117">b</span><span class="op" id="6145118">.</span><span class="ident" id="6145119">output</span><span class="op" id="6145125">[</span><span class="ident" id="6145126">j</span><span class="op" id="6145127">]</span>&nbsp;<span class="op" id="6145129">==</span>&nbsp;<span class="string" id="6145132">&#39;\n&#39;</span>&nbsp;<span class="op" id="6145137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6145142">nlCount</span><span class="op" id="6145149">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6145155">if</span>&nbsp;<span class="ident" id="6145158">nlCount</span>&nbsp;<span class="op" id="6145166">&gt;=</span>&nbsp;<span class="ident" id="6145169">maxNewlines</span>&nbsp;<span class="op" id="6145181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6145187">b</span><span class="op" id="6145188">.</span><span class="ident" id="6145189">output</span>&nbsp;<span class="op" id="6145196">=</span>&nbsp;<span class="builtinfunc" id="6145198">append</span><span class="op" id="6145204">(</span><span class="ident" id="6145205">b</span><span class="op" id="6145206">.</span><span class="ident" id="6145207">output</span><span class="op" id="6145213">[</span><span class="op" id="6145214">:</span><span class="ident" id="6145215">j</span><span class="op" id="6145216">]</span><span class="op" id="6145217">,</span>&nbsp;<span class="string" id="6145219">&#34;\n\t...&nbsp;[output&nbsp;truncated]\n&#34;</span><span class="op" id="6145249">...</span><span class="op" id="6145252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6145258">break</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6145267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6145271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6145274">}</span><br>
<span class="lineno"></span><span class="op" id="6145276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="6145279">//&nbsp;A&nbsp;PB&nbsp;is&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;for&nbsp;running&nbsp;parallel&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="keyword" id="6145343">type</span>&nbsp;<span class="ident" id="6145348">PB</span>&nbsp;<span class="keyword" id="6145351">struct</span>&nbsp;<span class="op" id="6145358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6145361">globalN</span>&nbsp;<span class="op" id="6145369">*</span><span class="ident" id="6145370">uint64</span>&nbsp;<span class="comment" id="6145377">//&nbsp;shared&nbsp;between&nbsp;all&nbsp;worker&nbsp;goroutines&nbsp;iteration&nbsp;counter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6145436">grain</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6145444">uint64</span>&nbsp;&nbsp;<span class="comment" id="6145452">//&nbsp;acquire&nbsp;that&nbsp;many&nbsp;iterations&nbsp;from&nbsp;globalN&nbsp;at&nbsp;once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6145506">cache</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6145514">uint64</span>&nbsp;&nbsp;<span class="comment" id="6145522">//&nbsp;local&nbsp;cache&nbsp;of&nbsp;acquired&nbsp;iterations</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6145561">bN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6145569">uint64</span>&nbsp;&nbsp;<span class="comment" id="6145577">//&nbsp;total&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;execute&nbsp;(b.N)</span><br>
<span class="lineno"></span><span class="op" id="6145624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6145627">//&nbsp;Next&nbsp;reports&nbsp;whether&nbsp;there&nbsp;are&nbsp;more&nbsp;iterations&nbsp;to&nbsp;execute.</span><br>
<span class="lineno"></span><span class="keyword" id="6145689">func</span>&nbsp;<span class="op" id="6145694">(</span><span class="ident" id="6145695">pb</span>&nbsp;<span class="op" id="6145698">*</span><span class="ident" id="6145699">PB</span><span class="op" id="6145701">)</span>&nbsp;<span class="ident" id="6145703">Next</span><span class="op" id="6145707">(</span><span class="op" id="6145708">)</span>&nbsp;<span class="builtintype" id="6145710">bool</span>&nbsp;<span class="op" id="6145715">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6145718">if</span>&nbsp;<span class="ident" id="6145721">pb</span><span class="op" id="6145723">.</span><span class="ident" id="6145724">cache</span>&nbsp;<span class="op" id="6145730">==</span>&nbsp;<span class="num" id="6145733">0</span>&nbsp;<span class="op" id="6145735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6145739">n</span>&nbsp;<span class="op" id="6145741">:=</span>&nbsp;<span class="ident" id="6145744">atomic</span><span class="op" id="6145750">.</span><span class="ident" id="6145751">AddUint64</span><span class="op" id="6145760">(</span><span class="ident" id="6145761">pb</span><span class="op" id="6145763">.</span><span class="ident" id="6145764">globalN</span><span class="op" id="6145771">,</span>&nbsp;<span class="ident" id="6145773">pb</span><span class="op" id="6145775">.</span><span class="ident" id="6145776">grain</span><span class="op" id="6145781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6145785">if</span>&nbsp;<span class="ident" id="6145788">n</span>&nbsp;<span class="op" id="6145790">&lt;=</span>&nbsp;<span class="ident" id="6145793">pb</span><span class="op" id="6145795">.</span><span class="ident" id="6145796">bN</span>&nbsp;<span class="op" id="6145799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6145804">pb</span><span class="op" id="6145806">.</span><span class="ident" id="6145807">cache</span>&nbsp;<span class="op" id="6145813">=</span>&nbsp;<span class="ident" id="6145815">pb</span><span class="op" id="6145817">.</span><span class="ident" id="6145818">grain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6145826">}</span>&nbsp;<span class="keyword" id="6145828">else</span>&nbsp;<span class="keyword" id="6145833">if</span>&nbsp;<span class="ident" id="6145836">n</span>&nbsp;<span class="op" id="6145838">&lt;</span>&nbsp;<span class="ident" id="6145840">pb</span><span class="op" id="6145842">.</span><span class="ident" id="6145843">bN</span><span class="op" id="6145845">+</span><span class="ident" id="6145846">pb</span><span class="op" id="6145848">.</span><span class="ident" id="6145849">grain</span>&nbsp;<span class="op" id="6145855">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6145860">pb</span><span class="op" id="6145862">.</span><span class="ident" id="6145863">cache</span>&nbsp;<span class="op" id="6145869">=</span>&nbsp;<span class="ident" id="6145871">pb</span><span class="op" id="6145873">.</span><span class="ident" id="6145874">bN</span>&nbsp;<span class="op" id="6145877">+</span>&nbsp;<span class="ident" id="6145879">pb</span><span class="op" id="6145881">.</span><span class="ident" id="6145882">grain</span>&nbsp;<span class="op" id="6145888">-</span>&nbsp;<span class="ident" id="6145890">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6145894">}</span>&nbsp;<span class="keyword" id="6145896">else</span>&nbsp;<span class="op" id="6145901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6145906">return</span>&nbsp;<span class="builtintype" id="6145913">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6145921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6145924">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6145927">pb</span><span class="op" id="6145929">.</span><span class="ident" id="6145930">cache</span><span class="op" id="6145935">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6145939">return</span>&nbsp;<span class="builtintype" id="6145946">true</span><br>
<span class="lineno"></span><span class="op" id="6145951">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6145954">//&nbsp;RunParallel&nbsp;runs&nbsp;a&nbsp;benchmark&nbsp;in&nbsp;parallel.</span><br>
<span class="lineno">380</span><span class="comment" id="6145999">//&nbsp;It&nbsp;creates&nbsp;multiple&nbsp;goroutines&nbsp;and&nbsp;distributes&nbsp;b.N&nbsp;iterations&nbsp;among&nbsp;them.</span><br>
<span class="lineno"></span><span class="comment" id="6146076">//&nbsp;The&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;defaults&nbsp;to&nbsp;GOMAXPROCS.&nbsp;To&nbsp;increase&nbsp;parallelism&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6146156">//&nbsp;non-CPU-bound&nbsp;benchmarks,&nbsp;call&nbsp;SetParallelism&nbsp;before&nbsp;RunParallel.</span><br>
<span class="lineno"></span><span class="comment" id="6146225">//&nbsp;RunParallel&nbsp;is&nbsp;usually&nbsp;used&nbsp;with&nbsp;the&nbsp;go&nbsp;test&nbsp;-cpu&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="6146284">//</span><br>
<span class="lineno">385</span><span class="comment" id="6146287">//&nbsp;The&nbsp;body&nbsp;function&nbsp;will&nbsp;be&nbsp;run&nbsp;in&nbsp;each&nbsp;goroutine.&nbsp;It&nbsp;should&nbsp;set&nbsp;up&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="6146360">//&nbsp;goroutine-local&nbsp;state&nbsp;and&nbsp;then&nbsp;iterate&nbsp;until&nbsp;pb.Next&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="6146431">//&nbsp;It&nbsp;should&nbsp;not&nbsp;use&nbsp;the&nbsp;StartTimer,&nbsp;StopTimer,&nbsp;or&nbsp;ResetTimer&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="6146504">//&nbsp;because&nbsp;they&nbsp;have&nbsp;global&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="6146540">func</span>&nbsp;<span class="op" id="6146545">(</span><span class="ident" id="6146546">b</span>&nbsp;<span class="op" id="6146548">*</span><span class="ident" id="6146549">B</span><span class="op" id="6146550">)</span>&nbsp;<span class="ident" id="6146552">RunParallel</span><span class="op" id="6146563">(</span><span class="ident" id="6146564">body</span>&nbsp;<span class="keyword" id="6146569">func</span><span class="op" id="6146573">(</span><span class="op" id="6146574">*</span><span class="ident" id="6146575">PB</span><span class="op" id="6146577">)</span><span class="op" id="6146578">)</span>&nbsp;<span class="op" id="6146580">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6146583">//&nbsp;Calculate&nbsp;grain&nbsp;size&nbsp;as&nbsp;number&nbsp;of&nbsp;iterations&nbsp;that&nbsp;take&nbsp;~100µs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6146651">//&nbsp;100µs&nbsp;is&nbsp;enough&nbsp;to&nbsp;amortize&nbsp;the&nbsp;overhead&nbsp;and&nbsp;provide&nbsp;sufficient</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6146720">//&nbsp;dynamic&nbsp;load&nbsp;balancing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6146748">grain</span>&nbsp;<span class="op" id="6146754">:=</span>&nbsp;<span class="ident" id="6146757">uint64</span><span class="op" id="6146763">(</span><span class="num" id="6146764">0</span><span class="op" id="6146765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6146768">if</span>&nbsp;<span class="ident" id="6146771">b</span><span class="op" id="6146772">.</span><span class="ident" id="6146773">previousN</span>&nbsp;<span class="op" id="6146783">&gt;</span>&nbsp;<span class="num" id="6146785">0</span>&nbsp;<span class="op" id="6146787">&amp;&amp;</span>&nbsp;<span class="ident" id="6146790">b</span><span class="op" id="6146791">.</span><span class="ident" id="6146792">previousDuration</span>&nbsp;<span class="op" id="6146809">&gt;</span>&nbsp;<span class="num" id="6146811">0</span>&nbsp;<span class="op" id="6146813">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6146817">grain</span>&nbsp;<span class="op" id="6146823">=</span>&nbsp;<span class="num" id="6146825">1e5</span>&nbsp;<span class="op" id="6146829">*</span>&nbsp;<span class="ident" id="6146831">uint64</span><span class="op" id="6146837">(</span><span class="ident" id="6146838">b</span><span class="op" id="6146839">.</span><span class="ident" id="6146840">previousN</span><span class="op" id="6146849">)</span>&nbsp;<span class="op" id="6146851">/</span>&nbsp;<span class="ident" id="6146853">uint64</span><span class="op" id="6146859">(</span><span class="ident" id="6146860">b</span><span class="op" id="6146861">.</span><span class="ident" id="6146862">previousDuration</span><span class="op" id="6146878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6146881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6146884">if</span>&nbsp;<span class="ident" id="6146887">grain</span>&nbsp;<span class="op" id="6146893">&lt;</span>&nbsp;<span class="num" id="6146895">1</span>&nbsp;<span class="op" id="6146897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6146901">grain</span>&nbsp;<span class="op" id="6146907">=</span>&nbsp;<span class="num" id="6146909">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6146912">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6146915">//&nbsp;We&nbsp;expect&nbsp;the&nbsp;inner&nbsp;loop&nbsp;and&nbsp;function&nbsp;call&nbsp;to&nbsp;take&nbsp;at&nbsp;least&nbsp;10ns,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6146985">//&nbsp;so&nbsp;do&nbsp;not&nbsp;do&nbsp;more&nbsp;than&nbsp;100µs/10ns=1e4&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6147040">if</span>&nbsp;<span class="ident" id="6147043">grain</span>&nbsp;<span class="op" id="6147049">&gt;</span>&nbsp;<span class="num" id="6147051">1e4</span>&nbsp;<span class="op" id="6147055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6147059">grain</span>&nbsp;<span class="op" id="6147065">=</span>&nbsp;<span class="num" id="6147067">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6147072">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6147076">n</span>&nbsp;<span class="op" id="6147078">:=</span>&nbsp;<span class="ident" id="6147081">uint64</span><span class="op" id="6147087">(</span><span class="num" id="6147088">0</span><span class="op" id="6147089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6147092">numProcs</span>&nbsp;<span class="op" id="6147101">:=</span>&nbsp;<span class="ident" id="6147104">b</span><span class="op" id="6147105">.</span><span class="ident" id="6147106">parallelism</span>&nbsp;<span class="op" id="6147118">*</span>&nbsp;<span class="ident" id="6147120">runtime</span><span class="op" id="6147127">.</span><span class="ident" id="6147128">GOMAXPROCS</span><span class="op" id="6147138">(</span><span class="num" id="6147139">0</span><span class="op" id="6147140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6147143">var</span>&nbsp;<span class="ident" id="6147147">wg</span>&nbsp;<span class="ident" id="6147150">sync</span><span class="op" id="6147154">.</span><span class="ident" id="6147155">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6147166">wg</span><span class="op" id="6147168">.</span><span class="ident" id="6147169">Add</span><span class="op" id="6147172">(</span><span class="ident" id="6147173">numProcs</span><span class="op" id="6147181">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6147184">for</span>&nbsp;<span class="ident" id="6147188">p</span>&nbsp;<span class="op" id="6147190">:=</span>&nbsp;<span class="num" id="6147193">0</span><span class="op" id="6147194">;</span>&nbsp;<span class="ident" id="6147196">p</span>&nbsp;<span class="op" id="6147198">&lt;</span>&nbsp;<span class="ident" id="6147200">numProcs</span><span class="op" id="6147208">;</span>&nbsp;<span class="ident" id="6147210">p</span><span class="op" id="6147211">++</span>&nbsp;<span class="op" id="6147214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6147218">go</span>&nbsp;<span class="keyword" id="6147221">func</span><span class="op" id="6147225">(</span><span class="op" id="6147226">)</span>&nbsp;<span class="op" id="6147228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6147233">defer</span>&nbsp;<span class="ident" id="6147239">wg</span><span class="op" id="6147241">.</span><span class="ident" id="6147242">Done</span><span class="op" id="6147246">(</span><span class="op" id="6147247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6147252">pb</span>&nbsp;<span class="op" id="6147255">:=</span>&nbsp;<span class="op" id="6147258">&amp;</span><span class="ident" id="6147259">PB</span><span class="op" id="6147261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6147267">globalN</span><span class="op" id="6147274">:</span>&nbsp;<span class="op" id="6147276">&amp;</span><span class="ident" id="6147277">n</span><span class="op" id="6147278">,</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6147284">grain</span><span class="op" id="6147289">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6147293">grain</span><span class="op" id="6147298">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6147304">bN</span><span class="op" id="6147306">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6147313">uint64</span><span class="op" id="6147319">(</span><span class="ident" id="6147320">b</span><span class="op" id="6147321">.</span><span class="ident" id="6147322">N</span><span class="op" id="6147323">)</span><span class="op" id="6147324">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6147329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6147334">body</span><span class="op" id="6147338">(</span><span class="ident" id="6147339">pb</span><span class="op" id="6147341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6147345">}</span><span class="op" id="6147346">(</span><span class="op" id="6147347">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6147350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6147353">wg</span><span class="op" id="6147355">.</span><span class="ident" id="6147356">Wait</span><span class="op" id="6147360">(</span><span class="op" id="6147361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6147364">if</span>&nbsp;<span class="ident" id="6147367">n</span>&nbsp;<span class="op" id="6147369">&lt;=</span>&nbsp;<span class="ident" id="6147372">uint64</span><span class="op" id="6147378">(</span><span class="ident" id="6147379">b</span><span class="op" id="6147380">.</span><span class="ident" id="6147381">N</span><span class="op" id="6147382">)</span>&nbsp;<span class="op" id="6147384">&amp;&amp;</span>&nbsp;<span class="op" id="6147387">!</span><span class="ident" id="6147388">b</span><span class="op" id="6147389">.</span><span class="ident" id="6147390">Failed</span><span class="op" id="6147396">(</span><span class="op" id="6147397">)</span>&nbsp;<span class="op" id="6147399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6147403">b</span><span class="op" id="6147404">.</span><span class="ident" id="6147405">Fatal</span><span class="op" id="6147410">(</span><span class="string" id="6147411">&#34;RunParallel:&nbsp;body&nbsp;exited&nbsp;without&nbsp;pb.Next()&nbsp;==&nbsp;false&#34;</span><span class="op" id="6147464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6147467">}</span><br>
<span class="lineno">425</span><span class="op" id="6147469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6147472">//&nbsp;SetParallelism&nbsp;sets&nbsp;the&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;to&nbsp;p*GOMAXPROCS.</span><br>
<span class="lineno"></span><span class="comment" id="6147557">//&nbsp;There&nbsp;is&nbsp;usually&nbsp;no&nbsp;need&nbsp;to&nbsp;call&nbsp;SetParallelism&nbsp;for&nbsp;CPU-bound&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="comment" id="6147634">//&nbsp;If&nbsp;p&nbsp;is&nbsp;less&nbsp;than&nbsp;1,&nbsp;this&nbsp;call&nbsp;will&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">430</span><span class="keyword" id="6147689">func</span>&nbsp;<span class="op" id="6147694">(</span><span class="ident" id="6147695">b</span>&nbsp;<span class="op" id="6147697">*</span><span class="ident" id="6147698">B</span><span class="op" id="6147699">)</span>&nbsp;<span class="ident" id="6147701">SetParallelism</span><span class="op" id="6147715">(</span><span class="ident" id="6147716">p</span>&nbsp;<span class="builtintype" id="6147718">int</span><span class="op" id="6147721">)</span>&nbsp;<span class="op" id="6147723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6147726">if</span>&nbsp;<span class="ident" id="6147729">p</span>&nbsp;<span class="op" id="6147731">&gt;=</span>&nbsp;<span class="num" id="6147734">1</span>&nbsp;<span class="op" id="6147736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6147740">b</span><span class="op" id="6147741">.</span><span class="ident" id="6147742">parallelism</span>&nbsp;<span class="op" id="6147754">=</span>&nbsp;<span class="ident" id="6147756">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6147759">}</span><br>
<span class="lineno"></span><span class="op" id="6147761">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="6147764">//&nbsp;Benchmark&nbsp;benchmarks&nbsp;a&nbsp;single&nbsp;function.&nbsp;Useful&nbsp;for&nbsp;creating</span><br>
<span class="lineno"></span><span class="comment" id="6147827">//&nbsp;custom&nbsp;benchmarks&nbsp;that&nbsp;do&nbsp;not&nbsp;use&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6147887">func</span>&nbsp;<span class="ident" id="6147892">Benchmark</span><span class="op" id="6147901">(</span><span class="ident" id="6147902">f</span>&nbsp;<span class="keyword" id="6147904">func</span><span class="op" id="6147908">(</span><span class="ident" id="6147909">b</span>&nbsp;<span class="op" id="6147911">*</span><span class="ident" id="6147912">B</span><span class="op" id="6147913">)</span><span class="op" id="6147914">)</span>&nbsp;<span class="ident" id="6147916">BenchmarkResult</span>&nbsp;<span class="op" id="6147932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6147935">b</span>&nbsp;<span class="op" id="6147937">:=</span>&nbsp;<span class="op" id="6147940">&amp;</span><span class="ident" id="6147941">B</span><span class="op" id="6147942">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6147946">common</span><span class="op" id="6147952">:</span>&nbsp;<span class="ident" id="6147954">common</span><span class="op" id="6147960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6147965">signal</span><span class="op" id="6147971">:</span>&nbsp;<span class="builtinfunc" id="6147973">make</span><span class="op" id="6147977">(</span><span class="keyword" id="6147978">chan</span>&nbsp;<span class="keyword" id="6147983">interface</span><span class="op" id="6147992">{</span><span class="op" id="6147993">}</span><span class="op" id="6147994">)</span><span class="op" id="6147995">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6147999">}</span><span class="op" id="6148000">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6148004">benchmark</span><span class="op" id="6148013">:</span>&nbsp;<span class="ident" id="6148015">InternalBenchmark</span><span class="op" id="6148032">{</span><span class="string" id="6148033">&#34;&#34;</span><span class="op" id="6148035">,</span>&nbsp;<span class="ident" id="6148037">f</span><span class="op" id="6148038">}</span><span class="op" id="6148039">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6148042">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6148045">return</span>&nbsp;<span class="ident" id="6148052">b</span><span class="op" id="6148053">.</span><span class="ident" id="6148054">run</span><span class="op" id="6148057">(</span><span class="op" id="6148058">)</span><br>
<span class="lineno"></span><span class="op" id="6148060">}</span>
</div>
</body>
</html>
