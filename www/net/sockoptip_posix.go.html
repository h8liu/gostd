<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3447504">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3447560">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3447614">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3447665">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3447730">package</span>&nbsp;<span class="ident" id="3447738">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3447743">import</span>&nbsp;<span class="op" id="3447750">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3447753">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3447759">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="3447769">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3447772">func</span>&nbsp;<span class="ident" id="3447777">joinIPv4Group</span><span class="op" id="3447790">(</span><span class="ident" id="3447791">fd</span>&nbsp;<span class="op" id="3447794">*</span><span class="ident" id="3447795">netFD</span><span class="op" id="3447800">,</span>&nbsp;<span class="ident" id="3447802">ifi</span>&nbsp;<span class="op" id="3447806">*</span><span class="ident" id="3447807">Interface</span><span class="op" id="3447816">,</span>&nbsp;<span class="ident" id="3447818">ip</span>&nbsp;<span class="ident" id="3447821">IP</span><span class="op" id="3447823">)</span>&nbsp;<span class="builtintype" id="3447825">error</span>&nbsp;<span class="op" id="3447831">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3447834">mreq</span>&nbsp;<span class="op" id="3447839">:=</span>&nbsp;<span class="op" id="3447842">&amp;</span><span class="ident" id="3447843">syscall</span><span class="op" id="3447850">.</span><span class="ident" id="3447851">IPMreq</span><span class="op" id="3447857">{</span><span class="ident" id="3447858">Multiaddr</span><span class="op" id="3447867">:</span>&nbsp;<span class="op" id="3447869">[</span><span class="num" id="3447870">4</span><span class="op" id="3447871">]</span><span class="builtintype" id="3447872">byte</span><span class="op" id="3447876">{</span><span class="ident" id="3447877">ip</span><span class="op" id="3447879">[</span><span class="num" id="3447880">0</span><span class="op" id="3447881">]</span><span class="op" id="3447882">,</span>&nbsp;<span class="ident" id="3447884">ip</span><span class="op" id="3447886">[</span><span class="num" id="3447887">1</span><span class="op" id="3447888">]</span><span class="op" id="3447889">,</span>&nbsp;<span class="ident" id="3447891">ip</span><span class="op" id="3447893">[</span><span class="num" id="3447894">2</span><span class="op" id="3447895">]</span><span class="op" id="3447896">,</span>&nbsp;<span class="ident" id="3447898">ip</span><span class="op" id="3447900">[</span><span class="num" id="3447901">3</span><span class="op" id="3447902">]</span><span class="op" id="3447903">}</span><span class="op" id="3447904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3447907">if</span>&nbsp;<span class="ident" id="3447910">err</span>&nbsp;<span class="op" id="3447914">:=</span>&nbsp;<span class="ident" id="3447917">setIPv4MreqToInterface</span><span class="op" id="3447939">(</span><span class="ident" id="3447940">mreq</span><span class="op" id="3447944">,</span>&nbsp;<span class="ident" id="3447946">ifi</span><span class="op" id="3447949">)</span><span class="op" id="3447950">;</span>&nbsp;<span class="ident" id="3447952">err</span>&nbsp;<span class="op" id="3447956">!=</span>&nbsp;<span class="ident" id="3447959">nil</span>&nbsp;<span class="op" id="3447963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3447967">return</span>&nbsp;<span class="ident" id="3447974">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3447979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3447982">if</span>&nbsp;<span class="ident" id="3447985">err</span>&nbsp;<span class="op" id="3447989">:=</span>&nbsp;<span class="ident" id="3447992">fd</span><span class="op" id="3447994">.</span><span class="ident" id="3447995">incref</span><span class="op" id="3448001">(</span><span class="op" id="3448002">)</span><span class="op" id="3448003">;</span>&nbsp;<span class="ident" id="3448005">err</span>&nbsp;<span class="op" id="3448009">!=</span>&nbsp;<span class="ident" id="3448012">nil</span>&nbsp;<span class="op" id="3448016">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3448020">return</span>&nbsp;<span class="ident" id="3448027">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3448032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3448035">defer</span>&nbsp;<span class="ident" id="3448041">fd</span><span class="op" id="3448043">.</span><span class="ident" id="3448044">decref</span><span class="op" id="3448050">(</span><span class="op" id="3448051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3448054">return</span>&nbsp;<span class="ident" id="3448061">os</span><span class="op" id="3448063">.</span><span class="ident" id="3448064">NewSyscallError</span><span class="op" id="3448079">(</span><span class="string" id="3448080">&#34;setsockopt&#34;</span><span class="op" id="3448092">,</span>&nbsp;<span class="ident" id="3448094">syscall</span><span class="op" id="3448101">.</span><span class="ident" id="3448102">SetsockoptIPMreq</span><span class="op" id="3448118">(</span><span class="ident" id="3448119">fd</span><span class="op" id="3448121">.</span><span class="ident" id="3448122">sysfd</span><span class="op" id="3448127">,</span>&nbsp;<span class="ident" id="3448129">syscall</span><span class="op" id="3448136">.</span><span class="ident" id="3448137">IPPROTO_IP</span><span class="op" id="3448147">,</span>&nbsp;<span class="ident" id="3448149">syscall</span><span class="op" id="3448156">.</span><span class="ident" id="3448157">IP_ADD_MEMBERSHIP</span><span class="op" id="3448174">,</span>&nbsp;<span class="ident" id="3448176">mreq</span><span class="op" id="3448180">)</span><span class="op" id="3448181">)</span><br>
<span class="lineno"></span><span class="op" id="3448183">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="3448186">func</span>&nbsp;<span class="ident" id="3448191">setIPv6MulticastInterface</span><span class="op" id="3448216">(</span><span class="ident" id="3448217">fd</span>&nbsp;<span class="op" id="3448220">*</span><span class="ident" id="3448221">netFD</span><span class="op" id="3448226">,</span>&nbsp;<span class="ident" id="3448228">ifi</span>&nbsp;<span class="op" id="3448232">*</span><span class="ident" id="3448233">Interface</span><span class="op" id="3448242">)</span>&nbsp;<span class="builtintype" id="3448244">error</span>&nbsp;<span class="op" id="3448250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3448253">var</span>&nbsp;<span class="ident" id="3448257">v</span>&nbsp;<span class="builtintype" id="3448259">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3448264">if</span>&nbsp;<span class="ident" id="3448267">ifi</span>&nbsp;<span class="op" id="3448271">!=</span>&nbsp;<span class="ident" id="3448274">nil</span>&nbsp;<span class="op" id="3448278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3448282">v</span>&nbsp;<span class="op" id="3448284">=</span>&nbsp;<span class="ident" id="3448286">ifi</span><span class="op" id="3448289">.</span><span class="ident" id="3448290">Index</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3448297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3448300">if</span>&nbsp;<span class="ident" id="3448303">err</span>&nbsp;<span class="op" id="3448307">:=</span>&nbsp;<span class="ident" id="3448310">fd</span><span class="op" id="3448312">.</span><span class="ident" id="3448313">incref</span><span class="op" id="3448319">(</span><span class="op" id="3448320">)</span><span class="op" id="3448321">;</span>&nbsp;<span class="ident" id="3448323">err</span>&nbsp;<span class="op" id="3448327">!=</span>&nbsp;<span class="ident" id="3448330">nil</span>&nbsp;<span class="op" id="3448334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3448338">return</span>&nbsp;<span class="ident" id="3448345">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3448350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3448353">defer</span>&nbsp;<span class="ident" id="3448359">fd</span><span class="op" id="3448361">.</span><span class="ident" id="3448362">decref</span><span class="op" id="3448368">(</span><span class="op" id="3448369">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3448372">return</span>&nbsp;<span class="ident" id="3448379">os</span><span class="op" id="3448381">.</span><span class="ident" id="3448382">NewSyscallError</span><span class="op" id="3448397">(</span><span class="string" id="3448398">&#34;setsockopt&#34;</span><span class="op" id="3448410">,</span>&nbsp;<span class="ident" id="3448412">syscall</span><span class="op" id="3448419">.</span><span class="ident" id="3448420">SetsockoptInt</span><span class="op" id="3448433">(</span><span class="ident" id="3448434">fd</span><span class="op" id="3448436">.</span><span class="ident" id="3448437">sysfd</span><span class="op" id="3448442">,</span>&nbsp;<span class="ident" id="3448444">syscall</span><span class="op" id="3448451">.</span><span class="ident" id="3448452">IPPROTO_IPV6</span><span class="op" id="3448464">,</span>&nbsp;<span class="ident" id="3448466">syscall</span><span class="op" id="3448473">.</span><span class="ident" id="3448474">IPV6_MULTICAST_IF</span><span class="op" id="3448491">,</span>&nbsp;<span class="ident" id="3448493">v</span><span class="op" id="3448494">)</span><span class="op" id="3448495">)</span><br>
<span class="lineno"></span><span class="op" id="3448497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3448500">func</span>&nbsp;<span class="ident" id="3448505">setIPv6MulticastLoopback</span><span class="op" id="3448529">(</span><span class="ident" id="3448530">fd</span>&nbsp;<span class="op" id="3448533">*</span><span class="ident" id="3448534">netFD</span><span class="op" id="3448539">,</span>&nbsp;<span class="ident" id="3448541">v</span>&nbsp;<span class="builtintype" id="3448543">bool</span><span class="op" id="3448547">)</span>&nbsp;<span class="builtintype" id="3448549">error</span>&nbsp;<span class="op" id="3448555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3448558">if</span>&nbsp;<span class="ident" id="3448561">err</span>&nbsp;<span class="op" id="3448565">:=</span>&nbsp;<span class="ident" id="3448568">fd</span><span class="op" id="3448570">.</span><span class="ident" id="3448571">incref</span><span class="op" id="3448577">(</span><span class="op" id="3448578">)</span><span class="op" id="3448579">;</span>&nbsp;<span class="ident" id="3448581">err</span>&nbsp;<span class="op" id="3448585">!=</span>&nbsp;<span class="ident" id="3448588">nil</span>&nbsp;<span class="op" id="3448592">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3448596">return</span>&nbsp;<span class="ident" id="3448603">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3448608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3448611">defer</span>&nbsp;<span class="ident" id="3448617">fd</span><span class="op" id="3448619">.</span><span class="ident" id="3448620">decref</span><span class="op" id="3448626">(</span><span class="op" id="3448627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3448630">return</span>&nbsp;<span class="ident" id="3448637">os</span><span class="op" id="3448639">.</span><span class="ident" id="3448640">NewSyscallError</span><span class="op" id="3448655">(</span><span class="string" id="3448656">&#34;setsockopt&#34;</span><span class="op" id="3448668">,</span>&nbsp;<span class="ident" id="3448670">syscall</span><span class="op" id="3448677">.</span><span class="ident" id="3448678">SetsockoptInt</span><span class="op" id="3448691">(</span><span class="ident" id="3448692">fd</span><span class="op" id="3448694">.</span><span class="ident" id="3448695">sysfd</span><span class="op" id="3448700">,</span>&nbsp;<span class="ident" id="3448702">syscall</span><span class="op" id="3448709">.</span><span class="ident" id="3448710">IPPROTO_IPV6</span><span class="op" id="3448722">,</span>&nbsp;<span class="ident" id="3448724">syscall</span><span class="op" id="3448731">.</span><span class="ident" id="3448732">IPV6_MULTICAST_LOOP</span><span class="op" id="3448751">,</span>&nbsp;<span class="ident" id="3448753">boolint</span><span class="op" id="3448760">(</span><span class="ident" id="3448761">v</span><span class="op" id="3448762">)</span><span class="op" id="3448763">)</span><span class="op" id="3448764">)</span><br>
<span class="lineno"></span><span class="op" id="3448766">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="3448769">func</span>&nbsp;<span class="ident" id="3448774">joinIPv6Group</span><span class="op" id="3448787">(</span><span class="ident" id="3448788">fd</span>&nbsp;<span class="op" id="3448791">*</span><span class="ident" id="3448792">netFD</span><span class="op" id="3448797">,</span>&nbsp;<span class="ident" id="3448799">ifi</span>&nbsp;<span class="op" id="3448803">*</span><span class="ident" id="3448804">Interface</span><span class="op" id="3448813">,</span>&nbsp;<span class="ident" id="3448815">ip</span>&nbsp;<span class="ident" id="3448818">IP</span><span class="op" id="3448820">)</span>&nbsp;<span class="builtintype" id="3448822">error</span>&nbsp;<span class="op" id="3448828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3448831">mreq</span>&nbsp;<span class="op" id="3448836">:=</span>&nbsp;<span class="op" id="3448839">&amp;</span><span class="ident" id="3448840">syscall</span><span class="op" id="3448847">.</span><span class="ident" id="3448848">IPv6Mreq</span><span class="op" id="3448856">{</span><span class="op" id="3448857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3448860">copy</span><span class="op" id="3448864">(</span><span class="ident" id="3448865">mreq</span><span class="op" id="3448869">.</span><span class="ident" id="3448870">Multiaddr</span><span class="op" id="3448879">[</span><span class="op" id="3448880">:</span><span class="op" id="3448881">]</span><span class="op" id="3448882">,</span>&nbsp;<span class="ident" id="3448884">ip</span><span class="op" id="3448886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3448889">if</span>&nbsp;<span class="ident" id="3448892">ifi</span>&nbsp;<span class="op" id="3448896">!=</span>&nbsp;<span class="ident" id="3448899">nil</span>&nbsp;<span class="op" id="3448903">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3448907">mreq</span><span class="op" id="3448911">.</span><span class="ident" id="3448912">Interface</span>&nbsp;<span class="op" id="3448922">=</span>&nbsp;<span class="builtintype" id="3448924">uint32</span><span class="op" id="3448930">(</span><span class="ident" id="3448931">ifi</span><span class="op" id="3448934">.</span><span class="ident" id="3448935">Index</span><span class="op" id="3448940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3448943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3448946">if</span>&nbsp;<span class="ident" id="3448949">err</span>&nbsp;<span class="op" id="3448953">:=</span>&nbsp;<span class="ident" id="3448956">fd</span><span class="op" id="3448958">.</span><span class="ident" id="3448959">incref</span><span class="op" id="3448965">(</span><span class="op" id="3448966">)</span><span class="op" id="3448967">;</span>&nbsp;<span class="ident" id="3448969">err</span>&nbsp;<span class="op" id="3448973">!=</span>&nbsp;<span class="ident" id="3448976">nil</span>&nbsp;<span class="op" id="3448980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3448984">return</span>&nbsp;<span class="ident" id="3448991">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3448996">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3448999">defer</span>&nbsp;<span class="ident" id="3449005">fd</span><span class="op" id="3449007">.</span><span class="ident" id="3449008">decref</span><span class="op" id="3449014">(</span><span class="op" id="3449015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3449018">return</span>&nbsp;<span class="ident" id="3449025">os</span><span class="op" id="3449027">.</span><span class="ident" id="3449028">NewSyscallError</span><span class="op" id="3449043">(</span><span class="string" id="3449044">&#34;setsockopt&#34;</span><span class="op" id="3449056">,</span>&nbsp;<span class="ident" id="3449058">syscall</span><span class="op" id="3449065">.</span><span class="ident" id="3449066">SetsockoptIPv6Mreq</span><span class="op" id="3449084">(</span><span class="ident" id="3449085">fd</span><span class="op" id="3449087">.</span><span class="ident" id="3449088">sysfd</span><span class="op" id="3449093">,</span>&nbsp;<span class="ident" id="3449095">syscall</span><span class="op" id="3449102">.</span><span class="ident" id="3449103">IPPROTO_IPV6</span><span class="op" id="3449115">,</span>&nbsp;<span class="ident" id="3449117">syscall</span><span class="op" id="3449124">.</span><span class="ident" id="3449125">IPV6_JOIN_GROUP</span><span class="op" id="3449140">,</span>&nbsp;<span class="ident" id="3449142">mreq</span><span class="op" id="3449146">)</span><span class="op" id="3449147">)</span><br>
<span class="lineno"></span><span class="op" id="3449149">}</span>
</div>
</body>
</html>
