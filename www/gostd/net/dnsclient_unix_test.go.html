<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html" class="current">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6654304">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6654359">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6654413">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6654464">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6654529">package</span>&nbsp;<span class="ident" id="6654537">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6654542">import</span>&nbsp;<span class="op" id="6654549">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6654552">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6654558">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6654571">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6654577">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6654585">&#34;reflect&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6654596">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6654607">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6654614">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6654617">var</span>&nbsp;<span class="ident" id="6654621">dnsTransportFallbackTests</span>&nbsp;<span class="op" id="6654647">=</span>&nbsp;<span class="op" id="6654649">[</span><span class="op" id="6654650">]</span><span class="keyword" id="6654651">struct</span>&nbsp;<span class="op" id="6654658">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654661">server</span>&nbsp;&nbsp;<span class="builtintype" id="6654669">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654677">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6654685">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654693">qtype</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6654701">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654709">timeout</span>&nbsp;<span class="builtintype" id="6654717">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6654722">rcode</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6654730">int</span><br>
<span class="lineno">25</span><span class="op" id="6654734">}</span><span class="op" id="6654735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6654738">//&nbsp;Querying&nbsp;&#34;com.&#34;&nbsp;with&nbsp;qtype=255&nbsp;usually&nbsp;makes&nbsp;an&nbsp;answer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6654797">//&nbsp;which&nbsp;requires&nbsp;more&nbsp;than&nbsp;512&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6654837">{</span><span class="string" id="6654838">&#34;8.8.8.8:53&#34;</span><span class="op" id="6654850">,</span>&nbsp;<span class="string" id="6654852">&#34;com.&#34;</span><span class="op" id="6654858">,</span>&nbsp;<span class="ident" id="6654860">dnsTypeALL</span><span class="op" id="6654870">,</span>&nbsp;<span class="num" id="6654872">2</span><span class="op" id="6654873">,</span>&nbsp;<span class="ident" id="6654875">dnsRcodeSuccess</span><span class="op" id="6654890">}</span><span class="op" id="6654891">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6654894">{</span><span class="string" id="6654895">&#34;8.8.4.4:53&#34;</span><span class="op" id="6654907">,</span>&nbsp;<span class="string" id="6654909">&#34;com.&#34;</span><span class="op" id="6654915">,</span>&nbsp;<span class="ident" id="6654917">dnsTypeALL</span><span class="op" id="6654927">,</span>&nbsp;<span class="num" id="6654929">4</span><span class="op" id="6654930">,</span>&nbsp;<span class="ident" id="6654932">dnsRcodeSuccess</span><span class="op" id="6654947">}</span><span class="op" id="6654948">,</span><br>
<span class="lineno">30</span><span class="op" id="6654950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6654953">func</span>&nbsp;<span class="ident" id="6654958">TestDNSTransportFallback</span><span class="op" id="6654982">(</span><span class="ident" id="6654983">t</span>&nbsp;<span class="op" id="6654985">*</span><span class="ident" id="6654986">testing</span><span class="op" id="6654993">.</span><span class="ident" id="6654994">T</span><span class="op" id="6654995">)</span>&nbsp;<span class="op" id="6654997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655000">if</span>&nbsp;<span class="ident" id="6655003">testing</span><span class="op" id="6655010">.</span><span class="ident" id="6655011">Short</span><span class="op" id="6655016">(</span><span class="op" id="6655017">)</span>&nbsp;<span class="op" id="6655019">||</span>&nbsp;<span class="op" id="6655022">!</span><span class="op" id="6655023">*</span><span class="ident" id="6655024">testExternal</span>&nbsp;<span class="op" id="6655037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655041">t</span><span class="op" id="6655042">.</span><span class="ident" id="6655043">Skip</span><span class="op" id="6655047">(</span><span class="string" id="6655048">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6655089">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655096">for</span>&nbsp;<span class="ident" id="6655100">_</span><span class="op" id="6655101">,</span>&nbsp;<span class="ident" id="6655103">tt</span>&nbsp;<span class="op" id="6655106">:=</span>&nbsp;<span class="keyword" id="6655109">range</span>&nbsp;<span class="ident" id="6655115">dnsTransportFallbackTests</span>&nbsp;<span class="op" id="6655141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655145">timeout</span>&nbsp;<span class="op" id="6655153">:=</span>&nbsp;<span class="ident" id="6655156">time</span><span class="op" id="6655160">.</span><span class="ident" id="6655161">Duration</span><span class="op" id="6655169">(</span><span class="ident" id="6655170">tt</span><span class="op" id="6655172">.</span><span class="ident" id="6655173">timeout</span><span class="op" id="6655180">)</span>&nbsp;<span class="op" id="6655182">*</span>&nbsp;<span class="ident" id="6655184">time</span><span class="op" id="6655188">.</span><span class="ident" id="6655189">Second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655198">msg</span><span class="op" id="6655201">,</span>&nbsp;<span class="ident" id="6655203">err</span>&nbsp;<span class="op" id="6655207">:=</span>&nbsp;<span class="ident" id="6655210">exchange</span><span class="op" id="6655218">(</span><span class="ident" id="6655219">tt</span><span class="op" id="6655221">.</span><span class="ident" id="6655222">server</span><span class="op" id="6655228">,</span>&nbsp;<span class="ident" id="6655230">tt</span><span class="op" id="6655232">.</span><span class="ident" id="6655233">name</span><span class="op" id="6655237">,</span>&nbsp;<span class="ident" id="6655239">tt</span><span class="op" id="6655241">.</span><span class="ident" id="6655242">qtype</span><span class="op" id="6655247">,</span>&nbsp;<span class="ident" id="6655249">timeout</span><span class="op" id="6655256">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655260">if</span>&nbsp;<span class="ident" id="6655263">err</span>&nbsp;<span class="op" id="6655267">!=</span>&nbsp;<span class="builtintype" id="6655270">nil</span>&nbsp;<span class="op" id="6655274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655279">t</span><span class="op" id="6655280">.</span><span class="ident" id="6655281">Error</span><span class="op" id="6655286">(</span><span class="ident" id="6655287">err</span><span class="op" id="6655290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655295">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655310">switch</span>&nbsp;<span class="ident" id="6655317">msg</span><span class="op" id="6655320">.</span><span class="ident" id="6655321">rcode</span>&nbsp;<span class="op" id="6655327">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655331">case</span>&nbsp;<span class="ident" id="6655336">tt</span><span class="op" id="6655338">.</span><span class="ident" id="6655339">rcode</span><span class="op" id="6655344">,</span>&nbsp;<span class="ident" id="6655346">dnsRcodeServerFailure</span><span class="op" id="6655367">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655371">default</span><span class="op" id="6655378">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655383">t</span><span class="op" id="6655384">.</span><span class="ident" id="6655385">Errorf</span><span class="op" id="6655391">(</span><span class="string" id="6655392">&#34;got&nbsp;%v&nbsp;from&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6655417">,</span>&nbsp;<span class="ident" id="6655419">msg</span><span class="op" id="6655422">.</span><span class="ident" id="6655423">rcode</span><span class="op" id="6655428">,</span>&nbsp;<span class="ident" id="6655430">tt</span><span class="op" id="6655432">.</span><span class="ident" id="6655433">server</span><span class="op" id="6655439">,</span>&nbsp;<span class="ident" id="6655441">tt</span><span class="op" id="6655443">.</span><span class="ident" id="6655444">rcode</span><span class="op" id="6655449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6655454">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655465">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655468">}</span><br>
<span class="lineno"></span><span class="op" id="6655470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6655473">//&nbsp;See&nbsp;RFC&nbsp;6761&nbsp;for&nbsp;further&nbsp;information&nbsp;about&nbsp;the&nbsp;reserved,&nbsp;pseudo</span><br>
<span class="lineno"></span><span class="comment" id="6655540">//&nbsp;domain&nbsp;names.</span><br>
<span class="lineno">55</span><span class="keyword" id="6655557">var</span>&nbsp;<span class="ident" id="6655561">specialDomainNameTests</span>&nbsp;<span class="op" id="6655584">=</span>&nbsp;<span class="op" id="6655586">[</span><span class="op" id="6655587">]</span><span class="keyword" id="6655588">struct</span>&nbsp;<span class="op" id="6655595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655598">name</span>&nbsp;&nbsp;<span class="builtintype" id="6655604">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655612">qtype</span>&nbsp;<span class="builtintype" id="6655618">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6655626">rcode</span>&nbsp;<span class="builtintype" id="6655632">int</span><br>
<span class="lineno"></span><span class="op" id="6655636">}</span><span class="op" id="6655637">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6655640">//&nbsp;Name&nbsp;resoltion&nbsp;APIs&nbsp;and&nbsp;libraries&nbsp;should&nbsp;not&nbsp;recongnize&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6655704">//&nbsp;followings&nbsp;as&nbsp;special.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655731">{</span><span class="string" id="6655732">&#34;1.0.168.192.in-addr.arpa.&#34;</span><span class="op" id="6655759">,</span>&nbsp;<span class="ident" id="6655761">dnsTypePTR</span><span class="op" id="6655771">,</span>&nbsp;<span class="ident" id="6655773">dnsRcodeNameError</span><span class="op" id="6655790">}</span><span class="op" id="6655791">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655794">{</span><span class="string" id="6655795">&#34;test.&#34;</span><span class="op" id="6655802">,</span>&nbsp;<span class="ident" id="6655804">dnsTypeALL</span><span class="op" id="6655814">,</span>&nbsp;<span class="ident" id="6655816">dnsRcodeNameError</span><span class="op" id="6655833">}</span><span class="op" id="6655834">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6655837">{</span><span class="string" id="6655838">&#34;example.com.&#34;</span><span class="op" id="6655852">,</span>&nbsp;<span class="ident" id="6655854">dnsTypeALL</span><span class="op" id="6655864">,</span>&nbsp;<span class="ident" id="6655866">dnsRcodeSuccess</span><span class="op" id="6655881">}</span><span class="op" id="6655882">,</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6655886">//&nbsp;Name&nbsp;resoltion&nbsp;APIs&nbsp;and&nbsp;libraries&nbsp;should&nbsp;recongnize&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6655946">//&nbsp;followings&nbsp;as&nbsp;special&nbsp;and&nbsp;should&nbsp;not&nbsp;send&nbsp;any&nbsp;queries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6656005">//&nbsp;Though,&nbsp;we&nbsp;test&nbsp;those&nbsp;names&nbsp;here&nbsp;for&nbsp;verifying&nbsp;nagative</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6656065">//&nbsp;answers&nbsp;at&nbsp;DNS&nbsp;query-response&nbsp;interaction&nbsp;level.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656118">{</span><span class="string" id="6656119">&#34;localhost.&#34;</span><span class="op" id="6656131">,</span>&nbsp;<span class="ident" id="6656133">dnsTypeALL</span><span class="op" id="6656143">,</span>&nbsp;<span class="ident" id="6656145">dnsRcodeNameError</span><span class="op" id="6656162">}</span><span class="op" id="6656163">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656166">{</span><span class="string" id="6656167">&#34;invalid.&#34;</span><span class="op" id="6656177">,</span>&nbsp;<span class="ident" id="6656179">dnsTypeALL</span><span class="op" id="6656189">,</span>&nbsp;<span class="ident" id="6656191">dnsRcodeNameError</span><span class="op" id="6656208">}</span><span class="op" id="6656209">,</span><br>
<span class="lineno"></span><span class="op" id="6656211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6656214">func</span>&nbsp;<span class="ident" id="6656219">TestSpecialDomainName</span><span class="op" id="6656240">(</span><span class="ident" id="6656241">t</span>&nbsp;<span class="op" id="6656243">*</span><span class="ident" id="6656244">testing</span><span class="op" id="6656251">.</span><span class="ident" id="6656252">T</span><span class="op" id="6656253">)</span>&nbsp;<span class="op" id="6656255">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656258">if</span>&nbsp;<span class="ident" id="6656261">testing</span><span class="op" id="6656268">.</span><span class="ident" id="6656269">Short</span><span class="op" id="6656274">(</span><span class="op" id="6656275">)</span>&nbsp;<span class="op" id="6656277">||</span>&nbsp;<span class="op" id="6656280">!</span><span class="op" id="6656281">*</span><span class="ident" id="6656282">testExternal</span>&nbsp;<span class="op" id="6656295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656299">t</span><span class="op" id="6656300">.</span><span class="ident" id="6656301">Skip</span><span class="op" id="6656305">(</span><span class="string" id="6656306">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6656347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656354">server</span>&nbsp;<span class="op" id="6656361">:=</span>&nbsp;<span class="string" id="6656364">&#34;8.8.8.8:53&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656378">for</span>&nbsp;<span class="ident" id="6656382">_</span><span class="op" id="6656383">,</span>&nbsp;<span class="ident" id="6656385">tt</span>&nbsp;<span class="op" id="6656388">:=</span>&nbsp;<span class="keyword" id="6656391">range</span>&nbsp;<span class="ident" id="6656397">specialDomainNameTests</span>&nbsp;<span class="op" id="6656420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656424">msg</span><span class="op" id="6656427">,</span>&nbsp;<span class="ident" id="6656429">err</span>&nbsp;<span class="op" id="6656433">:=</span>&nbsp;<span class="ident" id="6656436">exchange</span><span class="op" id="6656444">(</span><span class="ident" id="6656445">server</span><span class="op" id="6656451">,</span>&nbsp;<span class="ident" id="6656453">tt</span><span class="op" id="6656455">.</span><span class="ident" id="6656456">name</span><span class="op" id="6656460">,</span>&nbsp;<span class="ident" id="6656462">tt</span><span class="op" id="6656464">.</span><span class="ident" id="6656465">qtype</span><span class="op" id="6656470">,</span>&nbsp;<span class="num" id="6656472">0</span><span class="op" id="6656473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656477">if</span>&nbsp;<span class="ident" id="6656480">err</span>&nbsp;<span class="op" id="6656484">!=</span>&nbsp;<span class="builtintype" id="6656487">nil</span>&nbsp;<span class="op" id="6656491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656496">t</span><span class="op" id="6656497">.</span><span class="ident" id="6656498">Error</span><span class="op" id="6656503">(</span><span class="ident" id="6656504">err</span><span class="op" id="6656507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656512">continue</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656527">switch</span>&nbsp;<span class="ident" id="6656534">msg</span><span class="op" id="6656537">.</span><span class="ident" id="6656538">rcode</span>&nbsp;<span class="op" id="6656544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656548">case</span>&nbsp;<span class="ident" id="6656553">tt</span><span class="op" id="6656555">.</span><span class="ident" id="6656556">rcode</span><span class="op" id="6656561">,</span>&nbsp;<span class="ident" id="6656563">dnsRcodeServerFailure</span><span class="op" id="6656584">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656588">default</span><span class="op" id="6656595">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656600">t</span><span class="op" id="6656601">.</span><span class="ident" id="6656602">Errorf</span><span class="op" id="6656608">(</span><span class="string" id="6656609">&#34;got&nbsp;%v&nbsp;from&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6656634">,</span>&nbsp;<span class="ident" id="6656636">msg</span><span class="op" id="6656639">.</span><span class="ident" id="6656640">rcode</span><span class="op" id="6656645">,</span>&nbsp;<span class="ident" id="6656647">server</span><span class="op" id="6656653">,</span>&nbsp;<span class="ident" id="6656655">tt</span><span class="op" id="6656657">.</span><span class="ident" id="6656658">rcode</span><span class="op" id="6656663">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656668">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656682">}</span><br>
<span class="lineno"></span><span class="op" id="6656684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6656687">type</span>&nbsp;<span class="ident" id="6656692">resolvConfTest</span>&nbsp;<span class="keyword" id="6656707">struct</span>&nbsp;<span class="op" id="6656714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656717">*</span><span class="ident" id="6656718">testing</span><span class="op" id="6656725">.</span><span class="ident" id="6656726">T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656729">dir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6656737">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656745">path</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6656753">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656761">started</span>&nbsp;<span class="builtintype" id="6656769">bool</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656775">quitc</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656783">chan</span>&nbsp;<span class="keyword" id="6656788">chan</span>&nbsp;<span class="keyword" id="6656793">struct</span><span class="op" id="6656799">{</span><span class="op" id="6656800">}</span><br>
<span class="lineno"></span><span class="op" id="6656802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6656805">func</span>&nbsp;<span class="ident" id="6656810">newResolvConfTest</span><span class="op" id="6656827">(</span><span class="ident" id="6656828">t</span>&nbsp;<span class="op" id="6656830">*</span><span class="ident" id="6656831">testing</span><span class="op" id="6656838">.</span><span class="ident" id="6656839">T</span><span class="op" id="6656840">)</span>&nbsp;<span class="op" id="6656842">*</span><span class="ident" id="6656843">resolvConfTest</span>&nbsp;<span class="op" id="6656858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656861">dir</span><span class="op" id="6656864">,</span>&nbsp;<span class="ident" id="6656866">err</span>&nbsp;<span class="op" id="6656870">:=</span>&nbsp;<span class="ident" id="6656873">ioutil</span><span class="op" id="6656879">.</span><span class="ident" id="6656880">TempDir</span><span class="op" id="6656887">(</span><span class="string" id="6656888">&#34;&#34;</span><span class="op" id="6656890">,</span>&nbsp;<span class="string" id="6656892">&#34;resolvConfTest&#34;</span><span class="op" id="6656908">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6656911">if</span>&nbsp;<span class="ident" id="6656914">err</span>&nbsp;<span class="op" id="6656918">!=</span>&nbsp;<span class="builtintype" id="6656921">nil</span>&nbsp;<span class="op" id="6656925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6656929">t</span><span class="op" id="6656930">.</span><span class="ident" id="6656931">Fatalf</span><span class="op" id="6656937">(</span><span class="string" id="6656938">&#34;could&nbsp;not&nbsp;create&nbsp;temp&nbsp;dir:&nbsp;%v&#34;</span><span class="op" id="6656969">,</span>&nbsp;<span class="ident" id="6656971">err</span><span class="op" id="6656974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6656977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6656981">//&nbsp;Disable&nbsp;the&nbsp;default&nbsp;loadConfig</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657016">onceLoadConfig</span><span class="op" id="6657030">.</span><span class="ident" id="6657031">Do</span><span class="op" id="6657033">(</span><span class="keyword" id="6657034">func</span><span class="op" id="6657038">(</span><span class="op" id="6657039">)</span>&nbsp;<span class="op" id="6657041">{</span><span class="op" id="6657042">}</span><span class="op" id="6657043">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657047">r</span>&nbsp;<span class="op" id="6657049">:=</span>&nbsp;<span class="op" id="6657052">&amp;</span><span class="ident" id="6657053">resolvConfTest</span><span class="op" id="6657067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657071">T</span><span class="op" id="6657072">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657078">t</span><span class="op" id="6657079">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657083">dir</span><span class="op" id="6657086">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6657090">dir</span><span class="op" id="6657093">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657097">path</span><span class="op" id="6657101">:</span>&nbsp;&nbsp;<span class="ident" id="6657104">path</span><span class="op" id="6657108">.</span><span class="ident" id="6657109">Join</span><span class="op" id="6657113">(</span><span class="ident" id="6657114">dir</span><span class="op" id="6657117">,</span>&nbsp;<span class="string" id="6657119">&#34;resolv.conf&#34;</span><span class="op" id="6657132">)</span><span class="op" id="6657133">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657137">quitc</span><span class="op" id="6657142">:</span>&nbsp;<span class="builtinfunc" id="6657144">make</span><span class="op" id="6657148">(</span><span class="keyword" id="6657149">chan</span>&nbsp;<span class="keyword" id="6657154">chan</span>&nbsp;<span class="keyword" id="6657159">struct</span><span class="op" id="6657165">{</span><span class="op" id="6657166">}</span><span class="op" id="6657167">)</span><span class="op" id="6657168">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6657171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657175">return</span>&nbsp;<span class="ident" id="6657182">r</span><br>
<span class="lineno">120</span><span class="op" id="6657184">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6657187">func</span>&nbsp;<span class="op" id="6657192">(</span><span class="ident" id="6657193">r</span>&nbsp;<span class="op" id="6657195">*</span><span class="ident" id="6657196">resolvConfTest</span><span class="op" id="6657210">)</span>&nbsp;<span class="ident" id="6657212">Start</span><span class="op" id="6657217">(</span><span class="op" id="6657218">)</span>&nbsp;<span class="op" id="6657220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657223">loadConfig</span><span class="op" id="6657233">(</span><span class="ident" id="6657234">r</span><span class="op" id="6657235">.</span><span class="ident" id="6657236">path</span><span class="op" id="6657240">,</span>&nbsp;<span class="num" id="6657242">100</span><span class="op" id="6657245">*</span><span class="ident" id="6657246">time</span><span class="op" id="6657250">.</span><span class="ident" id="6657251">Millisecond</span><span class="op" id="6657262">,</span>&nbsp;<span class="ident" id="6657264">r</span><span class="op" id="6657265">.</span><span class="ident" id="6657266">quitc</span><span class="op" id="6657271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657274">r</span><span class="op" id="6657275">.</span><span class="ident" id="6657276">started</span>&nbsp;<span class="op" id="6657284">=</span>&nbsp;<span class="builtintype" id="6657286">true</span><br>
<span class="lineno">125</span><span class="op" id="6657291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6657294">func</span>&nbsp;<span class="op" id="6657299">(</span><span class="ident" id="6657300">r</span>&nbsp;<span class="op" id="6657302">*</span><span class="ident" id="6657303">resolvConfTest</span><span class="op" id="6657317">)</span>&nbsp;<span class="ident" id="6657319">SetConf</span><span class="op" id="6657326">(</span><span class="ident" id="6657327">s</span>&nbsp;<span class="builtintype" id="6657329">string</span><span class="op" id="6657335">)</span>&nbsp;<span class="op" id="6657337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6657340">//&nbsp;Make&nbsp;sure&nbsp;the&nbsp;file&nbsp;mtime&nbsp;will&nbsp;be&nbsp;different&nbsp;once&nbsp;we&#39;re&nbsp;done&nbsp;here,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6657409">//&nbsp;even&nbsp;on&nbsp;systems&nbsp;with&nbsp;coarse&nbsp;(1s)&nbsp;mtime&nbsp;resolution.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657464">time</span><span class="op" id="6657468">.</span><span class="ident" id="6657469">Sleep</span><span class="op" id="6657474">(</span><span class="ident" id="6657475">time</span><span class="op" id="6657479">.</span><span class="ident" id="6657480">Second</span><span class="op" id="6657486">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657490">f</span><span class="op" id="6657491">,</span>&nbsp;<span class="ident" id="6657493">err</span>&nbsp;<span class="op" id="6657497">:=</span>&nbsp;<span class="ident" id="6657500">os</span><span class="op" id="6657502">.</span><span class="ident" id="6657503">OpenFile</span><span class="op" id="6657511">(</span><span class="ident" id="6657512">r</span><span class="op" id="6657513">.</span><span class="ident" id="6657514">path</span><span class="op" id="6657518">,</span>&nbsp;<span class="ident" id="6657520">os</span><span class="op" id="6657522">.</span><span class="ident" id="6657523">O_CREATE</span><span class="op" id="6657531">|</span><span class="ident" id="6657532">os</span><span class="op" id="6657534">.</span><span class="ident" id="6657535">O_TRUNC</span><span class="op" id="6657542">|</span><span class="ident" id="6657543">os</span><span class="op" id="6657545">.</span><span class="ident" id="6657546">O_WRONLY</span><span class="op" id="6657554">,</span>&nbsp;<span class="num" id="6657556">0600</span><span class="op" id="6657560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657563">if</span>&nbsp;<span class="ident" id="6657566">err</span>&nbsp;<span class="op" id="6657570">!=</span>&nbsp;<span class="builtintype" id="6657573">nil</span>&nbsp;<span class="op" id="6657577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657581">r</span><span class="op" id="6657582">.</span><span class="ident" id="6657583">Fatalf</span><span class="op" id="6657589">(</span><span class="string" id="6657590">&#34;failed&nbsp;to&nbsp;create&nbsp;temp&nbsp;file&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="6657625">,</span>&nbsp;<span class="ident" id="6657627">r</span><span class="op" id="6657628">.</span><span class="ident" id="6657629">path</span><span class="op" id="6657633">,</span>&nbsp;<span class="ident" id="6657635">err</span><span class="op" id="6657638">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6657641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657644">if</span>&nbsp;<span class="ident" id="6657647">_</span><span class="op" id="6657648">,</span>&nbsp;<span class="ident" id="6657650">err</span>&nbsp;<span class="op" id="6657654">:=</span>&nbsp;<span class="ident" id="6657657">io</span><span class="op" id="6657659">.</span><span class="ident" id="6657660">WriteString</span><span class="op" id="6657671">(</span><span class="ident" id="6657672">f</span><span class="op" id="6657673">,</span>&nbsp;<span class="ident" id="6657675">s</span><span class="op" id="6657676">)</span><span class="op" id="6657677">;</span>&nbsp;<span class="ident" id="6657679">err</span>&nbsp;<span class="op" id="6657683">!=</span>&nbsp;<span class="builtintype" id="6657686">nil</span>&nbsp;<span class="op" id="6657690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657694">f</span><span class="op" id="6657695">.</span><span class="ident" id="6657696">Close</span><span class="op" id="6657701">(</span><span class="op" id="6657702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657706">r</span><span class="op" id="6657707">.</span><span class="ident" id="6657708">Fatalf</span><span class="op" id="6657714">(</span><span class="string" id="6657715">&#34;failed&nbsp;to&nbsp;write&nbsp;temp&nbsp;file:&nbsp;%v&#34;</span><span class="op" id="6657746">,</span>&nbsp;<span class="ident" id="6657748">err</span><span class="op" id="6657751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6657754">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657757">f</span><span class="op" id="6657758">.</span><span class="ident" id="6657759">Close</span><span class="op" id="6657764">(</span><span class="op" id="6657765">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6657769">if</span>&nbsp;<span class="ident" id="6657772">r</span><span class="op" id="6657773">.</span><span class="ident" id="6657774">started</span>&nbsp;<span class="op" id="6657782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657786">cfg</span><span class="op" id="6657789">.</span><span class="ident" id="6657790">ch</span>&nbsp;<span class="op" id="6657793">&lt;-</span>&nbsp;<span class="keyword" id="6657796">struct</span><span class="op" id="6657802">{</span><span class="op" id="6657803">}</span><span class="op" id="6657804">{</span><span class="op" id="6657805">}</span>&nbsp;<span class="comment" id="6657807">//&nbsp;fill&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657824">cfg</span><span class="op" id="6657827">.</span><span class="ident" id="6657828">ch</span>&nbsp;<span class="op" id="6657831">&lt;-</span>&nbsp;<span class="keyword" id="6657834">struct</span><span class="op" id="6657840">{</span><span class="op" id="6657841">}</span><span class="op" id="6657842">{</span><span class="op" id="6657843">}</span>&nbsp;<span class="comment" id="6657845">//&nbsp;wait&nbsp;for&nbsp;reload&nbsp;to&nbsp;begin</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657875">cfg</span><span class="op" id="6657878">.</span><span class="ident" id="6657879">ch</span>&nbsp;<span class="op" id="6657882">&lt;-</span>&nbsp;<span class="keyword" id="6657885">struct</span><span class="op" id="6657891">{</span><span class="op" id="6657892">}</span><span class="op" id="6657893">{</span><span class="op" id="6657894">}</span>&nbsp;<span class="comment" id="6657896">//&nbsp;wait&nbsp;for&nbsp;reload&nbsp;to&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6657928">}</span><br>
<span class="lineno"></span><span class="op" id="6657930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6657933">func</span>&nbsp;<span class="op" id="6657938">(</span><span class="ident" id="6657939">r</span>&nbsp;<span class="op" id="6657941">*</span><span class="ident" id="6657942">resolvConfTest</span><span class="op" id="6657956">)</span>&nbsp;<span class="ident" id="6657958">WantServers</span><span class="op" id="6657969">(</span><span class="ident" id="6657970">want</span>&nbsp;<span class="op" id="6657975">[</span><span class="op" id="6657976">]</span><span class="builtintype" id="6657977">string</span><span class="op" id="6657983">)</span>&nbsp;<span class="op" id="6657985">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6657988">cfg</span><span class="op" id="6657991">.</span><span class="ident" id="6657992">mu</span><span class="op" id="6657994">.</span><span class="ident" id="6657995">RLock</span><span class="op" id="6658000">(</span><span class="op" id="6658001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6658004">defer</span>&nbsp;<span class="ident" id="6658010">cfg</span><span class="op" id="6658013">.</span><span class="ident" id="6658014">mu</span><span class="op" id="6658016">.</span><span class="ident" id="6658017">RUnlock</span><span class="op" id="6658024">(</span><span class="op" id="6658025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6658028">if</span>&nbsp;<span class="ident" id="6658031">got</span>&nbsp;<span class="op" id="6658035">:=</span>&nbsp;<span class="ident" id="6658038">cfg</span><span class="op" id="6658041">.</span><span class="ident" id="6658042">dnsConfig</span><span class="op" id="6658051">.</span><span class="ident" id="6658052">servers</span><span class="op" id="6658059">;</span>&nbsp;<span class="op" id="6658061">!</span><span class="ident" id="6658062">reflect</span><span class="op" id="6658069">.</span><span class="ident" id="6658070">DeepEqual</span><span class="op" id="6658079">(</span><span class="ident" id="6658080">got</span><span class="op" id="6658083">,</span>&nbsp;<span class="ident" id="6658085">want</span><span class="op" id="6658089">)</span>&nbsp;<span class="op" id="6658091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658095">r</span><span class="op" id="6658096">.</span><span class="ident" id="6658097">Fatalf</span><span class="op" id="6658103">(</span><span class="string" id="6658104">&#34;Unexpected&nbsp;dns&nbsp;server&nbsp;loaded,&nbsp;got&nbsp;%v&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6658150">,</span>&nbsp;<span class="ident" id="6658152">got</span><span class="op" id="6658155">,</span>&nbsp;<span class="ident" id="6658157">want</span><span class="op" id="6658161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6658164">}</span><br>
<span class="lineno">155</span><span class="op" id="6658166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6658169">func</span>&nbsp;<span class="op" id="6658174">(</span><span class="ident" id="6658175">r</span>&nbsp;<span class="op" id="6658177">*</span><span class="ident" id="6658178">resolvConfTest</span><span class="op" id="6658192">)</span>&nbsp;<span class="ident" id="6658194">Close</span><span class="op" id="6658199">(</span><span class="op" id="6658200">)</span>&nbsp;<span class="op" id="6658202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658205">resp</span>&nbsp;<span class="op" id="6658210">:=</span>&nbsp;<span class="builtinfunc" id="6658213">make</span><span class="op" id="6658217">(</span><span class="keyword" id="6658218">chan</span>&nbsp;<span class="keyword" id="6658223">struct</span><span class="op" id="6658229">{</span><span class="op" id="6658230">}</span><span class="op" id="6658231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658234">r</span><span class="op" id="6658235">.</span><span class="ident" id="6658236">quitc</span>&nbsp;<span class="op" id="6658242">&lt;-</span>&nbsp;<span class="ident" id="6658245">resp</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6658251">&lt;-</span><span class="ident" id="6658253">resp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6658259">if</span>&nbsp;<span class="ident" id="6658262">err</span>&nbsp;<span class="op" id="6658266">:=</span>&nbsp;<span class="ident" id="6658269">os</span><span class="op" id="6658271">.</span><span class="ident" id="6658272">RemoveAll</span><span class="op" id="6658281">(</span><span class="ident" id="6658282">r</span><span class="op" id="6658283">.</span><span class="ident" id="6658284">dir</span><span class="op" id="6658287">)</span><span class="op" id="6658288">;</span>&nbsp;<span class="ident" id="6658290">err</span>&nbsp;<span class="op" id="6658294">!=</span>&nbsp;<span class="builtintype" id="6658297">nil</span>&nbsp;<span class="op" id="6658301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658305">r</span><span class="op" id="6658306">.</span><span class="ident" id="6658307">Logf</span><span class="op" id="6658311">(</span><span class="string" id="6658312">&#34;failed&nbsp;to&nbsp;remove&nbsp;temp&nbsp;dir&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="6658346">,</span>&nbsp;<span class="ident" id="6658348">r</span><span class="op" id="6658349">.</span><span class="ident" id="6658350">dir</span><span class="op" id="6658353">,</span>&nbsp;<span class="ident" id="6658355">err</span><span class="op" id="6658358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6658361">}</span><br>
<span class="lineno"></span><span class="op" id="6658363">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="6658366">func</span>&nbsp;<span class="ident" id="6658371">TestReloadResolvConfFail</span><span class="op" id="6658395">(</span><span class="ident" id="6658396">t</span>&nbsp;<span class="op" id="6658398">*</span><span class="ident" id="6658399">testing</span><span class="op" id="6658406">.</span><span class="ident" id="6658407">T</span><span class="op" id="6658408">)</span>&nbsp;<span class="op" id="6658410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6658413">if</span>&nbsp;<span class="ident" id="6658416">testing</span><span class="op" id="6658423">.</span><span class="ident" id="6658424">Short</span><span class="op" id="6658429">(</span><span class="op" id="6658430">)</span>&nbsp;<span class="op" id="6658432">||</span>&nbsp;<span class="op" id="6658435">!</span><span class="op" id="6658436">*</span><span class="ident" id="6658437">testExternal</span>&nbsp;<span class="op" id="6658450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658454">t</span><span class="op" id="6658455">.</span><span class="ident" id="6658456">Skip</span><span class="op" id="6658460">(</span><span class="string" id="6658461">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6658502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6658505">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658509">r</span>&nbsp;<span class="op" id="6658511">:=</span>&nbsp;<span class="ident" id="6658514">newResolvConfTest</span><span class="op" id="6658531">(</span><span class="ident" id="6658532">t</span><span class="op" id="6658533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6658536">defer</span>&nbsp;<span class="ident" id="6658542">r</span><span class="op" id="6658543">.</span><span class="ident" id="6658544">Close</span><span class="op" id="6658549">(</span><span class="op" id="6658550">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6658554">//&nbsp;resolv.conf.tmp&nbsp;does&nbsp;not&nbsp;exist&nbsp;yet</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658593">r</span><span class="op" id="6658594">.</span><span class="ident" id="6658595">Start</span><span class="op" id="6658600">(</span><span class="op" id="6658601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6658604">if</span>&nbsp;<span class="ident" id="6658607">_</span><span class="op" id="6658608">,</span>&nbsp;<span class="ident" id="6658610">err</span>&nbsp;<span class="op" id="6658614">:=</span>&nbsp;<span class="ident" id="6658617">goLookupIP</span><span class="op" id="6658627">(</span><span class="string" id="6658628">&#34;golang.org&#34;</span><span class="op" id="6658640">)</span><span class="op" id="6658641">;</span>&nbsp;<span class="ident" id="6658643">err</span>&nbsp;<span class="op" id="6658647">==</span>&nbsp;<span class="builtintype" id="6658650">nil</span>&nbsp;<span class="op" id="6658654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658658">t</span><span class="op" id="6658659">.</span><span class="ident" id="6658660">Fatal</span><span class="op" id="6658665">(</span><span class="string" id="6658666">&#34;goLookupIP(missing)&nbsp;succeeded&#34;</span><span class="op" id="6658697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6658700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658704">r</span><span class="op" id="6658705">.</span><span class="ident" id="6658706">SetConf</span><span class="op" id="6658713">(</span><span class="string" id="6658714">&#34;nameserver&nbsp;8.8.8.8&#34;</span><span class="op" id="6658734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6658737">if</span>&nbsp;<span class="ident" id="6658740">_</span><span class="op" id="6658741">,</span>&nbsp;<span class="ident" id="6658743">err</span>&nbsp;<span class="op" id="6658747">:=</span>&nbsp;<span class="ident" id="6658750">goLookupIP</span><span class="op" id="6658760">(</span><span class="string" id="6658761">&#34;golang.org&#34;</span><span class="op" id="6658773">)</span><span class="op" id="6658774">;</span>&nbsp;<span class="ident" id="6658776">err</span>&nbsp;<span class="op" id="6658780">!=</span>&nbsp;<span class="builtintype" id="6658783">nil</span>&nbsp;<span class="op" id="6658787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658791">t</span><span class="op" id="6658792">.</span><span class="ident" id="6658793">Fatalf</span><span class="op" id="6658799">(</span><span class="string" id="6658800">&#34;goLookupIP(missing;&nbsp;good)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6658838">,</span>&nbsp;<span class="ident" id="6658840">err</span><span class="op" id="6658843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6658846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6658850">//&nbsp;Using&nbsp;a&nbsp;bad&nbsp;resolv.conf&nbsp;while&nbsp;we&nbsp;had&nbsp;a&nbsp;good</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6658898">//&nbsp;one&nbsp;before&nbsp;should&nbsp;not&nbsp;update&nbsp;the&nbsp;config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6658942">r</span><span class="op" id="6658943">.</span><span class="ident" id="6658944">SetConf</span><span class="op" id="6658951">(</span><span class="string" id="6658952">&#34;&#34;</span><span class="op" id="6658954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6658957">if</span>&nbsp;<span class="ident" id="6658960">_</span><span class="op" id="6658961">,</span>&nbsp;<span class="ident" id="6658963">err</span>&nbsp;<span class="op" id="6658967">:=</span>&nbsp;<span class="ident" id="6658970">goLookupIP</span><span class="op" id="6658980">(</span><span class="string" id="6658981">&#34;golang.org&#34;</span><span class="op" id="6658993">)</span><span class="op" id="6658994">;</span>&nbsp;<span class="ident" id="6658996">err</span>&nbsp;<span class="op" id="6659000">!=</span>&nbsp;<span class="builtintype" id="6659003">nil</span>&nbsp;<span class="op" id="6659007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659011">t</span><span class="op" id="6659012">.</span><span class="ident" id="6659013">Fatalf</span><span class="op" id="6659019">(</span><span class="string" id="6659020">&#34;goLookupIP(missing;&nbsp;good;&nbsp;bad)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6659063">,</span>&nbsp;<span class="ident" id="6659065">err</span><span class="op" id="6659068">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6659071">}</span><br>
<span class="lineno"></span><span class="op" id="6659073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6659076">func</span>&nbsp;<span class="ident" id="6659081">TestReloadResolvConfChange</span><span class="op" id="6659107">(</span><span class="ident" id="6659108">t</span>&nbsp;<span class="op" id="6659110">*</span><span class="ident" id="6659111">testing</span><span class="op" id="6659118">.</span><span class="ident" id="6659119">T</span><span class="op" id="6659120">)</span>&nbsp;<span class="op" id="6659122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6659125">if</span>&nbsp;<span class="ident" id="6659128">testing</span><span class="op" id="6659135">.</span><span class="ident" id="6659136">Short</span><span class="op" id="6659141">(</span><span class="op" id="6659142">)</span>&nbsp;<span class="op" id="6659144">||</span>&nbsp;<span class="op" id="6659147">!</span><span class="op" id="6659148">*</span><span class="ident" id="6659149">testExternal</span>&nbsp;<span class="op" id="6659162">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659166">t</span><span class="op" id="6659167">.</span><span class="ident" id="6659168">Skip</span><span class="op" id="6659172">(</span><span class="string" id="6659173">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="6659214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6659217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659221">r</span>&nbsp;<span class="op" id="6659223">:=</span>&nbsp;<span class="ident" id="6659226">newResolvConfTest</span><span class="op" id="6659243">(</span><span class="ident" id="6659244">t</span><span class="op" id="6659245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6659248">defer</span>&nbsp;<span class="ident" id="6659254">r</span><span class="op" id="6659255">.</span><span class="ident" id="6659256">Close</span><span class="op" id="6659261">(</span><span class="op" id="6659262">)</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659266">r</span><span class="op" id="6659267">.</span><span class="ident" id="6659268">SetConf</span><span class="op" id="6659275">(</span><span class="string" id="6659276">&#34;nameserver&nbsp;8.8.8.8&#34;</span><span class="op" id="6659296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659299">r</span><span class="op" id="6659300">.</span><span class="ident" id="6659301">Start</span><span class="op" id="6659306">(</span><span class="op" id="6659307">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6659311">if</span>&nbsp;<span class="ident" id="6659314">_</span><span class="op" id="6659315">,</span>&nbsp;<span class="ident" id="6659317">err</span>&nbsp;<span class="op" id="6659321">:=</span>&nbsp;<span class="ident" id="6659324">goLookupIP</span><span class="op" id="6659334">(</span><span class="string" id="6659335">&#34;golang.org&#34;</span><span class="op" id="6659347">)</span><span class="op" id="6659348">;</span>&nbsp;<span class="ident" id="6659350">err</span>&nbsp;<span class="op" id="6659354">!=</span>&nbsp;<span class="builtintype" id="6659357">nil</span>&nbsp;<span class="op" id="6659361">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659365">t</span><span class="op" id="6659366">.</span><span class="ident" id="6659367">Fatalf</span><span class="op" id="6659373">(</span><span class="string" id="6659374">&#34;goLookupIP(good)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6659403">,</span>&nbsp;<span class="ident" id="6659405">err</span><span class="op" id="6659408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6659411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659414">r</span><span class="op" id="6659415">.</span><span class="ident" id="6659416">WantServers</span><span class="op" id="6659427">(</span><span class="op" id="6659428">[</span><span class="op" id="6659429">]</span><span class="builtintype" id="6659430">string</span><span class="op" id="6659436">{</span><span class="string" id="6659437">&#34;8.8.8.8&#34;</span><span class="op" id="6659446">}</span><span class="op" id="6659447">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6659451">//&nbsp;Using&nbsp;a&nbsp;bad&nbsp;resolv.conf&nbsp;when&nbsp;we&nbsp;had&nbsp;a&nbsp;good&nbsp;one</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6659502">//&nbsp;before&nbsp;should&nbsp;not&nbsp;update&nbsp;the&nbsp;config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659542">r</span><span class="op" id="6659543">.</span><span class="ident" id="6659544">SetConf</span><span class="op" id="6659551">(</span><span class="string" id="6659552">&#34;&#34;</span><span class="op" id="6659554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6659557">if</span>&nbsp;<span class="ident" id="6659560">_</span><span class="op" id="6659561">,</span>&nbsp;<span class="ident" id="6659563">err</span>&nbsp;<span class="op" id="6659567">:=</span>&nbsp;<span class="ident" id="6659570">goLookupIP</span><span class="op" id="6659580">(</span><span class="string" id="6659581">&#34;golang.org&#34;</span><span class="op" id="6659593">)</span><span class="op" id="6659594">;</span>&nbsp;<span class="ident" id="6659596">err</span>&nbsp;<span class="op" id="6659600">!=</span>&nbsp;<span class="builtintype" id="6659603">nil</span>&nbsp;<span class="op" id="6659607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659611">t</span><span class="op" id="6659612">.</span><span class="ident" id="6659613">Fatalf</span><span class="op" id="6659619">(</span><span class="string" id="6659620">&#34;goLookupIP(good;&nbsp;bad)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6659654">,</span>&nbsp;<span class="ident" id="6659656">err</span><span class="op" id="6659659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6659662">}</span><br>
<span class="lineno">215</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6659666">//&nbsp;A&nbsp;new&nbsp;good&nbsp;config&nbsp;should&nbsp;get&nbsp;picked&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659709">r</span><span class="op" id="6659710">.</span><span class="ident" id="6659711">SetConf</span><span class="op" id="6659718">(</span><span class="string" id="6659719">&#34;nameserver&nbsp;8.8.4.4&#34;</span><span class="op" id="6659739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659742">r</span><span class="op" id="6659743">.</span><span class="ident" id="6659744">WantServers</span><span class="op" id="6659755">(</span><span class="op" id="6659756">[</span><span class="op" id="6659757">]</span><span class="builtintype" id="6659758">string</span><span class="op" id="6659764">{</span><span class="string" id="6659765">&#34;8.8.4.4&#34;</span><span class="op" id="6659774">}</span><span class="op" id="6659775">)</span><br>
<span class="lineno"></span><span class="op" id="6659777">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="keyword" id="6659780">func</span>&nbsp;<span class="ident" id="6659785">BenchmarkGoLookupIP</span><span class="op" id="6659804">(</span><span class="ident" id="6659805">b</span>&nbsp;<span class="op" id="6659807">*</span><span class="ident" id="6659808">testing</span><span class="op" id="6659815">.</span><span class="ident" id="6659816">B</span><span class="op" id="6659817">)</span>&nbsp;<span class="op" id="6659819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6659822">for</span>&nbsp;<span class="ident" id="6659826">i</span>&nbsp;<span class="op" id="6659828">:=</span>&nbsp;<span class="num" id="6659831">0</span><span class="op" id="6659832">;</span>&nbsp;<span class="ident" id="6659834">i</span>&nbsp;<span class="op" id="6659836">&lt;</span>&nbsp;<span class="ident" id="6659838">b</span><span class="op" id="6659839">.</span><span class="ident" id="6659840">N</span><span class="op" id="6659841">;</span>&nbsp;<span class="ident" id="6659843">i</span><span class="op" id="6659844">++</span>&nbsp;<span class="op" id="6659847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659851">goLookupIP</span><span class="op" id="6659861">(</span><span class="string" id="6659862">&#34;www.example.com&#34;</span><span class="op" id="6659879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6659882">}</span><br>
<span class="lineno">225</span><span class="op" id="6659884">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6659887">func</span>&nbsp;<span class="ident" id="6659892">BenchmarkGoLookupIPNoSuchHost</span><span class="op" id="6659921">(</span><span class="ident" id="6659922">b</span>&nbsp;<span class="op" id="6659924">*</span><span class="ident" id="6659925">testing</span><span class="op" id="6659932">.</span><span class="ident" id="6659933">B</span><span class="op" id="6659934">)</span>&nbsp;<span class="op" id="6659936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6659939">for</span>&nbsp;<span class="ident" id="6659943">i</span>&nbsp;<span class="op" id="6659945">:=</span>&nbsp;<span class="num" id="6659948">0</span><span class="op" id="6659949">;</span>&nbsp;<span class="ident" id="6659951">i</span>&nbsp;<span class="op" id="6659953">&lt;</span>&nbsp;<span class="ident" id="6659955">b</span><span class="op" id="6659956">.</span><span class="ident" id="6659957">N</span><span class="op" id="6659958">;</span>&nbsp;<span class="ident" id="6659960">i</span><span class="op" id="6659961">++</span>&nbsp;<span class="op" id="6659964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6659968">goLookupIP</span><span class="op" id="6659978">(</span><span class="string" id="6659979">&#34;some.nonexistent&#34;</span><span class="op" id="6659997">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6660000">}</span><br>
<span class="lineno"></span><span class="op" id="6660002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6660005">func</span>&nbsp;<span class="ident" id="6660010">BenchmarkGoLookupIPWithBrokenNameServer</span><span class="op" id="6660049">(</span><span class="ident" id="6660050">b</span>&nbsp;<span class="op" id="6660052">*</span><span class="ident" id="6660053">testing</span><span class="op" id="6660060">.</span><span class="ident" id="6660061">B</span><span class="op" id="6660062">)</span>&nbsp;<span class="op" id="6660064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6660067">onceLoadConfig</span><span class="op" id="6660081">.</span><span class="ident" id="6660082">Do</span><span class="op" id="6660084">(</span><span class="ident" id="6660085">loadDefaultConfig</span><span class="op" id="6660102">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6660105">if</span>&nbsp;<span class="ident" id="6660108">cfg</span><span class="op" id="6660111">.</span><span class="ident" id="6660112">dnserr</span>&nbsp;<span class="op" id="6660119">!=</span>&nbsp;<span class="builtintype" id="6660122">nil</span>&nbsp;<span class="op" id="6660126">||</span>&nbsp;<span class="ident" id="6660129">cfg</span><span class="op" id="6660132">.</span><span class="ident" id="6660133">dnsConfig</span>&nbsp;<span class="op" id="6660143">==</span>&nbsp;<span class="builtintype" id="6660146">nil</span>&nbsp;<span class="op" id="6660150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6660154">b</span><span class="op" id="6660155">.</span><span class="ident" id="6660156">Fatalf</span><span class="op" id="6660162">(</span><span class="string" id="6660163">&#34;loadConfig&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6660186">,</span>&nbsp;<span class="ident" id="6660188">cfg</span><span class="op" id="6660191">.</span><span class="ident" id="6660192">dnserr</span><span class="op" id="6660198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6660201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6660204">//&nbsp;This&nbsp;looks&nbsp;ugly&nbsp;but&nbsp;it&#39;s&nbsp;safe&nbsp;as&nbsp;long&nbsp;as&nbsp;benchmarks&nbsp;are&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6660268">//&nbsp;sequentially&nbsp;in&nbsp;package&nbsp;testing.</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6660305">orig</span>&nbsp;<span class="op" id="6660310">:=</span>&nbsp;<span class="ident" id="6660313">cfg</span><span class="op" id="6660316">.</span><span class="ident" id="6660317">dnsConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6660328">cfg</span><span class="op" id="6660331">.</span><span class="ident" id="6660332">dnsConfig</span><span class="op" id="6660341">.</span><span class="ident" id="6660342">servers</span>&nbsp;<span class="op" id="6660350">=</span>&nbsp;<span class="builtinfunc" id="6660352">append</span><span class="op" id="6660358">(</span><span class="op" id="6660359">[</span><span class="op" id="6660360">]</span><span class="builtintype" id="6660361">string</span><span class="op" id="6660367">{</span><span class="string" id="6660368">&#34;203.0.113.254&#34;</span><span class="op" id="6660383">}</span><span class="op" id="6660384">,</span>&nbsp;<span class="ident" id="6660386">cfg</span><span class="op" id="6660389">.</span><span class="ident" id="6660390">dnsConfig</span><span class="op" id="6660399">.</span><span class="ident" id="6660400">servers</span><span class="op" id="6660407">...</span><span class="op" id="6660410">)</span>&nbsp;<span class="comment" id="6660412">//&nbsp;use&nbsp;TEST-NET-3&nbsp;block,&nbsp;see&nbsp;RFC&nbsp;5737</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6660451">for</span>&nbsp;<span class="ident" id="6660455">i</span>&nbsp;<span class="op" id="6660457">:=</span>&nbsp;<span class="num" id="6660460">0</span><span class="op" id="6660461">;</span>&nbsp;<span class="ident" id="6660463">i</span>&nbsp;<span class="op" id="6660465">&lt;</span>&nbsp;<span class="ident" id="6660467">b</span><span class="op" id="6660468">.</span><span class="ident" id="6660469">N</span><span class="op" id="6660470">;</span>&nbsp;<span class="ident" id="6660472">i</span><span class="op" id="6660473">++</span>&nbsp;<span class="op" id="6660476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6660480">goLookupIP</span><span class="op" id="6660490">(</span><span class="string" id="6660491">&#34;www.example.com&#34;</span><span class="op" id="6660508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6660511">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6660514">cfg</span><span class="op" id="6660517">.</span><span class="ident" id="6660518">dnsConfig</span>&nbsp;<span class="op" id="6660528">=</span>&nbsp;<span class="ident" id="6660530">orig</span><br>
<span class="lineno"></span><span class="op" id="6660535">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
