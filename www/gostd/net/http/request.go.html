<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4877216">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4877271">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4877325">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4877376">//&nbsp;HTTP&nbsp;Request&nbsp;reading&nbsp;and&nbsp;parsing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4877414">package</span>&nbsp;<span class="ident" id="4877422">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4877428">import</span>&nbsp;<span class="op" id="4877435">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4877438">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4877447">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4877456">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4877470">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4877489">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4877499">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4877506">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4877512">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4877525">&#34;mime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4877533">&#34;mime/multipart&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4877551">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4877568">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4877579">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4877590">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4877601">&#34;sync&#34;</span><br>
<span class="lineno">25</span><span class="op" id="4877608">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4877611">const</span>&nbsp;<span class="op" id="4877617">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877620">maxValueLength</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4877637">=</span>&nbsp;<span class="num" id="4877639">4096</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877645">maxHeaderLines</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4877662">=</span>&nbsp;<span class="num" id="4877664">1024</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877670">chunkSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4877687">=</span>&nbsp;<span class="num" id="4877689">4</span>&nbsp;<span class="op" id="4877691">&lt;&lt;</span>&nbsp;<span class="num" id="4877694">10</span>&nbsp;&nbsp;<span class="comment" id="4877698">//&nbsp;4&nbsp;KB&nbsp;chunks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4877714">defaultMaxMemory</span>&nbsp;<span class="op" id="4877731">=</span>&nbsp;<span class="num" id="4877733">32</span>&nbsp;<span class="op" id="4877736">&lt;&lt;</span>&nbsp;<span class="num" id="4877739">20</span>&nbsp;<span class="comment" id="4877742">//&nbsp;32&nbsp;MB</span><br>
<span class="lineno"></span><span class="op" id="4877751">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4877754">//&nbsp;ErrMissingFile&nbsp;is&nbsp;returned&nbsp;by&nbsp;FormFile&nbsp;when&nbsp;the&nbsp;provided&nbsp;file&nbsp;field&nbsp;name</span><br>
<span class="lineno">35</span><span class="comment" id="4877830">//&nbsp;is&nbsp;either&nbsp;not&nbsp;present&nbsp;in&nbsp;the&nbsp;request&nbsp;or&nbsp;not&nbsp;a&nbsp;file&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="4877891">var</span>&nbsp;<span class="ident" id="4877895">ErrMissingFile</span>&nbsp;<span class="op" id="4877910">=</span>&nbsp;<span class="ident" id="4877912">errors</span><span class="op" id="4877918">.</span><span class="ident" id="4877919">New</span><span class="op" id="4877922">(</span><span class="string" id="4877923">&#34;http:&nbsp;no&nbsp;such&nbsp;file&#34;</span><span class="op" id="4877943">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4877946">//&nbsp;HTTP&nbsp;request&nbsp;parsing&nbsp;errors.</span><br>
<span class="lineno"></span><span class="keyword" id="4877978">type</span>&nbsp;<span class="ident" id="4877983">ProtocolError</span>&nbsp;<span class="keyword" id="4877997">struct</span>&nbsp;<span class="op" id="4878004">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878007">ErrorString</span>&nbsp;<span class="builtintype" id="4878019">string</span><br>
<span class="lineno"></span><span class="op" id="4878026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4878029">func</span>&nbsp;<span class="op" id="4878034">(</span><span class="ident" id="4878035">err</span>&nbsp;<span class="op" id="4878039">*</span><span class="ident" id="4878040">ProtocolError</span><span class="op" id="4878053">)</span>&nbsp;<span class="ident" id="4878055">Error</span><span class="op" id="4878060">(</span><span class="op" id="4878061">)</span>&nbsp;<span class="builtintype" id="4878063">string</span>&nbsp;<span class="op" id="4878070">{</span>&nbsp;<span class="keyword" id="4878072">return</span>&nbsp;<span class="ident" id="4878079">err</span><span class="op" id="4878082">.</span><span class="ident" id="4878083">ErrorString</span>&nbsp;<span class="op" id="4878095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="keyword" id="4878098">var</span>&nbsp;<span class="op" id="4878102">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878105">ErrHeaderTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4878129">=</span>&nbsp;<span class="op" id="4878131">&amp;</span><span class="ident" id="4878132">ProtocolError</span><span class="op" id="4878145">{</span><span class="string" id="4878146">&#34;header&nbsp;too&nbsp;long&#34;</span><span class="op" id="4878163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878166">ErrShortBody</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4878190">=</span>&nbsp;<span class="op" id="4878192">&amp;</span><span class="ident" id="4878193">ProtocolError</span><span class="op" id="4878206">{</span><span class="string" id="4878207">&#34;entity&nbsp;body&nbsp;too&nbsp;short&#34;</span><span class="op" id="4878230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878233">ErrNotSupported</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4878257">=</span>&nbsp;<span class="op" id="4878259">&amp;</span><span class="ident" id="4878260">ProtocolError</span><span class="op" id="4878273">{</span><span class="string" id="4878274">&#34;feature&nbsp;not&nbsp;supported&#34;</span><span class="op" id="4878297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878300">ErrUnexpectedTrailer</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4878324">=</span>&nbsp;<span class="op" id="4878326">&amp;</span><span class="ident" id="4878327">ProtocolError</span><span class="op" id="4878340">{</span><span class="string" id="4878341">&#34;trailer&nbsp;header&nbsp;without&nbsp;chunked&nbsp;transfer&nbsp;encoding&#34;</span><span class="op" id="4878391">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878394">ErrMissingContentLength</span>&nbsp;<span class="op" id="4878418">=</span>&nbsp;<span class="op" id="4878420">&amp;</span><span class="ident" id="4878421">ProtocolError</span><span class="op" id="4878434">{</span><span class="string" id="4878435">&#34;missing&nbsp;ContentLength&nbsp;in&nbsp;HEAD&nbsp;response&#34;</span><span class="op" id="4878475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878478">ErrNotMultipart</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4878502">=</span>&nbsp;<span class="op" id="4878504">&amp;</span><span class="ident" id="4878505">ProtocolError</span><span class="op" id="4878518">{</span><span class="string" id="4878519">&#34;request&nbsp;Content-Type&nbsp;isn&#39;t&nbsp;multipart/form-data&#34;</span><span class="op" id="4878567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878570">ErrMissingBoundary</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4878594">=</span>&nbsp;<span class="op" id="4878596">&amp;</span><span class="ident" id="4878597">ProtocolError</span><span class="op" id="4878610">{</span><span class="string" id="4878611">&#34;no&nbsp;multipart&nbsp;boundary&nbsp;param&nbsp;in&nbsp;Content-Type&#34;</span><span class="op" id="4878656">}</span><br>
<span class="lineno"></span><span class="op" id="4878658">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="4878661">type</span>&nbsp;<span class="ident" id="4878666">badStringError</span>&nbsp;<span class="keyword" id="4878681">struct</span>&nbsp;<span class="op" id="4878688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878691">what</span>&nbsp;<span class="builtintype" id="4878696">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4878704">str</span>&nbsp;&nbsp;<span class="builtintype" id="4878709">string</span><br>
<span class="lineno"></span><span class="op" id="4878716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="4878719">func</span>&nbsp;<span class="op" id="4878724">(</span><span class="ident" id="4878725">e</span>&nbsp;<span class="op" id="4878727">*</span><span class="ident" id="4878728">badStringError</span><span class="op" id="4878742">)</span>&nbsp;<span class="ident" id="4878744">Error</span><span class="op" id="4878749">(</span><span class="op" id="4878750">)</span>&nbsp;<span class="builtintype" id="4878752">string</span>&nbsp;<span class="op" id="4878759">{</span>&nbsp;<span class="keyword" id="4878761">return</span>&nbsp;<span class="ident" id="4878768">fmt</span><span class="op" id="4878771">.</span><span class="ident" id="4878772">Sprintf</span><span class="op" id="4878779">(</span><span class="string" id="4878780">&#34;%s&nbsp;%q&#34;</span><span class="op" id="4878787">,</span>&nbsp;<span class="ident" id="4878789">e</span><span class="op" id="4878790">.</span><span class="ident" id="4878791">what</span><span class="op" id="4878795">,</span>&nbsp;<span class="ident" id="4878797">e</span><span class="op" id="4878798">.</span><span class="ident" id="4878799">str</span><span class="op" id="4878802">)</span>&nbsp;<span class="op" id="4878804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4878807">//&nbsp;Headers&nbsp;that&nbsp;Request.Write&nbsp;handles&nbsp;itself&nbsp;and&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="keyword" id="4878875">var</span>&nbsp;<span class="ident" id="4878879">reqWriteExcludeHeader</span>&nbsp;<span class="op" id="4878901">=</span>&nbsp;<span class="keyword" id="4878903">map</span><span class="op" id="4878906">[</span><span class="builtintype" id="4878907">string</span><span class="op" id="4878913">]</span><span class="builtintype" id="4878914">bool</span><span class="op" id="4878918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4878921">&#34;Host&#34;</span><span class="op" id="4878927">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4878942">true</span><span class="op" id="4878946">,</span>&nbsp;<span class="comment" id="4878948">//&nbsp;not&nbsp;in&nbsp;Header&nbsp;map&nbsp;anyway</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4878977">&#34;User-Agent&#34;</span><span class="op" id="4878989">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4878998">true</span><span class="op" id="4879002">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4879005">&#34;Content-Length&#34;</span><span class="op" id="4879021">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4879026">true</span><span class="op" id="4879030">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4879033">&#34;Transfer-Encoding&#34;</span><span class="op" id="4879052">:</span>&nbsp;<span class="builtintype" id="4879054">true</span><span class="op" id="4879058">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4879061">&#34;Trailer&#34;</span><span class="op" id="4879070">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4879082">true</span><span class="op" id="4879086">,</span><br>
<span class="lineno"></span><span class="op" id="4879088">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="4879091">//&nbsp;A&nbsp;Request&nbsp;represents&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;received&nbsp;by&nbsp;a&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="4879152">//&nbsp;or&nbsp;to&nbsp;be&nbsp;sent&nbsp;by&nbsp;a&nbsp;client.</span><br>
<span class="lineno"></span><span class="comment" id="4879182">//</span><br>
<span class="lineno"></span><span class="comment" id="4879185">//&nbsp;The&nbsp;field&nbsp;semantics&nbsp;differ&nbsp;slightly&nbsp;between&nbsp;client&nbsp;and&nbsp;server</span><br>
<span class="lineno">75</span><span class="comment" id="4879250">//&nbsp;usage.&nbsp;In&nbsp;addition&nbsp;to&nbsp;the&nbsp;notes&nbsp;on&nbsp;the&nbsp;fields&nbsp;below,&nbsp;see&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4879314">//&nbsp;documentation&nbsp;for&nbsp;Request.Write&nbsp;and&nbsp;RoundTripper.</span><br>
<span class="lineno"></span><span class="keyword" id="4879367">type</span>&nbsp;<span class="ident" id="4879372">Request</span>&nbsp;<span class="keyword" id="4879380">struct</span>&nbsp;<span class="op" id="4879387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4879390">//&nbsp;Method&nbsp;specifies&nbsp;the&nbsp;HTTP&nbsp;method&nbsp;(GET,&nbsp;POST,&nbsp;PUT,&nbsp;etc.).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4879451">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;an&nbsp;empty&nbsp;string&nbsp;means&nbsp;GET.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4879502">Method</span>&nbsp;<span class="builtintype" id="4879509">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4879518">//&nbsp;URL&nbsp;specifies&nbsp;either&nbsp;the&nbsp;URI&nbsp;being&nbsp;requested&nbsp;(for&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4879579">//&nbsp;requests)&nbsp;or&nbsp;the&nbsp;URL&nbsp;to&nbsp;access&nbsp;(for&nbsp;client&nbsp;requests).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4879637">//</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4879641">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;URL&nbsp;is&nbsp;parsed&nbsp;from&nbsp;the&nbsp;URI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4879696">//&nbsp;supplied&nbsp;on&nbsp;the&nbsp;Request-Line&nbsp;as&nbsp;stored&nbsp;in&nbsp;RequestURI.&nbsp;&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4879759">//&nbsp;most&nbsp;requests,&nbsp;fields&nbsp;other&nbsp;than&nbsp;Path&nbsp;and&nbsp;RawQuery&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4879822">//&nbsp;empty.&nbsp;(See&nbsp;RFC&nbsp;2616,&nbsp;Section&nbsp;5.1.2)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4879863">//</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4879867">//&nbsp;For&nbsp;client&nbsp;requests,&nbsp;the&nbsp;URL&#39;s&nbsp;Host&nbsp;specifies&nbsp;the&nbsp;server&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4879931">//&nbsp;connect&nbsp;to,&nbsp;while&nbsp;the&nbsp;Request&#39;s&nbsp;Host&nbsp;field&nbsp;optionally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4879989">//&nbsp;specifies&nbsp;the&nbsp;Host&nbsp;header&nbsp;value&nbsp;to&nbsp;send&nbsp;in&nbsp;the&nbsp;HTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880045">//&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4880058">URL</span>&nbsp;<span class="op" id="4880062">*</span><span class="ident" id="4880063">url</span><span class="op" id="4880066">.</span><span class="ident" id="4880067">URL</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880073">//&nbsp;The&nbsp;protocol&nbsp;version&nbsp;for&nbsp;incoming&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880121">//&nbsp;Client&nbsp;requests&nbsp;always&nbsp;use&nbsp;HTTP/1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4880162">Proto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4880173">string</span>&nbsp;<span class="comment" id="4880180">//&nbsp;&#34;HTTP/1.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4880195">ProtoMajor</span>&nbsp;<span class="builtintype" id="4880206">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4880213">//&nbsp;1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4880219">ProtoMinor</span>&nbsp;<span class="builtintype" id="4880230">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4880237">//&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880244">//&nbsp;A&nbsp;header&nbsp;maps&nbsp;request&nbsp;lines&nbsp;to&nbsp;their&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880293">//&nbsp;If&nbsp;the&nbsp;header&nbsp;says</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880316">//</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880320">//&nbsp;&nbsp;&nbsp;&nbspaccept-encoding:&nbsp;gzip,&nbsp;deflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880355">//&nbsp;&nbsp;&nbsp;&nbspAccept-Language:&nbsp;en-us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880382">//&nbsp;&nbsp;&nbsp;&nbspConnection:&nbsp;keep-alive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880409">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880413">//&nbsp;then</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880422">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880426">//&nbsp;&nbsp;&nbsp;&nbspHeader&nbsp;=&nbsp;map[string][]string{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880460">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Accept-Encoding&#34;:&nbsp;{&#34;gzip,&nbsp;deflate&#34;},</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880503">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Accept-Language&#34;:&nbsp;{&#34;en-us&#34;},</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880538">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&#34;Connection&#34;:&nbsp;{&#34;keep-alive&#34;},</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880573">//&nbsp;&nbsp;&nbsp;&nbsp}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880579">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880583">//&nbsp;HTTP&nbsp;defines&nbsp;that&nbsp;header&nbsp;names&nbsp;are&nbsp;case-insensitive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880640">//&nbsp;The&nbsp;request&nbsp;parser&nbsp;implements&nbsp;this&nbsp;by&nbsp;canonicalizing&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880701">//&nbsp;name,&nbsp;making&nbsp;the&nbsp;first&nbsp;character&nbsp;and&nbsp;any&nbsp;characters</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880757">//&nbsp;following&nbsp;a&nbsp;hyphen&nbsp;uppercase&nbsp;and&nbsp;the&nbsp;rest&nbsp;lowercase.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880814">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880818">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;certain&nbsp;headers&nbsp;are&nbsp;automatically</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880876">//&nbsp;added&nbsp;and&nbsp;may&nbsp;override&nbsp;values&nbsp;in&nbsp;Header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880921">//</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880925">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;the&nbsp;Request.Write&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4880981">Header</span>&nbsp;<span class="ident" id="4880988">Header</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4880997">//&nbsp;Body&nbsp;is&nbsp;the&nbsp;request&#39;s&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4881029">//</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4881033">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;a&nbsp;nil&nbsp;body&nbsp;means&nbsp;the&nbsp;request&nbsp;has&nbsp;no</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4881093">//&nbsp;body,&nbsp;such&nbsp;as&nbsp;a&nbsp;GET&nbsp;request.&nbsp;The&nbsp;HTTP&nbsp;Client&#39;s&nbsp;Transport</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4881154">//&nbsp;is&nbsp;responsible&nbsp;for&nbsp;calling&nbsp;the&nbsp;Close&nbsp;method.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4881203">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4881207">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;Request&nbsp;Body&nbsp;is&nbsp;always&nbsp;non-nil</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4881266">//&nbsp;but&nbsp;will&nbsp;return&nbsp;EOF&nbsp;immediately&nbsp;when&nbsp;no&nbsp;body&nbsp;is&nbsp;present.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4881327">//&nbsp;The&nbsp;Server&nbsp;will&nbsp;close&nbsp;the&nbsp;request&nbsp;body.&nbsp;The&nbsp;ServeHTTP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4881385">//&nbsp;Handler&nbsp;does&nbsp;not&nbsp;need&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881415">Body</span>&nbsp;<span class="ident" id="4881420">io</span><span class="op" id="4881422">.</span><span class="ident" id="4881423">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4881436">//&nbsp;ContentLength&nbsp;records&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;associated&nbsp;content.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4881500">//&nbsp;The&nbsp;value&nbsp;-1&nbsp;indicates&nbsp;that&nbsp;the&nbsp;length&nbsp;is&nbsp;unknown.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4881555">//&nbsp;Values&nbsp;&gt;=&nbsp;0&nbsp;indicate&nbsp;that&nbsp;the&nbsp;given&nbsp;number&nbsp;of&nbsp;bytes&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4881615">//&nbsp;be&nbsp;read&nbsp;from&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4881638">//&nbsp;For&nbsp;client&nbsp;requests,&nbsp;a&nbsp;value&nbsp;of&nbsp;0&nbsp;means&nbsp;unknown&nbsp;if&nbsp;Body&nbsp;is&nbsp;not&nbsp;nil.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4881710">ContentLength</span>&nbsp;<span class="ident" id="4881724">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4881732">//&nbsp;TransferEncoding&nbsp;lists&nbsp;the&nbsp;transfer&nbsp;encodings&nbsp;from&nbsp;outermost&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4881800">//&nbsp;innermost.&nbsp;An&nbsp;empty&nbsp;list&nbsp;denotes&nbsp;the&nbsp;&#34;identity&#34;&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4881862">//&nbsp;TransferEncoding&nbsp;can&nbsp;usually&nbsp;be&nbsp;ignored;&nbsp;chunked&nbsp;encoding&nbsp;is</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4881927">//&nbsp;automatically&nbsp;added&nbsp;and&nbsp;removed&nbsp;as&nbsp;necessary&nbsp;when&nbsp;sending&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4881993">//&nbsp;receiving&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882017">TransferEncoding</span>&nbsp;<span class="op" id="4882034">[</span><span class="op" id="4882035">]</span><span class="builtintype" id="4882036">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4882045">//&nbsp;Close&nbsp;indicates&nbsp;whether&nbsp;to&nbsp;close&nbsp;the&nbsp;connection&nbsp;after</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4882103">//&nbsp;replying&nbsp;to&nbsp;this&nbsp;request&nbsp;(for&nbsp;servers)&nbsp;or&nbsp;after&nbsp;sending</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4882163">//&nbsp;the&nbsp;request&nbsp;(for&nbsp;clients).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882194">Close</span>&nbsp;<span class="builtintype" id="4882200">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4882207">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;Host&nbsp;specifies&nbsp;the&nbsp;host&nbsp;on&nbsp;which&nbsp;the</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4882268">//&nbsp;URL&nbsp;is&nbsp;sought.&nbsp;Per&nbsp;RFC&nbsp;2616,&nbsp;this&nbsp;is&nbsp;either&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4882329">//&nbsp;the&nbsp;&#34;Host&#34;&nbsp;header&nbsp;or&nbsp;the&nbsp;host&nbsp;name&nbsp;given&nbsp;in&nbsp;the&nbsp;URL&nbsp;itself.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4882393">//&nbsp;It&nbsp;may&nbsp;be&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;host:port&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4882432">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4882436">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;Host&nbsp;optionally&nbsp;overrides&nbsp;the&nbsp;Host</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4882495">//&nbsp;header&nbsp;to&nbsp;send.&nbsp;If&nbsp;empty,&nbsp;the&nbsp;Request.Write&nbsp;method&nbsp;uses</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4882555">//&nbsp;the&nbsp;value&nbsp;of&nbsp;URL.Host.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882582">Host</span>&nbsp;<span class="builtintype" id="4882587">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4882596">//&nbsp;Form&nbsp;contains&nbsp;the&nbsp;parsed&nbsp;form&nbsp;data,&nbsp;including&nbsp;both&nbsp;the&nbsp;URL</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4882659">//&nbsp;field&#39;s&nbsp;query&nbsp;parameters&nbsp;and&nbsp;the&nbsp;POST&nbsp;or&nbsp;PUT&nbsp;form&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4882719">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4882779">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;Form&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4882835">Form</span>&nbsp;<span class="ident" id="4882840">url</span><span class="op" id="4882843">.</span><span class="ident" id="4882844">Values</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4882853">//&nbsp;PostForm&nbsp;contains&nbsp;the&nbsp;parsed&nbsp;form&nbsp;data&nbsp;from&nbsp;POST&nbsp;or&nbsp;PUT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4882913">//&nbsp;body&nbsp;parameters.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4882934">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4882994">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;PostForm&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4883054">PostForm</span>&nbsp;<span class="ident" id="4883063">url</span><span class="op" id="4883066">.</span><span class="ident" id="4883067">Values</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4883076">//&nbsp;MultipartForm&nbsp;is&nbsp;the&nbsp;parsed&nbsp;multipart&nbsp;form,&nbsp;including&nbsp;file&nbsp;uploads.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4883148">//&nbsp;This&nbsp;field&nbsp;is&nbsp;only&nbsp;available&nbsp;after&nbsp;ParseMultipartForm&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4883217">//&nbsp;The&nbsp;HTTP&nbsp;client&nbsp;ignores&nbsp;MultipartForm&nbsp;and&nbsp;uses&nbsp;Body&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4883282">MultipartForm</span>&nbsp;<span class="op" id="4883296">*</span><span class="ident" id="4883297">multipart</span><span class="op" id="4883306">.</span><span class="ident" id="4883307">Form</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4883314">//&nbsp;Trailer&nbsp;specifies&nbsp;additional&nbsp;headers&nbsp;that&nbsp;are&nbsp;sent&nbsp;after&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4883387">//&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4883397">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4883401">//&nbsp;For&nbsp;server&nbsp;requests&nbsp;the&nbsp;Trailer&nbsp;map&nbsp;initially&nbsp;contains&nbsp;only&nbsp;the</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4883469">//&nbsp;trailer&nbsp;keys,&nbsp;with&nbsp;nil&nbsp;values.&nbsp;(The&nbsp;client&nbsp;declares&nbsp;which&nbsp;trailers&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4883543">//&nbsp;will&nbsp;later&nbsp;send.)&nbsp;&nbsp;While&nbsp;the&nbsp;handler&nbsp;is&nbsp;reading&nbsp;from&nbsp;Body,&nbsp;it&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4883614">//&nbsp;not&nbsp;reference&nbsp;Trailer.&nbsp;After&nbsp;reading&nbsp;from&nbsp;Body&nbsp;returns&nbsp;EOF,&nbsp;Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4883686">//&nbsp;can&nbsp;be&nbsp;read&nbsp;again&nbsp;and&nbsp;will&nbsp;contain&nbsp;non-nil&nbsp;values,&nbsp;if&nbsp;they&nbsp;were&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4883759">//&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4883778">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4883782">//&nbsp;For&nbsp;client&nbsp;requests&nbsp;Trailer&nbsp;must&nbsp;be&nbsp;initialized&nbsp;to&nbsp;a&nbsp;map&nbsp;containing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4883854">//&nbsp;the&nbsp;trailer&nbsp;keys&nbsp;to&nbsp;later&nbsp;send.&nbsp;The&nbsp;values&nbsp;may&nbsp;be&nbsp;nil&nbsp;or&nbsp;their&nbsp;final</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4883927">//&nbsp;values.&nbsp;The&nbsp;ContentLength&nbsp;must&nbsp;be&nbsp;0&nbsp;or&nbsp;-1,&nbsp;to&nbsp;send&nbsp;a&nbsp;chunked&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4884001">//&nbsp;After&nbsp;the&nbsp;HTTP&nbsp;request&nbsp;is&nbsp;sent&nbsp;the&nbsp;map&nbsp;values&nbsp;can&nbsp;be&nbsp;updated&nbsp;while</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4884072">//&nbsp;the&nbsp;request&nbsp;body&nbsp;is&nbsp;read.&nbsp;Once&nbsp;the&nbsp;body&nbsp;returns&nbsp;EOF,&nbsp;the&nbsp;caller&nbsp;must</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4884145">//&nbsp;not&nbsp;mutate&nbsp;Trailer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4884169">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4884173">//&nbsp;Few&nbsp;HTTP&nbsp;clients,&nbsp;servers,&nbsp;or&nbsp;proxies&nbsp;support&nbsp;HTTP&nbsp;trailers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884238">Trailer</span>&nbsp;<span class="ident" id="4884246">Header</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4884255">//&nbsp;RemoteAddr&nbsp;allows&nbsp;HTTP&nbsp;servers&nbsp;and&nbsp;other&nbsp;software&nbsp;to&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4884319">//&nbsp;the&nbsp;network&nbsp;address&nbsp;that&nbsp;sent&nbsp;the&nbsp;request,&nbsp;usually&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4884378">//&nbsp;logging.&nbsp;This&nbsp;field&nbsp;is&nbsp;not&nbsp;filled&nbsp;in&nbsp;by&nbsp;ReadRequest&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4884438">//&nbsp;has&nbsp;no&nbsp;defined&nbsp;format.&nbsp;The&nbsp;HTTP&nbsp;server&nbsp;in&nbsp;this&nbsp;package</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4884497">//&nbsp;sets&nbsp;RemoteAddr&nbsp;to&nbsp;an&nbsp;&#34;IP:port&#34;&nbsp;address&nbsp;before&nbsp;invoking&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4884559">//&nbsp;handler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4884572">//&nbsp;This&nbsp;field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;the&nbsp;HTTP&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884618">RemoteAddr</span>&nbsp;<span class="builtintype" id="4884629">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4884638">//&nbsp;RequestURI&nbsp;is&nbsp;the&nbsp;unmodified&nbsp;Request-URI&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4884690">//&nbsp;Request-Line&nbsp;(RFC&nbsp;2616,&nbsp;Section&nbsp;5.1)&nbsp;as&nbsp;sent&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4884753">//&nbsp;to&nbsp;a&nbsp;server.&nbsp;Usually&nbsp;the&nbsp;URL&nbsp;field&nbsp;should&nbsp;be&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4884816">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;set&nbsp;this&nbsp;field&nbsp;in&nbsp;an&nbsp;HTTP&nbsp;client&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4884880">RequestURI</span>&nbsp;<span class="builtintype" id="4884891">string</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4884900">//&nbsp;TLS&nbsp;allows&nbsp;HTTP&nbsp;servers&nbsp;and&nbsp;other&nbsp;software&nbsp;to&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4884957">//&nbsp;information&nbsp;about&nbsp;the&nbsp;TLS&nbsp;connection&nbsp;on&nbsp;which&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4885019">//&nbsp;was&nbsp;received.&nbsp;This&nbsp;field&nbsp;is&nbsp;not&nbsp;filled&nbsp;in&nbsp;by&nbsp;ReadRequest.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4885081">//&nbsp;The&nbsp;HTTP&nbsp;server&nbsp;in&nbsp;this&nbsp;package&nbsp;sets&nbsp;the&nbsp;field&nbsp;for</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4885136">//&nbsp;TLS-enabled&nbsp;connections&nbsp;before&nbsp;invoking&nbsp;a&nbsp;handler;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4885191">//&nbsp;otherwise&nbsp;it&nbsp;leaves&nbsp;the&nbsp;field&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4885230">//&nbsp;This&nbsp;field&nbsp;is&nbsp;ignored&nbsp;by&nbsp;the&nbsp;HTTP&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885276">TLS</span>&nbsp;<span class="op" id="4885280">*</span><span class="ident" id="4885281">tls</span><span class="op" id="4885284">.</span><span class="ident" id="4885285">ConnectionState</span><br>
<span class="lineno"></span><span class="op" id="4885301">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="4885304">//&nbsp;ProtoAtLeast&nbsp;reports&nbsp;whether&nbsp;the&nbsp;HTTP&nbsp;protocol&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4885359">//&nbsp;in&nbsp;the&nbsp;request&nbsp;is&nbsp;at&nbsp;least&nbsp;major.minor.</span><br>
<span class="lineno"></span><span class="keyword" id="4885402">func</span>&nbsp;<span class="op" id="4885407">(</span><span class="ident" id="4885408">r</span>&nbsp;<span class="op" id="4885410">*</span><span class="ident" id="4885411">Request</span><span class="op" id="4885418">)</span>&nbsp;<span class="ident" id="4885420">ProtoAtLeast</span><span class="op" id="4885432">(</span><span class="ident" id="4885433">major</span><span class="op" id="4885438">,</span>&nbsp;<span class="ident" id="4885440">minor</span>&nbsp;<span class="builtintype" id="4885446">int</span><span class="op" id="4885449">)</span>&nbsp;<span class="builtintype" id="4885451">bool</span>&nbsp;<span class="op" id="4885456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4885459">return</span>&nbsp;<span class="ident" id="4885466">r</span><span class="op" id="4885467">.</span><span class="ident" id="4885468">ProtoMajor</span>&nbsp;<span class="op" id="4885479">&gt;</span>&nbsp;<span class="ident" id="4885481">major</span>&nbsp;<span class="op" id="4885487">||</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4885492">r</span><span class="op" id="4885493">.</span><span class="ident" id="4885494">ProtoMajor</span>&nbsp;<span class="op" id="4885505">==</span>&nbsp;<span class="ident" id="4885508">major</span>&nbsp;<span class="op" id="4885514">&amp;&amp;</span>&nbsp;<span class="ident" id="4885517">r</span><span class="op" id="4885518">.</span><span class="ident" id="4885519">ProtoMinor</span>&nbsp;<span class="op" id="4885530">&gt;=</span>&nbsp;<span class="ident" id="4885533">minor</span><br>
<span class="lineno"></span><span class="op" id="4885539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4885542">//&nbsp;UserAgent&nbsp;returns&nbsp;the&nbsp;client&#39;s&nbsp;User-Agent,&nbsp;if&nbsp;sent&nbsp;in&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="4885612">func</span>&nbsp;<span class="op" id="4885617">(</span><span class="ident" id="4885618">r</span>&nbsp;<span class="op" id="4885620">*</span><span class="ident" id="4885621">Request</span><span class="op" id="4885628">)</span>&nbsp;<span class="ident" id="4885630">UserAgent</span><span class="op" id="4885639">(</span><span class="op" id="4885640">)</span>&nbsp;<span class="builtintype" id="4885642">string</span>&nbsp;<span class="op" id="4885649">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4885652">return</span>&nbsp;<span class="ident" id="4885659">r</span><span class="op" id="4885660">.</span><span class="ident" id="4885661">Header</span><span class="op" id="4885667">.</span><span class="ident" id="4885668">Get</span><span class="op" id="4885671">(</span><span class="string" id="4885672">&#34;User-Agent&#34;</span><span class="op" id="4885684">)</span><br>
<span class="lineno"></span><span class="op" id="4885686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4885689">//&nbsp;Cookies&nbsp;parses&nbsp;and&nbsp;returns&nbsp;the&nbsp;HTTP&nbsp;cookies&nbsp;sent&nbsp;with&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="keyword" id="4885759">func</span>&nbsp;<span class="op" id="4885764">(</span><span class="ident" id="4885765">r</span>&nbsp;<span class="op" id="4885767">*</span><span class="ident" id="4885768">Request</span><span class="op" id="4885775">)</span>&nbsp;<span class="ident" id="4885777">Cookies</span><span class="op" id="4885784">(</span><span class="op" id="4885785">)</span>&nbsp;<span class="op" id="4885787">[</span><span class="op" id="4885788">]</span><span class="op" id="4885789">*</span><span class="ident" id="4885790">Cookie</span>&nbsp;<span class="op" id="4885797">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4885800">return</span>&nbsp;<span class="ident" id="4885807">readCookies</span><span class="op" id="4885818">(</span><span class="ident" id="4885819">r</span><span class="op" id="4885820">.</span><span class="ident" id="4885821">Header</span><span class="op" id="4885827">,</span>&nbsp;<span class="string" id="4885829">&#34;&#34;</span><span class="op" id="4885831">)</span><br>
<span class="lineno"></span><span class="op" id="4885833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4885836">var</span>&nbsp;<span class="ident" id="4885840">ErrNoCookie</span>&nbsp;<span class="op" id="4885852">=</span>&nbsp;<span class="ident" id="4885854">errors</span><span class="op" id="4885860">.</span><span class="ident" id="4885861">New</span><span class="op" id="4885864">(</span><span class="string" id="4885865">&#34;http:&nbsp;named&nbsp;cookie&nbsp;not&nbsp;present&#34;</span><span class="op" id="4885897">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="comment" id="4885900">//&nbsp;Cookie&nbsp;returns&nbsp;the&nbsp;named&nbsp;cookie&nbsp;provided&nbsp;in&nbsp;the&nbsp;request&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="4885962">//&nbsp;ErrNoCookie&nbsp;if&nbsp;not&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="4885991">func</span>&nbsp;<span class="op" id="4885996">(</span><span class="ident" id="4885997">r</span>&nbsp;<span class="op" id="4885999">*</span><span class="ident" id="4886000">Request</span><span class="op" id="4886007">)</span>&nbsp;<span class="ident" id="4886009">Cookie</span><span class="op" id="4886015">(</span><span class="ident" id="4886016">name</span>&nbsp;<span class="builtintype" id="4886021">string</span><span class="op" id="4886027">)</span>&nbsp;<span class="op" id="4886029">(</span><span class="op" id="4886030">*</span><span class="ident" id="4886031">Cookie</span><span class="op" id="4886037">,</span>&nbsp;<span class="builtintype" id="4886039">error</span><span class="op" id="4886044">)</span>&nbsp;<span class="op" id="4886046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886049">for</span>&nbsp;<span class="ident" id="4886053">_</span><span class="op" id="4886054">,</span>&nbsp;<span class="ident" id="4886056">c</span>&nbsp;<span class="op" id="4886058">:=</span>&nbsp;<span class="keyword" id="4886061">range</span>&nbsp;<span class="ident" id="4886067">readCookies</span><span class="op" id="4886078">(</span><span class="ident" id="4886079">r</span><span class="op" id="4886080">.</span><span class="ident" id="4886081">Header</span><span class="op" id="4886087">,</span>&nbsp;<span class="ident" id="4886089">name</span><span class="op" id="4886093">)</span>&nbsp;<span class="op" id="4886095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886099">return</span>&nbsp;<span class="ident" id="4886106">c</span><span class="op" id="4886107">,</span>&nbsp;<span class="ident" id="4886109">nil</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4886114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886117">return</span>&nbsp;<span class="ident" id="4886124">nil</span><span class="op" id="4886127">,</span>&nbsp;<span class="ident" id="4886129">ErrNoCookie</span><br>
<span class="lineno"></span><span class="op" id="4886141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4886144">//&nbsp;AddCookie&nbsp;adds&nbsp;a&nbsp;cookie&nbsp;to&nbsp;the&nbsp;request.&nbsp;&nbsp;Per&nbsp;RFC&nbsp;6265&nbsp;section&nbsp;5.4,</span><br>
<span class="lineno">260</span><span class="comment" id="4886214">//&nbsp;AddCookie&nbsp;does&nbsp;not&nbsp;attach&nbsp;more&nbsp;than&nbsp;one&nbsp;Cookie&nbsp;header&nbsp;field.&nbsp;&nbsp;That</span><br>
<span class="lineno"></span><span class="comment" id="4886284">//&nbsp;means&nbsp;all&nbsp;cookies,&nbsp;if&nbsp;any,&nbsp;are&nbsp;written&nbsp;into&nbsp;the&nbsp;same&nbsp;line,</span><br>
<span class="lineno"></span><span class="comment" id="4886346">//&nbsp;separated&nbsp;by&nbsp;semicolon.</span><br>
<span class="lineno"></span><span class="keyword" id="4886373">func</span>&nbsp;<span class="op" id="4886378">(</span><span class="ident" id="4886379">r</span>&nbsp;<span class="op" id="4886381">*</span><span class="ident" id="4886382">Request</span><span class="op" id="4886389">)</span>&nbsp;<span class="ident" id="4886391">AddCookie</span><span class="op" id="4886400">(</span><span class="ident" id="4886401">c</span>&nbsp;<span class="op" id="4886403">*</span><span class="ident" id="4886404">Cookie</span><span class="op" id="4886410">)</span>&nbsp;<span class="op" id="4886412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4886415">s</span>&nbsp;<span class="op" id="4886417">:=</span>&nbsp;<span class="ident" id="4886420">fmt</span><span class="op" id="4886423">.</span><span class="ident" id="4886424">Sprintf</span><span class="op" id="4886431">(</span><span class="string" id="4886432">&#34;%s=%s&#34;</span><span class="op" id="4886439">,</span>&nbsp;<span class="ident" id="4886441">sanitizeCookieName</span><span class="op" id="4886459">(</span><span class="ident" id="4886460">c</span><span class="op" id="4886461">.</span><span class="ident" id="4886462">Name</span><span class="op" id="4886466">)</span><span class="op" id="4886467">,</span>&nbsp;<span class="ident" id="4886469">sanitizeCookieValue</span><span class="op" id="4886488">(</span><span class="ident" id="4886489">c</span><span class="op" id="4886490">.</span><span class="ident" id="4886491">Value</span><span class="op" id="4886496">)</span><span class="op" id="4886497">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4886500">if</span>&nbsp;<span class="ident" id="4886503">c</span>&nbsp;<span class="op" id="4886505">:=</span>&nbsp;<span class="ident" id="4886508">r</span><span class="op" id="4886509">.</span><span class="ident" id="4886510">Header</span><span class="op" id="4886516">.</span><span class="ident" id="4886517">Get</span><span class="op" id="4886520">(</span><span class="string" id="4886521">&#34;Cookie&#34;</span><span class="op" id="4886529">)</span><span class="op" id="4886530">;</span>&nbsp;<span class="ident" id="4886532">c</span>&nbsp;<span class="op" id="4886534">!=</span>&nbsp;<span class="string" id="4886537">&#34;&#34;</span>&nbsp;<span class="op" id="4886540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4886544">r</span><span class="op" id="4886545">.</span><span class="ident" id="4886546">Header</span><span class="op" id="4886552">.</span><span class="ident" id="4886553">Set</span><span class="op" id="4886556">(</span><span class="string" id="4886557">&#34;Cookie&#34;</span><span class="op" id="4886565">,</span>&nbsp;<span class="ident" id="4886567">c</span><span class="op" id="4886568">+</span><span class="string" id="4886569">&#34;;&nbsp;&#34;</span><span class="op" id="4886573">+</span><span class="ident" id="4886574">s</span><span class="op" id="4886575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4886578">}</span>&nbsp;<span class="keyword" id="4886580">else</span>&nbsp;<span class="op" id="4886585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4886589">r</span><span class="op" id="4886590">.</span><span class="ident" id="4886591">Header</span><span class="op" id="4886597">.</span><span class="ident" id="4886598">Set</span><span class="op" id="4886601">(</span><span class="string" id="4886602">&#34;Cookie&#34;</span><span class="op" id="4886610">,</span>&nbsp;<span class="ident" id="4886612">s</span><span class="op" id="4886613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4886616">}</span><br>
<span class="lineno">270</span><span class="op" id="4886618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4886621">//&nbsp;Referer&nbsp;returns&nbsp;the&nbsp;referring&nbsp;URL,&nbsp;if&nbsp;sent&nbsp;in&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="4886683">//</span><br>
<span class="lineno"></span><span class="comment" id="4886686">//&nbsp;Referer&nbsp;is&nbsp;misspelled&nbsp;as&nbsp;in&nbsp;the&nbsp;request&nbsp;itself,&nbsp;a&nbsp;mistake&nbsp;from&nbsp;the</span><br>
<span class="lineno">275</span><span class="comment" id="4886756">//&nbsp;earliest&nbsp;days&nbsp;of&nbsp;HTTP.&nbsp;&nbsp;This&nbsp;value&nbsp;can&nbsp;also&nbsp;be&nbsp;fetched&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4886823">//&nbsp;Header&nbsp;map&nbsp;as&nbsp;Header[&#34;Referer&#34;];&nbsp;the&nbsp;benefit&nbsp;of&nbsp;making&nbsp;it&nbsp;available</span><br>
<span class="lineno"></span><span class="comment" id="4886894">//&nbsp;as&nbsp;a&nbsp;method&nbsp;is&nbsp;that&nbsp;the&nbsp;compiler&nbsp;can&nbsp;diagnose&nbsp;programs&nbsp;that&nbsp;use&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4886965">//&nbsp;alternate&nbsp;(correct&nbsp;English)&nbsp;spelling&nbsp;req.Referrer()&nbsp;but&nbsp;cannot</span><br>
<span class="lineno"></span><span class="comment" id="4887031">//&nbsp;diagnose&nbsp;programs&nbsp;that&nbsp;use&nbsp;Header[&#34;Referrer&#34;].</span><br>
<span class="lineno">280</span><span class="keyword" id="4887081">func</span>&nbsp;<span class="op" id="4887086">(</span><span class="ident" id="4887087">r</span>&nbsp;<span class="op" id="4887089">*</span><span class="ident" id="4887090">Request</span><span class="op" id="4887097">)</span>&nbsp;<span class="ident" id="4887099">Referer</span><span class="op" id="4887106">(</span><span class="op" id="4887107">)</span>&nbsp;<span class="builtintype" id="4887109">string</span>&nbsp;<span class="op" id="4887116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4887119">return</span>&nbsp;<span class="ident" id="4887126">r</span><span class="op" id="4887127">.</span><span class="ident" id="4887128">Header</span><span class="op" id="4887134">.</span><span class="ident" id="4887135">Get</span><span class="op" id="4887138">(</span><span class="string" id="4887139">&#34;Referer&#34;</span><span class="op" id="4887148">)</span><br>
<span class="lineno"></span><span class="op" id="4887150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4887153">//&nbsp;multipartByReader&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;value.</span><br>
<span class="lineno">285</span><span class="comment" id="4887195">//&nbsp;Its&nbsp;presence&nbsp;in&nbsp;Request.MultipartForm&nbsp;indicates&nbsp;that&nbsp;parsing&nbsp;of&nbsp;the&nbsp;request</span><br>
<span class="lineno"></span><span class="comment" id="4887274">//&nbsp;body&nbsp;has&nbsp;been&nbsp;handed&nbsp;off&nbsp;to&nbsp;a&nbsp;MultipartReader&nbsp;instead&nbsp;of&nbsp;ParseMultipartFrom.</span><br>
<span class="lineno"></span><span class="keyword" id="4887354">var</span>&nbsp;<span class="ident" id="4887358">multipartByReader</span>&nbsp;<span class="op" id="4887376">=</span>&nbsp;<span class="op" id="4887378">&amp;</span><span class="ident" id="4887379">multipart</span><span class="op" id="4887388">.</span><span class="ident" id="4887389">Form</span><span class="op" id="4887393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4887396">Value</span><span class="op" id="4887401">:</span>&nbsp;<span class="builtinfunc" id="4887403">make</span><span class="op" id="4887407">(</span><span class="keyword" id="4887408">map</span><span class="op" id="4887411">[</span><span class="builtintype" id="4887412">string</span><span class="op" id="4887418">]</span><span class="op" id="4887419">[</span><span class="op" id="4887420">]</span><span class="builtintype" id="4887421">string</span><span class="op" id="4887427">)</span><span class="op" id="4887428">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4887431">File</span><span class="op" id="4887435">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="4887438">make</span><span class="op" id="4887442">(</span><span class="keyword" id="4887443">map</span><span class="op" id="4887446">[</span><span class="builtintype" id="4887447">string</span><span class="op" id="4887453">]</span><span class="op" id="4887454">[</span><span class="op" id="4887455">]</span><span class="op" id="4887456">*</span><span class="ident" id="4887457">multipart</span><span class="op" id="4887466">.</span><span class="ident" id="4887467">FileHeader</span><span class="op" id="4887477">)</span><span class="op" id="4887478">,</span><br>
<span class="lineno">290</span><span class="op" id="4887480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4887483">//&nbsp;MultipartReader&nbsp;returns&nbsp;a&nbsp;MIME&nbsp;multipart&nbsp;reader&nbsp;if&nbsp;this&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4887547">//&nbsp;multipart/form-data&nbsp;POST&nbsp;request,&nbsp;else&nbsp;returns&nbsp;nil&nbsp;and&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="4887615">//&nbsp;Use&nbsp;this&nbsp;function&nbsp;instead&nbsp;of&nbsp;ParseMultipartForm&nbsp;to</span><br>
<span class="lineno">295</span><span class="comment" id="4887669">//&nbsp;process&nbsp;the&nbsp;request&nbsp;body&nbsp;as&nbsp;a&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="4887710">func</span>&nbsp;<span class="op" id="4887715">(</span><span class="ident" id="4887716">r</span>&nbsp;<span class="op" id="4887718">*</span><span class="ident" id="4887719">Request</span><span class="op" id="4887726">)</span>&nbsp;<span class="ident" id="4887728">MultipartReader</span><span class="op" id="4887743">(</span><span class="op" id="4887744">)</span>&nbsp;<span class="op" id="4887746">(</span><span class="op" id="4887747">*</span><span class="ident" id="4887748">multipart</span><span class="op" id="4887757">.</span><span class="ident" id="4887758">Reader</span><span class="op" id="4887764">,</span>&nbsp;<span class="builtintype" id="4887766">error</span><span class="op" id="4887771">)</span>&nbsp;<span class="op" id="4887773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4887776">if</span>&nbsp;<span class="ident" id="4887779">r</span><span class="op" id="4887780">.</span><span class="ident" id="4887781">MultipartForm</span>&nbsp;<span class="op" id="4887795">==</span>&nbsp;<span class="ident" id="4887798">multipartByReader</span>&nbsp;<span class="op" id="4887816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4887820">return</span>&nbsp;<span class="ident" id="4887827">nil</span><span class="op" id="4887830">,</span>&nbsp;<span class="ident" id="4887832">errors</span><span class="op" id="4887838">.</span><span class="ident" id="4887839">New</span><span class="op" id="4887842">(</span><span class="string" id="4887843">&#34;http:&nbsp;MultipartReader&nbsp;called&nbsp;twice&#34;</span><span class="op" id="4887879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4887882">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4887885">if</span>&nbsp;<span class="ident" id="4887888">r</span><span class="op" id="4887889">.</span><span class="ident" id="4887890">MultipartForm</span>&nbsp;<span class="op" id="4887904">!=</span>&nbsp;<span class="ident" id="4887907">nil</span>&nbsp;<span class="op" id="4887911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4887915">return</span>&nbsp;<span class="ident" id="4887922">nil</span><span class="op" id="4887925">,</span>&nbsp;<span class="ident" id="4887927">errors</span><span class="op" id="4887933">.</span><span class="ident" id="4887934">New</span><span class="op" id="4887937">(</span><span class="string" id="4887938">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;ParseMultipartForm&#34;</span><span class="op" id="4887985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4887988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4887991">r</span><span class="op" id="4887992">.</span><span class="ident" id="4887993">MultipartForm</span>&nbsp;<span class="op" id="4888007">=</span>&nbsp;<span class="ident" id="4888009">multipartByReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888028">return</span>&nbsp;<span class="ident" id="4888035">r</span><span class="op" id="4888036">.</span><span class="ident" id="4888037">multipartReader</span><span class="op" id="4888052">(</span><span class="op" id="4888053">)</span><br>
<span class="lineno">305</span><span class="op" id="4888055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4888058">func</span>&nbsp;<span class="op" id="4888063">(</span><span class="ident" id="4888064">r</span>&nbsp;<span class="op" id="4888066">*</span><span class="ident" id="4888067">Request</span><span class="op" id="4888074">)</span>&nbsp;<span class="ident" id="4888076">multipartReader</span><span class="op" id="4888091">(</span><span class="op" id="4888092">)</span>&nbsp;<span class="op" id="4888094">(</span><span class="op" id="4888095">*</span><span class="ident" id="4888096">multipart</span><span class="op" id="4888105">.</span><span class="ident" id="4888106">Reader</span><span class="op" id="4888112">,</span>&nbsp;<span class="builtintype" id="4888114">error</span><span class="op" id="4888119">)</span>&nbsp;<span class="op" id="4888121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4888124">v</span>&nbsp;<span class="op" id="4888126">:=</span>&nbsp;<span class="ident" id="4888129">r</span><span class="op" id="4888130">.</span><span class="ident" id="4888131">Header</span><span class="op" id="4888137">.</span><span class="ident" id="4888138">Get</span><span class="op" id="4888141">(</span><span class="string" id="4888142">&#34;Content-Type&#34;</span><span class="op" id="4888156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888159">if</span>&nbsp;<span class="ident" id="4888162">v</span>&nbsp;<span class="op" id="4888164">==</span>&nbsp;<span class="string" id="4888167">&#34;&#34;</span>&nbsp;<span class="op" id="4888170">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888174">return</span>&nbsp;<span class="ident" id="4888181">nil</span><span class="op" id="4888184">,</span>&nbsp;<span class="ident" id="4888186">ErrNotMultipart</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4888203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4888206">d</span><span class="op" id="4888207">,</span>&nbsp;<span class="ident" id="4888209">params</span><span class="op" id="4888215">,</span>&nbsp;<span class="ident" id="4888217">err</span>&nbsp;<span class="op" id="4888221">:=</span>&nbsp;<span class="ident" id="4888224">mime</span><span class="op" id="4888228">.</span><span class="ident" id="4888229">ParseMediaType</span><span class="op" id="4888243">(</span><span class="ident" id="4888244">v</span><span class="op" id="4888245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888248">if</span>&nbsp;<span class="ident" id="4888251">err</span>&nbsp;<span class="op" id="4888255">!=</span>&nbsp;<span class="ident" id="4888258">nil</span>&nbsp;<span class="op" id="4888262">||</span>&nbsp;<span class="ident" id="4888265">d</span>&nbsp;<span class="op" id="4888267">!=</span>&nbsp;<span class="string" id="4888270">&#34;multipart/form-data&#34;</span>&nbsp;<span class="op" id="4888292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888296">return</span>&nbsp;<span class="ident" id="4888303">nil</span><span class="op" id="4888306">,</span>&nbsp;<span class="ident" id="4888308">ErrNotMultipart</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4888325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4888328">boundary</span><span class="op" id="4888336">,</span>&nbsp;<span class="ident" id="4888338">ok</span>&nbsp;<span class="op" id="4888341">:=</span>&nbsp;<span class="ident" id="4888344">params</span><span class="op" id="4888350">[</span><span class="string" id="4888351">&#34;boundary&#34;</span><span class="op" id="4888361">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888364">if</span>&nbsp;<span class="op" id="4888367">!</span><span class="ident" id="4888368">ok</span>&nbsp;<span class="op" id="4888371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888375">return</span>&nbsp;<span class="ident" id="4888382">nil</span><span class="op" id="4888385">,</span>&nbsp;<span class="ident" id="4888387">ErrMissingBoundary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4888407">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888410">return</span>&nbsp;<span class="ident" id="4888417">multipart</span><span class="op" id="4888426">.</span><span class="ident" id="4888427">NewReader</span><span class="op" id="4888436">(</span><span class="ident" id="4888437">r</span><span class="op" id="4888438">.</span><span class="ident" id="4888439">Body</span><span class="op" id="4888443">,</span>&nbsp;<span class="ident" id="4888445">boundary</span><span class="op" id="4888453">)</span><span class="op" id="4888454">,</span>&nbsp;<span class="ident" id="4888456">nil</span><br>
<span class="lineno"></span><span class="op" id="4888460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4888463">//&nbsp;Return&nbsp;value&nbsp;if&nbsp;nonempty,&nbsp;def&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="keyword" id="4888507">func</span>&nbsp;<span class="ident" id="4888512">valueOrDefault</span><span class="op" id="4888526">(</span><span class="ident" id="4888527">value</span><span class="op" id="4888532">,</span>&nbsp;<span class="ident" id="4888534">def</span>&nbsp;<span class="builtintype" id="4888538">string</span><span class="op" id="4888544">)</span>&nbsp;<span class="builtintype" id="4888546">string</span>&nbsp;<span class="op" id="4888553">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888556">if</span>&nbsp;<span class="ident" id="4888559">value</span>&nbsp;<span class="op" id="4888565">!=</span>&nbsp;<span class="string" id="4888568">&#34;&#34;</span>&nbsp;<span class="op" id="4888571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888575">return</span>&nbsp;<span class="ident" id="4888582">value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4888589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4888592">return</span>&nbsp;<span class="ident" id="4888599">def</span><br>
<span class="lineno"></span><span class="op" id="4888603">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="comment" id="4888606">//&nbsp;NOTE:&nbsp;This&nbsp;is&nbsp;not&nbsp;intended&nbsp;to&nbsp;reflect&nbsp;the&nbsp;actual&nbsp;Go&nbsp;version&nbsp;being&nbsp;used.</span><br>
<span class="lineno"></span><span class="comment" id="4888681">//&nbsp;It&nbsp;was&nbsp;changed&nbsp;from&nbsp;&#34;Go&nbsp;http&nbsp;package&#34;&nbsp;to&nbsp;&#34;Go&nbsp;1.1&nbsp;package&nbsp;http&#34;&nbsp;at&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4888754">//&nbsp;time&nbsp;of&nbsp;the&nbsp;Go&nbsp;1.1&nbsp;release&nbsp;because&nbsp;the&nbsp;former&nbsp;User-Agent&nbsp;had&nbsp;ended&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="4888827">//&nbsp;on&nbsp;a&nbsp;blacklist&nbsp;for&nbsp;some&nbsp;intrusion&nbsp;detection&nbsp;systems.</span><br>
<span class="lineno">335</span><span class="comment" id="4888883">//&nbsp;See&nbsp;https://codereview.appspot.com/7532043.</span><br>
<span class="lineno"></span><span class="keyword" id="4888930">const</span>&nbsp;<span class="ident" id="4888936">defaultUserAgent</span>&nbsp;<span class="op" id="4888953">=</span>&nbsp;<span class="string" id="4888955">&#34;Go&nbsp;1.1&nbsp;package&nbsp;http&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4888978">//&nbsp;Write&nbsp;writes&nbsp;an&nbsp;HTTP/1.1&nbsp;request&nbsp;--&nbsp;header&nbsp;and&nbsp;body&nbsp;--&nbsp;in&nbsp;wire&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="4889052">//&nbsp;This&nbsp;method&nbsp;consults&nbsp;the&nbsp;following&nbsp;fields&nbsp;of&nbsp;the&nbsp;request:</span><br>
<span class="lineno">340</span><span class="comment" id="4889113">//&nbsp;&nbsp;&nbsp;&nbspHost</span><br>
<span class="lineno"></span><span class="comment" id="4889121">//&nbsp;&nbsp;&nbsp;&nbspURL</span><br>
<span class="lineno"></span><span class="comment" id="4889128">//&nbsp;&nbsp;&nbsp;&nbspMethod&nbsp;(defaults&nbsp;to&nbsp;&#34;GET&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="4889158">//&nbsp;&nbsp;&nbsp;&nbspHeader</span><br>
<span class="lineno"></span><span class="comment" id="4889168">//&nbsp;&nbsp;&nbsp;&nbspContentLength</span><br>
<span class="lineno">345</span><span class="comment" id="4889185">//&nbsp;&nbsp;&nbsp;&nbspTransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="4889205">//&nbsp;&nbsp;&nbsp;&nbspBody</span><br>
<span class="lineno"></span><span class="comment" id="4889213">//</span><br>
<span class="lineno"></span><span class="comment" id="4889216">//&nbsp;If&nbsp;Body&nbsp;is&nbsp;present,&nbsp;Content-Length&nbsp;is&nbsp;&lt;=&nbsp;0&nbsp;and&nbsp;TransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="4889283">//&nbsp;hasn&#39;t&nbsp;been&nbsp;set&nbsp;to&nbsp;&#34;identity&#34;,&nbsp;Write&nbsp;adds&nbsp;&#34;Transfer-Encoding:</span><br>
<span class="lineno">350</span><span class="comment" id="4889348">//&nbsp;chunked&#34;&nbsp;to&nbsp;the&nbsp;header.&nbsp;Body&nbsp;is&nbsp;closed&nbsp;after&nbsp;it&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="4889408">func</span>&nbsp;<span class="op" id="4889413">(</span><span class="ident" id="4889414">r</span>&nbsp;<span class="op" id="4889416">*</span><span class="ident" id="4889417">Request</span><span class="op" id="4889424">)</span>&nbsp;<span class="ident" id="4889426">Write</span><span class="op" id="4889431">(</span><span class="ident" id="4889432">w</span>&nbsp;<span class="ident" id="4889434">io</span><span class="op" id="4889436">.</span><span class="ident" id="4889437">Writer</span><span class="op" id="4889443">)</span>&nbsp;<span class="builtintype" id="4889445">error</span>&nbsp;<span class="op" id="4889451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4889454">return</span>&nbsp;<span class="ident" id="4889461">r</span><span class="op" id="4889462">.</span><span class="ident" id="4889463">write</span><span class="op" id="4889468">(</span><span class="ident" id="4889469">w</span><span class="op" id="4889470">,</span>&nbsp;<span class="builtintype" id="4889472">false</span><span class="op" id="4889477">,</span>&nbsp;<span class="ident" id="4889479">nil</span><span class="op" id="4889482">)</span><br>
<span class="lineno"></span><span class="op" id="4889484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="4889487">//&nbsp;WriteProxy&nbsp;is&nbsp;like&nbsp;Write&nbsp;but&nbsp;writes&nbsp;the&nbsp;request&nbsp;in&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="4889550">//&nbsp;expected&nbsp;by&nbsp;an&nbsp;HTTP&nbsp;proxy.&nbsp;&nbsp;In&nbsp;particular,&nbsp;WriteProxy&nbsp;writes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4889618">//&nbsp;initial&nbsp;Request-URI&nbsp;line&nbsp;of&nbsp;the&nbsp;request&nbsp;with&nbsp;an&nbsp;absolute&nbsp;URI,&nbsp;per</span><br>
<span class="lineno"></span><span class="comment" id="4889687">//&nbsp;section&nbsp;5.1.2&nbsp;of&nbsp;RFC&nbsp;2616,&nbsp;including&nbsp;the&nbsp;scheme&nbsp;and&nbsp;host.</span><br>
<span class="lineno"></span><span class="comment" id="4889748">//&nbsp;In&nbsp;either&nbsp;case,&nbsp;WriteProxy&nbsp;also&nbsp;writes&nbsp;a&nbsp;Host&nbsp;header,&nbsp;using</span><br>
<span class="lineno">360</span><span class="comment" id="4889811">//&nbsp;either&nbsp;r.Host&nbsp;or&nbsp;r.URL.Host.</span><br>
<span class="lineno"></span><span class="keyword" id="4889843">func</span>&nbsp;<span class="op" id="4889848">(</span><span class="ident" id="4889849">r</span>&nbsp;<span class="op" id="4889851">*</span><span class="ident" id="4889852">Request</span><span class="op" id="4889859">)</span>&nbsp;<span class="ident" id="4889861">WriteProxy</span><span class="op" id="4889871">(</span><span class="ident" id="4889872">w</span>&nbsp;<span class="ident" id="4889874">io</span><span class="op" id="4889876">.</span><span class="ident" id="4889877">Writer</span><span class="op" id="4889883">)</span>&nbsp;<span class="builtintype" id="4889885">error</span>&nbsp;<span class="op" id="4889891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4889894">return</span>&nbsp;<span class="ident" id="4889901">r</span><span class="op" id="4889902">.</span><span class="ident" id="4889903">write</span><span class="op" id="4889908">(</span><span class="ident" id="4889909">w</span><span class="op" id="4889910">,</span>&nbsp;<span class="builtintype" id="4889912">true</span><span class="op" id="4889916">,</span>&nbsp;<span class="ident" id="4889918">nil</span><span class="op" id="4889921">)</span><br>
<span class="lineno"></span><span class="op" id="4889923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="comment" id="4889926">//&nbsp;extraHeaders&nbsp;may&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span><span class="keyword" id="4889953">func</span>&nbsp;<span class="op" id="4889958">(</span><span class="ident" id="4889959">req</span>&nbsp;<span class="op" id="4889963">*</span><span class="ident" id="4889964">Request</span><span class="op" id="4889971">)</span>&nbsp;<span class="ident" id="4889973">write</span><span class="op" id="4889978">(</span><span class="ident" id="4889979">w</span>&nbsp;<span class="ident" id="4889981">io</span><span class="op" id="4889983">.</span><span class="ident" id="4889984">Writer</span><span class="op" id="4889990">,</span>&nbsp;<span class="ident" id="4889992">usingProxy</span>&nbsp;<span class="builtintype" id="4890003">bool</span><span class="op" id="4890007">,</span>&nbsp;<span class="ident" id="4890009">extraHeaders</span>&nbsp;<span class="ident" id="4890022">Header</span><span class="op" id="4890028">)</span>&nbsp;<span class="builtintype" id="4890030">error</span>&nbsp;<span class="op" id="4890036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890039">host</span>&nbsp;<span class="op" id="4890044">:=</span>&nbsp;<span class="ident" id="4890047">req</span><span class="op" id="4890050">.</span><span class="ident" id="4890051">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4890057">if</span>&nbsp;<span class="ident" id="4890060">host</span>&nbsp;<span class="op" id="4890065">==</span>&nbsp;<span class="string" id="4890068">&#34;&#34;</span>&nbsp;<span class="op" id="4890071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4890075">if</span>&nbsp;<span class="ident" id="4890078">req</span><span class="op" id="4890081">.</span><span class="ident" id="4890082">URL</span>&nbsp;<span class="op" id="4890086">==</span>&nbsp;<span class="ident" id="4890089">nil</span>&nbsp;<span class="op" id="4890093">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4890098">return</span>&nbsp;<span class="ident" id="4890105">errors</span><span class="op" id="4890111">.</span><span class="ident" id="4890112">New</span><span class="op" id="4890115">(</span><span class="string" id="4890116">&#34;http:&nbsp;Request.Write&nbsp;on&nbsp;Request&nbsp;with&nbsp;no&nbsp;Host&nbsp;or&nbsp;URL&nbsp;set&#34;</span><span class="op" id="4890172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4890176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890180">host</span>&nbsp;<span class="op" id="4890185">=</span>&nbsp;<span class="ident" id="4890187">req</span><span class="op" id="4890190">.</span><span class="ident" id="4890191">URL</span><span class="op" id="4890194">.</span><span class="ident" id="4890195">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4890201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890205">ruri</span>&nbsp;<span class="op" id="4890210">:=</span>&nbsp;<span class="ident" id="4890213">req</span><span class="op" id="4890216">.</span><span class="ident" id="4890217">URL</span><span class="op" id="4890220">.</span><span class="ident" id="4890221">RequestURI</span><span class="op" id="4890231">(</span><span class="op" id="4890232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4890235">if</span>&nbsp;<span class="ident" id="4890238">usingProxy</span>&nbsp;<span class="op" id="4890249">&amp;&amp;</span>&nbsp;<span class="ident" id="4890252">req</span><span class="op" id="4890255">.</span><span class="ident" id="4890256">URL</span><span class="op" id="4890259">.</span><span class="ident" id="4890260">Scheme</span>&nbsp;<span class="op" id="4890267">!=</span>&nbsp;<span class="string" id="4890270">&#34;&#34;</span>&nbsp;<span class="op" id="4890273">&amp;&amp;</span>&nbsp;<span class="ident" id="4890276">req</span><span class="op" id="4890279">.</span><span class="ident" id="4890280">URL</span><span class="op" id="4890283">.</span><span class="ident" id="4890284">Opaque</span>&nbsp;<span class="op" id="4890291">==</span>&nbsp;<span class="string" id="4890294">&#34;&#34;</span>&nbsp;<span class="op" id="4890297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890301">ruri</span>&nbsp;<span class="op" id="4890306">=</span>&nbsp;<span class="ident" id="4890308">req</span><span class="op" id="4890311">.</span><span class="ident" id="4890312">URL</span><span class="op" id="4890315">.</span><span class="ident" id="4890316">Scheme</span>&nbsp;<span class="op" id="4890323">+</span>&nbsp;<span class="string" id="4890325">&#34;://&#34;</span>&nbsp;<span class="op" id="4890331">+</span>&nbsp;<span class="ident" id="4890333">host</span>&nbsp;<span class="op" id="4890338">+</span>&nbsp;<span class="ident" id="4890340">ruri</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4890346">}</span>&nbsp;<span class="keyword" id="4890348">else</span>&nbsp;<span class="keyword" id="4890353">if</span>&nbsp;<span class="ident" id="4890356">req</span><span class="op" id="4890359">.</span><span class="ident" id="4890360">Method</span>&nbsp;<span class="op" id="4890367">==</span>&nbsp;<span class="string" id="4890370">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="4890380">&amp;&amp;</span>&nbsp;<span class="ident" id="4890383">req</span><span class="op" id="4890386">.</span><span class="ident" id="4890387">URL</span><span class="op" id="4890390">.</span><span class="ident" id="4890391">Path</span>&nbsp;<span class="op" id="4890396">==</span>&nbsp;<span class="string" id="4890399">&#34;&#34;</span>&nbsp;<span class="op" id="4890402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4890406">//&nbsp;CONNECT&nbsp;requests&nbsp;normally&nbsp;give&nbsp;just&nbsp;the&nbsp;host&nbsp;and&nbsp;port,&nbsp;not&nbsp;a&nbsp;full&nbsp;URL.</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890482">ruri</span>&nbsp;<span class="op" id="4890487">=</span>&nbsp;<span class="ident" id="4890489">host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4890495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4890498">//&nbsp;TODO(bradfitz):&nbsp;escape&nbsp;at&nbsp;least&nbsp;newlines&nbsp;in&nbsp;ruri?</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4890553">//&nbsp;Wrap&nbsp;the&nbsp;writer&nbsp;in&nbsp;a&nbsp;bufio&nbsp;Writer&nbsp;if&nbsp;it&#39;s&nbsp;not&nbsp;already&nbsp;buffered.</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4890621">//&nbsp;Don&#39;t&nbsp;always&nbsp;call&nbsp;NewWriter,&nbsp;as&nbsp;that&nbsp;forces&nbsp;a&nbsp;bytes.Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4890684">//&nbsp;and&nbsp;other&nbsp;small&nbsp;bufio&nbsp;Writers&nbsp;to&nbsp;have&nbsp;a&nbsp;minimum&nbsp;4k&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4890746">//&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4890756">var</span>&nbsp;<span class="ident" id="4890760">bw</span>&nbsp;<span class="op" id="4890763">*</span><span class="ident" id="4890764">bufio</span><span class="op" id="4890769">.</span><span class="ident" id="4890770">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4890778">if</span>&nbsp;<span class="ident" id="4890781">_</span><span class="op" id="4890782">,</span>&nbsp;<span class="ident" id="4890784">ok</span>&nbsp;<span class="op" id="4890787">:=</span>&nbsp;<span class="ident" id="4890790">w</span><span class="op" id="4890791">.</span><span class="op" id="4890792">(</span><span class="ident" id="4890793">io</span><span class="op" id="4890795">.</span><span class="ident" id="4890796">ByteWriter</span><span class="op" id="4890806">)</span><span class="op" id="4890807">;</span>&nbsp;<span class="op" id="4890809">!</span><span class="ident" id="4890810">ok</span>&nbsp;<span class="op" id="4890813">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890817">bw</span>&nbsp;<span class="op" id="4890820">=</span>&nbsp;<span class="ident" id="4890822">bufio</span><span class="op" id="4890827">.</span><span class="ident" id="4890828">NewWriter</span><span class="op" id="4890837">(</span><span class="ident" id="4890838">w</span><span class="op" id="4890839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890843">w</span>&nbsp;<span class="op" id="4890845">=</span>&nbsp;<span class="ident" id="4890847">bw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4890851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890855">_</span><span class="op" id="4890856">,</span>&nbsp;<span class="ident" id="4890858">err</span>&nbsp;<span class="op" id="4890862">:=</span>&nbsp;<span class="ident" id="4890865">fmt</span><span class="op" id="4890868">.</span><span class="ident" id="4890869">Fprintf</span><span class="op" id="4890876">(</span><span class="ident" id="4890877">w</span><span class="op" id="4890878">,</span>&nbsp;<span class="string" id="4890880">&#34;%s&nbsp;%s&nbsp;HTTP/1.1\r\n&#34;</span><span class="op" id="4890900">,</span>&nbsp;<span class="ident" id="4890902">valueOrDefault</span><span class="op" id="4890916">(</span><span class="ident" id="4890917">req</span><span class="op" id="4890920">.</span><span class="ident" id="4890921">Method</span><span class="op" id="4890927">,</span>&nbsp;<span class="string" id="4890929">&#34;GET&#34;</span><span class="op" id="4890934">)</span><span class="op" id="4890935">,</span>&nbsp;<span class="ident" id="4890937">ruri</span><span class="op" id="4890941">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4890944">if</span>&nbsp;<span class="ident" id="4890947">err</span>&nbsp;<span class="op" id="4890951">!=</span>&nbsp;<span class="ident" id="4890954">nil</span>&nbsp;<span class="op" id="4890958">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4890962">return</span>&nbsp;<span class="ident" id="4890969">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4890974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4890978">//&nbsp;Header&nbsp;lines</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4890995">_</span><span class="op" id="4890996">,</span>&nbsp;<span class="ident" id="4890998">err</span>&nbsp;<span class="op" id="4891002">=</span>&nbsp;<span class="ident" id="4891004">fmt</span><span class="op" id="4891007">.</span><span class="ident" id="4891008">Fprintf</span><span class="op" id="4891015">(</span><span class="ident" id="4891016">w</span><span class="op" id="4891017">,</span>&nbsp;<span class="string" id="4891019">&#34;Host:&nbsp;%s\r\n&#34;</span><span class="op" id="4891033">,</span>&nbsp;<span class="ident" id="4891035">host</span><span class="op" id="4891039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891042">if</span>&nbsp;<span class="ident" id="4891045">err</span>&nbsp;<span class="op" id="4891049">!=</span>&nbsp;<span class="ident" id="4891052">nil</span>&nbsp;<span class="op" id="4891056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891060">return</span>&nbsp;<span class="ident" id="4891067">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4891072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4891076">//&nbsp;Use&nbsp;the&nbsp;defaultUserAgent&nbsp;unless&nbsp;the&nbsp;Header&nbsp;contains&nbsp;one,&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4891143">//&nbsp;may&nbsp;be&nbsp;blank&nbsp;to&nbsp;not&nbsp;send&nbsp;the&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891184">userAgent</span>&nbsp;<span class="op" id="4891194">:=</span>&nbsp;<span class="ident" id="4891197">defaultUserAgent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891215">if</span>&nbsp;<span class="ident" id="4891218">req</span><span class="op" id="4891221">.</span><span class="ident" id="4891222">Header</span>&nbsp;<span class="op" id="4891229">!=</span>&nbsp;<span class="ident" id="4891232">nil</span>&nbsp;<span class="op" id="4891236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891240">if</span>&nbsp;<span class="ident" id="4891243">ua</span>&nbsp;<span class="op" id="4891246">:=</span>&nbsp;<span class="ident" id="4891249">req</span><span class="op" id="4891252">.</span><span class="ident" id="4891253">Header</span><span class="op" id="4891259">[</span><span class="string" id="4891260">&#34;User-Agent&#34;</span><span class="op" id="4891272">]</span><span class="op" id="4891273">;</span>&nbsp;<span class="builtinfunc" id="4891275">len</span><span class="op" id="4891278">(</span><span class="ident" id="4891279">ua</span><span class="op" id="4891281">)</span>&nbsp;<span class="op" id="4891283">&gt;</span>&nbsp;<span class="num" id="4891285">0</span>&nbsp;<span class="op" id="4891287">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891292">userAgent</span>&nbsp;<span class="op" id="4891302">=</span>&nbsp;<span class="ident" id="4891304">ua</span><span class="op" id="4891306">[</span><span class="num" id="4891307">0</span><span class="op" id="4891308">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4891312">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4891315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891318">if</span>&nbsp;<span class="ident" id="4891321">userAgent</span>&nbsp;<span class="op" id="4891331">!=</span>&nbsp;<span class="string" id="4891334">&#34;&#34;</span>&nbsp;<span class="op" id="4891337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891341">_</span><span class="op" id="4891342">,</span>&nbsp;<span class="ident" id="4891344">err</span>&nbsp;<span class="op" id="4891348">=</span>&nbsp;<span class="ident" id="4891350">fmt</span><span class="op" id="4891353">.</span><span class="ident" id="4891354">Fprintf</span><span class="op" id="4891361">(</span><span class="ident" id="4891362">w</span><span class="op" id="4891363">,</span>&nbsp;<span class="string" id="4891365">&#34;User-Agent:&nbsp;%s\r\n&#34;</span><span class="op" id="4891385">,</span>&nbsp;<span class="ident" id="4891387">userAgent</span><span class="op" id="4891396">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891400">if</span>&nbsp;<span class="ident" id="4891403">err</span>&nbsp;<span class="op" id="4891407">!=</span>&nbsp;<span class="ident" id="4891410">nil</span>&nbsp;<span class="op" id="4891414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891419">return</span>&nbsp;<span class="ident" id="4891426">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4891432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4891435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4891439">//&nbsp;Process&nbsp;Body,ContentLength,Close,Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891484">tw</span><span class="op" id="4891486">,</span>&nbsp;<span class="ident" id="4891488">err</span>&nbsp;<span class="op" id="4891492">:=</span>&nbsp;<span class="ident" id="4891495">newTransferWriter</span><span class="op" id="4891512">(</span><span class="ident" id="4891513">req</span><span class="op" id="4891516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891519">if</span>&nbsp;<span class="ident" id="4891522">err</span>&nbsp;<span class="op" id="4891526">!=</span>&nbsp;<span class="ident" id="4891529">nil</span>&nbsp;<span class="op" id="4891533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891537">return</span>&nbsp;<span class="ident" id="4891544">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4891549">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891552">err</span>&nbsp;<span class="op" id="4891556">=</span>&nbsp;<span class="ident" id="4891558">tw</span><span class="op" id="4891560">.</span><span class="ident" id="4891561">WriteHeader</span><span class="op" id="4891572">(</span><span class="ident" id="4891573">w</span><span class="op" id="4891574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891577">if</span>&nbsp;<span class="ident" id="4891580">err</span>&nbsp;<span class="op" id="4891584">!=</span>&nbsp;<span class="ident" id="4891587">nil</span>&nbsp;<span class="op" id="4891591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891595">return</span>&nbsp;<span class="ident" id="4891602">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4891607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891611">err</span>&nbsp;<span class="op" id="4891615">=</span>&nbsp;<span class="ident" id="4891617">req</span><span class="op" id="4891620">.</span><span class="ident" id="4891621">Header</span><span class="op" id="4891627">.</span><span class="ident" id="4891628">WriteSubset</span><span class="op" id="4891639">(</span><span class="ident" id="4891640">w</span><span class="op" id="4891641">,</span>&nbsp;<span class="ident" id="4891643">reqWriteExcludeHeader</span><span class="op" id="4891664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891667">if</span>&nbsp;<span class="ident" id="4891670">err</span>&nbsp;<span class="op" id="4891674">!=</span>&nbsp;<span class="ident" id="4891677">nil</span>&nbsp;<span class="op" id="4891681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891685">return</span>&nbsp;<span class="ident" id="4891692">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4891697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891701">if</span>&nbsp;<span class="ident" id="4891704">extraHeaders</span>&nbsp;<span class="op" id="4891717">!=</span>&nbsp;<span class="ident" id="4891720">nil</span>&nbsp;<span class="op" id="4891724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891728">err</span>&nbsp;<span class="op" id="4891732">=</span>&nbsp;<span class="ident" id="4891734">extraHeaders</span><span class="op" id="4891746">.</span><span class="ident" id="4891747">Write</span><span class="op" id="4891752">(</span><span class="ident" id="4891753">w</span><span class="op" id="4891754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891758">if</span>&nbsp;<span class="ident" id="4891761">err</span>&nbsp;<span class="op" id="4891765">!=</span>&nbsp;<span class="ident" id="4891768">nil</span>&nbsp;<span class="op" id="4891772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891777">return</span>&nbsp;<span class="ident" id="4891784">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4891790">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4891793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891797">_</span><span class="op" id="4891798">,</span>&nbsp;<span class="ident" id="4891800">err</span>&nbsp;<span class="op" id="4891804">=</span>&nbsp;<span class="ident" id="4891806">io</span><span class="op" id="4891808">.</span><span class="ident" id="4891809">WriteString</span><span class="op" id="4891820">(</span><span class="ident" id="4891821">w</span><span class="op" id="4891822">,</span>&nbsp;<span class="string" id="4891824">&#34;\r\n&#34;</span><span class="op" id="4891830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891833">if</span>&nbsp;<span class="ident" id="4891836">err</span>&nbsp;<span class="op" id="4891840">!=</span>&nbsp;<span class="ident" id="4891843">nil</span>&nbsp;<span class="op" id="4891847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891851">return</span>&nbsp;<span class="ident" id="4891858">err</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4891863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4891867">//&nbsp;Write&nbsp;body&nbsp;and&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4891894">err</span>&nbsp;<span class="op" id="4891898">=</span>&nbsp;<span class="ident" id="4891900">tw</span><span class="op" id="4891902">.</span><span class="ident" id="4891903">WriteBody</span><span class="op" id="4891912">(</span><span class="ident" id="4891913">w</span><span class="op" id="4891914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891917">if</span>&nbsp;<span class="ident" id="4891920">err</span>&nbsp;<span class="op" id="4891924">!=</span>&nbsp;<span class="ident" id="4891927">nil</span>&nbsp;<span class="op" id="4891931">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891935">return</span>&nbsp;<span class="ident" id="4891942">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4891947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891951">if</span>&nbsp;<span class="ident" id="4891954">bw</span>&nbsp;<span class="op" id="4891957">!=</span>&nbsp;<span class="ident" id="4891960">nil</span>&nbsp;<span class="op" id="4891964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891968">return</span>&nbsp;<span class="ident" id="4891975">bw</span><span class="op" id="4891977">.</span><span class="ident" id="4891978">Flush</span><span class="op" id="4891983">(</span><span class="op" id="4891984">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4891987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4891990">return</span>&nbsp;<span class="ident" id="4891997">nil</span><br>
<span class="lineno"></span><span class="op" id="4892001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4892004">//&nbsp;ParseHTTPVersion&nbsp;parses&nbsp;a&nbsp;HTTP&nbsp;version&nbsp;string.</span><br>
<span class="lineno">460</span><span class="comment" id="4892054">//&nbsp;&#34;HTTP/1.0&#34;&nbsp;returns&nbsp;(1,&nbsp;0,&nbsp;true).</span><br>
<span class="lineno"></span><span class="keyword" id="4892090">func</span>&nbsp;<span class="ident" id="4892095">ParseHTTPVersion</span><span class="op" id="4892111">(</span><span class="ident" id="4892112">vers</span>&nbsp;<span class="builtintype" id="4892117">string</span><span class="op" id="4892123">)</span>&nbsp;<span class="op" id="4892125">(</span><span class="ident" id="4892126">major</span><span class="op" id="4892131">,</span>&nbsp;<span class="ident" id="4892133">minor</span>&nbsp;<span class="builtintype" id="4892139">int</span><span class="op" id="4892142">,</span>&nbsp;<span class="ident" id="4892144">ok</span>&nbsp;<span class="builtintype" id="4892147">bool</span><span class="op" id="4892151">)</span>&nbsp;<span class="op" id="4892153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892156">const</span>&nbsp;<span class="ident" id="4892162">Big</span>&nbsp;<span class="op" id="4892166">=</span>&nbsp;<span class="num" id="4892168">1000000</span>&nbsp;<span class="comment" id="4892176">//&nbsp;arbitrary&nbsp;upper&nbsp;bound</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892202">switch</span>&nbsp;<span class="ident" id="4892209">vers</span>&nbsp;<span class="op" id="4892214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892217">case</span>&nbsp;<span class="string" id="4892222">&#34;HTTP/1.1&#34;</span><span class="op" id="4892232">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892236">return</span>&nbsp;<span class="num" id="4892243">1</span><span class="op" id="4892244">,</span>&nbsp;<span class="num" id="4892246">1</span><span class="op" id="4892247">,</span>&nbsp;<span class="builtintype" id="4892249">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892255">case</span>&nbsp;<span class="string" id="4892260">&#34;HTTP/1.0&#34;</span><span class="op" id="4892270">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892274">return</span>&nbsp;<span class="num" id="4892281">1</span><span class="op" id="4892282">,</span>&nbsp;<span class="num" id="4892284">0</span><span class="op" id="4892285">,</span>&nbsp;<span class="builtintype" id="4892287">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4892293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892296">if</span>&nbsp;<span class="op" id="4892299">!</span><span class="ident" id="4892300">strings</span><span class="op" id="4892307">.</span><span class="ident" id="4892308">HasPrefix</span><span class="op" id="4892317">(</span><span class="ident" id="4892318">vers</span><span class="op" id="4892322">,</span>&nbsp;<span class="string" id="4892324">&#34;HTTP/&#34;</span><span class="op" id="4892331">)</span>&nbsp;<span class="op" id="4892333">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892337">return</span>&nbsp;<span class="num" id="4892344">0</span><span class="op" id="4892345">,</span>&nbsp;<span class="num" id="4892347">0</span><span class="op" id="4892348">,</span>&nbsp;<span class="builtintype" id="4892350">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4892357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892360">dot</span>&nbsp;<span class="op" id="4892364">:=</span>&nbsp;<span class="ident" id="4892367">strings</span><span class="op" id="4892374">.</span><span class="ident" id="4892375">Index</span><span class="op" id="4892380">(</span><span class="ident" id="4892381">vers</span><span class="op" id="4892385">,</span>&nbsp;<span class="string" id="4892387">&#34;.&#34;</span><span class="op" id="4892390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892393">if</span>&nbsp;<span class="ident" id="4892396">dot</span>&nbsp;<span class="op" id="4892400">&lt;</span>&nbsp;<span class="num" id="4892402">0</span>&nbsp;<span class="op" id="4892404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892408">return</span>&nbsp;<span class="num" id="4892415">0</span><span class="op" id="4892416">,</span>&nbsp;<span class="num" id="4892418">0</span><span class="op" id="4892419">,</span>&nbsp;<span class="builtintype" id="4892421">false</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4892428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892431">major</span><span class="op" id="4892436">,</span>&nbsp;<span class="ident" id="4892438">err</span>&nbsp;<span class="op" id="4892442">:=</span>&nbsp;<span class="ident" id="4892445">strconv</span><span class="op" id="4892452">.</span><span class="ident" id="4892453">Atoi</span><span class="op" id="4892457">(</span><span class="ident" id="4892458">vers</span><span class="op" id="4892462">[</span><span class="num" id="4892463">5</span><span class="op" id="4892464">:</span><span class="ident" id="4892465">dot</span><span class="op" id="4892468">]</span><span class="op" id="4892469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892472">if</span>&nbsp;<span class="ident" id="4892475">err</span>&nbsp;<span class="op" id="4892479">!=</span>&nbsp;<span class="ident" id="4892482">nil</span>&nbsp;<span class="op" id="4892486">||</span>&nbsp;<span class="ident" id="4892489">major</span>&nbsp;<span class="op" id="4892495">&lt;</span>&nbsp;<span class="num" id="4892497">0</span>&nbsp;<span class="op" id="4892499">||</span>&nbsp;<span class="ident" id="4892502">major</span>&nbsp;<span class="op" id="4892508">&gt;</span>&nbsp;<span class="ident" id="4892510">Big</span>&nbsp;<span class="op" id="4892514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892518">return</span>&nbsp;<span class="num" id="4892525">0</span><span class="op" id="4892526">,</span>&nbsp;<span class="num" id="4892528">0</span><span class="op" id="4892529">,</span>&nbsp;<span class="builtintype" id="4892531">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4892538">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4892541">minor</span><span class="op" id="4892546">,</span>&nbsp;<span class="ident" id="4892548">err</span>&nbsp;<span class="op" id="4892552">=</span>&nbsp;<span class="ident" id="4892554">strconv</span><span class="op" id="4892561">.</span><span class="ident" id="4892562">Atoi</span><span class="op" id="4892566">(</span><span class="ident" id="4892567">vers</span><span class="op" id="4892571">[</span><span class="ident" id="4892572">dot</span><span class="op" id="4892575">+</span><span class="num" id="4892576">1</span><span class="op" id="4892577">:</span><span class="op" id="4892578">]</span><span class="op" id="4892579">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892582">if</span>&nbsp;<span class="ident" id="4892585">err</span>&nbsp;<span class="op" id="4892589">!=</span>&nbsp;<span class="ident" id="4892592">nil</span>&nbsp;<span class="op" id="4892596">||</span>&nbsp;<span class="ident" id="4892599">minor</span>&nbsp;<span class="op" id="4892605">&lt;</span>&nbsp;<span class="num" id="4892607">0</span>&nbsp;<span class="op" id="4892609">||</span>&nbsp;<span class="ident" id="4892612">minor</span>&nbsp;<span class="op" id="4892618">&gt;</span>&nbsp;<span class="ident" id="4892620">Big</span>&nbsp;<span class="op" id="4892624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892628">return</span>&nbsp;<span class="num" id="4892635">0</span><span class="op" id="4892636">,</span>&nbsp;<span class="num" id="4892638">0</span><span class="op" id="4892639">,</span>&nbsp;<span class="builtintype" id="4892641">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4892648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4892651">return</span>&nbsp;<span class="ident" id="4892658">major</span><span class="op" id="4892663">,</span>&nbsp;<span class="ident" id="4892665">minor</span><span class="op" id="4892670">,</span>&nbsp;<span class="builtintype" id="4892672">true</span><br>
<span class="lineno">485</span><span class="op" id="4892677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4892680">//&nbsp;NewRequest&nbsp;returns&nbsp;a&nbsp;new&nbsp;Request&nbsp;given&nbsp;a&nbsp;method,&nbsp;URL,&nbsp;and&nbsp;optional&nbsp;body.</span><br>
<span class="lineno"></span><span class="comment" id="4892756">//</span><br>
<span class="lineno"></span><span class="comment" id="4892759">//&nbsp;If&nbsp;the&nbsp;provided&nbsp;body&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer,&nbsp;the&nbsp;returned</span><br>
<span class="lineno">490</span><span class="comment" id="4892818">//&nbsp;Request.Body&nbsp;is&nbsp;set&nbsp;to&nbsp;body&nbsp;and&nbsp;will&nbsp;be&nbsp;closed&nbsp;by&nbsp;the&nbsp;Client</span><br>
<span class="lineno"></span><span class="comment" id="4892882">//&nbsp;methods&nbsp;Do,&nbsp;Post,&nbsp;and&nbsp;PostForm,&nbsp;and&nbsp;Transport.RoundTrip.</span><br>
<span class="lineno"></span><span class="keyword" id="4892942">func</span>&nbsp;<span class="ident" id="4892947">NewRequest</span><span class="op" id="4892957">(</span><span class="ident" id="4892958">method</span><span class="op" id="4892964">,</span>&nbsp;<span class="ident" id="4892966">urlStr</span>&nbsp;<span class="builtintype" id="4892973">string</span><span class="op" id="4892979">,</span>&nbsp;<span class="ident" id="4892981">body</span>&nbsp;<span class="ident" id="4892986">io</span><span class="op" id="4892988">.</span><span class="ident" id="4892989">Reader</span><span class="op" id="4892995">)</span>&nbsp;<span class="op" id="4892997">(</span><span class="op" id="4892998">*</span><span class="ident" id="4892999">Request</span><span class="op" id="4893006">,</span>&nbsp;<span class="builtintype" id="4893008">error</span><span class="op" id="4893013">)</span>&nbsp;<span class="op" id="4893015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893018">u</span><span class="op" id="4893019">,</span>&nbsp;<span class="ident" id="4893021">err</span>&nbsp;<span class="op" id="4893025">:=</span>&nbsp;<span class="ident" id="4893028">url</span><span class="op" id="4893031">.</span><span class="ident" id="4893032">Parse</span><span class="op" id="4893037">(</span><span class="ident" id="4893038">urlStr</span><span class="op" id="4893044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893047">if</span>&nbsp;<span class="ident" id="4893050">err</span>&nbsp;<span class="op" id="4893054">!=</span>&nbsp;<span class="ident" id="4893057">nil</span>&nbsp;<span class="op" id="4893061">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893065">return</span>&nbsp;<span class="ident" id="4893072">nil</span><span class="op" id="4893075">,</span>&nbsp;<span class="ident" id="4893077">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4893082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893085">rc</span><span class="op" id="4893087">,</span>&nbsp;<span class="ident" id="4893089">ok</span>&nbsp;<span class="op" id="4893092">:=</span>&nbsp;<span class="ident" id="4893095">body</span><span class="op" id="4893099">.</span><span class="op" id="4893100">(</span><span class="ident" id="4893101">io</span><span class="op" id="4893103">.</span><span class="ident" id="4893104">ReadCloser</span><span class="op" id="4893114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893117">if</span>&nbsp;<span class="op" id="4893120">!</span><span class="ident" id="4893121">ok</span>&nbsp;<span class="op" id="4893124">&amp;&amp;</span>&nbsp;<span class="ident" id="4893127">body</span>&nbsp;<span class="op" id="4893132">!=</span>&nbsp;<span class="ident" id="4893135">nil</span>&nbsp;<span class="op" id="4893139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893143">rc</span>&nbsp;<span class="op" id="4893146">=</span>&nbsp;<span class="ident" id="4893148">ioutil</span><span class="op" id="4893154">.</span><span class="ident" id="4893155">NopCloser</span><span class="op" id="4893164">(</span><span class="ident" id="4893165">body</span><span class="op" id="4893169">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4893172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893175">req</span>&nbsp;<span class="op" id="4893179">:=</span>&nbsp;<span class="op" id="4893182">&amp;</span><span class="ident" id="4893183">Request</span><span class="op" id="4893190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893194">Method</span><span class="op" id="4893200">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4893206">method</span><span class="op" id="4893212">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893216">URL</span><span class="op" id="4893219">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4893228">u</span><span class="op" id="4893229">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893233">Proto</span><span class="op" id="4893238">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4893245">&#34;HTTP/1.1&#34;</span><span class="op" id="4893255">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893259">ProtoMajor</span><span class="op" id="4893269">:</span>&nbsp;<span class="num" id="4893271">1</span><span class="op" id="4893272">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893276">ProtoMinor</span><span class="op" id="4893286">:</span>&nbsp;<span class="num" id="4893288">1</span><span class="op" id="4893289">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893293">Header</span><span class="op" id="4893299">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4893305">make</span><span class="op" id="4893309">(</span><span class="ident" id="4893310">Header</span><span class="op" id="4893316">)</span><span class="op" id="4893317">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893321">Body</span><span class="op" id="4893325">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4893333">rc</span><span class="op" id="4893335">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893339">Host</span><span class="op" id="4893343">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4893351">u</span><span class="op" id="4893352">.</span><span class="ident" id="4893353">Host</span><span class="op" id="4893357">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4893360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893363">if</span>&nbsp;<span class="ident" id="4893366">body</span>&nbsp;<span class="op" id="4893371">!=</span>&nbsp;<span class="ident" id="4893374">nil</span>&nbsp;<span class="op" id="4893378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893382">switch</span>&nbsp;<span class="ident" id="4893389">v</span>&nbsp;<span class="op" id="4893391">:=</span>&nbsp;<span class="ident" id="4893394">body</span><span class="op" id="4893398">.</span><span class="op" id="4893399">(</span><span class="keyword" id="4893400">type</span><span class="op" id="4893404">)</span>&nbsp;<span class="op" id="4893406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893410">case</span>&nbsp;<span class="op" id="4893415">*</span><span class="ident" id="4893416">bytes</span><span class="op" id="4893421">.</span><span class="ident" id="4893422">Buffer</span><span class="op" id="4893428">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893433">req</span><span class="op" id="4893436">.</span><span class="ident" id="4893437">ContentLength</span>&nbsp;<span class="op" id="4893451">=</span>&nbsp;<span class="ident" id="4893453">int64</span><span class="op" id="4893458">(</span><span class="ident" id="4893459">v</span><span class="op" id="4893460">.</span><span class="ident" id="4893461">Len</span><span class="op" id="4893464">(</span><span class="op" id="4893465">)</span><span class="op" id="4893466">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893470">case</span>&nbsp;<span class="op" id="4893475">*</span><span class="ident" id="4893476">bytes</span><span class="op" id="4893481">.</span><span class="ident" id="4893482">Reader</span><span class="op" id="4893488">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893493">req</span><span class="op" id="4893496">.</span><span class="ident" id="4893497">ContentLength</span>&nbsp;<span class="op" id="4893511">=</span>&nbsp;<span class="ident" id="4893513">int64</span><span class="op" id="4893518">(</span><span class="ident" id="4893519">v</span><span class="op" id="4893520">.</span><span class="ident" id="4893521">Len</span><span class="op" id="4893524">(</span><span class="op" id="4893525">)</span><span class="op" id="4893526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893530">case</span>&nbsp;<span class="op" id="4893535">*</span><span class="ident" id="4893536">strings</span><span class="op" id="4893543">.</span><span class="ident" id="4893544">Reader</span><span class="op" id="4893550">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893555">req</span><span class="op" id="4893558">.</span><span class="ident" id="4893559">ContentLength</span>&nbsp;<span class="op" id="4893573">=</span>&nbsp;<span class="ident" id="4893575">int64</span><span class="op" id="4893580">(</span><span class="ident" id="4893581">v</span><span class="op" id="4893582">.</span><span class="ident" id="4893583">Len</span><span class="op" id="4893586">(</span><span class="op" id="4893587">)</span><span class="op" id="4893588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4893592">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4893595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893599">return</span>&nbsp;<span class="ident" id="4893606">req</span><span class="op" id="4893609">,</span>&nbsp;<span class="ident" id="4893611">nil</span><br>
<span class="lineno"></span><span class="op" id="4893615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span><span class="comment" id="4893618">//&nbsp;BasicAuth&nbsp;returns&nbsp;the&nbsp;username&nbsp;and&nbsp;password&nbsp;provided&nbsp;in&nbsp;the&nbsp;request&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4893691">//&nbsp;Authorization&nbsp;header,&nbsp;if&nbsp;the&nbsp;request&nbsp;uses&nbsp;HTTP&nbsp;Basic&nbsp;Authentication.</span><br>
<span class="lineno"></span><span class="comment" id="4893763">//&nbsp;See&nbsp;RFC&nbsp;2617,&nbsp;Section&nbsp;2.</span><br>
<span class="lineno"></span><span class="keyword" id="4893791">func</span>&nbsp;<span class="op" id="4893796">(</span><span class="ident" id="4893797">r</span>&nbsp;<span class="op" id="4893799">*</span><span class="ident" id="4893800">Request</span><span class="op" id="4893807">)</span>&nbsp;<span class="ident" id="4893809">BasicAuth</span><span class="op" id="4893818">(</span><span class="op" id="4893819">)</span>&nbsp;<span class="op" id="4893821">(</span><span class="ident" id="4893822">username</span><span class="op" id="4893830">,</span>&nbsp;<span class="ident" id="4893832">password</span>&nbsp;<span class="builtintype" id="4893841">string</span><span class="op" id="4893847">,</span>&nbsp;<span class="ident" id="4893849">ok</span>&nbsp;<span class="builtintype" id="4893852">bool</span><span class="op" id="4893856">)</span>&nbsp;<span class="op" id="4893858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4893861">auth</span>&nbsp;<span class="op" id="4893866">:=</span>&nbsp;<span class="ident" id="4893869">r</span><span class="op" id="4893870">.</span><span class="ident" id="4893871">Header</span><span class="op" id="4893877">.</span><span class="ident" id="4893878">Get</span><span class="op" id="4893881">(</span><span class="string" id="4893882">&#34;Authorization&#34;</span><span class="op" id="4893897">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893900">if</span>&nbsp;<span class="ident" id="4893903">auth</span>&nbsp;<span class="op" id="4893908">==</span>&nbsp;<span class="string" id="4893911">&#34;&#34;</span>&nbsp;<span class="op" id="4893914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893918">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4893926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4893929">return</span>&nbsp;<span class="ident" id="4893936">parseBasicAuth</span><span class="op" id="4893950">(</span><span class="ident" id="4893951">auth</span><span class="op" id="4893955">)</span><br>
<span class="lineno"></span><span class="op" id="4893957">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span><span class="comment" id="4893960">//&nbsp;parseBasicAuth&nbsp;parses&nbsp;an&nbsp;HTTP&nbsp;Basic&nbsp;Authentication&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="4894022">//&nbsp;&#34;Basic&nbsp;QWxhZGRpbjpvcGVuIHNlc2FtZQ==&#34;&nbsp;returns&nbsp;(&#34;Aladdin&#34;,&nbsp;&#34;open&nbsp;sesame&#34;,&nbsp;true).</span><br>
<span class="lineno"></span><span class="keyword" id="4894104">func</span>&nbsp;<span class="ident" id="4894109">parseBasicAuth</span><span class="op" id="4894123">(</span><span class="ident" id="4894124">auth</span>&nbsp;<span class="builtintype" id="4894129">string</span><span class="op" id="4894135">)</span>&nbsp;<span class="op" id="4894137">(</span><span class="ident" id="4894138">username</span><span class="op" id="4894146">,</span>&nbsp;<span class="ident" id="4894148">password</span>&nbsp;<span class="builtintype" id="4894157">string</span><span class="op" id="4894163">,</span>&nbsp;<span class="ident" id="4894165">ok</span>&nbsp;<span class="builtintype" id="4894168">bool</span><span class="op" id="4894172">)</span>&nbsp;<span class="op" id="4894174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4894177">if</span>&nbsp;<span class="op" id="4894180">!</span><span class="ident" id="4894181">strings</span><span class="op" id="4894188">.</span><span class="ident" id="4894189">HasPrefix</span><span class="op" id="4894198">(</span><span class="ident" id="4894199">auth</span><span class="op" id="4894203">,</span>&nbsp;<span class="string" id="4894205">&#34;Basic&nbsp;&#34;</span><span class="op" id="4894213">)</span>&nbsp;<span class="op" id="4894215">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4894219">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4894227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894230">c</span><span class="op" id="4894231">,</span>&nbsp;<span class="ident" id="4894233">err</span>&nbsp;<span class="op" id="4894237">:=</span>&nbsp;<span class="ident" id="4894240">base64</span><span class="op" id="4894246">.</span><span class="ident" id="4894247">StdEncoding</span><span class="op" id="4894258">.</span><span class="ident" id="4894259">DecodeString</span><span class="op" id="4894271">(</span><span class="ident" id="4894272">strings</span><span class="op" id="4894279">.</span><span class="ident" id="4894280">TrimPrefix</span><span class="op" id="4894290">(</span><span class="ident" id="4894291">auth</span><span class="op" id="4894295">,</span>&nbsp;<span class="string" id="4894297">&#34;Basic&nbsp;&#34;</span><span class="op" id="4894305">)</span><span class="op" id="4894306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4894309">if</span>&nbsp;<span class="ident" id="4894312">err</span>&nbsp;<span class="op" id="4894316">!=</span>&nbsp;<span class="ident" id="4894319">nil</span>&nbsp;<span class="op" id="4894323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4894327">return</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4894335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894338">cs</span>&nbsp;<span class="op" id="4894341">:=</span>&nbsp;<span class="builtintype" id="4894344">string</span><span class="op" id="4894350">(</span><span class="ident" id="4894351">c</span><span class="op" id="4894352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894355">s</span>&nbsp;<span class="op" id="4894357">:=</span>&nbsp;<span class="ident" id="4894360">strings</span><span class="op" id="4894367">.</span><span class="ident" id="4894368">IndexByte</span><span class="op" id="4894377">(</span><span class="ident" id="4894378">cs</span><span class="op" id="4894380">,</span>&nbsp;<span class="string" id="4894382">&#39;:&#39;</span><span class="op" id="4894385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4894388">if</span>&nbsp;<span class="ident" id="4894391">s</span>&nbsp;<span class="op" id="4894393">&lt;</span>&nbsp;<span class="num" id="4894395">0</span>&nbsp;<span class="op" id="4894397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4894401">return</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4894409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4894412">return</span>&nbsp;<span class="ident" id="4894419">cs</span><span class="op" id="4894421">[</span><span class="op" id="4894422">:</span><span class="ident" id="4894423">s</span><span class="op" id="4894424">]</span><span class="op" id="4894425">,</span>&nbsp;<span class="ident" id="4894427">cs</span><span class="op" id="4894429">[</span><span class="ident" id="4894430">s</span><span class="op" id="4894431">+</span><span class="num" id="4894432">1</span><span class="op" id="4894433">:</span><span class="op" id="4894434">]</span><span class="op" id="4894435">,</span>&nbsp;<span class="builtintype" id="4894437">true</span><br>
<span class="lineno"></span><span class="op" id="4894442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4894445">//&nbsp;SetBasicAuth&nbsp;sets&nbsp;the&nbsp;request&#39;s&nbsp;Authorization&nbsp;header&nbsp;to&nbsp;use&nbsp;HTTP</span><br>
<span class="lineno">555</span><span class="comment" id="4894513">//&nbsp;Basic&nbsp;Authentication&nbsp;with&nbsp;the&nbsp;provided&nbsp;username&nbsp;and&nbsp;password.</span><br>
<span class="lineno"></span><span class="comment" id="4894578">//</span><br>
<span class="lineno"></span><span class="comment" id="4894581">//&nbsp;With&nbsp;HTTP&nbsp;Basic&nbsp;Authentication&nbsp;the&nbsp;provided&nbsp;username&nbsp;and&nbsp;password</span><br>
<span class="lineno"></span><span class="comment" id="4894650">//&nbsp;are&nbsp;not&nbsp;encrypted.</span><br>
<span class="lineno"></span><span class="keyword" id="4894672">func</span>&nbsp;<span class="op" id="4894677">(</span><span class="ident" id="4894678">r</span>&nbsp;<span class="op" id="4894680">*</span><span class="ident" id="4894681">Request</span><span class="op" id="4894688">)</span>&nbsp;<span class="ident" id="4894690">SetBasicAuth</span><span class="op" id="4894702">(</span><span class="ident" id="4894703">username</span><span class="op" id="4894711">,</span>&nbsp;<span class="ident" id="4894713">password</span>&nbsp;<span class="builtintype" id="4894722">string</span><span class="op" id="4894728">)</span>&nbsp;<span class="op" id="4894730">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894733">r</span><span class="op" id="4894734">.</span><span class="ident" id="4894735">Header</span><span class="op" id="4894741">.</span><span class="ident" id="4894742">Set</span><span class="op" id="4894745">(</span><span class="string" id="4894746">&#34;Authorization&#34;</span><span class="op" id="4894761">,</span>&nbsp;<span class="string" id="4894763">&#34;Basic&nbsp;&#34;</span><span class="op" id="4894771">+</span><span class="ident" id="4894772">basicAuth</span><span class="op" id="4894781">(</span><span class="ident" id="4894782">username</span><span class="op" id="4894790">,</span>&nbsp;<span class="ident" id="4894792">password</span><span class="op" id="4894800">)</span><span class="op" id="4894801">)</span><br>
<span class="lineno"></span><span class="op" id="4894803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4894806">//&nbsp;parseRequestLine&nbsp;parses&nbsp;&#34;GET&nbsp;/foo&nbsp;HTTP/1.1&#34;&nbsp;into&nbsp;its&nbsp;three&nbsp;parts.</span><br>
<span class="lineno"></span><span class="keyword" id="4894875">func</span>&nbsp;<span class="ident" id="4894880">parseRequestLine</span><span class="op" id="4894896">(</span><span class="ident" id="4894897">line</span>&nbsp;<span class="builtintype" id="4894902">string</span><span class="op" id="4894908">)</span>&nbsp;<span class="op" id="4894910">(</span><span class="ident" id="4894911">method</span><span class="op" id="4894917">,</span>&nbsp;<span class="ident" id="4894919">requestURI</span><span class="op" id="4894929">,</span>&nbsp;<span class="ident" id="4894931">proto</span>&nbsp;<span class="builtintype" id="4894937">string</span><span class="op" id="4894943">,</span>&nbsp;<span class="ident" id="4894945">ok</span>&nbsp;<span class="builtintype" id="4894948">bool</span><span class="op" id="4894952">)</span>&nbsp;<span class="op" id="4894954">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894957">s1</span>&nbsp;<span class="op" id="4894960">:=</span>&nbsp;<span class="ident" id="4894963">strings</span><span class="op" id="4894970">.</span><span class="ident" id="4894971">Index</span><span class="op" id="4894976">(</span><span class="ident" id="4894977">line</span><span class="op" id="4894981">,</span>&nbsp;<span class="string" id="4894983">&#34;&nbsp;&#34;</span><span class="op" id="4894986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4894989">s2</span>&nbsp;<span class="op" id="4894992">:=</span>&nbsp;<span class="ident" id="4894995">strings</span><span class="op" id="4895002">.</span><span class="ident" id="4895003">Index</span><span class="op" id="4895008">(</span><span class="ident" id="4895009">line</span><span class="op" id="4895013">[</span><span class="ident" id="4895014">s1</span><span class="op" id="4895016">+</span><span class="num" id="4895017">1</span><span class="op" id="4895018">:</span><span class="op" id="4895019">]</span><span class="op" id="4895020">,</span>&nbsp;<span class="string" id="4895022">&#34;&nbsp;&#34;</span><span class="op" id="4895025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4895028">if</span>&nbsp;<span class="ident" id="4895031">s1</span>&nbsp;<span class="op" id="4895034">&lt;</span>&nbsp;<span class="num" id="4895036">0</span>&nbsp;<span class="op" id="4895038">||</span>&nbsp;<span class="ident" id="4895041">s2</span>&nbsp;<span class="op" id="4895044">&lt;</span>&nbsp;<span class="num" id="4895046">0</span>&nbsp;<span class="op" id="4895048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4895052">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4895060">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895063">s2</span>&nbsp;<span class="op" id="4895066">+=</span>&nbsp;<span class="ident" id="4895069">s1</span>&nbsp;<span class="op" id="4895072">+</span>&nbsp;<span class="num" id="4895074">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4895077">return</span>&nbsp;<span class="ident" id="4895084">line</span><span class="op" id="4895088">[</span><span class="op" id="4895089">:</span><span class="ident" id="4895090">s1</span><span class="op" id="4895092">]</span><span class="op" id="4895093">,</span>&nbsp;<span class="ident" id="4895095">line</span><span class="op" id="4895099">[</span><span class="ident" id="4895100">s1</span><span class="op" id="4895102">+</span><span class="num" id="4895103">1</span>&nbsp;<span class="op" id="4895105">:</span>&nbsp;<span class="ident" id="4895107">s2</span><span class="op" id="4895109">]</span><span class="op" id="4895110">,</span>&nbsp;<span class="ident" id="4895112">line</span><span class="op" id="4895116">[</span><span class="ident" id="4895117">s2</span><span class="op" id="4895119">+</span><span class="num" id="4895120">1</span><span class="op" id="4895121">:</span><span class="op" id="4895122">]</span><span class="op" id="4895123">,</span>&nbsp;<span class="builtintype" id="4895125">true</span><br>
<span class="lineno"></span><span class="op" id="4895130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4895133">var</span>&nbsp;<span class="ident" id="4895137">textprotoReaderPool</span>&nbsp;<span class="ident" id="4895157">sync</span><span class="op" id="4895161">.</span><span class="ident" id="4895162">Pool</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="keyword" id="4895168">func</span>&nbsp;<span class="ident" id="4895173">newTextprotoReader</span><span class="op" id="4895191">(</span><span class="ident" id="4895192">br</span>&nbsp;<span class="op" id="4895195">*</span><span class="ident" id="4895196">bufio</span><span class="op" id="4895201">.</span><span class="ident" id="4895202">Reader</span><span class="op" id="4895208">)</span>&nbsp;<span class="op" id="4895210">*</span><span class="ident" id="4895211">textproto</span><span class="op" id="4895220">.</span><span class="ident" id="4895221">Reader</span>&nbsp;<span class="op" id="4895228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4895231">if</span>&nbsp;<span class="ident" id="4895234">v</span>&nbsp;<span class="op" id="4895236">:=</span>&nbsp;<span class="ident" id="4895239">textprotoReaderPool</span><span class="op" id="4895258">.</span><span class="ident" id="4895259">Get</span><span class="op" id="4895262">(</span><span class="op" id="4895263">)</span><span class="op" id="4895264">;</span>&nbsp;<span class="ident" id="4895266">v</span>&nbsp;<span class="op" id="4895268">!=</span>&nbsp;<span class="ident" id="4895271">nil</span>&nbsp;<span class="op" id="4895275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895279">tr</span>&nbsp;<span class="op" id="4895282">:=</span>&nbsp;<span class="ident" id="4895285">v</span><span class="op" id="4895286">.</span><span class="op" id="4895287">(</span><span class="op" id="4895288">*</span><span class="ident" id="4895289">textproto</span><span class="op" id="4895298">.</span><span class="ident" id="4895299">Reader</span><span class="op" id="4895305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895309">tr</span><span class="op" id="4895311">.</span><span class="ident" id="4895312">R</span>&nbsp;<span class="op" id="4895314">=</span>&nbsp;<span class="ident" id="4895316">br</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4895321">return</span>&nbsp;<span class="ident" id="4895328">tr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4895332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4895335">return</span>&nbsp;<span class="ident" id="4895342">textproto</span><span class="op" id="4895351">.</span><span class="ident" id="4895352">NewReader</span><span class="op" id="4895361">(</span><span class="ident" id="4895362">br</span><span class="op" id="4895364">)</span><br>
<span class="lineno"></span><span class="op" id="4895366">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">585</span><span class="keyword" id="4895369">func</span>&nbsp;<span class="ident" id="4895374">putTextprotoReader</span><span class="op" id="4895392">(</span><span class="ident" id="4895393">r</span>&nbsp;<span class="op" id="4895395">*</span><span class="ident" id="4895396">textproto</span><span class="op" id="4895405">.</span><span class="ident" id="4895406">Reader</span><span class="op" id="4895412">)</span>&nbsp;<span class="op" id="4895414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895417">r</span><span class="op" id="4895418">.</span><span class="ident" id="4895419">R</span>&nbsp;<span class="op" id="4895421">=</span>&nbsp;<span class="ident" id="4895423">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895428">textprotoReaderPool</span><span class="op" id="4895447">.</span><span class="ident" id="4895448">Put</span><span class="op" id="4895451">(</span><span class="ident" id="4895452">r</span><span class="op" id="4895453">)</span><br>
<span class="lineno"></span><span class="op" id="4895455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="comment" id="4895458">//&nbsp;ReadRequest&nbsp;reads&nbsp;and&nbsp;parses&nbsp;a&nbsp;request&nbsp;from&nbsp;b.</span><br>
<span class="lineno"></span><span class="keyword" id="4895508">func</span>&nbsp;<span class="ident" id="4895513">ReadRequest</span><span class="op" id="4895524">(</span><span class="ident" id="4895525">b</span>&nbsp;<span class="op" id="4895527">*</span><span class="ident" id="4895528">bufio</span><span class="op" id="4895533">.</span><span class="ident" id="4895534">Reader</span><span class="op" id="4895540">)</span>&nbsp;<span class="op" id="4895542">(</span><span class="ident" id="4895543">req</span>&nbsp;<span class="op" id="4895547">*</span><span class="ident" id="4895548">Request</span><span class="op" id="4895555">,</span>&nbsp;<span class="ident" id="4895557">err</span>&nbsp;<span class="builtintype" id="4895561">error</span><span class="op" id="4895566">)</span>&nbsp;<span class="op" id="4895568">{</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895572">tp</span>&nbsp;<span class="op" id="4895575">:=</span>&nbsp;<span class="ident" id="4895578">newTextprotoReader</span><span class="op" id="4895596">(</span><span class="ident" id="4895597">b</span><span class="op" id="4895598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895601">req</span>&nbsp;<span class="op" id="4895605">=</span>&nbsp;<span class="builtinfunc" id="4895607">new</span><span class="op" id="4895610">(</span><span class="ident" id="4895611">Request</span><span class="op" id="4895618">)</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4895622">//&nbsp;First&nbsp;line:&nbsp;GET&nbsp;/index.html&nbsp;HTTP/1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4895663">var</span>&nbsp;<span class="ident" id="4895667">s</span>&nbsp;<span class="builtintype" id="4895669">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4895677">if</span>&nbsp;<span class="ident" id="4895680">s</span><span class="op" id="4895681">,</span>&nbsp;<span class="ident" id="4895683">err</span>&nbsp;<span class="op" id="4895687">=</span>&nbsp;<span class="ident" id="4895689">tp</span><span class="op" id="4895691">.</span><span class="ident" id="4895692">ReadLine</span><span class="op" id="4895700">(</span><span class="op" id="4895701">)</span><span class="op" id="4895702">;</span>&nbsp;<span class="ident" id="4895704">err</span>&nbsp;<span class="op" id="4895708">!=</span>&nbsp;<span class="ident" id="4895711">nil</span>&nbsp;<span class="op" id="4895715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4895719">return</span>&nbsp;<span class="ident" id="4895726">nil</span><span class="op" id="4895729">,</span>&nbsp;<span class="ident" id="4895731">err</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4895736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4895739">defer</span>&nbsp;<span class="keyword" id="4895745">func</span><span class="op" id="4895749">(</span><span class="op" id="4895750">)</span>&nbsp;<span class="op" id="4895752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895756">putTextprotoReader</span><span class="op" id="4895774">(</span><span class="ident" id="4895775">tp</span><span class="op" id="4895777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4895781">if</span>&nbsp;<span class="ident" id="4895784">err</span>&nbsp;<span class="op" id="4895788">==</span>&nbsp;<span class="ident" id="4895791">io</span><span class="op" id="4895793">.</span><span class="ident" id="4895794">EOF</span>&nbsp;<span class="op" id="4895798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895803">err</span>&nbsp;<span class="op" id="4895807">=</span>&nbsp;<span class="ident" id="4895809">io</span><span class="op" id="4895811">.</span><span class="ident" id="4895812">ErrUnexpectedEOF</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4895831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4895834">}</span><span class="op" id="4895835">(</span><span class="op" id="4895836">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4895840">var</span>&nbsp;<span class="ident" id="4895844">ok</span>&nbsp;<span class="builtintype" id="4895847">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895853">req</span><span class="op" id="4895856">.</span><span class="ident" id="4895857">Method</span><span class="op" id="4895863">,</span>&nbsp;<span class="ident" id="4895865">req</span><span class="op" id="4895868">.</span><span class="ident" id="4895869">RequestURI</span><span class="op" id="4895879">,</span>&nbsp;<span class="ident" id="4895881">req</span><span class="op" id="4895884">.</span><span class="ident" id="4895885">Proto</span><span class="op" id="4895890">,</span>&nbsp;<span class="ident" id="4895892">ok</span>&nbsp;<span class="op" id="4895895">=</span>&nbsp;<span class="ident" id="4895897">parseRequestLine</span><span class="op" id="4895913">(</span><span class="ident" id="4895914">s</span><span class="op" id="4895915">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4895918">if</span>&nbsp;<span class="op" id="4895921">!</span><span class="ident" id="4895922">ok</span>&nbsp;<span class="op" id="4895925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4895929">return</span>&nbsp;<span class="ident" id="4895936">nil</span><span class="op" id="4895939">,</span>&nbsp;<span class="op" id="4895941">&amp;</span><span class="ident" id="4895942">badStringError</span><span class="op" id="4895956">{</span><span class="string" id="4895957">&#34;malformed&nbsp;HTTP&nbsp;request&#34;</span><span class="op" id="4895981">,</span>&nbsp;<span class="ident" id="4895983">s</span><span class="op" id="4895984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4895987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4895990">rawurl</span>&nbsp;<span class="op" id="4895997">:=</span>&nbsp;<span class="ident" id="4896000">req</span><span class="op" id="4896003">.</span><span class="ident" id="4896004">RequestURI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4896016">if</span>&nbsp;<span class="ident" id="4896019">req</span><span class="op" id="4896022">.</span><span class="ident" id="4896023">ProtoMajor</span><span class="op" id="4896033">,</span>&nbsp;<span class="ident" id="4896035">req</span><span class="op" id="4896038">.</span><span class="ident" id="4896039">ProtoMinor</span><span class="op" id="4896049">,</span>&nbsp;<span class="ident" id="4896051">ok</span>&nbsp;<span class="op" id="4896054">=</span>&nbsp;<span class="ident" id="4896056">ParseHTTPVersion</span><span class="op" id="4896072">(</span><span class="ident" id="4896073">req</span><span class="op" id="4896076">.</span><span class="ident" id="4896077">Proto</span><span class="op" id="4896082">)</span><span class="op" id="4896083">;</span>&nbsp;<span class="op" id="4896085">!</span><span class="ident" id="4896086">ok</span>&nbsp;<span class="op" id="4896089">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4896093">return</span>&nbsp;<span class="ident" id="4896100">nil</span><span class="op" id="4896103">,</span>&nbsp;<span class="op" id="4896105">&amp;</span><span class="ident" id="4896106">badStringError</span><span class="op" id="4896120">{</span><span class="string" id="4896121">&#34;malformed&nbsp;HTTP&nbsp;version&#34;</span><span class="op" id="4896145">,</span>&nbsp;<span class="ident" id="4896147">req</span><span class="op" id="4896150">.</span><span class="ident" id="4896151">Proto</span><span class="op" id="4896156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4896159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4896163">//&nbsp;CONNECT&nbsp;requests&nbsp;are&nbsp;used&nbsp;two&nbsp;different&nbsp;ways,&nbsp;and&nbsp;neither&nbsp;uses&nbsp;a&nbsp;full&nbsp;URL:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4896242">//&nbsp;The&nbsp;standard&nbsp;use&nbsp;is&nbsp;to&nbsp;tunnel&nbsp;HTTPS&nbsp;through&nbsp;an&nbsp;HTTP&nbsp;proxy.</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4896305">//&nbsp;It&nbsp;looks&nbsp;like&nbsp;&#34;CONNECT&nbsp;www.google.com:443&nbsp;HTTP/1.1&#34;,&nbsp;and&nbsp;the&nbsp;parameter&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4896383">//&nbsp;just&nbsp;the&nbsp;authority&nbsp;section&nbsp;of&nbsp;a&nbsp;URL.&nbsp;This&nbsp;information&nbsp;should&nbsp;go&nbsp;in&nbsp;req.URL.Host.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4896468">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4896472">//&nbsp;The&nbsp;net/rpc&nbsp;package&nbsp;also&nbsp;uses&nbsp;CONNECT,&nbsp;but&nbsp;there&nbsp;the&nbsp;parameter&nbsp;is&nbsp;a&nbsp;path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4896549">//&nbsp;that&nbsp;starts&nbsp;with&nbsp;a&nbsp;slash.&nbsp;It&nbsp;can&nbsp;be&nbsp;parsed&nbsp;with&nbsp;the&nbsp;regular&nbsp;URL&nbsp;parser,</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4896625">//&nbsp;and&nbsp;the&nbsp;path&nbsp;will&nbsp;end&nbsp;up&nbsp;in&nbsp;req.URL.Path,&nbsp;where&nbsp;it&nbsp;needs&nbsp;to&nbsp;be&nbsp;in&nbsp;order&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4896705">//&nbsp;RPC&nbsp;to&nbsp;work.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896722">justAuthority</span>&nbsp;<span class="op" id="4896736">:=</span>&nbsp;<span class="ident" id="4896739">req</span><span class="op" id="4896742">.</span><span class="ident" id="4896743">Method</span>&nbsp;<span class="op" id="4896750">==</span>&nbsp;<span class="string" id="4896753">&#34;CONNECT&#34;</span>&nbsp;<span class="op" id="4896763">&amp;&amp;</span>&nbsp;<span class="op" id="4896766">!</span><span class="ident" id="4896767">strings</span><span class="op" id="4896774">.</span><span class="ident" id="4896775">HasPrefix</span><span class="op" id="4896784">(</span><span class="ident" id="4896785">rawurl</span><span class="op" id="4896791">,</span>&nbsp;<span class="string" id="4896793">&#34;/&#34;</span><span class="op" id="4896796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4896799">if</span>&nbsp;<span class="ident" id="4896802">justAuthority</span>&nbsp;<span class="op" id="4896816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896820">rawurl</span>&nbsp;<span class="op" id="4896827">=</span>&nbsp;<span class="string" id="4896829">&#34;http://&#34;</span>&nbsp;<span class="op" id="4896839">+</span>&nbsp;<span class="ident" id="4896841">rawurl</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4896849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4896853">if</span>&nbsp;<span class="ident" id="4896856">req</span><span class="op" id="4896859">.</span><span class="ident" id="4896860">URL</span><span class="op" id="4896863">,</span>&nbsp;<span class="ident" id="4896865">err</span>&nbsp;<span class="op" id="4896869">=</span>&nbsp;<span class="ident" id="4896871">url</span><span class="op" id="4896874">.</span><span class="ident" id="4896875">ParseRequestURI</span><span class="op" id="4896890">(</span><span class="ident" id="4896891">rawurl</span><span class="op" id="4896897">)</span><span class="op" id="4896898">;</span>&nbsp;<span class="ident" id="4896900">err</span>&nbsp;<span class="op" id="4896904">!=</span>&nbsp;<span class="ident" id="4896907">nil</span>&nbsp;<span class="op" id="4896911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4896915">return</span>&nbsp;<span class="ident" id="4896922">nil</span><span class="op" id="4896925">,</span>&nbsp;<span class="ident" id="4896927">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4896932">}</span><br>
<span class="lineno">635</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4896936">if</span>&nbsp;<span class="ident" id="4896939">justAuthority</span>&nbsp;<span class="op" id="4896953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4896957">//&nbsp;Strip&nbsp;the&nbsp;bogus&nbsp;&#34;http://&#34;&nbsp;back&nbsp;off.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4896998">req</span><span class="op" id="4897001">.</span><span class="ident" id="4897002">URL</span><span class="op" id="4897005">.</span><span class="ident" id="4897006">Scheme</span>&nbsp;<span class="op" id="4897013">=</span>&nbsp;<span class="string" id="4897015">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4897019">}</span><br>
<span class="lineno">640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4897023">//&nbsp;Subsequent&nbsp;lines:&nbsp;Key:&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4897057">mimeHeader</span><span class="op" id="4897067">,</span>&nbsp;<span class="ident" id="4897069">err</span>&nbsp;<span class="op" id="4897073">:=</span>&nbsp;<span class="ident" id="4897076">tp</span><span class="op" id="4897078">.</span><span class="ident" id="4897079">ReadMIMEHeader</span><span class="op" id="4897093">(</span><span class="op" id="4897094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4897097">if</span>&nbsp;<span class="ident" id="4897100">err</span>&nbsp;<span class="op" id="4897104">!=</span>&nbsp;<span class="ident" id="4897107">nil</span>&nbsp;<span class="op" id="4897111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4897115">return</span>&nbsp;<span class="ident" id="4897122">nil</span><span class="op" id="4897125">,</span>&nbsp;<span class="ident" id="4897127">err</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4897132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4897135">req</span><span class="op" id="4897138">.</span><span class="ident" id="4897139">Header</span>&nbsp;<span class="op" id="4897146">=</span>&nbsp;<span class="ident" id="4897148">Header</span><span class="op" id="4897154">(</span><span class="ident" id="4897155">mimeHeader</span><span class="op" id="4897165">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4897169">//&nbsp;RFC2616:&nbsp;Must&nbsp;treat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4897193">//&nbsp;&nbsp;&nbsp;&nbspGET&nbsp;/index.html&nbsp;HTTP/1.1</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4897222">//&nbsp;&nbsp;&nbsp;&nbspHost:&nbsp;www.google.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4897247">//&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4897255">//&nbsp;&nbsp;&nbsp;&nbspGET&nbsp;http://www.google.com/index.html&nbsp;HTTP/1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4897305">//&nbsp;&nbsp;&nbsp;&nbspHost:&nbsp;doesntmatter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4897328">//&nbsp;the&nbsp;same.&nbsp;&nbsp;In&nbsp;the&nbsp;second&nbsp;case,&nbsp;any&nbsp;Host&nbsp;line&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4897389">req</span><span class="op" id="4897392">.</span><span class="ident" id="4897393">Host</span>&nbsp;<span class="op" id="4897398">=</span>&nbsp;<span class="ident" id="4897400">req</span><span class="op" id="4897403">.</span><span class="ident" id="4897404">URL</span><span class="op" id="4897407">.</span><span class="ident" id="4897408">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4897414">if</span>&nbsp;<span class="ident" id="4897417">req</span><span class="op" id="4897420">.</span><span class="ident" id="4897421">Host</span>&nbsp;<span class="op" id="4897426">==</span>&nbsp;<span class="string" id="4897429">&#34;&#34;</span>&nbsp;<span class="op" id="4897432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4897436">req</span><span class="op" id="4897439">.</span><span class="ident" id="4897440">Host</span>&nbsp;<span class="op" id="4897445">=</span>&nbsp;<span class="ident" id="4897447">req</span><span class="op" id="4897450">.</span><span class="ident" id="4897451">Header</span><span class="op" id="4897457">.</span><span class="ident" id="4897458">get</span><span class="op" id="4897461">(</span><span class="string" id="4897462">&#34;Host&#34;</span><span class="op" id="4897468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4897471">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4897474">delete</span><span class="op" id="4897480">(</span><span class="ident" id="4897481">req</span><span class="op" id="4897484">.</span><span class="ident" id="4897485">Header</span><span class="op" id="4897491">,</span>&nbsp;<span class="string" id="4897493">&#34;Host&#34;</span><span class="op" id="4897499">)</span><br>
<span class="lineno">660</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4897503">fixPragmaCacheControl</span><span class="op" id="4897524">(</span><span class="ident" id="4897525">req</span><span class="op" id="4897528">.</span><span class="ident" id="4897529">Header</span><span class="op" id="4897535">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4897539">err</span>&nbsp;<span class="op" id="4897543">=</span>&nbsp;<span class="ident" id="4897545">readTransfer</span><span class="op" id="4897557">(</span><span class="ident" id="4897558">req</span><span class="op" id="4897561">,</span>&nbsp;<span class="ident" id="4897563">b</span><span class="op" id="4897564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4897567">if</span>&nbsp;<span class="ident" id="4897570">err</span>&nbsp;<span class="op" id="4897574">!=</span>&nbsp;<span class="ident" id="4897577">nil</span>&nbsp;<span class="op" id="4897581">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4897585">return</span>&nbsp;<span class="ident" id="4897592">nil</span><span class="op" id="4897595">,</span>&nbsp;<span class="ident" id="4897597">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4897602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4897606">req</span><span class="op" id="4897609">.</span><span class="ident" id="4897610">Close</span>&nbsp;<span class="op" id="4897616">=</span>&nbsp;<span class="ident" id="4897618">shouldClose</span><span class="op" id="4897629">(</span><span class="ident" id="4897630">req</span><span class="op" id="4897633">.</span><span class="ident" id="4897634">ProtoMajor</span><span class="op" id="4897644">,</span>&nbsp;<span class="ident" id="4897646">req</span><span class="op" id="4897649">.</span><span class="ident" id="4897650">ProtoMinor</span><span class="op" id="4897660">,</span>&nbsp;<span class="ident" id="4897662">req</span><span class="op" id="4897665">.</span><span class="ident" id="4897666">Header</span><span class="op" id="4897672">,</span>&nbsp;<span class="builtintype" id="4897674">false</span><span class="op" id="4897679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4897682">return</span>&nbsp;<span class="ident" id="4897689">req</span><span class="op" id="4897692">,</span>&nbsp;<span class="ident" id="4897694">nil</span><br>
<span class="lineno">670</span><span class="op" id="4897698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4897701">//&nbsp;MaxBytesReader&nbsp;is&nbsp;similar&nbsp;to&nbsp;io.LimitReader&nbsp;but&nbsp;is&nbsp;intended&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4897768">//&nbsp;limiting&nbsp;the&nbsp;size&nbsp;of&nbsp;incoming&nbsp;request&nbsp;bodies.&nbsp;In&nbsp;contrast&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4897832">//&nbsp;io.LimitReader,&nbsp;MaxBytesReader&#39;s&nbsp;result&nbsp;is&nbsp;a&nbsp;ReadCloser,&nbsp;returns&nbsp;a</span><br>
<span class="lineno">675</span><span class="comment" id="4897902">//&nbsp;non-EOF&nbsp;error&nbsp;for&nbsp;a&nbsp;Read&nbsp;beyond&nbsp;the&nbsp;limit,&nbsp;and&nbsp;Closes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4897963">//&nbsp;underlying&nbsp;reader&nbsp;when&nbsp;its&nbsp;Close&nbsp;method&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span><span class="comment" id="4898017">//</span><br>
<span class="lineno"></span><span class="comment" id="4898020">//&nbsp;MaxBytesReader&nbsp;prevents&nbsp;clients&nbsp;from&nbsp;accidentally&nbsp;or&nbsp;maliciously</span><br>
<span class="lineno"></span><span class="comment" id="4898088">//&nbsp;sending&nbsp;a&nbsp;large&nbsp;request&nbsp;and&nbsp;wasting&nbsp;server&nbsp;resources.</span><br>
<span class="lineno">680</span><span class="keyword" id="4898145">func</span>&nbsp;<span class="ident" id="4898150">MaxBytesReader</span><span class="op" id="4898164">(</span><span class="ident" id="4898165">w</span>&nbsp;<span class="ident" id="4898167">ResponseWriter</span><span class="op" id="4898181">,</span>&nbsp;<span class="ident" id="4898183">r</span>&nbsp;<span class="ident" id="4898185">io</span><span class="op" id="4898187">.</span><span class="ident" id="4898188">ReadCloser</span><span class="op" id="4898198">,</span>&nbsp;<span class="ident" id="4898200">n</span>&nbsp;<span class="ident" id="4898202">int64</span><span class="op" id="4898207">)</span>&nbsp;<span class="ident" id="4898209">io</span><span class="op" id="4898211">.</span><span class="ident" id="4898212">ReadCloser</span>&nbsp;<span class="op" id="4898223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898226">return</span>&nbsp;<span class="op" id="4898233">&amp;</span><span class="ident" id="4898234">maxBytesReader</span><span class="op" id="4898248">{</span><span class="ident" id="4898249">w</span><span class="op" id="4898250">:</span>&nbsp;<span class="ident" id="4898252">w</span><span class="op" id="4898253">,</span>&nbsp;<span class="ident" id="4898255">r</span><span class="op" id="4898256">:</span>&nbsp;<span class="ident" id="4898258">r</span><span class="op" id="4898259">,</span>&nbsp;<span class="ident" id="4898261">n</span><span class="op" id="4898262">:</span>&nbsp;<span class="ident" id="4898264">n</span><span class="op" id="4898265">}</span><br>
<span class="lineno"></span><span class="op" id="4898267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4898270">type</span>&nbsp;<span class="ident" id="4898275">maxBytesReader</span>&nbsp;<span class="keyword" id="4898290">struct</span>&nbsp;<span class="op" id="4898297">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4898300">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898308">ResponseWriter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4898324">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898332">io</span><span class="op" id="4898334">.</span><span class="ident" id="4898335">ReadCloser</span>&nbsp;<span class="comment" id="4898346">//&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4898368">n</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4898376">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4898390">//&nbsp;max&nbsp;bytes&nbsp;remaining</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4898414">stopped</span>&nbsp;<span class="builtintype" id="4898422">bool</span><br>
<span class="lineno"></span><span class="op" id="4898427">}</span><br>
<span class="lineno">690</span><br>
<span class="lineno"></span><span class="keyword" id="4898430">func</span>&nbsp;<span class="op" id="4898435">(</span><span class="ident" id="4898436">l</span>&nbsp;<span class="op" id="4898438">*</span><span class="ident" id="4898439">maxBytesReader</span><span class="op" id="4898453">)</span>&nbsp;<span class="ident" id="4898455">Read</span><span class="op" id="4898459">(</span><span class="ident" id="4898460">p</span>&nbsp;<span class="op" id="4898462">[</span><span class="op" id="4898463">]</span><span class="builtintype" id="4898464">byte</span><span class="op" id="4898468">)</span>&nbsp;<span class="op" id="4898470">(</span><span class="ident" id="4898471">n</span>&nbsp;<span class="builtintype" id="4898473">int</span><span class="op" id="4898476">,</span>&nbsp;<span class="ident" id="4898478">err</span>&nbsp;<span class="builtintype" id="4898482">error</span><span class="op" id="4898487">)</span>&nbsp;<span class="op" id="4898489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898492">if</span>&nbsp;<span class="ident" id="4898495">l</span><span class="op" id="4898496">.</span><span class="ident" id="4898497">n</span>&nbsp;<span class="op" id="4898499">&lt;=</span>&nbsp;<span class="num" id="4898502">0</span>&nbsp;<span class="op" id="4898504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898508">if</span>&nbsp;<span class="op" id="4898511">!</span><span class="ident" id="4898512">l</span><span class="op" id="4898513">.</span><span class="ident" id="4898514">stopped</span>&nbsp;<span class="op" id="4898522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4898527">l</span><span class="op" id="4898528">.</span><span class="ident" id="4898529">stopped</span>&nbsp;<span class="op" id="4898537">=</span>&nbsp;<span class="builtintype" id="4898539">true</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898547">if</span>&nbsp;<span class="ident" id="4898550">res</span><span class="op" id="4898553">,</span>&nbsp;<span class="ident" id="4898555">ok</span>&nbsp;<span class="op" id="4898558">:=</span>&nbsp;<span class="ident" id="4898561">l</span><span class="op" id="4898562">.</span><span class="ident" id="4898563">w</span><span class="op" id="4898564">.</span><span class="op" id="4898565">(</span><span class="op" id="4898566">*</span><span class="ident" id="4898567">response</span><span class="op" id="4898575">)</span><span class="op" id="4898576">;</span>&nbsp;<span class="ident" id="4898578">ok</span>&nbsp;<span class="op" id="4898581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4898587">res</span><span class="op" id="4898590">.</span><span class="ident" id="4898591">requestTooLarge</span><span class="op" id="4898606">(</span><span class="op" id="4898607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4898612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4898616">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898620">return</span>&nbsp;<span class="num" id="4898627">0</span><span class="op" id="4898628">,</span>&nbsp;<span class="ident" id="4898630">errors</span><span class="op" id="4898636">.</span><span class="ident" id="4898637">New</span><span class="op" id="4898640">(</span><span class="string" id="4898641">&#34;http:&nbsp;request&nbsp;body&nbsp;too&nbsp;large&#34;</span><span class="op" id="4898671">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4898674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898677">if</span>&nbsp;<span class="ident" id="4898680">int64</span><span class="op" id="4898685">(</span><span class="builtinfunc" id="4898686">len</span><span class="op" id="4898689">(</span><span class="ident" id="4898690">p</span><span class="op" id="4898691">)</span><span class="op" id="4898692">)</span>&nbsp;<span class="op" id="4898694">&gt;</span>&nbsp;<span class="ident" id="4898696">l</span><span class="op" id="4898697">.</span><span class="ident" id="4898698">n</span>&nbsp;<span class="op" id="4898700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4898704">p</span>&nbsp;<span class="op" id="4898706">=</span>&nbsp;<span class="ident" id="4898708">p</span><span class="op" id="4898709">[</span><span class="op" id="4898710">:</span><span class="ident" id="4898711">l</span><span class="op" id="4898712">.</span><span class="ident" id="4898713">n</span><span class="op" id="4898714">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4898717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4898720">n</span><span class="op" id="4898721">,</span>&nbsp;<span class="ident" id="4898723">err</span>&nbsp;<span class="op" id="4898727">=</span>&nbsp;<span class="ident" id="4898729">l</span><span class="op" id="4898730">.</span><span class="ident" id="4898731">r</span><span class="op" id="4898732">.</span><span class="ident" id="4898733">Read</span><span class="op" id="4898737">(</span><span class="ident" id="4898738">p</span><span class="op" id="4898739">)</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4898742">l</span><span class="op" id="4898743">.</span><span class="ident" id="4898744">n</span>&nbsp;<span class="op" id="4898746">-=</span>&nbsp;<span class="ident" id="4898749">int64</span><span class="op" id="4898754">(</span><span class="ident" id="4898755">n</span><span class="op" id="4898756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898759">return</span><br>
<span class="lineno"></span><span class="op" id="4898766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4898769">func</span>&nbsp;<span class="op" id="4898774">(</span><span class="ident" id="4898775">l</span>&nbsp;<span class="op" id="4898777">*</span><span class="ident" id="4898778">maxBytesReader</span><span class="op" id="4898792">)</span>&nbsp;<span class="ident" id="4898794">Close</span><span class="op" id="4898799">(</span><span class="op" id="4898800">)</span>&nbsp;<span class="builtintype" id="4898802">error</span>&nbsp;<span class="op" id="4898808">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898811">return</span>&nbsp;<span class="ident" id="4898818">l</span><span class="op" id="4898819">.</span><span class="ident" id="4898820">r</span><span class="op" id="4898821">.</span><span class="ident" id="4898822">Close</span><span class="op" id="4898827">(</span><span class="op" id="4898828">)</span><br>
<span class="lineno"></span><span class="op" id="4898830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4898833">func</span>&nbsp;<span class="ident" id="4898838">copyValues</span><span class="op" id="4898848">(</span><span class="ident" id="4898849">dst</span><span class="op" id="4898852">,</span>&nbsp;<span class="ident" id="4898854">src</span>&nbsp;<span class="ident" id="4898858">url</span><span class="op" id="4898861">.</span><span class="ident" id="4898862">Values</span><span class="op" id="4898868">)</span>&nbsp;<span class="op" id="4898870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898873">for</span>&nbsp;<span class="ident" id="4898877">k</span><span class="op" id="4898878">,</span>&nbsp;<span class="ident" id="4898880">vs</span>&nbsp;<span class="op" id="4898883">:=</span>&nbsp;<span class="keyword" id="4898886">range</span>&nbsp;<span class="ident" id="4898892">src</span>&nbsp;<span class="op" id="4898896">{</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4898900">for</span>&nbsp;<span class="ident" id="4898904">_</span><span class="op" id="4898905">,</span>&nbsp;<span class="ident" id="4898907">value</span>&nbsp;<span class="op" id="4898913">:=</span>&nbsp;<span class="keyword" id="4898916">range</span>&nbsp;<span class="ident" id="4898922">vs</span>&nbsp;<span class="op" id="4898925">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4898930">dst</span><span class="op" id="4898933">.</span><span class="ident" id="4898934">Add</span><span class="op" id="4898937">(</span><span class="ident" id="4898938">k</span><span class="op" id="4898939">,</span>&nbsp;<span class="ident" id="4898941">value</span><span class="op" id="4898946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4898950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4898953">}</span><br>
<span class="lineno"></span><span class="op" id="4898955">}</span><br>
<span class="lineno">720</span><br>
<span class="lineno"></span><span class="keyword" id="4898958">func</span>&nbsp;<span class="ident" id="4898963">parsePostForm</span><span class="op" id="4898976">(</span><span class="ident" id="4898977">r</span>&nbsp;<span class="op" id="4898979">*</span><span class="ident" id="4898980">Request</span><span class="op" id="4898987">)</span>&nbsp;<span class="op" id="4898989">(</span><span class="ident" id="4898990">vs</span>&nbsp;<span class="ident" id="4898993">url</span><span class="op" id="4898996">.</span><span class="ident" id="4898997">Values</span><span class="op" id="4899003">,</span>&nbsp;<span class="ident" id="4899005">err</span>&nbsp;<span class="builtintype" id="4899009">error</span><span class="op" id="4899014">)</span>&nbsp;<span class="op" id="4899016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899019">if</span>&nbsp;<span class="ident" id="4899022">r</span><span class="op" id="4899023">.</span><span class="ident" id="4899024">Body</span>&nbsp;<span class="op" id="4899029">==</span>&nbsp;<span class="ident" id="4899032">nil</span>&nbsp;<span class="op" id="4899036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4899040">err</span>&nbsp;<span class="op" id="4899044">=</span>&nbsp;<span class="ident" id="4899046">errors</span><span class="op" id="4899052">.</span><span class="ident" id="4899053">New</span><span class="op" id="4899056">(</span><span class="string" id="4899057">&#34;missing&nbsp;form&nbsp;body&#34;</span><span class="op" id="4899076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899080">return</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4899088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4899091">ct</span>&nbsp;<span class="op" id="4899094">:=</span>&nbsp;<span class="ident" id="4899097">r</span><span class="op" id="4899098">.</span><span class="ident" id="4899099">Header</span><span class="op" id="4899105">.</span><span class="ident" id="4899106">Get</span><span class="op" id="4899109">(</span><span class="string" id="4899110">&#34;Content-Type&#34;</span><span class="op" id="4899124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4899127">//&nbsp;RFC&nbsp;2616,&nbsp;section&nbsp;7.2.1&nbsp;-&nbsp;empty&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4899168">//&nbsp;&nbsp;&nbsp;SHOULD&nbsp;be&nbsp;treated&nbsp;as&nbsp;application/octet-stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899220">if</span>&nbsp;<span class="ident" id="4899223">ct</span>&nbsp;<span class="op" id="4899226">==</span>&nbsp;<span class="string" id="4899229">&#34;&#34;</span>&nbsp;<span class="op" id="4899232">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4899236">ct</span>&nbsp;<span class="op" id="4899239">=</span>&nbsp;<span class="string" id="4899241">&#34;application/octet-stream&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4899269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4899272">ct</span><span class="op" id="4899274">,</span>&nbsp;<span class="ident" id="4899276">_</span><span class="op" id="4899277">,</span>&nbsp;<span class="ident" id="4899279">err</span>&nbsp;<span class="op" id="4899283">=</span>&nbsp;<span class="ident" id="4899285">mime</span><span class="op" id="4899289">.</span><span class="ident" id="4899290">ParseMediaType</span><span class="op" id="4899304">(</span><span class="ident" id="4899305">ct</span><span class="op" id="4899307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899310">switch</span>&nbsp;<span class="op" id="4899317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899320">case</span>&nbsp;<span class="ident" id="4899325">ct</span>&nbsp;<span class="op" id="4899328">==</span>&nbsp;<span class="string" id="4899331">&#34;application/x-www-form-urlencoded&#34;</span><span class="op" id="4899366">:</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899370">var</span>&nbsp;<span class="ident" id="4899374">reader</span>&nbsp;<span class="ident" id="4899381">io</span><span class="op" id="4899383">.</span><span class="ident" id="4899384">Reader</span>&nbsp;<span class="op" id="4899391">=</span>&nbsp;<span class="ident" id="4899393">r</span><span class="op" id="4899394">.</span><span class="ident" id="4899395">Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4899402">maxFormSize</span>&nbsp;<span class="op" id="4899414">:=</span>&nbsp;<span class="ident" id="4899417">int64</span><span class="op" id="4899422">(</span><span class="num" id="4899423">1</span><span class="op" id="4899424">&lt;&lt;</span><span class="num" id="4899426">63</span>&nbsp;<span class="op" id="4899429">-</span>&nbsp;<span class="num" id="4899431">1</span><span class="op" id="4899432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899436">if</span>&nbsp;<span class="ident" id="4899439">_</span><span class="op" id="4899440">,</span>&nbsp;<span class="ident" id="4899442">ok</span>&nbsp;<span class="op" id="4899445">:=</span>&nbsp;<span class="ident" id="4899448">r</span><span class="op" id="4899449">.</span><span class="ident" id="4899450">Body</span><span class="op" id="4899454">.</span><span class="op" id="4899455">(</span><span class="op" id="4899456">*</span><span class="ident" id="4899457">maxBytesReader</span><span class="op" id="4899471">)</span><span class="op" id="4899472">;</span>&nbsp;<span class="op" id="4899474">!</span><span class="ident" id="4899475">ok</span>&nbsp;<span class="op" id="4899478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4899483">maxFormSize</span>&nbsp;<span class="op" id="4899495">=</span>&nbsp;<span class="ident" id="4899497">int64</span><span class="op" id="4899502">(</span><span class="num" id="4899503">10</span>&nbsp;<span class="op" id="4899506">&lt;&lt;</span>&nbsp;<span class="num" id="4899509">20</span><span class="op" id="4899511">)</span>&nbsp;<span class="comment" id="4899513">//&nbsp;10&nbsp;MB&nbsp;is&nbsp;a&nbsp;lot&nbsp;of&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4899543">reader</span>&nbsp;<span class="op" id="4899550">=</span>&nbsp;<span class="ident" id="4899552">io</span><span class="op" id="4899554">.</span><span class="ident" id="4899555">LimitReader</span><span class="op" id="4899566">(</span><span class="ident" id="4899567">r</span><span class="op" id="4899568">.</span><span class="ident" id="4899569">Body</span><span class="op" id="4899573">,</span>&nbsp;<span class="ident" id="4899575">maxFormSize</span><span class="op" id="4899586">+</span><span class="num" id="4899587">1</span><span class="op" id="4899588">)</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4899592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4899596">b</span><span class="op" id="4899597">,</span>&nbsp;<span class="ident" id="4899599">e</span>&nbsp;<span class="op" id="4899601">:=</span>&nbsp;<span class="ident" id="4899604">ioutil</span><span class="op" id="4899610">.</span><span class="ident" id="4899611">ReadAll</span><span class="op" id="4899618">(</span><span class="ident" id="4899619">reader</span><span class="op" id="4899625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899629">if</span>&nbsp;<span class="ident" id="4899632">e</span>&nbsp;<span class="op" id="4899634">!=</span>&nbsp;<span class="ident" id="4899637">nil</span>&nbsp;<span class="op" id="4899641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899646">if</span>&nbsp;<span class="ident" id="4899649">err</span>&nbsp;<span class="op" id="4899653">==</span>&nbsp;<span class="ident" id="4899656">nil</span>&nbsp;<span class="op" id="4899660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4899666">err</span>&nbsp;<span class="op" id="4899670">=</span>&nbsp;<span class="ident" id="4899672">e</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4899677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899682">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4899690">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899694">if</span>&nbsp;<span class="ident" id="4899697">int64</span><span class="op" id="4899702">(</span><span class="builtinfunc" id="4899703">len</span><span class="op" id="4899706">(</span><span class="ident" id="4899707">b</span><span class="op" id="4899708">)</span><span class="op" id="4899709">)</span>&nbsp;<span class="op" id="4899711">&gt;</span>&nbsp;<span class="ident" id="4899713">maxFormSize</span>&nbsp;<span class="op" id="4899725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4899730">err</span>&nbsp;<span class="op" id="4899734">=</span>&nbsp;<span class="ident" id="4899736">errors</span><span class="op" id="4899742">.</span><span class="ident" id="4899743">New</span><span class="op" id="4899746">(</span><span class="string" id="4899747">&#34;http:&nbsp;POST&nbsp;too&nbsp;large&#34;</span><span class="op" id="4899769">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899774">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4899783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4899787">vs</span><span class="op" id="4899789">,</span>&nbsp;<span class="ident" id="4899791">e</span>&nbsp;<span class="op" id="4899793">=</span>&nbsp;<span class="ident" id="4899795">url</span><span class="op" id="4899798">.</span><span class="ident" id="4899799">ParseQuery</span><span class="op" id="4899809">(</span><span class="builtintype" id="4899810">string</span><span class="op" id="4899816">(</span><span class="ident" id="4899817">b</span><span class="op" id="4899818">)</span><span class="op" id="4899819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899823">if</span>&nbsp;<span class="ident" id="4899826">err</span>&nbsp;<span class="op" id="4899830">==</span>&nbsp;<span class="ident" id="4899833">nil</span>&nbsp;<span class="op" id="4899837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4899842">err</span>&nbsp;<span class="op" id="4899846">=</span>&nbsp;<span class="ident" id="4899848">e</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4899852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4899855">case</span>&nbsp;<span class="ident" id="4899860">ct</span>&nbsp;<span class="op" id="4899863">==</span>&nbsp;<span class="string" id="4899866">&#34;multipart/form-data&#34;</span><span class="op" id="4899887">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4899891">//&nbsp;handled&nbsp;by&nbsp;ParseMultipartForm&nbsp;(which&nbsp;is&nbsp;calling&nbsp;us,&nbsp;or&nbsp;should&nbsp;be)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4899962">//&nbsp;TODO(bradfitz):&nbsp;there&nbsp;are&nbsp;too&nbsp;many&nbsp;possible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4900011">//&nbsp;orders&nbsp;to&nbsp;call&nbsp;too&nbsp;many&nbsp;functions&nbsp;here.</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4900056">//&nbsp;Clean&nbsp;this&nbsp;up&nbsp;and&nbsp;write&nbsp;more&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4900097">//&nbsp;request_test.go&nbsp;contains&nbsp;the&nbsp;start&nbsp;of&nbsp;this,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4900146">//&nbsp;in&nbsp;TestParseMultipartFormOrder&nbsp;and&nbsp;others.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4900193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900196">return</span><br>
<span class="lineno">765</span><span class="op" id="4900203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4900206">//&nbsp;ParseForm&nbsp;parses&nbsp;the&nbsp;raw&nbsp;query&nbsp;from&nbsp;the&nbsp;URL&nbsp;and&nbsp;updates&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="4900273">//</span><br>
<span class="lineno"></span><span class="comment" id="4900276">//&nbsp;For&nbsp;POST&nbsp;or&nbsp;PUT&nbsp;requests,&nbsp;it&nbsp;also&nbsp;parses&nbsp;the&nbsp;request&nbsp;body&nbsp;as&nbsp;a&nbsp;form&nbsp;and</span><br>
<span class="lineno">770</span><span class="comment" id="4900351">//&nbsp;put&nbsp;the&nbsp;results&nbsp;into&nbsp;both&nbsp;r.PostForm&nbsp;and&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="4900403">//&nbsp;POST&nbsp;and&nbsp;PUT&nbsp;body&nbsp;parameters&nbsp;take&nbsp;precedence&nbsp;over&nbsp;URL&nbsp;query&nbsp;string&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="4900480">//&nbsp;in&nbsp;r.Form.</span><br>
<span class="lineno"></span><span class="comment" id="4900494">//</span><br>
<span class="lineno"></span><span class="comment" id="4900497">//&nbsp;If&nbsp;the&nbsp;request&nbsp;Body&#39;s&nbsp;size&nbsp;has&nbsp;not&nbsp;already&nbsp;been&nbsp;limited&nbsp;by&nbsp;MaxBytesReader,</span><br>
<span class="lineno">775</span><span class="comment" id="4900575">//&nbsp;the&nbsp;size&nbsp;is&nbsp;capped&nbsp;at&nbsp;10MB.</span><br>
<span class="lineno"></span><span class="comment" id="4900606">//</span><br>
<span class="lineno"></span><span class="comment" id="4900609">//&nbsp;ParseMultipartForm&nbsp;calls&nbsp;ParseForm&nbsp;automatically.</span><br>
<span class="lineno"></span><span class="comment" id="4900662">//&nbsp;It&nbsp;is&nbsp;idempotent.</span><br>
<span class="lineno"></span><span class="keyword" id="4900683">func</span>&nbsp;<span class="op" id="4900688">(</span><span class="ident" id="4900689">r</span>&nbsp;<span class="op" id="4900691">*</span><span class="ident" id="4900692">Request</span><span class="op" id="4900699">)</span>&nbsp;<span class="ident" id="4900701">ParseForm</span><span class="op" id="4900710">(</span><span class="op" id="4900711">)</span>&nbsp;<span class="builtintype" id="4900713">error</span>&nbsp;<span class="op" id="4900719">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900722">var</span>&nbsp;<span class="ident" id="4900726">err</span>&nbsp;<span class="builtintype" id="4900730">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900737">if</span>&nbsp;<span class="ident" id="4900740">r</span><span class="op" id="4900741">.</span><span class="ident" id="4900742">PostForm</span>&nbsp;<span class="op" id="4900751">==</span>&nbsp;<span class="ident" id="4900754">nil</span>&nbsp;<span class="op" id="4900758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900762">if</span>&nbsp;<span class="ident" id="4900765">r</span><span class="op" id="4900766">.</span><span class="ident" id="4900767">Method</span>&nbsp;<span class="op" id="4900774">==</span>&nbsp;<span class="string" id="4900777">&#34;POST&#34;</span>&nbsp;<span class="op" id="4900784">||</span>&nbsp;<span class="ident" id="4900787">r</span><span class="op" id="4900788">.</span><span class="ident" id="4900789">Method</span>&nbsp;<span class="op" id="4900796">==</span>&nbsp;<span class="string" id="4900799">&#34;PUT&#34;</span>&nbsp;<span class="op" id="4900805">||</span>&nbsp;<span class="ident" id="4900808">r</span><span class="op" id="4900809">.</span><span class="ident" id="4900810">Method</span>&nbsp;<span class="op" id="4900817">==</span>&nbsp;<span class="string" id="4900820">&#34;PATCH&#34;</span>&nbsp;<span class="op" id="4900828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4900833">r</span><span class="op" id="4900834">.</span><span class="ident" id="4900835">PostForm</span><span class="op" id="4900843">,</span>&nbsp;<span class="ident" id="4900845">err</span>&nbsp;<span class="op" id="4900849">=</span>&nbsp;<span class="ident" id="4900851">parsePostForm</span><span class="op" id="4900864">(</span><span class="ident" id="4900865">r</span><span class="op" id="4900866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4900870">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900874">if</span>&nbsp;<span class="ident" id="4900877">r</span><span class="op" id="4900878">.</span><span class="ident" id="4900879">PostForm</span>&nbsp;<span class="op" id="4900888">==</span>&nbsp;<span class="ident" id="4900891">nil</span>&nbsp;<span class="op" id="4900895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4900900">r</span><span class="op" id="4900901">.</span><span class="ident" id="4900902">PostForm</span>&nbsp;<span class="op" id="4900911">=</span>&nbsp;<span class="builtinfunc" id="4900913">make</span><span class="op" id="4900917">(</span><span class="ident" id="4900918">url</span><span class="op" id="4900921">.</span><span class="ident" id="4900922">Values</span><span class="op" id="4900928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4900932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4900935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900938">if</span>&nbsp;<span class="ident" id="4900941">r</span><span class="op" id="4900942">.</span><span class="ident" id="4900943">Form</span>&nbsp;<span class="op" id="4900948">==</span>&nbsp;<span class="ident" id="4900951">nil</span>&nbsp;<span class="op" id="4900955">{</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4900959">if</span>&nbsp;<span class="builtinfunc" id="4900962">len</span><span class="op" id="4900965">(</span><span class="ident" id="4900966">r</span><span class="op" id="4900967">.</span><span class="ident" id="4900968">PostForm</span><span class="op" id="4900976">)</span>&nbsp;<span class="op" id="4900978">&gt;</span>&nbsp;<span class="num" id="4900980">0</span>&nbsp;<span class="op" id="4900982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4900987">r</span><span class="op" id="4900988">.</span><span class="ident" id="4900989">Form</span>&nbsp;<span class="op" id="4900994">=</span>&nbsp;<span class="builtinfunc" id="4900996">make</span><span class="op" id="4901000">(</span><span class="ident" id="4901001">url</span><span class="op" id="4901004">.</span><span class="ident" id="4901005">Values</span><span class="op" id="4901011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4901016">copyValues</span><span class="op" id="4901026">(</span><span class="ident" id="4901027">r</span><span class="op" id="4901028">.</span><span class="ident" id="4901029">Form</span><span class="op" id="4901033">,</span>&nbsp;<span class="ident" id="4901035">r</span><span class="op" id="4901036">.</span><span class="ident" id="4901037">PostForm</span><span class="op" id="4901045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4901049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4901053">var</span>&nbsp;<span class="ident" id="4901057">newValues</span>&nbsp;<span class="ident" id="4901067">url</span><span class="op" id="4901070">.</span><span class="ident" id="4901071">Values</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4901080">if</span>&nbsp;<span class="ident" id="4901083">r</span><span class="op" id="4901084">.</span><span class="ident" id="4901085">URL</span>&nbsp;<span class="op" id="4901089">!=</span>&nbsp;<span class="ident" id="4901092">nil</span>&nbsp;<span class="op" id="4901096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4901101">var</span>&nbsp;<span class="ident" id="4901105">e</span>&nbsp;<span class="builtintype" id="4901107">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4901116">newValues</span><span class="op" id="4901125">,</span>&nbsp;<span class="ident" id="4901127">e</span>&nbsp;<span class="op" id="4901129">=</span>&nbsp;<span class="ident" id="4901131">url</span><span class="op" id="4901134">.</span><span class="ident" id="4901135">ParseQuery</span><span class="op" id="4901145">(</span><span class="ident" id="4901146">r</span><span class="op" id="4901147">.</span><span class="ident" id="4901148">URL</span><span class="op" id="4901151">.</span><span class="ident" id="4901152">RawQuery</span><span class="op" id="4901160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4901165">if</span>&nbsp;<span class="ident" id="4901168">err</span>&nbsp;<span class="op" id="4901172">==</span>&nbsp;<span class="ident" id="4901175">nil</span>&nbsp;<span class="op" id="4901179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4901185">err</span>&nbsp;<span class="op" id="4901189">=</span>&nbsp;<span class="ident" id="4901191">e</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4901196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4901200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4901204">if</span>&nbsp;<span class="ident" id="4901207">newValues</span>&nbsp;<span class="op" id="4901217">==</span>&nbsp;<span class="ident" id="4901220">nil</span>&nbsp;<span class="op" id="4901224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4901229">newValues</span>&nbsp;<span class="op" id="4901239">=</span>&nbsp;<span class="builtinfunc" id="4901241">make</span><span class="op" id="4901245">(</span><span class="ident" id="4901246">url</span><span class="op" id="4901249">.</span><span class="ident" id="4901250">Values</span><span class="op" id="4901256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4901260">}</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4901264">if</span>&nbsp;<span class="ident" id="4901267">r</span><span class="op" id="4901268">.</span><span class="ident" id="4901269">Form</span>&nbsp;<span class="op" id="4901274">==</span>&nbsp;<span class="ident" id="4901277">nil</span>&nbsp;<span class="op" id="4901281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4901286">r</span><span class="op" id="4901287">.</span><span class="ident" id="4901288">Form</span>&nbsp;<span class="op" id="4901293">=</span>&nbsp;<span class="ident" id="4901295">newValues</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4901307">}</span>&nbsp;<span class="keyword" id="4901309">else</span>&nbsp;<span class="op" id="4901314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4901319">copyValues</span><span class="op" id="4901329">(</span><span class="ident" id="4901330">r</span><span class="op" id="4901331">.</span><span class="ident" id="4901332">Form</span><span class="op" id="4901336">,</span>&nbsp;<span class="ident" id="4901338">newValues</span><span class="op" id="4901347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4901351">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4901354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4901357">return</span>&nbsp;<span class="ident" id="4901364">err</span><br>
<span class="lineno"></span><span class="op" id="4901368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4901371">//&nbsp;ParseMultipartForm&nbsp;parses&nbsp;a&nbsp;request&nbsp;body&nbsp;as&nbsp;multipart/form-data.</span><br>
<span class="lineno">815</span><span class="comment" id="4901439">//&nbsp;The&nbsp;whole&nbsp;request&nbsp;body&nbsp;is&nbsp;parsed&nbsp;and&nbsp;up&nbsp;to&nbsp;a&nbsp;total&nbsp;of&nbsp;maxMemory&nbsp;bytes&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4901515">//&nbsp;its&nbsp;file&nbsp;parts&nbsp;are&nbsp;stored&nbsp;in&nbsp;memory,&nbsp;with&nbsp;the&nbsp;remainder&nbsp;stored&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="4901584">//&nbsp;disk&nbsp;in&nbsp;temporary&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="4901612">//&nbsp;ParseMultipartForm&nbsp;calls&nbsp;ParseForm&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="comment" id="4901664">//&nbsp;After&nbsp;one&nbsp;call&nbsp;to&nbsp;ParseMultipartForm,&nbsp;subsequent&nbsp;calls&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">820</span><span class="keyword" id="4901738">func</span>&nbsp;<span class="op" id="4901743">(</span><span class="ident" id="4901744">r</span>&nbsp;<span class="op" id="4901746">*</span><span class="ident" id="4901747">Request</span><span class="op" id="4901754">)</span>&nbsp;<span class="ident" id="4901756">ParseMultipartForm</span><span class="op" id="4901774">(</span><span class="ident" id="4901775">maxMemory</span>&nbsp;<span class="ident" id="4901785">int64</span><span class="op" id="4901790">)</span>&nbsp;<span class="builtintype" id="4901792">error</span>&nbsp;<span class="op" id="4901798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4901801">if</span>&nbsp;<span class="ident" id="4901804">r</span><span class="op" id="4901805">.</span><span class="ident" id="4901806">MultipartForm</span>&nbsp;<span class="op" id="4901820">==</span>&nbsp;<span class="ident" id="4901823">multipartByReader</span>&nbsp;<span class="op" id="4901841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4901845">return</span>&nbsp;<span class="ident" id="4901852">errors</span><span class="op" id="4901858">.</span><span class="ident" id="4901859">New</span><span class="op" id="4901862">(</span><span class="string" id="4901863">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;MultipartReader&#34;</span><span class="op" id="4901907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4901910">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4901913">if</span>&nbsp;<span class="ident" id="4901916">r</span><span class="op" id="4901917">.</span><span class="ident" id="4901918">Form</span>&nbsp;<span class="op" id="4901923">==</span>&nbsp;<span class="ident" id="4901926">nil</span>&nbsp;<span class="op" id="4901930">{</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4901934">err</span>&nbsp;<span class="op" id="4901938">:=</span>&nbsp;<span class="ident" id="4901941">r</span><span class="op" id="4901942">.</span><span class="ident" id="4901943">ParseForm</span><span class="op" id="4901952">(</span><span class="op" id="4901953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4901957">if</span>&nbsp;<span class="ident" id="4901960">err</span>&nbsp;<span class="op" id="4901964">!=</span>&nbsp;<span class="ident" id="4901967">nil</span>&nbsp;<span class="op" id="4901971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4901976">return</span>&nbsp;<span class="ident" id="4901983">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4901989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4901992">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4901995">if</span>&nbsp;<span class="ident" id="4901998">r</span><span class="op" id="4901999">.</span><span class="ident" id="4902000">MultipartForm</span>&nbsp;<span class="op" id="4902014">!=</span>&nbsp;<span class="ident" id="4902017">nil</span>&nbsp;<span class="op" id="4902021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4902025">return</span>&nbsp;<span class="ident" id="4902032">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4902037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4902041">mr</span><span class="op" id="4902043">,</span>&nbsp;<span class="ident" id="4902045">err</span>&nbsp;<span class="op" id="4902049">:=</span>&nbsp;<span class="ident" id="4902052">r</span><span class="op" id="4902053">.</span><span class="ident" id="4902054">multipartReader</span><span class="op" id="4902069">(</span><span class="op" id="4902070">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4902073">if</span>&nbsp;<span class="ident" id="4902076">err</span>&nbsp;<span class="op" id="4902080">!=</span>&nbsp;<span class="ident" id="4902083">nil</span>&nbsp;<span class="op" id="4902087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4902091">return</span>&nbsp;<span class="ident" id="4902098">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4902103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4902107">f</span><span class="op" id="4902108">,</span>&nbsp;<span class="ident" id="4902110">err</span>&nbsp;<span class="op" id="4902114">:=</span>&nbsp;<span class="ident" id="4902117">mr</span><span class="op" id="4902119">.</span><span class="ident" id="4902120">ReadForm</span><span class="op" id="4902128">(</span><span class="ident" id="4902129">maxMemory</span><span class="op" id="4902138">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4902141">if</span>&nbsp;<span class="ident" id="4902144">err</span>&nbsp;<span class="op" id="4902148">!=</span>&nbsp;<span class="ident" id="4902151">nil</span>&nbsp;<span class="op" id="4902155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4902159">return</span>&nbsp;<span class="ident" id="4902166">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4902171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4902174">for</span>&nbsp;<span class="ident" id="4902178">k</span><span class="op" id="4902179">,</span>&nbsp;<span class="ident" id="4902181">v</span>&nbsp;<span class="op" id="4902183">:=</span>&nbsp;<span class="keyword" id="4902186">range</span>&nbsp;<span class="ident" id="4902192">f</span><span class="op" id="4902193">.</span><span class="ident" id="4902194">Value</span>&nbsp;<span class="op" id="4902200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4902204">r</span><span class="op" id="4902205">.</span><span class="ident" id="4902206">Form</span><span class="op" id="4902210">[</span><span class="ident" id="4902211">k</span><span class="op" id="4902212">]</span>&nbsp;<span class="op" id="4902214">=</span>&nbsp;<span class="builtinfunc" id="4902216">append</span><span class="op" id="4902222">(</span><span class="ident" id="4902223">r</span><span class="op" id="4902224">.</span><span class="ident" id="4902225">Form</span><span class="op" id="4902229">[</span><span class="ident" id="4902230">k</span><span class="op" id="4902231">]</span><span class="op" id="4902232">,</span>&nbsp;<span class="ident" id="4902234">v</span><span class="op" id="4902235">...</span><span class="op" id="4902238">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4902241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4902244">r</span><span class="op" id="4902245">.</span><span class="ident" id="4902246">MultipartForm</span>&nbsp;<span class="op" id="4902260">=</span>&nbsp;<span class="ident" id="4902262">f</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4902266">return</span>&nbsp;<span class="ident" id="4902273">nil</span><br>
<span class="lineno"></span><span class="op" id="4902277">}</span><br>
<span class="lineno">850</span><br>
<span class="lineno"></span><span class="comment" id="4902280">//&nbsp;FormValue&nbsp;returns&nbsp;the&nbsp;first&nbsp;value&nbsp;for&nbsp;the&nbsp;named&nbsp;component&nbsp;of&nbsp;the&nbsp;query.</span><br>
<span class="lineno"></span><span class="comment" id="4902355">//&nbsp;POST&nbsp;and&nbsp;PUT&nbsp;body&nbsp;parameters&nbsp;take&nbsp;precedence&nbsp;over&nbsp;URL&nbsp;query&nbsp;string&nbsp;values.</span><br>
<span class="lineno"></span><span class="comment" id="4902433">//&nbsp;FormValue&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary&nbsp;and&nbsp;ignores</span><br>
<span class="lineno"></span><span class="comment" id="4902510">//&nbsp;any&nbsp;errors&nbsp;returned&nbsp;by&nbsp;these&nbsp;functions.</span><br>
<span class="lineno">855</span><span class="comment" id="4902553">//&nbsp;To&nbsp;access&nbsp;multiple&nbsp;values&nbsp;of&nbsp;the&nbsp;same&nbsp;key,&nbsp;call&nbsp;ParseForm&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4902618">//&nbsp;then&nbsp;inspect&nbsp;Request.Form&nbsp;directly.</span><br>
<span class="lineno"></span><span class="keyword" id="4902657">func</span>&nbsp;<span class="op" id="4902662">(</span><span class="ident" id="4902663">r</span>&nbsp;<span class="op" id="4902665">*</span><span class="ident" id="4902666">Request</span><span class="op" id="4902673">)</span>&nbsp;<span class="ident" id="4902675">FormValue</span><span class="op" id="4902684">(</span><span class="ident" id="4902685">key</span>&nbsp;<span class="builtintype" id="4902689">string</span><span class="op" id="4902695">)</span>&nbsp;<span class="builtintype" id="4902697">string</span>&nbsp;<span class="op" id="4902704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4902707">if</span>&nbsp;<span class="ident" id="4902710">r</span><span class="op" id="4902711">.</span><span class="ident" id="4902712">Form</span>&nbsp;<span class="op" id="4902717">==</span>&nbsp;<span class="ident" id="4902720">nil</span>&nbsp;<span class="op" id="4902724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4902728">r</span><span class="op" id="4902729">.</span><span class="ident" id="4902730">ParseMultipartForm</span><span class="op" id="4902748">(</span><span class="ident" id="4902749">defaultMaxMemory</span><span class="op" id="4902765">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4902768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4902771">if</span>&nbsp;<span class="ident" id="4902774">vs</span>&nbsp;<span class="op" id="4902777">:=</span>&nbsp;<span class="ident" id="4902780">r</span><span class="op" id="4902781">.</span><span class="ident" id="4902782">Form</span><span class="op" id="4902786">[</span><span class="ident" id="4902787">key</span><span class="op" id="4902790">]</span><span class="op" id="4902791">;</span>&nbsp;<span class="builtinfunc" id="4902793">len</span><span class="op" id="4902796">(</span><span class="ident" id="4902797">vs</span><span class="op" id="4902799">)</span>&nbsp;<span class="op" id="4902801">&gt;</span>&nbsp;<span class="num" id="4902803">0</span>&nbsp;<span class="op" id="4902805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4902809">return</span>&nbsp;<span class="ident" id="4902816">vs</span><span class="op" id="4902818">[</span><span class="num" id="4902819">0</span><span class="op" id="4902820">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4902823">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4902826">return</span>&nbsp;<span class="string" id="4902833">&#34;&#34;</span><br>
<span class="lineno">865</span><span class="op" id="4902836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4902839">//&nbsp;PostFormValue&nbsp;returns&nbsp;the&nbsp;first&nbsp;value&nbsp;for&nbsp;the&nbsp;named&nbsp;component&nbsp;of&nbsp;the&nbsp;POST</span><br>
<span class="lineno"></span><span class="comment" id="4902916">//&nbsp;or&nbsp;PUT&nbsp;request&nbsp;body.&nbsp;URL&nbsp;query&nbsp;parameters&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="4902974">//&nbsp;PostFormValue&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary&nbsp;and&nbsp;ignores</span><br>
<span class="lineno">870</span><span class="comment" id="4903055">//&nbsp;any&nbsp;errors&nbsp;returned&nbsp;by&nbsp;these&nbsp;functions.</span><br>
<span class="lineno"></span><span class="keyword" id="4903098">func</span>&nbsp;<span class="op" id="4903103">(</span><span class="ident" id="4903104">r</span>&nbsp;<span class="op" id="4903106">*</span><span class="ident" id="4903107">Request</span><span class="op" id="4903114">)</span>&nbsp;<span class="ident" id="4903116">PostFormValue</span><span class="op" id="4903129">(</span><span class="ident" id="4903130">key</span>&nbsp;<span class="builtintype" id="4903134">string</span><span class="op" id="4903140">)</span>&nbsp;<span class="builtintype" id="4903142">string</span>&nbsp;<span class="op" id="4903149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4903152">if</span>&nbsp;<span class="ident" id="4903155">r</span><span class="op" id="4903156">.</span><span class="ident" id="4903157">PostForm</span>&nbsp;<span class="op" id="4903166">==</span>&nbsp;<span class="ident" id="4903169">nil</span>&nbsp;<span class="op" id="4903173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4903177">r</span><span class="op" id="4903178">.</span><span class="ident" id="4903179">ParseMultipartForm</span><span class="op" id="4903197">(</span><span class="ident" id="4903198">defaultMaxMemory</span><span class="op" id="4903214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4903217">}</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4903220">if</span>&nbsp;<span class="ident" id="4903223">vs</span>&nbsp;<span class="op" id="4903226">:=</span>&nbsp;<span class="ident" id="4903229">r</span><span class="op" id="4903230">.</span><span class="ident" id="4903231">PostForm</span><span class="op" id="4903239">[</span><span class="ident" id="4903240">key</span><span class="op" id="4903243">]</span><span class="op" id="4903244">;</span>&nbsp;<span class="builtinfunc" id="4903246">len</span><span class="op" id="4903249">(</span><span class="ident" id="4903250">vs</span><span class="op" id="4903252">)</span>&nbsp;<span class="op" id="4903254">&gt;</span>&nbsp;<span class="num" id="4903256">0</span>&nbsp;<span class="op" id="4903258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4903262">return</span>&nbsp;<span class="ident" id="4903269">vs</span><span class="op" id="4903271">[</span><span class="num" id="4903272">0</span><span class="op" id="4903273">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4903276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4903279">return</span>&nbsp;<span class="string" id="4903286">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="4903289">}</span><br>
<span class="lineno">880</span><br>
<span class="lineno"></span><span class="comment" id="4903292">//&nbsp;FormFile&nbsp;returns&nbsp;the&nbsp;first&nbsp;file&nbsp;for&nbsp;the&nbsp;provided&nbsp;form&nbsp;key.</span><br>
<span class="lineno"></span><span class="comment" id="4903354">//&nbsp;FormFile&nbsp;calls&nbsp;ParseMultipartForm&nbsp;and&nbsp;ParseForm&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="4903419">func</span>&nbsp;<span class="op" id="4903424">(</span><span class="ident" id="4903425">r</span>&nbsp;<span class="op" id="4903427">*</span><span class="ident" id="4903428">Request</span><span class="op" id="4903435">)</span>&nbsp;<span class="ident" id="4903437">FormFile</span><span class="op" id="4903445">(</span><span class="ident" id="4903446">key</span>&nbsp;<span class="builtintype" id="4903450">string</span><span class="op" id="4903456">)</span>&nbsp;<span class="op" id="4903458">(</span><span class="ident" id="4903459">multipart</span><span class="op" id="4903468">.</span><span class="ident" id="4903469">File</span><span class="op" id="4903473">,</span>&nbsp;<span class="op" id="4903475">*</span><span class="ident" id="4903476">multipart</span><span class="op" id="4903485">.</span><span class="ident" id="4903486">FileHeader</span><span class="op" id="4903496">,</span>&nbsp;<span class="builtintype" id="4903498">error</span><span class="op" id="4903503">)</span>&nbsp;<span class="op" id="4903505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4903508">if</span>&nbsp;<span class="ident" id="4903511">r</span><span class="op" id="4903512">.</span><span class="ident" id="4903513">MultipartForm</span>&nbsp;<span class="op" id="4903527">==</span>&nbsp;<span class="ident" id="4903530">multipartByReader</span>&nbsp;<span class="op" id="4903548">{</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4903552">return</span>&nbsp;<span class="ident" id="4903559">nil</span><span class="op" id="4903562">,</span>&nbsp;<span class="ident" id="4903564">nil</span><span class="op" id="4903567">,</span>&nbsp;<span class="ident" id="4903569">errors</span><span class="op" id="4903575">.</span><span class="ident" id="4903576">New</span><span class="op" id="4903579">(</span><span class="string" id="4903580">&#34;http:&nbsp;multipart&nbsp;handled&nbsp;by&nbsp;MultipartReader&#34;</span><span class="op" id="4903624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4903627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4903630">if</span>&nbsp;<span class="ident" id="4903633">r</span><span class="op" id="4903634">.</span><span class="ident" id="4903635">MultipartForm</span>&nbsp;<span class="op" id="4903649">==</span>&nbsp;<span class="ident" id="4903652">nil</span>&nbsp;<span class="op" id="4903656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4903660">err</span>&nbsp;<span class="op" id="4903664">:=</span>&nbsp;<span class="ident" id="4903667">r</span><span class="op" id="4903668">.</span><span class="ident" id="4903669">ParseMultipartForm</span><span class="op" id="4903687">(</span><span class="ident" id="4903688">defaultMaxMemory</span><span class="op" id="4903704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4903708">if</span>&nbsp;<span class="ident" id="4903711">err</span>&nbsp;<span class="op" id="4903715">!=</span>&nbsp;<span class="ident" id="4903718">nil</span>&nbsp;<span class="op" id="4903722">{</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4903727">return</span>&nbsp;<span class="ident" id="4903734">nil</span><span class="op" id="4903737">,</span>&nbsp;<span class="ident" id="4903739">nil</span><span class="op" id="4903742">,</span>&nbsp;<span class="ident" id="4903744">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4903750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4903753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4903756">if</span>&nbsp;<span class="ident" id="4903759">r</span><span class="op" id="4903760">.</span><span class="ident" id="4903761">MultipartForm</span>&nbsp;<span class="op" id="4903775">!=</span>&nbsp;<span class="ident" id="4903778">nil</span>&nbsp;<span class="op" id="4903782">&amp;&amp;</span>&nbsp;<span class="ident" id="4903785">r</span><span class="op" id="4903786">.</span><span class="ident" id="4903787">MultipartForm</span><span class="op" id="4903800">.</span><span class="ident" id="4903801">File</span>&nbsp;<span class="op" id="4903806">!=</span>&nbsp;<span class="ident" id="4903809">nil</span>&nbsp;<span class="op" id="4903813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4903817">if</span>&nbsp;<span class="ident" id="4903820">fhs</span>&nbsp;<span class="op" id="4903824">:=</span>&nbsp;<span class="ident" id="4903827">r</span><span class="op" id="4903828">.</span><span class="ident" id="4903829">MultipartForm</span><span class="op" id="4903842">.</span><span class="ident" id="4903843">File</span><span class="op" id="4903847">[</span><span class="ident" id="4903848">key</span><span class="op" id="4903851">]</span><span class="op" id="4903852">;</span>&nbsp;<span class="builtinfunc" id="4903854">len</span><span class="op" id="4903857">(</span><span class="ident" id="4903858">fhs</span><span class="op" id="4903861">)</span>&nbsp;<span class="op" id="4903863">&gt;</span>&nbsp;<span class="num" id="4903865">0</span>&nbsp;<span class="op" id="4903867">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4903872">f</span><span class="op" id="4903873">,</span>&nbsp;<span class="ident" id="4903875">err</span>&nbsp;<span class="op" id="4903879">:=</span>&nbsp;<span class="ident" id="4903882">fhs</span><span class="op" id="4903885">[</span><span class="num" id="4903886">0</span><span class="op" id="4903887">]</span><span class="op" id="4903888">.</span><span class="ident" id="4903889">Open</span><span class="op" id="4903893">(</span><span class="op" id="4903894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4903899">return</span>&nbsp;<span class="ident" id="4903906">f</span><span class="op" id="4903907">,</span>&nbsp;<span class="ident" id="4903909">fhs</span><span class="op" id="4903912">[</span><span class="num" id="4903913">0</span><span class="op" id="4903914">]</span><span class="op" id="4903915">,</span>&nbsp;<span class="ident" id="4903917">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4903923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4903926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4903929">return</span>&nbsp;<span class="ident" id="4903936">nil</span><span class="op" id="4903939">,</span>&nbsp;<span class="ident" id="4903941">nil</span><span class="op" id="4903944">,</span>&nbsp;<span class="ident" id="4903946">ErrMissingFile</span><br>
<span class="lineno">900</span><span class="op" id="4903961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4903964">func</span>&nbsp;<span class="op" id="4903969">(</span><span class="ident" id="4903970">r</span>&nbsp;<span class="op" id="4903972">*</span><span class="ident" id="4903973">Request</span><span class="op" id="4903980">)</span>&nbsp;<span class="ident" id="4903982">expectsContinue</span><span class="op" id="4903997">(</span><span class="op" id="4903998">)</span>&nbsp;<span class="builtintype" id="4904000">bool</span>&nbsp;<span class="op" id="4904005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4904008">return</span>&nbsp;<span class="ident" id="4904015">hasToken</span><span class="op" id="4904023">(</span><span class="ident" id="4904024">r</span><span class="op" id="4904025">.</span><span class="ident" id="4904026">Header</span><span class="op" id="4904032">.</span><span class="ident" id="4904033">get</span><span class="op" id="4904036">(</span><span class="string" id="4904037">&#34;Expect&#34;</span><span class="op" id="4904045">)</span><span class="op" id="4904046">,</span>&nbsp;<span class="string" id="4904048">&#34;100-continue&#34;</span><span class="op" id="4904062">)</span><br>
<span class="lineno"></span><span class="op" id="4904064">}</span><br>
<span class="lineno">905</span><br>
<span class="lineno"></span><span class="keyword" id="4904067">func</span>&nbsp;<span class="op" id="4904072">(</span><span class="ident" id="4904073">r</span>&nbsp;<span class="op" id="4904075">*</span><span class="ident" id="4904076">Request</span><span class="op" id="4904083">)</span>&nbsp;<span class="ident" id="4904085">wantsHttp10KeepAlive</span><span class="op" id="4904105">(</span><span class="op" id="4904106">)</span>&nbsp;<span class="builtintype" id="4904108">bool</span>&nbsp;<span class="op" id="4904113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4904116">if</span>&nbsp;<span class="ident" id="4904119">r</span><span class="op" id="4904120">.</span><span class="ident" id="4904121">ProtoMajor</span>&nbsp;<span class="op" id="4904132">!=</span>&nbsp;<span class="num" id="4904135">1</span>&nbsp;<span class="op" id="4904137">||</span>&nbsp;<span class="ident" id="4904140">r</span><span class="op" id="4904141">.</span><span class="ident" id="4904142">ProtoMinor</span>&nbsp;<span class="op" id="4904153">!=</span>&nbsp;<span class="num" id="4904156">0</span>&nbsp;<span class="op" id="4904158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4904162">return</span>&nbsp;<span class="builtintype" id="4904169">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4904176">}</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4904179">return</span>&nbsp;<span class="ident" id="4904186">hasToken</span><span class="op" id="4904194">(</span><span class="ident" id="4904195">r</span><span class="op" id="4904196">.</span><span class="ident" id="4904197">Header</span><span class="op" id="4904203">.</span><span class="ident" id="4904204">get</span><span class="op" id="4904207">(</span><span class="string" id="4904208">&#34;Connection&#34;</span><span class="op" id="4904220">)</span><span class="op" id="4904221">,</span>&nbsp;<span class="string" id="4904223">&#34;keep-alive&#34;</span><span class="op" id="4904235">)</span><br>
<span class="lineno"></span><span class="op" id="4904237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4904240">func</span>&nbsp;<span class="op" id="4904245">(</span><span class="ident" id="4904246">r</span>&nbsp;<span class="op" id="4904248">*</span><span class="ident" id="4904249">Request</span><span class="op" id="4904256">)</span>&nbsp;<span class="ident" id="4904258">wantsClose</span><span class="op" id="4904268">(</span><span class="op" id="4904269">)</span>&nbsp;<span class="builtintype" id="4904271">bool</span>&nbsp;<span class="op" id="4904276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4904279">return</span>&nbsp;<span class="ident" id="4904286">hasToken</span><span class="op" id="4904294">(</span><span class="ident" id="4904295">r</span><span class="op" id="4904296">.</span><span class="ident" id="4904297">Header</span><span class="op" id="4904303">.</span><span class="ident" id="4904304">get</span><span class="op" id="4904307">(</span><span class="string" id="4904308">&#34;Connection&#34;</span><span class="op" id="4904320">)</span><span class="op" id="4904321">,</span>&nbsp;<span class="string" id="4904323">&#34;close&#34;</span><span class="op" id="4904330">)</span><br>
<span class="lineno">915</span><span class="op" id="4904332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4904335">func</span>&nbsp;<span class="op" id="4904340">(</span><span class="ident" id="4904341">r</span>&nbsp;<span class="op" id="4904343">*</span><span class="ident" id="4904344">Request</span><span class="op" id="4904351">)</span>&nbsp;<span class="ident" id="4904353">closeBody</span><span class="op" id="4904362">(</span><span class="op" id="4904363">)</span>&nbsp;<span class="op" id="4904365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4904368">if</span>&nbsp;<span class="ident" id="4904371">r</span><span class="op" id="4904372">.</span><span class="ident" id="4904373">Body</span>&nbsp;<span class="op" id="4904378">!=</span>&nbsp;<span class="ident" id="4904381">nil</span>&nbsp;<span class="op" id="4904385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4904389">r</span><span class="op" id="4904390">.</span><span class="ident" id="4904391">Body</span><span class="op" id="4904395">.</span><span class="ident" id="4904396">Close</span><span class="op" id="4904401">(</span><span class="op" id="4904402">)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4904405">}</span><br>
<span class="lineno"></span><span class="op" id="4904407">}</span>
</div>
</body>
</html>
