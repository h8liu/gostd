<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2389031">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2389087">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2389141">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2389192">//&nbsp;MakeFunc&nbsp;implementation.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2389221">package</span>&nbsp;<span class="ident" id="2389229">reflect</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2389238">import</span>&nbsp;<span class="op" id="2389245">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2389248">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="2389257">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2389260">//&nbsp;makeFuncImpl&nbsp;is&nbsp;the&nbsp;closure&nbsp;value&nbsp;implementing&nbsp;the&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="2389323">//&nbsp;returned&nbsp;by&nbsp;MakeFunc.</span><br>
<span class="lineno">15</span><span class="keyword" id="2389348">type</span>&nbsp;<span class="ident" id="2389353">makeFuncImpl</span>&nbsp;<span class="keyword" id="2389366">struct</span>&nbsp;<span class="op" id="2389373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2389376">code</span>&nbsp;&nbsp;<span class="builtintype" id="2389382">uintptr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2389391">stack</span>&nbsp;<span class="op" id="2389397">*</span><span class="ident" id="2389398"><a href="/reflect/type.go.html#2444416">bitVector</a></span>&nbsp;<span class="comment" id="2389408">//&nbsp;stack&nbsp;bitmap&nbsp;for&nbsp;args&nbsp;-&nbsp;offset&nbsp;known&nbsp;to&nbsp;runtime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2389460">typ</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2389466">*</span><span class="ident" id="2389467"><a href="/reflect/type.go.html#2404317">funcType</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2389477">fn</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2389483">func</span><span class="op" id="2389487">(</span><span class="op" id="2389488">[</span><span class="op" id="2389489">]</span><span class="ident" id="2389490"><a href="/reflect/value.go.html#2446885">Value</a></span><span class="op" id="2389495">)</span>&nbsp;<span class="op" id="2389497">[</span><span class="op" id="2389498">]</span><span class="ident" id="2389499"><a href="/reflect/value.go.html#2446885">Value</a></span><br>
<span class="lineno">20</span><span class="op" id="2389505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2389508">//&nbsp;MakeFunc&nbsp;returns&nbsp;a&nbsp;new&nbsp;function&nbsp;of&nbsp;the&nbsp;given&nbsp;Type</span><br>
<span class="lineno"></span><span class="comment" id="2389561">//&nbsp;that&nbsp;wraps&nbsp;the&nbsp;function&nbsp;fn.&nbsp;When&nbsp;called,&nbsp;that&nbsp;new&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="2389623">//&nbsp;does&nbsp;the&nbsp;following:</span><br>
<span class="lineno">25</span><span class="comment" id="2389646">//</span><br>
<span class="lineno"></span><span class="comment" id="2389649">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;converts&nbsp;its&nbsp;arguments&nbsp;to&nbsp;a&nbsp;slice&nbsp;of&nbsp;Values.</span><br>
<span class="lineno"></span><span class="comment" id="2389699">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;runs&nbsp;results&nbsp;:=&nbsp;fn(args).</span><br>
<span class="lineno"></span><span class="comment" id="2389730">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;returns&nbsp;the&nbsp;results&nbsp;as&nbsp;a&nbsp;slice&nbsp;of&nbsp;Values,&nbsp;one&nbsp;per&nbsp;formal&nbsp;result.</span><br>
<span class="lineno"></span><span class="comment" id="2389800">//</span><br>
<span class="lineno">30</span><span class="comment" id="2389803">//&nbsp;The&nbsp;implementation&nbsp;fn&nbsp;can&nbsp;assume&nbsp;that&nbsp;the&nbsp;argument&nbsp;Value&nbsp;slice</span><br>
<span class="lineno"></span><span class="comment" id="2389869">//&nbsp;has&nbsp;the&nbsp;number&nbsp;and&nbsp;type&nbsp;of&nbsp;arguments&nbsp;given&nbsp;by&nbsp;typ.</span><br>
<span class="lineno"></span><span class="comment" id="2389923">//&nbsp;If&nbsp;typ&nbsp;describes&nbsp;a&nbsp;variadic&nbsp;function,&nbsp;the&nbsp;final&nbsp;Value&nbsp;is&nbsp;itself</span><br>
<span class="lineno"></span><span class="comment" id="2389990">//&nbsp;a&nbsp;slice&nbsp;representing&nbsp;the&nbsp;variadic&nbsp;arguments,&nbsp;as&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2390048">//&nbsp;body&nbsp;of&nbsp;a&nbsp;variadic&nbsp;function.&nbsp;The&nbsp;result&nbsp;Value&nbsp;slice&nbsp;returned&nbsp;by&nbsp;fn</span><br>
<span class="lineno">35</span><span class="comment" id="2390118">//&nbsp;must&nbsp;have&nbsp;the&nbsp;number&nbsp;and&nbsp;type&nbsp;of&nbsp;results&nbsp;given&nbsp;by&nbsp;typ.</span><br>
<span class="lineno"></span><span class="comment" id="2390176">//</span><br>
<span class="lineno"></span><span class="comment" id="2390179">//&nbsp;The&nbsp;Value.Call&nbsp;method&nbsp;allows&nbsp;the&nbsp;caller&nbsp;to&nbsp;invoke&nbsp;a&nbsp;typed&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="2390249">//&nbsp;in&nbsp;terms&nbsp;of&nbsp;Values;&nbsp;in&nbsp;contrast,&nbsp;MakeFunc&nbsp;allows&nbsp;the&nbsp;caller&nbsp;to&nbsp;implement</span><br>
<span class="lineno"></span><span class="comment" id="2390325">//&nbsp;a&nbsp;typed&nbsp;function&nbsp;in&nbsp;terms&nbsp;of&nbsp;Values.</span><br>
<span class="lineno">40</span><span class="comment" id="2390365">//</span><br>
<span class="lineno"></span><span class="comment" id="2390368">//&nbsp;The&nbsp;Examples&nbsp;section&nbsp;of&nbsp;the&nbsp;documentation&nbsp;includes&nbsp;an&nbsp;illustration</span><br>
<span class="lineno"></span><span class="comment" id="2390438">//&nbsp;of&nbsp;how&nbsp;to&nbsp;use&nbsp;MakeFunc&nbsp;to&nbsp;build&nbsp;a&nbsp;swap&nbsp;function&nbsp;for&nbsp;different&nbsp;types.</span><br>
<span class="lineno"></span><span class="comment" id="2390510">//</span><br>
<span class="lineno"></span><span class="keyword" id="2390513">func</span>&nbsp;<span class="ident" id="2390518">MakeFunc</span><span class="op" id="2390526">(</span><span class="ident" id="2390527">typ</span>&nbsp;<span class="ident" id="2390531"><a href="/reflect/type.go.html#2394795">Type</a></span><span class="op" id="2390535">,</span>&nbsp;<span class="ident" id="2390537">fn</span>&nbsp;<span class="keyword" id="2390540">func</span><span class="op" id="2390544">(</span><span class="ident" id="2390545">args</span>&nbsp;<span class="op" id="2390550">[</span><span class="op" id="2390551">]</span><span class="ident" id="2390552"><a href="/reflect/value.go.html#2446885">Value</a></span><span class="op" id="2390557">)</span>&nbsp;<span class="op" id="2390559">(</span><span class="ident" id="2390560">results</span>&nbsp;<span class="op" id="2390568">[</span><span class="op" id="2390569">]</span><span class="ident" id="2390570"><a href="/reflect/value.go.html#2446885">Value</a></span><span class="op" id="2390575">)</span><span class="op" id="2390576">)</span>&nbsp;<span class="ident" id="2390578"><a href="/reflect/value.go.html#2446885">Value</a></span>&nbsp;<span class="op" id="2390584">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2390587">if</span>&nbsp;<span class="ident" id="2390590"><a href="/reflect/makefunc.go.html#2390527">typ</a></span><span class="op" id="2390593">.</span><span class="ident" id="2390594">Kind</span><span class="op" id="2390598">(</span><span class="op" id="2390599">)</span>&nbsp;<span class="op" id="2390601">!=</span>&nbsp;<span class="ident" id="2390604"><a href="/reflect/type.go.html#2401363">Func</a></span>&nbsp;<span class="op" id="2390609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2390613">panic</span><span class="op" id="2390618">(</span><span class="string" id="2390619">&#34;reflect:&nbsp;call&nbsp;of&nbsp;MakeFunc&nbsp;with&nbsp;non-Func&nbsp;type&#34;</span><span class="op" id="2390665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2390668">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390672">t</span>&nbsp;<span class="op" id="2390674">:=</span>&nbsp;<span class="ident" id="2390677"><a href="/reflect/makefunc.go.html#2390527">typ</a></span><span class="op" id="2390680">.</span><span class="ident" id="2390681">common</span><span class="op" id="2390687">(</span><span class="op" id="2390688">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390691">ftyp</span>&nbsp;<span class="op" id="2390696">:=</span>&nbsp;<span class="op" id="2390699">(</span><span class="op" id="2390700">*</span><span class="ident" id="2390701"><a href="/reflect/type.go.html#2404317">funcType</a></span><span class="op" id="2390709">)</span><span class="op" id="2390710">(</span><span class="ident" id="2390711"><a href="/reflect/makefunc.go.html#2389248">unsafe</a></span><span class="op" id="2390717">.</span><span class="ident" id="2390718">Pointer</span><span class="op" id="2390725">(</span><span class="ident" id="2390726"><a href="/reflect/makefunc.go.html#2390672">t</a></span><span class="op" id="2390727">)</span><span class="op" id="2390728">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2390732">//&nbsp;Indirect&nbsp;Go&nbsp;func&nbsp;value&nbsp;(dummy)&nbsp;to&nbsp;obtain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2390777">//&nbsp;actual&nbsp;code&nbsp;address.&nbsp;(A&nbsp;Go&nbsp;func&nbsp;value&nbsp;is&nbsp;a&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2390832">//&nbsp;to&nbsp;a&nbsp;C&nbsp;function&nbsp;pointer.&nbsp;http://golang.org/s/go11func.)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390892">dummy</span>&nbsp;<span class="op" id="2390898">:=</span>&nbsp;<span class="ident" id="2390901"><a href="/reflect/makefunc.go.html#2391518">makeFuncStub</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2390915">code</span>&nbsp;<span class="op" id="2390920">:=</span>&nbsp;<span class="op" id="2390923">*</span><span class="op" id="2390924">*</span><span class="op" id="2390925">(</span><span class="op" id="2390926">*</span><span class="op" id="2390927">*</span><span class="builtintype" id="2390928">uintptr</span><span class="op" id="2390935">)</span><span class="op" id="2390936">(</span><span class="ident" id="2390937"><a href="/reflect/makefunc.go.html#2389248">unsafe</a></span><span class="op" id="2390943">.</span><span class="ident" id="2390944">Pointer</span><span class="op" id="2390951">(</span><span class="op" id="2390952">&amp;</span><span class="ident" id="2390953"><a href="/reflect/makefunc.go.html#2390892">dummy</a></span><span class="op" id="2390958">)</span><span class="op" id="2390959">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2390963">//&nbsp;makeFuncImpl&nbsp;contains&nbsp;a&nbsp;stack&nbsp;map&nbsp;for&nbsp;use&nbsp;by&nbsp;the&nbsp;runtime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2391024">_</span><span class="op" id="2391025">,</span>&nbsp;<span class="ident" id="2391027">_</span><span class="op" id="2391028">,</span>&nbsp;<span class="ident" id="2391030">_</span><span class="op" id="2391031">,</span>&nbsp;<span class="ident" id="2391033">stack</span>&nbsp;<span class="op" id="2391039">:=</span>&nbsp;<span class="ident" id="2391042"><a href="/reflect/type.go.html#2442017">funcLayout</a></span><span class="op" id="2391052">(</span><span class="ident" id="2391053"><a href="/reflect/makefunc.go.html#2390672">t</a></span><span class="op" id="2391054">,</span>&nbsp;<span class="ident" id="2391056">nil</span><span class="op" id="2391059">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2391063">impl</span>&nbsp;<span class="op" id="2391068">:=</span>&nbsp;<span class="op" id="2391071">&amp;</span><span class="ident" id="2391072"><a href="/reflect/makefunc.go.html#2389353">makeFuncImpl</a></span><span class="op" id="2391084">{</span><span class="ident" id="2391085">code</span><span class="op" id="2391089">:</span>&nbsp;<span class="ident" id="2391091"><a href="/reflect/makefunc.go.html#2390915">code</a></span><span class="op" id="2391095">,</span>&nbsp;<span class="ident" id="2391097">stack</span><span class="op" id="2391102">:</span>&nbsp;<span class="ident" id="2391104"><a href="/reflect/makefunc.go.html#2391033">stack</a></span><span class="op" id="2391109">,</span>&nbsp;<span class="ident" id="2391111">typ</span><span class="op" id="2391114">:</span>&nbsp;<span class="ident" id="2391116"><a href="/reflect/makefunc.go.html#2390691">ftyp</a></span><span class="op" id="2391120">,</span>&nbsp;<span class="ident" id="2391122">fn</span><span class="op" id="2391124">:</span>&nbsp;<span class="ident" id="2391126"><a href="/reflect/makefunc.go.html#2390537">fn</a></span><span class="op" id="2391128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2391132">return</span>&nbsp;<span class="ident" id="2391139"><a href="/reflect/value.go.html#2446885">Value</a></span><span class="op" id="2391144">{</span><span class="ident" id="2391145"><a href="/reflect/makefunc.go.html#2390672">t</a></span><span class="op" id="2391146">,</span>&nbsp;<span class="ident" id="2391148"><a href="/reflect/makefunc.go.html#2389248">unsafe</a></span><span class="op" id="2391154">.</span><span class="ident" id="2391155">Pointer</span><span class="op" id="2391162">(</span><span class="ident" id="2391163"><a href="/reflect/makefunc.go.html#2391063">impl</a></span><span class="op" id="2391167">)</span><span class="op" id="2391168">,</span>&nbsp;<span class="ident" id="2391170"><a href="/reflect/value.go.html#2448016">flag</a></span><span class="op" id="2391174">(</span><span class="ident" id="2391175"><a href="/reflect/type.go.html#2401363">Func</a></span><span class="op" id="2391179">)</span><span class="op" id="2391180">}</span><br>
<span class="lineno"></span><span class="op" id="2391182">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="2391185">//&nbsp;makeFuncStub&nbsp;is&nbsp;an&nbsp;assembly&nbsp;function&nbsp;that&nbsp;is&nbsp;the&nbsp;code&nbsp;half&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2391250">//&nbsp;the&nbsp;function&nbsp;returned&nbsp;from&nbsp;MakeFunc.&nbsp;It&nbsp;expects&nbsp;a&nbsp;*callReflectFunc</span><br>
<span class="lineno"></span><span class="comment" id="2391320">//&nbsp;as&nbsp;its&nbsp;context&nbsp;register,&nbsp;and&nbsp;its&nbsp;job&nbsp;is&nbsp;to&nbsp;invoke&nbsp;callReflect(ctxt,&nbsp;frame)</span><br>
<span class="lineno"></span><span class="comment" id="2391398">//&nbsp;where&nbsp;ctxt&nbsp;is&nbsp;the&nbsp;context&nbsp;register&nbsp;and&nbsp;frame&nbsp;is&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;first</span><br>
<span class="lineno">70</span><span class="comment" id="2391472">//&nbsp;word&nbsp;in&nbsp;the&nbsp;passed-in&nbsp;argument&nbsp;frame.</span><br>
<span class="lineno"></span><span class="keyword" id="2391513">func</span>&nbsp;<span class="ident" id="2391518">makeFuncStub</span><span class="op" id="2391530">(</span><span class="op" id="2391531">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2391534">type</span>&nbsp;<span class="ident" id="2391539">methodValue</span>&nbsp;<span class="keyword" id="2391551">struct</span>&nbsp;<span class="op" id="2391558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2391561">fn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2391568">uintptr</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2391577">stack</span>&nbsp;&nbsp;<span class="op" id="2391584">*</span><span class="ident" id="2391585"><a href="/reflect/type.go.html#2444416">bitVector</a></span>&nbsp;<span class="comment" id="2391595">//&nbsp;stack&nbsp;bitmap&nbsp;for&nbsp;args&nbsp;-&nbsp;offset&nbsp;known&nbsp;to&nbsp;runtime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2391647">method</span>&nbsp;<span class="builtintype" id="2391654">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2391659">rcvr</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2391666"><a href="/reflect/value.go.html#2446885">Value</a></span><br>
<span class="lineno"></span><span class="op" id="2391672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="2391675">//&nbsp;makeMethodValue&nbsp;converts&nbsp;v&nbsp;from&nbsp;the&nbsp;rcvr+method&nbsp;index&nbsp;representation</span><br>
<span class="lineno"></span><span class="comment" id="2391747">//&nbsp;of&nbsp;a&nbsp;method&nbsp;value&nbsp;to&nbsp;an&nbsp;actual&nbsp;method&nbsp;func&nbsp;value,&nbsp;which&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2391809">//&nbsp;basically&nbsp;the&nbsp;receiver&nbsp;value&nbsp;with&nbsp;a&nbsp;special&nbsp;bit&nbsp;set,&nbsp;into&nbsp;a&nbsp;true</span><br>
<span class="lineno"></span><span class="comment" id="2391877">//&nbsp;func&nbsp;value&nbsp;-&nbsp;a&nbsp;value&nbsp;holding&nbsp;an&nbsp;actual&nbsp;func.&nbsp;The&nbsp;output&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="2391939">//&nbsp;semantically&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;input&nbsp;as&nbsp;far&nbsp;as&nbsp;the&nbsp;user&nbsp;of&nbsp;package</span><br>
<span class="lineno">85</span><span class="comment" id="2392009">//&nbsp;reflect&nbsp;can&nbsp;tell,&nbsp;but&nbsp;the&nbsp;true&nbsp;func&nbsp;representation&nbsp;can&nbsp;be&nbsp;handled</span><br>
<span class="lineno"></span><span class="comment" id="2392078">//&nbsp;by&nbsp;code&nbsp;like&nbsp;Convert&nbsp;and&nbsp;Interface&nbsp;and&nbsp;Assign.</span><br>
<span class="lineno"></span><span class="keyword" id="2392128">func</span>&nbsp;<span class="ident" id="2392133">makeMethodValue</span><span class="op" id="2392148">(</span><span class="ident" id="2392149">op</span>&nbsp;<span class="builtintype" id="2392152">string</span><span class="op" id="2392158">,</span>&nbsp;<span class="ident" id="2392160">v</span>&nbsp;<span class="ident" id="2392162"><a href="/reflect/value.go.html#2446885">Value</a></span><span class="op" id="2392167">)</span>&nbsp;<span class="ident" id="2392169"><a href="/reflect/value.go.html#2446885">Value</a></span>&nbsp;<span class="op" id="2392175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2392178">if</span>&nbsp;<span class="ident" id="2392181"><a href="/reflect/makefunc.go.html#2392160">v</a></span><span class="op" id="2392182">.</span><span class="ident" id="2392183">flag</span><span class="op" id="2392187">&amp;</span><span class="ident" id="2392188"><a href="/reflect/value.go.html#2448225">flagMethod</a></span>&nbsp;<span class="op" id="2392199">==</span>&nbsp;<span class="num" id="2392202">0</span>&nbsp;<span class="op" id="2392204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="2392208">panic</span><span class="op" id="2392213">(</span><span class="string" id="2392214">&#34;reflect:&nbsp;internal&nbsp;error:&nbsp;invalid&nbsp;use&nbsp;of&nbsp;makeMethodValue&#34;</span><span class="op" id="2392271">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2392274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2392278">//&nbsp;Ignoring&nbsp;the&nbsp;flagMethod&nbsp;bit,&nbsp;v&nbsp;describes&nbsp;the&nbsp;receiver,&nbsp;not&nbsp;the&nbsp;method&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392358">fl</span>&nbsp;<span class="op" id="2392361">:=</span>&nbsp;<span class="ident" id="2392364"><a href="/reflect/makefunc.go.html#2392160">v</a></span><span class="op" id="2392365">.</span><span class="ident" id="2392366">flag</span>&nbsp;<span class="op" id="2392371">&amp;</span>&nbsp;<span class="op" id="2392373">(</span><span class="ident" id="2392374"><a href="/reflect/value.go.html#2448132">flagRO</a></span>&nbsp;<span class="op" id="2392381">|</span>&nbsp;<span class="ident" id="2392383"><a href="/reflect/value.go.html#2448194">flagAddr</a></span>&nbsp;<span class="op" id="2392392">|</span>&nbsp;<span class="ident" id="2392394"><a href="/reflect/value.go.html#2448163">flagIndir</a></span><span class="op" id="2392403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392406"><a href="/reflect/makefunc.go.html#2392358">fl</a></span>&nbsp;<span class="op" id="2392409">|=</span>&nbsp;<span class="ident" id="2392412"><a href="/reflect/value.go.html#2448016">flag</a></span><span class="op" id="2392416">(</span><span class="ident" id="2392417"><a href="/reflect/makefunc.go.html#2392160">v</a></span><span class="op" id="2392418">.</span><span class="ident" id="2392419">typ</span><span class="op" id="2392422">.</span><span class="ident" id="2392423">Kind</span><span class="op" id="2392427">(</span><span class="op" id="2392428">)</span><span class="op" id="2392429">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392432">rcvr</span>&nbsp;<span class="op" id="2392437">:=</span>&nbsp;<span class="ident" id="2392440"><a href="/reflect/value.go.html#2446885">Value</a></span><span class="op" id="2392445">{</span><span class="ident" id="2392446"><a href="/reflect/makefunc.go.html#2392160">v</a></span><span class="op" id="2392447">.</span><span class="ident" id="2392448">typ</span><span class="op" id="2392451">,</span>&nbsp;<span class="ident" id="2392453"><a href="/reflect/makefunc.go.html#2392160">v</a></span><span class="op" id="2392454">.</span><span class="ident" id="2392455">ptr</span><span class="op" id="2392458">,</span>&nbsp;<span class="ident" id="2392460"><a href="/reflect/makefunc.go.html#2392358">fl</a></span><span class="op" id="2392462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2392466">//&nbsp;v.Type&nbsp;returns&nbsp;the&nbsp;actual&nbsp;type&nbsp;of&nbsp;the&nbsp;method&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392522">funcType</span>&nbsp;<span class="op" id="2392531">:=</span>&nbsp;<span class="ident" id="2392534"><a href="/reflect/makefunc.go.html#2392160">v</a></span><span class="op" id="2392535">.</span><span class="ident" id="2392536">Type</span><span class="op" id="2392540">(</span><span class="op" id="2392541">)</span><span class="op" id="2392542">.</span><span class="op" id="2392543">(</span><span class="op" id="2392544">*</span><span class="ident" id="2392545"><a href="/reflect/type.go.html#2401678">rtype</a></span><span class="op" id="2392550">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2392554">//&nbsp;Indirect&nbsp;Go&nbsp;func&nbsp;value&nbsp;(dummy)&nbsp;to&nbsp;obtain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2392599">//&nbsp;actual&nbsp;code&nbsp;address.&nbsp;(A&nbsp;Go&nbsp;func&nbsp;value&nbsp;is&nbsp;a&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2392654">//&nbsp;to&nbsp;a&nbsp;C&nbsp;function&nbsp;pointer.&nbsp;http://golang.org/s/go11func.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392714">dummy</span>&nbsp;<span class="op" id="2392720">:=</span>&nbsp;<span class="ident" id="2392723"><a href="/reflect/makefunc.go.html#2393639">methodValueCall</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392740">code</span>&nbsp;<span class="op" id="2392745">:=</span>&nbsp;<span class="op" id="2392748">*</span><span class="op" id="2392749">*</span><span class="op" id="2392750">(</span><span class="op" id="2392751">*</span><span class="op" id="2392752">*</span><span class="builtintype" id="2392753">uintptr</span><span class="op" id="2392760">)</span><span class="op" id="2392761">(</span><span class="ident" id="2392762"><a href="/reflect/makefunc.go.html#2389248">unsafe</a></span><span class="op" id="2392768">.</span><span class="ident" id="2392769">Pointer</span><span class="op" id="2392776">(</span><span class="op" id="2392777">&amp;</span><span class="ident" id="2392778"><a href="/reflect/makefunc.go.html#2392714">dummy</a></span><span class="op" id="2392783">)</span><span class="op" id="2392784">)</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2392788">//&nbsp;methodValue&nbsp;contains&nbsp;a&nbsp;stack&nbsp;map&nbsp;for&nbsp;use&nbsp;by&nbsp;the&nbsp;runtime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392848">_</span><span class="op" id="2392849">,</span>&nbsp;<span class="ident" id="2392851">_</span><span class="op" id="2392852">,</span>&nbsp;<span class="ident" id="2392854">_</span><span class="op" id="2392855">,</span>&nbsp;<span class="ident" id="2392857">stack</span>&nbsp;<span class="op" id="2392863">:=</span>&nbsp;<span class="ident" id="2392866"><a href="/reflect/type.go.html#2442017">funcLayout</a></span><span class="op" id="2392876">(</span><span class="ident" id="2392877"><a href="/reflect/makefunc.go.html#2392522">funcType</a></span><span class="op" id="2392885">,</span>&nbsp;<span class="ident" id="2392887">nil</span><span class="op" id="2392890">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392894">fv</span>&nbsp;<span class="op" id="2392897">:=</span>&nbsp;<span class="op" id="2392900">&amp;</span><span class="ident" id="2392901"><a href="/reflect/makefunc.go.html#2391539">methodValue</a></span><span class="op" id="2392912">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392916">fn</span><span class="op" id="2392918">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2392924"><a href="/reflect/makefunc.go.html#2392740">code</a></span><span class="op" id="2392928">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392932">stack</span><span class="op" id="2392937">:</span>&nbsp;&nbsp;<span class="ident" id="2392940"><a href="/reflect/makefunc.go.html#2392857">stack</a></span><span class="op" id="2392945">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392949">method</span><span class="op" id="2392955">:</span>&nbsp;<span class="builtintype" id="2392957">int</span><span class="op" id="2392960">(</span><span class="ident" id="2392961"><a href="/reflect/makefunc.go.html#2392160">v</a></span><span class="op" id="2392962">.</span><span class="ident" id="2392963">flag</span><span class="op" id="2392967">)</span>&nbsp;<span class="op" id="2392969">&gt;&gt;</span>&nbsp;<span class="ident" id="2392972"><a href="/reflect/value.go.html#2448256">flagMethodShift</a></span><span class="op" id="2392987">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2392991">rcvr</span><span class="op" id="2392995">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2392999"><a href="/reflect/makefunc.go.html#2392432">rcvr</a></span><span class="op" id="2393003">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2393006">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2393010">//&nbsp;Cause&nbsp;panic&nbsp;if&nbsp;method&nbsp;is&nbsp;not&nbsp;appropriate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2393056">//&nbsp;The&nbsp;panic&nbsp;would&nbsp;still&nbsp;happen&nbsp;during&nbsp;the&nbsp;call&nbsp;if&nbsp;we&nbsp;omit&nbsp;this,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2393122">//&nbsp;but&nbsp;we&nbsp;want&nbsp;Interface()&nbsp;and&nbsp;other&nbsp;operations&nbsp;to&nbsp;fail&nbsp;early.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2393186"><a href="/reflect/value.go.html#2461614">methodReceiver</a></span><span class="op" id="2393200">(</span><span class="ident" id="2393201"><a href="/reflect/makefunc.go.html#2392149">op</a></span><span class="op" id="2393203">,</span>&nbsp;<span class="ident" id="2393205"><a href="/reflect/makefunc.go.html#2392894">fv</a></span><span class="op" id="2393207">.</span><span class="ident" id="2393208">rcvr</span><span class="op" id="2393212">,</span>&nbsp;<span class="ident" id="2393214"><a href="/reflect/makefunc.go.html#2392894">fv</a></span><span class="op" id="2393216">.</span><span class="ident" id="2393217">method</span><span class="op" id="2393223">)</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2393227">return</span>&nbsp;<span class="ident" id="2393234"><a href="/reflect/value.go.html#2446885">Value</a></span><span class="op" id="2393239">{</span><span class="ident" id="2393240"><a href="/reflect/makefunc.go.html#2392522">funcType</a></span><span class="op" id="2393248">,</span>&nbsp;<span class="ident" id="2393250"><a href="/reflect/makefunc.go.html#2389248">unsafe</a></span><span class="op" id="2393256">.</span><span class="ident" id="2393257">Pointer</span><span class="op" id="2393264">(</span><span class="ident" id="2393265"><a href="/reflect/makefunc.go.html#2392894">fv</a></span><span class="op" id="2393267">)</span><span class="op" id="2393268">,</span>&nbsp;<span class="ident" id="2393270"><a href="/reflect/makefunc.go.html#2392160">v</a></span><span class="op" id="2393271">.</span><span class="ident" id="2393272">flag</span><span class="op" id="2393276">&amp;</span><span class="ident" id="2393277"><a href="/reflect/value.go.html#2448132">flagRO</a></span>&nbsp;<span class="op" id="2393284">|</span>&nbsp;<span class="ident" id="2393286"><a href="/reflect/value.go.html#2448016">flag</a></span><span class="op" id="2393290">(</span><span class="ident" id="2393291"><a href="/reflect/type.go.html#2401363">Func</a></span><span class="op" id="2393295">)</span><span class="op" id="2393296">}</span><br>
<span class="lineno"></span><span class="op" id="2393298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2393301">//&nbsp;methodValueCall&nbsp;is&nbsp;an&nbsp;assembly&nbsp;function&nbsp;that&nbsp;is&nbsp;the&nbsp;code&nbsp;half&nbsp;of</span><br>
<span class="lineno">125</span><span class="comment" id="2393369">//&nbsp;the&nbsp;function&nbsp;returned&nbsp;from&nbsp;makeMethodValue.&nbsp;It&nbsp;expects&nbsp;a&nbsp;*methodValue</span><br>
<span class="lineno"></span><span class="comment" id="2393442">//&nbsp;as&nbsp;its&nbsp;context&nbsp;register,&nbsp;and&nbsp;its&nbsp;job&nbsp;is&nbsp;to&nbsp;invoke&nbsp;callMethod(ctxt,&nbsp;frame)</span><br>
<span class="lineno"></span><span class="comment" id="2393519">//&nbsp;where&nbsp;ctxt&nbsp;is&nbsp;the&nbsp;context&nbsp;register&nbsp;and&nbsp;frame&nbsp;is&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span><span class="comment" id="2393593">//&nbsp;word&nbsp;in&nbsp;the&nbsp;passed-in&nbsp;argument&nbsp;frame.</span><br>
<span class="lineno"></span><span class="keyword" id="2393634">func</span>&nbsp;<span class="ident" id="2393639">methodValueCall</span><span class="op" id="2393654">(</span><span class="op" id="2393655">)</span>
</div>
</body>
</html>
