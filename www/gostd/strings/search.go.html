<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>strings</h2>
<ul>
<li><a href="/gostd/strings/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/strings/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/strings/reader.go.html">reader.go</a></li>
<li><a href="/gostd/strings/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/strings/replace.go.html">replace.go</a></li>
<li><a href="/gostd/strings/replace_test.go.html">replace_test.go</a></li>
<li><a href="/gostd/strings/search.go.html">search.go</a></li>
<li><a href="/gostd/strings/search_test.go.html">search_test.go</a></li>
<li><a href="/gostd/strings/strings.go.html">strings.go</a></li>
<li><a href="/gostd/strings/strings_decl.go.html">strings_decl.go</a></li>
<li><a href="/gostd/strings/strings_test.go.html">strings_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2812577">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2812632">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2812686">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2812737">package</span>&nbsp;<span class="ident" id="2812745">strings</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2812754">//&nbsp;stringFinder&nbsp;efficiently&nbsp;finds&nbsp;strings&nbsp;in&nbsp;a&nbsp;source&nbsp;text.&nbsp;It&#39;s&nbsp;implemented</span><br>
<span class="lineno"></span><span class="comment" id="2812831">//&nbsp;using&nbsp;the&nbsp;Boyer-Moore&nbsp;string&nbsp;search&nbsp;algorithm:</span><br>
<span class="lineno"></span><span class="comment" id="2812881">//&nbsp;http://en.wikipedia.org/wiki/Boyer-Moore_string_search_algorithm</span><br>
<span class="lineno">10</span><span class="comment" id="2812949">//&nbsp;http://www.cs.utexas.edu/~moore/publications/fstrpos.pdf&nbsp;(note:&nbsp;this&nbsp;aged</span><br>
<span class="lineno"></span><span class="comment" id="2813026">//&nbsp;document&nbsp;uses&nbsp;1-based&nbsp;indexing)</span><br>
<span class="lineno"></span><span class="keyword" id="2813061">type</span>&nbsp;<span class="ident" id="2813066">stringFinder</span>&nbsp;<span class="keyword" id="2813079">struct</span>&nbsp;<span class="op" id="2813086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2813089">//&nbsp;pattern&nbsp;is&nbsp;the&nbsp;string&nbsp;that&nbsp;we&nbsp;are&nbsp;searching&nbsp;for&nbsp;in&nbsp;the&nbsp;text.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2813154">pattern</span>&nbsp;<span class="builtintype" id="2813162">string</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2813171">//&nbsp;badCharSkip[b]&nbsp;contains&nbsp;the&nbsp;distance&nbsp;between&nbsp;the&nbsp;last&nbsp;byte&nbsp;of&nbsp;pattern</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2813245">//&nbsp;and&nbsp;the&nbsp;rightmost&nbsp;occurrence&nbsp;of&nbsp;b&nbsp;in&nbsp;pattern.&nbsp;If&nbsp;b&nbsp;is&nbsp;not&nbsp;in&nbsp;pattern,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2813319">//&nbsp;badCharSkip[b]&nbsp;is&nbsp;len(pattern).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2813355">//</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2813359">//&nbsp;Whenever&nbsp;a&nbsp;mismatch&nbsp;is&nbsp;found&nbsp;with&nbsp;byte&nbsp;b&nbsp;in&nbsp;the&nbsp;text,&nbsp;we&nbsp;can&nbsp;safely</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2813431">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;at&nbsp;least&nbsp;badCharSkip[b]&nbsp;until&nbsp;the&nbsp;next&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2813504">//&nbsp;the&nbsp;matching&nbsp;char&nbsp;could&nbsp;be&nbsp;in&nbsp;alignment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2813549">badCharSkip</span>&nbsp;<span class="op" id="2813561">[</span><span class="num" id="2813562">256</span><span class="op" id="2813565">]</span><span class="builtintype" id="2813566">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2813572">//&nbsp;goodSuffixSkip[i]&nbsp;defines&nbsp;how&nbsp;far&nbsp;we&nbsp;can&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2813648">//&nbsp;that&nbsp;the&nbsp;suffix&nbsp;pattern[i+1:]&nbsp;matches,&nbsp;but&nbsp;the&nbsp;byte&nbsp;pattern[i]&nbsp;does</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2813720">//&nbsp;not.&nbsp;There&nbsp;are&nbsp;two&nbsp;cases&nbsp;to&nbsp;consider:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2813762">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2813766">//&nbsp;1.&nbsp;The&nbsp;matched&nbsp;suffix&nbsp;occurs&nbsp;elsewhere&nbsp;in&nbsp;pattern&nbsp;(with&nbsp;a&nbsp;different</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2813838">//&nbsp;byte&nbsp;preceding&nbsp;it&nbsp;that&nbsp;we&nbsp;might&nbsp;possibly&nbsp;match).&nbsp;In&nbsp;this&nbsp;case,&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2813912">//&nbsp;shift&nbsp;the&nbsp;matching&nbsp;frame&nbsp;to&nbsp;align&nbsp;with&nbsp;the&nbsp;next&nbsp;suffix&nbsp;chunk.&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2813982">//&nbsp;example,&nbsp;the&nbsp;pattern&nbsp;&#34;mississi&#34;&nbsp;has&nbsp;the&nbsp;suffix&nbsp;&#34;issi&#34;&nbsp;next&nbsp;occurring</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2814055">//&nbsp;(in&nbsp;right-to-left&nbsp;order)&nbsp;at&nbsp;index&nbsp;1,&nbsp;so&nbsp;goodSuffixSkip[3]&nbsp;==</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2814120">//&nbsp;shift+len(suffix)&nbsp;==&nbsp;3+4&nbsp;==&nbsp;7.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2814155">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2814159">//&nbsp;2.&nbsp;If&nbsp;the&nbsp;matched&nbsp;suffix&nbsp;does&nbsp;not&nbsp;occur&nbsp;elsewhere&nbsp;in&nbsp;pattern,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2814234">//&nbsp;matching&nbsp;frame&nbsp;may&nbsp;share&nbsp;part&nbsp;of&nbsp;its&nbsp;prefix&nbsp;with&nbsp;the&nbsp;end&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2814302">//&nbsp;matching&nbsp;suffix.&nbsp;In&nbsp;this&nbsp;case,&nbsp;goodSuffixSkip[i]&nbsp;will&nbsp;contain&nbsp;how&nbsp;far</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2814376">//&nbsp;to&nbsp;shift&nbsp;the&nbsp;frame&nbsp;to&nbsp;align&nbsp;this&nbsp;portion&nbsp;of&nbsp;the&nbsp;prefix&nbsp;to&nbsp;the</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2814442">//&nbsp;suffix.&nbsp;For&nbsp;example,&nbsp;in&nbsp;the&nbsp;pattern&nbsp;&#34;abcxxxabc&#34;,&nbsp;when&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2814510">//&nbsp;mismatch&nbsp;from&nbsp;the&nbsp;back&nbsp;is&nbsp;found&nbsp;to&nbsp;be&nbsp;in&nbsp;position&nbsp;3,&nbsp;the&nbsp;matching</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2814580">//&nbsp;suffix&nbsp;&#34;xxabc&#34;&nbsp;is&nbsp;not&nbsp;found&nbsp;elsewhere&nbsp;in&nbsp;the&nbsp;pattern.&nbsp;However,&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2814651">//&nbsp;rightmost&nbsp;&#34;abc&#34;&nbsp;(at&nbsp;position&nbsp;6)&nbsp;is&nbsp;a&nbsp;prefix&nbsp;of&nbsp;the&nbsp;whole&nbsp;pattern,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2814724">//&nbsp;goodSuffixSkip[3]&nbsp;==&nbsp;shift+len(suffix)&nbsp;==&nbsp;6+5&nbsp;==&nbsp;11.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2814781">goodSuffixSkip</span>&nbsp;<span class="op" id="2814796">[</span><span class="op" id="2814797">]</span><span class="builtintype" id="2814798">int</span><br>
<span class="lineno"></span><span class="op" id="2814802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2814805">func</span>&nbsp;<span class="ident" id="2814810">makeStringFinder</span><span class="op" id="2814826">(</span><span class="ident" id="2814827">pattern</span>&nbsp;<span class="builtintype" id="2814835">string</span><span class="op" id="2814841">)</span>&nbsp;<span class="op" id="2814843">*</span><span class="ident" id="2814844">stringFinder</span>&nbsp;<span class="op" id="2814857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2814860">f</span>&nbsp;<span class="op" id="2814862">:=</span>&nbsp;<span class="op" id="2814865">&amp;</span><span class="ident" id="2814866">stringFinder</span><span class="op" id="2814878">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2814882">pattern</span><span class="op" id="2814889">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2814898">pattern</span><span class="op" id="2814905">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2814909">goodSuffixSkip</span><span class="op" id="2814923">:</span>&nbsp;<span class="builtinfunc" id="2814925">make</span><span class="op" id="2814929">(</span><span class="op" id="2814930">[</span><span class="op" id="2814931">]</span><span class="builtintype" id="2814932">int</span><span class="op" id="2814935">,</span>&nbsp;<span class="builtinfunc" id="2814937">len</span><span class="op" id="2814940">(</span><span class="ident" id="2814941">pattern</span><span class="op" id="2814948">)</span><span class="op" id="2814949">)</span><span class="op" id="2814950">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2814953">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2814956">//&nbsp;last&nbsp;is&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;last&nbsp;character&nbsp;in&nbsp;the&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2815016">last</span>&nbsp;<span class="op" id="2815021">:=</span>&nbsp;<span class="builtinfunc" id="2815024">len</span><span class="op" id="2815027">(</span><span class="ident" id="2815028">pattern</span><span class="op" id="2815035">)</span>&nbsp;<span class="op" id="2815037">-</span>&nbsp;<span class="num" id="2815039">1</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2815043">//&nbsp;Build&nbsp;bad&nbsp;character&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2815074">//&nbsp;Bytes&nbsp;not&nbsp;in&nbsp;the&nbsp;pattern&nbsp;can&nbsp;skip&nbsp;one&nbsp;pattern&#39;s&nbsp;length.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2815134">for</span>&nbsp;<span class="ident" id="2815138">i</span>&nbsp;<span class="op" id="2815140">:=</span>&nbsp;<span class="keyword" id="2815143">range</span>&nbsp;<span class="ident" id="2815149">f</span><span class="op" id="2815150">.</span><span class="ident" id="2815151">badCharSkip</span>&nbsp;<span class="op" id="2815163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2815167">f</span><span class="op" id="2815168">.</span><span class="ident" id="2815169">badCharSkip</span><span class="op" id="2815180">[</span><span class="ident" id="2815181">i</span><span class="op" id="2815182">]</span>&nbsp;<span class="op" id="2815184">=</span>&nbsp;<span class="builtinfunc" id="2815186">len</span><span class="op" id="2815189">(</span><span class="ident" id="2815190">pattern</span><span class="op" id="2815197">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2815200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2815203">//&nbsp;The&nbsp;loop&nbsp;condition&nbsp;is&nbsp;&lt;&nbsp;instead&nbsp;of&nbsp;&lt;=&nbsp;so&nbsp;that&nbsp;the&nbsp;last&nbsp;byte&nbsp;does&nbsp;not</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2815276">//&nbsp;have&nbsp;a&nbsp;zero&nbsp;distance&nbsp;to&nbsp;itself.&nbsp;Finding&nbsp;this&nbsp;byte&nbsp;out&nbsp;of&nbsp;place&nbsp;implies</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2815351">//&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;in&nbsp;the&nbsp;last&nbsp;position.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2815392">for</span>&nbsp;<span class="ident" id="2815396">i</span>&nbsp;<span class="op" id="2815398">:=</span>&nbsp;<span class="num" id="2815401">0</span><span class="op" id="2815402">;</span>&nbsp;<span class="ident" id="2815404">i</span>&nbsp;<span class="op" id="2815406">&lt;</span>&nbsp;<span class="ident" id="2815408">last</span><span class="op" id="2815412">;</span>&nbsp;<span class="ident" id="2815414">i</span><span class="op" id="2815415">++</span>&nbsp;<span class="op" id="2815418">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2815422">f</span><span class="op" id="2815423">.</span><span class="ident" id="2815424">badCharSkip</span><span class="op" id="2815435">[</span><span class="ident" id="2815436">pattern</span><span class="op" id="2815443">[</span><span class="ident" id="2815444">i</span><span class="op" id="2815445">]</span><span class="op" id="2815446">]</span>&nbsp;<span class="op" id="2815448">=</span>&nbsp;<span class="ident" id="2815450">last</span>&nbsp;<span class="op" id="2815455">-</span>&nbsp;<span class="ident" id="2815457">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2815460">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2815464">//&nbsp;Build&nbsp;good&nbsp;suffix&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2815493">//&nbsp;First&nbsp;pass:&nbsp;set&nbsp;each&nbsp;value&nbsp;to&nbsp;the&nbsp;next&nbsp;index&nbsp;which&nbsp;starts&nbsp;a&nbsp;prefix&nbsp;of</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2815567">//&nbsp;pattern.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2815580">lastPrefix</span>&nbsp;<span class="op" id="2815591">:=</span>&nbsp;<span class="ident" id="2815594">last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2815600">for</span>&nbsp;<span class="ident" id="2815604">i</span>&nbsp;<span class="op" id="2815606">:=</span>&nbsp;<span class="ident" id="2815609">last</span><span class="op" id="2815613">;</span>&nbsp;<span class="ident" id="2815615">i</span>&nbsp;<span class="op" id="2815617">&gt;=</span>&nbsp;<span class="num" id="2815620">0</span><span class="op" id="2815621">;</span>&nbsp;<span class="ident" id="2815623">i</span><span class="op" id="2815624">--</span>&nbsp;<span class="op" id="2815627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2815631">if</span>&nbsp;<span class="ident" id="2815634">HasPrefix</span><span class="op" id="2815643">(</span><span class="ident" id="2815644">pattern</span><span class="op" id="2815651">,</span>&nbsp;<span class="ident" id="2815653">pattern</span><span class="op" id="2815660">[</span><span class="ident" id="2815661">i</span><span class="op" id="2815662">+</span><span class="num" id="2815663">1</span><span class="op" id="2815664">:</span><span class="op" id="2815665">]</span><span class="op" id="2815666">)</span>&nbsp;<span class="op" id="2815668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2815673">lastPrefix</span>&nbsp;<span class="op" id="2815684">=</span>&nbsp;<span class="ident" id="2815686">i</span>&nbsp;<span class="op" id="2815688">+</span>&nbsp;<span class="num" id="2815690">1</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2815694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2815698">//&nbsp;lastPrefix&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;(last-i)&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2815757">f</span><span class="op" id="2815758">.</span><span class="ident" id="2815759">goodSuffixSkip</span><span class="op" id="2815773">[</span><span class="ident" id="2815774">i</span><span class="op" id="2815775">]</span>&nbsp;<span class="op" id="2815777">=</span>&nbsp;<span class="ident" id="2815779">lastPrefix</span>&nbsp;<span class="op" id="2815790">+</span>&nbsp;<span class="ident" id="2815792">last</span>&nbsp;<span class="op" id="2815797">-</span>&nbsp;<span class="ident" id="2815799">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2815802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2815805">//&nbsp;Second&nbsp;pass:&nbsp;find&nbsp;repeats&nbsp;of&nbsp;pattern&#39;s&nbsp;suffix&nbsp;starting&nbsp;from&nbsp;the&nbsp;front.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2815880">for</span>&nbsp;<span class="ident" id="2815884">i</span>&nbsp;<span class="op" id="2815886">:=</span>&nbsp;<span class="num" id="2815889">0</span><span class="op" id="2815890">;</span>&nbsp;<span class="ident" id="2815892">i</span>&nbsp;<span class="op" id="2815894">&lt;</span>&nbsp;<span class="ident" id="2815896">last</span><span class="op" id="2815900">;</span>&nbsp;<span class="ident" id="2815902">i</span><span class="op" id="2815903">++</span>&nbsp;<span class="op" id="2815906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2815910">lenSuffix</span>&nbsp;<span class="op" id="2815920">:=</span>&nbsp;<span class="ident" id="2815923">longestCommonSuffix</span><span class="op" id="2815942">(</span><span class="ident" id="2815943">pattern</span><span class="op" id="2815950">,</span>&nbsp;<span class="ident" id="2815952">pattern</span><span class="op" id="2815959">[</span><span class="num" id="2815960">1</span><span class="op" id="2815961">:</span><span class="ident" id="2815962">i</span><span class="op" id="2815963">+</span><span class="num" id="2815964">1</span><span class="op" id="2815965">]</span><span class="op" id="2815966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2815970">if</span>&nbsp;<span class="ident" id="2815973">pattern</span><span class="op" id="2815980">[</span><span class="ident" id="2815981">i</span><span class="op" id="2815982">-</span><span class="ident" id="2815983">lenSuffix</span><span class="op" id="2815992">]</span>&nbsp;<span class="op" id="2815994">!=</span>&nbsp;<span class="ident" id="2815997">pattern</span><span class="op" id="2816004">[</span><span class="ident" id="2816005">last</span><span class="op" id="2816009">-</span><span class="ident" id="2816010">lenSuffix</span><span class="op" id="2816019">]</span>&nbsp;<span class="op" id="2816021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2816026">//&nbsp;(last-i)&nbsp;is&nbsp;the&nbsp;shift,&nbsp;and&nbsp;lenSuffix&nbsp;is&nbsp;len(suffix).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2816085">f</span><span class="op" id="2816086">.</span><span class="ident" id="2816087">goodSuffixSkip</span><span class="op" id="2816101">[</span><span class="ident" id="2816102">last</span><span class="op" id="2816106">-</span><span class="ident" id="2816107">lenSuffix</span><span class="op" id="2816116">]</span>&nbsp;<span class="op" id="2816118">=</span>&nbsp;<span class="ident" id="2816120">lenSuffix</span>&nbsp;<span class="op" id="2816130">+</span>&nbsp;<span class="ident" id="2816132">last</span>&nbsp;<span class="op" id="2816137">-</span>&nbsp;<span class="ident" id="2816139">i</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2816143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2816146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2816150">return</span>&nbsp;<span class="ident" id="2816157">f</span><br>
<span class="lineno"></span><span class="op" id="2816159">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span><span class="keyword" id="2816162">func</span>&nbsp;<span class="ident" id="2816167">longestCommonSuffix</span><span class="op" id="2816186">(</span><span class="ident" id="2816187">a</span><span class="op" id="2816188">,</span>&nbsp;<span class="ident" id="2816190">b</span>&nbsp;<span class="builtintype" id="2816192">string</span><span class="op" id="2816198">)</span>&nbsp;<span class="op" id="2816200">(</span><span class="ident" id="2816201">i</span>&nbsp;<span class="builtintype" id="2816203">int</span><span class="op" id="2816206">)</span>&nbsp;<span class="op" id="2816208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2816211">for</span>&nbsp;<span class="op" id="2816215">;</span>&nbsp;<span class="ident" id="2816217">i</span>&nbsp;<span class="op" id="2816219">&lt;</span>&nbsp;<span class="builtinfunc" id="2816221">len</span><span class="op" id="2816224">(</span><span class="ident" id="2816225">a</span><span class="op" id="2816226">)</span>&nbsp;<span class="op" id="2816228">&amp;&amp;</span>&nbsp;<span class="ident" id="2816231">i</span>&nbsp;<span class="op" id="2816233">&lt;</span>&nbsp;<span class="builtinfunc" id="2816235">len</span><span class="op" id="2816238">(</span><span class="ident" id="2816239">b</span><span class="op" id="2816240">)</span><span class="op" id="2816241">;</span>&nbsp;<span class="ident" id="2816243">i</span><span class="op" id="2816244">++</span>&nbsp;<span class="op" id="2816247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2816251">if</span>&nbsp;<span class="ident" id="2816254">a</span><span class="op" id="2816255">[</span><span class="builtinfunc" id="2816256">len</span><span class="op" id="2816259">(</span><span class="ident" id="2816260">a</span><span class="op" id="2816261">)</span><span class="op" id="2816262">-</span><span class="num" id="2816263">1</span><span class="op" id="2816264">-</span><span class="ident" id="2816265">i</span><span class="op" id="2816266">]</span>&nbsp;<span class="op" id="2816268">!=</span>&nbsp;<span class="ident" id="2816271">b</span><span class="op" id="2816272">[</span><span class="builtinfunc" id="2816273">len</span><span class="op" id="2816276">(</span><span class="ident" id="2816277">b</span><span class="op" id="2816278">)</span><span class="op" id="2816279">-</span><span class="num" id="2816280">1</span><span class="op" id="2816281">-</span><span class="ident" id="2816282">i</span><span class="op" id="2816283">]</span>&nbsp;<span class="op" id="2816285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2816290">break</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2816298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2816301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2816304">return</span><br>
<span class="lineno"></span><span class="op" id="2816311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="2816314">//&nbsp;next&nbsp;returns&nbsp;the&nbsp;index&nbsp;in&nbsp;text&nbsp;of&nbsp;the&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;the&nbsp;pattern.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="2816391">//&nbsp;the&nbsp;pattern&nbsp;is&nbsp;not&nbsp;found,&nbsp;it&nbsp;returns&nbsp;-1.</span><br>
<span class="lineno"></span><span class="keyword" id="2816435">func</span>&nbsp;<span class="op" id="2816440">(</span><span class="ident" id="2816441">f</span>&nbsp;<span class="op" id="2816443">*</span><span class="ident" id="2816444">stringFinder</span><span class="op" id="2816456">)</span>&nbsp;<span class="ident" id="2816458">next</span><span class="op" id="2816462">(</span><span class="ident" id="2816463">text</span>&nbsp;<span class="builtintype" id="2816468">string</span><span class="op" id="2816474">)</span>&nbsp;<span class="builtintype" id="2816476">int</span>&nbsp;<span class="op" id="2816480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2816483">i</span>&nbsp;<span class="op" id="2816485">:=</span>&nbsp;<span class="builtinfunc" id="2816488">len</span><span class="op" id="2816491">(</span><span class="ident" id="2816492">f</span><span class="op" id="2816493">.</span><span class="ident" id="2816494">pattern</span><span class="op" id="2816501">)</span>&nbsp;<span class="op" id="2816503">-</span>&nbsp;<span class="num" id="2816505">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2816508">for</span>&nbsp;<span class="ident" id="2816512">i</span>&nbsp;<span class="op" id="2816514">&lt;</span>&nbsp;<span class="builtinfunc" id="2816516">len</span><span class="op" id="2816519">(</span><span class="ident" id="2816520">text</span><span class="op" id="2816524">)</span>&nbsp;<span class="op" id="2816526">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2816530">//&nbsp;Compare&nbsp;backwards&nbsp;from&nbsp;the&nbsp;end&nbsp;until&nbsp;the&nbsp;first&nbsp;unmatching&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2816604">j</span>&nbsp;<span class="op" id="2816606">:=</span>&nbsp;<span class="builtinfunc" id="2816609">len</span><span class="op" id="2816612">(</span><span class="ident" id="2816613">f</span><span class="op" id="2816614">.</span><span class="ident" id="2816615">pattern</span><span class="op" id="2816622">)</span>&nbsp;<span class="op" id="2816624">-</span>&nbsp;<span class="num" id="2816626">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2816630">for</span>&nbsp;<span class="ident" id="2816634">j</span>&nbsp;<span class="op" id="2816636">&gt;=</span>&nbsp;<span class="num" id="2816639">0</span>&nbsp;<span class="op" id="2816641">&amp;&amp;</span>&nbsp;<span class="ident" id="2816644">text</span><span class="op" id="2816648">[</span><span class="ident" id="2816649">i</span><span class="op" id="2816650">]</span>&nbsp;<span class="op" id="2816652">==</span>&nbsp;<span class="ident" id="2816655">f</span><span class="op" id="2816656">.</span><span class="ident" id="2816657">pattern</span><span class="op" id="2816664">[</span><span class="ident" id="2816665">j</span><span class="op" id="2816666">]</span>&nbsp;<span class="op" id="2816668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2816673">i</span><span class="op" id="2816674">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2816680">j</span><span class="op" id="2816681">--</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2816686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2816690">if</span>&nbsp;<span class="ident" id="2816693">j</span>&nbsp;<span class="op" id="2816695">&lt;</span>&nbsp;<span class="num" id="2816697">0</span>&nbsp;<span class="op" id="2816699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2816704">return</span>&nbsp;<span class="ident" id="2816711">i</span>&nbsp;<span class="op" id="2816713">+</span>&nbsp;<span class="num" id="2816715">1</span>&nbsp;<span class="comment" id="2816717">//&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2816728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2816732">i</span>&nbsp;<span class="op" id="2816734">+=</span>&nbsp;<span class="ident" id="2816737">max</span><span class="op" id="2816740">(</span><span class="ident" id="2816741">f</span><span class="op" id="2816742">.</span><span class="ident" id="2816743">badCharSkip</span><span class="op" id="2816754">[</span><span class="ident" id="2816755">text</span><span class="op" id="2816759">[</span><span class="ident" id="2816760">i</span><span class="op" id="2816761">]</span><span class="op" id="2816762">]</span><span class="op" id="2816763">,</span>&nbsp;<span class="ident" id="2816765">f</span><span class="op" id="2816766">.</span><span class="ident" id="2816767">goodSuffixSkip</span><span class="op" id="2816781">[</span><span class="ident" id="2816782">j</span><span class="op" id="2816783">]</span><span class="op" id="2816784">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2816787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2816790">return</span>&nbsp;<span class="op" id="2816797">-</span><span class="num" id="2816798">1</span><br>
<span class="lineno"></span><span class="op" id="2816800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2816803">func</span>&nbsp;<span class="ident" id="2816808">max</span><span class="op" id="2816811">(</span><span class="ident" id="2816812">a</span><span class="op" id="2816813">,</span>&nbsp;<span class="ident" id="2816815">b</span>&nbsp;<span class="builtintype" id="2816817">int</span><span class="op" id="2816820">)</span>&nbsp;<span class="builtintype" id="2816822">int</span>&nbsp;<span class="op" id="2816826">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2816829">if</span>&nbsp;<span class="ident" id="2816832">a</span>&nbsp;<span class="op" id="2816834">&gt;</span>&nbsp;<span class="ident" id="2816836">b</span>&nbsp;<span class="op" id="2816838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2816842">return</span>&nbsp;<span class="ident" id="2816849">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2816852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2816855">return</span>&nbsp;<span class="ident" id="2816862">b</span><br>
<span class="lineno"></span><span class="op" id="2816864">}</span>
</div>
</body>
</html>
