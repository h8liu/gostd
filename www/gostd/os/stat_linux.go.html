<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2185964">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2186019">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2186073">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2186124">package</span>&nbsp;<span class="ident" id="2186132">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2186136">import</span>&nbsp;<span class="op" id="2186143">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2186146">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2186157">&#34;time&#34;</span><br>
<span class="lineno">10</span><span class="op" id="2186164">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2186167">func</span>&nbsp;<span class="ident" id="2186172">sameFile</span><span class="op" id="2186180">(</span><span class="ident" id="2186181">fs1</span><span class="op" id="2186184">,</span>&nbsp;<span class="ident" id="2186186">fs2</span>&nbsp;<span class="op" id="2186190">*</span><span class="ident" id="2186191">fileStat</span><span class="op" id="2186199">)</span>&nbsp;<span class="builtintype" id="2186201">bool</span>&nbsp;<span class="op" id="2186206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2186209">stat1</span>&nbsp;<span class="op" id="2186215">:=</span>&nbsp;<span class="ident" id="2186218">fs1</span><span class="op" id="2186221">.</span><span class="ident" id="2186222">sys</span><span class="op" id="2186225">.</span><span class="op" id="2186226">(</span><span class="op" id="2186227">*</span><span class="ident" id="2186228">syscall</span><span class="op" id="2186235">.</span><span class="ident" id="2186236">Stat_t</span><span class="op" id="2186242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2186245">stat2</span>&nbsp;<span class="op" id="2186251">:=</span>&nbsp;<span class="ident" id="2186254">fs2</span><span class="op" id="2186257">.</span><span class="ident" id="2186258">sys</span><span class="op" id="2186261">.</span><span class="op" id="2186262">(</span><span class="op" id="2186263">*</span><span class="ident" id="2186264">syscall</span><span class="op" id="2186271">.</span><span class="ident" id="2186272">Stat_t</span><span class="op" id="2186278">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186281">return</span>&nbsp;<span class="ident" id="2186288">stat1</span><span class="op" id="2186293">.</span><span class="ident" id="2186294">Dev</span>&nbsp;<span class="op" id="2186298">==</span>&nbsp;<span class="ident" id="2186301">stat2</span><span class="op" id="2186306">.</span><span class="ident" id="2186307">Dev</span>&nbsp;<span class="op" id="2186311">&amp;&amp;</span>&nbsp;<span class="ident" id="2186314">stat1</span><span class="op" id="2186319">.</span><span class="ident" id="2186320">Ino</span>&nbsp;<span class="op" id="2186324">==</span>&nbsp;<span class="ident" id="2186327">stat2</span><span class="op" id="2186332">.</span><span class="ident" id="2186333">Ino</span><br>
<span class="lineno"></span><span class="op" id="2186337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2186340">func</span>&nbsp;<span class="ident" id="2186345">fileInfoFromStat</span><span class="op" id="2186361">(</span><span class="ident" id="2186362">st</span>&nbsp;<span class="op" id="2186365">*</span><span class="ident" id="2186366">syscall</span><span class="op" id="2186373">.</span><span class="ident" id="2186374">Stat_t</span><span class="op" id="2186380">,</span>&nbsp;<span class="ident" id="2186382">name</span>&nbsp;<span class="builtintype" id="2186387">string</span><span class="op" id="2186393">)</span>&nbsp;<span class="ident" id="2186395">FileInfo</span>&nbsp;<span class="op" id="2186404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2186407">fs</span>&nbsp;<span class="op" id="2186410">:=</span>&nbsp;<span class="op" id="2186413">&amp;</span><span class="ident" id="2186414">fileStat</span><span class="op" id="2186422">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2186426">name</span><span class="op" id="2186430">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2186435">basename</span><span class="op" id="2186443">(</span><span class="ident" id="2186444">name</span><span class="op" id="2186448">)</span><span class="op" id="2186449">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2186453">size</span><span class="op" id="2186457">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2186462">int64</span><span class="op" id="2186467">(</span><span class="ident" id="2186468">st</span><span class="op" id="2186470">.</span><span class="ident" id="2186471">Size</span><span class="op" id="2186475">)</span><span class="op" id="2186476">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2186480">modTime</span><span class="op" id="2186487">:</span>&nbsp;<span class="ident" id="2186489">timespecToTime</span><span class="op" id="2186503">(</span><span class="ident" id="2186504">st</span><span class="op" id="2186506">.</span><span class="ident" id="2186507">Mtim</span><span class="op" id="2186511">)</span><span class="op" id="2186512">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2186516">sys</span><span class="op" id="2186519">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2186525">st</span><span class="op" id="2186527">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2186530">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2186533">fs</span><span class="op" id="2186535">.</span><span class="ident" id="2186536">mode</span>&nbsp;<span class="op" id="2186541">=</span>&nbsp;<span class="ident" id="2186543">FileMode</span><span class="op" id="2186551">(</span><span class="ident" id="2186552">st</span><span class="op" id="2186554">.</span><span class="ident" id="2186555">Mode</span>&nbsp;<span class="op" id="2186560">&amp;</span>&nbsp;<span class="num" id="2186562">0777</span><span class="op" id="2186566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186569">switch</span>&nbsp;<span class="ident" id="2186576">st</span><span class="op" id="2186578">.</span><span class="ident" id="2186579">Mode</span>&nbsp;<span class="op" id="2186584">&amp;</span>&nbsp;<span class="ident" id="2186586">syscall</span><span class="op" id="2186593">.</span><span class="ident" id="2186594">S_IFMT</span>&nbsp;<span class="op" id="2186601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186604">case</span>&nbsp;<span class="ident" id="2186609">syscall</span><span class="op" id="2186616">.</span><span class="ident" id="2186617">S_IFBLK</span><span class="op" id="2186624">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2186628">fs</span><span class="op" id="2186630">.</span><span class="ident" id="2186631">mode</span>&nbsp;<span class="op" id="2186636">|=</span>&nbsp;<span class="ident" id="2186639">ModeDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186651">case</span>&nbsp;<span class="ident" id="2186656">syscall</span><span class="op" id="2186663">.</span><span class="ident" id="2186664">S_IFCHR</span><span class="op" id="2186671">:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2186675">fs</span><span class="op" id="2186677">.</span><span class="ident" id="2186678">mode</span>&nbsp;<span class="op" id="2186683">|=</span>&nbsp;<span class="ident" id="2186686">ModeDevice</span>&nbsp;<span class="op" id="2186697">|</span>&nbsp;<span class="ident" id="2186699">ModeCharDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186715">case</span>&nbsp;<span class="ident" id="2186720">syscall</span><span class="op" id="2186727">.</span><span class="ident" id="2186728">S_IFDIR</span><span class="op" id="2186735">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2186739">fs</span><span class="op" id="2186741">.</span><span class="ident" id="2186742">mode</span>&nbsp;<span class="op" id="2186747">|=</span>&nbsp;<span class="ident" id="2186750">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186759">case</span>&nbsp;<span class="ident" id="2186764">syscall</span><span class="op" id="2186771">.</span><span class="ident" id="2186772">S_IFIFO</span><span class="op" id="2186779">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2186783">fs</span><span class="op" id="2186785">.</span><span class="ident" id="2186786">mode</span>&nbsp;<span class="op" id="2186791">|=</span>&nbsp;<span class="ident" id="2186794">ModeNamedPipe</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186809">case</span>&nbsp;<span class="ident" id="2186814">syscall</span><span class="op" id="2186821">.</span><span class="ident" id="2186822">S_IFLNK</span><span class="op" id="2186829">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2186833">fs</span><span class="op" id="2186835">.</span><span class="ident" id="2186836">mode</span>&nbsp;<span class="op" id="2186841">|=</span>&nbsp;<span class="ident" id="2186844">ModeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186857">case</span>&nbsp;<span class="ident" id="2186862">syscall</span><span class="op" id="2186869">.</span><span class="ident" id="2186870">S_IFREG</span><span class="op" id="2186877">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2186881">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186899">case</span>&nbsp;<span class="ident" id="2186904">syscall</span><span class="op" id="2186911">.</span><span class="ident" id="2186912">S_IFSOCK</span><span class="op" id="2186920">:</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2186924">fs</span><span class="op" id="2186926">.</span><span class="ident" id="2186927">mode</span>&nbsp;<span class="op" id="2186932">|=</span>&nbsp;<span class="ident" id="2186935">ModeSocket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2186947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2186950">if</span>&nbsp;<span class="ident" id="2186953">st</span><span class="op" id="2186955">.</span><span class="ident" id="2186956">Mode</span><span class="op" id="2186960">&amp;</span><span class="ident" id="2186961">syscall</span><span class="op" id="2186968">.</span><span class="ident" id="2186969">S_ISGID</span>&nbsp;<span class="op" id="2186977">!=</span>&nbsp;<span class="num" id="2186980">0</span>&nbsp;<span class="op" id="2186982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2186986">fs</span><span class="op" id="2186988">.</span><span class="ident" id="2186989">mode</span>&nbsp;<span class="op" id="2186994">|=</span>&nbsp;<span class="ident" id="2186997">ModeSetgid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2187009">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2187012">if</span>&nbsp;<span class="ident" id="2187015">st</span><span class="op" id="2187017">.</span><span class="ident" id="2187018">Mode</span><span class="op" id="2187022">&amp;</span><span class="ident" id="2187023">syscall</span><span class="op" id="2187030">.</span><span class="ident" id="2187031">S_ISUID</span>&nbsp;<span class="op" id="2187039">!=</span>&nbsp;<span class="num" id="2187042">0</span>&nbsp;<span class="op" id="2187044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2187048">fs</span><span class="op" id="2187050">.</span><span class="ident" id="2187051">mode</span>&nbsp;<span class="op" id="2187056">|=</span>&nbsp;<span class="ident" id="2187059">ModeSetuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2187071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2187074">if</span>&nbsp;<span class="ident" id="2187077">st</span><span class="op" id="2187079">.</span><span class="ident" id="2187080">Mode</span><span class="op" id="2187084">&amp;</span><span class="ident" id="2187085">syscall</span><span class="op" id="2187092">.</span><span class="ident" id="2187093">S_ISVTX</span>&nbsp;<span class="op" id="2187101">!=</span>&nbsp;<span class="num" id="2187104">0</span>&nbsp;<span class="op" id="2187106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2187110">fs</span><span class="op" id="2187112">.</span><span class="ident" id="2187113">mode</span>&nbsp;<span class="op" id="2187118">|=</span>&nbsp;<span class="ident" id="2187121">ModeSticky</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2187133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2187136">return</span>&nbsp;<span class="ident" id="2187143">fs</span><br>
<span class="lineno"></span><span class="op" id="2187146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2187149">func</span>&nbsp;<span class="ident" id="2187154">timespecToTime</span><span class="op" id="2187168">(</span><span class="ident" id="2187169">ts</span>&nbsp;<span class="ident" id="2187172">syscall</span><span class="op" id="2187179">.</span><span class="ident" id="2187180">Timespec</span><span class="op" id="2187188">)</span>&nbsp;<span class="ident" id="2187190">time</span><span class="op" id="2187194">.</span><span class="ident" id="2187195">Time</span>&nbsp;<span class="op" id="2187200">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2187203">return</span>&nbsp;<span class="ident" id="2187210">time</span><span class="op" id="2187214">.</span><span class="ident" id="2187215">Unix</span><span class="op" id="2187219">(</span><span class="ident" id="2187220">int64</span><span class="op" id="2187225">(</span><span class="ident" id="2187226">ts</span><span class="op" id="2187228">.</span><span class="ident" id="2187229">Sec</span><span class="op" id="2187232">)</span><span class="op" id="2187233">,</span>&nbsp;<span class="ident" id="2187235">int64</span><span class="op" id="2187240">(</span><span class="ident" id="2187241">ts</span><span class="op" id="2187243">.</span><span class="ident" id="2187244">Nsec</span><span class="op" id="2187248">)</span><span class="op" id="2187249">)</span><br>
<span class="lineno"></span><span class="op" id="2187251">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2187254">//&nbsp;For&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="2187270">func</span>&nbsp;<span class="ident" id="2187275">atime</span><span class="op" id="2187280">(</span><span class="ident" id="2187281">fi</span>&nbsp;<span class="ident" id="2187284">FileInfo</span><span class="op" id="2187292">)</span>&nbsp;<span class="ident" id="2187294">time</span><span class="op" id="2187298">.</span><span class="ident" id="2187299">Time</span>&nbsp;<span class="op" id="2187304">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2187307">return</span>&nbsp;<span class="ident" id="2187314">timespecToTime</span><span class="op" id="2187328">(</span><span class="ident" id="2187329">fi</span><span class="op" id="2187331">.</span><span class="ident" id="2187332">Sys</span><span class="op" id="2187335">(</span><span class="op" id="2187336">)</span><span class="op" id="2187337">.</span><span class="op" id="2187338">(</span><span class="op" id="2187339">*</span><span class="ident" id="2187340">syscall</span><span class="op" id="2187347">.</span><span class="ident" id="2187348">Stat_t</span><span class="op" id="2187354">)</span><span class="op" id="2187355">.</span><span class="ident" id="2187356">Atim</span><span class="op" id="2187360">)</span><br>
<span class="lineno"></span><span class="op" id="2187362">}</span>
</div>
</body>
</html>
