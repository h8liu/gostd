<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3939218">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3939273">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3939327">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3939378">package</span>&nbsp;<span class="ident" id="3939386">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3939392">import</span>&nbsp;<span class="op" id="3939399">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3939402">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span><span class="op" id="3939417">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="3939420">//&nbsp;CertPool&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;certificates.</span><br>
<span class="lineno"></span><span class="keyword" id="3939458">type</span>&nbsp;<span class="ident" id="3939463">CertPool</span>&nbsp;<span class="keyword" id="3939472">struct</span>&nbsp;<span class="op" id="3939479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939482">bySubjectKeyId</span>&nbsp;<span class="keyword" id="3939497">map</span><span class="op" id="3939500">[</span><span class="builtintype" id="3939501">string</span><span class="op" id="3939507">]</span><span class="op" id="3939508">[</span><span class="op" id="3939509">]</span><span class="builtintype" id="3939510">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939515">byName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3939530">map</span><span class="op" id="3939533">[</span><span class="builtintype" id="3939534">string</span><span class="op" id="3939540">]</span><span class="op" id="3939541">[</span><span class="op" id="3939542">]</span><span class="builtintype" id="3939543">int</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939548">certs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3939563">[</span><span class="op" id="3939564">]</span><span class="op" id="3939565">*</span><span class="ident" id="3939566">Certificate</span><br>
<span class="lineno"></span><span class="op" id="3939578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3939581">//&nbsp;NewCertPool&nbsp;returns&nbsp;a&nbsp;new,&nbsp;empty&nbsp;CertPool.</span><br>
<span class="lineno"></span><span class="keyword" id="3939627">func</span>&nbsp;<span class="ident" id="3939632">NewCertPool</span><span class="op" id="3939643">(</span><span class="op" id="3939644">)</span>&nbsp;<span class="op" id="3939646">*</span><span class="ident" id="3939647">CertPool</span>&nbsp;<span class="op" id="3939656">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939659">return</span>&nbsp;<span class="op" id="3939666">&amp;</span><span class="ident" id="3939667">CertPool</span><span class="op" id="3939675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3939679">make</span><span class="op" id="3939683">(</span><span class="keyword" id="3939684">map</span><span class="op" id="3939687">[</span><span class="builtintype" id="3939688">string</span><span class="op" id="3939694">]</span><span class="op" id="3939695">[</span><span class="op" id="3939696">]</span><span class="builtintype" id="3939697">int</span><span class="op" id="3939700">)</span><span class="op" id="3939701">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3939705">make</span><span class="op" id="3939709">(</span><span class="keyword" id="3939710">map</span><span class="op" id="3939713">[</span><span class="builtintype" id="3939714">string</span><span class="op" id="3939720">]</span><span class="op" id="3939721">[</span><span class="op" id="3939722">]</span><span class="builtintype" id="3939723">int</span><span class="op" id="3939726">)</span><span class="op" id="3939727">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939731">nil</span><span class="op" id="3939734">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3939737">}</span><br>
<span class="lineno">25</span><span class="op" id="3939739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3939742">//&nbsp;findVerifiedParents&nbsp;attempts&nbsp;to&nbsp;find&nbsp;certificates&nbsp;in&nbsp;s&nbsp;which&nbsp;have&nbsp;signed&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3939822">//&nbsp;given&nbsp;certificate.&nbsp;If&nbsp;any&nbsp;candidates&nbsp;were&nbsp;rejected&nbsp;then&nbsp;errCert&nbsp;will&nbsp;be&nbsp;set</span><br>
<span class="lineno"></span><span class="comment" id="3939901">//&nbsp;to&nbsp;one&nbsp;of&nbsp;them,&nbsp;arbitrarily,&nbsp;and&nbsp;err&nbsp;will&nbsp;contain&nbsp;the&nbsp;reason&nbsp;that&nbsp;it&nbsp;was</span><br>
<span class="lineno">30</span><span class="comment" id="3939977">//&nbsp;rejected.</span><br>
<span class="lineno"></span><span class="keyword" id="3939990">func</span>&nbsp;<span class="op" id="3939995">(</span><span class="ident" id="3939996">s</span>&nbsp;<span class="op" id="3939998">*</span><span class="ident" id="3939999">CertPool</span><span class="op" id="3940007">)</span>&nbsp;<span class="ident" id="3940009">findVerifiedParents</span><span class="op" id="3940028">(</span><span class="ident" id="3940029">cert</span>&nbsp;<span class="op" id="3940034">*</span><span class="ident" id="3940035">Certificate</span><span class="op" id="3940046">)</span>&nbsp;<span class="op" id="3940048">(</span><span class="ident" id="3940049">parents</span>&nbsp;<span class="op" id="3940057">[</span><span class="op" id="3940058">]</span><span class="builtintype" id="3940059">int</span><span class="op" id="3940062">,</span>&nbsp;<span class="ident" id="3940064">errCert</span>&nbsp;<span class="op" id="3940072">*</span><span class="ident" id="3940073">Certificate</span><span class="op" id="3940084">,</span>&nbsp;<span class="ident" id="3940086">err</span>&nbsp;<span class="builtintype" id="3940090">error</span><span class="op" id="3940095">)</span>&nbsp;<span class="op" id="3940097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940100">if</span>&nbsp;<span class="ident" id="3940103">s</span>&nbsp;<span class="op" id="3940105">==</span>&nbsp;<span class="ident" id="3940108">nil</span>&nbsp;<span class="op" id="3940112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940116">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940124">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940127">var</span>&nbsp;<span class="ident" id="3940131">candidates</span>&nbsp;<span class="op" id="3940142">[</span><span class="op" id="3940143">]</span><span class="builtintype" id="3940144">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940150">if</span>&nbsp;<span class="builtinfunc" id="3940153">len</span><span class="op" id="3940156">(</span><span class="ident" id="3940157">cert</span><span class="op" id="3940161">.</span><span class="ident" id="3940162">AuthorityKeyId</span><span class="op" id="3940176">)</span>&nbsp;<span class="op" id="3940178">&gt;</span>&nbsp;<span class="num" id="3940180">0</span>&nbsp;<span class="op" id="3940182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940186">candidates</span>&nbsp;<span class="op" id="3940197">=</span>&nbsp;<span class="ident" id="3940199">s</span><span class="op" id="3940200">.</span><span class="ident" id="3940201">bySubjectKeyId</span><span class="op" id="3940215">[</span><span class="builtintype" id="3940216">string</span><span class="op" id="3940222">(</span><span class="ident" id="3940223">cert</span><span class="op" id="3940227">.</span><span class="ident" id="3940228">AuthorityKeyId</span><span class="op" id="3940242">)</span><span class="op" id="3940243">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940246">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940249">if</span>&nbsp;<span class="builtinfunc" id="3940252">len</span><span class="op" id="3940255">(</span><span class="ident" id="3940256">candidates</span><span class="op" id="3940266">)</span>&nbsp;<span class="op" id="3940268">==</span>&nbsp;<span class="num" id="3940271">0</span>&nbsp;<span class="op" id="3940273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940277">candidates</span>&nbsp;<span class="op" id="3940288">=</span>&nbsp;<span class="ident" id="3940290">s</span><span class="op" id="3940291">.</span><span class="ident" id="3940292">byName</span><span class="op" id="3940298">[</span><span class="builtintype" id="3940299">string</span><span class="op" id="3940305">(</span><span class="ident" id="3940306">cert</span><span class="op" id="3940310">.</span><span class="ident" id="3940311">RawIssuer</span><span class="op" id="3940320">)</span><span class="op" id="3940321">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940328">for</span>&nbsp;<span class="ident" id="3940332">_</span><span class="op" id="3940333">,</span>&nbsp;<span class="ident" id="3940335">c</span>&nbsp;<span class="op" id="3940337">:=</span>&nbsp;<span class="keyword" id="3940340">range</span>&nbsp;<span class="ident" id="3940346">candidates</span>&nbsp;<span class="op" id="3940357">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940361">if</span>&nbsp;<span class="ident" id="3940364">err</span>&nbsp;<span class="op" id="3940368">=</span>&nbsp;<span class="ident" id="3940370">cert</span><span class="op" id="3940374">.</span><span class="ident" id="3940375">CheckSignatureFrom</span><span class="op" id="3940393">(</span><span class="ident" id="3940394">s</span><span class="op" id="3940395">.</span><span class="ident" id="3940396">certs</span><span class="op" id="3940401">[</span><span class="ident" id="3940402">c</span><span class="op" id="3940403">]</span><span class="op" id="3940404">)</span><span class="op" id="3940405">;</span>&nbsp;<span class="ident" id="3940407">err</span>&nbsp;<span class="op" id="3940411">==</span>&nbsp;<span class="ident" id="3940414">nil</span>&nbsp;<span class="op" id="3940418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940423">parents</span>&nbsp;<span class="op" id="3940431">=</span>&nbsp;<span class="builtinfunc" id="3940433">append</span><span class="op" id="3940439">(</span><span class="ident" id="3940440">parents</span><span class="op" id="3940447">,</span>&nbsp;<span class="ident" id="3940449">c</span><span class="op" id="3940450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940454">}</span>&nbsp;<span class="keyword" id="3940456">else</span>&nbsp;<span class="op" id="3940461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940466">errCert</span>&nbsp;<span class="op" id="3940474">=</span>&nbsp;<span class="ident" id="3940476">s</span><span class="op" id="3940477">.</span><span class="ident" id="3940478">certs</span><span class="op" id="3940483">[</span><span class="ident" id="3940484">c</span><span class="op" id="3940485">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940489">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940492">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940496">return</span><br>
<span class="lineno"></span><span class="op" id="3940503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="3940506">//&nbsp;AddCert&nbsp;adds&nbsp;a&nbsp;certificate&nbsp;to&nbsp;a&nbsp;pool.</span><br>
<span class="lineno"></span><span class="keyword" id="3940547">func</span>&nbsp;<span class="op" id="3940552">(</span><span class="ident" id="3940553">s</span>&nbsp;<span class="op" id="3940555">*</span><span class="ident" id="3940556">CertPool</span><span class="op" id="3940564">)</span>&nbsp;<span class="ident" id="3940566">AddCert</span><span class="op" id="3940573">(</span><span class="ident" id="3940574">cert</span>&nbsp;<span class="op" id="3940579">*</span><span class="ident" id="3940580">Certificate</span><span class="op" id="3940591">)</span>&nbsp;<span class="op" id="3940593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940596">if</span>&nbsp;<span class="ident" id="3940599">cert</span>&nbsp;<span class="op" id="3940604">==</span>&nbsp;<span class="ident" id="3940607">nil</span>&nbsp;<span class="op" id="3940611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3940615">panic</span><span class="op" id="3940620">(</span><span class="string" id="3940621">&#34;adding&nbsp;nil&nbsp;Certificate&nbsp;to&nbsp;CertPool&#34;</span><span class="op" id="3940657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940660">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3940664">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;certificate&nbsp;isn&#39;t&nbsp;being&nbsp;added&nbsp;twice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940720">for</span>&nbsp;<span class="ident" id="3940724">_</span><span class="op" id="3940725">,</span>&nbsp;<span class="ident" id="3940727">c</span>&nbsp;<span class="op" id="3940729">:=</span>&nbsp;<span class="keyword" id="3940732">range</span>&nbsp;<span class="ident" id="3940738">s</span><span class="op" id="3940739">.</span><span class="ident" id="3940740">certs</span>&nbsp;<span class="op" id="3940746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940750">if</span>&nbsp;<span class="ident" id="3940753">c</span><span class="op" id="3940754">.</span><span class="ident" id="3940755">Equal</span><span class="op" id="3940760">(</span><span class="ident" id="3940761">cert</span><span class="op" id="3940765">)</span>&nbsp;<span class="op" id="3940767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940772">return</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940788">n</span>&nbsp;<span class="op" id="3940790">:=</span>&nbsp;<span class="builtinfunc" id="3940793">len</span><span class="op" id="3940796">(</span><span class="ident" id="3940797">s</span><span class="op" id="3940798">.</span><span class="ident" id="3940799">certs</span><span class="op" id="3940804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940807">s</span><span class="op" id="3940808">.</span><span class="ident" id="3940809">certs</span>&nbsp;<span class="op" id="3940815">=</span>&nbsp;<span class="builtinfunc" id="3940817">append</span><span class="op" id="3940823">(</span><span class="ident" id="3940824">s</span><span class="op" id="3940825">.</span><span class="ident" id="3940826">certs</span><span class="op" id="3940831">,</span>&nbsp;<span class="ident" id="3940833">cert</span><span class="op" id="3940837">)</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940841">if</span>&nbsp;<span class="builtinfunc" id="3940844">len</span><span class="op" id="3940847">(</span><span class="ident" id="3940848">cert</span><span class="op" id="3940852">.</span><span class="ident" id="3940853">SubjectKeyId</span><span class="op" id="3940865">)</span>&nbsp;<span class="op" id="3940867">&gt;</span>&nbsp;<span class="num" id="3940869">0</span>&nbsp;<span class="op" id="3940871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940875">keyId</span>&nbsp;<span class="op" id="3940881">:=</span>&nbsp;<span class="builtintype" id="3940884">string</span><span class="op" id="3940890">(</span><span class="ident" id="3940891">cert</span><span class="op" id="3940895">.</span><span class="ident" id="3940896">SubjectKeyId</span><span class="op" id="3940908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940912">s</span><span class="op" id="3940913">.</span><span class="ident" id="3940914">bySubjectKeyId</span><span class="op" id="3940928">[</span><span class="ident" id="3940929">keyId</span><span class="op" id="3940934">]</span>&nbsp;<span class="op" id="3940936">=</span>&nbsp;<span class="builtinfunc" id="3940938">append</span><span class="op" id="3940944">(</span><span class="ident" id="3940945">s</span><span class="op" id="3940946">.</span><span class="ident" id="3940947">bySubjectKeyId</span><span class="op" id="3940961">[</span><span class="ident" id="3940962">keyId</span><span class="op" id="3940967">]</span><span class="op" id="3940968">,</span>&nbsp;<span class="ident" id="3940970">n</span><span class="op" id="3940971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940974">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940977">name</span>&nbsp;<span class="op" id="3940982">:=</span>&nbsp;<span class="builtintype" id="3940985">string</span><span class="op" id="3940991">(</span><span class="ident" id="3940992">cert</span><span class="op" id="3940996">.</span><span class="ident" id="3940997">RawSubject</span><span class="op" id="3941007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941010">s</span><span class="op" id="3941011">.</span><span class="ident" id="3941012">byName</span><span class="op" id="3941018">[</span><span class="ident" id="3941019">name</span><span class="op" id="3941023">]</span>&nbsp;<span class="op" id="3941025">=</span>&nbsp;<span class="builtinfunc" id="3941027">append</span><span class="op" id="3941033">(</span><span class="ident" id="3941034">s</span><span class="op" id="3941035">.</span><span class="ident" id="3941036">byName</span><span class="op" id="3941042">[</span><span class="ident" id="3941043">name</span><span class="op" id="3941047">]</span><span class="op" id="3941048">,</span>&nbsp;<span class="ident" id="3941050">n</span><span class="op" id="3941051">)</span><br>
<span class="lineno"></span><span class="op" id="3941053">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3941056">//&nbsp;AppendCertsFromPEM&nbsp;attempts&nbsp;to&nbsp;parse&nbsp;a&nbsp;series&nbsp;of&nbsp;PEM&nbsp;encoded&nbsp;certificates.</span><br>
<span class="lineno">80</span><span class="comment" id="3941134">//&nbsp;It&nbsp;appends&nbsp;any&nbsp;certificates&nbsp;found&nbsp;to&nbsp;s&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;any&nbsp;certificates</span><br>
<span class="lineno"></span><span class="comment" id="3941213">//&nbsp;were&nbsp;successfully&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="3941242">//</span><br>
<span class="lineno"></span><span class="comment" id="3941245">//&nbsp;On&nbsp;many&nbsp;Linux&nbsp;systems,&nbsp;/etc/ssl/cert.pem&nbsp;will&nbsp;contain&nbsp;the&nbsp;system&nbsp;wide&nbsp;set</span><br>
<span class="lineno"></span><span class="comment" id="3941322">//&nbsp;of&nbsp;root&nbsp;CAs&nbsp;in&nbsp;a&nbsp;format&nbsp;suitable&nbsp;for&nbsp;this&nbsp;function.</span><br>
<span class="lineno">85</span><span class="keyword" id="3941377">func</span>&nbsp;<span class="op" id="3941382">(</span><span class="ident" id="3941383">s</span>&nbsp;<span class="op" id="3941385">*</span><span class="ident" id="3941386">CertPool</span><span class="op" id="3941394">)</span>&nbsp;<span class="ident" id="3941396">AppendCertsFromPEM</span><span class="op" id="3941414">(</span><span class="ident" id="3941415">pemCerts</span>&nbsp;<span class="op" id="3941424">[</span><span class="op" id="3941425">]</span><span class="builtintype" id="3941426">byte</span><span class="op" id="3941430">)</span>&nbsp;<span class="op" id="3941432">(</span><span class="ident" id="3941433">ok</span>&nbsp;<span class="builtintype" id="3941436">bool</span><span class="op" id="3941440">)</span>&nbsp;<span class="op" id="3941442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941445">for</span>&nbsp;<span class="builtinfunc" id="3941449">len</span><span class="op" id="3941452">(</span><span class="ident" id="3941453">pemCerts</span><span class="op" id="3941461">)</span>&nbsp;<span class="op" id="3941463">&gt;</span>&nbsp;<span class="num" id="3941465">0</span>&nbsp;<span class="op" id="3941467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941471">var</span>&nbsp;<span class="ident" id="3941475">block</span>&nbsp;<span class="op" id="3941481">*</span><span class="ident" id="3941482">pem</span><span class="op" id="3941485">.</span><span class="ident" id="3941486">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941494">block</span><span class="op" id="3941499">,</span>&nbsp;<span class="ident" id="3941501">pemCerts</span>&nbsp;<span class="op" id="3941510">=</span>&nbsp;<span class="ident" id="3941512">pem</span><span class="op" id="3941515">.</span><span class="ident" id="3941516">Decode</span><span class="op" id="3941522">(</span><span class="ident" id="3941523">pemCerts</span><span class="op" id="3941531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941535">if</span>&nbsp;<span class="ident" id="3941538">block</span>&nbsp;<span class="op" id="3941544">==</span>&nbsp;<span class="ident" id="3941547">nil</span>&nbsp;<span class="op" id="3941551">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941556">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3941564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941568">if</span>&nbsp;<span class="ident" id="3941571">block</span><span class="op" id="3941576">.</span><span class="ident" id="3941577">Type</span>&nbsp;<span class="op" id="3941582">!=</span>&nbsp;<span class="string" id="3941585">&#34;CERTIFICATE&#34;</span>&nbsp;<span class="op" id="3941599">||</span>&nbsp;<span class="builtinfunc" id="3941602">len</span><span class="op" id="3941605">(</span><span class="ident" id="3941606">block</span><span class="op" id="3941611">.</span><span class="ident" id="3941612">Headers</span><span class="op" id="3941619">)</span>&nbsp;<span class="op" id="3941621">!=</span>&nbsp;<span class="num" id="3941624">0</span>&nbsp;<span class="op" id="3941626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941631">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3941642">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941647">cert</span><span class="op" id="3941651">,</span>&nbsp;<span class="ident" id="3941653">err</span>&nbsp;<span class="op" id="3941657">:=</span>&nbsp;<span class="ident" id="3941660">ParseCertificate</span><span class="op" id="3941676">(</span><span class="ident" id="3941677">block</span><span class="op" id="3941682">.</span><span class="ident" id="3941683">Bytes</span><span class="op" id="3941688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941692">if</span>&nbsp;<span class="ident" id="3941695">err</span>&nbsp;<span class="op" id="3941699">!=</span>&nbsp;<span class="ident" id="3941702">nil</span>&nbsp;<span class="op" id="3941706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941711">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3941722">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941727">s</span><span class="op" id="3941728">.</span><span class="ident" id="3941729">AddCert</span><span class="op" id="3941736">(</span><span class="ident" id="3941737">cert</span><span class="op" id="3941741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941745">ok</span>&nbsp;<span class="op" id="3941748">=</span>&nbsp;<span class="builtintype" id="3941750">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3941756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941760">return</span><br>
<span class="lineno"></span><span class="op" id="3941767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3941770">//&nbsp;Subjects&nbsp;returns&nbsp;a&nbsp;list&nbsp;of&nbsp;the&nbsp;DER-encoded&nbsp;subjects&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3941828">//&nbsp;all&nbsp;of&nbsp;the&nbsp;certificates&nbsp;in&nbsp;the&nbsp;pool.</span><br>
<span class="lineno">110</span><span class="keyword" id="3941868">func</span>&nbsp;<span class="op" id="3941873">(</span><span class="ident" id="3941874">s</span>&nbsp;<span class="op" id="3941876">*</span><span class="ident" id="3941877">CertPool</span><span class="op" id="3941885">)</span>&nbsp;<span class="ident" id="3941887">Subjects</span><span class="op" id="3941895">(</span><span class="op" id="3941896">)</span>&nbsp;<span class="op" id="3941898">(</span><span class="ident" id="3941899">res</span>&nbsp;<span class="op" id="3941903">[</span><span class="op" id="3941904">]</span><span class="op" id="3941905">[</span><span class="op" id="3941906">]</span><span class="builtintype" id="3941907">byte</span><span class="op" id="3941911">)</span>&nbsp;<span class="op" id="3941913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941916">res</span>&nbsp;<span class="op" id="3941920">=</span>&nbsp;<span class="builtinfunc" id="3941922">make</span><span class="op" id="3941926">(</span><span class="op" id="3941927">[</span><span class="op" id="3941928">]</span><span class="op" id="3941929">[</span><span class="op" id="3941930">]</span><span class="builtintype" id="3941931">byte</span><span class="op" id="3941935">,</span>&nbsp;<span class="builtinfunc" id="3941937">len</span><span class="op" id="3941940">(</span><span class="ident" id="3941941">s</span><span class="op" id="3941942">.</span><span class="ident" id="3941943">certs</span><span class="op" id="3941948">)</span><span class="op" id="3941949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941952">for</span>&nbsp;<span class="ident" id="3941956">i</span><span class="op" id="3941957">,</span>&nbsp;<span class="ident" id="3941959">c</span>&nbsp;<span class="op" id="3941961">:=</span>&nbsp;<span class="keyword" id="3941964">range</span>&nbsp;<span class="ident" id="3941970">s</span><span class="op" id="3941971">.</span><span class="ident" id="3941972">certs</span>&nbsp;<span class="op" id="3941978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941982">res</span><span class="op" id="3941985">[</span><span class="ident" id="3941986">i</span><span class="op" id="3941987">]</span>&nbsp;<span class="op" id="3941989">=</span>&nbsp;<span class="ident" id="3941991">c</span><span class="op" id="3941992">.</span><span class="ident" id="3941993">RawSubject</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3942005">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3942008">return</span><br>
<span class="lineno"></span><span class="op" id="3942015">}</span>
</div>
</body>
</html>
