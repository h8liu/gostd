<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5417137">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5417192">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5417246">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5417297">package</span>&nbsp;<span class="ident" id="5417305">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5417310">import</span>&nbsp;<span class="op" id="5417317">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5417320">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5417329">&#34;encoding/binary&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5417348">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5417358">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5417366">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5417380">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5417386">&#34;os&#34;</span><br>
<span class="lineno">15</span><span class="op" id="5417391">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5417394">var</span>&nbsp;<span class="op" id="5417398">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417401">ErrFormat</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5417414">=</span>&nbsp;<span class="ident" id="5417416">errors</span><span class="op" id="5417422">.</span><span class="ident" id="5417423">New</span><span class="op" id="5417426">(</span><span class="string" id="5417427">&#34;zip:&nbsp;not&nbsp;a&nbsp;valid&nbsp;zip&nbsp;file&#34;</span><span class="op" id="5417454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417457">ErrAlgorithm</span>&nbsp;<span class="op" id="5417470">=</span>&nbsp;<span class="ident" id="5417472">errors</span><span class="op" id="5417478">.</span><span class="ident" id="5417479">New</span><span class="op" id="5417482">(</span><span class="string" id="5417483">&#34;zip:&nbsp;unsupported&nbsp;compression&nbsp;algorithm&#34;</span><span class="op" id="5417523">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417526">ErrChecksum</span>&nbsp;&nbsp;<span class="op" id="5417539">=</span>&nbsp;<span class="ident" id="5417541">errors</span><span class="op" id="5417547">.</span><span class="ident" id="5417548">New</span><span class="op" id="5417551">(</span><span class="string" id="5417552">&#34;zip:&nbsp;checksum&nbsp;error&#34;</span><span class="op" id="5417573">)</span><br>
<span class="lineno"></span><span class="op" id="5417575">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5417578">type</span>&nbsp;<span class="ident" id="5417583">Reader</span>&nbsp;<span class="keyword" id="5417590">struct</span>&nbsp;<span class="op" id="5417597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417600">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417608">io</span><span class="op" id="5417610">.</span><span class="ident" id="5417611">ReaderAt</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417621">File</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5417629">[</span><span class="op" id="5417630">]</span><span class="op" id="5417631">*</span><span class="ident" id="5417632">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417638">Comment</span>&nbsp;<span class="builtintype" id="5417646">string</span><br>
<span class="lineno"></span><span class="op" id="5417653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5417656">type</span>&nbsp;<span class="ident" id="5417661">ReadCloser</span>&nbsp;<span class="keyword" id="5417672">struct</span>&nbsp;<span class="op" id="5417679">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417682">f</span>&nbsp;<span class="op" id="5417684">*</span><span class="ident" id="5417685">os</span><span class="op" id="5417687">.</span><span class="ident" id="5417688">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417694">Reader</span><br>
<span class="lineno"></span><span class="op" id="5417701">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5417704">type</span>&nbsp;<span class="ident" id="5417709">File</span>&nbsp;<span class="keyword" id="5417714">struct</span>&nbsp;<span class="op" id="5417721">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417724">FileHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417736">zipr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417749">io</span><span class="op" id="5417751">.</span><span class="ident" id="5417752">ReaderAt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417762">zipsize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417775">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5417782">headerOffset</span>&nbsp;<span class="ident" id="5417795">int64</span><br>
<span class="lineno"></span><span class="op" id="5417801">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="5417804">func</span>&nbsp;<span class="op" id="5417809">(</span><span class="ident" id="5417810">f</span>&nbsp;<span class="op" id="5417812">*</span><span class="ident" id="5417813">File</span><span class="op" id="5417817">)</span>&nbsp;<span class="ident" id="5417819">hasDataDescriptor</span><span class="op" id="5417836">(</span><span class="op" id="5417837">)</span>&nbsp;<span class="builtintype" id="5417839">bool</span>&nbsp;<span class="op" id="5417844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5417847">return</span>&nbsp;<span class="ident" id="5417854">f</span><span class="op" id="5417855">.</span><span class="ident" id="5417856">Flags</span><span class="op" id="5417861">&amp;</span><span class="num" id="5417862">0x8</span>&nbsp;<span class="op" id="5417866">!=</span>&nbsp;<span class="num" id="5417869">0</span><br>
<span class="lineno"></span><span class="op" id="5417871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="5417874">//&nbsp;OpenReader&nbsp;will&nbsp;open&nbsp;the&nbsp;Zip&nbsp;file&nbsp;specified&nbsp;by&nbsp;name&nbsp;and&nbsp;return&nbsp;a&nbsp;ReadCloser.</span><br>
<span class="lineno"></span><span class="keyword" id="5417954">func</span>&nbsp;<span class="ident" id="5417959">OpenReader</span><span class="op" id="5417969">(</span><span class="ident" id="5417970">name</span>&nbsp;<span class="builtintype" id="5417975">string</span><span class="op" id="5417981">)</span>&nbsp;<span class="op" id="5417983">(</span><span class="op" id="5417984">*</span><span class="ident" id="5417985">ReadCloser</span><span class="op" id="5417995">,</span>&nbsp;<span class="builtintype" id="5417997">error</span><span class="op" id="5418002">)</span>&nbsp;<span class="op" id="5418004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418007">f</span><span class="op" id="5418008">,</span>&nbsp;<span class="ident" id="5418010">err</span>&nbsp;<span class="op" id="5418014">:=</span>&nbsp;<span class="ident" id="5418017">os</span><span class="op" id="5418019">.</span><span class="ident" id="5418020">Open</span><span class="op" id="5418024">(</span><span class="ident" id="5418025">name</span><span class="op" id="5418029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418032">if</span>&nbsp;<span class="ident" id="5418035">err</span>&nbsp;<span class="op" id="5418039">!=</span>&nbsp;<span class="builtintype" id="5418042">nil</span>&nbsp;<span class="op" id="5418046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418050">return</span>&nbsp;<span class="builtintype" id="5418057">nil</span><span class="op" id="5418060">,</span>&nbsp;<span class="ident" id="5418062">err</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5418067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418070">fi</span><span class="op" id="5418072">,</span>&nbsp;<span class="ident" id="5418074">err</span>&nbsp;<span class="op" id="5418078">:=</span>&nbsp;<span class="ident" id="5418081">f</span><span class="op" id="5418082">.</span><span class="ident" id="5418083">Stat</span><span class="op" id="5418087">(</span><span class="op" id="5418088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418091">if</span>&nbsp;<span class="ident" id="5418094">err</span>&nbsp;<span class="op" id="5418098">!=</span>&nbsp;<span class="builtintype" id="5418101">nil</span>&nbsp;<span class="op" id="5418105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418109">f</span><span class="op" id="5418110">.</span><span class="ident" id="5418111">Close</span><span class="op" id="5418116">(</span><span class="op" id="5418117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418121">return</span>&nbsp;<span class="builtintype" id="5418128">nil</span><span class="op" id="5418131">,</span>&nbsp;<span class="ident" id="5418133">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5418138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418141">r</span>&nbsp;<span class="op" id="5418143">:=</span>&nbsp;<span class="builtinfunc" id="5418146">new</span><span class="op" id="5418149">(</span><span class="ident" id="5418150">ReadCloser</span><span class="op" id="5418160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418163">if</span>&nbsp;<span class="ident" id="5418166">err</span>&nbsp;<span class="op" id="5418170">:=</span>&nbsp;<span class="ident" id="5418173">r</span><span class="op" id="5418174">.</span><span class="ident" id="5418175">init</span><span class="op" id="5418179">(</span><span class="ident" id="5418180">f</span><span class="op" id="5418181">,</span>&nbsp;<span class="ident" id="5418183">fi</span><span class="op" id="5418185">.</span><span class="ident" id="5418186">Size</span><span class="op" id="5418190">(</span><span class="op" id="5418191">)</span><span class="op" id="5418192">)</span><span class="op" id="5418193">;</span>&nbsp;<span class="ident" id="5418195">err</span>&nbsp;<span class="op" id="5418199">!=</span>&nbsp;<span class="builtintype" id="5418202">nil</span>&nbsp;<span class="op" id="5418206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418210">f</span><span class="op" id="5418211">.</span><span class="ident" id="5418212">Close</span><span class="op" id="5418217">(</span><span class="op" id="5418218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418222">return</span>&nbsp;<span class="builtintype" id="5418229">nil</span><span class="op" id="5418232">,</span>&nbsp;<span class="ident" id="5418234">err</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5418239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418242">r</span><span class="op" id="5418243">.</span><span class="ident" id="5418244">f</span>&nbsp;<span class="op" id="5418246">=</span>&nbsp;<span class="ident" id="5418248">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418251">return</span>&nbsp;<span class="ident" id="5418258">r</span><span class="op" id="5418259">,</span>&nbsp;<span class="builtintype" id="5418261">nil</span><br>
<span class="lineno"></span><span class="op" id="5418265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="5418268">//&nbsp;NewReader&nbsp;returns&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r,&nbsp;which&nbsp;is&nbsp;assumed&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5418338">//&nbsp;have&nbsp;the&nbsp;given&nbsp;size&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="5418371">func</span>&nbsp;<span class="ident" id="5418376">NewReader</span><span class="op" id="5418385">(</span><span class="ident" id="5418386">r</span>&nbsp;<span class="ident" id="5418388">io</span><span class="op" id="5418390">.</span><span class="ident" id="5418391">ReaderAt</span><span class="op" id="5418399">,</span>&nbsp;<span class="ident" id="5418401">size</span>&nbsp;<span class="ident" id="5418406">int64</span><span class="op" id="5418411">)</span>&nbsp;<span class="op" id="5418413">(</span><span class="op" id="5418414">*</span><span class="ident" id="5418415">Reader</span><span class="op" id="5418421">,</span>&nbsp;<span class="builtintype" id="5418423">error</span><span class="op" id="5418428">)</span>&nbsp;<span class="op" id="5418430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418433">zr</span>&nbsp;<span class="op" id="5418436">:=</span>&nbsp;<span class="builtinfunc" id="5418439">new</span><span class="op" id="5418442">(</span><span class="ident" id="5418443">Reader</span><span class="op" id="5418449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418452">if</span>&nbsp;<span class="ident" id="5418455">err</span>&nbsp;<span class="op" id="5418459">:=</span>&nbsp;<span class="ident" id="5418462">zr</span><span class="op" id="5418464">.</span><span class="ident" id="5418465">init</span><span class="op" id="5418469">(</span><span class="ident" id="5418470">r</span><span class="op" id="5418471">,</span>&nbsp;<span class="ident" id="5418473">size</span><span class="op" id="5418477">)</span><span class="op" id="5418478">;</span>&nbsp;<span class="ident" id="5418480">err</span>&nbsp;<span class="op" id="5418484">!=</span>&nbsp;<span class="builtintype" id="5418487">nil</span>&nbsp;<span class="op" id="5418491">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418495">return</span>&nbsp;<span class="builtintype" id="5418502">nil</span><span class="op" id="5418505">,</span>&nbsp;<span class="ident" id="5418507">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5418512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418515">return</span>&nbsp;<span class="ident" id="5418522">zr</span><span class="op" id="5418524">,</span>&nbsp;<span class="builtintype" id="5418526">nil</span><br>
<span class="lineno"></span><span class="op" id="5418530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="5418533">func</span>&nbsp;<span class="op" id="5418538">(</span><span class="ident" id="5418539">z</span>&nbsp;<span class="op" id="5418541">*</span><span class="ident" id="5418542">Reader</span><span class="op" id="5418548">)</span>&nbsp;<span class="ident" id="5418550">init</span><span class="op" id="5418554">(</span><span class="ident" id="5418555">r</span>&nbsp;<span class="ident" id="5418557">io</span><span class="op" id="5418559">.</span><span class="ident" id="5418560">ReaderAt</span><span class="op" id="5418568">,</span>&nbsp;<span class="ident" id="5418570">size</span>&nbsp;<span class="ident" id="5418575">int64</span><span class="op" id="5418580">)</span>&nbsp;<span class="builtintype" id="5418582">error</span>&nbsp;<span class="op" id="5418588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418591">end</span><span class="op" id="5418594">,</span>&nbsp;<span class="ident" id="5418596">err</span>&nbsp;<span class="op" id="5418600">:=</span>&nbsp;<span class="ident" id="5418603">readDirectoryEnd</span><span class="op" id="5418619">(</span><span class="ident" id="5418620">r</span><span class="op" id="5418621">,</span>&nbsp;<span class="ident" id="5418623">size</span><span class="op" id="5418627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418630">if</span>&nbsp;<span class="ident" id="5418633">err</span>&nbsp;<span class="op" id="5418637">!=</span>&nbsp;<span class="builtintype" id="5418640">nil</span>&nbsp;<span class="op" id="5418644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418648">return</span>&nbsp;<span class="ident" id="5418655">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5418660">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418663">z</span><span class="op" id="5418664">.</span><span class="ident" id="5418665">r</span>&nbsp;<span class="op" id="5418667">=</span>&nbsp;<span class="ident" id="5418669">r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418672">z</span><span class="op" id="5418673">.</span><span class="ident" id="5418674">File</span>&nbsp;<span class="op" id="5418679">=</span>&nbsp;<span class="builtinfunc" id="5418681">make</span><span class="op" id="5418685">(</span><span class="op" id="5418686">[</span><span class="op" id="5418687">]</span><span class="op" id="5418688">*</span><span class="ident" id="5418689">File</span><span class="op" id="5418693">,</span>&nbsp;<span class="num" id="5418695">0</span><span class="op" id="5418696">,</span>&nbsp;<span class="ident" id="5418698">end</span><span class="op" id="5418701">.</span><span class="ident" id="5418702">directoryRecords</span><span class="op" id="5418718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418721">z</span><span class="op" id="5418722">.</span><span class="ident" id="5418723">Comment</span>&nbsp;<span class="op" id="5418731">=</span>&nbsp;<span class="ident" id="5418733">end</span><span class="op" id="5418736">.</span><span class="ident" id="5418737">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418746">rs</span>&nbsp;<span class="op" id="5418749">:=</span>&nbsp;<span class="ident" id="5418752">io</span><span class="op" id="5418754">.</span><span class="ident" id="5418755">NewSectionReader</span><span class="op" id="5418771">(</span><span class="ident" id="5418772">r</span><span class="op" id="5418773">,</span>&nbsp;<span class="num" id="5418775">0</span><span class="op" id="5418776">,</span>&nbsp;<span class="ident" id="5418778">size</span><span class="op" id="5418782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418785">if</span>&nbsp;<span class="ident" id="5418788">_</span><span class="op" id="5418789">,</span>&nbsp;<span class="ident" id="5418791">err</span>&nbsp;<span class="op" id="5418795">=</span>&nbsp;<span class="ident" id="5418797">rs</span><span class="op" id="5418799">.</span><span class="ident" id="5418800">Seek</span><span class="op" id="5418804">(</span><span class="ident" id="5418805">int64</span><span class="op" id="5418810">(</span><span class="ident" id="5418811">end</span><span class="op" id="5418814">.</span><span class="ident" id="5418815">directoryOffset</span><span class="op" id="5418830">)</span><span class="op" id="5418831">,</span>&nbsp;<span class="ident" id="5418833">os</span><span class="op" id="5418835">.</span><span class="ident" id="5418836">SEEK_SET</span><span class="op" id="5418844">)</span><span class="op" id="5418845">;</span>&nbsp;<span class="ident" id="5418847">err</span>&nbsp;<span class="op" id="5418851">!=</span>&nbsp;<span class="builtintype" id="5418854">nil</span>&nbsp;<span class="op" id="5418858">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5418862">return</span>&nbsp;<span class="ident" id="5418869">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5418874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5418877">buf</span>&nbsp;<span class="op" id="5418881">:=</span>&nbsp;<span class="ident" id="5418884">bufio</span><span class="op" id="5418889">.</span><span class="ident" id="5418890">NewReader</span><span class="op" id="5418899">(</span><span class="ident" id="5418900">rs</span><span class="op" id="5418902">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5418906">//&nbsp;The&nbsp;count&nbsp;of&nbsp;files&nbsp;inside&nbsp;a&nbsp;zip&nbsp;is&nbsp;truncated&nbsp;to&nbsp;fit&nbsp;in&nbsp;a&nbsp;uint16.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5418975">//&nbsp;Gloss&nbsp;over&nbsp;this&nbsp;by&nbsp;reading&nbsp;headers&nbsp;until&nbsp;we&nbsp;encounter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5419033">//&nbsp;a&nbsp;bad&nbsp;one,&nbsp;and&nbsp;then&nbsp;only&nbsp;report&nbsp;a&nbsp;ErrFormat&nbsp;or&nbsp;UnexpectedEOF&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5419101">//&nbsp;the&nbsp;file&nbsp;count&nbsp;modulo&nbsp;65536&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419147">for</span>&nbsp;<span class="op" id="5419151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5419155">f</span>&nbsp;<span class="op" id="5419157">:=</span>&nbsp;<span class="op" id="5419160">&amp;</span><span class="ident" id="5419161">File</span><span class="op" id="5419165">{</span><span class="ident" id="5419166">zipr</span><span class="op" id="5419170">:</span>&nbsp;<span class="ident" id="5419172">r</span><span class="op" id="5419173">,</span>&nbsp;<span class="ident" id="5419175">zipsize</span><span class="op" id="5419182">:</span>&nbsp;<span class="ident" id="5419184">size</span><span class="op" id="5419188">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5419192">err</span>&nbsp;<span class="op" id="5419196">=</span>&nbsp;<span class="ident" id="5419198">readDirectoryHeader</span><span class="op" id="5419217">(</span><span class="ident" id="5419218">f</span><span class="op" id="5419219">,</span>&nbsp;<span class="ident" id="5419221">buf</span><span class="op" id="5419224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419228">if</span>&nbsp;<span class="ident" id="5419231">err</span>&nbsp;<span class="op" id="5419235">==</span>&nbsp;<span class="ident" id="5419238">ErrFormat</span>&nbsp;<span class="op" id="5419248">||</span>&nbsp;<span class="ident" id="5419251">err</span>&nbsp;<span class="op" id="5419255">==</span>&nbsp;<span class="ident" id="5419258">io</span><span class="op" id="5419260">.</span><span class="ident" id="5419261">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="5419278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419283">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5419291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419295">if</span>&nbsp;<span class="ident" id="5419298">err</span>&nbsp;<span class="op" id="5419302">!=</span>&nbsp;<span class="builtintype" id="5419305">nil</span>&nbsp;<span class="op" id="5419309">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419314">return</span>&nbsp;<span class="ident" id="5419321">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5419327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5419331">z</span><span class="op" id="5419332">.</span><span class="ident" id="5419333">File</span>&nbsp;<span class="op" id="5419338">=</span>&nbsp;<span class="builtinfunc" id="5419340">append</span><span class="op" id="5419346">(</span><span class="ident" id="5419347">z</span><span class="op" id="5419348">.</span><span class="ident" id="5419349">File</span><span class="op" id="5419353">,</span>&nbsp;<span class="ident" id="5419355">f</span><span class="op" id="5419356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5419359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419362">if</span>&nbsp;<span class="builtintype" id="5419365">uint16</span><span class="op" id="5419371">(</span><span class="builtinfunc" id="5419372">len</span><span class="op" id="5419375">(</span><span class="ident" id="5419376">z</span><span class="op" id="5419377">.</span><span class="ident" id="5419378">File</span><span class="op" id="5419382">)</span><span class="op" id="5419383">)</span>&nbsp;<span class="op" id="5419385">!=</span>&nbsp;<span class="builtintype" id="5419388">uint16</span><span class="op" id="5419394">(</span><span class="ident" id="5419395">end</span><span class="op" id="5419398">.</span><span class="ident" id="5419399">directoryRecords</span><span class="op" id="5419415">)</span>&nbsp;<span class="op" id="5419417">{</span>&nbsp;<span class="comment" id="5419419">//&nbsp;only&nbsp;compare&nbsp;16&nbsp;bits&nbsp;here</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5419450">//&nbsp;Return&nbsp;the&nbsp;readDirectoryHeader&nbsp;error&nbsp;if&nbsp;we&nbsp;read</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5419503">//&nbsp;the&nbsp;wrong&nbsp;number&nbsp;of&nbsp;directory&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419547">return</span>&nbsp;<span class="ident" id="5419554">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5419559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419562">return</span>&nbsp;<span class="builtintype" id="5419569">nil</span><br>
<span class="lineno">110</span><span class="op" id="5419573">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5419576">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Zip&nbsp;file,&nbsp;rendering&nbsp;it&nbsp;unusable&nbsp;for&nbsp;I/O.</span><br>
<span class="lineno"></span><span class="keyword" id="5419637">func</span>&nbsp;<span class="op" id="5419642">(</span><span class="ident" id="5419643">rc</span>&nbsp;<span class="op" id="5419646">*</span><span class="ident" id="5419647">ReadCloser</span><span class="op" id="5419657">)</span>&nbsp;<span class="ident" id="5419659">Close</span><span class="op" id="5419664">(</span><span class="op" id="5419665">)</span>&nbsp;<span class="builtintype" id="5419667">error</span>&nbsp;<span class="op" id="5419673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5419676">return</span>&nbsp;<span class="ident" id="5419683">rc</span><span class="op" id="5419685">.</span><span class="ident" id="5419686">f</span><span class="op" id="5419687">.</span><span class="ident" id="5419688">Close</span><span class="op" id="5419693">(</span><span class="op" id="5419694">)</span><br>
<span class="lineno">115</span><span class="op" id="5419696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5419699">//&nbsp;DataOffset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;file&#39;s&nbsp;possibly-compressed</span><br>
<span class="lineno"></span><span class="comment" id="5419766">//&nbsp;data,&nbsp;relative&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;zip&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="5419818">//</span><br>
<span class="lineno">120</span><span class="comment" id="5419821">//&nbsp;Most&nbsp;callers&nbsp;should&nbsp;instead&nbsp;use&nbsp;Open,&nbsp;which&nbsp;transparently</span><br>
<span class="lineno"></span><span class="comment" id="5419882">//&nbsp;decompresses&nbsp;data&nbsp;and&nbsp;verifies&nbsp;checksums.</span><br>
<span class="lineno"></span><span class="keyword" id="5419927">func</span>&nbsp;<span class="op" id="5419932">(</span><span class="ident" id="5419933">f</span>&nbsp;<span class="op" id="5419935">*</span><span class="ident" id="5419936">File</span><span class="op" id="5419940">)</span>&nbsp;<span class="ident" id="5419942">DataOffset</span><span class="op" id="5419952">(</span><span class="op" id="5419953">)</span>&nbsp;<span class="op" id="5419955">(</span><span class="ident" id="5419956">offset</span>&nbsp;<span class="ident" id="5419963">int64</span><span class="op" id="5419968">,</span>&nbsp;<span class="ident" id="5419970">err</span>&nbsp;<span class="builtintype" id="5419974">error</span><span class="op" id="5419979">)</span>&nbsp;<span class="op" id="5419981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5419984">bodyOffset</span><span class="op" id="5419994">,</span>&nbsp;<span class="ident" id="5419996">err</span>&nbsp;<span class="op" id="5420000">:=</span>&nbsp;<span class="ident" id="5420003">f</span><span class="op" id="5420004">.</span><span class="ident" id="5420005">findBodyOffset</span><span class="op" id="5420019">(</span><span class="op" id="5420020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420023">if</span>&nbsp;<span class="ident" id="5420026">err</span>&nbsp;<span class="op" id="5420030">!=</span>&nbsp;<span class="builtintype" id="5420033">nil</span>&nbsp;<span class="op" id="5420037">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420041">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5420049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420052">return</span>&nbsp;<span class="ident" id="5420059">f</span><span class="op" id="5420060">.</span><span class="ident" id="5420061">headerOffset</span>&nbsp;<span class="op" id="5420074">+</span>&nbsp;<span class="ident" id="5420076">bodyOffset</span><span class="op" id="5420086">,</span>&nbsp;<span class="builtintype" id="5420088">nil</span><br>
<span class="lineno"></span><span class="op" id="5420092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="5420095">//&nbsp;Open&nbsp;returns&nbsp;a&nbsp;ReadCloser&nbsp;that&nbsp;provides&nbsp;access&nbsp;to&nbsp;the&nbsp;File&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="5420169">//&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;be&nbsp;read&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="keyword" id="5420213">func</span>&nbsp;<span class="op" id="5420218">(</span><span class="ident" id="5420219">f</span>&nbsp;<span class="op" id="5420221">*</span><span class="ident" id="5420222">File</span><span class="op" id="5420226">)</span>&nbsp;<span class="ident" id="5420228">Open</span><span class="op" id="5420232">(</span><span class="op" id="5420233">)</span>&nbsp;<span class="op" id="5420235">(</span><span class="ident" id="5420236">rc</span>&nbsp;<span class="ident" id="5420239">io</span><span class="op" id="5420241">.</span><span class="ident" id="5420242">ReadCloser</span><span class="op" id="5420252">,</span>&nbsp;<span class="ident" id="5420254">err</span>&nbsp;<span class="builtintype" id="5420258">error</span><span class="op" id="5420263">)</span>&nbsp;<span class="op" id="5420265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420268">bodyOffset</span><span class="op" id="5420278">,</span>&nbsp;<span class="ident" id="5420280">err</span>&nbsp;<span class="op" id="5420284">:=</span>&nbsp;<span class="ident" id="5420287">f</span><span class="op" id="5420288">.</span><span class="ident" id="5420289">findBodyOffset</span><span class="op" id="5420303">(</span><span class="op" id="5420304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420307">if</span>&nbsp;<span class="ident" id="5420310">err</span>&nbsp;<span class="op" id="5420314">!=</span>&nbsp;<span class="builtintype" id="5420317">nil</span>&nbsp;<span class="op" id="5420321">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420325">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5420333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420336">size</span>&nbsp;<span class="op" id="5420341">:=</span>&nbsp;<span class="ident" id="5420344">int64</span><span class="op" id="5420349">(</span><span class="ident" id="5420350">f</span><span class="op" id="5420351">.</span><span class="ident" id="5420352">CompressedSize64</span><span class="op" id="5420368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420371">r</span>&nbsp;<span class="op" id="5420373">:=</span>&nbsp;<span class="ident" id="5420376">io</span><span class="op" id="5420378">.</span><span class="ident" id="5420379">NewSectionReader</span><span class="op" id="5420395">(</span><span class="ident" id="5420396">f</span><span class="op" id="5420397">.</span><span class="ident" id="5420398">zipr</span><span class="op" id="5420402">,</span>&nbsp;<span class="ident" id="5420404">f</span><span class="op" id="5420405">.</span><span class="ident" id="5420406">headerOffset</span><span class="op" id="5420418">+</span><span class="ident" id="5420419">bodyOffset</span><span class="op" id="5420429">,</span>&nbsp;<span class="ident" id="5420431">size</span><span class="op" id="5420435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420438">dcomp</span>&nbsp;<span class="op" id="5420444">:=</span>&nbsp;<span class="ident" id="5420447">decompressor</span><span class="op" id="5420459">(</span><span class="ident" id="5420460">f</span><span class="op" id="5420461">.</span><span class="ident" id="5420462">Method</span><span class="op" id="5420468">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420471">if</span>&nbsp;<span class="ident" id="5420474">dcomp</span>&nbsp;<span class="op" id="5420480">==</span>&nbsp;<span class="builtintype" id="5420483">nil</span>&nbsp;<span class="op" id="5420487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420491">err</span>&nbsp;<span class="op" id="5420495">=</span>&nbsp;<span class="ident" id="5420497">ErrAlgorithm</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420512">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5420520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420523">rc</span>&nbsp;<span class="op" id="5420526">=</span>&nbsp;<span class="ident" id="5420528">dcomp</span><span class="op" id="5420533">(</span><span class="ident" id="5420534">r</span><span class="op" id="5420535">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420538">var</span>&nbsp;<span class="ident" id="5420542">desr</span>&nbsp;<span class="ident" id="5420547">io</span><span class="op" id="5420549">.</span><span class="ident" id="5420550">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420558">if</span>&nbsp;<span class="ident" id="5420561">f</span><span class="op" id="5420562">.</span><span class="ident" id="5420563">hasDataDescriptor</span><span class="op" id="5420580">(</span><span class="op" id="5420581">)</span>&nbsp;<span class="op" id="5420583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420587">desr</span>&nbsp;<span class="op" id="5420592">=</span>&nbsp;<span class="ident" id="5420594">io</span><span class="op" id="5420596">.</span><span class="ident" id="5420597">NewSectionReader</span><span class="op" id="5420613">(</span><span class="ident" id="5420614">f</span><span class="op" id="5420615">.</span><span class="ident" id="5420616">zipr</span><span class="op" id="5420620">,</span>&nbsp;<span class="ident" id="5420622">f</span><span class="op" id="5420623">.</span><span class="ident" id="5420624">headerOffset</span><span class="op" id="5420636">+</span><span class="ident" id="5420637">bodyOffset</span><span class="op" id="5420647">+</span><span class="ident" id="5420648">size</span><span class="op" id="5420652">,</span>&nbsp;<span class="ident" id="5420654">dataDescriptorLen</span><span class="op" id="5420671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5420674">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420677">rc</span>&nbsp;<span class="op" id="5420680">=</span>&nbsp;<span class="op" id="5420682">&amp;</span><span class="ident" id="5420683">checksumReader</span><span class="op" id="5420697">{</span><span class="ident" id="5420698">rc</span><span class="op" id="5420700">,</span>&nbsp;<span class="ident" id="5420702">crc32</span><span class="op" id="5420707">.</span><span class="ident" id="5420708">NewIEEE</span><span class="op" id="5420715">(</span><span class="op" id="5420716">)</span><span class="op" id="5420717">,</span>&nbsp;<span class="ident" id="5420719">f</span><span class="op" id="5420720">,</span>&nbsp;<span class="ident" id="5420722">desr</span><span class="op" id="5420726">,</span>&nbsp;<span class="builtintype" id="5420728">nil</span><span class="op" id="5420731">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420734">return</span><br>
<span class="lineno"></span><span class="op" id="5420741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5420744">type</span>&nbsp;<span class="ident" id="5420749">checksumReader</span>&nbsp;<span class="keyword" id="5420764">struct</span>&nbsp;<span class="op" id="5420771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420774">rc</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5420779">io</span><span class="op" id="5420781">.</span><span class="ident" id="5420782">ReadCloser</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420794">hash</span>&nbsp;<span class="ident" id="5420799">hash</span><span class="op" id="5420803">.</span><span class="ident" id="5420804">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420812">f</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5420817">*</span><span class="ident" id="5420818">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420824">desr</span>&nbsp;<span class="ident" id="5420829">io</span><span class="op" id="5420831">.</span><span class="ident" id="5420832">Reader</span>&nbsp;<span class="comment" id="5420839">//&nbsp;if&nbsp;non-nil,&nbsp;where&nbsp;to&nbsp;read&nbsp;the&nbsp;data&nbsp;descriptor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5420889">err</span>&nbsp;&nbsp;<span class="builtintype" id="5420894">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5420904">//&nbsp;sticky&nbsp;error</span><br>
<span class="lineno"></span><span class="op" id="5420920">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="5420923">func</span>&nbsp;<span class="op" id="5420928">(</span><span class="ident" id="5420929">r</span>&nbsp;<span class="op" id="5420931">*</span><span class="ident" id="5420932">checksumReader</span><span class="op" id="5420946">)</span>&nbsp;<span class="ident" id="5420948">Read</span><span class="op" id="5420952">(</span><span class="ident" id="5420953">b</span>&nbsp;<span class="op" id="5420955">[</span><span class="op" id="5420956">]</span><span class="builtintype" id="5420957">byte</span><span class="op" id="5420961">)</span>&nbsp;<span class="op" id="5420963">(</span><span class="ident" id="5420964">n</span>&nbsp;<span class="builtintype" id="5420966">int</span><span class="op" id="5420969">,</span>&nbsp;<span class="ident" id="5420971">err</span>&nbsp;<span class="builtintype" id="5420975">error</span><span class="op" id="5420980">)</span>&nbsp;<span class="op" id="5420982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5420985">if</span>&nbsp;<span class="ident" id="5420988">r</span><span class="op" id="5420989">.</span><span class="ident" id="5420990">err</span>&nbsp;<span class="op" id="5420994">!=</span>&nbsp;<span class="builtintype" id="5420997">nil</span>&nbsp;<span class="op" id="5421001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421005">return</span>&nbsp;<span class="num" id="5421012">0</span><span class="op" id="5421013">,</span>&nbsp;<span class="ident" id="5421015">r</span><span class="op" id="5421016">.</span><span class="ident" id="5421017">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5421022">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421025">n</span><span class="op" id="5421026">,</span>&nbsp;<span class="ident" id="5421028">err</span>&nbsp;<span class="op" id="5421032">=</span>&nbsp;<span class="ident" id="5421034">r</span><span class="op" id="5421035">.</span><span class="ident" id="5421036">rc</span><span class="op" id="5421038">.</span><span class="ident" id="5421039">Read</span><span class="op" id="5421043">(</span><span class="ident" id="5421044">b</span><span class="op" id="5421045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421048">r</span><span class="op" id="5421049">.</span><span class="ident" id="5421050">hash</span><span class="op" id="5421054">.</span><span class="ident" id="5421055">Write</span><span class="op" id="5421060">(</span><span class="ident" id="5421061">b</span><span class="op" id="5421062">[</span><span class="op" id="5421063">:</span><span class="ident" id="5421064">n</span><span class="op" id="5421065">]</span><span class="op" id="5421066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421069">if</span>&nbsp;<span class="ident" id="5421072">err</span>&nbsp;<span class="op" id="5421076">==</span>&nbsp;<span class="builtintype" id="5421079">nil</span>&nbsp;<span class="op" id="5421083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421087">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5421095">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421098">if</span>&nbsp;<span class="ident" id="5421101">err</span>&nbsp;<span class="op" id="5421105">==</span>&nbsp;<span class="ident" id="5421108">io</span><span class="op" id="5421110">.</span><span class="ident" id="5421111">EOF</span>&nbsp;<span class="op" id="5421115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421119">if</span>&nbsp;<span class="ident" id="5421122">r</span><span class="op" id="5421123">.</span><span class="ident" id="5421124">desr</span>&nbsp;<span class="op" id="5421129">!=</span>&nbsp;<span class="builtintype" id="5421132">nil</span>&nbsp;<span class="op" id="5421136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421141">if</span>&nbsp;<span class="ident" id="5421144">err1</span>&nbsp;<span class="op" id="5421149">:=</span>&nbsp;<span class="ident" id="5421152">readDataDescriptor</span><span class="op" id="5421170">(</span><span class="ident" id="5421171">r</span><span class="op" id="5421172">.</span><span class="ident" id="5421173">desr</span><span class="op" id="5421177">,</span>&nbsp;<span class="ident" id="5421179">r</span><span class="op" id="5421180">.</span><span class="ident" id="5421181">f</span><span class="op" id="5421182">)</span><span class="op" id="5421183">;</span>&nbsp;<span class="ident" id="5421185">err1</span>&nbsp;<span class="op" id="5421190">!=</span>&nbsp;<span class="builtintype" id="5421193">nil</span>&nbsp;<span class="op" id="5421197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421203">err</span>&nbsp;<span class="op" id="5421207">=</span>&nbsp;<span class="ident" id="5421209">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5421217">}</span>&nbsp;<span class="keyword" id="5421219">else</span>&nbsp;<span class="keyword" id="5421224">if</span>&nbsp;<span class="ident" id="5421227">r</span><span class="op" id="5421228">.</span><span class="ident" id="5421229">hash</span><span class="op" id="5421233">.</span><span class="ident" id="5421234">Sum32</span><span class="op" id="5421239">(</span><span class="op" id="5421240">)</span>&nbsp;<span class="op" id="5421242">!=</span>&nbsp;<span class="ident" id="5421245">r</span><span class="op" id="5421246">.</span><span class="ident" id="5421247">f</span><span class="op" id="5421248">.</span><span class="ident" id="5421249">CRC32</span>&nbsp;<span class="op" id="5421255">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421261">err</span>&nbsp;<span class="op" id="5421265">=</span>&nbsp;<span class="ident" id="5421267">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5421282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5421286">}</span>&nbsp;<span class="keyword" id="5421288">else</span>&nbsp;<span class="op" id="5421293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5421298">//&nbsp;If&nbsp;there&#39;s&nbsp;not&nbsp;a&nbsp;data&nbsp;descriptor,&nbsp;we&nbsp;still&nbsp;compare</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5421355">//&nbsp;the&nbsp;CRC32&nbsp;of&nbsp;what&nbsp;we&#39;ve&nbsp;read&nbsp;against&nbsp;the&nbsp;file&nbsp;header</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5421414">//&nbsp;or&nbsp;TOC&#39;s&nbsp;CRC32,&nbsp;if&nbsp;it&nbsp;seems&nbsp;like&nbsp;it&nbsp;was&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421465">if</span>&nbsp;<span class="ident" id="5421468">r</span><span class="op" id="5421469">.</span><span class="ident" id="5421470">f</span><span class="op" id="5421471">.</span><span class="ident" id="5421472">CRC32</span>&nbsp;<span class="op" id="5421478">!=</span>&nbsp;<span class="num" id="5421481">0</span>&nbsp;<span class="op" id="5421483">&amp;&amp;</span>&nbsp;<span class="ident" id="5421486">r</span><span class="op" id="5421487">.</span><span class="ident" id="5421488">hash</span><span class="op" id="5421492">.</span><span class="ident" id="5421493">Sum32</span><span class="op" id="5421498">(</span><span class="op" id="5421499">)</span>&nbsp;<span class="op" id="5421501">!=</span>&nbsp;<span class="ident" id="5421504">r</span><span class="op" id="5421505">.</span><span class="ident" id="5421506">f</span><span class="op" id="5421507">.</span><span class="ident" id="5421508">CRC32</span>&nbsp;<span class="op" id="5421514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421520">err</span>&nbsp;<span class="op" id="5421524">=</span>&nbsp;<span class="ident" id="5421526">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5421541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5421545">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5421548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421551">r</span><span class="op" id="5421552">.</span><span class="ident" id="5421553">err</span>&nbsp;<span class="op" id="5421557">=</span>&nbsp;<span class="ident" id="5421559">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421564">return</span><br>
<span class="lineno"></span><span class="op" id="5421571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="5421574">func</span>&nbsp;<span class="op" id="5421579">(</span><span class="ident" id="5421580">r</span>&nbsp;<span class="op" id="5421582">*</span><span class="ident" id="5421583">checksumReader</span><span class="op" id="5421597">)</span>&nbsp;<span class="ident" id="5421599">Close</span><span class="op" id="5421604">(</span><span class="op" id="5421605">)</span>&nbsp;<span class="builtintype" id="5421607">error</span>&nbsp;<span class="op" id="5421613">{</span>&nbsp;<span class="keyword" id="5421615">return</span>&nbsp;<span class="ident" id="5421622">r</span><span class="op" id="5421623">.</span><span class="ident" id="5421624">rc</span><span class="op" id="5421626">.</span><span class="ident" id="5421627">Close</span><span class="op" id="5421632">(</span><span class="op" id="5421633">)</span>&nbsp;<span class="op" id="5421635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5421638">//&nbsp;findBodyOffset&nbsp;does&nbsp;the&nbsp;minimum&nbsp;work&nbsp;to&nbsp;verify&nbsp;the&nbsp;file&nbsp;has&nbsp;a&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5421710">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;file&nbsp;body&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="5421747">func</span>&nbsp;<span class="op" id="5421752">(</span><span class="ident" id="5421753">f</span>&nbsp;<span class="op" id="5421755">*</span><span class="ident" id="5421756">File</span><span class="op" id="5421760">)</span>&nbsp;<span class="ident" id="5421762">findBodyOffset</span><span class="op" id="5421776">(</span><span class="op" id="5421777">)</span>&nbsp;<span class="op" id="5421779">(</span><span class="ident" id="5421780">int64</span><span class="op" id="5421785">,</span>&nbsp;<span class="builtintype" id="5421787">error</span><span class="op" id="5421792">)</span>&nbsp;<span class="op" id="5421794">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421797">var</span>&nbsp;<span class="ident" id="5421801">buf</span>&nbsp;<span class="op" id="5421805">[</span><span class="ident" id="5421806">fileHeaderLen</span><span class="op" id="5421819">]</span><span class="builtintype" id="5421820">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421826">if</span>&nbsp;<span class="ident" id="5421829">_</span><span class="op" id="5421830">,</span>&nbsp;<span class="ident" id="5421832">err</span>&nbsp;<span class="op" id="5421836">:=</span>&nbsp;<span class="ident" id="5421839">f</span><span class="op" id="5421840">.</span><span class="ident" id="5421841">zipr</span><span class="op" id="5421845">.</span><span class="ident" id="5421846">ReadAt</span><span class="op" id="5421852">(</span><span class="ident" id="5421853">buf</span><span class="op" id="5421856">[</span><span class="op" id="5421857">:</span><span class="op" id="5421858">]</span><span class="op" id="5421859">,</span>&nbsp;<span class="ident" id="5421861">f</span><span class="op" id="5421862">.</span><span class="ident" id="5421863">headerOffset</span><span class="op" id="5421875">)</span><span class="op" id="5421876">;</span>&nbsp;<span class="ident" id="5421878">err</span>&nbsp;<span class="op" id="5421882">!=</span>&nbsp;<span class="builtintype" id="5421885">nil</span>&nbsp;<span class="op" id="5421889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421893">return</span>&nbsp;<span class="num" id="5421900">0</span><span class="op" id="5421901">,</span>&nbsp;<span class="ident" id="5421903">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5421908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5421911">b</span>&nbsp;<span class="op" id="5421913">:=</span>&nbsp;<span class="ident" id="5421916">readBuf</span><span class="op" id="5421923">(</span><span class="ident" id="5421924">buf</span><span class="op" id="5421927">[</span><span class="op" id="5421928">:</span><span class="op" id="5421929">]</span><span class="op" id="5421930">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421933">if</span>&nbsp;<span class="ident" id="5421936">sig</span>&nbsp;<span class="op" id="5421940">:=</span>&nbsp;<span class="ident" id="5421943">b</span><span class="op" id="5421944">.</span><span class="builtintype" id="5421945">uint32</span><span class="op" id="5421951">(</span><span class="op" id="5421952">)</span><span class="op" id="5421953">;</span>&nbsp;<span class="ident" id="5421955">sig</span>&nbsp;<span class="op" id="5421959">!=</span>&nbsp;<span class="ident" id="5421962">fileHeaderSignature</span>&nbsp;<span class="op" id="5421982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5421986">return</span>&nbsp;<span class="num" id="5421993">0</span><span class="op" id="5421994">,</span>&nbsp;<span class="ident" id="5421996">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5422007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422010">b</span>&nbsp;<span class="op" id="5422012">=</span>&nbsp;<span class="ident" id="5422014">b</span><span class="op" id="5422015">[</span><span class="num" id="5422016">22</span><span class="op" id="5422018">:</span><span class="op" id="5422019">]</span>&nbsp;<span class="comment" id="5422021">//&nbsp;skip&nbsp;over&nbsp;most&nbsp;of&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422054">filenameLen</span>&nbsp;<span class="op" id="5422066">:=</span>&nbsp;<span class="builtintype" id="5422069">int</span><span class="op" id="5422072">(</span><span class="ident" id="5422073">b</span><span class="op" id="5422074">.</span><span class="builtintype" id="5422075">uint16</span><span class="op" id="5422081">(</span><span class="op" id="5422082">)</span><span class="op" id="5422083">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422086">extraLen</span>&nbsp;<span class="op" id="5422095">:=</span>&nbsp;<span class="builtintype" id="5422098">int</span><span class="op" id="5422101">(</span><span class="ident" id="5422102">b</span><span class="op" id="5422103">.</span><span class="builtintype" id="5422104">uint16</span><span class="op" id="5422110">(</span><span class="op" id="5422111">)</span><span class="op" id="5422112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5422115">return</span>&nbsp;<span class="ident" id="5422122">int64</span><span class="op" id="5422127">(</span><span class="ident" id="5422128">fileHeaderLen</span>&nbsp;<span class="op" id="5422142">+</span>&nbsp;<span class="ident" id="5422144">filenameLen</span>&nbsp;<span class="op" id="5422156">+</span>&nbsp;<span class="ident" id="5422158">extraLen</span><span class="op" id="5422166">)</span><span class="op" id="5422167">,</span>&nbsp;<span class="builtintype" id="5422169">nil</span><br>
<span class="lineno"></span><span class="op" id="5422173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5422176">//&nbsp;readDirectoryHeader&nbsp;attempts&nbsp;to&nbsp;read&nbsp;a&nbsp;directory&nbsp;header&nbsp;from&nbsp;r.</span><br>
<span class="lineno">210</span><span class="comment" id="5422243">//&nbsp;It&nbsp;returns&nbsp;io.ErrUnexpectedEOF&nbsp;if&nbsp;it&nbsp;cannot&nbsp;read&nbsp;a&nbsp;complete&nbsp;header,</span><br>
<span class="lineno"></span><span class="comment" id="5422314">//&nbsp;and&nbsp;ErrFormat&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;find&nbsp;a&nbsp;valid&nbsp;header&nbsp;signature.</span><br>
<span class="lineno"></span><span class="keyword" id="5422376">func</span>&nbsp;<span class="ident" id="5422381">readDirectoryHeader</span><span class="op" id="5422400">(</span><span class="ident" id="5422401">f</span>&nbsp;<span class="op" id="5422403">*</span><span class="ident" id="5422404">File</span><span class="op" id="5422408">,</span>&nbsp;<span class="ident" id="5422410">r</span>&nbsp;<span class="ident" id="5422412">io</span><span class="op" id="5422414">.</span><span class="ident" id="5422415">Reader</span><span class="op" id="5422421">)</span>&nbsp;<span class="builtintype" id="5422423">error</span>&nbsp;<span class="op" id="5422429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5422432">var</span>&nbsp;<span class="ident" id="5422436">buf</span>&nbsp;<span class="op" id="5422440">[</span><span class="ident" id="5422441">directoryHeaderLen</span><span class="op" id="5422459">]</span><span class="builtintype" id="5422460">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5422466">if</span>&nbsp;<span class="ident" id="5422469">_</span><span class="op" id="5422470">,</span>&nbsp;<span class="ident" id="5422472">err</span>&nbsp;<span class="op" id="5422476">:=</span>&nbsp;<span class="ident" id="5422479">io</span><span class="op" id="5422481">.</span><span class="ident" id="5422482">ReadFull</span><span class="op" id="5422490">(</span><span class="ident" id="5422491">r</span><span class="op" id="5422492">,</span>&nbsp;<span class="ident" id="5422494">buf</span><span class="op" id="5422497">[</span><span class="op" id="5422498">:</span><span class="op" id="5422499">]</span><span class="op" id="5422500">)</span><span class="op" id="5422501">;</span>&nbsp;<span class="ident" id="5422503">err</span>&nbsp;<span class="op" id="5422507">!=</span>&nbsp;<span class="builtintype" id="5422510">nil</span>&nbsp;<span class="op" id="5422514">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5422518">return</span>&nbsp;<span class="ident" id="5422525">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5422530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422533">b</span>&nbsp;<span class="op" id="5422535">:=</span>&nbsp;<span class="ident" id="5422538">readBuf</span><span class="op" id="5422545">(</span><span class="ident" id="5422546">buf</span><span class="op" id="5422549">[</span><span class="op" id="5422550">:</span><span class="op" id="5422551">]</span><span class="op" id="5422552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5422555">if</span>&nbsp;<span class="ident" id="5422558">sig</span>&nbsp;<span class="op" id="5422562">:=</span>&nbsp;<span class="ident" id="5422565">b</span><span class="op" id="5422566">.</span><span class="builtintype" id="5422567">uint32</span><span class="op" id="5422573">(</span><span class="op" id="5422574">)</span><span class="op" id="5422575">;</span>&nbsp;<span class="ident" id="5422577">sig</span>&nbsp;<span class="op" id="5422581">!=</span>&nbsp;<span class="ident" id="5422584">directoryHeaderSignature</span>&nbsp;<span class="op" id="5422609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5422613">return</span>&nbsp;<span class="ident" id="5422620">ErrFormat</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5422631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422634">f</span><span class="op" id="5422635">.</span><span class="ident" id="5422636">CreatorVersion</span>&nbsp;<span class="op" id="5422651">=</span>&nbsp;<span class="ident" id="5422653">b</span><span class="op" id="5422654">.</span><span class="builtintype" id="5422655">uint16</span><span class="op" id="5422661">(</span><span class="op" id="5422662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422665">f</span><span class="op" id="5422666">.</span><span class="ident" id="5422667">ReaderVersion</span>&nbsp;<span class="op" id="5422681">=</span>&nbsp;<span class="ident" id="5422683">b</span><span class="op" id="5422684">.</span><span class="builtintype" id="5422685">uint16</span><span class="op" id="5422691">(</span><span class="op" id="5422692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422695">f</span><span class="op" id="5422696">.</span><span class="ident" id="5422697">Flags</span>&nbsp;<span class="op" id="5422703">=</span>&nbsp;<span class="ident" id="5422705">b</span><span class="op" id="5422706">.</span><span class="builtintype" id="5422707">uint16</span><span class="op" id="5422713">(</span><span class="op" id="5422714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422717">f</span><span class="op" id="5422718">.</span><span class="ident" id="5422719">Method</span>&nbsp;<span class="op" id="5422726">=</span>&nbsp;<span class="ident" id="5422728">b</span><span class="op" id="5422729">.</span><span class="builtintype" id="5422730">uint16</span><span class="op" id="5422736">(</span><span class="op" id="5422737">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422740">f</span><span class="op" id="5422741">.</span><span class="ident" id="5422742">ModifiedTime</span>&nbsp;<span class="op" id="5422755">=</span>&nbsp;<span class="ident" id="5422757">b</span><span class="op" id="5422758">.</span><span class="builtintype" id="5422759">uint16</span><span class="op" id="5422765">(</span><span class="op" id="5422766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422769">f</span><span class="op" id="5422770">.</span><span class="ident" id="5422771">ModifiedDate</span>&nbsp;<span class="op" id="5422784">=</span>&nbsp;<span class="ident" id="5422786">b</span><span class="op" id="5422787">.</span><span class="builtintype" id="5422788">uint16</span><span class="op" id="5422794">(</span><span class="op" id="5422795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422798">f</span><span class="op" id="5422799">.</span><span class="ident" id="5422800">CRC32</span>&nbsp;<span class="op" id="5422806">=</span>&nbsp;<span class="ident" id="5422808">b</span><span class="op" id="5422809">.</span><span class="builtintype" id="5422810">uint32</span><span class="op" id="5422816">(</span><span class="op" id="5422817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422820">f</span><span class="op" id="5422821">.</span><span class="ident" id="5422822">CompressedSize</span>&nbsp;<span class="op" id="5422837">=</span>&nbsp;<span class="ident" id="5422839">b</span><span class="op" id="5422840">.</span><span class="builtintype" id="5422841">uint32</span><span class="op" id="5422847">(</span><span class="op" id="5422848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422851">f</span><span class="op" id="5422852">.</span><span class="ident" id="5422853">UncompressedSize</span>&nbsp;<span class="op" id="5422870">=</span>&nbsp;<span class="ident" id="5422872">b</span><span class="op" id="5422873">.</span><span class="builtintype" id="5422874">uint32</span><span class="op" id="5422880">(</span><span class="op" id="5422881">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422884">f</span><span class="op" id="5422885">.</span><span class="ident" id="5422886">CompressedSize64</span>&nbsp;<span class="op" id="5422903">=</span>&nbsp;<span class="ident" id="5422905">uint64</span><span class="op" id="5422911">(</span><span class="ident" id="5422912">f</span><span class="op" id="5422913">.</span><span class="ident" id="5422914">CompressedSize</span><span class="op" id="5422928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422931">f</span><span class="op" id="5422932">.</span><span class="ident" id="5422933">UncompressedSize64</span>&nbsp;<span class="op" id="5422952">=</span>&nbsp;<span class="ident" id="5422954">uint64</span><span class="op" id="5422960">(</span><span class="ident" id="5422961">f</span><span class="op" id="5422962">.</span><span class="ident" id="5422963">UncompressedSize</span><span class="op" id="5422979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5422982">filenameLen</span>&nbsp;<span class="op" id="5422994">:=</span>&nbsp;<span class="builtintype" id="5422997">int</span><span class="op" id="5423000">(</span><span class="ident" id="5423001">b</span><span class="op" id="5423002">.</span><span class="builtintype" id="5423003">uint16</span><span class="op" id="5423009">(</span><span class="op" id="5423010">)</span><span class="op" id="5423011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5423014">extraLen</span>&nbsp;<span class="op" id="5423023">:=</span>&nbsp;<span class="builtintype" id="5423026">int</span><span class="op" id="5423029">(</span><span class="ident" id="5423030">b</span><span class="op" id="5423031">.</span><span class="builtintype" id="5423032">uint16</span><span class="op" id="5423038">(</span><span class="op" id="5423039">)</span><span class="op" id="5423040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5423043">commentLen</span>&nbsp;<span class="op" id="5423054">:=</span>&nbsp;<span class="builtintype" id="5423057">int</span><span class="op" id="5423060">(</span><span class="ident" id="5423061">b</span><span class="op" id="5423062">.</span><span class="builtintype" id="5423063">uint16</span><span class="op" id="5423069">(</span><span class="op" id="5423070">)</span><span class="op" id="5423071">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5423074">b</span>&nbsp;<span class="op" id="5423076">=</span>&nbsp;<span class="ident" id="5423078">b</span><span class="op" id="5423079">[</span><span class="num" id="5423080">4</span><span class="op" id="5423081">:</span><span class="op" id="5423082">]</span>&nbsp;<span class="comment" id="5423084">//&nbsp;skipped&nbsp;start&nbsp;disk&nbsp;number&nbsp;and&nbsp;internal&nbsp;attributes&nbsp;(2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5423150">f</span><span class="op" id="5423151">.</span><span class="ident" id="5423152">ExternalAttrs</span>&nbsp;<span class="op" id="5423166">=</span>&nbsp;<span class="ident" id="5423168">b</span><span class="op" id="5423169">.</span><span class="builtintype" id="5423170">uint32</span><span class="op" id="5423176">(</span><span class="op" id="5423177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5423180">f</span><span class="op" id="5423181">.</span><span class="ident" id="5423182">headerOffset</span>&nbsp;<span class="op" id="5423195">=</span>&nbsp;<span class="ident" id="5423197">int64</span><span class="op" id="5423202">(</span><span class="ident" id="5423203">b</span><span class="op" id="5423204">.</span><span class="builtintype" id="5423205">uint32</span><span class="op" id="5423211">(</span><span class="op" id="5423212">)</span><span class="op" id="5423213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5423216">d</span>&nbsp;<span class="op" id="5423218">:=</span>&nbsp;<span class="builtinfunc" id="5423221">make</span><span class="op" id="5423225">(</span><span class="op" id="5423226">[</span><span class="op" id="5423227">]</span><span class="builtintype" id="5423228">byte</span><span class="op" id="5423232">,</span>&nbsp;<span class="ident" id="5423234">filenameLen</span><span class="op" id="5423245">+</span><span class="ident" id="5423246">extraLen</span><span class="op" id="5423254">+</span><span class="ident" id="5423255">commentLen</span><span class="op" id="5423265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5423268">if</span>&nbsp;<span class="ident" id="5423271">_</span><span class="op" id="5423272">,</span>&nbsp;<span class="ident" id="5423274">err</span>&nbsp;<span class="op" id="5423278">:=</span>&nbsp;<span class="ident" id="5423281">io</span><span class="op" id="5423283">.</span><span class="ident" id="5423284">ReadFull</span><span class="op" id="5423292">(</span><span class="ident" id="5423293">r</span><span class="op" id="5423294">,</span>&nbsp;<span class="ident" id="5423296">d</span><span class="op" id="5423297">)</span><span class="op" id="5423298">;</span>&nbsp;<span class="ident" id="5423300">err</span>&nbsp;<span class="op" id="5423304">!=</span>&nbsp;<span class="builtintype" id="5423307">nil</span>&nbsp;<span class="op" id="5423311">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5423315">return</span>&nbsp;<span class="ident" id="5423322">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5423327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5423330">f</span><span class="op" id="5423331">.</span><span class="ident" id="5423332">Name</span>&nbsp;<span class="op" id="5423337">=</span>&nbsp;<span class="builtintype" id="5423339">string</span><span class="op" id="5423345">(</span><span class="ident" id="5423346">d</span><span class="op" id="5423347">[</span><span class="op" id="5423348">:</span><span class="ident" id="5423349">filenameLen</span><span class="op" id="5423360">]</span><span class="op" id="5423361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5423364">f</span><span class="op" id="5423365">.</span><span class="ident" id="5423366">Extra</span>&nbsp;<span class="op" id="5423372">=</span>&nbsp;<span class="ident" id="5423374">d</span><span class="op" id="5423375">[</span><span class="ident" id="5423376">filenameLen</span>&nbsp;<span class="op" id="5423388">:</span>&nbsp;<span class="ident" id="5423390">filenameLen</span><span class="op" id="5423401">+</span><span class="ident" id="5423402">extraLen</span><span class="op" id="5423410">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5423413">f</span><span class="op" id="5423414">.</span><span class="ident" id="5423415">Comment</span>&nbsp;<span class="op" id="5423423">=</span>&nbsp;<span class="builtintype" id="5423425">string</span><span class="op" id="5423431">(</span><span class="ident" id="5423432">d</span><span class="op" id="5423433">[</span><span class="ident" id="5423434">filenameLen</span><span class="op" id="5423445">+</span><span class="ident" id="5423446">extraLen</span><span class="op" id="5423454">:</span><span class="op" id="5423455">]</span><span class="op" id="5423456">)</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5423460">if</span>&nbsp;<span class="builtinfunc" id="5423463">len</span><span class="op" id="5423466">(</span><span class="ident" id="5423467">f</span><span class="op" id="5423468">.</span><span class="ident" id="5423469">Extra</span><span class="op" id="5423474">)</span>&nbsp;<span class="op" id="5423476">&gt;</span>&nbsp;<span class="num" id="5423478">0</span>&nbsp;<span class="op" id="5423480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5423484">b</span>&nbsp;<span class="op" id="5423486">:=</span>&nbsp;<span class="ident" id="5423489">readBuf</span><span class="op" id="5423496">(</span><span class="ident" id="5423497">f</span><span class="op" id="5423498">.</span><span class="ident" id="5423499">Extra</span><span class="op" id="5423504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5423508">for</span>&nbsp;<span class="builtinfunc" id="5423512">len</span><span class="op" id="5423515">(</span><span class="ident" id="5423516">b</span><span class="op" id="5423517">)</span>&nbsp;<span class="op" id="5423519">&gt;=</span>&nbsp;<span class="num" id="5423522">4</span>&nbsp;<span class="op" id="5423524">{</span>&nbsp;<span class="comment" id="5423526">//&nbsp;need&nbsp;at&nbsp;least&nbsp;tag&nbsp;and&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5423559">tag</span>&nbsp;<span class="op" id="5423563">:=</span>&nbsp;<span class="ident" id="5423566">b</span><span class="op" id="5423567">.</span><span class="builtintype" id="5423568">uint16</span><span class="op" id="5423574">(</span><span class="op" id="5423575">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5423580">size</span>&nbsp;<span class="op" id="5423585">:=</span>&nbsp;<span class="ident" id="5423588">b</span><span class="op" id="5423589">.</span><span class="builtintype" id="5423590">uint16</span><span class="op" id="5423596">(</span><span class="op" id="5423597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5423602">if</span>&nbsp;<span class="builtintype" id="5423605">int</span><span class="op" id="5423608">(</span><span class="ident" id="5423609">size</span><span class="op" id="5423613">)</span>&nbsp;<span class="op" id="5423615">&gt;</span>&nbsp;<span class="builtinfunc" id="5423617">len</span><span class="op" id="5423620">(</span><span class="ident" id="5423621">b</span><span class="op" id="5423622">)</span>&nbsp;<span class="op" id="5423624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5423630">return</span>&nbsp;<span class="ident" id="5423637">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5423650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5423655">if</span>&nbsp;<span class="ident" id="5423658">tag</span>&nbsp;<span class="op" id="5423662">==</span>&nbsp;<span class="ident" id="5423665">zip64ExtraId</span>&nbsp;<span class="op" id="5423678">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5423684">//&nbsp;update&nbsp;directory&nbsp;values&nbsp;from&nbsp;the&nbsp;zip64&nbsp;extra&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5423742">eb</span>&nbsp;<span class="op" id="5423745">:=</span>&nbsp;<span class="ident" id="5423748">readBuf</span><span class="op" id="5423755">(</span><span class="ident" id="5423756">b</span><span class="op" id="5423757">[</span><span class="op" id="5423758">:</span><span class="ident" id="5423759">size</span><span class="op" id="5423763">]</span><span class="op" id="5423764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5423770">if</span>&nbsp;<span class="builtinfunc" id="5423773">len</span><span class="op" id="5423776">(</span><span class="ident" id="5423777">eb</span><span class="op" id="5423779">)</span>&nbsp;<span class="op" id="5423781">&gt;=</span>&nbsp;<span class="num" id="5423784">8</span>&nbsp;<span class="op" id="5423786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5423793">f</span><span class="op" id="5423794">.</span><span class="ident" id="5423795">UncompressedSize64</span>&nbsp;<span class="op" id="5423814">=</span>&nbsp;<span class="ident" id="5423816">eb</span><span class="op" id="5423818">.</span><span class="ident" id="5423819">uint64</span><span class="op" id="5423825">(</span><span class="op" id="5423826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5423832">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5423838">if</span>&nbsp;<span class="builtinfunc" id="5423841">len</span><span class="op" id="5423844">(</span><span class="ident" id="5423845">eb</span><span class="op" id="5423847">)</span>&nbsp;<span class="op" id="5423849">&gt;=</span>&nbsp;<span class="num" id="5423852">8</span>&nbsp;<span class="op" id="5423854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5423861">f</span><span class="op" id="5423862">.</span><span class="ident" id="5423863">CompressedSize64</span>&nbsp;<span class="op" id="5423880">=</span>&nbsp;<span class="ident" id="5423882">eb</span><span class="op" id="5423884">.</span><span class="ident" id="5423885">uint64</span><span class="op" id="5423891">(</span><span class="op" id="5423892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5423898">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5423904">if</span>&nbsp;<span class="builtinfunc" id="5423907">len</span><span class="op" id="5423910">(</span><span class="ident" id="5423911">eb</span><span class="op" id="5423913">)</span>&nbsp;<span class="op" id="5423915">&gt;=</span>&nbsp;<span class="num" id="5423918">8</span>&nbsp;<span class="op" id="5423920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5423927">f</span><span class="op" id="5423928">.</span><span class="ident" id="5423929">headerOffset</span>&nbsp;<span class="op" id="5423942">=</span>&nbsp;<span class="ident" id="5423944">int64</span><span class="op" id="5423949">(</span><span class="ident" id="5423950">eb</span><span class="op" id="5423952">.</span><span class="ident" id="5423953">uint64</span><span class="op" id="5423959">(</span><span class="op" id="5423960">)</span><span class="op" id="5423961">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5423967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5423972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5423977">b</span>&nbsp;<span class="op" id="5423979">=</span>&nbsp;<span class="ident" id="5423981">b</span><span class="op" id="5423982">[</span><span class="ident" id="5423983">size</span><span class="op" id="5423987">:</span><span class="op" id="5423988">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5423992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5423996">//&nbsp;Should&nbsp;have&nbsp;consumed&nbsp;the&nbsp;whole&nbsp;header.</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5424040">//&nbsp;But&nbsp;popular&nbsp;zip&nbsp;&amp;&nbsp;JAR&nbsp;creation&nbsp;tools&nbsp;are&nbsp;broken&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5424097">//&nbsp;may&nbsp;pad&nbsp;extra&nbsp;zeros&nbsp;at&nbsp;the&nbsp;end,&nbsp;so&nbsp;accept&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5424150">//&nbsp;too.&nbsp;See&nbsp;golang.org/issue/8186.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5424187">for</span>&nbsp;<span class="ident" id="5424191">_</span><span class="op" id="5424192">,</span>&nbsp;<span class="ident" id="5424194">v</span>&nbsp;<span class="op" id="5424196">:=</span>&nbsp;<span class="keyword" id="5424199">range</span>&nbsp;<span class="ident" id="5424205">b</span>&nbsp;<span class="op" id="5424207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5424212">if</span>&nbsp;<span class="ident" id="5424215">v</span>&nbsp;<span class="op" id="5424217">!=</span>&nbsp;<span class="num" id="5424220">0</span>&nbsp;<span class="op" id="5424222">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5424228">return</span>&nbsp;<span class="ident" id="5424235">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5424248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5424252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5424255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5424258">return</span>&nbsp;<span class="builtintype" id="5424265">nil</span><br>
<span class="lineno">280</span><span class="op" id="5424269">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5424272">func</span>&nbsp;<span class="ident" id="5424277">readDataDescriptor</span><span class="op" id="5424295">(</span><span class="ident" id="5424296">r</span>&nbsp;<span class="ident" id="5424298">io</span><span class="op" id="5424300">.</span><span class="ident" id="5424301">Reader</span><span class="op" id="5424307">,</span>&nbsp;<span class="ident" id="5424309">f</span>&nbsp;<span class="op" id="5424311">*</span><span class="ident" id="5424312">File</span><span class="op" id="5424316">)</span>&nbsp;<span class="builtintype" id="5424318">error</span>&nbsp;<span class="op" id="5424324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5424327">var</span>&nbsp;<span class="ident" id="5424331">buf</span>&nbsp;<span class="op" id="5424335">[</span><span class="ident" id="5424336">dataDescriptorLen</span><span class="op" id="5424353">]</span><span class="builtintype" id="5424354">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5424361">//&nbsp;The&nbsp;spec&nbsp;says:&nbsp;&#34;Although&nbsp;not&nbsp;originally&nbsp;assigned&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5424416">//&nbsp;signature,&nbsp;the&nbsp;value&nbsp;0x08074b50&nbsp;has&nbsp;commonly&nbsp;been&nbsp;adopted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5424478">//&nbsp;as&nbsp;a&nbsp;signature&nbsp;value&nbsp;for&nbsp;the&nbsp;data&nbsp;descriptor&nbsp;record.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5424535">//&nbsp;Implementers&nbsp;should&nbsp;be&nbsp;aware&nbsp;that&nbsp;ZIP&nbsp;files&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5424590">//&nbsp;encountered&nbsp;with&nbsp;or&nbsp;without&nbsp;this&nbsp;signature&nbsp;marking&nbsp;data</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5424650">//&nbsp;descriptors&nbsp;and&nbsp;should&nbsp;account&nbsp;for&nbsp;either&nbsp;case&nbsp;when&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5424714">//&nbsp;ZIP&nbsp;files&nbsp;to&nbsp;ensure&nbsp;compatibility.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5424754">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5424758">//&nbsp;dataDescriptorLen&nbsp;includes&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;signature&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5424819">//&nbsp;first&nbsp;read&nbsp;just&nbsp;those&nbsp;4&nbsp;bytes&nbsp;to&nbsp;see&nbsp;if&nbsp;it&nbsp;exists.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5424874">if</span>&nbsp;<span class="ident" id="5424877">_</span><span class="op" id="5424878">,</span>&nbsp;<span class="ident" id="5424880">err</span>&nbsp;<span class="op" id="5424884">:=</span>&nbsp;<span class="ident" id="5424887">io</span><span class="op" id="5424889">.</span><span class="ident" id="5424890">ReadFull</span><span class="op" id="5424898">(</span><span class="ident" id="5424899">r</span><span class="op" id="5424900">,</span>&nbsp;<span class="ident" id="5424902">buf</span><span class="op" id="5424905">[</span><span class="op" id="5424906">:</span><span class="num" id="5424907">4</span><span class="op" id="5424908">]</span><span class="op" id="5424909">)</span><span class="op" id="5424910">;</span>&nbsp;<span class="ident" id="5424912">err</span>&nbsp;<span class="op" id="5424916">!=</span>&nbsp;<span class="builtintype" id="5424919">nil</span>&nbsp;<span class="op" id="5424923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5424927">return</span>&nbsp;<span class="ident" id="5424934">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5424939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5424942">off</span>&nbsp;<span class="op" id="5424946">:=</span>&nbsp;<span class="num" id="5424949">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5424952">maybeSig</span>&nbsp;<span class="op" id="5424961">:=</span>&nbsp;<span class="ident" id="5424964">readBuf</span><span class="op" id="5424971">(</span><span class="ident" id="5424972">buf</span><span class="op" id="5424975">[</span><span class="op" id="5424976">:</span><span class="num" id="5424977">4</span><span class="op" id="5424978">]</span><span class="op" id="5424979">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5424982">if</span>&nbsp;<span class="ident" id="5424985">maybeSig</span><span class="op" id="5424993">.</span><span class="builtintype" id="5424994">uint32</span><span class="op" id="5425000">(</span><span class="op" id="5425001">)</span>&nbsp;<span class="op" id="5425003">!=</span>&nbsp;<span class="ident" id="5425006">dataDescriptorSignature</span>&nbsp;<span class="op" id="5425030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5425034">//&nbsp;No&nbsp;data&nbsp;descriptor&nbsp;signature.&nbsp;Keep&nbsp;these&nbsp;four</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5425085">//&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5425097">off</span>&nbsp;<span class="op" id="5425101">+=</span>&nbsp;<span class="num" id="5425104">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5425107">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5425110">if</span>&nbsp;<span class="ident" id="5425113">_</span><span class="op" id="5425114">,</span>&nbsp;<span class="ident" id="5425116">err</span>&nbsp;<span class="op" id="5425120">:=</span>&nbsp;<span class="ident" id="5425123">io</span><span class="op" id="5425125">.</span><span class="ident" id="5425126">ReadFull</span><span class="op" id="5425134">(</span><span class="ident" id="5425135">r</span><span class="op" id="5425136">,</span>&nbsp;<span class="ident" id="5425138">buf</span><span class="op" id="5425141">[</span><span class="ident" id="5425142">off</span><span class="op" id="5425145">:</span><span class="num" id="5425146">12</span><span class="op" id="5425148">]</span><span class="op" id="5425149">)</span><span class="op" id="5425150">;</span>&nbsp;<span class="ident" id="5425152">err</span>&nbsp;<span class="op" id="5425156">!=</span>&nbsp;<span class="builtintype" id="5425159">nil</span>&nbsp;<span class="op" id="5425163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5425167">return</span>&nbsp;<span class="ident" id="5425174">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5425179">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5425182">b</span>&nbsp;<span class="op" id="5425184">:=</span>&nbsp;<span class="ident" id="5425187">readBuf</span><span class="op" id="5425194">(</span><span class="ident" id="5425195">buf</span><span class="op" id="5425198">[</span><span class="op" id="5425199">:</span><span class="num" id="5425200">12</span><span class="op" id="5425202">]</span><span class="op" id="5425203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5425206">if</span>&nbsp;<span class="ident" id="5425209">b</span><span class="op" id="5425210">.</span><span class="builtintype" id="5425211">uint32</span><span class="op" id="5425217">(</span><span class="op" id="5425218">)</span>&nbsp;<span class="op" id="5425220">!=</span>&nbsp;<span class="ident" id="5425223">f</span><span class="op" id="5425224">.</span><span class="ident" id="5425225">CRC32</span>&nbsp;<span class="op" id="5425231">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5425235">return</span>&nbsp;<span class="ident" id="5425242">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5425255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5425259">//&nbsp;The&nbsp;two&nbsp;sizes&nbsp;that&nbsp;follow&nbsp;here&nbsp;can&nbsp;be&nbsp;either&nbsp;32&nbsp;bits&nbsp;or&nbsp;64&nbsp;bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5425327">//&nbsp;but&nbsp;the&nbsp;spec&nbsp;is&nbsp;not&nbsp;very&nbsp;clear&nbsp;on&nbsp;this&nbsp;and&nbsp;different</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5425384">//&nbsp;interpretations&nbsp;has&nbsp;been&nbsp;made&nbsp;causing&nbsp;incompatibilities.&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5425448">//&nbsp;already&nbsp;have&nbsp;the&nbsp;sizes&nbsp;from&nbsp;the&nbsp;central&nbsp;directory&nbsp;so&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5425512">//&nbsp;just&nbsp;ignore&nbsp;these.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5425536">return</span>&nbsp;<span class="builtintype" id="5425543">nil</span><br>
<span class="lineno">320</span><span class="op" id="5425547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5425550">func</span>&nbsp;<span class="ident" id="5425555">readDirectoryEnd</span><span class="op" id="5425571">(</span><span class="ident" id="5425572">r</span>&nbsp;<span class="ident" id="5425574">io</span><span class="op" id="5425576">.</span><span class="ident" id="5425577">ReaderAt</span><span class="op" id="5425585">,</span>&nbsp;<span class="ident" id="5425587">size</span>&nbsp;<span class="ident" id="5425592">int64</span><span class="op" id="5425597">)</span>&nbsp;<span class="op" id="5425599">(</span><span class="ident" id="5425600">dir</span>&nbsp;<span class="op" id="5425604">*</span><span class="ident" id="5425605">directoryEnd</span><span class="op" id="5425617">,</span>&nbsp;<span class="ident" id="5425619">err</span>&nbsp;<span class="builtintype" id="5425623">error</span><span class="op" id="5425628">)</span>&nbsp;<span class="op" id="5425630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5425633">//&nbsp;look&nbsp;for&nbsp;directoryEndSignature&nbsp;in&nbsp;the&nbsp;last&nbsp;1k,&nbsp;then&nbsp;in&nbsp;the&nbsp;last&nbsp;65k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5425705">var</span>&nbsp;<span class="ident" id="5425709">buf</span>&nbsp;<span class="op" id="5425713">[</span><span class="op" id="5425714">]</span><span class="builtintype" id="5425715">byte</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5425721">var</span>&nbsp;<span class="ident" id="5425725">directoryEndOffset</span>&nbsp;<span class="ident" id="5425744">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5425751">for</span>&nbsp;<span class="ident" id="5425755">i</span><span class="op" id="5425756">,</span>&nbsp;<span class="ident" id="5425758">bLen</span>&nbsp;<span class="op" id="5425763">:=</span>&nbsp;<span class="keyword" id="5425766">range</span>&nbsp;<span class="op" id="5425772">[</span><span class="op" id="5425773">]</span><span class="ident" id="5425774">int64</span><span class="op" id="5425779">{</span><span class="num" id="5425780">1024</span><span class="op" id="5425784">,</span>&nbsp;<span class="num" id="5425786">65</span>&nbsp;<span class="op" id="5425789">*</span>&nbsp;<span class="num" id="5425791">1024</span><span class="op" id="5425795">}</span>&nbsp;<span class="op" id="5425797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5425801">if</span>&nbsp;<span class="ident" id="5425804">bLen</span>&nbsp;<span class="op" id="5425809">&gt;</span>&nbsp;<span class="ident" id="5425811">size</span>&nbsp;<span class="op" id="5425816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5425821">bLen</span>&nbsp;<span class="op" id="5425826">=</span>&nbsp;<span class="ident" id="5425828">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5425835">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5425839">buf</span>&nbsp;<span class="op" id="5425843">=</span>&nbsp;<span class="builtinfunc" id="5425845">make</span><span class="op" id="5425849">(</span><span class="op" id="5425850">[</span><span class="op" id="5425851">]</span><span class="builtintype" id="5425852">byte</span><span class="op" id="5425856">,</span>&nbsp;<span class="builtintype" id="5425858">int</span><span class="op" id="5425861">(</span><span class="ident" id="5425862">bLen</span><span class="op" id="5425866">)</span><span class="op" id="5425867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5425871">if</span>&nbsp;<span class="ident" id="5425874">_</span><span class="op" id="5425875">,</span>&nbsp;<span class="ident" id="5425877">err</span>&nbsp;<span class="op" id="5425881">:=</span>&nbsp;<span class="ident" id="5425884">r</span><span class="op" id="5425885">.</span><span class="ident" id="5425886">ReadAt</span><span class="op" id="5425892">(</span><span class="ident" id="5425893">buf</span><span class="op" id="5425896">,</span>&nbsp;<span class="ident" id="5425898">size</span><span class="op" id="5425902">-</span><span class="ident" id="5425903">bLen</span><span class="op" id="5425907">)</span><span class="op" id="5425908">;</span>&nbsp;<span class="ident" id="5425910">err</span>&nbsp;<span class="op" id="5425914">!=</span>&nbsp;<span class="builtintype" id="5425917">nil</span>&nbsp;<span class="op" id="5425921">&amp;&amp;</span>&nbsp;<span class="ident" id="5425924">err</span>&nbsp;<span class="op" id="5425928">!=</span>&nbsp;<span class="ident" id="5425931">io</span><span class="op" id="5425933">.</span><span class="ident" id="5425934">EOF</span>&nbsp;<span class="op" id="5425938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5425943">return</span>&nbsp;<span class="builtintype" id="5425950">nil</span><span class="op" id="5425953">,</span>&nbsp;<span class="ident" id="5425955">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5425961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5425965">if</span>&nbsp;<span class="ident" id="5425968">p</span>&nbsp;<span class="op" id="5425970">:=</span>&nbsp;<span class="ident" id="5425973">findSignatureInBlock</span><span class="op" id="5425993">(</span><span class="ident" id="5425994">buf</span><span class="op" id="5425997">)</span><span class="op" id="5425998">;</span>&nbsp;<span class="ident" id="5426000">p</span>&nbsp;<span class="op" id="5426002">&gt;=</span>&nbsp;<span class="num" id="5426005">0</span>&nbsp;<span class="op" id="5426007">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5426012">buf</span>&nbsp;<span class="op" id="5426016">=</span>&nbsp;<span class="ident" id="5426018">buf</span><span class="op" id="5426021">[</span><span class="ident" id="5426022">p</span><span class="op" id="5426023">:</span><span class="op" id="5426024">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5426029">directoryEndOffset</span>&nbsp;<span class="op" id="5426048">=</span>&nbsp;<span class="ident" id="5426050">size</span>&nbsp;<span class="op" id="5426055">-</span>&nbsp;<span class="ident" id="5426057">bLen</span>&nbsp;<span class="op" id="5426062">+</span>&nbsp;<span class="ident" id="5426064">int64</span><span class="op" id="5426069">(</span><span class="ident" id="5426070">p</span><span class="op" id="5426071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5426076">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5426084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5426088">if</span>&nbsp;<span class="ident" id="5426091">i</span>&nbsp;<span class="op" id="5426093">==</span>&nbsp;<span class="num" id="5426096">1</span>&nbsp;<span class="op" id="5426098">||</span>&nbsp;<span class="ident" id="5426101">bLen</span>&nbsp;<span class="op" id="5426106">==</span>&nbsp;<span class="ident" id="5426109">size</span>&nbsp;<span class="op" id="5426114">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5426119">return</span>&nbsp;<span class="builtintype" id="5426126">nil</span><span class="op" id="5426129">,</span>&nbsp;<span class="ident" id="5426131">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5426143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5426146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5426150">//&nbsp;read&nbsp;header&nbsp;into&nbsp;struct</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5426178">b</span>&nbsp;<span class="op" id="5426180">:=</span>&nbsp;<span class="ident" id="5426183">readBuf</span><span class="op" id="5426190">(</span><span class="ident" id="5426191">buf</span><span class="op" id="5426194">[</span><span class="num" id="5426195">4</span><span class="op" id="5426196">:</span><span class="op" id="5426197">]</span><span class="op" id="5426198">)</span>&nbsp;<span class="comment" id="5426200">//&nbsp;skip&nbsp;signature</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5426219">d</span>&nbsp;<span class="op" id="5426221">:=</span>&nbsp;<span class="op" id="5426224">&amp;</span><span class="ident" id="5426225">directoryEnd</span><span class="op" id="5426237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5426241">diskNbr</span><span class="op" id="5426248">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5426261">uint32</span><span class="op" id="5426267">(</span><span class="ident" id="5426268">b</span><span class="op" id="5426269">.</span><span class="builtintype" id="5426270">uint16</span><span class="op" id="5426276">(</span><span class="op" id="5426277">)</span><span class="op" id="5426278">)</span><span class="op" id="5426279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5426283">dirDiskNbr</span><span class="op" id="5426293">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5426303">uint32</span><span class="op" id="5426309">(</span><span class="ident" id="5426310">b</span><span class="op" id="5426311">.</span><span class="builtintype" id="5426312">uint16</span><span class="op" id="5426318">(</span><span class="op" id="5426319">)</span><span class="op" id="5426320">)</span><span class="op" id="5426321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5426325">dirRecordsThisDisk</span><span class="op" id="5426343">:</span>&nbsp;<span class="ident" id="5426345">uint64</span><span class="op" id="5426351">(</span><span class="ident" id="5426352">b</span><span class="op" id="5426353">.</span><span class="builtintype" id="5426354">uint16</span><span class="op" id="5426360">(</span><span class="op" id="5426361">)</span><span class="op" id="5426362">)</span><span class="op" id="5426363">,</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5426367">directoryRecords</span><span class="op" id="5426383">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5426387">uint64</span><span class="op" id="5426393">(</span><span class="ident" id="5426394">b</span><span class="op" id="5426395">.</span><span class="builtintype" id="5426396">uint16</span><span class="op" id="5426402">(</span><span class="op" id="5426403">)</span><span class="op" id="5426404">)</span><span class="op" id="5426405">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5426409">directorySize</span><span class="op" id="5426422">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5426429">uint64</span><span class="op" id="5426435">(</span><span class="ident" id="5426436">b</span><span class="op" id="5426437">.</span><span class="builtintype" id="5426438">uint32</span><span class="op" id="5426444">(</span><span class="op" id="5426445">)</span><span class="op" id="5426446">)</span><span class="op" id="5426447">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5426451">directoryOffset</span><span class="op" id="5426466">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5426471">uint64</span><span class="op" id="5426477">(</span><span class="ident" id="5426478">b</span><span class="op" id="5426479">.</span><span class="builtintype" id="5426480">uint32</span><span class="op" id="5426486">(</span><span class="op" id="5426487">)</span><span class="op" id="5426488">)</span><span class="op" id="5426489">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5426493">commentLen</span><span class="op" id="5426503">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5426513">b</span><span class="op" id="5426514">.</span><span class="builtintype" id="5426515">uint16</span><span class="op" id="5426521">(</span><span class="op" id="5426522">)</span><span class="op" id="5426523">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5426526">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5426529">l</span>&nbsp;<span class="op" id="5426531">:=</span>&nbsp;<span class="builtintype" id="5426534">int</span><span class="op" id="5426537">(</span><span class="ident" id="5426538">d</span><span class="op" id="5426539">.</span><span class="ident" id="5426540">commentLen</span><span class="op" id="5426550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5426553">if</span>&nbsp;<span class="ident" id="5426556">l</span>&nbsp;<span class="op" id="5426558">&gt;</span>&nbsp;<span class="builtinfunc" id="5426560">len</span><span class="op" id="5426563">(</span><span class="ident" id="5426564">b</span><span class="op" id="5426565">)</span>&nbsp;<span class="op" id="5426567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5426571">return</span>&nbsp;<span class="builtintype" id="5426578">nil</span><span class="op" id="5426581">,</span>&nbsp;<span class="ident" id="5426583">errors</span><span class="op" id="5426589">.</span><span class="ident" id="5426590">New</span><span class="op" id="5426593">(</span><span class="string" id="5426594">&#34;zip:&nbsp;invalid&nbsp;comment&nbsp;length&#34;</span><span class="op" id="5426623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5426626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5426629">d</span><span class="op" id="5426630">.</span><span class="ident" id="5426631">comment</span>&nbsp;<span class="op" id="5426639">=</span>&nbsp;<span class="builtintype" id="5426641">string</span><span class="op" id="5426647">(</span><span class="ident" id="5426648">b</span><span class="op" id="5426649">[</span><span class="op" id="5426650">:</span><span class="ident" id="5426651">l</span><span class="op" id="5426652">]</span><span class="op" id="5426653">)</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5426657">p</span><span class="op" id="5426658">,</span>&nbsp;<span class="ident" id="5426660">err</span>&nbsp;<span class="op" id="5426664">:=</span>&nbsp;<span class="ident" id="5426667">findDirectory64End</span><span class="op" id="5426685">(</span><span class="ident" id="5426686">r</span><span class="op" id="5426687">,</span>&nbsp;<span class="ident" id="5426689">directoryEndOffset</span><span class="op" id="5426707">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5426710">if</span>&nbsp;<span class="ident" id="5426713">err</span>&nbsp;<span class="op" id="5426717">==</span>&nbsp;<span class="builtintype" id="5426720">nil</span>&nbsp;<span class="op" id="5426724">&amp;&amp;</span>&nbsp;<span class="ident" id="5426727">p</span>&nbsp;<span class="op" id="5426729">&gt;=</span>&nbsp;<span class="num" id="5426732">0</span>&nbsp;<span class="op" id="5426734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5426738">err</span>&nbsp;<span class="op" id="5426742">=</span>&nbsp;<span class="ident" id="5426744">readDirectory64End</span><span class="op" id="5426762">(</span><span class="ident" id="5426763">r</span><span class="op" id="5426764">,</span>&nbsp;<span class="ident" id="5426766">p</span><span class="op" id="5426767">,</span>&nbsp;<span class="ident" id="5426769">d</span><span class="op" id="5426770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5426773">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5426776">if</span>&nbsp;<span class="ident" id="5426779">err</span>&nbsp;<span class="op" id="5426783">!=</span>&nbsp;<span class="builtintype" id="5426786">nil</span>&nbsp;<span class="op" id="5426790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5426794">return</span>&nbsp;<span class="builtintype" id="5426801">nil</span><span class="op" id="5426804">,</span>&nbsp;<span class="ident" id="5426806">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5426811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5426815">//&nbsp;Make&nbsp;sure&nbsp;directoryOffset&nbsp;points&nbsp;to&nbsp;somewhere&nbsp;in&nbsp;our&nbsp;file.</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5426878">if</span>&nbsp;<span class="ident" id="5426881">o</span>&nbsp;<span class="op" id="5426883">:=</span>&nbsp;<span class="ident" id="5426886">int64</span><span class="op" id="5426891">(</span><span class="ident" id="5426892">d</span><span class="op" id="5426893">.</span><span class="ident" id="5426894">directoryOffset</span><span class="op" id="5426909">)</span><span class="op" id="5426910">;</span>&nbsp;<span class="ident" id="5426912">o</span>&nbsp;<span class="op" id="5426914">&lt;</span>&nbsp;<span class="num" id="5426916">0</span>&nbsp;<span class="op" id="5426918">||</span>&nbsp;<span class="ident" id="5426921">o</span>&nbsp;<span class="op" id="5426923">&gt;=</span>&nbsp;<span class="ident" id="5426926">size</span>&nbsp;<span class="op" id="5426931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5426935">return</span>&nbsp;<span class="builtintype" id="5426942">nil</span><span class="op" id="5426945">,</span>&nbsp;<span class="ident" id="5426947">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5426958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5426961">return</span>&nbsp;<span class="ident" id="5426968">d</span><span class="op" id="5426969">,</span>&nbsp;<span class="builtintype" id="5426971">nil</span><br>
<span class="lineno"></span><span class="op" id="5426975">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="5426978">//&nbsp;findDirectory64End&nbsp;tries&nbsp;to&nbsp;read&nbsp;the&nbsp;zip64&nbsp;locator&nbsp;just&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5427048">//&nbsp;directory&nbsp;end&nbsp;and&nbsp;returns&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="5427118">//&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="5427128">func</span>&nbsp;<span class="ident" id="5427133">findDirectory64End</span><span class="op" id="5427151">(</span><span class="ident" id="5427152">r</span>&nbsp;<span class="ident" id="5427154">io</span><span class="op" id="5427156">.</span><span class="ident" id="5427157">ReaderAt</span><span class="op" id="5427165">,</span>&nbsp;<span class="ident" id="5427167">directoryEndOffset</span>&nbsp;<span class="ident" id="5427186">int64</span><span class="op" id="5427191">)</span>&nbsp;<span class="op" id="5427193">(</span><span class="ident" id="5427194">int64</span><span class="op" id="5427199">,</span>&nbsp;<span class="builtintype" id="5427201">error</span><span class="op" id="5427206">)</span>&nbsp;<span class="op" id="5427208">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5427211">locOffset</span>&nbsp;<span class="op" id="5427221">:=</span>&nbsp;<span class="ident" id="5427224">directoryEndOffset</span>&nbsp;<span class="op" id="5427243">-</span>&nbsp;<span class="ident" id="5427245">directory64LocLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5427264">if</span>&nbsp;<span class="ident" id="5427267">locOffset</span>&nbsp;<span class="op" id="5427277">&lt;</span>&nbsp;<span class="num" id="5427279">0</span>&nbsp;<span class="op" id="5427281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5427285">return</span>&nbsp;<span class="op" id="5427292">-</span><span class="num" id="5427293">1</span><span class="op" id="5427294">,</span>&nbsp;<span class="builtintype" id="5427296">nil</span>&nbsp;<span class="comment" id="5427300">//&nbsp;no&nbsp;need&nbsp;to&nbsp;look&nbsp;for&nbsp;a&nbsp;header&nbsp;outside&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5427350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5427353">buf</span>&nbsp;<span class="op" id="5427357">:=</span>&nbsp;<span class="builtinfunc" id="5427360">make</span><span class="op" id="5427364">(</span><span class="op" id="5427365">[</span><span class="op" id="5427366">]</span><span class="builtintype" id="5427367">byte</span><span class="op" id="5427371">,</span>&nbsp;<span class="ident" id="5427373">directory64LocLen</span><span class="op" id="5427390">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5427393">if</span>&nbsp;<span class="ident" id="5427396">_</span><span class="op" id="5427397">,</span>&nbsp;<span class="ident" id="5427399">err</span>&nbsp;<span class="op" id="5427403">:=</span>&nbsp;<span class="ident" id="5427406">r</span><span class="op" id="5427407">.</span><span class="ident" id="5427408">ReadAt</span><span class="op" id="5427414">(</span><span class="ident" id="5427415">buf</span><span class="op" id="5427418">,</span>&nbsp;<span class="ident" id="5427420">locOffset</span><span class="op" id="5427429">)</span><span class="op" id="5427430">;</span>&nbsp;<span class="ident" id="5427432">err</span>&nbsp;<span class="op" id="5427436">!=</span>&nbsp;<span class="builtintype" id="5427439">nil</span>&nbsp;<span class="op" id="5427443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5427447">return</span>&nbsp;<span class="op" id="5427454">-</span><span class="num" id="5427455">1</span><span class="op" id="5427456">,</span>&nbsp;<span class="ident" id="5427458">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5427463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5427466">b</span>&nbsp;<span class="op" id="5427468">:=</span>&nbsp;<span class="ident" id="5427471">readBuf</span><span class="op" id="5427478">(</span><span class="ident" id="5427479">buf</span><span class="op" id="5427482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5427485">if</span>&nbsp;<span class="ident" id="5427488">sig</span>&nbsp;<span class="op" id="5427492">:=</span>&nbsp;<span class="ident" id="5427495">b</span><span class="op" id="5427496">.</span><span class="builtintype" id="5427497">uint32</span><span class="op" id="5427503">(</span><span class="op" id="5427504">)</span><span class="op" id="5427505">;</span>&nbsp;<span class="ident" id="5427507">sig</span>&nbsp;<span class="op" id="5427511">!=</span>&nbsp;<span class="ident" id="5427514">directory64LocSignature</span>&nbsp;<span class="op" id="5427538">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5427542">return</span>&nbsp;<span class="op" id="5427549">-</span><span class="num" id="5427550">1</span><span class="op" id="5427551">,</span>&nbsp;<span class="builtintype" id="5427553">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5427558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5427561">b</span>&nbsp;<span class="op" id="5427563">=</span>&nbsp;<span class="ident" id="5427565">b</span><span class="op" id="5427566">[</span><span class="num" id="5427567">4</span><span class="op" id="5427568">:</span><span class="op" id="5427569">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5427577">//&nbsp;skip&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5427658">p</span>&nbsp;<span class="op" id="5427660">:=</span>&nbsp;<span class="ident" id="5427663">b</span><span class="op" id="5427664">.</span><span class="ident" id="5427665">uint64</span><span class="op" id="5427671">(</span><span class="op" id="5427672">)</span>&nbsp;<span class="comment" id="5427674">//&nbsp;relative&nbsp;offset&nbsp;of&nbsp;the&nbsp;zip64&nbsp;end&nbsp;of&nbsp;central&nbsp;directory&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5427739">return</span>&nbsp;<span class="ident" id="5427746">int64</span><span class="op" id="5427751">(</span><span class="ident" id="5427752">p</span><span class="op" id="5427753">)</span><span class="op" id="5427754">,</span>&nbsp;<span class="builtintype" id="5427756">nil</span><br>
<span class="lineno">395</span><span class="op" id="5427760">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5427763">//&nbsp;readDirectory64End&nbsp;reads&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;and&nbsp;updates&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5427831">//&nbsp;directory&nbsp;end&nbsp;with&nbsp;the&nbsp;zip64&nbsp;directory&nbsp;end&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="5427885">func</span>&nbsp;<span class="ident" id="5427890">readDirectory64End</span><span class="op" id="5427908">(</span><span class="ident" id="5427909">r</span>&nbsp;<span class="ident" id="5427911">io</span><span class="op" id="5427913">.</span><span class="ident" id="5427914">ReaderAt</span><span class="op" id="5427922">,</span>&nbsp;<span class="ident" id="5427924">offset</span>&nbsp;<span class="ident" id="5427931">int64</span><span class="op" id="5427936">,</span>&nbsp;<span class="ident" id="5427938">d</span>&nbsp;<span class="op" id="5427940">*</span><span class="ident" id="5427941">directoryEnd</span><span class="op" id="5427953">)</span>&nbsp;<span class="op" id="5427955">(</span><span class="ident" id="5427956">err</span>&nbsp;<span class="builtintype" id="5427960">error</span><span class="op" id="5427965">)</span>&nbsp;<span class="op" id="5427967">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5427970">buf</span>&nbsp;<span class="op" id="5427974">:=</span>&nbsp;<span class="builtinfunc" id="5427977">make</span><span class="op" id="5427981">(</span><span class="op" id="5427982">[</span><span class="op" id="5427983">]</span><span class="builtintype" id="5427984">byte</span><span class="op" id="5427988">,</span>&nbsp;<span class="ident" id="5427990">directory64EndLen</span><span class="op" id="5428007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5428010">if</span>&nbsp;<span class="ident" id="5428013">_</span><span class="op" id="5428014">,</span>&nbsp;<span class="ident" id="5428016">err</span>&nbsp;<span class="op" id="5428020">:=</span>&nbsp;<span class="ident" id="5428023">r</span><span class="op" id="5428024">.</span><span class="ident" id="5428025">ReadAt</span><span class="op" id="5428031">(</span><span class="ident" id="5428032">buf</span><span class="op" id="5428035">,</span>&nbsp;<span class="ident" id="5428037">offset</span><span class="op" id="5428043">)</span><span class="op" id="5428044">;</span>&nbsp;<span class="ident" id="5428046">err</span>&nbsp;<span class="op" id="5428050">!=</span>&nbsp;<span class="builtintype" id="5428053">nil</span>&nbsp;<span class="op" id="5428057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5428061">return</span>&nbsp;<span class="ident" id="5428068">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5428073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428077">b</span>&nbsp;<span class="op" id="5428079">:=</span>&nbsp;<span class="ident" id="5428082">readBuf</span><span class="op" id="5428089">(</span><span class="ident" id="5428090">buf</span><span class="op" id="5428093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5428096">if</span>&nbsp;<span class="ident" id="5428099">sig</span>&nbsp;<span class="op" id="5428103">:=</span>&nbsp;<span class="ident" id="5428106">b</span><span class="op" id="5428107">.</span><span class="builtintype" id="5428108">uint32</span><span class="op" id="5428114">(</span><span class="op" id="5428115">)</span><span class="op" id="5428116">;</span>&nbsp;<span class="ident" id="5428118">sig</span>&nbsp;<span class="op" id="5428122">!=</span>&nbsp;<span class="ident" id="5428125">directory64EndSignature</span>&nbsp;<span class="op" id="5428149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5428153">return</span>&nbsp;<span class="ident" id="5428160">ErrFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5428171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428175">b</span>&nbsp;<span class="op" id="5428177">=</span>&nbsp;<span class="ident" id="5428179">b</span><span class="op" id="5428180">[</span><span class="num" id="5428181">12</span><span class="op" id="5428183">:</span><span class="op" id="5428184">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5428209">//&nbsp;skip&nbsp;dir&nbsp;size,&nbsp;version&nbsp;and&nbsp;version&nbsp;needed&nbsp;(uint64&nbsp;+&nbsp;2x&nbsp;uint16)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428276">d</span><span class="op" id="5428277">.</span><span class="ident" id="5428278">diskNbr</span>&nbsp;<span class="op" id="5428286">=</span>&nbsp;<span class="ident" id="5428288">b</span><span class="op" id="5428289">.</span><span class="builtintype" id="5428290">uint32</span><span class="op" id="5428296">(</span><span class="op" id="5428297">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5428310">//&nbsp;number&nbsp;of&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428334">d</span><span class="op" id="5428335">.</span><span class="ident" id="5428336">dirDiskNbr</span>&nbsp;<span class="op" id="5428347">=</span>&nbsp;<span class="ident" id="5428349">b</span><span class="op" id="5428350">.</span><span class="builtintype" id="5428351">uint32</span><span class="op" id="5428357">(</span><span class="op" id="5428358">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5428368">//&nbsp;number&nbsp;of&nbsp;the&nbsp;disk&nbsp;with&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428431">d</span><span class="op" id="5428432">.</span><span class="ident" id="5428433">dirRecordsThisDisk</span>&nbsp;<span class="op" id="5428452">=</span>&nbsp;<span class="ident" id="5428454">b</span><span class="op" id="5428455">.</span><span class="ident" id="5428456">uint64</span><span class="op" id="5428462">(</span><span class="op" id="5428463">)</span>&nbsp;<span class="comment" id="5428465">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory&nbsp;on&nbsp;this&nbsp;disk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428531">d</span><span class="op" id="5428532">.</span><span class="ident" id="5428533">directoryRecords</span>&nbsp;<span class="op" id="5428550">=</span>&nbsp;<span class="ident" id="5428552">b</span><span class="op" id="5428553">.</span><span class="ident" id="5428554">uint64</span><span class="op" id="5428560">(</span><span class="op" id="5428561">)</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5428565">//&nbsp;total&nbsp;number&nbsp;of&nbsp;entries&nbsp;in&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428618">d</span><span class="op" id="5428619">.</span><span class="ident" id="5428620">directorySize</span>&nbsp;<span class="op" id="5428634">=</span>&nbsp;<span class="ident" id="5428636">b</span><span class="op" id="5428637">.</span><span class="ident" id="5428638">uint64</span><span class="op" id="5428644">(</span><span class="op" id="5428645">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5428652">//&nbsp;size&nbsp;of&nbsp;the&nbsp;central&nbsp;directory</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5428686">d</span><span class="op" id="5428687">.</span><span class="ident" id="5428688">directoryOffset</span>&nbsp;<span class="op" id="5428704">=</span>&nbsp;<span class="ident" id="5428706">b</span><span class="op" id="5428707">.</span><span class="ident" id="5428708">uint64</span><span class="op" id="5428714">(</span><span class="op" id="5428715">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5428720">//&nbsp;offset&nbsp;of&nbsp;start&nbsp;of&nbsp;central&nbsp;directory&nbsp;with&nbsp;respect&nbsp;to&nbsp;the&nbsp;starting&nbsp;disk&nbsp;number</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5428803">return</span>&nbsp;<span class="builtintype" id="5428810">nil</span><br>
<span class="lineno"></span><span class="op" id="5428814">}</span><br>
<span class="lineno">420</span><br>
<span class="lineno"></span><span class="keyword" id="5428817">func</span>&nbsp;<span class="ident" id="5428822">findSignatureInBlock</span><span class="op" id="5428842">(</span><span class="ident" id="5428843">b</span>&nbsp;<span class="op" id="5428845">[</span><span class="op" id="5428846">]</span><span class="builtintype" id="5428847">byte</span><span class="op" id="5428851">)</span>&nbsp;<span class="builtintype" id="5428853">int</span>&nbsp;<span class="op" id="5428857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5428860">for</span>&nbsp;<span class="ident" id="5428864">i</span>&nbsp;<span class="op" id="5428866">:=</span>&nbsp;<span class="builtinfunc" id="5428869">len</span><span class="op" id="5428872">(</span><span class="ident" id="5428873">b</span><span class="op" id="5428874">)</span>&nbsp;<span class="op" id="5428876">-</span>&nbsp;<span class="ident" id="5428878">directoryEndLen</span><span class="op" id="5428893">;</span>&nbsp;<span class="ident" id="5428895">i</span>&nbsp;<span class="op" id="5428897">&gt;=</span>&nbsp;<span class="num" id="5428900">0</span><span class="op" id="5428901">;</span>&nbsp;<span class="ident" id="5428903">i</span><span class="op" id="5428904">--</span>&nbsp;<span class="op" id="5428907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5428911">//&nbsp;defined&nbsp;from&nbsp;directoryEndSignature&nbsp;in&nbsp;struct.go</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5428964">if</span>&nbsp;<span class="ident" id="5428967">b</span><span class="op" id="5428968">[</span><span class="ident" id="5428969">i</span><span class="op" id="5428970">]</span>&nbsp;<span class="op" id="5428972">==</span>&nbsp;<span class="string" id="5428975">&#39;P&#39;</span>&nbsp;<span class="op" id="5428979">&amp;&amp;</span>&nbsp;<span class="ident" id="5428982">b</span><span class="op" id="5428983">[</span><span class="ident" id="5428984">i</span><span class="op" id="5428985">+</span><span class="num" id="5428986">1</span><span class="op" id="5428987">]</span>&nbsp;<span class="op" id="5428989">==</span>&nbsp;<span class="string" id="5428992">&#39;K&#39;</span>&nbsp;<span class="op" id="5428996">&amp;&amp;</span>&nbsp;<span class="ident" id="5428999">b</span><span class="op" id="5429000">[</span><span class="ident" id="5429001">i</span><span class="op" id="5429002">+</span><span class="num" id="5429003">2</span><span class="op" id="5429004">]</span>&nbsp;<span class="op" id="5429006">==</span>&nbsp;<span class="num" id="5429009">0x05</span>&nbsp;<span class="op" id="5429014">&amp;&amp;</span>&nbsp;<span class="ident" id="5429017">b</span><span class="op" id="5429018">[</span><span class="ident" id="5429019">i</span><span class="op" id="5429020">+</span><span class="num" id="5429021">3</span><span class="op" id="5429022">]</span>&nbsp;<span class="op" id="5429024">==</span>&nbsp;<span class="num" id="5429027">0x06</span>&nbsp;<span class="op" id="5429032">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5429037">//&nbsp;n&nbsp;is&nbsp;length&nbsp;of&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429066">n</span>&nbsp;<span class="op" id="5429068">:=</span>&nbsp;<span class="builtintype" id="5429071">int</span><span class="op" id="5429074">(</span><span class="ident" id="5429075">b</span><span class="op" id="5429076">[</span><span class="ident" id="5429077">i</span><span class="op" id="5429078">+</span><span class="ident" id="5429079">directoryEndLen</span><span class="op" id="5429094">-</span><span class="num" id="5429095">2</span><span class="op" id="5429096">]</span><span class="op" id="5429097">)</span>&nbsp;<span class="op" id="5429099">|</span>&nbsp;<span class="builtintype" id="5429101">int</span><span class="op" id="5429104">(</span><span class="ident" id="5429105">b</span><span class="op" id="5429106">[</span><span class="ident" id="5429107">i</span><span class="op" id="5429108">+</span><span class="ident" id="5429109">directoryEndLen</span><span class="op" id="5429124">-</span><span class="num" id="5429125">1</span><span class="op" id="5429126">]</span><span class="op" id="5429127">)</span><span class="op" id="5429128">&lt;&lt;</span><span class="num" id="5429130">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5429135">if</span>&nbsp;<span class="ident" id="5429138">n</span><span class="op" id="5429139">+</span><span class="ident" id="5429140">directoryEndLen</span><span class="op" id="5429155">+</span><span class="ident" id="5429156">i</span>&nbsp;<span class="op" id="5429158">&lt;=</span>&nbsp;<span class="builtinfunc" id="5429161">len</span><span class="op" id="5429164">(</span><span class="ident" id="5429165">b</span><span class="op" id="5429166">)</span>&nbsp;<span class="op" id="5429168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5429174">return</span>&nbsp;<span class="ident" id="5429181">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5429186">}</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5429190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5429193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5429196">return</span>&nbsp;<span class="op" id="5429203">-</span><span class="num" id="5429204">1</span><br>
<span class="lineno"></span><span class="op" id="5429206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">435</span><span class="keyword" id="5429209">type</span>&nbsp;<span class="ident" id="5429214">readBuf</span>&nbsp;<span class="op" id="5429222">[</span><span class="op" id="5429223">]</span><span class="builtintype" id="5429224">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5429230">func</span>&nbsp;<span class="op" id="5429235">(</span><span class="ident" id="5429236">b</span>&nbsp;<span class="op" id="5429238">*</span><span class="ident" id="5429239">readBuf</span><span class="op" id="5429246">)</span>&nbsp;<span class="builtintype" id="5429248">uint16</span><span class="op" id="5429254">(</span><span class="op" id="5429255">)</span>&nbsp;<span class="builtintype" id="5429257">uint16</span>&nbsp;<span class="op" id="5429264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429267">v</span>&nbsp;<span class="op" id="5429269">:=</span>&nbsp;<span class="ident" id="5429272">binary</span><span class="op" id="5429278">.</span><span class="ident" id="5429279">LittleEndian</span><span class="op" id="5429291">.</span><span class="ident" id="5429292">Uint16</span><span class="op" id="5429298">(</span><span class="op" id="5429299">*</span><span class="ident" id="5429300">b</span><span class="op" id="5429301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5429304">*</span><span class="ident" id="5429305">b</span>&nbsp;<span class="op" id="5429307">=</span>&nbsp;<span class="op" id="5429309">(</span><span class="op" id="5429310">*</span><span class="ident" id="5429311">b</span><span class="op" id="5429312">)</span><span class="op" id="5429313">[</span><span class="num" id="5429314">2</span><span class="op" id="5429315">:</span><span class="op" id="5429316">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5429319">return</span>&nbsp;<span class="ident" id="5429326">v</span><br>
<span class="lineno"></span><span class="op" id="5429328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5429331">func</span>&nbsp;<span class="op" id="5429336">(</span><span class="ident" id="5429337">b</span>&nbsp;<span class="op" id="5429339">*</span><span class="ident" id="5429340">readBuf</span><span class="op" id="5429347">)</span>&nbsp;<span class="builtintype" id="5429349">uint32</span><span class="op" id="5429355">(</span><span class="op" id="5429356">)</span>&nbsp;<span class="builtintype" id="5429358">uint32</span>&nbsp;<span class="op" id="5429365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429368">v</span>&nbsp;<span class="op" id="5429370">:=</span>&nbsp;<span class="ident" id="5429373">binary</span><span class="op" id="5429379">.</span><span class="ident" id="5429380">LittleEndian</span><span class="op" id="5429392">.</span><span class="ident" id="5429393">Uint32</span><span class="op" id="5429399">(</span><span class="op" id="5429400">*</span><span class="ident" id="5429401">b</span><span class="op" id="5429402">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5429405">*</span><span class="ident" id="5429406">b</span>&nbsp;<span class="op" id="5429408">=</span>&nbsp;<span class="op" id="5429410">(</span><span class="op" id="5429411">*</span><span class="ident" id="5429412">b</span><span class="op" id="5429413">)</span><span class="op" id="5429414">[</span><span class="num" id="5429415">4</span><span class="op" id="5429416">:</span><span class="op" id="5429417">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5429420">return</span>&nbsp;<span class="ident" id="5429427">v</span><br>
<span class="lineno"></span><span class="op" id="5429429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5429432">func</span>&nbsp;<span class="op" id="5429437">(</span><span class="ident" id="5429438">b</span>&nbsp;<span class="op" id="5429440">*</span><span class="ident" id="5429441">readBuf</span><span class="op" id="5429448">)</span>&nbsp;<span class="ident" id="5429450">uint64</span><span class="op" id="5429456">(</span><span class="op" id="5429457">)</span>&nbsp;<span class="ident" id="5429459">uint64</span>&nbsp;<span class="op" id="5429466">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5429469">v</span>&nbsp;<span class="op" id="5429471">:=</span>&nbsp;<span class="ident" id="5429474">binary</span><span class="op" id="5429480">.</span><span class="ident" id="5429481">LittleEndian</span><span class="op" id="5429493">.</span><span class="ident" id="5429494">Uint64</span><span class="op" id="5429500">(</span><span class="op" id="5429501">*</span><span class="ident" id="5429502">b</span><span class="op" id="5429503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5429506">*</span><span class="ident" id="5429507">b</span>&nbsp;<span class="op" id="5429509">=</span>&nbsp;<span class="op" id="5429511">(</span><span class="op" id="5429512">*</span><span class="ident" id="5429513">b</span><span class="op" id="5429514">)</span><span class="op" id="5429515">[</span><span class="num" id="5429516">8</span><span class="op" id="5429517">:</span><span class="op" id="5429518">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5429521">return</span>&nbsp;<span class="ident" id="5429528">v</span><br>
<span class="lineno"></span><span class="op" id="5429530">}</span>
</div>
</body>
</html>
