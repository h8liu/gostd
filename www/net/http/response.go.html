<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3816456">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3816511">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3816565">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3816616">//&nbsp;HTTP&nbsp;Response&nbsp;reading&nbsp;and&nbsp;parsing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3816655">package</span>&nbsp;<span class="ident" id="3816663">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3816669">import</span>&nbsp;<span class="op" id="3816676">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3816679">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3816688">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3816697">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3816711">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3816721">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3816727">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3816744">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3816755">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3816766">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3816776">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3816779">var</span>&nbsp;<span class="ident" id="3816783">respExcludeHeader</span>&nbsp;<span class="op" id="3816801">=</span>&nbsp;<span class="keyword" id="3816803">map</span><span class="op" id="3816806">[</span><span class="builtintype" id="3816807">string</span><span class="op" id="3816813">]</span><span class="builtintype" id="3816814">bool</span><span class="op" id="3816818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3816821">&#34;Content-Length&#34;</span><span class="op" id="3816837">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3816842">true</span><span class="op" id="3816846">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3816849">&#34;Transfer-Encoding&#34;</span><span class="op" id="3816868">:</span>&nbsp;<span class="ident" id="3816870">true</span><span class="op" id="3816874">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3816877">&#34;Trailer&#34;</span><span class="op" id="3816886">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3816898">true</span><span class="op" id="3816902">,</span><br>
<span class="lineno">25</span><span class="op" id="3816904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3816907">//&nbsp;Response&nbsp;represents&nbsp;the&nbsp;response&nbsp;from&nbsp;an&nbsp;HTTP&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="3816965">//</span><br>
<span class="lineno"></span><span class="keyword" id="3816968">type</span>&nbsp;<span class="ident" id="3816973">Response</span>&nbsp;<span class="keyword" id="3816982">struct</span>&nbsp;<span class="op" id="3816989">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3816992">Status</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3817003">string</span>&nbsp;<span class="comment" id="3817010">//&nbsp;e.g.&nbsp;&#34;200&nbsp;OK&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3817028">StatusCode</span>&nbsp;<span class="builtintype" id="3817039">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3817046">//&nbsp;e.g.&nbsp;200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3817059">Proto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3817070">string</span>&nbsp;<span class="comment" id="3817077">//&nbsp;e.g.&nbsp;&#34;HTTP/1.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3817097">ProtoMajor</span>&nbsp;<span class="builtintype" id="3817108">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3817115">//&nbsp;e.g.&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3817126">ProtoMinor</span>&nbsp;<span class="builtintype" id="3817137">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3817144">//&nbsp;e.g.&nbsp;0</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3817156">//&nbsp;Header&nbsp;maps&nbsp;header&nbsp;keys&nbsp;to&nbsp;values.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;had&nbsp;multiple</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3817225">//&nbsp;headers&nbsp;with&nbsp;the&nbsp;same&nbsp;key,&nbsp;they&nbsp;may&nbsp;be&nbsp;concatenated,&nbsp;with&nbsp;comma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3817293">//&nbsp;delimiters.&nbsp;&nbsp;(Section&nbsp;4.2&nbsp;of&nbsp;RFC&nbsp;2616&nbsp;requires&nbsp;that&nbsp;multiple&nbsp;headers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3817366">//&nbsp;be&nbsp;semantically&nbsp;equivalent&nbsp;to&nbsp;a&nbsp;comma-delimited&nbsp;sequence.)&nbsp;Values</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3817436">//&nbsp;duplicated&nbsp;by&nbsp;other&nbsp;fields&nbsp;in&nbsp;this&nbsp;struct&nbsp;(e.g.,&nbsp;ContentLength)&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3817508">//&nbsp;omitted&nbsp;from&nbsp;Header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3817533">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3817537">//&nbsp;Keys&nbsp;in&nbsp;the&nbsp;map&nbsp;are&nbsp;canonicalized&nbsp;(see&nbsp;CanonicalHeaderKey).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3817601">Header</span>&nbsp;<span class="ident" id="3817608"><a href="/net/http/header.go.html#3781581">Header</a></span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3817617">//&nbsp;Body&nbsp;represents&nbsp;the&nbsp;response&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3817656">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3817660">//&nbsp;The&nbsp;http&nbsp;Client&nbsp;and&nbsp;Transport&nbsp;guarantee&nbsp;that&nbsp;Body&nbsp;is&nbsp;always</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3817724">//&nbsp;non-nil,&nbsp;even&nbsp;on&nbsp;responses&nbsp;without&nbsp;a&nbsp;body&nbsp;or&nbsp;responses&nbsp;with</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3817788">//&nbsp;a&nbsp;zero-length&nbsp;body.&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3817849">//&nbsp;close&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3817865">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3817869">//&nbsp;The&nbsp;Body&nbsp;is&nbsp;automatically&nbsp;dechunked&nbsp;if&nbsp;the&nbsp;server&nbsp;replied</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3817931">//&nbsp;with&nbsp;a&nbsp;&#34;chunked&#34;&nbsp;Transfer-Encoding.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3817971">Body</span>&nbsp;<span class="ident" id="3817976"><a href="/net/http/response.go.html#3816721">io</a></span><span class="op" id="3817978">.</span><span class="ident" id="3817979">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3817992">//&nbsp;ContentLength&nbsp;records&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;associated&nbsp;content.&nbsp;&nbsp;The</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818061">//&nbsp;value&nbsp;-1&nbsp;indicates&nbsp;that&nbsp;the&nbsp;length&nbsp;is&nbsp;unknown.&nbsp;&nbsp;Unless&nbsp;Request.Method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818135">//&nbsp;is&nbsp;&#34;HEAD&#34;,&nbsp;values&nbsp;&gt;=&nbsp;0&nbsp;indicate&nbsp;that&nbsp;the&nbsp;given&nbsp;number&nbsp;of&nbsp;bytes&nbsp;may</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818206">//&nbsp;be&nbsp;read&nbsp;from&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3818229">ContentLength</span>&nbsp;<span class="ident" id="3818243">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818251">//&nbsp;Contains&nbsp;transfer&nbsp;encodings&nbsp;from&nbsp;outer-most&nbsp;to&nbsp;inner-most.&nbsp;Value&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818323">//&nbsp;nil,&nbsp;means&nbsp;that&nbsp;&#34;identity&#34;&nbsp;encoding&nbsp;is&nbsp;used.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3818372">TransferEncoding</span>&nbsp;<span class="op" id="3818389">[</span><span class="op" id="3818390">]</span><span class="builtintype" id="3818391">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818400">//&nbsp;Close&nbsp;records&nbsp;whether&nbsp;the&nbsp;header&nbsp;directed&nbsp;that&nbsp;the&nbsp;connection&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818469">//&nbsp;closed&nbsp;after&nbsp;reading&nbsp;Body.&nbsp;&nbsp;The&nbsp;value&nbsp;is&nbsp;advice&nbsp;for&nbsp;clients:&nbsp;neither</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818542">//&nbsp;ReadResponse&nbsp;nor&nbsp;Response.Write&nbsp;ever&nbsp;closes&nbsp;a&nbsp;connection.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3818604">Close</span>&nbsp;<span class="builtintype" id="3818610">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818617">//&nbsp;Trailer&nbsp;maps&nbsp;trailer&nbsp;keys&nbsp;to&nbsp;values,&nbsp;in&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818670">//&nbsp;format&nbsp;as&nbsp;the&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3818696">Trailer</span>&nbsp;<span class="ident" id="3818704"><a href="/net/http/header.go.html#3781581">Header</a></span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818713">//&nbsp;The&nbsp;Request&nbsp;that&nbsp;was&nbsp;sent&nbsp;to&nbsp;obtain&nbsp;this&nbsp;Response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818768">//&nbsp;Request&#39;s&nbsp;Body&nbsp;is&nbsp;nil&nbsp;(having&nbsp;already&nbsp;been&nbsp;consumed).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818826">//&nbsp;This&nbsp;is&nbsp;only&nbsp;populated&nbsp;for&nbsp;Client&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3818874">Request</span>&nbsp;<span class="op" id="3818882">*</span><span class="ident" id="3818883"><a href="/net/http/request.go.html#3791418">Request</a></span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818893">//&nbsp;TLS&nbsp;contains&nbsp;information&nbsp;about&nbsp;the&nbsp;TLS&nbsp;connection&nbsp;on&nbsp;which&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3818960">//&nbsp;response&nbsp;was&nbsp;received.&nbsp;It&nbsp;is&nbsp;nil&nbsp;for&nbsp;unencrypted&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3819024">//&nbsp;The&nbsp;pointer&nbsp;is&nbsp;shared&nbsp;between&nbsp;responses&nbsp;and&nbsp;should&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3819086">//&nbsp;modified.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3819100">TLS</span>&nbsp;<span class="op" id="3819104">*</span><span class="ident" id="3819105"><a href="/net/http/response.go.html#3816697">tls</a></span><span class="op" id="3819108">.</span><span class="ident" id="3819109">ConnectionState</span><br>
<span class="lineno"></span><span class="op" id="3819125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3819128">//&nbsp;Cookies&nbsp;parses&nbsp;and&nbsp;returns&nbsp;the&nbsp;cookies&nbsp;set&nbsp;in&nbsp;the&nbsp;Set-Cookie&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="3819201">func</span>&nbsp;<span class="op" id="3819206">(</span><span class="ident" id="3819207">r</span>&nbsp;<span class="op" id="3819209">*</span><span class="ident" id="3819210"><a href="/net/http/response.go.html#3816973">Response</a></span><span class="op" id="3819218">)</span>&nbsp;<span class="ident" id="3819220">Cookies</span><span class="op" id="3819227">(</span><span class="op" id="3819228">)</span>&nbsp;<span class="op" id="3819230">[</span><span class="op" id="3819231">]</span><span class="op" id="3819232">*</span><span class="ident" id="3819233"><a href="/net/http/cookie.go.html#3751461">Cookie</a></span>&nbsp;<span class="op" id="3819240">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3819243">return</span>&nbsp;<span class="ident" id="3819250"><a href="/net/http/cookie.go.html#3752027">readSetCookies</a></span><span class="op" id="3819264">(</span><span class="ident" id="3819265"><a href="/net/http/response.go.html#3819207">r</a></span><span class="op" id="3819266">.</span><span class="ident" id="3819267">Header</span><span class="op" id="3819273">)</span><br>
<span class="lineno"></span><span class="op" id="3819275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3819278">var</span>&nbsp;<span class="ident" id="3819282">ErrNoLocation</span>&nbsp;<span class="op" id="3819296">=</span>&nbsp;<span class="ident" id="3819298"><a href="/net/http/response.go.html#3816711">errors</a></span><span class="op" id="3819304">.</span><span class="ident" id="3819305">New</span><span class="op" id="3819308">(</span><span class="string" id="3819309">&#34;http:&nbsp;no&nbsp;Location&nbsp;header&nbsp;in&nbsp;response&#34;</span><span class="op" id="3819347">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="3819350">//&nbsp;Location&nbsp;returns&nbsp;the&nbsp;URL&nbsp;of&nbsp;the&nbsp;response&#39;s&nbsp;&#34;Location&#34;&nbsp;header,</span><br>
<span class="lineno"></span><span class="comment" id="3819415">//&nbsp;if&nbsp;present.&nbsp;&nbsp;Relative&nbsp;redirects&nbsp;are&nbsp;resolved&nbsp;relative&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3819475">//&nbsp;the&nbsp;Response&#39;s&nbsp;Request.&nbsp;&nbsp;ErrNoLocation&nbsp;is&nbsp;returned&nbsp;if&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="3819535">//&nbsp;Location&nbsp;header&nbsp;is&nbsp;present.</span><br>
<span class="lineno"></span><span class="keyword" id="3819566">func</span>&nbsp;<span class="op" id="3819571">(</span><span class="ident" id="3819572">r</span>&nbsp;<span class="op" id="3819574">*</span><span class="ident" id="3819575"><a href="/net/http/response.go.html#3816973">Response</a></span><span class="op" id="3819583">)</span>&nbsp;<span class="ident" id="3819585">Location</span><span class="op" id="3819593">(</span><span class="op" id="3819594">)</span>&nbsp;<span class="op" id="3819596">(</span><span class="op" id="3819597">*</span><span class="ident" id="3819598"><a href="/net/http/response.go.html#3816744">url</a></span><span class="op" id="3819601">.</span><span class="ident" id="3819602">URL</span><span class="op" id="3819605">,</span>&nbsp;<span class="builtintype" id="3819607">error</span><span class="op" id="3819612">)</span>&nbsp;<span class="op" id="3819614">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3819617">lv</span>&nbsp;<span class="op" id="3819620">:=</span>&nbsp;<span class="ident" id="3819623"><a href="/net/http/response.go.html#3819572">r</a></span><span class="op" id="3819624">.</span><span class="ident" id="3819625">Header</span><span class="op" id="3819631">.</span><span class="ident" id="3819632">Get</span><span class="op" id="3819635">(</span><span class="string" id="3819636">&#34;Location&#34;</span><span class="op" id="3819646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3819649">if</span>&nbsp;<span class="ident" id="3819652"><a href="/net/http/response.go.html#3819617">lv</a></span>&nbsp;<span class="op" id="3819655">==</span>&nbsp;<span class="string" id="3819658">&#34;&#34;</span>&nbsp;<span class="op" id="3819661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3819665">return</span>&nbsp;<span class="ident" id="3819672">nil</span><span class="op" id="3819675">,</span>&nbsp;<span class="ident" id="3819677"><a href="/net/http/response.go.html#3819282">ErrNoLocation</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3819692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3819695">if</span>&nbsp;<span class="ident" id="3819698"><a href="/net/http/response.go.html#3819572">r</a></span><span class="op" id="3819699">.</span><span class="ident" id="3819700">Request</span>&nbsp;<span class="op" id="3819708">!=</span>&nbsp;<span class="ident" id="3819711">nil</span>&nbsp;<span class="op" id="3819715">&amp;&amp;</span>&nbsp;<span class="ident" id="3819718"><a href="/net/http/response.go.html#3819572">r</a></span><span class="op" id="3819719">.</span><span class="ident" id="3819720">Request</span><span class="op" id="3819727">.</span><span class="ident" id="3819728">URL</span>&nbsp;<span class="op" id="3819732">!=</span>&nbsp;<span class="ident" id="3819735">nil</span>&nbsp;<span class="op" id="3819739">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3819743">return</span>&nbsp;<span class="ident" id="3819750"><a href="/net/http/response.go.html#3819572">r</a></span><span class="op" id="3819751">.</span><span class="ident" id="3819752">Request</span><span class="op" id="3819759">.</span><span class="ident" id="3819760">URL</span><span class="op" id="3819763">.</span><span class="ident" id="3819764">Parse</span><span class="op" id="3819769">(</span><span class="ident" id="3819770"><a href="/net/http/response.go.html#3819617">lv</a></span><span class="op" id="3819772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3819775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3819778">return</span>&nbsp;<span class="ident" id="3819785"><a href="/net/http/response.go.html#3816744">url</a></span><span class="op" id="3819788">.</span><span class="ident" id="3819789">Parse</span><span class="op" id="3819794">(</span><span class="ident" id="3819795"><a href="/net/http/response.go.html#3819617">lv</a></span><span class="op" id="3819797">)</span><br>
<span class="lineno"></span><span class="op" id="3819799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="3819802">//&nbsp;ReadResponse&nbsp;reads&nbsp;and&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;response&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3819861">//&nbsp;The&nbsp;req&nbsp;parameter&nbsp;optionally&nbsp;specifies&nbsp;the&nbsp;Request&nbsp;that&nbsp;corresponds</span><br>
<span class="lineno"></span><span class="comment" id="3819932">//&nbsp;to&nbsp;this&nbsp;Response.&nbsp;If&nbsp;nil,&nbsp;a&nbsp;GET&nbsp;request&nbsp;is&nbsp;assumed.</span><br>
<span class="lineno"></span><span class="comment" id="3819987">//&nbsp;Clients&nbsp;must&nbsp;call&nbsp;resp.Body.Close&nbsp;when&nbsp;finished&nbsp;reading&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3820057">//&nbsp;After&nbsp;that&nbsp;call,&nbsp;clients&nbsp;can&nbsp;inspect&nbsp;resp.Trailer&nbsp;to&nbsp;find&nbsp;key/value</span><br>
<span class="lineno">115</span><span class="comment" id="3820128">//&nbsp;pairs&nbsp;included&nbsp;in&nbsp;the&nbsp;response&nbsp;trailer.</span><br>
<span class="lineno"></span><span class="keyword" id="3820171">func</span>&nbsp;<span class="ident" id="3820176">ReadResponse</span><span class="op" id="3820188">(</span><span class="ident" id="3820189">r</span>&nbsp;<span class="op" id="3820191">*</span><span class="ident" id="3820192"><a href="/net/http/response.go.html#3816679">bufio</a></span><span class="op" id="3820197">.</span><span class="ident" id="3820198">Reader</span><span class="op" id="3820204">,</span>&nbsp;<span class="ident" id="3820206">req</span>&nbsp;<span class="op" id="3820210">*</span><span class="ident" id="3820211"><a href="/net/http/request.go.html#3791418">Request</a></span><span class="op" id="3820218">)</span>&nbsp;<span class="op" id="3820220">(</span><span class="op" id="3820221">*</span><span class="ident" id="3820222"><a href="/net/http/response.go.html#3816973">Response</a></span><span class="op" id="3820230">,</span>&nbsp;<span class="builtintype" id="3820232">error</span><span class="op" id="3820237">)</span>&nbsp;<span class="op" id="3820239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820242">tp</span>&nbsp;<span class="op" id="3820245">:=</span>&nbsp;<span class="ident" id="3820248"><a href="/net/http/response.go.html#3816727">textproto</a></span><span class="op" id="3820257">.</span><span class="ident" id="3820258">NewReader</span><span class="op" id="3820267">(</span><span class="ident" id="3820268"><a href="/net/http/response.go.html#3820189">r</a></span><span class="op" id="3820269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820272">resp</span>&nbsp;<span class="op" id="3820277">:=</span>&nbsp;<span class="op" id="3820280">&amp;</span><span class="ident" id="3820281"><a href="/net/http/response.go.html#3816973">Response</a></span><span class="op" id="3820289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820293">Request</span><span class="op" id="3820300">:</span>&nbsp;<span class="ident" id="3820302"><a href="/net/http/response.go.html#3820206">req</a></span><span class="op" id="3820305">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3820308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3820312">//&nbsp;Parse&nbsp;the&nbsp;first&nbsp;line&nbsp;of&nbsp;the&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820354">line</span><span class="op" id="3820358">,</span>&nbsp;<span class="ident" id="3820360">err</span>&nbsp;<span class="op" id="3820364">:=</span>&nbsp;<span class="ident" id="3820367"><a href="/net/http/response.go.html#3820242">tp</a></span><span class="op" id="3820369">.</span><span class="ident" id="3820370">ReadLine</span><span class="op" id="3820378">(</span><span class="op" id="3820379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820382">if</span>&nbsp;<span class="ident" id="3820385"><a href="/net/http/response.go.html#3820360">err</a></span>&nbsp;<span class="op" id="3820389">!=</span>&nbsp;<span class="ident" id="3820392">nil</span>&nbsp;<span class="op" id="3820396">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820400">if</span>&nbsp;<span class="ident" id="3820403"><a href="/net/http/response.go.html#3820360">err</a></span>&nbsp;<span class="op" id="3820407">==</span>&nbsp;<span class="ident" id="3820410"><a href="/net/http/response.go.html#3816721">io</a></span><span class="op" id="3820412">.</span><span class="ident" id="3820413">EOF</span>&nbsp;<span class="op" id="3820417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820422"><a href="/net/http/response.go.html#3820360">err</a></span>&nbsp;<span class="op" id="3820426">=</span>&nbsp;<span class="ident" id="3820428"><a href="/net/http/response.go.html#3816721">io</a></span><span class="op" id="3820430">.</span><span class="ident" id="3820431">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3820450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820454">return</span>&nbsp;<span class="ident" id="3820461">nil</span><span class="op" id="3820464">,</span>&nbsp;<span class="ident" id="3820466"><a href="/net/http/response.go.html#3820360">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3820471">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820474">f</span>&nbsp;<span class="op" id="3820476">:=</span>&nbsp;<span class="ident" id="3820479"><a href="/net/http/response.go.html#3816766">strings</a></span><span class="op" id="3820486">.</span><span class="ident" id="3820487">SplitN</span><span class="op" id="3820493">(</span><span class="ident" id="3820494"><a href="/net/http/response.go.html#3820354">line</a></span><span class="op" id="3820498">,</span>&nbsp;<span class="string" id="3820500">&#34;&nbsp;&#34;</span><span class="op" id="3820503">,</span>&nbsp;<span class="num" id="3820505">3</span><span class="op" id="3820506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820509">if</span>&nbsp;<span class="builtinfunc" id="3820512">len</span><span class="op" id="3820515">(</span><span class="ident" id="3820516"><a href="/net/http/response.go.html#3820474">f</a></span><span class="op" id="3820517">)</span>&nbsp;<span class="op" id="3820519">&lt;</span>&nbsp;<span class="num" id="3820521">2</span>&nbsp;<span class="op" id="3820523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820527">return</span>&nbsp;<span class="ident" id="3820534">nil</span><span class="op" id="3820537">,</span>&nbsp;<span class="op" id="3820539">&amp;</span><span class="ident" id="3820540"><a href="/net/http/request.go.html#3790712">badStringError</a></span><span class="op" id="3820554">{</span><span class="string" id="3820555">&#34;malformed&nbsp;HTTP&nbsp;response&#34;</span><span class="op" id="3820580">,</span>&nbsp;<span class="ident" id="3820582"><a href="/net/http/response.go.html#3820354">line</a></span><span class="op" id="3820586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3820589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820592">reasonPhrase</span>&nbsp;<span class="op" id="3820605">:=</span>&nbsp;<span class="string" id="3820608">&#34;&#34;</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820612">if</span>&nbsp;<span class="builtinfunc" id="3820615">len</span><span class="op" id="3820618">(</span><span class="ident" id="3820619"><a href="/net/http/response.go.html#3820474">f</a></span><span class="op" id="3820620">)</span>&nbsp;<span class="op" id="3820622">&gt;</span>&nbsp;<span class="num" id="3820624">2</span>&nbsp;<span class="op" id="3820626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820630"><a href="/net/http/response.go.html#3820592">reasonPhrase</a></span>&nbsp;<span class="op" id="3820643">=</span>&nbsp;<span class="ident" id="3820645"><a href="/net/http/response.go.html#3820474">f</a></span><span class="op" id="3820646">[</span><span class="num" id="3820647">2</span><span class="op" id="3820648">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3820651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820654"><a href="/net/http/response.go.html#3820272">resp</a></span><span class="op" id="3820658">.</span><span class="ident" id="3820659">Status</span>&nbsp;<span class="op" id="3820666">=</span>&nbsp;<span class="ident" id="3820668"><a href="/net/http/response.go.html#3820474">f</a></span><span class="op" id="3820669">[</span><span class="num" id="3820670">1</span><span class="op" id="3820671">]</span>&nbsp;<span class="op" id="3820673">+</span>&nbsp;<span class="string" id="3820675">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="3820679">+</span>&nbsp;<span class="ident" id="3820681"><a href="/net/http/response.go.html#3820592">reasonPhrase</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820695"><a href="/net/http/response.go.html#3820272">resp</a></span><span class="op" id="3820699">.</span><span class="ident" id="3820700">StatusCode</span><span class="op" id="3820710">,</span>&nbsp;<span class="ident" id="3820712"><a href="/net/http/response.go.html#3820360">err</a></span>&nbsp;<span class="op" id="3820716">=</span>&nbsp;<span class="ident" id="3820718"><a href="/net/http/response.go.html#3816755">strconv</a></span><span class="op" id="3820725">.</span><span class="ident" id="3820726">Atoi</span><span class="op" id="3820730">(</span><span class="ident" id="3820731"><a href="/net/http/response.go.html#3820474">f</a></span><span class="op" id="3820732">[</span><span class="num" id="3820733">1</span><span class="op" id="3820734">]</span><span class="op" id="3820735">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820738">if</span>&nbsp;<span class="ident" id="3820741"><a href="/net/http/response.go.html#3820360">err</a></span>&nbsp;<span class="op" id="3820745">!=</span>&nbsp;<span class="ident" id="3820748">nil</span>&nbsp;<span class="op" id="3820752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820756">return</span>&nbsp;<span class="ident" id="3820763">nil</span><span class="op" id="3820766">,</span>&nbsp;<span class="op" id="3820768">&amp;</span><span class="ident" id="3820769"><a href="/net/http/request.go.html#3790712">badStringError</a></span><span class="op" id="3820783">{</span><span class="string" id="3820784">&#34;malformed&nbsp;HTTP&nbsp;status&nbsp;code&#34;</span><span class="op" id="3820812">,</span>&nbsp;<span class="ident" id="3820814"><a href="/net/http/response.go.html#3820474">f</a></span><span class="op" id="3820815">[</span><span class="num" id="3820816">1</span><span class="op" id="3820817">]</span><span class="op" id="3820818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3820821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3820825"><a href="/net/http/response.go.html#3820272">resp</a></span><span class="op" id="3820829">.</span><span class="ident" id="3820830">Proto</span>&nbsp;<span class="op" id="3820836">=</span>&nbsp;<span class="ident" id="3820838"><a href="/net/http/response.go.html#3820474">f</a></span><span class="op" id="3820839">[</span><span class="num" id="3820840">0</span><span class="op" id="3820841">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820844">var</span>&nbsp;<span class="ident" id="3820848">ok</span>&nbsp;<span class="builtintype" id="3820851">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820857">if</span>&nbsp;<span class="ident" id="3820860"><a href="/net/http/response.go.html#3820272">resp</a></span><span class="op" id="3820864">.</span><span class="ident" id="3820865">ProtoMajor</span><span class="op" id="3820875">,</span>&nbsp;<span class="ident" id="3820877"><a href="/net/http/response.go.html#3820272">resp</a></span><span class="op" id="3820881">.</span><span class="ident" id="3820882">ProtoMinor</span><span class="op" id="3820892">,</span>&nbsp;<span class="ident" id="3820894"><a href="/net/http/response.go.html#3820848">ok</a></span>&nbsp;<span class="op" id="3820897">=</span>&nbsp;<span class="ident" id="3820899"><a href="/net/http/request.go.html#3804141">ParseHTTPVersion</a></span><span class="op" id="3820915">(</span><span class="ident" id="3820916"><a href="/net/http/response.go.html#3820272">resp</a></span><span class="op" id="3820920">.</span><span class="ident" id="3820921">Proto</span><span class="op" id="3820926">)</span><span class="op" id="3820927">;</span>&nbsp;<span class="op" id="3820929">!</span><span class="ident" id="3820930"><a href="/net/http/response.go.html#3820848">ok</a></span>&nbsp;<span class="op" id="3820933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3820937">return</span>&nbsp;<span class="ident" id="3820944">nil</span><span class="op" id="3820947">,</span>&nbsp;<span class="op" id="3820949">&amp;</span><span class="ident" id="3820950"><a href="/net/http/request.go.html#3790712">badStringError</a></span><span class="op" id="3820964">{</span><span class="string" id="3820965">&#34;malformed&nbsp;HTTP&nbsp;version&#34;</span><span class="op" id="3820989">,</span>&nbsp;<span class="ident" id="3820991"><a href="/net/http/response.go.html#3820272">resp</a></span><span class="op" id="3820995">.</span><span class="ident" id="3820996">Proto</span><span class="op" id="3821001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3821004">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3821008">//&nbsp;Parse&nbsp;the&nbsp;response&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3821040">mimeHeader</span><span class="op" id="3821050">,</span>&nbsp;<span class="ident" id="3821052"><a href="/net/http/response.go.html#3820360">err</a></span>&nbsp;<span class="op" id="3821056">:=</span>&nbsp;<span class="ident" id="3821059"><a href="/net/http/response.go.html#3820242">tp</a></span><span class="op" id="3821061">.</span><span class="ident" id="3821062">ReadMIMEHeader</span><span class="op" id="3821076">(</span><span class="op" id="3821077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3821080">if</span>&nbsp;<span class="ident" id="3821083"><a href="/net/http/response.go.html#3820360">err</a></span>&nbsp;<span class="op" id="3821087">!=</span>&nbsp;<span class="ident" id="3821090">nil</span>&nbsp;<span class="op" id="3821094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3821098">if</span>&nbsp;<span class="ident" id="3821101"><a href="/net/http/response.go.html#3820360">err</a></span>&nbsp;<span class="op" id="3821105">==</span>&nbsp;<span class="ident" id="3821108"><a href="/net/http/response.go.html#3816721">io</a></span><span class="op" id="3821110">.</span><span class="ident" id="3821111">EOF</span>&nbsp;<span class="op" id="3821115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3821120"><a href="/net/http/response.go.html#3820360">err</a></span>&nbsp;<span class="op" id="3821124">=</span>&nbsp;<span class="ident" id="3821126"><a href="/net/http/response.go.html#3816721">io</a></span><span class="op" id="3821128">.</span><span class="ident" id="3821129">ErrUnexpectedEOF</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3821148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3821152">return</span>&nbsp;<span class="ident" id="3821159">nil</span><span class="op" id="3821162">,</span>&nbsp;<span class="ident" id="3821164"><a href="/net/http/response.go.html#3820360">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3821169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3821172"><a href="/net/http/response.go.html#3820272">resp</a></span><span class="op" id="3821176">.</span><span class="ident" id="3821177">Header</span>&nbsp;<span class="op" id="3821184">=</span>&nbsp;<span class="ident" id="3821186"><a href="/net/http/header.go.html#3781581">Header</a></span><span class="op" id="3821192">(</span><span class="ident" id="3821193"><a href="/net/http/response.go.html#3821040">mimeHeader</a></span><span class="op" id="3821203">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3821207"><a href="/net/http/response.go.html#3821417">fixPragmaCacheControl</a></span><span class="op" id="3821228">(</span><span class="ident" id="3821229"><a href="/net/http/response.go.html#3820272">resp</a></span><span class="op" id="3821233">.</span><span class="ident" id="3821234">Header</span><span class="op" id="3821240">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3821244"><a href="/net/http/response.go.html#3820360">err</a></span>&nbsp;<span class="op" id="3821248">=</span>&nbsp;<span class="ident" id="3821250"><a href="/net/http/transfer.go.html#3903260">readTransfer</a></span><span class="op" id="3821262">(</span><span class="ident" id="3821263"><a href="/net/http/response.go.html#3820272">resp</a></span><span class="op" id="3821267">,</span>&nbsp;<span class="ident" id="3821269"><a href="/net/http/response.go.html#3820189">r</a></span><span class="op" id="3821270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3821273">if</span>&nbsp;<span class="ident" id="3821276"><a href="/net/http/response.go.html#3820360">err</a></span>&nbsp;<span class="op" id="3821280">!=</span>&nbsp;<span class="ident" id="3821283">nil</span>&nbsp;<span class="op" id="3821287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3821291">return</span>&nbsp;<span class="ident" id="3821298">nil</span><span class="op" id="3821301">,</span>&nbsp;<span class="ident" id="3821303"><a href="/net/http/response.go.html#3820360">err</a></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3821308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3821312">return</span>&nbsp;<span class="ident" id="3821319"><a href="/net/http/response.go.html#3820272">resp</a></span><span class="op" id="3821323">,</span>&nbsp;<span class="ident" id="3821325">nil</span><br>
<span class="lineno"></span><span class="op" id="3821329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="3821332">//&nbsp;RFC2616:&nbsp;Should&nbsp;treat</span><br>
<span class="lineno"></span><span class="comment" id="3821357">//&nbsp;&nbsp;&nbsp;&nbspPragma:&nbsp;no-cache</span><br>
<span class="lineno"></span><span class="comment" id="3821377">//&nbsp;like</span><br>
<span class="lineno"></span><span class="comment" id="3821385">//&nbsp;&nbsp;&nbsp;&nbspCache-Control:&nbsp;no-cache</span><br>
<span class="lineno"></span><span class="keyword" id="3821412">func</span>&nbsp;<span class="ident" id="3821417">fixPragmaCacheControl</span><span class="op" id="3821438">(</span><span class="ident" id="3821439">header</span>&nbsp;<span class="ident" id="3821446"><a href="/net/http/header.go.html#3781581">Header</a></span><span class="op" id="3821452">)</span>&nbsp;<span class="op" id="3821454">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3821457">if</span>&nbsp;<span class="ident" id="3821460">hp</span><span class="op" id="3821462">,</span>&nbsp;<span class="ident" id="3821464">ok</span>&nbsp;<span class="op" id="3821467">:=</span>&nbsp;<span class="ident" id="3821470"><a href="/net/http/response.go.html#3821439">header</a></span><span class="op" id="3821476">[</span><span class="string" id="3821477">&#34;Pragma&#34;</span><span class="op" id="3821485">]</span><span class="op" id="3821486">;</span>&nbsp;<span class="ident" id="3821488"><a href="/net/http/response.go.html#3821464">ok</a></span>&nbsp;<span class="op" id="3821491">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3821494">len</span><span class="op" id="3821497">(</span><span class="ident" id="3821498"><a href="/net/http/response.go.html#3821460">hp</a></span><span class="op" id="3821500">)</span>&nbsp;<span class="op" id="3821502">&gt;</span>&nbsp;<span class="num" id="3821504">0</span>&nbsp;<span class="op" id="3821506">&amp;&amp;</span>&nbsp;<span class="ident" id="3821509"><a href="/net/http/response.go.html#3821460">hp</a></span><span class="op" id="3821511">[</span><span class="num" id="3821512">0</span><span class="op" id="3821513">]</span>&nbsp;<span class="op" id="3821515">==</span>&nbsp;<span class="string" id="3821518">&#34;no-cache&#34;</span>&nbsp;<span class="op" id="3821529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3821533">if</span>&nbsp;<span class="ident" id="3821536">_</span><span class="op" id="3821537">,</span>&nbsp;<span class="ident" id="3821539">presentcc</span>&nbsp;<span class="op" id="3821549">:=</span>&nbsp;<span class="ident" id="3821552"><a href="/net/http/response.go.html#3821439">header</a></span><span class="op" id="3821558">[</span><span class="string" id="3821559">&#34;Cache-Control&#34;</span><span class="op" id="3821574">]</span><span class="op" id="3821575">;</span>&nbsp;<span class="op" id="3821577">!</span><span class="ident" id="3821578"><a href="/net/http/response.go.html#3821539">presentcc</a></span>&nbsp;<span class="op" id="3821588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3821593"><a href="/net/http/response.go.html#3821439">header</a></span><span class="op" id="3821599">[</span><span class="string" id="3821600">&#34;Cache-Control&#34;</span><span class="op" id="3821615">]</span>&nbsp;<span class="op" id="3821617">=</span>&nbsp;<span class="op" id="3821619">[</span><span class="op" id="3821620">]</span><span class="builtintype" id="3821621">string</span><span class="op" id="3821627">{</span><span class="string" id="3821628">&#34;no-cache&#34;</span><span class="op" id="3821638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3821642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3821645">}</span><br>
<span class="lineno">180</span><span class="op" id="3821647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3821650">//&nbsp;ProtoAtLeast&nbsp;reports&nbsp;whether&nbsp;the&nbsp;HTTP&nbsp;protocol&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3821705">//&nbsp;in&nbsp;the&nbsp;response&nbsp;is&nbsp;at&nbsp;least&nbsp;major.minor.</span><br>
<span class="lineno"></span><span class="keyword" id="3821749">func</span>&nbsp;<span class="op" id="3821754">(</span><span class="ident" id="3821755">r</span>&nbsp;<span class="op" id="3821757">*</span><span class="ident" id="3821758"><a href="/net/http/response.go.html#3816973">Response</a></span><span class="op" id="3821766">)</span>&nbsp;<span class="ident" id="3821768">ProtoAtLeast</span><span class="op" id="3821780">(</span><span class="ident" id="3821781">major</span><span class="op" id="3821786">,</span>&nbsp;<span class="ident" id="3821788">minor</span>&nbsp;<span class="builtintype" id="3821794">int</span><span class="op" id="3821797">)</span>&nbsp;<span class="builtintype" id="3821799">bool</span>&nbsp;<span class="op" id="3821804">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3821807">return</span>&nbsp;<span class="ident" id="3821814"><a href="/net/http/response.go.html#3821755">r</a></span><span class="op" id="3821815">.</span><span class="ident" id="3821816">ProtoMajor</span>&nbsp;<span class="op" id="3821827">&gt;</span>&nbsp;<span class="ident" id="3821829"><a href="/net/http/response.go.html#3821781">major</a></span>&nbsp;<span class="op" id="3821835">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3821840"><a href="/net/http/response.go.html#3821755">r</a></span><span class="op" id="3821841">.</span><span class="ident" id="3821842">ProtoMajor</span>&nbsp;<span class="op" id="3821853">==</span>&nbsp;<span class="ident" id="3821856"><a href="/net/http/response.go.html#3821781">major</a></span>&nbsp;<span class="op" id="3821862">&amp;&amp;</span>&nbsp;<span class="ident" id="3821865"><a href="/net/http/response.go.html#3821755">r</a></span><span class="op" id="3821866">.</span><span class="ident" id="3821867">ProtoMinor</span>&nbsp;<span class="op" id="3821878">&gt;=</span>&nbsp;<span class="ident" id="3821881"><a href="/net/http/response.go.html#3821788">minor</a></span><br>
<span class="lineno"></span><span class="op" id="3821887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3821890">//&nbsp;Writes&nbsp;the&nbsp;response&nbsp;(header,&nbsp;body&nbsp;and&nbsp;trailer)&nbsp;in&nbsp;wire&nbsp;format.&nbsp;This&nbsp;method</span><br>
<span class="lineno">190</span><span class="comment" id="3821968">//&nbsp;consults&nbsp;the&nbsp;following&nbsp;fields&nbsp;of&nbsp;the&nbsp;response:</span><br>
<span class="lineno"></span><span class="comment" id="3822018">//</span><br>
<span class="lineno"></span><span class="comment" id="3822021">//&nbsp;&nbsp;StatusCode</span><br>
<span class="lineno"></span><span class="comment" id="3822036">//&nbsp;&nbsp;ProtoMajor</span><br>
<span class="lineno"></span><span class="comment" id="3822051">//&nbsp;&nbsp;ProtoMinor</span><br>
<span class="lineno">195</span><span class="comment" id="3822066">//&nbsp;&nbsp;Request.Method</span><br>
<span class="lineno"></span><span class="comment" id="3822085">//&nbsp;&nbsp;TransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="3822106">//&nbsp;&nbsp;Trailer</span><br>
<span class="lineno"></span><span class="comment" id="3822118">//&nbsp;&nbsp;Body</span><br>
<span class="lineno"></span><span class="comment" id="3822127">//&nbsp;&nbsp;ContentLength</span><br>
<span class="lineno">200</span><span class="comment" id="3822145">//&nbsp;&nbsp;Header,&nbsp;values&nbsp;for&nbsp;non-canonical&nbsp;keys&nbsp;will&nbsp;have&nbsp;unpredictable&nbsp;behavior</span><br>
<span class="lineno"></span><span class="comment" id="3822220">//</span><br>
<span class="lineno"></span><span class="comment" id="3822223">//&nbsp;Body&nbsp;is&nbsp;closed&nbsp;after&nbsp;it&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="3822259">func</span>&nbsp;<span class="op" id="3822264">(</span><span class="ident" id="3822265">r</span>&nbsp;<span class="op" id="3822267">*</span><span class="ident" id="3822268"><a href="/net/http/response.go.html#3816973">Response</a></span><span class="op" id="3822276">)</span>&nbsp;<span class="ident" id="3822278">Write</span><span class="op" id="3822283">(</span><span class="ident" id="3822284">w</span>&nbsp;<span class="ident" id="3822286"><a href="/net/http/response.go.html#3816721">io</a></span><span class="op" id="3822288">.</span><span class="ident" id="3822289">Writer</span><span class="op" id="3822295">)</span>&nbsp;<span class="builtintype" id="3822297">error</span>&nbsp;<span class="op" id="3822303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3822306">//&nbsp;Status&nbsp;line</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3822322">text</span>&nbsp;<span class="op" id="3822327">:=</span>&nbsp;<span class="ident" id="3822330"><a href="/net/http/response.go.html#3822265">r</a></span><span class="op" id="3822331">.</span><span class="ident" id="3822332">Status</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3822340">if</span>&nbsp;<span class="ident" id="3822343"><a href="/net/http/response.go.html#3822322">text</a></span>&nbsp;<span class="op" id="3822348">==</span>&nbsp;<span class="string" id="3822351">&#34;&#34;</span>&nbsp;<span class="op" id="3822354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3822358">var</span>&nbsp;<span class="ident" id="3822362">ok</span>&nbsp;<span class="builtintype" id="3822365">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3822372"><a href="/net/http/response.go.html#3822322">text</a></span><span class="op" id="3822376">,</span>&nbsp;<span class="ident" id="3822378"><a href="/net/http/response.go.html#3822362">ok</a></span>&nbsp;<span class="op" id="3822381">=</span>&nbsp;<span class="ident" id="3822383"><a href="/net/http/status.go.html#3893462">statusText</a></span><span class="op" id="3822393">[</span><span class="ident" id="3822394"><a href="/net/http/response.go.html#3822265">r</a></span><span class="op" id="3822395">.</span><span class="ident" id="3822396">StatusCode</span><span class="op" id="3822406">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3822410">if</span>&nbsp;<span class="op" id="3822413">!</span><span class="ident" id="3822414"><a href="/net/http/response.go.html#3822362">ok</a></span>&nbsp;<span class="op" id="3822417">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3822422"><a href="/net/http/response.go.html#3822322">text</a></span>&nbsp;<span class="op" id="3822427">=</span>&nbsp;<span class="string" id="3822429">&#34;status&nbsp;code&nbsp;&#34;</span>&nbsp;<span class="op" id="3822444">+</span>&nbsp;<span class="ident" id="3822446"><a href="/net/http/response.go.html#3816755">strconv</a></span><span class="op" id="3822453">.</span><span class="ident" id="3822454">Itoa</span><span class="op" id="3822458">(</span><span class="ident" id="3822459"><a href="/net/http/response.go.html#3822265">r</a></span><span class="op" id="3822460">.</span><span class="ident" id="3822461">StatusCode</span><span class="op" id="3822471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3822475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3822478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3822481">protoMajor</span><span class="op" id="3822491">,</span>&nbsp;<span class="ident" id="3822493">protoMinor</span>&nbsp;<span class="op" id="3822504">:=</span>&nbsp;<span class="ident" id="3822507"><a href="/net/http/response.go.html#3816755">strconv</a></span><span class="op" id="3822514">.</span><span class="ident" id="3822515">Itoa</span><span class="op" id="3822519">(</span><span class="ident" id="3822520"><a href="/net/http/response.go.html#3822265">r</a></span><span class="op" id="3822521">.</span><span class="ident" id="3822522">ProtoMajor</span><span class="op" id="3822532">)</span><span class="op" id="3822533">,</span>&nbsp;<span class="ident" id="3822535"><a href="/net/http/response.go.html#3816755">strconv</a></span><span class="op" id="3822542">.</span><span class="ident" id="3822543">Itoa</span><span class="op" id="3822547">(</span><span class="ident" id="3822548"><a href="/net/http/response.go.html#3822265">r</a></span><span class="op" id="3822549">.</span><span class="ident" id="3822550">ProtoMinor</span><span class="op" id="3822560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3822563">statusCode</span>&nbsp;<span class="op" id="3822574">:=</span>&nbsp;<span class="ident" id="3822577"><a href="/net/http/response.go.html#3816755">strconv</a></span><span class="op" id="3822584">.</span><span class="ident" id="3822585">Itoa</span><span class="op" id="3822589">(</span><span class="ident" id="3822590"><a href="/net/http/response.go.html#3822265">r</a></span><span class="op" id="3822591">.</span><span class="ident" id="3822592">StatusCode</span><span class="op" id="3822602">)</span>&nbsp;<span class="op" id="3822604">+</span>&nbsp;<span class="string" id="3822606">&#34;&nbsp;&#34;</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3822611"><a href="/net/http/response.go.html#3822322">text</a></span>&nbsp;<span class="op" id="3822616">=</span>&nbsp;<span class="ident" id="3822618"><a href="/net/http/response.go.html#3816766">strings</a></span><span class="op" id="3822625">.</span><span class="ident" id="3822626">TrimPrefix</span><span class="op" id="3822636">(</span><span class="ident" id="3822637"><a href="/net/http/response.go.html#3822322">text</a></span><span class="op" id="3822641">,</span>&nbsp;<span class="ident" id="3822643"><a href="/net/http/response.go.html#3822563">statusCode</a></span><span class="op" id="3822653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3822656">if</span>&nbsp;<span class="ident" id="3822659">_</span><span class="op" id="3822660">,</span>&nbsp;<span class="ident" id="3822662">err</span>&nbsp;<span class="op" id="3822666">:=</span>&nbsp;<span class="ident" id="3822669"><a href="/net/http/response.go.html#3816721">io</a></span><span class="op" id="3822671">.</span><span class="ident" id="3822672">WriteString</span><span class="op" id="3822683">(</span><span class="ident" id="3822684"><a href="/net/http/response.go.html#3822284">w</a></span><span class="op" id="3822685">,</span>&nbsp;<span class="string" id="3822687">&#34;HTTP/&#34;</span><span class="op" id="3822694">+</span><span class="ident" id="3822695"><a href="/net/http/response.go.html#3822481">protoMajor</a></span><span class="op" id="3822705">+</span><span class="string" id="3822706">&#34;.&#34;</span><span class="op" id="3822709">+</span><span class="ident" id="3822710"><a href="/net/http/response.go.html#3822493">protoMinor</a></span><span class="op" id="3822720">+</span><span class="string" id="3822721">&#34;&nbsp;&#34;</span><span class="op" id="3822724">+</span><span class="ident" id="3822725"><a href="/net/http/response.go.html#3822563">statusCode</a></span><span class="op" id="3822735">+</span><span class="ident" id="3822736"><a href="/net/http/response.go.html#3822322">text</a></span><span class="op" id="3822740">+</span><span class="string" id="3822741">&#34;\r\n&#34;</span><span class="op" id="3822747">)</span><span class="op" id="3822748">;</span>&nbsp;<span class="ident" id="3822750"><a href="/net/http/response.go.html#3822662">err</a></span>&nbsp;<span class="op" id="3822754">!=</span>&nbsp;<span class="ident" id="3822757">nil</span>&nbsp;<span class="op" id="3822761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3822765">return</span>&nbsp;<span class="ident" id="3822772"><a href="/net/http/response.go.html#3822662">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3822777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3822781">//&nbsp;Clone&nbsp;it,&nbsp;so&nbsp;we&nbsp;can&nbsp;modify&nbsp;r1&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3822826">r1</span>&nbsp;<span class="op" id="3822829">:=</span>&nbsp;<span class="builtinfunc" id="3822832">new</span><span class="op" id="3822835">(</span><span class="ident" id="3822836"><a href="/net/http/response.go.html#3816973">Response</a></span><span class="op" id="3822844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3822847">*</span><span class="ident" id="3822848"><a href="/net/http/response.go.html#3822826">r1</a></span>&nbsp;<span class="op" id="3822851">=</span>&nbsp;<span class="op" id="3822853">*</span><span class="ident" id="3822854"><a href="/net/http/response.go.html#3822265">r</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3822857">if</span>&nbsp;<span class="ident" id="3822860"><a href="/net/http/response.go.html#3822826">r1</a></span><span class="op" id="3822862">.</span><span class="ident" id="3822863">ContentLength</span>&nbsp;<span class="op" id="3822877">==</span>&nbsp;<span class="num" id="3822880">0</span>&nbsp;<span class="op" id="3822882">&amp;&amp;</span>&nbsp;<span class="ident" id="3822885"><a href="/net/http/response.go.html#3822826">r1</a></span><span class="op" id="3822887">.</span><span class="ident" id="3822888">Body</span>&nbsp;<span class="op" id="3822893">!=</span>&nbsp;<span class="ident" id="3822896">nil</span>&nbsp;<span class="op" id="3822900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3822904">//&nbsp;Is&nbsp;it&nbsp;actually&nbsp;0&nbsp;length?&nbsp;Or&nbsp;just&nbsp;unknown?</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3822951">var</span>&nbsp;<span class="ident" id="3822955">buf</span>&nbsp;<span class="op" id="3822959">[</span><span class="num" id="3822960">1</span><span class="op" id="3822961">]</span><span class="builtintype" id="3822962">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3822969">n</span><span class="op" id="3822970">,</span>&nbsp;<span class="ident" id="3822972">err</span>&nbsp;<span class="op" id="3822976">:=</span>&nbsp;<span class="ident" id="3822979"><a href="/net/http/response.go.html#3822826">r1</a></span><span class="op" id="3822981">.</span><span class="ident" id="3822982">Body</span><span class="op" id="3822986">.</span><span class="ident" id="3822987">Read</span><span class="op" id="3822991">(</span><span class="ident" id="3822992"><a href="/net/http/response.go.html#3822955">buf</a></span><span class="op" id="3822995">[</span><span class="op" id="3822996">:</span><span class="op" id="3822997">]</span><span class="op" id="3822998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3823002">if</span>&nbsp;<span class="ident" id="3823005"><a href="/net/http/response.go.html#3822972">err</a></span>&nbsp;<span class="op" id="3823009">!=</span>&nbsp;<span class="ident" id="3823012">nil</span>&nbsp;<span class="op" id="3823016">&amp;&amp;</span>&nbsp;<span class="ident" id="3823019"><a href="/net/http/response.go.html#3822972">err</a></span>&nbsp;<span class="op" id="3823023">!=</span>&nbsp;<span class="ident" id="3823026"><a href="/net/http/response.go.html#3816721">io</a></span><span class="op" id="3823028">.</span><span class="ident" id="3823029">EOF</span>&nbsp;<span class="op" id="3823033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3823038">return</span>&nbsp;<span class="ident" id="3823045"><a href="/net/http/response.go.html#3822972">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3823051">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3823055">if</span>&nbsp;<span class="ident" id="3823058"><a href="/net/http/response.go.html#3822969">n</a></span>&nbsp;<span class="op" id="3823060">==</span>&nbsp;<span class="num" id="3823063">0</span>&nbsp;<span class="op" id="3823065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3823070">//&nbsp;Reset&nbsp;it&nbsp;to&nbsp;a&nbsp;known&nbsp;zero&nbsp;reader,&nbsp;in&nbsp;case&nbsp;underlying&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3823132">//&nbsp;is&nbsp;unhappy&nbsp;being&nbsp;read&nbsp;repeatedly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3823172"><a href="/net/http/response.go.html#3822826">r1</a></span><span class="op" id="3823174">.</span><span class="ident" id="3823175">Body</span>&nbsp;<span class="op" id="3823180">=</span>&nbsp;<span class="ident" id="3823182"><a href="/net/http/server.go.html#3883891">eofReader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3823194">}</span>&nbsp;<span class="keyword" id="3823196">else</span>&nbsp;<span class="op" id="3823201">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3823206"><a href="/net/http/response.go.html#3822826">r1</a></span><span class="op" id="3823208">.</span><span class="ident" id="3823209">ContentLength</span>&nbsp;<span class="op" id="3823223">=</span>&nbsp;<span class="op" id="3823225">-</span><span class="num" id="3823226">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3823231"><a href="/net/http/response.go.html#3822826">r1</a></span><span class="op" id="3823233">.</span><span class="ident" id="3823234">Body</span>&nbsp;<span class="op" id="3823239">=</span>&nbsp;<span class="keyword" id="3823241">struct</span>&nbsp;<span class="op" id="3823248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3823254"><a href="/net/http/response.go.html#3816721">io</a></span><span class="op" id="3823256">.</span><span class="ident" id="3823257">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3823268"><a href="/net/http/response.go.html#3816721">io</a></span><span class="op" id="3823270">.</span><span class="ident" id="3823271">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3823281">}</span><span class="op" id="3823282">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3823288"><a href="/net/http/response.go.html#3816721">io</a></span><span class="op" id="3823290">.</span><span class="ident" id="3823291">MultiReader</span><span class="op" id="3823302">(</span><span class="ident" id="3823303"><a href="/net/http/response.go.html#3816688">bytes</a></span><span class="op" id="3823308">.</span><span class="ident" id="3823309">NewReader</span><span class="op" id="3823318">(</span><span class="ident" id="3823319"><a href="/net/http/response.go.html#3822955">buf</a></span><span class="op" id="3823322">[</span><span class="op" id="3823323">:</span><span class="num" id="3823324">1</span><span class="op" id="3823325">]</span><span class="op" id="3823326">)</span><span class="op" id="3823327">,</span>&nbsp;<span class="ident" id="3823329"><a href="/net/http/response.go.html#3822265">r</a></span><span class="op" id="3823330">.</span><span class="ident" id="3823331">Body</span><span class="op" id="3823335">)</span><span class="op" id="3823336">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3823342"><a href="/net/http/response.go.html#3822265">r</a></span><span class="op" id="3823343">.</span><span class="ident" id="3823344">Body</span><span class="op" id="3823348">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3823353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3823357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3823360">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3823363">//&nbsp;If&nbsp;we&#39;re&nbsp;sending&nbsp;a&nbsp;non-chunked&nbsp;HTTP/1.1&nbsp;response&nbsp;without&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3823426">//&nbsp;content-length,&nbsp;the&nbsp;only&nbsp;way&nbsp;to&nbsp;do&nbsp;that&nbsp;is&nbsp;the&nbsp;old&nbsp;HTTP/1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3823490">//&nbsp;way,&nbsp;by&nbsp;noting&nbsp;the&nbsp;EOF&nbsp;with&nbsp;a&nbsp;connection&nbsp;close,&nbsp;so&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3823553">//&nbsp;to&nbsp;set&nbsp;Close.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3823571">if</span>&nbsp;<span class="ident" id="3823574"><a href="/net/http/response.go.html#3822826">r1</a></span><span class="op" id="3823576">.</span><span class="ident" id="3823577">ContentLength</span>&nbsp;<span class="op" id="3823591">==</span>&nbsp;<span class="op" id="3823594">-</span><span class="num" id="3823595">1</span>&nbsp;<span class="op" id="3823597">&amp;&amp;</span>&nbsp;<span class="op" id="3823600">!</span><span class="ident" id="3823601"><a href="/net/http/response.go.html#3822826">r1</a></span><span class="op" id="3823603">.</span><span class="ident" id="3823604">Close</span>&nbsp;<span class="op" id="3823610">&amp;&amp;</span>&nbsp;<span class="ident" id="3823613"><a href="/net/http/response.go.html#3822826">r1</a></span><span class="op" id="3823615">.</span><span class="ident" id="3823616">ProtoAtLeast</span><span class="op" id="3823628">(</span><span class="num" id="3823629">1</span><span class="op" id="3823630">,</span>&nbsp;<span class="num" id="3823632">1</span><span class="op" id="3823633">)</span>&nbsp;<span class="op" id="3823635">&amp;&amp;</span>&nbsp;<span class="op" id="3823638">!</span><span class="ident" id="3823639"><a href="/net/http/transfer.go.html#3906289">chunked</a></span><span class="op" id="3823646">(</span><span class="ident" id="3823647"><a href="/net/http/response.go.html#3822826">r1</a></span><span class="op" id="3823649">.</span><span class="ident" id="3823650">TransferEncoding</span><span class="op" id="3823666">)</span>&nbsp;<span class="op" id="3823668">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3823672"><a href="/net/http/response.go.html#3822826">r1</a></span><span class="op" id="3823674">.</span><span class="ident" id="3823675">Close</span>&nbsp;<span class="op" id="3823681">=</span>&nbsp;<span class="ident" id="3823683">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3823689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3823693">//&nbsp;Process&nbsp;Body,ContentLength,Close,Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3823738">tw</span><span class="op" id="3823740">,</span>&nbsp;<span class="ident" id="3823742">err</span>&nbsp;<span class="op" id="3823746">:=</span>&nbsp;<span class="ident" id="3823749"><a href="/net/http/transfer.go.html#3897137">newTransferWriter</a></span><span class="op" id="3823766">(</span><span class="ident" id="3823767"><a href="/net/http/response.go.html#3822826">r1</a></span><span class="op" id="3823769">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3823772">if</span>&nbsp;<span class="ident" id="3823775"><a href="/net/http/response.go.html#3823742">err</a></span>&nbsp;<span class="op" id="3823779">!=</span>&nbsp;<span class="ident" id="3823782">nil</span>&nbsp;<span class="op" id="3823786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3823790">return</span>&nbsp;<span class="ident" id="3823797"><a href="/net/http/response.go.html#3823742">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3823802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3823805"><a href="/net/http/response.go.html#3823742">err</a></span>&nbsp;<span class="op" id="3823809">=</span>&nbsp;<span class="ident" id="3823811"><a href="/net/http/response.go.html#3823738">tw</a></span><span class="op" id="3823813">.</span><span class="ident" id="3823814">WriteHeader</span><span class="op" id="3823825">(</span><span class="ident" id="3823826"><a href="/net/http/response.go.html#3822284">w</a></span><span class="op" id="3823827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3823830">if</span>&nbsp;<span class="ident" id="3823833"><a href="/net/http/response.go.html#3823742">err</a></span>&nbsp;<span class="op" id="3823837">!=</span>&nbsp;<span class="ident" id="3823840">nil</span>&nbsp;<span class="op" id="3823844">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3823848">return</span>&nbsp;<span class="ident" id="3823855"><a href="/net/http/response.go.html#3823742">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3823860">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3823864">//&nbsp;Rest&nbsp;of&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3823883"><a href="/net/http/response.go.html#3823742">err</a></span>&nbsp;<span class="op" id="3823887">=</span>&nbsp;<span class="ident" id="3823889"><a href="/net/http/response.go.html#3822265">r</a></span><span class="op" id="3823890">.</span><span class="ident" id="3823891">Header</span><span class="op" id="3823897">.</span><span class="ident" id="3823898">WriteSubset</span><span class="op" id="3823909">(</span><span class="ident" id="3823910"><a href="/net/http/response.go.html#3822284">w</a></span><span class="op" id="3823911">,</span>&nbsp;<span class="ident" id="3823913"><a href="/net/http/response.go.html#3816783">respExcludeHeader</a></span><span class="op" id="3823930">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3823933">if</span>&nbsp;<span class="ident" id="3823936"><a href="/net/http/response.go.html#3823742">err</a></span>&nbsp;<span class="op" id="3823940">!=</span>&nbsp;<span class="ident" id="3823943">nil</span>&nbsp;<span class="op" id="3823947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3823951">return</span>&nbsp;<span class="ident" id="3823958"><a href="/net/http/response.go.html#3823742">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3823963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3823967">//&nbsp;contentLengthAlreadySent&nbsp;may&nbsp;have&nbsp;been&nbsp;already&nbsp;sent&nbsp;for</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3824027">//&nbsp;POST/PUT&nbsp;requests,&nbsp;even&nbsp;if&nbsp;zero&nbsp;length.&nbsp;See&nbsp;Issue&nbsp;8180.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3824087">contentLengthAlreadySent</span>&nbsp;<span class="op" id="3824112">:=</span>&nbsp;<span class="ident" id="3824115"><a href="/net/http/response.go.html#3823738">tw</a></span><span class="op" id="3824117">.</span><span class="ident" id="3824118">shouldSendContentLength</span><span class="op" id="3824141">(</span><span class="op" id="3824142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3824145">if</span>&nbsp;<span class="ident" id="3824148"><a href="/net/http/response.go.html#3822826">r1</a></span><span class="op" id="3824150">.</span><span class="ident" id="3824151">ContentLength</span>&nbsp;<span class="op" id="3824165">==</span>&nbsp;<span class="num" id="3824168">0</span>&nbsp;<span class="op" id="3824170">&amp;&amp;</span>&nbsp;<span class="op" id="3824173">!</span><span class="ident" id="3824174"><a href="/net/http/transfer.go.html#3906289">chunked</a></span><span class="op" id="3824181">(</span><span class="ident" id="3824182"><a href="/net/http/response.go.html#3822826">r1</a></span><span class="op" id="3824184">.</span><span class="ident" id="3824185">TransferEncoding</span><span class="op" id="3824201">)</span>&nbsp;<span class="op" id="3824203">&amp;&amp;</span>&nbsp;<span class="op" id="3824206">!</span><span class="ident" id="3824207"><a href="/net/http/response.go.html#3824087">contentLengthAlreadySent</a></span>&nbsp;<span class="op" id="3824232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3824236">if</span>&nbsp;<span class="ident" id="3824239">_</span><span class="op" id="3824240">,</span>&nbsp;<span class="ident" id="3824242">err</span>&nbsp;<span class="op" id="3824246">:=</span>&nbsp;<span class="ident" id="3824249"><a href="/net/http/response.go.html#3816721">io</a></span><span class="op" id="3824251">.</span><span class="ident" id="3824252">WriteString</span><span class="op" id="3824263">(</span><span class="ident" id="3824264"><a href="/net/http/response.go.html#3822284">w</a></span><span class="op" id="3824265">,</span>&nbsp;<span class="string" id="3824267">&#34;Content-Length:&nbsp;0\r\n&#34;</span><span class="op" id="3824290">)</span><span class="op" id="3824291">;</span>&nbsp;<span class="ident" id="3824293"><a href="/net/http/response.go.html#3824242">err</a></span>&nbsp;<span class="op" id="3824297">!=</span>&nbsp;<span class="ident" id="3824300">nil</span>&nbsp;<span class="op" id="3824304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3824309">return</span>&nbsp;<span class="ident" id="3824316"><a href="/net/http/response.go.html#3824242">err</a></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3824322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3824325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3824329">//&nbsp;End-of-header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3824347">if</span>&nbsp;<span class="ident" id="3824350">_</span><span class="op" id="3824351">,</span>&nbsp;<span class="ident" id="3824353">err</span>&nbsp;<span class="op" id="3824357">:=</span>&nbsp;<span class="ident" id="3824360"><a href="/net/http/response.go.html#3816721">io</a></span><span class="op" id="3824362">.</span><span class="ident" id="3824363">WriteString</span><span class="op" id="3824374">(</span><span class="ident" id="3824375"><a href="/net/http/response.go.html#3822284">w</a></span><span class="op" id="3824376">,</span>&nbsp;<span class="string" id="3824378">&#34;\r\n&#34;</span><span class="op" id="3824384">)</span><span class="op" id="3824385">;</span>&nbsp;<span class="ident" id="3824387"><a href="/net/http/response.go.html#3824353">err</a></span>&nbsp;<span class="op" id="3824391">!=</span>&nbsp;<span class="ident" id="3824394">nil</span>&nbsp;<span class="op" id="3824398">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3824402">return</span>&nbsp;<span class="ident" id="3824409"><a href="/net/http/response.go.html#3824353">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3824414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3824418">//&nbsp;Write&nbsp;body&nbsp;and&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3824445"><a href="/net/http/response.go.html#3823742">err</a></span>&nbsp;<span class="op" id="3824449">=</span>&nbsp;<span class="ident" id="3824451"><a href="/net/http/response.go.html#3823738">tw</a></span><span class="op" id="3824453">.</span><span class="ident" id="3824454">WriteBody</span><span class="op" id="3824463">(</span><span class="ident" id="3824464"><a href="/net/http/response.go.html#3822284">w</a></span><span class="op" id="3824465">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3824468">if</span>&nbsp;<span class="ident" id="3824471"><a href="/net/http/response.go.html#3823742">err</a></span>&nbsp;<span class="op" id="3824475">!=</span>&nbsp;<span class="ident" id="3824478">nil</span>&nbsp;<span class="op" id="3824482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3824486">return</span>&nbsp;<span class="ident" id="3824493"><a href="/net/http/response.go.html#3823742">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3824498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3824502">//&nbsp;Success</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3824514">return</span>&nbsp;<span class="ident" id="3824521">nil</span><br>
<span class="lineno"></span><span class="op" id="3824525">}</span>
</div>
</body>
</html>
