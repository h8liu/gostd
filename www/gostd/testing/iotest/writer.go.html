<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing/iotest</h2>
<ul>
<li><a href="/gostd/testing/iotest/logger.go.html">logger.go</a></li>
<li><a href="/gostd/testing/iotest/reader.go.html">reader.go</a></li>
<li><a href="/gostd/testing/iotest/writer.go.html">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5796121">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5796176">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5796230">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5796281">package</span>&nbsp;<span class="ident" id="5796289">iotest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5796297">import</span>&nbsp;<span class="string" id="5796304">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5796310">//&nbsp;TruncateWriter&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;that&nbsp;writes&nbsp;to&nbsp;w</span><br>
<span class="lineno">10</span><span class="comment" id="5796362">//&nbsp;but&nbsp;stops&nbsp;silently&nbsp;after&nbsp;n&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="5796399">func</span>&nbsp;<span class="ident" id="5796404">TruncateWriter</span><span class="op" id="5796418">(</span><span class="ident" id="5796419">w</span>&nbsp;<span class="ident" id="5796421">io</span><span class="op" id="5796423">.</span><span class="ident" id="5796424">Writer</span><span class="op" id="5796430">,</span>&nbsp;<span class="ident" id="5796432">n</span>&nbsp;<span class="ident" id="5796434">int64</span><span class="op" id="5796439">)</span>&nbsp;<span class="ident" id="5796441">io</span><span class="op" id="5796443">.</span><span class="ident" id="5796444">Writer</span>&nbsp;<span class="op" id="5796451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5796454">return</span>&nbsp;<span class="op" id="5796461">&amp;</span><span class="ident" id="5796462">truncateWriter</span><span class="op" id="5796476">{</span><span class="ident" id="5796477">w</span><span class="op" id="5796478">,</span>&nbsp;<span class="ident" id="5796480">n</span><span class="op" id="5796481">}</span><br>
<span class="lineno"></span><span class="op" id="5796483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="5796486">type</span>&nbsp;<span class="ident" id="5796491">truncateWriter</span>&nbsp;<span class="keyword" id="5796506">struct</span>&nbsp;<span class="op" id="5796513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5796516">w</span>&nbsp;<span class="ident" id="5796518">io</span><span class="op" id="5796520">.</span><span class="ident" id="5796521">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5796529">n</span>&nbsp;<span class="ident" id="5796531">int64</span><br>
<span class="lineno"></span><span class="op" id="5796537">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="5796540">func</span>&nbsp;<span class="op" id="5796545">(</span><span class="ident" id="5796546">t</span>&nbsp;<span class="op" id="5796548">*</span><span class="ident" id="5796549">truncateWriter</span><span class="op" id="5796563">)</span>&nbsp;<span class="ident" id="5796565">Write</span><span class="op" id="5796570">(</span><span class="ident" id="5796571">p</span>&nbsp;<span class="op" id="5796573">[</span><span class="op" id="5796574">]</span><span class="builtintype" id="5796575">byte</span><span class="op" id="5796579">)</span>&nbsp;<span class="op" id="5796581">(</span><span class="ident" id="5796582">n</span>&nbsp;<span class="builtintype" id="5796584">int</span><span class="op" id="5796587">,</span>&nbsp;<span class="ident" id="5796589">err</span>&nbsp;<span class="builtintype" id="5796593">error</span><span class="op" id="5796598">)</span>&nbsp;<span class="op" id="5796600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5796603">if</span>&nbsp;<span class="ident" id="5796606">t</span><span class="op" id="5796607">.</span><span class="ident" id="5796608">n</span>&nbsp;<span class="op" id="5796610">&lt;=</span>&nbsp;<span class="num" id="5796613">0</span>&nbsp;<span class="op" id="5796615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5796619">return</span>&nbsp;<span class="builtinfunc" id="5796626">len</span><span class="op" id="5796629">(</span><span class="ident" id="5796630">p</span><span class="op" id="5796631">)</span><span class="op" id="5796632">,</span>&nbsp;<span class="ident" id="5796634">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5796639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5796642">//&nbsp;real&nbsp;write</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5796657">n</span>&nbsp;<span class="op" id="5796659">=</span>&nbsp;<span class="builtinfunc" id="5796661">len</span><span class="op" id="5796664">(</span><span class="ident" id="5796665">p</span><span class="op" id="5796666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5796669">if</span>&nbsp;<span class="ident" id="5796672">int64</span><span class="op" id="5796677">(</span><span class="ident" id="5796678">n</span><span class="op" id="5796679">)</span>&nbsp;<span class="op" id="5796681">&gt;</span>&nbsp;<span class="ident" id="5796683">t</span><span class="op" id="5796684">.</span><span class="ident" id="5796685">n</span>&nbsp;<span class="op" id="5796687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5796691">n</span>&nbsp;<span class="op" id="5796693">=</span>&nbsp;<span class="builtintype" id="5796695">int</span><span class="op" id="5796698">(</span><span class="ident" id="5796699">t</span><span class="op" id="5796700">.</span><span class="ident" id="5796701">n</span><span class="op" id="5796702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5796705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5796708">n</span><span class="op" id="5796709">,</span>&nbsp;<span class="ident" id="5796711">err</span>&nbsp;<span class="op" id="5796715">=</span>&nbsp;<span class="ident" id="5796717">t</span><span class="op" id="5796718">.</span><span class="ident" id="5796719">w</span><span class="op" id="5796720">.</span><span class="ident" id="5796721">Write</span><span class="op" id="5796726">(</span><span class="ident" id="5796727">p</span><span class="op" id="5796728">[</span><span class="num" id="5796729">0</span><span class="op" id="5796730">:</span><span class="ident" id="5796731">n</span><span class="op" id="5796732">]</span><span class="op" id="5796733">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5796736">t</span><span class="op" id="5796737">.</span><span class="ident" id="5796738">n</span>&nbsp;<span class="op" id="5796740">-=</span>&nbsp;<span class="ident" id="5796743">int64</span><span class="op" id="5796748">(</span><span class="ident" id="5796749">n</span><span class="op" id="5796750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5796753">if</span>&nbsp;<span class="ident" id="5796756">err</span>&nbsp;<span class="op" id="5796760">==</span>&nbsp;<span class="ident" id="5796763">nil</span>&nbsp;<span class="op" id="5796767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5796771">n</span>&nbsp;<span class="op" id="5796773">=</span>&nbsp;<span class="builtinfunc" id="5796775">len</span><span class="op" id="5796778">(</span><span class="ident" id="5796779">p</span><span class="op" id="5796780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5796783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5796786">return</span><br>
<span class="lineno">35</span><span class="op" id="5796793">}</span>
</div>
</body>
</html>
