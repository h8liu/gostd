<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os/exec</h2>
<ul>
<li><a href="/gostd/os/exec/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/os/exec/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/os/exec/lp_test.go.html">lp_test.go</a></li>
<li><a href="/gostd/os/exec/lp_unix.go.html">lp_unix.go</a></li>
<li><a href="/gostd/os/exec/lp_unix_test.go.html">lp_unix_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6430797">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6430853">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6430907">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6430958">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6431023">package</span>&nbsp;<span class="ident" id="6431031">exec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6431037">import</span>&nbsp;<span class="op" id="6431044">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6431047">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6431060">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6431066">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6431076">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6431079">func</span>&nbsp;<span class="ident" id="6431084">TestLookPathUnixEmptyPath</span><span class="op" id="6431109">(</span><span class="ident" id="6431110">t</span>&nbsp;<span class="op" id="6431112">*</span><span class="ident" id="6431113">testing</span><span class="op" id="6431120">.</span><span class="ident" id="6431121">T</span><span class="op" id="6431122">)</span>&nbsp;<span class="op" id="6431124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431127">tmp</span><span class="op" id="6431130">,</span>&nbsp;<span class="ident" id="6431132">err</span>&nbsp;<span class="op" id="6431136">:=</span>&nbsp;<span class="ident" id="6431139">ioutil</span><span class="op" id="6431145">.</span><span class="ident" id="6431146">TempDir</span><span class="op" id="6431153">(</span><span class="string" id="6431154">&#34;&#34;</span><span class="op" id="6431156">,</span>&nbsp;<span class="string" id="6431158">&#34;TestLookPathUnixEmptyPath&#34;</span><span class="op" id="6431185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431188">if</span>&nbsp;<span class="ident" id="6431191">err</span>&nbsp;<span class="op" id="6431195">!=</span>&nbsp;<span class="ident" id="6431198">nil</span>&nbsp;<span class="op" id="6431202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431206">t</span><span class="op" id="6431207">.</span><span class="ident" id="6431208">Fatal</span><span class="op" id="6431213">(</span><span class="string" id="6431214">&#34;TempDir&nbsp;failed:&nbsp;&#34;</span><span class="op" id="6431232">,</span>&nbsp;<span class="ident" id="6431234">err</span><span class="op" id="6431237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6431240">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431243">defer</span>&nbsp;<span class="ident" id="6431249">os</span><span class="op" id="6431251">.</span><span class="ident" id="6431252">RemoveAll</span><span class="op" id="6431261">(</span><span class="ident" id="6431262">tmp</span><span class="op" id="6431265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431268">wd</span><span class="op" id="6431270">,</span>&nbsp;<span class="ident" id="6431272">err</span>&nbsp;<span class="op" id="6431276">:=</span>&nbsp;<span class="ident" id="6431279">os</span><span class="op" id="6431281">.</span><span class="ident" id="6431282">Getwd</span><span class="op" id="6431287">(</span><span class="op" id="6431288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431291">if</span>&nbsp;<span class="ident" id="6431294">err</span>&nbsp;<span class="op" id="6431298">!=</span>&nbsp;<span class="ident" id="6431301">nil</span>&nbsp;<span class="op" id="6431305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431309">t</span><span class="op" id="6431310">.</span><span class="ident" id="6431311">Fatal</span><span class="op" id="6431316">(</span><span class="string" id="6431317">&#34;Getwd&nbsp;failed:&nbsp;&#34;</span><span class="op" id="6431333">,</span>&nbsp;<span class="ident" id="6431335">err</span><span class="op" id="6431338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6431341">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431344">err</span>&nbsp;<span class="op" id="6431348">=</span>&nbsp;<span class="ident" id="6431350">os</span><span class="op" id="6431352">.</span><span class="ident" id="6431353">Chdir</span><span class="op" id="6431358">(</span><span class="ident" id="6431359">tmp</span><span class="op" id="6431362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431365">if</span>&nbsp;<span class="ident" id="6431368">err</span>&nbsp;<span class="op" id="6431372">!=</span>&nbsp;<span class="ident" id="6431375">nil</span>&nbsp;<span class="op" id="6431379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431383">t</span><span class="op" id="6431384">.</span><span class="ident" id="6431385">Fatal</span><span class="op" id="6431390">(</span><span class="string" id="6431391">&#34;Chdir&nbsp;failed:&nbsp;&#34;</span><span class="op" id="6431407">,</span>&nbsp;<span class="ident" id="6431409">err</span><span class="op" id="6431412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6431415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431418">defer</span>&nbsp;<span class="ident" id="6431424">os</span><span class="op" id="6431426">.</span><span class="ident" id="6431427">Chdir</span><span class="op" id="6431432">(</span><span class="ident" id="6431433">wd</span><span class="op" id="6431435">)</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431439">f</span><span class="op" id="6431440">,</span>&nbsp;<span class="ident" id="6431442">err</span>&nbsp;<span class="op" id="6431446">:=</span>&nbsp;<span class="ident" id="6431449">os</span><span class="op" id="6431451">.</span><span class="ident" id="6431452">OpenFile</span><span class="op" id="6431460">(</span><span class="string" id="6431461">&#34;exec_me&#34;</span><span class="op" id="6431470">,</span>&nbsp;<span class="ident" id="6431472">os</span><span class="op" id="6431474">.</span><span class="ident" id="6431475">O_CREATE</span><span class="op" id="6431483">|</span><span class="ident" id="6431484">os</span><span class="op" id="6431486">.</span><span class="ident" id="6431487">O_EXCL</span><span class="op" id="6431493">,</span>&nbsp;<span class="num" id="6431495">0700</span><span class="op" id="6431499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431502">if</span>&nbsp;<span class="ident" id="6431505">err</span>&nbsp;<span class="op" id="6431509">!=</span>&nbsp;<span class="ident" id="6431512">nil</span>&nbsp;<span class="op" id="6431516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431520">t</span><span class="op" id="6431521">.</span><span class="ident" id="6431522">Fatal</span><span class="op" id="6431527">(</span><span class="string" id="6431528">&#34;OpenFile&nbsp;failed:&nbsp;&#34;</span><span class="op" id="6431547">,</span>&nbsp;<span class="ident" id="6431549">err</span><span class="op" id="6431552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6431555">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431558">err</span>&nbsp;<span class="op" id="6431562">=</span>&nbsp;<span class="ident" id="6431564">f</span><span class="op" id="6431565">.</span><span class="ident" id="6431566">Close</span><span class="op" id="6431571">(</span><span class="op" id="6431572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431575">if</span>&nbsp;<span class="ident" id="6431578">err</span>&nbsp;<span class="op" id="6431582">!=</span>&nbsp;<span class="ident" id="6431585">nil</span>&nbsp;<span class="op" id="6431589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431593">t</span><span class="op" id="6431594">.</span><span class="ident" id="6431595">Fatal</span><span class="op" id="6431600">(</span><span class="string" id="6431601">&#34;Close&nbsp;failed:&nbsp;&#34;</span><span class="op" id="6431617">,</span>&nbsp;<span class="ident" id="6431619">err</span><span class="op" id="6431622">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6431625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431629">pathenv</span>&nbsp;<span class="op" id="6431637">:=</span>&nbsp;<span class="ident" id="6431640">os</span><span class="op" id="6431642">.</span><span class="ident" id="6431643">Getenv</span><span class="op" id="6431649">(</span><span class="string" id="6431650">&#34;PATH&#34;</span><span class="op" id="6431656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431659">defer</span>&nbsp;<span class="ident" id="6431665">os</span><span class="op" id="6431667">.</span><span class="ident" id="6431668">Setenv</span><span class="op" id="6431674">(</span><span class="string" id="6431675">&#34;PATH&#34;</span><span class="op" id="6431681">,</span>&nbsp;<span class="ident" id="6431683">pathenv</span><span class="op" id="6431690">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431694">err</span>&nbsp;<span class="op" id="6431698">=</span>&nbsp;<span class="ident" id="6431700">os</span><span class="op" id="6431702">.</span><span class="ident" id="6431703">Setenv</span><span class="op" id="6431709">(</span><span class="string" id="6431710">&#34;PATH&#34;</span><span class="op" id="6431716">,</span>&nbsp;<span class="string" id="6431718">&#34;&#34;</span><span class="op" id="6431720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431723">if</span>&nbsp;<span class="ident" id="6431726">err</span>&nbsp;<span class="op" id="6431730">!=</span>&nbsp;<span class="ident" id="6431733">nil</span>&nbsp;<span class="op" id="6431737">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431741">t</span><span class="op" id="6431742">.</span><span class="ident" id="6431743">Fatal</span><span class="op" id="6431748">(</span><span class="string" id="6431749">&#34;Setenv&nbsp;failed:&nbsp;&#34;</span><span class="op" id="6431766">,</span>&nbsp;<span class="ident" id="6431768">err</span><span class="op" id="6431771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6431774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431778">path</span><span class="op" id="6431782">,</span>&nbsp;<span class="ident" id="6431784">err</span>&nbsp;<span class="op" id="6431788">:=</span>&nbsp;<span class="ident" id="6431791">LookPath</span><span class="op" id="6431799">(</span><span class="string" id="6431800">&#34;exec_me&#34;</span><span class="op" id="6431809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431812">if</span>&nbsp;<span class="ident" id="6431815">err</span>&nbsp;<span class="op" id="6431819">==</span>&nbsp;<span class="ident" id="6431822">nil</span>&nbsp;<span class="op" id="6431826">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431830">t</span><span class="op" id="6431831">.</span><span class="ident" id="6431832">Fatal</span><span class="op" id="6431837">(</span><span class="string" id="6431838">&#34;LookPath&nbsp;found&nbsp;exec_me&nbsp;in&nbsp;empty&nbsp;$PATH&#34;</span><span class="op" id="6431877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6431880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6431883">if</span>&nbsp;<span class="ident" id="6431886">path</span>&nbsp;<span class="op" id="6431891">!=</span>&nbsp;<span class="string" id="6431894">&#34;&#34;</span>&nbsp;<span class="op" id="6431897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6431901">t</span><span class="op" id="6431902">.</span><span class="ident" id="6431903">Fatalf</span><span class="op" id="6431909">(</span><span class="string" id="6431910">&#34;LookPath&nbsp;path&nbsp;==&nbsp;%q&nbsp;when&nbsp;err&nbsp;!=&nbsp;nil&#34;</span><span class="op" id="6431947">,</span>&nbsp;<span class="ident" id="6431949">path</span><span class="op" id="6431953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6431956">}</span><br>
<span class="lineno">55</span><span class="op" id="6431958">}</span>
</div>
</body>
</html>
