<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/zlib</h2>
<ul>
<li><a href="/gostd/compress/zlib/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/compress/zlib/reader.go.html">reader.go</a></li>
<li><a href="/gostd/compress/zlib/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/zlib/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/compress/zlib/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5445571">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5445626">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5445680">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5445731">package</span>&nbsp;<span class="ident" id="5445739">zlib</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5445745">import</span>&nbsp;<span class="op" id="5445752">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5445755">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5445773">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5445780">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5445788">&#34;hash/adler32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5445804">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5445809">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="5445812">//&nbsp;These&nbsp;constants&nbsp;are&nbsp;copied&nbsp;from&nbsp;the&nbsp;flate&nbsp;package,&nbsp;so&nbsp;that&nbsp;code&nbsp;that&nbsp;imports</span><br>
<span class="lineno"></span><span class="comment" id="5445892">//&nbsp;&#34;compress/zlib&#34;&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;to&nbsp;import&nbsp;&#34;compress/flate&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5445958">const</span>&nbsp;<span class="op" id="5445964">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5445967">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5445986">=</span>&nbsp;<span class="ident" id="5445988">flate</span><span class="op" id="5445993">.</span><span class="ident" id="5445994">NoCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446009">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5446028">=</span>&nbsp;<span class="ident" id="5446030">flate</span><span class="op" id="5446035">.</span><span class="ident" id="5446036">BestSpeed</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446047">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5446066">=</span>&nbsp;<span class="ident" id="5446068">flate</span><span class="op" id="5446073">.</span><span class="ident" id="5446074">BestCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446091">DefaultCompression</span>&nbsp;<span class="op" id="5446110">=</span>&nbsp;<span class="ident" id="5446112">flate</span><span class="op" id="5446117">.</span><span class="ident" id="5446118">DefaultCompression</span><br>
<span class="lineno"></span><span class="op" id="5446137">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5446140">//&nbsp;A&nbsp;Writer&nbsp;takes&nbsp;data&nbsp;written&nbsp;to&nbsp;it&nbsp;and&nbsp;writes&nbsp;the&nbsp;compressed</span><br>
<span class="lineno">25</span><span class="comment" id="5446203">//&nbsp;form&nbsp;of&nbsp;that&nbsp;data&nbsp;to&nbsp;an&nbsp;underlying&nbsp;writer&nbsp;(see&nbsp;NewWriter).</span><br>
<span class="lineno"></span><span class="keyword" id="5446265">type</span>&nbsp;<span class="ident" id="5446270">Writer</span>&nbsp;<span class="keyword" id="5446277">struct</span>&nbsp;<span class="op" id="5446284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446287">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446299">io</span><span class="op" id="5446301">.</span><span class="ident" id="5446302">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446310">level</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5446322">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446327">dict</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5446339">[</span><span class="op" id="5446340">]</span><span class="builtintype" id="5446341">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446347">compressor</span>&nbsp;&nbsp;<span class="op" id="5446359">*</span><span class="ident" id="5446360">flate</span><span class="op" id="5446365">.</span><span class="ident" id="5446366">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446374">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5446386">hash</span><span class="op" id="5446390">.</span><span class="ident" id="5446391">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446399">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5446411">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446418">scratch</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5446430">[</span><span class="num" id="5446431">4</span><span class="op" id="5446432">]</span><span class="builtintype" id="5446433">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446439">wroteHeader</span>&nbsp;<span class="builtintype" id="5446451">bool</span><br>
<span class="lineno">35</span><span class="op" id="5446456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5446459">//&nbsp;NewWriter&nbsp;creates&nbsp;a&nbsp;new&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="5446494">//&nbsp;Writes&nbsp;to&nbsp;the&nbsp;returned&nbsp;Writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="5446560">//</span><br>
<span class="lineno">40</span><span class="comment" id="5446563">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;WriteCloser&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="comment" id="5446644">//&nbsp;Writes&nbsp;may&nbsp;be&nbsp;buffered&nbsp;and&nbsp;not&nbsp;flushed&nbsp;until&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="5446699">func</span>&nbsp;<span class="ident" id="5446704">NewWriter</span><span class="op" id="5446713">(</span><span class="ident" id="5446714">w</span>&nbsp;<span class="ident" id="5446716">io</span><span class="op" id="5446718">.</span><span class="ident" id="5446719">Writer</span><span class="op" id="5446725">)</span>&nbsp;<span class="op" id="5446727">*</span><span class="ident" id="5446728">Writer</span>&nbsp;<span class="op" id="5446735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5446738">z</span><span class="op" id="5446739">,</span>&nbsp;<span class="ident" id="5446741">_</span>&nbsp;<span class="op" id="5446743">:=</span>&nbsp;<span class="ident" id="5446746">NewWriterLevelDict</span><span class="op" id="5446764">(</span><span class="ident" id="5446765">w</span><span class="op" id="5446766">,</span>&nbsp;<span class="ident" id="5446768">DefaultCompression</span><span class="op" id="5446786">,</span>&nbsp;<span class="ident" id="5446788">nil</span><span class="op" id="5446791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5446794">return</span>&nbsp;<span class="ident" id="5446801">z</span><br>
<span class="lineno">45</span><span class="op" id="5446803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5446806">//&nbsp;NewWriterLevel&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;specifies&nbsp;the&nbsp;compression&nbsp;level&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="5446886">//&nbsp;of&nbsp;assuming&nbsp;DefaultCompression.</span><br>
<span class="lineno"></span><span class="comment" id="5446921">//</span><br>
<span class="lineno">50</span><span class="comment" id="5446924">//&nbsp;The&nbsp;compression&nbsp;level&nbsp;can&nbsp;be&nbsp;DefaultCompression,&nbsp;NoCompression,&nbsp;or&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="5446998">//&nbsp;integer&nbsp;value&nbsp;between&nbsp;BestSpeed&nbsp;and&nbsp;BestCompression&nbsp;inclusive.&nbsp;The&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="5447074">//&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;level&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="5447121">func</span>&nbsp;<span class="ident" id="5447126">NewWriterLevel</span><span class="op" id="5447140">(</span><span class="ident" id="5447141">w</span>&nbsp;<span class="ident" id="5447143">io</span><span class="op" id="5447145">.</span><span class="ident" id="5447146">Writer</span><span class="op" id="5447152">,</span>&nbsp;<span class="ident" id="5447154">level</span>&nbsp;<span class="builtintype" id="5447160">int</span><span class="op" id="5447163">)</span>&nbsp;<span class="op" id="5447165">(</span><span class="op" id="5447166">*</span><span class="ident" id="5447167">Writer</span><span class="op" id="5447173">,</span>&nbsp;<span class="builtintype" id="5447175">error</span><span class="op" id="5447180">)</span>&nbsp;<span class="op" id="5447182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447185">return</span>&nbsp;<span class="ident" id="5447192">NewWriterLevelDict</span><span class="op" id="5447210">(</span><span class="ident" id="5447211">w</span><span class="op" id="5447212">,</span>&nbsp;<span class="ident" id="5447214">level</span><span class="op" id="5447219">,</span>&nbsp;<span class="ident" id="5447221">nil</span><span class="op" id="5447224">)</span><br>
<span class="lineno">55</span><span class="op" id="5447226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5447229">//&nbsp;NewWriterLevelDict&nbsp;is&nbsp;like&nbsp;NewWriterLevel&nbsp;but&nbsp;specifies&nbsp;a&nbsp;dictionary&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5447304">//&nbsp;compress&nbsp;with.</span><br>
<span class="lineno"></span><span class="comment" id="5447322">//</span><br>
<span class="lineno">60</span><span class="comment" id="5447325">//&nbsp;The&nbsp;dictionary&nbsp;may&nbsp;be&nbsp;nil.&nbsp;If&nbsp;not,&nbsp;its&nbsp;contents&nbsp;should&nbsp;not&nbsp;be&nbsp;modified&nbsp;until</span><br>
<span class="lineno"></span><span class="comment" id="5447405">//&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="5447430">func</span>&nbsp;<span class="ident" id="5447435">NewWriterLevelDict</span><span class="op" id="5447453">(</span><span class="ident" id="5447454">w</span>&nbsp;<span class="ident" id="5447456">io</span><span class="op" id="5447458">.</span><span class="ident" id="5447459">Writer</span><span class="op" id="5447465">,</span>&nbsp;<span class="ident" id="5447467">level</span>&nbsp;<span class="builtintype" id="5447473">int</span><span class="op" id="5447476">,</span>&nbsp;<span class="ident" id="5447478">dict</span>&nbsp;<span class="op" id="5447483">[</span><span class="op" id="5447484">]</span><span class="builtintype" id="5447485">byte</span><span class="op" id="5447489">)</span>&nbsp;<span class="op" id="5447491">(</span><span class="op" id="5447492">*</span><span class="ident" id="5447493">Writer</span><span class="op" id="5447499">,</span>&nbsp;<span class="builtintype" id="5447501">error</span><span class="op" id="5447506">)</span>&nbsp;<span class="op" id="5447508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447511">if</span>&nbsp;<span class="ident" id="5447514">level</span>&nbsp;<span class="op" id="5447520">&lt;</span>&nbsp;<span class="ident" id="5447522">DefaultCompression</span>&nbsp;<span class="op" id="5447541">||</span>&nbsp;<span class="ident" id="5447544">level</span>&nbsp;<span class="op" id="5447550">&gt;</span>&nbsp;<span class="ident" id="5447552">BestCompression</span>&nbsp;<span class="op" id="5447568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447572">return</span>&nbsp;<span class="ident" id="5447579">nil</span><span class="op" id="5447582">,</span>&nbsp;<span class="ident" id="5447584">fmt</span><span class="op" id="5447587">.</span><span class="ident" id="5447588">Errorf</span><span class="op" id="5447594">(</span><span class="string" id="5447595">&#34;zlib:&nbsp;invalid&nbsp;compression&nbsp;level:&nbsp;%d&#34;</span><span class="op" id="5447632">,</span>&nbsp;<span class="ident" id="5447634">level</span><span class="op" id="5447639">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5447642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447645">return</span>&nbsp;<span class="op" id="5447652">&amp;</span><span class="ident" id="5447653">Writer</span><span class="op" id="5447659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447663">w</span><span class="op" id="5447664">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5447670">w</span><span class="op" id="5447671">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447675">level</span><span class="op" id="5447680">:</span>&nbsp;<span class="ident" id="5447682">level</span><span class="op" id="5447687">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447691">dict</span><span class="op" id="5447695">:</span>&nbsp;&nbsp;<span class="ident" id="5447698">dict</span><span class="op" id="5447702">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5447705">}</span><span class="op" id="5447706">,</span>&nbsp;<span class="ident" id="5447708">nil</span><br>
<span class="lineno"></span><span class="op" id="5447712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5447715">//&nbsp;Reset&nbsp;clears&nbsp;the&nbsp;state&nbsp;of&nbsp;the&nbsp;Writer&nbsp;z&nbsp;such&nbsp;that&nbsp;it&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="5447791">//&nbsp;initial&nbsp;state&nbsp;from&nbsp;NewWriterLevel&nbsp;or&nbsp;NewWriterLevelDict,&nbsp;but&nbsp;instead&nbsp;writing</span><br>
<span class="lineno">75</span><span class="comment" id="5447871">//&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5447880">func</span>&nbsp;<span class="op" id="5447885">(</span><span class="ident" id="5447886">z</span>&nbsp;<span class="op" id="5447888">*</span><span class="ident" id="5447889">Writer</span><span class="op" id="5447895">)</span>&nbsp;<span class="ident" id="5447897">Reset</span><span class="op" id="5447902">(</span><span class="ident" id="5447903">w</span>&nbsp;<span class="ident" id="5447905">io</span><span class="op" id="5447907">.</span><span class="ident" id="5447908">Writer</span><span class="op" id="5447914">)</span>&nbsp;<span class="op" id="5447916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447919">z</span><span class="op" id="5447920">.</span><span class="ident" id="5447921">w</span>&nbsp;<span class="op" id="5447923">=</span>&nbsp;<span class="ident" id="5447925">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5447928">//&nbsp;z.level&nbsp;and&nbsp;z.dict&nbsp;left&nbsp;unchanged.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5447967">if</span>&nbsp;<span class="ident" id="5447970">z</span><span class="op" id="5447971">.</span><span class="ident" id="5447972">compressor</span>&nbsp;<span class="op" id="5447983">!=</span>&nbsp;<span class="ident" id="5447986">nil</span>&nbsp;<span class="op" id="5447990">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5447994">z</span><span class="op" id="5447995">.</span><span class="ident" id="5447996">compressor</span><span class="op" id="5448006">.</span><span class="ident" id="5448007">Reset</span><span class="op" id="5448012">(</span><span class="ident" id="5448013">w</span><span class="op" id="5448014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5448017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5448020">if</span>&nbsp;<span class="ident" id="5448023">z</span><span class="op" id="5448024">.</span><span class="ident" id="5448025">digest</span>&nbsp;<span class="op" id="5448032">!=</span>&nbsp;<span class="ident" id="5448035">nil</span>&nbsp;<span class="op" id="5448039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448043">z</span><span class="op" id="5448044">.</span><span class="ident" id="5448045">digest</span><span class="op" id="5448051">.</span><span class="ident" id="5448052">Reset</span><span class="op" id="5448057">(</span><span class="op" id="5448058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5448061">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448064">z</span><span class="op" id="5448065">.</span><span class="ident" id="5448066">err</span>&nbsp;<span class="op" id="5448070">=</span>&nbsp;<span class="ident" id="5448072">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448077">z</span><span class="op" id="5448078">.</span><span class="ident" id="5448079">scratch</span>&nbsp;<span class="op" id="5448087">=</span>&nbsp;<span class="op" id="5448089">[</span><span class="num" id="5448090">4</span><span class="op" id="5448091">]</span><span class="builtintype" id="5448092">byte</span><span class="op" id="5448096">{</span><span class="op" id="5448097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448100">z</span><span class="op" id="5448101">.</span><span class="ident" id="5448102">wroteHeader</span>&nbsp;<span class="op" id="5448114">=</span>&nbsp;<span class="builtintype" id="5448116">false</span><br>
<span class="lineno"></span><span class="op" id="5448122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="5448125">//&nbsp;writeHeader&nbsp;writes&nbsp;the&nbsp;ZLIB&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="5448164">func</span>&nbsp;<span class="op" id="5448169">(</span><span class="ident" id="5448170">z</span>&nbsp;<span class="op" id="5448172">*</span><span class="ident" id="5448173">Writer</span><span class="op" id="5448179">)</span>&nbsp;<span class="ident" id="5448181">writeHeader</span><span class="op" id="5448192">(</span><span class="op" id="5448193">)</span>&nbsp;<span class="op" id="5448195">(</span><span class="ident" id="5448196">err</span>&nbsp;<span class="builtintype" id="5448200">error</span><span class="op" id="5448205">)</span>&nbsp;<span class="op" id="5448207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448210">z</span><span class="op" id="5448211">.</span><span class="ident" id="5448212">wroteHeader</span>&nbsp;<span class="op" id="5448224">=</span>&nbsp;<span class="builtintype" id="5448226">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5448232">//&nbsp;ZLIB&nbsp;has&nbsp;a&nbsp;two-byte&nbsp;header&nbsp;(as&nbsp;documented&nbsp;in&nbsp;RFC&nbsp;1950).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5448292">//&nbsp;The&nbsp;first&nbsp;four&nbsp;bits&nbsp;is&nbsp;the&nbsp;CINFO&nbsp;(compression&nbsp;info),&nbsp;which&nbsp;is&nbsp;7&nbsp;for&nbsp;the&nbsp;default&nbsp;deflate&nbsp;window&nbsp;size.</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5448397">//&nbsp;The&nbsp;next&nbsp;four&nbsp;bits&nbsp;is&nbsp;the&nbsp;CM&nbsp;(compression&nbsp;method),&nbsp;which&nbsp;is&nbsp;8&nbsp;for&nbsp;deflate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448476">z</span><span class="op" id="5448477">.</span><span class="ident" id="5448478">scratch</span><span class="op" id="5448485">[</span><span class="num" id="5448486">0</span><span class="op" id="5448487">]</span>&nbsp;<span class="op" id="5448489">=</span>&nbsp;<span class="num" id="5448491">0x78</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5448497">//&nbsp;The&nbsp;next&nbsp;two&nbsp;bits&nbsp;is&nbsp;the&nbsp;FLEVEL&nbsp;(compression&nbsp;level).&nbsp;The&nbsp;four&nbsp;values&nbsp;are:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5448575">//&nbsp;0=fastest,&nbsp;1=fast,&nbsp;2=default,&nbsp;3=best.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5448617">//&nbsp;The&nbsp;next&nbsp;bit,&nbsp;FDICT,&nbsp;is&nbsp;set&nbsp;if&nbsp;a&nbsp;dictionary&nbsp;is&nbsp;given.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5448675">//&nbsp;The&nbsp;final&nbsp;five&nbsp;FCHECK&nbsp;bits&nbsp;form&nbsp;a&nbsp;mod-31&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5448730">switch</span>&nbsp;<span class="ident" id="5448737">z</span><span class="op" id="5448738">.</span><span class="ident" id="5448739">level</span>&nbsp;<span class="op" id="5448745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5448748">case</span>&nbsp;<span class="num" id="5448753">0</span><span class="op" id="5448754">,</span>&nbsp;<span class="num" id="5448756">1</span><span class="op" id="5448757">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448761">z</span><span class="op" id="5448762">.</span><span class="ident" id="5448763">scratch</span><span class="op" id="5448770">[</span><span class="num" id="5448771">1</span><span class="op" id="5448772">]</span>&nbsp;<span class="op" id="5448774">=</span>&nbsp;<span class="num" id="5448776">0</span>&nbsp;<span class="op" id="5448778">&lt;&lt;</span>&nbsp;<span class="num" id="5448781">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5448784">case</span>&nbsp;<span class="num" id="5448789">2</span><span class="op" id="5448790">,</span>&nbsp;<span class="num" id="5448792">3</span><span class="op" id="5448793">,</span>&nbsp;<span class="num" id="5448795">4</span><span class="op" id="5448796">,</span>&nbsp;<span class="num" id="5448798">5</span><span class="op" id="5448799">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448803">z</span><span class="op" id="5448804">.</span><span class="ident" id="5448805">scratch</span><span class="op" id="5448812">[</span><span class="num" id="5448813">1</span><span class="op" id="5448814">]</span>&nbsp;<span class="op" id="5448816">=</span>&nbsp;<span class="num" id="5448818">1</span>&nbsp;<span class="op" id="5448820">&lt;&lt;</span>&nbsp;<span class="num" id="5448823">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5448826">case</span>&nbsp;<span class="num" id="5448831">6</span><span class="op" id="5448832">,</span>&nbsp;<span class="op" id="5448834">-</span><span class="num" id="5448835">1</span><span class="op" id="5448836">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448840">z</span><span class="op" id="5448841">.</span><span class="ident" id="5448842">scratch</span><span class="op" id="5448849">[</span><span class="num" id="5448850">1</span><span class="op" id="5448851">]</span>&nbsp;<span class="op" id="5448853">=</span>&nbsp;<span class="num" id="5448855">2</span>&nbsp;<span class="op" id="5448857">&lt;&lt;</span>&nbsp;<span class="num" id="5448860">6</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5448863">case</span>&nbsp;<span class="num" id="5448868">7</span><span class="op" id="5448869">,</span>&nbsp;<span class="num" id="5448871">8</span><span class="op" id="5448872">,</span>&nbsp;<span class="num" id="5448874">9</span><span class="op" id="5448875">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448879">z</span><span class="op" id="5448880">.</span><span class="ident" id="5448881">scratch</span><span class="op" id="5448888">[</span><span class="num" id="5448889">1</span><span class="op" id="5448890">]</span>&nbsp;<span class="op" id="5448892">=</span>&nbsp;<span class="num" id="5448894">3</span>&nbsp;<span class="op" id="5448896">&lt;&lt;</span>&nbsp;<span class="num" id="5448899">6</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5448902">default</span><span class="op" id="5448909">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5448913">panic</span><span class="op" id="5448918">(</span><span class="string" id="5448919">&#34;unreachable&#34;</span><span class="op" id="5448932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5448935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5448938">if</span>&nbsp;<span class="ident" id="5448941">z</span><span class="op" id="5448942">.</span><span class="ident" id="5448943">dict</span>&nbsp;<span class="op" id="5448948">!=</span>&nbsp;<span class="ident" id="5448951">nil</span>&nbsp;<span class="op" id="5448955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448959">z</span><span class="op" id="5448960">.</span><span class="ident" id="5448961">scratch</span><span class="op" id="5448968">[</span><span class="num" id="5448969">1</span><span class="op" id="5448970">]</span>&nbsp;<span class="op" id="5448972">|=</span>&nbsp;<span class="num" id="5448975">1</span>&nbsp;<span class="op" id="5448977">&lt;&lt;</span>&nbsp;<span class="num" id="5448980">5</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5448983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5448986">z</span><span class="op" id="5448987">.</span><span class="ident" id="5448988">scratch</span><span class="op" id="5448995">[</span><span class="num" id="5448996">1</span><span class="op" id="5448997">]</span>&nbsp;<span class="op" id="5448999">+=</span>&nbsp;<span class="builtintype" id="5449002">uint8</span><span class="op" id="5449007">(</span><span class="num" id="5449008">31</span>&nbsp;<span class="op" id="5449011">-</span>&nbsp;<span class="op" id="5449013">(</span><span class="builtintype" id="5449014">uint16</span><span class="op" id="5449020">(</span><span class="ident" id="5449021">z</span><span class="op" id="5449022">.</span><span class="ident" id="5449023">scratch</span><span class="op" id="5449030">[</span><span class="num" id="5449031">0</span><span class="op" id="5449032">]</span><span class="op" id="5449033">)</span><span class="op" id="5449034">&lt;&lt;</span><span class="num" id="5449036">8</span><span class="op" id="5449037">+</span><span class="builtintype" id="5449038">uint16</span><span class="op" id="5449044">(</span><span class="ident" id="5449045">z</span><span class="op" id="5449046">.</span><span class="ident" id="5449047">scratch</span><span class="op" id="5449054">[</span><span class="num" id="5449055">1</span><span class="op" id="5449056">]</span><span class="op" id="5449057">)</span><span class="op" id="5449058">)</span><span class="op" id="5449059">%</span><span class="num" id="5449060">31</span><span class="op" id="5449062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449065">if</span>&nbsp;<span class="ident" id="5449068">_</span><span class="op" id="5449069">,</span>&nbsp;<span class="ident" id="5449071">err</span>&nbsp;<span class="op" id="5449075">=</span>&nbsp;<span class="ident" id="5449077">z</span><span class="op" id="5449078">.</span><span class="ident" id="5449079">w</span><span class="op" id="5449080">.</span><span class="ident" id="5449081">Write</span><span class="op" id="5449086">(</span><span class="ident" id="5449087">z</span><span class="op" id="5449088">.</span><span class="ident" id="5449089">scratch</span><span class="op" id="5449096">[</span><span class="num" id="5449097">0</span><span class="op" id="5449098">:</span><span class="num" id="5449099">2</span><span class="op" id="5449100">]</span><span class="op" id="5449101">)</span><span class="op" id="5449102">;</span>&nbsp;<span class="ident" id="5449104">err</span>&nbsp;<span class="op" id="5449108">!=</span>&nbsp;<span class="ident" id="5449111">nil</span>&nbsp;<span class="op" id="5449115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449119">return</span>&nbsp;<span class="ident" id="5449126">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5449131">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449134">if</span>&nbsp;<span class="ident" id="5449137">z</span><span class="op" id="5449138">.</span><span class="ident" id="5449139">dict</span>&nbsp;<span class="op" id="5449144">!=</span>&nbsp;<span class="ident" id="5449147">nil</span>&nbsp;<span class="op" id="5449151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5449155">//&nbsp;The&nbsp;next&nbsp;four&nbsp;bytes&nbsp;are&nbsp;the&nbsp;Adler-32&nbsp;checksum&nbsp;of&nbsp;the&nbsp;dictionary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449225">checksum</span>&nbsp;<span class="op" id="5449234">:=</span>&nbsp;<span class="ident" id="5449237">adler32</span><span class="op" id="5449244">.</span><span class="ident" id="5449245">Checksum</span><span class="op" id="5449253">(</span><span class="ident" id="5449254">z</span><span class="op" id="5449255">.</span><span class="ident" id="5449256">dict</span><span class="op" id="5449260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449264">z</span><span class="op" id="5449265">.</span><span class="ident" id="5449266">scratch</span><span class="op" id="5449273">[</span><span class="num" id="5449274">0</span><span class="op" id="5449275">]</span>&nbsp;<span class="op" id="5449277">=</span>&nbsp;<span class="builtintype" id="5449279">uint8</span><span class="op" id="5449284">(</span><span class="ident" id="5449285">checksum</span>&nbsp;<span class="op" id="5449294">&gt;&gt;</span>&nbsp;<span class="num" id="5449297">24</span><span class="op" id="5449299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449303">z</span><span class="op" id="5449304">.</span><span class="ident" id="5449305">scratch</span><span class="op" id="5449312">[</span><span class="num" id="5449313">1</span><span class="op" id="5449314">]</span>&nbsp;<span class="op" id="5449316">=</span>&nbsp;<span class="builtintype" id="5449318">uint8</span><span class="op" id="5449323">(</span><span class="ident" id="5449324">checksum</span>&nbsp;<span class="op" id="5449333">&gt;&gt;</span>&nbsp;<span class="num" id="5449336">16</span><span class="op" id="5449338">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449342">z</span><span class="op" id="5449343">.</span><span class="ident" id="5449344">scratch</span><span class="op" id="5449351">[</span><span class="num" id="5449352">2</span><span class="op" id="5449353">]</span>&nbsp;<span class="op" id="5449355">=</span>&nbsp;<span class="builtintype" id="5449357">uint8</span><span class="op" id="5449362">(</span><span class="ident" id="5449363">checksum</span>&nbsp;<span class="op" id="5449372">&gt;&gt;</span>&nbsp;<span class="num" id="5449375">8</span><span class="op" id="5449376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449380">z</span><span class="op" id="5449381">.</span><span class="ident" id="5449382">scratch</span><span class="op" id="5449389">[</span><span class="num" id="5449390">3</span><span class="op" id="5449391">]</span>&nbsp;<span class="op" id="5449393">=</span>&nbsp;<span class="builtintype" id="5449395">uint8</span><span class="op" id="5449400">(</span><span class="ident" id="5449401">checksum</span>&nbsp;<span class="op" id="5449410">&gt;&gt;</span>&nbsp;<span class="num" id="5449413">0</span><span class="op" id="5449414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449418">if</span>&nbsp;<span class="ident" id="5449421">_</span><span class="op" id="5449422">,</span>&nbsp;<span class="ident" id="5449424">err</span>&nbsp;<span class="op" id="5449428">=</span>&nbsp;<span class="ident" id="5449430">z</span><span class="op" id="5449431">.</span><span class="ident" id="5449432">w</span><span class="op" id="5449433">.</span><span class="ident" id="5449434">Write</span><span class="op" id="5449439">(</span><span class="ident" id="5449440">z</span><span class="op" id="5449441">.</span><span class="ident" id="5449442">scratch</span><span class="op" id="5449449">[</span><span class="num" id="5449450">0</span><span class="op" id="5449451">:</span><span class="num" id="5449452">4</span><span class="op" id="5449453">]</span><span class="op" id="5449454">)</span><span class="op" id="5449455">;</span>&nbsp;<span class="ident" id="5449457">err</span>&nbsp;<span class="op" id="5449461">!=</span>&nbsp;<span class="ident" id="5449464">nil</span>&nbsp;<span class="op" id="5449468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449473">return</span>&nbsp;<span class="ident" id="5449480">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5449486">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5449489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449492">if</span>&nbsp;<span class="ident" id="5449495">z</span><span class="op" id="5449496">.</span><span class="ident" id="5449497">compressor</span>&nbsp;<span class="op" id="5449508">==</span>&nbsp;<span class="ident" id="5449511">nil</span>&nbsp;<span class="op" id="5449515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5449519">//&nbsp;Initialize&nbsp;deflater&nbsp;unless&nbsp;the&nbsp;Writer&nbsp;is&nbsp;being&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5449578">//&nbsp;after&nbsp;a&nbsp;Reset&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449603">z</span><span class="op" id="5449604">.</span><span class="ident" id="5449605">compressor</span><span class="op" id="5449615">,</span>&nbsp;<span class="ident" id="5449617">err</span>&nbsp;<span class="op" id="5449621">=</span>&nbsp;<span class="ident" id="5449623">flate</span><span class="op" id="5449628">.</span><span class="ident" id="5449629">NewWriterDict</span><span class="op" id="5449642">(</span><span class="ident" id="5449643">z</span><span class="op" id="5449644">.</span><span class="ident" id="5449645">w</span><span class="op" id="5449646">,</span>&nbsp;<span class="ident" id="5449648">z</span><span class="op" id="5449649">.</span><span class="ident" id="5449650">level</span><span class="op" id="5449655">,</span>&nbsp;<span class="ident" id="5449657">z</span><span class="op" id="5449658">.</span><span class="ident" id="5449659">dict</span><span class="op" id="5449663">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449667">if</span>&nbsp;<span class="ident" id="5449670">err</span>&nbsp;<span class="op" id="5449674">!=</span>&nbsp;<span class="ident" id="5449677">nil</span>&nbsp;<span class="op" id="5449681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449686">return</span>&nbsp;<span class="ident" id="5449693">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5449699">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449703">z</span><span class="op" id="5449704">.</span><span class="ident" id="5449705">digest</span>&nbsp;<span class="op" id="5449712">=</span>&nbsp;<span class="ident" id="5449714">adler32</span><span class="op" id="5449721">.</span><span class="ident" id="5449722">New</span><span class="op" id="5449725">(</span><span class="op" id="5449726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5449729">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449732">return</span>&nbsp;<span class="ident" id="5449739">nil</span><br>
<span class="lineno"></span><span class="op" id="5449743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5449746">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;compressed&nbsp;form&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="5449818">//&nbsp;compressed&nbsp;bytes&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;flushed&nbsp;until&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed&nbsp;or</span><br>
<span class="lineno">145</span><span class="comment" id="5449896">//&nbsp;explicitly&nbsp;flushed.</span><br>
<span class="lineno"></span><span class="keyword" id="5449919">func</span>&nbsp;<span class="op" id="5449924">(</span><span class="ident" id="5449925">z</span>&nbsp;<span class="op" id="5449927">*</span><span class="ident" id="5449928">Writer</span><span class="op" id="5449934">)</span>&nbsp;<span class="ident" id="5449936">Write</span><span class="op" id="5449941">(</span><span class="ident" id="5449942">p</span>&nbsp;<span class="op" id="5449944">[</span><span class="op" id="5449945">]</span><span class="builtintype" id="5449946">byte</span><span class="op" id="5449950">)</span>&nbsp;<span class="op" id="5449952">(</span><span class="ident" id="5449953">n</span>&nbsp;<span class="builtintype" id="5449955">int</span><span class="op" id="5449958">,</span>&nbsp;<span class="ident" id="5449960">err</span>&nbsp;<span class="builtintype" id="5449964">error</span><span class="op" id="5449969">)</span>&nbsp;<span class="op" id="5449971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5449974">if</span>&nbsp;<span class="op" id="5449977">!</span><span class="ident" id="5449978">z</span><span class="op" id="5449979">.</span><span class="ident" id="5449980">wroteHeader</span>&nbsp;<span class="op" id="5449992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5449996">z</span><span class="op" id="5449997">.</span><span class="ident" id="5449998">err</span>&nbsp;<span class="op" id="5450002">=</span>&nbsp;<span class="ident" id="5450004">z</span><span class="op" id="5450005">.</span><span class="ident" id="5450006">writeHeader</span><span class="op" id="5450017">(</span><span class="op" id="5450018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5450021">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450024">if</span>&nbsp;<span class="ident" id="5450027">z</span><span class="op" id="5450028">.</span><span class="ident" id="5450029">err</span>&nbsp;<span class="op" id="5450033">!=</span>&nbsp;<span class="ident" id="5450036">nil</span>&nbsp;<span class="op" id="5450040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450044">return</span>&nbsp;<span class="num" id="5450051">0</span><span class="op" id="5450052">,</span>&nbsp;<span class="ident" id="5450054">z</span><span class="op" id="5450055">.</span><span class="ident" id="5450056">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5450061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450064">if</span>&nbsp;<span class="builtinfunc" id="5450067">len</span><span class="op" id="5450070">(</span><span class="ident" id="5450071">p</span><span class="op" id="5450072">)</span>&nbsp;<span class="op" id="5450074">==</span>&nbsp;<span class="num" id="5450077">0</span>&nbsp;<span class="op" id="5450079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450083">return</span>&nbsp;<span class="num" id="5450090">0</span><span class="op" id="5450091">,</span>&nbsp;<span class="ident" id="5450093">nil</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5450098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450101">n</span><span class="op" id="5450102">,</span>&nbsp;<span class="ident" id="5450104">err</span>&nbsp;<span class="op" id="5450108">=</span>&nbsp;<span class="ident" id="5450110">z</span><span class="op" id="5450111">.</span><span class="ident" id="5450112">compressor</span><span class="op" id="5450122">.</span><span class="ident" id="5450123">Write</span><span class="op" id="5450128">(</span><span class="ident" id="5450129">p</span><span class="op" id="5450130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450133">if</span>&nbsp;<span class="ident" id="5450136">err</span>&nbsp;<span class="op" id="5450140">!=</span>&nbsp;<span class="ident" id="5450143">nil</span>&nbsp;<span class="op" id="5450147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450151">z</span><span class="op" id="5450152">.</span><span class="ident" id="5450153">err</span>&nbsp;<span class="op" id="5450157">=</span>&nbsp;<span class="ident" id="5450159">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450165">return</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5450173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450176">z</span><span class="op" id="5450177">.</span><span class="ident" id="5450178">digest</span><span class="op" id="5450184">.</span><span class="ident" id="5450185">Write</span><span class="op" id="5450190">(</span><span class="ident" id="5450191">p</span><span class="op" id="5450192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450195">return</span><br>
<span class="lineno"></span><span class="op" id="5450202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="5450205">//&nbsp;Flush&nbsp;flushes&nbsp;the&nbsp;Writer&nbsp;to&nbsp;its&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5450262">func</span>&nbsp;<span class="op" id="5450267">(</span><span class="ident" id="5450268">z</span>&nbsp;<span class="op" id="5450270">*</span><span class="ident" id="5450271">Writer</span><span class="op" id="5450277">)</span>&nbsp;<span class="ident" id="5450279">Flush</span><span class="op" id="5450284">(</span><span class="op" id="5450285">)</span>&nbsp;<span class="builtintype" id="5450287">error</span>&nbsp;<span class="op" id="5450293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450296">if</span>&nbsp;<span class="op" id="5450299">!</span><span class="ident" id="5450300">z</span><span class="op" id="5450301">.</span><span class="ident" id="5450302">wroteHeader</span>&nbsp;<span class="op" id="5450314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450318">z</span><span class="op" id="5450319">.</span><span class="ident" id="5450320">err</span>&nbsp;<span class="op" id="5450324">=</span>&nbsp;<span class="ident" id="5450326">z</span><span class="op" id="5450327">.</span><span class="ident" id="5450328">writeHeader</span><span class="op" id="5450339">(</span><span class="op" id="5450340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5450343">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450346">if</span>&nbsp;<span class="ident" id="5450349">z</span><span class="op" id="5450350">.</span><span class="ident" id="5450351">err</span>&nbsp;<span class="op" id="5450355">!=</span>&nbsp;<span class="ident" id="5450358">nil</span>&nbsp;<span class="op" id="5450362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450366">return</span>&nbsp;<span class="ident" id="5450373">z</span><span class="op" id="5450374">.</span><span class="ident" id="5450375">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5450380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450383">z</span><span class="op" id="5450384">.</span><span class="ident" id="5450385">err</span>&nbsp;<span class="op" id="5450389">=</span>&nbsp;<span class="ident" id="5450391">z</span><span class="op" id="5450392">.</span><span class="ident" id="5450393">compressor</span><span class="op" id="5450403">.</span><span class="ident" id="5450404">Flush</span><span class="op" id="5450409">(</span><span class="op" id="5450410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450413">return</span>&nbsp;<span class="ident" id="5450420">z</span><span class="op" id="5450421">.</span><span class="ident" id="5450422">err</span><br>
<span class="lineno">175</span><span class="op" id="5450426">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5450429">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Writer,&nbsp;flushing&nbsp;any&nbsp;unwritten&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="5450503">//&nbsp;io.Writer,&nbsp;but&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5450562">func</span>&nbsp;<span class="op" id="5450567">(</span><span class="ident" id="5450568">z</span>&nbsp;<span class="op" id="5450570">*</span><span class="ident" id="5450571">Writer</span><span class="op" id="5450577">)</span>&nbsp;<span class="ident" id="5450579">Close</span><span class="op" id="5450584">(</span><span class="op" id="5450585">)</span>&nbsp;<span class="builtintype" id="5450587">error</span>&nbsp;<span class="op" id="5450593">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450596">if</span>&nbsp;<span class="op" id="5450599">!</span><span class="ident" id="5450600">z</span><span class="op" id="5450601">.</span><span class="ident" id="5450602">wroteHeader</span>&nbsp;<span class="op" id="5450614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450618">z</span><span class="op" id="5450619">.</span><span class="ident" id="5450620">err</span>&nbsp;<span class="op" id="5450624">=</span>&nbsp;<span class="ident" id="5450626">z</span><span class="op" id="5450627">.</span><span class="ident" id="5450628">writeHeader</span><span class="op" id="5450639">(</span><span class="op" id="5450640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5450643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450646">if</span>&nbsp;<span class="ident" id="5450649">z</span><span class="op" id="5450650">.</span><span class="ident" id="5450651">err</span>&nbsp;<span class="op" id="5450655">!=</span>&nbsp;<span class="ident" id="5450658">nil</span>&nbsp;<span class="op" id="5450662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450666">return</span>&nbsp;<span class="ident" id="5450673">z</span><span class="op" id="5450674">.</span><span class="ident" id="5450675">err</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5450680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450683">z</span><span class="op" id="5450684">.</span><span class="ident" id="5450685">err</span>&nbsp;<span class="op" id="5450689">=</span>&nbsp;<span class="ident" id="5450691">z</span><span class="op" id="5450692">.</span><span class="ident" id="5450693">compressor</span><span class="op" id="5450703">.</span><span class="ident" id="5450704">Close</span><span class="op" id="5450709">(</span><span class="op" id="5450710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450713">if</span>&nbsp;<span class="ident" id="5450716">z</span><span class="op" id="5450717">.</span><span class="ident" id="5450718">err</span>&nbsp;<span class="op" id="5450722">!=</span>&nbsp;<span class="ident" id="5450725">nil</span>&nbsp;<span class="op" id="5450729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5450733">return</span>&nbsp;<span class="ident" id="5450740">z</span><span class="op" id="5450741">.</span><span class="ident" id="5450742">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5450747">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450750">checksum</span>&nbsp;<span class="op" id="5450759">:=</span>&nbsp;<span class="ident" id="5450762">z</span><span class="op" id="5450763">.</span><span class="ident" id="5450764">digest</span><span class="op" id="5450770">.</span><span class="ident" id="5450771">Sum32</span><span class="op" id="5450776">(</span><span class="op" id="5450777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5450780">//&nbsp;ZLIB&nbsp;(RFC&nbsp;1950)&nbsp;is&nbsp;big-endian,&nbsp;unlike&nbsp;GZIP&nbsp;(RFC&nbsp;1952).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450839">z</span><span class="op" id="5450840">.</span><span class="ident" id="5450841">scratch</span><span class="op" id="5450848">[</span><span class="num" id="5450849">0</span><span class="op" id="5450850">]</span>&nbsp;<span class="op" id="5450852">=</span>&nbsp;<span class="builtintype" id="5450854">uint8</span><span class="op" id="5450859">(</span><span class="ident" id="5450860">checksum</span>&nbsp;<span class="op" id="5450869">&gt;&gt;</span>&nbsp;<span class="num" id="5450872">24</span><span class="op" id="5450874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450877">z</span><span class="op" id="5450878">.</span><span class="ident" id="5450879">scratch</span><span class="op" id="5450886">[</span><span class="num" id="5450887">1</span><span class="op" id="5450888">]</span>&nbsp;<span class="op" id="5450890">=</span>&nbsp;<span class="builtintype" id="5450892">uint8</span><span class="op" id="5450897">(</span><span class="ident" id="5450898">checksum</span>&nbsp;<span class="op" id="5450907">&gt;&gt;</span>&nbsp;<span class="num" id="5450910">16</span><span class="op" id="5450912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450915">z</span><span class="op" id="5450916">.</span><span class="ident" id="5450917">scratch</span><span class="op" id="5450924">[</span><span class="num" id="5450925">2</span><span class="op" id="5450926">]</span>&nbsp;<span class="op" id="5450928">=</span>&nbsp;<span class="builtintype" id="5450930">uint8</span><span class="op" id="5450935">(</span><span class="ident" id="5450936">checksum</span>&nbsp;<span class="op" id="5450945">&gt;&gt;</span>&nbsp;<span class="num" id="5450948">8</span><span class="op" id="5450949">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450952">z</span><span class="op" id="5450953">.</span><span class="ident" id="5450954">scratch</span><span class="op" id="5450961">[</span><span class="num" id="5450962">3</span><span class="op" id="5450963">]</span>&nbsp;<span class="op" id="5450965">=</span>&nbsp;<span class="builtintype" id="5450967">uint8</span><span class="op" id="5450972">(</span><span class="ident" id="5450973">checksum</span>&nbsp;<span class="op" id="5450982">&gt;&gt;</span>&nbsp;<span class="num" id="5450985">0</span><span class="op" id="5450986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5450989">_</span><span class="op" id="5450990">,</span>&nbsp;<span class="ident" id="5450992">z</span><span class="op" id="5450993">.</span><span class="ident" id="5450994">err</span>&nbsp;<span class="op" id="5450998">=</span>&nbsp;<span class="ident" id="5451000">z</span><span class="op" id="5451001">.</span><span class="ident" id="5451002">w</span><span class="op" id="5451003">.</span><span class="ident" id="5451004">Write</span><span class="op" id="5451009">(</span><span class="ident" id="5451010">z</span><span class="op" id="5451011">.</span><span class="ident" id="5451012">scratch</span><span class="op" id="5451019">[</span><span class="num" id="5451020">0</span><span class="op" id="5451021">:</span><span class="num" id="5451022">4</span><span class="op" id="5451023">]</span><span class="op" id="5451024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5451027">return</span>&nbsp;<span class="ident" id="5451034">z</span><span class="op" id="5451035">.</span><span class="ident" id="5451036">err</span><br>
<span class="lineno"></span><span class="op" id="5451040">}</span>
</div>
</body>
</html>
