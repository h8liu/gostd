<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7753946">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7754001">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7754055">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7754106">//&nbsp;Tests&nbsp;that&nbsp;involve&nbsp;both&nbsp;reading&nbsp;and&nbsp;writing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7754155">package</span>&nbsp;<span class="ident" id="7754163">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7754168">import</span>&nbsp;<span class="op" id="7754175">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7754178">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7754187">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7754194">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7754202">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7754208">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7754221">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7754229">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7754240">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7754251">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7754258">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="7754261">func</span>&nbsp;<span class="ident" id="7754266">TestOver65kFiles</span><span class="op" id="7754282">(</span><span class="ident" id="7754283">t</span>&nbsp;<span class="op" id="7754285">*</span><span class="ident" id="7754286">testing</span><span class="op" id="7754293">.</span><span class="ident" id="7754294">T</span><span class="op" id="7754295">)</span>&nbsp;<span class="op" id="7754297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7754300">buf</span>&nbsp;<span class="op" id="7754304">:=</span>&nbsp;<span class="builtinfunc" id="7754307">new</span><span class="op" id="7754310">(</span><span class="ident" id="7754311">bytes</span><span class="op" id="7754316">.</span><span class="ident" id="7754317">Buffer</span><span class="op" id="7754323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7754326">w</span>&nbsp;<span class="op" id="7754328">:=</span>&nbsp;<span class="ident" id="7754331">NewWriter</span><span class="op" id="7754340">(</span><span class="ident" id="7754341">buf</span><span class="op" id="7754344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7754347">const</span>&nbsp;<span class="ident" id="7754353">nFiles</span>&nbsp;<span class="op" id="7754360">=</span>&nbsp;<span class="op" id="7754362">(</span><span class="num" id="7754363">1</span>&nbsp;<span class="op" id="7754365">&lt;&lt;</span>&nbsp;<span class="num" id="7754368">16</span><span class="op" id="7754370">)</span>&nbsp;<span class="op" id="7754372">+</span>&nbsp;<span class="num" id="7754374">42</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7754378">for</span>&nbsp;<span class="ident" id="7754382">i</span>&nbsp;<span class="op" id="7754384">:=</span>&nbsp;<span class="num" id="7754387">0</span><span class="op" id="7754388">;</span>&nbsp;<span class="ident" id="7754390">i</span>&nbsp;<span class="op" id="7754392">&lt;</span>&nbsp;<span class="ident" id="7754394">nFiles</span><span class="op" id="7754400">;</span>&nbsp;<span class="ident" id="7754402">i</span><span class="op" id="7754403">++</span>&nbsp;<span class="op" id="7754406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7754410">_</span><span class="op" id="7754411">,</span>&nbsp;<span class="ident" id="7754413">err</span>&nbsp;<span class="op" id="7754417">:=</span>&nbsp;<span class="ident" id="7754420">w</span><span class="op" id="7754421">.</span><span class="ident" id="7754422">CreateHeader</span><span class="op" id="7754434">(</span><span class="op" id="7754435">&amp;</span><span class="ident" id="7754436">FileHeader</span><span class="op" id="7754446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7754451">Name</span><span class="op" id="7754455">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7754459">fmt</span><span class="op" id="7754462">.</span><span class="ident" id="7754463">Sprintf</span><span class="op" id="7754470">(</span><span class="string" id="7754471">&#34;%d.dat&#34;</span><span class="op" id="7754479">,</span>&nbsp;<span class="ident" id="7754481">i</span><span class="op" id="7754482">)</span><span class="op" id="7754483">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7754488">Method</span><span class="op" id="7754494">:</span>&nbsp;<span class="ident" id="7754496">Store</span><span class="op" id="7754501">,</span>&nbsp;<span class="comment" id="7754503">//&nbsp;avoid&nbsp;Issue&nbsp;6136&nbsp;and&nbsp;Issue&nbsp;6138</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7754540">}</span><span class="op" id="7754541">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7754545">if</span>&nbsp;<span class="ident" id="7754548">err</span>&nbsp;<span class="op" id="7754552">!=</span>&nbsp;<span class="ident" id="7754555">nil</span>&nbsp;<span class="op" id="7754559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7754564">t</span><span class="op" id="7754565">.</span><span class="ident" id="7754566">Fatalf</span><span class="op" id="7754572">(</span><span class="string" id="7754573">&#34;creating&nbsp;file&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="7754595">,</span>&nbsp;<span class="ident" id="7754597">i</span><span class="op" id="7754598">,</span>&nbsp;<span class="ident" id="7754600">err</span><span class="op" id="7754603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7754607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7754610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7754613">if</span>&nbsp;<span class="ident" id="7754616">err</span>&nbsp;<span class="op" id="7754620">:=</span>&nbsp;<span class="ident" id="7754623">w</span><span class="op" id="7754624">.</span><span class="ident" id="7754625">Close</span><span class="op" id="7754630">(</span><span class="op" id="7754631">)</span><span class="op" id="7754632">;</span>&nbsp;<span class="ident" id="7754634">err</span>&nbsp;<span class="op" id="7754638">!=</span>&nbsp;<span class="ident" id="7754641">nil</span>&nbsp;<span class="op" id="7754645">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7754649">t</span><span class="op" id="7754650">.</span><span class="ident" id="7754651">Fatalf</span><span class="op" id="7754657">(</span><span class="string" id="7754658">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="7754676">,</span>&nbsp;<span class="ident" id="7754678">err</span><span class="op" id="7754681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7754684">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7754687">s</span>&nbsp;<span class="op" id="7754689">:=</span>&nbsp;<span class="ident" id="7754692">buf</span><span class="op" id="7754695">.</span><span class="ident" id="7754696">String</span><span class="op" id="7754702">(</span><span class="op" id="7754703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7754706">zr</span><span class="op" id="7754708">,</span>&nbsp;<span class="ident" id="7754710">err</span>&nbsp;<span class="op" id="7754714">:=</span>&nbsp;<span class="ident" id="7754717">NewReader</span><span class="op" id="7754726">(</span><span class="ident" id="7754727">strings</span><span class="op" id="7754734">.</span><span class="ident" id="7754735">NewReader</span><span class="op" id="7754744">(</span><span class="ident" id="7754745">s</span><span class="op" id="7754746">)</span><span class="op" id="7754747">,</span>&nbsp;<span class="ident" id="7754749">int64</span><span class="op" id="7754754">(</span><span class="builtinfunc" id="7754755">len</span><span class="op" id="7754758">(</span><span class="ident" id="7754759">s</span><span class="op" id="7754760">)</span><span class="op" id="7754761">)</span><span class="op" id="7754762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7754765">if</span>&nbsp;<span class="ident" id="7754768">err</span>&nbsp;<span class="op" id="7754772">!=</span>&nbsp;<span class="ident" id="7754775">nil</span>&nbsp;<span class="op" id="7754779">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7754783">t</span><span class="op" id="7754784">.</span><span class="ident" id="7754785">Fatalf</span><span class="op" id="7754791">(</span><span class="string" id="7754792">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="7754807">,</span>&nbsp;<span class="ident" id="7754809">err</span><span class="op" id="7754812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7754815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7754818">if</span>&nbsp;<span class="ident" id="7754821">got</span>&nbsp;<span class="op" id="7754825">:=</span>&nbsp;<span class="builtinfunc" id="7754828">len</span><span class="op" id="7754831">(</span><span class="ident" id="7754832">zr</span><span class="op" id="7754834">.</span><span class="ident" id="7754835">File</span><span class="op" id="7754839">)</span><span class="op" id="7754840">;</span>&nbsp;<span class="ident" id="7754842">got</span>&nbsp;<span class="op" id="7754846">!=</span>&nbsp;<span class="ident" id="7754849">nFiles</span>&nbsp;<span class="op" id="7754856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7754860">t</span><span class="op" id="7754861">.</span><span class="ident" id="7754862">Fatalf</span><span class="op" id="7754868">(</span><span class="string" id="7754869">&#34;File&nbsp;contains&nbsp;%d&nbsp;files,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7754902">,</span>&nbsp;<span class="ident" id="7754904">got</span><span class="op" id="7754907">,</span>&nbsp;<span class="ident" id="7754909">nFiles</span><span class="op" id="7754915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7754918">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7754921">for</span>&nbsp;<span class="ident" id="7754925">i</span>&nbsp;<span class="op" id="7754927">:=</span>&nbsp;<span class="num" id="7754930">0</span><span class="op" id="7754931">;</span>&nbsp;<span class="ident" id="7754933">i</span>&nbsp;<span class="op" id="7754935">&lt;</span>&nbsp;<span class="ident" id="7754937">nFiles</span><span class="op" id="7754943">;</span>&nbsp;<span class="ident" id="7754945">i</span><span class="op" id="7754946">++</span>&nbsp;<span class="op" id="7754949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7754953">want</span>&nbsp;<span class="op" id="7754958">:=</span>&nbsp;<span class="ident" id="7754961">fmt</span><span class="op" id="7754964">.</span><span class="ident" id="7754965">Sprintf</span><span class="op" id="7754972">(</span><span class="string" id="7754973">&#34;%d.dat&#34;</span><span class="op" id="7754981">,</span>&nbsp;<span class="ident" id="7754983">i</span><span class="op" id="7754984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7754988">if</span>&nbsp;<span class="ident" id="7754991">zr</span><span class="op" id="7754993">.</span><span class="ident" id="7754994">File</span><span class="op" id="7754998">[</span><span class="ident" id="7754999">i</span><span class="op" id="7755000">]</span><span class="op" id="7755001">.</span><span class="ident" id="7755002">Name</span>&nbsp;<span class="op" id="7755007">!=</span>&nbsp;<span class="ident" id="7755010">want</span>&nbsp;<span class="op" id="7755015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7755020">t</span><span class="op" id="7755021">.</span><span class="ident" id="7755022">Fatalf</span><span class="op" id="7755028">(</span><span class="string" id="7755029">&#34;File(%d)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7755053">,</span>&nbsp;<span class="ident" id="7755055">i</span><span class="op" id="7755056">,</span>&nbsp;<span class="ident" id="7755058">zr</span><span class="op" id="7755060">.</span><span class="ident" id="7755061">File</span><span class="op" id="7755065">[</span><span class="ident" id="7755066">i</span><span class="op" id="7755067">]</span><span class="op" id="7755068">.</span><span class="ident" id="7755069">Name</span><span class="op" id="7755073">,</span>&nbsp;<span class="ident" id="7755075">want</span><span class="op" id="7755079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7755083">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7755086">}</span><br>
<span class="lineno"></span><span class="op" id="7755088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7755091">func</span>&nbsp;<span class="ident" id="7755096">TestModTime</span><span class="op" id="7755107">(</span><span class="ident" id="7755108">t</span>&nbsp;<span class="op" id="7755110">*</span><span class="ident" id="7755111">testing</span><span class="op" id="7755118">.</span><span class="ident" id="7755119">T</span><span class="op" id="7755120">)</span>&nbsp;<span class="op" id="7755122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7755125">var</span>&nbsp;<span class="ident" id="7755129">testTime</span>&nbsp;<span class="op" id="7755138">=</span>&nbsp;<span class="ident" id="7755140">time</span><span class="op" id="7755144">.</span><span class="ident" id="7755145">Date</span><span class="op" id="7755149">(</span><span class="num" id="7755150">2009</span><span class="op" id="7755154">,</span>&nbsp;<span class="ident" id="7755156">time</span><span class="op" id="7755160">.</span><span class="ident" id="7755161">November</span><span class="op" id="7755169">,</span>&nbsp;<span class="num" id="7755171">10</span><span class="op" id="7755173">,</span>&nbsp;<span class="num" id="7755175">23</span><span class="op" id="7755177">,</span>&nbsp;<span class="num" id="7755179">45</span><span class="op" id="7755181">,</span>&nbsp;<span class="num" id="7755183">58</span><span class="op" id="7755185">,</span>&nbsp;<span class="num" id="7755187">0</span><span class="op" id="7755188">,</span>&nbsp;<span class="ident" id="7755190">time</span><span class="op" id="7755194">.</span><span class="ident" id="7755195">UTC</span><span class="op" id="7755198">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7755201">fh</span>&nbsp;<span class="op" id="7755204">:=</span>&nbsp;<span class="builtinfunc" id="7755207">new</span><span class="op" id="7755210">(</span><span class="ident" id="7755211">FileHeader</span><span class="op" id="7755221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7755224">fh</span><span class="op" id="7755226">.</span><span class="ident" id="7755227">SetModTime</span><span class="op" id="7755237">(</span><span class="ident" id="7755238">testTime</span><span class="op" id="7755246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7755249">outTime</span>&nbsp;<span class="op" id="7755257">:=</span>&nbsp;<span class="ident" id="7755260">fh</span><span class="op" id="7755262">.</span><span class="ident" id="7755263">ModTime</span><span class="op" id="7755270">(</span><span class="op" id="7755271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7755274">if</span>&nbsp;<span class="op" id="7755277">!</span><span class="ident" id="7755278">outTime</span><span class="op" id="7755285">.</span><span class="ident" id="7755286">Equal</span><span class="op" id="7755291">(</span><span class="ident" id="7755292">testTime</span><span class="op" id="7755300">)</span>&nbsp;<span class="op" id="7755302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7755306">t</span><span class="op" id="7755307">.</span><span class="ident" id="7755308">Errorf</span><span class="op" id="7755314">(</span><span class="string" id="7755315">&#34;times&nbsp;don&#39;t&nbsp;match:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7755351">,</span>&nbsp;<span class="ident" id="7755353">outTime</span><span class="op" id="7755360">,</span>&nbsp;<span class="ident" id="7755362">testTime</span><span class="op" id="7755370">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7755373">}</span><br>
<span class="lineno"></span><span class="op" id="7755375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7755378">func</span>&nbsp;<span class="ident" id="7755383">testHeaderRoundTrip</span><span class="op" id="7755402">(</span><span class="ident" id="7755403">fh</span>&nbsp;<span class="op" id="7755406">*</span><span class="ident" id="7755407">FileHeader</span><span class="op" id="7755417">,</span>&nbsp;<span class="ident" id="7755419">wantUncompressedSize</span>&nbsp;<span class="builtintype" id="7755440">uint32</span><span class="op" id="7755446">,</span>&nbsp;<span class="ident" id="7755448">wantUncompressedSize64</span>&nbsp;<span class="ident" id="7755471">uint64</span><span class="op" id="7755477">,</span>&nbsp;<span class="ident" id="7755479">t</span>&nbsp;<span class="op" id="7755481">*</span><span class="ident" id="7755482">testing</span><span class="op" id="7755489">.</span><span class="ident" id="7755490">T</span><span class="op" id="7755491">)</span>&nbsp;<span class="op" id="7755493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7755496">fi</span>&nbsp;<span class="op" id="7755499">:=</span>&nbsp;<span class="ident" id="7755502">fh</span><span class="op" id="7755504">.</span><span class="ident" id="7755505">FileInfo</span><span class="op" id="7755513">(</span><span class="op" id="7755514">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7755517">fh2</span><span class="op" id="7755520">,</span>&nbsp;<span class="ident" id="7755522">err</span>&nbsp;<span class="op" id="7755526">:=</span>&nbsp;<span class="ident" id="7755529">FileInfoHeader</span><span class="op" id="7755543">(</span><span class="ident" id="7755544">fi</span><span class="op" id="7755546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7755549">if</span>&nbsp;<span class="ident" id="7755552">err</span>&nbsp;<span class="op" id="7755556">!=</span>&nbsp;<span class="ident" id="7755559">nil</span>&nbsp;<span class="op" id="7755563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7755567">t</span><span class="op" id="7755568">.</span><span class="ident" id="7755569">Fatal</span><span class="op" id="7755574">(</span><span class="ident" id="7755575">err</span><span class="op" id="7755578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7755581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7755584">if</span>&nbsp;<span class="ident" id="7755587">got</span><span class="op" id="7755590">,</span>&nbsp;<span class="ident" id="7755592">want</span>&nbsp;<span class="op" id="7755597">:=</span>&nbsp;<span class="ident" id="7755600">fh2</span><span class="op" id="7755603">.</span><span class="ident" id="7755604">Name</span><span class="op" id="7755608">,</span>&nbsp;<span class="ident" id="7755610">fh</span><span class="op" id="7755612">.</span><span class="ident" id="7755613">Name</span><span class="op" id="7755617">;</span>&nbsp;<span class="ident" id="7755619">got</span>&nbsp;<span class="op" id="7755623">!=</span>&nbsp;<span class="ident" id="7755626">want</span>&nbsp;<span class="op" id="7755631">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7755635">t</span><span class="op" id="7755636">.</span><span class="ident" id="7755637">Errorf</span><span class="op" id="7755643">(</span><span class="string" id="7755644">&#34;Name:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s\n&#34;</span><span class="op" id="7755669">,</span>&nbsp;<span class="ident" id="7755671">got</span><span class="op" id="7755674">,</span>&nbsp;<span class="ident" id="7755676">want</span><span class="op" id="7755680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7755683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7755686">if</span>&nbsp;<span class="ident" id="7755689">got</span><span class="op" id="7755692">,</span>&nbsp;<span class="ident" id="7755694">want</span>&nbsp;<span class="op" id="7755699">:=</span>&nbsp;<span class="ident" id="7755702">fh2</span><span class="op" id="7755705">.</span><span class="ident" id="7755706">UncompressedSize</span><span class="op" id="7755722">,</span>&nbsp;<span class="ident" id="7755724">wantUncompressedSize</span><span class="op" id="7755744">;</span>&nbsp;<span class="ident" id="7755746">got</span>&nbsp;<span class="op" id="7755750">!=</span>&nbsp;<span class="ident" id="7755753">want</span>&nbsp;<span class="op" id="7755758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7755762">t</span><span class="op" id="7755763">.</span><span class="ident" id="7755764">Errorf</span><span class="op" id="7755770">(</span><span class="string" id="7755771">&#34;UncompressedSize:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7755808">,</span>&nbsp;<span class="ident" id="7755810">got</span><span class="op" id="7755813">,</span>&nbsp;<span class="ident" id="7755815">want</span><span class="op" id="7755819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7755822">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7755825">if</span>&nbsp;<span class="ident" id="7755828">got</span><span class="op" id="7755831">,</span>&nbsp;<span class="ident" id="7755833">want</span>&nbsp;<span class="op" id="7755838">:=</span>&nbsp;<span class="ident" id="7755841">fh2</span><span class="op" id="7755844">.</span><span class="ident" id="7755845">UncompressedSize64</span><span class="op" id="7755863">,</span>&nbsp;<span class="ident" id="7755865">wantUncompressedSize64</span><span class="op" id="7755887">;</span>&nbsp;<span class="ident" id="7755889">got</span>&nbsp;<span class="op" id="7755893">!=</span>&nbsp;<span class="ident" id="7755896">want</span>&nbsp;<span class="op" id="7755901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7755905">t</span><span class="op" id="7755906">.</span><span class="ident" id="7755907">Errorf</span><span class="op" id="7755913">(</span><span class="string" id="7755914">&#34;UncompressedSize64:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7755953">,</span>&nbsp;<span class="ident" id="7755955">got</span><span class="op" id="7755958">,</span>&nbsp;<span class="ident" id="7755960">want</span><span class="op" id="7755964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7755967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7755970">if</span>&nbsp;<span class="ident" id="7755973">got</span><span class="op" id="7755976">,</span>&nbsp;<span class="ident" id="7755978">want</span>&nbsp;<span class="op" id="7755983">:=</span>&nbsp;<span class="ident" id="7755986">fh2</span><span class="op" id="7755989">.</span><span class="ident" id="7755990">ModifiedTime</span><span class="op" id="7756002">,</span>&nbsp;<span class="ident" id="7756004">fh</span><span class="op" id="7756006">.</span><span class="ident" id="7756007">ModifiedTime</span><span class="op" id="7756019">;</span>&nbsp;<span class="ident" id="7756021">got</span>&nbsp;<span class="op" id="7756025">!=</span>&nbsp;<span class="ident" id="7756028">want</span>&nbsp;<span class="op" id="7756033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7756037">t</span><span class="op" id="7756038">.</span><span class="ident" id="7756039">Errorf</span><span class="op" id="7756045">(</span><span class="string" id="7756046">&#34;ModifiedTime:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7756079">,</span>&nbsp;<span class="ident" id="7756081">got</span><span class="op" id="7756084">,</span>&nbsp;<span class="ident" id="7756086">want</span><span class="op" id="7756090">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7756093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7756096">if</span>&nbsp;<span class="ident" id="7756099">got</span><span class="op" id="7756102">,</span>&nbsp;<span class="ident" id="7756104">want</span>&nbsp;<span class="op" id="7756109">:=</span>&nbsp;<span class="ident" id="7756112">fh2</span><span class="op" id="7756115">.</span><span class="ident" id="7756116">ModifiedDate</span><span class="op" id="7756128">,</span>&nbsp;<span class="ident" id="7756130">fh</span><span class="op" id="7756132">.</span><span class="ident" id="7756133">ModifiedDate</span><span class="op" id="7756145">;</span>&nbsp;<span class="ident" id="7756147">got</span>&nbsp;<span class="op" id="7756151">!=</span>&nbsp;<span class="ident" id="7756154">want</span>&nbsp;<span class="op" id="7756159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7756163">t</span><span class="op" id="7756164">.</span><span class="ident" id="7756165">Errorf</span><span class="op" id="7756171">(</span><span class="string" id="7756172">&#34;ModifiedDate:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7756205">,</span>&nbsp;<span class="ident" id="7756207">got</span><span class="op" id="7756210">,</span>&nbsp;<span class="ident" id="7756212">want</span><span class="op" id="7756216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7756219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7756223">if</span>&nbsp;<span class="ident" id="7756226">sysfh</span><span class="op" id="7756231">,</span>&nbsp;<span class="ident" id="7756233">ok</span>&nbsp;<span class="op" id="7756236">:=</span>&nbsp;<span class="ident" id="7756239">fi</span><span class="op" id="7756241">.</span><span class="ident" id="7756242">Sys</span><span class="op" id="7756245">(</span><span class="op" id="7756246">)</span><span class="op" id="7756247">.</span><span class="op" id="7756248">(</span><span class="op" id="7756249">*</span><span class="ident" id="7756250">FileHeader</span><span class="op" id="7756260">)</span><span class="op" id="7756261">;</span>&nbsp;<span class="op" id="7756263">!</span><span class="ident" id="7756264">ok</span>&nbsp;<span class="op" id="7756267">&amp;&amp;</span>&nbsp;<span class="ident" id="7756270">sysfh</span>&nbsp;<span class="op" id="7756276">!=</span>&nbsp;<span class="ident" id="7756279">fh</span>&nbsp;<span class="op" id="7756282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7756286">t</span><span class="op" id="7756287">.</span><span class="ident" id="7756288">Errorf</span><span class="op" id="7756294">(</span><span class="string" id="7756295">&#34;Sys&nbsp;didn&#39;t&nbsp;return&nbsp;original&nbsp;*FileHeader&#34;</span><span class="op" id="7756335">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7756338">}</span><br>
<span class="lineno"></span><span class="op" id="7756340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="7756343">func</span>&nbsp;<span class="ident" id="7756348">TestFileHeaderRoundTrip</span><span class="op" id="7756371">(</span><span class="ident" id="7756372">t</span>&nbsp;<span class="op" id="7756374">*</span><span class="ident" id="7756375">testing</span><span class="op" id="7756382">.</span><span class="ident" id="7756383">T</span><span class="op" id="7756384">)</span>&nbsp;<span class="op" id="7756386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7756389">fh</span>&nbsp;<span class="op" id="7756392">:=</span>&nbsp;<span class="op" id="7756395">&amp;</span><span class="ident" id="7756396">FileHeader</span><span class="op" id="7756406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7756410">Name</span><span class="op" id="7756414">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7756428">&#34;foo.txt&#34;</span><span class="op" id="7756437">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7756441">UncompressedSize</span><span class="op" id="7756457">:</span>&nbsp;<span class="num" id="7756459">987654321</span><span class="op" id="7756468">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7756472">ModifiedTime</span><span class="op" id="7756484">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7756490">1234</span><span class="op" id="7756494">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7756498">ModifiedDate</span><span class="op" id="7756510">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7756516">5678</span><span class="op" id="7756520">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7756523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7756526">testHeaderRoundTrip</span><span class="op" id="7756545">(</span><span class="ident" id="7756546">fh</span><span class="op" id="7756548">,</span>&nbsp;<span class="ident" id="7756550">fh</span><span class="op" id="7756552">.</span><span class="ident" id="7756553">UncompressedSize</span><span class="op" id="7756569">,</span>&nbsp;<span class="ident" id="7756571">uint64</span><span class="op" id="7756577">(</span><span class="ident" id="7756578">fh</span><span class="op" id="7756580">.</span><span class="ident" id="7756581">UncompressedSize</span><span class="op" id="7756597">)</span><span class="op" id="7756598">,</span>&nbsp;<span class="ident" id="7756600">t</span><span class="op" id="7756601">)</span><br>
<span class="lineno"></span><span class="op" id="7756603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="7756606">func</span>&nbsp;<span class="ident" id="7756611">TestFileHeaderRoundTrip64</span><span class="op" id="7756636">(</span><span class="ident" id="7756637">t</span>&nbsp;<span class="op" id="7756639">*</span><span class="ident" id="7756640">testing</span><span class="op" id="7756647">.</span><span class="ident" id="7756648">T</span><span class="op" id="7756649">)</span>&nbsp;<span class="op" id="7756651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7756654">fh</span>&nbsp;<span class="op" id="7756657">:=</span>&nbsp;<span class="op" id="7756660">&amp;</span><span class="ident" id="7756661">FileHeader</span><span class="op" id="7756671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7756675">Name</span><span class="op" id="7756679">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7756695">&#34;foo.txt&#34;</span><span class="op" id="7756704">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7756708">UncompressedSize64</span><span class="op" id="7756726">:</span>&nbsp;<span class="num" id="7756728">9876543210</span><span class="op" id="7756738">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7756742">ModifiedTime</span><span class="op" id="7756754">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7756762">1234</span><span class="op" id="7756766">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7756770">ModifiedDate</span><span class="op" id="7756782">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7756790">5678</span><span class="op" id="7756794">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7756797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7756800">testHeaderRoundTrip</span><span class="op" id="7756819">(</span><span class="ident" id="7756820">fh</span><span class="op" id="7756822">,</span>&nbsp;<span class="ident" id="7756824">uint32max</span><span class="op" id="7756833">,</span>&nbsp;<span class="ident" id="7756835">fh</span><span class="op" id="7756837">.</span><span class="ident" id="7756838">UncompressedSize64</span><span class="op" id="7756856">,</span>&nbsp;<span class="ident" id="7756858">t</span><span class="op" id="7756859">)</span><br>
<span class="lineno"></span><span class="op" id="7756861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="7756864">type</span>&nbsp;<span class="ident" id="7756869">repeatedByte</span>&nbsp;<span class="keyword" id="7756882">struct</span>&nbsp;<span class="op" id="7756889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7756892">off</span>&nbsp;<span class="ident" id="7756896">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7756903">b</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7756907">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7756913">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7756917">int64</span><br>
<span class="lineno"></span><span class="op" id="7756923">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="7756926">//&nbsp;rleBuffer&nbsp;is&nbsp;a&nbsp;run-length-encoded&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="7756976">//&nbsp;It&#39;s&nbsp;an&nbsp;io.Writer&nbsp;(like&nbsp;a&nbsp;bytes.Buffer)&nbsp;and&nbsp;also&nbsp;an&nbsp;io.ReaderAt,</span><br>
<span class="lineno"></span><span class="comment" id="7757044">//&nbsp;allowing&nbsp;random-access&nbsp;reads.</span><br>
<span class="lineno"></span><span class="keyword" id="7757077">type</span>&nbsp;<span class="ident" id="7757082">rleBuffer</span>&nbsp;<span class="keyword" id="7757092">struct</span>&nbsp;<span class="op" id="7757099">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7757102">buf</span>&nbsp;<span class="op" id="7757106">[</span><span class="op" id="7757107">]</span><span class="ident" id="7757108">repeatedByte</span><br>
<span class="lineno"></span><span class="op" id="7757121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7757124">func</span>&nbsp;<span class="op" id="7757129">(</span><span class="ident" id="7757130">r</span>&nbsp;<span class="op" id="7757132">*</span><span class="ident" id="7757133">rleBuffer</span><span class="op" id="7757142">)</span>&nbsp;<span class="ident" id="7757144">Size</span><span class="op" id="7757148">(</span><span class="op" id="7757149">)</span>&nbsp;<span class="ident" id="7757151">int64</span>&nbsp;<span class="op" id="7757157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7757160">if</span>&nbsp;<span class="builtinfunc" id="7757163">len</span><span class="op" id="7757166">(</span><span class="ident" id="7757167">r</span><span class="op" id="7757168">.</span><span class="ident" id="7757169">buf</span><span class="op" id="7757172">)</span>&nbsp;<span class="op" id="7757174">==</span>&nbsp;<span class="num" id="7757177">0</span>&nbsp;<span class="op" id="7757179">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7757183">return</span>&nbsp;<span class="num" id="7757190">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7757193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7757196">last</span>&nbsp;<span class="op" id="7757201">:=</span>&nbsp;<span class="op" id="7757204">&amp;</span><span class="ident" id="7757205">r</span><span class="op" id="7757206">.</span><span class="ident" id="7757207">buf</span><span class="op" id="7757210">[</span><span class="builtinfunc" id="7757211">len</span><span class="op" id="7757214">(</span><span class="ident" id="7757215">r</span><span class="op" id="7757216">.</span><span class="ident" id="7757217">buf</span><span class="op" id="7757220">)</span><span class="op" id="7757221">-</span><span class="num" id="7757222">1</span><span class="op" id="7757223">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7757226">return</span>&nbsp;<span class="ident" id="7757233">last</span><span class="op" id="7757237">.</span><span class="ident" id="7757238">off</span>&nbsp;<span class="op" id="7757242">+</span>&nbsp;<span class="ident" id="7757244">last</span><span class="op" id="7757248">.</span><span class="ident" id="7757249">n</span><br>
<span class="lineno"></span><span class="op" id="7757251">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="7757254">func</span>&nbsp;<span class="op" id="7757259">(</span><span class="ident" id="7757260">r</span>&nbsp;<span class="op" id="7757262">*</span><span class="ident" id="7757263">rleBuffer</span><span class="op" id="7757272">)</span>&nbsp;<span class="ident" id="7757274">Write</span><span class="op" id="7757279">(</span><span class="ident" id="7757280">p</span>&nbsp;<span class="op" id="7757282">[</span><span class="op" id="7757283">]</span><span class="builtintype" id="7757284">byte</span><span class="op" id="7757288">)</span>&nbsp;<span class="op" id="7757290">(</span><span class="ident" id="7757291">n</span>&nbsp;<span class="builtintype" id="7757293">int</span><span class="op" id="7757296">,</span>&nbsp;<span class="ident" id="7757298">err</span>&nbsp;<span class="builtintype" id="7757302">error</span><span class="op" id="7757307">)</span>&nbsp;<span class="op" id="7757309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7757312">var</span>&nbsp;<span class="ident" id="7757316">rp</span>&nbsp;<span class="op" id="7757319">*</span><span class="ident" id="7757320">repeatedByte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7757334">if</span>&nbsp;<span class="builtinfunc" id="7757337">len</span><span class="op" id="7757340">(</span><span class="ident" id="7757341">r</span><span class="op" id="7757342">.</span><span class="ident" id="7757343">buf</span><span class="op" id="7757346">)</span>&nbsp;<span class="op" id="7757348">&gt;</span>&nbsp;<span class="num" id="7757350">0</span>&nbsp;<span class="op" id="7757352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7757356">rp</span>&nbsp;<span class="op" id="7757359">=</span>&nbsp;<span class="op" id="7757361">&amp;</span><span class="ident" id="7757362">r</span><span class="op" id="7757363">.</span><span class="ident" id="7757364">buf</span><span class="op" id="7757367">[</span><span class="builtinfunc" id="7757368">len</span><span class="op" id="7757371">(</span><span class="ident" id="7757372">r</span><span class="op" id="7757373">.</span><span class="ident" id="7757374">buf</span><span class="op" id="7757377">)</span><span class="op" id="7757378">-</span><span class="num" id="7757379">1</span><span class="op" id="7757380">]</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7757384">//&nbsp;Fast&nbsp;path,&nbsp;if&nbsp;p&nbsp;is&nbsp;entirely&nbsp;the&nbsp;same&nbsp;byte&nbsp;repeated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7757441">if</span>&nbsp;<span class="ident" id="7757444">lastByte</span>&nbsp;<span class="op" id="7757453">:=</span>&nbsp;<span class="ident" id="7757456">rp</span><span class="op" id="7757458">.</span><span class="ident" id="7757459">b</span><span class="op" id="7757460">;</span>&nbsp;<span class="builtinfunc" id="7757462">len</span><span class="op" id="7757465">(</span><span class="ident" id="7757466">p</span><span class="op" id="7757467">)</span>&nbsp;<span class="op" id="7757469">&gt;</span>&nbsp;<span class="num" id="7757471">0</span>&nbsp;<span class="op" id="7757473">&amp;&amp;</span>&nbsp;<span class="ident" id="7757476">p</span><span class="op" id="7757477">[</span><span class="num" id="7757478">0</span><span class="op" id="7757479">]</span>&nbsp;<span class="op" id="7757481">==</span>&nbsp;<span class="ident" id="7757484">lastByte</span>&nbsp;<span class="op" id="7757493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7757498">all</span>&nbsp;<span class="op" id="7757502">:=</span>&nbsp;<span class="ident" id="7757505">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7757513">for</span>&nbsp;<span class="ident" id="7757517">_</span><span class="op" id="7757518">,</span>&nbsp;<span class="ident" id="7757520">b</span>&nbsp;<span class="op" id="7757522">:=</span>&nbsp;<span class="keyword" id="7757525">range</span>&nbsp;<span class="ident" id="7757531">p</span>&nbsp;<span class="op" id="7757533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7757539">if</span>&nbsp;<span class="ident" id="7757542">b</span>&nbsp;<span class="op" id="7757544">!=</span>&nbsp;<span class="ident" id="7757547">lastByte</span>&nbsp;<span class="op" id="7757556">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7757563">all</span>&nbsp;<span class="op" id="7757567">=</span>&nbsp;<span class="ident" id="7757569">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7757580">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7757590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7757595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7757600">if</span>&nbsp;<span class="ident" id="7757603">all</span>&nbsp;<span class="op" id="7757607">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7757613">rp</span><span class="op" id="7757615">.</span><span class="ident" id="7757616">n</span>&nbsp;<span class="op" id="7757618">+=</span>&nbsp;<span class="ident" id="7757621">int64</span><span class="op" id="7757626">(</span><span class="builtinfunc" id="7757627">len</span><span class="op" id="7757630">(</span><span class="ident" id="7757631">p</span><span class="op" id="7757632">)</span><span class="op" id="7757633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7757639">return</span>&nbsp;<span class="builtinfunc" id="7757646">len</span><span class="op" id="7757649">(</span><span class="ident" id="7757650">p</span><span class="op" id="7757651">)</span><span class="op" id="7757652">,</span>&nbsp;<span class="ident" id="7757654">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7757661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7757665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7757668">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7757672">for</span>&nbsp;<span class="ident" id="7757676">_</span><span class="op" id="7757677">,</span>&nbsp;<span class="ident" id="7757679">b</span>&nbsp;<span class="op" id="7757681">:=</span>&nbsp;<span class="keyword" id="7757684">range</span>&nbsp;<span class="ident" id="7757690">p</span>&nbsp;<span class="op" id="7757692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7757696">if</span>&nbsp;<span class="ident" id="7757699">rp</span>&nbsp;<span class="op" id="7757702">==</span>&nbsp;<span class="ident" id="7757705">nil</span>&nbsp;<span class="op" id="7757709">||</span>&nbsp;<span class="ident" id="7757712">rp</span><span class="op" id="7757714">.</span><span class="ident" id="7757715">b</span>&nbsp;<span class="op" id="7757717">!=</span>&nbsp;<span class="ident" id="7757720">b</span>&nbsp;<span class="op" id="7757722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7757727">r</span><span class="op" id="7757728">.</span><span class="ident" id="7757729">buf</span>&nbsp;<span class="op" id="7757733">=</span>&nbsp;<span class="builtinfunc" id="7757735">append</span><span class="op" id="7757741">(</span><span class="ident" id="7757742">r</span><span class="op" id="7757743">.</span><span class="ident" id="7757744">buf</span><span class="op" id="7757747">,</span>&nbsp;<span class="ident" id="7757749">repeatedByte</span><span class="op" id="7757761">{</span><span class="ident" id="7757762">r</span><span class="op" id="7757763">.</span><span class="ident" id="7757764">Size</span><span class="op" id="7757768">(</span><span class="op" id="7757769">)</span><span class="op" id="7757770">,</span>&nbsp;<span class="ident" id="7757772">b</span><span class="op" id="7757773">,</span>&nbsp;<span class="num" id="7757775">1</span><span class="op" id="7757776">}</span><span class="op" id="7757777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7757782">rp</span>&nbsp;<span class="op" id="7757785">=</span>&nbsp;<span class="op" id="7757787">&amp;</span><span class="ident" id="7757788">r</span><span class="op" id="7757789">.</span><span class="ident" id="7757790">buf</span><span class="op" id="7757793">[</span><span class="builtinfunc" id="7757794">len</span><span class="op" id="7757797">(</span><span class="ident" id="7757798">r</span><span class="op" id="7757799">.</span><span class="ident" id="7757800">buf</span><span class="op" id="7757803">)</span><span class="op" id="7757804">-</span><span class="num" id="7757805">1</span><span class="op" id="7757806">]</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7757810">}</span>&nbsp;<span class="keyword" id="7757812">else</span>&nbsp;<span class="op" id="7757817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7757822">rp</span><span class="op" id="7757824">.</span><span class="ident" id="7757825">n</span><span class="op" id="7757826">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7757831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7757834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7757837">return</span>&nbsp;<span class="builtinfunc" id="7757844">len</span><span class="op" id="7757847">(</span><span class="ident" id="7757848">p</span><span class="op" id="7757849">)</span><span class="op" id="7757850">,</span>&nbsp;<span class="ident" id="7757852">nil</span><br>
<span class="lineno">160</span><span class="op" id="7757856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7757859">func</span>&nbsp;<span class="op" id="7757864">(</span><span class="ident" id="7757865">r</span>&nbsp;<span class="op" id="7757867">*</span><span class="ident" id="7757868">rleBuffer</span><span class="op" id="7757877">)</span>&nbsp;<span class="ident" id="7757879">ReadAt</span><span class="op" id="7757885">(</span><span class="ident" id="7757886">p</span>&nbsp;<span class="op" id="7757888">[</span><span class="op" id="7757889">]</span><span class="builtintype" id="7757890">byte</span><span class="op" id="7757894">,</span>&nbsp;<span class="ident" id="7757896">off</span>&nbsp;<span class="ident" id="7757900">int64</span><span class="op" id="7757905">)</span>&nbsp;<span class="op" id="7757907">(</span><span class="ident" id="7757908">n</span>&nbsp;<span class="builtintype" id="7757910">int</span><span class="op" id="7757913">,</span>&nbsp;<span class="ident" id="7757915">err</span>&nbsp;<span class="builtintype" id="7757919">error</span><span class="op" id="7757924">)</span>&nbsp;<span class="op" id="7757926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7757929">if</span>&nbsp;<span class="builtinfunc" id="7757932">len</span><span class="op" id="7757935">(</span><span class="ident" id="7757936">p</span><span class="op" id="7757937">)</span>&nbsp;<span class="op" id="7757939">==</span>&nbsp;<span class="num" id="7757942">0</span>&nbsp;<span class="op" id="7757944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7757948">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7757956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7757959">skipParts</span>&nbsp;<span class="op" id="7757969">:=</span>&nbsp;<span class="ident" id="7757972">sort</span><span class="op" id="7757976">.</span><span class="ident" id="7757977">Search</span><span class="op" id="7757983">(</span><span class="builtinfunc" id="7757984">len</span><span class="op" id="7757987">(</span><span class="ident" id="7757988">r</span><span class="op" id="7757989">.</span><span class="ident" id="7757990">buf</span><span class="op" id="7757993">)</span><span class="op" id="7757994">,</span>&nbsp;<span class="keyword" id="7757996">func</span><span class="op" id="7758000">(</span><span class="ident" id="7758001">i</span>&nbsp;<span class="builtintype" id="7758003">int</span><span class="op" id="7758006">)</span>&nbsp;<span class="builtintype" id="7758008">bool</span>&nbsp;<span class="op" id="7758013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7758017">part</span>&nbsp;<span class="op" id="7758022">:=</span>&nbsp;<span class="op" id="7758025">&amp;</span><span class="ident" id="7758026">r</span><span class="op" id="7758027">.</span><span class="ident" id="7758028">buf</span><span class="op" id="7758031">[</span><span class="ident" id="7758032">i</span><span class="op" id="7758033">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7758037">return</span>&nbsp;<span class="ident" id="7758044">part</span><span class="op" id="7758048">.</span><span class="ident" id="7758049">off</span><span class="op" id="7758052">+</span><span class="ident" id="7758053">part</span><span class="op" id="7758057">.</span><span class="ident" id="7758058">n</span>&nbsp;<span class="op" id="7758060">&gt;</span>&nbsp;<span class="ident" id="7758062">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7758067">}</span><span class="op" id="7758068">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7758071">parts</span>&nbsp;<span class="op" id="7758077">:=</span>&nbsp;<span class="ident" id="7758080">r</span><span class="op" id="7758081">.</span><span class="ident" id="7758082">buf</span><span class="op" id="7758085">[</span><span class="ident" id="7758086">skipParts</span><span class="op" id="7758095">:</span><span class="op" id="7758096">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7758099">if</span>&nbsp;<span class="builtinfunc" id="7758102">len</span><span class="op" id="7758105">(</span><span class="ident" id="7758106">parts</span><span class="op" id="7758111">)</span>&nbsp;<span class="op" id="7758113">&gt;</span>&nbsp;<span class="num" id="7758115">0</span>&nbsp;<span class="op" id="7758117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7758121">skipBytes</span>&nbsp;<span class="op" id="7758131">:=</span>&nbsp;<span class="ident" id="7758134">off</span>&nbsp;<span class="op" id="7758138">-</span>&nbsp;<span class="ident" id="7758140">parts</span><span class="op" id="7758145">[</span><span class="num" id="7758146">0</span><span class="op" id="7758147">]</span><span class="op" id="7758148">.</span><span class="ident" id="7758149">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7758155">for</span>&nbsp;<span class="builtinfunc" id="7758159">len</span><span class="op" id="7758162">(</span><span class="ident" id="7758163">parts</span><span class="op" id="7758168">)</span>&nbsp;<span class="op" id="7758170">&gt;</span>&nbsp;<span class="num" id="7758172">0</span>&nbsp;<span class="op" id="7758174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7758179">part</span>&nbsp;<span class="op" id="7758184">:=</span>&nbsp;<span class="ident" id="7758187">parts</span><span class="op" id="7758192">[</span><span class="num" id="7758193">0</span><span class="op" id="7758194">]</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7758199">for</span>&nbsp;<span class="ident" id="7758203">i</span>&nbsp;<span class="op" id="7758205">:=</span>&nbsp;<span class="ident" id="7758208">skipBytes</span><span class="op" id="7758217">;</span>&nbsp;<span class="ident" id="7758219">i</span>&nbsp;<span class="op" id="7758221">&lt;</span>&nbsp;<span class="ident" id="7758223">part</span><span class="op" id="7758227">.</span><span class="ident" id="7758228">n</span><span class="op" id="7758229">;</span>&nbsp;<span class="ident" id="7758231">i</span><span class="op" id="7758232">++</span>&nbsp;<span class="op" id="7758235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7758241">if</span>&nbsp;<span class="ident" id="7758244">n</span>&nbsp;<span class="op" id="7758246">==</span>&nbsp;<span class="builtinfunc" id="7758249">len</span><span class="op" id="7758252">(</span><span class="ident" id="7758253">p</span><span class="op" id="7758254">)</span>&nbsp;<span class="op" id="7758256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7758263">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7758274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7758280">p</span><span class="op" id="7758281">[</span><span class="ident" id="7758282">n</span><span class="op" id="7758283">]</span>&nbsp;<span class="op" id="7758285">=</span>&nbsp;<span class="ident" id="7758287">part</span><span class="op" id="7758291">.</span><span class="ident" id="7758292">b</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7758298">n</span><span class="op" id="7758299">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7758305">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7758310">parts</span>&nbsp;<span class="op" id="7758316">=</span>&nbsp;<span class="ident" id="7758318">parts</span><span class="op" id="7758323">[</span><span class="num" id="7758324">1</span><span class="op" id="7758325">:</span><span class="op" id="7758326">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7758331">skipBytes</span>&nbsp;<span class="op" id="7758341">=</span>&nbsp;<span class="num" id="7758343">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7758347">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7758350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7758353">if</span>&nbsp;<span class="ident" id="7758356">n</span>&nbsp;<span class="op" id="7758358">!=</span>&nbsp;<span class="builtinfunc" id="7758361">len</span><span class="op" id="7758364">(</span><span class="ident" id="7758365">p</span><span class="op" id="7758366">)</span>&nbsp;<span class="op" id="7758368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7758372">err</span>&nbsp;<span class="op" id="7758376">=</span>&nbsp;<span class="ident" id="7758378">io</span><span class="op" id="7758380">.</span><span class="ident" id="7758381">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7758399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7758402">return</span><br>
<span class="lineno">190</span><span class="op" id="7758409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7758412">//&nbsp;Just&nbsp;testing&nbsp;the&nbsp;rleBuffer&nbsp;used&nbsp;in&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above.&nbsp;Not&nbsp;used&nbsp;by&nbsp;the&nbsp;zip&nbsp;code.</span><br>
<span class="lineno"></span><span class="keyword" id="7758498">func</span>&nbsp;<span class="ident" id="7758503">TestRLEBuffer</span><span class="op" id="7758516">(</span><span class="ident" id="7758517">t</span>&nbsp;<span class="op" id="7758519">*</span><span class="ident" id="7758520">testing</span><span class="op" id="7758527">.</span><span class="ident" id="7758528">T</span><span class="op" id="7758529">)</span>&nbsp;<span class="op" id="7758531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7758534">b</span>&nbsp;<span class="op" id="7758536">:=</span>&nbsp;<span class="builtinfunc" id="7758539">new</span><span class="op" id="7758542">(</span><span class="ident" id="7758543">rleBuffer</span><span class="op" id="7758552">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7758555">var</span>&nbsp;<span class="ident" id="7758559">all</span>&nbsp;<span class="op" id="7758563">[</span><span class="op" id="7758564">]</span><span class="builtintype" id="7758565">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7758571">writes</span>&nbsp;<span class="op" id="7758578">:=</span>&nbsp;<span class="op" id="7758581">[</span><span class="op" id="7758582">]</span><span class="builtintype" id="7758583">string</span><span class="op" id="7758589">{</span><span class="string" id="7758590">&#34;abcdeee&#34;</span><span class="op" id="7758599">,</span>&nbsp;<span class="string" id="7758601">&#34;eeeeeee&#34;</span><span class="op" id="7758610">,</span>&nbsp;<span class="string" id="7758612">&#34;eeeefghaaiii&#34;</span><span class="op" id="7758626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7758629">for</span>&nbsp;<span class="ident" id="7758633">_</span><span class="op" id="7758634">,</span>&nbsp;<span class="ident" id="7758636">w</span>&nbsp;<span class="op" id="7758638">:=</span>&nbsp;<span class="keyword" id="7758641">range</span>&nbsp;<span class="ident" id="7758647">writes</span>&nbsp;<span class="op" id="7758654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7758658">b</span><span class="op" id="7758659">.</span><span class="ident" id="7758660">Write</span><span class="op" id="7758665">(</span><span class="op" id="7758666">[</span><span class="op" id="7758667">]</span><span class="builtintype" id="7758668">byte</span><span class="op" id="7758672">(</span><span class="ident" id="7758673">w</span><span class="op" id="7758674">)</span><span class="op" id="7758675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7758679">all</span>&nbsp;<span class="op" id="7758683">=</span>&nbsp;<span class="builtinfunc" id="7758685">append</span><span class="op" id="7758691">(</span><span class="ident" id="7758692">all</span><span class="op" id="7758695">,</span>&nbsp;<span class="ident" id="7758697">w</span><span class="op" id="7758698">...</span><span class="op" id="7758701">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7758704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7758707">if</span>&nbsp;<span class="builtinfunc" id="7758710">len</span><span class="op" id="7758713">(</span><span class="ident" id="7758714">b</span><span class="op" id="7758715">.</span><span class="ident" id="7758716">buf</span><span class="op" id="7758719">)</span>&nbsp;<span class="op" id="7758721">!=</span>&nbsp;<span class="num" id="7758724">10</span>&nbsp;<span class="op" id="7758727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7758731">t</span><span class="op" id="7758732">.</span><span class="ident" id="7758733">Fatalf</span><span class="op" id="7758739">(</span><span class="string" id="7758740">&#34;len(b.buf)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;10&#34;</span><span class="op" id="7758766">,</span>&nbsp;<span class="builtinfunc" id="7758768">len</span><span class="op" id="7758771">(</span><span class="ident" id="7758772">b</span><span class="op" id="7758773">.</span><span class="ident" id="7758774">buf</span><span class="op" id="7758777">)</span><span class="op" id="7758778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7758781">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7758785">for</span>&nbsp;<span class="ident" id="7758789">i</span>&nbsp;<span class="op" id="7758791">:=</span>&nbsp;<span class="num" id="7758794">0</span><span class="op" id="7758795">;</span>&nbsp;<span class="ident" id="7758797">i</span>&nbsp;<span class="op" id="7758799">&lt;</span>&nbsp;<span class="builtinfunc" id="7758801">len</span><span class="op" id="7758804">(</span><span class="ident" id="7758805">all</span><span class="op" id="7758808">)</span><span class="op" id="7758809">;</span>&nbsp;<span class="ident" id="7758811">i</span><span class="op" id="7758812">++</span>&nbsp;<span class="op" id="7758815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7758819">for</span>&nbsp;<span class="ident" id="7758823">j</span>&nbsp;<span class="op" id="7758825">:=</span>&nbsp;<span class="num" id="7758828">0</span><span class="op" id="7758829">;</span>&nbsp;<span class="ident" id="7758831">j</span>&nbsp;<span class="op" id="7758833">&lt;</span>&nbsp;<span class="builtinfunc" id="7758835">len</span><span class="op" id="7758838">(</span><span class="ident" id="7758839">all</span><span class="op" id="7758842">)</span><span class="op" id="7758843">-</span><span class="ident" id="7758844">i</span><span class="op" id="7758845">;</span>&nbsp;<span class="ident" id="7758847">j</span><span class="op" id="7758848">++</span>&nbsp;<span class="op" id="7758851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7758856">buf</span>&nbsp;<span class="op" id="7758860">:=</span>&nbsp;<span class="builtinfunc" id="7758863">make</span><span class="op" id="7758867">(</span><span class="op" id="7758868">[</span><span class="op" id="7758869">]</span><span class="builtintype" id="7758870">byte</span><span class="op" id="7758874">,</span>&nbsp;<span class="ident" id="7758876">j</span><span class="op" id="7758877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7758882">n</span><span class="op" id="7758883">,</span>&nbsp;<span class="ident" id="7758885">err</span>&nbsp;<span class="op" id="7758889">:=</span>&nbsp;<span class="ident" id="7758892">b</span><span class="op" id="7758893">.</span><span class="ident" id="7758894">ReadAt</span><span class="op" id="7758900">(</span><span class="ident" id="7758901">buf</span><span class="op" id="7758904">,</span>&nbsp;<span class="ident" id="7758906">int64</span><span class="op" id="7758911">(</span><span class="ident" id="7758912">i</span><span class="op" id="7758913">)</span><span class="op" id="7758914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7758919">if</span>&nbsp;<span class="ident" id="7758922">err</span>&nbsp;<span class="op" id="7758926">!=</span>&nbsp;<span class="ident" id="7758929">nil</span>&nbsp;<span class="op" id="7758933">||</span>&nbsp;<span class="ident" id="7758936">n</span>&nbsp;<span class="op" id="7758938">!=</span>&nbsp;<span class="builtinfunc" id="7758941">len</span><span class="op" id="7758944">(</span><span class="ident" id="7758945">buf</span><span class="op" id="7758948">)</span>&nbsp;<span class="op" id="7758950">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7758956">t</span><span class="op" id="7758957">.</span><span class="ident" id="7758958">Errorf</span><span class="op" id="7758964">(</span><span class="string" id="7758965">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="7759004">,</span>&nbsp;<span class="ident" id="7759006">i</span><span class="op" id="7759007">,</span>&nbsp;<span class="ident" id="7759009">j</span><span class="op" id="7759010">,</span>&nbsp;<span class="ident" id="7759012">n</span><span class="op" id="7759013">,</span>&nbsp;<span class="ident" id="7759015">err</span><span class="op" id="7759018">,</span>&nbsp;<span class="builtinfunc" id="7759020">len</span><span class="op" id="7759023">(</span><span class="ident" id="7759024">buf</span><span class="op" id="7759027">)</span><span class="op" id="7759028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7759033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7759038">if</span>&nbsp;<span class="op" id="7759041">!</span><span class="ident" id="7759042">bytes</span><span class="op" id="7759047">.</span><span class="ident" id="7759048">Equal</span><span class="op" id="7759053">(</span><span class="ident" id="7759054">buf</span><span class="op" id="7759057">,</span>&nbsp;<span class="ident" id="7759059">all</span><span class="op" id="7759062">[</span><span class="ident" id="7759063">i</span><span class="op" id="7759064">:</span><span class="ident" id="7759065">i</span><span class="op" id="7759066">+</span><span class="ident" id="7759067">j</span><span class="op" id="7759068">]</span><span class="op" id="7759069">)</span>&nbsp;<span class="op" id="7759071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7759077">t</span><span class="op" id="7759078">.</span><span class="ident" id="7759079">Errorf</span><span class="op" id="7759085">(</span><span class="string" id="7759086">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7759116">,</span>&nbsp;<span class="ident" id="7759118">i</span><span class="op" id="7759119">,</span>&nbsp;<span class="ident" id="7759121">j</span><span class="op" id="7759122">,</span>&nbsp;<span class="ident" id="7759124">buf</span><span class="op" id="7759127">,</span>&nbsp;<span class="ident" id="7759129">all</span><span class="op" id="7759132">[</span><span class="ident" id="7759133">i</span><span class="op" id="7759134">:</span><span class="ident" id="7759135">i</span><span class="op" id="7759136">+</span><span class="ident" id="7759137">j</span><span class="op" id="7759138">]</span><span class="op" id="7759139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7759144">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7759148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7759151">}</span><br>
<span class="lineno"></span><span class="op" id="7759153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7759156">//&nbsp;fakeHash32&nbsp;is&nbsp;a&nbsp;dummy&nbsp;Hash32&nbsp;that&nbsp;always&nbsp;returns&nbsp;0.</span><br>
<span class="lineno">220</span><span class="keyword" id="7759211">type</span>&nbsp;<span class="ident" id="7759216">fakeHash32</span>&nbsp;<span class="keyword" id="7759227">struct</span>&nbsp;<span class="op" id="7759234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7759237">hash</span><span class="op" id="7759241">.</span><span class="ident" id="7759242">Hash32</span><br>
<span class="lineno"></span><span class="op" id="7759249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7759252">func</span>&nbsp;<span class="op" id="7759257">(</span><span class="ident" id="7759258">fakeHash32</span><span class="op" id="7759268">)</span>&nbsp;<span class="ident" id="7759270">Write</span><span class="op" id="7759275">(</span><span class="ident" id="7759276">p</span>&nbsp;<span class="op" id="7759278">[</span><span class="op" id="7759279">]</span><span class="builtintype" id="7759280">byte</span><span class="op" id="7759284">)</span>&nbsp;<span class="op" id="7759286">(</span><span class="builtintype" id="7759287">int</span><span class="op" id="7759290">,</span>&nbsp;<span class="builtintype" id="7759292">error</span><span class="op" id="7759297">)</span>&nbsp;<span class="op" id="7759299">{</span>&nbsp;<span class="keyword" id="7759301">return</span>&nbsp;<span class="builtinfunc" id="7759308">len</span><span class="op" id="7759311">(</span><span class="ident" id="7759312">p</span><span class="op" id="7759313">)</span><span class="op" id="7759314">,</span>&nbsp;<span class="ident" id="7759316">nil</span>&nbsp;<span class="op" id="7759320">}</span><br>
<span class="lineno">225</span><span class="keyword" id="7759322">func</span>&nbsp;<span class="op" id="7759327">(</span><span class="ident" id="7759328">fakeHash32</span><span class="op" id="7759338">)</span>&nbsp;<span class="ident" id="7759340">Sum32</span><span class="op" id="7759345">(</span><span class="op" id="7759346">)</span>&nbsp;<span class="builtintype" id="7759348">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7759369">{</span>&nbsp;<span class="keyword" id="7759371">return</span>&nbsp;<span class="num" id="7759378">0</span>&nbsp;<span class="op" id="7759380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7759383">func</span>&nbsp;<span class="ident" id="7759388">TestZip64</span><span class="op" id="7759397">(</span><span class="ident" id="7759398">t</span>&nbsp;<span class="op" id="7759400">*</span><span class="ident" id="7759401">testing</span><span class="op" id="7759408">.</span><span class="ident" id="7759409">T</span><span class="op" id="7759410">)</span>&nbsp;<span class="op" id="7759412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7759415">if</span>&nbsp;<span class="ident" id="7759418">testing</span><span class="op" id="7759425">.</span><span class="ident" id="7759426">Short</span><span class="op" id="7759431">(</span><span class="op" id="7759432">)</span>&nbsp;<span class="op" id="7759434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7759438">t</span><span class="op" id="7759439">.</span><span class="ident" id="7759440">Skip</span><span class="op" id="7759444">(</span><span class="string" id="7759445">&#34;slow&nbsp;test;&nbsp;skipping&#34;</span><span class="op" id="7759466">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7759469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7759472">const</span>&nbsp;<span class="ident" id="7759478">size</span>&nbsp;<span class="op" id="7759483">=</span>&nbsp;<span class="num" id="7759485">1</span>&nbsp;<span class="op" id="7759487">&lt;&lt;</span>&nbsp;<span class="num" id="7759490">32</span>&nbsp;<span class="comment" id="7759493">//&nbsp;before&nbsp;the&nbsp;&#34;END\n&#34;&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7759521">testZip64</span><span class="op" id="7759530">(</span><span class="ident" id="7759531">t</span><span class="op" id="7759532">,</span>&nbsp;<span class="ident" id="7759534">size</span><span class="op" id="7759538">)</span><br>
<span class="lineno"></span><span class="op" id="7759540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="7759543">func</span>&nbsp;<span class="ident" id="7759548">testZip64</span><span class="op" id="7759557">(</span><span class="ident" id="7759558">t</span>&nbsp;<span class="ident" id="7759560">testing</span><span class="op" id="7759567">.</span><span class="ident" id="7759568">TB</span><span class="op" id="7759570">,</span>&nbsp;<span class="ident" id="7759572">size</span>&nbsp;<span class="ident" id="7759577">int64</span><span class="op" id="7759582">)</span>&nbsp;<span class="op" id="7759584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7759587">const</span>&nbsp;<span class="ident" id="7759593">chunkSize</span>&nbsp;<span class="op" id="7759603">=</span>&nbsp;<span class="num" id="7759605">1024</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7759611">chunks</span>&nbsp;<span class="op" id="7759618">:=</span>&nbsp;<span class="builtintype" id="7759621">int</span><span class="op" id="7759624">(</span><span class="ident" id="7759625">size</span>&nbsp;<span class="op" id="7759630">/</span>&nbsp;<span class="ident" id="7759632">chunkSize</span><span class="op" id="7759641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7759644">//&nbsp;write&nbsp;2^32&nbsp;bytes&nbsp;plus&nbsp;&#34;END\n&#34;&nbsp;to&nbsp;a&nbsp;zip&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7759692">buf</span>&nbsp;<span class="op" id="7759696">:=</span>&nbsp;<span class="builtinfunc" id="7759699">new</span><span class="op" id="7759702">(</span><span class="ident" id="7759703">rleBuffer</span><span class="op" id="7759712">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7759715">w</span>&nbsp;<span class="op" id="7759717">:=</span>&nbsp;<span class="ident" id="7759720">NewWriter</span><span class="op" id="7759729">(</span><span class="ident" id="7759730">buf</span><span class="op" id="7759733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7759736">f</span><span class="op" id="7759737">,</span>&nbsp;<span class="ident" id="7759739">err</span>&nbsp;<span class="op" id="7759743">:=</span>&nbsp;<span class="ident" id="7759746">w</span><span class="op" id="7759747">.</span><span class="ident" id="7759748">CreateHeader</span><span class="op" id="7759760">(</span><span class="op" id="7759761">&amp;</span><span class="ident" id="7759762">FileHeader</span><span class="op" id="7759772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7759776">Name</span><span class="op" id="7759780">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7759784">&#34;huge.txt&#34;</span><span class="op" id="7759794">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7759798">Method</span><span class="op" id="7759804">:</span>&nbsp;<span class="ident" id="7759806">Store</span><span class="op" id="7759811">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7759814">}</span><span class="op" id="7759815">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7759818">if</span>&nbsp;<span class="ident" id="7759821">err</span>&nbsp;<span class="op" id="7759825">!=</span>&nbsp;<span class="ident" id="7759828">nil</span>&nbsp;<span class="op" id="7759832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7759836">t</span><span class="op" id="7759837">.</span><span class="ident" id="7759838">Fatal</span><span class="op" id="7759843">(</span><span class="ident" id="7759844">err</span><span class="op" id="7759847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7759850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7759853">f</span><span class="op" id="7759854">.</span><span class="op" id="7759855">(</span><span class="op" id="7759856">*</span><span class="ident" id="7759857">fileWriter</span><span class="op" id="7759867">)</span><span class="op" id="7759868">.</span><span class="ident" id="7759869">crc32</span>&nbsp;<span class="op" id="7759875">=</span>&nbsp;<span class="ident" id="7759877">fakeHash32</span><span class="op" id="7759887">{</span><span class="op" id="7759888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7759891">chunk</span>&nbsp;<span class="op" id="7759897">:=</span>&nbsp;<span class="builtinfunc" id="7759900">make</span><span class="op" id="7759904">(</span><span class="op" id="7759905">[</span><span class="op" id="7759906">]</span><span class="builtintype" id="7759907">byte</span><span class="op" id="7759911">,</span>&nbsp;<span class="ident" id="7759913">chunkSize</span><span class="op" id="7759922">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7759925">for</span>&nbsp;<span class="ident" id="7759929">i</span>&nbsp;<span class="op" id="7759931">:=</span>&nbsp;<span class="keyword" id="7759934">range</span>&nbsp;<span class="ident" id="7759940">chunk</span>&nbsp;<span class="op" id="7759946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7759950">chunk</span><span class="op" id="7759955">[</span><span class="ident" id="7759956">i</span><span class="op" id="7759957">]</span>&nbsp;<span class="op" id="7759959">=</span>&nbsp;<span class="string" id="7759961">&#39;.&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7759966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7759969">for</span>&nbsp;<span class="ident" id="7759973">i</span>&nbsp;<span class="op" id="7759975">:=</span>&nbsp;<span class="num" id="7759978">0</span><span class="op" id="7759979">;</span>&nbsp;<span class="ident" id="7759981">i</span>&nbsp;<span class="op" id="7759983">&lt;</span>&nbsp;<span class="ident" id="7759985">chunks</span><span class="op" id="7759991">;</span>&nbsp;<span class="ident" id="7759993">i</span><span class="op" id="7759994">++</span>&nbsp;<span class="op" id="7759997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7760001">_</span><span class="op" id="7760002">,</span>&nbsp;<span class="ident" id="7760004">err</span>&nbsp;<span class="op" id="7760008">:=</span>&nbsp;<span class="ident" id="7760011">f</span><span class="op" id="7760012">.</span><span class="ident" id="7760013">Write</span><span class="op" id="7760018">(</span><span class="ident" id="7760019">chunk</span><span class="op" id="7760024">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7760028">if</span>&nbsp;<span class="ident" id="7760031">err</span>&nbsp;<span class="op" id="7760035">!=</span>&nbsp;<span class="ident" id="7760038">nil</span>&nbsp;<span class="op" id="7760042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7760047">t</span><span class="op" id="7760048">.</span><span class="ident" id="7760049">Fatal</span><span class="op" id="7760054">(</span><span class="string" id="7760055">&#34;write&nbsp;chunk:&#34;</span><span class="op" id="7760069">,</span>&nbsp;<span class="ident" id="7760071">err</span><span class="op" id="7760074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7760078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7760081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7760084">end</span>&nbsp;<span class="op" id="7760088">:=</span>&nbsp;<span class="op" id="7760091">[</span><span class="op" id="7760092">]</span><span class="builtintype" id="7760093">byte</span><span class="op" id="7760097">(</span><span class="string" id="7760098">&#34;END\n&#34;</span><span class="op" id="7760105">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7760108">_</span><span class="op" id="7760109">,</span>&nbsp;<span class="ident" id="7760111">err</span>&nbsp;<span class="op" id="7760115">=</span>&nbsp;<span class="ident" id="7760117">f</span><span class="op" id="7760118">.</span><span class="ident" id="7760119">Write</span><span class="op" id="7760124">(</span><span class="ident" id="7760125">end</span><span class="op" id="7760128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7760131">if</span>&nbsp;<span class="ident" id="7760134">err</span>&nbsp;<span class="op" id="7760138">!=</span>&nbsp;<span class="ident" id="7760141">nil</span>&nbsp;<span class="op" id="7760145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7760149">t</span><span class="op" id="7760150">.</span><span class="ident" id="7760151">Fatal</span><span class="op" id="7760156">(</span><span class="string" id="7760157">&#34;write&nbsp;end:&#34;</span><span class="op" id="7760169">,</span>&nbsp;<span class="ident" id="7760171">err</span><span class="op" id="7760174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7760177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7760180">if</span>&nbsp;<span class="ident" id="7760183">err</span>&nbsp;<span class="op" id="7760187">:=</span>&nbsp;<span class="ident" id="7760190">w</span><span class="op" id="7760191">.</span><span class="ident" id="7760192">Close</span><span class="op" id="7760197">(</span><span class="op" id="7760198">)</span><span class="op" id="7760199">;</span>&nbsp;<span class="ident" id="7760201">err</span>&nbsp;<span class="op" id="7760205">!=</span>&nbsp;<span class="ident" id="7760208">nil</span>&nbsp;<span class="op" id="7760212">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7760216">t</span><span class="op" id="7760217">.</span><span class="ident" id="7760218">Fatal</span><span class="op" id="7760223">(</span><span class="ident" id="7760224">err</span><span class="op" id="7760227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7760230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7760234">//&nbsp;read&nbsp;back&nbsp;zip&nbsp;file&nbsp;and&nbsp;check&nbsp;that&nbsp;we&nbsp;get&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7760296">r</span><span class="op" id="7760297">,</span>&nbsp;<span class="ident" id="7760299">err</span>&nbsp;<span class="op" id="7760303">:=</span>&nbsp;<span class="ident" id="7760306">NewReader</span><span class="op" id="7760315">(</span><span class="ident" id="7760316">buf</span><span class="op" id="7760319">,</span>&nbsp;<span class="ident" id="7760321">int64</span><span class="op" id="7760326">(</span><span class="ident" id="7760327">buf</span><span class="op" id="7760330">.</span><span class="ident" id="7760331">Size</span><span class="op" id="7760335">(</span><span class="op" id="7760336">)</span><span class="op" id="7760337">)</span><span class="op" id="7760338">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7760341">if</span>&nbsp;<span class="ident" id="7760344">err</span>&nbsp;<span class="op" id="7760348">!=</span>&nbsp;<span class="ident" id="7760351">nil</span>&nbsp;<span class="op" id="7760355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7760359">t</span><span class="op" id="7760360">.</span><span class="ident" id="7760361">Fatal</span><span class="op" id="7760366">(</span><span class="string" id="7760367">&#34;reader:&#34;</span><span class="op" id="7760376">,</span>&nbsp;<span class="ident" id="7760378">err</span><span class="op" id="7760381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7760384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7760387">f0</span>&nbsp;<span class="op" id="7760390">:=</span>&nbsp;<span class="ident" id="7760393">r</span><span class="op" id="7760394">.</span><span class="ident" id="7760395">File</span><span class="op" id="7760399">[</span><span class="num" id="7760400">0</span><span class="op" id="7760401">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7760404">rc</span><span class="op" id="7760406">,</span>&nbsp;<span class="ident" id="7760408">err</span>&nbsp;<span class="op" id="7760412">:=</span>&nbsp;<span class="ident" id="7760415">f0</span><span class="op" id="7760417">.</span><span class="ident" id="7760418">Open</span><span class="op" id="7760422">(</span><span class="op" id="7760423">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7760426">if</span>&nbsp;<span class="ident" id="7760429">err</span>&nbsp;<span class="op" id="7760433">!=</span>&nbsp;<span class="ident" id="7760436">nil</span>&nbsp;<span class="op" id="7760440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7760444">t</span><span class="op" id="7760445">.</span><span class="ident" id="7760446">Fatal</span><span class="op" id="7760451">(</span><span class="string" id="7760452">&#34;opening:&#34;</span><span class="op" id="7760462">,</span>&nbsp;<span class="ident" id="7760464">err</span><span class="op" id="7760467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7760470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7760473">rc</span><span class="op" id="7760475">.</span><span class="op" id="7760476">(</span><span class="op" id="7760477">*</span><span class="ident" id="7760478">checksumReader</span><span class="op" id="7760492">)</span><span class="op" id="7760493">.</span><span class="ident" id="7760494">hash</span>&nbsp;<span class="op" id="7760499">=</span>&nbsp;<span class="ident" id="7760501">fakeHash32</span><span class="op" id="7760511">{</span><span class="op" id="7760512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7760515">for</span>&nbsp;<span class="ident" id="7760519">i</span>&nbsp;<span class="op" id="7760521">:=</span>&nbsp;<span class="num" id="7760524">0</span><span class="op" id="7760525">;</span>&nbsp;<span class="ident" id="7760527">i</span>&nbsp;<span class="op" id="7760529">&lt;</span>&nbsp;<span class="ident" id="7760531">chunks</span><span class="op" id="7760537">;</span>&nbsp;<span class="ident" id="7760539">i</span><span class="op" id="7760540">++</span>&nbsp;<span class="op" id="7760543">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7760547">_</span><span class="op" id="7760548">,</span>&nbsp;<span class="ident" id="7760550">err</span>&nbsp;<span class="op" id="7760554">:=</span>&nbsp;<span class="ident" id="7760557">io</span><span class="op" id="7760559">.</span><span class="ident" id="7760560">ReadFull</span><span class="op" id="7760568">(</span><span class="ident" id="7760569">rc</span><span class="op" id="7760571">,</span>&nbsp;<span class="ident" id="7760573">chunk</span><span class="op" id="7760578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7760582">if</span>&nbsp;<span class="ident" id="7760585">err</span>&nbsp;<span class="op" id="7760589">!=</span>&nbsp;<span class="ident" id="7760592">nil</span>&nbsp;<span class="op" id="7760596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7760601">t</span><span class="op" id="7760602">.</span><span class="ident" id="7760603">Fatal</span><span class="op" id="7760608">(</span><span class="string" id="7760609">&#34;read:&#34;</span><span class="op" id="7760616">,</span>&nbsp;<span class="ident" id="7760618">err</span><span class="op" id="7760621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7760625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7760628">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7760631">gotEnd</span><span class="op" id="7760637">,</span>&nbsp;<span class="ident" id="7760639">err</span>&nbsp;<span class="op" id="7760643">:=</span>&nbsp;<span class="ident" id="7760646">ioutil</span><span class="op" id="7760652">.</span><span class="ident" id="7760653">ReadAll</span><span class="op" id="7760660">(</span><span class="ident" id="7760661">rc</span><span class="op" id="7760663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7760666">if</span>&nbsp;<span class="ident" id="7760669">err</span>&nbsp;<span class="op" id="7760673">!=</span>&nbsp;<span class="ident" id="7760676">nil</span>&nbsp;<span class="op" id="7760680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7760684">t</span><span class="op" id="7760685">.</span><span class="ident" id="7760686">Fatal</span><span class="op" id="7760691">(</span><span class="string" id="7760692">&#34;read&nbsp;end:&#34;</span><span class="op" id="7760703">,</span>&nbsp;<span class="ident" id="7760705">err</span><span class="op" id="7760708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7760711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7760714">if</span>&nbsp;<span class="op" id="7760717">!</span><span class="ident" id="7760718">bytes</span><span class="op" id="7760723">.</span><span class="ident" id="7760724">Equal</span><span class="op" id="7760729">(</span><span class="ident" id="7760730">gotEnd</span><span class="op" id="7760736">,</span>&nbsp;<span class="ident" id="7760738">end</span><span class="op" id="7760741">)</span>&nbsp;<span class="op" id="7760743">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7760747">t</span><span class="op" id="7760748">.</span><span class="ident" id="7760749">Errorf</span><span class="op" id="7760755">(</span><span class="string" id="7760756">&#34;End&nbsp;of&nbsp;zip64&nbsp;archive&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7760790">,</span>&nbsp;<span class="ident" id="7760792">gotEnd</span><span class="op" id="7760798">,</span>&nbsp;<span class="ident" id="7760800">end</span><span class="op" id="7760803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7760806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7760809">err</span>&nbsp;<span class="op" id="7760813">=</span>&nbsp;<span class="ident" id="7760815">rc</span><span class="op" id="7760817">.</span><span class="ident" id="7760818">Close</span><span class="op" id="7760823">(</span><span class="op" id="7760824">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7760827">if</span>&nbsp;<span class="ident" id="7760830">err</span>&nbsp;<span class="op" id="7760834">!=</span>&nbsp;<span class="ident" id="7760837">nil</span>&nbsp;<span class="op" id="7760841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7760845">t</span><span class="op" id="7760846">.</span><span class="ident" id="7760847">Fatal</span><span class="op" id="7760852">(</span><span class="string" id="7760853">&#34;closing:&#34;</span><span class="op" id="7760863">,</span>&nbsp;<span class="ident" id="7760865">err</span><span class="op" id="7760868">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7760871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7760874">if</span>&nbsp;<span class="ident" id="7760877">size</span>&nbsp;<span class="op" id="7760882">==</span>&nbsp;<span class="num" id="7760885">1</span><span class="op" id="7760886">&lt;&lt;</span><span class="num" id="7760888">32</span>&nbsp;<span class="op" id="7760891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7760895">if</span>&nbsp;<span class="ident" id="7760898">got</span><span class="op" id="7760901">,</span>&nbsp;<span class="ident" id="7760903">want</span>&nbsp;<span class="op" id="7760908">:=</span>&nbsp;<span class="ident" id="7760911">f0</span><span class="op" id="7760913">.</span><span class="ident" id="7760914">UncompressedSize</span><span class="op" id="7760930">,</span>&nbsp;<span class="builtintype" id="7760932">uint32</span><span class="op" id="7760938">(</span><span class="ident" id="7760939">uint32max</span><span class="op" id="7760948">)</span><span class="op" id="7760949">;</span>&nbsp;<span class="ident" id="7760951">got</span>&nbsp;<span class="op" id="7760955">!=</span>&nbsp;<span class="ident" id="7760958">want</span>&nbsp;<span class="op" id="7760963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7760968">t</span><span class="op" id="7760969">.</span><span class="ident" id="7760970">Errorf</span><span class="op" id="7760976">(</span><span class="string" id="7760977">&#34;UncompressedSize&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7761007">,</span>&nbsp;<span class="ident" id="7761009">got</span><span class="op" id="7761012">,</span>&nbsp;<span class="ident" id="7761014">want</span><span class="op" id="7761018">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7761022">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7761025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7761029">if</span>&nbsp;<span class="ident" id="7761032">got</span><span class="op" id="7761035">,</span>&nbsp;<span class="ident" id="7761037">want</span>&nbsp;<span class="op" id="7761042">:=</span>&nbsp;<span class="ident" id="7761045">f0</span><span class="op" id="7761047">.</span><span class="ident" id="7761048">UncompressedSize64</span><span class="op" id="7761066">,</span>&nbsp;<span class="ident" id="7761068">uint64</span><span class="op" id="7761074">(</span><span class="ident" id="7761075">size</span><span class="op" id="7761079">)</span><span class="op" id="7761080">+</span><span class="ident" id="7761081">uint64</span><span class="op" id="7761087">(</span><span class="builtinfunc" id="7761088">len</span><span class="op" id="7761091">(</span><span class="ident" id="7761092">end</span><span class="op" id="7761095">)</span><span class="op" id="7761096">)</span><span class="op" id="7761097">;</span>&nbsp;<span class="ident" id="7761099">got</span>&nbsp;<span class="op" id="7761103">!=</span>&nbsp;<span class="ident" id="7761106">want</span>&nbsp;<span class="op" id="7761111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7761115">t</span><span class="op" id="7761116">.</span><span class="ident" id="7761117">Errorf</span><span class="op" id="7761123">(</span><span class="string" id="7761124">&#34;UncompressedSize64&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7761156">,</span>&nbsp;<span class="ident" id="7761158">got</span><span class="op" id="7761161">,</span>&nbsp;<span class="ident" id="7761163">want</span><span class="op" id="7761167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7761170">}</span><br>
<span class="lineno">305</span><span class="op" id="7761172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7761175">func</span>&nbsp;<span class="ident" id="7761180">testInvalidHeader</span><span class="op" id="7761197">(</span><span class="ident" id="7761198">h</span>&nbsp;<span class="op" id="7761200">*</span><span class="ident" id="7761201">FileHeader</span><span class="op" id="7761211">,</span>&nbsp;<span class="ident" id="7761213">t</span>&nbsp;<span class="op" id="7761215">*</span><span class="ident" id="7761216">testing</span><span class="op" id="7761223">.</span><span class="ident" id="7761224">T</span><span class="op" id="7761225">)</span>&nbsp;<span class="op" id="7761227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7761230">var</span>&nbsp;<span class="ident" id="7761234">buf</span>&nbsp;<span class="ident" id="7761238">bytes</span><span class="op" id="7761243">.</span><span class="ident" id="7761244">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7761252">z</span>&nbsp;<span class="op" id="7761254">:=</span>&nbsp;<span class="ident" id="7761257">NewWriter</span><span class="op" id="7761266">(</span><span class="op" id="7761267">&amp;</span><span class="ident" id="7761268">buf</span><span class="op" id="7761271">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7761275">f</span><span class="op" id="7761276">,</span>&nbsp;<span class="ident" id="7761278">err</span>&nbsp;<span class="op" id="7761282">:=</span>&nbsp;<span class="ident" id="7761285">z</span><span class="op" id="7761286">.</span><span class="ident" id="7761287">CreateHeader</span><span class="op" id="7761299">(</span><span class="ident" id="7761300">h</span><span class="op" id="7761301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7761304">if</span>&nbsp;<span class="ident" id="7761307">err</span>&nbsp;<span class="op" id="7761311">!=</span>&nbsp;<span class="ident" id="7761314">nil</span>&nbsp;<span class="op" id="7761318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7761322">t</span><span class="op" id="7761323">.</span><span class="ident" id="7761324">Fatalf</span><span class="op" id="7761330">(</span><span class="string" id="7761331">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="7761358">,</span>&nbsp;<span class="ident" id="7761360">err</span><span class="op" id="7761363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7761366">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7761369">if</span>&nbsp;<span class="ident" id="7761372">_</span><span class="op" id="7761373">,</span>&nbsp;<span class="ident" id="7761375">err</span>&nbsp;<span class="op" id="7761379">:=</span>&nbsp;<span class="ident" id="7761382">f</span><span class="op" id="7761383">.</span><span class="ident" id="7761384">Write</span><span class="op" id="7761389">(</span><span class="op" id="7761390">[</span><span class="op" id="7761391">]</span><span class="builtintype" id="7761392">byte</span><span class="op" id="7761396">(</span><span class="string" id="7761397">&#34;hi&#34;</span><span class="op" id="7761401">)</span><span class="op" id="7761402">)</span><span class="op" id="7761403">;</span>&nbsp;<span class="ident" id="7761405">err</span>&nbsp;<span class="op" id="7761409">!=</span>&nbsp;<span class="ident" id="7761412">nil</span>&nbsp;<span class="op" id="7761416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7761420">t</span><span class="op" id="7761421">.</span><span class="ident" id="7761422">Fatalf</span><span class="op" id="7761428">(</span><span class="string" id="7761429">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="7761456">,</span>&nbsp;<span class="ident" id="7761458">err</span><span class="op" id="7761461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7761464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7761467">if</span>&nbsp;<span class="ident" id="7761470">err</span>&nbsp;<span class="op" id="7761474">:=</span>&nbsp;<span class="ident" id="7761477">z</span><span class="op" id="7761478">.</span><span class="ident" id="7761479">Close</span><span class="op" id="7761484">(</span><span class="op" id="7761485">)</span><span class="op" id="7761486">;</span>&nbsp;<span class="ident" id="7761488">err</span>&nbsp;<span class="op" id="7761492">!=</span>&nbsp;<span class="ident" id="7761495">nil</span>&nbsp;<span class="op" id="7761499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7761503">t</span><span class="op" id="7761504">.</span><span class="ident" id="7761505">Fatalf</span><span class="op" id="7761511">(</span><span class="string" id="7761512">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="7761542">,</span>&nbsp;<span class="ident" id="7761544">err</span><span class="op" id="7761547">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7761550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7761554">b</span>&nbsp;<span class="op" id="7761556">:=</span>&nbsp;<span class="ident" id="7761559">buf</span><span class="op" id="7761562">.</span><span class="ident" id="7761563">Bytes</span><span class="op" id="7761568">(</span><span class="op" id="7761569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7761572">if</span>&nbsp;<span class="ident" id="7761575">_</span><span class="op" id="7761576">,</span>&nbsp;<span class="ident" id="7761578">err</span>&nbsp;<span class="op" id="7761582">=</span>&nbsp;<span class="ident" id="7761584">NewReader</span><span class="op" id="7761593">(</span><span class="ident" id="7761594">bytes</span><span class="op" id="7761599">.</span><span class="ident" id="7761600">NewReader</span><span class="op" id="7761609">(</span><span class="ident" id="7761610">b</span><span class="op" id="7761611">)</span><span class="op" id="7761612">,</span>&nbsp;<span class="ident" id="7761614">int64</span><span class="op" id="7761619">(</span><span class="builtinfunc" id="7761620">len</span><span class="op" id="7761623">(</span><span class="ident" id="7761624">b</span><span class="op" id="7761625">)</span><span class="op" id="7761626">)</span><span class="op" id="7761627">)</span><span class="op" id="7761628">;</span>&nbsp;<span class="ident" id="7761630">err</span>&nbsp;<span class="op" id="7761634">!=</span>&nbsp;<span class="ident" id="7761637">ErrFormat</span>&nbsp;<span class="op" id="7761647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7761651">t</span><span class="op" id="7761652">.</span><span class="ident" id="7761653">Fatalf</span><span class="op" id="7761659">(</span><span class="string" id="7761660">&#34;got&nbsp;%v,&nbsp;expected&nbsp;ErrFormat&#34;</span><span class="op" id="7761688">,</span>&nbsp;<span class="ident" id="7761690">err</span><span class="op" id="7761693">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7761696">}</span><br>
<span class="lineno"></span><span class="op" id="7761698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7761701">func</span>&nbsp;<span class="ident" id="7761706">testValidHeader</span><span class="op" id="7761721">(</span><span class="ident" id="7761722">h</span>&nbsp;<span class="op" id="7761724">*</span><span class="ident" id="7761725">FileHeader</span><span class="op" id="7761735">,</span>&nbsp;<span class="ident" id="7761737">t</span>&nbsp;<span class="op" id="7761739">*</span><span class="ident" id="7761740">testing</span><span class="op" id="7761747">.</span><span class="ident" id="7761748">T</span><span class="op" id="7761749">)</span>&nbsp;<span class="op" id="7761751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7761754">var</span>&nbsp;<span class="ident" id="7761758">buf</span>&nbsp;<span class="ident" id="7761762">bytes</span><span class="op" id="7761767">.</span><span class="ident" id="7761768">Buffer</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7761776">z</span>&nbsp;<span class="op" id="7761778">:=</span>&nbsp;<span class="ident" id="7761781">NewWriter</span><span class="op" id="7761790">(</span><span class="op" id="7761791">&amp;</span><span class="ident" id="7761792">buf</span><span class="op" id="7761795">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7761799">f</span><span class="op" id="7761800">,</span>&nbsp;<span class="ident" id="7761802">err</span>&nbsp;<span class="op" id="7761806">:=</span>&nbsp;<span class="ident" id="7761809">z</span><span class="op" id="7761810">.</span><span class="ident" id="7761811">CreateHeader</span><span class="op" id="7761823">(</span><span class="ident" id="7761824">h</span><span class="op" id="7761825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7761828">if</span>&nbsp;<span class="ident" id="7761831">err</span>&nbsp;<span class="op" id="7761835">!=</span>&nbsp;<span class="ident" id="7761838">nil</span>&nbsp;<span class="op" id="7761842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7761846">t</span><span class="op" id="7761847">.</span><span class="ident" id="7761848">Fatalf</span><span class="op" id="7761854">(</span><span class="string" id="7761855">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="7761882">,</span>&nbsp;<span class="ident" id="7761884">err</span><span class="op" id="7761887">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7761890">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7761893">if</span>&nbsp;<span class="ident" id="7761896">_</span><span class="op" id="7761897">,</span>&nbsp;<span class="ident" id="7761899">err</span>&nbsp;<span class="op" id="7761903">:=</span>&nbsp;<span class="ident" id="7761906">f</span><span class="op" id="7761907">.</span><span class="ident" id="7761908">Write</span><span class="op" id="7761913">(</span><span class="op" id="7761914">[</span><span class="op" id="7761915">]</span><span class="builtintype" id="7761916">byte</span><span class="op" id="7761920">(</span><span class="string" id="7761921">&#34;hi&#34;</span><span class="op" id="7761925">)</span><span class="op" id="7761926">)</span><span class="op" id="7761927">;</span>&nbsp;<span class="ident" id="7761929">err</span>&nbsp;<span class="op" id="7761933">!=</span>&nbsp;<span class="ident" id="7761936">nil</span>&nbsp;<span class="op" id="7761940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7761944">t</span><span class="op" id="7761945">.</span><span class="ident" id="7761946">Fatalf</span><span class="op" id="7761952">(</span><span class="string" id="7761953">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="7761980">,</span>&nbsp;<span class="ident" id="7761982">err</span><span class="op" id="7761985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7761988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7761991">if</span>&nbsp;<span class="ident" id="7761994">err</span>&nbsp;<span class="op" id="7761998">:=</span>&nbsp;<span class="ident" id="7762001">z</span><span class="op" id="7762002">.</span><span class="ident" id="7762003">Close</span><span class="op" id="7762008">(</span><span class="op" id="7762009">)</span><span class="op" id="7762010">;</span>&nbsp;<span class="ident" id="7762012">err</span>&nbsp;<span class="op" id="7762016">!=</span>&nbsp;<span class="ident" id="7762019">nil</span>&nbsp;<span class="op" id="7762023">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7762027">t</span><span class="op" id="7762028">.</span><span class="ident" id="7762029">Fatalf</span><span class="op" id="7762035">(</span><span class="string" id="7762036">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="7762066">,</span>&nbsp;<span class="ident" id="7762068">err</span><span class="op" id="7762071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7762074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7762078">b</span>&nbsp;<span class="op" id="7762080">:=</span>&nbsp;<span class="ident" id="7762083">buf</span><span class="op" id="7762086">.</span><span class="ident" id="7762087">Bytes</span><span class="op" id="7762092">(</span><span class="op" id="7762093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7762096">if</span>&nbsp;<span class="ident" id="7762099">_</span><span class="op" id="7762100">,</span>&nbsp;<span class="ident" id="7762102">err</span>&nbsp;<span class="op" id="7762106">=</span>&nbsp;<span class="ident" id="7762108">NewReader</span><span class="op" id="7762117">(</span><span class="ident" id="7762118">bytes</span><span class="op" id="7762123">.</span><span class="ident" id="7762124">NewReader</span><span class="op" id="7762133">(</span><span class="ident" id="7762134">b</span><span class="op" id="7762135">)</span><span class="op" id="7762136">,</span>&nbsp;<span class="ident" id="7762138">int64</span><span class="op" id="7762143">(</span><span class="builtinfunc" id="7762144">len</span><span class="op" id="7762147">(</span><span class="ident" id="7762148">b</span><span class="op" id="7762149">)</span><span class="op" id="7762150">)</span><span class="op" id="7762151">)</span><span class="op" id="7762152">;</span>&nbsp;<span class="ident" id="7762154">err</span>&nbsp;<span class="op" id="7762158">!=</span>&nbsp;<span class="ident" id="7762161">nil</span>&nbsp;<span class="op" id="7762165">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7762169">t</span><span class="op" id="7762170">.</span><span class="ident" id="7762171">Fatalf</span><span class="op" id="7762177">(</span><span class="string" id="7762178">&#34;got&nbsp;%v,&nbsp;expected&nbsp;nil&#34;</span><span class="op" id="7762200">,</span>&nbsp;<span class="ident" id="7762202">err</span><span class="op" id="7762205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7762208">}</span><br>
<span class="lineno"></span><span class="op" id="7762210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7762213">//&nbsp;Issue&nbsp;4302.</span><br>
<span class="lineno">350</span><span class="keyword" id="7762228">func</span>&nbsp;<span class="ident" id="7762233">TestHeaderInvalidTagAndSize</span><span class="op" id="7762260">(</span><span class="ident" id="7762261">t</span>&nbsp;<span class="op" id="7762263">*</span><span class="ident" id="7762264">testing</span><span class="op" id="7762271">.</span><span class="ident" id="7762272">T</span><span class="op" id="7762273">)</span>&nbsp;<span class="op" id="7762275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7762278">const</span>&nbsp;<span class="ident" id="7762284">timeFormat</span>&nbsp;<span class="op" id="7762295">=</span>&nbsp;<span class="string" id="7762297">&#34;20060102T150405.000.txt&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7762325">ts</span>&nbsp;<span class="op" id="7762328">:=</span>&nbsp;<span class="ident" id="7762331">time</span><span class="op" id="7762335">.</span><span class="ident" id="7762336">Now</span><span class="op" id="7762339">(</span><span class="op" id="7762340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7762343">filename</span>&nbsp;<span class="op" id="7762352">:=</span>&nbsp;<span class="ident" id="7762355">ts</span><span class="op" id="7762357">.</span><span class="ident" id="7762358">Format</span><span class="op" id="7762364">(</span><span class="ident" id="7762365">timeFormat</span><span class="op" id="7762375">)</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7762379">h</span>&nbsp;<span class="op" id="7762381">:=</span>&nbsp;<span class="ident" id="7762384">FileHeader</span><span class="op" id="7762394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7762398">Name</span><span class="op" id="7762402">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7762406">filename</span><span class="op" id="7762414">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7762418">Method</span><span class="op" id="7762424">:</span>&nbsp;<span class="ident" id="7762426">Deflate</span><span class="op" id="7762433">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7762437">Extra</span><span class="op" id="7762442">:</span>&nbsp;&nbsp;<span class="op" id="7762445">[</span><span class="op" id="7762446">]</span><span class="builtintype" id="7762447">byte</span><span class="op" id="7762451">(</span><span class="ident" id="7762452">ts</span><span class="op" id="7762454">.</span><span class="ident" id="7762455">Format</span><span class="op" id="7762461">(</span><span class="ident" id="7762462">time</span><span class="op" id="7762466">.</span><span class="ident" id="7762467">RFC3339Nano</span><span class="op" id="7762478">)</span><span class="op" id="7762479">)</span><span class="op" id="7762480">,</span>&nbsp;<span class="comment" id="7762482">//&nbsp;missing&nbsp;tag&nbsp;and&nbsp;len</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7762506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7762509">h</span><span class="op" id="7762510">.</span><span class="ident" id="7762511">SetModTime</span><span class="op" id="7762521">(</span><span class="ident" id="7762522">ts</span><span class="op" id="7762524">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7762528">testInvalidHeader</span><span class="op" id="7762545">(</span><span class="op" id="7762546">&amp;</span><span class="ident" id="7762547">h</span><span class="op" id="7762548">,</span>&nbsp;<span class="ident" id="7762550">t</span><span class="op" id="7762551">)</span><br>
<span class="lineno"></span><span class="op" id="7762553">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="7762556">func</span>&nbsp;<span class="ident" id="7762561">TestHeaderTooShort</span><span class="op" id="7762579">(</span><span class="ident" id="7762580">t</span>&nbsp;<span class="op" id="7762582">*</span><span class="ident" id="7762583">testing</span><span class="op" id="7762590">.</span><span class="ident" id="7762591">T</span><span class="op" id="7762592">)</span>&nbsp;<span class="op" id="7762594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7762597">h</span>&nbsp;<span class="op" id="7762599">:=</span>&nbsp;<span class="ident" id="7762602">FileHeader</span><span class="op" id="7762612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7762616">Name</span><span class="op" id="7762620">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7762624">&#34;foo.txt&#34;</span><span class="op" id="7762633">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7762637">Method</span><span class="op" id="7762643">:</span>&nbsp;<span class="ident" id="7762645">Deflate</span><span class="op" id="7762652">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7762656">Extra</span><span class="op" id="7762661">:</span>&nbsp;&nbsp;<span class="op" id="7762664">[</span><span class="op" id="7762665">]</span><span class="builtintype" id="7762666">byte</span><span class="op" id="7762670">{</span><span class="ident" id="7762671">zip64ExtraId</span><span class="op" id="7762683">}</span><span class="op" id="7762684">,</span>&nbsp;<span class="comment" id="7762686">//&nbsp;missing&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7762703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7762706">testInvalidHeader</span><span class="op" id="7762723">(</span><span class="op" id="7762724">&amp;</span><span class="ident" id="7762725">h</span><span class="op" id="7762726">,</span>&nbsp;<span class="ident" id="7762728">t</span><span class="op" id="7762729">)</span><br>
<span class="lineno"></span><span class="op" id="7762731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span><span class="comment" id="7762734">//&nbsp;Issue&nbsp;4393.&nbsp;It&nbsp;is&nbsp;valid&nbsp;to&nbsp;have&nbsp;an&nbsp;extra&nbsp;data&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="7762790">//&nbsp;which&nbsp;contains&nbsp;no&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="7762817">func</span>&nbsp;<span class="ident" id="7762822">TestZeroLengthHeader</span><span class="op" id="7762842">(</span><span class="ident" id="7762843">t</span>&nbsp;<span class="op" id="7762845">*</span><span class="ident" id="7762846">testing</span><span class="op" id="7762853">.</span><span class="ident" id="7762854">T</span><span class="op" id="7762855">)</span>&nbsp;<span class="op" id="7762857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7762860">h</span>&nbsp;<span class="op" id="7762862">:=</span>&nbsp;<span class="ident" id="7762865">FileHeader</span><span class="op" id="7762875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7762879">Name</span><span class="op" id="7762883">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7762887">&#34;extadata.txt&#34;</span><span class="op" id="7762901">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7762905">Method</span><span class="op" id="7762911">:</span>&nbsp;<span class="ident" id="7762913">Deflate</span><span class="op" id="7762920">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7762924">Extra</span><span class="op" id="7762929">:</span>&nbsp;<span class="op" id="7762931">[</span><span class="op" id="7762932">]</span><span class="builtintype" id="7762933">byte</span><span class="op" id="7762937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7762942">85</span><span class="op" id="7762944">,</span>&nbsp;<span class="num" id="7762946">84</span><span class="op" id="7762948">,</span>&nbsp;<span class="num" id="7762950">5</span><span class="op" id="7762951">,</span>&nbsp;<span class="num" id="7762953">0</span><span class="op" id="7762954">,</span>&nbsp;<span class="num" id="7762956">3</span><span class="op" id="7762957">,</span>&nbsp;<span class="num" id="7762959">154</span><span class="op" id="7762962">,</span>&nbsp;<span class="num" id="7762964">144</span><span class="op" id="7762967">,</span>&nbsp;<span class="num" id="7762969">195</span><span class="op" id="7762972">,</span>&nbsp;<span class="num" id="7762974">77</span><span class="op" id="7762976">,</span>&nbsp;<span class="comment" id="7762978">//&nbsp;tag&nbsp;21589&nbsp;size&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7763001">85</span><span class="op" id="7763003">,</span>&nbsp;<span class="num" id="7763005">120</span><span class="op" id="7763008">,</span>&nbsp;<span class="num" id="7763010">0</span><span class="op" id="7763011">,</span>&nbsp;<span class="num" id="7763013">0</span><span class="op" id="7763014">,</span>&nbsp;<span class="comment" id="7763016">//&nbsp;tag&nbsp;30805&nbsp;size&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7763038">}</span><span class="op" id="7763039">,</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7763042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7763045">testValidHeader</span><span class="op" id="7763060">(</span><span class="op" id="7763061">&amp;</span><span class="ident" id="7763062">h</span><span class="op" id="7763063">,</span>&nbsp;<span class="ident" id="7763065">t</span><span class="op" id="7763066">)</span><br>
<span class="lineno"></span><span class="op" id="7763068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7763071">//&nbsp;Just&nbsp;benchmarking&nbsp;how&nbsp;fast&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above&nbsp;is.&nbsp;Not&nbsp;related&nbsp;to</span><br>
<span class="lineno">390</span><span class="comment" id="7763141">//&nbsp;our&nbsp;zip&nbsp;performance,&nbsp;since&nbsp;the&nbsp;test&nbsp;above&nbsp;disabled&nbsp;CRC32&nbsp;and&nbsp;flate.</span><br>
<span class="lineno"></span><span class="keyword" id="7763212">func</span>&nbsp;<span class="ident" id="7763217">BenchmarkZip64Test</span><span class="op" id="7763235">(</span><span class="ident" id="7763236">b</span>&nbsp;<span class="op" id="7763238">*</span><span class="ident" id="7763239">testing</span><span class="op" id="7763246">.</span><span class="ident" id="7763247">B</span><span class="op" id="7763248">)</span>&nbsp;<span class="op" id="7763250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7763253">for</span>&nbsp;<span class="ident" id="7763257">i</span>&nbsp;<span class="op" id="7763259">:=</span>&nbsp;<span class="num" id="7763262">0</span><span class="op" id="7763263">;</span>&nbsp;<span class="ident" id="7763265">i</span>&nbsp;<span class="op" id="7763267">&lt;</span>&nbsp;<span class="ident" id="7763269">b</span><span class="op" id="7763270">.</span><span class="ident" id="7763271">N</span><span class="op" id="7763272">;</span>&nbsp;<span class="ident" id="7763274">i</span><span class="op" id="7763275">++</span>&nbsp;<span class="op" id="7763278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7763282">testZip64</span><span class="op" id="7763291">(</span><span class="ident" id="7763292">b</span><span class="op" id="7763293">,</span>&nbsp;<span class="num" id="7763295">1</span><span class="op" id="7763296">&lt;&lt;</span><span class="num" id="7763298">26</span><span class="op" id="7763300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7763303">}</span><br>
<span class="lineno">395</span><span class="op" id="7763305">}</span>
</div>
</body>
</html>
