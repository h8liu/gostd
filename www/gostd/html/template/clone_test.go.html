<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7369847">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7369902">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7369956">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7370007">package</span>&nbsp;<span class="ident" id="7370015">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7370025">import</span>&nbsp;<span class="op" id="7370032">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7370035">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7370044">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7370054">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7370067">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7370078">&#34;text/template/parse&#34;</span><br>
<span class="lineno"></span><span class="op" id="7370100">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7370103">func</span>&nbsp;<span class="ident" id="7370108">TestAddParseTree</span><span class="op" id="7370124">(</span><span class="ident" id="7370125">t</span>&nbsp;<span class="op" id="7370127">*</span><span class="ident" id="7370128">testing</span><span class="op" id="7370135">.</span><span class="ident" id="7370136">T</span><span class="op" id="7370137">)</span>&nbsp;<span class="op" id="7370139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370142">root</span>&nbsp;<span class="op" id="7370147">:=</span>&nbsp;<span class="ident" id="7370150">Must</span><span class="op" id="7370154">(</span><span class="ident" id="7370155">New</span><span class="op" id="7370158">(</span><span class="string" id="7370159">&#34;root&#34;</span><span class="op" id="7370165">)</span><span class="op" id="7370166">.</span><span class="ident" id="7370167">Parse</span><span class="op" id="7370172">(</span><span class="string" id="7370173">`{{define&nbsp;&#34;a&#34;}}&nbsp;{{.}}&nbsp;{{template&nbsp;&#34;b&#34;}}&nbsp;{{.}}&nbsp;&#34;&gt;&lt;/a&gt;{{end}}`</span><span class="op" id="7370232">)</span><span class="op" id="7370233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370236">tree</span><span class="op" id="7370240">,</span>&nbsp;<span class="ident" id="7370242">err</span>&nbsp;<span class="op" id="7370246">:=</span>&nbsp;<span class="ident" id="7370249">parse</span><span class="op" id="7370254">.</span><span class="ident" id="7370255">Parse</span><span class="op" id="7370260">(</span><span class="string" id="7370261">&#34;t&#34;</span><span class="op" id="7370264">,</span>&nbsp;<span class="string" id="7370266">`{{define&nbsp;&#34;b&#34;}}&lt;a&nbsp;href=&#34;{{end}}`</span><span class="op" id="7370298">,</span>&nbsp;<span class="string" id="7370300">&#34;&#34;</span><span class="op" id="7370302">,</span>&nbsp;<span class="string" id="7370304">&#34;&#34;</span><span class="op" id="7370306">,</span>&nbsp;<span class="ident" id="7370308">nil</span><span class="op" id="7370311">,</span>&nbsp;<span class="ident" id="7370313">nil</span><span class="op" id="7370316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370319">if</span>&nbsp;<span class="ident" id="7370322">err</span>&nbsp;<span class="op" id="7370326">!=</span>&nbsp;<span class="ident" id="7370329">nil</span>&nbsp;<span class="op" id="7370333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370337">t</span><span class="op" id="7370338">.</span><span class="ident" id="7370339">Fatal</span><span class="op" id="7370344">(</span><span class="ident" id="7370345">err</span><span class="op" id="7370348">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7370351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370354">added</span>&nbsp;<span class="op" id="7370360">:=</span>&nbsp;<span class="ident" id="7370363">Must</span><span class="op" id="7370367">(</span><span class="ident" id="7370368">root</span><span class="op" id="7370372">.</span><span class="ident" id="7370373">AddParseTree</span><span class="op" id="7370385">(</span><span class="string" id="7370386">&#34;b&#34;</span><span class="op" id="7370389">,</span>&nbsp;<span class="ident" id="7370391">tree</span><span class="op" id="7370395">[</span><span class="string" id="7370396">&#34;b&#34;</span><span class="op" id="7370399">]</span><span class="op" id="7370400">)</span><span class="op" id="7370401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370404">b</span>&nbsp;<span class="op" id="7370406">:=</span>&nbsp;<span class="builtinfunc" id="7370409">new</span><span class="op" id="7370412">(</span><span class="ident" id="7370413">bytes</span><span class="op" id="7370418">.</span><span class="ident" id="7370419">Buffer</span><span class="op" id="7370425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370428">err</span>&nbsp;<span class="op" id="7370432">=</span>&nbsp;<span class="ident" id="7370434">added</span><span class="op" id="7370439">.</span><span class="ident" id="7370440">ExecuteTemplate</span><span class="op" id="7370455">(</span><span class="ident" id="7370456">b</span><span class="op" id="7370457">,</span>&nbsp;<span class="string" id="7370459">&#34;a&#34;</span><span class="op" id="7370462">,</span>&nbsp;<span class="string" id="7370464">&#34;1&gt;0&#34;</span><span class="op" id="7370469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370472">if</span>&nbsp;<span class="ident" id="7370475">err</span>&nbsp;<span class="op" id="7370479">!=</span>&nbsp;<span class="ident" id="7370482">nil</span>&nbsp;<span class="op" id="7370486">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370490">t</span><span class="op" id="7370491">.</span><span class="ident" id="7370492">Fatal</span><span class="op" id="7370497">(</span><span class="ident" id="7370498">err</span><span class="op" id="7370501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7370504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370507">if</span>&nbsp;<span class="ident" id="7370510">got</span><span class="op" id="7370513">,</span>&nbsp;<span class="ident" id="7370515">want</span>&nbsp;<span class="op" id="7370520">:=</span>&nbsp;<span class="ident" id="7370523">b</span><span class="op" id="7370524">.</span><span class="ident" id="7370525">String</span><span class="op" id="7370531">(</span><span class="op" id="7370532">)</span><span class="op" id="7370533">,</span>&nbsp;<span class="string" id="7370535">`&nbsp;1&amp;gt;0&nbsp;&lt;a&nbsp;href=&#34;&nbsp;1%3e0&nbsp;&#34;&gt;&lt;/a&gt;`</span><span class="op" id="7370567">;</span>&nbsp;<span class="ident" id="7370569">got</span>&nbsp;<span class="op" id="7370573">!=</span>&nbsp;<span class="ident" id="7370576">want</span>&nbsp;<span class="op" id="7370581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7370585">t</span><span class="op" id="7370586">.</span><span class="ident" id="7370587">Errorf</span><span class="op" id="7370593">(</span><span class="string" id="7370594">&#34;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7370610">,</span>&nbsp;<span class="ident" id="7370612">got</span><span class="op" id="7370615">,</span>&nbsp;<span class="ident" id="7370617">want</span><span class="op" id="7370621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7370624">}</span><br>
<span class="lineno">30</span><span class="op" id="7370626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7370629">func</span>&nbsp;<span class="ident" id="7370634">TestClone</span><span class="op" id="7370643">(</span><span class="ident" id="7370644">t</span>&nbsp;<span class="op" id="7370646">*</span><span class="ident" id="7370647">testing</span><span class="op" id="7370654">.</span><span class="ident" id="7370655">T</span><span class="op" id="7370656">)</span>&nbsp;<span class="op" id="7370658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7370661">//&nbsp;The&nbsp;{{.}}&nbsp;will&nbsp;be&nbsp;executed&nbsp;with&nbsp;data&nbsp;&#34;&lt;i&gt;*/&#34;&nbsp;in&nbsp;different&nbsp;contexts.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7370733">//&nbsp;In&nbsp;the&nbsp;t0&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;text&nbsp;context.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7370787">//&nbsp;In&nbsp;the&nbsp;t1&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;URL&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7370840">//&nbsp;In&nbsp;the&nbsp;t2&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;JavaScript&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7370900">//&nbsp;In&nbsp;the&nbsp;t3&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;CSS&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7370953">const</span>&nbsp;<span class="ident" id="7370959">tmpl</span>&nbsp;<span class="op" id="7370964">=</span>&nbsp;<span class="string" id="7370966">`{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;lhs&#34;}}{{.}}{{template&nbsp;&#34;rhs&#34;}}{{end}}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371032">b</span>&nbsp;<span class="op" id="7371034">:=</span>&nbsp;<span class="builtinfunc" id="7371037">new</span><span class="op" id="7371040">(</span><span class="ident" id="7371041">bytes</span><span class="op" id="7371046">.</span><span class="ident" id="7371047">Buffer</span><span class="op" id="7371053">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7371057">//&nbsp;Create&nbsp;an&nbsp;incomplete&nbsp;template&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371095">t0</span>&nbsp;<span class="op" id="7371098">:=</span>&nbsp;<span class="ident" id="7371101">Must</span><span class="op" id="7371105">(</span><span class="ident" id="7371106">New</span><span class="op" id="7371109">(</span><span class="string" id="7371110">&#34;t0&#34;</span><span class="op" id="7371114">)</span><span class="op" id="7371115">.</span><span class="ident" id="7371116">Parse</span><span class="op" id="7371121">(</span><span class="ident" id="7371122">tmpl</span><span class="op" id="7371126">)</span><span class="op" id="7371127">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7371131">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t1.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371151">t1</span>&nbsp;<span class="op" id="7371154">:=</span>&nbsp;<span class="ident" id="7371157">Must</span><span class="op" id="7371161">(</span><span class="ident" id="7371162">t0</span><span class="op" id="7371164">.</span><span class="ident" id="7371165">Clone</span><span class="op" id="7371170">(</span><span class="op" id="7371171">)</span><span class="op" id="7371172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371175">Must</span><span class="op" id="7371179">(</span><span class="ident" id="7371180">t1</span><span class="op" id="7371182">.</span><span class="ident" id="7371183">Parse</span><span class="op" id="7371188">(</span><span class="string" id="7371189">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;a&nbsp;href=&#34;&nbsp;{{end}}`</span><span class="op" id="7371225">)</span><span class="op" id="7371226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371229">Must</span><span class="op" id="7371233">(</span><span class="ident" id="7371234">t1</span><span class="op" id="7371236">.</span><span class="ident" id="7371237">Parse</span><span class="op" id="7371242">(</span><span class="string" id="7371243">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;{{end}}`</span><span class="op" id="7371276">)</span><span class="op" id="7371277">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7371281">//&nbsp;Execute&nbsp;t1.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371297">b</span><span class="op" id="7371298">.</span><span class="ident" id="7371299">Reset</span><span class="op" id="7371304">(</span><span class="op" id="7371305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7371308">if</span>&nbsp;<span class="ident" id="7371311">err</span>&nbsp;<span class="op" id="7371315">:=</span>&nbsp;<span class="ident" id="7371318">t1</span><span class="op" id="7371320">.</span><span class="ident" id="7371321">ExecuteTemplate</span><span class="op" id="7371336">(</span><span class="ident" id="7371337">b</span><span class="op" id="7371338">,</span>&nbsp;<span class="string" id="7371340">&#34;a&#34;</span><span class="op" id="7371343">,</span>&nbsp;<span class="string" id="7371345">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="7371352">)</span><span class="op" id="7371353">;</span>&nbsp;<span class="ident" id="7371355">err</span>&nbsp;<span class="op" id="7371359">!=</span>&nbsp;<span class="ident" id="7371362">nil</span>&nbsp;<span class="op" id="7371366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371370">t</span><span class="op" id="7371371">.</span><span class="ident" id="7371372">Fatal</span><span class="op" id="7371377">(</span><span class="ident" id="7371378">err</span><span class="op" id="7371381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7371384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7371387">if</span>&nbsp;<span class="ident" id="7371390">got</span><span class="op" id="7371393">,</span>&nbsp;<span class="ident" id="7371395">want</span>&nbsp;<span class="op" id="7371400">:=</span>&nbsp;<span class="ident" id="7371403">b</span><span class="op" id="7371404">.</span><span class="ident" id="7371405">String</span><span class="op" id="7371411">(</span><span class="op" id="7371412">)</span><span class="op" id="7371413">,</span>&nbsp;<span class="string" id="7371415">`&nbsp;&lt;a&nbsp;href=&#34;&nbsp;%3ci%3e*/&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;`</span><span class="op" id="7371445">;</span>&nbsp;<span class="ident" id="7371447">got</span>&nbsp;<span class="op" id="7371451">!=</span>&nbsp;<span class="ident" id="7371454">want</span>&nbsp;<span class="op" id="7371459">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371463">t</span><span class="op" id="7371464">.</span><span class="ident" id="7371465">Errorf</span><span class="op" id="7371471">(</span><span class="string" id="7371472">&#34;t1:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7371492">,</span>&nbsp;<span class="ident" id="7371494">got</span><span class="op" id="7371497">,</span>&nbsp;<span class="ident" id="7371499">want</span><span class="op" id="7371503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7371506">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7371510">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371530">t2</span>&nbsp;<span class="op" id="7371533">:=</span>&nbsp;<span class="ident" id="7371536">Must</span><span class="op" id="7371540">(</span><span class="ident" id="7371541">t0</span><span class="op" id="7371543">.</span><span class="ident" id="7371544">Clone</span><span class="op" id="7371549">(</span><span class="op" id="7371550">)</span><span class="op" id="7371551">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371554">Must</span><span class="op" id="7371558">(</span><span class="ident" id="7371559">t2</span><span class="op" id="7371561">.</span><span class="ident" id="7371562">Parse</span><span class="op" id="7371567">(</span><span class="string" id="7371568">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;p&nbsp;onclick=&#34;javascript:&nbsp;{{end}}`</span><span class="op" id="7371618">)</span><span class="op" id="7371619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371622">Must</span><span class="op" id="7371626">(</span><span class="ident" id="7371627">t2</span><span class="op" id="7371629">.</span><span class="ident" id="7371630">Parse</span><span class="op" id="7371635">(</span><span class="string" id="7371636">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/p&gt;&nbsp;{{end}}`</span><span class="op" id="7371669">)</span><span class="op" id="7371670">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7371674">//&nbsp;Execute&nbsp;t2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371690">b</span><span class="op" id="7371691">.</span><span class="ident" id="7371692">Reset</span><span class="op" id="7371697">(</span><span class="op" id="7371698">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7371701">if</span>&nbsp;<span class="ident" id="7371704">err</span>&nbsp;<span class="op" id="7371708">:=</span>&nbsp;<span class="ident" id="7371711">t2</span><span class="op" id="7371713">.</span><span class="ident" id="7371714">ExecuteTemplate</span><span class="op" id="7371729">(</span><span class="ident" id="7371730">b</span><span class="op" id="7371731">,</span>&nbsp;<span class="string" id="7371733">&#34;a&#34;</span><span class="op" id="7371736">,</span>&nbsp;<span class="string" id="7371738">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="7371745">)</span><span class="op" id="7371746">;</span>&nbsp;<span class="ident" id="7371748">err</span>&nbsp;<span class="op" id="7371752">!=</span>&nbsp;<span class="ident" id="7371755">nil</span>&nbsp;<span class="op" id="7371759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371763">t</span><span class="op" id="7371764">.</span><span class="ident" id="7371765">Fatal</span><span class="op" id="7371770">(</span><span class="ident" id="7371771">err</span><span class="op" id="7371774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7371777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7371780">if</span>&nbsp;<span class="ident" id="7371783">got</span><span class="op" id="7371786">,</span>&nbsp;<span class="ident" id="7371788">want</span>&nbsp;<span class="op" id="7371793">:=</span>&nbsp;<span class="ident" id="7371796">b</span><span class="op" id="7371797">.</span><span class="ident" id="7371798">String</span><span class="op" id="7371804">(</span><span class="op" id="7371805">)</span><span class="op" id="7371806">,</span>&nbsp;<span class="string" id="7371808">`&nbsp;&lt;p&nbsp;onclick=&#34;javascript:&nbsp;&amp;#34;\u003ci\u003e*/&amp;#34;&nbsp;&#34;&gt;&lt;/p&gt;&nbsp;`</span><span class="op" id="7371868">;</span>&nbsp;<span class="ident" id="7371870">got</span>&nbsp;<span class="op" id="7371874">!=</span>&nbsp;<span class="ident" id="7371877">want</span>&nbsp;<span class="op" id="7371882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371886">t</span><span class="op" id="7371887">.</span><span class="ident" id="7371888">Errorf</span><span class="op" id="7371894">(</span><span class="string" id="7371895">&#34;t2:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7371915">,</span>&nbsp;<span class="ident" id="7371917">got</span><span class="op" id="7371920">,</span>&nbsp;<span class="ident" id="7371922">want</span><span class="op" id="7371926">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7371929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7371933">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t3,&nbsp;but&nbsp;do&nbsp;not&nbsp;execute&nbsp;t3&nbsp;yet.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7371980">t3</span>&nbsp;<span class="op" id="7371983">:=</span>&nbsp;<span class="ident" id="7371986">Must</span><span class="op" id="7371990">(</span><span class="ident" id="7371991">t0</span><span class="op" id="7371993">.</span><span class="ident" id="7371994">Clone</span><span class="op" id="7371999">(</span><span class="op" id="7372000">)</span><span class="op" id="7372001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372004">Must</span><span class="op" id="7372008">(</span><span class="ident" id="7372009">t3</span><span class="op" id="7372011">.</span><span class="ident" id="7372012">Parse</span><span class="op" id="7372017">(</span><span class="string" id="7372018">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;style&gt;&nbsp;{{end}}`</span><span class="op" id="7372052">)</span><span class="op" id="7372053">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372056">Must</span><span class="op" id="7372060">(</span><span class="ident" id="7372061">t3</span><span class="op" id="7372063">.</span><span class="ident" id="7372064">Parse</span><span class="op" id="7372069">(</span><span class="string" id="7372070">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&lt;/style&gt;&nbsp;{{end}}`</span><span class="op" id="7372105">)</span><span class="op" id="7372106">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7372110">//&nbsp;Complete&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372127">Must</span><span class="op" id="7372131">(</span><span class="ident" id="7372132">t0</span><span class="op" id="7372134">.</span><span class="ident" id="7372135">Parse</span><span class="op" id="7372140">(</span><span class="string" id="7372141">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;(&nbsp;{{end}}`</span><span class="op" id="7372169">)</span><span class="op" id="7372170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372173">Must</span><span class="op" id="7372177">(</span><span class="ident" id="7372178">t0</span><span class="op" id="7372180">.</span><span class="ident" id="7372181">Parse</span><span class="op" id="7372186">(</span><span class="string" id="7372187">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;)&nbsp;{{end}}`</span><span class="op" id="7372215">)</span><span class="op" id="7372216">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7372220">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t4.&nbsp;Redefining&nbsp;the&nbsp;&#34;lhs&#34;&nbsp;template&nbsp;should&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372283">t4</span>&nbsp;<span class="op" id="7372286">:=</span>&nbsp;<span class="ident" id="7372289">Must</span><span class="op" id="7372293">(</span><span class="ident" id="7372294">t0</span><span class="op" id="7372296">.</span><span class="ident" id="7372297">Clone</span><span class="op" id="7372302">(</span><span class="op" id="7372303">)</span><span class="op" id="7372304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372307">if</span>&nbsp;<span class="ident" id="7372310">_</span><span class="op" id="7372311">,</span>&nbsp;<span class="ident" id="7372313">err</span>&nbsp;<span class="op" id="7372317">:=</span>&nbsp;<span class="ident" id="7372320">t4</span><span class="op" id="7372322">.</span><span class="ident" id="7372323">Parse</span><span class="op" id="7372328">(</span><span class="string" id="7372329">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;FAIL&nbsp;{{end}}`</span><span class="op" id="7372360">)</span><span class="op" id="7372361">;</span>&nbsp;<span class="ident" id="7372363">err</span>&nbsp;<span class="op" id="7372367">==</span>&nbsp;<span class="ident" id="7372370">nil</span>&nbsp;<span class="op" id="7372374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372378">t</span><span class="op" id="7372379">.</span><span class="ident" id="7372380">Error</span><span class="op" id="7372385">(</span><span class="string" id="7372386">`redefine&nbsp;&#34;lhs&#34;:&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="7372428">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7372431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7372435">//&nbsp;Execute&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372451">b</span><span class="op" id="7372452">.</span><span class="ident" id="7372453">Reset</span><span class="op" id="7372458">(</span><span class="op" id="7372459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372462">if</span>&nbsp;<span class="ident" id="7372465">err</span>&nbsp;<span class="op" id="7372469">:=</span>&nbsp;<span class="ident" id="7372472">t0</span><span class="op" id="7372474">.</span><span class="ident" id="7372475">ExecuteTemplate</span><span class="op" id="7372490">(</span><span class="ident" id="7372491">b</span><span class="op" id="7372492">,</span>&nbsp;<span class="string" id="7372494">&#34;a&#34;</span><span class="op" id="7372497">,</span>&nbsp;<span class="string" id="7372499">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="7372506">)</span><span class="op" id="7372507">;</span>&nbsp;<span class="ident" id="7372509">err</span>&nbsp;<span class="op" id="7372513">!=</span>&nbsp;<span class="ident" id="7372516">nil</span>&nbsp;<span class="op" id="7372520">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372524">t</span><span class="op" id="7372525">.</span><span class="ident" id="7372526">Fatal</span><span class="op" id="7372531">(</span><span class="ident" id="7372532">err</span><span class="op" id="7372535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7372538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372541">if</span>&nbsp;<span class="ident" id="7372544">got</span><span class="op" id="7372547">,</span>&nbsp;<span class="ident" id="7372549">want</span>&nbsp;<span class="op" id="7372554">:=</span>&nbsp;<span class="ident" id="7372557">b</span><span class="op" id="7372558">.</span><span class="ident" id="7372559">String</span><span class="op" id="7372565">(</span><span class="op" id="7372566">)</span><span class="op" id="7372567">,</span>&nbsp;<span class="string" id="7372569">`&nbsp;(&nbsp;&amp;lt;i&amp;gt;*/&nbsp;)&nbsp;`</span><span class="op" id="7372588">;</span>&nbsp;<span class="ident" id="7372590">got</span>&nbsp;<span class="op" id="7372594">!=</span>&nbsp;<span class="ident" id="7372597">want</span>&nbsp;<span class="op" id="7372602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372606">t</span><span class="op" id="7372607">.</span><span class="ident" id="7372608">Errorf</span><span class="op" id="7372614">(</span><span class="string" id="7372615">&#34;t0:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7372635">,</span>&nbsp;<span class="ident" id="7372637">got</span><span class="op" id="7372640">,</span>&nbsp;<span class="ident" id="7372642">want</span><span class="op" id="7372646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7372649">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7372653">//&nbsp;Clone&nbsp;t0.&nbsp;This&nbsp;should&nbsp;fail,&nbsp;as&nbsp;t0&nbsp;has&nbsp;already&nbsp;executed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372713">if</span>&nbsp;<span class="ident" id="7372716">_</span><span class="op" id="7372717">,</span>&nbsp;<span class="ident" id="7372719">err</span>&nbsp;<span class="op" id="7372723">:=</span>&nbsp;<span class="ident" id="7372726">t0</span><span class="op" id="7372728">.</span><span class="ident" id="7372729">Clone</span><span class="op" id="7372734">(</span><span class="op" id="7372735">)</span><span class="op" id="7372736">;</span>&nbsp;<span class="ident" id="7372738">err</span>&nbsp;<span class="op" id="7372742">==</span>&nbsp;<span class="ident" id="7372745">nil</span>&nbsp;<span class="op" id="7372749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372753">t</span><span class="op" id="7372754">.</span><span class="ident" id="7372755">Error</span><span class="op" id="7372760">(</span><span class="string" id="7372761">`t0.Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="7372799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7372802">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7372806">//&nbsp;Similarly,&nbsp;cloning&nbsp;sub-templates&nbsp;should&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372856">if</span>&nbsp;<span class="ident" id="7372859">_</span><span class="op" id="7372860">,</span>&nbsp;<span class="ident" id="7372862">err</span>&nbsp;<span class="op" id="7372866">:=</span>&nbsp;<span class="ident" id="7372869">t0</span><span class="op" id="7372871">.</span><span class="ident" id="7372872">Lookup</span><span class="op" id="7372878">(</span><span class="string" id="7372879">&#34;a&#34;</span><span class="op" id="7372882">)</span><span class="op" id="7372883">.</span><span class="ident" id="7372884">Clone</span><span class="op" id="7372889">(</span><span class="op" id="7372890">)</span><span class="op" id="7372891">;</span>&nbsp;<span class="ident" id="7372893">err</span>&nbsp;<span class="op" id="7372897">==</span>&nbsp;<span class="ident" id="7372900">nil</span>&nbsp;<span class="op" id="7372904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7372908">t</span><span class="op" id="7372909">.</span><span class="ident" id="7372910">Error</span><span class="op" id="7372915">(</span><span class="string" id="7372916">`t0.Lookup(&#34;a&#34;).Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="7372966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7372969">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7372972">if</span>&nbsp;<span class="ident" id="7372975">_</span><span class="op" id="7372976">,</span>&nbsp;<span class="ident" id="7372978">err</span>&nbsp;<span class="op" id="7372982">:=</span>&nbsp;<span class="ident" id="7372985">t0</span><span class="op" id="7372987">.</span><span class="ident" id="7372988">Lookup</span><span class="op" id="7372994">(</span><span class="string" id="7372995">&#34;lhs&#34;</span><span class="op" id="7373000">)</span><span class="op" id="7373001">.</span><span class="ident" id="7373002">Clone</span><span class="op" id="7373007">(</span><span class="op" id="7373008">)</span><span class="op" id="7373009">;</span>&nbsp;<span class="ident" id="7373011">err</span>&nbsp;<span class="op" id="7373015">==</span>&nbsp;<span class="ident" id="7373018">nil</span>&nbsp;<span class="op" id="7373022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373026">t</span><span class="op" id="7373027">.</span><span class="ident" id="7373028">Error</span><span class="op" id="7373033">(</span><span class="string" id="7373034">`t0.Lookup(&#34;lhs&#34;).Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="7373086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7373093">//&nbsp;Execute&nbsp;t3.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373109">b</span><span class="op" id="7373110">.</span><span class="ident" id="7373111">Reset</span><span class="op" id="7373116">(</span><span class="op" id="7373117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373120">if</span>&nbsp;<span class="ident" id="7373123">err</span>&nbsp;<span class="op" id="7373127">:=</span>&nbsp;<span class="ident" id="7373130">t3</span><span class="op" id="7373132">.</span><span class="ident" id="7373133">ExecuteTemplate</span><span class="op" id="7373148">(</span><span class="ident" id="7373149">b</span><span class="op" id="7373150">,</span>&nbsp;<span class="string" id="7373152">&#34;a&#34;</span><span class="op" id="7373155">,</span>&nbsp;<span class="string" id="7373157">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="7373164">)</span><span class="op" id="7373165">;</span>&nbsp;<span class="ident" id="7373167">err</span>&nbsp;<span class="op" id="7373171">!=</span>&nbsp;<span class="ident" id="7373174">nil</span>&nbsp;<span class="op" id="7373178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373182">t</span><span class="op" id="7373183">.</span><span class="ident" id="7373184">Fatal</span><span class="op" id="7373189">(</span><span class="ident" id="7373190">err</span><span class="op" id="7373193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373199">if</span>&nbsp;<span class="ident" id="7373202">got</span><span class="op" id="7373205">,</span>&nbsp;<span class="ident" id="7373207">want</span>&nbsp;<span class="op" id="7373212">:=</span>&nbsp;<span class="ident" id="7373215">b</span><span class="op" id="7373216">.</span><span class="ident" id="7373217">String</span><span class="op" id="7373223">(</span><span class="op" id="7373224">)</span><span class="op" id="7373225">,</span>&nbsp;<span class="string" id="7373227">`&nbsp;&lt;style&gt;&nbsp;ZgotmplZ&nbsp;&lt;/style&gt;&nbsp;`</span><span class="op" id="7373256">;</span>&nbsp;<span class="ident" id="7373258">got</span>&nbsp;<span class="op" id="7373262">!=</span>&nbsp;<span class="ident" id="7373265">want</span>&nbsp;<span class="op" id="7373270">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373274">t</span><span class="op" id="7373275">.</span><span class="ident" id="7373276">Errorf</span><span class="op" id="7373282">(</span><span class="string" id="7373283">&#34;t3:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7373303">,</span>&nbsp;<span class="ident" id="7373305">got</span><span class="op" id="7373308">,</span>&nbsp;<span class="ident" id="7373310">want</span><span class="op" id="7373314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373317">}</span><br>
<span class="lineno"></span><span class="op" id="7373319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7373322">func</span>&nbsp;<span class="ident" id="7373327">TestTemplates</span><span class="op" id="7373340">(</span><span class="ident" id="7373341">t</span>&nbsp;<span class="op" id="7373343">*</span><span class="ident" id="7373344">testing</span><span class="op" id="7373351">.</span><span class="ident" id="7373352">T</span><span class="op" id="7373353">)</span>&nbsp;<span class="op" id="7373355">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373358">names</span>&nbsp;<span class="op" id="7373364">:=</span>&nbsp;<span class="op" id="7373367">[</span><span class="op" id="7373368">]</span><span class="builtintype" id="7373369">string</span><span class="op" id="7373375">{</span><span class="string" id="7373376">&#34;t0&#34;</span><span class="op" id="7373380">,</span>&nbsp;<span class="string" id="7373382">&#34;a&#34;</span><span class="op" id="7373385">,</span>&nbsp;<span class="string" id="7373387">&#34;lhs&#34;</span><span class="op" id="7373392">,</span>&nbsp;<span class="string" id="7373394">&#34;rhs&#34;</span><span class="op" id="7373399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7373402">//&nbsp;Some&nbsp;template&nbsp;definitions&nbsp;borrowed&nbsp;from&nbsp;TestClone.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373457">const</span>&nbsp;<span class="ident" id="7373463">tmpl</span>&nbsp;<span class="op" id="7373468">=</span>&nbsp;<span class="string" id="7373470">`<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;lhs&#34;}}{{.}}{{template&nbsp;&#34;rhs&#34;}}{{end}}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;a&nbsp;href=&#34;&nbsp;{{end}}<br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;{{end}}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373610">t0</span>&nbsp;<span class="op" id="7373613">:=</span>&nbsp;<span class="ident" id="7373616">Must</span><span class="op" id="7373620">(</span><span class="ident" id="7373621">New</span><span class="op" id="7373624">(</span><span class="string" id="7373625">&#34;t0&#34;</span><span class="op" id="7373629">)</span><span class="op" id="7373630">.</span><span class="ident" id="7373631">Parse</span><span class="op" id="7373636">(</span><span class="ident" id="7373637">tmpl</span><span class="op" id="7373641">)</span><span class="op" id="7373642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373645">templates</span>&nbsp;<span class="op" id="7373655">:=</span>&nbsp;<span class="ident" id="7373658">t0</span><span class="op" id="7373660">.</span><span class="ident" id="7373661">Templates</span><span class="op" id="7373670">(</span><span class="op" id="7373671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373674">if</span>&nbsp;<span class="builtinfunc" id="7373677">len</span><span class="op" id="7373680">(</span><span class="ident" id="7373681">templates</span><span class="op" id="7373690">)</span>&nbsp;<span class="op" id="7373692">!=</span>&nbsp;<span class="builtinfunc" id="7373695">len</span><span class="op" id="7373698">(</span><span class="ident" id="7373699">names</span><span class="op" id="7373704">)</span>&nbsp;<span class="op" id="7373706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373710">t</span><span class="op" id="7373711">.</span><span class="ident" id="7373712">Errorf</span><span class="op" id="7373718">(</span><span class="string" id="7373719">&#34;expected&nbsp;%d&nbsp;templates;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7373750">,</span>&nbsp;<span class="builtinfunc" id="7373752">len</span><span class="op" id="7373755">(</span><span class="ident" id="7373756">names</span><span class="op" id="7373761">)</span><span class="op" id="7373762">,</span>&nbsp;<span class="builtinfunc" id="7373764">len</span><span class="op" id="7373767">(</span><span class="ident" id="7373768">templates</span><span class="op" id="7373777">)</span><span class="op" id="7373778">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373784">for</span>&nbsp;<span class="ident" id="7373788">_</span><span class="op" id="7373789">,</span>&nbsp;<span class="ident" id="7373791">name</span>&nbsp;<span class="op" id="7373796">:=</span>&nbsp;<span class="keyword" id="7373799">range</span>&nbsp;<span class="ident" id="7373805">names</span>&nbsp;<span class="op" id="7373811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373815">found</span>&nbsp;<span class="op" id="7373821">:=</span>&nbsp;<span class="builtintype" id="7373824">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373832">for</span>&nbsp;<span class="ident" id="7373836">_</span><span class="op" id="7373837">,</span>&nbsp;<span class="ident" id="7373839">tmpl</span>&nbsp;<span class="op" id="7373844">:=</span>&nbsp;<span class="keyword" id="7373847">range</span>&nbsp;<span class="ident" id="7373853">templates</span>&nbsp;<span class="op" id="7373863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373868">if</span>&nbsp;<span class="ident" id="7373871">name</span>&nbsp;<span class="op" id="7373876">==</span>&nbsp;<span class="ident" id="7373879">tmpl</span><span class="op" id="7373883">.</span><span class="ident" id="7373884">text</span><span class="op" id="7373888">.</span><span class="ident" id="7373889">Name</span><span class="op" id="7373893">(</span><span class="op" id="7373894">)</span>&nbsp;<span class="op" id="7373896">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373902">found</span>&nbsp;<span class="op" id="7373908">=</span>&nbsp;<span class="builtintype" id="7373910">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373919">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7373936">if</span>&nbsp;<span class="op" id="7373939">!</span><span class="ident" id="7373940">found</span>&nbsp;<span class="op" id="7373946">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7373951">t</span><span class="op" id="7373952">.</span><span class="ident" id="7373953">Error</span><span class="op" id="7373958">(</span><span class="string" id="7373959">&#34;could&nbsp;not&nbsp;find&nbsp;template&#34;</span><span class="op" id="7373984">,</span>&nbsp;<span class="ident" id="7373986">name</span><span class="op" id="7373990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7373997">}</span><br>
<span class="lineno"></span><span class="op" id="7373999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="7374002">//&nbsp;This&nbsp;used&nbsp;to&nbsp;crash;&nbsp;http://golang.org/issue/3281</span><br>
<span class="lineno"></span><span class="keyword" id="7374054">func</span>&nbsp;<span class="ident" id="7374059">TestCloneCrash</span><span class="op" id="7374073">(</span><span class="ident" id="7374074">t</span>&nbsp;<span class="op" id="7374076">*</span><span class="ident" id="7374077">testing</span><span class="op" id="7374084">.</span><span class="ident" id="7374085">T</span><span class="op" id="7374086">)</span>&nbsp;<span class="op" id="7374088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374091">t1</span>&nbsp;<span class="op" id="7374094">:=</span>&nbsp;<span class="ident" id="7374097">New</span><span class="op" id="7374100">(</span><span class="string" id="7374101">&#34;all&#34;</span><span class="op" id="7374106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374109">Must</span><span class="op" id="7374113">(</span><span class="ident" id="7374114">t1</span><span class="op" id="7374116">.</span><span class="ident" id="7374117">New</span><span class="op" id="7374120">(</span><span class="string" id="7374121">&#34;t1&#34;</span><span class="op" id="7374125">)</span><span class="op" id="7374126">.</span><span class="ident" id="7374127">Parse</span><span class="op" id="7374132">(</span><span class="string" id="7374133">`{{define&nbsp;&#34;foo&#34;}}foo{{end}}`</span><span class="op" id="7374161">)</span><span class="op" id="7374162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374165">t1</span><span class="op" id="7374167">.</span><span class="ident" id="7374168">Clone</span><span class="op" id="7374173">(</span><span class="op" id="7374174">)</span><br>
<span class="lineno">150</span><span class="op" id="7374176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7374179">//&nbsp;Ensure&nbsp;that&nbsp;this&nbsp;guarantee&nbsp;from&nbsp;the&nbsp;docs&nbsp;is&nbsp;upheld:</span><br>
<span class="lineno"></span><span class="comment" id="7374234">//&nbsp;&#34;Further&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;in&nbsp;the&nbsp;copy&nbsp;will&nbsp;add&nbsp;templates</span><br>
<span class="lineno"></span><span class="comment" id="7374292">//&nbsp;to&nbsp;the&nbsp;copy&nbsp;but&nbsp;not&nbsp;to&nbsp;the&nbsp;original.&#34;</span><br>
<span class="lineno">155</span><span class="keyword" id="7374333">func</span>&nbsp;<span class="ident" id="7374338">TestCloneThenParse</span><span class="op" id="7374356">(</span><span class="ident" id="7374357">t</span>&nbsp;<span class="op" id="7374359">*</span><span class="ident" id="7374360">testing</span><span class="op" id="7374367">.</span><span class="ident" id="7374368">T</span><span class="op" id="7374369">)</span>&nbsp;<span class="op" id="7374371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374374">t0</span>&nbsp;<span class="op" id="7374377">:=</span>&nbsp;<span class="ident" id="7374380">Must</span><span class="op" id="7374384">(</span><span class="ident" id="7374385">New</span><span class="op" id="7374388">(</span><span class="string" id="7374389">&#34;t0&#34;</span><span class="op" id="7374393">)</span><span class="op" id="7374394">.</span><span class="ident" id="7374395">Parse</span><span class="op" id="7374400">(</span><span class="string" id="7374401">`{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;embedded&#34;}}{{end}}`</span><span class="op" id="7374447">)</span><span class="op" id="7374448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374451">t1</span>&nbsp;<span class="op" id="7374454">:=</span>&nbsp;<span class="ident" id="7374457">Must</span><span class="op" id="7374461">(</span><span class="ident" id="7374462">t0</span><span class="op" id="7374464">.</span><span class="ident" id="7374465">Clone</span><span class="op" id="7374470">(</span><span class="op" id="7374471">)</span><span class="op" id="7374472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374475">Must</span><span class="op" id="7374479">(</span><span class="ident" id="7374480">t1</span><span class="op" id="7374482">.</span><span class="ident" id="7374483">Parse</span><span class="op" id="7374488">(</span><span class="string" id="7374489">`{{define&nbsp;&#34;embedded&#34;}}t1{{end}}`</span><span class="op" id="7374521">)</span><span class="op" id="7374522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7374525">if</span>&nbsp;<span class="builtinfunc" id="7374528">len</span><span class="op" id="7374531">(</span><span class="ident" id="7374532">t0</span><span class="op" id="7374534">.</span><span class="ident" id="7374535">Templates</span><span class="op" id="7374544">(</span><span class="op" id="7374545">)</span><span class="op" id="7374546">)</span><span class="op" id="7374547">+</span><span class="num" id="7374548">1</span>&nbsp;<span class="op" id="7374550">!=</span>&nbsp;<span class="builtinfunc" id="7374553">len</span><span class="op" id="7374556">(</span><span class="ident" id="7374557">t1</span><span class="op" id="7374559">.</span><span class="ident" id="7374560">Templates</span><span class="op" id="7374569">(</span><span class="op" id="7374570">)</span><span class="op" id="7374571">)</span>&nbsp;<span class="op" id="7374573">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374577">t</span><span class="op" id="7374578">.</span><span class="ident" id="7374579">Error</span><span class="op" id="7374584">(</span><span class="string" id="7374585">&#34;adding&nbsp;a&nbsp;template&nbsp;to&nbsp;a&nbsp;clone&nbsp;added&nbsp;it&nbsp;to&nbsp;the&nbsp;original&#34;</span><span class="op" id="7374640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7374643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7374646">//&nbsp;double&nbsp;check&nbsp;that&nbsp;the&nbsp;embedded&nbsp;template&nbsp;isn&#39;t&nbsp;available&nbsp;in&nbsp;the&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374722">err</span>&nbsp;<span class="op" id="7374726">:=</span>&nbsp;<span class="ident" id="7374729">t0</span><span class="op" id="7374731">.</span><span class="ident" id="7374732">ExecuteTemplate</span><span class="op" id="7374747">(</span><span class="ident" id="7374748">ioutil</span><span class="op" id="7374754">.</span><span class="ident" id="7374755">Discard</span><span class="op" id="7374762">,</span>&nbsp;<span class="string" id="7374764">&#34;a&#34;</span><span class="op" id="7374767">,</span>&nbsp;<span class="ident" id="7374769">nil</span><span class="op" id="7374772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7374775">if</span>&nbsp;<span class="ident" id="7374778">err</span>&nbsp;<span class="op" id="7374782">==</span>&nbsp;<span class="ident" id="7374785">nil</span>&nbsp;<span class="op" id="7374789">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374793">t</span><span class="op" id="7374794">.</span><span class="ident" id="7374795">Error</span><span class="op" id="7374800">(</span><span class="string" id="7374801">&#34;expected&nbsp;&#39;no&nbsp;such&nbsp;template&#39;&nbsp;error&#34;</span><span class="op" id="7374836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7374839">}</span><br>
<span class="lineno"></span><span class="op" id="7374841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7374844">//&nbsp;https://code.google.com/p/go/issues/detail?id=5980</span><br>
<span class="lineno">170</span><span class="keyword" id="7374898">func</span>&nbsp;<span class="ident" id="7374903">TestFuncMapWorksAfterClone</span><span class="op" id="7374929">(</span><span class="ident" id="7374930">t</span>&nbsp;<span class="op" id="7374932">*</span><span class="ident" id="7374933">testing</span><span class="op" id="7374940">.</span><span class="ident" id="7374941">T</span><span class="op" id="7374942">)</span>&nbsp;<span class="op" id="7374944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7374947">funcs</span>&nbsp;<span class="op" id="7374953">:=</span>&nbsp;<span class="ident" id="7374956">FuncMap</span><span class="op" id="7374963">{</span><span class="string" id="7374964">&#34;customFunc&#34;</span><span class="op" id="7374976">:</span>&nbsp;<span class="keyword" id="7374978">func</span><span class="op" id="7374982">(</span><span class="op" id="7374983">)</span>&nbsp;<span class="op" id="7374985">(</span><span class="builtintype" id="7374986">string</span><span class="op" id="7374992">,</span>&nbsp;<span class="builtintype" id="7374994">error</span><span class="op" id="7374999">)</span>&nbsp;<span class="op" id="7375001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7375005">return</span>&nbsp;<span class="string" id="7375012">&#34;&#34;</span><span class="op" id="7375014">,</span>&nbsp;<span class="ident" id="7375016">errors</span><span class="op" id="7375022">.</span><span class="ident" id="7375023">New</span><span class="op" id="7375026">(</span><span class="string" id="7375027">&#34;issue5980&#34;</span><span class="op" id="7375038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7375041">}</span><span class="op" id="7375042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7375046">//&nbsp;get&nbsp;the&nbsp;expected&nbsp;error&nbsp;output&nbsp;(no&nbsp;clone)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375091">uncloned</span>&nbsp;<span class="op" id="7375100">:=</span>&nbsp;<span class="ident" id="7375103">Must</span><span class="op" id="7375107">(</span><span class="ident" id="7375108">New</span><span class="op" id="7375111">(</span><span class="string" id="7375112">&#34;&#34;</span><span class="op" id="7375114">)</span><span class="op" id="7375115">.</span><span class="ident" id="7375116">Funcs</span><span class="op" id="7375121">(</span><span class="ident" id="7375122">funcs</span><span class="op" id="7375127">)</span><span class="op" id="7375128">.</span><span class="ident" id="7375129">Parse</span><span class="op" id="7375134">(</span><span class="string" id="7375135">&#34;{{customFunc}}&#34;</span><span class="op" id="7375151">)</span><span class="op" id="7375152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375155">wantErr</span>&nbsp;<span class="op" id="7375163">:=</span>&nbsp;<span class="ident" id="7375166">uncloned</span><span class="op" id="7375174">.</span><span class="ident" id="7375175">Execute</span><span class="op" id="7375182">(</span><span class="ident" id="7375183">ioutil</span><span class="op" id="7375189">.</span><span class="ident" id="7375190">Discard</span><span class="op" id="7375197">,</span>&nbsp;<span class="ident" id="7375199">nil</span><span class="op" id="7375202">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7375206">//&nbsp;toClone&nbsp;must&nbsp;be&nbsp;the&nbsp;same&nbsp;as&nbsp;uncloned.&nbsp;It&nbsp;has&nbsp;to&nbsp;be&nbsp;recreated&nbsp;from&nbsp;scratch,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7375285">//&nbsp;since&nbsp;cloning&nbsp;cannot&nbsp;occur&nbsp;after&nbsp;execution.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375333">toClone</span>&nbsp;<span class="op" id="7375341">:=</span>&nbsp;<span class="ident" id="7375344">Must</span><span class="op" id="7375348">(</span><span class="ident" id="7375349">New</span><span class="op" id="7375352">(</span><span class="string" id="7375353">&#34;&#34;</span><span class="op" id="7375355">)</span><span class="op" id="7375356">.</span><span class="ident" id="7375357">Funcs</span><span class="op" id="7375362">(</span><span class="ident" id="7375363">funcs</span><span class="op" id="7375368">)</span><span class="op" id="7375369">.</span><span class="ident" id="7375370">Parse</span><span class="op" id="7375375">(</span><span class="string" id="7375376">&#34;{{customFunc}}&#34;</span><span class="op" id="7375392">)</span><span class="op" id="7375393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375396">cloned</span>&nbsp;<span class="op" id="7375403">:=</span>&nbsp;<span class="ident" id="7375406">Must</span><span class="op" id="7375410">(</span><span class="ident" id="7375411">toClone</span><span class="op" id="7375418">.</span><span class="ident" id="7375419">Clone</span><span class="op" id="7375424">(</span><span class="op" id="7375425">)</span><span class="op" id="7375426">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375429">gotErr</span>&nbsp;<span class="op" id="7375436">:=</span>&nbsp;<span class="ident" id="7375439">cloned</span><span class="op" id="7375445">.</span><span class="ident" id="7375446">Execute</span><span class="op" id="7375453">(</span><span class="ident" id="7375454">ioutil</span><span class="op" id="7375460">.</span><span class="ident" id="7375461">Discard</span><span class="op" id="7375468">,</span>&nbsp;<span class="ident" id="7375470">nil</span><span class="op" id="7375473">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7375477">if</span>&nbsp;<span class="ident" id="7375480">wantErr</span><span class="op" id="7375487">.</span><span class="ident" id="7375488">Error</span><span class="op" id="7375493">(</span><span class="op" id="7375494">)</span>&nbsp;<span class="op" id="7375496">!=</span>&nbsp;<span class="ident" id="7375499">gotErr</span><span class="op" id="7375505">.</span><span class="ident" id="7375506">Error</span><span class="op" id="7375511">(</span><span class="op" id="7375512">)</span>&nbsp;<span class="op" id="7375514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7375518">t</span><span class="op" id="7375519">.</span><span class="ident" id="7375520">Errorf</span><span class="op" id="7375526">(</span><span class="string" id="7375527">&#34;clone&nbsp;error&nbsp;message&nbsp;mismatch&nbsp;want&nbsp;%q&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7375572">,</span>&nbsp;<span class="ident" id="7375574">wantErr</span><span class="op" id="7375581">,</span>&nbsp;<span class="ident" id="7375583">gotErr</span><span class="op" id="7375589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7375592">}</span><br>
<span class="lineno"></span><span class="op" id="7375594">}</span>
</div>
</body>
</html>
