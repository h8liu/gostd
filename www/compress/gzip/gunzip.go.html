<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4284145">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4284200">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4284254">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4284305">//&nbsp;Package&nbsp;gzip&nbsp;implements&nbsp;reading&nbsp;and&nbsp;writing&nbsp;of&nbsp;gzip&nbsp;format&nbsp;compressed&nbsp;files,</span><br>
<span class="lineno"></span><span class="comment" id="4284385">//&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;1952.</span><br>
<span class="lineno"></span><span class="keyword" id="4284414">package</span>&nbsp;<span class="ident" id="4284422">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4284428">import</span>&nbsp;<span class="op" id="4284435">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4284438">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4284447">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4284465">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4284475">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4284483">&#34;hash/crc32&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4284497">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4284503">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4284510">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4284513">const</span>&nbsp;<span class="op" id="4284519">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284522">gzipID1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4284534">=</span>&nbsp;<span class="num" id="4284536">0x1f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284542">gzipID2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4284554">=</span>&nbsp;<span class="num" id="4284556">0x8b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284562">gzipDeflate</span>&nbsp;<span class="op" id="4284574">=</span>&nbsp;<span class="num" id="4284576">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284579">flagText</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4284591">=</span>&nbsp;<span class="num" id="4284593">1</span>&nbsp;<span class="op" id="4284595">&lt;&lt;</span>&nbsp;<span class="num" id="4284598">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284601">flagHdrCrc</span>&nbsp;&nbsp;<span class="op" id="4284613">=</span>&nbsp;<span class="num" id="4284615">1</span>&nbsp;<span class="op" id="4284617">&lt;&lt;</span>&nbsp;<span class="num" id="4284620">1</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284623">flagExtra</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4284635">=</span>&nbsp;<span class="num" id="4284637">1</span>&nbsp;<span class="op" id="4284639">&lt;&lt;</span>&nbsp;<span class="num" id="4284642">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284645">flagName</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4284657">=</span>&nbsp;<span class="num" id="4284659">1</span>&nbsp;<span class="op" id="4284661">&lt;&lt;</span>&nbsp;<span class="num" id="4284664">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284667">flagComment</span>&nbsp;<span class="op" id="4284679">=</span>&nbsp;<span class="num" id="4284681">1</span>&nbsp;<span class="op" id="4284683">&lt;&lt;</span>&nbsp;<span class="num" id="4284686">4</span><br>
<span class="lineno"></span><span class="op" id="4284688">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="4284691">func</span>&nbsp;<span class="ident" id="4284696">makeReader</span><span class="op" id="4284706">(</span><span class="ident" id="4284707">r</span>&nbsp;<span class="ident" id="4284709">io</span><span class="op" id="4284711">.</span><span class="ident" id="4284712">Reader</span><span class="op" id="4284718">)</span>&nbsp;<span class="ident" id="4284720">flate</span><span class="op" id="4284725">.</span><span class="ident" id="4284726">Reader</span>&nbsp;<span class="op" id="4284733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4284736">if</span>&nbsp;<span class="ident" id="4284739">rr</span><span class="op" id="4284741">,</span>&nbsp;<span class="ident" id="4284743">ok</span>&nbsp;<span class="op" id="4284746">:=</span>&nbsp;<span class="ident" id="4284749">r</span><span class="op" id="4284750">.</span><span class="op" id="4284751">(</span><span class="ident" id="4284752">flate</span><span class="op" id="4284757">.</span><span class="ident" id="4284758">Reader</span><span class="op" id="4284764">)</span><span class="op" id="4284765">;</span>&nbsp;<span class="ident" id="4284767">ok</span>&nbsp;<span class="op" id="4284770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4284774">return</span>&nbsp;<span class="ident" id="4284781">rr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4284785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4284788">return</span>&nbsp;<span class="ident" id="4284795">bufio</span><span class="op" id="4284800">.</span><span class="ident" id="4284801">NewReader</span><span class="op" id="4284810">(</span><span class="ident" id="4284811">r</span><span class="op" id="4284812">)</span><br>
<span class="lineno">35</span><span class="op" id="4284814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4284817">var</span>&nbsp;<span class="op" id="4284821">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4284824">//&nbsp;ErrChecksum&nbsp;is&nbsp;returned&nbsp;when&nbsp;reading&nbsp;GZIP&nbsp;data&nbsp;that&nbsp;has&nbsp;an&nbsp;invalid&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4284905">ErrChecksum</span>&nbsp;<span class="op" id="4284917">=</span>&nbsp;<span class="ident" id="4284919">errors</span><span class="op" id="4284925">.</span><span class="ident" id="4284926">New</span><span class="op" id="4284929">(</span><span class="string" id="4284930">&#34;gzip:&nbsp;invalid&nbsp;checksum&#34;</span><span class="op" id="4284954">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4284957">//&nbsp;ErrHeader&nbsp;is&nbsp;returned&nbsp;when&nbsp;reading&nbsp;GZIP&nbsp;data&nbsp;that&nbsp;has&nbsp;an&nbsp;invalid&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285034">ErrHeader</span>&nbsp;<span class="op" id="4285044">=</span>&nbsp;<span class="ident" id="4285046">errors</span><span class="op" id="4285052">.</span><span class="ident" id="4285053">New</span><span class="op" id="4285056">(</span><span class="string" id="4285057">&#34;gzip:&nbsp;invalid&nbsp;header&#34;</span><span class="op" id="4285079">)</span><br>
<span class="lineno"></span><span class="op" id="4285081">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4285084">//&nbsp;The&nbsp;gzip&nbsp;file&nbsp;stores&nbsp;a&nbsp;header&nbsp;giving&nbsp;metadata&nbsp;about&nbsp;the&nbsp;compressed&nbsp;file.</span><br>
<span class="lineno">45</span><span class="comment" id="4285160">//&nbsp;That&nbsp;header&nbsp;is&nbsp;exposed&nbsp;as&nbsp;the&nbsp;fields&nbsp;of&nbsp;the&nbsp;Writer&nbsp;and&nbsp;Reader&nbsp;structs.</span><br>
<span class="lineno"></span><span class="keyword" id="4285234">type</span>&nbsp;<span class="ident" id="4285239">Header</span>&nbsp;<span class="keyword" id="4285246">struct</span>&nbsp;<span class="op" id="4285253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285256">Comment</span>&nbsp;<span class="builtintype" id="4285264">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4285274">//&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285286">Extra</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4285294">[</span><span class="op" id="4285295">]</span><span class="builtintype" id="4285296">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4285304">//&nbsp;&#34;extra&nbsp;data&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285321">ModTime</span>&nbsp;<span class="ident" id="4285329">time</span><span class="op" id="4285333">.</span><span class="ident" id="4285334">Time</span>&nbsp;<span class="comment" id="4285339">//&nbsp;modification&nbsp;time</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285361">Name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4285369">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4285379">//&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4285393">OS</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4285401">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4285411">//&nbsp;operating&nbsp;system&nbsp;type</span><br>
<span class="lineno"></span><span class="op" id="4285436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4285439">//&nbsp;A&nbsp;Reader&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;can&nbsp;be&nbsp;read&nbsp;to&nbsp;retrieve</span><br>
<span class="lineno">55</span><span class="comment" id="4285496">//&nbsp;uncompressed&nbsp;data&nbsp;from&nbsp;a&nbsp;gzip-format&nbsp;compressed&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="4285553">//</span><br>
<span class="lineno"></span><span class="comment" id="4285556">//&nbsp;In&nbsp;general,&nbsp;a&nbsp;gzip&nbsp;file&nbsp;can&nbsp;be&nbsp;a&nbsp;concatenation&nbsp;of&nbsp;gzip&nbsp;files,</span><br>
<span class="lineno"></span><span class="comment" id="4285621">//&nbsp;each&nbsp;with&nbsp;its&nbsp;own&nbsp;header.&nbsp;&nbsp;Reads&nbsp;from&nbsp;the&nbsp;Reader</span><br>
<span class="lineno"></span><span class="comment" id="4285673">//&nbsp;return&nbsp;the&nbsp;concatenation&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;of&nbsp;each.</span><br>
<span class="lineno">60</span><span class="comment" id="4285735">//&nbsp;Only&nbsp;the&nbsp;first&nbsp;header&nbsp;is&nbsp;recorded&nbsp;in&nbsp;the&nbsp;Reader&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="4285794">//</span><br>
<span class="lineno"></span><span class="comment" id="4285797">//&nbsp;Gzip&nbsp;files&nbsp;store&nbsp;a&nbsp;length&nbsp;and&nbsp;checksum&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="4285865">//&nbsp;The&nbsp;Reader&nbsp;will&nbsp;return&nbsp;a&nbsp;ErrChecksum&nbsp;when&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="4285915">//&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;uncompressed&nbsp;data&nbsp;if&nbsp;it&nbsp;does&nbsp;not</span><br>
<span class="lineno">65</span><span class="comment" id="4285974">//&nbsp;have&nbsp;the&nbsp;expected&nbsp;length&nbsp;or&nbsp;checksum.&nbsp;&nbsp;Clients&nbsp;should&nbsp;treat&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="4286042">//&nbsp;returned&nbsp;by&nbsp;Read&nbsp;as&nbsp;tentative&nbsp;until&nbsp;they&nbsp;receive&nbsp;the&nbsp;io.EOF</span><br>
<span class="lineno"></span><span class="comment" id="4286105">//&nbsp;marking&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4286137">type</span>&nbsp;<span class="ident" id="4286142">Reader</span>&nbsp;<span class="keyword" id="4286149">struct</span>&nbsp;<span class="op" id="4286156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286159">Header</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286167">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4286180">flate</span><span class="op" id="4286185">.</span><span class="ident" id="4286186">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286194">decompressor</span>&nbsp;<span class="ident" id="4286207">io</span><span class="op" id="4286209">.</span><span class="ident" id="4286210">ReadCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286222">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4286235">hash</span><span class="op" id="4286239">.</span><span class="ident" id="4286240">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286248">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4286261">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286269">flg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4286282">byte</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286288">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4286301">[</span><span class="num" id="4286302">512</span><span class="op" id="4286305">]</span><span class="builtintype" id="4286306">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286312">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4286325">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286332">multistream</span>&nbsp;&nbsp;<span class="builtintype" id="4286345">bool</span><br>
<span class="lineno"></span><span class="op" id="4286350">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="4286353">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;the&nbsp;given&nbsp;reader.</span><br>
<span class="lineno"></span><span class="comment" id="4286413">//&nbsp;If&nbsp;r&nbsp;does&nbsp;not&nbsp;also&nbsp;implement&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4286460">//&nbsp;the&nbsp;decompressor&nbsp;may&nbsp;read&nbsp;more&nbsp;data&nbsp;than&nbsp;necessary&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="4286522">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;Reader&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="keyword" id="4286598">func</span>&nbsp;<span class="ident" id="4286603">NewReader</span><span class="op" id="4286612">(</span><span class="ident" id="4286613">r</span>&nbsp;<span class="ident" id="4286615">io</span><span class="op" id="4286617">.</span><span class="ident" id="4286618">Reader</span><span class="op" id="4286624">)</span>&nbsp;<span class="op" id="4286626">(</span><span class="op" id="4286627">*</span><span class="ident" id="4286628">Reader</span><span class="op" id="4286634">,</span>&nbsp;<span class="builtintype" id="4286636">error</span><span class="op" id="4286641">)</span>&nbsp;<span class="op" id="4286643">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286646">z</span>&nbsp;<span class="op" id="4286648">:=</span>&nbsp;<span class="builtinfunc" id="4286651">new</span><span class="op" id="4286654">(</span><span class="ident" id="4286655">Reader</span><span class="op" id="4286661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286664">z</span><span class="op" id="4286665">.</span><span class="ident" id="4286666">r</span>&nbsp;<span class="op" id="4286668">=</span>&nbsp;<span class="ident" id="4286670">makeReader</span><span class="op" id="4286680">(</span><span class="ident" id="4286681">r</span><span class="op" id="4286682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286685">z</span><span class="op" id="4286686">.</span><span class="ident" id="4286687">multistream</span>&nbsp;<span class="op" id="4286699">=</span>&nbsp;<span class="ident" id="4286701">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4286707">z</span><span class="op" id="4286708">.</span><span class="ident" id="4286709">digest</span>&nbsp;<span class="op" id="4286716">=</span>&nbsp;<span class="ident" id="4286718">crc32</span><span class="op" id="4286723">.</span><span class="ident" id="4286724">NewIEEE</span><span class="op" id="4286731">(</span><span class="op" id="4286732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286735">if</span>&nbsp;<span class="ident" id="4286738">err</span>&nbsp;<span class="op" id="4286742">:=</span>&nbsp;<span class="ident" id="4286745">z</span><span class="op" id="4286746">.</span><span class="ident" id="4286747">readHeader</span><span class="op" id="4286757">(</span><span class="ident" id="4286758">true</span><span class="op" id="4286762">)</span><span class="op" id="4286763">;</span>&nbsp;<span class="ident" id="4286765">err</span>&nbsp;<span class="op" id="4286769">!=</span>&nbsp;<span class="ident" id="4286772">nil</span>&nbsp;<span class="op" id="4286776">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286780">return</span>&nbsp;<span class="ident" id="4286787">nil</span><span class="op" id="4286790">,</span>&nbsp;<span class="ident" id="4286792">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4286797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4286800">return</span>&nbsp;<span class="ident" id="4286807">z</span><span class="op" id="4286808">,</span>&nbsp;<span class="ident" id="4286810">nil</span><br>
<span class="lineno"></span><span class="op" id="4286814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="4286817">//&nbsp;Reset&nbsp;discards&nbsp;the&nbsp;Reader&nbsp;z&#39;s&nbsp;state&nbsp;and&nbsp;makes&nbsp;it&nbsp;equivalent&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4286887">//&nbsp;result&nbsp;of&nbsp;its&nbsp;original&nbsp;state&nbsp;from&nbsp;NewReader,&nbsp;but&nbsp;reading&nbsp;from&nbsp;r&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="4286963">//&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;Reader&nbsp;rather&nbsp;than&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4287030">func</span>&nbsp;<span class="op" id="4287035">(</span><span class="ident" id="4287036">z</span>&nbsp;<span class="op" id="4287038">*</span><span class="ident" id="4287039">Reader</span><span class="op" id="4287045">)</span>&nbsp;<span class="ident" id="4287047">Reset</span><span class="op" id="4287052">(</span><span class="ident" id="4287053">r</span>&nbsp;<span class="ident" id="4287055">io</span><span class="op" id="4287057">.</span><span class="ident" id="4287058">Reader</span><span class="op" id="4287064">)</span>&nbsp;<span class="builtintype" id="4287066">error</span>&nbsp;<span class="op" id="4287072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4287075">z</span><span class="op" id="4287076">.</span><span class="ident" id="4287077">r</span>&nbsp;<span class="op" id="4287079">=</span>&nbsp;<span class="ident" id="4287081">makeReader</span><span class="op" id="4287091">(</span><span class="ident" id="4287092">r</span><span class="op" id="4287093">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4287096">if</span>&nbsp;<span class="ident" id="4287099">z</span><span class="op" id="4287100">.</span><span class="ident" id="4287101">digest</span>&nbsp;<span class="op" id="4287108">==</span>&nbsp;<span class="ident" id="4287111">nil</span>&nbsp;<span class="op" id="4287115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4287119">z</span><span class="op" id="4287120">.</span><span class="ident" id="4287121">digest</span>&nbsp;<span class="op" id="4287128">=</span>&nbsp;<span class="ident" id="4287130">crc32</span><span class="op" id="4287135">.</span><span class="ident" id="4287136">NewIEEE</span><span class="op" id="4287143">(</span><span class="op" id="4287144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4287147">}</span>&nbsp;<span class="keyword" id="4287149">else</span>&nbsp;<span class="op" id="4287154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4287158">z</span><span class="op" id="4287159">.</span><span class="ident" id="4287160">digest</span><span class="op" id="4287166">.</span><span class="ident" id="4287167">Reset</span><span class="op" id="4287172">(</span><span class="op" id="4287173">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4287176">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4287179">z</span><span class="op" id="4287180">.</span><span class="ident" id="4287181">size</span>&nbsp;<span class="op" id="4287186">=</span>&nbsp;<span class="num" id="4287188">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4287191">z</span><span class="op" id="4287192">.</span><span class="ident" id="4287193">err</span>&nbsp;<span class="op" id="4287197">=</span>&nbsp;<span class="ident" id="4287199">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4287204">z</span><span class="op" id="4287205">.</span><span class="ident" id="4287206">multistream</span>&nbsp;<span class="op" id="4287218">=</span>&nbsp;<span class="ident" id="4287220">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4287226">return</span>&nbsp;<span class="ident" id="4287233">z</span><span class="op" id="4287234">.</span><span class="ident" id="4287235">readHeader</span><span class="op" id="4287245">(</span><span class="ident" id="4287246">true</span><span class="op" id="4287250">)</span><br>
<span class="lineno"></span><span class="op" id="4287252">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="comment" id="4287255">//&nbsp;Multistream&nbsp;controls&nbsp;whether&nbsp;the&nbsp;reader&nbsp;supports&nbsp;multistream&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="4287326">//</span><br>
<span class="lineno"></span><span class="comment" id="4287329">//&nbsp;If&nbsp;enabled&nbsp;(the&nbsp;default),&nbsp;the&nbsp;Reader&nbsp;expects&nbsp;the&nbsp;input&nbsp;to&nbsp;be&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="4287404">//&nbsp;of&nbsp;individually&nbsp;gzipped&nbsp;data&nbsp;streams,&nbsp;each&nbsp;with&nbsp;its&nbsp;own&nbsp;header&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="4287474">//&nbsp;trailer,&nbsp;ending&nbsp;at&nbsp;EOF.&nbsp;The&nbsp;effect&nbsp;is&nbsp;that&nbsp;the&nbsp;concatenation&nbsp;of&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="4287552">//&nbsp;of&nbsp;gzipped&nbsp;files&nbsp;is&nbsp;treated&nbsp;as&nbsp;equivalent&nbsp;to&nbsp;the&nbsp;gzip&nbsp;of&nbsp;the&nbsp;concatenation</span><br>
<span class="lineno"></span><span class="comment" id="4287630">//&nbsp;of&nbsp;the&nbsp;sequence.&nbsp;This&nbsp;is&nbsp;standard&nbsp;behavior&nbsp;for&nbsp;gzip&nbsp;readers.</span><br>
<span class="lineno"></span><span class="comment" id="4287694">//</span><br>
<span class="lineno"></span><span class="comment" id="4287697">//&nbsp;Calling&nbsp;Multistream(false)&nbsp;disables&nbsp;this&nbsp;behavior;&nbsp;disabling&nbsp;the&nbsp;behavior</span><br>
<span class="lineno">120</span><span class="comment" id="4287774">//&nbsp;can&nbsp;be&nbsp;useful&nbsp;when&nbsp;reading&nbsp;file&nbsp;formats&nbsp;that&nbsp;distinguish&nbsp;individual&nbsp;gzip</span><br>
<span class="lineno"></span><span class="comment" id="4287850">//&nbsp;data&nbsp;streams&nbsp;or&nbsp;mix&nbsp;gzip&nbsp;data&nbsp;streams&nbsp;with&nbsp;other&nbsp;data&nbsp;streams.</span><br>
<span class="lineno"></span><span class="comment" id="4287916">//&nbsp;In&nbsp;this&nbsp;mode,&nbsp;when&nbsp;the&nbsp;Reader&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;data&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="4287985">//&nbsp;Read&nbsp;returns&nbsp;io.EOF.&nbsp;If&nbsp;the&nbsp;underlying&nbsp;reader&nbsp;implements&nbsp;io.ByteReader,</span><br>
<span class="lineno"></span><span class="comment" id="4288060">//&nbsp;it&nbsp;will&nbsp;be&nbsp;left&nbsp;positioned&nbsp;just&nbsp;after&nbsp;the&nbsp;gzip&nbsp;stream.</span><br>
<span class="lineno">125</span><span class="comment" id="4288118">//&nbsp;To&nbsp;start&nbsp;the&nbsp;next&nbsp;stream,&nbsp;call&nbsp;z.Reset(r)&nbsp;followed&nbsp;by&nbsp;z.Multistream(false).</span><br>
<span class="lineno"></span><span class="comment" id="4288197">//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;next&nbsp;stream,&nbsp;z.Reset(r)&nbsp;will&nbsp;return&nbsp;io.EOF.</span><br>
<span class="lineno"></span><span class="keyword" id="4288259">func</span>&nbsp;<span class="op" id="4288264">(</span><span class="ident" id="4288265">z</span>&nbsp;<span class="op" id="4288267">*</span><span class="ident" id="4288268">Reader</span><span class="op" id="4288274">)</span>&nbsp;<span class="ident" id="4288276">Multistream</span><span class="op" id="4288287">(</span><span class="ident" id="4288288">ok</span>&nbsp;<span class="builtintype" id="4288291">bool</span><span class="op" id="4288295">)</span>&nbsp;<span class="op" id="4288297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288300">z</span><span class="op" id="4288301">.</span><span class="ident" id="4288302">multistream</span>&nbsp;<span class="op" id="4288314">=</span>&nbsp;<span class="ident" id="4288316">ok</span><br>
<span class="lineno"></span><span class="op" id="4288319">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="4288322">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;is&nbsp;little-endian,&nbsp;unlike&nbsp;ZLIB&nbsp;(RFC&nbsp;1950).</span><br>
<span class="lineno"></span><span class="keyword" id="4288383">func</span>&nbsp;<span class="ident" id="4288388">get4</span><span class="op" id="4288392">(</span><span class="ident" id="4288393">p</span>&nbsp;<span class="op" id="4288395">[</span><span class="op" id="4288396">]</span><span class="builtintype" id="4288397">byte</span><span class="op" id="4288401">)</span>&nbsp;<span class="builtintype" id="4288403">uint32</span>&nbsp;<span class="op" id="4288410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288413">return</span>&nbsp;<span class="builtintype" id="4288420">uint32</span><span class="op" id="4288426">(</span><span class="ident" id="4288427">p</span><span class="op" id="4288428">[</span><span class="num" id="4288429">0</span><span class="op" id="4288430">]</span><span class="op" id="4288431">)</span>&nbsp;<span class="op" id="4288433">|</span>&nbsp;<span class="builtintype" id="4288435">uint32</span><span class="op" id="4288441">(</span><span class="ident" id="4288442">p</span><span class="op" id="4288443">[</span><span class="num" id="4288444">1</span><span class="op" id="4288445">]</span><span class="op" id="4288446">)</span><span class="op" id="4288447">&lt;&lt;</span><span class="num" id="4288449">8</span>&nbsp;<span class="op" id="4288451">|</span>&nbsp;<span class="builtintype" id="4288453">uint32</span><span class="op" id="4288459">(</span><span class="ident" id="4288460">p</span><span class="op" id="4288461">[</span><span class="num" id="4288462">2</span><span class="op" id="4288463">]</span><span class="op" id="4288464">)</span><span class="op" id="4288465">&lt;&lt;</span><span class="num" id="4288467">16</span>&nbsp;<span class="op" id="4288470">|</span>&nbsp;<span class="builtintype" id="4288472">uint32</span><span class="op" id="4288478">(</span><span class="ident" id="4288479">p</span><span class="op" id="4288480">[</span><span class="num" id="4288481">3</span><span class="op" id="4288482">]</span><span class="op" id="4288483">)</span><span class="op" id="4288484">&lt;&lt;</span><span class="num" id="4288486">24</span><br>
<span class="lineno"></span><span class="op" id="4288489">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="4288492">func</span>&nbsp;<span class="op" id="4288497">(</span><span class="ident" id="4288498">z</span>&nbsp;<span class="op" id="4288500">*</span><span class="ident" id="4288501">Reader</span><span class="op" id="4288507">)</span>&nbsp;<span class="ident" id="4288509">readString</span><span class="op" id="4288519">(</span><span class="op" id="4288520">)</span>&nbsp;<span class="op" id="4288522">(</span><span class="builtintype" id="4288523">string</span><span class="op" id="4288529">,</span>&nbsp;<span class="builtintype" id="4288531">error</span><span class="op" id="4288536">)</span>&nbsp;<span class="op" id="4288538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288541">var</span>&nbsp;<span class="ident" id="4288545">err</span>&nbsp;<span class="builtintype" id="4288549">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288556">needconv</span>&nbsp;<span class="op" id="4288565">:=</span>&nbsp;<span class="ident" id="4288568">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288575">for</span>&nbsp;<span class="ident" id="4288579">i</span>&nbsp;<span class="op" id="4288581">:=</span>&nbsp;<span class="num" id="4288584">0</span><span class="op" id="4288585">;</span>&nbsp;<span class="op" id="4288587">;</span>&nbsp;<span class="ident" id="4288589">i</span><span class="op" id="4288590">++</span>&nbsp;<span class="op" id="4288593">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288597">if</span>&nbsp;<span class="ident" id="4288600">i</span>&nbsp;<span class="op" id="4288602">&gt;=</span>&nbsp;<span class="builtinfunc" id="4288605">len</span><span class="op" id="4288608">(</span><span class="ident" id="4288609">z</span><span class="op" id="4288610">.</span><span class="ident" id="4288611">buf</span><span class="op" id="4288614">)</span>&nbsp;<span class="op" id="4288616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288621">return</span>&nbsp;<span class="string" id="4288628">&#34;&#34;</span><span class="op" id="4288630">,</span>&nbsp;<span class="ident" id="4288632">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4288644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288648">z</span><span class="op" id="4288649">.</span><span class="ident" id="4288650">buf</span><span class="op" id="4288653">[</span><span class="ident" id="4288654">i</span><span class="op" id="4288655">]</span><span class="op" id="4288656">,</span>&nbsp;<span class="ident" id="4288658">err</span>&nbsp;<span class="op" id="4288662">=</span>&nbsp;<span class="ident" id="4288664">z</span><span class="op" id="4288665">.</span><span class="ident" id="4288666">r</span><span class="op" id="4288667">.</span><span class="ident" id="4288668">ReadByte</span><span class="op" id="4288676">(</span><span class="op" id="4288677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288681">if</span>&nbsp;<span class="ident" id="4288684">err</span>&nbsp;<span class="op" id="4288688">!=</span>&nbsp;<span class="ident" id="4288691">nil</span>&nbsp;<span class="op" id="4288695">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288700">return</span>&nbsp;<span class="string" id="4288707">&#34;&#34;</span><span class="op" id="4288709">,</span>&nbsp;<span class="ident" id="4288711">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4288717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288721">if</span>&nbsp;<span class="ident" id="4288724">z</span><span class="op" id="4288725">.</span><span class="ident" id="4288726">buf</span><span class="op" id="4288729">[</span><span class="ident" id="4288730">i</span><span class="op" id="4288731">]</span>&nbsp;<span class="op" id="4288733">&gt;</span>&nbsp;<span class="num" id="4288735">0x7f</span>&nbsp;<span class="op" id="4288740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288745">needconv</span>&nbsp;<span class="op" id="4288754">=</span>&nbsp;<span class="ident" id="4288756">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4288763">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288767">if</span>&nbsp;<span class="ident" id="4288770">z</span><span class="op" id="4288771">.</span><span class="ident" id="4288772">buf</span><span class="op" id="4288775">[</span><span class="ident" id="4288776">i</span><span class="op" id="4288777">]</span>&nbsp;<span class="op" id="4288779">==</span>&nbsp;<span class="num" id="4288782">0</span>&nbsp;<span class="op" id="4288784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4288789">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;specifies&nbsp;that&nbsp;strings&nbsp;are&nbsp;NUL-terminated&nbsp;ISO&nbsp;8859-1&nbsp;(Latin-1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288875">if</span>&nbsp;<span class="ident" id="4288878">needconv</span>&nbsp;<span class="op" id="4288887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288893">s</span>&nbsp;<span class="op" id="4288895">:=</span>&nbsp;<span class="builtinfunc" id="4288898">make</span><span class="op" id="4288902">(</span><span class="op" id="4288903">[</span><span class="op" id="4288904">]</span><span class="builtintype" id="4288905">rune</span><span class="op" id="4288909">,</span>&nbsp;<span class="num" id="4288911">0</span><span class="op" id="4288912">,</span>&nbsp;<span class="ident" id="4288914">i</span><span class="op" id="4288915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288921">for</span>&nbsp;<span class="ident" id="4288925">_</span><span class="op" id="4288926">,</span>&nbsp;<span class="ident" id="4288928">v</span>&nbsp;<span class="op" id="4288930">:=</span>&nbsp;<span class="keyword" id="4288933">range</span>&nbsp;<span class="ident" id="4288939">z</span><span class="op" id="4288940">.</span><span class="ident" id="4288941">buf</span><span class="op" id="4288944">[</span><span class="num" id="4288945">0</span><span class="op" id="4288946">:</span><span class="ident" id="4288947">i</span><span class="op" id="4288948">]</span>&nbsp;<span class="op" id="4288950">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4288957">s</span>&nbsp;<span class="op" id="4288959">=</span>&nbsp;<span class="builtinfunc" id="4288961">append</span><span class="op" id="4288967">(</span><span class="ident" id="4288968">s</span><span class="op" id="4288969">,</span>&nbsp;<span class="builtintype" id="4288971">rune</span><span class="op" id="4288975">(</span><span class="ident" id="4288976">v</span><span class="op" id="4288977">)</span><span class="op" id="4288978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4288984">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4288990">return</span>&nbsp;<span class="builtintype" id="4288997">string</span><span class="op" id="4289003">(</span><span class="ident" id="4289004">s</span><span class="op" id="4289005">)</span><span class="op" id="4289006">,</span>&nbsp;<span class="ident" id="4289008">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4289015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289020">return</span>&nbsp;<span class="builtintype" id="4289027">string</span><span class="op" id="4289033">(</span><span class="ident" id="4289034">z</span><span class="op" id="4289035">.</span><span class="ident" id="4289036">buf</span><span class="op" id="4289039">[</span><span class="num" id="4289040">0</span><span class="op" id="4289041">:</span><span class="ident" id="4289042">i</span><span class="op" id="4289043">]</span><span class="op" id="4289044">)</span><span class="op" id="4289045">,</span>&nbsp;<span class="ident" id="4289047">nil</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4289053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4289056">}</span><br>
<span class="lineno"></span><span class="op" id="4289058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4289061">func</span>&nbsp;<span class="op" id="4289066">(</span><span class="ident" id="4289067">z</span>&nbsp;<span class="op" id="4289069">*</span><span class="ident" id="4289070">Reader</span><span class="op" id="4289076">)</span>&nbsp;<span class="ident" id="4289078">read2</span><span class="op" id="4289083">(</span><span class="op" id="4289084">)</span>&nbsp;<span class="op" id="4289086">(</span><span class="builtintype" id="4289087">uint32</span><span class="op" id="4289093">,</span>&nbsp;<span class="builtintype" id="4289095">error</span><span class="op" id="4289100">)</span>&nbsp;<span class="op" id="4289102">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289105">_</span><span class="op" id="4289106">,</span>&nbsp;<span class="ident" id="4289108">err</span>&nbsp;<span class="op" id="4289112">:=</span>&nbsp;<span class="ident" id="4289115">io</span><span class="op" id="4289117">.</span><span class="ident" id="4289118">ReadFull</span><span class="op" id="4289126">(</span><span class="ident" id="4289127">z</span><span class="op" id="4289128">.</span><span class="ident" id="4289129">r</span><span class="op" id="4289130">,</span>&nbsp;<span class="ident" id="4289132">z</span><span class="op" id="4289133">.</span><span class="ident" id="4289134">buf</span><span class="op" id="4289137">[</span><span class="num" id="4289138">0</span><span class="op" id="4289139">:</span><span class="num" id="4289140">2</span><span class="op" id="4289141">]</span><span class="op" id="4289142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289145">if</span>&nbsp;<span class="ident" id="4289148">err</span>&nbsp;<span class="op" id="4289152">!=</span>&nbsp;<span class="ident" id="4289155">nil</span>&nbsp;<span class="op" id="4289159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289163">return</span>&nbsp;<span class="num" id="4289170">0</span><span class="op" id="4289171">,</span>&nbsp;<span class="ident" id="4289173">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4289178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289181">return</span>&nbsp;<span class="builtintype" id="4289188">uint32</span><span class="op" id="4289194">(</span><span class="ident" id="4289195">z</span><span class="op" id="4289196">.</span><span class="ident" id="4289197">buf</span><span class="op" id="4289200">[</span><span class="num" id="4289201">0</span><span class="op" id="4289202">]</span><span class="op" id="4289203">)</span>&nbsp;<span class="op" id="4289205">|</span>&nbsp;<span class="builtintype" id="4289207">uint32</span><span class="op" id="4289213">(</span><span class="ident" id="4289214">z</span><span class="op" id="4289215">.</span><span class="ident" id="4289216">buf</span><span class="op" id="4289219">[</span><span class="num" id="4289220">1</span><span class="op" id="4289221">]</span><span class="op" id="4289222">)</span><span class="op" id="4289223">&lt;&lt;</span><span class="num" id="4289225">8</span><span class="op" id="4289226">,</span>&nbsp;<span class="ident" id="4289228">nil</span><br>
<span class="lineno">170</span><span class="op" id="4289232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4289235">func</span>&nbsp;<span class="op" id="4289240">(</span><span class="ident" id="4289241">z</span>&nbsp;<span class="op" id="4289243">*</span><span class="ident" id="4289244">Reader</span><span class="op" id="4289250">)</span>&nbsp;<span class="ident" id="4289252">readHeader</span><span class="op" id="4289262">(</span><span class="ident" id="4289263">save</span>&nbsp;<span class="builtintype" id="4289268">bool</span><span class="op" id="4289272">)</span>&nbsp;<span class="builtintype" id="4289274">error</span>&nbsp;<span class="op" id="4289280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289283">_</span><span class="op" id="4289284">,</span>&nbsp;<span class="ident" id="4289286">err</span>&nbsp;<span class="op" id="4289290">:=</span>&nbsp;<span class="ident" id="4289293">io</span><span class="op" id="4289295">.</span><span class="ident" id="4289296">ReadFull</span><span class="op" id="4289304">(</span><span class="ident" id="4289305">z</span><span class="op" id="4289306">.</span><span class="ident" id="4289307">r</span><span class="op" id="4289308">,</span>&nbsp;<span class="ident" id="4289310">z</span><span class="op" id="4289311">.</span><span class="ident" id="4289312">buf</span><span class="op" id="4289315">[</span><span class="num" id="4289316">0</span><span class="op" id="4289317">:</span><span class="num" id="4289318">10</span><span class="op" id="4289320">]</span><span class="op" id="4289321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289324">if</span>&nbsp;<span class="ident" id="4289327">err</span>&nbsp;<span class="op" id="4289331">!=</span>&nbsp;<span class="ident" id="4289334">nil</span>&nbsp;<span class="op" id="4289338">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289342">return</span>&nbsp;<span class="ident" id="4289349">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4289354">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289357">if</span>&nbsp;<span class="ident" id="4289360">z</span><span class="op" id="4289361">.</span><span class="ident" id="4289362">buf</span><span class="op" id="4289365">[</span><span class="num" id="4289366">0</span><span class="op" id="4289367">]</span>&nbsp;<span class="op" id="4289369">!=</span>&nbsp;<span class="ident" id="4289372">gzipID1</span>&nbsp;<span class="op" id="4289380">||</span>&nbsp;<span class="ident" id="4289383">z</span><span class="op" id="4289384">.</span><span class="ident" id="4289385">buf</span><span class="op" id="4289388">[</span><span class="num" id="4289389">1</span><span class="op" id="4289390">]</span>&nbsp;<span class="op" id="4289392">!=</span>&nbsp;<span class="ident" id="4289395">gzipID2</span>&nbsp;<span class="op" id="4289403">||</span>&nbsp;<span class="ident" id="4289406">z</span><span class="op" id="4289407">.</span><span class="ident" id="4289408">buf</span><span class="op" id="4289411">[</span><span class="num" id="4289412">2</span><span class="op" id="4289413">]</span>&nbsp;<span class="op" id="4289415">!=</span>&nbsp;<span class="ident" id="4289418">gzipDeflate</span>&nbsp;<span class="op" id="4289430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289434">return</span>&nbsp;<span class="ident" id="4289441">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4289452">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289455">z</span><span class="op" id="4289456">.</span><span class="ident" id="4289457">flg</span>&nbsp;<span class="op" id="4289461">=</span>&nbsp;<span class="ident" id="4289463">z</span><span class="op" id="4289464">.</span><span class="ident" id="4289465">buf</span><span class="op" id="4289468">[</span><span class="num" id="4289469">3</span><span class="op" id="4289470">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289473">if</span>&nbsp;<span class="ident" id="4289476">save</span>&nbsp;<span class="op" id="4289481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289485">z</span><span class="op" id="4289486">.</span><span class="ident" id="4289487">ModTime</span>&nbsp;<span class="op" id="4289495">=</span>&nbsp;<span class="ident" id="4289497">time</span><span class="op" id="4289501">.</span><span class="ident" id="4289502">Unix</span><span class="op" id="4289506">(</span><span class="ident" id="4289507">int64</span><span class="op" id="4289512">(</span><span class="ident" id="4289513">get4</span><span class="op" id="4289517">(</span><span class="ident" id="4289518">z</span><span class="op" id="4289519">.</span><span class="ident" id="4289520">buf</span><span class="op" id="4289523">[</span><span class="num" id="4289524">4</span><span class="op" id="4289525">:</span><span class="num" id="4289526">8</span><span class="op" id="4289527">]</span><span class="op" id="4289528">)</span><span class="op" id="4289529">)</span><span class="op" id="4289530">,</span>&nbsp;<span class="num" id="4289532">0</span><span class="op" id="4289533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4289537">//&nbsp;z.buf[8]&nbsp;is&nbsp;xfl,&nbsp;ignored</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289567">z</span><span class="op" id="4289568">.</span><span class="ident" id="4289569">OS</span>&nbsp;<span class="op" id="4289572">=</span>&nbsp;<span class="ident" id="4289574">z</span><span class="op" id="4289575">.</span><span class="ident" id="4289576">buf</span><span class="op" id="4289579">[</span><span class="num" id="4289580">9</span><span class="op" id="4289581">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4289584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289587">z</span><span class="op" id="4289588">.</span><span class="ident" id="4289589">digest</span><span class="op" id="4289595">.</span><span class="ident" id="4289596">Reset</span><span class="op" id="4289601">(</span><span class="op" id="4289602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289605">z</span><span class="op" id="4289606">.</span><span class="ident" id="4289607">digest</span><span class="op" id="4289613">.</span><span class="ident" id="4289614">Write</span><span class="op" id="4289619">(</span><span class="ident" id="4289620">z</span><span class="op" id="4289621">.</span><span class="ident" id="4289622">buf</span><span class="op" id="4289625">[</span><span class="num" id="4289626">0</span><span class="op" id="4289627">:</span><span class="num" id="4289628">10</span><span class="op" id="4289630">]</span><span class="op" id="4289631">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289635">if</span>&nbsp;<span class="ident" id="4289638">z</span><span class="op" id="4289639">.</span><span class="ident" id="4289640">flg</span><span class="op" id="4289643">&amp;</span><span class="ident" id="4289644">flagExtra</span>&nbsp;<span class="op" id="4289654">!=</span>&nbsp;<span class="num" id="4289657">0</span>&nbsp;<span class="op" id="4289659">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289663">n</span><span class="op" id="4289664">,</span>&nbsp;<span class="ident" id="4289666">err</span>&nbsp;<span class="op" id="4289670">:=</span>&nbsp;<span class="ident" id="4289673">z</span><span class="op" id="4289674">.</span><span class="ident" id="4289675">read2</span><span class="op" id="4289680">(</span><span class="op" id="4289681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289685">if</span>&nbsp;<span class="ident" id="4289688">err</span>&nbsp;<span class="op" id="4289692">!=</span>&nbsp;<span class="ident" id="4289695">nil</span>&nbsp;<span class="op" id="4289699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289704">return</span>&nbsp;<span class="ident" id="4289711">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4289717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289721">data</span>&nbsp;<span class="op" id="4289726">:=</span>&nbsp;<span class="builtinfunc" id="4289729">make</span><span class="op" id="4289733">(</span><span class="op" id="4289734">[</span><span class="op" id="4289735">]</span><span class="builtintype" id="4289736">byte</span><span class="op" id="4289740">,</span>&nbsp;<span class="ident" id="4289742">n</span><span class="op" id="4289743">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289747">if</span>&nbsp;<span class="ident" id="4289750">_</span><span class="op" id="4289751">,</span>&nbsp;<span class="ident" id="4289753">err</span>&nbsp;<span class="op" id="4289757">=</span>&nbsp;<span class="ident" id="4289759">io</span><span class="op" id="4289761">.</span><span class="ident" id="4289762">ReadFull</span><span class="op" id="4289770">(</span><span class="ident" id="4289771">z</span><span class="op" id="4289772">.</span><span class="ident" id="4289773">r</span><span class="op" id="4289774">,</span>&nbsp;<span class="ident" id="4289776">data</span><span class="op" id="4289780">)</span><span class="op" id="4289781">;</span>&nbsp;<span class="ident" id="4289783">err</span>&nbsp;<span class="op" id="4289787">!=</span>&nbsp;<span class="ident" id="4289790">nil</span>&nbsp;<span class="op" id="4289794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289799">return</span>&nbsp;<span class="ident" id="4289806">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4289812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289816">if</span>&nbsp;<span class="ident" id="4289819">save</span>&nbsp;<span class="op" id="4289824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289829">z</span><span class="op" id="4289830">.</span><span class="ident" id="4289831">Extra</span>&nbsp;<span class="op" id="4289837">=</span>&nbsp;<span class="ident" id="4289839">data</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4289846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4289849">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289853">var</span>&nbsp;<span class="ident" id="4289857">s</span>&nbsp;<span class="builtintype" id="4289859">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289867">if</span>&nbsp;<span class="ident" id="4289870">z</span><span class="op" id="4289871">.</span><span class="ident" id="4289872">flg</span><span class="op" id="4289875">&amp;</span><span class="ident" id="4289876">flagName</span>&nbsp;<span class="op" id="4289885">!=</span>&nbsp;<span class="num" id="4289888">0</span>&nbsp;<span class="op" id="4289890">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289894">if</span>&nbsp;<span class="ident" id="4289897">s</span><span class="op" id="4289898">,</span>&nbsp;<span class="ident" id="4289900">err</span>&nbsp;<span class="op" id="4289904">=</span>&nbsp;<span class="ident" id="4289906">z</span><span class="op" id="4289907">.</span><span class="ident" id="4289908">readString</span><span class="op" id="4289918">(</span><span class="op" id="4289919">)</span><span class="op" id="4289920">;</span>&nbsp;<span class="ident" id="4289922">err</span>&nbsp;<span class="op" id="4289926">!=</span>&nbsp;<span class="ident" id="4289929">nil</span>&nbsp;<span class="op" id="4289933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289938">return</span>&nbsp;<span class="ident" id="4289945">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4289951">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289955">if</span>&nbsp;<span class="ident" id="4289958">save</span>&nbsp;<span class="op" id="4289963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4289968">z</span><span class="op" id="4289969">.</span><span class="ident" id="4289970">Name</span>&nbsp;<span class="op" id="4289975">=</span>&nbsp;<span class="ident" id="4289977">s</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4289981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4289984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4289988">if</span>&nbsp;<span class="ident" id="4289991">z</span><span class="op" id="4289992">.</span><span class="ident" id="4289993">flg</span><span class="op" id="4289996">&amp;</span><span class="ident" id="4289997">flagComment</span>&nbsp;<span class="op" id="4290009">!=</span>&nbsp;<span class="num" id="4290012">0</span>&nbsp;<span class="op" id="4290014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290018">if</span>&nbsp;<span class="ident" id="4290021">s</span><span class="op" id="4290022">,</span>&nbsp;<span class="ident" id="4290024">err</span>&nbsp;<span class="op" id="4290028">=</span>&nbsp;<span class="ident" id="4290030">z</span><span class="op" id="4290031">.</span><span class="ident" id="4290032">readString</span><span class="op" id="4290042">(</span><span class="op" id="4290043">)</span><span class="op" id="4290044">;</span>&nbsp;<span class="ident" id="4290046">err</span>&nbsp;<span class="op" id="4290050">!=</span>&nbsp;<span class="ident" id="4290053">nil</span>&nbsp;<span class="op" id="4290057">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290062">return</span>&nbsp;<span class="ident" id="4290069">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4290075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290079">if</span>&nbsp;<span class="ident" id="4290082">save</span>&nbsp;<span class="op" id="4290087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4290092">z</span><span class="op" id="4290093">.</span><span class="ident" id="4290094">Comment</span>&nbsp;<span class="op" id="4290102">=</span>&nbsp;<span class="ident" id="4290104">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4290108">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4290111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290115">if</span>&nbsp;<span class="ident" id="4290118">z</span><span class="op" id="4290119">.</span><span class="ident" id="4290120">flg</span><span class="op" id="4290123">&amp;</span><span class="ident" id="4290124">flagHdrCrc</span>&nbsp;<span class="op" id="4290135">!=</span>&nbsp;<span class="num" id="4290138">0</span>&nbsp;<span class="op" id="4290140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4290144">n</span><span class="op" id="4290145">,</span>&nbsp;<span class="ident" id="4290147">err</span>&nbsp;<span class="op" id="4290151">:=</span>&nbsp;<span class="ident" id="4290154">z</span><span class="op" id="4290155">.</span><span class="ident" id="4290156">read2</span><span class="op" id="4290161">(</span><span class="op" id="4290162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290166">if</span>&nbsp;<span class="ident" id="4290169">err</span>&nbsp;<span class="op" id="4290173">!=</span>&nbsp;<span class="ident" id="4290176">nil</span>&nbsp;<span class="op" id="4290180">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290185">return</span>&nbsp;<span class="ident" id="4290192">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4290198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4290202">sum</span>&nbsp;<span class="op" id="4290206">:=</span>&nbsp;<span class="ident" id="4290209">z</span><span class="op" id="4290210">.</span><span class="ident" id="4290211">digest</span><span class="op" id="4290217">.</span><span class="ident" id="4290218">Sum32</span><span class="op" id="4290223">(</span><span class="op" id="4290224">)</span>&nbsp;<span class="op" id="4290226">&amp;</span>&nbsp;<span class="num" id="4290228">0xFFFF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290237">if</span>&nbsp;<span class="ident" id="4290240">n</span>&nbsp;<span class="op" id="4290242">!=</span>&nbsp;<span class="ident" id="4290245">sum</span>&nbsp;<span class="op" id="4290249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290254">return</span>&nbsp;<span class="ident" id="4290261">ErrHeader</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4290273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4290276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4290280">z</span><span class="op" id="4290281">.</span><span class="ident" id="4290282">digest</span><span class="op" id="4290288">.</span><span class="ident" id="4290289">Reset</span><span class="op" id="4290294">(</span><span class="op" id="4290295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290298">if</span>&nbsp;<span class="ident" id="4290301">z</span><span class="op" id="4290302">.</span><span class="ident" id="4290303">decompressor</span>&nbsp;<span class="op" id="4290316">==</span>&nbsp;<span class="ident" id="4290319">nil</span>&nbsp;<span class="op" id="4290323">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4290327">z</span><span class="op" id="4290328">.</span><span class="ident" id="4290329">decompressor</span>&nbsp;<span class="op" id="4290342">=</span>&nbsp;<span class="ident" id="4290344">flate</span><span class="op" id="4290349">.</span><span class="ident" id="4290350">NewReader</span><span class="op" id="4290359">(</span><span class="ident" id="4290360">z</span><span class="op" id="4290361">.</span><span class="ident" id="4290362">r</span><span class="op" id="4290363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4290366">}</span>&nbsp;<span class="keyword" id="4290368">else</span>&nbsp;<span class="op" id="4290373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4290377">z</span><span class="op" id="4290378">.</span><span class="ident" id="4290379">decompressor</span><span class="op" id="4290391">.</span><span class="op" id="4290392">(</span><span class="ident" id="4290393">flate</span><span class="op" id="4290398">.</span><span class="ident" id="4290399">Resetter</span><span class="op" id="4290407">)</span><span class="op" id="4290408">.</span><span class="ident" id="4290409">Reset</span><span class="op" id="4290414">(</span><span class="ident" id="4290415">z</span><span class="op" id="4290416">.</span><span class="ident" id="4290417">r</span><span class="op" id="4290418">,</span>&nbsp;<span class="ident" id="4290420">nil</span><span class="op" id="4290423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4290426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290429">return</span>&nbsp;<span class="ident" id="4290436">nil</span><br>
<span class="lineno">240</span><span class="op" id="4290440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4290443">func</span>&nbsp;<span class="op" id="4290448">(</span><span class="ident" id="4290449">z</span>&nbsp;<span class="op" id="4290451">*</span><span class="ident" id="4290452">Reader</span><span class="op" id="4290458">)</span>&nbsp;<span class="ident" id="4290460">Read</span><span class="op" id="4290464">(</span><span class="ident" id="4290465">p</span>&nbsp;<span class="op" id="4290467">[</span><span class="op" id="4290468">]</span><span class="builtintype" id="4290469">byte</span><span class="op" id="4290473">)</span>&nbsp;<span class="op" id="4290475">(</span><span class="ident" id="4290476">n</span>&nbsp;<span class="builtintype" id="4290478">int</span><span class="op" id="4290481">,</span>&nbsp;<span class="ident" id="4290483">err</span>&nbsp;<span class="builtintype" id="4290487">error</span><span class="op" id="4290492">)</span>&nbsp;<span class="op" id="4290494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290497">if</span>&nbsp;<span class="ident" id="4290500">z</span><span class="op" id="4290501">.</span><span class="ident" id="4290502">err</span>&nbsp;<span class="op" id="4290506">!=</span>&nbsp;<span class="ident" id="4290509">nil</span>&nbsp;<span class="op" id="4290513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290517">return</span>&nbsp;<span class="num" id="4290524">0</span><span class="op" id="4290525">,</span>&nbsp;<span class="ident" id="4290527">z</span><span class="op" id="4290528">.</span><span class="ident" id="4290529">err</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4290534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290537">if</span>&nbsp;<span class="builtinfunc" id="4290540">len</span><span class="op" id="4290543">(</span><span class="ident" id="4290544">p</span><span class="op" id="4290545">)</span>&nbsp;<span class="op" id="4290547">==</span>&nbsp;<span class="num" id="4290550">0</span>&nbsp;<span class="op" id="4290552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290556">return</span>&nbsp;<span class="num" id="4290563">0</span><span class="op" id="4290564">,</span>&nbsp;<span class="ident" id="4290566">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4290571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4290575">n</span><span class="op" id="4290576">,</span>&nbsp;<span class="ident" id="4290578">err</span>&nbsp;<span class="op" id="4290582">=</span>&nbsp;<span class="ident" id="4290584">z</span><span class="op" id="4290585">.</span><span class="ident" id="4290586">decompressor</span><span class="op" id="4290598">.</span><span class="ident" id="4290599">Read</span><span class="op" id="4290603">(</span><span class="ident" id="4290604">p</span><span class="op" id="4290605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4290608">z</span><span class="op" id="4290609">.</span><span class="ident" id="4290610">digest</span><span class="op" id="4290616">.</span><span class="ident" id="4290617">Write</span><span class="op" id="4290622">(</span><span class="ident" id="4290623">p</span><span class="op" id="4290624">[</span><span class="num" id="4290625">0</span><span class="op" id="4290626">:</span><span class="ident" id="4290627">n</span><span class="op" id="4290628">]</span><span class="op" id="4290629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4290632">z</span><span class="op" id="4290633">.</span><span class="ident" id="4290634">size</span>&nbsp;<span class="op" id="4290639">+=</span>&nbsp;<span class="builtintype" id="4290642">uint32</span><span class="op" id="4290648">(</span><span class="ident" id="4290649">n</span><span class="op" id="4290650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290653">if</span>&nbsp;<span class="ident" id="4290656">n</span>&nbsp;<span class="op" id="4290658">!=</span>&nbsp;<span class="num" id="4290661">0</span>&nbsp;<span class="op" id="4290663">||</span>&nbsp;<span class="ident" id="4290666">err</span>&nbsp;<span class="op" id="4290670">!=</span>&nbsp;<span class="ident" id="4290673">io</span><span class="op" id="4290675">.</span><span class="ident" id="4290676">EOF</span>&nbsp;<span class="op" id="4290680">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4290684">z</span><span class="op" id="4290685">.</span><span class="ident" id="4290686">err</span>&nbsp;<span class="op" id="4290690">=</span>&nbsp;<span class="ident" id="4290692">err</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290698">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4290706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4290710">//&nbsp;Finished&nbsp;file;&nbsp;check&nbsp;checksum&nbsp;+&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290752">if</span>&nbsp;<span class="ident" id="4290755">_</span><span class="op" id="4290756">,</span>&nbsp;<span class="ident" id="4290758">err</span>&nbsp;<span class="op" id="4290762">:=</span>&nbsp;<span class="ident" id="4290765">io</span><span class="op" id="4290767">.</span><span class="ident" id="4290768">ReadFull</span><span class="op" id="4290776">(</span><span class="ident" id="4290777">z</span><span class="op" id="4290778">.</span><span class="ident" id="4290779">r</span><span class="op" id="4290780">,</span>&nbsp;<span class="ident" id="4290782">z</span><span class="op" id="4290783">.</span><span class="ident" id="4290784">buf</span><span class="op" id="4290787">[</span><span class="num" id="4290788">0</span><span class="op" id="4290789">:</span><span class="num" id="4290790">8</span><span class="op" id="4290791">]</span><span class="op" id="4290792">)</span><span class="op" id="4290793">;</span>&nbsp;<span class="ident" id="4290795">err</span>&nbsp;<span class="op" id="4290799">!=</span>&nbsp;<span class="ident" id="4290802">nil</span>&nbsp;<span class="op" id="4290806">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4290810">z</span><span class="op" id="4290811">.</span><span class="ident" id="4290812">err</span>&nbsp;<span class="op" id="4290816">=</span>&nbsp;<span class="ident" id="4290818">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290824">return</span>&nbsp;<span class="num" id="4290831">0</span><span class="op" id="4290832">,</span>&nbsp;<span class="ident" id="4290834">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4290839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4290842">crc32</span><span class="op" id="4290847">,</span>&nbsp;<span class="ident" id="4290849">isize</span>&nbsp;<span class="op" id="4290855">:=</span>&nbsp;<span class="ident" id="4290858">get4</span><span class="op" id="4290862">(</span><span class="ident" id="4290863">z</span><span class="op" id="4290864">.</span><span class="ident" id="4290865">buf</span><span class="op" id="4290868">[</span><span class="num" id="4290869">0</span><span class="op" id="4290870">:</span><span class="num" id="4290871">4</span><span class="op" id="4290872">]</span><span class="op" id="4290873">)</span><span class="op" id="4290874">,</span>&nbsp;<span class="ident" id="4290876">get4</span><span class="op" id="4290880">(</span><span class="ident" id="4290881">z</span><span class="op" id="4290882">.</span><span class="ident" id="4290883">buf</span><span class="op" id="4290886">[</span><span class="num" id="4290887">4</span><span class="op" id="4290888">:</span><span class="num" id="4290889">8</span><span class="op" id="4290890">]</span><span class="op" id="4290891">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4290894">sum</span>&nbsp;<span class="op" id="4290898">:=</span>&nbsp;<span class="ident" id="4290901">z</span><span class="op" id="4290902">.</span><span class="ident" id="4290903">digest</span><span class="op" id="4290909">.</span><span class="ident" id="4290910">Sum32</span><span class="op" id="4290915">(</span><span class="op" id="4290916">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290919">if</span>&nbsp;<span class="ident" id="4290922">sum</span>&nbsp;<span class="op" id="4290926">!=</span>&nbsp;<span class="ident" id="4290929">crc32</span>&nbsp;<span class="op" id="4290935">||</span>&nbsp;<span class="ident" id="4290938">isize</span>&nbsp;<span class="op" id="4290944">!=</span>&nbsp;<span class="ident" id="4290947">z</span><span class="op" id="4290948">.</span><span class="ident" id="4290949">size</span>&nbsp;<span class="op" id="4290954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4290958">z</span><span class="op" id="4290959">.</span><span class="ident" id="4290960">err</span>&nbsp;<span class="op" id="4290964">=</span>&nbsp;<span class="ident" id="4290966">ErrChecksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4290980">return</span>&nbsp;<span class="num" id="4290987">0</span><span class="op" id="4290988">,</span>&nbsp;<span class="ident" id="4290990">z</span><span class="op" id="4290991">.</span><span class="ident" id="4290992">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4290997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4291001">//&nbsp;File&nbsp;is&nbsp;ok;&nbsp;is&nbsp;there&nbsp;another?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291035">if</span>&nbsp;<span class="op" id="4291038">!</span><span class="ident" id="4291039">z</span><span class="op" id="4291040">.</span><span class="ident" id="4291041">multistream</span>&nbsp;<span class="op" id="4291053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291057">return</span>&nbsp;<span class="num" id="4291064">0</span><span class="op" id="4291065">,</span>&nbsp;<span class="ident" id="4291067">io</span><span class="op" id="4291069">.</span><span class="ident" id="4291070">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4291075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291079">if</span>&nbsp;<span class="ident" id="4291082">err</span>&nbsp;<span class="op" id="4291086">=</span>&nbsp;<span class="ident" id="4291088">z</span><span class="op" id="4291089">.</span><span class="ident" id="4291090">readHeader</span><span class="op" id="4291100">(</span><span class="ident" id="4291101">false</span><span class="op" id="4291106">)</span><span class="op" id="4291107">;</span>&nbsp;<span class="ident" id="4291109">err</span>&nbsp;<span class="op" id="4291113">!=</span>&nbsp;<span class="ident" id="4291116">nil</span>&nbsp;<span class="op" id="4291120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291124">z</span><span class="op" id="4291125">.</span><span class="ident" id="4291126">err</span>&nbsp;<span class="op" id="4291130">=</span>&nbsp;<span class="ident" id="4291132">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291138">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4291146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4291150">//&nbsp;Yes.&nbsp;&nbsp;Reset&nbsp;and&nbsp;read&nbsp;from&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291184">z</span><span class="op" id="4291185">.</span><span class="ident" id="4291186">digest</span><span class="op" id="4291192">.</span><span class="ident" id="4291193">Reset</span><span class="op" id="4291198">(</span><span class="op" id="4291199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4291202">z</span><span class="op" id="4291203">.</span><span class="ident" id="4291204">size</span>&nbsp;<span class="op" id="4291209">=</span>&nbsp;<span class="num" id="4291211">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4291214">return</span>&nbsp;<span class="ident" id="4291221">z</span><span class="op" id="4291222">.</span><span class="ident" id="4291223">Read</span><span class="op" id="4291227">(</span><span class="ident" id="4291228">p</span><span class="op" id="4291229">)</span><br>
<span class="lineno"></span><span class="op" id="4291231">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="4291234">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Reader.&nbsp;It&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Reader.</span><br>
<span class="lineno"></span><span class="keyword" id="4291306">func</span>&nbsp;<span class="op" id="4291311">(</span><span class="ident" id="4291312">z</span>&nbsp;<span class="op" id="4291314">*</span><span class="ident" id="4291315">Reader</span><span class="op" id="4291321">)</span>&nbsp;<span class="ident" id="4291323">Close</span><span class="op" id="4291328">(</span><span class="op" id="4291329">)</span>&nbsp;<span class="builtintype" id="4291331">error</span>&nbsp;<span class="op" id="4291337">{</span>&nbsp;<span class="keyword" id="4291339">return</span>&nbsp;<span class="ident" id="4291346">z</span><span class="op" id="4291347">.</span><span class="ident" id="4291348">decompressor</span><span class="op" id="4291360">.</span><span class="ident" id="4291361">Close</span><span class="op" id="4291366">(</span><span class="op" id="4291367">)</span>&nbsp;<span class="op" id="4291369">}</span>
</div>
</body>
</html>
