<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime/debug</h2>
<ul>
<li><a href="/gostd/runtime/debug/garbage.go.html">garbage.go</a></li>
<li><a href="/gostd/runtime/debug/garbage_test.go.html">garbage_test.go</a></li>
<li><a href="/gostd/runtime/debug/heapdump_test.go.html">heapdump_test.go</a></li>
<li><a href="/gostd/runtime/debug/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/debug/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/debug/stubs.go.html">stubs.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6503266">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6503321">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6503375">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6503426">//&nbsp;Package&nbsp;debug&nbsp;contains&nbsp;facilities&nbsp;for&nbsp;programs&nbsp;to&nbsp;debug&nbsp;themselves&nbsp;while</span><br>
<span class="lineno"></span><span class="comment" id="6503502">//&nbsp;they&nbsp;are&nbsp;running.</span><br>
<span class="lineno"></span><span class="keyword" id="6503523">package</span>&nbsp;<span class="ident" id="6503531">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6503538">import</span>&nbsp;<span class="op" id="6503545">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6503548">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6503557">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6503564">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6503577">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6503583">&#34;runtime&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6503593">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6503596">var</span>&nbsp;<span class="op" id="6503600">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6503603">dunno</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6503613">=</span>&nbsp;<span class="op" id="6503615">[</span><span class="op" id="6503616">]</span><span class="builtintype" id="6503617">byte</span><span class="op" id="6503621">(</span><span class="string" id="6503622">&#34;???&#34;</span><span class="op" id="6503627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6503630">centerDot</span>&nbsp;<span class="op" id="6503640">=</span>&nbsp;<span class="op" id="6503642">[</span><span class="op" id="6503643">]</span><span class="builtintype" id="6503644">byte</span><span class="op" id="6503648">(</span><span class="string" id="6503649">&#34;Â·&#34;</span><span class="op" id="6503653">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6503656">dot</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6503666">=</span>&nbsp;<span class="op" id="6503668">[</span><span class="op" id="6503669">]</span><span class="builtintype" id="6503670">byte</span><span class="op" id="6503674">(</span><span class="string" id="6503675">&#34;.&#34;</span><span class="op" id="6503678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6503681">slash</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6503691">=</span>&nbsp;<span class="op" id="6503693">[</span><span class="op" id="6503694">]</span><span class="builtintype" id="6503695">byte</span><span class="op" id="6503699">(</span><span class="string" id="6503700">&#34;/&#34;</span><span class="op" id="6503703">)</span><br>
<span class="lineno"></span><span class="op" id="6503705">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6503708">//&nbsp;PrintStack&nbsp;prints&nbsp;to&nbsp;standard&nbsp;error&nbsp;the&nbsp;stack&nbsp;trace&nbsp;returned&nbsp;by&nbsp;Stack.</span><br>
<span class="lineno">25</span><span class="keyword" id="6503782">func</span>&nbsp;<span class="ident" id="6503787">PrintStack</span><span class="op" id="6503797">(</span><span class="op" id="6503798">)</span>&nbsp;<span class="op" id="6503800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6503803">os</span><span class="op" id="6503805">.</span><span class="ident" id="6503806">Stderr</span><span class="op" id="6503812">.</span><span class="ident" id="6503813">Write</span><span class="op" id="6503818">(</span><span class="ident" id="6503819">stack</span><span class="op" id="6503824">(</span><span class="op" id="6503825">)</span><span class="op" id="6503826">)</span><br>
<span class="lineno"></span><span class="op" id="6503828">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6503831">//&nbsp;Stack&nbsp;returns&nbsp;a&nbsp;formatted&nbsp;stack&nbsp;trace&nbsp;of&nbsp;the&nbsp;goroutine&nbsp;that&nbsp;calls&nbsp;it.</span><br>
<span class="lineno">30</span><span class="comment" id="6503904">//&nbsp;For&nbsp;each&nbsp;routine,&nbsp;it&nbsp;includes&nbsp;the&nbsp;source&nbsp;line&nbsp;information&nbsp;and&nbsp;PC&nbsp;value,</span><br>
<span class="lineno"></span><span class="comment" id="6503979">//&nbsp;then&nbsp;attempts&nbsp;to&nbsp;discover,&nbsp;for&nbsp;Go&nbsp;functions,&nbsp;the&nbsp;calling&nbsp;function&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="6504051">//&nbsp;method&nbsp;and&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;line&nbsp;containing&nbsp;the&nbsp;invocation.</span><br>
<span class="lineno"></span><span class="comment" id="6504113">//</span><br>
<span class="lineno"></span><span class="comment" id="6504116">//&nbsp;This&nbsp;function&nbsp;is&nbsp;deprecated.&nbsp;Use&nbsp;package&nbsp;runtime&#39;s&nbsp;Stack&nbsp;instead.</span><br>
<span class="lineno">35</span><span class="keyword" id="6504185">func</span>&nbsp;<span class="ident" id="6504190">Stack</span><span class="op" id="6504195">(</span><span class="op" id="6504196">)</span>&nbsp;<span class="op" id="6504198">[</span><span class="op" id="6504199">]</span><span class="builtintype" id="6504200">byte</span>&nbsp;<span class="op" id="6504205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6504208">return</span>&nbsp;<span class="ident" id="6504215">stack</span><span class="op" id="6504220">(</span><span class="op" id="6504221">)</span><br>
<span class="lineno"></span><span class="op" id="6504223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6504226">//&nbsp;stack&nbsp;implements&nbsp;Stack,&nbsp;skipping&nbsp;2&nbsp;frames</span><br>
<span class="lineno">40</span><span class="keyword" id="6504271">func</span>&nbsp;<span class="ident" id="6504276">stack</span><span class="op" id="6504281">(</span><span class="op" id="6504282">)</span>&nbsp;<span class="op" id="6504284">[</span><span class="op" id="6504285">]</span><span class="builtintype" id="6504286">byte</span>&nbsp;<span class="op" id="6504291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6504294">buf</span>&nbsp;<span class="op" id="6504298">:=</span>&nbsp;<span class="builtinfunc" id="6504301">new</span><span class="op" id="6504304">(</span><span class="ident" id="6504305">bytes</span><span class="op" id="6504310">.</span><span class="ident" id="6504311">Buffer</span><span class="op" id="6504317">)</span>&nbsp;<span class="comment" id="6504319">//&nbsp;the&nbsp;returned&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6504341">//&nbsp;As&nbsp;we&nbsp;loop,&nbsp;we&nbsp;open&nbsp;files&nbsp;and&nbsp;read&nbsp;them.&nbsp;These&nbsp;variables&nbsp;record&nbsp;the&nbsp;currently</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6504423">//&nbsp;loaded&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6504440">var</span>&nbsp;<span class="ident" id="6504444">lines</span>&nbsp;<span class="op" id="6504450">[</span><span class="op" id="6504451">]</span><span class="op" id="6504452">[</span><span class="op" id="6504453">]</span><span class="builtintype" id="6504454">byte</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6504460">var</span>&nbsp;<span class="ident" id="6504464">lastFile</span>&nbsp;<span class="builtintype" id="6504473">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6504481">for</span>&nbsp;<span class="ident" id="6504485">i</span>&nbsp;<span class="op" id="6504487">:=</span>&nbsp;<span class="num" id="6504490">2</span><span class="op" id="6504491">;</span>&nbsp;<span class="op" id="6504493">;</span>&nbsp;<span class="ident" id="6504495">i</span><span class="op" id="6504496">++</span>&nbsp;<span class="op" id="6504499">{</span>&nbsp;<span class="comment" id="6504501">//&nbsp;Caller&nbsp;we&nbsp;care&nbsp;about&nbsp;is&nbsp;the&nbsp;user,&nbsp;2&nbsp;frames&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6504552">pc</span><span class="op" id="6504554">,</span>&nbsp;<span class="ident" id="6504556">file</span><span class="op" id="6504560">,</span>&nbsp;<span class="ident" id="6504562">line</span><span class="op" id="6504566">,</span>&nbsp;<span class="ident" id="6504568">ok</span>&nbsp;<span class="op" id="6504571">:=</span>&nbsp;<span class="ident" id="6504574">runtime</span><span class="op" id="6504581">.</span><span class="ident" id="6504582">Caller</span><span class="op" id="6504588">(</span><span class="ident" id="6504589">i</span><span class="op" id="6504590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6504594">if</span>&nbsp;<span class="op" id="6504597">!</span><span class="ident" id="6504598">ok</span>&nbsp;<span class="op" id="6504601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6504606">break</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6504614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6504618">//&nbsp;Print&nbsp;this&nbsp;much&nbsp;at&nbsp;least.&nbsp;&nbsp;If&nbsp;we&nbsp;can&#39;t&nbsp;find&nbsp;the&nbsp;source,&nbsp;it&nbsp;won&#39;t&nbsp;show.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6504694">fmt</span><span class="op" id="6504697">.</span><span class="ident" id="6504698">Fprintf</span><span class="op" id="6504705">(</span><span class="ident" id="6504706">buf</span><span class="op" id="6504709">,</span>&nbsp;<span class="string" id="6504711">&#34;%s:%d&nbsp;(0x%x)\n&#34;</span><span class="op" id="6504727">,</span>&nbsp;<span class="ident" id="6504729">file</span><span class="op" id="6504733">,</span>&nbsp;<span class="ident" id="6504735">line</span><span class="op" id="6504739">,</span>&nbsp;<span class="ident" id="6504741">pc</span><span class="op" id="6504743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6504747">if</span>&nbsp;<span class="ident" id="6504750">file</span>&nbsp;<span class="op" id="6504755">!=</span>&nbsp;<span class="ident" id="6504758">lastFile</span>&nbsp;<span class="op" id="6504767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6504772">data</span><span class="op" id="6504776">,</span>&nbsp;<span class="ident" id="6504778">err</span>&nbsp;<span class="op" id="6504782">:=</span>&nbsp;<span class="ident" id="6504785">ioutil</span><span class="op" id="6504791">.</span><span class="ident" id="6504792">ReadFile</span><span class="op" id="6504800">(</span><span class="ident" id="6504801">file</span><span class="op" id="6504805">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6504810">if</span>&nbsp;<span class="ident" id="6504813">err</span>&nbsp;<span class="op" id="6504817">!=</span>&nbsp;<span class="ident" id="6504820">nil</span>&nbsp;<span class="op" id="6504824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6504830">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6504842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6504847">lines</span>&nbsp;<span class="op" id="6504853">=</span>&nbsp;<span class="ident" id="6504855">bytes</span><span class="op" id="6504860">.</span><span class="ident" id="6504861">Split</span><span class="op" id="6504866">(</span><span class="ident" id="6504867">data</span><span class="op" id="6504871">,</span>&nbsp;<span class="op" id="6504873">[</span><span class="op" id="6504874">]</span><span class="builtintype" id="6504875">byte</span><span class="op" id="6504879">{</span><span class="string" id="6504880">&#39;\n&#39;</span><span class="op" id="6504884">}</span><span class="op" id="6504885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6504890">lastFile</span>&nbsp;<span class="op" id="6504899">=</span>&nbsp;<span class="ident" id="6504901">file</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6504908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6504912">line</span><span class="op" id="6504916">--</span>&nbsp;<span class="comment" id="6504919">//&nbsp;in&nbsp;stack&nbsp;trace,&nbsp;lines&nbsp;are&nbsp;1-indexed&nbsp;but&nbsp;our&nbsp;array&nbsp;is&nbsp;0-indexed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6504987">fmt</span><span class="op" id="6504990">.</span><span class="ident" id="6504991">Fprintf</span><span class="op" id="6504998">(</span><span class="ident" id="6504999">buf</span><span class="op" id="6505002">,</span>&nbsp;<span class="string" id="6505004">&#34;\t%s:&nbsp;%s\n&#34;</span><span class="op" id="6505016">,</span>&nbsp;<span class="ident" id="6505018">function</span><span class="op" id="6505026">(</span><span class="ident" id="6505027">pc</span><span class="op" id="6505029">)</span><span class="op" id="6505030">,</span>&nbsp;<span class="ident" id="6505032">source</span><span class="op" id="6505038">(</span><span class="ident" id="6505039">lines</span><span class="op" id="6505044">,</span>&nbsp;<span class="ident" id="6505046">line</span><span class="op" id="6505050">)</span><span class="op" id="6505051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6505054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6505057">return</span>&nbsp;<span class="ident" id="6505064">buf</span><span class="op" id="6505067">.</span><span class="ident" id="6505068">Bytes</span><span class="op" id="6505073">(</span><span class="op" id="6505074">)</span><br>
<span class="lineno">65</span><span class="op" id="6505076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6505079">//&nbsp;source&nbsp;returns&nbsp;a&nbsp;space-trimmed&nbsp;slice&nbsp;of&nbsp;the&nbsp;n&#39;th&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="6505137">func</span>&nbsp;<span class="ident" id="6505142">source</span><span class="op" id="6505148">(</span><span class="ident" id="6505149">lines</span>&nbsp;<span class="op" id="6505155">[</span><span class="op" id="6505156">]</span><span class="op" id="6505157">[</span><span class="op" id="6505158">]</span><span class="builtintype" id="6505159">byte</span><span class="op" id="6505163">,</span>&nbsp;<span class="ident" id="6505165">n</span>&nbsp;<span class="builtintype" id="6505167">int</span><span class="op" id="6505170">)</span>&nbsp;<span class="op" id="6505172">[</span><span class="op" id="6505173">]</span><span class="builtintype" id="6505174">byte</span>&nbsp;<span class="op" id="6505179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6505182">if</span>&nbsp;<span class="ident" id="6505185">n</span>&nbsp;<span class="op" id="6505187">&lt;</span>&nbsp;<span class="num" id="6505189">0</span>&nbsp;<span class="op" id="6505191">||</span>&nbsp;<span class="ident" id="6505194">n</span>&nbsp;<span class="op" id="6505196">&gt;=</span>&nbsp;<span class="builtinfunc" id="6505199">len</span><span class="op" id="6505202">(</span><span class="ident" id="6505203">lines</span><span class="op" id="6505208">)</span>&nbsp;<span class="op" id="6505210">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6505214">return</span>&nbsp;<span class="ident" id="6505221">dunno</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6505228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6505231">return</span>&nbsp;<span class="ident" id="6505238">bytes</span><span class="op" id="6505243">.</span><span class="ident" id="6505244">Trim</span><span class="op" id="6505248">(</span><span class="ident" id="6505249">lines</span><span class="op" id="6505254">[</span><span class="ident" id="6505255">n</span><span class="op" id="6505256">]</span><span class="op" id="6505257">,</span>&nbsp;<span class="string" id="6505259">&#34;&nbsp;\t&#34;</span><span class="op" id="6505264">)</span><br>
<span class="lineno"></span><span class="op" id="6505266">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="6505269">//&nbsp;function&nbsp;returns,&nbsp;if&nbsp;possible,&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;function&nbsp;containing&nbsp;the&nbsp;PC.</span><br>
<span class="lineno"></span><span class="keyword" id="6505347">func</span>&nbsp;<span class="ident" id="6505352">function</span><span class="op" id="6505360">(</span><span class="ident" id="6505361">pc</span>&nbsp;<span class="builtintype" id="6505364">uintptr</span><span class="op" id="6505371">)</span>&nbsp;<span class="op" id="6505373">[</span><span class="op" id="6505374">]</span><span class="builtintype" id="6505375">byte</span>&nbsp;<span class="op" id="6505380">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6505383">fn</span>&nbsp;<span class="op" id="6505386">:=</span>&nbsp;<span class="ident" id="6505389">runtime</span><span class="op" id="6505396">.</span><span class="ident" id="6505397">FuncForPC</span><span class="op" id="6505406">(</span><span class="ident" id="6505407">pc</span><span class="op" id="6505409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6505412">if</span>&nbsp;<span class="ident" id="6505415">fn</span>&nbsp;<span class="op" id="6505418">==</span>&nbsp;<span class="ident" id="6505421">nil</span>&nbsp;<span class="op" id="6505425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6505429">return</span>&nbsp;<span class="ident" id="6505436">dunno</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6505443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6505446">name</span>&nbsp;<span class="op" id="6505451">:=</span>&nbsp;<span class="op" id="6505454">[</span><span class="op" id="6505455">]</span><span class="builtintype" id="6505456">byte</span><span class="op" id="6505460">(</span><span class="ident" id="6505461">fn</span><span class="op" id="6505463">.</span><span class="ident" id="6505464">Name</span><span class="op" id="6505468">(</span><span class="op" id="6505469">)</span><span class="op" id="6505470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6505473">//&nbsp;The&nbsp;name&nbsp;includes&nbsp;the&nbsp;path&nbsp;name&nbsp;to&nbsp;the&nbsp;package,&nbsp;which&nbsp;is&nbsp;unnecessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6505546">//&nbsp;since&nbsp;the&nbsp;file&nbsp;name&nbsp;is&nbsp;already&nbsp;included.&nbsp;&nbsp;Plus,&nbsp;it&nbsp;has&nbsp;center&nbsp;dots.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6505618">//&nbsp;That&nbsp;is,&nbsp;we&nbsp;see</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6505638">//&nbsp;&nbsp;&nbsp;&nbspruntime/debug.*TÂ·ptrmethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6505670">//&nbsp;and&nbsp;want</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6505683">//&nbsp;&nbsp;&nbsp;&nbsp*T.ptrmethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6505700">//&nbsp;Since&nbsp;the&nbsp;package&nbsp;path&nbsp;might&nbsp;contains&nbsp;dots&nbsp;(e.g.&nbsp;code.google.com/...),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6505775">//&nbsp;we&nbsp;first&nbsp;remove&nbsp;the&nbsp;path&nbsp;prefix&nbsp;if&nbsp;there&nbsp;is&nbsp;one.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6505828">if</span>&nbsp;<span class="ident" id="6505831">lastslash</span>&nbsp;<span class="op" id="6505841">:=</span>&nbsp;<span class="ident" id="6505844">bytes</span><span class="op" id="6505849">.</span><span class="ident" id="6505850">LastIndex</span><span class="op" id="6505859">(</span><span class="ident" id="6505860">name</span><span class="op" id="6505864">,</span>&nbsp;<span class="ident" id="6505866">slash</span><span class="op" id="6505871">)</span><span class="op" id="6505872">;</span>&nbsp;<span class="ident" id="6505874">lastslash</span>&nbsp;<span class="op" id="6505884">&gt;=</span>&nbsp;<span class="num" id="6505887">0</span>&nbsp;<span class="op" id="6505889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6505893">name</span>&nbsp;<span class="op" id="6505898">=</span>&nbsp;<span class="ident" id="6505900">name</span><span class="op" id="6505904">[</span><span class="ident" id="6505905">lastslash</span><span class="op" id="6505914">+</span><span class="num" id="6505915">1</span><span class="op" id="6505916">:</span><span class="op" id="6505917">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6505920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6505923">if</span>&nbsp;<span class="ident" id="6505926">period</span>&nbsp;<span class="op" id="6505933">:=</span>&nbsp;<span class="ident" id="6505936">bytes</span><span class="op" id="6505941">.</span><span class="ident" id="6505942">Index</span><span class="op" id="6505947">(</span><span class="ident" id="6505948">name</span><span class="op" id="6505952">,</span>&nbsp;<span class="ident" id="6505954">dot</span><span class="op" id="6505957">)</span><span class="op" id="6505958">;</span>&nbsp;<span class="ident" id="6505960">period</span>&nbsp;<span class="op" id="6505967">&gt;=</span>&nbsp;<span class="num" id="6505970">0</span>&nbsp;<span class="op" id="6505972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6505976">name</span>&nbsp;<span class="op" id="6505981">=</span>&nbsp;<span class="ident" id="6505983">name</span><span class="op" id="6505987">[</span><span class="ident" id="6505988">period</span><span class="op" id="6505994">+</span><span class="num" id="6505995">1</span><span class="op" id="6505996">:</span><span class="op" id="6505997">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6506000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6506003">name</span>&nbsp;<span class="op" id="6506008">=</span>&nbsp;<span class="ident" id="6506010">bytes</span><span class="op" id="6506015">.</span><span class="ident" id="6506016">Replace</span><span class="op" id="6506023">(</span><span class="ident" id="6506024">name</span><span class="op" id="6506028">,</span>&nbsp;<span class="ident" id="6506030">centerDot</span><span class="op" id="6506039">,</span>&nbsp;<span class="ident" id="6506041">dot</span><span class="op" id="6506044">,</span>&nbsp;<span class="op" id="6506046">-</span><span class="num" id="6506047">1</span><span class="op" id="6506048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6506051">return</span>&nbsp;<span class="ident" id="6506058">name</span><br>
<span class="lineno"></span><span class="op" id="6506063">}</span>
</div>
</body>
</html>
