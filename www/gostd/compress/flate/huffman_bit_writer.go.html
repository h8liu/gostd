<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4617791">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4617846">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4617900">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4617951">package</span>&nbsp;<span class="ident" id="4617959">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4617966">import</span>&nbsp;<span class="op" id="4617973">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4617976">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4617982">&#34;math&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4617989">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4617992">const</span>&nbsp;<span class="op" id="4617998">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4618001">//&nbsp;The&nbsp;largest&nbsp;offset&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4618030">offsetCodeCount</span>&nbsp;<span class="op" id="4618046">=</span>&nbsp;<span class="num" id="4618048">30</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4618053">//&nbsp;The&nbsp;special&nbsp;code&nbsp;used&nbsp;to&nbsp;mark&nbsp;the&nbsp;end&nbsp;of&nbsp;a&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4618107">endBlockMarker</span>&nbsp;<span class="op" id="4618122">=</span>&nbsp;<span class="num" id="4618124">256</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4618130">//&nbsp;The&nbsp;first&nbsp;length&nbsp;code.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4618157">lengthCodesStart</span>&nbsp;<span class="op" id="4618174">=</span>&nbsp;<span class="num" id="4618176">257</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4618182">//&nbsp;The&nbsp;number&nbsp;of&nbsp;codegen&nbsp;codes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4618215">codegenCodeCount</span>&nbsp;<span class="op" id="4618232">=</span>&nbsp;<span class="num" id="4618234">19</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4618238">badCode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4618255">=</span>&nbsp;<span class="num" id="4618257">255</span><br>
<span class="lineno">25</span><span class="op" id="4618261">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4618264">//&nbsp;The&nbsp;number&nbsp;of&nbsp;extra&nbsp;bits&nbsp;needed&nbsp;by&nbsp;length&nbsp;code&nbsp;X&nbsp;-&nbsp;LENGTH_CODES_START.</span><br>
<span class="lineno"></span><span class="keyword" id="4618338">var</span>&nbsp;<span class="ident" id="4618342">lengthExtraBits</span>&nbsp;<span class="op" id="4618358">=</span>&nbsp;<span class="op" id="4618360">[</span><span class="op" id="4618361">]</span><span class="builtintype" id="4618362">int8</span><span class="op" id="4618366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4618369">/*&nbsp;257&nbsp;*/</span>&nbsp;<span class="num" id="4618379">0</span><span class="op" id="4618380">,</span>&nbsp;<span class="num" id="4618382">0</span><span class="op" id="4618383">,</span>&nbsp;<span class="num" id="4618385">0</span><span class="op" id="4618386">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4618389">/*&nbsp;260&nbsp;*/</span>&nbsp;<span class="num" id="4618399">0</span><span class="op" id="4618400">,</span>&nbsp;<span class="num" id="4618402">0</span><span class="op" id="4618403">,</span>&nbsp;<span class="num" id="4618405">0</span><span class="op" id="4618406">,</span>&nbsp;<span class="num" id="4618408">0</span><span class="op" id="4618409">,</span>&nbsp;<span class="num" id="4618411">0</span><span class="op" id="4618412">,</span>&nbsp;<span class="num" id="4618414">1</span><span class="op" id="4618415">,</span>&nbsp;<span class="num" id="4618417">1</span><span class="op" id="4618418">,</span>&nbsp;<span class="num" id="4618420">1</span><span class="op" id="4618421">,</span>&nbsp;<span class="num" id="4618423">1</span><span class="op" id="4618424">,</span>&nbsp;<span class="num" id="4618426">2</span><span class="op" id="4618427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4618430">/*&nbsp;270&nbsp;*/</span>&nbsp;<span class="num" id="4618440">2</span><span class="op" id="4618441">,</span>&nbsp;<span class="num" id="4618443">2</span><span class="op" id="4618444">,</span>&nbsp;<span class="num" id="4618446">2</span><span class="op" id="4618447">,</span>&nbsp;<span class="num" id="4618449">3</span><span class="op" id="4618450">,</span>&nbsp;<span class="num" id="4618452">3</span><span class="op" id="4618453">,</span>&nbsp;<span class="num" id="4618455">3</span><span class="op" id="4618456">,</span>&nbsp;<span class="num" id="4618458">3</span><span class="op" id="4618459">,</span>&nbsp;<span class="num" id="4618461">4</span><span class="op" id="4618462">,</span>&nbsp;<span class="num" id="4618464">4</span><span class="op" id="4618465">,</span>&nbsp;<span class="num" id="4618467">4</span><span class="op" id="4618468">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4618471">/*&nbsp;280&nbsp;*/</span>&nbsp;<span class="num" id="4618481">4</span><span class="op" id="4618482">,</span>&nbsp;<span class="num" id="4618484">5</span><span class="op" id="4618485">,</span>&nbsp;<span class="num" id="4618487">5</span><span class="op" id="4618488">,</span>&nbsp;<span class="num" id="4618490">5</span><span class="op" id="4618491">,</span>&nbsp;<span class="num" id="4618493">5</span><span class="op" id="4618494">,</span>&nbsp;<span class="num" id="4618496">0</span><span class="op" id="4618497">,</span><br>
<span class="lineno"></span><span class="op" id="4618499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="4618502">//&nbsp;The&nbsp;length&nbsp;indicated&nbsp;by&nbsp;length&nbsp;code&nbsp;X&nbsp;-&nbsp;LENGTH_CODES_START.</span><br>
<span class="lineno"></span><span class="keyword" id="4618565">var</span>&nbsp;<span class="ident" id="4618569">lengthBase</span>&nbsp;<span class="op" id="4618580">=</span>&nbsp;<span class="op" id="4618582">[</span><span class="op" id="4618583">]</span><span class="builtintype" id="4618584">uint32</span><span class="op" id="4618590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4618593">0</span><span class="op" id="4618594">,</span>&nbsp;<span class="num" id="4618596">1</span><span class="op" id="4618597">,</span>&nbsp;<span class="num" id="4618599">2</span><span class="op" id="4618600">,</span>&nbsp;<span class="num" id="4618602">3</span><span class="op" id="4618603">,</span>&nbsp;<span class="num" id="4618605">4</span><span class="op" id="4618606">,</span>&nbsp;<span class="num" id="4618608">5</span><span class="op" id="4618609">,</span>&nbsp;<span class="num" id="4618611">6</span><span class="op" id="4618612">,</span>&nbsp;<span class="num" id="4618614">7</span><span class="op" id="4618615">,</span>&nbsp;<span class="num" id="4618617">8</span><span class="op" id="4618618">,</span>&nbsp;<span class="num" id="4618620">10</span><span class="op" id="4618622">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4618625">12</span><span class="op" id="4618627">,</span>&nbsp;<span class="num" id="4618629">14</span><span class="op" id="4618631">,</span>&nbsp;<span class="num" id="4618633">16</span><span class="op" id="4618635">,</span>&nbsp;<span class="num" id="4618637">20</span><span class="op" id="4618639">,</span>&nbsp;<span class="num" id="4618641">24</span><span class="op" id="4618643">,</span>&nbsp;<span class="num" id="4618645">28</span><span class="op" id="4618647">,</span>&nbsp;<span class="num" id="4618649">32</span><span class="op" id="4618651">,</span>&nbsp;<span class="num" id="4618653">40</span><span class="op" id="4618655">,</span>&nbsp;<span class="num" id="4618657">48</span><span class="op" id="4618659">,</span>&nbsp;<span class="num" id="4618661">56</span><span class="op" id="4618663">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4618666">64</span><span class="op" id="4618668">,</span>&nbsp;<span class="num" id="4618670">80</span><span class="op" id="4618672">,</span>&nbsp;<span class="num" id="4618674">96</span><span class="op" id="4618676">,</span>&nbsp;<span class="num" id="4618678">112</span><span class="op" id="4618681">,</span>&nbsp;<span class="num" id="4618683">128</span><span class="op" id="4618686">,</span>&nbsp;<span class="num" id="4618688">160</span><span class="op" id="4618691">,</span>&nbsp;<span class="num" id="4618693">192</span><span class="op" id="4618696">,</span>&nbsp;<span class="num" id="4618698">224</span><span class="op" id="4618701">,</span>&nbsp;<span class="num" id="4618703">255</span><span class="op" id="4618706">,</span><br>
<span class="lineno">40</span><span class="op" id="4618708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4618711">//&nbsp;offset&nbsp;code&nbsp;word&nbsp;extra&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="4618743">var</span>&nbsp;<span class="ident" id="4618747">offsetExtraBits</span>&nbsp;<span class="op" id="4618763">=</span>&nbsp;<span class="op" id="4618765">[</span><span class="op" id="4618766">]</span><span class="builtintype" id="4618767">int8</span><span class="op" id="4618771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4618774">0</span><span class="op" id="4618775">,</span>&nbsp;<span class="num" id="4618777">0</span><span class="op" id="4618778">,</span>&nbsp;<span class="num" id="4618780">0</span><span class="op" id="4618781">,</span>&nbsp;<span class="num" id="4618783">0</span><span class="op" id="4618784">,</span>&nbsp;<span class="num" id="4618786">1</span><span class="op" id="4618787">,</span>&nbsp;<span class="num" id="4618789">1</span><span class="op" id="4618790">,</span>&nbsp;<span class="num" id="4618792">2</span><span class="op" id="4618793">,</span>&nbsp;<span class="num" id="4618795">2</span><span class="op" id="4618796">,</span>&nbsp;<span class="num" id="4618798">3</span><span class="op" id="4618799">,</span>&nbsp;<span class="num" id="4618801">3</span><span class="op" id="4618802">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4618805">4</span><span class="op" id="4618806">,</span>&nbsp;<span class="num" id="4618808">4</span><span class="op" id="4618809">,</span>&nbsp;<span class="num" id="4618811">5</span><span class="op" id="4618812">,</span>&nbsp;<span class="num" id="4618814">5</span><span class="op" id="4618815">,</span>&nbsp;<span class="num" id="4618817">6</span><span class="op" id="4618818">,</span>&nbsp;<span class="num" id="4618820">6</span><span class="op" id="4618821">,</span>&nbsp;<span class="num" id="4618823">7</span><span class="op" id="4618824">,</span>&nbsp;<span class="num" id="4618826">7</span><span class="op" id="4618827">,</span>&nbsp;<span class="num" id="4618829">8</span><span class="op" id="4618830">,</span>&nbsp;<span class="num" id="4618832">8</span><span class="op" id="4618833">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4618836">9</span><span class="op" id="4618837">,</span>&nbsp;<span class="num" id="4618839">9</span><span class="op" id="4618840">,</span>&nbsp;<span class="num" id="4618842">10</span><span class="op" id="4618844">,</span>&nbsp;<span class="num" id="4618846">10</span><span class="op" id="4618848">,</span>&nbsp;<span class="num" id="4618850">11</span><span class="op" id="4618852">,</span>&nbsp;<span class="num" id="4618854">11</span><span class="op" id="4618856">,</span>&nbsp;<span class="num" id="4618858">12</span><span class="op" id="4618860">,</span>&nbsp;<span class="num" id="4618862">12</span><span class="op" id="4618864">,</span>&nbsp;<span class="num" id="4618866">13</span><span class="op" id="4618868">,</span>&nbsp;<span class="num" id="4618870">13</span><span class="op" id="4618872">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4618875">/*&nbsp;extended&nbsp;window&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4618898">14</span><span class="op" id="4618900">,</span>&nbsp;<span class="num" id="4618902">14</span><span class="op" id="4618904">,</span>&nbsp;<span class="num" id="4618906">15</span><span class="op" id="4618908">,</span>&nbsp;<span class="num" id="4618910">15</span><span class="op" id="4618912">,</span>&nbsp;<span class="num" id="4618914">16</span><span class="op" id="4618916">,</span>&nbsp;<span class="num" id="4618918">16</span><span class="op" id="4618920">,</span>&nbsp;<span class="num" id="4618922">17</span><span class="op" id="4618924">,</span>&nbsp;<span class="num" id="4618926">17</span><span class="op" id="4618928">,</span>&nbsp;<span class="num" id="4618930">18</span><span class="op" id="4618932">,</span>&nbsp;<span class="num" id="4618934">18</span><span class="op" id="4618936">,</span>&nbsp;<span class="num" id="4618938">19</span><span class="op" id="4618940">,</span>&nbsp;<span class="num" id="4618942">19</span><span class="op" id="4618944">,</span>&nbsp;<span class="num" id="4618946">20</span><span class="op" id="4618948">,</span>&nbsp;<span class="num" id="4618950">20</span><span class="op" id="4618952">,</span><br>
<span class="lineno"></span><span class="op" id="4618954">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="4618957">var</span>&nbsp;<span class="ident" id="4618961">offsetBase</span>&nbsp;<span class="op" id="4618972">=</span>&nbsp;<span class="op" id="4618974">[</span><span class="op" id="4618975">]</span><span class="builtintype" id="4618976">uint32</span><span class="op" id="4618982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4618985">/*&nbsp;normal&nbsp;deflate&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4619007">0x000000</span><span class="op" id="4619015">,</span>&nbsp;<span class="num" id="4619017">0x000001</span><span class="op" id="4619025">,</span>&nbsp;<span class="num" id="4619027">0x000002</span><span class="op" id="4619035">,</span>&nbsp;<span class="num" id="4619037">0x000003</span><span class="op" id="4619045">,</span>&nbsp;<span class="num" id="4619047">0x000004</span><span class="op" id="4619055">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4619058">0x000006</span><span class="op" id="4619066">,</span>&nbsp;<span class="num" id="4619068">0x000008</span><span class="op" id="4619076">,</span>&nbsp;<span class="num" id="4619078">0x00000c</span><span class="op" id="4619086">,</span>&nbsp;<span class="num" id="4619088">0x000010</span><span class="op" id="4619096">,</span>&nbsp;<span class="num" id="4619098">0x000018</span><span class="op" id="4619106">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4619109">0x000020</span><span class="op" id="4619117">,</span>&nbsp;<span class="num" id="4619119">0x000030</span><span class="op" id="4619127">,</span>&nbsp;<span class="num" id="4619129">0x000040</span><span class="op" id="4619137">,</span>&nbsp;<span class="num" id="4619139">0x000060</span><span class="op" id="4619147">,</span>&nbsp;<span class="num" id="4619149">0x000080</span><span class="op" id="4619157">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4619160">0x0000c0</span><span class="op" id="4619168">,</span>&nbsp;<span class="num" id="4619170">0x000100</span><span class="op" id="4619178">,</span>&nbsp;<span class="num" id="4619180">0x000180</span><span class="op" id="4619188">,</span>&nbsp;<span class="num" id="4619190">0x000200</span><span class="op" id="4619198">,</span>&nbsp;<span class="num" id="4619200">0x000300</span><span class="op" id="4619208">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4619211">0x000400</span><span class="op" id="4619219">,</span>&nbsp;<span class="num" id="4619221">0x000600</span><span class="op" id="4619229">,</span>&nbsp;<span class="num" id="4619231">0x000800</span><span class="op" id="4619239">,</span>&nbsp;<span class="num" id="4619241">0x000c00</span><span class="op" id="4619249">,</span>&nbsp;<span class="num" id="4619251">0x001000</span><span class="op" id="4619259">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4619262">0x001800</span><span class="op" id="4619270">,</span>&nbsp;<span class="num" id="4619272">0x002000</span><span class="op" id="4619280">,</span>&nbsp;<span class="num" id="4619282">0x003000</span><span class="op" id="4619290">,</span>&nbsp;<span class="num" id="4619292">0x004000</span><span class="op" id="4619300">,</span>&nbsp;<span class="num" id="4619302">0x006000</span><span class="op" id="4619310">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4619314">/*&nbsp;extended&nbsp;window&nbsp;*/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4619337">0x008000</span><span class="op" id="4619345">,</span>&nbsp;<span class="num" id="4619347">0x00c000</span><span class="op" id="4619355">,</span>&nbsp;<span class="num" id="4619357">0x010000</span><span class="op" id="4619365">,</span>&nbsp;<span class="num" id="4619367">0x018000</span><span class="op" id="4619375">,</span>&nbsp;<span class="num" id="4619377">0x020000</span><span class="op" id="4619385">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4619388">0x030000</span><span class="op" id="4619396">,</span>&nbsp;<span class="num" id="4619398">0x040000</span><span class="op" id="4619406">,</span>&nbsp;<span class="num" id="4619408">0x060000</span><span class="op" id="4619416">,</span>&nbsp;<span class="num" id="4619418">0x080000</span><span class="op" id="4619426">,</span>&nbsp;<span class="num" id="4619428">0x0c0000</span><span class="op" id="4619436">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4619439">0x100000</span><span class="op" id="4619447">,</span>&nbsp;<span class="num" id="4619449">0x180000</span><span class="op" id="4619457">,</span>&nbsp;<span class="num" id="4619459">0x200000</span><span class="op" id="4619467">,</span>&nbsp;<span class="num" id="4619469">0x300000</span><span class="op" id="4619477">,</span><br>
<span class="lineno"></span><span class="op" id="4619479">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="4619482">//&nbsp;The&nbsp;odd&nbsp;order&nbsp;in&nbsp;which&nbsp;the&nbsp;codegen&nbsp;code&nbsp;sizes&nbsp;are&nbsp;written.</span><br>
<span class="lineno"></span><span class="keyword" id="4619544">var</span>&nbsp;<span class="ident" id="4619548">codegenOrder</span>&nbsp;<span class="op" id="4619561">=</span>&nbsp;<span class="op" id="4619563">[</span><span class="op" id="4619564">]</span><span class="builtintype" id="4619565">uint32</span><span class="op" id="4619571">{</span><span class="num" id="4619572">16</span><span class="op" id="4619574">,</span>&nbsp;<span class="num" id="4619576">17</span><span class="op" id="4619578">,</span>&nbsp;<span class="num" id="4619580">18</span><span class="op" id="4619582">,</span>&nbsp;<span class="num" id="4619584">0</span><span class="op" id="4619585">,</span>&nbsp;<span class="num" id="4619587">8</span><span class="op" id="4619588">,</span>&nbsp;<span class="num" id="4619590">7</span><span class="op" id="4619591">,</span>&nbsp;<span class="num" id="4619593">9</span><span class="op" id="4619594">,</span>&nbsp;<span class="num" id="4619596">6</span><span class="op" id="4619597">,</span>&nbsp;<span class="num" id="4619599">10</span><span class="op" id="4619601">,</span>&nbsp;<span class="num" id="4619603">5</span><span class="op" id="4619604">,</span>&nbsp;<span class="num" id="4619606">11</span><span class="op" id="4619608">,</span>&nbsp;<span class="num" id="4619610">4</span><span class="op" id="4619611">,</span>&nbsp;<span class="num" id="4619613">12</span><span class="op" id="4619615">,</span>&nbsp;<span class="num" id="4619617">3</span><span class="op" id="4619618">,</span>&nbsp;<span class="num" id="4619620">13</span><span class="op" id="4619622">,</span>&nbsp;<span class="num" id="4619624">2</span><span class="op" id="4619625">,</span>&nbsp;<span class="num" id="4619627">14</span><span class="op" id="4619629">,</span>&nbsp;<span class="num" id="4619631">1</span><span class="op" id="4619632">,</span>&nbsp;<span class="num" id="4619634">15</span><span class="op" id="4619636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4619639">type</span>&nbsp;<span class="ident" id="4619644">huffmanBitWriter</span>&nbsp;<span class="keyword" id="4619661">struct</span>&nbsp;<span class="op" id="4619668">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4619671">w</span>&nbsp;<span class="ident" id="4619673">io</span><span class="op" id="4619675">.</span><span class="ident" id="4619676">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4619684">//&nbsp;Data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;written&nbsp;is&nbsp;bytes[0:nbytes]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4619734">//&nbsp;and&nbsp;then&nbsp;the&nbsp;low&nbsp;nbits&nbsp;of&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4619770">bits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4619786">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4619794">nbits</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4619810">uint32</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4619818">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4619834">[</span><span class="num" id="4619835">64</span><span class="op" id="4619837">]</span><span class="builtintype" id="4619838">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4619844">nbytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4619860">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4619865">literalFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4619881">[</span><span class="op" id="4619882">]</span><span class="builtintype" id="4619883">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4619890">offsetFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4619906">[</span><span class="op" id="4619907">]</span><span class="builtintype" id="4619908">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4619915">codegen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4619931">[</span><span class="op" id="4619932">]</span><span class="builtintype" id="4619933">uint8</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4619940">codegenFreq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4619956">[</span><span class="op" id="4619957">]</span><span class="builtintype" id="4619958">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4619965">literalEncoding</span>&nbsp;<span class="op" id="4619981">*</span><span class="ident" id="4619982">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4619998">offsetEncoding</span>&nbsp;&nbsp;<span class="op" id="4620014">*</span><span class="ident" id="4620015">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4620031">codegenEncoding</span>&nbsp;<span class="op" id="4620047">*</span><span class="ident" id="4620048">huffmanEncoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4620064">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4620080">error</span><br>
<span class="lineno">85</span><span class="op" id="4620086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4620089">func</span>&nbsp;<span class="ident" id="4620094">newHuffmanBitWriter</span><span class="op" id="4620113">(</span><span class="ident" id="4620114">w</span>&nbsp;<span class="ident" id="4620116">io</span><span class="op" id="4620118">.</span><span class="ident" id="4620119">Writer</span><span class="op" id="4620125">)</span>&nbsp;<span class="op" id="4620127">*</span><span class="ident" id="4620128">huffmanBitWriter</span>&nbsp;<span class="op" id="4620145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4620148">return</span>&nbsp;<span class="op" id="4620155">&amp;</span><span class="ident" id="4620156">huffmanBitWriter</span><span class="op" id="4620172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4620176">w</span><span class="op" id="4620177">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4620193">w</span><span class="op" id="4620194">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4620198">literalFreq</span><span class="op" id="4620209">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4620215">make</span><span class="op" id="4620219">(</span><span class="op" id="4620220">[</span><span class="op" id="4620221">]</span><span class="builtintype" id="4620222">int32</span><span class="op" id="4620227">,</span>&nbsp;<span class="ident" id="4620229">maxLit</span><span class="op" id="4620235">)</span><span class="op" id="4620236">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4620240">offsetFreq</span><span class="op" id="4620250">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4620257">make</span><span class="op" id="4620261">(</span><span class="op" id="4620262">[</span><span class="op" id="4620263">]</span><span class="builtintype" id="4620264">int32</span><span class="op" id="4620269">,</span>&nbsp;<span class="ident" id="4620271">offsetCodeCount</span><span class="op" id="4620286">)</span><span class="op" id="4620287">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4620291">codegen</span><span class="op" id="4620298">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4620308">make</span><span class="op" id="4620312">(</span><span class="op" id="4620313">[</span><span class="op" id="4620314">]</span><span class="builtintype" id="4620315">uint8</span><span class="op" id="4620320">,</span>&nbsp;<span class="ident" id="4620322">maxLit</span><span class="op" id="4620328">+</span><span class="ident" id="4620329">offsetCodeCount</span><span class="op" id="4620344">+</span><span class="num" id="4620345">1</span><span class="op" id="4620346">)</span><span class="op" id="4620347">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4620351">codegenFreq</span><span class="op" id="4620362">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4620368">make</span><span class="op" id="4620372">(</span><span class="op" id="4620373">[</span><span class="op" id="4620374">]</span><span class="builtintype" id="4620375">int32</span><span class="op" id="4620380">,</span>&nbsp;<span class="ident" id="4620382">codegenCodeCount</span><span class="op" id="4620398">)</span><span class="op" id="4620399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4620403">literalEncoding</span><span class="op" id="4620418">:</span>&nbsp;<span class="ident" id="4620420">newHuffmanEncoder</span><span class="op" id="4620437">(</span><span class="ident" id="4620438">maxLit</span><span class="op" id="4620444">)</span><span class="op" id="4620445">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4620449">offsetEncoding</span><span class="op" id="4620463">:</span>&nbsp;&nbsp;<span class="ident" id="4620466">newHuffmanEncoder</span><span class="op" id="4620483">(</span><span class="ident" id="4620484">offsetCodeCount</span><span class="op" id="4620499">)</span><span class="op" id="4620500">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4620504">codegenEncoding</span><span class="op" id="4620519">:</span>&nbsp;<span class="ident" id="4620521">newHuffmanEncoder</span><span class="op" id="4620538">(</span><span class="ident" id="4620539">codegenCodeCount</span><span class="op" id="4620555">)</span><span class="op" id="4620556">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4620559">}</span><br>
<span class="lineno"></span><span class="op" id="4620561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="4620564">func</span>&nbsp;<span class="op" id="4620569">(</span><span class="ident" id="4620570">w</span>&nbsp;<span class="op" id="4620572">*</span><span class="ident" id="4620573">huffmanBitWriter</span><span class="op" id="4620589">)</span>&nbsp;<span class="ident" id="4620591">reset</span><span class="op" id="4620596">(</span><span class="ident" id="4620597">writer</span>&nbsp;<span class="ident" id="4620604">io</span><span class="op" id="4620606">.</span><span class="ident" id="4620607">Writer</span><span class="op" id="4620613">)</span>&nbsp;<span class="op" id="4620615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4620618">w</span><span class="op" id="4620619">.</span><span class="ident" id="4620620">w</span>&nbsp;<span class="op" id="4620622">=</span>&nbsp;<span class="ident" id="4620624">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4620632">w</span><span class="op" id="4620633">.</span><span class="ident" id="4620634">bits</span><span class="op" id="4620638">,</span>&nbsp;<span class="ident" id="4620640">w</span><span class="op" id="4620641">.</span><span class="ident" id="4620642">nbits</span><span class="op" id="4620647">,</span>&nbsp;<span class="ident" id="4620649">w</span><span class="op" id="4620650">.</span><span class="ident" id="4620651">nbytes</span><span class="op" id="4620657">,</span>&nbsp;<span class="ident" id="4620659">w</span><span class="op" id="4620660">.</span><span class="ident" id="4620661">err</span>&nbsp;<span class="op" id="4620665">=</span>&nbsp;<span class="num" id="4620667">0</span><span class="op" id="4620668">,</span>&nbsp;<span class="num" id="4620670">0</span><span class="op" id="4620671">,</span>&nbsp;<span class="num" id="4620673">0</span><span class="op" id="4620674">,</span>&nbsp;<span class="ident" id="4620676">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4620681">w</span><span class="op" id="4620682">.</span><span class="ident" id="4620683">bytes</span>&nbsp;<span class="op" id="4620689">=</span>&nbsp;<span class="op" id="4620691">[</span><span class="num" id="4620692">64</span><span class="op" id="4620694">]</span><span class="builtintype" id="4620695">byte</span><span class="op" id="4620699">{</span><span class="op" id="4620700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4620703">for</span>&nbsp;<span class="ident" id="4620707">i</span>&nbsp;<span class="op" id="4620709">:=</span>&nbsp;<span class="keyword" id="4620712">range</span>&nbsp;<span class="ident" id="4620718">w</span><span class="op" id="4620719">.</span><span class="ident" id="4620720">codegen</span>&nbsp;<span class="op" id="4620728">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4620732">w</span><span class="op" id="4620733">.</span><span class="ident" id="4620734">codegen</span><span class="op" id="4620741">[</span><span class="ident" id="4620742">i</span><span class="op" id="4620743">]</span>&nbsp;<span class="op" id="4620745">=</span>&nbsp;<span class="num" id="4620747">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4620750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4620753">for</span>&nbsp;<span class="ident" id="4620757">_</span><span class="op" id="4620758">,</span>&nbsp;<span class="ident" id="4620760">s</span>&nbsp;<span class="op" id="4620762">:=</span>&nbsp;<span class="keyword" id="4620765">range</span>&nbsp;<span class="op" id="4620771">[</span><span class="op" id="4620772">...</span><span class="op" id="4620775">]</span><span class="op" id="4620776">[</span><span class="op" id="4620777">]</span><span class="builtintype" id="4620778">int32</span><span class="op" id="4620783">{</span><span class="ident" id="4620784">w</span><span class="op" id="4620785">.</span><span class="ident" id="4620786">literalFreq</span><span class="op" id="4620797">,</span>&nbsp;<span class="ident" id="4620799">w</span><span class="op" id="4620800">.</span><span class="ident" id="4620801">offsetFreq</span><span class="op" id="4620811">,</span>&nbsp;<span class="ident" id="4620813">w</span><span class="op" id="4620814">.</span><span class="ident" id="4620815">codegenFreq</span><span class="op" id="4620826">}</span>&nbsp;<span class="op" id="4620828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4620832">for</span>&nbsp;<span class="ident" id="4620836">i</span>&nbsp;<span class="op" id="4620838">:=</span>&nbsp;<span class="keyword" id="4620841">range</span>&nbsp;<span class="ident" id="4620847">s</span>&nbsp;<span class="op" id="4620849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4620854">s</span><span class="op" id="4620855">[</span><span class="ident" id="4620856">i</span><span class="op" id="4620857">]</span>&nbsp;<span class="op" id="4620859">=</span>&nbsp;<span class="num" id="4620861">0</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4620865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4620868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4620871">for</span>&nbsp;<span class="ident" id="4620875">_</span><span class="op" id="4620876">,</span>&nbsp;<span class="ident" id="4620878">enc</span>&nbsp;<span class="op" id="4620882">:=</span>&nbsp;<span class="keyword" id="4620885">range</span>&nbsp;<span class="op" id="4620891">[</span><span class="op" id="4620892">...</span><span class="op" id="4620895">]</span><span class="op" id="4620896">*</span><span class="ident" id="4620897">huffmanEncoder</span><span class="op" id="4620911">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4620915">w</span><span class="op" id="4620916">.</span><span class="ident" id="4620917">literalEncoding</span><span class="op" id="4620932">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4620936">w</span><span class="op" id="4620937">.</span><span class="ident" id="4620938">offsetEncoding</span><span class="op" id="4620952">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4620956">w</span><span class="op" id="4620957">.</span><span class="ident" id="4620958">codegenEncoding</span><span class="op" id="4620973">}</span>&nbsp;<span class="op" id="4620975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4620979">for</span>&nbsp;<span class="ident" id="4620983">i</span>&nbsp;<span class="op" id="4620985">:=</span>&nbsp;<span class="keyword" id="4620988">range</span>&nbsp;<span class="ident" id="4620994">enc</span><span class="op" id="4620997">.</span><span class="ident" id="4620998">code</span>&nbsp;<span class="op" id="4621003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621008">enc</span><span class="op" id="4621011">.</span><span class="ident" id="4621012">code</span><span class="op" id="4621016">[</span><span class="ident" id="4621017">i</span><span class="op" id="4621018">]</span>&nbsp;<span class="op" id="4621020">=</span>&nbsp;<span class="num" id="4621022">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4621026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621030">for</span>&nbsp;<span class="ident" id="4621034">i</span>&nbsp;<span class="op" id="4621036">:=</span>&nbsp;<span class="keyword" id="4621039">range</span>&nbsp;<span class="ident" id="4621045">enc</span><span class="op" id="4621048">.</span><span class="ident" id="4621049">codeBits</span>&nbsp;<span class="op" id="4621058">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621063">enc</span><span class="op" id="4621066">.</span><span class="ident" id="4621067">codeBits</span><span class="op" id="4621075">[</span><span class="ident" id="4621076">i</span><span class="op" id="4621077">]</span>&nbsp;<span class="op" id="4621079">=</span>&nbsp;<span class="num" id="4621081">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4621085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4621088">}</span><br>
<span class="lineno"></span><span class="op" id="4621090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="4621093">func</span>&nbsp;<span class="op" id="4621098">(</span><span class="ident" id="4621099">w</span>&nbsp;<span class="op" id="4621101">*</span><span class="ident" id="4621102">huffmanBitWriter</span><span class="op" id="4621118">)</span>&nbsp;<span class="ident" id="4621120">flushBits</span><span class="op" id="4621129">(</span><span class="op" id="4621130">)</span>&nbsp;<span class="op" id="4621132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621135">if</span>&nbsp;<span class="ident" id="4621138">w</span><span class="op" id="4621139">.</span><span class="ident" id="4621140">err</span>&nbsp;<span class="op" id="4621144">!=</span>&nbsp;<span class="ident" id="4621147">nil</span>&nbsp;<span class="op" id="4621151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621155">w</span><span class="op" id="4621156">.</span><span class="ident" id="4621157">nbits</span>&nbsp;<span class="op" id="4621163">=</span>&nbsp;<span class="num" id="4621165">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621169">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4621177">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621180">bits</span>&nbsp;<span class="op" id="4621185">:=</span>&nbsp;<span class="ident" id="4621188">w</span><span class="op" id="4621189">.</span><span class="ident" id="4621190">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621196">w</span><span class="op" id="4621197">.</span><span class="ident" id="4621198">bits</span>&nbsp;<span class="op" id="4621203">&gt;&gt;=</span>&nbsp;<span class="num" id="4621207">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621211">w</span><span class="op" id="4621212">.</span><span class="ident" id="4621213">nbits</span>&nbsp;<span class="op" id="4621219">-=</span>&nbsp;<span class="num" id="4621222">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621226">n</span>&nbsp;<span class="op" id="4621228">:=</span>&nbsp;<span class="ident" id="4621231">w</span><span class="op" id="4621232">.</span><span class="ident" id="4621233">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621241">w</span><span class="op" id="4621242">.</span><span class="ident" id="4621243">bytes</span><span class="op" id="4621248">[</span><span class="ident" id="4621249">n</span><span class="op" id="4621250">]</span>&nbsp;<span class="op" id="4621252">=</span>&nbsp;<span class="builtintype" id="4621254">byte</span><span class="op" id="4621258">(</span><span class="ident" id="4621259">bits</span><span class="op" id="4621263">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621266">w</span><span class="op" id="4621267">.</span><span class="ident" id="4621268">bytes</span><span class="op" id="4621273">[</span><span class="ident" id="4621274">n</span><span class="op" id="4621275">+</span><span class="num" id="4621276">1</span><span class="op" id="4621277">]</span>&nbsp;<span class="op" id="4621279">=</span>&nbsp;<span class="builtintype" id="4621281">byte</span><span class="op" id="4621285">(</span><span class="ident" id="4621286">bits</span>&nbsp;<span class="op" id="4621291">&gt;&gt;</span>&nbsp;<span class="num" id="4621294">8</span><span class="op" id="4621295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621298">if</span>&nbsp;<span class="ident" id="4621301">n</span>&nbsp;<span class="op" id="4621303">+=</span>&nbsp;<span class="num" id="4621306">2</span><span class="op" id="4621307">;</span>&nbsp;<span class="ident" id="4621309">n</span>&nbsp;<span class="op" id="4621311">&gt;=</span>&nbsp;<span class="builtinfunc" id="4621314">len</span><span class="op" id="4621317">(</span><span class="ident" id="4621318">w</span><span class="op" id="4621319">.</span><span class="ident" id="4621320">bytes</span><span class="op" id="4621325">)</span>&nbsp;<span class="op" id="4621327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621331">_</span><span class="op" id="4621332">,</span>&nbsp;<span class="ident" id="4621334">w</span><span class="op" id="4621335">.</span><span class="ident" id="4621336">err</span>&nbsp;<span class="op" id="4621340">=</span>&nbsp;<span class="ident" id="4621342">w</span><span class="op" id="4621343">.</span><span class="ident" id="4621344">w</span><span class="op" id="4621345">.</span><span class="ident" id="4621346">Write</span><span class="op" id="4621351">(</span><span class="ident" id="4621352">w</span><span class="op" id="4621353">.</span><span class="ident" id="4621354">bytes</span><span class="op" id="4621359">[</span><span class="num" id="4621360">0</span><span class="op" id="4621361">:</span><span class="op" id="4621362">]</span><span class="op" id="4621363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621367">n</span>&nbsp;<span class="op" id="4621369">=</span>&nbsp;<span class="num" id="4621371">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4621374">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621377">w</span><span class="op" id="4621378">.</span><span class="ident" id="4621379">nbytes</span>&nbsp;<span class="op" id="4621386">=</span>&nbsp;<span class="ident" id="4621388">n</span><br>
<span class="lineno"></span><span class="op" id="4621390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4621393">func</span>&nbsp;<span class="op" id="4621398">(</span><span class="ident" id="4621399">w</span>&nbsp;<span class="op" id="4621401">*</span><span class="ident" id="4621402">huffmanBitWriter</span><span class="op" id="4621418">)</span>&nbsp;<span class="ident" id="4621420">flush</span><span class="op" id="4621425">(</span><span class="op" id="4621426">)</span>&nbsp;<span class="op" id="4621428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621431">if</span>&nbsp;<span class="ident" id="4621434">w</span><span class="op" id="4621435">.</span><span class="ident" id="4621436">err</span>&nbsp;<span class="op" id="4621440">!=</span>&nbsp;<span class="ident" id="4621443">nil</span>&nbsp;<span class="op" id="4621447">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621451">w</span><span class="op" id="4621452">.</span><span class="ident" id="4621453">nbits</span>&nbsp;<span class="op" id="4621459">=</span>&nbsp;<span class="num" id="4621461">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621465">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4621473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621476">n</span>&nbsp;<span class="op" id="4621478">:=</span>&nbsp;<span class="ident" id="4621481">w</span><span class="op" id="4621482">.</span><span class="ident" id="4621483">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621491">if</span>&nbsp;<span class="ident" id="4621494">w</span><span class="op" id="4621495">.</span><span class="ident" id="4621496">nbits</span>&nbsp;<span class="op" id="4621502">&gt;</span>&nbsp;<span class="num" id="4621504">8</span>&nbsp;<span class="op" id="4621506">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621510">w</span><span class="op" id="4621511">.</span><span class="ident" id="4621512">bytes</span><span class="op" id="4621517">[</span><span class="ident" id="4621518">n</span><span class="op" id="4621519">]</span>&nbsp;<span class="op" id="4621521">=</span>&nbsp;<span class="builtintype" id="4621523">byte</span><span class="op" id="4621527">(</span><span class="ident" id="4621528">w</span><span class="op" id="4621529">.</span><span class="ident" id="4621530">bits</span><span class="op" id="4621534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621538">w</span><span class="op" id="4621539">.</span><span class="ident" id="4621540">bits</span>&nbsp;<span class="op" id="4621545">&gt;&gt;=</span>&nbsp;<span class="num" id="4621549">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621553">w</span><span class="op" id="4621554">.</span><span class="ident" id="4621555">nbits</span>&nbsp;<span class="op" id="4621561">-=</span>&nbsp;<span class="num" id="4621564">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621568">n</span><span class="op" id="4621569">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4621573">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621576">if</span>&nbsp;<span class="ident" id="4621579">w</span><span class="op" id="4621580">.</span><span class="ident" id="4621581">nbits</span>&nbsp;<span class="op" id="4621587">&gt;</span>&nbsp;<span class="num" id="4621589">0</span>&nbsp;<span class="op" id="4621591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621595">w</span><span class="op" id="4621596">.</span><span class="ident" id="4621597">bytes</span><span class="op" id="4621602">[</span><span class="ident" id="4621603">n</span><span class="op" id="4621604">]</span>&nbsp;<span class="op" id="4621606">=</span>&nbsp;<span class="builtintype" id="4621608">byte</span><span class="op" id="4621612">(</span><span class="ident" id="4621613">w</span><span class="op" id="4621614">.</span><span class="ident" id="4621615">bits</span><span class="op" id="4621619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621623">w</span><span class="op" id="4621624">.</span><span class="ident" id="4621625">nbits</span>&nbsp;<span class="op" id="4621631">=</span>&nbsp;<span class="num" id="4621633">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621637">n</span><span class="op" id="4621638">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4621642">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621645">w</span><span class="op" id="4621646">.</span><span class="ident" id="4621647">bits</span>&nbsp;<span class="op" id="4621652">=</span>&nbsp;<span class="num" id="4621654">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621657">_</span><span class="op" id="4621658">,</span>&nbsp;<span class="ident" id="4621660">w</span><span class="op" id="4621661">.</span><span class="ident" id="4621662">err</span>&nbsp;<span class="op" id="4621666">=</span>&nbsp;<span class="ident" id="4621668">w</span><span class="op" id="4621669">.</span><span class="ident" id="4621670">w</span><span class="op" id="4621671">.</span><span class="ident" id="4621672">Write</span><span class="op" id="4621677">(</span><span class="ident" id="4621678">w</span><span class="op" id="4621679">.</span><span class="ident" id="4621680">bytes</span><span class="op" id="4621685">[</span><span class="num" id="4621686">0</span><span class="op" id="4621687">:</span><span class="ident" id="4621688">n</span><span class="op" id="4621689">]</span><span class="op" id="4621690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621693">w</span><span class="op" id="4621694">.</span><span class="ident" id="4621695">nbytes</span>&nbsp;<span class="op" id="4621702">=</span>&nbsp;<span class="num" id="4621704">0</span><br>
<span class="lineno"></span><span class="op" id="4621706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="4621709">func</span>&nbsp;<span class="op" id="4621714">(</span><span class="ident" id="4621715">w</span>&nbsp;<span class="op" id="4621717">*</span><span class="ident" id="4621718">huffmanBitWriter</span><span class="op" id="4621734">)</span>&nbsp;<span class="ident" id="4621736">writeBits</span><span class="op" id="4621745">(</span><span class="ident" id="4621746">b</span><span class="op" id="4621747">,</span>&nbsp;<span class="ident" id="4621749">nb</span>&nbsp;<span class="builtintype" id="4621752">int32</span><span class="op" id="4621757">)</span>&nbsp;<span class="op" id="4621759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621762">w</span><span class="op" id="4621763">.</span><span class="ident" id="4621764">bits</span>&nbsp;<span class="op" id="4621769">|=</span>&nbsp;<span class="builtintype" id="4621772">uint32</span><span class="op" id="4621778">(</span><span class="ident" id="4621779">b</span><span class="op" id="4621780">)</span>&nbsp;<span class="op" id="4621782">&lt;&lt;</span>&nbsp;<span class="ident" id="4621785">w</span><span class="op" id="4621786">.</span><span class="ident" id="4621787">nbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621794">if</span>&nbsp;<span class="ident" id="4621797">w</span><span class="op" id="4621798">.</span><span class="ident" id="4621799">nbits</span>&nbsp;<span class="op" id="4621805">+=</span>&nbsp;<span class="builtintype" id="4621808">uint32</span><span class="op" id="4621814">(</span><span class="ident" id="4621815">nb</span><span class="op" id="4621817">)</span><span class="op" id="4621818">;</span>&nbsp;<span class="ident" id="4621820">w</span><span class="op" id="4621821">.</span><span class="ident" id="4621822">nbits</span>&nbsp;<span class="op" id="4621828">&gt;=</span>&nbsp;<span class="num" id="4621831">16</span>&nbsp;<span class="op" id="4621834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621838">w</span><span class="op" id="4621839">.</span><span class="ident" id="4621840">flushBits</span><span class="op" id="4621849">(</span><span class="op" id="4621850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4621853">}</span><br>
<span class="lineno">170</span><span class="op" id="4621855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4621858">func</span>&nbsp;<span class="op" id="4621863">(</span><span class="ident" id="4621864">w</span>&nbsp;<span class="op" id="4621866">*</span><span class="ident" id="4621867">huffmanBitWriter</span><span class="op" id="4621883">)</span>&nbsp;<span class="ident" id="4621885">writeBytes</span><span class="op" id="4621895">(</span><span class="ident" id="4621896">bytes</span>&nbsp;<span class="op" id="4621902">[</span><span class="op" id="4621903">]</span><span class="builtintype" id="4621904">byte</span><span class="op" id="4621908">)</span>&nbsp;<span class="op" id="4621910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621913">if</span>&nbsp;<span class="ident" id="4621916">w</span><span class="op" id="4621917">.</span><span class="ident" id="4621918">err</span>&nbsp;<span class="op" id="4621922">!=</span>&nbsp;<span class="ident" id="4621925">nil</span>&nbsp;<span class="op" id="4621929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621933">return</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4621941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621944">n</span>&nbsp;<span class="op" id="4621946">:=</span>&nbsp;<span class="ident" id="4621949">w</span><span class="op" id="4621950">.</span><span class="ident" id="4621951">nbytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4621959">if</span>&nbsp;<span class="ident" id="4621962">w</span><span class="op" id="4621963">.</span><span class="ident" id="4621964">nbits</span>&nbsp;<span class="op" id="4621970">==</span>&nbsp;<span class="num" id="4621973">8</span>&nbsp;<span class="op" id="4621975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4621979">w</span><span class="op" id="4621980">.</span><span class="ident" id="4621981">bytes</span><span class="op" id="4621986">[</span><span class="ident" id="4621987">n</span><span class="op" id="4621988">]</span>&nbsp;<span class="op" id="4621990">=</span>&nbsp;<span class="builtintype" id="4621992">byte</span><span class="op" id="4621996">(</span><span class="ident" id="4621997">w</span><span class="op" id="4621998">.</span><span class="ident" id="4621999">bits</span><span class="op" id="4622003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4622007">w</span><span class="op" id="4622008">.</span><span class="ident" id="4622009">nbits</span>&nbsp;<span class="op" id="4622015">=</span>&nbsp;<span class="num" id="4622017">0</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4622021">n</span><span class="op" id="4622022">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4622026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4622029">if</span>&nbsp;<span class="ident" id="4622032">w</span><span class="op" id="4622033">.</span><span class="ident" id="4622034">nbits</span>&nbsp;<span class="op" id="4622040">!=</span>&nbsp;<span class="num" id="4622043">0</span>&nbsp;<span class="op" id="4622045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4622049">w</span><span class="op" id="4622050">.</span><span class="ident" id="4622051">err</span>&nbsp;<span class="op" id="4622055">=</span>&nbsp;<span class="ident" id="4622057">InternalError</span><span class="op" id="4622070">(</span><span class="string" id="4622071">&#34;writeBytes&nbsp;with&nbsp;unfinished&nbsp;bits&#34;</span><span class="op" id="4622104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4622108">return</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4622116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4622119">if</span>&nbsp;<span class="ident" id="4622122">n</span>&nbsp;<span class="op" id="4622124">!=</span>&nbsp;<span class="num" id="4622127">0</span>&nbsp;<span class="op" id="4622129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4622133">_</span><span class="op" id="4622134">,</span>&nbsp;<span class="ident" id="4622136">w</span><span class="op" id="4622137">.</span><span class="ident" id="4622138">err</span>&nbsp;<span class="op" id="4622142">=</span>&nbsp;<span class="ident" id="4622144">w</span><span class="op" id="4622145">.</span><span class="ident" id="4622146">w</span><span class="op" id="4622147">.</span><span class="ident" id="4622148">Write</span><span class="op" id="4622153">(</span><span class="ident" id="4622154">w</span><span class="op" id="4622155">.</span><span class="ident" id="4622156">bytes</span><span class="op" id="4622161">[</span><span class="num" id="4622162">0</span><span class="op" id="4622163">:</span><span class="ident" id="4622164">n</span><span class="op" id="4622165">]</span><span class="op" id="4622166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4622170">if</span>&nbsp;<span class="ident" id="4622173">w</span><span class="op" id="4622174">.</span><span class="ident" id="4622175">err</span>&nbsp;<span class="op" id="4622179">!=</span>&nbsp;<span class="ident" id="4622182">nil</span>&nbsp;<span class="op" id="4622186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4622191">return</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4622200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4622203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4622206">w</span><span class="op" id="4622207">.</span><span class="ident" id="4622208">nbytes</span>&nbsp;<span class="op" id="4622215">=</span>&nbsp;<span class="num" id="4622217">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4622220">_</span><span class="op" id="4622221">,</span>&nbsp;<span class="ident" id="4622223">w</span><span class="op" id="4622224">.</span><span class="ident" id="4622225">err</span>&nbsp;<span class="op" id="4622229">=</span>&nbsp;<span class="ident" id="4622231">w</span><span class="op" id="4622232">.</span><span class="ident" id="4622233">w</span><span class="op" id="4622234">.</span><span class="ident" id="4622235">Write</span><span class="op" id="4622240">(</span><span class="ident" id="4622241">bytes</span><span class="op" id="4622246">)</span><br>
<span class="lineno"></span><span class="op" id="4622248">}</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span><span class="comment" id="4622251">//&nbsp;RFC&nbsp;1951&nbsp;3.2.7&nbsp;specifies&nbsp;a&nbsp;special&nbsp;run-length&nbsp;encoding&nbsp;for&nbsp;specifying</span><br>
<span class="lineno"></span><span class="comment" id="4622324">//&nbsp;the&nbsp;literal&nbsp;and&nbsp;offset&nbsp;lengths&nbsp;arrays&nbsp;(which&nbsp;are&nbsp;concatenated&nbsp;into&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span><span class="comment" id="4622403">//&nbsp;array).&nbsp;&nbsp;This&nbsp;method&nbsp;generates&nbsp;that&nbsp;run-length&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="4622463">//</span><br>
<span class="lineno">200</span><span class="comment" id="4622466">//&nbsp;The&nbsp;result&nbsp;is&nbsp;written&nbsp;into&nbsp;the&nbsp;codegen&nbsp;array,&nbsp;and&nbsp;the&nbsp;frequencies</span><br>
<span class="lineno"></span><span class="comment" id="4622535">//&nbsp;of&nbsp;each&nbsp;code&nbsp;is&nbsp;written&nbsp;into&nbsp;the&nbsp;codegenFreq&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="4622590">//&nbsp;Codes&nbsp;0-15&nbsp;are&nbsp;single&nbsp;byte&nbsp;codes.&nbsp;Codes&nbsp;16-18&nbsp;are&nbsp;followed&nbsp;by&nbsp;additional</span><br>
<span class="lineno"></span><span class="comment" id="4622666">//&nbsp;information.&nbsp;&nbsp;Code&nbsp;badCode&nbsp;is&nbsp;an&nbsp;end&nbsp;marker</span><br>
<span class="lineno"></span><span class="comment" id="4622713">//</span><br>
<span class="lineno">205</span><span class="comment" id="4622716">//&nbsp;&nbsp;numLiterals&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;literals&nbsp;in&nbsp;literalEncoding</span><br>
<span class="lineno"></span><span class="comment" id="4622779">//&nbsp;&nbsp;numOffsets&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;offsets&nbsp;in&nbsp;offsetEncoding</span><br>
<span class="lineno"></span><span class="keyword" id="4622840">func</span>&nbsp;<span class="op" id="4622845">(</span><span class="ident" id="4622846">w</span>&nbsp;<span class="op" id="4622848">*</span><span class="ident" id="4622849">huffmanBitWriter</span><span class="op" id="4622865">)</span>&nbsp;<span class="ident" id="4622867">generateCodegen</span><span class="op" id="4622882">(</span><span class="ident" id="4622883">numLiterals</span>&nbsp;<span class="builtintype" id="4622895">int</span><span class="op" id="4622898">,</span>&nbsp;<span class="ident" id="4622900">numOffsets</span>&nbsp;<span class="builtintype" id="4622911">int</span><span class="op" id="4622914">)</span>&nbsp;<span class="op" id="4622916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4622919">for</span>&nbsp;<span class="ident" id="4622923">i</span>&nbsp;<span class="op" id="4622925">:=</span>&nbsp;<span class="keyword" id="4622928">range</span>&nbsp;<span class="ident" id="4622934">w</span><span class="op" id="4622935">.</span><span class="ident" id="4622936">codegenFreq</span>&nbsp;<span class="op" id="4622948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4622952">w</span><span class="op" id="4622953">.</span><span class="ident" id="4622954">codegenFreq</span><span class="op" id="4622965">[</span><span class="ident" id="4622966">i</span><span class="op" id="4622967">]</span>&nbsp;<span class="op" id="4622969">=</span>&nbsp;<span class="num" id="4622971">0</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4622974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4622977">//&nbsp;Note&nbsp;that&nbsp;we&nbsp;are&nbsp;using&nbsp;codegen&nbsp;both&nbsp;as&nbsp;a&nbsp;temporary&nbsp;variable&nbsp;for&nbsp;holding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4623053">//&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;frequencies,&nbsp;and&nbsp;as&nbsp;the&nbsp;place&nbsp;where&nbsp;we&nbsp;put&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4623126">//&nbsp;This&nbsp;is&nbsp;fine&nbsp;because&nbsp;the&nbsp;output&nbsp;is&nbsp;always&nbsp;shorter&nbsp;than&nbsp;the&nbsp;input&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4623200">//&nbsp;so&nbsp;far.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4623212">codegen</span>&nbsp;<span class="op" id="4623220">:=</span>&nbsp;<span class="ident" id="4623223">w</span><span class="op" id="4623224">.</span><span class="ident" id="4623225">codegen</span>&nbsp;<span class="comment" id="4623233">//&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4623243">//&nbsp;Copy&nbsp;the&nbsp;concatenated&nbsp;code&nbsp;sizes&nbsp;to&nbsp;codegen.&nbsp;&nbsp;Put&nbsp;a&nbsp;marker&nbsp;at&nbsp;the&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4623318">copy</span><span class="op" id="4623322">(</span><span class="ident" id="4623323">codegen</span><span class="op" id="4623330">[</span><span class="num" id="4623331">0</span><span class="op" id="4623332">:</span><span class="ident" id="4623333">numLiterals</span><span class="op" id="4623344">]</span><span class="op" id="4623345">,</span>&nbsp;<span class="ident" id="4623347">w</span><span class="op" id="4623348">.</span><span class="ident" id="4623349">literalEncoding</span><span class="op" id="4623364">.</span><span class="ident" id="4623365">codeBits</span><span class="op" id="4623373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4623376">copy</span><span class="op" id="4623380">(</span><span class="ident" id="4623381">codegen</span><span class="op" id="4623388">[</span><span class="ident" id="4623389">numLiterals</span><span class="op" id="4623400">:</span><span class="ident" id="4623401">numLiterals</span><span class="op" id="4623412">+</span><span class="ident" id="4623413">numOffsets</span><span class="op" id="4623423">]</span><span class="op" id="4623424">,</span>&nbsp;<span class="ident" id="4623426">w</span><span class="op" id="4623427">.</span><span class="ident" id="4623428">offsetEncoding</span><span class="op" id="4623442">.</span><span class="ident" id="4623443">codeBits</span><span class="op" id="4623451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4623454">codegen</span><span class="op" id="4623461">[</span><span class="ident" id="4623462">numLiterals</span><span class="op" id="4623473">+</span><span class="ident" id="4623474">numOffsets</span><span class="op" id="4623484">]</span>&nbsp;<span class="op" id="4623486">=</span>&nbsp;<span class="ident" id="4623488">badCode</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4623498">size</span>&nbsp;<span class="op" id="4623503">:=</span>&nbsp;<span class="ident" id="4623506">codegen</span><span class="op" id="4623513">[</span><span class="num" id="4623514">0</span><span class="op" id="4623515">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4623518">count</span>&nbsp;<span class="op" id="4623524">:=</span>&nbsp;<span class="num" id="4623527">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4623530">outIndex</span>&nbsp;<span class="op" id="4623539">:=</span>&nbsp;<span class="num" id="4623542">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623545">for</span>&nbsp;<span class="ident" id="4623549">inIndex</span>&nbsp;<span class="op" id="4623557">:=</span>&nbsp;<span class="num" id="4623560">1</span><span class="op" id="4623561">;</span>&nbsp;<span class="ident" id="4623563">size</span>&nbsp;<span class="op" id="4623568">!=</span>&nbsp;<span class="ident" id="4623571">badCode</span><span class="op" id="4623578">;</span>&nbsp;<span class="ident" id="4623580">inIndex</span><span class="op" id="4623587">++</span>&nbsp;<span class="op" id="4623590">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4623594">//&nbsp;INVARIANT:&nbsp;We&nbsp;have&nbsp;seen&nbsp;&#34;count&#34;&nbsp;copies&nbsp;of&nbsp;size&nbsp;that&nbsp;have&nbsp;not&nbsp;yet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4623664">//&nbsp;had&nbsp;output&nbsp;generated&nbsp;for&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4623700">nextSize</span>&nbsp;<span class="op" id="4623709">:=</span>&nbsp;<span class="ident" id="4623712">codegen</span><span class="op" id="4623719">[</span><span class="ident" id="4623720">inIndex</span><span class="op" id="4623727">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623731">if</span>&nbsp;<span class="ident" id="4623734">nextSize</span>&nbsp;<span class="op" id="4623743">==</span>&nbsp;<span class="ident" id="4623746">size</span>&nbsp;<span class="op" id="4623751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4623756">count</span><span class="op" id="4623761">++</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623767">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4623778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4623782">//&nbsp;We&nbsp;need&nbsp;to&nbsp;generate&nbsp;codegen&nbsp;indicating&nbsp;&#34;count&#34;&nbsp;of&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623843">if</span>&nbsp;<span class="ident" id="4623846">size</span>&nbsp;<span class="op" id="4623851">!=</span>&nbsp;<span class="num" id="4623854">0</span>&nbsp;<span class="op" id="4623856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4623861">codegen</span><span class="op" id="4623868">[</span><span class="ident" id="4623869">outIndex</span><span class="op" id="4623877">]</span>&nbsp;<span class="op" id="4623879">=</span>&nbsp;<span class="ident" id="4623881">size</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4623889">outIndex</span><span class="op" id="4623897">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4623903">w</span><span class="op" id="4623904">.</span><span class="ident" id="4623905">codegenFreq</span><span class="op" id="4623916">[</span><span class="ident" id="4623917">size</span><span class="op" id="4623921">]</span><span class="op" id="4623922">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4623928">count</span><span class="op" id="4623933">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623939">for</span>&nbsp;<span class="ident" id="4623943">count</span>&nbsp;<span class="op" id="4623949">&gt;=</span>&nbsp;<span class="num" id="4623952">3</span>&nbsp;<span class="op" id="4623954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4623960">n</span>&nbsp;<span class="op" id="4623962">:=</span>&nbsp;<span class="num" id="4623965">6</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4623971">if</span>&nbsp;<span class="ident" id="4623974">n</span>&nbsp;<span class="op" id="4623976">&gt;</span>&nbsp;<span class="ident" id="4623978">count</span>&nbsp;<span class="op" id="4623984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4623991">n</span>&nbsp;<span class="op" id="4623993">=</span>&nbsp;<span class="ident" id="4623995">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4624005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624011">codegen</span><span class="op" id="4624018">[</span><span class="ident" id="4624019">outIndex</span><span class="op" id="4624027">]</span>&nbsp;<span class="op" id="4624029">=</span>&nbsp;<span class="num" id="4624031">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624038">outIndex</span><span class="op" id="4624046">++</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624053">codegen</span><span class="op" id="4624060">[</span><span class="ident" id="4624061">outIndex</span><span class="op" id="4624069">]</span>&nbsp;<span class="op" id="4624071">=</span>&nbsp;<span class="builtintype" id="4624073">uint8</span><span class="op" id="4624078">(</span><span class="ident" id="4624079">n</span>&nbsp;<span class="op" id="4624081">-</span>&nbsp;<span class="num" id="4624083">3</span><span class="op" id="4624084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624090">outIndex</span><span class="op" id="4624098">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624105">w</span><span class="op" id="4624106">.</span><span class="ident" id="4624107">codegenFreq</span><span class="op" id="4624118">[</span><span class="num" id="4624119">16</span><span class="op" id="4624121">]</span><span class="op" id="4624122">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624129">count</span>&nbsp;<span class="op" id="4624135">-=</span>&nbsp;<span class="ident" id="4624138">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4624143">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4624147">}</span>&nbsp;<span class="keyword" id="4624149">else</span>&nbsp;<span class="op" id="4624154">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4624159">for</span>&nbsp;<span class="ident" id="4624163">count</span>&nbsp;<span class="op" id="4624169">&gt;=</span>&nbsp;<span class="num" id="4624172">11</span>&nbsp;<span class="op" id="4624175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624181">n</span>&nbsp;<span class="op" id="4624183">:=</span>&nbsp;<span class="num" id="4624186">138</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4624194">if</span>&nbsp;<span class="ident" id="4624197">n</span>&nbsp;<span class="op" id="4624199">&gt;</span>&nbsp;<span class="ident" id="4624201">count</span>&nbsp;<span class="op" id="4624207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624214">n</span>&nbsp;<span class="op" id="4624216">=</span>&nbsp;<span class="ident" id="4624218">count</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4624228">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624234">codegen</span><span class="op" id="4624241">[</span><span class="ident" id="4624242">outIndex</span><span class="op" id="4624250">]</span>&nbsp;<span class="op" id="4624252">=</span>&nbsp;<span class="num" id="4624254">18</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624261">outIndex</span><span class="op" id="4624269">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624276">codegen</span><span class="op" id="4624283">[</span><span class="ident" id="4624284">outIndex</span><span class="op" id="4624292">]</span>&nbsp;<span class="op" id="4624294">=</span>&nbsp;<span class="builtintype" id="4624296">uint8</span><span class="op" id="4624301">(</span><span class="ident" id="4624302">n</span>&nbsp;<span class="op" id="4624304">-</span>&nbsp;<span class="num" id="4624306">11</span><span class="op" id="4624308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624314">outIndex</span><span class="op" id="4624322">++</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624329">w</span><span class="op" id="4624330">.</span><span class="ident" id="4624331">codegenFreq</span><span class="op" id="4624342">[</span><span class="num" id="4624343">18</span><span class="op" id="4624345">]</span><span class="op" id="4624346">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624353">count</span>&nbsp;<span class="op" id="4624359">-=</span>&nbsp;<span class="ident" id="4624362">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4624367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4624372">if</span>&nbsp;<span class="ident" id="4624375">count</span>&nbsp;<span class="op" id="4624381">&gt;=</span>&nbsp;<span class="num" id="4624384">3</span>&nbsp;<span class="op" id="4624386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4624392">//&nbsp;count&nbsp;&gt;=&nbsp;3&nbsp;&amp;&amp;&nbsp;count&nbsp;&lt;=&nbsp;10</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624425">codegen</span><span class="op" id="4624432">[</span><span class="ident" id="4624433">outIndex</span><span class="op" id="4624441">]</span>&nbsp;<span class="op" id="4624443">=</span>&nbsp;<span class="num" id="4624445">17</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624452">outIndex</span><span class="op" id="4624460">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624467">codegen</span><span class="op" id="4624474">[</span><span class="ident" id="4624475">outIndex</span><span class="op" id="4624483">]</span>&nbsp;<span class="op" id="4624485">=</span>&nbsp;<span class="builtintype" id="4624487">uint8</span><span class="op" id="4624492">(</span><span class="ident" id="4624493">count</span>&nbsp;<span class="op" id="4624499">-</span>&nbsp;<span class="num" id="4624501">3</span><span class="op" id="4624502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624508">outIndex</span><span class="op" id="4624516">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624523">w</span><span class="op" id="4624524">.</span><span class="ident" id="4624525">codegenFreq</span><span class="op" id="4624536">[</span><span class="num" id="4624537">17</span><span class="op" id="4624539">]</span><span class="op" id="4624540">++</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624547">count</span>&nbsp;<span class="op" id="4624553">=</span>&nbsp;<span class="num" id="4624555">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4624560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4624564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624568">count</span><span class="op" id="4624573">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4624578">for</span>&nbsp;<span class="op" id="4624582">;</span>&nbsp;<span class="ident" id="4624584">count</span>&nbsp;<span class="op" id="4624590">&gt;=</span>&nbsp;<span class="num" id="4624593">0</span><span class="op" id="4624594">;</span>&nbsp;<span class="ident" id="4624596">count</span><span class="op" id="4624601">--</span>&nbsp;<span class="op" id="4624604">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624609">codegen</span><span class="op" id="4624616">[</span><span class="ident" id="4624617">outIndex</span><span class="op" id="4624625">]</span>&nbsp;<span class="op" id="4624627">=</span>&nbsp;<span class="ident" id="4624629">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624637">outIndex</span><span class="op" id="4624645">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624651">w</span><span class="op" id="4624652">.</span><span class="ident" id="4624653">codegenFreq</span><span class="op" id="4624664">[</span><span class="ident" id="4624665">size</span><span class="op" id="4624669">]</span><span class="op" id="4624670">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4624675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4624679">//&nbsp;Set&nbsp;up&nbsp;invariant&nbsp;for&nbsp;next&nbsp;time&nbsp;through&nbsp;the&nbsp;loop.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624733">size</span>&nbsp;<span class="op" id="4624738">=</span>&nbsp;<span class="ident" id="4624740">nextSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624751">count</span>&nbsp;<span class="op" id="4624757">=</span>&nbsp;<span class="num" id="4624759">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4624762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4624765">//&nbsp;Marker&nbsp;indicating&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;codegen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624811">codegen</span><span class="op" id="4624818">[</span><span class="ident" id="4624819">outIndex</span><span class="op" id="4624827">]</span>&nbsp;<span class="op" id="4624829">=</span>&nbsp;<span class="ident" id="4624831">badCode</span><br>
<span class="lineno">285</span><span class="op" id="4624839">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4624842">func</span>&nbsp;<span class="op" id="4624847">(</span><span class="ident" id="4624848">w</span>&nbsp;<span class="op" id="4624850">*</span><span class="ident" id="4624851">huffmanBitWriter</span><span class="op" id="4624867">)</span>&nbsp;<span class="ident" id="4624869">writeCode</span><span class="op" id="4624878">(</span><span class="ident" id="4624879">code</span>&nbsp;<span class="op" id="4624884">*</span><span class="ident" id="4624885">huffmanEncoder</span><span class="op" id="4624899">,</span>&nbsp;<span class="ident" id="4624901">literal</span>&nbsp;<span class="builtintype" id="4624909">uint32</span><span class="op" id="4624915">)</span>&nbsp;<span class="op" id="4624917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4624920">if</span>&nbsp;<span class="ident" id="4624923">w</span><span class="op" id="4624924">.</span><span class="ident" id="4624925">err</span>&nbsp;<span class="op" id="4624929">!=</span>&nbsp;<span class="ident" id="4624932">nil</span>&nbsp;<span class="op" id="4624936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4624940">return</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4624948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4624951">w</span><span class="op" id="4624952">.</span><span class="ident" id="4624953">writeBits</span><span class="op" id="4624962">(</span><span class="builtintype" id="4624963">int32</span><span class="op" id="4624968">(</span><span class="ident" id="4624969">code</span><span class="op" id="4624973">.</span><span class="ident" id="4624974">code</span><span class="op" id="4624978">[</span><span class="ident" id="4624979">literal</span><span class="op" id="4624986">]</span><span class="op" id="4624987">)</span><span class="op" id="4624988">,</span>&nbsp;<span class="builtintype" id="4624990">int32</span><span class="op" id="4624995">(</span><span class="ident" id="4624996">code</span><span class="op" id="4625000">.</span><span class="ident" id="4625001">codeBits</span><span class="op" id="4625009">[</span><span class="ident" id="4625010">literal</span><span class="op" id="4625017">]</span><span class="op" id="4625018">)</span><span class="op" id="4625019">)</span><br>
<span class="lineno"></span><span class="op" id="4625021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4625024">//&nbsp;Write&nbsp;the&nbsp;header&nbsp;of&nbsp;a&nbsp;dynamic&nbsp;Huffman&nbsp;block&nbsp;to&nbsp;the&nbsp;output&nbsp;stream.</span><br>
<span class="lineno">295</span><span class="comment" id="4625093">//</span><br>
<span class="lineno"></span><span class="comment" id="4625096">//&nbsp;&nbsp;numLiterals&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;literals&nbsp;specified&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="comment" id="4625157">//&nbsp;&nbsp;numOffsets&nbsp;&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;offsets&nbsp;specified&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="comment" id="4625217">//&nbsp;&nbsp;numCodegens&nbsp;&nbsp;The&nbsp;number&nbsp;of&nbsp;codegens&nbsp;used&nbsp;in&nbsp;codegen</span><br>
<span class="lineno"></span><span class="keyword" id="4625273">func</span>&nbsp;<span class="op" id="4625278">(</span><span class="ident" id="4625279">w</span>&nbsp;<span class="op" id="4625281">*</span><span class="ident" id="4625282">huffmanBitWriter</span><span class="op" id="4625298">)</span>&nbsp;<span class="ident" id="4625300">writeDynamicHeader</span><span class="op" id="4625318">(</span><span class="ident" id="4625319">numLiterals</span>&nbsp;<span class="builtintype" id="4625331">int</span><span class="op" id="4625334">,</span>&nbsp;<span class="ident" id="4625336">numOffsets</span>&nbsp;<span class="builtintype" id="4625347">int</span><span class="op" id="4625350">,</span>&nbsp;<span class="ident" id="4625352">numCodegens</span>&nbsp;<span class="builtintype" id="4625364">int</span><span class="op" id="4625367">,</span>&nbsp;<span class="ident" id="4625369">isEof</span>&nbsp;<span class="builtintype" id="4625375">bool</span><span class="op" id="4625379">)</span>&nbsp;<span class="op" id="4625381">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4625384">if</span>&nbsp;<span class="ident" id="4625387">w</span><span class="op" id="4625388">.</span><span class="ident" id="4625389">err</span>&nbsp;<span class="op" id="4625393">!=</span>&nbsp;<span class="ident" id="4625396">nil</span>&nbsp;<span class="op" id="4625400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4625404">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4625412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4625415">var</span>&nbsp;<span class="ident" id="4625419">firstBits</span>&nbsp;<span class="builtintype" id="4625429">int32</span>&nbsp;<span class="op" id="4625435">=</span>&nbsp;<span class="num" id="4625437">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4625440">if</span>&nbsp;<span class="ident" id="4625443">isEof</span>&nbsp;<span class="op" id="4625449">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4625453">firstBits</span>&nbsp;<span class="op" id="4625463">=</span>&nbsp;<span class="num" id="4625465">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4625468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4625471">w</span><span class="op" id="4625472">.</span><span class="ident" id="4625473">writeBits</span><span class="op" id="4625482">(</span><span class="ident" id="4625483">firstBits</span><span class="op" id="4625492">,</span>&nbsp;<span class="num" id="4625494">3</span><span class="op" id="4625495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4625498">w</span><span class="op" id="4625499">.</span><span class="ident" id="4625500">writeBits</span><span class="op" id="4625509">(</span><span class="builtintype" id="4625510">int32</span><span class="op" id="4625515">(</span><span class="ident" id="4625516">numLiterals</span><span class="op" id="4625527">-</span><span class="num" id="4625528">257</span><span class="op" id="4625531">)</span><span class="op" id="4625532">,</span>&nbsp;<span class="num" id="4625534">5</span><span class="op" id="4625535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4625538">w</span><span class="op" id="4625539">.</span><span class="ident" id="4625540">writeBits</span><span class="op" id="4625549">(</span><span class="builtintype" id="4625550">int32</span><span class="op" id="4625555">(</span><span class="ident" id="4625556">numOffsets</span><span class="op" id="4625566">-</span><span class="num" id="4625567">1</span><span class="op" id="4625568">)</span><span class="op" id="4625569">,</span>&nbsp;<span class="num" id="4625571">5</span><span class="op" id="4625572">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4625575">w</span><span class="op" id="4625576">.</span><span class="ident" id="4625577">writeBits</span><span class="op" id="4625586">(</span><span class="builtintype" id="4625587">int32</span><span class="op" id="4625592">(</span><span class="ident" id="4625593">numCodegens</span><span class="op" id="4625604">-</span><span class="num" id="4625605">4</span><span class="op" id="4625606">)</span><span class="op" id="4625607">,</span>&nbsp;<span class="num" id="4625609">4</span><span class="op" id="4625610">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4625614">for</span>&nbsp;<span class="ident" id="4625618">i</span>&nbsp;<span class="op" id="4625620">:=</span>&nbsp;<span class="num" id="4625623">0</span><span class="op" id="4625624">;</span>&nbsp;<span class="ident" id="4625626">i</span>&nbsp;<span class="op" id="4625628">&lt;</span>&nbsp;<span class="ident" id="4625630">numCodegens</span><span class="op" id="4625641">;</span>&nbsp;<span class="ident" id="4625643">i</span><span class="op" id="4625644">++</span>&nbsp;<span class="op" id="4625647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4625651">value</span>&nbsp;<span class="op" id="4625657">:=</span>&nbsp;<span class="ident" id="4625660">w</span><span class="op" id="4625661">.</span><span class="ident" id="4625662">codegenEncoding</span><span class="op" id="4625677">.</span><span class="ident" id="4625678">codeBits</span><span class="op" id="4625686">[</span><span class="ident" id="4625687">codegenOrder</span><span class="op" id="4625699">[</span><span class="ident" id="4625700">i</span><span class="op" id="4625701">]</span><span class="op" id="4625702">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4625706">w</span><span class="op" id="4625707">.</span><span class="ident" id="4625708">writeBits</span><span class="op" id="4625717">(</span><span class="builtintype" id="4625718">int32</span><span class="op" id="4625723">(</span><span class="ident" id="4625724">value</span><span class="op" id="4625729">)</span><span class="op" id="4625730">,</span>&nbsp;<span class="num" id="4625732">3</span><span class="op" id="4625733">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4625736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4625740">i</span>&nbsp;<span class="op" id="4625742">:=</span>&nbsp;<span class="num" id="4625745">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4625748">for</span>&nbsp;<span class="op" id="4625752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4625756">var</span>&nbsp;<span class="ident" id="4625760">codeWord</span>&nbsp;<span class="builtintype" id="4625769">int</span>&nbsp;<span class="op" id="4625773">=</span>&nbsp;<span class="builtintype" id="4625775">int</span><span class="op" id="4625778">(</span><span class="ident" id="4625779">w</span><span class="op" id="4625780">.</span><span class="ident" id="4625781">codegen</span><span class="op" id="4625788">[</span><span class="ident" id="4625789">i</span><span class="op" id="4625790">]</span><span class="op" id="4625791">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4625795">i</span><span class="op" id="4625796">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4625801">if</span>&nbsp;<span class="ident" id="4625804">codeWord</span>&nbsp;<span class="op" id="4625813">==</span>&nbsp;<span class="ident" id="4625816">badCode</span>&nbsp;<span class="op" id="4625824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4625829">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4625837">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4625841">//&nbsp;The&nbsp;low&nbsp;byte&nbsp;contains&nbsp;the&nbsp;actual&nbsp;code&nbsp;to&nbsp;generate.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4625897">w</span><span class="op" id="4625898">.</span><span class="ident" id="4625899">writeCode</span><span class="op" id="4625908">(</span><span class="ident" id="4625909">w</span><span class="op" id="4625910">.</span><span class="ident" id="4625911">codegenEncoding</span><span class="op" id="4625926">,</span>&nbsp;<span class="builtintype" id="4625928">uint32</span><span class="op" id="4625934">(</span><span class="ident" id="4625935">codeWord</span><span class="op" id="4625943">)</span><span class="op" id="4625944">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4625949">switch</span>&nbsp;<span class="ident" id="4625956">codeWord</span>&nbsp;<span class="op" id="4625965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4625969">case</span>&nbsp;<span class="num" id="4625974">16</span><span class="op" id="4625976">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4625981">w</span><span class="op" id="4625982">.</span><span class="ident" id="4625983">writeBits</span><span class="op" id="4625992">(</span><span class="builtintype" id="4625993">int32</span><span class="op" id="4625998">(</span><span class="ident" id="4625999">w</span><span class="op" id="4626000">.</span><span class="ident" id="4626001">codegen</span><span class="op" id="4626008">[</span><span class="ident" id="4626009">i</span><span class="op" id="4626010">]</span><span class="op" id="4626011">)</span><span class="op" id="4626012">,</span>&nbsp;<span class="num" id="4626014">2</span><span class="op" id="4626015">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4626020">i</span><span class="op" id="4626021">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4626027">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4626035">case</span>&nbsp;<span class="num" id="4626040">17</span><span class="op" id="4626042">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4626047">w</span><span class="op" id="4626048">.</span><span class="ident" id="4626049">writeBits</span><span class="op" id="4626058">(</span><span class="builtintype" id="4626059">int32</span><span class="op" id="4626064">(</span><span class="ident" id="4626065">w</span><span class="op" id="4626066">.</span><span class="ident" id="4626067">codegen</span><span class="op" id="4626074">[</span><span class="ident" id="4626075">i</span><span class="op" id="4626076">]</span><span class="op" id="4626077">)</span><span class="op" id="4626078">,</span>&nbsp;<span class="num" id="4626080">3</span><span class="op" id="4626081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4626086">i</span><span class="op" id="4626087">++</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4626093">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4626101">case</span>&nbsp;<span class="num" id="4626106">18</span><span class="op" id="4626108">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4626113">w</span><span class="op" id="4626114">.</span><span class="ident" id="4626115">writeBits</span><span class="op" id="4626124">(</span><span class="builtintype" id="4626125">int32</span><span class="op" id="4626130">(</span><span class="ident" id="4626131">w</span><span class="op" id="4626132">.</span><span class="ident" id="4626133">codegen</span><span class="op" id="4626140">[</span><span class="ident" id="4626141">i</span><span class="op" id="4626142">]</span><span class="op" id="4626143">)</span><span class="op" id="4626144">,</span>&nbsp;<span class="num" id="4626146">7</span><span class="op" id="4626147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4626152">i</span><span class="op" id="4626153">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4626159">break</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4626167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4626170">}</span><br>
<span class="lineno"></span><span class="op" id="4626172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4626175">func</span>&nbsp;<span class="op" id="4626180">(</span><span class="ident" id="4626181">w</span>&nbsp;<span class="op" id="4626183">*</span><span class="ident" id="4626184">huffmanBitWriter</span><span class="op" id="4626200">)</span>&nbsp;<span class="ident" id="4626202">writeStoredHeader</span><span class="op" id="4626219">(</span><span class="ident" id="4626220">length</span>&nbsp;<span class="builtintype" id="4626227">int</span><span class="op" id="4626230">,</span>&nbsp;<span class="ident" id="4626232">isEof</span>&nbsp;<span class="builtintype" id="4626238">bool</span><span class="op" id="4626242">)</span>&nbsp;<span class="op" id="4626244">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4626247">if</span>&nbsp;<span class="ident" id="4626250">w</span><span class="op" id="4626251">.</span><span class="ident" id="4626252">err</span>&nbsp;<span class="op" id="4626256">!=</span>&nbsp;<span class="ident" id="4626259">nil</span>&nbsp;<span class="op" id="4626263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4626267">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4626275">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4626278">var</span>&nbsp;<span class="ident" id="4626282">flag</span>&nbsp;<span class="builtintype" id="4626287">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4626294">if</span>&nbsp;<span class="ident" id="4626297">isEof</span>&nbsp;<span class="op" id="4626303">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4626307">flag</span>&nbsp;<span class="op" id="4626312">=</span>&nbsp;<span class="num" id="4626314">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4626317">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4626320">w</span><span class="op" id="4626321">.</span><span class="ident" id="4626322">writeBits</span><span class="op" id="4626331">(</span><span class="ident" id="4626332">flag</span><span class="op" id="4626336">,</span>&nbsp;<span class="num" id="4626338">3</span><span class="op" id="4626339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4626342">w</span><span class="op" id="4626343">.</span><span class="ident" id="4626344">flush</span><span class="op" id="4626349">(</span><span class="op" id="4626350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4626353">w</span><span class="op" id="4626354">.</span><span class="ident" id="4626355">writeBits</span><span class="op" id="4626364">(</span><span class="builtintype" id="4626365">int32</span><span class="op" id="4626370">(</span><span class="ident" id="4626371">length</span><span class="op" id="4626377">)</span><span class="op" id="4626378">,</span>&nbsp;<span class="num" id="4626380">16</span><span class="op" id="4626382">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4626385">w</span><span class="op" id="4626386">.</span><span class="ident" id="4626387">writeBits</span><span class="op" id="4626396">(</span><span class="builtintype" id="4626397">int32</span><span class="op" id="4626402">(</span><span class="op" id="4626403">^</span><span class="builtintype" id="4626404">uint16</span><span class="op" id="4626410">(</span><span class="ident" id="4626411">length</span><span class="op" id="4626417">)</span><span class="op" id="4626418">)</span><span class="op" id="4626419">,</span>&nbsp;<span class="num" id="4626421">16</span><span class="op" id="4626423">)</span><br>
<span class="lineno"></span><span class="op" id="4626425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4626428">func</span>&nbsp;<span class="op" id="4626433">(</span><span class="ident" id="4626434">w</span>&nbsp;<span class="op" id="4626436">*</span><span class="ident" id="4626437">huffmanBitWriter</span><span class="op" id="4626453">)</span>&nbsp;<span class="ident" id="4626455">writeFixedHeader</span><span class="op" id="4626471">(</span><span class="ident" id="4626472">isEof</span>&nbsp;<span class="builtintype" id="4626478">bool</span><span class="op" id="4626482">)</span>&nbsp;<span class="op" id="4626484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4626487">if</span>&nbsp;<span class="ident" id="4626490">w</span><span class="op" id="4626491">.</span><span class="ident" id="4626492">err</span>&nbsp;<span class="op" id="4626496">!=</span>&nbsp;<span class="ident" id="4626499">nil</span>&nbsp;<span class="op" id="4626503">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4626507">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4626515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4626518">//&nbsp;Indicate&nbsp;that&nbsp;we&nbsp;are&nbsp;a&nbsp;fixed&nbsp;Huffman&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4626565">var</span>&nbsp;<span class="ident" id="4626569">value</span>&nbsp;<span class="builtintype" id="4626575">int32</span>&nbsp;<span class="op" id="4626581">=</span>&nbsp;<span class="num" id="4626583">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4626586">if</span>&nbsp;<span class="ident" id="4626589">isEof</span>&nbsp;<span class="op" id="4626595">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4626599">value</span>&nbsp;<span class="op" id="4626605">=</span>&nbsp;<span class="num" id="4626607">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4626610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4626613">w</span><span class="op" id="4626614">.</span><span class="ident" id="4626615">writeBits</span><span class="op" id="4626624">(</span><span class="ident" id="4626625">value</span><span class="op" id="4626630">,</span>&nbsp;<span class="num" id="4626632">3</span><span class="op" id="4626633">)</span><br>
<span class="lineno"></span><span class="op" id="4626635">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="keyword" id="4626638">func</span>&nbsp;<span class="op" id="4626643">(</span><span class="ident" id="4626644">w</span>&nbsp;<span class="op" id="4626646">*</span><span class="ident" id="4626647">huffmanBitWriter</span><span class="op" id="4626663">)</span>&nbsp;<span class="ident" id="4626665">writeBlock</span><span class="op" id="4626675">(</span><span class="ident" id="4626676">tokens</span>&nbsp;<span class="op" id="4626683">[</span><span class="op" id="4626684">]</span><span class="ident" id="4626685">token</span><span class="op" id="4626690">,</span>&nbsp;<span class="ident" id="4626692">eof</span>&nbsp;<span class="builtintype" id="4626696">bool</span><span class="op" id="4626700">,</span>&nbsp;<span class="ident" id="4626702">input</span>&nbsp;<span class="op" id="4626708">[</span><span class="op" id="4626709">]</span><span class="builtintype" id="4626710">byte</span><span class="op" id="4626714">)</span>&nbsp;<span class="op" id="4626716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4626719">if</span>&nbsp;<span class="ident" id="4626722">w</span><span class="op" id="4626723">.</span><span class="ident" id="4626724">err</span>&nbsp;<span class="op" id="4626728">!=</span>&nbsp;<span class="ident" id="4626731">nil</span>&nbsp;<span class="op" id="4626735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4626739">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4626747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4626750">for</span>&nbsp;<span class="ident" id="4626754">i</span>&nbsp;<span class="op" id="4626756">:=</span>&nbsp;<span class="keyword" id="4626759">range</span>&nbsp;<span class="ident" id="4626765">w</span><span class="op" id="4626766">.</span><span class="ident" id="4626767">literalFreq</span>&nbsp;<span class="op" id="4626779">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4626783">w</span><span class="op" id="4626784">.</span><span class="ident" id="4626785">literalFreq</span><span class="op" id="4626796">[</span><span class="ident" id="4626797">i</span><span class="op" id="4626798">]</span>&nbsp;<span class="op" id="4626800">=</span>&nbsp;<span class="num" id="4626802">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4626805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4626808">for</span>&nbsp;<span class="ident" id="4626812">i</span>&nbsp;<span class="op" id="4626814">:=</span>&nbsp;<span class="keyword" id="4626817">range</span>&nbsp;<span class="ident" id="4626823">w</span><span class="op" id="4626824">.</span><span class="ident" id="4626825">offsetFreq</span>&nbsp;<span class="op" id="4626836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4626840">w</span><span class="op" id="4626841">.</span><span class="ident" id="4626842">offsetFreq</span><span class="op" id="4626852">[</span><span class="ident" id="4626853">i</span><span class="op" id="4626854">]</span>&nbsp;<span class="op" id="4626856">=</span>&nbsp;<span class="num" id="4626858">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4626861">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4626865">n</span>&nbsp;<span class="op" id="4626867">:=</span>&nbsp;<span class="builtinfunc" id="4626870">len</span><span class="op" id="4626873">(</span><span class="ident" id="4626874">tokens</span><span class="op" id="4626880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4626883">tokens</span>&nbsp;<span class="op" id="4626890">=</span>&nbsp;<span class="ident" id="4626892">tokens</span><span class="op" id="4626898">[</span><span class="num" id="4626899">0</span>&nbsp;<span class="op" id="4626901">:</span>&nbsp;<span class="ident" id="4626903">n</span><span class="op" id="4626904">+</span><span class="num" id="4626905">1</span><span class="op" id="4626906">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4626909">tokens</span><span class="op" id="4626915">[</span><span class="ident" id="4626916">n</span><span class="op" id="4626917">]</span>&nbsp;<span class="op" id="4626919">=</span>&nbsp;<span class="ident" id="4626921">endBlockMarker</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4626938">for</span>&nbsp;<span class="ident" id="4626942">_</span><span class="op" id="4626943">,</span>&nbsp;<span class="ident" id="4626945">t</span>&nbsp;<span class="op" id="4626947">:=</span>&nbsp;<span class="keyword" id="4626950">range</span>&nbsp;<span class="ident" id="4626956">tokens</span>&nbsp;<span class="op" id="4626963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4626967">switch</span>&nbsp;<span class="ident" id="4626974">t</span><span class="op" id="4626975">.</span><span class="ident" id="4626976">typ</span><span class="op" id="4626979">(</span><span class="op" id="4626980">)</span>&nbsp;<span class="op" id="4626982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4626986">case</span>&nbsp;<span class="ident" id="4626991">literalType</span><span class="op" id="4627002">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627007">w</span><span class="op" id="4627008">.</span><span class="ident" id="4627009">literalFreq</span><span class="op" id="4627020">[</span><span class="ident" id="4627021">t</span><span class="op" id="4627022">.</span><span class="ident" id="4627023">literal</span><span class="op" id="4627030">(</span><span class="op" id="4627031">)</span><span class="op" id="4627032">]</span><span class="op" id="4627033">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4627038">case</span>&nbsp;<span class="ident" id="4627043">matchType</span><span class="op" id="4627052">:</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627057">length</span>&nbsp;<span class="op" id="4627064">:=</span>&nbsp;<span class="ident" id="4627067">t</span><span class="op" id="4627068">.</span><span class="ident" id="4627069">length</span><span class="op" id="4627075">(</span><span class="op" id="4627076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627081">offset</span>&nbsp;<span class="op" id="4627088">:=</span>&nbsp;<span class="ident" id="4627091">t</span><span class="op" id="4627092">.</span><span class="ident" id="4627093">offset</span><span class="op" id="4627099">(</span><span class="op" id="4627100">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627105">w</span><span class="op" id="4627106">.</span><span class="ident" id="4627107">literalFreq</span><span class="op" id="4627118">[</span><span class="ident" id="4627119">lengthCodesStart</span><span class="op" id="4627135">+</span><span class="ident" id="4627136">lengthCode</span><span class="op" id="4627146">(</span><span class="ident" id="4627147">length</span><span class="op" id="4627153">)</span><span class="op" id="4627154">]</span><span class="op" id="4627155">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627161">w</span><span class="op" id="4627162">.</span><span class="ident" id="4627163">offsetFreq</span><span class="op" id="4627173">[</span><span class="ident" id="4627174">offsetCode</span><span class="op" id="4627184">(</span><span class="ident" id="4627185">offset</span><span class="op" id="4627191">)</span><span class="op" id="4627192">]</span><span class="op" id="4627193">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4627198">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4627201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4627205">//&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;literals</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627236">numLiterals</span>&nbsp;<span class="op" id="4627248">:=</span>&nbsp;<span class="builtinfunc" id="4627251">len</span><span class="op" id="4627254">(</span><span class="ident" id="4627255">w</span><span class="op" id="4627256">.</span><span class="ident" id="4627257">literalFreq</span><span class="op" id="4627268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4627271">for</span>&nbsp;<span class="ident" id="4627275">w</span><span class="op" id="4627276">.</span><span class="ident" id="4627277">literalFreq</span><span class="op" id="4627288">[</span><span class="ident" id="4627289">numLiterals</span><span class="op" id="4627300">-</span><span class="num" id="4627301">1</span><span class="op" id="4627302">]</span>&nbsp;<span class="op" id="4627304">==</span>&nbsp;<span class="num" id="4627307">0</span>&nbsp;<span class="op" id="4627309">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627313">numLiterals</span><span class="op" id="4627324">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4627328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4627331">//&nbsp;get&nbsp;the&nbsp;number&nbsp;of&nbsp;offsets</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627361">numOffsets</span>&nbsp;<span class="op" id="4627372">:=</span>&nbsp;<span class="builtinfunc" id="4627375">len</span><span class="op" id="4627378">(</span><span class="ident" id="4627379">w</span><span class="op" id="4627380">.</span><span class="ident" id="4627381">offsetFreq</span><span class="op" id="4627391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4627394">for</span>&nbsp;<span class="ident" id="4627398">numOffsets</span>&nbsp;<span class="op" id="4627409">&gt;</span>&nbsp;<span class="num" id="4627411">0</span>&nbsp;<span class="op" id="4627413">&amp;&amp;</span>&nbsp;<span class="ident" id="4627416">w</span><span class="op" id="4627417">.</span><span class="ident" id="4627418">offsetFreq</span><span class="op" id="4627428">[</span><span class="ident" id="4627429">numOffsets</span><span class="op" id="4627439">-</span><span class="num" id="4627440">1</span><span class="op" id="4627441">]</span>&nbsp;<span class="op" id="4627443">==</span>&nbsp;<span class="num" id="4627446">0</span>&nbsp;<span class="op" id="4627448">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627452">numOffsets</span><span class="op" id="4627462">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4627466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4627469">if</span>&nbsp;<span class="ident" id="4627472">numOffsets</span>&nbsp;<span class="op" id="4627483">==</span>&nbsp;<span class="num" id="4627486">0</span>&nbsp;<span class="op" id="4627488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4627492">//&nbsp;We&nbsp;haven&#39;t&nbsp;found&nbsp;a&nbsp;single&nbsp;match.&nbsp;If&nbsp;we&nbsp;want&nbsp;to&nbsp;go&nbsp;with&nbsp;the&nbsp;dynamic&nbsp;encoding,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4627574">//&nbsp;we&nbsp;should&nbsp;count&nbsp;at&nbsp;least&nbsp;one&nbsp;offset&nbsp;to&nbsp;be&nbsp;sure&nbsp;that&nbsp;the&nbsp;offset&nbsp;huffman&nbsp;tree&nbsp;could&nbsp;be&nbsp;encoded.</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627673">w</span><span class="op" id="4627674">.</span><span class="ident" id="4627675">offsetFreq</span><span class="op" id="4627685">[</span><span class="num" id="4627686">0</span><span class="op" id="4627687">]</span>&nbsp;<span class="op" id="4627689">=</span>&nbsp;<span class="num" id="4627691">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627695">numOffsets</span>&nbsp;<span class="op" id="4627706">=</span>&nbsp;<span class="num" id="4627708">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4627711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627715">w</span><span class="op" id="4627716">.</span><span class="ident" id="4627717">literalEncoding</span><span class="op" id="4627732">.</span><span class="ident" id="4627733">generate</span><span class="op" id="4627741">(</span><span class="ident" id="4627742">w</span><span class="op" id="4627743">.</span><span class="ident" id="4627744">literalFreq</span><span class="op" id="4627755">,</span>&nbsp;<span class="num" id="4627757">15</span><span class="op" id="4627759">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627762">w</span><span class="op" id="4627763">.</span><span class="ident" id="4627764">offsetEncoding</span><span class="op" id="4627778">.</span><span class="ident" id="4627779">generate</span><span class="op" id="4627787">(</span><span class="ident" id="4627788">w</span><span class="op" id="4627789">.</span><span class="ident" id="4627790">offsetFreq</span><span class="op" id="4627800">,</span>&nbsp;<span class="num" id="4627802">15</span><span class="op" id="4627804">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627808">storedBytes</span>&nbsp;<span class="op" id="4627820">:=</span>&nbsp;<span class="num" id="4627823">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4627826">if</span>&nbsp;<span class="ident" id="4627829">input</span>&nbsp;<span class="op" id="4627835">!=</span>&nbsp;<span class="ident" id="4627838">nil</span>&nbsp;<span class="op" id="4627842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627846">storedBytes</span>&nbsp;<span class="op" id="4627858">=</span>&nbsp;<span class="builtinfunc" id="4627860">len</span><span class="op" id="4627863">(</span><span class="ident" id="4627864">input</span><span class="op" id="4627869">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4627872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4627875">var</span>&nbsp;<span class="ident" id="4627879">extraBits</span>&nbsp;<span class="ident" id="4627889">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4627896">var</span>&nbsp;<span class="ident" id="4627900">storedSize</span>&nbsp;<span class="ident" id="4627911">int64</span>&nbsp;<span class="op" id="4627917">=</span>&nbsp;<span class="ident" id="4627919">math</span><span class="op" id="4627923">.</span><span class="ident" id="4627924">MaxInt64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4627934">if</span>&nbsp;<span class="ident" id="4627937">storedBytes</span>&nbsp;<span class="op" id="4627949">&lt;=</span>&nbsp;<span class="ident" id="4627952">maxStoreBlockSize</span>&nbsp;<span class="op" id="4627970">&amp;&amp;</span>&nbsp;<span class="ident" id="4627973">input</span>&nbsp;<span class="op" id="4627979">!=</span>&nbsp;<span class="ident" id="4627982">nil</span>&nbsp;<span class="op" id="4627986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4627990">storedSize</span>&nbsp;<span class="op" id="4628001">=</span>&nbsp;<span class="ident" id="4628003">int64</span><span class="op" id="4628008">(</span><span class="op" id="4628009">(</span><span class="ident" id="4628010">storedBytes</span>&nbsp;<span class="op" id="4628022">+</span>&nbsp;<span class="num" id="4628024">5</span><span class="op" id="4628025">)</span>&nbsp;<span class="op" id="4628027">*</span>&nbsp;<span class="num" id="4628029">8</span><span class="op" id="4628030">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4628034">//&nbsp;We&nbsp;only&nbsp;bother&nbsp;calculating&nbsp;the&nbsp;costs&nbsp;of&nbsp;the&nbsp;extra&nbsp;bits&nbsp;required&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4628106">//&nbsp;the&nbsp;length&nbsp;of&nbsp;offset&nbsp;fields&nbsp;(which&nbsp;will&nbsp;be&nbsp;the&nbsp;same&nbsp;for&nbsp;both&nbsp;fixed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4628178">//&nbsp;and&nbsp;dynamic&nbsp;encoding),&nbsp;if&nbsp;we&nbsp;need&nbsp;to&nbsp;compare&nbsp;those&nbsp;two&nbsp;encodings</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4628248">//&nbsp;against&nbsp;stored&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628278">for</span>&nbsp;<span class="ident" id="4628282">lengthCode</span>&nbsp;<span class="op" id="4628293">:=</span>&nbsp;<span class="ident" id="4628296">lengthCodesStart</span>&nbsp;<span class="op" id="4628313">+</span>&nbsp;<span class="num" id="4628315">8</span><span class="op" id="4628316">;</span>&nbsp;<span class="ident" id="4628318">lengthCode</span>&nbsp;<span class="op" id="4628329">&lt;</span>&nbsp;<span class="ident" id="4628331">numLiterals</span><span class="op" id="4628342">;</span>&nbsp;<span class="ident" id="4628344">lengthCode</span><span class="op" id="4628354">++</span>&nbsp;<span class="op" id="4628357">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4628362">//&nbsp;First&nbsp;eight&nbsp;length&nbsp;codes&nbsp;have&nbsp;extra&nbsp;size&nbsp;=&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4628414">extraBits</span>&nbsp;<span class="op" id="4628424">+=</span>&nbsp;<span class="ident" id="4628427">int64</span><span class="op" id="4628432">(</span><span class="ident" id="4628433">w</span><span class="op" id="4628434">.</span><span class="ident" id="4628435">literalFreq</span><span class="op" id="4628446">[</span><span class="ident" id="4628447">lengthCode</span><span class="op" id="4628457">]</span><span class="op" id="4628458">)</span>&nbsp;<span class="op" id="4628460">*</span>&nbsp;<span class="ident" id="4628462">int64</span><span class="op" id="4628467">(</span><span class="ident" id="4628468">lengthExtraBits</span><span class="op" id="4628483">[</span><span class="ident" id="4628484">lengthCode</span><span class="op" id="4628494">-</span><span class="ident" id="4628495">lengthCodesStart</span><span class="op" id="4628511">]</span><span class="op" id="4628512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4628516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628520">for</span>&nbsp;<span class="ident" id="4628524">offsetCode</span>&nbsp;<span class="op" id="4628535">:=</span>&nbsp;<span class="num" id="4628538">4</span><span class="op" id="4628539">;</span>&nbsp;<span class="ident" id="4628541">offsetCode</span>&nbsp;<span class="op" id="4628552">&lt;</span>&nbsp;<span class="ident" id="4628554">numOffsets</span><span class="op" id="4628564">;</span>&nbsp;<span class="ident" id="4628566">offsetCode</span><span class="op" id="4628576">++</span>&nbsp;<span class="op" id="4628579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4628584">//&nbsp;First&nbsp;four&nbsp;offset&nbsp;codes&nbsp;have&nbsp;extra&nbsp;size&nbsp;=&nbsp;0.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4628635">extraBits</span>&nbsp;<span class="op" id="4628645">+=</span>&nbsp;<span class="ident" id="4628648">int64</span><span class="op" id="4628653">(</span><span class="ident" id="4628654">w</span><span class="op" id="4628655">.</span><span class="ident" id="4628656">offsetFreq</span><span class="op" id="4628666">[</span><span class="ident" id="4628667">offsetCode</span><span class="op" id="4628677">]</span><span class="op" id="4628678">)</span>&nbsp;<span class="op" id="4628680">*</span>&nbsp;<span class="ident" id="4628682">int64</span><span class="op" id="4628687">(</span><span class="ident" id="4628688">offsetExtraBits</span><span class="op" id="4628703">[</span><span class="ident" id="4628704">offsetCode</span><span class="op" id="4628714">]</span><span class="op" id="4628715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4628719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4628722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4628726">//&nbsp;Figure&nbsp;out&nbsp;smallest&nbsp;code.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4628756">//&nbsp;Fixed&nbsp;Huffman&nbsp;baseline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628784">var</span>&nbsp;<span class="ident" id="4628788">size</span>&nbsp;<span class="op" id="4628793">=</span>&nbsp;<span class="ident" id="4628795">int64</span><span class="op" id="4628800">(</span><span class="num" id="4628801">3</span><span class="op" id="4628802">)</span>&nbsp;<span class="op" id="4628804">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4628808">fixedLiteralEncoding</span><span class="op" id="4628828">.</span><span class="ident" id="4628829">bitLength</span><span class="op" id="4628838">(</span><span class="ident" id="4628839">w</span><span class="op" id="4628840">.</span><span class="ident" id="4628841">literalFreq</span><span class="op" id="4628852">)</span>&nbsp;<span class="op" id="4628854">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4628858">fixedOffsetEncoding</span><span class="op" id="4628877">.</span><span class="ident" id="4628878">bitLength</span><span class="op" id="4628887">(</span><span class="ident" id="4628888">w</span><span class="op" id="4628889">.</span><span class="ident" id="4628890">offsetFreq</span><span class="op" id="4628900">)</span>&nbsp;<span class="op" id="4628902">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4628906">extraBits</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628917">var</span>&nbsp;<span class="ident" id="4628921">literalEncoding</span>&nbsp;<span class="op" id="4628937">=</span>&nbsp;<span class="ident" id="4628939">fixedLiteralEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4628961">var</span>&nbsp;<span class="ident" id="4628965">offsetEncoding</span>&nbsp;<span class="op" id="4628980">=</span>&nbsp;<span class="ident" id="4628982">fixedOffsetEncoding</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4629004">//&nbsp;Dynamic&nbsp;Huffman?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4629025">var</span>&nbsp;<span class="ident" id="4629029">numCodegens</span>&nbsp;<span class="builtintype" id="4629041">int</span><br>
<span class="lineno">450</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4629047">//&nbsp;Generate&nbsp;codegen&nbsp;and&nbsp;codegenFrequencies,&nbsp;which&nbsp;indicates&nbsp;how&nbsp;to&nbsp;encode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4629122">//&nbsp;the&nbsp;literalEncoding&nbsp;and&nbsp;the&nbsp;offsetEncoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629170">w</span><span class="op" id="4629171">.</span><span class="ident" id="4629172">generateCodegen</span><span class="op" id="4629187">(</span><span class="ident" id="4629188">numLiterals</span><span class="op" id="4629199">,</span>&nbsp;<span class="ident" id="4629201">numOffsets</span><span class="op" id="4629211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629214">w</span><span class="op" id="4629215">.</span><span class="ident" id="4629216">codegenEncoding</span><span class="op" id="4629231">.</span><span class="ident" id="4629232">generate</span><span class="op" id="4629240">(</span><span class="ident" id="4629241">w</span><span class="op" id="4629242">.</span><span class="ident" id="4629243">codegenFreq</span><span class="op" id="4629254">,</span>&nbsp;<span class="num" id="4629256">7</span><span class="op" id="4629257">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629260">numCodegens</span>&nbsp;<span class="op" id="4629272">=</span>&nbsp;<span class="builtinfunc" id="4629274">len</span><span class="op" id="4629277">(</span><span class="ident" id="4629278">w</span><span class="op" id="4629279">.</span><span class="ident" id="4629280">codegenFreq</span><span class="op" id="4629291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4629294">for</span>&nbsp;<span class="ident" id="4629298">numCodegens</span>&nbsp;<span class="op" id="4629310">&gt;</span>&nbsp;<span class="num" id="4629312">4</span>&nbsp;<span class="op" id="4629314">&amp;&amp;</span>&nbsp;<span class="ident" id="4629317">w</span><span class="op" id="4629318">.</span><span class="ident" id="4629319">codegenFreq</span><span class="op" id="4629330">[</span><span class="ident" id="4629331">codegenOrder</span><span class="op" id="4629343">[</span><span class="ident" id="4629344">numCodegens</span><span class="op" id="4629355">-</span><span class="num" id="4629356">1</span><span class="op" id="4629357">]</span><span class="op" id="4629358">]</span>&nbsp;<span class="op" id="4629360">==</span>&nbsp;<span class="num" id="4629363">0</span>&nbsp;<span class="op" id="4629365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629369">numCodegens</span><span class="op" id="4629380">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4629384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629387">dynamicHeader</span>&nbsp;<span class="op" id="4629401">:=</span>&nbsp;<span class="ident" id="4629404">int64</span><span class="op" id="4629409">(</span><span class="num" id="4629410">3</span><span class="op" id="4629411">+</span><span class="num" id="4629412">5</span><span class="op" id="4629413">+</span><span class="num" id="4629414">5</span><span class="op" id="4629415">+</span><span class="num" id="4629416">4</span><span class="op" id="4629417">+</span><span class="op" id="4629418">(</span><span class="num" id="4629419">3</span><span class="op" id="4629420">*</span><span class="ident" id="4629421">numCodegens</span><span class="op" id="4629432">)</span><span class="op" id="4629433">)</span>&nbsp;<span class="op" id="4629435">+</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629439">w</span><span class="op" id="4629440">.</span><span class="ident" id="4629441">codegenEncoding</span><span class="op" id="4629456">.</span><span class="ident" id="4629457">bitLength</span><span class="op" id="4629466">(</span><span class="ident" id="4629467">w</span><span class="op" id="4629468">.</span><span class="ident" id="4629469">codegenFreq</span><span class="op" id="4629480">)</span>&nbsp;<span class="op" id="4629482">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629486">int64</span><span class="op" id="4629491">(</span><span class="ident" id="4629492">extraBits</span><span class="op" id="4629501">)</span>&nbsp;<span class="op" id="4629503">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629507">int64</span><span class="op" id="4629512">(</span><span class="ident" id="4629513">w</span><span class="op" id="4629514">.</span><span class="ident" id="4629515">codegenFreq</span><span class="op" id="4629526">[</span><span class="num" id="4629527">16</span><span class="op" id="4629529">]</span><span class="op" id="4629530">*</span><span class="num" id="4629531">2</span><span class="op" id="4629532">)</span>&nbsp;<span class="op" id="4629534">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629538">int64</span><span class="op" id="4629543">(</span><span class="ident" id="4629544">w</span><span class="op" id="4629545">.</span><span class="ident" id="4629546">codegenFreq</span><span class="op" id="4629557">[</span><span class="num" id="4629558">17</span><span class="op" id="4629560">]</span><span class="op" id="4629561">*</span><span class="num" id="4629562">3</span><span class="op" id="4629563">)</span>&nbsp;<span class="op" id="4629565">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629569">int64</span><span class="op" id="4629574">(</span><span class="ident" id="4629575">w</span><span class="op" id="4629576">.</span><span class="ident" id="4629577">codegenFreq</span><span class="op" id="4629588">[</span><span class="num" id="4629589">18</span><span class="op" id="4629591">]</span><span class="op" id="4629592">*</span><span class="num" id="4629593">7</span><span class="op" id="4629594">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629597">dynamicSize</span>&nbsp;<span class="op" id="4629609">:=</span>&nbsp;<span class="ident" id="4629612">dynamicHeader</span>&nbsp;<span class="op" id="4629626">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629630">w</span><span class="op" id="4629631">.</span><span class="ident" id="4629632">literalEncoding</span><span class="op" id="4629647">.</span><span class="ident" id="4629648">bitLength</span><span class="op" id="4629657">(</span><span class="ident" id="4629658">w</span><span class="op" id="4629659">.</span><span class="ident" id="4629660">literalFreq</span><span class="op" id="4629671">)</span>&nbsp;<span class="op" id="4629673">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629677">w</span><span class="op" id="4629678">.</span><span class="ident" id="4629679">offsetEncoding</span><span class="op" id="4629693">.</span><span class="ident" id="4629694">bitLength</span><span class="op" id="4629703">(</span><span class="ident" id="4629704">w</span><span class="op" id="4629705">.</span><span class="ident" id="4629706">offsetFreq</span><span class="op" id="4629716">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4629720">if</span>&nbsp;<span class="ident" id="4629723">dynamicSize</span>&nbsp;<span class="op" id="4629735">&lt;</span>&nbsp;<span class="ident" id="4629737">size</span>&nbsp;<span class="op" id="4629742">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629746">size</span>&nbsp;<span class="op" id="4629751">=</span>&nbsp;<span class="ident" id="4629753">dynamicSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629767">literalEncoding</span>&nbsp;<span class="op" id="4629783">=</span>&nbsp;<span class="ident" id="4629785">w</span><span class="op" id="4629786">.</span><span class="ident" id="4629787">literalEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629805">offsetEncoding</span>&nbsp;<span class="op" id="4629820">=</span>&nbsp;<span class="ident" id="4629822">w</span><span class="op" id="4629823">.</span><span class="ident" id="4629824">offsetEncoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4629840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4629844">//&nbsp;Stored&nbsp;bytes?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4629862">if</span>&nbsp;<span class="ident" id="4629865">storedSize</span>&nbsp;<span class="op" id="4629876">&lt;</span>&nbsp;<span class="ident" id="4629878">size</span>&nbsp;<span class="op" id="4629883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629887">w</span><span class="op" id="4629888">.</span><span class="ident" id="4629889">writeStoredHeader</span><span class="op" id="4629906">(</span><span class="ident" id="4629907">storedBytes</span><span class="op" id="4629918">,</span>&nbsp;<span class="ident" id="4629920">eof</span><span class="op" id="4629923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4629927">w</span><span class="op" id="4629928">.</span><span class="ident" id="4629929">writeBytes</span><span class="op" id="4629939">(</span><span class="ident" id="4629940">input</span><span class="op" id="4629945">[</span><span class="num" id="4629946">0</span><span class="op" id="4629947">:</span><span class="ident" id="4629948">storedBytes</span><span class="op" id="4629959">]</span><span class="op" id="4629960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4629964">return</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4629972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4629976">//&nbsp;Huffman.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4629989">if</span>&nbsp;<span class="ident" id="4629992">literalEncoding</span>&nbsp;<span class="op" id="4630008">==</span>&nbsp;<span class="ident" id="4630011">fixedLiteralEncoding</span>&nbsp;<span class="op" id="4630032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630036">w</span><span class="op" id="4630037">.</span><span class="ident" id="4630038">writeFixedHeader</span><span class="op" id="4630054">(</span><span class="ident" id="4630055">eof</span><span class="op" id="4630058">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4630061">}</span>&nbsp;<span class="keyword" id="4630063">else</span>&nbsp;<span class="op" id="4630068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630072">w</span><span class="op" id="4630073">.</span><span class="ident" id="4630074">writeDynamicHeader</span><span class="op" id="4630092">(</span><span class="ident" id="4630093">numLiterals</span><span class="op" id="4630104">,</span>&nbsp;<span class="ident" id="4630106">numOffsets</span><span class="op" id="4630116">,</span>&nbsp;<span class="ident" id="4630118">numCodegens</span><span class="op" id="4630129">,</span>&nbsp;<span class="ident" id="4630131">eof</span><span class="op" id="4630134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4630137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4630140">for</span>&nbsp;<span class="ident" id="4630144">_</span><span class="op" id="4630145">,</span>&nbsp;<span class="ident" id="4630147">t</span>&nbsp;<span class="op" id="4630149">:=</span>&nbsp;<span class="keyword" id="4630152">range</span>&nbsp;<span class="ident" id="4630158">tokens</span>&nbsp;<span class="op" id="4630165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4630169">switch</span>&nbsp;<span class="ident" id="4630176">t</span><span class="op" id="4630177">.</span><span class="ident" id="4630178">typ</span><span class="op" id="4630181">(</span><span class="op" id="4630182">)</span>&nbsp;<span class="op" id="4630184">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4630188">case</span>&nbsp;<span class="ident" id="4630193">literalType</span><span class="op" id="4630204">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630209">w</span><span class="op" id="4630210">.</span><span class="ident" id="4630211">writeCode</span><span class="op" id="4630220">(</span><span class="ident" id="4630221">literalEncoding</span><span class="op" id="4630236">,</span>&nbsp;<span class="ident" id="4630238">t</span><span class="op" id="4630239">.</span><span class="ident" id="4630240">literal</span><span class="op" id="4630247">(</span><span class="op" id="4630248">)</span><span class="op" id="4630249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4630254">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4630262">case</span>&nbsp;<span class="ident" id="4630267">matchType</span><span class="op" id="4630276">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4630281">//&nbsp;Write&nbsp;the&nbsp;length</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630304">length</span>&nbsp;<span class="op" id="4630311">:=</span>&nbsp;<span class="ident" id="4630314">t</span><span class="op" id="4630315">.</span><span class="ident" id="4630316">length</span><span class="op" id="4630322">(</span><span class="op" id="4630323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630328">lengthCode</span>&nbsp;<span class="op" id="4630339">:=</span>&nbsp;<span class="ident" id="4630342">lengthCode</span><span class="op" id="4630352">(</span><span class="ident" id="4630353">length</span><span class="op" id="4630359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630364">w</span><span class="op" id="4630365">.</span><span class="ident" id="4630366">writeCode</span><span class="op" id="4630375">(</span><span class="ident" id="4630376">literalEncoding</span><span class="op" id="4630391">,</span>&nbsp;<span class="ident" id="4630393">lengthCode</span><span class="op" id="4630403">+</span><span class="ident" id="4630404">lengthCodesStart</span><span class="op" id="4630420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630425">extraLengthBits</span>&nbsp;<span class="op" id="4630441">:=</span>&nbsp;<span class="builtintype" id="4630444">int32</span><span class="op" id="4630449">(</span><span class="ident" id="4630450">lengthExtraBits</span><span class="op" id="4630465">[</span><span class="ident" id="4630466">lengthCode</span><span class="op" id="4630476">]</span><span class="op" id="4630477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4630482">if</span>&nbsp;<span class="ident" id="4630485">extraLengthBits</span>&nbsp;<span class="op" id="4630501">&gt;</span>&nbsp;<span class="num" id="4630503">0</span>&nbsp;<span class="op" id="4630505">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630511">extraLength</span>&nbsp;<span class="op" id="4630523">:=</span>&nbsp;<span class="builtintype" id="4630526">int32</span><span class="op" id="4630531">(</span><span class="ident" id="4630532">length</span>&nbsp;<span class="op" id="4630539">-</span>&nbsp;<span class="ident" id="4630541">lengthBase</span><span class="op" id="4630551">[</span><span class="ident" id="4630552">lengthCode</span><span class="op" id="4630562">]</span><span class="op" id="4630563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630569">w</span><span class="op" id="4630570">.</span><span class="ident" id="4630571">writeBits</span><span class="op" id="4630580">(</span><span class="ident" id="4630581">extraLength</span><span class="op" id="4630592">,</span>&nbsp;<span class="ident" id="4630594">extraLengthBits</span><span class="op" id="4630609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4630614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4630619">//&nbsp;Write&nbsp;the&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630642">offset</span>&nbsp;<span class="op" id="4630649">:=</span>&nbsp;<span class="ident" id="4630652">t</span><span class="op" id="4630653">.</span><span class="ident" id="4630654">offset</span><span class="op" id="4630660">(</span><span class="op" id="4630661">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630666">offsetCode</span>&nbsp;<span class="op" id="4630677">:=</span>&nbsp;<span class="ident" id="4630680">offsetCode</span><span class="op" id="4630690">(</span><span class="ident" id="4630691">offset</span><span class="op" id="4630697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630702">w</span><span class="op" id="4630703">.</span><span class="ident" id="4630704">writeCode</span><span class="op" id="4630713">(</span><span class="ident" id="4630714">offsetEncoding</span><span class="op" id="4630728">,</span>&nbsp;<span class="ident" id="4630730">offsetCode</span><span class="op" id="4630740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630745">extraOffsetBits</span>&nbsp;<span class="op" id="4630761">:=</span>&nbsp;<span class="builtintype" id="4630764">int32</span><span class="op" id="4630769">(</span><span class="ident" id="4630770">offsetExtraBits</span><span class="op" id="4630785">[</span><span class="ident" id="4630786">offsetCode</span><span class="op" id="4630796">]</span><span class="op" id="4630797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4630802">if</span>&nbsp;<span class="ident" id="4630805">extraOffsetBits</span>&nbsp;<span class="op" id="4630821">&gt;</span>&nbsp;<span class="num" id="4630823">0</span>&nbsp;<span class="op" id="4630825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630831">extraOffset</span>&nbsp;<span class="op" id="4630843">:=</span>&nbsp;<span class="builtintype" id="4630846">int32</span><span class="op" id="4630851">(</span><span class="ident" id="4630852">offset</span>&nbsp;<span class="op" id="4630859">-</span>&nbsp;<span class="ident" id="4630861">offsetBase</span><span class="op" id="4630871">[</span><span class="ident" id="4630872">offsetCode</span><span class="op" id="4630882">]</span><span class="op" id="4630883">)</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4630889">w</span><span class="op" id="4630890">.</span><span class="ident" id="4630891">writeBits</span><span class="op" id="4630900">(</span><span class="ident" id="4630901">extraOffset</span><span class="op" id="4630912">,</span>&nbsp;<span class="ident" id="4630914">extraOffsetBits</span><span class="op" id="4630929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4630934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4630939">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4630947">default</span><span class="op" id="4630954">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4630959">panic</span><span class="op" id="4630964">(</span><span class="string" id="4630965">&#34;unknown&nbsp;token&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="4630988">+</span>&nbsp;<span class="builtintype" id="4630990">string</span><span class="op" id="4630996">(</span><span class="ident" id="4630997">t</span><span class="op" id="4630998">)</span><span class="op" id="4630999">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4631003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4631006">}</span><br>
<span class="lineno"></span><span class="op" id="4631008">}</span>
</div>
</body>
</html>
