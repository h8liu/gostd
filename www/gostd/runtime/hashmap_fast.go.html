<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html" class="current">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1559258">//&nbsp;Copyright&nbsp;2014&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1559313">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1559367">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1559418">package</span>&nbsp;<span class="ident" id="1559426">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1559435">import</span>&nbsp;<span class="op" id="1559442">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1559445">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="1559454">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="1559457">func</span>&nbsp;<span class="ident" id="1559462">mapaccess1_fast32</span><span class="op" id="1559479">(</span><span class="ident" id="1559480">t</span>&nbsp;<span class="op" id="1559482">*</span><span class="ident" id="1559483">maptype</span><span class="op" id="1559490">,</span>&nbsp;<span class="ident" id="1559492">h</span>&nbsp;<span class="op" id="1559494">*</span><span class="ident" id="1559495">hmap</span><span class="op" id="1559499">,</span>&nbsp;<span class="ident" id="1559501">key</span>&nbsp;<span class="builtintype" id="1559505">uint32</span><span class="op" id="1559511">)</span>&nbsp;<span class="ident" id="1559513">unsafe</span><span class="op" id="1559519">.</span><span class="ident" id="1559520">Pointer</span>&nbsp;<span class="op" id="1559528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559531">if</span>&nbsp;<span class="ident" id="1559534">raceenabled</span>&nbsp;<span class="op" id="1559546">&amp;&amp;</span>&nbsp;<span class="ident" id="1559549">h</span>&nbsp;<span class="op" id="1559551">!=</span>&nbsp;<span class="ident" id="1559554">nil</span>&nbsp;<span class="op" id="1559558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559562">callerpc</span>&nbsp;<span class="op" id="1559571">:=</span>&nbsp;<span class="ident" id="1559574">getcallerpc</span><span class="op" id="1559585">(</span><span class="ident" id="1559586">unsafe</span><span class="op" id="1559592">.</span><span class="ident" id="1559593">Pointer</span><span class="op" id="1559600">(</span><span class="op" id="1559601">&amp;</span><span class="ident" id="1559602">t</span><span class="op" id="1559603">)</span><span class="op" id="1559604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559608">racereadpc</span><span class="op" id="1559618">(</span><span class="ident" id="1559619">unsafe</span><span class="op" id="1559625">.</span><span class="ident" id="1559626">Pointer</span><span class="op" id="1559633">(</span><span class="ident" id="1559634">h</span><span class="op" id="1559635">)</span><span class="op" id="1559636">,</span>&nbsp;<span class="ident" id="1559638">callerpc</span><span class="op" id="1559646">,</span>&nbsp;<span class="ident" id="1559648">funcPC</span><span class="op" id="1559654">(</span><span class="ident" id="1559655">mapaccess1_fast32</span><span class="op" id="1559672">)</span><span class="op" id="1559673">)</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559679">if</span>&nbsp;<span class="ident" id="1559682">h</span>&nbsp;<span class="op" id="1559684">==</span>&nbsp;<span class="ident" id="1559687">nil</span>&nbsp;<span class="op" id="1559691">||</span>&nbsp;<span class="ident" id="1559694">h</span><span class="op" id="1559695">.</span><span class="ident" id="1559696">count</span>&nbsp;<span class="op" id="1559702">==</span>&nbsp;<span class="num" id="1559705">0</span>&nbsp;<span class="op" id="1559707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559711">return</span>&nbsp;<span class="ident" id="1559718">unsafe</span><span class="op" id="1559724">.</span><span class="ident" id="1559725">Pointer</span><span class="op" id="1559732">(</span><span class="ident" id="1559733">t</span><span class="op" id="1559734">.</span><span class="ident" id="1559735">elem</span><span class="op" id="1559739">.</span><span class="ident" id="1559740">zero</span><span class="op" id="1559744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559750">var</span>&nbsp;<span class="ident" id="1559754">b</span>&nbsp;<span class="op" id="1559756">*</span><span class="ident" id="1559757">bmap</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1559763">if</span>&nbsp;<span class="ident" id="1559766">h</span><span class="op" id="1559767">.</span><span class="ident" id="1559768">B</span>&nbsp;<span class="op" id="1559770">==</span>&nbsp;<span class="num" id="1559773">0</span>&nbsp;<span class="op" id="1559775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1559779">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559820">b</span>&nbsp;<span class="op" id="1559822">=</span>&nbsp;<span class="op" id="1559824">(</span><span class="op" id="1559825">*</span><span class="ident" id="1559826">bmap</span><span class="op" id="1559830">)</span><span class="op" id="1559831">(</span><span class="ident" id="1559832">h</span><span class="op" id="1559833">.</span><span class="ident" id="1559834">buckets</span><span class="op" id="1559841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1559844">}</span>&nbsp;<span class="keyword" id="1559846">else</span>&nbsp;<span class="op" id="1559851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559855">hash</span>&nbsp;<span class="op" id="1559860">:=</span>&nbsp;<span class="ident" id="1559863">goalg</span><span class="op" id="1559868">(</span><span class="ident" id="1559869">t</span><span class="op" id="1559870">.</span><span class="ident" id="1559871">key</span><span class="op" id="1559874">.</span><span class="ident" id="1559875">alg</span><span class="op" id="1559878">)</span><span class="op" id="1559879">.</span><span class="ident" id="1559880">hash</span><span class="op" id="1559884">(</span><span class="ident" id="1559885">noescape</span><span class="op" id="1559893">(</span><span class="ident" id="1559894">unsafe</span><span class="op" id="1559900">.</span><span class="ident" id="1559901">Pointer</span><span class="op" id="1559908">(</span><span class="op" id="1559909">&amp;</span><span class="ident" id="1559910">key</span><span class="op" id="1559913">)</span><span class="op" id="1559914">)</span><span class="op" id="1559915">,</span>&nbsp;<span class="num" id="1559917">4</span><span class="op" id="1559918">,</span>&nbsp;<span class="builtintype" id="1559920">uintptr</span><span class="op" id="1559927">(</span><span class="ident" id="1559928">h</span><span class="op" id="1559929">.</span><span class="ident" id="1559930">hash0</span><span class="op" id="1559935">)</span><span class="op" id="1559936">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559940">m</span>&nbsp;<span class="op" id="1559942">:=</span>&nbsp;<span class="builtintype" id="1559945">uintptr</span><span class="op" id="1559952">(</span><span class="num" id="1559953">1</span><span class="op" id="1559954">)</span><span class="op" id="1559955">&lt;&lt;</span><span class="ident" id="1559957">h</span><span class="op" id="1559958">.</span><span class="ident" id="1559959">B</span>&nbsp;<span class="op" id="1559961">-</span>&nbsp;<span class="num" id="1559963">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1559967">b</span>&nbsp;<span class="op" id="1559969">=</span>&nbsp;<span class="op" id="1559971">(</span><span class="op" id="1559972">*</span><span class="ident" id="1559973">bmap</span><span class="op" id="1559977">)</span><span class="op" id="1559978">(</span><span class="ident" id="1559979">add</span><span class="op" id="1559982">(</span><span class="ident" id="1559983">h</span><span class="op" id="1559984">.</span><span class="ident" id="1559985">buckets</span><span class="op" id="1559992">,</span>&nbsp;<span class="op" id="1559994">(</span><span class="ident" id="1559995">hash</span><span class="op" id="1559999">&amp;</span><span class="ident" id="1560000">m</span><span class="op" id="1560001">)</span><span class="op" id="1560002">*</span><span class="builtintype" id="1560003">uintptr</span><span class="op" id="1560010">(</span><span class="ident" id="1560011">t</span><span class="op" id="1560012">.</span><span class="ident" id="1560013">bucketsize</span><span class="op" id="1560023">)</span><span class="op" id="1560024">)</span><span class="op" id="1560025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560029">if</span>&nbsp;<span class="ident" id="1560032">c</span>&nbsp;<span class="op" id="1560034">:=</span>&nbsp;<span class="ident" id="1560037">h</span><span class="op" id="1560038">.</span><span class="ident" id="1560039">oldbuckets</span><span class="op" id="1560049">;</span>&nbsp;<span class="ident" id="1560051">c</span>&nbsp;<span class="op" id="1560053">!=</span>&nbsp;<span class="ident" id="1560056">nil</span>&nbsp;<span class="op" id="1560060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560065">oldb</span>&nbsp;<span class="op" id="1560070">:=</span>&nbsp;<span class="op" id="1560073">(</span><span class="op" id="1560074">*</span><span class="ident" id="1560075">bmap</span><span class="op" id="1560079">)</span><span class="op" id="1560080">(</span><span class="ident" id="1560081">add</span><span class="op" id="1560084">(</span><span class="ident" id="1560085">c</span><span class="op" id="1560086">,</span>&nbsp;<span class="op" id="1560088">(</span><span class="ident" id="1560089">hash</span><span class="op" id="1560093">&amp;</span><span class="op" id="1560094">(</span><span class="ident" id="1560095">m</span><span class="op" id="1560096">&gt;&gt;</span><span class="num" id="1560098">1</span><span class="op" id="1560099">)</span><span class="op" id="1560100">)</span><span class="op" id="1560101">*</span><span class="builtintype" id="1560102">uintptr</span><span class="op" id="1560109">(</span><span class="ident" id="1560110">t</span><span class="op" id="1560111">.</span><span class="ident" id="1560112">bucketsize</span><span class="op" id="1560122">)</span><span class="op" id="1560123">)</span><span class="op" id="1560124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560129">if</span>&nbsp;<span class="op" id="1560132">!</span><span class="ident" id="1560133">evacuated</span><span class="op" id="1560142">(</span><span class="ident" id="1560143">oldb</span><span class="op" id="1560147">)</span>&nbsp;<span class="op" id="1560149">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560155">b</span>&nbsp;<span class="op" id="1560157">=</span>&nbsp;<span class="ident" id="1560159">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560177">for</span>&nbsp;<span class="op" id="1560181">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560185">for</span>&nbsp;<span class="ident" id="1560189">i</span>&nbsp;<span class="op" id="1560191">:=</span>&nbsp;<span class="builtintype" id="1560194">uintptr</span><span class="op" id="1560201">(</span><span class="num" id="1560202">0</span><span class="op" id="1560203">)</span><span class="op" id="1560204">;</span>&nbsp;<span class="ident" id="1560206">i</span>&nbsp;<span class="op" id="1560208">&lt;</span>&nbsp;<span class="ident" id="1560210">bucketCnt</span><span class="op" id="1560219">;</span>&nbsp;<span class="ident" id="1560221">i</span><span class="op" id="1560222">++</span>&nbsp;<span class="op" id="1560225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560230">k</span>&nbsp;<span class="op" id="1560232">:=</span>&nbsp;<span class="op" id="1560235">*</span><span class="op" id="1560236">(</span><span class="op" id="1560237">(</span><span class="op" id="1560238">*</span><span class="builtintype" id="1560239">uint32</span><span class="op" id="1560245">)</span><span class="op" id="1560246">(</span><span class="ident" id="1560247">add</span><span class="op" id="1560250">(</span><span class="ident" id="1560251">unsafe</span><span class="op" id="1560257">.</span><span class="ident" id="1560258">Pointer</span><span class="op" id="1560265">(</span><span class="ident" id="1560266">b</span><span class="op" id="1560267">)</span><span class="op" id="1560268">,</span>&nbsp;<span class="ident" id="1560270">dataOffset</span><span class="op" id="1560280">+</span><span class="ident" id="1560281">i</span><span class="op" id="1560282">*</span><span class="num" id="1560283">4</span><span class="op" id="1560284">)</span><span class="op" id="1560285">)</span><span class="op" id="1560286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560291">if</span>&nbsp;<span class="ident" id="1560294">k</span>&nbsp;<span class="op" id="1560296">!=</span>&nbsp;<span class="ident" id="1560299">key</span>&nbsp;<span class="op" id="1560303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560309">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560321">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560326">x</span>&nbsp;<span class="op" id="1560328">:=</span>&nbsp;<span class="op" id="1560331">*</span><span class="op" id="1560332">(</span><span class="op" id="1560333">(</span><span class="op" id="1560334">*</span><span class="builtintype" id="1560335">uint8</span><span class="op" id="1560340">)</span><span class="op" id="1560341">(</span><span class="ident" id="1560342">add</span><span class="op" id="1560345">(</span><span class="ident" id="1560346">unsafe</span><span class="op" id="1560352">.</span><span class="ident" id="1560353">Pointer</span><span class="op" id="1560360">(</span><span class="ident" id="1560361">b</span><span class="op" id="1560362">)</span><span class="op" id="1560363">,</span>&nbsp;<span class="ident" id="1560365">i</span><span class="op" id="1560366">)</span><span class="op" id="1560367">)</span><span class="op" id="1560368">)</span>&nbsp;<span class="comment" id="1560370">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560414">if</span>&nbsp;<span class="ident" id="1560417">x</span>&nbsp;<span class="op" id="1560419">==</span>&nbsp;<span class="ident" id="1560422">empty</span>&nbsp;<span class="op" id="1560428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560434">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560451">return</span>&nbsp;<span class="ident" id="1560458">add</span><span class="op" id="1560461">(</span><span class="ident" id="1560462">unsafe</span><span class="op" id="1560468">.</span><span class="ident" id="1560469">Pointer</span><span class="op" id="1560476">(</span><span class="ident" id="1560477">b</span><span class="op" id="1560478">)</span><span class="op" id="1560479">,</span>&nbsp;<span class="ident" id="1560481">dataOffset</span><span class="op" id="1560491">+</span><span class="ident" id="1560492">bucketCnt</span><span class="op" id="1560501">*</span><span class="num" id="1560502">4</span><span class="op" id="1560503">+</span><span class="ident" id="1560504">i</span><span class="op" id="1560505">*</span><span class="builtintype" id="1560506">uintptr</span><span class="op" id="1560513">(</span><span class="ident" id="1560514">t</span><span class="op" id="1560515">.</span><span class="ident" id="1560516">valuesize</span><span class="op" id="1560525">)</span><span class="op" id="1560526">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560534">b</span>&nbsp;<span class="op" id="1560536">=</span>&nbsp;<span class="ident" id="1560538">b</span><span class="op" id="1560539">.</span><span class="ident" id="1560540">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560551">if</span>&nbsp;<span class="ident" id="1560554">b</span>&nbsp;<span class="op" id="1560556">==</span>&nbsp;<span class="ident" id="1560559">nil</span>&nbsp;<span class="op" id="1560563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560568">return</span>&nbsp;<span class="ident" id="1560575">unsafe</span><span class="op" id="1560581">.</span><span class="ident" id="1560582">Pointer</span><span class="op" id="1560589">(</span><span class="ident" id="1560590">t</span><span class="op" id="1560591">.</span><span class="ident" id="1560592">elem</span><span class="op" id="1560596">.</span><span class="ident" id="1560597">zero</span><span class="op" id="1560601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560605">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560608">}</span><br>
<span class="lineno"></span><span class="op" id="1560610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1560613">func</span>&nbsp;<span class="ident" id="1560618">mapaccess2_fast32</span><span class="op" id="1560635">(</span><span class="ident" id="1560636">t</span>&nbsp;<span class="op" id="1560638">*</span><span class="ident" id="1560639">maptype</span><span class="op" id="1560646">,</span>&nbsp;<span class="ident" id="1560648">h</span>&nbsp;<span class="op" id="1560650">*</span><span class="ident" id="1560651">hmap</span><span class="op" id="1560655">,</span>&nbsp;<span class="ident" id="1560657">key</span>&nbsp;<span class="builtintype" id="1560661">uint32</span><span class="op" id="1560667">)</span>&nbsp;<span class="op" id="1560669">(</span><span class="ident" id="1560670">unsafe</span><span class="op" id="1560676">.</span><span class="ident" id="1560677">Pointer</span><span class="op" id="1560684">,</span>&nbsp;<span class="builtintype" id="1560686">bool</span><span class="op" id="1560690">)</span>&nbsp;<span class="op" id="1560692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560695">if</span>&nbsp;<span class="ident" id="1560698">raceenabled</span>&nbsp;<span class="op" id="1560710">&amp;&amp;</span>&nbsp;<span class="ident" id="1560713">h</span>&nbsp;<span class="op" id="1560715">!=</span>&nbsp;<span class="ident" id="1560718">nil</span>&nbsp;<span class="op" id="1560722">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560726">callerpc</span>&nbsp;<span class="op" id="1560735">:=</span>&nbsp;<span class="ident" id="1560738">getcallerpc</span><span class="op" id="1560749">(</span><span class="ident" id="1560750">unsafe</span><span class="op" id="1560756">.</span><span class="ident" id="1560757">Pointer</span><span class="op" id="1560764">(</span><span class="op" id="1560765">&amp;</span><span class="ident" id="1560766">t</span><span class="op" id="1560767">)</span><span class="op" id="1560768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560772">racereadpc</span><span class="op" id="1560782">(</span><span class="ident" id="1560783">unsafe</span><span class="op" id="1560789">.</span><span class="ident" id="1560790">Pointer</span><span class="op" id="1560797">(</span><span class="ident" id="1560798">h</span><span class="op" id="1560799">)</span><span class="op" id="1560800">,</span>&nbsp;<span class="ident" id="1560802">callerpc</span><span class="op" id="1560810">,</span>&nbsp;<span class="ident" id="1560812">funcPC</span><span class="op" id="1560818">(</span><span class="ident" id="1560819">mapaccess2_fast32</span><span class="op" id="1560836">)</span><span class="op" id="1560837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560843">if</span>&nbsp;<span class="ident" id="1560846">h</span>&nbsp;<span class="op" id="1560848">==</span>&nbsp;<span class="ident" id="1560851">nil</span>&nbsp;<span class="op" id="1560855">||</span>&nbsp;<span class="ident" id="1560858">h</span><span class="op" id="1560859">.</span><span class="ident" id="1560860">count</span>&nbsp;<span class="op" id="1560866">==</span>&nbsp;<span class="num" id="1560869">0</span>&nbsp;<span class="op" id="1560871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560875">return</span>&nbsp;<span class="ident" id="1560882">unsafe</span><span class="op" id="1560888">.</span><span class="ident" id="1560889">Pointer</span><span class="op" id="1560896">(</span><span class="ident" id="1560897">t</span><span class="op" id="1560898">.</span><span class="ident" id="1560899">elem</span><span class="op" id="1560903">.</span><span class="ident" id="1560904">zero</span><span class="op" id="1560908">)</span><span class="op" id="1560909">,</span>&nbsp;<span class="builtintype" id="1560911">false</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1560918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560921">var</span>&nbsp;<span class="ident" id="1560925">b</span>&nbsp;<span class="op" id="1560927">*</span><span class="ident" id="1560928">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1560934">if</span>&nbsp;<span class="ident" id="1560937">h</span><span class="op" id="1560938">.</span><span class="ident" id="1560939">B</span>&nbsp;<span class="op" id="1560941">==</span>&nbsp;<span class="num" id="1560944">0</span>&nbsp;<span class="op" id="1560946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1560950">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1560991">b</span>&nbsp;<span class="op" id="1560993">=</span>&nbsp;<span class="op" id="1560995">(</span><span class="op" id="1560996">*</span><span class="ident" id="1560997">bmap</span><span class="op" id="1561001">)</span><span class="op" id="1561002">(</span><span class="ident" id="1561003">h</span><span class="op" id="1561004">.</span><span class="ident" id="1561005">buckets</span><span class="op" id="1561012">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561015">}</span>&nbsp;<span class="keyword" id="1561017">else</span>&nbsp;<span class="op" id="1561022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561026">hash</span>&nbsp;<span class="op" id="1561031">:=</span>&nbsp;<span class="ident" id="1561034">goalg</span><span class="op" id="1561039">(</span><span class="ident" id="1561040">t</span><span class="op" id="1561041">.</span><span class="ident" id="1561042">key</span><span class="op" id="1561045">.</span><span class="ident" id="1561046">alg</span><span class="op" id="1561049">)</span><span class="op" id="1561050">.</span><span class="ident" id="1561051">hash</span><span class="op" id="1561055">(</span><span class="ident" id="1561056">noescape</span><span class="op" id="1561064">(</span><span class="ident" id="1561065">unsafe</span><span class="op" id="1561071">.</span><span class="ident" id="1561072">Pointer</span><span class="op" id="1561079">(</span><span class="op" id="1561080">&amp;</span><span class="ident" id="1561081">key</span><span class="op" id="1561084">)</span><span class="op" id="1561085">)</span><span class="op" id="1561086">,</span>&nbsp;<span class="num" id="1561088">4</span><span class="op" id="1561089">,</span>&nbsp;<span class="builtintype" id="1561091">uintptr</span><span class="op" id="1561098">(</span><span class="ident" id="1561099">h</span><span class="op" id="1561100">.</span><span class="ident" id="1561101">hash0</span><span class="op" id="1561106">)</span><span class="op" id="1561107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561111">m</span>&nbsp;<span class="op" id="1561113">:=</span>&nbsp;<span class="builtintype" id="1561116">uintptr</span><span class="op" id="1561123">(</span><span class="num" id="1561124">1</span><span class="op" id="1561125">)</span><span class="op" id="1561126">&lt;&lt;</span><span class="ident" id="1561128">h</span><span class="op" id="1561129">.</span><span class="ident" id="1561130">B</span>&nbsp;<span class="op" id="1561132">-</span>&nbsp;<span class="num" id="1561134">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561138">b</span>&nbsp;<span class="op" id="1561140">=</span>&nbsp;<span class="op" id="1561142">(</span><span class="op" id="1561143">*</span><span class="ident" id="1561144">bmap</span><span class="op" id="1561148">)</span><span class="op" id="1561149">(</span><span class="ident" id="1561150">add</span><span class="op" id="1561153">(</span><span class="ident" id="1561154">h</span><span class="op" id="1561155">.</span><span class="ident" id="1561156">buckets</span><span class="op" id="1561163">,</span>&nbsp;<span class="op" id="1561165">(</span><span class="ident" id="1561166">hash</span><span class="op" id="1561170">&amp;</span><span class="ident" id="1561171">m</span><span class="op" id="1561172">)</span><span class="op" id="1561173">*</span><span class="builtintype" id="1561174">uintptr</span><span class="op" id="1561181">(</span><span class="ident" id="1561182">t</span><span class="op" id="1561183">.</span><span class="ident" id="1561184">bucketsize</span><span class="op" id="1561194">)</span><span class="op" id="1561195">)</span><span class="op" id="1561196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561200">if</span>&nbsp;<span class="ident" id="1561203">c</span>&nbsp;<span class="op" id="1561205">:=</span>&nbsp;<span class="ident" id="1561208">h</span><span class="op" id="1561209">.</span><span class="ident" id="1561210">oldbuckets</span><span class="op" id="1561220">;</span>&nbsp;<span class="ident" id="1561222">c</span>&nbsp;<span class="op" id="1561224">!=</span>&nbsp;<span class="ident" id="1561227">nil</span>&nbsp;<span class="op" id="1561231">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561236">oldb</span>&nbsp;<span class="op" id="1561241">:=</span>&nbsp;<span class="op" id="1561244">(</span><span class="op" id="1561245">*</span><span class="ident" id="1561246">bmap</span><span class="op" id="1561250">)</span><span class="op" id="1561251">(</span><span class="ident" id="1561252">add</span><span class="op" id="1561255">(</span><span class="ident" id="1561256">c</span><span class="op" id="1561257">,</span>&nbsp;<span class="op" id="1561259">(</span><span class="ident" id="1561260">hash</span><span class="op" id="1561264">&amp;</span><span class="op" id="1561265">(</span><span class="ident" id="1561266">m</span><span class="op" id="1561267">&gt;&gt;</span><span class="num" id="1561269">1</span><span class="op" id="1561270">)</span><span class="op" id="1561271">)</span><span class="op" id="1561272">*</span><span class="builtintype" id="1561273">uintptr</span><span class="op" id="1561280">(</span><span class="ident" id="1561281">t</span><span class="op" id="1561282">.</span><span class="ident" id="1561283">bucketsize</span><span class="op" id="1561293">)</span><span class="op" id="1561294">)</span><span class="op" id="1561295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561300">if</span>&nbsp;<span class="op" id="1561303">!</span><span class="ident" id="1561304">evacuated</span><span class="op" id="1561313">(</span><span class="ident" id="1561314">oldb</span><span class="op" id="1561318">)</span>&nbsp;<span class="op" id="1561320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561326">b</span>&nbsp;<span class="op" id="1561328">=</span>&nbsp;<span class="ident" id="1561330">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561342">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561348">for</span>&nbsp;<span class="op" id="1561352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561356">for</span>&nbsp;<span class="ident" id="1561360">i</span>&nbsp;<span class="op" id="1561362">:=</span>&nbsp;<span class="builtintype" id="1561365">uintptr</span><span class="op" id="1561372">(</span><span class="num" id="1561373">0</span><span class="op" id="1561374">)</span><span class="op" id="1561375">;</span>&nbsp;<span class="ident" id="1561377">i</span>&nbsp;<span class="op" id="1561379">&lt;</span>&nbsp;<span class="ident" id="1561381">bucketCnt</span><span class="op" id="1561390">;</span>&nbsp;<span class="ident" id="1561392">i</span><span class="op" id="1561393">++</span>&nbsp;<span class="op" id="1561396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561401">k</span>&nbsp;<span class="op" id="1561403">:=</span>&nbsp;<span class="op" id="1561406">*</span><span class="op" id="1561407">(</span><span class="op" id="1561408">(</span><span class="op" id="1561409">*</span><span class="builtintype" id="1561410">uint32</span><span class="op" id="1561416">)</span><span class="op" id="1561417">(</span><span class="ident" id="1561418">add</span><span class="op" id="1561421">(</span><span class="ident" id="1561422">unsafe</span><span class="op" id="1561428">.</span><span class="ident" id="1561429">Pointer</span><span class="op" id="1561436">(</span><span class="ident" id="1561437">b</span><span class="op" id="1561438">)</span><span class="op" id="1561439">,</span>&nbsp;<span class="ident" id="1561441">dataOffset</span><span class="op" id="1561451">+</span><span class="ident" id="1561452">i</span><span class="op" id="1561453">*</span><span class="num" id="1561454">4</span><span class="op" id="1561455">)</span><span class="op" id="1561456">)</span><span class="op" id="1561457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561462">if</span>&nbsp;<span class="ident" id="1561465">k</span>&nbsp;<span class="op" id="1561467">!=</span>&nbsp;<span class="ident" id="1561470">key</span>&nbsp;<span class="op" id="1561474">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561480">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561497">x</span>&nbsp;<span class="op" id="1561499">:=</span>&nbsp;<span class="op" id="1561502">*</span><span class="op" id="1561503">(</span><span class="op" id="1561504">(</span><span class="op" id="1561505">*</span><span class="builtintype" id="1561506">uint8</span><span class="op" id="1561511">)</span><span class="op" id="1561512">(</span><span class="ident" id="1561513">add</span><span class="op" id="1561516">(</span><span class="ident" id="1561517">unsafe</span><span class="op" id="1561523">.</span><span class="ident" id="1561524">Pointer</span><span class="op" id="1561531">(</span><span class="ident" id="1561532">b</span><span class="op" id="1561533">)</span><span class="op" id="1561534">,</span>&nbsp;<span class="ident" id="1561536">i</span><span class="op" id="1561537">)</span><span class="op" id="1561538">)</span><span class="op" id="1561539">)</span>&nbsp;<span class="comment" id="1561541">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561585">if</span>&nbsp;<span class="ident" id="1561588">x</span>&nbsp;<span class="op" id="1561590">==</span>&nbsp;<span class="ident" id="1561593">empty</span>&nbsp;<span class="op" id="1561599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561605">continue</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561622">return</span>&nbsp;<span class="ident" id="1561629">add</span><span class="op" id="1561632">(</span><span class="ident" id="1561633">unsafe</span><span class="op" id="1561639">.</span><span class="ident" id="1561640">Pointer</span><span class="op" id="1561647">(</span><span class="ident" id="1561648">b</span><span class="op" id="1561649">)</span><span class="op" id="1561650">,</span>&nbsp;<span class="ident" id="1561652">dataOffset</span><span class="op" id="1561662">+</span><span class="ident" id="1561663">bucketCnt</span><span class="op" id="1561672">*</span><span class="num" id="1561673">4</span><span class="op" id="1561674">+</span><span class="ident" id="1561675">i</span><span class="op" id="1561676">*</span><span class="builtintype" id="1561677">uintptr</span><span class="op" id="1561684">(</span><span class="ident" id="1561685">t</span><span class="op" id="1561686">.</span><span class="ident" id="1561687">valuesize</span><span class="op" id="1561696">)</span><span class="op" id="1561697">)</span><span class="op" id="1561698">,</span>&nbsp;<span class="builtintype" id="1561700">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561711">b</span>&nbsp;<span class="op" id="1561713">=</span>&nbsp;<span class="ident" id="1561715">b</span><span class="op" id="1561716">.</span><span class="ident" id="1561717">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561728">if</span>&nbsp;<span class="ident" id="1561731">b</span>&nbsp;<span class="op" id="1561733">==</span>&nbsp;<span class="ident" id="1561736">nil</span>&nbsp;<span class="op" id="1561740">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561745">return</span>&nbsp;<span class="ident" id="1561752">unsafe</span><span class="op" id="1561758">.</span><span class="ident" id="1561759">Pointer</span><span class="op" id="1561766">(</span><span class="ident" id="1561767">t</span><span class="op" id="1561768">.</span><span class="ident" id="1561769">elem</span><span class="op" id="1561773">.</span><span class="ident" id="1561774">zero</span><span class="op" id="1561778">)</span><span class="op" id="1561779">,</span>&nbsp;<span class="builtintype" id="1561781">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561789">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1561792">}</span><br>
<span class="lineno"></span><span class="op" id="1561794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="1561797">func</span>&nbsp;<span class="ident" id="1561802">mapaccess1_fast64</span><span class="op" id="1561819">(</span><span class="ident" id="1561820">t</span>&nbsp;<span class="op" id="1561822">*</span><span class="ident" id="1561823">maptype</span><span class="op" id="1561830">,</span>&nbsp;<span class="ident" id="1561832">h</span>&nbsp;<span class="op" id="1561834">*</span><span class="ident" id="1561835">hmap</span><span class="op" id="1561839">,</span>&nbsp;<span class="ident" id="1561841">key</span>&nbsp;<span class="ident" id="1561845">uint64</span><span class="op" id="1561851">)</span>&nbsp;<span class="ident" id="1561853">unsafe</span><span class="op" id="1561859">.</span><span class="ident" id="1561860">Pointer</span>&nbsp;<span class="op" id="1561868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1561871">if</span>&nbsp;<span class="ident" id="1561874">raceenabled</span>&nbsp;<span class="op" id="1561886">&amp;&amp;</span>&nbsp;<span class="ident" id="1561889">h</span>&nbsp;<span class="op" id="1561891">!=</span>&nbsp;<span class="ident" id="1561894">nil</span>&nbsp;<span class="op" id="1561898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561902">callerpc</span>&nbsp;<span class="op" id="1561911">:=</span>&nbsp;<span class="ident" id="1561914">getcallerpc</span><span class="op" id="1561925">(</span><span class="ident" id="1561926">unsafe</span><span class="op" id="1561932">.</span><span class="ident" id="1561933">Pointer</span><span class="op" id="1561940">(</span><span class="op" id="1561941">&amp;</span><span class="ident" id="1561942">t</span><span class="op" id="1561943">)</span><span class="op" id="1561944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1561948">racereadpc</span><span class="op" id="1561958">(</span><span class="ident" id="1561959">unsafe</span><span class="op" id="1561965">.</span><span class="ident" id="1561966">Pointer</span><span class="op" id="1561973">(</span><span class="ident" id="1561974">h</span><span class="op" id="1561975">)</span><span class="op" id="1561976">,</span>&nbsp;<span class="ident" id="1561978">callerpc</span><span class="op" id="1561986">,</span>&nbsp;<span class="ident" id="1561988">funcPC</span><span class="op" id="1561994">(</span><span class="ident" id="1561995">mapaccess1_fast64</span><span class="op" id="1562012">)</span><span class="op" id="1562013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1562016">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562019">if</span>&nbsp;<span class="ident" id="1562022">h</span>&nbsp;<span class="op" id="1562024">==</span>&nbsp;<span class="ident" id="1562027">nil</span>&nbsp;<span class="op" id="1562031">||</span>&nbsp;<span class="ident" id="1562034">h</span><span class="op" id="1562035">.</span><span class="ident" id="1562036">count</span>&nbsp;<span class="op" id="1562042">==</span>&nbsp;<span class="num" id="1562045">0</span>&nbsp;<span class="op" id="1562047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562051">return</span>&nbsp;<span class="ident" id="1562058">unsafe</span><span class="op" id="1562064">.</span><span class="ident" id="1562065">Pointer</span><span class="op" id="1562072">(</span><span class="ident" id="1562073">t</span><span class="op" id="1562074">.</span><span class="ident" id="1562075">elem</span><span class="op" id="1562079">.</span><span class="ident" id="1562080">zero</span><span class="op" id="1562084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1562087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562090">var</span>&nbsp;<span class="ident" id="1562094">b</span>&nbsp;<span class="op" id="1562096">*</span><span class="ident" id="1562097">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562103">if</span>&nbsp;<span class="ident" id="1562106">h</span><span class="op" id="1562107">.</span><span class="ident" id="1562108">B</span>&nbsp;<span class="op" id="1562110">==</span>&nbsp;<span class="num" id="1562113">0</span>&nbsp;<span class="op" id="1562115">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1562119">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1562160">b</span>&nbsp;<span class="op" id="1562162">=</span>&nbsp;<span class="op" id="1562164">(</span><span class="op" id="1562165">*</span><span class="ident" id="1562166">bmap</span><span class="op" id="1562170">)</span><span class="op" id="1562171">(</span><span class="ident" id="1562172">h</span><span class="op" id="1562173">.</span><span class="ident" id="1562174">buckets</span><span class="op" id="1562181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1562184">}</span>&nbsp;<span class="keyword" id="1562186">else</span>&nbsp;<span class="op" id="1562191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1562195">hash</span>&nbsp;<span class="op" id="1562200">:=</span>&nbsp;<span class="ident" id="1562203">goalg</span><span class="op" id="1562208">(</span><span class="ident" id="1562209">t</span><span class="op" id="1562210">.</span><span class="ident" id="1562211">key</span><span class="op" id="1562214">.</span><span class="ident" id="1562215">alg</span><span class="op" id="1562218">)</span><span class="op" id="1562219">.</span><span class="ident" id="1562220">hash</span><span class="op" id="1562224">(</span><span class="ident" id="1562225">noescape</span><span class="op" id="1562233">(</span><span class="ident" id="1562234">unsafe</span><span class="op" id="1562240">.</span><span class="ident" id="1562241">Pointer</span><span class="op" id="1562248">(</span><span class="op" id="1562249">&amp;</span><span class="ident" id="1562250">key</span><span class="op" id="1562253">)</span><span class="op" id="1562254">)</span><span class="op" id="1562255">,</span>&nbsp;<span class="num" id="1562257">8</span><span class="op" id="1562258">,</span>&nbsp;<span class="builtintype" id="1562260">uintptr</span><span class="op" id="1562267">(</span><span class="ident" id="1562268">h</span><span class="op" id="1562269">.</span><span class="ident" id="1562270">hash0</span><span class="op" id="1562275">)</span><span class="op" id="1562276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1562280">m</span>&nbsp;<span class="op" id="1562282">:=</span>&nbsp;<span class="builtintype" id="1562285">uintptr</span><span class="op" id="1562292">(</span><span class="num" id="1562293">1</span><span class="op" id="1562294">)</span><span class="op" id="1562295">&lt;&lt;</span><span class="ident" id="1562297">h</span><span class="op" id="1562298">.</span><span class="ident" id="1562299">B</span>&nbsp;<span class="op" id="1562301">-</span>&nbsp;<span class="num" id="1562303">1</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1562307">b</span>&nbsp;<span class="op" id="1562309">=</span>&nbsp;<span class="op" id="1562311">(</span><span class="op" id="1562312">*</span><span class="ident" id="1562313">bmap</span><span class="op" id="1562317">)</span><span class="op" id="1562318">(</span><span class="ident" id="1562319">add</span><span class="op" id="1562322">(</span><span class="ident" id="1562323">h</span><span class="op" id="1562324">.</span><span class="ident" id="1562325">buckets</span><span class="op" id="1562332">,</span>&nbsp;<span class="op" id="1562334">(</span><span class="ident" id="1562335">hash</span><span class="op" id="1562339">&amp;</span><span class="ident" id="1562340">m</span><span class="op" id="1562341">)</span><span class="op" id="1562342">*</span><span class="builtintype" id="1562343">uintptr</span><span class="op" id="1562350">(</span><span class="ident" id="1562351">t</span><span class="op" id="1562352">.</span><span class="ident" id="1562353">bucketsize</span><span class="op" id="1562363">)</span><span class="op" id="1562364">)</span><span class="op" id="1562365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562369">if</span>&nbsp;<span class="ident" id="1562372">c</span>&nbsp;<span class="op" id="1562374">:=</span>&nbsp;<span class="ident" id="1562377">h</span><span class="op" id="1562378">.</span><span class="ident" id="1562379">oldbuckets</span><span class="op" id="1562389">;</span>&nbsp;<span class="ident" id="1562391">c</span>&nbsp;<span class="op" id="1562393">!=</span>&nbsp;<span class="ident" id="1562396">nil</span>&nbsp;<span class="op" id="1562400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1562405">oldb</span>&nbsp;<span class="op" id="1562410">:=</span>&nbsp;<span class="op" id="1562413">(</span><span class="op" id="1562414">*</span><span class="ident" id="1562415">bmap</span><span class="op" id="1562419">)</span><span class="op" id="1562420">(</span><span class="ident" id="1562421">add</span><span class="op" id="1562424">(</span><span class="ident" id="1562425">c</span><span class="op" id="1562426">,</span>&nbsp;<span class="op" id="1562428">(</span><span class="ident" id="1562429">hash</span><span class="op" id="1562433">&amp;</span><span class="op" id="1562434">(</span><span class="ident" id="1562435">m</span><span class="op" id="1562436">&gt;&gt;</span><span class="num" id="1562438">1</span><span class="op" id="1562439">)</span><span class="op" id="1562440">)</span><span class="op" id="1562441">*</span><span class="builtintype" id="1562442">uintptr</span><span class="op" id="1562449">(</span><span class="ident" id="1562450">t</span><span class="op" id="1562451">.</span><span class="ident" id="1562452">bucketsize</span><span class="op" id="1562462">)</span><span class="op" id="1562463">)</span><span class="op" id="1562464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562469">if</span>&nbsp;<span class="op" id="1562472">!</span><span class="ident" id="1562473">evacuated</span><span class="op" id="1562482">(</span><span class="ident" id="1562483">oldb</span><span class="op" id="1562487">)</span>&nbsp;<span class="op" id="1562489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1562495">b</span>&nbsp;<span class="op" id="1562497">=</span>&nbsp;<span class="ident" id="1562499">oldb</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1562507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1562511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1562514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562517">for</span>&nbsp;<span class="op" id="1562521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562525">for</span>&nbsp;<span class="ident" id="1562529">i</span>&nbsp;<span class="op" id="1562531">:=</span>&nbsp;<span class="builtintype" id="1562534">uintptr</span><span class="op" id="1562541">(</span><span class="num" id="1562542">0</span><span class="op" id="1562543">)</span><span class="op" id="1562544">;</span>&nbsp;<span class="ident" id="1562546">i</span>&nbsp;<span class="op" id="1562548">&lt;</span>&nbsp;<span class="ident" id="1562550">bucketCnt</span><span class="op" id="1562559">;</span>&nbsp;<span class="ident" id="1562561">i</span><span class="op" id="1562562">++</span>&nbsp;<span class="op" id="1562565">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1562570">k</span>&nbsp;<span class="op" id="1562572">:=</span>&nbsp;<span class="op" id="1562575">*</span><span class="op" id="1562576">(</span><span class="op" id="1562577">(</span><span class="op" id="1562578">*</span><span class="ident" id="1562579">uint64</span><span class="op" id="1562585">)</span><span class="op" id="1562586">(</span><span class="ident" id="1562587">add</span><span class="op" id="1562590">(</span><span class="ident" id="1562591">unsafe</span><span class="op" id="1562597">.</span><span class="ident" id="1562598">Pointer</span><span class="op" id="1562605">(</span><span class="ident" id="1562606">b</span><span class="op" id="1562607">)</span><span class="op" id="1562608">,</span>&nbsp;<span class="ident" id="1562610">dataOffset</span><span class="op" id="1562620">+</span><span class="ident" id="1562621">i</span><span class="op" id="1562622">*</span><span class="num" id="1562623">8</span><span class="op" id="1562624">)</span><span class="op" id="1562625">)</span><span class="op" id="1562626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562631">if</span>&nbsp;<span class="ident" id="1562634">k</span>&nbsp;<span class="op" id="1562636">!=</span>&nbsp;<span class="ident" id="1562639">key</span>&nbsp;<span class="op" id="1562643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562649">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1562661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1562666">x</span>&nbsp;<span class="op" id="1562668">:=</span>&nbsp;<span class="op" id="1562671">*</span><span class="op" id="1562672">(</span><span class="op" id="1562673">(</span><span class="op" id="1562674">*</span><span class="builtintype" id="1562675">uint8</span><span class="op" id="1562680">)</span><span class="op" id="1562681">(</span><span class="ident" id="1562682">add</span><span class="op" id="1562685">(</span><span class="ident" id="1562686">unsafe</span><span class="op" id="1562692">.</span><span class="ident" id="1562693">Pointer</span><span class="op" id="1562700">(</span><span class="ident" id="1562701">b</span><span class="op" id="1562702">)</span><span class="op" id="1562703">,</span>&nbsp;<span class="ident" id="1562705">i</span><span class="op" id="1562706">)</span><span class="op" id="1562707">)</span><span class="op" id="1562708">)</span>&nbsp;<span class="comment" id="1562710">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562754">if</span>&nbsp;<span class="ident" id="1562757">x</span>&nbsp;<span class="op" id="1562759">==</span>&nbsp;<span class="ident" id="1562762">empty</span>&nbsp;<span class="op" id="1562768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562774">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1562786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562791">return</span>&nbsp;<span class="ident" id="1562798">add</span><span class="op" id="1562801">(</span><span class="ident" id="1562802">unsafe</span><span class="op" id="1562808">.</span><span class="ident" id="1562809">Pointer</span><span class="op" id="1562816">(</span><span class="ident" id="1562817">b</span><span class="op" id="1562818">)</span><span class="op" id="1562819">,</span>&nbsp;<span class="ident" id="1562821">dataOffset</span><span class="op" id="1562831">+</span><span class="ident" id="1562832">bucketCnt</span><span class="op" id="1562841">*</span><span class="num" id="1562842">8</span><span class="op" id="1562843">+</span><span class="ident" id="1562844">i</span><span class="op" id="1562845">*</span><span class="builtintype" id="1562846">uintptr</span><span class="op" id="1562853">(</span><span class="ident" id="1562854">t</span><span class="op" id="1562855">.</span><span class="ident" id="1562856">valuesize</span><span class="op" id="1562865">)</span><span class="op" id="1562866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1562870">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1562874">b</span>&nbsp;<span class="op" id="1562876">=</span>&nbsp;<span class="ident" id="1562878">b</span><span class="op" id="1562879">.</span><span class="ident" id="1562880">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562891">if</span>&nbsp;<span class="ident" id="1562894">b</span>&nbsp;<span class="op" id="1562896">==</span>&nbsp;<span class="ident" id="1562899">nil</span>&nbsp;<span class="op" id="1562903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1562908">return</span>&nbsp;<span class="ident" id="1562915">unsafe</span><span class="op" id="1562921">.</span><span class="ident" id="1562922">Pointer</span><span class="op" id="1562929">(</span><span class="ident" id="1562930">t</span><span class="op" id="1562931">.</span><span class="ident" id="1562932">elem</span><span class="op" id="1562936">.</span><span class="ident" id="1562937">zero</span><span class="op" id="1562941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1562945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1562948">}</span><br>
<span class="lineno">135</span><span class="op" id="1562950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1562953">func</span>&nbsp;<span class="ident" id="1562958">mapaccess2_fast64</span><span class="op" id="1562975">(</span><span class="ident" id="1562976">t</span>&nbsp;<span class="op" id="1562978">*</span><span class="ident" id="1562979">maptype</span><span class="op" id="1562986">,</span>&nbsp;<span class="ident" id="1562988">h</span>&nbsp;<span class="op" id="1562990">*</span><span class="ident" id="1562991">hmap</span><span class="op" id="1562995">,</span>&nbsp;<span class="ident" id="1562997">key</span>&nbsp;<span class="ident" id="1563001">uint64</span><span class="op" id="1563007">)</span>&nbsp;<span class="op" id="1563009">(</span><span class="ident" id="1563010">unsafe</span><span class="op" id="1563016">.</span><span class="ident" id="1563017">Pointer</span><span class="op" id="1563024">,</span>&nbsp;<span class="builtintype" id="1563026">bool</span><span class="op" id="1563030">)</span>&nbsp;<span class="op" id="1563032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563035">if</span>&nbsp;<span class="ident" id="1563038">raceenabled</span>&nbsp;<span class="op" id="1563050">&amp;&amp;</span>&nbsp;<span class="ident" id="1563053">h</span>&nbsp;<span class="op" id="1563055">!=</span>&nbsp;<span class="ident" id="1563058">nil</span>&nbsp;<span class="op" id="1563062">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1563066">callerpc</span>&nbsp;<span class="op" id="1563075">:=</span>&nbsp;<span class="ident" id="1563078">getcallerpc</span><span class="op" id="1563089">(</span><span class="ident" id="1563090">unsafe</span><span class="op" id="1563096">.</span><span class="ident" id="1563097">Pointer</span><span class="op" id="1563104">(</span><span class="op" id="1563105">&amp;</span><span class="ident" id="1563106">t</span><span class="op" id="1563107">)</span><span class="op" id="1563108">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1563112">racereadpc</span><span class="op" id="1563122">(</span><span class="ident" id="1563123">unsafe</span><span class="op" id="1563129">.</span><span class="ident" id="1563130">Pointer</span><span class="op" id="1563137">(</span><span class="ident" id="1563138">h</span><span class="op" id="1563139">)</span><span class="op" id="1563140">,</span>&nbsp;<span class="ident" id="1563142">callerpc</span><span class="op" id="1563150">,</span>&nbsp;<span class="ident" id="1563152">funcPC</span><span class="op" id="1563158">(</span><span class="ident" id="1563159">mapaccess2_fast64</span><span class="op" id="1563176">)</span><span class="op" id="1563177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1563180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563183">if</span>&nbsp;<span class="ident" id="1563186">h</span>&nbsp;<span class="op" id="1563188">==</span>&nbsp;<span class="ident" id="1563191">nil</span>&nbsp;<span class="op" id="1563195">||</span>&nbsp;<span class="ident" id="1563198">h</span><span class="op" id="1563199">.</span><span class="ident" id="1563200">count</span>&nbsp;<span class="op" id="1563206">==</span>&nbsp;<span class="num" id="1563209">0</span>&nbsp;<span class="op" id="1563211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563215">return</span>&nbsp;<span class="ident" id="1563222">unsafe</span><span class="op" id="1563228">.</span><span class="ident" id="1563229">Pointer</span><span class="op" id="1563236">(</span><span class="ident" id="1563237">t</span><span class="op" id="1563238">.</span><span class="ident" id="1563239">elem</span><span class="op" id="1563243">.</span><span class="ident" id="1563244">zero</span><span class="op" id="1563248">)</span><span class="op" id="1563249">,</span>&nbsp;<span class="builtintype" id="1563251">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1563258">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563261">var</span>&nbsp;<span class="ident" id="1563265">b</span>&nbsp;<span class="op" id="1563267">*</span><span class="ident" id="1563268">bmap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563274">if</span>&nbsp;<span class="ident" id="1563277">h</span><span class="op" id="1563278">.</span><span class="ident" id="1563279">B</span>&nbsp;<span class="op" id="1563281">==</span>&nbsp;<span class="num" id="1563284">0</span>&nbsp;<span class="op" id="1563286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1563290">//&nbsp;One-bucket&nbsp;table.&nbsp;&nbsp;No&nbsp;need&nbsp;to&nbsp;hash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1563331">b</span>&nbsp;<span class="op" id="1563333">=</span>&nbsp;<span class="op" id="1563335">(</span><span class="op" id="1563336">*</span><span class="ident" id="1563337">bmap</span><span class="op" id="1563341">)</span><span class="op" id="1563342">(</span><span class="ident" id="1563343">h</span><span class="op" id="1563344">.</span><span class="ident" id="1563345">buckets</span><span class="op" id="1563352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1563355">}</span>&nbsp;<span class="keyword" id="1563357">else</span>&nbsp;<span class="op" id="1563362">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1563366">hash</span>&nbsp;<span class="op" id="1563371">:=</span>&nbsp;<span class="ident" id="1563374">goalg</span><span class="op" id="1563379">(</span><span class="ident" id="1563380">t</span><span class="op" id="1563381">.</span><span class="ident" id="1563382">key</span><span class="op" id="1563385">.</span><span class="ident" id="1563386">alg</span><span class="op" id="1563389">)</span><span class="op" id="1563390">.</span><span class="ident" id="1563391">hash</span><span class="op" id="1563395">(</span><span class="ident" id="1563396">noescape</span><span class="op" id="1563404">(</span><span class="ident" id="1563405">unsafe</span><span class="op" id="1563411">.</span><span class="ident" id="1563412">Pointer</span><span class="op" id="1563419">(</span><span class="op" id="1563420">&amp;</span><span class="ident" id="1563421">key</span><span class="op" id="1563424">)</span><span class="op" id="1563425">)</span><span class="op" id="1563426">,</span>&nbsp;<span class="num" id="1563428">8</span><span class="op" id="1563429">,</span>&nbsp;<span class="builtintype" id="1563431">uintptr</span><span class="op" id="1563438">(</span><span class="ident" id="1563439">h</span><span class="op" id="1563440">.</span><span class="ident" id="1563441">hash0</span><span class="op" id="1563446">)</span><span class="op" id="1563447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1563451">m</span>&nbsp;<span class="op" id="1563453">:=</span>&nbsp;<span class="builtintype" id="1563456">uintptr</span><span class="op" id="1563463">(</span><span class="num" id="1563464">1</span><span class="op" id="1563465">)</span><span class="op" id="1563466">&lt;&lt;</span><span class="ident" id="1563468">h</span><span class="op" id="1563469">.</span><span class="ident" id="1563470">B</span>&nbsp;<span class="op" id="1563472">-</span>&nbsp;<span class="num" id="1563474">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1563478">b</span>&nbsp;<span class="op" id="1563480">=</span>&nbsp;<span class="op" id="1563482">(</span><span class="op" id="1563483">*</span><span class="ident" id="1563484">bmap</span><span class="op" id="1563488">)</span><span class="op" id="1563489">(</span><span class="ident" id="1563490">add</span><span class="op" id="1563493">(</span><span class="ident" id="1563494">h</span><span class="op" id="1563495">.</span><span class="ident" id="1563496">buckets</span><span class="op" id="1563503">,</span>&nbsp;<span class="op" id="1563505">(</span><span class="ident" id="1563506">hash</span><span class="op" id="1563510">&amp;</span><span class="ident" id="1563511">m</span><span class="op" id="1563512">)</span><span class="op" id="1563513">*</span><span class="builtintype" id="1563514">uintptr</span><span class="op" id="1563521">(</span><span class="ident" id="1563522">t</span><span class="op" id="1563523">.</span><span class="ident" id="1563524">bucketsize</span><span class="op" id="1563534">)</span><span class="op" id="1563535">)</span><span class="op" id="1563536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563540">if</span>&nbsp;<span class="ident" id="1563543">c</span>&nbsp;<span class="op" id="1563545">:=</span>&nbsp;<span class="ident" id="1563548">h</span><span class="op" id="1563549">.</span><span class="ident" id="1563550">oldbuckets</span><span class="op" id="1563560">;</span>&nbsp;<span class="ident" id="1563562">c</span>&nbsp;<span class="op" id="1563564">!=</span>&nbsp;<span class="ident" id="1563567">nil</span>&nbsp;<span class="op" id="1563571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1563576">oldb</span>&nbsp;<span class="op" id="1563581">:=</span>&nbsp;<span class="op" id="1563584">(</span><span class="op" id="1563585">*</span><span class="ident" id="1563586">bmap</span><span class="op" id="1563590">)</span><span class="op" id="1563591">(</span><span class="ident" id="1563592">add</span><span class="op" id="1563595">(</span><span class="ident" id="1563596">c</span><span class="op" id="1563597">,</span>&nbsp;<span class="op" id="1563599">(</span><span class="ident" id="1563600">hash</span><span class="op" id="1563604">&amp;</span><span class="op" id="1563605">(</span><span class="ident" id="1563606">m</span><span class="op" id="1563607">&gt;&gt;</span><span class="num" id="1563609">1</span><span class="op" id="1563610">)</span><span class="op" id="1563611">)</span><span class="op" id="1563612">*</span><span class="builtintype" id="1563613">uintptr</span><span class="op" id="1563620">(</span><span class="ident" id="1563621">t</span><span class="op" id="1563622">.</span><span class="ident" id="1563623">bucketsize</span><span class="op" id="1563633">)</span><span class="op" id="1563634">)</span><span class="op" id="1563635">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563640">if</span>&nbsp;<span class="op" id="1563643">!</span><span class="ident" id="1563644">evacuated</span><span class="op" id="1563653">(</span><span class="ident" id="1563654">oldb</span><span class="op" id="1563658">)</span>&nbsp;<span class="op" id="1563660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1563666">b</span>&nbsp;<span class="op" id="1563668">=</span>&nbsp;<span class="ident" id="1563670">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1563678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1563682">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1563685">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563688">for</span>&nbsp;<span class="op" id="1563692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563696">for</span>&nbsp;<span class="ident" id="1563700">i</span>&nbsp;<span class="op" id="1563702">:=</span>&nbsp;<span class="builtintype" id="1563705">uintptr</span><span class="op" id="1563712">(</span><span class="num" id="1563713">0</span><span class="op" id="1563714">)</span><span class="op" id="1563715">;</span>&nbsp;<span class="ident" id="1563717">i</span>&nbsp;<span class="op" id="1563719">&lt;</span>&nbsp;<span class="ident" id="1563721">bucketCnt</span><span class="op" id="1563730">;</span>&nbsp;<span class="ident" id="1563732">i</span><span class="op" id="1563733">++</span>&nbsp;<span class="op" id="1563736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1563741">k</span>&nbsp;<span class="op" id="1563743">:=</span>&nbsp;<span class="op" id="1563746">*</span><span class="op" id="1563747">(</span><span class="op" id="1563748">(</span><span class="op" id="1563749">*</span><span class="ident" id="1563750">uint64</span><span class="op" id="1563756">)</span><span class="op" id="1563757">(</span><span class="ident" id="1563758">add</span><span class="op" id="1563761">(</span><span class="ident" id="1563762">unsafe</span><span class="op" id="1563768">.</span><span class="ident" id="1563769">Pointer</span><span class="op" id="1563776">(</span><span class="ident" id="1563777">b</span><span class="op" id="1563778">)</span><span class="op" id="1563779">,</span>&nbsp;<span class="ident" id="1563781">dataOffset</span><span class="op" id="1563791">+</span><span class="ident" id="1563792">i</span><span class="op" id="1563793">*</span><span class="num" id="1563794">8</span><span class="op" id="1563795">)</span><span class="op" id="1563796">)</span><span class="op" id="1563797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563802">if</span>&nbsp;<span class="ident" id="1563805">k</span>&nbsp;<span class="op" id="1563807">!=</span>&nbsp;<span class="ident" id="1563810">key</span>&nbsp;<span class="op" id="1563814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563820">continue</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1563832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1563837">x</span>&nbsp;<span class="op" id="1563839">:=</span>&nbsp;<span class="op" id="1563842">*</span><span class="op" id="1563843">(</span><span class="op" id="1563844">(</span><span class="op" id="1563845">*</span><span class="builtintype" id="1563846">uint8</span><span class="op" id="1563851">)</span><span class="op" id="1563852">(</span><span class="ident" id="1563853">add</span><span class="op" id="1563856">(</span><span class="ident" id="1563857">unsafe</span><span class="op" id="1563863">.</span><span class="ident" id="1563864">Pointer</span><span class="op" id="1563871">(</span><span class="ident" id="1563872">b</span><span class="op" id="1563873">)</span><span class="op" id="1563874">,</span>&nbsp;<span class="ident" id="1563876">i</span><span class="op" id="1563877">)</span><span class="op" id="1563878">)</span><span class="op" id="1563879">)</span>&nbsp;<span class="comment" id="1563881">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563925">if</span>&nbsp;<span class="ident" id="1563928">x</span>&nbsp;<span class="op" id="1563930">==</span>&nbsp;<span class="ident" id="1563933">empty</span>&nbsp;<span class="op" id="1563939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563945">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1563957">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1563962">return</span>&nbsp;<span class="ident" id="1563969">add</span><span class="op" id="1563972">(</span><span class="ident" id="1563973">unsafe</span><span class="op" id="1563979">.</span><span class="ident" id="1563980">Pointer</span><span class="op" id="1563987">(</span><span class="ident" id="1563988">b</span><span class="op" id="1563989">)</span><span class="op" id="1563990">,</span>&nbsp;<span class="ident" id="1563992">dataOffset</span><span class="op" id="1564002">+</span><span class="ident" id="1564003">bucketCnt</span><span class="op" id="1564012">*</span><span class="num" id="1564013">8</span><span class="op" id="1564014">+</span><span class="ident" id="1564015">i</span><span class="op" id="1564016">*</span><span class="builtintype" id="1564017">uintptr</span><span class="op" id="1564024">(</span><span class="ident" id="1564025">t</span><span class="op" id="1564026">.</span><span class="ident" id="1564027">valuesize</span><span class="op" id="1564036">)</span><span class="op" id="1564037">)</span><span class="op" id="1564038">,</span>&nbsp;<span class="builtintype" id="1564040">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1564047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1564051">b</span>&nbsp;<span class="op" id="1564053">=</span>&nbsp;<span class="ident" id="1564055">b</span><span class="op" id="1564056">.</span><span class="ident" id="1564057">overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1564068">if</span>&nbsp;<span class="ident" id="1564071">b</span>&nbsp;<span class="op" id="1564073">==</span>&nbsp;<span class="ident" id="1564076">nil</span>&nbsp;<span class="op" id="1564080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1564085">return</span>&nbsp;<span class="ident" id="1564092">unsafe</span><span class="op" id="1564098">.</span><span class="ident" id="1564099">Pointer</span><span class="op" id="1564106">(</span><span class="ident" id="1564107">t</span><span class="op" id="1564108">.</span><span class="ident" id="1564109">elem</span><span class="op" id="1564113">.</span><span class="ident" id="1564114">zero</span><span class="op" id="1564118">)</span><span class="op" id="1564119">,</span>&nbsp;<span class="builtintype" id="1564121">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1564129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1564132">}</span><br>
<span class="lineno"></span><span class="op" id="1564134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1564137">func</span>&nbsp;<span class="ident" id="1564142">mapaccess1_faststr</span><span class="op" id="1564160">(</span><span class="ident" id="1564161">t</span>&nbsp;<span class="op" id="1564163">*</span><span class="ident" id="1564164">maptype</span><span class="op" id="1564171">,</span>&nbsp;<span class="ident" id="1564173">h</span>&nbsp;<span class="op" id="1564175">*</span><span class="ident" id="1564176">hmap</span><span class="op" id="1564180">,</span>&nbsp;<span class="ident" id="1564182">ky</span>&nbsp;<span class="builtintype" id="1564185">string</span><span class="op" id="1564191">)</span>&nbsp;<span class="ident" id="1564193">unsafe</span><span class="op" id="1564199">.</span><span class="ident" id="1564200">Pointer</span>&nbsp;<span class="op" id="1564208">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1564211">if</span>&nbsp;<span class="ident" id="1564214">raceenabled</span>&nbsp;<span class="op" id="1564226">&amp;&amp;</span>&nbsp;<span class="ident" id="1564229">h</span>&nbsp;<span class="op" id="1564231">!=</span>&nbsp;<span class="ident" id="1564234">nil</span>&nbsp;<span class="op" id="1564238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1564242">callerpc</span>&nbsp;<span class="op" id="1564251">:=</span>&nbsp;<span class="ident" id="1564254">getcallerpc</span><span class="op" id="1564265">(</span><span class="ident" id="1564266">unsafe</span><span class="op" id="1564272">.</span><span class="ident" id="1564273">Pointer</span><span class="op" id="1564280">(</span><span class="op" id="1564281">&amp;</span><span class="ident" id="1564282">t</span><span class="op" id="1564283">)</span><span class="op" id="1564284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1564288">racereadpc</span><span class="op" id="1564298">(</span><span class="ident" id="1564299">unsafe</span><span class="op" id="1564305">.</span><span class="ident" id="1564306">Pointer</span><span class="op" id="1564313">(</span><span class="ident" id="1564314">h</span><span class="op" id="1564315">)</span><span class="op" id="1564316">,</span>&nbsp;<span class="ident" id="1564318">callerpc</span><span class="op" id="1564326">,</span>&nbsp;<span class="ident" id="1564328">funcPC</span><span class="op" id="1564334">(</span><span class="ident" id="1564335">mapaccess1_faststr</span><span class="op" id="1564353">)</span><span class="op" id="1564354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1564357">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1564360">if</span>&nbsp;<span class="ident" id="1564363">h</span>&nbsp;<span class="op" id="1564365">==</span>&nbsp;<span class="ident" id="1564368">nil</span>&nbsp;<span class="op" id="1564372">||</span>&nbsp;<span class="ident" id="1564375">h</span><span class="op" id="1564376">.</span><span class="ident" id="1564377">count</span>&nbsp;<span class="op" id="1564383">==</span>&nbsp;<span class="num" id="1564386">0</span>&nbsp;<span class="op" id="1564388">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1564392">return</span>&nbsp;<span class="ident" id="1564399">unsafe</span><span class="op" id="1564405">.</span><span class="ident" id="1564406">Pointer</span><span class="op" id="1564413">(</span><span class="ident" id="1564414">t</span><span class="op" id="1564415">.</span><span class="ident" id="1564416">elem</span><span class="op" id="1564420">.</span><span class="ident" id="1564421">zero</span><span class="op" id="1564425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1564428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1564431">key</span>&nbsp;<span class="op" id="1564435">:=</span>&nbsp;<span class="op" id="1564438">(</span><span class="op" id="1564439">*</span><span class="ident" id="1564440">stringStruct</span><span class="op" id="1564452">)</span><span class="op" id="1564453">(</span><span class="ident" id="1564454">unsafe</span><span class="op" id="1564460">.</span><span class="ident" id="1564461">Pointer</span><span class="op" id="1564468">(</span><span class="op" id="1564469">&amp;</span><span class="ident" id="1564470">ky</span><span class="op" id="1564472">)</span><span class="op" id="1564473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1564476">if</span>&nbsp;<span class="ident" id="1564479">h</span><span class="op" id="1564480">.</span><span class="ident" id="1564481">B</span>&nbsp;<span class="op" id="1564483">==</span>&nbsp;<span class="num" id="1564486">0</span>&nbsp;<span class="op" id="1564488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1564492">//&nbsp;One-bucket&nbsp;table.</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1564515">b</span>&nbsp;<span class="op" id="1564517">:=</span>&nbsp;<span class="op" id="1564520">(</span><span class="op" id="1564521">*</span><span class="ident" id="1564522">bmap</span><span class="op" id="1564526">)</span><span class="op" id="1564527">(</span><span class="ident" id="1564528">h</span><span class="op" id="1564529">.</span><span class="ident" id="1564530">buckets</span><span class="op" id="1564537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1564541">if</span>&nbsp;<span class="ident" id="1564544">key</span><span class="op" id="1564547">.</span><span class="builtinfunc" id="1564548">len</span>&nbsp;<span class="op" id="1564552">&lt;</span>&nbsp;<span class="num" id="1564554">32</span>&nbsp;<span class="op" id="1564557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1564562">//&nbsp;short&nbsp;key,&nbsp;doing&nbsp;lots&nbsp;of&nbsp;comparisons&nbsp;is&nbsp;ok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1564611">for</span>&nbsp;<span class="ident" id="1564615">i</span>&nbsp;<span class="op" id="1564617">:=</span>&nbsp;<span class="builtintype" id="1564620">uintptr</span><span class="op" id="1564627">(</span><span class="num" id="1564628">0</span><span class="op" id="1564629">)</span><span class="op" id="1564630">;</span>&nbsp;<span class="ident" id="1564632">i</span>&nbsp;<span class="op" id="1564634">&lt;</span>&nbsp;<span class="ident" id="1564636">bucketCnt</span><span class="op" id="1564645">;</span>&nbsp;<span class="ident" id="1564647">i</span><span class="op" id="1564648">++</span>&nbsp;<span class="op" id="1564651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1564657">x</span>&nbsp;<span class="op" id="1564659">:=</span>&nbsp;<span class="op" id="1564662">*</span><span class="op" id="1564663">(</span><span class="op" id="1564664">(</span><span class="op" id="1564665">*</span><span class="builtintype" id="1564666">uint8</span><span class="op" id="1564671">)</span><span class="op" id="1564672">(</span><span class="ident" id="1564673">add</span><span class="op" id="1564676">(</span><span class="ident" id="1564677">unsafe</span><span class="op" id="1564683">.</span><span class="ident" id="1564684">Pointer</span><span class="op" id="1564691">(</span><span class="ident" id="1564692">b</span><span class="op" id="1564693">)</span><span class="op" id="1564694">,</span>&nbsp;<span class="ident" id="1564696">i</span><span class="op" id="1564697">)</span><span class="op" id="1564698">)</span><span class="op" id="1564699">)</span>&nbsp;<span class="comment" id="1564701">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1564746">if</span>&nbsp;<span class="ident" id="1564749">x</span>&nbsp;<span class="op" id="1564751">==</span>&nbsp;<span class="ident" id="1564754">empty</span>&nbsp;<span class="op" id="1564760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1564767">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1564780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1564786">k</span>&nbsp;<span class="op" id="1564788">:=</span>&nbsp;<span class="op" id="1564791">(</span><span class="op" id="1564792">*</span><span class="ident" id="1564793">stringStruct</span><span class="op" id="1564805">)</span><span class="op" id="1564806">(</span><span class="ident" id="1564807">add</span><span class="op" id="1564810">(</span><span class="ident" id="1564811">unsafe</span><span class="op" id="1564817">.</span><span class="ident" id="1564818">Pointer</span><span class="op" id="1564825">(</span><span class="ident" id="1564826">b</span><span class="op" id="1564827">)</span><span class="op" id="1564828">,</span>&nbsp;<span class="ident" id="1564830">dataOffset</span><span class="op" id="1564840">+</span><span class="ident" id="1564841">i</span><span class="op" id="1564842">*</span><span class="num" id="1564843">2</span><span class="op" id="1564844">*</span><span class="ident" id="1564845">ptrSize</span><span class="op" id="1564852">)</span><span class="op" id="1564853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1564859">if</span>&nbsp;<span class="ident" id="1564862">k</span><span class="op" id="1564863">.</span><span class="builtinfunc" id="1564864">len</span>&nbsp;<span class="op" id="1564868">!=</span>&nbsp;<span class="ident" id="1564871">key</span><span class="op" id="1564874">.</span><span class="builtinfunc" id="1564875">len</span>&nbsp;<span class="op" id="1564879">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1564886">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1564899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1564905">if</span>&nbsp;<span class="ident" id="1564908">k</span><span class="op" id="1564909">.</span><span class="ident" id="1564910">str</span>&nbsp;<span class="op" id="1564914">==</span>&nbsp;<span class="ident" id="1564917">key</span><span class="op" id="1564920">.</span><span class="ident" id="1564921">str</span>&nbsp;<span class="op" id="1564925">||</span>&nbsp;<span class="ident" id="1564928">memeq</span><span class="op" id="1564933">(</span><span class="ident" id="1564934">k</span><span class="op" id="1564935">.</span><span class="ident" id="1564936">str</span><span class="op" id="1564939">,</span>&nbsp;<span class="ident" id="1564941">key</span><span class="op" id="1564944">.</span><span class="ident" id="1564945">str</span><span class="op" id="1564948">,</span>&nbsp;<span class="builtintype" id="1564950">uintptr</span><span class="op" id="1564957">(</span><span class="ident" id="1564958">key</span><span class="op" id="1564961">.</span><span class="builtinfunc" id="1564962">len</span><span class="op" id="1564965">)</span><span class="op" id="1564966">)</span>&nbsp;<span class="op" id="1564968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1564975">return</span>&nbsp;<span class="ident" id="1564982">add</span><span class="op" id="1564985">(</span><span class="ident" id="1564986">unsafe</span><span class="op" id="1564992">.</span><span class="ident" id="1564993">Pointer</span><span class="op" id="1565000">(</span><span class="ident" id="1565001">b</span><span class="op" id="1565002">)</span><span class="op" id="1565003">,</span>&nbsp;<span class="ident" id="1565005">dataOffset</span><span class="op" id="1565015">+</span><span class="ident" id="1565016">bucketCnt</span><span class="op" id="1565025">*</span><span class="num" id="1565026">2</span><span class="op" id="1565027">*</span><span class="ident" id="1565028">ptrSize</span><span class="op" id="1565035">+</span><span class="ident" id="1565036">i</span><span class="op" id="1565037">*</span><span class="builtintype" id="1565038">uintptr</span><span class="op" id="1565045">(</span><span class="ident" id="1565046">t</span><span class="op" id="1565047">.</span><span class="ident" id="1565048">valuesize</span><span class="op" id="1565057">)</span><span class="op" id="1565058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1565064">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1565069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1565074">return</span>&nbsp;<span class="ident" id="1565081">unsafe</span><span class="op" id="1565087">.</span><span class="ident" id="1565088">Pointer</span><span class="op" id="1565095">(</span><span class="ident" id="1565096">t</span><span class="op" id="1565097">.</span><span class="ident" id="1565098">elem</span><span class="op" id="1565102">.</span><span class="ident" id="1565103">zero</span><span class="op" id="1565107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1565111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1565115">//&nbsp;long&nbsp;key,&nbsp;try&nbsp;not&nbsp;to&nbsp;do&nbsp;more&nbsp;comparisons&nbsp;than&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1565176">keymaybe</span>&nbsp;<span class="op" id="1565185">:=</span>&nbsp;<span class="builtintype" id="1565188">uintptr</span><span class="op" id="1565195">(</span><span class="ident" id="1565196">bucketCnt</span><span class="op" id="1565205">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1565209">for</span>&nbsp;<span class="ident" id="1565213">i</span>&nbsp;<span class="op" id="1565215">:=</span>&nbsp;<span class="builtintype" id="1565218">uintptr</span><span class="op" id="1565225">(</span><span class="num" id="1565226">0</span><span class="op" id="1565227">)</span><span class="op" id="1565228">;</span>&nbsp;<span class="ident" id="1565230">i</span>&nbsp;<span class="op" id="1565232">&lt;</span>&nbsp;<span class="ident" id="1565234">bucketCnt</span><span class="op" id="1565243">;</span>&nbsp;<span class="ident" id="1565245">i</span><span class="op" id="1565246">++</span>&nbsp;<span class="op" id="1565249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1565254">x</span>&nbsp;<span class="op" id="1565256">:=</span>&nbsp;<span class="op" id="1565259">*</span><span class="op" id="1565260">(</span><span class="op" id="1565261">(</span><span class="op" id="1565262">*</span><span class="builtintype" id="1565263">uint8</span><span class="op" id="1565268">)</span><span class="op" id="1565269">(</span><span class="ident" id="1565270">add</span><span class="op" id="1565273">(</span><span class="ident" id="1565274">unsafe</span><span class="op" id="1565280">.</span><span class="ident" id="1565281">Pointer</span><span class="op" id="1565288">(</span><span class="ident" id="1565289">b</span><span class="op" id="1565290">)</span><span class="op" id="1565291">,</span>&nbsp;<span class="ident" id="1565293">i</span><span class="op" id="1565294">)</span><span class="op" id="1565295">)</span><span class="op" id="1565296">)</span>&nbsp;<span class="comment" id="1565298">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1565342">if</span>&nbsp;<span class="ident" id="1565345">x</span>&nbsp;<span class="op" id="1565347">==</span>&nbsp;<span class="ident" id="1565350">empty</span>&nbsp;<span class="op" id="1565356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1565362">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1565374">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1565379">k</span>&nbsp;<span class="op" id="1565381">:=</span>&nbsp;<span class="op" id="1565384">(</span><span class="op" id="1565385">*</span><span class="ident" id="1565386">stringStruct</span><span class="op" id="1565398">)</span><span class="op" id="1565399">(</span><span class="ident" id="1565400">add</span><span class="op" id="1565403">(</span><span class="ident" id="1565404">unsafe</span><span class="op" id="1565410">.</span><span class="ident" id="1565411">Pointer</span><span class="op" id="1565418">(</span><span class="ident" id="1565419">b</span><span class="op" id="1565420">)</span><span class="op" id="1565421">,</span>&nbsp;<span class="ident" id="1565423">dataOffset</span><span class="op" id="1565433">+</span><span class="ident" id="1565434">i</span><span class="op" id="1565435">*</span><span class="num" id="1565436">2</span><span class="op" id="1565437">*</span><span class="ident" id="1565438">ptrSize</span><span class="op" id="1565445">)</span><span class="op" id="1565446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1565451">if</span>&nbsp;<span class="ident" id="1565454">k</span><span class="op" id="1565455">.</span><span class="builtinfunc" id="1565456">len</span>&nbsp;<span class="op" id="1565460">!=</span>&nbsp;<span class="ident" id="1565463">key</span><span class="op" id="1565466">.</span><span class="builtinfunc" id="1565467">len</span>&nbsp;<span class="op" id="1565471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1565477">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1565489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1565494">if</span>&nbsp;<span class="ident" id="1565497">k</span><span class="op" id="1565498">.</span><span class="ident" id="1565499">str</span>&nbsp;<span class="op" id="1565503">==</span>&nbsp;<span class="ident" id="1565506">key</span><span class="op" id="1565509">.</span><span class="ident" id="1565510">str</span>&nbsp;<span class="op" id="1565514">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1565520">return</span>&nbsp;<span class="ident" id="1565527">add</span><span class="op" id="1565530">(</span><span class="ident" id="1565531">unsafe</span><span class="op" id="1565537">.</span><span class="ident" id="1565538">Pointer</span><span class="op" id="1565545">(</span><span class="ident" id="1565546">b</span><span class="op" id="1565547">)</span><span class="op" id="1565548">,</span>&nbsp;<span class="ident" id="1565550">dataOffset</span><span class="op" id="1565560">+</span><span class="ident" id="1565561">bucketCnt</span><span class="op" id="1565570">*</span><span class="num" id="1565571">2</span><span class="op" id="1565572">*</span><span class="ident" id="1565573">ptrSize</span><span class="op" id="1565580">+</span><span class="ident" id="1565581">i</span><span class="op" id="1565582">*</span><span class="builtintype" id="1565583">uintptr</span><span class="op" id="1565590">(</span><span class="ident" id="1565591">t</span><span class="op" id="1565592">.</span><span class="ident" id="1565593">valuesize</span><span class="op" id="1565602">)</span><span class="op" id="1565603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1565608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1565613">//&nbsp;check&nbsp;first&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1565639">//&nbsp;TODO:&nbsp;on&nbsp;amd64/386&nbsp;at&nbsp;least,&nbsp;make&nbsp;this&nbsp;compile&nbsp;to&nbsp;one&nbsp;4-byte&nbsp;comparison&nbsp;instead&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1565728">//&nbsp;four&nbsp;1-byte&nbsp;comparisons.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1565759">if</span>&nbsp;<span class="op" id="1565762">*</span><span class="op" id="1565763">(</span><span class="op" id="1565764">(</span><span class="op" id="1565765">*</span><span class="op" id="1565766">[</span><span class="num" id="1565767">4</span><span class="op" id="1565768">]</span><span class="builtintype" id="1565769">byte</span><span class="op" id="1565773">)</span><span class="op" id="1565774">(</span><span class="ident" id="1565775">key</span><span class="op" id="1565778">.</span><span class="ident" id="1565779">str</span><span class="op" id="1565782">)</span><span class="op" id="1565783">)</span>&nbsp;<span class="op" id="1565785">!=</span>&nbsp;<span class="op" id="1565788">*</span><span class="op" id="1565789">(</span><span class="op" id="1565790">(</span><span class="op" id="1565791">*</span><span class="op" id="1565792">[</span><span class="num" id="1565793">4</span><span class="op" id="1565794">]</span><span class="builtintype" id="1565795">byte</span><span class="op" id="1565799">)</span><span class="op" id="1565800">(</span><span class="ident" id="1565801">k</span><span class="op" id="1565802">.</span><span class="ident" id="1565803">str</span><span class="op" id="1565806">)</span><span class="op" id="1565807">)</span>&nbsp;<span class="op" id="1565809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1565815">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1565827">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1565832">//&nbsp;check&nbsp;last&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1565857">if</span>&nbsp;<span class="op" id="1565860">*</span><span class="op" id="1565861">(</span><span class="op" id="1565862">(</span><span class="op" id="1565863">*</span><span class="op" id="1565864">[</span><span class="num" id="1565865">4</span><span class="op" id="1565866">]</span><span class="builtintype" id="1565867">byte</span><span class="op" id="1565871">)</span><span class="op" id="1565872">(</span><span class="ident" id="1565873">add</span><span class="op" id="1565876">(</span><span class="ident" id="1565877">key</span><span class="op" id="1565880">.</span><span class="ident" id="1565881">str</span><span class="op" id="1565884">,</span>&nbsp;<span class="builtintype" id="1565886">uintptr</span><span class="op" id="1565893">(</span><span class="ident" id="1565894">key</span><span class="op" id="1565897">.</span><span class="builtinfunc" id="1565898">len</span><span class="op" id="1565901">)</span><span class="op" id="1565902">-</span><span class="num" id="1565903">4</span><span class="op" id="1565904">)</span><span class="op" id="1565905">)</span><span class="op" id="1565906">)</span>&nbsp;<span class="op" id="1565908">!=</span>&nbsp;<span class="op" id="1565911">*</span><span class="op" id="1565912">(</span><span class="op" id="1565913">(</span><span class="op" id="1565914">*</span><span class="op" id="1565915">[</span><span class="num" id="1565916">4</span><span class="op" id="1565917">]</span><span class="builtintype" id="1565918">byte</span><span class="op" id="1565922">)</span><span class="op" id="1565923">(</span><span class="ident" id="1565924">add</span><span class="op" id="1565927">(</span><span class="ident" id="1565928">k</span><span class="op" id="1565929">.</span><span class="ident" id="1565930">str</span><span class="op" id="1565933">,</span>&nbsp;<span class="builtintype" id="1565935">uintptr</span><span class="op" id="1565942">(</span><span class="ident" id="1565943">key</span><span class="op" id="1565946">.</span><span class="builtinfunc" id="1565947">len</span><span class="op" id="1565950">)</span><span class="op" id="1565951">-</span><span class="num" id="1565952">4</span><span class="op" id="1565953">)</span><span class="op" id="1565954">)</span><span class="op" id="1565955">)</span>&nbsp;<span class="op" id="1565957">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1565963">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1565975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1565980">if</span>&nbsp;<span class="ident" id="1565983">keymaybe</span>&nbsp;<span class="op" id="1565992">!=</span>&nbsp;<span class="ident" id="1565995">bucketCnt</span>&nbsp;<span class="op" id="1566005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1566011">//&nbsp;Two&nbsp;keys&nbsp;are&nbsp;potential&nbsp;matches.&nbsp;&nbsp;Use&nbsp;hash&nbsp;to&nbsp;distinguish&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1566081">goto</span>&nbsp;<span class="ident" id="1566086">dohash</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1566096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1566101">keymaybe</span>&nbsp;<span class="op" id="1566110">=</span>&nbsp;<span class="ident" id="1566112">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1566116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1566120">if</span>&nbsp;<span class="ident" id="1566123">keymaybe</span>&nbsp;<span class="op" id="1566132">!=</span>&nbsp;<span class="ident" id="1566135">bucketCnt</span>&nbsp;<span class="op" id="1566145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1566150">k</span>&nbsp;<span class="op" id="1566152">:=</span>&nbsp;<span class="op" id="1566155">(</span><span class="op" id="1566156">*</span><span class="ident" id="1566157">stringStruct</span><span class="op" id="1566169">)</span><span class="op" id="1566170">(</span><span class="ident" id="1566171">add</span><span class="op" id="1566174">(</span><span class="ident" id="1566175">unsafe</span><span class="op" id="1566181">.</span><span class="ident" id="1566182">Pointer</span><span class="op" id="1566189">(</span><span class="ident" id="1566190">b</span><span class="op" id="1566191">)</span><span class="op" id="1566192">,</span>&nbsp;<span class="ident" id="1566194">dataOffset</span><span class="op" id="1566204">+</span><span class="ident" id="1566205">keymaybe</span><span class="op" id="1566213">*</span><span class="num" id="1566214">2</span><span class="op" id="1566215">*</span><span class="ident" id="1566216">ptrSize</span><span class="op" id="1566223">)</span><span class="op" id="1566224">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1566229">if</span>&nbsp;<span class="ident" id="1566232">memeq</span><span class="op" id="1566237">(</span><span class="ident" id="1566238">k</span><span class="op" id="1566239">.</span><span class="ident" id="1566240">str</span><span class="op" id="1566243">,</span>&nbsp;<span class="ident" id="1566245">key</span><span class="op" id="1566248">.</span><span class="ident" id="1566249">str</span><span class="op" id="1566252">,</span>&nbsp;<span class="builtintype" id="1566254">uintptr</span><span class="op" id="1566261">(</span><span class="ident" id="1566262">key</span><span class="op" id="1566265">.</span><span class="builtinfunc" id="1566266">len</span><span class="op" id="1566269">)</span><span class="op" id="1566270">)</span>&nbsp;<span class="op" id="1566272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1566278">return</span>&nbsp;<span class="ident" id="1566285">add</span><span class="op" id="1566288">(</span><span class="ident" id="1566289">unsafe</span><span class="op" id="1566295">.</span><span class="ident" id="1566296">Pointer</span><span class="op" id="1566303">(</span><span class="ident" id="1566304">b</span><span class="op" id="1566305">)</span><span class="op" id="1566306">,</span>&nbsp;<span class="ident" id="1566308">dataOffset</span><span class="op" id="1566318">+</span><span class="ident" id="1566319">bucketCnt</span><span class="op" id="1566328">*</span><span class="num" id="1566329">2</span><span class="op" id="1566330">*</span><span class="ident" id="1566331">ptrSize</span><span class="op" id="1566338">+</span><span class="ident" id="1566339">keymaybe</span><span class="op" id="1566347">*</span><span class="builtintype" id="1566348">uintptr</span><span class="op" id="1566355">(</span><span class="ident" id="1566356">t</span><span class="op" id="1566357">.</span><span class="ident" id="1566358">valuesize</span><span class="op" id="1566367">)</span><span class="op" id="1566368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1566373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1566377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1566381">return</span>&nbsp;<span class="ident" id="1566388">unsafe</span><span class="op" id="1566394">.</span><span class="ident" id="1566395">Pointer</span><span class="op" id="1566402">(</span><span class="ident" id="1566403">t</span><span class="op" id="1566404">.</span><span class="ident" id="1566405">elem</span><span class="op" id="1566409">.</span><span class="ident" id="1566410">zero</span><span class="op" id="1566414">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1566417">}</span><br>
<span class="lineno"></span><span class="ident" id="1566419">dohash</span><span class="op" id="1566425">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1566428">hash</span>&nbsp;<span class="op" id="1566433">:=</span>&nbsp;<span class="ident" id="1566436">goalg</span><span class="op" id="1566441">(</span><span class="ident" id="1566442">t</span><span class="op" id="1566443">.</span><span class="ident" id="1566444">key</span><span class="op" id="1566447">.</span><span class="ident" id="1566448">alg</span><span class="op" id="1566451">)</span><span class="op" id="1566452">.</span><span class="ident" id="1566453">hash</span><span class="op" id="1566457">(</span><span class="ident" id="1566458">noescape</span><span class="op" id="1566466">(</span><span class="ident" id="1566467">unsafe</span><span class="op" id="1566473">.</span><span class="ident" id="1566474">Pointer</span><span class="op" id="1566481">(</span><span class="op" id="1566482">&amp;</span><span class="ident" id="1566483">ky</span><span class="op" id="1566485">)</span><span class="op" id="1566486">)</span><span class="op" id="1566487">,</span>&nbsp;<span class="num" id="1566489">2</span><span class="op" id="1566490">*</span><span class="ident" id="1566491">ptrSize</span><span class="op" id="1566498">,</span>&nbsp;<span class="builtintype" id="1566500">uintptr</span><span class="op" id="1566507">(</span><span class="ident" id="1566508">h</span><span class="op" id="1566509">.</span><span class="ident" id="1566510">hash0</span><span class="op" id="1566515">)</span><span class="op" id="1566516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1566519">m</span>&nbsp;<span class="op" id="1566521">:=</span>&nbsp;<span class="builtintype" id="1566524">uintptr</span><span class="op" id="1566531">(</span><span class="num" id="1566532">1</span><span class="op" id="1566533">)</span><span class="op" id="1566534">&lt;&lt;</span><span class="ident" id="1566536">h</span><span class="op" id="1566537">.</span><span class="ident" id="1566538">B</span>&nbsp;<span class="op" id="1566540">-</span>&nbsp;<span class="num" id="1566542">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1566545">b</span>&nbsp;<span class="op" id="1566547">:=</span>&nbsp;<span class="op" id="1566550">(</span><span class="op" id="1566551">*</span><span class="ident" id="1566552">bmap</span><span class="op" id="1566556">)</span><span class="op" id="1566557">(</span><span class="ident" id="1566558">add</span><span class="op" id="1566561">(</span><span class="ident" id="1566562">h</span><span class="op" id="1566563">.</span><span class="ident" id="1566564">buckets</span><span class="op" id="1566571">,</span>&nbsp;<span class="op" id="1566573">(</span><span class="ident" id="1566574">hash</span><span class="op" id="1566578">&amp;</span><span class="ident" id="1566579">m</span><span class="op" id="1566580">)</span><span class="op" id="1566581">*</span><span class="builtintype" id="1566582">uintptr</span><span class="op" id="1566589">(</span><span class="ident" id="1566590">t</span><span class="op" id="1566591">.</span><span class="ident" id="1566592">bucketsize</span><span class="op" id="1566602">)</span><span class="op" id="1566603">)</span><span class="op" id="1566604">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1566607">if</span>&nbsp;<span class="ident" id="1566610">c</span>&nbsp;<span class="op" id="1566612">:=</span>&nbsp;<span class="ident" id="1566615">h</span><span class="op" id="1566616">.</span><span class="ident" id="1566617">oldbuckets</span><span class="op" id="1566627">;</span>&nbsp;<span class="ident" id="1566629">c</span>&nbsp;<span class="op" id="1566631">!=</span>&nbsp;<span class="ident" id="1566634">nil</span>&nbsp;<span class="op" id="1566638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1566642">oldb</span>&nbsp;<span class="op" id="1566647">:=</span>&nbsp;<span class="op" id="1566650">(</span><span class="op" id="1566651">*</span><span class="ident" id="1566652">bmap</span><span class="op" id="1566656">)</span><span class="op" id="1566657">(</span><span class="ident" id="1566658">add</span><span class="op" id="1566661">(</span><span class="ident" id="1566662">c</span><span class="op" id="1566663">,</span>&nbsp;<span class="op" id="1566665">(</span><span class="ident" id="1566666">hash</span><span class="op" id="1566670">&amp;</span><span class="op" id="1566671">(</span><span class="ident" id="1566672">m</span><span class="op" id="1566673">&gt;&gt;</span><span class="num" id="1566675">1</span><span class="op" id="1566676">)</span><span class="op" id="1566677">)</span><span class="op" id="1566678">*</span><span class="builtintype" id="1566679">uintptr</span><span class="op" id="1566686">(</span><span class="ident" id="1566687">t</span><span class="op" id="1566688">.</span><span class="ident" id="1566689">bucketsize</span><span class="op" id="1566699">)</span><span class="op" id="1566700">)</span><span class="op" id="1566701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1566705">if</span>&nbsp;<span class="op" id="1566708">!</span><span class="ident" id="1566709">evacuated</span><span class="op" id="1566718">(</span><span class="ident" id="1566719">oldb</span><span class="op" id="1566723">)</span>&nbsp;<span class="op" id="1566725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1566730">b</span>&nbsp;<span class="op" id="1566732">=</span>&nbsp;<span class="ident" id="1566734">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1566741">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1566744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1566747">top</span>&nbsp;<span class="op" id="1566751">:=</span>&nbsp;<span class="builtintype" id="1566754">uint8</span><span class="op" id="1566759">(</span><span class="ident" id="1566760">hash</span>&nbsp;<span class="op" id="1566765">&gt;&gt;</span>&nbsp;<span class="op" id="1566768">(</span><span class="ident" id="1566769">ptrSize</span><span class="op" id="1566776">*</span><span class="num" id="1566777">8</span>&nbsp;<span class="op" id="1566779">-</span>&nbsp;<span class="num" id="1566781">8</span><span class="op" id="1566782">)</span><span class="op" id="1566783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1566786">if</span>&nbsp;<span class="ident" id="1566789">top</span>&nbsp;<span class="op" id="1566793">&lt;</span>&nbsp;<span class="ident" id="1566795">minTopHash</span>&nbsp;<span class="op" id="1566806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1566810">top</span>&nbsp;<span class="op" id="1566814">+=</span>&nbsp;<span class="ident" id="1566817">minTopHash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1566829">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1566832">for</span>&nbsp;<span class="op" id="1566836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1566840">for</span>&nbsp;<span class="ident" id="1566844">i</span>&nbsp;<span class="op" id="1566846">:=</span>&nbsp;<span class="builtintype" id="1566849">uintptr</span><span class="op" id="1566856">(</span><span class="num" id="1566857">0</span><span class="op" id="1566858">)</span><span class="op" id="1566859">;</span>&nbsp;<span class="ident" id="1566861">i</span>&nbsp;<span class="op" id="1566863">&lt;</span>&nbsp;<span class="ident" id="1566865">bucketCnt</span><span class="op" id="1566874">;</span>&nbsp;<span class="ident" id="1566876">i</span><span class="op" id="1566877">++</span>&nbsp;<span class="op" id="1566880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1566885">x</span>&nbsp;<span class="op" id="1566887">:=</span>&nbsp;<span class="op" id="1566890">*</span><span class="op" id="1566891">(</span><span class="op" id="1566892">(</span><span class="op" id="1566893">*</span><span class="builtintype" id="1566894">uint8</span><span class="op" id="1566899">)</span><span class="op" id="1566900">(</span><span class="ident" id="1566901">add</span><span class="op" id="1566904">(</span><span class="ident" id="1566905">unsafe</span><span class="op" id="1566911">.</span><span class="ident" id="1566912">Pointer</span><span class="op" id="1566919">(</span><span class="ident" id="1566920">b</span><span class="op" id="1566921">)</span><span class="op" id="1566922">,</span>&nbsp;<span class="ident" id="1566924">i</span><span class="op" id="1566925">)</span><span class="op" id="1566926">)</span><span class="op" id="1566927">)</span>&nbsp;<span class="comment" id="1566929">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1566973">if</span>&nbsp;<span class="ident" id="1566976">x</span>&nbsp;<span class="op" id="1566978">!=</span>&nbsp;<span class="ident" id="1566981">top</span>&nbsp;<span class="op" id="1566985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1566991">continue</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1567003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1567008">k</span>&nbsp;<span class="op" id="1567010">:=</span>&nbsp;<span class="op" id="1567013">(</span><span class="op" id="1567014">*</span><span class="ident" id="1567015">stringStruct</span><span class="op" id="1567027">)</span><span class="op" id="1567028">(</span><span class="ident" id="1567029">add</span><span class="op" id="1567032">(</span><span class="ident" id="1567033">unsafe</span><span class="op" id="1567039">.</span><span class="ident" id="1567040">Pointer</span><span class="op" id="1567047">(</span><span class="ident" id="1567048">b</span><span class="op" id="1567049">)</span><span class="op" id="1567050">,</span>&nbsp;<span class="ident" id="1567052">dataOffset</span><span class="op" id="1567062">+</span><span class="ident" id="1567063">i</span><span class="op" id="1567064">*</span><span class="num" id="1567065">2</span><span class="op" id="1567066">*</span><span class="ident" id="1567067">ptrSize</span><span class="op" id="1567074">)</span><span class="op" id="1567075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567080">if</span>&nbsp;<span class="ident" id="1567083">k</span><span class="op" id="1567084">.</span><span class="builtinfunc" id="1567085">len</span>&nbsp;<span class="op" id="1567089">!=</span>&nbsp;<span class="ident" id="1567092">key</span><span class="op" id="1567095">.</span><span class="builtinfunc" id="1567096">len</span>&nbsp;<span class="op" id="1567100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567106">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1567118">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567123">if</span>&nbsp;<span class="ident" id="1567126">k</span><span class="op" id="1567127">.</span><span class="ident" id="1567128">str</span>&nbsp;<span class="op" id="1567132">==</span>&nbsp;<span class="ident" id="1567135">key</span><span class="op" id="1567138">.</span><span class="ident" id="1567139">str</span>&nbsp;<span class="op" id="1567143">||</span>&nbsp;<span class="ident" id="1567146">memeq</span><span class="op" id="1567151">(</span><span class="ident" id="1567152">k</span><span class="op" id="1567153">.</span><span class="ident" id="1567154">str</span><span class="op" id="1567157">,</span>&nbsp;<span class="ident" id="1567159">key</span><span class="op" id="1567162">.</span><span class="ident" id="1567163">str</span><span class="op" id="1567166">,</span>&nbsp;<span class="builtintype" id="1567168">uintptr</span><span class="op" id="1567175">(</span><span class="ident" id="1567176">key</span><span class="op" id="1567179">.</span><span class="builtinfunc" id="1567180">len</span><span class="op" id="1567183">)</span><span class="op" id="1567184">)</span>&nbsp;<span class="op" id="1567186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567192">return</span>&nbsp;<span class="ident" id="1567199">add</span><span class="op" id="1567202">(</span><span class="ident" id="1567203">unsafe</span><span class="op" id="1567209">.</span><span class="ident" id="1567210">Pointer</span><span class="op" id="1567217">(</span><span class="ident" id="1567218">b</span><span class="op" id="1567219">)</span><span class="op" id="1567220">,</span>&nbsp;<span class="ident" id="1567222">dataOffset</span><span class="op" id="1567232">+</span><span class="ident" id="1567233">bucketCnt</span><span class="op" id="1567242">*</span><span class="num" id="1567243">2</span><span class="op" id="1567244">*</span><span class="ident" id="1567245">ptrSize</span><span class="op" id="1567252">+</span><span class="ident" id="1567253">i</span><span class="op" id="1567254">*</span><span class="builtintype" id="1567255">uintptr</span><span class="op" id="1567262">(</span><span class="ident" id="1567263">t</span><span class="op" id="1567264">.</span><span class="ident" id="1567265">valuesize</span><span class="op" id="1567274">)</span><span class="op" id="1567275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1567280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1567284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1567288">b</span>&nbsp;<span class="op" id="1567290">=</span>&nbsp;<span class="ident" id="1567292">b</span><span class="op" id="1567293">.</span><span class="ident" id="1567294">overflow</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567305">if</span>&nbsp;<span class="ident" id="1567308">b</span>&nbsp;<span class="op" id="1567310">==</span>&nbsp;<span class="ident" id="1567313">nil</span>&nbsp;<span class="op" id="1567317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567322">return</span>&nbsp;<span class="ident" id="1567329">unsafe</span><span class="op" id="1567335">.</span><span class="ident" id="1567336">Pointer</span><span class="op" id="1567343">(</span><span class="ident" id="1567344">t</span><span class="op" id="1567345">.</span><span class="ident" id="1567346">elem</span><span class="op" id="1567350">.</span><span class="ident" id="1567351">zero</span><span class="op" id="1567355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1567359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1567362">}</span><br>
<span class="lineno"></span><span class="op" id="1567364">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="keyword" id="1567367">func</span>&nbsp;<span class="ident" id="1567372">mapaccess2_faststr</span><span class="op" id="1567390">(</span><span class="ident" id="1567391">t</span>&nbsp;<span class="op" id="1567393">*</span><span class="ident" id="1567394">maptype</span><span class="op" id="1567401">,</span>&nbsp;<span class="ident" id="1567403">h</span>&nbsp;<span class="op" id="1567405">*</span><span class="ident" id="1567406">hmap</span><span class="op" id="1567410">,</span>&nbsp;<span class="ident" id="1567412">ky</span>&nbsp;<span class="builtintype" id="1567415">string</span><span class="op" id="1567421">)</span>&nbsp;<span class="op" id="1567423">(</span><span class="ident" id="1567424">unsafe</span><span class="op" id="1567430">.</span><span class="ident" id="1567431">Pointer</span><span class="op" id="1567438">,</span>&nbsp;<span class="builtintype" id="1567440">bool</span><span class="op" id="1567444">)</span>&nbsp;<span class="op" id="1567446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567449">if</span>&nbsp;<span class="ident" id="1567452">raceenabled</span>&nbsp;<span class="op" id="1567464">&amp;&amp;</span>&nbsp;<span class="ident" id="1567467">h</span>&nbsp;<span class="op" id="1567469">!=</span>&nbsp;<span class="ident" id="1567472">nil</span>&nbsp;<span class="op" id="1567476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1567480">callerpc</span>&nbsp;<span class="op" id="1567489">:=</span>&nbsp;<span class="ident" id="1567492">getcallerpc</span><span class="op" id="1567503">(</span><span class="ident" id="1567504">unsafe</span><span class="op" id="1567510">.</span><span class="ident" id="1567511">Pointer</span><span class="op" id="1567518">(</span><span class="op" id="1567519">&amp;</span><span class="ident" id="1567520">t</span><span class="op" id="1567521">)</span><span class="op" id="1567522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1567526">racereadpc</span><span class="op" id="1567536">(</span><span class="ident" id="1567537">unsafe</span><span class="op" id="1567543">.</span><span class="ident" id="1567544">Pointer</span><span class="op" id="1567551">(</span><span class="ident" id="1567552">h</span><span class="op" id="1567553">)</span><span class="op" id="1567554">,</span>&nbsp;<span class="ident" id="1567556">callerpc</span><span class="op" id="1567564">,</span>&nbsp;<span class="ident" id="1567566">funcPC</span><span class="op" id="1567572">(</span><span class="ident" id="1567573">mapaccess2_faststr</span><span class="op" id="1567591">)</span><span class="op" id="1567592">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1567595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567598">if</span>&nbsp;<span class="ident" id="1567601">h</span>&nbsp;<span class="op" id="1567603">==</span>&nbsp;<span class="ident" id="1567606">nil</span>&nbsp;<span class="op" id="1567610">||</span>&nbsp;<span class="ident" id="1567613">h</span><span class="op" id="1567614">.</span><span class="ident" id="1567615">count</span>&nbsp;<span class="op" id="1567621">==</span>&nbsp;<span class="num" id="1567624">0</span>&nbsp;<span class="op" id="1567626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567630">return</span>&nbsp;<span class="ident" id="1567637">unsafe</span><span class="op" id="1567643">.</span><span class="ident" id="1567644">Pointer</span><span class="op" id="1567651">(</span><span class="ident" id="1567652">t</span><span class="op" id="1567653">.</span><span class="ident" id="1567654">elem</span><span class="op" id="1567658">.</span><span class="ident" id="1567659">zero</span><span class="op" id="1567663">)</span><span class="op" id="1567664">,</span>&nbsp;<span class="builtintype" id="1567666">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1567673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1567676">key</span>&nbsp;<span class="op" id="1567680">:=</span>&nbsp;<span class="op" id="1567683">(</span><span class="op" id="1567684">*</span><span class="ident" id="1567685">stringStruct</span><span class="op" id="1567697">)</span><span class="op" id="1567698">(</span><span class="ident" id="1567699">unsafe</span><span class="op" id="1567705">.</span><span class="ident" id="1567706">Pointer</span><span class="op" id="1567713">(</span><span class="op" id="1567714">&amp;</span><span class="ident" id="1567715">ky</span><span class="op" id="1567717">)</span><span class="op" id="1567718">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567721">if</span>&nbsp;<span class="ident" id="1567724">h</span><span class="op" id="1567725">.</span><span class="ident" id="1567726">B</span>&nbsp;<span class="op" id="1567728">==</span>&nbsp;<span class="num" id="1567731">0</span>&nbsp;<span class="op" id="1567733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1567737">//&nbsp;One-bucket&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1567760">b</span>&nbsp;<span class="op" id="1567762">:=</span>&nbsp;<span class="op" id="1567765">(</span><span class="op" id="1567766">*</span><span class="ident" id="1567767">bmap</span><span class="op" id="1567771">)</span><span class="op" id="1567772">(</span><span class="ident" id="1567773">h</span><span class="op" id="1567774">.</span><span class="ident" id="1567775">buckets</span><span class="op" id="1567782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567786">if</span>&nbsp;<span class="ident" id="1567789">key</span><span class="op" id="1567792">.</span><span class="builtinfunc" id="1567793">len</span>&nbsp;<span class="op" id="1567797">&lt;</span>&nbsp;<span class="num" id="1567799">32</span>&nbsp;<span class="op" id="1567802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1567807">//&nbsp;short&nbsp;key,&nbsp;doing&nbsp;lots&nbsp;of&nbsp;comparisons&nbsp;is&nbsp;ok</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567856">for</span>&nbsp;<span class="ident" id="1567860">i</span>&nbsp;<span class="op" id="1567862">:=</span>&nbsp;<span class="builtintype" id="1567865">uintptr</span><span class="op" id="1567872">(</span><span class="num" id="1567873">0</span><span class="op" id="1567874">)</span><span class="op" id="1567875">;</span>&nbsp;<span class="ident" id="1567877">i</span>&nbsp;<span class="op" id="1567879">&lt;</span>&nbsp;<span class="ident" id="1567881">bucketCnt</span><span class="op" id="1567890">;</span>&nbsp;<span class="ident" id="1567892">i</span><span class="op" id="1567893">++</span>&nbsp;<span class="op" id="1567896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1567902">x</span>&nbsp;<span class="op" id="1567904">:=</span>&nbsp;<span class="op" id="1567907">*</span><span class="op" id="1567908">(</span><span class="op" id="1567909">(</span><span class="op" id="1567910">*</span><span class="builtintype" id="1567911">uint8</span><span class="op" id="1567916">)</span><span class="op" id="1567917">(</span><span class="ident" id="1567918">add</span><span class="op" id="1567921">(</span><span class="ident" id="1567922">unsafe</span><span class="op" id="1567928">.</span><span class="ident" id="1567929">Pointer</span><span class="op" id="1567936">(</span><span class="ident" id="1567937">b</span><span class="op" id="1567938">)</span><span class="op" id="1567939">,</span>&nbsp;<span class="ident" id="1567941">i</span><span class="op" id="1567942">)</span><span class="op" id="1567943">)</span><span class="op" id="1567944">)</span>&nbsp;<span class="comment" id="1567946">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1567991">if</span>&nbsp;<span class="ident" id="1567994">x</span>&nbsp;<span class="op" id="1567996">==</span>&nbsp;<span class="ident" id="1567999">empty</span>&nbsp;<span class="op" id="1568005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568012">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1568025">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1568031">k</span>&nbsp;<span class="op" id="1568033">:=</span>&nbsp;<span class="op" id="1568036">(</span><span class="op" id="1568037">*</span><span class="ident" id="1568038">stringStruct</span><span class="op" id="1568050">)</span><span class="op" id="1568051">(</span><span class="ident" id="1568052">add</span><span class="op" id="1568055">(</span><span class="ident" id="1568056">unsafe</span><span class="op" id="1568062">.</span><span class="ident" id="1568063">Pointer</span><span class="op" id="1568070">(</span><span class="ident" id="1568071">b</span><span class="op" id="1568072">)</span><span class="op" id="1568073">,</span>&nbsp;<span class="ident" id="1568075">dataOffset</span><span class="op" id="1568085">+</span><span class="ident" id="1568086">i</span><span class="op" id="1568087">*</span><span class="num" id="1568088">2</span><span class="op" id="1568089">*</span><span class="ident" id="1568090">ptrSize</span><span class="op" id="1568097">)</span><span class="op" id="1568098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568104">if</span>&nbsp;<span class="ident" id="1568107">k</span><span class="op" id="1568108">.</span><span class="builtinfunc" id="1568109">len</span>&nbsp;<span class="op" id="1568113">!=</span>&nbsp;<span class="ident" id="1568116">key</span><span class="op" id="1568119">.</span><span class="builtinfunc" id="1568120">len</span>&nbsp;<span class="op" id="1568124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568131">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1568144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568150">if</span>&nbsp;<span class="ident" id="1568153">k</span><span class="op" id="1568154">.</span><span class="ident" id="1568155">str</span>&nbsp;<span class="op" id="1568159">==</span>&nbsp;<span class="ident" id="1568162">key</span><span class="op" id="1568165">.</span><span class="ident" id="1568166">str</span>&nbsp;<span class="op" id="1568170">||</span>&nbsp;<span class="ident" id="1568173">memeq</span><span class="op" id="1568178">(</span><span class="ident" id="1568179">k</span><span class="op" id="1568180">.</span><span class="ident" id="1568181">str</span><span class="op" id="1568184">,</span>&nbsp;<span class="ident" id="1568186">key</span><span class="op" id="1568189">.</span><span class="ident" id="1568190">str</span><span class="op" id="1568193">,</span>&nbsp;<span class="builtintype" id="1568195">uintptr</span><span class="op" id="1568202">(</span><span class="ident" id="1568203">key</span><span class="op" id="1568206">.</span><span class="builtinfunc" id="1568207">len</span><span class="op" id="1568210">)</span><span class="op" id="1568211">)</span>&nbsp;<span class="op" id="1568213">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568220">return</span>&nbsp;<span class="ident" id="1568227">add</span><span class="op" id="1568230">(</span><span class="ident" id="1568231">unsafe</span><span class="op" id="1568237">.</span><span class="ident" id="1568238">Pointer</span><span class="op" id="1568245">(</span><span class="ident" id="1568246">b</span><span class="op" id="1568247">)</span><span class="op" id="1568248">,</span>&nbsp;<span class="ident" id="1568250">dataOffset</span><span class="op" id="1568260">+</span><span class="ident" id="1568261">bucketCnt</span><span class="op" id="1568270">*</span><span class="num" id="1568271">2</span><span class="op" id="1568272">*</span><span class="ident" id="1568273">ptrSize</span><span class="op" id="1568280">+</span><span class="ident" id="1568281">i</span><span class="op" id="1568282">*</span><span class="builtintype" id="1568283">uintptr</span><span class="op" id="1568290">(</span><span class="ident" id="1568291">t</span><span class="op" id="1568292">.</span><span class="ident" id="1568293">valuesize</span><span class="op" id="1568302">)</span><span class="op" id="1568303">)</span><span class="op" id="1568304">,</span>&nbsp;<span class="builtintype" id="1568306">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1568315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1568320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568325">return</span>&nbsp;<span class="ident" id="1568332">unsafe</span><span class="op" id="1568338">.</span><span class="ident" id="1568339">Pointer</span><span class="op" id="1568346">(</span><span class="ident" id="1568347">t</span><span class="op" id="1568348">.</span><span class="ident" id="1568349">elem</span><span class="op" id="1568353">.</span><span class="ident" id="1568354">zero</span><span class="op" id="1568358">)</span><span class="op" id="1568359">,</span>&nbsp;<span class="builtintype" id="1568361">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1568369">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1568373">//&nbsp;long&nbsp;key,&nbsp;try&nbsp;not&nbsp;to&nbsp;do&nbsp;more&nbsp;comparisons&nbsp;than&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1568434">keymaybe</span>&nbsp;<span class="op" id="1568443">:=</span>&nbsp;<span class="builtintype" id="1568446">uintptr</span><span class="op" id="1568453">(</span><span class="ident" id="1568454">bucketCnt</span><span class="op" id="1568463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568467">for</span>&nbsp;<span class="ident" id="1568471">i</span>&nbsp;<span class="op" id="1568473">:=</span>&nbsp;<span class="builtintype" id="1568476">uintptr</span><span class="op" id="1568483">(</span><span class="num" id="1568484">0</span><span class="op" id="1568485">)</span><span class="op" id="1568486">;</span>&nbsp;<span class="ident" id="1568488">i</span>&nbsp;<span class="op" id="1568490">&lt;</span>&nbsp;<span class="ident" id="1568492">bucketCnt</span><span class="op" id="1568501">;</span>&nbsp;<span class="ident" id="1568503">i</span><span class="op" id="1568504">++</span>&nbsp;<span class="op" id="1568507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1568512">x</span>&nbsp;<span class="op" id="1568514">:=</span>&nbsp;<span class="op" id="1568517">*</span><span class="op" id="1568518">(</span><span class="op" id="1568519">(</span><span class="op" id="1568520">*</span><span class="builtintype" id="1568521">uint8</span><span class="op" id="1568526">)</span><span class="op" id="1568527">(</span><span class="ident" id="1568528">add</span><span class="op" id="1568531">(</span><span class="ident" id="1568532">unsafe</span><span class="op" id="1568538">.</span><span class="ident" id="1568539">Pointer</span><span class="op" id="1568546">(</span><span class="ident" id="1568547">b</span><span class="op" id="1568548">)</span><span class="op" id="1568549">,</span>&nbsp;<span class="ident" id="1568551">i</span><span class="op" id="1568552">)</span><span class="op" id="1568553">)</span><span class="op" id="1568554">)</span>&nbsp;<span class="comment" id="1568556">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568600">if</span>&nbsp;<span class="ident" id="1568603">x</span>&nbsp;<span class="op" id="1568605">==</span>&nbsp;<span class="ident" id="1568608">empty</span>&nbsp;<span class="op" id="1568614">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568620">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1568632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1568637">k</span>&nbsp;<span class="op" id="1568639">:=</span>&nbsp;<span class="op" id="1568642">(</span><span class="op" id="1568643">*</span><span class="ident" id="1568644">stringStruct</span><span class="op" id="1568656">)</span><span class="op" id="1568657">(</span><span class="ident" id="1568658">add</span><span class="op" id="1568661">(</span><span class="ident" id="1568662">unsafe</span><span class="op" id="1568668">.</span><span class="ident" id="1568669">Pointer</span><span class="op" id="1568676">(</span><span class="ident" id="1568677">b</span><span class="op" id="1568678">)</span><span class="op" id="1568679">,</span>&nbsp;<span class="ident" id="1568681">dataOffset</span><span class="op" id="1568691">+</span><span class="ident" id="1568692">i</span><span class="op" id="1568693">*</span><span class="num" id="1568694">2</span><span class="op" id="1568695">*</span><span class="ident" id="1568696">ptrSize</span><span class="op" id="1568703">)</span><span class="op" id="1568704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568709">if</span>&nbsp;<span class="ident" id="1568712">k</span><span class="op" id="1568713">.</span><span class="builtinfunc" id="1568714">len</span>&nbsp;<span class="op" id="1568718">!=</span>&nbsp;<span class="ident" id="1568721">key</span><span class="op" id="1568724">.</span><span class="builtinfunc" id="1568725">len</span>&nbsp;<span class="op" id="1568729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568735">continue</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1568747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568752">if</span>&nbsp;<span class="ident" id="1568755">k</span><span class="op" id="1568756">.</span><span class="ident" id="1568757">str</span>&nbsp;<span class="op" id="1568761">==</span>&nbsp;<span class="ident" id="1568764">key</span><span class="op" id="1568767">.</span><span class="ident" id="1568768">str</span>&nbsp;<span class="op" id="1568772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568778">return</span>&nbsp;<span class="ident" id="1568785">add</span><span class="op" id="1568788">(</span><span class="ident" id="1568789">unsafe</span><span class="op" id="1568795">.</span><span class="ident" id="1568796">Pointer</span><span class="op" id="1568803">(</span><span class="ident" id="1568804">b</span><span class="op" id="1568805">)</span><span class="op" id="1568806">,</span>&nbsp;<span class="ident" id="1568808">dataOffset</span><span class="op" id="1568818">+</span><span class="ident" id="1568819">bucketCnt</span><span class="op" id="1568828">*</span><span class="num" id="1568829">2</span><span class="op" id="1568830">*</span><span class="ident" id="1568831">ptrSize</span><span class="op" id="1568838">+</span><span class="ident" id="1568839">i</span><span class="op" id="1568840">*</span><span class="builtintype" id="1568841">uintptr</span><span class="op" id="1568848">(</span><span class="ident" id="1568849">t</span><span class="op" id="1568850">.</span><span class="ident" id="1568851">valuesize</span><span class="op" id="1568860">)</span><span class="op" id="1568861">)</span><span class="op" id="1568862">,</span>&nbsp;<span class="builtintype" id="1568864">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1568872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1568877">//&nbsp;check&nbsp;first&nbsp;4&nbsp;bytes</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568903">if</span>&nbsp;<span class="op" id="1568906">*</span><span class="op" id="1568907">(</span><span class="op" id="1568908">(</span><span class="op" id="1568909">*</span><span class="op" id="1568910">[</span><span class="num" id="1568911">4</span><span class="op" id="1568912">]</span><span class="builtintype" id="1568913">byte</span><span class="op" id="1568917">)</span><span class="op" id="1568918">(</span><span class="ident" id="1568919">key</span><span class="op" id="1568922">.</span><span class="ident" id="1568923">str</span><span class="op" id="1568926">)</span><span class="op" id="1568927">)</span>&nbsp;<span class="op" id="1568929">!=</span>&nbsp;<span class="op" id="1568932">*</span><span class="op" id="1568933">(</span><span class="op" id="1568934">(</span><span class="op" id="1568935">*</span><span class="op" id="1568936">[</span><span class="num" id="1568937">4</span><span class="op" id="1568938">]</span><span class="builtintype" id="1568939">byte</span><span class="op" id="1568943">)</span><span class="op" id="1568944">(</span><span class="ident" id="1568945">k</span><span class="op" id="1568946">.</span><span class="ident" id="1568947">str</span><span class="op" id="1568950">)</span><span class="op" id="1568951">)</span>&nbsp;<span class="op" id="1568953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1568959">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1568971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1568976">//&nbsp;check&nbsp;last&nbsp;4&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569001">if</span>&nbsp;<span class="op" id="1569004">*</span><span class="op" id="1569005">(</span><span class="op" id="1569006">(</span><span class="op" id="1569007">*</span><span class="op" id="1569008">[</span><span class="num" id="1569009">4</span><span class="op" id="1569010">]</span><span class="builtintype" id="1569011">byte</span><span class="op" id="1569015">)</span><span class="op" id="1569016">(</span><span class="ident" id="1569017">add</span><span class="op" id="1569020">(</span><span class="ident" id="1569021">key</span><span class="op" id="1569024">.</span><span class="ident" id="1569025">str</span><span class="op" id="1569028">,</span>&nbsp;<span class="builtintype" id="1569030">uintptr</span><span class="op" id="1569037">(</span><span class="ident" id="1569038">key</span><span class="op" id="1569041">.</span><span class="builtinfunc" id="1569042">len</span><span class="op" id="1569045">)</span><span class="op" id="1569046">-</span><span class="num" id="1569047">4</span><span class="op" id="1569048">)</span><span class="op" id="1569049">)</span><span class="op" id="1569050">)</span>&nbsp;<span class="op" id="1569052">!=</span>&nbsp;<span class="op" id="1569055">*</span><span class="op" id="1569056">(</span><span class="op" id="1569057">(</span><span class="op" id="1569058">*</span><span class="op" id="1569059">[</span><span class="num" id="1569060">4</span><span class="op" id="1569061">]</span><span class="builtintype" id="1569062">byte</span><span class="op" id="1569066">)</span><span class="op" id="1569067">(</span><span class="ident" id="1569068">add</span><span class="op" id="1569071">(</span><span class="ident" id="1569072">k</span><span class="op" id="1569073">.</span><span class="ident" id="1569074">str</span><span class="op" id="1569077">,</span>&nbsp;<span class="builtintype" id="1569079">uintptr</span><span class="op" id="1569086">(</span><span class="ident" id="1569087">key</span><span class="op" id="1569090">.</span><span class="builtinfunc" id="1569091">len</span><span class="op" id="1569094">)</span><span class="op" id="1569095">-</span><span class="num" id="1569096">4</span><span class="op" id="1569097">)</span><span class="op" id="1569098">)</span><span class="op" id="1569099">)</span>&nbsp;<span class="op" id="1569101">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569107">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1569119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569124">if</span>&nbsp;<span class="ident" id="1569127">keymaybe</span>&nbsp;<span class="op" id="1569136">!=</span>&nbsp;<span class="ident" id="1569139">bucketCnt</span>&nbsp;<span class="op" id="1569149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="1569155">//&nbsp;Two&nbsp;keys&nbsp;are&nbsp;potential&nbsp;matches.&nbsp;&nbsp;Use&nbsp;hash&nbsp;to&nbsp;distinguish&nbsp;them.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569225">goto</span>&nbsp;<span class="ident" id="1569230">dohash</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1569240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1569245">keymaybe</span>&nbsp;<span class="op" id="1569254">=</span>&nbsp;<span class="ident" id="1569256">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1569260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569264">if</span>&nbsp;<span class="ident" id="1569267">keymaybe</span>&nbsp;<span class="op" id="1569276">!=</span>&nbsp;<span class="ident" id="1569279">bucketCnt</span>&nbsp;<span class="op" id="1569289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1569294">k</span>&nbsp;<span class="op" id="1569296">:=</span>&nbsp;<span class="op" id="1569299">(</span><span class="op" id="1569300">*</span><span class="ident" id="1569301">stringStruct</span><span class="op" id="1569313">)</span><span class="op" id="1569314">(</span><span class="ident" id="1569315">add</span><span class="op" id="1569318">(</span><span class="ident" id="1569319">unsafe</span><span class="op" id="1569325">.</span><span class="ident" id="1569326">Pointer</span><span class="op" id="1569333">(</span><span class="ident" id="1569334">b</span><span class="op" id="1569335">)</span><span class="op" id="1569336">,</span>&nbsp;<span class="ident" id="1569338">dataOffset</span><span class="op" id="1569348">+</span><span class="ident" id="1569349">keymaybe</span><span class="op" id="1569357">*</span><span class="num" id="1569358">2</span><span class="op" id="1569359">*</span><span class="ident" id="1569360">ptrSize</span><span class="op" id="1569367">)</span><span class="op" id="1569368">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569373">if</span>&nbsp;<span class="ident" id="1569376">memeq</span><span class="op" id="1569381">(</span><span class="ident" id="1569382">k</span><span class="op" id="1569383">.</span><span class="ident" id="1569384">str</span><span class="op" id="1569387">,</span>&nbsp;<span class="ident" id="1569389">key</span><span class="op" id="1569392">.</span><span class="ident" id="1569393">str</span><span class="op" id="1569396">,</span>&nbsp;<span class="builtintype" id="1569398">uintptr</span><span class="op" id="1569405">(</span><span class="ident" id="1569406">key</span><span class="op" id="1569409">.</span><span class="builtinfunc" id="1569410">len</span><span class="op" id="1569413">)</span><span class="op" id="1569414">)</span>&nbsp;<span class="op" id="1569416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569422">return</span>&nbsp;<span class="ident" id="1569429">add</span><span class="op" id="1569432">(</span><span class="ident" id="1569433">unsafe</span><span class="op" id="1569439">.</span><span class="ident" id="1569440">Pointer</span><span class="op" id="1569447">(</span><span class="ident" id="1569448">b</span><span class="op" id="1569449">)</span><span class="op" id="1569450">,</span>&nbsp;<span class="ident" id="1569452">dataOffset</span><span class="op" id="1569462">+</span><span class="ident" id="1569463">bucketCnt</span><span class="op" id="1569472">*</span><span class="num" id="1569473">2</span><span class="op" id="1569474">*</span><span class="ident" id="1569475">ptrSize</span><span class="op" id="1569482">+</span><span class="ident" id="1569483">keymaybe</span><span class="op" id="1569491">*</span><span class="builtintype" id="1569492">uintptr</span><span class="op" id="1569499">(</span><span class="ident" id="1569500">t</span><span class="op" id="1569501">.</span><span class="ident" id="1569502">valuesize</span><span class="op" id="1569511">)</span><span class="op" id="1569512">)</span><span class="op" id="1569513">,</span>&nbsp;<span class="builtintype" id="1569515">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1569523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1569527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569531">return</span>&nbsp;<span class="ident" id="1569538">unsafe</span><span class="op" id="1569544">.</span><span class="ident" id="1569545">Pointer</span><span class="op" id="1569552">(</span><span class="ident" id="1569553">t</span><span class="op" id="1569554">.</span><span class="ident" id="1569555">elem</span><span class="op" id="1569559">.</span><span class="ident" id="1569560">zero</span><span class="op" id="1569564">)</span><span class="op" id="1569565">,</span>&nbsp;<span class="builtintype" id="1569567">false</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1569574">}</span><br>
<span class="lineno"></span><span class="ident" id="1569576">dohash</span><span class="op" id="1569582">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1569585">hash</span>&nbsp;<span class="op" id="1569590">:=</span>&nbsp;<span class="ident" id="1569593">goalg</span><span class="op" id="1569598">(</span><span class="ident" id="1569599">t</span><span class="op" id="1569600">.</span><span class="ident" id="1569601">key</span><span class="op" id="1569604">.</span><span class="ident" id="1569605">alg</span><span class="op" id="1569608">)</span><span class="op" id="1569609">.</span><span class="ident" id="1569610">hash</span><span class="op" id="1569614">(</span><span class="ident" id="1569615">noescape</span><span class="op" id="1569623">(</span><span class="ident" id="1569624">unsafe</span><span class="op" id="1569630">.</span><span class="ident" id="1569631">Pointer</span><span class="op" id="1569638">(</span><span class="op" id="1569639">&amp;</span><span class="ident" id="1569640">ky</span><span class="op" id="1569642">)</span><span class="op" id="1569643">)</span><span class="op" id="1569644">,</span>&nbsp;<span class="num" id="1569646">2</span><span class="op" id="1569647">*</span><span class="ident" id="1569648">ptrSize</span><span class="op" id="1569655">,</span>&nbsp;<span class="builtintype" id="1569657">uintptr</span><span class="op" id="1569664">(</span><span class="ident" id="1569665">h</span><span class="op" id="1569666">.</span><span class="ident" id="1569667">hash0</span><span class="op" id="1569672">)</span><span class="op" id="1569673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1569676">m</span>&nbsp;<span class="op" id="1569678">:=</span>&nbsp;<span class="builtintype" id="1569681">uintptr</span><span class="op" id="1569688">(</span><span class="num" id="1569689">1</span><span class="op" id="1569690">)</span><span class="op" id="1569691">&lt;&lt;</span><span class="ident" id="1569693">h</span><span class="op" id="1569694">.</span><span class="ident" id="1569695">B</span>&nbsp;<span class="op" id="1569697">-</span>&nbsp;<span class="num" id="1569699">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1569702">b</span>&nbsp;<span class="op" id="1569704">:=</span>&nbsp;<span class="op" id="1569707">(</span><span class="op" id="1569708">*</span><span class="ident" id="1569709">bmap</span><span class="op" id="1569713">)</span><span class="op" id="1569714">(</span><span class="ident" id="1569715">add</span><span class="op" id="1569718">(</span><span class="ident" id="1569719">h</span><span class="op" id="1569720">.</span><span class="ident" id="1569721">buckets</span><span class="op" id="1569728">,</span>&nbsp;<span class="op" id="1569730">(</span><span class="ident" id="1569731">hash</span><span class="op" id="1569735">&amp;</span><span class="ident" id="1569736">m</span><span class="op" id="1569737">)</span><span class="op" id="1569738">*</span><span class="builtintype" id="1569739">uintptr</span><span class="op" id="1569746">(</span><span class="ident" id="1569747">t</span><span class="op" id="1569748">.</span><span class="ident" id="1569749">bucketsize</span><span class="op" id="1569759">)</span><span class="op" id="1569760">)</span><span class="op" id="1569761">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569764">if</span>&nbsp;<span class="ident" id="1569767">c</span>&nbsp;<span class="op" id="1569769">:=</span>&nbsp;<span class="ident" id="1569772">h</span><span class="op" id="1569773">.</span><span class="ident" id="1569774">oldbuckets</span><span class="op" id="1569784">;</span>&nbsp;<span class="ident" id="1569786">c</span>&nbsp;<span class="op" id="1569788">!=</span>&nbsp;<span class="ident" id="1569791">nil</span>&nbsp;<span class="op" id="1569795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1569799">oldb</span>&nbsp;<span class="op" id="1569804">:=</span>&nbsp;<span class="op" id="1569807">(</span><span class="op" id="1569808">*</span><span class="ident" id="1569809">bmap</span><span class="op" id="1569813">)</span><span class="op" id="1569814">(</span><span class="ident" id="1569815">add</span><span class="op" id="1569818">(</span><span class="ident" id="1569819">c</span><span class="op" id="1569820">,</span>&nbsp;<span class="op" id="1569822">(</span><span class="ident" id="1569823">hash</span><span class="op" id="1569827">&amp;</span><span class="op" id="1569828">(</span><span class="ident" id="1569829">m</span><span class="op" id="1569830">&gt;&gt;</span><span class="num" id="1569832">1</span><span class="op" id="1569833">)</span><span class="op" id="1569834">)</span><span class="op" id="1569835">*</span><span class="builtintype" id="1569836">uintptr</span><span class="op" id="1569843">(</span><span class="ident" id="1569844">t</span><span class="op" id="1569845">.</span><span class="ident" id="1569846">bucketsize</span><span class="op" id="1569856">)</span><span class="op" id="1569857">)</span><span class="op" id="1569858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569862">if</span>&nbsp;<span class="op" id="1569865">!</span><span class="ident" id="1569866">evacuated</span><span class="op" id="1569875">(</span><span class="ident" id="1569876">oldb</span><span class="op" id="1569880">)</span>&nbsp;<span class="op" id="1569882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1569887">b</span>&nbsp;<span class="op" id="1569889">=</span>&nbsp;<span class="ident" id="1569891">oldb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1569898">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1569901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1569904">top</span>&nbsp;<span class="op" id="1569908">:=</span>&nbsp;<span class="builtintype" id="1569911">uint8</span><span class="op" id="1569916">(</span><span class="ident" id="1569917">hash</span>&nbsp;<span class="op" id="1569922">&gt;&gt;</span>&nbsp;<span class="op" id="1569925">(</span><span class="ident" id="1569926">ptrSize</span><span class="op" id="1569933">*</span><span class="num" id="1569934">8</span>&nbsp;<span class="op" id="1569936">-</span>&nbsp;<span class="num" id="1569938">8</span><span class="op" id="1569939">)</span><span class="op" id="1569940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569943">if</span>&nbsp;<span class="ident" id="1569946">top</span>&nbsp;<span class="op" id="1569950">&lt;</span>&nbsp;<span class="ident" id="1569952">minTopHash</span>&nbsp;<span class="op" id="1569963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1569967">top</span>&nbsp;<span class="op" id="1569971">+=</span>&nbsp;<span class="ident" id="1569974">minTopHash</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1569986">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569989">for</span>&nbsp;<span class="op" id="1569993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1569997">for</span>&nbsp;<span class="ident" id="1570001">i</span>&nbsp;<span class="op" id="1570003">:=</span>&nbsp;<span class="builtintype" id="1570006">uintptr</span><span class="op" id="1570013">(</span><span class="num" id="1570014">0</span><span class="op" id="1570015">)</span><span class="op" id="1570016">;</span>&nbsp;<span class="ident" id="1570018">i</span>&nbsp;<span class="op" id="1570020">&lt;</span>&nbsp;<span class="ident" id="1570022">bucketCnt</span><span class="op" id="1570031">;</span>&nbsp;<span class="ident" id="1570033">i</span><span class="op" id="1570034">++</span>&nbsp;<span class="op" id="1570037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1570042">x</span>&nbsp;<span class="op" id="1570044">:=</span>&nbsp;<span class="op" id="1570047">*</span><span class="op" id="1570048">(</span><span class="op" id="1570049">(</span><span class="op" id="1570050">*</span><span class="builtintype" id="1570051">uint8</span><span class="op" id="1570056">)</span><span class="op" id="1570057">(</span><span class="ident" id="1570058">add</span><span class="op" id="1570061">(</span><span class="ident" id="1570062">unsafe</span><span class="op" id="1570068">.</span><span class="ident" id="1570069">Pointer</span><span class="op" id="1570076">(</span><span class="ident" id="1570077">b</span><span class="op" id="1570078">)</span><span class="op" id="1570079">,</span>&nbsp;<span class="ident" id="1570081">i</span><span class="op" id="1570082">)</span><span class="op" id="1570083">)</span><span class="op" id="1570084">)</span>&nbsp;<span class="comment" id="1570086">//&nbsp;b.topbits[i]&nbsp;without&nbsp;the&nbsp;bounds&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1570130">if</span>&nbsp;<span class="ident" id="1570133">x</span>&nbsp;<span class="op" id="1570135">!=</span>&nbsp;<span class="ident" id="1570138">top</span>&nbsp;<span class="op" id="1570142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1570148">continue</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1570160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1570165">k</span>&nbsp;<span class="op" id="1570167">:=</span>&nbsp;<span class="op" id="1570170">(</span><span class="op" id="1570171">*</span><span class="ident" id="1570172">stringStruct</span><span class="op" id="1570184">)</span><span class="op" id="1570185">(</span><span class="ident" id="1570186">add</span><span class="op" id="1570189">(</span><span class="ident" id="1570190">unsafe</span><span class="op" id="1570196">.</span><span class="ident" id="1570197">Pointer</span><span class="op" id="1570204">(</span><span class="ident" id="1570205">b</span><span class="op" id="1570206">)</span><span class="op" id="1570207">,</span>&nbsp;<span class="ident" id="1570209">dataOffset</span><span class="op" id="1570219">+</span><span class="ident" id="1570220">i</span><span class="op" id="1570221">*</span><span class="num" id="1570222">2</span><span class="op" id="1570223">*</span><span class="ident" id="1570224">ptrSize</span><span class="op" id="1570231">)</span><span class="op" id="1570232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1570237">if</span>&nbsp;<span class="ident" id="1570240">k</span><span class="op" id="1570241">.</span><span class="builtinfunc" id="1570242">len</span>&nbsp;<span class="op" id="1570246">!=</span>&nbsp;<span class="ident" id="1570249">key</span><span class="op" id="1570252">.</span><span class="builtinfunc" id="1570253">len</span>&nbsp;<span class="op" id="1570257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1570263">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1570275">}</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1570280">if</span>&nbsp;<span class="ident" id="1570283">k</span><span class="op" id="1570284">.</span><span class="ident" id="1570285">str</span>&nbsp;<span class="op" id="1570289">==</span>&nbsp;<span class="ident" id="1570292">key</span><span class="op" id="1570295">.</span><span class="ident" id="1570296">str</span>&nbsp;<span class="op" id="1570300">||</span>&nbsp;<span class="ident" id="1570303">memeq</span><span class="op" id="1570308">(</span><span class="ident" id="1570309">k</span><span class="op" id="1570310">.</span><span class="ident" id="1570311">str</span><span class="op" id="1570314">,</span>&nbsp;<span class="ident" id="1570316">key</span><span class="op" id="1570319">.</span><span class="ident" id="1570320">str</span><span class="op" id="1570323">,</span>&nbsp;<span class="builtintype" id="1570325">uintptr</span><span class="op" id="1570332">(</span><span class="ident" id="1570333">key</span><span class="op" id="1570336">.</span><span class="builtinfunc" id="1570337">len</span><span class="op" id="1570340">)</span><span class="op" id="1570341">)</span>&nbsp;<span class="op" id="1570343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1570349">return</span>&nbsp;<span class="ident" id="1570356">add</span><span class="op" id="1570359">(</span><span class="ident" id="1570360">unsafe</span><span class="op" id="1570366">.</span><span class="ident" id="1570367">Pointer</span><span class="op" id="1570374">(</span><span class="ident" id="1570375">b</span><span class="op" id="1570376">)</span><span class="op" id="1570377">,</span>&nbsp;<span class="ident" id="1570379">dataOffset</span><span class="op" id="1570389">+</span><span class="ident" id="1570390">bucketCnt</span><span class="op" id="1570399">*</span><span class="num" id="1570400">2</span><span class="op" id="1570401">*</span><span class="ident" id="1570402">ptrSize</span><span class="op" id="1570409">+</span><span class="ident" id="1570410">i</span><span class="op" id="1570411">*</span><span class="builtintype" id="1570412">uintptr</span><span class="op" id="1570419">(</span><span class="ident" id="1570420">t</span><span class="op" id="1570421">.</span><span class="ident" id="1570422">valuesize</span><span class="op" id="1570431">)</span><span class="op" id="1570432">)</span><span class="op" id="1570433">,</span>&nbsp;<span class="builtintype" id="1570435">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1570443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1570447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1570451">b</span>&nbsp;<span class="op" id="1570453">=</span>&nbsp;<span class="ident" id="1570455">b</span><span class="op" id="1570456">.</span><span class="ident" id="1570457">overflow</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1570468">if</span>&nbsp;<span class="ident" id="1570471">b</span>&nbsp;<span class="op" id="1570473">==</span>&nbsp;<span class="ident" id="1570476">nil</span>&nbsp;<span class="op" id="1570480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1570485">return</span>&nbsp;<span class="ident" id="1570492">unsafe</span><span class="op" id="1570498">.</span><span class="ident" id="1570499">Pointer</span><span class="op" id="1570506">(</span><span class="ident" id="1570507">t</span><span class="op" id="1570508">.</span><span class="ident" id="1570509">elem</span><span class="op" id="1570513">.</span><span class="ident" id="1570514">zero</span><span class="op" id="1570518">)</span><span class="op" id="1570519">,</span>&nbsp;<span class="builtintype" id="1570521">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1570529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1570532">}</span><br>
<span class="lineno"></span><span class="op" id="1570534">}</span>
</div>
</body>
</html>
