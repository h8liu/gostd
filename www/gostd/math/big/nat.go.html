<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>math/big</h2>
<ul>
<li><a href="/gostd/math/big/arith.go.html">arith.go</a></li>
<li><a href="/gostd/math/big/arith_decl.go.html">arith_decl.go</a></li>
<li><a href="/gostd/math/big/arith_test.go.html">arith_test.go</a></li>
<li><a href="/gostd/math/big/calibrate_test.go.html">calibrate_test.go</a></li>
<li><a href="/gostd/math/big/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/math/big/gcd_test.go.html">gcd_test.go</a></li>
<li><a href="/gostd/math/big/hilbert_test.go.html">hilbert_test.go</a></li>
<li><a href="/gostd/math/big/int.go.html">int.go</a></li>
<li><a href="/gostd/math/big/int_test.go.html">int_test.go</a></li>
<li><a href="/gostd/math/big/nat.go.html" class="current">nat.go</a></li>
<li><a href="/gostd/math/big/nat_test.go.html">nat_test.go</a></li>
<li><a href="/gostd/math/big/rat.go.html">rat.go</a></li>
<li><a href="/gostd/math/big/rat_test.go.html">rat_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3526929">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3526984">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3527038">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3527089">//&nbsp;Package&nbsp;big&nbsp;implements&nbsp;multi-precision&nbsp;arithmetic&nbsp;(big&nbsp;numbers).</span><br>
<span class="lineno"></span><span class="comment" id="3527157">//&nbsp;The&nbsp;following&nbsp;numeric&nbsp;types&nbsp;are&nbsp;supported:</span><br>
<span class="lineno"></span><span class="comment" id="3527203">//</span><br>
<span class="lineno"></span><span class="comment" id="3527206">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;Int&nbsp;&nbsp;&nbsp;&nbspsigned&nbsp;integers</span><br>
<span class="lineno"></span><span class="comment" id="3527231">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;Rat&nbsp;&nbsp;&nbsp;&nbsprational&nbsp;numbers</span><br>
<span class="lineno">10</span><span class="comment" id="3527257">//</span><br>
<span class="lineno"></span><span class="comment" id="3527260">//&nbsp;Methods&nbsp;are&nbsp;typically&nbsp;of&nbsp;the&nbsp;form:</span><br>
<span class="lineno"></span><span class="comment" id="3527298">//</span><br>
<span class="lineno"></span><span class="comment" id="3527301">//&nbsp;&nbsp;&nbsp;&nbspfunc&nbsp;(z&nbsp;*Int)&nbsp;Op(x,&nbsp;y&nbsp;*Int)&nbsp;*Int&nbsp;&nbsp;&nbsp;&nbsp(similar&nbsp;for&nbsp;*Rat)</span><br>
<span class="lineno"></span><span class="comment" id="3527356">//</span><br>
<span class="lineno">15</span><span class="comment" id="3527359">//&nbsp;and&nbsp;implement&nbsp;operations&nbsp;z&nbsp;=&nbsp;x&nbsp;Op&nbsp;y&nbsp;with&nbsp;the&nbsp;result&nbsp;as&nbsp;receiver;&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="3527433">//&nbsp;is&nbsp;one&nbsp;of&nbsp;the&nbsp;operands&nbsp;it&nbsp;may&nbsp;be&nbsp;overwritten&nbsp;(and&nbsp;its&nbsp;memory&nbsp;reused).</span><br>
<span class="lineno"></span><span class="comment" id="3527506">//&nbsp;To&nbsp;enable&nbsp;chaining&nbsp;of&nbsp;operations,&nbsp;the&nbsp;result&nbsp;is&nbsp;also&nbsp;returned.&nbsp;Methods</span><br>
<span class="lineno"></span><span class="comment" id="3527580">//&nbsp;returning&nbsp;a&nbsp;result&nbsp;other&nbsp;than&nbsp;*Int&nbsp;or&nbsp;*Rat&nbsp;take&nbsp;one&nbsp;of&nbsp;the&nbsp;operands&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="3527654">//&nbsp;the&nbsp;receiver.</span><br>
<span class="lineno">20</span><span class="comment" id="3527671">//</span><br>
<span class="lineno"></span><span class="keyword" id="3527674">package</span>&nbsp;<span class="ident" id="3527682">big</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3527687">//&nbsp;This&nbsp;file&nbsp;contains&nbsp;operations&nbsp;on&nbsp;unsigned&nbsp;multi-precision&nbsp;integers.</span><br>
<span class="lineno"></span><span class="comment" id="3527758">//&nbsp;These&nbsp;are&nbsp;the&nbsp;building&nbsp;blocks&nbsp;for&nbsp;the&nbsp;operations&nbsp;on&nbsp;signed&nbsp;integers</span><br>
<span class="lineno">25</span><span class="comment" id="3527829">//&nbsp;and&nbsp;rationals.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3527848">import</span>&nbsp;<span class="op" id="3527855">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3527858">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3527868">&#34;io&#34;</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3527874">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3527882">&#34;math/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3527895">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="3527902">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="3527905">//&nbsp;An&nbsp;unsigned&nbsp;integer&nbsp;x&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="3527942">//</span><br>
<span class="lineno"></span><span class="comment" id="3527945">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;x[n-1]*_B^(n-1)&nbsp;+&nbsp;x[n-2]*_B^(n-2)&nbsp;+&nbsp;...&nbsp;+&nbsp;x[1]*_B&nbsp;+&nbsp;x[0]</span><br>
<span class="lineno"></span><span class="comment" id="3528011">//</span><br>
<span class="lineno"></span><span class="comment" id="3528014">//&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;x[i]&nbsp;&lt;&nbsp;_B&nbsp;and&nbsp;0&nbsp;&lt;=&nbsp;i&nbsp;&lt;&nbsp;n&nbsp;is&nbsp;stored&nbsp;in&nbsp;a&nbsp;slice&nbsp;of&nbsp;length&nbsp;n,</span><br>
<span class="lineno">40</span><span class="comment" id="3528086">//&nbsp;with&nbsp;the&nbsp;digits&nbsp;x[i]&nbsp;as&nbsp;the&nbsp;slice&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="3528133">//</span><br>
<span class="lineno"></span><span class="comment" id="3528136">//&nbsp;A&nbsp;number&nbsp;is&nbsp;normalized&nbsp;if&nbsp;the&nbsp;slice&nbsp;contains&nbsp;no&nbsp;leading&nbsp;0&nbsp;digits.</span><br>
<span class="lineno"></span><span class="comment" id="3528205">//&nbsp;During&nbsp;arithmetic&nbsp;operations,&nbsp;denormalized&nbsp;values&nbsp;may&nbsp;occur&nbsp;but&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3528276">//&nbsp;always&nbsp;normalized&nbsp;before&nbsp;returning&nbsp;the&nbsp;final&nbsp;result.&nbsp;The&nbsp;normalized</span><br>
<span class="lineno">45</span><span class="comment" id="3528347">//&nbsp;representation&nbsp;of&nbsp;0&nbsp;is&nbsp;the&nbsp;empty&nbsp;or&nbsp;nil&nbsp;slice&nbsp;(length&nbsp;=&nbsp;0).</span><br>
<span class="lineno"></span><span class="comment" id="3528410">//</span><br>
<span class="lineno"></span><span class="keyword" id="3528413">type</span>&nbsp;<span class="ident" id="3528418">nat</span>&nbsp;<span class="op" id="3528422">[</span><span class="op" id="3528423">]</span><span class="ident" id="3528424">Word</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3528430">var</span>&nbsp;<span class="op" id="3528434">(</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3528437">natOne</span>&nbsp;<span class="op" id="3528444">=</span>&nbsp;<span class="ident" id="3528446">nat</span><span class="op" id="3528449">{</span><span class="num" id="3528450">1</span><span class="op" id="3528451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3528454">natTwo</span>&nbsp;<span class="op" id="3528461">=</span>&nbsp;<span class="ident" id="3528463">nat</span><span class="op" id="3528466">{</span><span class="num" id="3528467">2</span><span class="op" id="3528468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3528471">natTen</span>&nbsp;<span class="op" id="3528478">=</span>&nbsp;<span class="ident" id="3528480">nat</span><span class="op" id="3528483">{</span><span class="num" id="3528484">10</span><span class="op" id="3528486">}</span><br>
<span class="lineno"></span><span class="op" id="3528488">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="3528491">func</span>&nbsp;<span class="op" id="3528496">(</span><span class="ident" id="3528497">z</span>&nbsp;<span class="ident" id="3528499">nat</span><span class="op" id="3528502">)</span>&nbsp;<span class="ident" id="3528504">clear</span><span class="op" id="3528509">(</span><span class="op" id="3528510">)</span>&nbsp;<span class="op" id="3528512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3528515">for</span>&nbsp;<span class="ident" id="3528519">i</span>&nbsp;<span class="op" id="3528521">:=</span>&nbsp;<span class="keyword" id="3528524">range</span>&nbsp;<span class="ident" id="3528530">z</span>&nbsp;<span class="op" id="3528532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3528536">z</span><span class="op" id="3528537">[</span><span class="ident" id="3528538">i</span><span class="op" id="3528539">]</span>&nbsp;<span class="op" id="3528541">=</span>&nbsp;<span class="num" id="3528543">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3528546">}</span><br>
<span class="lineno"></span><span class="op" id="3528548">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="3528551">func</span>&nbsp;<span class="op" id="3528556">(</span><span class="ident" id="3528557">z</span>&nbsp;<span class="ident" id="3528559">nat</span><span class="op" id="3528562">)</span>&nbsp;<span class="ident" id="3528564">norm</span><span class="op" id="3528568">(</span><span class="op" id="3528569">)</span>&nbsp;<span class="ident" id="3528571">nat</span>&nbsp;<span class="op" id="3528575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3528578">i</span>&nbsp;<span class="op" id="3528580">:=</span>&nbsp;<span class="builtinfunc" id="3528583">len</span><span class="op" id="3528586">(</span><span class="ident" id="3528587">z</span><span class="op" id="3528588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3528591">for</span>&nbsp;<span class="ident" id="3528595">i</span>&nbsp;<span class="op" id="3528597">&gt;</span>&nbsp;<span class="num" id="3528599">0</span>&nbsp;<span class="op" id="3528601">&amp;&amp;</span>&nbsp;<span class="ident" id="3528604">z</span><span class="op" id="3528605">[</span><span class="ident" id="3528606">i</span><span class="op" id="3528607">-</span><span class="num" id="3528608">1</span><span class="op" id="3528609">]</span>&nbsp;<span class="op" id="3528611">==</span>&nbsp;<span class="num" id="3528614">0</span>&nbsp;<span class="op" id="3528616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3528620">i</span><span class="op" id="3528621">--</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3528625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3528628">return</span>&nbsp;<span class="ident" id="3528635">z</span><span class="op" id="3528636">[</span><span class="num" id="3528637">0</span><span class="op" id="3528638">:</span><span class="ident" id="3528639">i</span><span class="op" id="3528640">]</span><br>
<span class="lineno"></span><span class="op" id="3528642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3528645">func</span>&nbsp;<span class="op" id="3528650">(</span><span class="ident" id="3528651">z</span>&nbsp;<span class="ident" id="3528653">nat</span><span class="op" id="3528656">)</span>&nbsp;<span class="builtinfunc" id="3528658">make</span><span class="op" id="3528662">(</span><span class="ident" id="3528663">n</span>&nbsp;<span class="builtintype" id="3528665">int</span><span class="op" id="3528668">)</span>&nbsp;<span class="ident" id="3528670">nat</span>&nbsp;<span class="op" id="3528674">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3528677">if</span>&nbsp;<span class="ident" id="3528680">n</span>&nbsp;<span class="op" id="3528682">&lt;=</span>&nbsp;<span class="builtinfunc" id="3528685">cap</span><span class="op" id="3528688">(</span><span class="ident" id="3528689">z</span><span class="op" id="3528690">)</span>&nbsp;<span class="op" id="3528692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3528696">return</span>&nbsp;<span class="ident" id="3528703">z</span><span class="op" id="3528704">[</span><span class="num" id="3528705">0</span><span class="op" id="3528706">:</span><span class="ident" id="3528707">n</span><span class="op" id="3528708">]</span>&nbsp;<span class="comment" id="3528710">//&nbsp;reuse&nbsp;z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3528722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3528725">//&nbsp;Choosing&nbsp;a&nbsp;good&nbsp;value&nbsp;for&nbsp;e&nbsp;has&nbsp;significant&nbsp;performance&nbsp;impact</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3528792">//&nbsp;because&nbsp;it&nbsp;increases&nbsp;the&nbsp;chance&nbsp;that&nbsp;a&nbsp;value&nbsp;can&nbsp;be&nbsp;reused.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3528856">const</span>&nbsp;<span class="ident" id="3528862">e</span>&nbsp;<span class="op" id="3528864">=</span>&nbsp;<span class="num" id="3528866">4</span>&nbsp;<span class="comment" id="3528868">//&nbsp;extra&nbsp;capacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3528887">return</span>&nbsp;<span class="builtinfunc" id="3528894">make</span><span class="op" id="3528898">(</span><span class="ident" id="3528899">nat</span><span class="op" id="3528902">,</span>&nbsp;<span class="ident" id="3528904">n</span><span class="op" id="3528905">,</span>&nbsp;<span class="ident" id="3528907">n</span><span class="op" id="3528908">+</span><span class="ident" id="3528909">e</span><span class="op" id="3528910">)</span><br>
<span class="lineno"></span><span class="op" id="3528912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3528915">func</span>&nbsp;<span class="op" id="3528920">(</span><span class="ident" id="3528921">z</span>&nbsp;<span class="ident" id="3528923">nat</span><span class="op" id="3528926">)</span>&nbsp;<span class="ident" id="3528928">setWord</span><span class="op" id="3528935">(</span><span class="ident" id="3528936">x</span>&nbsp;<span class="ident" id="3528938">Word</span><span class="op" id="3528942">)</span>&nbsp;<span class="ident" id="3528944">nat</span>&nbsp;<span class="op" id="3528948">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3528951">if</span>&nbsp;<span class="ident" id="3528954">x</span>&nbsp;<span class="op" id="3528956">==</span>&nbsp;<span class="num" id="3528959">0</span>&nbsp;<span class="op" id="3528961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3528965">return</span>&nbsp;<span class="ident" id="3528972">z</span><span class="op" id="3528973">.</span><span class="builtinfunc" id="3528974">make</span><span class="op" id="3528978">(</span><span class="num" id="3528979">0</span><span class="op" id="3528980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3528983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3528986">z</span>&nbsp;<span class="op" id="3528988">=</span>&nbsp;<span class="ident" id="3528990">z</span><span class="op" id="3528991">.</span><span class="builtinfunc" id="3528992">make</span><span class="op" id="3528996">(</span><span class="num" id="3528997">1</span><span class="op" id="3528998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529001">z</span><span class="op" id="3529002">[</span><span class="num" id="3529003">0</span><span class="op" id="3529004">]</span>&nbsp;<span class="op" id="3529006">=</span>&nbsp;<span class="ident" id="3529008">x</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529011">return</span>&nbsp;<span class="ident" id="3529018">z</span><br>
<span class="lineno"></span><span class="op" id="3529020">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3529023">func</span>&nbsp;<span class="op" id="3529028">(</span><span class="ident" id="3529029">z</span>&nbsp;<span class="ident" id="3529031">nat</span><span class="op" id="3529034">)</span>&nbsp;<span class="ident" id="3529036">setUint64</span><span class="op" id="3529045">(</span><span class="ident" id="3529046">x</span>&nbsp;<span class="ident" id="3529048">uint64</span><span class="op" id="3529054">)</span>&nbsp;<span class="ident" id="3529056">nat</span>&nbsp;<span class="op" id="3529060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3529063">//&nbsp;single-digit&nbsp;values</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529087">if</span>&nbsp;<span class="ident" id="3529090">w</span>&nbsp;<span class="op" id="3529092">:=</span>&nbsp;<span class="ident" id="3529095">Word</span><span class="op" id="3529099">(</span><span class="ident" id="3529100">x</span><span class="op" id="3529101">)</span><span class="op" id="3529102">;</span>&nbsp;<span class="ident" id="3529104">uint64</span><span class="op" id="3529110">(</span><span class="ident" id="3529111">w</span><span class="op" id="3529112">)</span>&nbsp;<span class="op" id="3529114">==</span>&nbsp;<span class="ident" id="3529117">x</span>&nbsp;<span class="op" id="3529119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529123">return</span>&nbsp;<span class="ident" id="3529130">z</span><span class="op" id="3529131">.</span><span class="ident" id="3529132">setWord</span><span class="op" id="3529139">(</span><span class="ident" id="3529140">w</span><span class="op" id="3529141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3529144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3529148">//&nbsp;compute&nbsp;number&nbsp;of&nbsp;words&nbsp;n&nbsp;required&nbsp;to&nbsp;represent&nbsp;x</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529202">n</span>&nbsp;<span class="op" id="3529204">:=</span>&nbsp;<span class="num" id="3529207">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529210">for</span>&nbsp;<span class="ident" id="3529214">t</span>&nbsp;<span class="op" id="3529216">:=</span>&nbsp;<span class="ident" id="3529219">x</span><span class="op" id="3529220">;</span>&nbsp;<span class="ident" id="3529222">t</span>&nbsp;<span class="op" id="3529224">&gt;</span>&nbsp;<span class="num" id="3529226">0</span><span class="op" id="3529227">;</span>&nbsp;<span class="ident" id="3529229">t</span>&nbsp;<span class="op" id="3529231">&gt;&gt;=</span>&nbsp;<span class="ident" id="3529235">_W</span>&nbsp;<span class="op" id="3529238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529242">n</span><span class="op" id="3529243">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3529247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3529251">//&nbsp;split&nbsp;x&nbsp;into&nbsp;n&nbsp;words</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529276">z</span>&nbsp;<span class="op" id="3529278">=</span>&nbsp;<span class="ident" id="3529280">z</span><span class="op" id="3529281">.</span><span class="builtinfunc" id="3529282">make</span><span class="op" id="3529286">(</span><span class="ident" id="3529287">n</span><span class="op" id="3529288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529291">for</span>&nbsp;<span class="ident" id="3529295">i</span>&nbsp;<span class="op" id="3529297">:=</span>&nbsp;<span class="keyword" id="3529300">range</span>&nbsp;<span class="ident" id="3529306">z</span>&nbsp;<span class="op" id="3529308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529312">z</span><span class="op" id="3529313">[</span><span class="ident" id="3529314">i</span><span class="op" id="3529315">]</span>&nbsp;<span class="op" id="3529317">=</span>&nbsp;<span class="ident" id="3529319">Word</span><span class="op" id="3529323">(</span><span class="ident" id="3529324">x</span>&nbsp;<span class="op" id="3529326">&amp;</span>&nbsp;<span class="ident" id="3529328">_M</span><span class="op" id="3529330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529334">x</span>&nbsp;<span class="op" id="3529336">&gt;&gt;=</span>&nbsp;<span class="ident" id="3529340">_W</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3529344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529348">return</span>&nbsp;<span class="ident" id="3529355">z</span><br>
<span class="lineno"></span><span class="op" id="3529357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="3529360">func</span>&nbsp;<span class="op" id="3529365">(</span><span class="ident" id="3529366">z</span>&nbsp;<span class="ident" id="3529368">nat</span><span class="op" id="3529371">)</span>&nbsp;<span class="ident" id="3529373">set</span><span class="op" id="3529376">(</span><span class="ident" id="3529377">x</span>&nbsp;<span class="ident" id="3529379">nat</span><span class="op" id="3529382">)</span>&nbsp;<span class="ident" id="3529384">nat</span>&nbsp;<span class="op" id="3529388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529391">z</span>&nbsp;<span class="op" id="3529393">=</span>&nbsp;<span class="ident" id="3529395">z</span><span class="op" id="3529396">.</span><span class="builtinfunc" id="3529397">make</span><span class="op" id="3529401">(</span><span class="builtinfunc" id="3529402">len</span><span class="op" id="3529405">(</span><span class="ident" id="3529406">x</span><span class="op" id="3529407">)</span><span class="op" id="3529408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3529411">copy</span><span class="op" id="3529415">(</span><span class="ident" id="3529416">z</span><span class="op" id="3529417">,</span>&nbsp;<span class="ident" id="3529419">x</span><span class="op" id="3529420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529423">return</span>&nbsp;<span class="ident" id="3529430">z</span><br>
<span class="lineno"></span><span class="op" id="3529432">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="3529435">func</span>&nbsp;<span class="op" id="3529440">(</span><span class="ident" id="3529441">z</span>&nbsp;<span class="ident" id="3529443">nat</span><span class="op" id="3529446">)</span>&nbsp;<span class="ident" id="3529448">add</span><span class="op" id="3529451">(</span><span class="ident" id="3529452">x</span><span class="op" id="3529453">,</span>&nbsp;<span class="ident" id="3529455">y</span>&nbsp;<span class="ident" id="3529457">nat</span><span class="op" id="3529460">)</span>&nbsp;<span class="ident" id="3529462">nat</span>&nbsp;<span class="op" id="3529466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529469">m</span>&nbsp;<span class="op" id="3529471">:=</span>&nbsp;<span class="builtinfunc" id="3529474">len</span><span class="op" id="3529477">(</span><span class="ident" id="3529478">x</span><span class="op" id="3529479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529482">n</span>&nbsp;<span class="op" id="3529484">:=</span>&nbsp;<span class="builtinfunc" id="3529487">len</span><span class="op" id="3529490">(</span><span class="ident" id="3529491">y</span><span class="op" id="3529492">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529496">switch</span>&nbsp;<span class="op" id="3529503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529506">case</span>&nbsp;<span class="ident" id="3529511">m</span>&nbsp;<span class="op" id="3529513">&lt;</span>&nbsp;<span class="ident" id="3529515">n</span><span class="op" id="3529516">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529520">return</span>&nbsp;<span class="ident" id="3529527">z</span><span class="op" id="3529528">.</span><span class="ident" id="3529529">add</span><span class="op" id="3529532">(</span><span class="ident" id="3529533">y</span><span class="op" id="3529534">,</span>&nbsp;<span class="ident" id="3529536">x</span><span class="op" id="3529537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529540">case</span>&nbsp;<span class="ident" id="3529545">m</span>&nbsp;<span class="op" id="3529547">==</span>&nbsp;<span class="num" id="3529550">0</span><span class="op" id="3529551">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3529555">//&nbsp;n&nbsp;==&nbsp;0&nbsp;because&nbsp;m&nbsp;&gt;=&nbsp;n;&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529595">return</span>&nbsp;<span class="ident" id="3529602">z</span><span class="op" id="3529603">.</span><span class="builtinfunc" id="3529604">make</span><span class="op" id="3529608">(</span><span class="num" id="3529609">0</span><span class="op" id="3529610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529613">case</span>&nbsp;<span class="ident" id="3529618">n</span>&nbsp;<span class="op" id="3529620">==</span>&nbsp;<span class="num" id="3529623">0</span><span class="op" id="3529624">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3529628">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529645">return</span>&nbsp;<span class="ident" id="3529652">z</span><span class="op" id="3529653">.</span><span class="ident" id="3529654">set</span><span class="op" id="3529657">(</span><span class="ident" id="3529658">x</span><span class="op" id="3529659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3529662">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3529665">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529676">z</span>&nbsp;<span class="op" id="3529678">=</span>&nbsp;<span class="ident" id="3529680">z</span><span class="op" id="3529681">.</span><span class="builtinfunc" id="3529682">make</span><span class="op" id="3529686">(</span><span class="ident" id="3529687">m</span>&nbsp;<span class="op" id="3529689">+</span>&nbsp;<span class="num" id="3529691">1</span><span class="op" id="3529692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529695">c</span>&nbsp;<span class="op" id="3529697">:=</span>&nbsp;<span class="ident" id="3529700">addVV</span><span class="op" id="3529705">(</span><span class="ident" id="3529706">z</span><span class="op" id="3529707">[</span><span class="num" id="3529708">0</span><span class="op" id="3529709">:</span><span class="ident" id="3529710">n</span><span class="op" id="3529711">]</span><span class="op" id="3529712">,</span>&nbsp;<span class="ident" id="3529714">x</span><span class="op" id="3529715">,</span>&nbsp;<span class="ident" id="3529717">y</span><span class="op" id="3529718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529721">if</span>&nbsp;<span class="ident" id="3529724">m</span>&nbsp;<span class="op" id="3529726">&gt;</span>&nbsp;<span class="ident" id="3529728">n</span>&nbsp;<span class="op" id="3529730">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529734">c</span>&nbsp;<span class="op" id="3529736">=</span>&nbsp;<span class="ident" id="3529738">addVW</span><span class="op" id="3529743">(</span><span class="ident" id="3529744">z</span><span class="op" id="3529745">[</span><span class="ident" id="3529746">n</span><span class="op" id="3529747">:</span><span class="ident" id="3529748">m</span><span class="op" id="3529749">]</span><span class="op" id="3529750">,</span>&nbsp;<span class="ident" id="3529752">x</span><span class="op" id="3529753">[</span><span class="ident" id="3529754">n</span><span class="op" id="3529755">:</span><span class="op" id="3529756">]</span><span class="op" id="3529757">,</span>&nbsp;<span class="ident" id="3529759">c</span><span class="op" id="3529760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3529763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529766">z</span><span class="op" id="3529767">[</span><span class="ident" id="3529768">m</span><span class="op" id="3529769">]</span>&nbsp;<span class="op" id="3529771">=</span>&nbsp;<span class="ident" id="3529773">c</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529777">return</span>&nbsp;<span class="ident" id="3529784">z</span><span class="op" id="3529785">.</span><span class="ident" id="3529786">norm</span><span class="op" id="3529790">(</span><span class="op" id="3529791">)</span><br>
<span class="lineno">140</span><span class="op" id="3529793">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3529796">func</span>&nbsp;<span class="op" id="3529801">(</span><span class="ident" id="3529802">z</span>&nbsp;<span class="ident" id="3529804">nat</span><span class="op" id="3529807">)</span>&nbsp;<span class="ident" id="3529809">sub</span><span class="op" id="3529812">(</span><span class="ident" id="3529813">x</span><span class="op" id="3529814">,</span>&nbsp;<span class="ident" id="3529816">y</span>&nbsp;<span class="ident" id="3529818">nat</span><span class="op" id="3529821">)</span>&nbsp;<span class="ident" id="3529823">nat</span>&nbsp;<span class="op" id="3529827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529830">m</span>&nbsp;<span class="op" id="3529832">:=</span>&nbsp;<span class="builtinfunc" id="3529835">len</span><span class="op" id="3529838">(</span><span class="ident" id="3529839">x</span><span class="op" id="3529840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3529843">n</span>&nbsp;<span class="op" id="3529845">:=</span>&nbsp;<span class="builtinfunc" id="3529848">len</span><span class="op" id="3529851">(</span><span class="ident" id="3529852">y</span><span class="op" id="3529853">)</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529857">switch</span>&nbsp;<span class="op" id="3529864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529867">case</span>&nbsp;<span class="ident" id="3529872">m</span>&nbsp;<span class="op" id="3529874">&lt;</span>&nbsp;<span class="ident" id="3529876">n</span><span class="op" id="3529877">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3529881">panic</span><span class="op" id="3529886">(</span><span class="string" id="3529887">&#34;underflow&#34;</span><span class="op" id="3529898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529901">case</span>&nbsp;<span class="ident" id="3529906">m</span>&nbsp;<span class="op" id="3529908">==</span>&nbsp;<span class="num" id="3529911">0</span><span class="op" id="3529912">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3529916">//&nbsp;n&nbsp;==&nbsp;0&nbsp;because&nbsp;m&nbsp;&gt;=&nbsp;n;&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529956">return</span>&nbsp;<span class="ident" id="3529963">z</span><span class="op" id="3529964">.</span><span class="builtinfunc" id="3529965">make</span><span class="op" id="3529969">(</span><span class="num" id="3529970">0</span><span class="op" id="3529971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3529974">case</span>&nbsp;<span class="ident" id="3529979">n</span>&nbsp;<span class="op" id="3529981">==</span>&nbsp;<span class="num" id="3529984">0</span><span class="op" id="3529985">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3529989">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530006">return</span>&nbsp;<span class="ident" id="3530013">z</span><span class="op" id="3530014">.</span><span class="ident" id="3530015">set</span><span class="op" id="3530018">(</span><span class="ident" id="3530019">x</span><span class="op" id="3530020">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3530023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3530026">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3530037">z</span>&nbsp;<span class="op" id="3530039">=</span>&nbsp;<span class="ident" id="3530041">z</span><span class="op" id="3530042">.</span><span class="builtinfunc" id="3530043">make</span><span class="op" id="3530047">(</span><span class="ident" id="3530048">m</span><span class="op" id="3530049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3530052">c</span>&nbsp;<span class="op" id="3530054">:=</span>&nbsp;<span class="ident" id="3530057">subVV</span><span class="op" id="3530062">(</span><span class="ident" id="3530063">z</span><span class="op" id="3530064">[</span><span class="num" id="3530065">0</span><span class="op" id="3530066">:</span><span class="ident" id="3530067">n</span><span class="op" id="3530068">]</span><span class="op" id="3530069">,</span>&nbsp;<span class="ident" id="3530071">x</span><span class="op" id="3530072">,</span>&nbsp;<span class="ident" id="3530074">y</span><span class="op" id="3530075">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530078">if</span>&nbsp;<span class="ident" id="3530081">m</span>&nbsp;<span class="op" id="3530083">&gt;</span>&nbsp;<span class="ident" id="3530085">n</span>&nbsp;<span class="op" id="3530087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3530091">c</span>&nbsp;<span class="op" id="3530093">=</span>&nbsp;<span class="ident" id="3530095">subVW</span><span class="op" id="3530100">(</span><span class="ident" id="3530101">z</span><span class="op" id="3530102">[</span><span class="ident" id="3530103">n</span><span class="op" id="3530104">:</span><span class="op" id="3530105">]</span><span class="op" id="3530106">,</span>&nbsp;<span class="ident" id="3530108">x</span><span class="op" id="3530109">[</span><span class="ident" id="3530110">n</span><span class="op" id="3530111">:</span><span class="op" id="3530112">]</span><span class="op" id="3530113">,</span>&nbsp;<span class="ident" id="3530115">c</span><span class="op" id="3530116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3530119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530122">if</span>&nbsp;<span class="ident" id="3530125">c</span>&nbsp;<span class="op" id="3530127">!=</span>&nbsp;<span class="num" id="3530130">0</span>&nbsp;<span class="op" id="3530132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3530136">panic</span><span class="op" id="3530141">(</span><span class="string" id="3530142">&#34;underflow&#34;</span><span class="op" id="3530153">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3530156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530160">return</span>&nbsp;<span class="ident" id="3530167">z</span><span class="op" id="3530168">.</span><span class="ident" id="3530169">norm</span><span class="op" id="3530173">(</span><span class="op" id="3530174">)</span><br>
<span class="lineno"></span><span class="op" id="3530176">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="3530179">func</span>&nbsp;<span class="op" id="3530184">(</span><span class="ident" id="3530185">x</span>&nbsp;<span class="ident" id="3530187">nat</span><span class="op" id="3530190">)</span>&nbsp;<span class="ident" id="3530192">cmp</span><span class="op" id="3530195">(</span><span class="ident" id="3530196">y</span>&nbsp;<span class="ident" id="3530198">nat</span><span class="op" id="3530201">)</span>&nbsp;<span class="op" id="3530203">(</span><span class="ident" id="3530204">r</span>&nbsp;<span class="builtintype" id="3530206">int</span><span class="op" id="3530209">)</span>&nbsp;<span class="op" id="3530211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3530214">m</span>&nbsp;<span class="op" id="3530216">:=</span>&nbsp;<span class="builtinfunc" id="3530219">len</span><span class="op" id="3530222">(</span><span class="ident" id="3530223">x</span><span class="op" id="3530224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3530227">n</span>&nbsp;<span class="op" id="3530229">:=</span>&nbsp;<span class="builtinfunc" id="3530232">len</span><span class="op" id="3530235">(</span><span class="ident" id="3530236">y</span><span class="op" id="3530237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530240">if</span>&nbsp;<span class="ident" id="3530243">m</span>&nbsp;<span class="op" id="3530245">!=</span>&nbsp;<span class="ident" id="3530248">n</span>&nbsp;<span class="op" id="3530250">||</span>&nbsp;<span class="ident" id="3530253">m</span>&nbsp;<span class="op" id="3530255">==</span>&nbsp;<span class="num" id="3530258">0</span>&nbsp;<span class="op" id="3530260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530264">switch</span>&nbsp;<span class="op" id="3530271">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530275">case</span>&nbsp;<span class="ident" id="3530280">m</span>&nbsp;<span class="op" id="3530282">&lt;</span>&nbsp;<span class="ident" id="3530284">n</span><span class="op" id="3530285">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3530290">r</span>&nbsp;<span class="op" id="3530292">=</span>&nbsp;<span class="op" id="3530294">-</span><span class="num" id="3530295">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530299">case</span>&nbsp;<span class="ident" id="3530304">m</span>&nbsp;<span class="op" id="3530306">&gt;</span>&nbsp;<span class="ident" id="3530308">n</span><span class="op" id="3530309">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3530314">r</span>&nbsp;<span class="op" id="3530316">=</span>&nbsp;<span class="num" id="3530318">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3530322">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530326">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3530334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3530338">i</span>&nbsp;<span class="op" id="3530340">:=</span>&nbsp;<span class="ident" id="3530343">m</span>&nbsp;<span class="op" id="3530345">-</span>&nbsp;<span class="num" id="3530347">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530350">for</span>&nbsp;<span class="ident" id="3530354">i</span>&nbsp;<span class="op" id="3530356">&gt;</span>&nbsp;<span class="num" id="3530358">0</span>&nbsp;<span class="op" id="3530360">&amp;&amp;</span>&nbsp;<span class="ident" id="3530363">x</span><span class="op" id="3530364">[</span><span class="ident" id="3530365">i</span><span class="op" id="3530366">]</span>&nbsp;<span class="op" id="3530368">==</span>&nbsp;<span class="ident" id="3530371">y</span><span class="op" id="3530372">[</span><span class="ident" id="3530373">i</span><span class="op" id="3530374">]</span>&nbsp;<span class="op" id="3530376">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3530380">i</span><span class="op" id="3530381">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3530385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530389">switch</span>&nbsp;<span class="op" id="3530396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530399">case</span>&nbsp;<span class="ident" id="3530404">x</span><span class="op" id="3530405">[</span><span class="ident" id="3530406">i</span><span class="op" id="3530407">]</span>&nbsp;<span class="op" id="3530409">&lt;</span>&nbsp;<span class="ident" id="3530411">y</span><span class="op" id="3530412">[</span><span class="ident" id="3530413">i</span><span class="op" id="3530414">]</span><span class="op" id="3530415">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3530419">r</span>&nbsp;<span class="op" id="3530421">=</span>&nbsp;<span class="op" id="3530423">-</span><span class="num" id="3530424">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530427">case</span>&nbsp;<span class="ident" id="3530432">x</span><span class="op" id="3530433">[</span><span class="ident" id="3530434">i</span><span class="op" id="3530435">]</span>&nbsp;<span class="op" id="3530437">&gt;</span>&nbsp;<span class="ident" id="3530439">y</span><span class="op" id="3530440">[</span><span class="ident" id="3530441">i</span><span class="op" id="3530442">]</span><span class="op" id="3530443">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3530447">r</span>&nbsp;<span class="op" id="3530449">=</span>&nbsp;<span class="num" id="3530451">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3530454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530457">return</span><br>
<span class="lineno">195</span><span class="op" id="3530464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3530467">func</span>&nbsp;<span class="op" id="3530472">(</span><span class="ident" id="3530473">z</span>&nbsp;<span class="ident" id="3530475">nat</span><span class="op" id="3530478">)</span>&nbsp;<span class="ident" id="3530480">mulAddWW</span><span class="op" id="3530488">(</span><span class="ident" id="3530489">x</span>&nbsp;<span class="ident" id="3530491">nat</span><span class="op" id="3530494">,</span>&nbsp;<span class="ident" id="3530496">y</span><span class="op" id="3530497">,</span>&nbsp;<span class="ident" id="3530499">r</span>&nbsp;<span class="ident" id="3530501">Word</span><span class="op" id="3530505">)</span>&nbsp;<span class="ident" id="3530507">nat</span>&nbsp;<span class="op" id="3530511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3530514">m</span>&nbsp;<span class="op" id="3530516">:=</span>&nbsp;<span class="builtinfunc" id="3530519">len</span><span class="op" id="3530522">(</span><span class="ident" id="3530523">x</span><span class="op" id="3530524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530527">if</span>&nbsp;<span class="ident" id="3530530">m</span>&nbsp;<span class="op" id="3530532">==</span>&nbsp;<span class="num" id="3530535">0</span>&nbsp;<span class="op" id="3530537">||</span>&nbsp;<span class="ident" id="3530540">y</span>&nbsp;<span class="op" id="3530542">==</span>&nbsp;<span class="num" id="3530545">0</span>&nbsp;<span class="op" id="3530547">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530551">return</span>&nbsp;<span class="ident" id="3530558">z</span><span class="op" id="3530559">.</span><span class="ident" id="3530560">setWord</span><span class="op" id="3530567">(</span><span class="ident" id="3530568">r</span><span class="op" id="3530569">)</span>&nbsp;<span class="comment" id="3530571">//&nbsp;result&nbsp;is&nbsp;r</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3530587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3530590">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3530601">z</span>&nbsp;<span class="op" id="3530603">=</span>&nbsp;<span class="ident" id="3530605">z</span><span class="op" id="3530606">.</span><span class="builtinfunc" id="3530607">make</span><span class="op" id="3530611">(</span><span class="ident" id="3530612">m</span>&nbsp;<span class="op" id="3530614">+</span>&nbsp;<span class="num" id="3530616">1</span><span class="op" id="3530617">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3530620">z</span><span class="op" id="3530621">[</span><span class="ident" id="3530622">m</span><span class="op" id="3530623">]</span>&nbsp;<span class="op" id="3530625">=</span>&nbsp;<span class="ident" id="3530627">mulAddVWW</span><span class="op" id="3530636">(</span><span class="ident" id="3530637">z</span><span class="op" id="3530638">[</span><span class="num" id="3530639">0</span><span class="op" id="3530640">:</span><span class="ident" id="3530641">m</span><span class="op" id="3530642">]</span><span class="op" id="3530643">,</span>&nbsp;<span class="ident" id="3530645">x</span><span class="op" id="3530646">,</span>&nbsp;<span class="ident" id="3530648">y</span><span class="op" id="3530649">,</span>&nbsp;<span class="ident" id="3530651">r</span><span class="op" id="3530652">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530656">return</span>&nbsp;<span class="ident" id="3530663">z</span><span class="op" id="3530664">.</span><span class="ident" id="3530665">norm</span><span class="op" id="3530669">(</span><span class="op" id="3530670">)</span><br>
<span class="lineno"></span><span class="op" id="3530672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="3530675">//&nbsp;basicMul&nbsp;multiplies&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;leaves&nbsp;the&nbsp;result&nbsp;in&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3530734">//&nbsp;The&nbsp;(non-normalized)&nbsp;result&nbsp;is&nbsp;placed&nbsp;in&nbsp;z[0&nbsp;:&nbsp;len(x)&nbsp;+&nbsp;len(y)].</span><br>
<span class="lineno"></span><span class="keyword" id="3530802">func</span>&nbsp;<span class="ident" id="3530807">basicMul</span><span class="op" id="3530815">(</span><span class="ident" id="3530816">z</span><span class="op" id="3530817">,</span>&nbsp;<span class="ident" id="3530819">x</span><span class="op" id="3530820">,</span>&nbsp;<span class="ident" id="3530822">y</span>&nbsp;<span class="ident" id="3530824">nat</span><span class="op" id="3530827">)</span>&nbsp;<span class="op" id="3530829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3530832">z</span><span class="op" id="3530833">[</span><span class="num" id="3530834">0</span>&nbsp;<span class="op" id="3530836">:</span>&nbsp;<span class="builtinfunc" id="3530838">len</span><span class="op" id="3530841">(</span><span class="ident" id="3530842">x</span><span class="op" id="3530843">)</span><span class="op" id="3530844">+</span><span class="builtinfunc" id="3530845">len</span><span class="op" id="3530848">(</span><span class="ident" id="3530849">y</span><span class="op" id="3530850">)</span><span class="op" id="3530851">]</span><span class="op" id="3530852">.</span><span class="ident" id="3530853">clear</span><span class="op" id="3530858">(</span><span class="op" id="3530859">)</span>&nbsp;<span class="comment" id="3530861">//&nbsp;initialize&nbsp;z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530878">for</span>&nbsp;<span class="ident" id="3530882">i</span><span class="op" id="3530883">,</span>&nbsp;<span class="ident" id="3530885">d</span>&nbsp;<span class="op" id="3530887">:=</span>&nbsp;<span class="keyword" id="3530890">range</span>&nbsp;<span class="ident" id="3530896">y</span>&nbsp;<span class="op" id="3530898">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3530902">if</span>&nbsp;<span class="ident" id="3530905">d</span>&nbsp;<span class="op" id="3530907">!=</span>&nbsp;<span class="num" id="3530910">0</span>&nbsp;<span class="op" id="3530912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3530917">z</span><span class="op" id="3530918">[</span><span class="builtinfunc" id="3530919">len</span><span class="op" id="3530922">(</span><span class="ident" id="3530923">x</span><span class="op" id="3530924">)</span><span class="op" id="3530925">+</span><span class="ident" id="3530926">i</span><span class="op" id="3530927">]</span>&nbsp;<span class="op" id="3530929">=</span>&nbsp;<span class="ident" id="3530931">addMulVVW</span><span class="op" id="3530940">(</span><span class="ident" id="3530941">z</span><span class="op" id="3530942">[</span><span class="ident" id="3530943">i</span><span class="op" id="3530944">:</span><span class="ident" id="3530945">i</span><span class="op" id="3530946">+</span><span class="builtinfunc" id="3530947">len</span><span class="op" id="3530950">(</span><span class="ident" id="3530951">x</span><span class="op" id="3530952">)</span><span class="op" id="3530953">]</span><span class="op" id="3530954">,</span>&nbsp;<span class="ident" id="3530956">x</span><span class="op" id="3530957">,</span>&nbsp;<span class="ident" id="3530959">d</span><span class="op" id="3530960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3530964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3530967">}</span><br>
<span class="lineno"></span><span class="op" id="3530969">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="3530972">//&nbsp;Fast&nbsp;version&nbsp;of&nbsp;z[0:n+n&gt;&gt;1].add(z[0:n+n&gt;&gt;1],&nbsp;x[0:n])&nbsp;w/o&nbsp;bounds&nbsp;checks.</span><br>
<span class="lineno"></span><span class="comment" id="3531047">//&nbsp;Factored&nbsp;out&nbsp;for&nbsp;readability&nbsp;-&nbsp;do&nbsp;not&nbsp;use&nbsp;outside&nbsp;karatsuba.</span><br>
<span class="lineno"></span><span class="keyword" id="3531111">func</span>&nbsp;<span class="ident" id="3531116">karatsubaAdd</span><span class="op" id="3531128">(</span><span class="ident" id="3531129">z</span><span class="op" id="3531130">,</span>&nbsp;<span class="ident" id="3531132">x</span>&nbsp;<span class="ident" id="3531134">nat</span><span class="op" id="3531137">,</span>&nbsp;<span class="ident" id="3531139">n</span>&nbsp;<span class="builtintype" id="3531141">int</span><span class="op" id="3531144">)</span>&nbsp;<span class="op" id="3531146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3531149">if</span>&nbsp;<span class="ident" id="3531152">c</span>&nbsp;<span class="op" id="3531154">:=</span>&nbsp;<span class="ident" id="3531157">addVV</span><span class="op" id="3531162">(</span><span class="ident" id="3531163">z</span><span class="op" id="3531164">[</span><span class="num" id="3531165">0</span><span class="op" id="3531166">:</span><span class="ident" id="3531167">n</span><span class="op" id="3531168">]</span><span class="op" id="3531169">,</span>&nbsp;<span class="ident" id="3531171">z</span><span class="op" id="3531172">,</span>&nbsp;<span class="ident" id="3531174">x</span><span class="op" id="3531175">)</span><span class="op" id="3531176">;</span>&nbsp;<span class="ident" id="3531178">c</span>&nbsp;<span class="op" id="3531180">!=</span>&nbsp;<span class="num" id="3531183">0</span>&nbsp;<span class="op" id="3531185">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3531189">addVW</span><span class="op" id="3531194">(</span><span class="ident" id="3531195">z</span><span class="op" id="3531196">[</span><span class="ident" id="3531197">n</span><span class="op" id="3531198">:</span><span class="ident" id="3531199">n</span><span class="op" id="3531200">+</span><span class="ident" id="3531201">n</span><span class="op" id="3531202">&gt;&gt;</span><span class="num" id="3531204">1</span><span class="op" id="3531205">]</span><span class="op" id="3531206">,</span>&nbsp;<span class="ident" id="3531208">z</span><span class="op" id="3531209">[</span><span class="ident" id="3531210">n</span><span class="op" id="3531211">:</span><span class="op" id="3531212">]</span><span class="op" id="3531213">,</span>&nbsp;<span class="ident" id="3531215">c</span><span class="op" id="3531216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3531219">}</span><br>
<span class="lineno"></span><span class="op" id="3531221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3531224">//&nbsp;Like&nbsp;karatsubaAdd,&nbsp;but&nbsp;does&nbsp;subtract.</span><br>
<span class="lineno">230</span><span class="keyword" id="3531265">func</span>&nbsp;<span class="ident" id="3531270">karatsubaSub</span><span class="op" id="3531282">(</span><span class="ident" id="3531283">z</span><span class="op" id="3531284">,</span>&nbsp;<span class="ident" id="3531286">x</span>&nbsp;<span class="ident" id="3531288">nat</span><span class="op" id="3531291">,</span>&nbsp;<span class="ident" id="3531293">n</span>&nbsp;<span class="builtintype" id="3531295">int</span><span class="op" id="3531298">)</span>&nbsp;<span class="op" id="3531300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3531303">if</span>&nbsp;<span class="ident" id="3531306">c</span>&nbsp;<span class="op" id="3531308">:=</span>&nbsp;<span class="ident" id="3531311">subVV</span><span class="op" id="3531316">(</span><span class="ident" id="3531317">z</span><span class="op" id="3531318">[</span><span class="num" id="3531319">0</span><span class="op" id="3531320">:</span><span class="ident" id="3531321">n</span><span class="op" id="3531322">]</span><span class="op" id="3531323">,</span>&nbsp;<span class="ident" id="3531325">z</span><span class="op" id="3531326">,</span>&nbsp;<span class="ident" id="3531328">x</span><span class="op" id="3531329">)</span><span class="op" id="3531330">;</span>&nbsp;<span class="ident" id="3531332">c</span>&nbsp;<span class="op" id="3531334">!=</span>&nbsp;<span class="num" id="3531337">0</span>&nbsp;<span class="op" id="3531339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3531343">subVW</span><span class="op" id="3531348">(</span><span class="ident" id="3531349">z</span><span class="op" id="3531350">[</span><span class="ident" id="3531351">n</span><span class="op" id="3531352">:</span><span class="ident" id="3531353">n</span><span class="op" id="3531354">+</span><span class="ident" id="3531355">n</span><span class="op" id="3531356">&gt;&gt;</span><span class="num" id="3531358">1</span><span class="op" id="3531359">]</span><span class="op" id="3531360">,</span>&nbsp;<span class="ident" id="3531362">z</span><span class="op" id="3531363">[</span><span class="ident" id="3531364">n</span><span class="op" id="3531365">:</span><span class="op" id="3531366">]</span><span class="op" id="3531367">,</span>&nbsp;<span class="ident" id="3531369">c</span><span class="op" id="3531370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3531373">}</span><br>
<span class="lineno"></span><span class="op" id="3531375">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="3531378">//&nbsp;Operands&nbsp;that&nbsp;are&nbsp;shorter&nbsp;than&nbsp;karatsubaThreshold&nbsp;are&nbsp;multiplied&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="3531452">//&nbsp;&#34;grade&nbsp;school&#34;&nbsp;multiplication;&nbsp;for&nbsp;longer&nbsp;operands&nbsp;the&nbsp;Karatsuba&nbsp;algorithm</span><br>
<span class="lineno"></span><span class="comment" id="3531530">//&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="3531542">var</span>&nbsp;<span class="ident" id="3531546">karatsubaThreshold</span>&nbsp;<span class="builtintype" id="3531565">int</span>&nbsp;<span class="op" id="3531569">=</span>&nbsp;<span class="num" id="3531571">40</span>&nbsp;<span class="comment" id="3531574">//&nbsp;computed&nbsp;by&nbsp;calibrate.go</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="comment" id="3531603">//&nbsp;karatsuba&nbsp;multiplies&nbsp;x&nbsp;and&nbsp;y&nbsp;and&nbsp;leaves&nbsp;the&nbsp;result&nbsp;in&nbsp;z.</span><br>
<span class="lineno"></span><span class="comment" id="3531663">//&nbsp;Both&nbsp;x&nbsp;and&nbsp;y&nbsp;must&nbsp;have&nbsp;the&nbsp;same&nbsp;length&nbsp;n&nbsp;and&nbsp;n&nbsp;must&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3531723">//&nbsp;power&nbsp;of&nbsp;2.&nbsp;The&nbsp;result&nbsp;vector&nbsp;z&nbsp;must&nbsp;have&nbsp;len(z)&nbsp;&gt;=&nbsp;6*n.</span><br>
<span class="lineno"></span><span class="comment" id="3531783">//&nbsp;The&nbsp;(non-normalized)&nbsp;result&nbsp;is&nbsp;placed&nbsp;in&nbsp;z[0&nbsp;:&nbsp;2*n].</span><br>
<span class="lineno">245</span><span class="keyword" id="3531839">func</span>&nbsp;<span class="ident" id="3531844">karatsuba</span><span class="op" id="3531853">(</span><span class="ident" id="3531854">z</span><span class="op" id="3531855">,</span>&nbsp;<span class="ident" id="3531857">x</span><span class="op" id="3531858">,</span>&nbsp;<span class="ident" id="3531860">y</span>&nbsp;<span class="ident" id="3531862">nat</span><span class="op" id="3531865">)</span>&nbsp;<span class="op" id="3531867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3531870">n</span>&nbsp;<span class="op" id="3531872">:=</span>&nbsp;<span class="builtinfunc" id="3531875">len</span><span class="op" id="3531878">(</span><span class="ident" id="3531879">y</span><span class="op" id="3531880">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3531884">//&nbsp;Switch&nbsp;to&nbsp;basic&nbsp;multiplication&nbsp;if&nbsp;numbers&nbsp;are&nbsp;odd&nbsp;or&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3531948">//&nbsp;(n&nbsp;is&nbsp;always&nbsp;even&nbsp;if&nbsp;karatsubaThreshold&nbsp;is&nbsp;even,&nbsp;but&nbsp;be</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3532008">//&nbsp;conservative)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3532026">if</span>&nbsp;<span class="ident" id="3532029">n</span><span class="op" id="3532030">&amp;</span><span class="num" id="3532031">1</span>&nbsp;<span class="op" id="3532033">!=</span>&nbsp;<span class="num" id="3532036">0</span>&nbsp;<span class="op" id="3532038">||</span>&nbsp;<span class="ident" id="3532041">n</span>&nbsp;<span class="op" id="3532043">&lt;</span>&nbsp;<span class="ident" id="3532045">karatsubaThreshold</span>&nbsp;<span class="op" id="3532064">||</span>&nbsp;<span class="ident" id="3532067">n</span>&nbsp;<span class="op" id="3532069">&lt;</span>&nbsp;<span class="num" id="3532071">2</span>&nbsp;<span class="op" id="3532073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3532077">basicMul</span><span class="op" id="3532085">(</span><span class="ident" id="3532086">z</span><span class="op" id="3532087">,</span>&nbsp;<span class="ident" id="3532089">x</span><span class="op" id="3532090">,</span>&nbsp;<span class="ident" id="3532092">y</span><span class="op" id="3532093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3532097">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3532105">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3532108">//&nbsp;n&amp;1&nbsp;==&nbsp;0&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;karatsubaThreshold&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3532159">//&nbsp;Karatsuba&nbsp;multiplication&nbsp;is&nbsp;based&nbsp;on&nbsp;the&nbsp;observation&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3532221">//&nbsp;for&nbsp;two&nbsp;numbers&nbsp;x&nbsp;and&nbsp;y&nbsp;with:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3532255">//</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3532259">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;x1*b&nbsp;+&nbsp;x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3532279">//&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;y1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3532299">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3532303">//&nbsp;the&nbsp;product&nbsp;x*y&nbsp;can&nbsp;be&nbsp;obtained&nbsp;with&nbsp;3&nbsp;products&nbsp;z2,&nbsp;z1,&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3532366">//&nbsp;instead&nbsp;of&nbsp;4:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3532384">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3532388">//&nbsp;&nbsp;&nbsp;x*y&nbsp;=&nbsp;x1*y1*b*b&nbsp;+&nbsp;(x1*y0&nbsp;+&nbsp;x0*y1)*b&nbsp;+&nbsp;x0*y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3532438">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;z2*b*b&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;z1*b&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3532488">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3532492">//&nbsp;with:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3532502">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3532506">//&nbsp;&nbsp;&nbsp;xd&nbsp;=&nbsp;x1&nbsp;-&nbsp;x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3532525">//&nbsp;&nbsp;&nbsp;yd&nbsp;=&nbsp;y0&nbsp;-&nbsp;y1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3532544">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3532548">//&nbsp;&nbsp;&nbsp;z1&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;xd*yd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3532599">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;(x1-x0)*(y0&nbsp;-&nbsp;y1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3532650">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;-&nbsp;x1*y1&nbsp;-&nbsp;x0*y0&nbsp;+&nbsp;x0*y1&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3532701">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;z2&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;z0&nbsp;+&nbsp;x0*y1&nbsp;+&nbsp;z2&nbsp;+&nbsp;z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3532752">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;x1*y0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+&nbsp;x0*y1</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3532794">//&nbsp;split&nbsp;x,&nbsp;y&nbsp;into&nbsp;&#34;digits&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3532823">n2</span>&nbsp;<span class="op" id="3532826">:=</span>&nbsp;<span class="ident" id="3532829">n</span>&nbsp;<span class="op" id="3532831">&gt;&gt;</span>&nbsp;<span class="num" id="3532834">1</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3532849">//&nbsp;n2&nbsp;&gt;=&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3532861">x1</span><span class="op" id="3532863">,</span>&nbsp;<span class="ident" id="3532865">x0</span>&nbsp;<span class="op" id="3532868">:=</span>&nbsp;<span class="ident" id="3532871">x</span><span class="op" id="3532872">[</span><span class="ident" id="3532873">n2</span><span class="op" id="3532875">:</span><span class="op" id="3532876">]</span><span class="op" id="3532877">,</span>&nbsp;<span class="ident" id="3532879">x</span><span class="op" id="3532880">[</span><span class="num" id="3532881">0</span><span class="op" id="3532882">:</span><span class="ident" id="3532883">n2</span><span class="op" id="3532885">]</span>&nbsp;<span class="comment" id="3532887">//&nbsp;x&nbsp;=&nbsp;x1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3532905">y1</span><span class="op" id="3532907">,</span>&nbsp;<span class="ident" id="3532909">y0</span>&nbsp;<span class="op" id="3532912">:=</span>&nbsp;<span class="ident" id="3532915">y</span><span class="op" id="3532916">[</span><span class="ident" id="3532917">n2</span><span class="op" id="3532919">:</span><span class="op" id="3532920">]</span><span class="op" id="3532921">,</span>&nbsp;<span class="ident" id="3532923">y</span><span class="op" id="3532924">[</span><span class="num" id="3532925">0</span><span class="op" id="3532926">:</span><span class="ident" id="3532927">n2</span><span class="op" id="3532929">]</span>&nbsp;<span class="comment" id="3532931">//&nbsp;y&nbsp;=&nbsp;y1*b&nbsp;+&nbsp;y0</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3532950">//&nbsp;z&nbsp;is&nbsp;used&nbsp;for&nbsp;the&nbsp;result&nbsp;and&nbsp;temporary&nbsp;storage:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3533002">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3533006">//&nbsp;&nbsp;&nbsp;6*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0*n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3533064">//&nbsp;z&nbsp;=&nbsp;[z2&nbsp;copy|z0&nbsp;copy|&nbsp;xd*yd&nbsp;|&nbsp;yd:xd&nbsp;|&nbsp;x1*y1&nbsp;|&nbsp;x0*y0&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3533122">//</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3533126">//&nbsp;For&nbsp;each&nbsp;recursive&nbsp;call&nbsp;of&nbsp;karatsuba,&nbsp;an&nbsp;unused&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3533187">//&nbsp;z&nbsp;is&nbsp;passed&nbsp;in&nbsp;that&nbsp;has&nbsp;(at&nbsp;least)&nbsp;half&nbsp;the&nbsp;length&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3533249">//&nbsp;caller&#39;s&nbsp;z.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3533266">//&nbsp;compute&nbsp;z0&nbsp;and&nbsp;z2&nbsp;with&nbsp;the&nbsp;result&nbsp;&#34;in&nbsp;place&#34;&nbsp;in&nbsp;z</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3533320">karatsuba</span><span class="op" id="3533329">(</span><span class="ident" id="3533330">z</span><span class="op" id="3533331">,</span>&nbsp;<span class="ident" id="3533333">x0</span><span class="op" id="3533335">,</span>&nbsp;<span class="ident" id="3533337">y0</span><span class="op" id="3533339">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3533345">//&nbsp;z0&nbsp;=&nbsp;x0*y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3533360">karatsuba</span><span class="op" id="3533369">(</span><span class="ident" id="3533370">z</span><span class="op" id="3533371">[</span><span class="ident" id="3533372">n</span><span class="op" id="3533373">:</span><span class="op" id="3533374">]</span><span class="op" id="3533375">,</span>&nbsp;<span class="ident" id="3533377">x1</span><span class="op" id="3533379">,</span>&nbsp;<span class="ident" id="3533381">y1</span><span class="op" id="3533383">)</span>&nbsp;<span class="comment" id="3533385">//&nbsp;z2&nbsp;=&nbsp;x1*y1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3533401">//&nbsp;compute&nbsp;xd&nbsp;(or&nbsp;the&nbsp;negative&nbsp;value&nbsp;if&nbsp;underflow&nbsp;occurs)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3533460">s</span>&nbsp;<span class="op" id="3533462">:=</span>&nbsp;<span class="num" id="3533465">1</span>&nbsp;<span class="comment" id="3533467">//&nbsp;sign&nbsp;of&nbsp;product&nbsp;xd*yd</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3533493">xd</span>&nbsp;<span class="op" id="3533496">:=</span>&nbsp;<span class="ident" id="3533499">z</span><span class="op" id="3533500">[</span><span class="num" id="3533501">2</span><span class="op" id="3533502">*</span><span class="ident" id="3533503">n</span>&nbsp;<span class="op" id="3533505">:</span>&nbsp;<span class="num" id="3533507">2</span><span class="op" id="3533508">*</span><span class="ident" id="3533509">n</span><span class="op" id="3533510">+</span><span class="ident" id="3533511">n2</span><span class="op" id="3533513">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3533516">if</span>&nbsp;<span class="ident" id="3533519">subVV</span><span class="op" id="3533524">(</span><span class="ident" id="3533525">xd</span><span class="op" id="3533527">,</span>&nbsp;<span class="ident" id="3533529">x1</span><span class="op" id="3533531">,</span>&nbsp;<span class="ident" id="3533533">x0</span><span class="op" id="3533535">)</span>&nbsp;<span class="op" id="3533537">!=</span>&nbsp;<span class="num" id="3533540">0</span>&nbsp;<span class="op" id="3533542">{</span>&nbsp;<span class="comment" id="3533544">//&nbsp;x1-x0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3533555">s</span>&nbsp;<span class="op" id="3533557">=</span>&nbsp;<span class="op" id="3533559">-</span><span class="ident" id="3533560">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3533564">subVV</span><span class="op" id="3533569">(</span><span class="ident" id="3533570">xd</span><span class="op" id="3533572">,</span>&nbsp;<span class="ident" id="3533574">x0</span><span class="op" id="3533576">,</span>&nbsp;<span class="ident" id="3533578">x1</span><span class="op" id="3533580">)</span>&nbsp;<span class="comment" id="3533582">//&nbsp;x0-x1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3533592">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3533596">//&nbsp;compute&nbsp;yd&nbsp;(or&nbsp;the&nbsp;negative&nbsp;value&nbsp;if&nbsp;underflow&nbsp;occurs)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3533655">yd</span>&nbsp;<span class="op" id="3533658">:=</span>&nbsp;<span class="ident" id="3533661">z</span><span class="op" id="3533662">[</span><span class="num" id="3533663">2</span><span class="op" id="3533664">*</span><span class="ident" id="3533665">n</span><span class="op" id="3533666">+</span><span class="ident" id="3533667">n2</span>&nbsp;<span class="op" id="3533670">:</span>&nbsp;<span class="num" id="3533672">3</span><span class="op" id="3533673">*</span><span class="ident" id="3533674">n</span><span class="op" id="3533675">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3533678">if</span>&nbsp;<span class="ident" id="3533681">subVV</span><span class="op" id="3533686">(</span><span class="ident" id="3533687">yd</span><span class="op" id="3533689">,</span>&nbsp;<span class="ident" id="3533691">y0</span><span class="op" id="3533693">,</span>&nbsp;<span class="ident" id="3533695">y1</span><span class="op" id="3533697">)</span>&nbsp;<span class="op" id="3533699">!=</span>&nbsp;<span class="num" id="3533702">0</span>&nbsp;<span class="op" id="3533704">{</span>&nbsp;<span class="comment" id="3533706">//&nbsp;y0-y1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3533717">s</span>&nbsp;<span class="op" id="3533719">=</span>&nbsp;<span class="op" id="3533721">-</span><span class="ident" id="3533722">s</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3533726">subVV</span><span class="op" id="3533731">(</span><span class="ident" id="3533732">yd</span><span class="op" id="3533734">,</span>&nbsp;<span class="ident" id="3533736">y1</span><span class="op" id="3533738">,</span>&nbsp;<span class="ident" id="3533740">y0</span><span class="op" id="3533742">)</span>&nbsp;<span class="comment" id="3533744">//&nbsp;y1-y0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3533754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3533758">//&nbsp;p&nbsp;=&nbsp;(x1-x0)*(y0-y1)&nbsp;==&nbsp;x1*y0&nbsp;-&nbsp;x1*y1&nbsp;-&nbsp;x0*y0&nbsp;+&nbsp;x0*y1&nbsp;for&nbsp;s&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3533825">//&nbsp;p&nbsp;=&nbsp;(x0-x1)*(y0-y1)&nbsp;==&nbsp;x0*y0&nbsp;-&nbsp;x0*y1&nbsp;-&nbsp;x1*y0&nbsp;+&nbsp;x1*y1&nbsp;for&nbsp;s&nbsp;&lt;&nbsp;0</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3533892">p</span>&nbsp;<span class="op" id="3533894">:=</span>&nbsp;<span class="ident" id="3533897">z</span><span class="op" id="3533898">[</span><span class="ident" id="3533899">n</span><span class="op" id="3533900">*</span><span class="num" id="3533901">3</span><span class="op" id="3533902">:</span><span class="op" id="3533903">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3533906">karatsuba</span><span class="op" id="3533915">(</span><span class="ident" id="3533916">p</span><span class="op" id="3533917">,</span>&nbsp;<span class="ident" id="3533919">xd</span><span class="op" id="3533921">,</span>&nbsp;<span class="ident" id="3533923">yd</span><span class="op" id="3533925">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3533929">//&nbsp;save&nbsp;original&nbsp;z2:z0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3533953">//&nbsp;(ok&nbsp;to&nbsp;use&nbsp;upper&nbsp;half&nbsp;of&nbsp;z&nbsp;since&nbsp;we&#39;re&nbsp;done&nbsp;recursing)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3534012">r</span>&nbsp;<span class="op" id="3534014">:=</span>&nbsp;<span class="ident" id="3534017">z</span><span class="op" id="3534018">[</span><span class="ident" id="3534019">n</span><span class="op" id="3534020">*</span><span class="num" id="3534021">4</span><span class="op" id="3534022">:</span><span class="op" id="3534023">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3534026">copy</span><span class="op" id="3534030">(</span><span class="ident" id="3534031">r</span><span class="op" id="3534032">,</span>&nbsp;<span class="ident" id="3534034">z</span><span class="op" id="3534035">[</span><span class="op" id="3534036">:</span><span class="ident" id="3534037">n</span><span class="op" id="3534038">*</span><span class="num" id="3534039">2</span><span class="op" id="3534040">]</span><span class="op" id="3534041">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3534045">//&nbsp;add&nbsp;up&nbsp;all&nbsp;partial&nbsp;products</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3534077">//</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3534081">//&nbsp;&nbsp;&nbsp;2*n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3534103">//&nbsp;z&nbsp;=&nbsp;[&nbsp;z2&nbsp;&nbsp;|&nbsp;z0&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3534125">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;z0&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3534144">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;z2&nbsp;&nbsp;]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3534163">//&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;&nbsp;[&nbsp;&nbsp;p&nbsp;&nbsp;]</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3534182">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3534186">karatsubaAdd</span><span class="op" id="3534198">(</span><span class="ident" id="3534199">z</span><span class="op" id="3534200">[</span><span class="ident" id="3534201">n2</span><span class="op" id="3534203">:</span><span class="op" id="3534204">]</span><span class="op" id="3534205">,</span>&nbsp;<span class="ident" id="3534207">r</span><span class="op" id="3534208">,</span>&nbsp;<span class="ident" id="3534210">n</span><span class="op" id="3534211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3534214">karatsubaAdd</span><span class="op" id="3534226">(</span><span class="ident" id="3534227">z</span><span class="op" id="3534228">[</span><span class="ident" id="3534229">n2</span><span class="op" id="3534231">:</span><span class="op" id="3534232">]</span><span class="op" id="3534233">,</span>&nbsp;<span class="ident" id="3534235">r</span><span class="op" id="3534236">[</span><span class="ident" id="3534237">n</span><span class="op" id="3534238">:</span><span class="op" id="3534239">]</span><span class="op" id="3534240">,</span>&nbsp;<span class="ident" id="3534242">n</span><span class="op" id="3534243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3534246">if</span>&nbsp;<span class="ident" id="3534249">s</span>&nbsp;<span class="op" id="3534251">&gt;</span>&nbsp;<span class="num" id="3534253">0</span>&nbsp;<span class="op" id="3534255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3534259">karatsubaAdd</span><span class="op" id="3534271">(</span><span class="ident" id="3534272">z</span><span class="op" id="3534273">[</span><span class="ident" id="3534274">n2</span><span class="op" id="3534276">:</span><span class="op" id="3534277">]</span><span class="op" id="3534278">,</span>&nbsp;<span class="ident" id="3534280">p</span><span class="op" id="3534281">,</span>&nbsp;<span class="ident" id="3534283">n</span><span class="op" id="3534284">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3534287">}</span>&nbsp;<span class="keyword" id="3534289">else</span>&nbsp;<span class="op" id="3534294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3534298">karatsubaSub</span><span class="op" id="3534310">(</span><span class="ident" id="3534311">z</span><span class="op" id="3534312">[</span><span class="ident" id="3534313">n2</span><span class="op" id="3534315">:</span><span class="op" id="3534316">]</span><span class="op" id="3534317">,</span>&nbsp;<span class="ident" id="3534319">p</span><span class="op" id="3534320">,</span>&nbsp;<span class="ident" id="3534322">n</span><span class="op" id="3534323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3534326">}</span><br>
<span class="lineno"></span><span class="op" id="3534328">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="3534331">//&nbsp;alias&nbsp;returns&nbsp;true&nbsp;if&nbsp;x&nbsp;and&nbsp;y&nbsp;share&nbsp;the&nbsp;same&nbsp;base&nbsp;array.</span><br>
<span class="lineno"></span><span class="keyword" id="3534391">func</span>&nbsp;<span class="ident" id="3534396">alias</span><span class="op" id="3534401">(</span><span class="ident" id="3534402">x</span><span class="op" id="3534403">,</span>&nbsp;<span class="ident" id="3534405">y</span>&nbsp;<span class="ident" id="3534407">nat</span><span class="op" id="3534410">)</span>&nbsp;<span class="builtintype" id="3534412">bool</span>&nbsp;<span class="op" id="3534417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3534420">return</span>&nbsp;<span class="builtinfunc" id="3534427">cap</span><span class="op" id="3534430">(</span><span class="ident" id="3534431">x</span><span class="op" id="3534432">)</span>&nbsp;<span class="op" id="3534434">&gt;</span>&nbsp;<span class="num" id="3534436">0</span>&nbsp;<span class="op" id="3534438">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3534441">cap</span><span class="op" id="3534444">(</span><span class="ident" id="3534445">y</span><span class="op" id="3534446">)</span>&nbsp;<span class="op" id="3534448">&gt;</span>&nbsp;<span class="num" id="3534450">0</span>&nbsp;<span class="op" id="3534452">&amp;&amp;</span>&nbsp;<span class="op" id="3534455">&amp;</span><span class="ident" id="3534456">x</span><span class="op" id="3534457">[</span><span class="num" id="3534458">0</span><span class="op" id="3534459">:</span><span class="builtinfunc" id="3534460">cap</span><span class="op" id="3534463">(</span><span class="ident" id="3534464">x</span><span class="op" id="3534465">)</span><span class="op" id="3534466">]</span><span class="op" id="3534467">[</span><span class="builtinfunc" id="3534468">cap</span><span class="op" id="3534471">(</span><span class="ident" id="3534472">x</span><span class="op" id="3534473">)</span><span class="op" id="3534474">-</span><span class="num" id="3534475">1</span><span class="op" id="3534476">]</span>&nbsp;<span class="op" id="3534478">==</span>&nbsp;<span class="op" id="3534481">&amp;</span><span class="ident" id="3534482">y</span><span class="op" id="3534483">[</span><span class="num" id="3534484">0</span><span class="op" id="3534485">:</span><span class="builtinfunc" id="3534486">cap</span><span class="op" id="3534489">(</span><span class="ident" id="3534490">y</span><span class="op" id="3534491">)</span><span class="op" id="3534492">]</span><span class="op" id="3534493">[</span><span class="builtinfunc" id="3534494">cap</span><span class="op" id="3534497">(</span><span class="ident" id="3534498">y</span><span class="op" id="3534499">)</span><span class="op" id="3534500">-</span><span class="num" id="3534501">1</span><span class="op" id="3534502">]</span><br>
<span class="lineno"></span><span class="op" id="3534504">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="comment" id="3534507">//&nbsp;addAt&nbsp;implements&nbsp;z&nbsp;+=&nbsp;x&lt;&lt;(_W*i);&nbsp;z&nbsp;must&nbsp;be&nbsp;long&nbsp;enough.</span><br>
<span class="lineno"></span><span class="comment" id="3534566">//&nbsp;(we&nbsp;don&#39;t&nbsp;use&nbsp;nat.add&nbsp;because&nbsp;we&nbsp;need&nbsp;z&nbsp;to&nbsp;stay&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="3534626">//&nbsp;slice,&nbsp;and&nbsp;we&nbsp;don&#39;t&nbsp;need&nbsp;to&nbsp;normalize&nbsp;z&nbsp;after&nbsp;each&nbsp;addition)</span><br>
<span class="lineno"></span><span class="keyword" id="3534690">func</span>&nbsp;<span class="ident" id="3534695">addAt</span><span class="op" id="3534700">(</span><span class="ident" id="3534701">z</span><span class="op" id="3534702">,</span>&nbsp;<span class="ident" id="3534704">x</span>&nbsp;<span class="ident" id="3534706">nat</span><span class="op" id="3534709">,</span>&nbsp;<span class="ident" id="3534711">i</span>&nbsp;<span class="builtintype" id="3534713">int</span><span class="op" id="3534716">)</span>&nbsp;<span class="op" id="3534718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3534721">if</span>&nbsp;<span class="ident" id="3534724">n</span>&nbsp;<span class="op" id="3534726">:=</span>&nbsp;<span class="builtinfunc" id="3534729">len</span><span class="op" id="3534732">(</span><span class="ident" id="3534733">x</span><span class="op" id="3534734">)</span><span class="op" id="3534735">;</span>&nbsp;<span class="ident" id="3534737">n</span>&nbsp;<span class="op" id="3534739">&gt;</span>&nbsp;<span class="num" id="3534741">0</span>&nbsp;<span class="op" id="3534743">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3534747">if</span>&nbsp;<span class="ident" id="3534750">c</span>&nbsp;<span class="op" id="3534752">:=</span>&nbsp;<span class="ident" id="3534755">addVV</span><span class="op" id="3534760">(</span><span class="ident" id="3534761">z</span><span class="op" id="3534762">[</span><span class="ident" id="3534763">i</span><span class="op" id="3534764">:</span><span class="ident" id="3534765">i</span><span class="op" id="3534766">+</span><span class="ident" id="3534767">n</span><span class="op" id="3534768">]</span><span class="op" id="3534769">,</span>&nbsp;<span class="ident" id="3534771">z</span><span class="op" id="3534772">[</span><span class="ident" id="3534773">i</span><span class="op" id="3534774">:</span><span class="op" id="3534775">]</span><span class="op" id="3534776">,</span>&nbsp;<span class="ident" id="3534778">x</span><span class="op" id="3534779">)</span><span class="op" id="3534780">;</span>&nbsp;<span class="ident" id="3534782">c</span>&nbsp;<span class="op" id="3534784">!=</span>&nbsp;<span class="num" id="3534787">0</span>&nbsp;<span class="op" id="3534789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3534794">j</span>&nbsp;<span class="op" id="3534796">:=</span>&nbsp;<span class="ident" id="3534799">i</span>&nbsp;<span class="op" id="3534801">+</span>&nbsp;<span class="ident" id="3534803">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3534808">if</span>&nbsp;<span class="ident" id="3534811">j</span>&nbsp;<span class="op" id="3534813">&lt;</span>&nbsp;<span class="builtinfunc" id="3534815">len</span><span class="op" id="3534818">(</span><span class="ident" id="3534819">z</span><span class="op" id="3534820">)</span>&nbsp;<span class="op" id="3534822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3534828">addVW</span><span class="op" id="3534833">(</span><span class="ident" id="3534834">z</span><span class="op" id="3534835">[</span><span class="ident" id="3534836">j</span><span class="op" id="3534837">:</span><span class="op" id="3534838">]</span><span class="op" id="3534839">,</span>&nbsp;<span class="ident" id="3534841">z</span><span class="op" id="3534842">[</span><span class="ident" id="3534843">j</span><span class="op" id="3534844">:</span><span class="op" id="3534845">]</span><span class="op" id="3534846">,</span>&nbsp;<span class="ident" id="3534848">c</span><span class="op" id="3534849">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3534854">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3534858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3534861">}</span><br>
<span class="lineno"></span><span class="op" id="3534863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3534866">func</span>&nbsp;<span class="ident" id="3534871">max</span><span class="op" id="3534874">(</span><span class="ident" id="3534875">x</span><span class="op" id="3534876">,</span>&nbsp;<span class="ident" id="3534878">y</span>&nbsp;<span class="builtintype" id="3534880">int</span><span class="op" id="3534883">)</span>&nbsp;<span class="builtintype" id="3534885">int</span>&nbsp;<span class="op" id="3534889">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3534892">if</span>&nbsp;<span class="ident" id="3534895">x</span>&nbsp;<span class="op" id="3534897">&gt;</span>&nbsp;<span class="ident" id="3534899">y</span>&nbsp;<span class="op" id="3534901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3534905">return</span>&nbsp;<span class="ident" id="3534912">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3534915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3534918">return</span>&nbsp;<span class="ident" id="3534925">y</span><br>
<span class="lineno"></span><span class="op" id="3534927">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="comment" id="3534930">//&nbsp;karatsubaLen&nbsp;computes&nbsp;an&nbsp;approximation&nbsp;to&nbsp;the&nbsp;maximum&nbsp;k&nbsp;&lt;=&nbsp;n&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3535004">//&nbsp;k&nbsp;=&nbsp;p&lt;&lt;i&nbsp;for&nbsp;a&nbsp;number&nbsp;p&nbsp;&lt;=&nbsp;karatsubaThreshold&nbsp;and&nbsp;an&nbsp;i&nbsp;&gt;=&nbsp;0.&nbsp;Thus,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3535078">//&nbsp;result&nbsp;is&nbsp;the&nbsp;largest&nbsp;number&nbsp;that&nbsp;can&nbsp;be&nbsp;divided&nbsp;repeatedly&nbsp;by&nbsp;2&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="3535153">//&nbsp;becoming&nbsp;about&nbsp;the&nbsp;value&nbsp;of&nbsp;karatsubaThreshold.</span><br>
<span class="lineno">370</span><span class="keyword" id="3535204">func</span>&nbsp;<span class="ident" id="3535209">karatsubaLen</span><span class="op" id="3535221">(</span><span class="ident" id="3535222">n</span>&nbsp;<span class="builtintype" id="3535224">int</span><span class="op" id="3535227">)</span>&nbsp;<span class="builtintype" id="3535229">int</span>&nbsp;<span class="op" id="3535233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3535236">i</span>&nbsp;<span class="op" id="3535238">:=</span>&nbsp;<span class="builtintype" id="3535241">uint</span><span class="op" id="3535245">(</span><span class="num" id="3535246">0</span><span class="op" id="3535247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3535250">for</span>&nbsp;<span class="ident" id="3535254">n</span>&nbsp;<span class="op" id="3535256">&gt;</span>&nbsp;<span class="ident" id="3535258">karatsubaThreshold</span>&nbsp;<span class="op" id="3535277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3535281">n</span>&nbsp;<span class="op" id="3535283">&gt;&gt;=</span>&nbsp;<span class="num" id="3535287">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3535291">i</span><span class="op" id="3535292">++</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3535296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3535299">return</span>&nbsp;<span class="ident" id="3535306">n</span>&nbsp;<span class="op" id="3535308">&lt;&lt;</span>&nbsp;<span class="ident" id="3535311">i</span><br>
<span class="lineno"></span><span class="op" id="3535313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3535316">func</span>&nbsp;<span class="op" id="3535321">(</span><span class="ident" id="3535322">z</span>&nbsp;<span class="ident" id="3535324">nat</span><span class="op" id="3535327">)</span>&nbsp;<span class="ident" id="3535329">mul</span><span class="op" id="3535332">(</span><span class="ident" id="3535333">x</span><span class="op" id="3535334">,</span>&nbsp;<span class="ident" id="3535336">y</span>&nbsp;<span class="ident" id="3535338">nat</span><span class="op" id="3535341">)</span>&nbsp;<span class="ident" id="3535343">nat</span>&nbsp;<span class="op" id="3535347">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3535350">m</span>&nbsp;<span class="op" id="3535352">:=</span>&nbsp;<span class="builtinfunc" id="3535355">len</span><span class="op" id="3535358">(</span><span class="ident" id="3535359">x</span><span class="op" id="3535360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3535363">n</span>&nbsp;<span class="op" id="3535365">:=</span>&nbsp;<span class="builtinfunc" id="3535368">len</span><span class="op" id="3535371">(</span><span class="ident" id="3535372">y</span><span class="op" id="3535373">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3535377">switch</span>&nbsp;<span class="op" id="3535384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3535387">case</span>&nbsp;<span class="ident" id="3535392">m</span>&nbsp;<span class="op" id="3535394">&lt;</span>&nbsp;<span class="ident" id="3535396">n</span><span class="op" id="3535397">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3535401">return</span>&nbsp;<span class="ident" id="3535408">z</span><span class="op" id="3535409">.</span><span class="ident" id="3535410">mul</span><span class="op" id="3535413">(</span><span class="ident" id="3535414">y</span><span class="op" id="3535415">,</span>&nbsp;<span class="ident" id="3535417">x</span><span class="op" id="3535418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3535421">case</span>&nbsp;<span class="ident" id="3535426">m</span>&nbsp;<span class="op" id="3535428">==</span>&nbsp;<span class="num" id="3535431">0</span>&nbsp;<span class="op" id="3535433">||</span>&nbsp;<span class="ident" id="3535436">n</span>&nbsp;<span class="op" id="3535438">==</span>&nbsp;<span class="num" id="3535441">0</span><span class="op" id="3535442">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3535446">return</span>&nbsp;<span class="ident" id="3535453">z</span><span class="op" id="3535454">.</span><span class="builtinfunc" id="3535455">make</span><span class="op" id="3535459">(</span><span class="num" id="3535460">0</span><span class="op" id="3535461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3535464">case</span>&nbsp;<span class="ident" id="3535469">n</span>&nbsp;<span class="op" id="3535471">==</span>&nbsp;<span class="num" id="3535474">1</span><span class="op" id="3535475">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3535479">return</span>&nbsp;<span class="ident" id="3535486">z</span><span class="op" id="3535487">.</span><span class="ident" id="3535488">mulAddWW</span><span class="op" id="3535496">(</span><span class="ident" id="3535497">x</span><span class="op" id="3535498">,</span>&nbsp;<span class="ident" id="3535500">y</span><span class="op" id="3535501">[</span><span class="num" id="3535502">0</span><span class="op" id="3535503">]</span><span class="op" id="3535504">,</span>&nbsp;<span class="num" id="3535506">0</span><span class="op" id="3535507">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3535510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3535513">//&nbsp;m&nbsp;&gt;=&nbsp;n&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3535529">//&nbsp;determine&nbsp;if&nbsp;z&nbsp;can&nbsp;be&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3535562">if</span>&nbsp;<span class="ident" id="3535565">alias</span><span class="op" id="3535570">(</span><span class="ident" id="3535571">z</span><span class="op" id="3535572">,</span>&nbsp;<span class="ident" id="3535574">x</span><span class="op" id="3535575">)</span>&nbsp;<span class="op" id="3535577">||</span>&nbsp;<span class="ident" id="3535580">alias</span><span class="op" id="3535585">(</span><span class="ident" id="3535586">z</span><span class="op" id="3535587">,</span>&nbsp;<span class="ident" id="3535589">y</span><span class="op" id="3535590">)</span>&nbsp;<span class="op" id="3535592">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3535596">z</span>&nbsp;<span class="op" id="3535598">=</span>&nbsp;<span class="ident" id="3535600">nil</span>&nbsp;<span class="comment" id="3535604">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;x&nbsp;or&nbsp;y&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3535648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3535652">//&nbsp;use&nbsp;basic&nbsp;multiplication&nbsp;if&nbsp;the&nbsp;numbers&nbsp;are&nbsp;small</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3535706">if</span>&nbsp;<span class="ident" id="3535709">n</span>&nbsp;<span class="op" id="3535711">&lt;</span>&nbsp;<span class="ident" id="3535713">karatsubaThreshold</span>&nbsp;<span class="op" id="3535732">{</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3535736">z</span>&nbsp;<span class="op" id="3535738">=</span>&nbsp;<span class="ident" id="3535740">z</span><span class="op" id="3535741">.</span><span class="builtinfunc" id="3535742">make</span><span class="op" id="3535746">(</span><span class="ident" id="3535747">m</span>&nbsp;<span class="op" id="3535749">+</span>&nbsp;<span class="ident" id="3535751">n</span><span class="op" id="3535752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3535756">basicMul</span><span class="op" id="3535764">(</span><span class="ident" id="3535765">z</span><span class="op" id="3535766">,</span>&nbsp;<span class="ident" id="3535768">x</span><span class="op" id="3535769">,</span>&nbsp;<span class="ident" id="3535771">y</span><span class="op" id="3535772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3535776">return</span>&nbsp;<span class="ident" id="3535783">z</span><span class="op" id="3535784">.</span><span class="ident" id="3535785">norm</span><span class="op" id="3535789">(</span><span class="op" id="3535790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3535793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3535796">//&nbsp;m&nbsp;&gt;=&nbsp;n&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;karatsubaThreshold&nbsp;&amp;&amp;&nbsp;n&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3535845">//&nbsp;determine&nbsp;Karatsuba&nbsp;length&nbsp;k&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3535888">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3535892">//&nbsp;&nbsp;&nbsp;x&nbsp;=&nbsp;xh*b&nbsp;+&nbsp;x0&nbsp;&nbsp;(0&nbsp;&lt;=&nbsp;x0&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3535927">//&nbsp;&nbsp;&nbsp;y&nbsp;=&nbsp;yh*b&nbsp;+&nbsp;y0&nbsp;&nbsp;(0&nbsp;&lt;=&nbsp;y0&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3535962">//&nbsp;&nbsp;&nbsp;b&nbsp;=&nbsp;1&lt;&lt;(_W*k)&nbsp;&nbsp;(&#34;base&#34;&nbsp;of&nbsp;digits&nbsp;xi,&nbsp;yi)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3536009">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3536013">k</span>&nbsp;<span class="op" id="3536015">:=</span>&nbsp;<span class="ident" id="3536018">karatsubaLen</span><span class="op" id="3536030">(</span><span class="ident" id="3536031">n</span><span class="op" id="3536032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3536035">//&nbsp;k&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3536047">//&nbsp;multiply&nbsp;x0&nbsp;and&nbsp;y0&nbsp;via&nbsp;Karatsuba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3536084">x0</span>&nbsp;<span class="op" id="3536087">:=</span>&nbsp;<span class="ident" id="3536090">x</span><span class="op" id="3536091">[</span><span class="num" id="3536092">0</span><span class="op" id="3536093">:</span><span class="ident" id="3536094">k</span><span class="op" id="3536095">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3536110">//&nbsp;x0&nbsp;is&nbsp;not&nbsp;normalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3536135">y0</span>&nbsp;<span class="op" id="3536138">:=</span>&nbsp;<span class="ident" id="3536141">y</span><span class="op" id="3536142">[</span><span class="num" id="3536143">0</span><span class="op" id="3536144">:</span><span class="ident" id="3536145">k</span><span class="op" id="3536146">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3536161">//&nbsp;y0&nbsp;is&nbsp;not&nbsp;normalized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3536186">z</span>&nbsp;<span class="op" id="3536188">=</span>&nbsp;<span class="ident" id="3536190">z</span><span class="op" id="3536191">.</span><span class="builtinfunc" id="3536192">make</span><span class="op" id="3536196">(</span><span class="ident" id="3536197">max</span><span class="op" id="3536200">(</span><span class="num" id="3536201">6</span><span class="op" id="3536202">*</span><span class="ident" id="3536203">k</span><span class="op" id="3536204">,</span>&nbsp;<span class="ident" id="3536206">m</span><span class="op" id="3536207">+</span><span class="ident" id="3536208">n</span><span class="op" id="3536209">)</span><span class="op" id="3536210">)</span>&nbsp;<span class="comment" id="3536212">//&nbsp;enough&nbsp;space&nbsp;for&nbsp;karatsuba&nbsp;of&nbsp;x0*y0&nbsp;and&nbsp;full&nbsp;result&nbsp;of&nbsp;x*y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3536275">karatsuba</span><span class="op" id="3536284">(</span><span class="ident" id="3536285">z</span><span class="op" id="3536286">,</span>&nbsp;<span class="ident" id="3536288">x0</span><span class="op" id="3536290">,</span>&nbsp;<span class="ident" id="3536292">y0</span><span class="op" id="3536294">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3536297">z</span>&nbsp;<span class="op" id="3536299">=</span>&nbsp;<span class="ident" id="3536301">z</span><span class="op" id="3536302">[</span><span class="num" id="3536303">0</span>&nbsp;<span class="op" id="3536305">:</span>&nbsp;<span class="ident" id="3536307">m</span><span class="op" id="3536308">+</span><span class="ident" id="3536309">n</span><span class="op" id="3536310">]</span>&nbsp;&nbsp;<span class="comment" id="3536313">//&nbsp;z&nbsp;has&nbsp;final&nbsp;length&nbsp;but&nbsp;may&nbsp;be&nbsp;incomplete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3536358">z</span><span class="op" id="3536359">[</span><span class="num" id="3536360">2</span><span class="op" id="3536361">*</span><span class="ident" id="3536362">k</span><span class="op" id="3536363">:</span><span class="op" id="3536364">]</span><span class="op" id="3536365">.</span><span class="ident" id="3536366">clear</span><span class="op" id="3536371">(</span><span class="op" id="3536372">)</span>&nbsp;<span class="comment" id="3536374">//&nbsp;upper&nbsp;portion&nbsp;of&nbsp;z&nbsp;is&nbsp;garbage&nbsp;(and&nbsp;2*k&nbsp;&lt;=&nbsp;m+n&nbsp;since&nbsp;k&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;m)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3536444">//&nbsp;If&nbsp;xh&nbsp;!=&nbsp;0&nbsp;or&nbsp;yh&nbsp;!=&nbsp;0,&nbsp;add&nbsp;the&nbsp;missing&nbsp;terms&nbsp;to&nbsp;z.&nbsp;For</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3536503">//</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3536507">//&nbsp;&nbsp;&nbsp;xh&nbsp;=&nbsp;xi*b^i&nbsp;+&nbsp;...&nbsp;+&nbsp;x2*b^2&nbsp;+&nbsp;x1*b&nbsp;(0&nbsp;&lt;=&nbsp;xi&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3536561">//&nbsp;&nbsp;&nbsp;yh&nbsp;=&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y1*b&nbsp;(0&nbsp;&lt;=&nbsp;y1&nbsp;&lt;&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3536615">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3536619">//&nbsp;the&nbsp;missing&nbsp;terms&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3536645">//</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3536649">//&nbsp;&nbsp;&nbsp;x0*y1*b&nbsp;and&nbsp;xi*y0*b^i,&nbsp;xi*y1*b^(i+1)&nbsp;for&nbsp;i&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3536702">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3536706">//&nbsp;since&nbsp;all&nbsp;the&nbsp;yi&nbsp;for&nbsp;i&nbsp;&gt;&nbsp;1&nbsp;are&nbsp;0&nbsp;by&nbsp;choice&nbsp;of&nbsp;k:&nbsp;If&nbsp;any&nbsp;of&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3536774">//&nbsp;were&nbsp;&gt;&nbsp;0,&nbsp;then&nbsp;yh&nbsp;&gt;=&nbsp;b^2&nbsp;and&nbsp;thus&nbsp;y&nbsp;&gt;=&nbsp;b^2.&nbsp;Then&nbsp;k&#39;&nbsp;=&nbsp;k*2&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3536842">//&nbsp;be&nbsp;a&nbsp;larger&nbsp;valid&nbsp;threshold&nbsp;contradicting&nbsp;the&nbsp;assumption&nbsp;about&nbsp;k.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3536912">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3536916">if</span>&nbsp;<span class="ident" id="3536919">k</span>&nbsp;<span class="op" id="3536921">&lt;</span>&nbsp;<span class="ident" id="3536923">n</span>&nbsp;<span class="op" id="3536925">||</span>&nbsp;<span class="ident" id="3536928">m</span>&nbsp;<span class="op" id="3536930">!=</span>&nbsp;<span class="ident" id="3536933">n</span>&nbsp;<span class="op" id="3536935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3536939">var</span>&nbsp;<span class="ident" id="3536943">t</span>&nbsp;<span class="ident" id="3536945">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3536952">//&nbsp;add&nbsp;x0*y1*b</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3536969">x0</span>&nbsp;<span class="op" id="3536972">:=</span>&nbsp;<span class="ident" id="3536975">x0</span><span class="op" id="3536977">.</span><span class="ident" id="3536978">norm</span><span class="op" id="3536982">(</span><span class="op" id="3536983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3536987">y1</span>&nbsp;<span class="op" id="3536990">:=</span>&nbsp;<span class="ident" id="3536993">y</span><span class="op" id="3536994">[</span><span class="ident" id="3536995">k</span><span class="op" id="3536996">:</span><span class="op" id="3536997">]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3537005">//&nbsp;y1&nbsp;is&nbsp;normalized&nbsp;because&nbsp;y&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3537040">t</span>&nbsp;<span class="op" id="3537042">=</span>&nbsp;<span class="ident" id="3537044">t</span><span class="op" id="3537045">.</span><span class="ident" id="3537046">mul</span><span class="op" id="3537049">(</span><span class="ident" id="3537050">x0</span><span class="op" id="3537052">,</span>&nbsp;<span class="ident" id="3537054">y1</span><span class="op" id="3537056">)</span>&nbsp;<span class="comment" id="3537058">//&nbsp;update&nbsp;t&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;lose&nbsp;t&#39;s&nbsp;underlying&nbsp;array</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3537110">addAt</span><span class="op" id="3537115">(</span><span class="ident" id="3537116">z</span><span class="op" id="3537117">,</span>&nbsp;<span class="ident" id="3537119">t</span><span class="op" id="3537120">,</span>&nbsp;<span class="ident" id="3537122">k</span><span class="op" id="3537123">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3537128">//&nbsp;add&nbsp;xi*y0&lt;&lt;i,&nbsp;xi*y1*b&lt;&lt;(i+k)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3537162">y0</span>&nbsp;<span class="op" id="3537165">:=</span>&nbsp;<span class="ident" id="3537168">y0</span><span class="op" id="3537170">.</span><span class="ident" id="3537171">norm</span><span class="op" id="3537175">(</span><span class="op" id="3537176">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3537180">for</span>&nbsp;<span class="ident" id="3537184">i</span>&nbsp;<span class="op" id="3537186">:=</span>&nbsp;<span class="ident" id="3537189">k</span><span class="op" id="3537190">;</span>&nbsp;<span class="ident" id="3537192">i</span>&nbsp;<span class="op" id="3537194">&lt;</span>&nbsp;<span class="builtinfunc" id="3537196">len</span><span class="op" id="3537199">(</span><span class="ident" id="3537200">x</span><span class="op" id="3537201">)</span><span class="op" id="3537202">;</span>&nbsp;<span class="ident" id="3537204">i</span>&nbsp;<span class="op" id="3537206">+=</span>&nbsp;<span class="ident" id="3537209">k</span>&nbsp;<span class="op" id="3537211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3537216">xi</span>&nbsp;<span class="op" id="3537219">:=</span>&nbsp;<span class="ident" id="3537222">x</span><span class="op" id="3537223">[</span><span class="ident" id="3537224">i</span><span class="op" id="3537225">:</span><span class="op" id="3537226">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3537231">if</span>&nbsp;<span class="builtinfunc" id="3537234">len</span><span class="op" id="3537237">(</span><span class="ident" id="3537238">xi</span><span class="op" id="3537240">)</span>&nbsp;<span class="op" id="3537242">&gt;</span>&nbsp;<span class="ident" id="3537244">k</span>&nbsp;<span class="op" id="3537246">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3537252">xi</span>&nbsp;<span class="op" id="3537255">=</span>&nbsp;<span class="ident" id="3537257">xi</span><span class="op" id="3537259">[</span><span class="op" id="3537260">:</span><span class="ident" id="3537261">k</span><span class="op" id="3537262">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3537267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3537272">xi</span>&nbsp;<span class="op" id="3537275">=</span>&nbsp;<span class="ident" id="3537277">xi</span><span class="op" id="3537279">.</span><span class="ident" id="3537280">norm</span><span class="op" id="3537284">(</span><span class="op" id="3537285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3537290">t</span>&nbsp;<span class="op" id="3537292">=</span>&nbsp;<span class="ident" id="3537294">t</span><span class="op" id="3537295">.</span><span class="ident" id="3537296">mul</span><span class="op" id="3537299">(</span><span class="ident" id="3537300">xi</span><span class="op" id="3537302">,</span>&nbsp;<span class="ident" id="3537304">y0</span><span class="op" id="3537306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3537311">addAt</span><span class="op" id="3537316">(</span><span class="ident" id="3537317">z</span><span class="op" id="3537318">,</span>&nbsp;<span class="ident" id="3537320">t</span><span class="op" id="3537321">,</span>&nbsp;<span class="ident" id="3537323">i</span><span class="op" id="3537324">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3537329">t</span>&nbsp;<span class="op" id="3537331">=</span>&nbsp;<span class="ident" id="3537333">t</span><span class="op" id="3537334">.</span><span class="ident" id="3537335">mul</span><span class="op" id="3537338">(</span><span class="ident" id="3537339">xi</span><span class="op" id="3537341">,</span>&nbsp;<span class="ident" id="3537343">y1</span><span class="op" id="3537345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3537350">addAt</span><span class="op" id="3537355">(</span><span class="ident" id="3537356">z</span><span class="op" id="3537357">,</span>&nbsp;<span class="ident" id="3537359">t</span><span class="op" id="3537360">,</span>&nbsp;<span class="ident" id="3537362">i</span><span class="op" id="3537363">+</span><span class="ident" id="3537364">k</span><span class="op" id="3537365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3537369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3537372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3537376">return</span>&nbsp;<span class="ident" id="3537383">z</span><span class="op" id="3537384">.</span><span class="ident" id="3537385">norm</span><span class="op" id="3537389">(</span><span class="op" id="3537390">)</span><br>
<span class="lineno"></span><span class="op" id="3537392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3537395">//&nbsp;mulRange&nbsp;computes&nbsp;the&nbsp;product&nbsp;of&nbsp;all&nbsp;the&nbsp;unsigned&nbsp;integers&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3537464">//&nbsp;range&nbsp;[a,&nbsp;b]&nbsp;inclusively.&nbsp;If&nbsp;a&nbsp;&gt;&nbsp;b&nbsp;(empty&nbsp;range),&nbsp;the&nbsp;result&nbsp;is&nbsp;1.</span><br>
<span class="lineno">465</span><span class="keyword" id="3537534">func</span>&nbsp;<span class="op" id="3537539">(</span><span class="ident" id="3537540">z</span>&nbsp;<span class="ident" id="3537542">nat</span><span class="op" id="3537545">)</span>&nbsp;<span class="ident" id="3537547">mulRange</span><span class="op" id="3537555">(</span><span class="ident" id="3537556">a</span><span class="op" id="3537557">,</span>&nbsp;<span class="ident" id="3537559">b</span>&nbsp;<span class="ident" id="3537561">uint64</span><span class="op" id="3537567">)</span>&nbsp;<span class="ident" id="3537569">nat</span>&nbsp;<span class="op" id="3537573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3537576">switch</span>&nbsp;<span class="op" id="3537583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3537586">case</span>&nbsp;<span class="ident" id="3537591">a</span>&nbsp;<span class="op" id="3537593">==</span>&nbsp;<span class="num" id="3537596">0</span><span class="op" id="3537597">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3537601">//&nbsp;cut&nbsp;long&nbsp;ranges&nbsp;short&nbsp;(optimization)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3537643">return</span>&nbsp;<span class="ident" id="3537650">z</span><span class="op" id="3537651">.</span><span class="ident" id="3537652">setUint64</span><span class="op" id="3537661">(</span><span class="num" id="3537662">0</span><span class="op" id="3537663">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3537666">case</span>&nbsp;<span class="ident" id="3537671">a</span>&nbsp;<span class="op" id="3537673">&gt;</span>&nbsp;<span class="ident" id="3537675">b</span><span class="op" id="3537676">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3537680">return</span>&nbsp;<span class="ident" id="3537687">z</span><span class="op" id="3537688">.</span><span class="ident" id="3537689">setUint64</span><span class="op" id="3537698">(</span><span class="num" id="3537699">1</span><span class="op" id="3537700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3537703">case</span>&nbsp;<span class="ident" id="3537708">a</span>&nbsp;<span class="op" id="3537710">==</span>&nbsp;<span class="ident" id="3537713">b</span><span class="op" id="3537714">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3537718">return</span>&nbsp;<span class="ident" id="3537725">z</span><span class="op" id="3537726">.</span><span class="ident" id="3537727">setUint64</span><span class="op" id="3537736">(</span><span class="ident" id="3537737">a</span><span class="op" id="3537738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3537741">case</span>&nbsp;<span class="ident" id="3537746">a</span><span class="op" id="3537747">+</span><span class="num" id="3537748">1</span>&nbsp;<span class="op" id="3537750">==</span>&nbsp;<span class="ident" id="3537753">b</span><span class="op" id="3537754">:</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3537758">return</span>&nbsp;<span class="ident" id="3537765">z</span><span class="op" id="3537766">.</span><span class="ident" id="3537767">mul</span><span class="op" id="3537770">(</span><span class="ident" id="3537771">nat</span><span class="op" id="3537774">(</span><span class="ident" id="3537775">nil</span><span class="op" id="3537778">)</span><span class="op" id="3537779">.</span><span class="ident" id="3537780">setUint64</span><span class="op" id="3537789">(</span><span class="ident" id="3537790">a</span><span class="op" id="3537791">)</span><span class="op" id="3537792">,</span>&nbsp;<span class="ident" id="3537794">nat</span><span class="op" id="3537797">(</span><span class="ident" id="3537798">nil</span><span class="op" id="3537801">)</span><span class="op" id="3537802">.</span><span class="ident" id="3537803">setUint64</span><span class="op" id="3537812">(</span><span class="ident" id="3537813">b</span><span class="op" id="3537814">)</span><span class="op" id="3537815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3537818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3537821">m</span>&nbsp;<span class="op" id="3537823">:=</span>&nbsp;<span class="op" id="3537826">(</span><span class="ident" id="3537827">a</span>&nbsp;<span class="op" id="3537829">+</span>&nbsp;<span class="ident" id="3537831">b</span><span class="op" id="3537832">)</span>&nbsp;<span class="op" id="3537834">/</span>&nbsp;<span class="num" id="3537836">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3537839">return</span>&nbsp;<span class="ident" id="3537846">z</span><span class="op" id="3537847">.</span><span class="ident" id="3537848">mul</span><span class="op" id="3537851">(</span><span class="ident" id="3537852">nat</span><span class="op" id="3537855">(</span><span class="ident" id="3537856">nil</span><span class="op" id="3537859">)</span><span class="op" id="3537860">.</span><span class="ident" id="3537861">mulRange</span><span class="op" id="3537869">(</span><span class="ident" id="3537870">a</span><span class="op" id="3537871">,</span>&nbsp;<span class="ident" id="3537873">m</span><span class="op" id="3537874">)</span><span class="op" id="3537875">,</span>&nbsp;<span class="ident" id="3537877">nat</span><span class="op" id="3537880">(</span><span class="ident" id="3537881">nil</span><span class="op" id="3537884">)</span><span class="op" id="3537885">.</span><span class="ident" id="3537886">mulRange</span><span class="op" id="3537894">(</span><span class="ident" id="3537895">m</span><span class="op" id="3537896">+</span><span class="num" id="3537897">1</span><span class="op" id="3537898">,</span>&nbsp;<span class="ident" id="3537900">b</span><span class="op" id="3537901">)</span><span class="op" id="3537902">)</span><br>
<span class="lineno"></span><span class="op" id="3537904">}</span><br>
<span class="lineno">480</span><br>
<span class="lineno"></span><span class="comment" id="3537907">//&nbsp;q&nbsp;=&nbsp;(x-r)/y,&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;r&nbsp;&lt;&nbsp;y</span><br>
<span class="lineno"></span><span class="keyword" id="3537939">func</span>&nbsp;<span class="op" id="3537944">(</span><span class="ident" id="3537945">z</span>&nbsp;<span class="ident" id="3537947">nat</span><span class="op" id="3537950">)</span>&nbsp;<span class="ident" id="3537952">divW</span><span class="op" id="3537956">(</span><span class="ident" id="3537957">x</span>&nbsp;<span class="ident" id="3537959">nat</span><span class="op" id="3537962">,</span>&nbsp;<span class="ident" id="3537964">y</span>&nbsp;<span class="ident" id="3537966">Word</span><span class="op" id="3537970">)</span>&nbsp;<span class="op" id="3537972">(</span><span class="ident" id="3537973">q</span>&nbsp;<span class="ident" id="3537975">nat</span><span class="op" id="3537978">,</span>&nbsp;<span class="ident" id="3537980">r</span>&nbsp;<span class="ident" id="3537982">Word</span><span class="op" id="3537986">)</span>&nbsp;<span class="op" id="3537988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3537991">m</span>&nbsp;<span class="op" id="3537993">:=</span>&nbsp;<span class="builtinfunc" id="3537996">len</span><span class="op" id="3537999">(</span><span class="ident" id="3538000">x</span><span class="op" id="3538001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3538004">switch</span>&nbsp;<span class="op" id="3538011">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3538014">case</span>&nbsp;<span class="ident" id="3538019">y</span>&nbsp;<span class="op" id="3538021">==</span>&nbsp;<span class="num" id="3538024">0</span><span class="op" id="3538025">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3538029">panic</span><span class="op" id="3538034">(</span><span class="string" id="3538035">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3538053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3538056">case</span>&nbsp;<span class="ident" id="3538061">y</span>&nbsp;<span class="op" id="3538063">==</span>&nbsp;<span class="num" id="3538066">1</span><span class="op" id="3538067">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3538071">q</span>&nbsp;<span class="op" id="3538073">=</span>&nbsp;<span class="ident" id="3538075">z</span><span class="op" id="3538076">.</span><span class="ident" id="3538077">set</span><span class="op" id="3538080">(</span><span class="ident" id="3538081">x</span><span class="op" id="3538082">)</span>&nbsp;<span class="comment" id="3538084">//&nbsp;result&nbsp;is&nbsp;x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3538101">return</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3538109">case</span>&nbsp;<span class="ident" id="3538114">m</span>&nbsp;<span class="op" id="3538116">==</span>&nbsp;<span class="num" id="3538119">0</span><span class="op" id="3538120">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3538124">q</span>&nbsp;<span class="op" id="3538126">=</span>&nbsp;<span class="ident" id="3538128">z</span><span class="op" id="3538129">.</span><span class="builtinfunc" id="3538130">make</span><span class="op" id="3538134">(</span><span class="num" id="3538135">0</span><span class="op" id="3538136">)</span>&nbsp;<span class="comment" id="3538138">//&nbsp;result&nbsp;is&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3538155">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3538163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3538166">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3538176">z</span>&nbsp;<span class="op" id="3538178">=</span>&nbsp;<span class="ident" id="3538180">z</span><span class="op" id="3538181">.</span><span class="builtinfunc" id="3538182">make</span><span class="op" id="3538186">(</span><span class="ident" id="3538187">m</span><span class="op" id="3538188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3538191">r</span>&nbsp;<span class="op" id="3538193">=</span>&nbsp;<span class="ident" id="3538195">divWVW</span><span class="op" id="3538201">(</span><span class="ident" id="3538202">z</span><span class="op" id="3538203">,</span>&nbsp;<span class="num" id="3538205">0</span><span class="op" id="3538206">,</span>&nbsp;<span class="ident" id="3538208">x</span><span class="op" id="3538209">,</span>&nbsp;<span class="ident" id="3538211">y</span><span class="op" id="3538212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3538215">q</span>&nbsp;<span class="op" id="3538217">=</span>&nbsp;<span class="ident" id="3538219">z</span><span class="op" id="3538220">.</span><span class="ident" id="3538221">norm</span><span class="op" id="3538225">(</span><span class="op" id="3538226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3538229">return</span><br>
<span class="lineno"></span><span class="op" id="3538236">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="3538239">func</span>&nbsp;<span class="op" id="3538244">(</span><span class="ident" id="3538245">z</span>&nbsp;<span class="ident" id="3538247">nat</span><span class="op" id="3538250">)</span>&nbsp;<span class="ident" id="3538252">div</span><span class="op" id="3538255">(</span><span class="ident" id="3538256">z2</span><span class="op" id="3538258">,</span>&nbsp;<span class="ident" id="3538260">u</span><span class="op" id="3538261">,</span>&nbsp;<span class="ident" id="3538263">v</span>&nbsp;<span class="ident" id="3538265">nat</span><span class="op" id="3538268">)</span>&nbsp;<span class="op" id="3538270">(</span><span class="ident" id="3538271">q</span><span class="op" id="3538272">,</span>&nbsp;<span class="ident" id="3538274">r</span>&nbsp;<span class="ident" id="3538276">nat</span><span class="op" id="3538279">)</span>&nbsp;<span class="op" id="3538281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3538284">if</span>&nbsp;<span class="builtinfunc" id="3538287">len</span><span class="op" id="3538290">(</span><span class="ident" id="3538291">v</span><span class="op" id="3538292">)</span>&nbsp;<span class="op" id="3538294">==</span>&nbsp;<span class="num" id="3538297">0</span>&nbsp;<span class="op" id="3538299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3538303">panic</span><span class="op" id="3538308">(</span><span class="string" id="3538309">&#34;division&nbsp;by&nbsp;zero&#34;</span><span class="op" id="3538327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3538330">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3538334">if</span>&nbsp;<span class="ident" id="3538337">u</span><span class="op" id="3538338">.</span><span class="ident" id="3538339">cmp</span><span class="op" id="3538342">(</span><span class="ident" id="3538343">v</span><span class="op" id="3538344">)</span>&nbsp;<span class="op" id="3538346">&lt;</span>&nbsp;<span class="num" id="3538348">0</span>&nbsp;<span class="op" id="3538350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3538354">q</span>&nbsp;<span class="op" id="3538356">=</span>&nbsp;<span class="ident" id="3538358">z</span><span class="op" id="3538359">.</span><span class="builtinfunc" id="3538360">make</span><span class="op" id="3538364">(</span><span class="num" id="3538365">0</span><span class="op" id="3538366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3538370">r</span>&nbsp;<span class="op" id="3538372">=</span>&nbsp;<span class="ident" id="3538374">z2</span><span class="op" id="3538376">.</span><span class="ident" id="3538377">set</span><span class="op" id="3538380">(</span><span class="ident" id="3538381">u</span><span class="op" id="3538382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3538386">return</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3538394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3538398">if</span>&nbsp;<span class="builtinfunc" id="3538401">len</span><span class="op" id="3538404">(</span><span class="ident" id="3538405">v</span><span class="op" id="3538406">)</span>&nbsp;<span class="op" id="3538408">==</span>&nbsp;<span class="num" id="3538411">1</span>&nbsp;<span class="op" id="3538413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3538417">var</span>&nbsp;<span class="ident" id="3538421">r2</span>&nbsp;<span class="ident" id="3538424">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3538431">q</span><span class="op" id="3538432">,</span>&nbsp;<span class="ident" id="3538434">r2</span>&nbsp;<span class="op" id="3538437">=</span>&nbsp;<span class="ident" id="3538439">z</span><span class="op" id="3538440">.</span><span class="ident" id="3538441">divW</span><span class="op" id="3538445">(</span><span class="ident" id="3538446">u</span><span class="op" id="3538447">,</span>&nbsp;<span class="ident" id="3538449">v</span><span class="op" id="3538450">[</span><span class="num" id="3538451">0</span><span class="op" id="3538452">]</span><span class="op" id="3538453">)</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3538457">r</span>&nbsp;<span class="op" id="3538459">=</span>&nbsp;<span class="ident" id="3538461">z2</span><span class="op" id="3538463">.</span><span class="ident" id="3538464">setWord</span><span class="op" id="3538471">(</span><span class="ident" id="3538472">r2</span><span class="op" id="3538474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3538478">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3538486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3538490">q</span><span class="op" id="3538491">,</span>&nbsp;<span class="ident" id="3538493">r</span>&nbsp;<span class="op" id="3538495">=</span>&nbsp;<span class="ident" id="3538497">z</span><span class="op" id="3538498">.</span><span class="ident" id="3538499">divLarge</span><span class="op" id="3538507">(</span><span class="ident" id="3538508">z2</span><span class="op" id="3538510">,</span>&nbsp;<span class="ident" id="3538512">u</span><span class="op" id="3538513">,</span>&nbsp;<span class="ident" id="3538515">v</span><span class="op" id="3538516">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3538519">return</span><br>
<span class="lineno"></span><span class="op" id="3538526">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3538529">//&nbsp;q&nbsp;=&nbsp;(uIn-r)/v,&nbsp;with&nbsp;0&nbsp;&lt;=&nbsp;r&nbsp;&lt;&nbsp;y</span><br>
<span class="lineno"></span><span class="comment" id="3538563">//&nbsp;Uses&nbsp;z&nbsp;as&nbsp;storage&nbsp;for&nbsp;q,&nbsp;and&nbsp;u&nbsp;as&nbsp;storage&nbsp;for&nbsp;r&nbsp;if&nbsp;possible.</span><br>
<span class="lineno">525</span><span class="comment" id="3538627">//&nbsp;See&nbsp;Knuth,&nbsp;Volume&nbsp;2,&nbsp;section&nbsp;4.3.1,&nbsp;Algorithm&nbsp;D.</span><br>
<span class="lineno"></span><span class="comment" id="3538679">//&nbsp;Preconditions:</span><br>
<span class="lineno"></span><span class="comment" id="3538697">//&nbsp;&nbsp;&nbsp;&nbsp;len(v)&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span><span class="comment" id="3538715">//&nbsp;&nbsp;&nbsp;&nbsp;len(uIn)&nbsp;&gt;=&nbsp;len(v)</span><br>
<span class="lineno"></span><span class="keyword" id="3538740">func</span>&nbsp;<span class="op" id="3538745">(</span><span class="ident" id="3538746">z</span>&nbsp;<span class="ident" id="3538748">nat</span><span class="op" id="3538751">)</span>&nbsp;<span class="ident" id="3538753">divLarge</span><span class="op" id="3538761">(</span><span class="ident" id="3538762">u</span><span class="op" id="3538763">,</span>&nbsp;<span class="ident" id="3538765">uIn</span><span class="op" id="3538768">,</span>&nbsp;<span class="ident" id="3538770">v</span>&nbsp;<span class="ident" id="3538772">nat</span><span class="op" id="3538775">)</span>&nbsp;<span class="op" id="3538777">(</span><span class="ident" id="3538778">q</span><span class="op" id="3538779">,</span>&nbsp;<span class="ident" id="3538781">r</span>&nbsp;<span class="ident" id="3538783">nat</span><span class="op" id="3538786">)</span>&nbsp;<span class="op" id="3538788">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3538791">n</span>&nbsp;<span class="op" id="3538793">:=</span>&nbsp;<span class="builtinfunc" id="3538796">len</span><span class="op" id="3538799">(</span><span class="ident" id="3538800">v</span><span class="op" id="3538801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3538804">m</span>&nbsp;<span class="op" id="3538806">:=</span>&nbsp;<span class="builtinfunc" id="3538809">len</span><span class="op" id="3538812">(</span><span class="ident" id="3538813">uIn</span><span class="op" id="3538816">)</span>&nbsp;<span class="op" id="3538818">-</span>&nbsp;<span class="ident" id="3538820">n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3538824">//&nbsp;determine&nbsp;if&nbsp;z&nbsp;can&nbsp;be&nbsp;reused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3538857">//&nbsp;TODO(gri)&nbsp;should&nbsp;find&nbsp;a&nbsp;better&nbsp;solution&nbsp;-&nbsp;this&nbsp;if&nbsp;statement</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3538921">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;is&nbsp;very&nbsp;costly&nbsp;(see&nbsp;e.g.&nbsp;time&nbsp;pidigits&nbsp;-s&nbsp;-n&nbsp;10000)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3538987">if</span>&nbsp;<span class="ident" id="3538990">alias</span><span class="op" id="3538995">(</span><span class="ident" id="3538996">z</span><span class="op" id="3538997">,</span>&nbsp;<span class="ident" id="3538999">uIn</span><span class="op" id="3539002">)</span>&nbsp;<span class="op" id="3539004">||</span>&nbsp;<span class="ident" id="3539007">alias</span><span class="op" id="3539012">(</span><span class="ident" id="3539013">z</span><span class="op" id="3539014">,</span>&nbsp;<span class="ident" id="3539016">v</span><span class="op" id="3539017">)</span>&nbsp;<span class="op" id="3539019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539023">z</span>&nbsp;<span class="op" id="3539025">=</span>&nbsp;<span class="ident" id="3539027">nil</span>&nbsp;<span class="comment" id="3539031">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;uIn&nbsp;or&nbsp;v&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3539077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539080">q</span>&nbsp;<span class="op" id="3539082">=</span>&nbsp;<span class="ident" id="3539084">z</span><span class="op" id="3539085">.</span><span class="builtinfunc" id="3539086">make</span><span class="op" id="3539090">(</span><span class="ident" id="3539091">m</span>&nbsp;<span class="op" id="3539093">+</span>&nbsp;<span class="num" id="3539095">1</span><span class="op" id="3539096">)</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539100">qhatv</span>&nbsp;<span class="op" id="3539106">:=</span>&nbsp;<span class="builtinfunc" id="3539109">make</span><span class="op" id="3539113">(</span><span class="ident" id="3539114">nat</span><span class="op" id="3539117">,</span>&nbsp;<span class="ident" id="3539119">n</span><span class="op" id="3539120">+</span><span class="num" id="3539121">1</span><span class="op" id="3539122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3539125">if</span>&nbsp;<span class="ident" id="3539128">alias</span><span class="op" id="3539133">(</span><span class="ident" id="3539134">u</span><span class="op" id="3539135">,</span>&nbsp;<span class="ident" id="3539137">uIn</span><span class="op" id="3539140">)</span>&nbsp;<span class="op" id="3539142">||</span>&nbsp;<span class="ident" id="3539145">alias</span><span class="op" id="3539150">(</span><span class="ident" id="3539151">u</span><span class="op" id="3539152">,</span>&nbsp;<span class="ident" id="3539154">v</span><span class="op" id="3539155">)</span>&nbsp;<span class="op" id="3539157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539161">u</span>&nbsp;<span class="op" id="3539163">=</span>&nbsp;<span class="ident" id="3539165">nil</span>&nbsp;<span class="comment" id="3539169">//&nbsp;u&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;uIn&nbsp;or&nbsp;v&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3539215">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539218">u</span>&nbsp;<span class="op" id="3539220">=</span>&nbsp;<span class="ident" id="3539222">u</span><span class="op" id="3539223">.</span><span class="builtinfunc" id="3539224">make</span><span class="op" id="3539228">(</span><span class="builtinfunc" id="3539229">len</span><span class="op" id="3539232">(</span><span class="ident" id="3539233">uIn</span><span class="op" id="3539236">)</span>&nbsp;<span class="op" id="3539238">+</span>&nbsp;<span class="num" id="3539240">1</span><span class="op" id="3539241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539244">u</span><span class="op" id="3539245">.</span><span class="ident" id="3539246">clear</span><span class="op" id="3539251">(</span><span class="op" id="3539252">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539256">//&nbsp;D1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539264">shift</span>&nbsp;<span class="op" id="3539270">:=</span>&nbsp;<span class="ident" id="3539273">leadingZeros</span><span class="op" id="3539285">(</span><span class="ident" id="3539286">v</span><span class="op" id="3539287">[</span><span class="ident" id="3539288">n</span><span class="op" id="3539289">-</span><span class="num" id="3539290">1</span><span class="op" id="3539291">]</span><span class="op" id="3539292">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3539295">if</span>&nbsp;<span class="ident" id="3539298">shift</span>&nbsp;<span class="op" id="3539304">&gt;</span>&nbsp;<span class="num" id="3539306">0</span>&nbsp;<span class="op" id="3539308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539312">//&nbsp;do&nbsp;not&nbsp;modify&nbsp;v,&nbsp;it&nbsp;may&nbsp;be&nbsp;used&nbsp;by&nbsp;another&nbsp;goroutine&nbsp;simultaneously</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539385">v1</span>&nbsp;<span class="op" id="3539388">:=</span>&nbsp;<span class="builtinfunc" id="3539391">make</span><span class="op" id="3539395">(</span><span class="ident" id="3539396">nat</span><span class="op" id="3539399">,</span>&nbsp;<span class="ident" id="3539401">n</span><span class="op" id="3539402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539406">shlVU</span><span class="op" id="3539411">(</span><span class="ident" id="3539412">v1</span><span class="op" id="3539414">,</span>&nbsp;<span class="ident" id="3539416">v</span><span class="op" id="3539417">,</span>&nbsp;<span class="ident" id="3539419">shift</span><span class="op" id="3539424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539428">v</span>&nbsp;<span class="op" id="3539430">=</span>&nbsp;<span class="ident" id="3539432">v1</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3539436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539439">u</span><span class="op" id="3539440">[</span><span class="builtinfunc" id="3539441">len</span><span class="op" id="3539444">(</span><span class="ident" id="3539445">uIn</span><span class="op" id="3539448">)</span><span class="op" id="3539449">]</span>&nbsp;<span class="op" id="3539451">=</span>&nbsp;<span class="ident" id="3539453">shlVU</span><span class="op" id="3539458">(</span><span class="ident" id="3539459">u</span><span class="op" id="3539460">[</span><span class="num" id="3539461">0</span><span class="op" id="3539462">:</span><span class="builtinfunc" id="3539463">len</span><span class="op" id="3539466">(</span><span class="ident" id="3539467">uIn</span><span class="op" id="3539470">)</span><span class="op" id="3539471">]</span><span class="op" id="3539472">,</span>&nbsp;<span class="ident" id="3539474">uIn</span><span class="op" id="3539477">,</span>&nbsp;<span class="ident" id="3539479">shift</span><span class="op" id="3539484">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539488">//&nbsp;D2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3539496">for</span>&nbsp;<span class="ident" id="3539500">j</span>&nbsp;<span class="op" id="3539502">:=</span>&nbsp;<span class="ident" id="3539505">m</span><span class="op" id="3539506">;</span>&nbsp;<span class="ident" id="3539508">j</span>&nbsp;<span class="op" id="3539510">&gt;=</span>&nbsp;<span class="num" id="3539513">0</span><span class="op" id="3539514">;</span>&nbsp;<span class="ident" id="3539516">j</span><span class="op" id="3539517">--</span>&nbsp;<span class="op" id="3539520">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539524">//&nbsp;D3.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539533">qhat</span>&nbsp;<span class="op" id="3539538">:=</span>&nbsp;<span class="ident" id="3539541">Word</span><span class="op" id="3539545">(</span><span class="ident" id="3539546">_M</span><span class="op" id="3539548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3539552">if</span>&nbsp;<span class="ident" id="3539555">u</span><span class="op" id="3539556">[</span><span class="ident" id="3539557">j</span><span class="op" id="3539558">+</span><span class="ident" id="3539559">n</span><span class="op" id="3539560">]</span>&nbsp;<span class="op" id="3539562">!=</span>&nbsp;<span class="ident" id="3539565">v</span><span class="op" id="3539566">[</span><span class="ident" id="3539567">n</span><span class="op" id="3539568">-</span><span class="num" id="3539569">1</span><span class="op" id="3539570">]</span>&nbsp;<span class="op" id="3539572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3539577">var</span>&nbsp;<span class="ident" id="3539581">rhat</span>&nbsp;<span class="ident" id="3539586">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539594">qhat</span><span class="op" id="3539598">,</span>&nbsp;<span class="ident" id="3539600">rhat</span>&nbsp;<span class="op" id="3539605">=</span>&nbsp;<span class="ident" id="3539607">divWW</span><span class="op" id="3539612">(</span><span class="ident" id="3539613">u</span><span class="op" id="3539614">[</span><span class="ident" id="3539615">j</span><span class="op" id="3539616">+</span><span class="ident" id="3539617">n</span><span class="op" id="3539618">]</span><span class="op" id="3539619">,</span>&nbsp;<span class="ident" id="3539621">u</span><span class="op" id="3539622">[</span><span class="ident" id="3539623">j</span><span class="op" id="3539624">+</span><span class="ident" id="3539625">n</span><span class="op" id="3539626">-</span><span class="num" id="3539627">1</span><span class="op" id="3539628">]</span><span class="op" id="3539629">,</span>&nbsp;<span class="ident" id="3539631">v</span><span class="op" id="3539632">[</span><span class="ident" id="3539633">n</span><span class="op" id="3539634">-</span><span class="num" id="3539635">1</span><span class="op" id="3539636">]</span><span class="op" id="3539637">)</span><br>
<span class="lineno">565</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539643">//&nbsp;x1&nbsp;|&nbsp;x2&nbsp;=&nbsp;qv_{n-2}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539670">x1</span><span class="op" id="3539672">,</span>&nbsp;<span class="ident" id="3539674">x2</span>&nbsp;<span class="op" id="3539677">:=</span>&nbsp;<span class="ident" id="3539680">mulWW</span><span class="op" id="3539685">(</span><span class="ident" id="3539686">qhat</span><span class="op" id="3539690">,</span>&nbsp;<span class="ident" id="3539692">v</span><span class="op" id="3539693">[</span><span class="ident" id="3539694">n</span><span class="op" id="3539695">-</span><span class="num" id="3539696">2</span><span class="op" id="3539697">]</span><span class="op" id="3539698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539703">//&nbsp;test&nbsp;if&nbsp;qv_{n-2}&nbsp;&gt;&nbsp;br&nbsp;+&nbsp;u_{j+n-2}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3539747">for</span>&nbsp;<span class="ident" id="3539751">greaterThan</span><span class="op" id="3539762">(</span><span class="ident" id="3539763">x1</span><span class="op" id="3539765">,</span>&nbsp;<span class="ident" id="3539767">x2</span><span class="op" id="3539769">,</span>&nbsp;<span class="ident" id="3539771">rhat</span><span class="op" id="3539775">,</span>&nbsp;<span class="ident" id="3539777">u</span><span class="op" id="3539778">[</span><span class="ident" id="3539779">j</span><span class="op" id="3539780">+</span><span class="ident" id="3539781">n</span><span class="op" id="3539782">-</span><span class="num" id="3539783">2</span><span class="op" id="3539784">]</span><span class="op" id="3539785">)</span>&nbsp;<span class="op" id="3539787">{</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539793">qhat</span><span class="op" id="3539797">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539804">prevRhat</span>&nbsp;<span class="op" id="3539813">:=</span>&nbsp;<span class="ident" id="3539816">rhat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539825">rhat</span>&nbsp;<span class="op" id="3539830">+=</span>&nbsp;<span class="ident" id="3539833">v</span><span class="op" id="3539834">[</span><span class="ident" id="3539835">n</span><span class="op" id="3539836">-</span><span class="num" id="3539837">1</span><span class="op" id="3539838">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539844">//&nbsp;v[n-1]&nbsp;&gt;=&nbsp;0,&nbsp;so&nbsp;this&nbsp;tests&nbsp;for&nbsp;overflow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3539892">if</span>&nbsp;<span class="ident" id="3539895">rhat</span>&nbsp;<span class="op" id="3539900">&lt;</span>&nbsp;<span class="ident" id="3539902">prevRhat</span>&nbsp;<span class="op" id="3539911">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3539918">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3539928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539934">x1</span><span class="op" id="3539936">,</span>&nbsp;<span class="ident" id="3539938">x2</span>&nbsp;<span class="op" id="3539941">=</span>&nbsp;<span class="ident" id="3539943">mulWW</span><span class="op" id="3539948">(</span><span class="ident" id="3539949">qhat</span><span class="op" id="3539953">,</span>&nbsp;<span class="ident" id="3539955">v</span><span class="op" id="3539956">[</span><span class="ident" id="3539957">n</span><span class="op" id="3539958">-</span><span class="num" id="3539959">2</span><span class="op" id="3539960">]</span><span class="op" id="3539961">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3539966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3539970">}</span><br>
<span class="lineno">580</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3539975">//&nbsp;D4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3539984">qhatv</span><span class="op" id="3539989">[</span><span class="ident" id="3539990">n</span><span class="op" id="3539991">]</span>&nbsp;<span class="op" id="3539993">=</span>&nbsp;<span class="ident" id="3539995">mulAddVWW</span><span class="op" id="3540004">(</span><span class="ident" id="3540005">qhatv</span><span class="op" id="3540010">[</span><span class="num" id="3540011">0</span><span class="op" id="3540012">:</span><span class="ident" id="3540013">n</span><span class="op" id="3540014">]</span><span class="op" id="3540015">,</span>&nbsp;<span class="ident" id="3540017">v</span><span class="op" id="3540018">,</span>&nbsp;<span class="ident" id="3540020">qhat</span><span class="op" id="3540024">,</span>&nbsp;<span class="num" id="3540026">0</span><span class="op" id="3540027">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3540032">c</span>&nbsp;<span class="op" id="3540034">:=</span>&nbsp;<span class="ident" id="3540037">subVV</span><span class="op" id="3540042">(</span><span class="ident" id="3540043">u</span><span class="op" id="3540044">[</span><span class="ident" id="3540045">j</span><span class="op" id="3540046">:</span><span class="ident" id="3540047">j</span><span class="op" id="3540048">+</span><span class="builtinfunc" id="3540049">len</span><span class="op" id="3540052">(</span><span class="ident" id="3540053">qhatv</span><span class="op" id="3540058">)</span><span class="op" id="3540059">]</span><span class="op" id="3540060">,</span>&nbsp;<span class="ident" id="3540062">u</span><span class="op" id="3540063">[</span><span class="ident" id="3540064">j</span><span class="op" id="3540065">:</span><span class="op" id="3540066">]</span><span class="op" id="3540067">,</span>&nbsp;<span class="ident" id="3540069">qhatv</span><span class="op" id="3540074">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3540078">if</span>&nbsp;<span class="ident" id="3540081">c</span>&nbsp;<span class="op" id="3540083">!=</span>&nbsp;<span class="num" id="3540086">0</span>&nbsp;<span class="op" id="3540088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3540093">c</span>&nbsp;<span class="op" id="3540095">:=</span>&nbsp;<span class="ident" id="3540098">addVV</span><span class="op" id="3540103">(</span><span class="ident" id="3540104">u</span><span class="op" id="3540105">[</span><span class="ident" id="3540106">j</span><span class="op" id="3540107">:</span><span class="ident" id="3540108">j</span><span class="op" id="3540109">+</span><span class="ident" id="3540110">n</span><span class="op" id="3540111">]</span><span class="op" id="3540112">,</span>&nbsp;<span class="ident" id="3540114">u</span><span class="op" id="3540115">[</span><span class="ident" id="3540116">j</span><span class="op" id="3540117">:</span><span class="op" id="3540118">]</span><span class="op" id="3540119">,</span>&nbsp;<span class="ident" id="3540121">v</span><span class="op" id="3540122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3540127">u</span><span class="op" id="3540128">[</span><span class="ident" id="3540129">j</span><span class="op" id="3540130">+</span><span class="ident" id="3540131">n</span><span class="op" id="3540132">]</span>&nbsp;<span class="op" id="3540134">+=</span>&nbsp;<span class="ident" id="3540137">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3540142">qhat</span><span class="op" id="3540146">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3540151">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3540156">q</span><span class="op" id="3540157">[</span><span class="ident" id="3540158">j</span><span class="op" id="3540159">]</span>&nbsp;<span class="op" id="3540161">=</span>&nbsp;<span class="ident" id="3540163">qhat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3540169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3540173">q</span>&nbsp;<span class="op" id="3540175">=</span>&nbsp;<span class="ident" id="3540177">q</span><span class="op" id="3540178">.</span><span class="ident" id="3540179">norm</span><span class="op" id="3540183">(</span><span class="op" id="3540184">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3540187">shrVU</span><span class="op" id="3540192">(</span><span class="ident" id="3540193">u</span><span class="op" id="3540194">,</span>&nbsp;<span class="ident" id="3540196">u</span><span class="op" id="3540197">,</span>&nbsp;<span class="ident" id="3540199">shift</span><span class="op" id="3540204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3540207">r</span>&nbsp;<span class="op" id="3540209">=</span>&nbsp;<span class="ident" id="3540211">u</span><span class="op" id="3540212">.</span><span class="ident" id="3540213">norm</span><span class="op" id="3540217">(</span><span class="op" id="3540218">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3540222">return</span>&nbsp;<span class="ident" id="3540229">q</span><span class="op" id="3540230">,</span>&nbsp;<span class="ident" id="3540232">r</span><br>
<span class="lineno"></span><span class="op" id="3540234">}</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="comment" id="3540237">//&nbsp;Length&nbsp;of&nbsp;x&nbsp;in&nbsp;bits.&nbsp;x&nbsp;must&nbsp;be&nbsp;normalized.</span><br>
<span class="lineno"></span><span class="keyword" id="3540283">func</span>&nbsp;<span class="op" id="3540288">(</span><span class="ident" id="3540289">x</span>&nbsp;<span class="ident" id="3540291">nat</span><span class="op" id="3540294">)</span>&nbsp;<span class="ident" id="3540296">bitLen</span><span class="op" id="3540302">(</span><span class="op" id="3540303">)</span>&nbsp;<span class="builtintype" id="3540305">int</span>&nbsp;<span class="op" id="3540309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3540312">if</span>&nbsp;<span class="ident" id="3540315">i</span>&nbsp;<span class="op" id="3540317">:=</span>&nbsp;<span class="builtinfunc" id="3540320">len</span><span class="op" id="3540323">(</span><span class="ident" id="3540324">x</span><span class="op" id="3540325">)</span>&nbsp;<span class="op" id="3540327">-</span>&nbsp;<span class="num" id="3540329">1</span><span class="op" id="3540330">;</span>&nbsp;<span class="ident" id="3540332">i</span>&nbsp;<span class="op" id="3540334">&gt;=</span>&nbsp;<span class="num" id="3540337">0</span>&nbsp;<span class="op" id="3540339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3540343">return</span>&nbsp;<span class="ident" id="3540350">i</span><span class="op" id="3540351">*</span><span class="ident" id="3540352">_W</span>&nbsp;<span class="op" id="3540355">+</span>&nbsp;<span class="ident" id="3540357">bitLen</span><span class="op" id="3540363">(</span><span class="ident" id="3540364">x</span><span class="op" id="3540365">[</span><span class="ident" id="3540366">i</span><span class="op" id="3540367">]</span><span class="op" id="3540368">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3540371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3540374">return</span>&nbsp;<span class="num" id="3540381">0</span><br>
<span class="lineno"></span><span class="op" id="3540383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3540386">//&nbsp;MaxBase&nbsp;is&nbsp;the&nbsp;largest&nbsp;number&nbsp;base&nbsp;accepted&nbsp;for&nbsp;string&nbsp;conversions.</span><br>
<span class="lineno">610</span><span class="keyword" id="3540457">const</span>&nbsp;<span class="ident" id="3540463">MaxBase</span>&nbsp;<span class="op" id="3540471">=</span>&nbsp;<span class="string" id="3540473">&#39;z&#39;</span>&nbsp;<span class="op" id="3540477">-</span>&nbsp;<span class="string" id="3540479">&#39;a&#39;</span>&nbsp;<span class="op" id="3540483">+</span>&nbsp;<span class="num" id="3540485">10</span>&nbsp;<span class="op" id="3540488">+</span>&nbsp;<span class="num" id="3540490">1</span>&nbsp;<span class="comment" id="3540492">//&nbsp;=&nbsp;hexValue(&#39;z&#39;)&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3540516">func</span>&nbsp;<span class="ident" id="3540521">hexValue</span><span class="op" id="3540529">(</span><span class="ident" id="3540530">ch</span>&nbsp;<span class="builtintype" id="3540533">rune</span><span class="op" id="3540537">)</span>&nbsp;<span class="ident" id="3540539">Word</span>&nbsp;<span class="op" id="3540544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3540547">d</span>&nbsp;<span class="op" id="3540549">:=</span>&nbsp;<span class="builtintype" id="3540552">int</span><span class="op" id="3540555">(</span><span class="ident" id="3540556">MaxBase</span>&nbsp;<span class="op" id="3540564">+</span>&nbsp;<span class="num" id="3540566">1</span><span class="op" id="3540567">)</span>&nbsp;<span class="comment" id="3540569">//&nbsp;illegal&nbsp;base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3540586">switch</span>&nbsp;<span class="op" id="3540593">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3540596">case</span>&nbsp;<span class="string" id="3540601">&#39;0&#39;</span>&nbsp;<span class="op" id="3540605">&lt;=</span>&nbsp;<span class="ident" id="3540608">ch</span>&nbsp;<span class="op" id="3540611">&amp;&amp;</span>&nbsp;<span class="ident" id="3540614">ch</span>&nbsp;<span class="op" id="3540617">&lt;=</span>&nbsp;<span class="string" id="3540620">&#39;9&#39;</span><span class="op" id="3540623">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3540627">d</span>&nbsp;<span class="op" id="3540629">=</span>&nbsp;<span class="builtintype" id="3540631">int</span><span class="op" id="3540634">(</span><span class="ident" id="3540635">ch</span>&nbsp;<span class="op" id="3540638">-</span>&nbsp;<span class="string" id="3540640">&#39;0&#39;</span><span class="op" id="3540643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3540646">case</span>&nbsp;<span class="string" id="3540651">&#39;a&#39;</span>&nbsp;<span class="op" id="3540655">&lt;=</span>&nbsp;<span class="ident" id="3540658">ch</span>&nbsp;<span class="op" id="3540661">&amp;&amp;</span>&nbsp;<span class="ident" id="3540664">ch</span>&nbsp;<span class="op" id="3540667">&lt;=</span>&nbsp;<span class="string" id="3540670">&#39;z&#39;</span><span class="op" id="3540673">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3540677">d</span>&nbsp;<span class="op" id="3540679">=</span>&nbsp;<span class="builtintype" id="3540681">int</span><span class="op" id="3540684">(</span><span class="ident" id="3540685">ch</span>&nbsp;<span class="op" id="3540688">-</span>&nbsp;<span class="string" id="3540690">&#39;a&#39;</span>&nbsp;<span class="op" id="3540694">+</span>&nbsp;<span class="num" id="3540696">10</span><span class="op" id="3540698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3540701">case</span>&nbsp;<span class="string" id="3540706">&#39;A&#39;</span>&nbsp;<span class="op" id="3540710">&lt;=</span>&nbsp;<span class="ident" id="3540713">ch</span>&nbsp;<span class="op" id="3540716">&amp;&amp;</span>&nbsp;<span class="ident" id="3540719">ch</span>&nbsp;<span class="op" id="3540722">&lt;=</span>&nbsp;<span class="string" id="3540725">&#39;Z&#39;</span><span class="op" id="3540728">:</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3540732">d</span>&nbsp;<span class="op" id="3540734">=</span>&nbsp;<span class="builtintype" id="3540736">int</span><span class="op" id="3540739">(</span><span class="ident" id="3540740">ch</span>&nbsp;<span class="op" id="3540743">-</span>&nbsp;<span class="string" id="3540745">&#39;A&#39;</span>&nbsp;<span class="op" id="3540749">+</span>&nbsp;<span class="num" id="3540751">10</span><span class="op" id="3540753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3540756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3540759">return</span>&nbsp;<span class="ident" id="3540766">Word</span><span class="op" id="3540770">(</span><span class="ident" id="3540771">d</span><span class="op" id="3540772">)</span><br>
<span class="lineno"></span><span class="op" id="3540774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">625</span><span class="comment" id="3540777">//&nbsp;scan&nbsp;sets&nbsp;z&nbsp;to&nbsp;the&nbsp;natural&nbsp;number&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;longest&nbsp;possible&nbsp;prefix</span><br>
<span class="lineno"></span><span class="comment" id="3540859">//&nbsp;read&nbsp;from&nbsp;r&nbsp;representing&nbsp;an&nbsp;unsigned&nbsp;integer&nbsp;in&nbsp;a&nbsp;given&nbsp;conversion&nbsp;base.</span><br>
<span class="lineno"></span><span class="comment" id="3540935">//&nbsp;It&nbsp;returns&nbsp;z,&nbsp;the&nbsp;actual&nbsp;conversion&nbsp;base&nbsp;used,&nbsp;and&nbsp;an&nbsp;error,&nbsp;if&nbsp;any.&nbsp;In&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3541014">//&nbsp;error&nbsp;case,&nbsp;the&nbsp;value&nbsp;of&nbsp;z&nbsp;is&nbsp;undefined.&nbsp;The&nbsp;syntax&nbsp;follows&nbsp;the&nbsp;syntax&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3541091">//&nbsp;unsigned&nbsp;integer&nbsp;literals&nbsp;in&nbsp;Go.</span><br>
<span class="lineno">630</span><span class="comment" id="3541127">//</span><br>
<span class="lineno"></span><span class="comment" id="3541130">//&nbsp;The&nbsp;base&nbsp;argument&nbsp;must&nbsp;be&nbsp;0&nbsp;or&nbsp;a&nbsp;value&nbsp;from&nbsp;2&nbsp;through&nbsp;MaxBase.&nbsp;If&nbsp;the&nbsp;base</span><br>
<span class="lineno"></span><span class="comment" id="3541208">//&nbsp;is&nbsp;0,&nbsp;the&nbsp;string&nbsp;prefix&nbsp;determines&nbsp;the&nbsp;actual&nbsp;conversion&nbsp;base.&nbsp;A&nbsp;prefix&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3541286">//&nbsp;``0x&#39;&#39;&nbsp;or&nbsp;``0X&#39;&#39;&nbsp;selects&nbsp;base&nbsp;16;&nbsp;the&nbsp;``0&#39;&#39;&nbsp;prefix&nbsp;selects&nbsp;base&nbsp;8,&nbsp;and&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3541362">//&nbsp;``0b&#39;&#39;&nbsp;or&nbsp;``0B&#39;&#39;&nbsp;prefix&nbsp;selects&nbsp;base&nbsp;2.&nbsp;Otherwise&nbsp;the&nbsp;selected&nbsp;base&nbsp;is&nbsp;10.</span><br>
<span class="lineno">635</span><span class="comment" id="3541440">//</span><br>
<span class="lineno"></span><span class="keyword" id="3541443">func</span>&nbsp;<span class="op" id="3541448">(</span><span class="ident" id="3541449">z</span>&nbsp;<span class="ident" id="3541451">nat</span><span class="op" id="3541454">)</span>&nbsp;<span class="ident" id="3541456">scan</span><span class="op" id="3541460">(</span><span class="ident" id="3541461">r</span>&nbsp;<span class="ident" id="3541463">io</span><span class="op" id="3541465">.</span><span class="ident" id="3541466">RuneScanner</span><span class="op" id="3541477">,</span>&nbsp;<span class="ident" id="3541479">base</span>&nbsp;<span class="builtintype" id="3541484">int</span><span class="op" id="3541487">)</span>&nbsp;<span class="op" id="3541489">(</span><span class="ident" id="3541490">nat</span><span class="op" id="3541493">,</span>&nbsp;<span class="builtintype" id="3541495">int</span><span class="op" id="3541498">,</span>&nbsp;<span class="builtintype" id="3541500">error</span><span class="op" id="3541505">)</span>&nbsp;<span class="op" id="3541507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541510">//&nbsp;reject&nbsp;illegal&nbsp;bases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541535">if</span>&nbsp;<span class="ident" id="3541538">base</span>&nbsp;<span class="op" id="3541543">&lt;</span>&nbsp;<span class="num" id="3541545">0</span>&nbsp;<span class="op" id="3541547">||</span>&nbsp;<span class="ident" id="3541550">base</span>&nbsp;<span class="op" id="3541555">==</span>&nbsp;<span class="num" id="3541558">1</span>&nbsp;<span class="op" id="3541560">||</span>&nbsp;<span class="ident" id="3541563">MaxBase</span>&nbsp;<span class="op" id="3541571">&lt;</span>&nbsp;<span class="ident" id="3541573">base</span>&nbsp;<span class="op" id="3541578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541582">return</span>&nbsp;<span class="ident" id="3541589">z</span><span class="op" id="3541590">,</span>&nbsp;<span class="num" id="3541592">0</span><span class="op" id="3541593">,</span>&nbsp;<span class="ident" id="3541595">errors</span><span class="op" id="3541601">.</span><span class="ident" id="3541602">New</span><span class="op" id="3541605">(</span><span class="string" id="3541606">&#34;illegal&nbsp;number&nbsp;base&#34;</span><span class="op" id="3541627">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3541630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541634">//&nbsp;one&nbsp;char&nbsp;look-ahead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3541658">ch</span><span class="op" id="3541660">,</span>&nbsp;<span class="ident" id="3541662">_</span><span class="op" id="3541663">,</span>&nbsp;<span class="ident" id="3541665">err</span>&nbsp;<span class="op" id="3541669">:=</span>&nbsp;<span class="ident" id="3541672">r</span><span class="op" id="3541673">.</span><span class="ident" id="3541674">ReadRune</span><span class="op" id="3541682">(</span><span class="op" id="3541683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541686">if</span>&nbsp;<span class="ident" id="3541689">err</span>&nbsp;<span class="op" id="3541693">!=</span>&nbsp;<span class="ident" id="3541696">nil</span>&nbsp;<span class="op" id="3541700">{</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541704">return</span>&nbsp;<span class="ident" id="3541711">z</span><span class="op" id="3541712">,</span>&nbsp;<span class="num" id="3541714">0</span><span class="op" id="3541715">,</span>&nbsp;<span class="ident" id="3541717">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3541722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3541726">//&nbsp;determine&nbsp;base&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3541758">b</span>&nbsp;<span class="op" id="3541760">:=</span>&nbsp;<span class="ident" id="3541763">Word</span><span class="op" id="3541767">(</span><span class="ident" id="3541768">base</span><span class="op" id="3541772">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541775">if</span>&nbsp;<span class="ident" id="3541778">base</span>&nbsp;<span class="op" id="3541783">==</span>&nbsp;<span class="num" id="3541786">0</span>&nbsp;<span class="op" id="3541788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3541792">b</span>&nbsp;<span class="op" id="3541794">=</span>&nbsp;<span class="num" id="3541796">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541801">if</span>&nbsp;<span class="ident" id="3541804">ch</span>&nbsp;<span class="op" id="3541807">==</span>&nbsp;<span class="string" id="3541810">&#39;0&#39;</span>&nbsp;<span class="op" id="3541814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541819">switch</span>&nbsp;<span class="ident" id="3541826">ch</span><span class="op" id="3541828">,</span>&nbsp;<span class="ident" id="3541830">_</span><span class="op" id="3541831">,</span>&nbsp;<span class="ident" id="3541833">err</span>&nbsp;<span class="op" id="3541837">=</span>&nbsp;<span class="ident" id="3541839">r</span><span class="op" id="3541840">.</span><span class="ident" id="3541841">ReadRune</span><span class="op" id="3541849">(</span><span class="op" id="3541850">)</span><span class="op" id="3541851">;</span>&nbsp;<span class="ident" id="3541853">err</span>&nbsp;<span class="op" id="3541857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541862">case</span>&nbsp;<span class="ident" id="3541867">nil</span><span class="op" id="3541870">:</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3541876">b</span>&nbsp;<span class="op" id="3541878">=</span>&nbsp;<span class="num" id="3541880">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541886">switch</span>&nbsp;<span class="ident" id="3541893">ch</span>&nbsp;<span class="op" id="3541896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541902">case</span>&nbsp;<span class="string" id="3541907">&#39;x&#39;</span><span class="op" id="3541910">,</span>&nbsp;<span class="string" id="3541912">&#39;X&#39;</span><span class="op" id="3541915">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3541922">b</span>&nbsp;<span class="op" id="3541924">=</span>&nbsp;<span class="num" id="3541926">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541933">case</span>&nbsp;<span class="string" id="3541938">&#39;b&#39;</span><span class="op" id="3541941">,</span>&nbsp;<span class="string" id="3541943">&#39;B&#39;</span><span class="op" id="3541946">:</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3541953">b</span>&nbsp;<span class="op" id="3541955">=</span>&nbsp;<span class="num" id="3541957">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3541963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541969">if</span>&nbsp;<span class="ident" id="3541972">b</span>&nbsp;<span class="op" id="3541974">==</span>&nbsp;<span class="num" id="3541977">2</span>&nbsp;<span class="op" id="3541979">||</span>&nbsp;<span class="ident" id="3541982">b</span>&nbsp;<span class="op" id="3541984">==</span>&nbsp;<span class="num" id="3541987">16</span>&nbsp;<span class="op" id="3541990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3541997">if</span>&nbsp;<span class="ident" id="3542000">ch</span><span class="op" id="3542002">,</span>&nbsp;<span class="ident" id="3542004">_</span><span class="op" id="3542005">,</span>&nbsp;<span class="ident" id="3542007">err</span>&nbsp;<span class="op" id="3542011">=</span>&nbsp;<span class="ident" id="3542013">r</span><span class="op" id="3542014">.</span><span class="ident" id="3542015">ReadRune</span><span class="op" id="3542023">(</span><span class="op" id="3542024">)</span><span class="op" id="3542025">;</span>&nbsp;<span class="ident" id="3542027">err</span>&nbsp;<span class="op" id="3542031">!=</span>&nbsp;<span class="ident" id="3542034">nil</span>&nbsp;<span class="op" id="3542038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542046">return</span>&nbsp;<span class="ident" id="3542053">z</span><span class="op" id="3542054">,</span>&nbsp;<span class="num" id="3542056">0</span><span class="op" id="3542057">,</span>&nbsp;<span class="ident" id="3542059">err</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3542068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3542074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542079">case</span>&nbsp;<span class="ident" id="3542084">io</span><span class="op" id="3542086">.</span><span class="ident" id="3542087">EOF</span><span class="op" id="3542090">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542096">return</span>&nbsp;<span class="ident" id="3542103">z</span><span class="op" id="3542104">.</span><span class="builtinfunc" id="3542105">make</span><span class="op" id="3542109">(</span><span class="num" id="3542110">0</span><span class="op" id="3542111">)</span><span class="op" id="3542112">,</span>&nbsp;<span class="num" id="3542114">10</span><span class="op" id="3542116">,</span>&nbsp;<span class="ident" id="3542118">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542125">default</span><span class="op" id="3542132">:</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542138">return</span>&nbsp;<span class="ident" id="3542145">z</span><span class="op" id="3542146">,</span>&nbsp;<span class="num" id="3542148">10</span><span class="op" id="3542150">,</span>&nbsp;<span class="ident" id="3542152">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3542159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3542163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3542166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3542170">//&nbsp;convert&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3542189">//&nbsp;-&nbsp;group&nbsp;as&nbsp;many&nbsp;digits&nbsp;d&nbsp;as&nbsp;possible&nbsp;together&nbsp;into&nbsp;a&nbsp;&#34;super-digit&#34;&nbsp;dd&nbsp;with&nbsp;&#34;super-base&#34;&nbsp;bb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3542284">//&nbsp;-&nbsp;only&nbsp;when&nbsp;bb&nbsp;does&nbsp;not&nbsp;fit&nbsp;into&nbsp;a&nbsp;word&nbsp;anymore,&nbsp;do&nbsp;a&nbsp;full&nbsp;number&nbsp;mulAddWW&nbsp;using&nbsp;bb&nbsp;and&nbsp;dd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542379">z</span>&nbsp;<span class="op" id="3542381">=</span>&nbsp;<span class="ident" id="3542383">z</span><span class="op" id="3542384">.</span><span class="builtinfunc" id="3542385">make</span><span class="op" id="3542389">(</span><span class="num" id="3542390">0</span><span class="op" id="3542391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542394">bb</span>&nbsp;<span class="op" id="3542397">:=</span>&nbsp;<span class="ident" id="3542400">Word</span><span class="op" id="3542404">(</span><span class="num" id="3542405">1</span><span class="op" id="3542406">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542409">dd</span>&nbsp;<span class="op" id="3542412">:=</span>&nbsp;<span class="ident" id="3542415">Word</span><span class="op" id="3542419">(</span><span class="num" id="3542420">0</span><span class="op" id="3542421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542424">for</span>&nbsp;<span class="ident" id="3542428">max</span>&nbsp;<span class="op" id="3542432">:=</span>&nbsp;<span class="ident" id="3542435">_M</span>&nbsp;<span class="op" id="3542438">/</span>&nbsp;<span class="ident" id="3542440">b</span><span class="op" id="3542441">;</span>&nbsp;<span class="op" id="3542443">;</span>&nbsp;<span class="op" id="3542445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542449">d</span>&nbsp;<span class="op" id="3542451">:=</span>&nbsp;<span class="ident" id="3542454">hexValue</span><span class="op" id="3542462">(</span><span class="ident" id="3542463">ch</span><span class="op" id="3542465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542469">if</span>&nbsp;<span class="ident" id="3542472">d</span>&nbsp;<span class="op" id="3542474">&gt;=</span>&nbsp;<span class="ident" id="3542477">b</span>&nbsp;<span class="op" id="3542479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542484">r</span><span class="op" id="3542485">.</span><span class="ident" id="3542486">UnreadRune</span><span class="op" id="3542496">(</span><span class="op" id="3542497">)</span>&nbsp;<span class="comment" id="3542499">//&nbsp;ch&nbsp;does&nbsp;not&nbsp;belong&nbsp;to&nbsp;number&nbsp;anymore</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542542">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3542550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542555">if</span>&nbsp;<span class="ident" id="3542558">bb</span>&nbsp;<span class="op" id="3542561">&lt;=</span>&nbsp;<span class="ident" id="3542564">max</span>&nbsp;<span class="op" id="3542568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542573">bb</span>&nbsp;<span class="op" id="3542576">*=</span>&nbsp;<span class="ident" id="3542579">b</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542584">dd</span>&nbsp;<span class="op" id="3542587">=</span>&nbsp;<span class="ident" id="3542589">dd</span><span class="op" id="3542591">*</span><span class="ident" id="3542592">b</span>&nbsp;<span class="op" id="3542594">+</span>&nbsp;<span class="ident" id="3542596">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3542600">}</span>&nbsp;<span class="keyword" id="3542602">else</span>&nbsp;<span class="op" id="3542607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3542612">//&nbsp;bb&nbsp;*&nbsp;b&nbsp;would&nbsp;overflow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542640">z</span>&nbsp;<span class="op" id="3542642">=</span>&nbsp;<span class="ident" id="3542644">z</span><span class="op" id="3542645">.</span><span class="ident" id="3542646">mulAddWW</span><span class="op" id="3542654">(</span><span class="ident" id="3542655">z</span><span class="op" id="3542656">,</span>&nbsp;<span class="ident" id="3542658">bb</span><span class="op" id="3542660">,</span>&nbsp;<span class="ident" id="3542662">dd</span><span class="op" id="3542664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542669">bb</span>&nbsp;<span class="op" id="3542672">=</span>&nbsp;<span class="ident" id="3542674">b</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542679">dd</span>&nbsp;<span class="op" id="3542682">=</span>&nbsp;<span class="ident" id="3542684">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3542688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542693">if</span>&nbsp;<span class="ident" id="3542696">ch</span><span class="op" id="3542698">,</span>&nbsp;<span class="ident" id="3542700">_</span><span class="op" id="3542701">,</span>&nbsp;<span class="ident" id="3542703">err</span>&nbsp;<span class="op" id="3542707">=</span>&nbsp;<span class="ident" id="3542709">r</span><span class="op" id="3542710">.</span><span class="ident" id="3542711">ReadRune</span><span class="op" id="3542719">(</span><span class="op" id="3542720">)</span><span class="op" id="3542721">;</span>&nbsp;<span class="ident" id="3542723">err</span>&nbsp;<span class="op" id="3542727">!=</span>&nbsp;<span class="ident" id="3542730">nil</span>&nbsp;<span class="op" id="3542734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542739">if</span>&nbsp;<span class="ident" id="3542742">err</span>&nbsp;<span class="op" id="3542746">!=</span>&nbsp;<span class="ident" id="3542749">io</span><span class="op" id="3542751">.</span><span class="ident" id="3542752">EOF</span>&nbsp;<span class="op" id="3542756">{</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542762">return</span>&nbsp;<span class="ident" id="3542769">z</span><span class="op" id="3542770">,</span>&nbsp;<span class="builtintype" id="3542772">int</span><span class="op" id="3542775">(</span><span class="ident" id="3542776">b</span><span class="op" id="3542777">)</span><span class="op" id="3542778">,</span>&nbsp;<span class="ident" id="3542780">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3542787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542792">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3542800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3542803">}</span><br>
<span class="lineno">705</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542807">switch</span>&nbsp;<span class="op" id="3542814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542817">case</span>&nbsp;<span class="ident" id="3542822">bb</span>&nbsp;<span class="op" id="3542825">&gt;</span>&nbsp;<span class="num" id="3542827">1</span><span class="op" id="3542828">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3542832">//&nbsp;there&nbsp;was&nbsp;at&nbsp;least&nbsp;one&nbsp;mantissa&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3542875">z</span>&nbsp;<span class="op" id="3542877">=</span>&nbsp;<span class="ident" id="3542879">z</span><span class="op" id="3542880">.</span><span class="ident" id="3542881">mulAddWW</span><span class="op" id="3542889">(</span><span class="ident" id="3542890">z</span><span class="op" id="3542891">,</span>&nbsp;<span class="ident" id="3542893">bb</span><span class="op" id="3542895">,</span>&nbsp;<span class="ident" id="3542897">dd</span><span class="op" id="3542899">)</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3542902">case</span>&nbsp;<span class="ident" id="3542907">base</span>&nbsp;<span class="op" id="3542912">==</span>&nbsp;<span class="num" id="3542915">0</span>&nbsp;<span class="op" id="3542917">&amp;&amp;</span>&nbsp;<span class="ident" id="3542920">b</span>&nbsp;<span class="op" id="3542922">==</span>&nbsp;<span class="num" id="3542925">8</span><span class="op" id="3542926">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3542930">//&nbsp;there&nbsp;was&nbsp;only&nbsp;the&nbsp;octal&nbsp;prefix&nbsp;0&nbsp;(possibly&nbsp;followed&nbsp;by&nbsp;digits&nbsp;&gt;&nbsp;7);</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3543004">//&nbsp;return&nbsp;base&nbsp;10,&nbsp;not&nbsp;8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3543031">return</span>&nbsp;<span class="ident" id="3543038">z</span><span class="op" id="3543039">,</span>&nbsp;<span class="num" id="3543041">10</span><span class="op" id="3543043">,</span>&nbsp;<span class="ident" id="3543045">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3543050">case</span>&nbsp;<span class="ident" id="3543055">base</span>&nbsp;<span class="op" id="3543060">!=</span>&nbsp;<span class="num" id="3543063">0</span>&nbsp;<span class="op" id="3543065">||</span>&nbsp;<span class="ident" id="3543068">b</span>&nbsp;<span class="op" id="3543070">!=</span>&nbsp;<span class="num" id="3543073">8</span><span class="op" id="3543074">:</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3543078">//&nbsp;there&nbsp;was&nbsp;neither&nbsp;a&nbsp;mantissa&nbsp;digit&nbsp;nor&nbsp;the&nbsp;octal&nbsp;prefix&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3543141">return</span>&nbsp;<span class="ident" id="3543148">z</span><span class="op" id="3543149">,</span>&nbsp;<span class="builtintype" id="3543151">int</span><span class="op" id="3543154">(</span><span class="ident" id="3543155">b</span><span class="op" id="3543156">)</span><span class="op" id="3543157">,</span>&nbsp;<span class="ident" id="3543159">errors</span><span class="op" id="3543165">.</span><span class="ident" id="3543166">New</span><span class="op" id="3543169">(</span><span class="string" id="3543170">&#34;syntax&nbsp;error&nbsp;scanning&nbsp;number&#34;</span><span class="op" id="3543200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3543203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3543207">return</span>&nbsp;<span class="ident" id="3543214">z</span><span class="op" id="3543215">.</span><span class="ident" id="3543216">norm</span><span class="op" id="3543220">(</span><span class="op" id="3543221">)</span><span class="op" id="3543222">,</span>&nbsp;<span class="builtintype" id="3543224">int</span><span class="op" id="3543227">(</span><span class="ident" id="3543228">b</span><span class="op" id="3543229">)</span><span class="op" id="3543230">,</span>&nbsp;<span class="ident" id="3543232">nil</span><br>
<span class="lineno">720</span><span class="op" id="3543236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3543239">//&nbsp;Character&nbsp;sets&nbsp;for&nbsp;string&nbsp;conversion.</span><br>
<span class="lineno"></span><span class="keyword" id="3543280">const</span>&nbsp;<span class="op" id="3543286">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3543289">lowercaseDigits</span>&nbsp;<span class="op" id="3543305">=</span>&nbsp;<span class="string" id="3543307">&#34;0123456789abcdefghijklmnopqrstuvwxyz&#34;</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3543347">uppercaseDigits</span>&nbsp;<span class="op" id="3543363">=</span>&nbsp;<span class="string" id="3543365">&#34;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span><span class="op" id="3543404">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3543407">//&nbsp;decimalString&nbsp;returns&nbsp;a&nbsp;decimal&nbsp;representation&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="comment" id="3543463">//&nbsp;It&nbsp;calls&nbsp;x.string&nbsp;with&nbsp;the&nbsp;charset&nbsp;&#34;0123456789&#34;.</span><br>
<span class="lineno">730</span><span class="keyword" id="3543515">func</span>&nbsp;<span class="op" id="3543520">(</span><span class="ident" id="3543521">x</span>&nbsp;<span class="ident" id="3543523">nat</span><span class="op" id="3543526">)</span>&nbsp;<span class="ident" id="3543528">decimalString</span><span class="op" id="3543541">(</span><span class="op" id="3543542">)</span>&nbsp;<span class="builtintype" id="3543544">string</span>&nbsp;<span class="op" id="3543551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3543554">return</span>&nbsp;<span class="ident" id="3543561">x</span><span class="op" id="3543562">.</span><span class="builtintype" id="3543563">string</span><span class="op" id="3543569">(</span><span class="ident" id="3543570">lowercaseDigits</span><span class="op" id="3543585">[</span><span class="num" id="3543586">0</span><span class="op" id="3543587">:</span><span class="num" id="3543588">10</span><span class="op" id="3543590">]</span><span class="op" id="3543591">)</span><br>
<span class="lineno"></span><span class="op" id="3543593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3543596">//&nbsp;string&nbsp;converts&nbsp;x&nbsp;to&nbsp;a&nbsp;string&nbsp;using&nbsp;digits&nbsp;from&nbsp;a&nbsp;charset;&nbsp;a&nbsp;digit&nbsp;with</span><br>
<span class="lineno">735</span><span class="comment" id="3543671">//&nbsp;value&nbsp;d&nbsp;is&nbsp;represented&nbsp;by&nbsp;charset[d].&nbsp;The&nbsp;conversion&nbsp;base&nbsp;is&nbsp;determined</span><br>
<span class="lineno"></span><span class="comment" id="3543746">//&nbsp;by&nbsp;len(charset),&nbsp;which&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;2&nbsp;and&nbsp;&lt;=&nbsp;256.</span><br>
<span class="lineno"></span><span class="keyword" id="3543797">func</span>&nbsp;<span class="op" id="3543802">(</span><span class="ident" id="3543803">x</span>&nbsp;<span class="ident" id="3543805">nat</span><span class="op" id="3543808">)</span>&nbsp;<span class="builtintype" id="3543810">string</span><span class="op" id="3543816">(</span><span class="ident" id="3543817">charset</span>&nbsp;<span class="builtintype" id="3543825">string</span><span class="op" id="3543831">)</span>&nbsp;<span class="builtintype" id="3543833">string</span>&nbsp;<span class="op" id="3543840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3543843">b</span>&nbsp;<span class="op" id="3543845">:=</span>&nbsp;<span class="ident" id="3543848">Word</span><span class="op" id="3543852">(</span><span class="builtinfunc" id="3543853">len</span><span class="op" id="3543856">(</span><span class="ident" id="3543857">charset</span><span class="op" id="3543864">)</span><span class="op" id="3543865">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3543869">//&nbsp;special&nbsp;cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3543887">switch</span>&nbsp;<span class="op" id="3543894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3543897">case</span>&nbsp;<span class="ident" id="3543902">b</span>&nbsp;<span class="op" id="3543904">&lt;</span>&nbsp;<span class="num" id="3543906">2</span>&nbsp;<span class="op" id="3543908">||</span>&nbsp;<span class="ident" id="3543911">MaxBase</span>&nbsp;<span class="op" id="3543919">&gt;</span>&nbsp;<span class="num" id="3543921">256</span><span class="op" id="3543924">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3543928">panic</span><span class="op" id="3543933">(</span><span class="string" id="3543934">&#34;illegal&nbsp;base&#34;</span><span class="op" id="3543948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3543951">case</span>&nbsp;<span class="builtinfunc" id="3543956">len</span><span class="op" id="3543959">(</span><span class="ident" id="3543960">x</span><span class="op" id="3543961">)</span>&nbsp;<span class="op" id="3543963">==</span>&nbsp;<span class="num" id="3543966">0</span><span class="op" id="3543967">:</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3543971">return</span>&nbsp;<span class="builtintype" id="3543978">string</span><span class="op" id="3543984">(</span><span class="ident" id="3543985">charset</span><span class="op" id="3543992">[</span><span class="num" id="3543993">0</span><span class="op" id="3543994">]</span><span class="op" id="3543995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3543998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544002">//&nbsp;allocate&nbsp;buffer&nbsp;for&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544037">i</span>&nbsp;<span class="op" id="3544039">:=</span>&nbsp;<span class="builtintype" id="3544042">int</span><span class="op" id="3544045">(</span><span class="builtintype" id="3544046">float64</span><span class="op" id="3544053">(</span><span class="ident" id="3544054">x</span><span class="op" id="3544055">.</span><span class="ident" id="3544056">bitLen</span><span class="op" id="3544062">(</span><span class="op" id="3544063">)</span><span class="op" id="3544064">)</span><span class="op" id="3544065">/</span><span class="ident" id="3544066">math</span><span class="op" id="3544070">.</span><span class="ident" id="3544071">Log2</span><span class="op" id="3544075">(</span><span class="builtintype" id="3544076">float64</span><span class="op" id="3544083">(</span><span class="ident" id="3544084">b</span><span class="op" id="3544085">)</span><span class="op" id="3544086">)</span><span class="op" id="3544087">)</span>&nbsp;<span class="op" id="3544089">+</span>&nbsp;<span class="num" id="3544091">1</span>&nbsp;<span class="comment" id="3544093">//&nbsp;off&nbsp;by&nbsp;one&nbsp;at&nbsp;most</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544116">s</span>&nbsp;<span class="op" id="3544118">:=</span>&nbsp;<span class="builtinfunc" id="3544121">make</span><span class="op" id="3544125">(</span><span class="op" id="3544126">[</span><span class="op" id="3544127">]</span><span class="builtintype" id="3544128">byte</span><span class="op" id="3544132">,</span>&nbsp;<span class="ident" id="3544134">i</span><span class="op" id="3544135">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544139">//&nbsp;convert&nbsp;power&nbsp;of&nbsp;two&nbsp;and&nbsp;non&nbsp;power&nbsp;of&nbsp;two&nbsp;bases&nbsp;separately</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3544202">if</span>&nbsp;<span class="ident" id="3544205">b</span>&nbsp;<span class="op" id="3544207">==</span>&nbsp;<span class="ident" id="3544210">b</span><span class="op" id="3544211">&amp;</span><span class="op" id="3544212">-</span><span class="ident" id="3544213">b</span>&nbsp;<span class="op" id="3544215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544219">//&nbsp;shift&nbsp;is&nbsp;base-b&nbsp;digit&nbsp;size&nbsp;in&nbsp;bits</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544259">shift</span>&nbsp;<span class="op" id="3544265">:=</span>&nbsp;<span class="ident" id="3544268">trailingZeroBits</span><span class="op" id="3544284">(</span><span class="ident" id="3544285">b</span><span class="op" id="3544286">)</span>&nbsp;<span class="comment" id="3544288">//&nbsp;shift&nbsp;&gt;&nbsp;0&nbsp;because&nbsp;b&nbsp;&gt;=&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544318">mask</span>&nbsp;<span class="op" id="3544323">:=</span>&nbsp;<span class="ident" id="3544326">Word</span><span class="op" id="3544330">(</span><span class="num" id="3544331">1</span><span class="op" id="3544332">)</span><span class="op" id="3544333">&lt;&lt;</span><span class="ident" id="3544335">shift</span>&nbsp;<span class="op" id="3544341">-</span>&nbsp;<span class="num" id="3544343">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544347">w</span>&nbsp;<span class="op" id="3544349">:=</span>&nbsp;<span class="ident" id="3544352">x</span><span class="op" id="3544353">[</span><span class="num" id="3544354">0</span><span class="op" id="3544355">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544359">nbits</span>&nbsp;<span class="op" id="3544365">:=</span>&nbsp;<span class="builtintype" id="3544368">uint</span><span class="op" id="3544372">(</span><span class="ident" id="3544373">_W</span><span class="op" id="3544375">)</span>&nbsp;<span class="comment" id="3544377">//&nbsp;number&nbsp;of&nbsp;unprocessed&nbsp;bits&nbsp;in&nbsp;w</span><br>
<span class="lineno"></span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544415">//&nbsp;convert&nbsp;less-significant&nbsp;words</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3544451">for</span>&nbsp;<span class="ident" id="3544455">k</span>&nbsp;<span class="op" id="3544457">:=</span>&nbsp;<span class="num" id="3544460">1</span><span class="op" id="3544461">;</span>&nbsp;<span class="ident" id="3544463">k</span>&nbsp;<span class="op" id="3544465">&lt;</span>&nbsp;<span class="builtinfunc" id="3544467">len</span><span class="op" id="3544470">(</span><span class="ident" id="3544471">x</span><span class="op" id="3544472">)</span><span class="op" id="3544473">;</span>&nbsp;<span class="ident" id="3544475">k</span><span class="op" id="3544476">++</span>&nbsp;<span class="op" id="3544479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544484">//&nbsp;convert&nbsp;full&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3544510">for</span>&nbsp;<span class="ident" id="3544514">nbits</span>&nbsp;<span class="op" id="3544520">&gt;=</span>&nbsp;<span class="ident" id="3544523">shift</span>&nbsp;<span class="op" id="3544529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544535">i</span><span class="op" id="3544536">--</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544543">s</span><span class="op" id="3544544">[</span><span class="ident" id="3544545">i</span><span class="op" id="3544546">]</span>&nbsp;<span class="op" id="3544548">=</span>&nbsp;<span class="ident" id="3544550">charset</span><span class="op" id="3544557">[</span><span class="ident" id="3544558">w</span><span class="op" id="3544559">&amp;</span><span class="ident" id="3544560">mask</span><span class="op" id="3544564">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544570">w</span>&nbsp;<span class="op" id="3544572">&gt;&gt;=</span>&nbsp;<span class="ident" id="3544576">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544586">nbits</span>&nbsp;<span class="op" id="3544592">-=</span>&nbsp;<span class="ident" id="3544595">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3544604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544610">//&nbsp;convert&nbsp;any&nbsp;partial&nbsp;leading&nbsp;digit&nbsp;and&nbsp;advance&nbsp;to&nbsp;next&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3544675">if</span>&nbsp;<span class="ident" id="3544678">nbits</span>&nbsp;<span class="op" id="3544684">==</span>&nbsp;<span class="num" id="3544687">0</span>&nbsp;<span class="op" id="3544689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544695">//&nbsp;no&nbsp;partial&nbsp;digit&nbsp;remaining,&nbsp;just&nbsp;advance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544743">w</span>&nbsp;<span class="op" id="3544745">=</span>&nbsp;<span class="ident" id="3544747">x</span><span class="op" id="3544748">[</span><span class="ident" id="3544749">k</span><span class="op" id="3544750">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544756">nbits</span>&nbsp;<span class="op" id="3544762">=</span>&nbsp;<span class="ident" id="3544764">_W</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3544770">}</span>&nbsp;<span class="keyword" id="3544772">else</span>&nbsp;<span class="op" id="3544777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544783">//&nbsp;partial&nbsp;digit&nbsp;in&nbsp;current&nbsp;(k-1)&nbsp;and&nbsp;next&nbsp;(k)&nbsp;word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544839">w</span>&nbsp;<span class="op" id="3544841">|=</span>&nbsp;<span class="ident" id="3544844">x</span><span class="op" id="3544845">[</span><span class="ident" id="3544846">k</span><span class="op" id="3544847">]</span>&nbsp;<span class="op" id="3544849">&lt;&lt;</span>&nbsp;<span class="ident" id="3544852">nbits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544862">i</span><span class="op" id="3544863">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544870">s</span><span class="op" id="3544871">[</span><span class="ident" id="3544872">i</span><span class="op" id="3544873">]</span>&nbsp;<span class="op" id="3544875">=</span>&nbsp;<span class="ident" id="3544877">charset</span><span class="op" id="3544884">[</span><span class="ident" id="3544885">w</span><span class="op" id="3544886">&amp;</span><span class="ident" id="3544887">mask</span><span class="op" id="3544891">]</span><br>
<span class="lineno">780</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544898">//&nbsp;advance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544913">w</span>&nbsp;<span class="op" id="3544915">=</span>&nbsp;<span class="ident" id="3544917">x</span><span class="op" id="3544918">[</span><span class="ident" id="3544919">k</span><span class="op" id="3544920">]</span>&nbsp;<span class="op" id="3544922">&gt;&gt;</span>&nbsp;<span class="op" id="3544925">(</span><span class="ident" id="3544926">shift</span>&nbsp;<span class="op" id="3544932">-</span>&nbsp;<span class="ident" id="3544934">nbits</span><span class="op" id="3544939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3544945">nbits</span>&nbsp;<span class="op" id="3544951">=</span>&nbsp;<span class="ident" id="3544953">_W</span>&nbsp;<span class="op" id="3544956">-</span>&nbsp;<span class="op" id="3544958">(</span><span class="ident" id="3544959">shift</span>&nbsp;<span class="op" id="3544965">-</span>&nbsp;<span class="ident" id="3544967">nbits</span><span class="op" id="3544972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3544977">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3544981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3544986">//&nbsp;convert&nbsp;digits&nbsp;of&nbsp;most-significant&nbsp;word&nbsp;(omit&nbsp;leading&nbsp;zeros)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3545052">for</span>&nbsp;<span class="ident" id="3545056">nbits</span>&nbsp;<span class="op" id="3545062">&gt;=</span>&nbsp;<span class="num" id="3545065">0</span>&nbsp;<span class="op" id="3545067">&amp;&amp;</span>&nbsp;<span class="ident" id="3545070">w</span>&nbsp;<span class="op" id="3545072">!=</span>&nbsp;<span class="num" id="3545075">0</span>&nbsp;<span class="op" id="3545077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3545082">i</span><span class="op" id="3545083">--</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3545089">s</span><span class="op" id="3545090">[</span><span class="ident" id="3545091">i</span><span class="op" id="3545092">]</span>&nbsp;<span class="op" id="3545094">=</span>&nbsp;<span class="ident" id="3545096">charset</span><span class="op" id="3545103">[</span><span class="ident" id="3545104">w</span><span class="op" id="3545105">&amp;</span><span class="ident" id="3545106">mask</span><span class="op" id="3545110">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3545115">w</span>&nbsp;<span class="op" id="3545117">&gt;&gt;=</span>&nbsp;<span class="ident" id="3545121">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3545130">nbits</span>&nbsp;<span class="op" id="3545136">-=</span>&nbsp;<span class="ident" id="3545139">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3545147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3545151">}</span>&nbsp;<span class="keyword" id="3545153">else</span>&nbsp;<span class="op" id="3545158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3545162">//&nbsp;determine&nbsp;&#34;big&nbsp;base&#34;;&nbsp;i.e.,&nbsp;the&nbsp;largest&nbsp;possible&nbsp;value&nbsp;bb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3545225">//&nbsp;that&nbsp;is&nbsp;a&nbsp;power&nbsp;of&nbsp;base&nbsp;b&nbsp;and&nbsp;still&nbsp;fits&nbsp;into&nbsp;a&nbsp;Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3545283">//&nbsp;(as&nbsp;in&nbsp;10^19&nbsp;for&nbsp;19&nbsp;decimal&nbsp;digits&nbsp;in&nbsp;a&nbsp;64bit&nbsp;Word)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3545340">bb</span>&nbsp;<span class="op" id="3545343">:=</span>&nbsp;<span class="ident" id="3545346">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3545353">//&nbsp;big&nbsp;base&nbsp;is&nbsp;b**ndigits</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3545381">ndigits</span>&nbsp;<span class="op" id="3545389">:=</span>&nbsp;<span class="num" id="3545392">1</span>&nbsp;<span class="comment" id="3545394">//&nbsp;number&nbsp;of&nbsp;base&nbsp;b&nbsp;digits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3545423">for</span>&nbsp;<span class="ident" id="3545427">max</span>&nbsp;<span class="op" id="3545431">:=</span>&nbsp;<span class="ident" id="3545434">Word</span><span class="op" id="3545438">(</span><span class="ident" id="3545439">_M</span>&nbsp;<span class="op" id="3545442">/</span>&nbsp;<span class="ident" id="3545444">b</span><span class="op" id="3545445">)</span><span class="op" id="3545446">;</span>&nbsp;<span class="ident" id="3545448">bb</span>&nbsp;<span class="op" id="3545451">&lt;=</span>&nbsp;<span class="ident" id="3545454">max</span><span class="op" id="3545457">;</span>&nbsp;<span class="ident" id="3545459">bb</span>&nbsp;<span class="op" id="3545462">*=</span>&nbsp;<span class="ident" id="3545465">b</span>&nbsp;<span class="op" id="3545467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3545472">ndigits</span><span class="op" id="3545479">++</span>&nbsp;<span class="comment" id="3545482">//&nbsp;maximize&nbsp;ndigits&nbsp;where&nbsp;bb&nbsp;=&nbsp;b**ndigits,&nbsp;bb&nbsp;&lt;=&nbsp;_M</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3545536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3545541">//&nbsp;construct&nbsp;table&nbsp;of&nbsp;successive&nbsp;squares&nbsp;of&nbsp;bb*leafSize&nbsp;to&nbsp;use&nbsp;in&nbsp;subdivisions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3545622">//&nbsp;result&nbsp;(table&nbsp;!=&nbsp;nil)&nbsp;&lt;=&gt;&nbsp;(len(x)&nbsp;&gt;&nbsp;leafSize&nbsp;&gt;&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3545677">table</span>&nbsp;<span class="op" id="3545683">:=</span>&nbsp;<span class="ident" id="3545686">divisors</span><span class="op" id="3545694">(</span><span class="builtinfunc" id="3545695">len</span><span class="op" id="3545698">(</span><span class="ident" id="3545699">x</span><span class="op" id="3545700">)</span><span class="op" id="3545701">,</span>&nbsp;<span class="ident" id="3545703">b</span><span class="op" id="3545704">,</span>&nbsp;<span class="ident" id="3545706">ndigits</span><span class="op" id="3545713">,</span>&nbsp;<span class="ident" id="3545715">bb</span><span class="op" id="3545717">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3545722">//&nbsp;preserve&nbsp;x,&nbsp;create&nbsp;local&nbsp;copy&nbsp;for&nbsp;use&nbsp;by&nbsp;convertWords</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3545781">q</span>&nbsp;<span class="op" id="3545783">:=</span>&nbsp;<span class="ident" id="3545786">nat</span><span class="op" id="3545789">(</span><span class="ident" id="3545790">nil</span><span class="op" id="3545793">)</span><span class="op" id="3545794">.</span><span class="ident" id="3545795">set</span><span class="op" id="3545798">(</span><span class="ident" id="3545799">x</span><span class="op" id="3545800">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3545805">//&nbsp;convert&nbsp;q&nbsp;to&nbsp;string&nbsp;s&nbsp;in&nbsp;base&nbsp;b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3545842">q</span><span class="op" id="3545843">.</span><span class="ident" id="3545844">convertWords</span><span class="op" id="3545856">(</span><span class="ident" id="3545857">s</span><span class="op" id="3545858">,</span>&nbsp;<span class="ident" id="3545860">charset</span><span class="op" id="3545867">,</span>&nbsp;<span class="ident" id="3545869">b</span><span class="op" id="3545870">,</span>&nbsp;<span class="ident" id="3545872">ndigits</span><span class="op" id="3545879">,</span>&nbsp;<span class="ident" id="3545881">bb</span><span class="op" id="3545883">,</span>&nbsp;<span class="ident" id="3545885">table</span><span class="op" id="3545890">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3545895">//&nbsp;strip&nbsp;leading&nbsp;zeros</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3545920">//&nbsp;(x&nbsp;!=&nbsp;0;&nbsp;thus&nbsp;s&nbsp;must&nbsp;contain&nbsp;at&nbsp;least&nbsp;one&nbsp;non-zero&nbsp;digit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3545982">//&nbsp;and&nbsp;the&nbsp;loop&nbsp;will&nbsp;terminate)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3546016">i</span>&nbsp;<span class="op" id="3546018">=</span>&nbsp;<span class="num" id="3546020">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3546024">for</span>&nbsp;<span class="ident" id="3546028">zero</span>&nbsp;<span class="op" id="3546033">:=</span>&nbsp;<span class="ident" id="3546036">charset</span><span class="op" id="3546043">[</span><span class="num" id="3546044">0</span><span class="op" id="3546045">]</span><span class="op" id="3546046">;</span>&nbsp;<span class="ident" id="3546048">s</span><span class="op" id="3546049">[</span><span class="ident" id="3546050">i</span><span class="op" id="3546051">]</span>&nbsp;<span class="op" id="3546053">==</span>&nbsp;<span class="ident" id="3546056">zero</span><span class="op" id="3546060">;</span>&nbsp;<span class="op" id="3546062">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3546067">i</span><span class="op" id="3546068">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3546073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3546076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3546080">return</span>&nbsp;<span class="builtintype" id="3546087">string</span><span class="op" id="3546093">(</span><span class="ident" id="3546094">s</span><span class="op" id="3546095">[</span><span class="ident" id="3546096">i</span><span class="op" id="3546097">:</span><span class="op" id="3546098">]</span><span class="op" id="3546099">)</span><br>
<span class="lineno">825</span><span class="op" id="3546101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3546104">//&nbsp;Convert&nbsp;words&nbsp;of&nbsp;q&nbsp;to&nbsp;base&nbsp;b&nbsp;digits&nbsp;in&nbsp;s.&nbsp;If&nbsp;q&nbsp;is&nbsp;large,&nbsp;it&nbsp;is&nbsp;recursively&nbsp;&#34;split&nbsp;in&nbsp;half&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3546198">//&nbsp;by&nbsp;nat/nat&nbsp;division&nbsp;using&nbsp;tabulated&nbsp;divisors.&nbsp;Otherwise,&nbsp;it&nbsp;is&nbsp;converted&nbsp;iteratively&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="3546292">//&nbsp;repeated&nbsp;nat/Word&nbsp;division.</span><br>
<span class="lineno">830</span><span class="comment" id="3546323">//</span><br>
<span class="lineno"></span><span class="comment" id="3546326">//&nbsp;The&nbsp;iterative&nbsp;method&nbsp;processes&nbsp;n&nbsp;Words&nbsp;by&nbsp;n&nbsp;divW()&nbsp;calls,&nbsp;each&nbsp;of&nbsp;which&nbsp;visits&nbsp;every&nbsp;Word&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3546426">//&nbsp;incrementally&nbsp;shortened&nbsp;q&nbsp;for&nbsp;a&nbsp;total&nbsp;of&nbsp;n&nbsp;+&nbsp;(n-1)&nbsp;+&nbsp;(n-2)&nbsp;...&nbsp;+&nbsp;2&nbsp;+&nbsp;1,&nbsp;or&nbsp;n(n+1)/2&nbsp;divW()&#39;s.</span><br>
<span class="lineno"></span><span class="comment" id="3546523">//&nbsp;Recursive&nbsp;conversion&nbsp;divides&nbsp;q&nbsp;by&nbsp;its&nbsp;approximate&nbsp;square&nbsp;root,&nbsp;yielding&nbsp;two&nbsp;parts,&nbsp;each&nbsp;half</span><br>
<span class="lineno"></span><span class="comment" id="3546619">//&nbsp;the&nbsp;size&nbsp;of&nbsp;q.&nbsp;Using&nbsp;the&nbsp;iterative&nbsp;method&nbsp;on&nbsp;both&nbsp;halves&nbsp;means&nbsp;2&nbsp;*&nbsp;(n/2)(n/2&nbsp;+&nbsp;1)/2&nbsp;divW()&#39;s</span><br>
<span class="lineno">835</span><span class="comment" id="3546715">//&nbsp;plus&nbsp;the&nbsp;expensive&nbsp;long&nbsp;div().&nbsp;Asymptotically,&nbsp;the&nbsp;ratio&nbsp;is&nbsp;favorable&nbsp;at&nbsp;1/2&nbsp;the&nbsp;divW()&#39;s,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3546813">//&nbsp;is&nbsp;made&nbsp;better&nbsp;by&nbsp;splitting&nbsp;the&nbsp;subblocks&nbsp;recursively.&nbsp;Best&nbsp;is&nbsp;to&nbsp;split&nbsp;blocks&nbsp;until&nbsp;one&nbsp;more</span><br>
<span class="lineno"></span><span class="comment" id="3546910">//&nbsp;split&nbsp;would&nbsp;take&nbsp;longer&nbsp;(because&nbsp;of&nbsp;the&nbsp;nat/nat&nbsp;div())&nbsp;than&nbsp;the&nbsp;twice&nbsp;as&nbsp;many&nbsp;divW()&#39;s&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3547007">//&nbsp;iterative&nbsp;approach.&nbsp;This&nbsp;threshold&nbsp;is&nbsp;represented&nbsp;by&nbsp;leafSize.&nbsp;Benchmarking&nbsp;of&nbsp;leafSize&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3547105">//&nbsp;range&nbsp;2..64&nbsp;shows&nbsp;that&nbsp;values&nbsp;of&nbsp;8&nbsp;and&nbsp;16&nbsp;work&nbsp;well,&nbsp;with&nbsp;a&nbsp;4x&nbsp;speedup&nbsp;at&nbsp;medium&nbsp;lengths&nbsp;and</span><br>
<span class="lineno">840</span><span class="comment" id="3547201">//&nbsp;~30x&nbsp;for&nbsp;20000&nbsp;digits.&nbsp;Use&nbsp;nat_test.go&#39;s&nbsp;BenchmarkLeafSize&nbsp;tests&nbsp;to&nbsp;optimize&nbsp;leafSize&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3547294">//&nbsp;specific&nbsp;hardware.</span><br>
<span class="lineno"></span><span class="comment" id="3547316">//</span><br>
<span class="lineno"></span><span class="keyword" id="3547319">func</span>&nbsp;<span class="op" id="3547324">(</span><span class="ident" id="3547325">q</span>&nbsp;<span class="ident" id="3547327">nat</span><span class="op" id="3547330">)</span>&nbsp;<span class="ident" id="3547332">convertWords</span><span class="op" id="3547344">(</span><span class="ident" id="3547345">s</span>&nbsp;<span class="op" id="3547347">[</span><span class="op" id="3547348">]</span><span class="builtintype" id="3547349">byte</span><span class="op" id="3547353">,</span>&nbsp;<span class="ident" id="3547355">charset</span>&nbsp;<span class="builtintype" id="3547363">string</span><span class="op" id="3547369">,</span>&nbsp;<span class="ident" id="3547371">b</span>&nbsp;<span class="ident" id="3547373">Word</span><span class="op" id="3547377">,</span>&nbsp;<span class="ident" id="3547379">ndigits</span>&nbsp;<span class="builtintype" id="3547387">int</span><span class="op" id="3547390">,</span>&nbsp;<span class="ident" id="3547392">bb</span>&nbsp;<span class="ident" id="3547395">Word</span><span class="op" id="3547399">,</span>&nbsp;<span class="ident" id="3547401">table</span>&nbsp;<span class="op" id="3547407">[</span><span class="op" id="3547408">]</span><span class="ident" id="3547409">divisor</span><span class="op" id="3547416">)</span>&nbsp;<span class="op" id="3547418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3547421">//&nbsp;split&nbsp;larger&nbsp;blocks&nbsp;recursively</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547457">if</span>&nbsp;<span class="ident" id="3547460">table</span>&nbsp;<span class="op" id="3547466">!=</span>&nbsp;<span class="ident" id="3547469">nil</span>&nbsp;<span class="op" id="3547473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3547477">//&nbsp;len(q)&nbsp;&gt;&nbsp;leafSize&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547504">var</span>&nbsp;<span class="ident" id="3547508">r</span>&nbsp;<span class="ident" id="3547510">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3547516">index</span>&nbsp;<span class="op" id="3547522">:=</span>&nbsp;<span class="builtinfunc" id="3547525">len</span><span class="op" id="3547528">(</span><span class="ident" id="3547529">table</span><span class="op" id="3547534">)</span>&nbsp;<span class="op" id="3547536">-</span>&nbsp;<span class="num" id="3547538">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547542">for</span>&nbsp;<span class="builtinfunc" id="3547546">len</span><span class="op" id="3547549">(</span><span class="ident" id="3547550">q</span><span class="op" id="3547551">)</span>&nbsp;<span class="op" id="3547553">&gt;</span>&nbsp;<span class="ident" id="3547555">leafSize</span>&nbsp;<span class="op" id="3547564">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3547569">//&nbsp;find&nbsp;divisor&nbsp;close&nbsp;to&nbsp;sqrt(q)&nbsp;if&nbsp;possible,&nbsp;but&nbsp;in&nbsp;any&nbsp;case&nbsp;&lt;&nbsp;q</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3547638">maxLength</span>&nbsp;<span class="op" id="3547648">:=</span>&nbsp;<span class="ident" id="3547651">q</span><span class="op" id="3547652">.</span><span class="ident" id="3547653">bitLen</span><span class="op" id="3547659">(</span><span class="op" id="3547660">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3547666">//&nbsp;~=&nbsp;log2&nbsp;q,&nbsp;or&nbsp;at&nbsp;of&nbsp;least&nbsp;largest&nbsp;possible&nbsp;q&nbsp;of&nbsp;this&nbsp;bit&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3547736">minLength</span>&nbsp;<span class="op" id="3547746">:=</span>&nbsp;<span class="ident" id="3547749">maxLength</span>&nbsp;<span class="op" id="3547759">&gt;&gt;</span>&nbsp;<span class="num" id="3547762">1</span>&nbsp;<span class="comment" id="3547764">//&nbsp;~=&nbsp;log2&nbsp;sqrt(q)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547786">for</span>&nbsp;<span class="ident" id="3547790">index</span>&nbsp;<span class="op" id="3547796">&gt;</span>&nbsp;<span class="num" id="3547798">0</span>&nbsp;<span class="op" id="3547800">&amp;&amp;</span>&nbsp;<span class="ident" id="3547803">table</span><span class="op" id="3547808">[</span><span class="ident" id="3547809">index</span><span class="op" id="3547814">-</span><span class="num" id="3547815">1</span><span class="op" id="3547816">]</span><span class="op" id="3547817">.</span><span class="ident" id="3547818">nbits</span>&nbsp;<span class="op" id="3547824">&gt;</span>&nbsp;<span class="ident" id="3547826">minLength</span>&nbsp;<span class="op" id="3547836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3547842">index</span><span class="op" id="3547847">--</span>&nbsp;<span class="comment" id="3547850">//&nbsp;desired</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3547864">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547869">if</span>&nbsp;<span class="ident" id="3547872">table</span><span class="op" id="3547877">[</span><span class="ident" id="3547878">index</span><span class="op" id="3547883">]</span><span class="op" id="3547884">.</span><span class="ident" id="3547885">nbits</span>&nbsp;<span class="op" id="3547891">&gt;=</span>&nbsp;<span class="ident" id="3547894">maxLength</span>&nbsp;<span class="op" id="3547904">&amp;&amp;</span>&nbsp;<span class="ident" id="3547907">table</span><span class="op" id="3547912">[</span><span class="ident" id="3547913">index</span><span class="op" id="3547918">]</span><span class="op" id="3547919">.</span><span class="ident" id="3547920">bbb</span><span class="op" id="3547923">.</span><span class="ident" id="3547924">cmp</span><span class="op" id="3547927">(</span><span class="ident" id="3547928">q</span><span class="op" id="3547929">)</span>&nbsp;<span class="op" id="3547931">&gt;=</span>&nbsp;<span class="num" id="3547934">0</span>&nbsp;<span class="op" id="3547936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3547942">index</span><span class="op" id="3547947">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3547954">if</span>&nbsp;<span class="ident" id="3547957">index</span>&nbsp;<span class="op" id="3547963">&lt;</span>&nbsp;<span class="num" id="3547965">0</span>&nbsp;<span class="op" id="3547967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3547974">panic</span><span class="op" id="3547979">(</span><span class="string" id="3547980">&#34;internal&nbsp;inconsistency&#34;</span><span class="op" id="3548004">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3548010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3548015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3548021">//&nbsp;split&nbsp;q&nbsp;into&nbsp;the&nbsp;two&nbsp;digit&nbsp;number&nbsp;(q&#39;*bbb&nbsp;+&nbsp;r)&nbsp;to&nbsp;form&nbsp;independent&nbsp;subblocks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3548104">q</span><span class="op" id="3548105">,</span>&nbsp;<span class="ident" id="3548107">r</span>&nbsp;<span class="op" id="3548109">=</span>&nbsp;<span class="ident" id="3548111">q</span><span class="op" id="3548112">.</span><span class="ident" id="3548113">div</span><span class="op" id="3548116">(</span><span class="ident" id="3548117">r</span><span class="op" id="3548118">,</span>&nbsp;<span class="ident" id="3548120">q</span><span class="op" id="3548121">,</span>&nbsp;<span class="ident" id="3548123">table</span><span class="op" id="3548128">[</span><span class="ident" id="3548129">index</span><span class="op" id="3548134">]</span><span class="op" id="3548135">.</span><span class="ident" id="3548136">bbb</span><span class="op" id="3548139">)</span><br>
<span class="lineno">865</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3548145">//&nbsp;convert&nbsp;subblocks&nbsp;and&nbsp;collect&nbsp;results&nbsp;in&nbsp;s[:h]&nbsp;and&nbsp;s[h:]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3548208">h</span>&nbsp;<span class="op" id="3548210">:=</span>&nbsp;<span class="builtinfunc" id="3548213">len</span><span class="op" id="3548216">(</span><span class="ident" id="3548217">s</span><span class="op" id="3548218">)</span>&nbsp;<span class="op" id="3548220">-</span>&nbsp;<span class="ident" id="3548222">table</span><span class="op" id="3548227">[</span><span class="ident" id="3548228">index</span><span class="op" id="3548233">]</span><span class="op" id="3548234">.</span><span class="ident" id="3548235">ndigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3548246">r</span><span class="op" id="3548247">.</span><span class="ident" id="3548248">convertWords</span><span class="op" id="3548260">(</span><span class="ident" id="3548261">s</span><span class="op" id="3548262">[</span><span class="ident" id="3548263">h</span><span class="op" id="3548264">:</span><span class="op" id="3548265">]</span><span class="op" id="3548266">,</span>&nbsp;<span class="ident" id="3548268">charset</span><span class="op" id="3548275">,</span>&nbsp;<span class="ident" id="3548277">b</span><span class="op" id="3548278">,</span>&nbsp;<span class="ident" id="3548280">ndigits</span><span class="op" id="3548287">,</span>&nbsp;<span class="ident" id="3548289">bb</span><span class="op" id="3548291">,</span>&nbsp;<span class="ident" id="3548293">table</span><span class="op" id="3548298">[</span><span class="num" id="3548299">0</span><span class="op" id="3548300">:</span><span class="ident" id="3548301">index</span><span class="op" id="3548306">]</span><span class="op" id="3548307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3548312">s</span>&nbsp;<span class="op" id="3548314">=</span>&nbsp;<span class="ident" id="3548316">s</span><span class="op" id="3548317">[</span><span class="op" id="3548318">:</span><span class="ident" id="3548319">h</span><span class="op" id="3548320">]</span>&nbsp;<span class="comment" id="3548322">//&nbsp;==&nbsp;q.convertWords(s,&nbsp;charset,&nbsp;b,&nbsp;ndigits,&nbsp;bb,&nbsp;table[0:index+1])</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3548391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3548394">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3548398">//&nbsp;having&nbsp;split&nbsp;any&nbsp;large&nbsp;blocks&nbsp;now&nbsp;process&nbsp;the&nbsp;remaining&nbsp;(small)&nbsp;block&nbsp;iteratively</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3548484">i</span>&nbsp;<span class="op" id="3548486">:=</span>&nbsp;<span class="builtinfunc" id="3548489">len</span><span class="op" id="3548492">(</span><span class="ident" id="3548493">s</span><span class="op" id="3548494">)</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3548497">var</span>&nbsp;<span class="ident" id="3548501">r</span>&nbsp;<span class="ident" id="3548503">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3548509">if</span>&nbsp;<span class="ident" id="3548512">b</span>&nbsp;<span class="op" id="3548514">==</span>&nbsp;<span class="num" id="3548517">10</span>&nbsp;<span class="op" id="3548520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3548524">//&nbsp;hard-coding&nbsp;for&nbsp;10&nbsp;here&nbsp;speeds&nbsp;this&nbsp;up&nbsp;by&nbsp;1.25x&nbsp;(allows&nbsp;for&nbsp;/&nbsp;and&nbsp;%&nbsp;by&nbsp;constants)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3548611">for</span>&nbsp;<span class="builtinfunc" id="3548615">len</span><span class="op" id="3548618">(</span><span class="ident" id="3548619">q</span><span class="op" id="3548620">)</span>&nbsp;<span class="op" id="3548622">&gt;</span>&nbsp;<span class="num" id="3548624">0</span>&nbsp;<span class="op" id="3548626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3548631">//&nbsp;extract&nbsp;least&nbsp;significant,&nbsp;base&nbsp;bb&nbsp;&#34;digit&#34;</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3548680">q</span><span class="op" id="3548681">,</span>&nbsp;<span class="ident" id="3548683">r</span>&nbsp;<span class="op" id="3548685">=</span>&nbsp;<span class="ident" id="3548687">q</span><span class="op" id="3548688">.</span><span class="ident" id="3548689">divW</span><span class="op" id="3548693">(</span><span class="ident" id="3548694">q</span><span class="op" id="3548695">,</span>&nbsp;<span class="ident" id="3548697">bb</span><span class="op" id="3548699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3548704">for</span>&nbsp;<span class="ident" id="3548708">j</span>&nbsp;<span class="op" id="3548710">:=</span>&nbsp;<span class="num" id="3548713">0</span><span class="op" id="3548714">;</span>&nbsp;<span class="ident" id="3548716">j</span>&nbsp;<span class="op" id="3548718">&lt;</span>&nbsp;<span class="ident" id="3548720">ndigits</span>&nbsp;<span class="op" id="3548728">&amp;&amp;</span>&nbsp;<span class="ident" id="3548731">i</span>&nbsp;<span class="op" id="3548733">&gt;</span>&nbsp;<span class="num" id="3548735">0</span><span class="op" id="3548736">;</span>&nbsp;<span class="ident" id="3548738">j</span><span class="op" id="3548739">++</span>&nbsp;<span class="op" id="3548742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3548748">i</span><span class="op" id="3548749">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3548756">//&nbsp;avoid&nbsp;%&nbsp;computation&nbsp;since&nbsp;r%10&nbsp;==&nbsp;r&nbsp;-&nbsp;int(r/10)*10;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3548815">//&nbsp;this&nbsp;appears&nbsp;to&nbsp;be&nbsp;faster&nbsp;for&nbsp;BenchmarkString10000Base10</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3548879">//&nbsp;and&nbsp;smaller&nbsp;strings&nbsp;(but&nbsp;a&nbsp;bit&nbsp;slower&nbsp;for&nbsp;larger&nbsp;ones)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3548941">t</span>&nbsp;<span class="op" id="3548943">:=</span>&nbsp;<span class="ident" id="3548946">r</span>&nbsp;<span class="op" id="3548948">/</span>&nbsp;<span class="num" id="3548950">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3548957">s</span><span class="op" id="3548958">[</span><span class="ident" id="3548959">i</span><span class="op" id="3548960">]</span>&nbsp;<span class="op" id="3548962">=</span>&nbsp;<span class="ident" id="3548964">charset</span><span class="op" id="3548971">[</span><span class="ident" id="3548972">r</span><span class="op" id="3548973">-</span><span class="ident" id="3548974">t</span><span class="op" id="3548975">&lt;&lt;</span><span class="num" id="3548977">3</span><span class="op" id="3548978">-</span><span class="ident" id="3548979">t</span><span class="op" id="3548980">-</span><span class="ident" id="3548981">t</span><span class="op" id="3548982">]</span>&nbsp;<span class="comment" id="3548984">//&nbsp;TODO(gri)&nbsp;replace&nbsp;w/&nbsp;t*10&nbsp;once&nbsp;compiler&nbsp;produces&nbsp;better&nbsp;code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549052">r</span>&nbsp;<span class="op" id="3549054">=</span>&nbsp;<span class="ident" id="3549056">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3549061">}</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3549065">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3549068">}</span>&nbsp;<span class="keyword" id="3549070">else</span>&nbsp;<span class="op" id="3549075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3549079">for</span>&nbsp;<span class="builtinfunc" id="3549083">len</span><span class="op" id="3549086">(</span><span class="ident" id="3549087">q</span><span class="op" id="3549088">)</span>&nbsp;<span class="op" id="3549090">&gt;</span>&nbsp;<span class="num" id="3549092">0</span>&nbsp;<span class="op" id="3549094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3549099">//&nbsp;extract&nbsp;least&nbsp;significant,&nbsp;base&nbsp;bb&nbsp;&#34;digit&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549148">q</span><span class="op" id="3549149">,</span>&nbsp;<span class="ident" id="3549151">r</span>&nbsp;<span class="op" id="3549153">=</span>&nbsp;<span class="ident" id="3549155">q</span><span class="op" id="3549156">.</span><span class="ident" id="3549157">divW</span><span class="op" id="3549161">(</span><span class="ident" id="3549162">q</span><span class="op" id="3549163">,</span>&nbsp;<span class="ident" id="3549165">bb</span><span class="op" id="3549167">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3549172">for</span>&nbsp;<span class="ident" id="3549176">j</span>&nbsp;<span class="op" id="3549178">:=</span>&nbsp;<span class="num" id="3549181">0</span><span class="op" id="3549182">;</span>&nbsp;<span class="ident" id="3549184">j</span>&nbsp;<span class="op" id="3549186">&lt;</span>&nbsp;<span class="ident" id="3549188">ndigits</span>&nbsp;<span class="op" id="3549196">&amp;&amp;</span>&nbsp;<span class="ident" id="3549199">i</span>&nbsp;<span class="op" id="3549201">&gt;</span>&nbsp;<span class="num" id="3549203">0</span><span class="op" id="3549204">;</span>&nbsp;<span class="ident" id="3549206">j</span><span class="op" id="3549207">++</span>&nbsp;<span class="op" id="3549210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549216">i</span><span class="op" id="3549217">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549224">s</span><span class="op" id="3549225">[</span><span class="ident" id="3549226">i</span><span class="op" id="3549227">]</span>&nbsp;<span class="op" id="3549229">=</span>&nbsp;<span class="ident" id="3549231">charset</span><span class="op" id="3549238">[</span><span class="ident" id="3549239">r</span><span class="op" id="3549240">%</span><span class="ident" id="3549241">b</span><span class="op" id="3549242">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549248">r</span>&nbsp;<span class="op" id="3549250">/=</span>&nbsp;<span class="ident" id="3549253">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3549258">}</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3549262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3549265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3549269">//&nbsp;prepend&nbsp;high-order&nbsp;zeroes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549299">zero</span>&nbsp;<span class="op" id="3549304">:=</span>&nbsp;<span class="ident" id="3549307">charset</span><span class="op" id="3549314">[</span><span class="num" id="3549315">0</span><span class="op" id="3549316">]</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3549319">for</span>&nbsp;<span class="ident" id="3549323">i</span>&nbsp;<span class="op" id="3549325">&gt;</span>&nbsp;<span class="num" id="3549327">0</span>&nbsp;<span class="op" id="3549329">{</span>&nbsp;<span class="comment" id="3549331">//&nbsp;while&nbsp;need&nbsp;more&nbsp;leading&nbsp;zeroes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549367">i</span><span class="op" id="3549368">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549373">s</span><span class="op" id="3549374">[</span><span class="ident" id="3549375">i</span><span class="op" id="3549376">]</span>&nbsp;<span class="op" id="3549378">=</span>&nbsp;<span class="ident" id="3549380">zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3549386">}</span><br>
<span class="lineno"></span><span class="op" id="3549388">}</span><br>
<span class="lineno">910</span><br>
<span class="lineno"></span><span class="comment" id="3549391">//&nbsp;Split&nbsp;blocks&nbsp;greater&nbsp;than&nbsp;leafSize&nbsp;Words&nbsp;(or&nbsp;set&nbsp;to&nbsp;0&nbsp;to&nbsp;disable&nbsp;recursive&nbsp;conversion)</span><br>
<span class="lineno"></span><span class="comment" id="3549481">//&nbsp;Benchmark&nbsp;and&nbsp;configure&nbsp;leafSize&nbsp;using:&nbsp;go&nbsp;test&nbsp;-bench=&#34;Leaf&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3549546">//&nbsp;&nbsp;&nbsp;8&nbsp;and&nbsp;16&nbsp;effective&nbsp;on&nbsp;3.0&nbsp;GHz&nbsp;Xeon&nbsp;&#34;Clovertown&#34;&nbsp;CPU&nbsp;(128&nbsp;byte&nbsp;cache&nbsp;lines)</span><br>
<span class="lineno"></span><span class="comment" id="3549626">//&nbsp;&nbsp;&nbsp;8&nbsp;and&nbsp;16&nbsp;effective&nbsp;on&nbsp;2.66&nbsp;GHz&nbsp;Core&nbsp;2&nbsp;Duo&nbsp;&#34;Penryn&#34;&nbsp;CPU</span><br>
<span class="lineno">915</span><span class="keyword" id="3549686">var</span>&nbsp;<span class="ident" id="3549690">leafSize</span>&nbsp;<span class="builtintype" id="3549699">int</span>&nbsp;<span class="op" id="3549703">=</span>&nbsp;<span class="num" id="3549705">8</span>&nbsp;<span class="comment" id="3549707">//&nbsp;number&nbsp;of&nbsp;Word-size&nbsp;binary&nbsp;values&nbsp;treat&nbsp;as&nbsp;a&nbsp;monolithic&nbsp;block</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3549773">type</span>&nbsp;<span class="ident" id="3549778">divisor</span>&nbsp;<span class="keyword" id="3549786">struct</span>&nbsp;<span class="op" id="3549793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549796">bbb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3549804">nat</span>&nbsp;<span class="comment" id="3549808">//&nbsp;divisor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549820">nbits</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3549828">int</span>&nbsp;<span class="comment" id="3549832">//&nbsp;bit&nbsp;length&nbsp;of&nbsp;divisor&nbsp;(discounting&nbsp;leading&nbsp;zeroes)&nbsp;~=&nbsp;log2(bbb)</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549900">ndigits</span>&nbsp;<span class="builtintype" id="3549908">int</span>&nbsp;<span class="comment" id="3549912">//&nbsp;digit&nbsp;length&nbsp;of&nbsp;divisor&nbsp;in&nbsp;terms&nbsp;of&nbsp;output&nbsp;base&nbsp;digits</span><br>
<span class="lineno"></span><span class="op" id="3549970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3549973">var</span>&nbsp;<span class="ident" id="3549977">cacheBase10</span>&nbsp;<span class="keyword" id="3549989">struct</span>&nbsp;<span class="op" id="3549996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3549999">sync</span><span class="op" id="3550003">.</span><span class="ident" id="3550004">Mutex</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550011">table</span>&nbsp;<span class="op" id="3550017">[</span><span class="num" id="3550018">64</span><span class="op" id="3550020">]</span><span class="ident" id="3550021">divisor</span>&nbsp;<span class="comment" id="3550029">//&nbsp;cached&nbsp;divisors&nbsp;for&nbsp;base&nbsp;10</span><br>
<span class="lineno"></span><span class="op" id="3550060">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3550063">//&nbsp;expWW&nbsp;computes&nbsp;x**y</span><br>
<span class="lineno"></span><span class="keyword" id="3550086">func</span>&nbsp;<span class="op" id="3550091">(</span><span class="ident" id="3550092">z</span>&nbsp;<span class="ident" id="3550094">nat</span><span class="op" id="3550097">)</span>&nbsp;<span class="ident" id="3550099">expWW</span><span class="op" id="3550104">(</span><span class="ident" id="3550105">x</span><span class="op" id="3550106">,</span>&nbsp;<span class="ident" id="3550108">y</span>&nbsp;<span class="ident" id="3550110">Word</span><span class="op" id="3550114">)</span>&nbsp;<span class="ident" id="3550116">nat</span>&nbsp;<span class="op" id="3550120">{</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550123">return</span>&nbsp;<span class="ident" id="3550130">z</span><span class="op" id="3550131">.</span><span class="ident" id="3550132">expNN</span><span class="op" id="3550137">(</span><span class="ident" id="3550138">nat</span><span class="op" id="3550141">(</span><span class="ident" id="3550142">nil</span><span class="op" id="3550145">)</span><span class="op" id="3550146">.</span><span class="ident" id="3550147">setWord</span><span class="op" id="3550154">(</span><span class="ident" id="3550155">x</span><span class="op" id="3550156">)</span><span class="op" id="3550157">,</span>&nbsp;<span class="ident" id="3550159">nat</span><span class="op" id="3550162">(</span><span class="ident" id="3550163">nil</span><span class="op" id="3550166">)</span><span class="op" id="3550167">.</span><span class="ident" id="3550168">setWord</span><span class="op" id="3550175">(</span><span class="ident" id="3550176">y</span><span class="op" id="3550177">)</span><span class="op" id="3550178">,</span>&nbsp;<span class="ident" id="3550180">nil</span><span class="op" id="3550183">)</span><br>
<span class="lineno"></span><span class="op" id="3550185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3550188">//&nbsp;construct&nbsp;table&nbsp;of&nbsp;powers&nbsp;of&nbsp;bb*leafSize&nbsp;to&nbsp;use&nbsp;in&nbsp;subdivisions</span><br>
<span class="lineno"></span><span class="keyword" id="3550255">func</span>&nbsp;<span class="ident" id="3550260">divisors</span><span class="op" id="3550268">(</span><span class="ident" id="3550269">m</span>&nbsp;<span class="builtintype" id="3550271">int</span><span class="op" id="3550274">,</span>&nbsp;<span class="ident" id="3550276">b</span>&nbsp;<span class="ident" id="3550278">Word</span><span class="op" id="3550282">,</span>&nbsp;<span class="ident" id="3550284">ndigits</span>&nbsp;<span class="builtintype" id="3550292">int</span><span class="op" id="3550295">,</span>&nbsp;<span class="ident" id="3550297">bb</span>&nbsp;<span class="ident" id="3550300">Word</span><span class="op" id="3550304">)</span>&nbsp;<span class="op" id="3550306">[</span><span class="op" id="3550307">]</span><span class="ident" id="3550308">divisor</span>&nbsp;<span class="op" id="3550316">{</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3550319">//&nbsp;only&nbsp;compute&nbsp;table&nbsp;when&nbsp;recursive&nbsp;conversion&nbsp;is&nbsp;enabled&nbsp;and&nbsp;x&nbsp;is&nbsp;large</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550394">if</span>&nbsp;<span class="ident" id="3550397">leafSize</span>&nbsp;<span class="op" id="3550406">==</span>&nbsp;<span class="num" id="3550409">0</span>&nbsp;<span class="op" id="3550411">||</span>&nbsp;<span class="ident" id="3550414">m</span>&nbsp;<span class="op" id="3550416">&lt;=</span>&nbsp;<span class="ident" id="3550419">leafSize</span>&nbsp;<span class="op" id="3550428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550432">return</span>&nbsp;<span class="ident" id="3550439">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3550448">//&nbsp;determine&nbsp;k&nbsp;where&nbsp;(bb**leafSize)**(2**k)&nbsp;&gt;=&nbsp;sqrt(x)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550504">k</span>&nbsp;<span class="op" id="3550506">:=</span>&nbsp;<span class="num" id="3550509">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550512">for</span>&nbsp;<span class="ident" id="3550516">words</span>&nbsp;<span class="op" id="3550522">:=</span>&nbsp;<span class="ident" id="3550525">leafSize</span><span class="op" id="3550533">;</span>&nbsp;<span class="ident" id="3550535">words</span>&nbsp;<span class="op" id="3550541">&lt;</span>&nbsp;<span class="ident" id="3550543">m</span><span class="op" id="3550544">&gt;&gt;</span><span class="num" id="3550546">1</span>&nbsp;<span class="op" id="3550548">&amp;&amp;</span>&nbsp;<span class="ident" id="3550551">k</span>&nbsp;<span class="op" id="3550553">&lt;</span>&nbsp;<span class="builtinfunc" id="3550555">len</span><span class="op" id="3550558">(</span><span class="ident" id="3550559">cacheBase10</span><span class="op" id="3550570">.</span><span class="ident" id="3550571">table</span><span class="op" id="3550576">)</span><span class="op" id="3550577">;</span>&nbsp;<span class="ident" id="3550579">words</span>&nbsp;<span class="op" id="3550585">&lt;&lt;=</span>&nbsp;<span class="num" id="3550589">1</span>&nbsp;<span class="op" id="3550591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550595">k</span><span class="op" id="3550596">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550600">}</span><br>
<span class="lineno">945</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3550604">//&nbsp;reuse&nbsp;and&nbsp;extend&nbsp;existing&nbsp;table&nbsp;of&nbsp;divisors&nbsp;or&nbsp;create&nbsp;new&nbsp;table&nbsp;as&nbsp;appropriate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550687">var</span>&nbsp;<span class="ident" id="3550691">table</span>&nbsp;<span class="op" id="3550697">[</span><span class="op" id="3550698">]</span><span class="ident" id="3550699">divisor</span>&nbsp;<span class="comment" id="3550707">//&nbsp;for&nbsp;b&nbsp;==&nbsp;10,&nbsp;table&nbsp;overlaps&nbsp;with&nbsp;cacheBase10.table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550762">if</span>&nbsp;<span class="ident" id="3550765">b</span>&nbsp;<span class="op" id="3550767">==</span>&nbsp;<span class="num" id="3550770">10</span>&nbsp;<span class="op" id="3550773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550777">cacheBase10</span><span class="op" id="3550788">.</span><span class="ident" id="3550789">Lock</span><span class="op" id="3550793">(</span><span class="op" id="3550794">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550798">table</span>&nbsp;<span class="op" id="3550804">=</span>&nbsp;<span class="ident" id="3550806">cacheBase10</span><span class="op" id="3550817">.</span><span class="ident" id="3550818">table</span><span class="op" id="3550823">[</span><span class="num" id="3550824">0</span><span class="op" id="3550825">:</span><span class="ident" id="3550826">k</span><span class="op" id="3550827">]</span>&nbsp;<span class="comment" id="3550829">//&nbsp;reuse&nbsp;old&nbsp;table&nbsp;for&nbsp;this&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550869">}</span>&nbsp;<span class="keyword" id="3550871">else</span>&nbsp;<span class="op" id="3550876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3550880">table</span>&nbsp;<span class="op" id="3550886">=</span>&nbsp;<span class="builtinfunc" id="3550888">make</span><span class="op" id="3550892">(</span><span class="op" id="3550893">[</span><span class="op" id="3550894">]</span><span class="ident" id="3550895">divisor</span><span class="op" id="3550902">,</span>&nbsp;<span class="ident" id="3550904">k</span><span class="op" id="3550905">)</span>&nbsp;<span class="comment" id="3550907">//&nbsp;create&nbsp;new&nbsp;table&nbsp;for&nbsp;this&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3550948">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3550952">//&nbsp;extend&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3550969">if</span>&nbsp;<span class="ident" id="3550972">table</span><span class="op" id="3550977">[</span><span class="ident" id="3550978">k</span><span class="op" id="3550979">-</span><span class="num" id="3550980">1</span><span class="op" id="3550981">]</span><span class="op" id="3550982">.</span><span class="ident" id="3550983">ndigits</span>&nbsp;<span class="op" id="3550991">==</span>&nbsp;<span class="num" id="3550994">0</span>&nbsp;<span class="op" id="3550996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3551000">//&nbsp;add&nbsp;new&nbsp;entries&nbsp;as&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551031">var</span>&nbsp;<span class="ident" id="3551035">larger</span>&nbsp;<span class="ident" id="3551042">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551048">for</span>&nbsp;<span class="ident" id="3551052">i</span>&nbsp;<span class="op" id="3551054">:=</span>&nbsp;<span class="num" id="3551057">0</span><span class="op" id="3551058">;</span>&nbsp;<span class="ident" id="3551060">i</span>&nbsp;<span class="op" id="3551062">&lt;</span>&nbsp;<span class="ident" id="3551064">k</span><span class="op" id="3551065">;</span>&nbsp;<span class="ident" id="3551067">i</span><span class="op" id="3551068">++</span>&nbsp;<span class="op" id="3551071">{</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551076">if</span>&nbsp;<span class="ident" id="3551079">table</span><span class="op" id="3551084">[</span><span class="ident" id="3551085">i</span><span class="op" id="3551086">]</span><span class="op" id="3551087">.</span><span class="ident" id="3551088">ndigits</span>&nbsp;<span class="op" id="3551096">==</span>&nbsp;<span class="num" id="3551099">0</span>&nbsp;<span class="op" id="3551101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551107">if</span>&nbsp;<span class="ident" id="3551110">i</span>&nbsp;<span class="op" id="3551112">==</span>&nbsp;<span class="num" id="3551115">0</span>&nbsp;<span class="op" id="3551117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551124">table</span><span class="op" id="3551129">[</span><span class="num" id="3551130">0</span><span class="op" id="3551131">]</span><span class="op" id="3551132">.</span><span class="ident" id="3551133">bbb</span>&nbsp;<span class="op" id="3551137">=</span>&nbsp;<span class="ident" id="3551139">nat</span><span class="op" id="3551142">(</span><span class="ident" id="3551143">nil</span><span class="op" id="3551146">)</span><span class="op" id="3551147">.</span><span class="ident" id="3551148">expWW</span><span class="op" id="3551153">(</span><span class="ident" id="3551154">bb</span><span class="op" id="3551156">,</span>&nbsp;<span class="ident" id="3551158">Word</span><span class="op" id="3551162">(</span><span class="ident" id="3551163">leafSize</span><span class="op" id="3551171">)</span><span class="op" id="3551172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551179">table</span><span class="op" id="3551184">[</span><span class="num" id="3551185">0</span><span class="op" id="3551186">]</span><span class="op" id="3551187">.</span><span class="ident" id="3551188">ndigits</span>&nbsp;<span class="op" id="3551196">=</span>&nbsp;<span class="ident" id="3551198">ndigits</span>&nbsp;<span class="op" id="3551206">*</span>&nbsp;<span class="ident" id="3551208">leafSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3551221">}</span>&nbsp;<span class="keyword" id="3551223">else</span>&nbsp;<span class="op" id="3551228">{</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551235">table</span><span class="op" id="3551240">[</span><span class="ident" id="3551241">i</span><span class="op" id="3551242">]</span><span class="op" id="3551243">.</span><span class="ident" id="3551244">bbb</span>&nbsp;<span class="op" id="3551248">=</span>&nbsp;<span class="ident" id="3551250">nat</span><span class="op" id="3551253">(</span><span class="ident" id="3551254">nil</span><span class="op" id="3551257">)</span><span class="op" id="3551258">.</span><span class="ident" id="3551259">mul</span><span class="op" id="3551262">(</span><span class="ident" id="3551263">table</span><span class="op" id="3551268">[</span><span class="ident" id="3551269">i</span><span class="op" id="3551270">-</span><span class="num" id="3551271">1</span><span class="op" id="3551272">]</span><span class="op" id="3551273">.</span><span class="ident" id="3551274">bbb</span><span class="op" id="3551277">,</span>&nbsp;<span class="ident" id="3551279">table</span><span class="op" id="3551284">[</span><span class="ident" id="3551285">i</span><span class="op" id="3551286">-</span><span class="num" id="3551287">1</span><span class="op" id="3551288">]</span><span class="op" id="3551289">.</span><span class="ident" id="3551290">bbb</span><span class="op" id="3551293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551300">table</span><span class="op" id="3551305">[</span><span class="ident" id="3551306">i</span><span class="op" id="3551307">]</span><span class="op" id="3551308">.</span><span class="ident" id="3551309">ndigits</span>&nbsp;<span class="op" id="3551317">=</span>&nbsp;<span class="num" id="3551319">2</span>&nbsp;<span class="op" id="3551321">*</span>&nbsp;<span class="ident" id="3551323">table</span><span class="op" id="3551328">[</span><span class="ident" id="3551329">i</span><span class="op" id="3551330">-</span><span class="num" id="3551331">1</span><span class="op" id="3551332">]</span><span class="op" id="3551333">.</span><span class="ident" id="3551334">ndigits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3551346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3551353">//&nbsp;optimization:&nbsp;exploit&nbsp;aggregated&nbsp;extra&nbsp;bits&nbsp;in&nbsp;macro&nbsp;blocks</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551420">larger</span>&nbsp;<span class="op" id="3551427">=</span>&nbsp;<span class="ident" id="3551429">nat</span><span class="op" id="3551432">(</span><span class="ident" id="3551433">nil</span><span class="op" id="3551436">)</span><span class="op" id="3551437">.</span><span class="ident" id="3551438">set</span><span class="op" id="3551441">(</span><span class="ident" id="3551442">table</span><span class="op" id="3551447">[</span><span class="ident" id="3551448">i</span><span class="op" id="3551449">]</span><span class="op" id="3551450">.</span><span class="ident" id="3551451">bbb</span><span class="op" id="3551454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551460">for</span>&nbsp;<span class="ident" id="3551464">mulAddVWW</span><span class="op" id="3551473">(</span><span class="ident" id="3551474">larger</span><span class="op" id="3551480">,</span>&nbsp;<span class="ident" id="3551482">larger</span><span class="op" id="3551488">,</span>&nbsp;<span class="ident" id="3551490">b</span><span class="op" id="3551491">,</span>&nbsp;<span class="num" id="3551493">0</span><span class="op" id="3551494">)</span>&nbsp;<span class="op" id="3551496">==</span>&nbsp;<span class="num" id="3551499">0</span>&nbsp;<span class="op" id="3551501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551508">table</span><span class="op" id="3551513">[</span><span class="ident" id="3551514">i</span><span class="op" id="3551515">]</span><span class="op" id="3551516">.</span><span class="ident" id="3551517">bbb</span>&nbsp;<span class="op" id="3551521">=</span>&nbsp;<span class="ident" id="3551523">table</span><span class="op" id="3551528">[</span><span class="ident" id="3551529">i</span><span class="op" id="3551530">]</span><span class="op" id="3551531">.</span><span class="ident" id="3551532">bbb</span><span class="op" id="3551535">.</span><span class="ident" id="3551536">set</span><span class="op" id="3551539">(</span><span class="ident" id="3551540">larger</span><span class="op" id="3551546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551553">table</span><span class="op" id="3551558">[</span><span class="ident" id="3551559">i</span><span class="op" id="3551560">]</span><span class="op" id="3551561">.</span><span class="ident" id="3551562">ndigits</span><span class="op" id="3551569">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3551576">}</span><br>
<span class="lineno">975</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551583">table</span><span class="op" id="3551588">[</span><span class="ident" id="3551589">i</span><span class="op" id="3551590">]</span><span class="op" id="3551591">.</span><span class="ident" id="3551592">nbits</span>&nbsp;<span class="op" id="3551598">=</span>&nbsp;<span class="ident" id="3551600">table</span><span class="op" id="3551605">[</span><span class="ident" id="3551606">i</span><span class="op" id="3551607">]</span><span class="op" id="3551608">.</span><span class="ident" id="3551609">bbb</span><span class="op" id="3551612">.</span><span class="ident" id="3551613">bitLen</span><span class="op" id="3551619">(</span><span class="op" id="3551620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3551625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3551629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3551632">}</span><br>
<span class="lineno">980</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551636">if</span>&nbsp;<span class="ident" id="3551639">b</span>&nbsp;<span class="op" id="3551641">==</span>&nbsp;<span class="num" id="3551644">10</span>&nbsp;<span class="op" id="3551647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3551651">cacheBase10</span><span class="op" id="3551662">.</span><span class="ident" id="3551663">Unlock</span><span class="op" id="3551669">(</span><span class="op" id="3551670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3551673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3551677">return</span>&nbsp;<span class="ident" id="3551684">table</span><br>
<span class="lineno"></span><span class="op" id="3551690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3551693">const</span>&nbsp;<span class="ident" id="3551699">deBruijn32</span>&nbsp;<span class="op" id="3551710">=</span>&nbsp;<span class="num" id="3551712">0x077CB531</span><br>
<span class="lineno"></span><br>
<span class="lineno">990</span><span class="keyword" id="3551724">var</span>&nbsp;<span class="ident" id="3551728">deBruijn32Lookup</span>&nbsp;<span class="op" id="3551745">=</span>&nbsp;<span class="op" id="3551747">[</span><span class="op" id="3551748">]</span><span class="builtintype" id="3551749">byte</span><span class="op" id="3551753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3551756">0</span><span class="op" id="3551757">,</span>&nbsp;<span class="num" id="3551759">1</span><span class="op" id="3551760">,</span>&nbsp;<span class="num" id="3551762">28</span><span class="op" id="3551764">,</span>&nbsp;<span class="num" id="3551766">2</span><span class="op" id="3551767">,</span>&nbsp;<span class="num" id="3551769">29</span><span class="op" id="3551771">,</span>&nbsp;<span class="num" id="3551773">14</span><span class="op" id="3551775">,</span>&nbsp;<span class="num" id="3551777">24</span><span class="op" id="3551779">,</span>&nbsp;<span class="num" id="3551781">3</span><span class="op" id="3551782">,</span>&nbsp;<span class="num" id="3551784">30</span><span class="op" id="3551786">,</span>&nbsp;<span class="num" id="3551788">22</span><span class="op" id="3551790">,</span>&nbsp;<span class="num" id="3551792">20</span><span class="op" id="3551794">,</span>&nbsp;<span class="num" id="3551796">15</span><span class="op" id="3551798">,</span>&nbsp;<span class="num" id="3551800">25</span><span class="op" id="3551802">,</span>&nbsp;<span class="num" id="3551804">17</span><span class="op" id="3551806">,</span>&nbsp;<span class="num" id="3551808">4</span><span class="op" id="3551809">,</span>&nbsp;<span class="num" id="3551811">8</span><span class="op" id="3551812">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3551815">31</span><span class="op" id="3551817">,</span>&nbsp;<span class="num" id="3551819">27</span><span class="op" id="3551821">,</span>&nbsp;<span class="num" id="3551823">13</span><span class="op" id="3551825">,</span>&nbsp;<span class="num" id="3551827">23</span><span class="op" id="3551829">,</span>&nbsp;<span class="num" id="3551831">21</span><span class="op" id="3551833">,</span>&nbsp;<span class="num" id="3551835">19</span><span class="op" id="3551837">,</span>&nbsp;<span class="num" id="3551839">16</span><span class="op" id="3551841">,</span>&nbsp;<span class="num" id="3551843">7</span><span class="op" id="3551844">,</span>&nbsp;<span class="num" id="3551846">26</span><span class="op" id="3551848">,</span>&nbsp;<span class="num" id="3551850">12</span><span class="op" id="3551852">,</span>&nbsp;<span class="num" id="3551854">18</span><span class="op" id="3551856">,</span>&nbsp;<span class="num" id="3551858">6</span><span class="op" id="3551859">,</span>&nbsp;<span class="num" id="3551861">11</span><span class="op" id="3551863">,</span>&nbsp;<span class="num" id="3551865">5</span><span class="op" id="3551866">,</span>&nbsp;<span class="num" id="3551868">10</span><span class="op" id="3551870">,</span>&nbsp;<span class="num" id="3551872">9</span><span class="op" id="3551873">,</span><br>
<span class="lineno"></span><span class="op" id="3551875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">995</span><span class="keyword" id="3551878">const</span>&nbsp;<span class="ident" id="3551884">deBruijn64</span>&nbsp;<span class="op" id="3551895">=</span>&nbsp;<span class="num" id="3551897">0x03f79d71b4ca8b09</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3551917">var</span>&nbsp;<span class="ident" id="3551921">deBruijn64Lookup</span>&nbsp;<span class="op" id="3551938">=</span>&nbsp;<span class="op" id="3551940">[</span><span class="op" id="3551941">]</span><span class="builtintype" id="3551942">byte</span><span class="op" id="3551946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3551949">0</span><span class="op" id="3551950">,</span>&nbsp;<span class="num" id="3551952">1</span><span class="op" id="3551953">,</span>&nbsp;<span class="num" id="3551955">56</span><span class="op" id="3551957">,</span>&nbsp;<span class="num" id="3551959">2</span><span class="op" id="3551960">,</span>&nbsp;<span class="num" id="3551962">57</span><span class="op" id="3551964">,</span>&nbsp;<span class="num" id="3551966">49</span><span class="op" id="3551968">,</span>&nbsp;<span class="num" id="3551970">28</span><span class="op" id="3551972">,</span>&nbsp;<span class="num" id="3551974">3</span><span class="op" id="3551975">,</span>&nbsp;<span class="num" id="3551977">61</span><span class="op" id="3551979">,</span>&nbsp;<span class="num" id="3551981">58</span><span class="op" id="3551983">,</span>&nbsp;<span class="num" id="3551985">42</span><span class="op" id="3551987">,</span>&nbsp;<span class="num" id="3551989">50</span><span class="op" id="3551991">,</span>&nbsp;<span class="num" id="3551993">38</span><span class="op" id="3551995">,</span>&nbsp;<span class="num" id="3551997">29</span><span class="op" id="3551999">,</span>&nbsp;<span class="num" id="3552001">17</span><span class="op" id="3552003">,</span>&nbsp;<span class="num" id="3552005">4</span><span class="op" id="3552006">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3552009">62</span><span class="op" id="3552011">,</span>&nbsp;<span class="num" id="3552013">47</span><span class="op" id="3552015">,</span>&nbsp;<span class="num" id="3552017">59</span><span class="op" id="3552019">,</span>&nbsp;<span class="num" id="3552021">36</span><span class="op" id="3552023">,</span>&nbsp;<span class="num" id="3552025">45</span><span class="op" id="3552027">,</span>&nbsp;<span class="num" id="3552029">43</span><span class="op" id="3552031">,</span>&nbsp;<span class="num" id="3552033">51</span><span class="op" id="3552035">,</span>&nbsp;<span class="num" id="3552037">22</span><span class="op" id="3552039">,</span>&nbsp;<span class="num" id="3552041">53</span><span class="op" id="3552043">,</span>&nbsp;<span class="num" id="3552045">39</span><span class="op" id="3552047">,</span>&nbsp;<span class="num" id="3552049">33</span><span class="op" id="3552051">,</span>&nbsp;<span class="num" id="3552053">30</span><span class="op" id="3552055">,</span>&nbsp;<span class="num" id="3552057">24</span><span class="op" id="3552059">,</span>&nbsp;<span class="num" id="3552061">18</span><span class="op" id="3552063">,</span>&nbsp;<span class="num" id="3552065">12</span><span class="op" id="3552067">,</span>&nbsp;<span class="num" id="3552069">5</span><span class="op" id="3552070">,</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3552073">63</span><span class="op" id="3552075">,</span>&nbsp;<span class="num" id="3552077">55</span><span class="op" id="3552079">,</span>&nbsp;<span class="num" id="3552081">48</span><span class="op" id="3552083">,</span>&nbsp;<span class="num" id="3552085">27</span><span class="op" id="3552087">,</span>&nbsp;<span class="num" id="3552089">60</span><span class="op" id="3552091">,</span>&nbsp;<span class="num" id="3552093">41</span><span class="op" id="3552095">,</span>&nbsp;<span class="num" id="3552097">37</span><span class="op" id="3552099">,</span>&nbsp;<span class="num" id="3552101">16</span><span class="op" id="3552103">,</span>&nbsp;<span class="num" id="3552105">46</span><span class="op" id="3552107">,</span>&nbsp;<span class="num" id="3552109">35</span><span class="op" id="3552111">,</span>&nbsp;<span class="num" id="3552113">44</span><span class="op" id="3552115">,</span>&nbsp;<span class="num" id="3552117">21</span><span class="op" id="3552119">,</span>&nbsp;<span class="num" id="3552121">52</span><span class="op" id="3552123">,</span>&nbsp;<span class="num" id="3552125">32</span><span class="op" id="3552127">,</span>&nbsp;<span class="num" id="3552129">23</span><span class="op" id="3552131">,</span>&nbsp;<span class="num" id="3552133">11</span><span class="op" id="3552135">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="3552138">54</span><span class="op" id="3552140">,</span>&nbsp;<span class="num" id="3552142">26</span><span class="op" id="3552144">,</span>&nbsp;<span class="num" id="3552146">40</span><span class="op" id="3552148">,</span>&nbsp;<span class="num" id="3552150">15</span><span class="op" id="3552152">,</span>&nbsp;<span class="num" id="3552154">34</span><span class="op" id="3552156">,</span>&nbsp;<span class="num" id="3552158">20</span><span class="op" id="3552160">,</span>&nbsp;<span class="num" id="3552162">31</span><span class="op" id="3552164">,</span>&nbsp;<span class="num" id="3552166">10</span><span class="op" id="3552168">,</span>&nbsp;<span class="num" id="3552170">25</span><span class="op" id="3552172">,</span>&nbsp;<span class="num" id="3552174">14</span><span class="op" id="3552176">,</span>&nbsp;<span class="num" id="3552178">19</span><span class="op" id="3552180">,</span>&nbsp;<span class="num" id="3552182">9</span><span class="op" id="3552183">,</span>&nbsp;<span class="num" id="3552185">13</span><span class="op" id="3552187">,</span>&nbsp;<span class="num" id="3552189">8</span><span class="op" id="3552190">,</span>&nbsp;<span class="num" id="3552192">7</span><span class="op" id="3552193">,</span>&nbsp;<span class="num" id="3552195">6</span><span class="op" id="3552196">,</span><br>
<span class="lineno"></span><span class="op" id="3552198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3552201">//&nbsp;trailingZeroBits&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;least&nbsp;significant&nbsp;zero</span><br>
<span class="lineno">1005</span><span class="comment" id="3552278">//&nbsp;bits&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3552292">func</span>&nbsp;<span class="ident" id="3552297">trailingZeroBits</span><span class="op" id="3552313">(</span><span class="ident" id="3552314">x</span>&nbsp;<span class="ident" id="3552316">Word</span><span class="op" id="3552320">)</span>&nbsp;<span class="builtintype" id="3552322">uint</span>&nbsp;<span class="op" id="3552327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3552330">//&nbsp;x&nbsp;&amp;&nbsp;-x&nbsp;leaves&nbsp;only&nbsp;the&nbsp;right-most&nbsp;bit&nbsp;set&nbsp;in&nbsp;the&nbsp;word.&nbsp;Let&nbsp;k&nbsp;be&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3552402">//&nbsp;index&nbsp;of&nbsp;that&nbsp;bit.&nbsp;Since&nbsp;only&nbsp;a&nbsp;single&nbsp;bit&nbsp;is&nbsp;set,&nbsp;the&nbsp;value&nbsp;is&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3552474">//&nbsp;to&nbsp;the&nbsp;power&nbsp;of&nbsp;k.&nbsp;Multiplying&nbsp;by&nbsp;a&nbsp;power&nbsp;of&nbsp;two&nbsp;is&nbsp;equivalent&nbsp;to</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3552544">//&nbsp;left&nbsp;shifting,&nbsp;in&nbsp;this&nbsp;case&nbsp;by&nbsp;k&nbsp;bits.&nbsp;&nbsp;The&nbsp;de&nbsp;Bruijn&nbsp;constant&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3552614">//&nbsp;such&nbsp;that&nbsp;all&nbsp;six&nbsp;bit,&nbsp;consecutive&nbsp;substrings&nbsp;are&nbsp;distinct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3552678">//&nbsp;Therefore,&nbsp;if&nbsp;we&nbsp;have&nbsp;a&nbsp;left&nbsp;shifted&nbsp;version&nbsp;of&nbsp;this&nbsp;constant&nbsp;we&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3552751">//&nbsp;find&nbsp;by&nbsp;how&nbsp;many&nbsp;bits&nbsp;it&nbsp;was&nbsp;shifted&nbsp;by&nbsp;looking&nbsp;at&nbsp;which&nbsp;six&nbsp;bit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3552820">//&nbsp;substring&nbsp;ended&nbsp;up&nbsp;at&nbsp;the&nbsp;top&nbsp;of&nbsp;the&nbsp;word.</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3552867">//&nbsp;(Knuth,&nbsp;volume&nbsp;4,&nbsp;section&nbsp;7.3.1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552904">switch</span>&nbsp;<span class="ident" id="3552911">_W</span>&nbsp;<span class="op" id="3552914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552917">case</span>&nbsp;<span class="num" id="3552922">32</span><span class="op" id="3552924">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552928">return</span>&nbsp;<span class="builtintype" id="3552935">uint</span><span class="op" id="3552939">(</span><span class="ident" id="3552940">deBruijn32Lookup</span><span class="op" id="3552956">[</span><span class="op" id="3552957">(</span><span class="op" id="3552958">(</span><span class="ident" id="3552959">x</span><span class="op" id="3552960">&amp;</span><span class="op" id="3552961">-</span><span class="ident" id="3552962">x</span><span class="op" id="3552963">)</span><span class="op" id="3552964">*</span><span class="ident" id="3552965">deBruijn32</span><span class="op" id="3552975">)</span><span class="op" id="3552976">&gt;&gt;</span><span class="num" id="3552978">27</span><span class="op" id="3552980">]</span><span class="op" id="3552981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552984">case</span>&nbsp;<span class="num" id="3552989">64</span><span class="op" id="3552991">:</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3552995">return</span>&nbsp;<span class="builtintype" id="3553002">uint</span><span class="op" id="3553006">(</span><span class="ident" id="3553007">deBruijn64Lookup</span><span class="op" id="3553023">[</span><span class="op" id="3553024">(</span><span class="op" id="3553025">(</span><span class="ident" id="3553026">x</span><span class="op" id="3553027">&amp;</span><span class="op" id="3553028">-</span><span class="ident" id="3553029">x</span><span class="op" id="3553030">)</span><span class="op" id="3553031">*</span><span class="op" id="3553032">(</span><span class="ident" id="3553033">deBruijn64</span><span class="op" id="3553043">&amp;</span><span class="ident" id="3553044">_M</span><span class="op" id="3553046">)</span><span class="op" id="3553047">)</span><span class="op" id="3553048">&gt;&gt;</span><span class="num" id="3553050">58</span><span class="op" id="3553052">]</span><span class="op" id="3553053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553056">default</span><span class="op" id="3553063">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3553067">panic</span><span class="op" id="3553072">(</span><span class="string" id="3553073">&#34;unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="3553092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3553095">}</span><br>
<span class="lineno"></span><span class="op" id="3553097">}</span><br>
<span class="lineno">1025</span><br>
<span class="lineno"></span><span class="comment" id="3553100">//&nbsp;trailingZeroBits&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;consecutive&nbsp;least&nbsp;significant&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="3553177">//&nbsp;bits&nbsp;of&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="3553191">func</span>&nbsp;<span class="op" id="3553196">(</span><span class="ident" id="3553197">x</span>&nbsp;<span class="ident" id="3553199">nat</span><span class="op" id="3553202">)</span>&nbsp;<span class="ident" id="3553204">trailingZeroBits</span><span class="op" id="3553220">(</span><span class="op" id="3553221">)</span>&nbsp;<span class="builtintype" id="3553223">uint</span>&nbsp;<span class="op" id="3553228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553231">if</span>&nbsp;<span class="builtinfunc" id="3553234">len</span><span class="op" id="3553237">(</span><span class="ident" id="3553238">x</span><span class="op" id="3553239">)</span>&nbsp;<span class="op" id="3553241">==</span>&nbsp;<span class="num" id="3553244">0</span>&nbsp;<span class="op" id="3553246">{</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553250">return</span>&nbsp;<span class="num" id="3553257">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3553260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553263">var</span>&nbsp;<span class="ident" id="3553267">i</span>&nbsp;<span class="builtintype" id="3553269">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553275">for</span>&nbsp;<span class="ident" id="3553279">x</span><span class="op" id="3553280">[</span><span class="ident" id="3553281">i</span><span class="op" id="3553282">]</span>&nbsp;<span class="op" id="3553284">==</span>&nbsp;<span class="num" id="3553287">0</span>&nbsp;<span class="op" id="3553289">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553293">i</span><span class="op" id="3553294">++</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3553298">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3553301">//&nbsp;x[i]&nbsp;!=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553315">return</span>&nbsp;<span class="ident" id="3553322">i</span><span class="op" id="3553323">*</span><span class="ident" id="3553324">_W</span>&nbsp;<span class="op" id="3553327">+</span>&nbsp;<span class="ident" id="3553329">trailingZeroBits</span><span class="op" id="3553345">(</span><span class="ident" id="3553346">x</span><span class="op" id="3553347">[</span><span class="ident" id="3553348">i</span><span class="op" id="3553349">]</span><span class="op" id="3553350">)</span><br>
<span class="lineno"></span><span class="op" id="3553352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1040</span><span class="comment" id="3553355">//&nbsp;z&nbsp;=&nbsp;x&nbsp;&lt;&lt;&nbsp;s</span><br>
<span class="lineno"></span><span class="keyword" id="3553369">func</span>&nbsp;<span class="op" id="3553374">(</span><span class="ident" id="3553375">z</span>&nbsp;<span class="ident" id="3553377">nat</span><span class="op" id="3553380">)</span>&nbsp;<span class="ident" id="3553382">shl</span><span class="op" id="3553385">(</span><span class="ident" id="3553386">x</span>&nbsp;<span class="ident" id="3553388">nat</span><span class="op" id="3553391">,</span>&nbsp;<span class="ident" id="3553393">s</span>&nbsp;<span class="builtintype" id="3553395">uint</span><span class="op" id="3553399">)</span>&nbsp;<span class="ident" id="3553401">nat</span>&nbsp;<span class="op" id="3553405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553408">m</span>&nbsp;<span class="op" id="3553410">:=</span>&nbsp;<span class="builtinfunc" id="3553413">len</span><span class="op" id="3553416">(</span><span class="ident" id="3553417">x</span><span class="op" id="3553418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553421">if</span>&nbsp;<span class="ident" id="3553424">m</span>&nbsp;<span class="op" id="3553426">==</span>&nbsp;<span class="num" id="3553429">0</span>&nbsp;<span class="op" id="3553431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553435">return</span>&nbsp;<span class="ident" id="3553442">z</span><span class="op" id="3553443">.</span><span class="builtinfunc" id="3553444">make</span><span class="op" id="3553448">(</span><span class="num" id="3553449">0</span><span class="op" id="3553450">)</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3553453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3553456">//&nbsp;m&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553467">n</span>&nbsp;<span class="op" id="3553469">:=</span>&nbsp;<span class="ident" id="3553472">m</span>&nbsp;<span class="op" id="3553474">+</span>&nbsp;<span class="builtintype" id="3553476">int</span><span class="op" id="3553479">(</span><span class="ident" id="3553480">s</span><span class="op" id="3553481">/</span><span class="ident" id="3553482">_W</span><span class="op" id="3553484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553487">z</span>&nbsp;<span class="op" id="3553489">=</span>&nbsp;<span class="ident" id="3553491">z</span><span class="op" id="3553492">.</span><span class="builtinfunc" id="3553493">make</span><span class="op" id="3553497">(</span><span class="ident" id="3553498">n</span>&nbsp;<span class="op" id="3553500">+</span>&nbsp;<span class="num" id="3553502">1</span><span class="op" id="3553503">)</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553506">z</span><span class="op" id="3553507">[</span><span class="ident" id="3553508">n</span><span class="op" id="3553509">]</span>&nbsp;<span class="op" id="3553511">=</span>&nbsp;<span class="ident" id="3553513">shlVU</span><span class="op" id="3553518">(</span><span class="ident" id="3553519">z</span><span class="op" id="3553520">[</span><span class="ident" id="3553521">n</span><span class="op" id="3553522">-</span><span class="ident" id="3553523">m</span><span class="op" id="3553524">:</span><span class="ident" id="3553525">n</span><span class="op" id="3553526">]</span><span class="op" id="3553527">,</span>&nbsp;<span class="ident" id="3553529">x</span><span class="op" id="3553530">,</span>&nbsp;<span class="ident" id="3553532">s</span><span class="op" id="3553533">%</span><span class="ident" id="3553534">_W</span><span class="op" id="3553536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553539">z</span><span class="op" id="3553540">[</span><span class="num" id="3553541">0</span>&nbsp;<span class="op" id="3553543">:</span>&nbsp;<span class="ident" id="3553545">n</span><span class="op" id="3553546">-</span><span class="ident" id="3553547">m</span><span class="op" id="3553548">]</span><span class="op" id="3553549">.</span><span class="ident" id="3553550">clear</span><span class="op" id="3553555">(</span><span class="op" id="3553556">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553560">return</span>&nbsp;<span class="ident" id="3553567">z</span><span class="op" id="3553568">.</span><span class="ident" id="3553569">norm</span><span class="op" id="3553573">(</span><span class="op" id="3553574">)</span><br>
<span class="lineno"></span><span class="op" id="3553576">}</span><br>
<span class="lineno">1055</span><br>
<span class="lineno"></span><span class="comment" id="3553579">//&nbsp;z&nbsp;=&nbsp;x&nbsp;&gt;&gt;&nbsp;s</span><br>
<span class="lineno"></span><span class="keyword" id="3553593">func</span>&nbsp;<span class="op" id="3553598">(</span><span class="ident" id="3553599">z</span>&nbsp;<span class="ident" id="3553601">nat</span><span class="op" id="3553604">)</span>&nbsp;<span class="ident" id="3553606">shr</span><span class="op" id="3553609">(</span><span class="ident" id="3553610">x</span>&nbsp;<span class="ident" id="3553612">nat</span><span class="op" id="3553615">,</span>&nbsp;<span class="ident" id="3553617">s</span>&nbsp;<span class="builtintype" id="3553619">uint</span><span class="op" id="3553623">)</span>&nbsp;<span class="ident" id="3553625">nat</span>&nbsp;<span class="op" id="3553629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553632">m</span>&nbsp;<span class="op" id="3553634">:=</span>&nbsp;<span class="builtinfunc" id="3553637">len</span><span class="op" id="3553640">(</span><span class="ident" id="3553641">x</span><span class="op" id="3553642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553645">n</span>&nbsp;<span class="op" id="3553647">:=</span>&nbsp;<span class="ident" id="3553650">m</span>&nbsp;<span class="op" id="3553652">-</span>&nbsp;<span class="builtintype" id="3553654">int</span><span class="op" id="3553657">(</span><span class="ident" id="3553658">s</span><span class="op" id="3553659">/</span><span class="ident" id="3553660">_W</span><span class="op" id="3553662">)</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553665">if</span>&nbsp;<span class="ident" id="3553668">n</span>&nbsp;<span class="op" id="3553670">&lt;=</span>&nbsp;<span class="num" id="3553673">0</span>&nbsp;<span class="op" id="3553675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553679">return</span>&nbsp;<span class="ident" id="3553686">z</span><span class="op" id="3553687">.</span><span class="builtinfunc" id="3553688">make</span><span class="op" id="3553692">(</span><span class="num" id="3553693">0</span><span class="op" id="3553694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3553697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3553700">//&nbsp;n&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553711">z</span>&nbsp;<span class="op" id="3553713">=</span>&nbsp;<span class="ident" id="3553715">z</span><span class="op" id="3553716">.</span><span class="builtinfunc" id="3553717">make</span><span class="op" id="3553721">(</span><span class="ident" id="3553722">n</span><span class="op" id="3553723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553726">shrVU</span><span class="op" id="3553731">(</span><span class="ident" id="3553732">z</span><span class="op" id="3553733">,</span>&nbsp;<span class="ident" id="3553735">x</span><span class="op" id="3553736">[</span><span class="ident" id="3553737">m</span><span class="op" id="3553738">-</span><span class="ident" id="3553739">n</span><span class="op" id="3553740">:</span><span class="op" id="3553741">]</span><span class="op" id="3553742">,</span>&nbsp;<span class="ident" id="3553744">s</span><span class="op" id="3553745">%</span><span class="ident" id="3553746">_W</span><span class="op" id="3553748">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553752">return</span>&nbsp;<span class="ident" id="3553759">z</span><span class="op" id="3553760">.</span><span class="ident" id="3553761">norm</span><span class="op" id="3553765">(</span><span class="op" id="3553766">)</span><br>
<span class="lineno"></span><span class="op" id="3553768">}</span><br>
<span class="lineno">1070</span><br>
<span class="lineno"></span><span class="keyword" id="3553771">func</span>&nbsp;<span class="op" id="3553776">(</span><span class="ident" id="3553777">z</span>&nbsp;<span class="ident" id="3553779">nat</span><span class="op" id="3553782">)</span>&nbsp;<span class="ident" id="3553784">setBit</span><span class="op" id="3553790">(</span><span class="ident" id="3553791">x</span>&nbsp;<span class="ident" id="3553793">nat</span><span class="op" id="3553796">,</span>&nbsp;<span class="ident" id="3553798">i</span>&nbsp;<span class="builtintype" id="3553800">uint</span><span class="op" id="3553804">,</span>&nbsp;<span class="ident" id="3553806">b</span>&nbsp;<span class="builtintype" id="3553808">uint</span><span class="op" id="3553812">)</span>&nbsp;<span class="ident" id="3553814">nat</span>&nbsp;<span class="op" id="3553818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553821">j</span>&nbsp;<span class="op" id="3553823">:=</span>&nbsp;<span class="builtintype" id="3553826">int</span><span class="op" id="3553829">(</span><span class="ident" id="3553830">i</span>&nbsp;<span class="op" id="3553832">/</span>&nbsp;<span class="ident" id="3553834">_W</span><span class="op" id="3553836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553839">m</span>&nbsp;<span class="op" id="3553841">:=</span>&nbsp;<span class="ident" id="3553844">Word</span><span class="op" id="3553848">(</span><span class="num" id="3553849">1</span><span class="op" id="3553850">)</span>&nbsp;<span class="op" id="3553852">&lt;&lt;</span>&nbsp;<span class="op" id="3553855">(</span><span class="ident" id="3553856">i</span>&nbsp;<span class="op" id="3553858">%</span>&nbsp;<span class="ident" id="3553860">_W</span><span class="op" id="3553862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553865">n</span>&nbsp;<span class="op" id="3553867">:=</span>&nbsp;<span class="builtinfunc" id="3553870">len</span><span class="op" id="3553873">(</span><span class="ident" id="3553874">x</span><span class="op" id="3553875">)</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553878">switch</span>&nbsp;<span class="ident" id="3553885">b</span>&nbsp;<span class="op" id="3553887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553890">case</span>&nbsp;<span class="num" id="3553895">0</span><span class="op" id="3553896">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553900">z</span>&nbsp;<span class="op" id="3553902">=</span>&nbsp;<span class="ident" id="3553904">z</span><span class="op" id="3553905">.</span><span class="builtinfunc" id="3553906">make</span><span class="op" id="3553910">(</span><span class="ident" id="3553911">n</span><span class="op" id="3553912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3553916">copy</span><span class="op" id="3553920">(</span><span class="ident" id="3553921">z</span><span class="op" id="3553922">,</span>&nbsp;<span class="ident" id="3553924">x</span><span class="op" id="3553925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553929">if</span>&nbsp;<span class="ident" id="3553932">j</span>&nbsp;<span class="op" id="3553934">&gt;=</span>&nbsp;<span class="ident" id="3553937">n</span>&nbsp;<span class="op" id="3553939">{</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3553944">//&nbsp;no&nbsp;need&nbsp;to&nbsp;grow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553966">return</span>&nbsp;<span class="ident" id="3553973">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3553977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3553981">z</span><span class="op" id="3553982">[</span><span class="ident" id="3553983">j</span><span class="op" id="3553984">]</span>&nbsp;<span class="op" id="3553986">&amp;^=</span>&nbsp;<span class="ident" id="3553990">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3553994">return</span>&nbsp;<span class="ident" id="3554001">z</span><span class="op" id="3554002">.</span><span class="ident" id="3554003">norm</span><span class="op" id="3554007">(</span><span class="op" id="3554008">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554011">case</span>&nbsp;<span class="num" id="3554016">1</span><span class="op" id="3554017">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554021">if</span>&nbsp;<span class="ident" id="3554024">j</span>&nbsp;<span class="op" id="3554026">&gt;=</span>&nbsp;<span class="ident" id="3554029">n</span>&nbsp;<span class="op" id="3554031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554036">z</span>&nbsp;<span class="op" id="3554038">=</span>&nbsp;<span class="ident" id="3554040">z</span><span class="op" id="3554041">.</span><span class="builtinfunc" id="3554042">make</span><span class="op" id="3554046">(</span><span class="ident" id="3554047">j</span>&nbsp;<span class="op" id="3554049">+</span>&nbsp;<span class="num" id="3554051">1</span><span class="op" id="3554052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554057">z</span><span class="op" id="3554058">[</span><span class="ident" id="3554059">n</span><span class="op" id="3554060">:</span><span class="op" id="3554061">]</span><span class="op" id="3554062">.</span><span class="ident" id="3554063">clear</span><span class="op" id="3554068">(</span><span class="op" id="3554069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554073">}</span>&nbsp;<span class="keyword" id="3554075">else</span>&nbsp;<span class="op" id="3554080">{</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554085">z</span>&nbsp;<span class="op" id="3554087">=</span>&nbsp;<span class="ident" id="3554089">z</span><span class="op" id="3554090">.</span><span class="builtinfunc" id="3554091">make</span><span class="op" id="3554095">(</span><span class="ident" id="3554096">n</span><span class="op" id="3554097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3554105">copy</span><span class="op" id="3554109">(</span><span class="ident" id="3554110">z</span><span class="op" id="3554111">,</span>&nbsp;<span class="ident" id="3554113">x</span><span class="op" id="3554114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554118">z</span><span class="op" id="3554119">[</span><span class="ident" id="3554120">j</span><span class="op" id="3554121">]</span>&nbsp;<span class="op" id="3554123">|=</span>&nbsp;<span class="ident" id="3554126">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3554130">//&nbsp;no&nbsp;need&nbsp;to&nbsp;normalize</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554156">return</span>&nbsp;<span class="ident" id="3554163">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3554169">panic</span><span class="op" id="3554174">(</span><span class="string" id="3554175">&#34;set&nbsp;bit&nbsp;is&nbsp;not&nbsp;0&nbsp;or&nbsp;1&#34;</span><span class="op" id="3554198">)</span><br>
<span class="lineno"></span><span class="op" id="3554200">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1100</span><span class="keyword" id="3554203">func</span>&nbsp;<span class="op" id="3554208">(</span><span class="ident" id="3554209">z</span>&nbsp;<span class="ident" id="3554211">nat</span><span class="op" id="3554214">)</span>&nbsp;<span class="ident" id="3554216">bit</span><span class="op" id="3554219">(</span><span class="ident" id="3554220">i</span>&nbsp;<span class="builtintype" id="3554222">uint</span><span class="op" id="3554226">)</span>&nbsp;<span class="builtintype" id="3554228">uint</span>&nbsp;<span class="op" id="3554233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554236">j</span>&nbsp;<span class="op" id="3554238">:=</span>&nbsp;<span class="builtintype" id="3554241">int</span><span class="op" id="3554244">(</span><span class="ident" id="3554245">i</span>&nbsp;<span class="op" id="3554247">/</span>&nbsp;<span class="ident" id="3554249">_W</span><span class="op" id="3554251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554254">if</span>&nbsp;<span class="ident" id="3554257">j</span>&nbsp;<span class="op" id="3554259">&gt;=</span>&nbsp;<span class="builtinfunc" id="3554262">len</span><span class="op" id="3554265">(</span><span class="ident" id="3554266">z</span><span class="op" id="3554267">)</span>&nbsp;<span class="op" id="3554269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554273">return</span>&nbsp;<span class="num" id="3554280">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554283">}</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554286">return</span>&nbsp;<span class="builtintype" id="3554293">uint</span><span class="op" id="3554297">(</span><span class="ident" id="3554298">z</span><span class="op" id="3554299">[</span><span class="ident" id="3554300">j</span><span class="op" id="3554301">]</span>&nbsp;<span class="op" id="3554303">&gt;&gt;</span>&nbsp;<span class="op" id="3554306">(</span><span class="ident" id="3554307">i</span>&nbsp;<span class="op" id="3554309">%</span>&nbsp;<span class="ident" id="3554311">_W</span><span class="op" id="3554313">)</span>&nbsp;<span class="op" id="3554315">&amp;</span>&nbsp;<span class="num" id="3554317">1</span><span class="op" id="3554318">)</span><br>
<span class="lineno"></span><span class="op" id="3554320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3554323">func</span>&nbsp;<span class="op" id="3554328">(</span><span class="ident" id="3554329">z</span>&nbsp;<span class="ident" id="3554331">nat</span><span class="op" id="3554334">)</span>&nbsp;<span class="ident" id="3554336">and</span><span class="op" id="3554339">(</span><span class="ident" id="3554340">x</span><span class="op" id="3554341">,</span>&nbsp;<span class="ident" id="3554343">y</span>&nbsp;<span class="ident" id="3554345">nat</span><span class="op" id="3554348">)</span>&nbsp;<span class="ident" id="3554350">nat</span>&nbsp;<span class="op" id="3554354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554357">m</span>&nbsp;<span class="op" id="3554359">:=</span>&nbsp;<span class="builtinfunc" id="3554362">len</span><span class="op" id="3554365">(</span><span class="ident" id="3554366">x</span><span class="op" id="3554367">)</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554370">n</span>&nbsp;<span class="op" id="3554372">:=</span>&nbsp;<span class="builtinfunc" id="3554375">len</span><span class="op" id="3554378">(</span><span class="ident" id="3554379">y</span><span class="op" id="3554380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554383">if</span>&nbsp;<span class="ident" id="3554386">m</span>&nbsp;<span class="op" id="3554388">&gt;</span>&nbsp;<span class="ident" id="3554390">n</span>&nbsp;<span class="op" id="3554392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554396">m</span>&nbsp;<span class="op" id="3554398">=</span>&nbsp;<span class="ident" id="3554400">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3554406">//&nbsp;m&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno">1115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554418">z</span>&nbsp;<span class="op" id="3554420">=</span>&nbsp;<span class="ident" id="3554422">z</span><span class="op" id="3554423">.</span><span class="builtinfunc" id="3554424">make</span><span class="op" id="3554428">(</span><span class="ident" id="3554429">m</span><span class="op" id="3554430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554433">for</span>&nbsp;<span class="ident" id="3554437">i</span>&nbsp;<span class="op" id="3554439">:=</span>&nbsp;<span class="num" id="3554442">0</span><span class="op" id="3554443">;</span>&nbsp;<span class="ident" id="3554445">i</span>&nbsp;<span class="op" id="3554447">&lt;</span>&nbsp;<span class="ident" id="3554449">m</span><span class="op" id="3554450">;</span>&nbsp;<span class="ident" id="3554452">i</span><span class="op" id="3554453">++</span>&nbsp;<span class="op" id="3554456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554460">z</span><span class="op" id="3554461">[</span><span class="ident" id="3554462">i</span><span class="op" id="3554463">]</span>&nbsp;<span class="op" id="3554465">=</span>&nbsp;<span class="ident" id="3554467">x</span><span class="op" id="3554468">[</span><span class="ident" id="3554469">i</span><span class="op" id="3554470">]</span>&nbsp;<span class="op" id="3554472">&amp;</span>&nbsp;<span class="ident" id="3554474">y</span><span class="op" id="3554475">[</span><span class="ident" id="3554476">i</span><span class="op" id="3554477">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554480">}</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554484">return</span>&nbsp;<span class="ident" id="3554491">z</span><span class="op" id="3554492">.</span><span class="ident" id="3554493">norm</span><span class="op" id="3554497">(</span><span class="op" id="3554498">)</span><br>
<span class="lineno"></span><span class="op" id="3554500">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3554503">func</span>&nbsp;<span class="op" id="3554508">(</span><span class="ident" id="3554509">z</span>&nbsp;<span class="ident" id="3554511">nat</span><span class="op" id="3554514">)</span>&nbsp;<span class="ident" id="3554516">andNot</span><span class="op" id="3554522">(</span><span class="ident" id="3554523">x</span><span class="op" id="3554524">,</span>&nbsp;<span class="ident" id="3554526">y</span>&nbsp;<span class="ident" id="3554528">nat</span><span class="op" id="3554531">)</span>&nbsp;<span class="ident" id="3554533">nat</span>&nbsp;<span class="op" id="3554537">{</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554540">m</span>&nbsp;<span class="op" id="3554542">:=</span>&nbsp;<span class="builtinfunc" id="3554545">len</span><span class="op" id="3554548">(</span><span class="ident" id="3554549">x</span><span class="op" id="3554550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554553">n</span>&nbsp;<span class="op" id="3554555">:=</span>&nbsp;<span class="builtinfunc" id="3554558">len</span><span class="op" id="3554561">(</span><span class="ident" id="3554562">y</span><span class="op" id="3554563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554566">if</span>&nbsp;<span class="ident" id="3554569">n</span>&nbsp;<span class="op" id="3554571">&gt;</span>&nbsp;<span class="ident" id="3554573">m</span>&nbsp;<span class="op" id="3554575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554579">n</span>&nbsp;<span class="op" id="3554581">=</span>&nbsp;<span class="ident" id="3554583">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554586">}</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3554589">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554601">z</span>&nbsp;<span class="op" id="3554603">=</span>&nbsp;<span class="ident" id="3554605">z</span><span class="op" id="3554606">.</span><span class="builtinfunc" id="3554607">make</span><span class="op" id="3554611">(</span><span class="ident" id="3554612">m</span><span class="op" id="3554613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554616">for</span>&nbsp;<span class="ident" id="3554620">i</span>&nbsp;<span class="op" id="3554622">:=</span>&nbsp;<span class="num" id="3554625">0</span><span class="op" id="3554626">;</span>&nbsp;<span class="ident" id="3554628">i</span>&nbsp;<span class="op" id="3554630">&lt;</span>&nbsp;<span class="ident" id="3554632">n</span><span class="op" id="3554633">;</span>&nbsp;<span class="ident" id="3554635">i</span><span class="op" id="3554636">++</span>&nbsp;<span class="op" id="3554639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554643">z</span><span class="op" id="3554644">[</span><span class="ident" id="3554645">i</span><span class="op" id="3554646">]</span>&nbsp;<span class="op" id="3554648">=</span>&nbsp;<span class="ident" id="3554650">x</span><span class="op" id="3554651">[</span><span class="ident" id="3554652">i</span><span class="op" id="3554653">]</span>&nbsp;<span class="op" id="3554655">&amp;^</span>&nbsp;<span class="ident" id="3554658">y</span><span class="op" id="3554659">[</span><span class="ident" id="3554660">i</span><span class="op" id="3554661">]</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554664">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3554667">copy</span><span class="op" id="3554671">(</span><span class="ident" id="3554672">z</span><span class="op" id="3554673">[</span><span class="ident" id="3554674">n</span><span class="op" id="3554675">:</span><span class="ident" id="3554676">m</span><span class="op" id="3554677">]</span><span class="op" id="3554678">,</span>&nbsp;<span class="ident" id="3554680">x</span><span class="op" id="3554681">[</span><span class="ident" id="3554682">n</span><span class="op" id="3554683">:</span><span class="ident" id="3554684">m</span><span class="op" id="3554685">]</span><span class="op" id="3554686">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554690">return</span>&nbsp;<span class="ident" id="3554697">z</span><span class="op" id="3554698">.</span><span class="ident" id="3554699">norm</span><span class="op" id="3554703">(</span><span class="op" id="3554704">)</span><br>
<span class="lineno"></span><span class="op" id="3554706">}</span><br>
<span class="lineno">1140</span><br>
<span class="lineno"></span><span class="keyword" id="3554709">func</span>&nbsp;<span class="op" id="3554714">(</span><span class="ident" id="3554715">z</span>&nbsp;<span class="ident" id="3554717">nat</span><span class="op" id="3554720">)</span>&nbsp;<span class="ident" id="3554722">or</span><span class="op" id="3554724">(</span><span class="ident" id="3554725">x</span><span class="op" id="3554726">,</span>&nbsp;<span class="ident" id="3554728">y</span>&nbsp;<span class="ident" id="3554730">nat</span><span class="op" id="3554733">)</span>&nbsp;<span class="ident" id="3554735">nat</span>&nbsp;<span class="op" id="3554739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554742">m</span>&nbsp;<span class="op" id="3554744">:=</span>&nbsp;<span class="builtinfunc" id="3554747">len</span><span class="op" id="3554750">(</span><span class="ident" id="3554751">x</span><span class="op" id="3554752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554755">n</span>&nbsp;<span class="op" id="3554757">:=</span>&nbsp;<span class="builtinfunc" id="3554760">len</span><span class="op" id="3554763">(</span><span class="ident" id="3554764">y</span><span class="op" id="3554765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554768">s</span>&nbsp;<span class="op" id="3554770">:=</span>&nbsp;<span class="ident" id="3554773">x</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554776">if</span>&nbsp;<span class="ident" id="3554779">m</span>&nbsp;<span class="op" id="3554781">&lt;</span>&nbsp;<span class="ident" id="3554783">n</span>&nbsp;<span class="op" id="3554785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554789">n</span><span class="op" id="3554790">,</span>&nbsp;<span class="ident" id="3554792">m</span>&nbsp;<span class="op" id="3554794">=</span>&nbsp;<span class="ident" id="3554796">m</span><span class="op" id="3554797">,</span>&nbsp;<span class="ident" id="3554799">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554803">s</span>&nbsp;<span class="op" id="3554805">=</span>&nbsp;<span class="ident" id="3554807">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3554813">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno">1150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554825">z</span>&nbsp;<span class="op" id="3554827">=</span>&nbsp;<span class="ident" id="3554829">z</span><span class="op" id="3554830">.</span><span class="builtinfunc" id="3554831">make</span><span class="op" id="3554835">(</span><span class="ident" id="3554836">m</span><span class="op" id="3554837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554840">for</span>&nbsp;<span class="ident" id="3554844">i</span>&nbsp;<span class="op" id="3554846">:=</span>&nbsp;<span class="num" id="3554849">0</span><span class="op" id="3554850">;</span>&nbsp;<span class="ident" id="3554852">i</span>&nbsp;<span class="op" id="3554854">&lt;</span>&nbsp;<span class="ident" id="3554856">n</span><span class="op" id="3554857">;</span>&nbsp;<span class="ident" id="3554859">i</span><span class="op" id="3554860">++</span>&nbsp;<span class="op" id="3554863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554867">z</span><span class="op" id="3554868">[</span><span class="ident" id="3554869">i</span><span class="op" id="3554870">]</span>&nbsp;<span class="op" id="3554872">=</span>&nbsp;<span class="ident" id="3554874">x</span><span class="op" id="3554875">[</span><span class="ident" id="3554876">i</span><span class="op" id="3554877">]</span>&nbsp;<span class="op" id="3554879">|</span>&nbsp;<span class="ident" id="3554881">y</span><span class="op" id="3554882">[</span><span class="ident" id="3554883">i</span><span class="op" id="3554884">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3554887">}</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3554890">copy</span><span class="op" id="3554894">(</span><span class="ident" id="3554895">z</span><span class="op" id="3554896">[</span><span class="ident" id="3554897">n</span><span class="op" id="3554898">:</span><span class="ident" id="3554899">m</span><span class="op" id="3554900">]</span><span class="op" id="3554901">,</span>&nbsp;<span class="ident" id="3554903">s</span><span class="op" id="3554904">[</span><span class="ident" id="3554905">n</span><span class="op" id="3554906">:</span><span class="ident" id="3554907">m</span><span class="op" id="3554908">]</span><span class="op" id="3554909">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3554913">return</span>&nbsp;<span class="ident" id="3554920">z</span><span class="op" id="3554921">.</span><span class="ident" id="3554922">norm</span><span class="op" id="3554926">(</span><span class="op" id="3554927">)</span><br>
<span class="lineno"></span><span class="op" id="3554929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1160</span><span class="keyword" id="3554932">func</span>&nbsp;<span class="op" id="3554937">(</span><span class="ident" id="3554938">z</span>&nbsp;<span class="ident" id="3554940">nat</span><span class="op" id="3554943">)</span>&nbsp;<span class="ident" id="3554945">xor</span><span class="op" id="3554948">(</span><span class="ident" id="3554949">x</span><span class="op" id="3554950">,</span>&nbsp;<span class="ident" id="3554952">y</span>&nbsp;<span class="ident" id="3554954">nat</span><span class="op" id="3554957">)</span>&nbsp;<span class="ident" id="3554959">nat</span>&nbsp;<span class="op" id="3554963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554966">m</span>&nbsp;<span class="op" id="3554968">:=</span>&nbsp;<span class="builtinfunc" id="3554971">len</span><span class="op" id="3554974">(</span><span class="ident" id="3554975">x</span><span class="op" id="3554976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554979">n</span>&nbsp;<span class="op" id="3554981">:=</span>&nbsp;<span class="builtinfunc" id="3554984">len</span><span class="op" id="3554987">(</span><span class="ident" id="3554988">y</span><span class="op" id="3554989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3554992">s</span>&nbsp;<span class="op" id="3554994">:=</span>&nbsp;<span class="ident" id="3554997">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555000">if</span>&nbsp;<span class="ident" id="3555003">m</span>&nbsp;<span class="op" id="3555005">&lt;</span>&nbsp;<span class="ident" id="3555007">n</span>&nbsp;<span class="op" id="3555009">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3555013">n</span><span class="op" id="3555014">,</span>&nbsp;<span class="ident" id="3555016">m</span>&nbsp;<span class="op" id="3555018">=</span>&nbsp;<span class="ident" id="3555020">m</span><span class="op" id="3555021">,</span>&nbsp;<span class="ident" id="3555023">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3555027">s</span>&nbsp;<span class="op" id="3555029">=</span>&nbsp;<span class="ident" id="3555031">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3555034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3555037">//&nbsp;m&nbsp;&gt;=&nbsp;n</span><br>
<span class="lineno"></span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3555049">z</span>&nbsp;<span class="op" id="3555051">=</span>&nbsp;<span class="ident" id="3555053">z</span><span class="op" id="3555054">.</span><span class="builtinfunc" id="3555055">make</span><span class="op" id="3555059">(</span><span class="ident" id="3555060">m</span><span class="op" id="3555061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555064">for</span>&nbsp;<span class="ident" id="3555068">i</span>&nbsp;<span class="op" id="3555070">:=</span>&nbsp;<span class="num" id="3555073">0</span><span class="op" id="3555074">;</span>&nbsp;<span class="ident" id="3555076">i</span>&nbsp;<span class="op" id="3555078">&lt;</span>&nbsp;<span class="ident" id="3555080">n</span><span class="op" id="3555081">;</span>&nbsp;<span class="ident" id="3555083">i</span><span class="op" id="3555084">++</span>&nbsp;<span class="op" id="3555087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3555091">z</span><span class="op" id="3555092">[</span><span class="ident" id="3555093">i</span><span class="op" id="3555094">]</span>&nbsp;<span class="op" id="3555096">=</span>&nbsp;<span class="ident" id="3555098">x</span><span class="op" id="3555099">[</span><span class="ident" id="3555100">i</span><span class="op" id="3555101">]</span>&nbsp;<span class="op" id="3555103">^</span>&nbsp;<span class="ident" id="3555105">y</span><span class="op" id="3555106">[</span><span class="ident" id="3555107">i</span><span class="op" id="3555108">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3555111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3555114">copy</span><span class="op" id="3555118">(</span><span class="ident" id="3555119">z</span><span class="op" id="3555120">[</span><span class="ident" id="3555121">n</span><span class="op" id="3555122">:</span><span class="ident" id="3555123">m</span><span class="op" id="3555124">]</span><span class="op" id="3555125">,</span>&nbsp;<span class="ident" id="3555127">s</span><span class="op" id="3555128">[</span><span class="ident" id="3555129">n</span><span class="op" id="3555130">:</span><span class="ident" id="3555131">m</span><span class="op" id="3555132">]</span><span class="op" id="3555133">)</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555137">return</span>&nbsp;<span class="ident" id="3555144">z</span><span class="op" id="3555145">.</span><span class="ident" id="3555146">norm</span><span class="op" id="3555150">(</span><span class="op" id="3555151">)</span><br>
<span class="lineno"></span><span class="op" id="3555153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3555156">//&nbsp;greaterThan&nbsp;returns&nbsp;true&nbsp;iff&nbsp;(x1&lt;&lt;_W&nbsp;+&nbsp;x2)&nbsp;&gt;&nbsp;(y1&lt;&lt;_W&nbsp;+&nbsp;y2)</span><br>
<span class="lineno">1180</span><span class="keyword" id="3555218">func</span>&nbsp;<span class="ident" id="3555223">greaterThan</span><span class="op" id="3555234">(</span><span class="ident" id="3555235">x1</span><span class="op" id="3555237">,</span>&nbsp;<span class="ident" id="3555239">x2</span><span class="op" id="3555241">,</span>&nbsp;<span class="ident" id="3555243">y1</span><span class="op" id="3555245">,</span>&nbsp;<span class="ident" id="3555247">y2</span>&nbsp;<span class="ident" id="3555250">Word</span><span class="op" id="3555254">)</span>&nbsp;<span class="builtintype" id="3555256">bool</span>&nbsp;<span class="op" id="3555261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555264">return</span>&nbsp;<span class="ident" id="3555271">x1</span>&nbsp;<span class="op" id="3555274">&gt;</span>&nbsp;<span class="ident" id="3555276">y1</span>&nbsp;<span class="op" id="3555279">||</span>&nbsp;<span class="ident" id="3555282">x1</span>&nbsp;<span class="op" id="3555285">==</span>&nbsp;<span class="ident" id="3555288">y1</span>&nbsp;<span class="op" id="3555291">&amp;&amp;</span>&nbsp;<span class="ident" id="3555294">x2</span>&nbsp;<span class="op" id="3555297">&gt;</span>&nbsp;<span class="ident" id="3555299">y2</span><br>
<span class="lineno"></span><span class="op" id="3555302">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3555305">//&nbsp;modW&nbsp;returns&nbsp;x&nbsp;%&nbsp;d.</span><br>
<span class="lineno">1185</span><span class="keyword" id="3555328">func</span>&nbsp;<span class="op" id="3555333">(</span><span class="ident" id="3555334">x</span>&nbsp;<span class="ident" id="3555336">nat</span><span class="op" id="3555339">)</span>&nbsp;<span class="ident" id="3555341">modW</span><span class="op" id="3555345">(</span><span class="ident" id="3555346">d</span>&nbsp;<span class="ident" id="3555348">Word</span><span class="op" id="3555352">)</span>&nbsp;<span class="op" id="3555354">(</span><span class="ident" id="3555355">r</span>&nbsp;<span class="ident" id="3555357">Word</span><span class="op" id="3555361">)</span>&nbsp;<span class="op" id="3555363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3555366">//&nbsp;TODO(agl):&nbsp;we&nbsp;don&#39;t&nbsp;actually&nbsp;need&nbsp;to&nbsp;store&nbsp;the&nbsp;q&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555426">var</span>&nbsp;<span class="ident" id="3555430">q</span>&nbsp;<span class="ident" id="3555432">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3555437">q</span>&nbsp;<span class="op" id="3555439">=</span>&nbsp;<span class="ident" id="3555441">q</span><span class="op" id="3555442">.</span><span class="builtinfunc" id="3555443">make</span><span class="op" id="3555447">(</span><span class="builtinfunc" id="3555448">len</span><span class="op" id="3555451">(</span><span class="ident" id="3555452">x</span><span class="op" id="3555453">)</span><span class="op" id="3555454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555457">return</span>&nbsp;<span class="ident" id="3555464">divWVW</span><span class="op" id="3555470">(</span><span class="ident" id="3555471">q</span><span class="op" id="3555472">,</span>&nbsp;<span class="num" id="3555474">0</span><span class="op" id="3555475">,</span>&nbsp;<span class="ident" id="3555477">x</span><span class="op" id="3555478">,</span>&nbsp;<span class="ident" id="3555480">d</span><span class="op" id="3555481">)</span><br>
<span class="lineno">1190</span><span class="op" id="3555483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3555486">//&nbsp;random&nbsp;creates&nbsp;a&nbsp;random&nbsp;integer&nbsp;in&nbsp;[0..limit),&nbsp;using&nbsp;the&nbsp;space&nbsp;in&nbsp;z&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="3555560">//&nbsp;possible.&nbsp;n&nbsp;is&nbsp;the&nbsp;bit&nbsp;length&nbsp;of&nbsp;limit.</span><br>
<span class="lineno"></span><span class="keyword" id="3555603">func</span>&nbsp;<span class="op" id="3555608">(</span><span class="ident" id="3555609">z</span>&nbsp;<span class="ident" id="3555611">nat</span><span class="op" id="3555614">)</span>&nbsp;<span class="ident" id="3555616">random</span><span class="op" id="3555622">(</span><span class="ident" id="3555623">rand</span>&nbsp;<span class="op" id="3555628">*</span><span class="ident" id="3555629">rand</span><span class="op" id="3555633">.</span><span class="ident" id="3555634">Rand</span><span class="op" id="3555638">,</span>&nbsp;<span class="ident" id="3555640">limit</span>&nbsp;<span class="ident" id="3555646">nat</span><span class="op" id="3555649">,</span>&nbsp;<span class="ident" id="3555651">n</span>&nbsp;<span class="builtintype" id="3555653">int</span><span class="op" id="3555656">)</span>&nbsp;<span class="ident" id="3555658">nat</span>&nbsp;<span class="op" id="3555662">{</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555665">if</span>&nbsp;<span class="ident" id="3555668">alias</span><span class="op" id="3555673">(</span><span class="ident" id="3555674">z</span><span class="op" id="3555675">,</span>&nbsp;<span class="ident" id="3555677">limit</span><span class="op" id="3555682">)</span>&nbsp;<span class="op" id="3555684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3555688">z</span>&nbsp;<span class="op" id="3555690">=</span>&nbsp;<span class="ident" id="3555692">nil</span>&nbsp;<span class="comment" id="3555696">//&nbsp;z&nbsp;is&nbsp;an&nbsp;alias&nbsp;for&nbsp;limit&nbsp;-&nbsp;cannot&nbsp;reuse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3555739">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3555742">z</span>&nbsp;<span class="op" id="3555744">=</span>&nbsp;<span class="ident" id="3555746">z</span><span class="op" id="3555747">.</span><span class="builtinfunc" id="3555748">make</span><span class="op" id="3555752">(</span><span class="builtinfunc" id="3555753">len</span><span class="op" id="3555756">(</span><span class="ident" id="3555757">limit</span><span class="op" id="3555762">)</span><span class="op" id="3555763">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3555767">bitLengthOfMSW</span>&nbsp;<span class="op" id="3555782">:=</span>&nbsp;<span class="builtintype" id="3555785">uint</span><span class="op" id="3555789">(</span><span class="ident" id="3555790">n</span>&nbsp;<span class="op" id="3555792">%</span>&nbsp;<span class="ident" id="3555794">_W</span><span class="op" id="3555796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555799">if</span>&nbsp;<span class="ident" id="3555802">bitLengthOfMSW</span>&nbsp;<span class="op" id="3555817">==</span>&nbsp;<span class="num" id="3555820">0</span>&nbsp;<span class="op" id="3555822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3555826">bitLengthOfMSW</span>&nbsp;<span class="op" id="3555841">=</span>&nbsp;<span class="ident" id="3555843">_W</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3555847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3555850">mask</span>&nbsp;<span class="op" id="3555855">:=</span>&nbsp;<span class="ident" id="3555858">Word</span><span class="op" id="3555862">(</span><span class="op" id="3555863">(</span><span class="num" id="3555864">1</span>&nbsp;<span class="op" id="3555866">&lt;&lt;</span>&nbsp;<span class="ident" id="3555869">bitLengthOfMSW</span><span class="op" id="3555883">)</span>&nbsp;<span class="op" id="3555885">-</span>&nbsp;<span class="num" id="3555887">1</span><span class="op" id="3555888">)</span><br>
<span class="lineno">1205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555892">for</span>&nbsp;<span class="op" id="3555896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555900">switch</span>&nbsp;<span class="ident" id="3555907">_W</span>&nbsp;<span class="op" id="3555910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555914">case</span>&nbsp;<span class="num" id="3555919">32</span><span class="op" id="3555921">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555926">for</span>&nbsp;<span class="ident" id="3555930">i</span>&nbsp;<span class="op" id="3555932">:=</span>&nbsp;<span class="keyword" id="3555935">range</span>&nbsp;<span class="ident" id="3555941">z</span>&nbsp;<span class="op" id="3555943">{</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3555949">z</span><span class="op" id="3555950">[</span><span class="ident" id="3555951">i</span><span class="op" id="3555952">]</span>&nbsp;<span class="op" id="3555954">=</span>&nbsp;<span class="ident" id="3555956">Word</span><span class="op" id="3555960">(</span><span class="ident" id="3555961">rand</span><span class="op" id="3555965">.</span><span class="ident" id="3555966">Uint32</span><span class="op" id="3555972">(</span><span class="op" id="3555973">)</span><span class="op" id="3555974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3555979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555983">case</span>&nbsp;<span class="num" id="3555988">64</span><span class="op" id="3555990">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3555995">for</span>&nbsp;<span class="ident" id="3555999">i</span>&nbsp;<span class="op" id="3556001">:=</span>&nbsp;<span class="keyword" id="3556004">range</span>&nbsp;<span class="ident" id="3556010">z</span>&nbsp;<span class="op" id="3556012">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556018">z</span><span class="op" id="3556019">[</span><span class="ident" id="3556020">i</span><span class="op" id="3556021">]</span>&nbsp;<span class="op" id="3556023">=</span>&nbsp;<span class="ident" id="3556025">Word</span><span class="op" id="3556029">(</span><span class="ident" id="3556030">rand</span><span class="op" id="3556034">.</span><span class="ident" id="3556035">Uint32</span><span class="op" id="3556041">(</span><span class="op" id="3556042">)</span><span class="op" id="3556043">)</span>&nbsp;<span class="op" id="3556045">|</span>&nbsp;<span class="ident" id="3556047">Word</span><span class="op" id="3556051">(</span><span class="ident" id="3556052">rand</span><span class="op" id="3556056">.</span><span class="ident" id="3556057">Uint32</span><span class="op" id="3556063">(</span><span class="op" id="3556064">)</span><span class="op" id="3556065">)</span><span class="op" id="3556066">&lt;&lt;</span><span class="num" id="3556068">32</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3556074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556078">default</span><span class="op" id="3556085">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3556090">panic</span><span class="op" id="3556095">(</span><span class="string" id="3556096">&#34;unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="3556115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3556119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556123">z</span><span class="op" id="3556124">[</span><span class="builtinfunc" id="3556125">len</span><span class="op" id="3556128">(</span><span class="ident" id="3556129">limit</span><span class="op" id="3556134">)</span><span class="op" id="3556135">-</span><span class="num" id="3556136">1</span><span class="op" id="3556137">]</span>&nbsp;<span class="op" id="3556139">&amp;=</span>&nbsp;<span class="ident" id="3556142">mask</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556149">if</span>&nbsp;<span class="ident" id="3556152">z</span><span class="op" id="3556153">.</span><span class="ident" id="3556154">cmp</span><span class="op" id="3556157">(</span><span class="ident" id="3556158">limit</span><span class="op" id="3556163">)</span>&nbsp;<span class="op" id="3556165">&lt;</span>&nbsp;<span class="num" id="3556167">0</span>&nbsp;<span class="op" id="3556169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556174">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3556182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3556185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556189">return</span>&nbsp;<span class="ident" id="3556196">z</span><span class="op" id="3556197">.</span><span class="ident" id="3556198">norm</span><span class="op" id="3556202">(</span><span class="op" id="3556203">)</span><br>
<span class="lineno"></span><span class="op" id="3556205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3556208">//&nbsp;If&nbsp;m&nbsp;!=&nbsp;0&nbsp;(i.e.,&nbsp;len(m)&nbsp;!=&nbsp;0),&nbsp;expNN&nbsp;sets&nbsp;z&nbsp;to&nbsp;x**y&nbsp;mod&nbsp;m;</span><br>
<span class="lineno"></span><span class="comment" id="3556270">//&nbsp;otherwise&nbsp;it&nbsp;sets&nbsp;z&nbsp;to&nbsp;x**y.&nbsp;The&nbsp;result&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;z.</span><br>
<span class="lineno">1230</span><span class="keyword" id="3556332">func</span>&nbsp;<span class="op" id="3556337">(</span><span class="ident" id="3556338">z</span>&nbsp;<span class="ident" id="3556340">nat</span><span class="op" id="3556343">)</span>&nbsp;<span class="ident" id="3556345">expNN</span><span class="op" id="3556350">(</span><span class="ident" id="3556351">x</span><span class="op" id="3556352">,</span>&nbsp;<span class="ident" id="3556354">y</span><span class="op" id="3556355">,</span>&nbsp;<span class="ident" id="3556357">m</span>&nbsp;<span class="ident" id="3556359">nat</span><span class="op" id="3556362">)</span>&nbsp;<span class="ident" id="3556364">nat</span>&nbsp;<span class="op" id="3556368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556371">if</span>&nbsp;<span class="ident" id="3556374">alias</span><span class="op" id="3556379">(</span><span class="ident" id="3556380">z</span><span class="op" id="3556381">,</span>&nbsp;<span class="ident" id="3556383">x</span><span class="op" id="3556384">)</span>&nbsp;<span class="op" id="3556386">||</span>&nbsp;<span class="ident" id="3556389">alias</span><span class="op" id="3556394">(</span><span class="ident" id="3556395">z</span><span class="op" id="3556396">,</span>&nbsp;<span class="ident" id="3556398">y</span><span class="op" id="3556399">)</span>&nbsp;<span class="op" id="3556401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556405">//&nbsp;We&nbsp;cannot&nbsp;allow&nbsp;in-place&nbsp;modification&nbsp;of&nbsp;x&nbsp;or&nbsp;y.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556459">z</span>&nbsp;<span class="op" id="3556461">=</span>&nbsp;<span class="ident" id="3556463">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3556468">}</span><br>
<span class="lineno">1235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556472">//&nbsp;x**y&nbsp;mod&nbsp;1&nbsp;==&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556492">if</span>&nbsp;<span class="builtinfunc" id="3556495">len</span><span class="op" id="3556498">(</span><span class="ident" id="3556499">m</span><span class="op" id="3556500">)</span>&nbsp;<span class="op" id="3556502">==</span>&nbsp;<span class="num" id="3556505">1</span>&nbsp;<span class="op" id="3556507">&amp;&amp;</span>&nbsp;<span class="ident" id="3556510">m</span><span class="op" id="3556511">[</span><span class="num" id="3556512">0</span><span class="op" id="3556513">]</span>&nbsp;<span class="op" id="3556515">==</span>&nbsp;<span class="num" id="3556518">1</span>&nbsp;<span class="op" id="3556520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556524">return</span>&nbsp;<span class="ident" id="3556531">z</span><span class="op" id="3556532">.</span><span class="ident" id="3556533">setWord</span><span class="op" id="3556540">(</span><span class="num" id="3556541">0</span><span class="op" id="3556542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3556545">}</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556548">//&nbsp;m&nbsp;==&nbsp;0&nbsp;||&nbsp;m&nbsp;&gt;&nbsp;1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556569">//&nbsp;x**0&nbsp;==&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556583">if</span>&nbsp;<span class="builtinfunc" id="3556586">len</span><span class="op" id="3556589">(</span><span class="ident" id="3556590">y</span><span class="op" id="3556591">)</span>&nbsp;<span class="op" id="3556593">==</span>&nbsp;<span class="num" id="3556596">0</span>&nbsp;<span class="op" id="3556598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556602">return</span>&nbsp;<span class="ident" id="3556609">z</span><span class="op" id="3556610">.</span><span class="ident" id="3556611">setWord</span><span class="op" id="3556618">(</span><span class="num" id="3556619">1</span><span class="op" id="3556620">)</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3556623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556626">//&nbsp;y&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3556637">if</span>&nbsp;<span class="builtinfunc" id="3556640">len</span><span class="op" id="3556643">(</span><span class="ident" id="3556644">m</span><span class="op" id="3556645">)</span>&nbsp;<span class="op" id="3556647">!=</span>&nbsp;<span class="num" id="3556650">0</span>&nbsp;<span class="op" id="3556652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556656">//&nbsp;We&nbsp;likely&nbsp;end&nbsp;up&nbsp;being&nbsp;as&nbsp;long&nbsp;as&nbsp;the&nbsp;modulus.</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556708">z</span>&nbsp;<span class="op" id="3556710">=</span>&nbsp;<span class="ident" id="3556712">z</span><span class="op" id="3556713">.</span><span class="builtinfunc" id="3556714">make</span><span class="op" id="3556718">(</span><span class="builtinfunc" id="3556719">len</span><span class="op" id="3556722">(</span><span class="ident" id="3556723">m</span><span class="op" id="3556724">)</span><span class="op" id="3556725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3556728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3556731">z</span>&nbsp;<span class="op" id="3556733">=</span>&nbsp;<span class="ident" id="3556735">z</span><span class="op" id="3556736">.</span><span class="ident" id="3556737">set</span><span class="op" id="3556740">(</span><span class="ident" id="3556741">x</span><span class="op" id="3556742">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556746">//&nbsp;If&nbsp;the&nbsp;base&nbsp;is&nbsp;non-trivial&nbsp;and&nbsp;the&nbsp;exponent&nbsp;is&nbsp;large,&nbsp;we&nbsp;use</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556811">//&nbsp;4-bit,&nbsp;windowed&nbsp;exponentiation.&nbsp;This&nbsp;involves&nbsp;precomputing&nbsp;14&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556884">//&nbsp;(x^2...x^15)&nbsp;but&nbsp;then&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of&nbsp;multiply-reduces&nbsp;by&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3556954">//&nbsp;third.&nbsp;Even&nbsp;for&nbsp;a&nbsp;32-bit&nbsp;exponent,&nbsp;this&nbsp;reduces&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3557020">//&nbsp;operations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3557036">if</span>&nbsp;<span class="builtinfunc" id="3557039">len</span><span class="op" id="3557042">(</span><span class="ident" id="3557043">x</span><span class="op" id="3557044">)</span>&nbsp;<span class="op" id="3557046">&gt;</span>&nbsp;<span class="num" id="3557048">1</span>&nbsp;<span class="op" id="3557050">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3557053">len</span><span class="op" id="3557056">(</span><span class="ident" id="3557057">y</span><span class="op" id="3557058">)</span>&nbsp;<span class="op" id="3557060">&gt;</span>&nbsp;<span class="num" id="3557062">1</span>&nbsp;<span class="op" id="3557064">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3557067">len</span><span class="op" id="3557070">(</span><span class="ident" id="3557071">m</span><span class="op" id="3557072">)</span>&nbsp;<span class="op" id="3557074">&gt;</span>&nbsp;<span class="num" id="3557076">0</span>&nbsp;<span class="op" id="3557078">{</span><br>
<span class="lineno">1260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3557082">return</span>&nbsp;<span class="ident" id="3557089">z</span><span class="op" id="3557090">.</span><span class="ident" id="3557091">expNNWindowed</span><span class="op" id="3557104">(</span><span class="ident" id="3557105">x</span><span class="op" id="3557106">,</span>&nbsp;<span class="ident" id="3557108">y</span><span class="op" id="3557109">,</span>&nbsp;<span class="ident" id="3557111">m</span><span class="op" id="3557112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3557115">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3557119">v</span>&nbsp;<span class="op" id="3557121">:=</span>&nbsp;<span class="ident" id="3557124">y</span><span class="op" id="3557125">[</span><span class="builtinfunc" id="3557126">len</span><span class="op" id="3557129">(</span><span class="ident" id="3557130">y</span><span class="op" id="3557131">)</span><span class="op" id="3557132">-</span><span class="num" id="3557133">1</span><span class="op" id="3557134">]</span>&nbsp;<span class="comment" id="3557136">//&nbsp;v&nbsp;&gt;&nbsp;0&nbsp;because&nbsp;y&nbsp;is&nbsp;normalized&nbsp;and&nbsp;y&nbsp;&gt;&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3557180">shift</span>&nbsp;<span class="op" id="3557186">:=</span>&nbsp;<span class="ident" id="3557189">leadingZeros</span><span class="op" id="3557201">(</span><span class="ident" id="3557202">v</span><span class="op" id="3557203">)</span>&nbsp;<span class="op" id="3557205">+</span>&nbsp;<span class="num" id="3557207">1</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3557210">v</span>&nbsp;<span class="op" id="3557212">&lt;&lt;=</span>&nbsp;<span class="ident" id="3557216">shift</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3557223">var</span>&nbsp;<span class="ident" id="3557227">q</span>&nbsp;<span class="ident" id="3557229">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3557235">const</span>&nbsp;<span class="ident" id="3557241">mask</span>&nbsp;<span class="op" id="3557246">=</span>&nbsp;<span class="num" id="3557248">1</span>&nbsp;<span class="op" id="3557250">&lt;&lt;</span>&nbsp;<span class="op" id="3557253">(</span><span class="ident" id="3557254">_W</span>&nbsp;<span class="op" id="3557257">-</span>&nbsp;<span class="num" id="3557259">1</span><span class="op" id="3557260">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3557264">//&nbsp;We&nbsp;walk&nbsp;through&nbsp;the&nbsp;bits&nbsp;of&nbsp;the&nbsp;exponent&nbsp;one&nbsp;by&nbsp;one.&nbsp;Each&nbsp;time&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3557334">//&nbsp;see&nbsp;a&nbsp;bit,&nbsp;we&nbsp;square,&nbsp;thus&nbsp;doubling&nbsp;the&nbsp;power.&nbsp;If&nbsp;the&nbsp;bit&nbsp;is&nbsp;a&nbsp;one,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3557406">//&nbsp;we&nbsp;also&nbsp;multiply&nbsp;by&nbsp;x,&nbsp;thus&nbsp;adding&nbsp;one&nbsp;to&nbsp;the&nbsp;power.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3557464">w</span>&nbsp;<span class="op" id="3557466">:=</span>&nbsp;<span class="ident" id="3557469">_W</span>&nbsp;<span class="op" id="3557472">-</span>&nbsp;<span class="builtintype" id="3557474">int</span><span class="op" id="3557477">(</span><span class="ident" id="3557478">shift</span><span class="op" id="3557483">)</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3557486">//&nbsp;zz&nbsp;and&nbsp;r&nbsp;are&nbsp;used&nbsp;to&nbsp;avoid&nbsp;allocating&nbsp;in&nbsp;mul&nbsp;and&nbsp;div&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3557546">//&nbsp;otherwise&nbsp;the&nbsp;arguments&nbsp;would&nbsp;alias.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3557587">var</span>&nbsp;<span class="ident" id="3557591">zz</span><span class="op" id="3557593">,</span>&nbsp;<span class="ident" id="3557595">r</span>&nbsp;<span class="ident" id="3557597">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3557602">for</span>&nbsp;<span class="ident" id="3557606">j</span>&nbsp;<span class="op" id="3557608">:=</span>&nbsp;<span class="num" id="3557611">0</span><span class="op" id="3557612">;</span>&nbsp;<span class="ident" id="3557614">j</span>&nbsp;<span class="op" id="3557616">&lt;</span>&nbsp;<span class="ident" id="3557618">w</span><span class="op" id="3557619">;</span>&nbsp;<span class="ident" id="3557621">j</span><span class="op" id="3557622">++</span>&nbsp;<span class="op" id="3557625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3557629">zz</span>&nbsp;<span class="op" id="3557632">=</span>&nbsp;<span class="ident" id="3557634">zz</span><span class="op" id="3557636">.</span><span class="ident" id="3557637">mul</span><span class="op" id="3557640">(</span><span class="ident" id="3557641">z</span><span class="op" id="3557642">,</span>&nbsp;<span class="ident" id="3557644">z</span><span class="op" id="3557645">)</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3557649">zz</span><span class="op" id="3557651">,</span>&nbsp;<span class="ident" id="3557653">z</span>&nbsp;<span class="op" id="3557655">=</span>&nbsp;<span class="ident" id="3557657">z</span><span class="op" id="3557658">,</span>&nbsp;<span class="ident" id="3557660">zz</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3557666">if</span>&nbsp;<span class="ident" id="3557669">v</span><span class="op" id="3557670">&amp;</span><span class="ident" id="3557671">mask</span>&nbsp;<span class="op" id="3557676">!=</span>&nbsp;<span class="num" id="3557679">0</span>&nbsp;<span class="op" id="3557681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3557686">zz</span>&nbsp;<span class="op" id="3557689">=</span>&nbsp;<span class="ident" id="3557691">zz</span><span class="op" id="3557693">.</span><span class="ident" id="3557694">mul</span><span class="op" id="3557697">(</span><span class="ident" id="3557698">z</span><span class="op" id="3557699">,</span>&nbsp;<span class="ident" id="3557701">x</span><span class="op" id="3557702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3557707">zz</span><span class="op" id="3557709">,</span>&nbsp;<span class="ident" id="3557711">z</span>&nbsp;<span class="op" id="3557713">=</span>&nbsp;<span class="ident" id="3557715">z</span><span class="op" id="3557716">,</span>&nbsp;<span class="ident" id="3557718">zz</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3557723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3557728">if</span>&nbsp;<span class="builtinfunc" id="3557731">len</span><span class="op" id="3557734">(</span><span class="ident" id="3557735">m</span><span class="op" id="3557736">)</span>&nbsp;<span class="op" id="3557738">!=</span>&nbsp;<span class="num" id="3557741">0</span>&nbsp;<span class="op" id="3557743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3557748">zz</span><span class="op" id="3557750">,</span>&nbsp;<span class="ident" id="3557752">r</span>&nbsp;<span class="op" id="3557754">=</span>&nbsp;<span class="ident" id="3557756">zz</span><span class="op" id="3557758">.</span><span class="ident" id="3557759">div</span><span class="op" id="3557762">(</span><span class="ident" id="3557763">r</span><span class="op" id="3557764">,</span>&nbsp;<span class="ident" id="3557766">z</span><span class="op" id="3557767">,</span>&nbsp;<span class="ident" id="3557769">m</span><span class="op" id="3557770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3557775">zz</span><span class="op" id="3557777">,</span>&nbsp;<span class="ident" id="3557779">r</span><span class="op" id="3557780">,</span>&nbsp;<span class="ident" id="3557782">q</span><span class="op" id="3557783">,</span>&nbsp;<span class="ident" id="3557785">z</span>&nbsp;<span class="op" id="3557787">=</span>&nbsp;<span class="ident" id="3557789">q</span><span class="op" id="3557790">,</span>&nbsp;<span class="ident" id="3557792">z</span><span class="op" id="3557793">,</span>&nbsp;<span class="ident" id="3557795">zz</span><span class="op" id="3557797">,</span>&nbsp;<span class="ident" id="3557799">r</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3557803">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3557808">v</span>&nbsp;<span class="op" id="3557810">&lt;&lt;=</span>&nbsp;<span class="num" id="3557814">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3557817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3557821">for</span>&nbsp;<span class="ident" id="3557825">i</span>&nbsp;<span class="op" id="3557827">:=</span>&nbsp;<span class="builtinfunc" id="3557830">len</span><span class="op" id="3557833">(</span><span class="ident" id="3557834">y</span><span class="op" id="3557835">)</span>&nbsp;<span class="op" id="3557837">-</span>&nbsp;<span class="num" id="3557839">2</span><span class="op" id="3557840">;</span>&nbsp;<span class="ident" id="3557842">i</span>&nbsp;<span class="op" id="3557844">&gt;=</span>&nbsp;<span class="num" id="3557847">0</span><span class="op" id="3557848">;</span>&nbsp;<span class="ident" id="3557850">i</span><span class="op" id="3557851">--</span>&nbsp;<span class="op" id="3557854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3557858">v</span>&nbsp;<span class="op" id="3557860">=</span>&nbsp;<span class="ident" id="3557862">y</span><span class="op" id="3557863">[</span><span class="ident" id="3557864">i</span><span class="op" id="3557865">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3557870">for</span>&nbsp;<span class="ident" id="3557874">j</span>&nbsp;<span class="op" id="3557876">:=</span>&nbsp;<span class="num" id="3557879">0</span><span class="op" id="3557880">;</span>&nbsp;<span class="ident" id="3557882">j</span>&nbsp;<span class="op" id="3557884">&lt;</span>&nbsp;<span class="ident" id="3557886">_W</span><span class="op" id="3557888">;</span>&nbsp;<span class="ident" id="3557890">j</span><span class="op" id="3557891">++</span>&nbsp;<span class="op" id="3557894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3557899">zz</span>&nbsp;<span class="op" id="3557902">=</span>&nbsp;<span class="ident" id="3557904">zz</span><span class="op" id="3557906">.</span><span class="ident" id="3557907">mul</span><span class="op" id="3557910">(</span><span class="ident" id="3557911">z</span><span class="op" id="3557912">,</span>&nbsp;<span class="ident" id="3557914">z</span><span class="op" id="3557915">)</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3557920">zz</span><span class="op" id="3557922">,</span>&nbsp;<span class="ident" id="3557924">z</span>&nbsp;<span class="op" id="3557926">=</span>&nbsp;<span class="ident" id="3557928">z</span><span class="op" id="3557929">,</span>&nbsp;<span class="ident" id="3557931">zz</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3557938">if</span>&nbsp;<span class="ident" id="3557941">v</span><span class="op" id="3557942">&amp;</span><span class="ident" id="3557943">mask</span>&nbsp;<span class="op" id="3557948">!=</span>&nbsp;<span class="num" id="3557951">0</span>&nbsp;<span class="op" id="3557953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3557959">zz</span>&nbsp;<span class="op" id="3557962">=</span>&nbsp;<span class="ident" id="3557964">zz</span><span class="op" id="3557966">.</span><span class="ident" id="3557967">mul</span><span class="op" id="3557970">(</span><span class="ident" id="3557971">z</span><span class="op" id="3557972">,</span>&nbsp;<span class="ident" id="3557974">x</span><span class="op" id="3557975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3557981">zz</span><span class="op" id="3557983">,</span>&nbsp;<span class="ident" id="3557985">z</span>&nbsp;<span class="op" id="3557987">=</span>&nbsp;<span class="ident" id="3557989">z</span><span class="op" id="3557990">,</span>&nbsp;<span class="ident" id="3557992">zz</span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3557998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3558004">if</span>&nbsp;<span class="builtinfunc" id="3558007">len</span><span class="op" id="3558010">(</span><span class="ident" id="3558011">m</span><span class="op" id="3558012">)</span>&nbsp;<span class="op" id="3558014">!=</span>&nbsp;<span class="num" id="3558017">0</span>&nbsp;<span class="op" id="3558019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3558025">zz</span><span class="op" id="3558027">,</span>&nbsp;<span class="ident" id="3558029">r</span>&nbsp;<span class="op" id="3558031">=</span>&nbsp;<span class="ident" id="3558033">zz</span><span class="op" id="3558035">.</span><span class="ident" id="3558036">div</span><span class="op" id="3558039">(</span><span class="ident" id="3558040">r</span><span class="op" id="3558041">,</span>&nbsp;<span class="ident" id="3558043">z</span><span class="op" id="3558044">,</span>&nbsp;<span class="ident" id="3558046">m</span><span class="op" id="3558047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3558053">zz</span><span class="op" id="3558055">,</span>&nbsp;<span class="ident" id="3558057">r</span><span class="op" id="3558058">,</span>&nbsp;<span class="ident" id="3558060">q</span><span class="op" id="3558061">,</span>&nbsp;<span class="ident" id="3558063">z</span>&nbsp;<span class="op" id="3558065">=</span>&nbsp;<span class="ident" id="3558067">q</span><span class="op" id="3558068">,</span>&nbsp;<span class="ident" id="3558070">z</span><span class="op" id="3558071">,</span>&nbsp;<span class="ident" id="3558073">zz</span><span class="op" id="3558075">,</span>&nbsp;<span class="ident" id="3558077">r</span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3558082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3558088">v</span>&nbsp;<span class="op" id="3558090">&lt;&lt;=</span>&nbsp;<span class="num" id="3558094">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3558098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3558101">}</span><br>
<span class="lineno">1315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3558105">return</span>&nbsp;<span class="ident" id="3558112">z</span><span class="op" id="3558113">.</span><span class="ident" id="3558114">norm</span><span class="op" id="3558118">(</span><span class="op" id="3558119">)</span><br>
<span class="lineno"></span><span class="op" id="3558121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3558124">//&nbsp;expNNWindowed&nbsp;calculates&nbsp;x**y&nbsp;mod&nbsp;m&nbsp;using&nbsp;a&nbsp;fixed,&nbsp;4-bit&nbsp;window.</span><br>
<span class="lineno">1320</span><span class="keyword" id="3558192">func</span>&nbsp;<span class="op" id="3558197">(</span><span class="ident" id="3558198">z</span>&nbsp;<span class="ident" id="3558200">nat</span><span class="op" id="3558203">)</span>&nbsp;<span class="ident" id="3558205">expNNWindowed</span><span class="op" id="3558218">(</span><span class="ident" id="3558219">x</span><span class="op" id="3558220">,</span>&nbsp;<span class="ident" id="3558222">y</span><span class="op" id="3558223">,</span>&nbsp;<span class="ident" id="3558225">m</span>&nbsp;<span class="ident" id="3558227">nat</span><span class="op" id="3558230">)</span>&nbsp;<span class="ident" id="3558232">nat</span>&nbsp;<span class="op" id="3558236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3558239">//&nbsp;zz&nbsp;and&nbsp;r&nbsp;are&nbsp;used&nbsp;to&nbsp;avoid&nbsp;allocating&nbsp;in&nbsp;mul&nbsp;and&nbsp;div&nbsp;as&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3558309">//&nbsp;the&nbsp;arguments&nbsp;would&nbsp;alias.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3558340">var</span>&nbsp;<span class="ident" id="3558344">zz</span><span class="op" id="3558346">,</span>&nbsp;<span class="ident" id="3558348">r</span>&nbsp;<span class="ident" id="3558350">nat</span><br>
<span class="lineno"></span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3558356">const</span>&nbsp;<span class="ident" id="3558362">n</span>&nbsp;<span class="op" id="3558364">=</span>&nbsp;<span class="num" id="3558366">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3558369">//&nbsp;powers[i]&nbsp;contains&nbsp;x^i.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3558397">var</span>&nbsp;<span class="ident" id="3558401">powers</span>&nbsp;<span class="op" id="3558408">[</span><span class="num" id="3558409">1</span>&nbsp;<span class="op" id="3558411">&lt;&lt;</span>&nbsp;<span class="ident" id="3558414">n</span><span class="op" id="3558415">]</span><span class="ident" id="3558416">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3558421">powers</span><span class="op" id="3558427">[</span><span class="num" id="3558428">0</span><span class="op" id="3558429">]</span>&nbsp;<span class="op" id="3558431">=</span>&nbsp;<span class="ident" id="3558433">natOne</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3558441">powers</span><span class="op" id="3558447">[</span><span class="num" id="3558448">1</span><span class="op" id="3558449">]</span>&nbsp;<span class="op" id="3558451">=</span>&nbsp;<span class="ident" id="3558453">x</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3558456">for</span>&nbsp;<span class="ident" id="3558460">i</span>&nbsp;<span class="op" id="3558462">:=</span>&nbsp;<span class="num" id="3558465">2</span><span class="op" id="3558466">;</span>&nbsp;<span class="ident" id="3558468">i</span>&nbsp;<span class="op" id="3558470">&lt;</span>&nbsp;<span class="num" id="3558472">1</span><span class="op" id="3558473">&lt;&lt;</span><span class="ident" id="3558475">n</span><span class="op" id="3558476">;</span>&nbsp;<span class="ident" id="3558478">i</span>&nbsp;<span class="op" id="3558480">+=</span>&nbsp;<span class="num" id="3558483">2</span>&nbsp;<span class="op" id="3558485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3558489">p2</span><span class="op" id="3558491">,</span>&nbsp;<span class="ident" id="3558493">p</span><span class="op" id="3558494">,</span>&nbsp;<span class="ident" id="3558496">p1</span>&nbsp;<span class="op" id="3558499">:=</span>&nbsp;<span class="op" id="3558502">&amp;</span><span class="ident" id="3558503">powers</span><span class="op" id="3558509">[</span><span class="ident" id="3558510">i</span><span class="op" id="3558511">/</span><span class="num" id="3558512">2</span><span class="op" id="3558513">]</span><span class="op" id="3558514">,</span>&nbsp;<span class="op" id="3558516">&amp;</span><span class="ident" id="3558517">powers</span><span class="op" id="3558523">[</span><span class="ident" id="3558524">i</span><span class="op" id="3558525">]</span><span class="op" id="3558526">,</span>&nbsp;<span class="op" id="3558528">&amp;</span><span class="ident" id="3558529">powers</span><span class="op" id="3558535">[</span><span class="ident" id="3558536">i</span><span class="op" id="3558537">+</span><span class="num" id="3558538">1</span><span class="op" id="3558539">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3558543">*</span><span class="ident" id="3558544">p</span>&nbsp;<span class="op" id="3558546">=</span>&nbsp;<span class="ident" id="3558548">p</span><span class="op" id="3558549">.</span><span class="ident" id="3558550">mul</span><span class="op" id="3558553">(</span><span class="op" id="3558554">*</span><span class="ident" id="3558555">p2</span><span class="op" id="3558557">,</span>&nbsp;<span class="op" id="3558559">*</span><span class="ident" id="3558560">p2</span><span class="op" id="3558562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3558566">zz</span><span class="op" id="3558568">,</span>&nbsp;<span class="ident" id="3558570">r</span>&nbsp;<span class="op" id="3558572">=</span>&nbsp;<span class="ident" id="3558574">zz</span><span class="op" id="3558576">.</span><span class="ident" id="3558577">div</span><span class="op" id="3558580">(</span><span class="ident" id="3558581">r</span><span class="op" id="3558582">,</span>&nbsp;<span class="op" id="3558584">*</span><span class="ident" id="3558585">p</span><span class="op" id="3558586">,</span>&nbsp;<span class="ident" id="3558588">m</span><span class="op" id="3558589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3558593">*</span><span class="ident" id="3558594">p</span><span class="op" id="3558595">,</span>&nbsp;<span class="ident" id="3558597">r</span>&nbsp;<span class="op" id="3558599">=</span>&nbsp;<span class="ident" id="3558601">r</span><span class="op" id="3558602">,</span>&nbsp;<span class="op" id="3558604">*</span><span class="ident" id="3558605">p</span><br>
<span class="lineno">1335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3558609">*</span><span class="ident" id="3558610">p1</span>&nbsp;<span class="op" id="3558613">=</span>&nbsp;<span class="ident" id="3558615">p1</span><span class="op" id="3558617">.</span><span class="ident" id="3558618">mul</span><span class="op" id="3558621">(</span><span class="op" id="3558622">*</span><span class="ident" id="3558623">p</span><span class="op" id="3558624">,</span>&nbsp;<span class="ident" id="3558626">x</span><span class="op" id="3558627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3558631">zz</span><span class="op" id="3558633">,</span>&nbsp;<span class="ident" id="3558635">r</span>&nbsp;<span class="op" id="3558637">=</span>&nbsp;<span class="ident" id="3558639">zz</span><span class="op" id="3558641">.</span><span class="ident" id="3558642">div</span><span class="op" id="3558645">(</span><span class="ident" id="3558646">r</span><span class="op" id="3558647">,</span>&nbsp;<span class="op" id="3558649">*</span><span class="ident" id="3558650">p1</span><span class="op" id="3558652">,</span>&nbsp;<span class="ident" id="3558654">m</span><span class="op" id="3558655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3558659">*</span><span class="ident" id="3558660">p1</span><span class="op" id="3558662">,</span>&nbsp;<span class="ident" id="3558664">r</span>&nbsp;<span class="op" id="3558666">=</span>&nbsp;<span class="ident" id="3558668">r</span><span class="op" id="3558669">,</span>&nbsp;<span class="op" id="3558671">*</span><span class="ident" id="3558672">p1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3558676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3558680">z</span>&nbsp;<span class="op" id="3558682">=</span>&nbsp;<span class="ident" id="3558684">z</span><span class="op" id="3558685">.</span><span class="ident" id="3558686">setWord</span><span class="op" id="3558693">(</span><span class="num" id="3558694">1</span><span class="op" id="3558695">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3558699">for</span>&nbsp;<span class="ident" id="3558703">i</span>&nbsp;<span class="op" id="3558705">:=</span>&nbsp;<span class="builtinfunc" id="3558708">len</span><span class="op" id="3558711">(</span><span class="ident" id="3558712">y</span><span class="op" id="3558713">)</span>&nbsp;<span class="op" id="3558715">-</span>&nbsp;<span class="num" id="3558717">1</span><span class="op" id="3558718">;</span>&nbsp;<span class="ident" id="3558720">i</span>&nbsp;<span class="op" id="3558722">&gt;=</span>&nbsp;<span class="num" id="3558725">0</span><span class="op" id="3558726">;</span>&nbsp;<span class="ident" id="3558728">i</span><span class="op" id="3558729">--</span>&nbsp;<span class="op" id="3558732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3558736">yi</span>&nbsp;<span class="op" id="3558739">:=</span>&nbsp;<span class="ident" id="3558742">y</span><span class="op" id="3558743">[</span><span class="ident" id="3558744">i</span><span class="op" id="3558745">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3558749">for</span>&nbsp;<span class="ident" id="3558753">j</span>&nbsp;<span class="op" id="3558755">:=</span>&nbsp;<span class="num" id="3558758">0</span><span class="op" id="3558759">;</span>&nbsp;<span class="ident" id="3558761">j</span>&nbsp;<span class="op" id="3558763">&lt;</span>&nbsp;<span class="ident" id="3558765">_W</span><span class="op" id="3558767">;</span>&nbsp;<span class="ident" id="3558769">j</span>&nbsp;<span class="op" id="3558771">+=</span>&nbsp;<span class="ident" id="3558774">n</span>&nbsp;<span class="op" id="3558776">{</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3558781">if</span>&nbsp;<span class="ident" id="3558784">i</span>&nbsp;<span class="op" id="3558786">!=</span>&nbsp;<span class="builtinfunc" id="3558789">len</span><span class="op" id="3558792">(</span><span class="ident" id="3558793">y</span><span class="op" id="3558794">)</span><span class="op" id="3558795">-</span><span class="num" id="3558796">1</span>&nbsp;<span class="op" id="3558798">||</span>&nbsp;<span class="ident" id="3558801">j</span>&nbsp;<span class="op" id="3558803">!=</span>&nbsp;<span class="num" id="3558806">0</span>&nbsp;<span class="op" id="3558808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3558814">//&nbsp;Unrolled&nbsp;loop&nbsp;for&nbsp;significant&nbsp;performance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3558863">//&nbsp;gain.&nbsp;&nbsp;Use&nbsp;go&nbsp;test&nbsp;-bench=&#34;.*&#34;&nbsp;in&nbsp;crypto/rsa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3558915">//&nbsp;to&nbsp;check&nbsp;performance&nbsp;before&nbsp;making&nbsp;changes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3558966">zz</span>&nbsp;<span class="op" id="3558969">=</span>&nbsp;<span class="ident" id="3558971">zz</span><span class="op" id="3558973">.</span><span class="ident" id="3558974">mul</span><span class="op" id="3558977">(</span><span class="ident" id="3558978">z</span><span class="op" id="3558979">,</span>&nbsp;<span class="ident" id="3558981">z</span><span class="op" id="3558982">)</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3558988">zz</span><span class="op" id="3558990">,</span>&nbsp;<span class="ident" id="3558992">z</span>&nbsp;<span class="op" id="3558994">=</span>&nbsp;<span class="ident" id="3558996">z</span><span class="op" id="3558997">,</span>&nbsp;<span class="ident" id="3558999">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3559006">zz</span><span class="op" id="3559008">,</span>&nbsp;<span class="ident" id="3559010">r</span>&nbsp;<span class="op" id="3559012">=</span>&nbsp;<span class="ident" id="3559014">zz</span><span class="op" id="3559016">.</span><span class="ident" id="3559017">div</span><span class="op" id="3559020">(</span><span class="ident" id="3559021">r</span><span class="op" id="3559022">,</span>&nbsp;<span class="ident" id="3559024">z</span><span class="op" id="3559025">,</span>&nbsp;<span class="ident" id="3559027">m</span><span class="op" id="3559028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3559034">z</span><span class="op" id="3559035">,</span>&nbsp;<span class="ident" id="3559037">r</span>&nbsp;<span class="op" id="3559039">=</span>&nbsp;<span class="ident" id="3559041">r</span><span class="op" id="3559042">,</span>&nbsp;<span class="ident" id="3559044">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3559051">zz</span>&nbsp;<span class="op" id="3559054">=</span>&nbsp;<span class="ident" id="3559056">zz</span><span class="op" id="3559058">.</span><span class="ident" id="3559059">mul</span><span class="op" id="3559062">(</span><span class="ident" id="3559063">z</span><span class="op" id="3559064">,</span>&nbsp;<span class="ident" id="3559066">z</span><span class="op" id="3559067">)</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3559073">zz</span><span class="op" id="3559075">,</span>&nbsp;<span class="ident" id="3559077">z</span>&nbsp;<span class="op" id="3559079">=</span>&nbsp;<span class="ident" id="3559081">z</span><span class="op" id="3559082">,</span>&nbsp;<span class="ident" id="3559084">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3559091">zz</span><span class="op" id="3559093">,</span>&nbsp;<span class="ident" id="3559095">r</span>&nbsp;<span class="op" id="3559097">=</span>&nbsp;<span class="ident" id="3559099">zz</span><span class="op" id="3559101">.</span><span class="ident" id="3559102">div</span><span class="op" id="3559105">(</span><span class="ident" id="3559106">r</span><span class="op" id="3559107">,</span>&nbsp;<span class="ident" id="3559109">z</span><span class="op" id="3559110">,</span>&nbsp;<span class="ident" id="3559112">m</span><span class="op" id="3559113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3559119">z</span><span class="op" id="3559120">,</span>&nbsp;<span class="ident" id="3559122">r</span>&nbsp;<span class="op" id="3559124">=</span>&nbsp;<span class="ident" id="3559126">r</span><span class="op" id="3559127">,</span>&nbsp;<span class="ident" id="3559129">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3559136">zz</span>&nbsp;<span class="op" id="3559139">=</span>&nbsp;<span class="ident" id="3559141">zz</span><span class="op" id="3559143">.</span><span class="ident" id="3559144">mul</span><span class="op" id="3559147">(</span><span class="ident" id="3559148">z</span><span class="op" id="3559149">,</span>&nbsp;<span class="ident" id="3559151">z</span><span class="op" id="3559152">)</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3559158">zz</span><span class="op" id="3559160">,</span>&nbsp;<span class="ident" id="3559162">z</span>&nbsp;<span class="op" id="3559164">=</span>&nbsp;<span class="ident" id="3559166">z</span><span class="op" id="3559167">,</span>&nbsp;<span class="ident" id="3559169">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3559176">zz</span><span class="op" id="3559178">,</span>&nbsp;<span class="ident" id="3559180">r</span>&nbsp;<span class="op" id="3559182">=</span>&nbsp;<span class="ident" id="3559184">zz</span><span class="op" id="3559186">.</span><span class="ident" id="3559187">div</span><span class="op" id="3559190">(</span><span class="ident" id="3559191">r</span><span class="op" id="3559192">,</span>&nbsp;<span class="ident" id="3559194">z</span><span class="op" id="3559195">,</span>&nbsp;<span class="ident" id="3559197">m</span><span class="op" id="3559198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3559204">z</span><span class="op" id="3559205">,</span>&nbsp;<span class="ident" id="3559207">r</span>&nbsp;<span class="op" id="3559209">=</span>&nbsp;<span class="ident" id="3559211">r</span><span class="op" id="3559212">,</span>&nbsp;<span class="ident" id="3559214">z</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3559221">zz</span>&nbsp;<span class="op" id="3559224">=</span>&nbsp;<span class="ident" id="3559226">zz</span><span class="op" id="3559228">.</span><span class="ident" id="3559229">mul</span><span class="op" id="3559232">(</span><span class="ident" id="3559233">z</span><span class="op" id="3559234">,</span>&nbsp;<span class="ident" id="3559236">z</span><span class="op" id="3559237">)</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3559243">zz</span><span class="op" id="3559245">,</span>&nbsp;<span class="ident" id="3559247">z</span>&nbsp;<span class="op" id="3559249">=</span>&nbsp;<span class="ident" id="3559251">z</span><span class="op" id="3559252">,</span>&nbsp;<span class="ident" id="3559254">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3559261">zz</span><span class="op" id="3559263">,</span>&nbsp;<span class="ident" id="3559265">r</span>&nbsp;<span class="op" id="3559267">=</span>&nbsp;<span class="ident" id="3559269">zz</span><span class="op" id="3559271">.</span><span class="ident" id="3559272">div</span><span class="op" id="3559275">(</span><span class="ident" id="3559276">r</span><span class="op" id="3559277">,</span>&nbsp;<span class="ident" id="3559279">z</span><span class="op" id="3559280">,</span>&nbsp;<span class="ident" id="3559282">m</span><span class="op" id="3559283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3559289">z</span><span class="op" id="3559290">,</span>&nbsp;<span class="ident" id="3559292">r</span>&nbsp;<span class="op" id="3559294">=</span>&nbsp;<span class="ident" id="3559296">r</span><span class="op" id="3559297">,</span>&nbsp;<span class="ident" id="3559299">z</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3559304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3559310">zz</span>&nbsp;<span class="op" id="3559313">=</span>&nbsp;<span class="ident" id="3559315">zz</span><span class="op" id="3559317">.</span><span class="ident" id="3559318">mul</span><span class="op" id="3559321">(</span><span class="ident" id="3559322">z</span><span class="op" id="3559323">,</span>&nbsp;<span class="ident" id="3559325">powers</span><span class="op" id="3559331">[</span><span class="ident" id="3559332">yi</span><span class="op" id="3559334">&gt;&gt;</span><span class="op" id="3559336">(</span><span class="ident" id="3559337">_W</span><span class="op" id="3559339">-</span><span class="ident" id="3559340">n</span><span class="op" id="3559341">)</span><span class="op" id="3559342">]</span><span class="op" id="3559343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3559348">zz</span><span class="op" id="3559350">,</span>&nbsp;<span class="ident" id="3559352">z</span>&nbsp;<span class="op" id="3559354">=</span>&nbsp;<span class="ident" id="3559356">z</span><span class="op" id="3559357">,</span>&nbsp;<span class="ident" id="3559359">zz</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3559365">zz</span><span class="op" id="3559367">,</span>&nbsp;<span class="ident" id="3559369">r</span>&nbsp;<span class="op" id="3559371">=</span>&nbsp;<span class="ident" id="3559373">zz</span><span class="op" id="3559375">.</span><span class="ident" id="3559376">div</span><span class="op" id="3559379">(</span><span class="ident" id="3559380">r</span><span class="op" id="3559381">,</span>&nbsp;<span class="ident" id="3559383">z</span><span class="op" id="3559384">,</span>&nbsp;<span class="ident" id="3559386">m</span><span class="op" id="3559387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3559392">z</span><span class="op" id="3559393">,</span>&nbsp;<span class="ident" id="3559395">r</span>&nbsp;<span class="op" id="3559397">=</span>&nbsp;<span class="ident" id="3559399">r</span><span class="op" id="3559400">,</span>&nbsp;<span class="ident" id="3559402">z</span><br>
<span class="lineno"></span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3559408">yi</span>&nbsp;<span class="op" id="3559411">&lt;&lt;=</span>&nbsp;<span class="ident" id="3559415">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3559419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3559422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3559426">return</span>&nbsp;<span class="ident" id="3559433">z</span><span class="op" id="3559434">.</span><span class="ident" id="3559435">norm</span><span class="op" id="3559439">(</span><span class="op" id="3559440">)</span><br>
<span class="lineno">1380</span><span class="op" id="3559442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3559445">//&nbsp;probablyPrime&nbsp;performs&nbsp;reps&nbsp;Miller-Rabin&nbsp;tests&nbsp;to&nbsp;check&nbsp;whether&nbsp;n&nbsp;is&nbsp;prime.</span><br>
<span class="lineno"></span><span class="comment" id="3559524">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;true,&nbsp;n&nbsp;is&nbsp;prime&nbsp;with&nbsp;probability&nbsp;1&nbsp;-&nbsp;1/4^reps.</span><br>
<span class="lineno"></span><span class="comment" id="3559589">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;false,&nbsp;n&nbsp;is&nbsp;not&nbsp;prime.</span><br>
<span class="lineno">1385</span><span class="keyword" id="3559629">func</span>&nbsp;<span class="op" id="3559634">(</span><span class="ident" id="3559635">n</span>&nbsp;<span class="ident" id="3559637">nat</span><span class="op" id="3559640">)</span>&nbsp;<span class="ident" id="3559642">probablyPrime</span><span class="op" id="3559655">(</span><span class="ident" id="3559656">reps</span>&nbsp;<span class="builtintype" id="3559661">int</span><span class="op" id="3559664">)</span>&nbsp;<span class="builtintype" id="3559666">bool</span>&nbsp;<span class="op" id="3559671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3559674">if</span>&nbsp;<span class="builtinfunc" id="3559677">len</span><span class="op" id="3559680">(</span><span class="ident" id="3559681">n</span><span class="op" id="3559682">)</span>&nbsp;<span class="op" id="3559684">==</span>&nbsp;<span class="num" id="3559687">0</span>&nbsp;<span class="op" id="3559689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3559693">return</span>&nbsp;<span class="builtintype" id="3559700">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3559707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3559711">if</span>&nbsp;<span class="builtinfunc" id="3559714">len</span><span class="op" id="3559717">(</span><span class="ident" id="3559718">n</span><span class="op" id="3559719">)</span>&nbsp;<span class="op" id="3559721">==</span>&nbsp;<span class="num" id="3559724">1</span>&nbsp;<span class="op" id="3559726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3559730">if</span>&nbsp;<span class="ident" id="3559733">n</span><span class="op" id="3559734">[</span><span class="num" id="3559735">0</span><span class="op" id="3559736">]</span>&nbsp;<span class="op" id="3559738">&lt;</span>&nbsp;<span class="num" id="3559740">2</span>&nbsp;<span class="op" id="3559742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3559747">return</span>&nbsp;<span class="builtintype" id="3559754">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3559762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3559767">if</span>&nbsp;<span class="ident" id="3559770">n</span><span class="op" id="3559771">[</span><span class="num" id="3559772">0</span><span class="op" id="3559773">]</span><span class="op" id="3559774">%</span><span class="num" id="3559775">2</span>&nbsp;<span class="op" id="3559777">==</span>&nbsp;<span class="num" id="3559780">0</span>&nbsp;<span class="op" id="3559782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3559787">return</span>&nbsp;<span class="ident" id="3559794">n</span><span class="op" id="3559795">[</span><span class="num" id="3559796">0</span><span class="op" id="3559797">]</span>&nbsp;<span class="op" id="3559799">==</span>&nbsp;<span class="num" id="3559802">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3559806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3559811">//&nbsp;We&nbsp;have&nbsp;to&nbsp;exclude&nbsp;these&nbsp;cases&nbsp;because&nbsp;we&nbsp;reject&nbsp;all</span><br>
<span class="lineno">1400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3559869">//&nbsp;multiples&nbsp;of&nbsp;these&nbsp;numbers&nbsp;below.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3559908">switch</span>&nbsp;<span class="ident" id="3559915">n</span><span class="op" id="3559916">[</span><span class="num" id="3559917">0</span><span class="op" id="3559918">]</span>&nbsp;<span class="op" id="3559920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3559924">case</span>&nbsp;<span class="num" id="3559929">3</span><span class="op" id="3559930">,</span>&nbsp;<span class="num" id="3559932">5</span><span class="op" id="3559933">,</span>&nbsp;<span class="num" id="3559935">7</span><span class="op" id="3559936">,</span>&nbsp;<span class="num" id="3559938">11</span><span class="op" id="3559940">,</span>&nbsp;<span class="num" id="3559942">13</span><span class="op" id="3559944">,</span>&nbsp;<span class="num" id="3559946">17</span><span class="op" id="3559948">,</span>&nbsp;<span class="num" id="3559950">19</span><span class="op" id="3559952">,</span>&nbsp;<span class="num" id="3559954">23</span><span class="op" id="3559956">,</span>&nbsp;<span class="num" id="3559958">29</span><span class="op" id="3559960">,</span>&nbsp;<span class="num" id="3559962">31</span><span class="op" id="3559964">,</span>&nbsp;<span class="num" id="3559966">37</span><span class="op" id="3559968">,</span>&nbsp;<span class="num" id="3559970">41</span><span class="op" id="3559972">,</span>&nbsp;<span class="num" id="3559974">43</span><span class="op" id="3559976">,</span>&nbsp;<span class="num" id="3559978">47</span><span class="op" id="3559980">,</span>&nbsp;<span class="num" id="3559982">53</span><span class="op" id="3559984">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3559989">return</span>&nbsp;<span class="builtintype" id="3559996">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3560003">}</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3560006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560010">const</span>&nbsp;<span class="ident" id="3560016">primesProduct32</span>&nbsp;<span class="op" id="3560032">=</span>&nbsp;<span class="num" id="3560034">0xC0CFD797</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3560053">//&nbsp;&nbsp;{p&nbsp;&nbsp;primes,&nbsp;2&nbsp;&lt;&nbsp;p&nbsp;&lt;=&nbsp;29}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560088">const</span>&nbsp;<span class="ident" id="3560094">primesProduct64</span>&nbsp;<span class="op" id="3560110">=</span>&nbsp;<span class="num" id="3560112">0xE221F97C30E94E1D</span>&nbsp;<span class="comment" id="3560131">//&nbsp;&nbsp;{p&nbsp;&nbsp;primes,&nbsp;2&nbsp;&lt;&nbsp;p&nbsp;&lt;=&nbsp;53}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560167">var</span>&nbsp;<span class="ident" id="3560171">r</span>&nbsp;<span class="ident" id="3560173">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560179">switch</span>&nbsp;<span class="ident" id="3560186">_W</span>&nbsp;<span class="op" id="3560189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560192">case</span>&nbsp;<span class="num" id="3560197">32</span><span class="op" id="3560199">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560203">r</span>&nbsp;<span class="op" id="3560205">=</span>&nbsp;<span class="ident" id="3560207">n</span><span class="op" id="3560208">.</span><span class="ident" id="3560209">modW</span><span class="op" id="3560213">(</span><span class="ident" id="3560214">primesProduct32</span><span class="op" id="3560229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560232">case</span>&nbsp;<span class="num" id="3560237">64</span><span class="op" id="3560239">:</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560243">r</span>&nbsp;<span class="op" id="3560245">=</span>&nbsp;<span class="ident" id="3560247">n</span><span class="op" id="3560248">.</span><span class="ident" id="3560249">modW</span><span class="op" id="3560253">(</span><span class="ident" id="3560254">primesProduct64</span>&nbsp;<span class="op" id="3560270">&amp;</span>&nbsp;<span class="ident" id="3560272">_M</span><span class="op" id="3560274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560277">default</span><span class="op" id="3560284">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3560288">panic</span><span class="op" id="3560293">(</span><span class="string" id="3560294">&#34;Unknown&nbsp;word&nbsp;size&#34;</span><span class="op" id="3560313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3560316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560320">if</span>&nbsp;<span class="ident" id="3560323">r</span><span class="op" id="3560324">%</span><span class="num" id="3560325">3</span>&nbsp;<span class="op" id="3560327">==</span>&nbsp;<span class="num" id="3560330">0</span>&nbsp;<span class="op" id="3560332">||</span>&nbsp;<span class="ident" id="3560335">r</span><span class="op" id="3560336">%</span><span class="num" id="3560337">5</span>&nbsp;<span class="op" id="3560339">==</span>&nbsp;<span class="num" id="3560342">0</span>&nbsp;<span class="op" id="3560344">||</span>&nbsp;<span class="ident" id="3560347">r</span><span class="op" id="3560348">%</span><span class="num" id="3560349">7</span>&nbsp;<span class="op" id="3560351">==</span>&nbsp;<span class="num" id="3560354">0</span>&nbsp;<span class="op" id="3560356">||</span>&nbsp;<span class="ident" id="3560359">r</span><span class="op" id="3560360">%</span><span class="num" id="3560361">11</span>&nbsp;<span class="op" id="3560364">==</span>&nbsp;<span class="num" id="3560367">0</span>&nbsp;<span class="op" id="3560369">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560374">r</span><span class="op" id="3560375">%</span><span class="num" id="3560376">13</span>&nbsp;<span class="op" id="3560379">==</span>&nbsp;<span class="num" id="3560382">0</span>&nbsp;<span class="op" id="3560384">||</span>&nbsp;<span class="ident" id="3560387">r</span><span class="op" id="3560388">%</span><span class="num" id="3560389">17</span>&nbsp;<span class="op" id="3560392">==</span>&nbsp;<span class="num" id="3560395">0</span>&nbsp;<span class="op" id="3560397">||</span>&nbsp;<span class="ident" id="3560400">r</span><span class="op" id="3560401">%</span><span class="num" id="3560402">19</span>&nbsp;<span class="op" id="3560405">==</span>&nbsp;<span class="num" id="3560408">0</span>&nbsp;<span class="op" id="3560410">||</span>&nbsp;<span class="ident" id="3560413">r</span><span class="op" id="3560414">%</span><span class="num" id="3560415">23</span>&nbsp;<span class="op" id="3560418">==</span>&nbsp;<span class="num" id="3560421">0</span>&nbsp;<span class="op" id="3560423">||</span>&nbsp;<span class="ident" id="3560426">r</span><span class="op" id="3560427">%</span><span class="num" id="3560428">29</span>&nbsp;<span class="op" id="3560431">==</span>&nbsp;<span class="num" id="3560434">0</span>&nbsp;<span class="op" id="3560436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560440">return</span>&nbsp;<span class="builtintype" id="3560447">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3560454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560458">if</span>&nbsp;<span class="ident" id="3560461">_W</span>&nbsp;<span class="op" id="3560464">==</span>&nbsp;<span class="num" id="3560467">64</span>&nbsp;<span class="op" id="3560470">&amp;&amp;</span>&nbsp;<span class="op" id="3560473">(</span><span class="ident" id="3560474">r</span><span class="op" id="3560475">%</span><span class="num" id="3560476">31</span>&nbsp;<span class="op" id="3560479">==</span>&nbsp;<span class="num" id="3560482">0</span>&nbsp;<span class="op" id="3560484">||</span>&nbsp;<span class="ident" id="3560487">r</span><span class="op" id="3560488">%</span><span class="num" id="3560489">37</span>&nbsp;<span class="op" id="3560492">==</span>&nbsp;<span class="num" id="3560495">0</span>&nbsp;<span class="op" id="3560497">||</span>&nbsp;<span class="ident" id="3560500">r</span><span class="op" id="3560501">%</span><span class="num" id="3560502">41</span>&nbsp;<span class="op" id="3560505">==</span>&nbsp;<span class="num" id="3560508">0</span>&nbsp;<span class="op" id="3560510">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560515">r</span><span class="op" id="3560516">%</span><span class="num" id="3560517">43</span>&nbsp;<span class="op" id="3560520">==</span>&nbsp;<span class="num" id="3560523">0</span>&nbsp;<span class="op" id="3560525">||</span>&nbsp;<span class="ident" id="3560528">r</span><span class="op" id="3560529">%</span><span class="num" id="3560530">47</span>&nbsp;<span class="op" id="3560533">==</span>&nbsp;<span class="num" id="3560536">0</span>&nbsp;<span class="op" id="3560538">||</span>&nbsp;<span class="ident" id="3560541">r</span><span class="op" id="3560542">%</span><span class="num" id="3560543">53</span>&nbsp;<span class="op" id="3560546">==</span>&nbsp;<span class="num" id="3560549">0</span><span class="op" id="3560550">)</span>&nbsp;<span class="op" id="3560552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560556">return</span>&nbsp;<span class="builtintype" id="3560563">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3560570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560574">nm1</span>&nbsp;<span class="op" id="3560578">:=</span>&nbsp;<span class="ident" id="3560581">nat</span><span class="op" id="3560584">(</span><span class="ident" id="3560585">nil</span><span class="op" id="3560588">)</span><span class="op" id="3560589">.</span><span class="ident" id="3560590">sub</span><span class="op" id="3560593">(</span><span class="ident" id="3560594">n</span><span class="op" id="3560595">,</span>&nbsp;<span class="ident" id="3560597">natOne</span><span class="op" id="3560603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3560606">//&nbsp;determine&nbsp;q,&nbsp;k&nbsp;such&nbsp;that&nbsp;nm1&nbsp;=&nbsp;q&nbsp;&lt;&lt;&nbsp;k</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560648">k</span>&nbsp;<span class="op" id="3560650">:=</span>&nbsp;<span class="ident" id="3560653">nm1</span><span class="op" id="3560656">.</span><span class="ident" id="3560657">trailingZeroBits</span><span class="op" id="3560673">(</span><span class="op" id="3560674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560677">q</span>&nbsp;<span class="op" id="3560679">:=</span>&nbsp;<span class="ident" id="3560682">nat</span><span class="op" id="3560685">(</span><span class="ident" id="3560686">nil</span><span class="op" id="3560689">)</span><span class="op" id="3560690">.</span><span class="ident" id="3560691">shr</span><span class="op" id="3560694">(</span><span class="ident" id="3560695">nm1</span><span class="op" id="3560698">,</span>&nbsp;<span class="ident" id="3560700">k</span><span class="op" id="3560701">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560705">nm3</span>&nbsp;<span class="op" id="3560709">:=</span>&nbsp;<span class="ident" id="3560712">nat</span><span class="op" id="3560715">(</span><span class="ident" id="3560716">nil</span><span class="op" id="3560719">)</span><span class="op" id="3560720">.</span><span class="ident" id="3560721">sub</span><span class="op" id="3560724">(</span><span class="ident" id="3560725">nm1</span><span class="op" id="3560728">,</span>&nbsp;<span class="ident" id="3560730">natTwo</span><span class="op" id="3560736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560739">rand</span>&nbsp;<span class="op" id="3560744">:=</span>&nbsp;<span class="ident" id="3560747">rand</span><span class="op" id="3560751">.</span><span class="ident" id="3560752">New</span><span class="op" id="3560755">(</span><span class="ident" id="3560756">rand</span><span class="op" id="3560760">.</span><span class="ident" id="3560761">NewSource</span><span class="op" id="3560770">(</span><span class="ident" id="3560771">int64</span><span class="op" id="3560776">(</span><span class="ident" id="3560777">n</span><span class="op" id="3560778">[</span><span class="num" id="3560779">0</span><span class="op" id="3560780">]</span><span class="op" id="3560781">)</span><span class="op" id="3560782">)</span><span class="op" id="3560783">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560787">var</span>&nbsp;<span class="ident" id="3560791">x</span><span class="op" id="3560792">,</span>&nbsp;<span class="ident" id="3560794">y</span><span class="op" id="3560795">,</span>&nbsp;<span class="ident" id="3560797">quotient</span>&nbsp;<span class="ident" id="3560806">nat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560811">nm3Len</span>&nbsp;<span class="op" id="3560818">:=</span>&nbsp;<span class="ident" id="3560821">nm3</span><span class="op" id="3560824">.</span><span class="ident" id="3560825">bitLen</span><span class="op" id="3560831">(</span><span class="op" id="3560832">)</span><br>
<span class="lineno">1440</span><br>
<span class="lineno"></span><span class="ident" id="3560835">NextRandom</span><span class="op" id="3560845">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560848">for</span>&nbsp;<span class="ident" id="3560852">i</span>&nbsp;<span class="op" id="3560854">:=</span>&nbsp;<span class="num" id="3560857">0</span><span class="op" id="3560858">;</span>&nbsp;<span class="ident" id="3560860">i</span>&nbsp;<span class="op" id="3560862">&lt;</span>&nbsp;<span class="ident" id="3560864">reps</span><span class="op" id="3560868">;</span>&nbsp;<span class="ident" id="3560870">i</span><span class="op" id="3560871">++</span>&nbsp;<span class="op" id="3560874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560878">x</span>&nbsp;<span class="op" id="3560880">=</span>&nbsp;<span class="ident" id="3560882">x</span><span class="op" id="3560883">.</span><span class="ident" id="3560884">random</span><span class="op" id="3560890">(</span><span class="ident" id="3560891">rand</span><span class="op" id="3560895">,</span>&nbsp;<span class="ident" id="3560897">nm3</span><span class="op" id="3560900">,</span>&nbsp;<span class="ident" id="3560902">nm3Len</span><span class="op" id="3560908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560912">x</span>&nbsp;<span class="op" id="3560914">=</span>&nbsp;<span class="ident" id="3560916">x</span><span class="op" id="3560917">.</span><span class="ident" id="3560918">add</span><span class="op" id="3560921">(</span><span class="ident" id="3560922">x</span><span class="op" id="3560923">,</span>&nbsp;<span class="ident" id="3560925">natTwo</span><span class="op" id="3560931">)</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3560935">y</span>&nbsp;<span class="op" id="3560937">=</span>&nbsp;<span class="ident" id="3560939">y</span><span class="op" id="3560940">.</span><span class="ident" id="3560941">expNN</span><span class="op" id="3560946">(</span><span class="ident" id="3560947">x</span><span class="op" id="3560948">,</span>&nbsp;<span class="ident" id="3560950">q</span><span class="op" id="3560951">,</span>&nbsp;<span class="ident" id="3560953">n</span><span class="op" id="3560954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3560958">if</span>&nbsp;<span class="ident" id="3560961">y</span><span class="op" id="3560962">.</span><span class="ident" id="3560963">cmp</span><span class="op" id="3560966">(</span><span class="ident" id="3560967">natOne</span><span class="op" id="3560973">)</span>&nbsp;<span class="op" id="3560975">==</span>&nbsp;<span class="num" id="3560978">0</span>&nbsp;<span class="op" id="3560980">||</span>&nbsp;<span class="ident" id="3560983">y</span><span class="op" id="3560984">.</span><span class="ident" id="3560985">cmp</span><span class="op" id="3560988">(</span><span class="ident" id="3560989">nm1</span><span class="op" id="3560992">)</span>&nbsp;<span class="op" id="3560994">==</span>&nbsp;<span class="num" id="3560997">0</span>&nbsp;<span class="op" id="3560999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561004">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3561015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561019">for</span>&nbsp;<span class="ident" id="3561023">j</span>&nbsp;<span class="op" id="3561025">:=</span>&nbsp;<span class="builtintype" id="3561028">uint</span><span class="op" id="3561032">(</span><span class="num" id="3561033">1</span><span class="op" id="3561034">)</span><span class="op" id="3561035">;</span>&nbsp;<span class="ident" id="3561037">j</span>&nbsp;<span class="op" id="3561039">&lt;</span>&nbsp;<span class="ident" id="3561041">k</span><span class="op" id="3561042">;</span>&nbsp;<span class="ident" id="3561044">j</span><span class="op" id="3561045">++</span>&nbsp;<span class="op" id="3561048">{</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561053">y</span>&nbsp;<span class="op" id="3561055">=</span>&nbsp;<span class="ident" id="3561057">y</span><span class="op" id="3561058">.</span><span class="ident" id="3561059">mul</span><span class="op" id="3561062">(</span><span class="ident" id="3561063">y</span><span class="op" id="3561064">,</span>&nbsp;<span class="ident" id="3561066">y</span><span class="op" id="3561067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561072">quotient</span><span class="op" id="3561080">,</span>&nbsp;<span class="ident" id="3561082">y</span>&nbsp;<span class="op" id="3561084">=</span>&nbsp;<span class="ident" id="3561086">quotient</span><span class="op" id="3561094">.</span><span class="ident" id="3561095">div</span><span class="op" id="3561098">(</span><span class="ident" id="3561099">y</span><span class="op" id="3561100">,</span>&nbsp;<span class="ident" id="3561102">y</span><span class="op" id="3561103">,</span>&nbsp;<span class="ident" id="3561105">n</span><span class="op" id="3561106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561111">if</span>&nbsp;<span class="ident" id="3561114">y</span><span class="op" id="3561115">.</span><span class="ident" id="3561116">cmp</span><span class="op" id="3561119">(</span><span class="ident" id="3561120">nm1</span><span class="op" id="3561123">)</span>&nbsp;<span class="op" id="3561125">==</span>&nbsp;<span class="num" id="3561128">0</span>&nbsp;<span class="op" id="3561130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561136">continue</span>&nbsp;<span class="ident" id="3561145">NextRandom</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3561159">}</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561164">if</span>&nbsp;<span class="ident" id="3561167">y</span><span class="op" id="3561168">.</span><span class="ident" id="3561169">cmp</span><span class="op" id="3561172">(</span><span class="ident" id="3561173">natOne</span><span class="op" id="3561179">)</span>&nbsp;<span class="op" id="3561181">==</span>&nbsp;<span class="num" id="3561184">0</span>&nbsp;<span class="op" id="3561186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561192">return</span>&nbsp;<span class="builtintype" id="3561199">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3561208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3561212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561216">return</span>&nbsp;<span class="builtintype" id="3561223">false</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3561230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561234">return</span>&nbsp;<span class="builtintype" id="3561241">true</span><br>
<span class="lineno"></span><span class="op" id="3561246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1465</span><span class="comment" id="3561249">//&nbsp;bytes&nbsp;writes&nbsp;the&nbsp;value&nbsp;of&nbsp;z&nbsp;into&nbsp;buf&nbsp;using&nbsp;big-endian&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="3561316">//&nbsp;len(buf)&nbsp;must&nbsp;be&nbsp;&gt;=&nbsp;len(z)*_S.&nbsp;The&nbsp;value&nbsp;of&nbsp;z&nbsp;is&nbsp;encoded&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3561383">//&nbsp;slice&nbsp;buf[i:].&nbsp;The&nbsp;number&nbsp;i&nbsp;of&nbsp;unused&nbsp;bytes&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3561450">//&nbsp;buf&nbsp;is&nbsp;returned&nbsp;as&nbsp;result.</span><br>
<span class="lineno"></span><span class="keyword" id="3561480">func</span>&nbsp;<span class="op" id="3561485">(</span><span class="ident" id="3561486">z</span>&nbsp;<span class="ident" id="3561488">nat</span><span class="op" id="3561491">)</span>&nbsp;<span class="ident" id="3561493">bytes</span><span class="op" id="3561498">(</span><span class="ident" id="3561499">buf</span>&nbsp;<span class="op" id="3561503">[</span><span class="op" id="3561504">]</span><span class="builtintype" id="3561505">byte</span><span class="op" id="3561509">)</span>&nbsp;<span class="op" id="3561511">(</span><span class="ident" id="3561512">i</span>&nbsp;<span class="builtintype" id="3561514">int</span><span class="op" id="3561517">)</span>&nbsp;<span class="op" id="3561519">{</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561522">i</span>&nbsp;<span class="op" id="3561524">=</span>&nbsp;<span class="builtinfunc" id="3561526">len</span><span class="op" id="3561529">(</span><span class="ident" id="3561530">buf</span><span class="op" id="3561533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561536">for</span>&nbsp;<span class="ident" id="3561540">_</span><span class="op" id="3561541">,</span>&nbsp;<span class="ident" id="3561543">d</span>&nbsp;<span class="op" id="3561545">:=</span>&nbsp;<span class="keyword" id="3561548">range</span>&nbsp;<span class="ident" id="3561554">z</span>&nbsp;<span class="op" id="3561556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561560">for</span>&nbsp;<span class="ident" id="3561564">j</span>&nbsp;<span class="op" id="3561566">:=</span>&nbsp;<span class="num" id="3561569">0</span><span class="op" id="3561570">;</span>&nbsp;<span class="ident" id="3561572">j</span>&nbsp;<span class="op" id="3561574">&lt;</span>&nbsp;<span class="ident" id="3561576">_S</span><span class="op" id="3561578">;</span>&nbsp;<span class="ident" id="3561580">j</span><span class="op" id="3561581">++</span>&nbsp;<span class="op" id="3561584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561589">i</span><span class="op" id="3561590">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561596">buf</span><span class="op" id="3561599">[</span><span class="ident" id="3561600">i</span><span class="op" id="3561601">]</span>&nbsp;<span class="op" id="3561603">=</span>&nbsp;<span class="builtintype" id="3561605">byte</span><span class="op" id="3561609">(</span><span class="ident" id="3561610">d</span><span class="op" id="3561611">)</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561616">d</span>&nbsp;<span class="op" id="3561618">&gt;&gt;=</span>&nbsp;<span class="num" id="3561622">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3561626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3561629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561633">for</span>&nbsp;<span class="ident" id="3561637">i</span>&nbsp;<span class="op" id="3561639">&lt;</span>&nbsp;<span class="builtinfunc" id="3561641">len</span><span class="op" id="3561644">(</span><span class="ident" id="3561645">buf</span><span class="op" id="3561648">)</span>&nbsp;<span class="op" id="3561650">&amp;&amp;</span>&nbsp;<span class="ident" id="3561653">buf</span><span class="op" id="3561656">[</span><span class="ident" id="3561657">i</span><span class="op" id="3561658">]</span>&nbsp;<span class="op" id="3561660">==</span>&nbsp;<span class="num" id="3561663">0</span>&nbsp;<span class="op" id="3561665">{</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561669">i</span><span class="op" id="3561670">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3561674">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561678">return</span><br>
<span class="lineno"></span><span class="op" id="3561685">}</span><br>
<span class="lineno">1485</span><br>
<span class="lineno"></span><span class="comment" id="3561688">//&nbsp;setBytes&nbsp;interprets&nbsp;buf&nbsp;as&nbsp;the&nbsp;bytes&nbsp;of&nbsp;a&nbsp;big-endian&nbsp;unsigned</span><br>
<span class="lineno"></span><span class="comment" id="3561753">//&nbsp;integer,&nbsp;sets&nbsp;z&nbsp;to&nbsp;that&nbsp;value,&nbsp;and&nbsp;returns&nbsp;z.</span><br>
<span class="lineno"></span><span class="keyword" id="3561802">func</span>&nbsp;<span class="op" id="3561807">(</span><span class="ident" id="3561808">z</span>&nbsp;<span class="ident" id="3561810">nat</span><span class="op" id="3561813">)</span>&nbsp;<span class="ident" id="3561815">setBytes</span><span class="op" id="3561823">(</span><span class="ident" id="3561824">buf</span>&nbsp;<span class="op" id="3561828">[</span><span class="op" id="3561829">]</span><span class="builtintype" id="3561830">byte</span><span class="op" id="3561834">)</span>&nbsp;<span class="ident" id="3561836">nat</span>&nbsp;<span class="op" id="3561840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561843">z</span>&nbsp;<span class="op" id="3561845">=</span>&nbsp;<span class="ident" id="3561847">z</span><span class="op" id="3561848">.</span><span class="builtinfunc" id="3561849">make</span><span class="op" id="3561853">(</span><span class="op" id="3561854">(</span><span class="builtinfunc" id="3561855">len</span><span class="op" id="3561858">(</span><span class="ident" id="3561859">buf</span><span class="op" id="3561862">)</span>&nbsp;<span class="op" id="3561864">+</span>&nbsp;<span class="ident" id="3561866">_S</span>&nbsp;<span class="op" id="3561869">-</span>&nbsp;<span class="num" id="3561871">1</span><span class="op" id="3561872">)</span>&nbsp;<span class="op" id="3561874">/</span>&nbsp;<span class="ident" id="3561876">_S</span><span class="op" id="3561878">)</span><br>
<span class="lineno">1490</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561882">k</span>&nbsp;<span class="op" id="3561884">:=</span>&nbsp;<span class="num" id="3561887">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561890">s</span>&nbsp;<span class="op" id="3561892">:=</span>&nbsp;<span class="builtintype" id="3561895">uint</span><span class="op" id="3561899">(</span><span class="num" id="3561900">0</span><span class="op" id="3561901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561904">var</span>&nbsp;<span class="ident" id="3561908">d</span>&nbsp;<span class="ident" id="3561910">Word</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561916">for</span>&nbsp;<span class="ident" id="3561920">i</span>&nbsp;<span class="op" id="3561922">:=</span>&nbsp;<span class="builtinfunc" id="3561925">len</span><span class="op" id="3561928">(</span><span class="ident" id="3561929">buf</span><span class="op" id="3561932">)</span><span class="op" id="3561933">;</span>&nbsp;<span class="ident" id="3561935">i</span>&nbsp;<span class="op" id="3561937">&gt;</span>&nbsp;<span class="num" id="3561939">0</span><span class="op" id="3561940">;</span>&nbsp;<span class="ident" id="3561942">i</span><span class="op" id="3561943">--</span>&nbsp;<span class="op" id="3561946">{</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3561950">d</span>&nbsp;<span class="op" id="3561952">|=</span>&nbsp;<span class="ident" id="3561955">Word</span><span class="op" id="3561959">(</span><span class="ident" id="3561960">buf</span><span class="op" id="3561963">[</span><span class="ident" id="3561964">i</span><span class="op" id="3561965">-</span><span class="num" id="3561966">1</span><span class="op" id="3561967">]</span><span class="op" id="3561968">)</span>&nbsp;<span class="op" id="3561970">&lt;&lt;</span>&nbsp;<span class="ident" id="3561973">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3561977">if</span>&nbsp;<span class="ident" id="3561980">s</span>&nbsp;<span class="op" id="3561982">+=</span>&nbsp;<span class="num" id="3561985">8</span><span class="op" id="3561986">;</span>&nbsp;<span class="ident" id="3561988">s</span>&nbsp;<span class="op" id="3561990">==</span>&nbsp;<span class="ident" id="3561993">_S</span><span class="op" id="3561995">*</span><span class="num" id="3561996">8</span>&nbsp;<span class="op" id="3561998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562003">z</span><span class="op" id="3562004">[</span><span class="ident" id="3562005">k</span><span class="op" id="3562006">]</span>&nbsp;<span class="op" id="3562008">=</span>&nbsp;<span class="ident" id="3562010">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562015">k</span><span class="op" id="3562016">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562022">s</span>&nbsp;<span class="op" id="3562024">=</span>&nbsp;<span class="num" id="3562026">0</span><br>
<span class="lineno">1500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562031">d</span>&nbsp;<span class="op" id="3562033">=</span>&nbsp;<span class="num" id="3562035">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3562039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3562042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562045">if</span>&nbsp;<span class="ident" id="3562048">k</span>&nbsp;<span class="op" id="3562050">&lt;</span>&nbsp;<span class="builtinfunc" id="3562052">len</span><span class="op" id="3562055">(</span><span class="ident" id="3562056">z</span><span class="op" id="3562057">)</span>&nbsp;<span class="op" id="3562059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3562063">z</span><span class="op" id="3562064">[</span><span class="ident" id="3562065">k</span><span class="op" id="3562066">]</span>&nbsp;<span class="op" id="3562068">=</span>&nbsp;<span class="ident" id="3562070">d</span><br>
<span class="lineno">1505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3562073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3562077">return</span>&nbsp;<span class="ident" id="3562084">z</span><span class="op" id="3562085">.</span><span class="ident" id="3562086">norm</span><span class="op" id="3562090">(</span><span class="op" id="3562091">)</span><br>
<span class="lineno"></span><span class="op" id="3562093">}</span>
</div>
</body>
</html>
