<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing</h2>
<ul>
<li><a href="/gostd/testing/allocs.go.html">allocs.go</a></li>
<li><a href="/gostd/testing/allocs_test.go.html">allocs_test.go</a></li>
<li><a href="/gostd/testing/benchmark.go.html" class="current">benchmark.go</a></li>
<li><a href="/gostd/testing/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/testing/cover.go.html">cover.go</a></li>
<li><a href="/gostd/testing/example.go.html">example.go</a></li>
<li><a href="/gostd/testing/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/testing/testing.go.html">testing.go</a></li>
<li><a href="/gostd/testing/testing_test.go.html">testing_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6333370">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6333425">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6333479">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6333530">package</span>&nbsp;<span class="ident" id="6333538">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6333547">import</span>&nbsp;<span class="op" id="6333554">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6333557">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6333565">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6333572">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6333578">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6333589">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6333597">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6333612">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6333619">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6333622">var</span>&nbsp;<span class="ident" id="6333626">matchBenchmarks</span>&nbsp;<span class="op" id="6333642">=</span>&nbsp;<span class="ident" id="6333644">flag</span><span class="op" id="6333648">.</span><span class="ident" id="6333649">String</span><span class="op" id="6333655">(</span><span class="string" id="6333656">&#34;test.bench&#34;</span><span class="op" id="6333668">,</span>&nbsp;<span class="string" id="6333670">&#34;&#34;</span><span class="op" id="6333672">,</span>&nbsp;<span class="string" id="6333674">&#34;regular&nbsp;expression&nbsp;to&nbsp;select&nbsp;benchmarks&nbsp;to&nbsp;run&#34;</span><span class="op" id="6333722">)</span><br>
<span class="lineno"></span><span class="keyword" id="6333724">var</span>&nbsp;<span class="ident" id="6333728">benchTime</span>&nbsp;<span class="op" id="6333738">=</span>&nbsp;<span class="ident" id="6333740">flag</span><span class="op" id="6333744">.</span><span class="ident" id="6333745">Duration</span><span class="op" id="6333753">(</span><span class="string" id="6333754">&#34;test.benchtime&#34;</span><span class="op" id="6333770">,</span>&nbsp;<span class="num" id="6333772">1</span><span class="op" id="6333773">*</span><span class="ident" id="6333774">time</span><span class="op" id="6333778">.</span><span class="ident" id="6333779">Second</span><span class="op" id="6333785">,</span>&nbsp;<span class="string" id="6333787">&#34;approximate&nbsp;run&nbsp;time&nbsp;for&nbsp;each&nbsp;benchmark&#34;</span><span class="op" id="6333828">)</span><br>
<span class="lineno"></span><span class="keyword" id="6333830">var</span>&nbsp;<span class="ident" id="6333834">benchmarkMemory</span>&nbsp;<span class="op" id="6333850">=</span>&nbsp;<span class="ident" id="6333852">flag</span><span class="op" id="6333856">.</span><span class="ident" id="6333857">Bool</span><span class="op" id="6333861">(</span><span class="string" id="6333862">&#34;test.benchmem&#34;</span><span class="op" id="6333877">,</span>&nbsp;<span class="builtintype" id="6333879">false</span><span class="op" id="6333884">,</span>&nbsp;<span class="string" id="6333886">&#34;print&nbsp;memory&nbsp;allocations&nbsp;for&nbsp;benchmarks&#34;</span><span class="op" id="6333927">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="6333930">//&nbsp;Global&nbsp;lock&nbsp;to&nbsp;ensure&nbsp;only&nbsp;one&nbsp;benchmark&nbsp;runs&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="6333990">var</span>&nbsp;<span class="ident" id="6333994">benchmarkLock</span>&nbsp;<span class="ident" id="6334008">sync</span><span class="op" id="6334012">.</span><span class="ident" id="6334013">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6334020">//&nbsp;Used&nbsp;for&nbsp;every&nbsp;benchmark&nbsp;for&nbsp;measuring&nbsp;memory.</span><br>
<span class="lineno">25</span><span class="keyword" id="6334070">var</span>&nbsp;<span class="ident" id="6334074">memStats</span>&nbsp;<span class="ident" id="6334083">runtime</span><span class="op" id="6334090">.</span><span class="ident" id="6334091">MemStats</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6334101">//&nbsp;An&nbsp;internal&nbsp;type&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6334190">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6334219">type</span>&nbsp;<span class="ident" id="6334224">InternalBenchmark</span>&nbsp;<span class="keyword" id="6334242">struct</span>&nbsp;<span class="op" id="6334249">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334252">Name</span>&nbsp;<span class="builtintype" id="6334257">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334265">F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6334270">func</span><span class="op" id="6334274">(</span><span class="ident" id="6334275">b</span>&nbsp;<span class="op" id="6334277">*</span><span class="ident" id="6334278">B</span><span class="op" id="6334279">)</span><br>
<span class="lineno"></span><span class="op" id="6334281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6334284">//&nbsp;B&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;Benchmark&nbsp;functions&nbsp;to&nbsp;manage&nbsp;benchmark</span><br>
<span class="lineno">35</span><span class="comment" id="6334349">//&nbsp;timing&nbsp;and&nbsp;to&nbsp;specify&nbsp;the&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="6334407">type</span>&nbsp;<span class="ident" id="6334412">B</span>&nbsp;<span class="keyword" id="6334414">struct</span>&nbsp;<span class="op" id="6334421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334424">common</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334432">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6334449">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334454">previousN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6334471">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6334485">//&nbsp;number&nbsp;of&nbsp;iterations&nbsp;in&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334530">previousDuration</span>&nbsp;<span class="ident" id="6334547">time</span><span class="op" id="6334551">.</span><span class="ident" id="6334552">Duration</span>&nbsp;<span class="comment" id="6334561">//&nbsp;total&nbsp;duration&nbsp;of&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334600">benchmark</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6334617">InternalBenchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334636">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6334653">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334660">timerOn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6334677">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334683">showAllocResult</span>&nbsp;&nbsp;<span class="builtintype" id="6334700">bool</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334706">result</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6334723">BenchmarkResult</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334740">parallelism</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6334757">int</span>&nbsp;<span class="comment" id="6334761">//&nbsp;RunParallel&nbsp;creates&nbsp;parallelism*GOMAXPROCS&nbsp;goroutines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6334819">//&nbsp;The&nbsp;initial&nbsp;states&nbsp;of&nbsp;memStats.Mallocs&nbsp;and&nbsp;memStats.TotalAlloc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334887">startAllocs</span>&nbsp;<span class="ident" id="6334899">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334907">startBytes</span>&nbsp;&nbsp;<span class="ident" id="6334919">uint64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6334927">//&nbsp;The&nbsp;net&nbsp;total&nbsp;of&nbsp;this&nbsp;test&nbsp;after&nbsp;being&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334975">netAllocs</span>&nbsp;<span class="ident" id="6334985">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334993">netBytes</span>&nbsp;&nbsp;<span class="ident" id="6335003">uint64</span><br>
<span class="lineno"></span><span class="op" id="6335010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="6335013">//&nbsp;StartTimer&nbsp;starts&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;function&nbsp;is&nbsp;called&nbsp;automatically</span><br>
<span class="lineno"></span><span class="comment" id="6335088">//&nbsp;before&nbsp;a&nbsp;benchmark&nbsp;starts,&nbsp;but&nbsp;it&nbsp;can&nbsp;also&nbsp;used&nbsp;to&nbsp;resume&nbsp;timing&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="6335162">//&nbsp;a&nbsp;call&nbsp;to&nbsp;StopTimer.</span><br>
<span class="lineno"></span><span class="keyword" id="6335186">func</span>&nbsp;<span class="op" id="6335191">(</span><span class="ident" id="6335192">b</span>&nbsp;<span class="op" id="6335194">*</span><span class="ident" id="6335195">B</span><span class="op" id="6335196">)</span>&nbsp;<span class="ident" id="6335198">StartTimer</span><span class="op" id="6335208">(</span><span class="op" id="6335209">)</span>&nbsp;<span class="op" id="6335211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335214">if</span>&nbsp;<span class="op" id="6335217">!</span><span class="ident" id="6335218">b</span><span class="op" id="6335219">.</span><span class="ident" id="6335220">timerOn</span>&nbsp;<span class="op" id="6335228">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335232">runtime</span><span class="op" id="6335239">.</span><span class="ident" id="6335240">ReadMemStats</span><span class="op" id="6335252">(</span><span class="op" id="6335253">&amp;</span><span class="ident" id="6335254">memStats</span><span class="op" id="6335262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335266">b</span><span class="op" id="6335267">.</span><span class="ident" id="6335268">startAllocs</span>&nbsp;<span class="op" id="6335280">=</span>&nbsp;<span class="ident" id="6335282">memStats</span><span class="op" id="6335290">.</span><span class="ident" id="6335291">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335301">b</span><span class="op" id="6335302">.</span><span class="ident" id="6335303">startBytes</span>&nbsp;<span class="op" id="6335314">=</span>&nbsp;<span class="ident" id="6335316">memStats</span><span class="op" id="6335324">.</span><span class="ident" id="6335325">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335338">b</span><span class="op" id="6335339">.</span><span class="ident" id="6335340">start</span>&nbsp;<span class="op" id="6335346">=</span>&nbsp;<span class="ident" id="6335348">time</span><span class="op" id="6335352">.</span><span class="ident" id="6335353">Now</span><span class="op" id="6335356">(</span><span class="op" id="6335357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335361">b</span><span class="op" id="6335362">.</span><span class="ident" id="6335363">timerOn</span>&nbsp;<span class="op" id="6335371">=</span>&nbsp;<span class="builtintype" id="6335373">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6335379">}</span><br>
<span class="lineno"></span><span class="op" id="6335381">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6335384">//&nbsp;StopTimer&nbsp;stops&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;pause&nbsp;the&nbsp;timer</span><br>
<span class="lineno"></span><span class="comment" id="6335455">//&nbsp;while&nbsp;performing&nbsp;complex&nbsp;initialization&nbsp;that&nbsp;you&nbsp;don&#39;t</span><br>
<span class="lineno">70</span><span class="comment" id="6335513">//&nbsp;want&nbsp;to&nbsp;measure.</span><br>
<span class="lineno"></span><span class="keyword" id="6335533">func</span>&nbsp;<span class="op" id="6335538">(</span><span class="ident" id="6335539">b</span>&nbsp;<span class="op" id="6335541">*</span><span class="ident" id="6335542">B</span><span class="op" id="6335543">)</span>&nbsp;<span class="ident" id="6335545">StopTimer</span><span class="op" id="6335554">(</span><span class="op" id="6335555">)</span>&nbsp;<span class="op" id="6335557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335560">if</span>&nbsp;<span class="ident" id="6335563">b</span><span class="op" id="6335564">.</span><span class="ident" id="6335565">timerOn</span>&nbsp;<span class="op" id="6335573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335577">b</span><span class="op" id="6335578">.</span><span class="ident" id="6335579">duration</span>&nbsp;<span class="op" id="6335588">+=</span>&nbsp;<span class="ident" id="6335591">time</span><span class="op" id="6335595">.</span><span class="ident" id="6335596">Now</span><span class="op" id="6335599">(</span><span class="op" id="6335600">)</span><span class="op" id="6335601">.</span><span class="ident" id="6335602">Sub</span><span class="op" id="6335605">(</span><span class="ident" id="6335606">b</span><span class="op" id="6335607">.</span><span class="ident" id="6335608">start</span><span class="op" id="6335613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335617">runtime</span><span class="op" id="6335624">.</span><span class="ident" id="6335625">ReadMemStats</span><span class="op" id="6335637">(</span><span class="op" id="6335638">&amp;</span><span class="ident" id="6335639">memStats</span><span class="op" id="6335647">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335651">b</span><span class="op" id="6335652">.</span><span class="ident" id="6335653">netAllocs</span>&nbsp;<span class="op" id="6335663">+=</span>&nbsp;<span class="ident" id="6335666">memStats</span><span class="op" id="6335674">.</span><span class="ident" id="6335675">Mallocs</span>&nbsp;<span class="op" id="6335683">-</span>&nbsp;<span class="ident" id="6335685">b</span><span class="op" id="6335686">.</span><span class="ident" id="6335687">startAllocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335701">b</span><span class="op" id="6335702">.</span><span class="ident" id="6335703">netBytes</span>&nbsp;<span class="op" id="6335712">+=</span>&nbsp;<span class="ident" id="6335715">memStats</span><span class="op" id="6335723">.</span><span class="ident" id="6335724">TotalAlloc</span>&nbsp;<span class="op" id="6335735">-</span>&nbsp;<span class="ident" id="6335737">b</span><span class="op" id="6335738">.</span><span class="ident" id="6335739">startBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335752">b</span><span class="op" id="6335753">.</span><span class="ident" id="6335754">timerOn</span>&nbsp;<span class="op" id="6335762">=</span>&nbsp;<span class="builtintype" id="6335764">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6335771">}</span><br>
<span class="lineno"></span><span class="op" id="6335773">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="6335776">//&nbsp;ResetTimer&nbsp;zeros&nbsp;the&nbsp;elapsed&nbsp;benchmark&nbsp;time&nbsp;and&nbsp;memory&nbsp;allocation&nbsp;counters.</span><br>
<span class="lineno"></span><span class="comment" id="6335855">//&nbsp;It&nbsp;does&nbsp;not&nbsp;affect&nbsp;whether&nbsp;the&nbsp;timer&nbsp;is&nbsp;running.</span><br>
<span class="lineno"></span><span class="keyword" id="6335907">func</span>&nbsp;<span class="op" id="6335912">(</span><span class="ident" id="6335913">b</span>&nbsp;<span class="op" id="6335915">*</span><span class="ident" id="6335916">B</span><span class="op" id="6335917">)</span>&nbsp;<span class="ident" id="6335919">ResetTimer</span><span class="op" id="6335929">(</span><span class="op" id="6335930">)</span>&nbsp;<span class="op" id="6335932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335935">if</span>&nbsp;<span class="ident" id="6335938">b</span><span class="op" id="6335939">.</span><span class="ident" id="6335940">timerOn</span>&nbsp;<span class="op" id="6335948">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335952">runtime</span><span class="op" id="6335959">.</span><span class="ident" id="6335960">ReadMemStats</span><span class="op" id="6335972">(</span><span class="op" id="6335973">&amp;</span><span class="ident" id="6335974">memStats</span><span class="op" id="6335982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6335986">b</span><span class="op" id="6335987">.</span><span class="ident" id="6335988">startAllocs</span>&nbsp;<span class="op" id="6336000">=</span>&nbsp;<span class="ident" id="6336002">memStats</span><span class="op" id="6336010">.</span><span class="ident" id="6336011">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336021">b</span><span class="op" id="6336022">.</span><span class="ident" id="6336023">startBytes</span>&nbsp;<span class="op" id="6336034">=</span>&nbsp;<span class="ident" id="6336036">memStats</span><span class="op" id="6336044">.</span><span class="ident" id="6336045">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336058">b</span><span class="op" id="6336059">.</span><span class="ident" id="6336060">start</span>&nbsp;<span class="op" id="6336066">=</span>&nbsp;<span class="ident" id="6336068">time</span><span class="op" id="6336072">.</span><span class="ident" id="6336073">Now</span><span class="op" id="6336076">(</span><span class="op" id="6336077">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6336080">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336083">b</span><span class="op" id="6336084">.</span><span class="ident" id="6336085">duration</span>&nbsp;<span class="op" id="6336094">=</span>&nbsp;<span class="num" id="6336096">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336099">b</span><span class="op" id="6336100">.</span><span class="ident" id="6336101">netAllocs</span>&nbsp;<span class="op" id="6336111">=</span>&nbsp;<span class="num" id="6336113">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336116">b</span><span class="op" id="6336117">.</span><span class="ident" id="6336118">netBytes</span>&nbsp;<span class="op" id="6336127">=</span>&nbsp;<span class="num" id="6336129">0</span><br>
<span class="lineno"></span><span class="op" id="6336131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="6336134">//&nbsp;SetBytes&nbsp;records&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;processed&nbsp;in&nbsp;a&nbsp;single&nbsp;operation.</span><br>
<span class="lineno"></span><span class="comment" id="6336207">//&nbsp;If&nbsp;this&nbsp;is&nbsp;called,&nbsp;the&nbsp;benchmark&nbsp;will&nbsp;report&nbsp;ns/op&nbsp;and&nbsp;MB/s.</span><br>
<span class="lineno"></span><span class="keyword" id="6336271">func</span>&nbsp;<span class="op" id="6336276">(</span><span class="ident" id="6336277">b</span>&nbsp;<span class="op" id="6336279">*</span><span class="ident" id="6336280">B</span><span class="op" id="6336281">)</span>&nbsp;<span class="ident" id="6336283">SetBytes</span><span class="op" id="6336291">(</span><span class="ident" id="6336292">n</span>&nbsp;<span class="ident" id="6336294">int64</span><span class="op" id="6336299">)</span>&nbsp;<span class="op" id="6336301">{</span>&nbsp;<span class="ident" id="6336303">b</span><span class="op" id="6336304">.</span><span class="ident" id="6336305">bytes</span>&nbsp;<span class="op" id="6336311">=</span>&nbsp;<span class="ident" id="6336313">n</span>&nbsp;<span class="op" id="6336315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6336318">//&nbsp;ReportAllocs&nbsp;enables&nbsp;malloc&nbsp;statistics&nbsp;for&nbsp;this&nbsp;benchmark.</span><br>
<span class="lineno">100</span><span class="comment" id="6336380">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;setting&nbsp;-test.benchmem,&nbsp;but&nbsp;it&nbsp;only&nbsp;affects&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6336451">//&nbsp;benchmark&nbsp;function&nbsp;that&nbsp;calls&nbsp;ReportAllocs.</span><br>
<span class="lineno"></span><span class="keyword" id="6336498">func</span>&nbsp;<span class="op" id="6336503">(</span><span class="ident" id="6336504">b</span>&nbsp;<span class="op" id="6336506">*</span><span class="ident" id="6336507">B</span><span class="op" id="6336508">)</span>&nbsp;<span class="ident" id="6336510">ReportAllocs</span><span class="op" id="6336522">(</span><span class="op" id="6336523">)</span>&nbsp;<span class="op" id="6336525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336528">b</span><span class="op" id="6336529">.</span><span class="ident" id="6336530">showAllocResult</span>&nbsp;<span class="op" id="6336546">=</span>&nbsp;<span class="builtintype" id="6336548">true</span><br>
<span class="lineno"></span><span class="op" id="6336553">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6336556">func</span>&nbsp;<span class="op" id="6336561">(</span><span class="ident" id="6336562">b</span>&nbsp;<span class="op" id="6336564">*</span><span class="ident" id="6336565">B</span><span class="op" id="6336566">)</span>&nbsp;<span class="ident" id="6336568">nsPerOp</span><span class="op" id="6336575">(</span><span class="op" id="6336576">)</span>&nbsp;<span class="ident" id="6336578">int64</span>&nbsp;<span class="op" id="6336584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336587">if</span>&nbsp;<span class="ident" id="6336590">b</span><span class="op" id="6336591">.</span><span class="ident" id="6336592">N</span>&nbsp;<span class="op" id="6336594">&lt;=</span>&nbsp;<span class="num" id="6336597">0</span>&nbsp;<span class="op" id="6336599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336603">return</span>&nbsp;<span class="num" id="6336610">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6336613">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336616">return</span>&nbsp;<span class="ident" id="6336623">b</span><span class="op" id="6336624">.</span><span class="ident" id="6336625">duration</span><span class="op" id="6336633">.</span><span class="ident" id="6336634">Nanoseconds</span><span class="op" id="6336645">(</span><span class="op" id="6336646">)</span>&nbsp;<span class="op" id="6336648">/</span>&nbsp;<span class="ident" id="6336650">int64</span><span class="op" id="6336655">(</span><span class="ident" id="6336656">b</span><span class="op" id="6336657">.</span><span class="ident" id="6336658">N</span><span class="op" id="6336659">)</span><br>
<span class="lineno"></span><span class="op" id="6336661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6336664">//&nbsp;runN&nbsp;runs&nbsp;a&nbsp;single&nbsp;benchmark&nbsp;for&nbsp;the&nbsp;specified&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span><span class="keyword" id="6336736">func</span>&nbsp;<span class="op" id="6336741">(</span><span class="ident" id="6336742">b</span>&nbsp;<span class="op" id="6336744">*</span><span class="ident" id="6336745">B</span><span class="op" id="6336746">)</span>&nbsp;<span class="ident" id="6336748">runN</span><span class="op" id="6336752">(</span><span class="ident" id="6336753">n</span>&nbsp;<span class="builtintype" id="6336755">int</span><span class="op" id="6336758">)</span>&nbsp;<span class="op" id="6336760">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336763">benchmarkLock</span><span class="op" id="6336776">.</span><span class="ident" id="6336777">Lock</span><span class="op" id="6336781">(</span><span class="op" id="6336782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336785">defer</span>&nbsp;<span class="ident" id="6336791">benchmarkLock</span><span class="op" id="6336804">.</span><span class="ident" id="6336805">Unlock</span><span class="op" id="6336811">(</span><span class="op" id="6336812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6336815">//&nbsp;Try&nbsp;to&nbsp;get&nbsp;a&nbsp;comparable&nbsp;environment&nbsp;for&nbsp;each&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6336868">//&nbsp;by&nbsp;clearing&nbsp;garbage&nbsp;from&nbsp;previous&nbsp;runs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336912">runtime</span><span class="op" id="6336919">.</span><span class="ident" id="6336920">GC</span><span class="op" id="6336922">(</span><span class="op" id="6336923">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336926">b</span><span class="op" id="6336927">.</span><span class="ident" id="6336928">N</span>&nbsp;<span class="op" id="6336930">=</span>&nbsp;<span class="ident" id="6336932">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336935">b</span><span class="op" id="6336936">.</span><span class="ident" id="6336937">parallelism</span>&nbsp;<span class="op" id="6336949">=</span>&nbsp;<span class="num" id="6336951">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336954">b</span><span class="op" id="6336955">.</span><span class="ident" id="6336956">ResetTimer</span><span class="op" id="6336966">(</span><span class="op" id="6336967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336970">b</span><span class="op" id="6336971">.</span><span class="ident" id="6336972">StartTimer</span><span class="op" id="6336982">(</span><span class="op" id="6336983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336986">b</span><span class="op" id="6336987">.</span><span class="ident" id="6336988">benchmark</span><span class="op" id="6336997">.</span><span class="ident" id="6336998">F</span><span class="op" id="6336999">(</span><span class="ident" id="6337000">b</span><span class="op" id="6337001">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337004">b</span><span class="op" id="6337005">.</span><span class="ident" id="6337006">StopTimer</span><span class="op" id="6337015">(</span><span class="op" id="6337016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337019">b</span><span class="op" id="6337020">.</span><span class="ident" id="6337021">previousN</span>&nbsp;<span class="op" id="6337031">=</span>&nbsp;<span class="ident" id="6337033">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337036">b</span><span class="op" id="6337037">.</span><span class="ident" id="6337038">previousDuration</span>&nbsp;<span class="op" id="6337055">=</span>&nbsp;<span class="ident" id="6337057">b</span><span class="op" id="6337058">.</span><span class="ident" id="6337059">duration</span><br>
<span class="lineno"></span><span class="op" id="6337068">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="6337071">func</span>&nbsp;<span class="ident" id="6337076">min</span><span class="op" id="6337079">(</span><span class="ident" id="6337080">x</span><span class="op" id="6337081">,</span>&nbsp;<span class="ident" id="6337083">y</span>&nbsp;<span class="builtintype" id="6337085">int</span><span class="op" id="6337088">)</span>&nbsp;<span class="builtintype" id="6337090">int</span>&nbsp;<span class="op" id="6337094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337097">if</span>&nbsp;<span class="ident" id="6337100">x</span>&nbsp;<span class="op" id="6337102">&gt;</span>&nbsp;<span class="ident" id="6337104">y</span>&nbsp;<span class="op" id="6337106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337110">return</span>&nbsp;<span class="ident" id="6337117">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6337120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337123">return</span>&nbsp;<span class="ident" id="6337130">x</span><br>
<span class="lineno">135</span><span class="op" id="6337132">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6337135">func</span>&nbsp;<span class="ident" id="6337140">max</span><span class="op" id="6337143">(</span><span class="ident" id="6337144">x</span><span class="op" id="6337145">,</span>&nbsp;<span class="ident" id="6337147">y</span>&nbsp;<span class="builtintype" id="6337149">int</span><span class="op" id="6337152">)</span>&nbsp;<span class="builtintype" id="6337154">int</span>&nbsp;<span class="op" id="6337158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337161">if</span>&nbsp;<span class="ident" id="6337164">x</span>&nbsp;<span class="op" id="6337166">&lt;</span>&nbsp;<span class="ident" id="6337168">y</span>&nbsp;<span class="op" id="6337170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337174">return</span>&nbsp;<span class="ident" id="6337181">y</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6337184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337187">return</span>&nbsp;<span class="ident" id="6337194">x</span><br>
<span class="lineno"></span><span class="op" id="6337196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6337199">//&nbsp;roundDown10&nbsp;rounds&nbsp;a&nbsp;number&nbsp;down&nbsp;to&nbsp;the&nbsp;nearest&nbsp;power&nbsp;of&nbsp;10.</span><br>
<span class="lineno">145</span><span class="keyword" id="6337263">func</span>&nbsp;<span class="ident" id="6337268">roundDown10</span><span class="op" id="6337279">(</span><span class="ident" id="6337280">n</span>&nbsp;<span class="builtintype" id="6337282">int</span><span class="op" id="6337285">)</span>&nbsp;<span class="builtintype" id="6337287">int</span>&nbsp;<span class="op" id="6337291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337294">var</span>&nbsp;<span class="ident" id="6337298">tens</span>&nbsp;<span class="op" id="6337303">=</span>&nbsp;<span class="num" id="6337305">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6337308">//&nbsp;tens&nbsp;=&nbsp;floor(log_10(n))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337336">for</span>&nbsp;<span class="ident" id="6337340">n</span>&nbsp;<span class="op" id="6337342">&gt;=</span>&nbsp;<span class="num" id="6337345">10</span>&nbsp;<span class="op" id="6337348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337352">n</span>&nbsp;<span class="op" id="6337354">=</span>&nbsp;<span class="ident" id="6337356">n</span>&nbsp;<span class="op" id="6337358">/</span>&nbsp;<span class="num" id="6337360">10</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337365">tens</span><span class="op" id="6337369">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6337373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6337376">//&nbsp;result&nbsp;=&nbsp;10^tens</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337397">result</span>&nbsp;<span class="op" id="6337404">:=</span>&nbsp;<span class="num" id="6337407">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337410">for</span>&nbsp;<span class="ident" id="6337414">i</span>&nbsp;<span class="op" id="6337416">:=</span>&nbsp;<span class="num" id="6337419">0</span><span class="op" id="6337420">;</span>&nbsp;<span class="ident" id="6337422">i</span>&nbsp;<span class="op" id="6337424">&lt;</span>&nbsp;<span class="ident" id="6337426">tens</span><span class="op" id="6337430">;</span>&nbsp;<span class="ident" id="6337432">i</span><span class="op" id="6337433">++</span>&nbsp;<span class="op" id="6337436">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337440">result</span>&nbsp;<span class="op" id="6337447">*=</span>&nbsp;<span class="num" id="6337450">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6337454">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337457">return</span>&nbsp;<span class="ident" id="6337464">result</span><br>
<span class="lineno"></span><span class="op" id="6337471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="6337474">//&nbsp;roundUp&nbsp;rounds&nbsp;x&nbsp;up&nbsp;to&nbsp;a&nbsp;number&nbsp;of&nbsp;the&nbsp;form&nbsp;[1eX,&nbsp;2eX,&nbsp;3eX,&nbsp;5eX].</span><br>
<span class="lineno"></span><span class="keyword" id="6337543">func</span>&nbsp;<span class="ident" id="6337548">roundUp</span><span class="op" id="6337555">(</span><span class="ident" id="6337556">n</span>&nbsp;<span class="builtintype" id="6337558">int</span><span class="op" id="6337561">)</span>&nbsp;<span class="builtintype" id="6337563">int</span>&nbsp;<span class="op" id="6337567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337570">base</span>&nbsp;<span class="op" id="6337575">:=</span>&nbsp;<span class="ident" id="6337578">roundDown10</span><span class="op" id="6337589">(</span><span class="ident" id="6337590">n</span><span class="op" id="6337591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337594">switch</span>&nbsp;<span class="op" id="6337601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337604">case</span>&nbsp;<span class="ident" id="6337609">n</span>&nbsp;<span class="op" id="6337611">&lt;=</span>&nbsp;<span class="ident" id="6337614">base</span><span class="op" id="6337618">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337622">return</span>&nbsp;<span class="ident" id="6337629">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337635">case</span>&nbsp;<span class="ident" id="6337640">n</span>&nbsp;<span class="op" id="6337642">&lt;=</span>&nbsp;<span class="op" id="6337645">(</span><span class="num" id="6337646">2</span>&nbsp;<span class="op" id="6337648">*</span>&nbsp;<span class="ident" id="6337650">base</span><span class="op" id="6337654">)</span><span class="op" id="6337655">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337659">return</span>&nbsp;<span class="num" id="6337666">2</span>&nbsp;<span class="op" id="6337668">*</span>&nbsp;<span class="ident" id="6337670">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337676">case</span>&nbsp;<span class="ident" id="6337681">n</span>&nbsp;<span class="op" id="6337683">&lt;=</span>&nbsp;<span class="op" id="6337686">(</span><span class="num" id="6337687">3</span>&nbsp;<span class="op" id="6337689">*</span>&nbsp;<span class="ident" id="6337691">base</span><span class="op" id="6337695">)</span><span class="op" id="6337696">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337700">return</span>&nbsp;<span class="num" id="6337707">3</span>&nbsp;<span class="op" id="6337709">*</span>&nbsp;<span class="ident" id="6337711">base</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337717">case</span>&nbsp;<span class="ident" id="6337722">n</span>&nbsp;<span class="op" id="6337724">&lt;=</span>&nbsp;<span class="op" id="6337727">(</span><span class="num" id="6337728">5</span>&nbsp;<span class="op" id="6337730">*</span>&nbsp;<span class="ident" id="6337732">base</span><span class="op" id="6337736">)</span><span class="op" id="6337737">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337741">return</span>&nbsp;<span class="num" id="6337748">5</span>&nbsp;<span class="op" id="6337750">*</span>&nbsp;<span class="ident" id="6337752">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337758">default</span><span class="op" id="6337765">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337769">return</span>&nbsp;<span class="num" id="6337776">10</span>&nbsp;<span class="op" id="6337779">*</span>&nbsp;<span class="ident" id="6337781">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6337787">}</span><br>
<span class="lineno">175</span><span class="op" id="6337789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6337792">//&nbsp;run&nbsp;times&nbsp;the&nbsp;benchmark&nbsp;function&nbsp;in&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="6337853">func</span>&nbsp;<span class="op" id="6337858">(</span><span class="ident" id="6337859">b</span>&nbsp;<span class="op" id="6337861">*</span><span class="ident" id="6337862">B</span><span class="op" id="6337863">)</span>&nbsp;<span class="ident" id="6337865">run</span><span class="op" id="6337868">(</span><span class="op" id="6337869">)</span>&nbsp;<span class="ident" id="6337871">BenchmarkResult</span>&nbsp;<span class="op" id="6337887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337890">go</span>&nbsp;<span class="ident" id="6337893">b</span><span class="op" id="6337894">.</span><span class="ident" id="6337895">launch</span><span class="op" id="6337901">(</span><span class="op" id="6337902">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6337905">&lt;-</span><span class="ident" id="6337907">b</span><span class="op" id="6337908">.</span><span class="ident" id="6337909">signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337917">return</span>&nbsp;<span class="ident" id="6337924">b</span><span class="op" id="6337925">.</span><span class="ident" id="6337926">result</span><br>
<span class="lineno"></span><span class="op" id="6337933">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6337936">//&nbsp;launch&nbsp;launches&nbsp;the&nbsp;benchmark&nbsp;function.&nbsp;&nbsp;It&nbsp;gradually&nbsp;increases&nbsp;the&nbsp;number</span><br>
<span class="lineno">185</span><span class="comment" id="6338014">//&nbsp;of&nbsp;benchmark&nbsp;iterations&nbsp;until&nbsp;the&nbsp;benchmark&nbsp;runs&nbsp;for&nbsp;the&nbsp;requested&nbsp;benchtime.</span><br>
<span class="lineno"></span><span class="comment" id="6338095">//&nbsp;It&nbsp;prints&nbsp;timing&nbsp;information&nbsp;in&nbsp;this&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="6338140">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptesting.BenchmarkHello&nbsp;&nbsp;&nbsp;&nbsp100000&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp19&nbsp;ns/op</span><br>
<span class="lineno"></span><span class="comment" id="6338184">//&nbsp;launch&nbsp;is&nbsp;run&nbsp;by&nbsp;the&nbsp;run&nbsp;function&nbsp;as&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="6338246">func</span>&nbsp;<span class="op" id="6338251">(</span><span class="ident" id="6338252">b</span>&nbsp;<span class="op" id="6338254">*</span><span class="ident" id="6338255">B</span><span class="op" id="6338256">)</span>&nbsp;<span class="ident" id="6338258">launch</span><span class="op" id="6338264">(</span><span class="op" id="6338265">)</span>&nbsp;<span class="op" id="6338267">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6338270">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;a&nbsp;single&nbsp;iteration&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;expensive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6338339">n</span>&nbsp;<span class="op" id="6338341">:=</span>&nbsp;<span class="num" id="6338344">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6338348">//&nbsp;Signal&nbsp;that&nbsp;we&#39;re&nbsp;done&nbsp;whether&nbsp;we&nbsp;return&nbsp;normally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6338402">//&nbsp;or&nbsp;by&nbsp;FailNow&#39;s&nbsp;runtime.Goexit.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338438">defer</span>&nbsp;<span class="keyword" id="6338444">func</span><span class="op" id="6338448">(</span><span class="op" id="6338449">)</span>&nbsp;<span class="op" id="6338451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6338455">b</span><span class="op" id="6338456">.</span><span class="ident" id="6338457">signal</span>&nbsp;<span class="op" id="6338464">&lt;-</span>&nbsp;<span class="ident" id="6338467">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6338470">}</span><span class="op" id="6338471">(</span><span class="op" id="6338472">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6338476">b</span><span class="op" id="6338477">.</span><span class="ident" id="6338478">runN</span><span class="op" id="6338482">(</span><span class="ident" id="6338483">n</span><span class="op" id="6338484">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6338487">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;at&nbsp;least&nbsp;the&nbsp;specified&nbsp;amount&nbsp;of&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6338552">d</span>&nbsp;<span class="op" id="6338554">:=</span>&nbsp;<span class="op" id="6338557">*</span><span class="ident" id="6338558">benchTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338569">for</span>&nbsp;<span class="op" id="6338573">!</span><span class="ident" id="6338574">b</span><span class="op" id="6338575">.</span><span class="ident" id="6338576">failed</span>&nbsp;<span class="op" id="6338583">&amp;&amp;</span>&nbsp;<span class="ident" id="6338586">b</span><span class="op" id="6338587">.</span><span class="ident" id="6338588">duration</span>&nbsp;<span class="op" id="6338597">&lt;</span>&nbsp;<span class="ident" id="6338599">d</span>&nbsp;<span class="op" id="6338601">&amp;&amp;</span>&nbsp;<span class="ident" id="6338604">n</span>&nbsp;<span class="op" id="6338606">&lt;</span>&nbsp;<span class="num" id="6338608">1e9</span>&nbsp;<span class="op" id="6338612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6338616">last</span>&nbsp;<span class="op" id="6338621">:=</span>&nbsp;<span class="ident" id="6338624">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6338628">//&nbsp;Predict&nbsp;required&nbsp;iterations.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338662">if</span>&nbsp;<span class="ident" id="6338665">b</span><span class="op" id="6338666">.</span><span class="ident" id="6338667">nsPerOp</span><span class="op" id="6338674">(</span><span class="op" id="6338675">)</span>&nbsp;<span class="op" id="6338677">==</span>&nbsp;<span class="num" id="6338680">0</span>&nbsp;<span class="op" id="6338682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6338687">n</span>&nbsp;<span class="op" id="6338689">=</span>&nbsp;<span class="num" id="6338691">1e9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6338697">}</span>&nbsp;<span class="keyword" id="6338699">else</span>&nbsp;<span class="op" id="6338704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6338709">n</span>&nbsp;<span class="op" id="6338711">=</span>&nbsp;<span class="builtintype" id="6338713">int</span><span class="op" id="6338716">(</span><span class="ident" id="6338717">d</span><span class="op" id="6338718">.</span><span class="ident" id="6338719">Nanoseconds</span><span class="op" id="6338730">(</span><span class="op" id="6338731">)</span>&nbsp;<span class="op" id="6338733">/</span>&nbsp;<span class="ident" id="6338735">b</span><span class="op" id="6338736">.</span><span class="ident" id="6338737">nsPerOp</span><span class="op" id="6338744">(</span><span class="op" id="6338745">)</span><span class="op" id="6338746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6338750">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6338754">//&nbsp;Run&nbsp;more&nbsp;iterations&nbsp;than&nbsp;we&nbsp;think&nbsp;we&#39;ll&nbsp;need&nbsp;(1.2x).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6338812">//&nbsp;Don&#39;t&nbsp;grow&nbsp;too&nbsp;fast&nbsp;in&nbsp;case&nbsp;we&nbsp;had&nbsp;timing&nbsp;errors&nbsp;previously.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6338878">//&nbsp;Be&nbsp;sure&nbsp;to&nbsp;run&nbsp;at&nbsp;least&nbsp;one&nbsp;more&nbsp;than&nbsp;last&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6338932">n</span>&nbsp;<span class="op" id="6338934">=</span>&nbsp;<span class="ident" id="6338936">max</span><span class="op" id="6338939">(</span><span class="ident" id="6338940">min</span><span class="op" id="6338943">(</span><span class="ident" id="6338944">n</span><span class="op" id="6338945">+</span><span class="ident" id="6338946">n</span><span class="op" id="6338947">/</span><span class="num" id="6338948">5</span><span class="op" id="6338949">,</span>&nbsp;<span class="num" id="6338951">100</span><span class="op" id="6338954">*</span><span class="ident" id="6338955">last</span><span class="op" id="6338959">)</span><span class="op" id="6338960">,</span>&nbsp;<span class="ident" id="6338962">last</span><span class="op" id="6338966">+</span><span class="num" id="6338967">1</span><span class="op" id="6338968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6338972">//&nbsp;Round&nbsp;up&nbsp;to&nbsp;something&nbsp;easy&nbsp;to&nbsp;read.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6339013">n</span>&nbsp;<span class="op" id="6339015">=</span>&nbsp;<span class="ident" id="6339017">roundUp</span><span class="op" id="6339024">(</span><span class="ident" id="6339025">n</span><span class="op" id="6339026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6339030">b</span><span class="op" id="6339031">.</span><span class="ident" id="6339032">runN</span><span class="op" id="6339036">(</span><span class="ident" id="6339037">n</span><span class="op" id="6339038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6339041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6339044">b</span><span class="op" id="6339045">.</span><span class="ident" id="6339046">result</span>&nbsp;<span class="op" id="6339053">=</span>&nbsp;<span class="ident" id="6339055">BenchmarkResult</span><span class="op" id="6339070">{</span><span class="ident" id="6339071">b</span><span class="op" id="6339072">.</span><span class="ident" id="6339073">N</span><span class="op" id="6339074">,</span>&nbsp;<span class="ident" id="6339076">b</span><span class="op" id="6339077">.</span><span class="ident" id="6339078">duration</span><span class="op" id="6339086">,</span>&nbsp;<span class="ident" id="6339088">b</span><span class="op" id="6339089">.</span><span class="ident" id="6339090">bytes</span><span class="op" id="6339095">,</span>&nbsp;<span class="ident" id="6339097">b</span><span class="op" id="6339098">.</span><span class="ident" id="6339099">netAllocs</span><span class="op" id="6339108">,</span>&nbsp;<span class="ident" id="6339110">b</span><span class="op" id="6339111">.</span><span class="ident" id="6339112">netBytes</span><span class="op" id="6339120">}</span><br>
<span class="lineno"></span><span class="op" id="6339122">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="6339125">//&nbsp;The&nbsp;results&nbsp;of&nbsp;a&nbsp;benchmark&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="6339160">type</span>&nbsp;<span class="ident" id="6339165">BenchmarkResult</span>&nbsp;<span class="keyword" id="6339181">struct</span>&nbsp;<span class="op" id="6339188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6339191">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6339201">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6339215">//&nbsp;The&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6339245">T</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6339255">time</span><span class="op" id="6339259">.</span><span class="ident" id="6339260">Duration</span>&nbsp;<span class="comment" id="6339269">//&nbsp;The&nbsp;total&nbsp;time&nbsp;taken.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6339295">Bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6339305">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6339319">//&nbsp;Bytes&nbsp;processed&nbsp;in&nbsp;one&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6339357">MemAllocs</span>&nbsp;<span class="ident" id="6339367">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6339381">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;memory&nbsp;allocations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6339425">MemBytes</span>&nbsp;&nbsp;<span class="ident" id="6339435">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6339449">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;bytes&nbsp;allocated.</span><br>
<span class="lineno"></span><span class="op" id="6339489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="6339492">func</span>&nbsp;<span class="op" id="6339497">(</span><span class="ident" id="6339498">r</span>&nbsp;<span class="ident" id="6339500">BenchmarkResult</span><span class="op" id="6339515">)</span>&nbsp;<span class="ident" id="6339517">NsPerOp</span><span class="op" id="6339524">(</span><span class="op" id="6339525">)</span>&nbsp;<span class="ident" id="6339527">int64</span>&nbsp;<span class="op" id="6339533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6339536">if</span>&nbsp;<span class="ident" id="6339539">r</span><span class="op" id="6339540">.</span><span class="ident" id="6339541">N</span>&nbsp;<span class="op" id="6339543">&lt;=</span>&nbsp;<span class="num" id="6339546">0</span>&nbsp;<span class="op" id="6339548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6339552">return</span>&nbsp;<span class="num" id="6339559">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6339562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6339565">return</span>&nbsp;<span class="ident" id="6339572">r</span><span class="op" id="6339573">.</span><span class="ident" id="6339574">T</span><span class="op" id="6339575">.</span><span class="ident" id="6339576">Nanoseconds</span><span class="op" id="6339587">(</span><span class="op" id="6339588">)</span>&nbsp;<span class="op" id="6339590">/</span>&nbsp;<span class="ident" id="6339592">int64</span><span class="op" id="6339597">(</span><span class="ident" id="6339598">r</span><span class="op" id="6339599">.</span><span class="ident" id="6339600">N</span><span class="op" id="6339601">)</span><br>
<span class="lineno">235</span><span class="op" id="6339603">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6339606">func</span>&nbsp;<span class="op" id="6339611">(</span><span class="ident" id="6339612">r</span>&nbsp;<span class="ident" id="6339614">BenchmarkResult</span><span class="op" id="6339629">)</span>&nbsp;<span class="ident" id="6339631">mbPerSec</span><span class="op" id="6339639">(</span><span class="op" id="6339640">)</span>&nbsp;<span class="builtintype" id="6339642">float64</span>&nbsp;<span class="op" id="6339650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6339653">if</span>&nbsp;<span class="ident" id="6339656">r</span><span class="op" id="6339657">.</span><span class="ident" id="6339658">Bytes</span>&nbsp;<span class="op" id="6339664">&lt;=</span>&nbsp;<span class="num" id="6339667">0</span>&nbsp;<span class="op" id="6339669">||</span>&nbsp;<span class="ident" id="6339672">r</span><span class="op" id="6339673">.</span><span class="ident" id="6339674">T</span>&nbsp;<span class="op" id="6339676">&lt;=</span>&nbsp;<span class="num" id="6339679">0</span>&nbsp;<span class="op" id="6339681">||</span>&nbsp;<span class="ident" id="6339684">r</span><span class="op" id="6339685">.</span><span class="ident" id="6339686">N</span>&nbsp;<span class="op" id="6339688">&lt;=</span>&nbsp;<span class="num" id="6339691">0</span>&nbsp;<span class="op" id="6339693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6339697">return</span>&nbsp;<span class="num" id="6339704">0</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6339707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6339710">return</span>&nbsp;<span class="op" id="6339717">(</span><span class="builtintype" id="6339718">float64</span><span class="op" id="6339725">(</span><span class="ident" id="6339726">r</span><span class="op" id="6339727">.</span><span class="ident" id="6339728">Bytes</span><span class="op" id="6339733">)</span>&nbsp;<span class="op" id="6339735">*</span>&nbsp;<span class="builtintype" id="6339737">float64</span><span class="op" id="6339744">(</span><span class="ident" id="6339745">r</span><span class="op" id="6339746">.</span><span class="ident" id="6339747">N</span><span class="op" id="6339748">)</span>&nbsp;<span class="op" id="6339750">/</span>&nbsp;<span class="num" id="6339752">1e6</span><span class="op" id="6339755">)</span>&nbsp;<span class="op" id="6339757">/</span>&nbsp;<span class="ident" id="6339759">r</span><span class="op" id="6339760">.</span><span class="ident" id="6339761">T</span><span class="op" id="6339762">.</span><span class="ident" id="6339763">Seconds</span><span class="op" id="6339770">(</span><span class="op" id="6339771">)</span><br>
<span class="lineno"></span><span class="op" id="6339773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6339776">func</span>&nbsp;<span class="op" id="6339781">(</span><span class="ident" id="6339782">r</span>&nbsp;<span class="ident" id="6339784">BenchmarkResult</span><span class="op" id="6339799">)</span>&nbsp;<span class="ident" id="6339801">AllocsPerOp</span><span class="op" id="6339812">(</span><span class="op" id="6339813">)</span>&nbsp;<span class="ident" id="6339815">int64</span>&nbsp;<span class="op" id="6339821">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6339824">if</span>&nbsp;<span class="ident" id="6339827">r</span><span class="op" id="6339828">.</span><span class="ident" id="6339829">N</span>&nbsp;<span class="op" id="6339831">&lt;=</span>&nbsp;<span class="num" id="6339834">0</span>&nbsp;<span class="op" id="6339836">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6339840">return</span>&nbsp;<span class="num" id="6339847">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6339850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6339853">return</span>&nbsp;<span class="ident" id="6339860">int64</span><span class="op" id="6339865">(</span><span class="ident" id="6339866">r</span><span class="op" id="6339867">.</span><span class="ident" id="6339868">MemAllocs</span><span class="op" id="6339877">)</span>&nbsp;<span class="op" id="6339879">/</span>&nbsp;<span class="ident" id="6339881">int64</span><span class="op" id="6339886">(</span><span class="ident" id="6339887">r</span><span class="op" id="6339888">.</span><span class="ident" id="6339889">N</span><span class="op" id="6339890">)</span><br>
<span class="lineno"></span><span class="op" id="6339892">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="6339895">func</span>&nbsp;<span class="op" id="6339900">(</span><span class="ident" id="6339901">r</span>&nbsp;<span class="ident" id="6339903">BenchmarkResult</span><span class="op" id="6339918">)</span>&nbsp;<span class="ident" id="6339920">AllocedBytesPerOp</span><span class="op" id="6339937">(</span><span class="op" id="6339938">)</span>&nbsp;<span class="ident" id="6339940">int64</span>&nbsp;<span class="op" id="6339946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6339949">if</span>&nbsp;<span class="ident" id="6339952">r</span><span class="op" id="6339953">.</span><span class="ident" id="6339954">N</span>&nbsp;<span class="op" id="6339956">&lt;=</span>&nbsp;<span class="num" id="6339959">0</span>&nbsp;<span class="op" id="6339961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6339965">return</span>&nbsp;<span class="num" id="6339972">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6339975">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6339978">return</span>&nbsp;<span class="ident" id="6339985">int64</span><span class="op" id="6339990">(</span><span class="ident" id="6339991">r</span><span class="op" id="6339992">.</span><span class="ident" id="6339993">MemBytes</span><span class="op" id="6340001">)</span>&nbsp;<span class="op" id="6340003">/</span>&nbsp;<span class="ident" id="6340005">int64</span><span class="op" id="6340010">(</span><span class="ident" id="6340011">r</span><span class="op" id="6340012">.</span><span class="ident" id="6340013">N</span><span class="op" id="6340014">)</span><br>
<span class="lineno"></span><span class="op" id="6340016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6340019">func</span>&nbsp;<span class="op" id="6340024">(</span><span class="ident" id="6340025">r</span>&nbsp;<span class="ident" id="6340027">BenchmarkResult</span><span class="op" id="6340042">)</span>&nbsp;<span class="ident" id="6340044">String</span><span class="op" id="6340050">(</span><span class="op" id="6340051">)</span>&nbsp;<span class="builtintype" id="6340053">string</span>&nbsp;<span class="op" id="6340060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340063">mbs</span>&nbsp;<span class="op" id="6340067">:=</span>&nbsp;<span class="ident" id="6340070">r</span><span class="op" id="6340071">.</span><span class="ident" id="6340072">mbPerSec</span><span class="op" id="6340080">(</span><span class="op" id="6340081">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340084">mb</span>&nbsp;<span class="op" id="6340087">:=</span>&nbsp;<span class="string" id="6340090">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6340094">if</span>&nbsp;<span class="ident" id="6340097">mbs</span>&nbsp;<span class="op" id="6340101">!=</span>&nbsp;<span class="num" id="6340104">0</span>&nbsp;<span class="op" id="6340106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340110">mb</span>&nbsp;<span class="op" id="6340113">=</span>&nbsp;<span class="ident" id="6340115">fmt</span><span class="op" id="6340118">.</span><span class="ident" id="6340119">Sprintf</span><span class="op" id="6340126">(</span><span class="string" id="6340127">&#34;\t%7.2f&nbsp;MB/s&#34;</span><span class="op" id="6340141">,</span>&nbsp;<span class="ident" id="6340143">mbs</span><span class="op" id="6340146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6340149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340152">nsop</span>&nbsp;<span class="op" id="6340157">:=</span>&nbsp;<span class="ident" id="6340160">r</span><span class="op" id="6340161">.</span><span class="ident" id="6340162">NsPerOp</span><span class="op" id="6340169">(</span><span class="op" id="6340170">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340173">ns</span>&nbsp;<span class="op" id="6340176">:=</span>&nbsp;<span class="ident" id="6340179">fmt</span><span class="op" id="6340182">.</span><span class="ident" id="6340183">Sprintf</span><span class="op" id="6340190">(</span><span class="string" id="6340191">&#34;%10d&nbsp;ns/op&#34;</span><span class="op" id="6340203">,</span>&nbsp;<span class="ident" id="6340205">nsop</span><span class="op" id="6340209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6340212">if</span>&nbsp;<span class="ident" id="6340215">r</span><span class="op" id="6340216">.</span><span class="ident" id="6340217">N</span>&nbsp;<span class="op" id="6340219">&gt;</span>&nbsp;<span class="num" id="6340221">0</span>&nbsp;<span class="op" id="6340223">&amp;&amp;</span>&nbsp;<span class="ident" id="6340226">nsop</span>&nbsp;<span class="op" id="6340231">&lt;</span>&nbsp;<span class="num" id="6340233">100</span>&nbsp;<span class="op" id="6340237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6340241">//&nbsp;The&nbsp;format&nbsp;specifiers&nbsp;here&nbsp;make&nbsp;sure&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6340288">//&nbsp;the&nbsp;ones&nbsp;digits&nbsp;line&nbsp;up&nbsp;for&nbsp;all&nbsp;three&nbsp;possible&nbsp;formats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6340349">if</span>&nbsp;<span class="ident" id="6340352">nsop</span>&nbsp;<span class="op" id="6340357">&lt;</span>&nbsp;<span class="num" id="6340359">10</span>&nbsp;<span class="op" id="6340362">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340367">ns</span>&nbsp;<span class="op" id="6340370">=</span>&nbsp;<span class="ident" id="6340372">fmt</span><span class="op" id="6340375">.</span><span class="ident" id="6340376">Sprintf</span><span class="op" id="6340383">(</span><span class="string" id="6340384">&#34;%13.2f&nbsp;ns/op&#34;</span><span class="op" id="6340398">,</span>&nbsp;<span class="builtintype" id="6340400">float64</span><span class="op" id="6340407">(</span><span class="ident" id="6340408">r</span><span class="op" id="6340409">.</span><span class="ident" id="6340410">T</span><span class="op" id="6340411">.</span><span class="ident" id="6340412">Nanoseconds</span><span class="op" id="6340423">(</span><span class="op" id="6340424">)</span><span class="op" id="6340425">)</span><span class="op" id="6340426">/</span><span class="builtintype" id="6340427">float64</span><span class="op" id="6340434">(</span><span class="ident" id="6340435">r</span><span class="op" id="6340436">.</span><span class="ident" id="6340437">N</span><span class="op" id="6340438">)</span><span class="op" id="6340439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6340443">}</span>&nbsp;<span class="keyword" id="6340445">else</span>&nbsp;<span class="op" id="6340450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340455">ns</span>&nbsp;<span class="op" id="6340458">=</span>&nbsp;<span class="ident" id="6340460">fmt</span><span class="op" id="6340463">.</span><span class="ident" id="6340464">Sprintf</span><span class="op" id="6340471">(</span><span class="string" id="6340472">&#34;%12.1f&nbsp;ns/op&#34;</span><span class="op" id="6340486">,</span>&nbsp;<span class="builtintype" id="6340488">float64</span><span class="op" id="6340495">(</span><span class="ident" id="6340496">r</span><span class="op" id="6340497">.</span><span class="ident" id="6340498">T</span><span class="op" id="6340499">.</span><span class="ident" id="6340500">Nanoseconds</span><span class="op" id="6340511">(</span><span class="op" id="6340512">)</span><span class="op" id="6340513">)</span><span class="op" id="6340514">/</span><span class="builtintype" id="6340515">float64</span><span class="op" id="6340522">(</span><span class="ident" id="6340523">r</span><span class="op" id="6340524">.</span><span class="ident" id="6340525">N</span><span class="op" id="6340526">)</span><span class="op" id="6340527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6340531">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6340534">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6340537">return</span>&nbsp;<span class="ident" id="6340544">fmt</span><span class="op" id="6340547">.</span><span class="ident" id="6340548">Sprintf</span><span class="op" id="6340555">(</span><span class="string" id="6340556">&#34;%8d\t%s%s&#34;</span><span class="op" id="6340567">,</span>&nbsp;<span class="ident" id="6340569">r</span><span class="op" id="6340570">.</span><span class="ident" id="6340571">N</span><span class="op" id="6340572">,</span>&nbsp;<span class="ident" id="6340574">ns</span><span class="op" id="6340576">,</span>&nbsp;<span class="ident" id="6340578">mb</span><span class="op" id="6340580">)</span><br>
<span class="lineno"></span><span class="op" id="6340582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6340585">func</span>&nbsp;<span class="op" id="6340590">(</span><span class="ident" id="6340591">r</span>&nbsp;<span class="ident" id="6340593">BenchmarkResult</span><span class="op" id="6340608">)</span>&nbsp;<span class="ident" id="6340610">MemString</span><span class="op" id="6340619">(</span><span class="op" id="6340620">)</span>&nbsp;<span class="builtintype" id="6340622">string</span>&nbsp;<span class="op" id="6340629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6340632">return</span>&nbsp;<span class="ident" id="6340639">fmt</span><span class="op" id="6340642">.</span><span class="ident" id="6340643">Sprintf</span><span class="op" id="6340650">(</span><span class="string" id="6340651">&#34;%8d&nbsp;B/op\t%8d&nbsp;allocs/op&#34;</span><span class="op" id="6340676">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6340680">r</span><span class="op" id="6340681">.</span><span class="ident" id="6340682">AllocedBytesPerOp</span><span class="op" id="6340699">(</span><span class="op" id="6340700">)</span><span class="op" id="6340701">,</span>&nbsp;<span class="ident" id="6340703">r</span><span class="op" id="6340704">.</span><span class="ident" id="6340705">AllocsPerOp</span><span class="op" id="6340716">(</span><span class="op" id="6340717">)</span><span class="op" id="6340718">)</span><br>
<span class="lineno"></span><span class="op" id="6340720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6340723">//&nbsp;An&nbsp;internal&nbsp;function&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6340816">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno">285</span><span class="keyword" id="6340845">func</span>&nbsp;<span class="ident" id="6340850">RunBenchmarks</span><span class="op" id="6340863">(</span><span class="ident" id="6340864">matchString</span>&nbsp;<span class="keyword" id="6340876">func</span><span class="op" id="6340880">(</span><span class="ident" id="6340881">pat</span><span class="op" id="6340884">,</span>&nbsp;<span class="ident" id="6340886">str</span>&nbsp;<span class="builtintype" id="6340890">string</span><span class="op" id="6340896">)</span>&nbsp;<span class="op" id="6340898">(</span><span class="builtintype" id="6340899">bool</span><span class="op" id="6340903">,</span>&nbsp;<span class="builtintype" id="6340905">error</span><span class="op" id="6340910">)</span><span class="op" id="6340911">,</span>&nbsp;<span class="ident" id="6340913">benchmarks</span>&nbsp;<span class="op" id="6340924">[</span><span class="op" id="6340925">]</span><span class="ident" id="6340926">InternalBenchmark</span><span class="op" id="6340943">)</span>&nbsp;<span class="op" id="6340945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6340948">//&nbsp;If&nbsp;no&nbsp;flag&nbsp;was&nbsp;specified,&nbsp;don&#39;t&nbsp;run&nbsp;benchmarks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6341000">if</span>&nbsp;<span class="builtinfunc" id="6341003">len</span><span class="op" id="6341006">(</span><span class="op" id="6341007">*</span><span class="ident" id="6341008">matchBenchmarks</span><span class="op" id="6341023">)</span>&nbsp;<span class="op" id="6341025">==</span>&nbsp;<span class="num" id="6341028">0</span>&nbsp;<span class="op" id="6341030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6341034">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6341042">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6341045">for</span>&nbsp;<span class="ident" id="6341049">_</span><span class="op" id="6341050">,</span>&nbsp;<span class="ident" id="6341052">Benchmark</span>&nbsp;<span class="op" id="6341062">:=</span>&nbsp;<span class="keyword" id="6341065">range</span>&nbsp;<span class="ident" id="6341071">benchmarks</span>&nbsp;<span class="op" id="6341082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341086">matched</span><span class="op" id="6341093">,</span>&nbsp;<span class="ident" id="6341095">err</span>&nbsp;<span class="op" id="6341099">:=</span>&nbsp;<span class="ident" id="6341102">matchString</span><span class="op" id="6341113">(</span><span class="op" id="6341114">*</span><span class="ident" id="6341115">matchBenchmarks</span><span class="op" id="6341130">,</span>&nbsp;<span class="ident" id="6341132">Benchmark</span><span class="op" id="6341141">.</span><span class="ident" id="6341142">Name</span><span class="op" id="6341146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6341150">if</span>&nbsp;<span class="ident" id="6341153">err</span>&nbsp;<span class="op" id="6341157">!=</span>&nbsp;<span class="ident" id="6341160">nil</span>&nbsp;<span class="op" id="6341164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341169">fmt</span><span class="op" id="6341172">.</span><span class="ident" id="6341173">Fprintf</span><span class="op" id="6341180">(</span><span class="ident" id="6341181">os</span><span class="op" id="6341183">.</span><span class="ident" id="6341184">Stderr</span><span class="op" id="6341190">,</span>&nbsp;<span class="string" id="6341192">&#34;testing:&nbsp;invalid&nbsp;regexp&nbsp;for&nbsp;-test.bench:&nbsp;%s\n&#34;</span><span class="op" id="6341239">,</span>&nbsp;<span class="ident" id="6341241">err</span><span class="op" id="6341244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341249">os</span><span class="op" id="6341251">.</span><span class="ident" id="6341252">Exit</span><span class="op" id="6341256">(</span><span class="num" id="6341257">1</span><span class="op" id="6341258">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6341262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6341266">if</span>&nbsp;<span class="op" id="6341269">!</span><span class="ident" id="6341270">matched</span>&nbsp;<span class="op" id="6341278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6341283">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6341294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6341298">for</span>&nbsp;<span class="ident" id="6341302">_</span><span class="op" id="6341303">,</span>&nbsp;<span class="ident" id="6341305">procs</span>&nbsp;<span class="op" id="6341311">:=</span>&nbsp;<span class="keyword" id="6341314">range</span>&nbsp;<span class="ident" id="6341320">cpuList</span>&nbsp;<span class="op" id="6341328">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341333">runtime</span><span class="op" id="6341340">.</span><span class="ident" id="6341341">GOMAXPROCS</span><span class="op" id="6341351">(</span><span class="ident" id="6341352">procs</span><span class="op" id="6341357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341362">b</span>&nbsp;<span class="op" id="6341364">:=</span>&nbsp;<span class="op" id="6341367">&amp;</span><span class="ident" id="6341368">B</span><span class="op" id="6341369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341375">common</span><span class="op" id="6341381">:</span>&nbsp;<span class="ident" id="6341383">common</span><span class="op" id="6341389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341396">signal</span><span class="op" id="6341402">:</span>&nbsp;<span class="builtinfunc" id="6341404">make</span><span class="op" id="6341408">(</span><span class="keyword" id="6341409">chan</span>&nbsp;<span class="keyword" id="6341414">interface</span><span class="op" id="6341423">{</span><span class="op" id="6341424">}</span><span class="op" id="6341425">)</span><span class="op" id="6341426">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6341432">}</span><span class="op" id="6341433">,</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341439">benchmark</span><span class="op" id="6341448">:</span>&nbsp;<span class="ident" id="6341450">Benchmark</span><span class="op" id="6341459">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6341464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341469">benchName</span>&nbsp;<span class="op" id="6341479">:=</span>&nbsp;<span class="ident" id="6341482">Benchmark</span><span class="op" id="6341491">.</span><span class="ident" id="6341492">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6341500">if</span>&nbsp;<span class="ident" id="6341503">procs</span>&nbsp;<span class="op" id="6341509">!=</span>&nbsp;<span class="num" id="6341512">1</span>&nbsp;<span class="op" id="6341514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341520">benchName</span>&nbsp;<span class="op" id="6341530">=</span>&nbsp;<span class="ident" id="6341532">fmt</span><span class="op" id="6341535">.</span><span class="ident" id="6341536">Sprintf</span><span class="op" id="6341543">(</span><span class="string" id="6341544">&#34;%s-%d&#34;</span><span class="op" id="6341551">,</span>&nbsp;<span class="ident" id="6341553">Benchmark</span><span class="op" id="6341562">.</span><span class="ident" id="6341563">Name</span><span class="op" id="6341567">,</span>&nbsp;<span class="ident" id="6341569">procs</span><span class="op" id="6341574">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6341579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341584">fmt</span><span class="op" id="6341587">.</span><span class="ident" id="6341588">Printf</span><span class="op" id="6341594">(</span><span class="string" id="6341595">&#34;%s\t&#34;</span><span class="op" id="6341601">,</span>&nbsp;<span class="ident" id="6341603">benchName</span><span class="op" id="6341612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341617">r</span>&nbsp;<span class="op" id="6341619">:=</span>&nbsp;<span class="ident" id="6341622">b</span><span class="op" id="6341623">.</span><span class="ident" id="6341624">run</span><span class="op" id="6341627">(</span><span class="op" id="6341628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6341633">if</span>&nbsp;<span class="ident" id="6341636">b</span><span class="op" id="6341637">.</span><span class="ident" id="6341638">failed</span>&nbsp;<span class="op" id="6341645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6341651">//&nbsp;The&nbsp;output&nbsp;could&nbsp;be&nbsp;very&nbsp;long&nbsp;here,&nbsp;but&nbsp;probably&nbsp;isn&#39;t.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6341714">//&nbsp;We&nbsp;print&nbsp;it&nbsp;all,&nbsp;regardless,&nbsp;because&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;trim&nbsp;the&nbsp;reason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6341791">//&nbsp;the&nbsp;benchmark&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341820">fmt</span><span class="op" id="6341823">.</span><span class="ident" id="6341824">Printf</span><span class="op" id="6341830">(</span><span class="string" id="6341831">&#34;---&nbsp;FAIL:&nbsp;%s\n%s&#34;</span><span class="op" id="6341849">,</span>&nbsp;<span class="ident" id="6341851">benchName</span><span class="op" id="6341860">,</span>&nbsp;<span class="ident" id="6341862">b</span><span class="op" id="6341863">.</span><span class="ident" id="6341864">output</span><span class="op" id="6341870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6341876">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6341888">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341893">results</span>&nbsp;<span class="op" id="6341901">:=</span>&nbsp;<span class="ident" id="6341904">r</span><span class="op" id="6341905">.</span><span class="ident" id="6341906">String</span><span class="op" id="6341912">(</span><span class="op" id="6341913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6341918">if</span>&nbsp;<span class="op" id="6341921">*</span><span class="ident" id="6341922">benchmarkMemory</span>&nbsp;<span class="op" id="6341938">||</span>&nbsp;<span class="ident" id="6341941">b</span><span class="op" id="6341942">.</span><span class="ident" id="6341943">showAllocResult</span>&nbsp;<span class="op" id="6341959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6341965">results</span>&nbsp;<span class="op" id="6341973">+=</span>&nbsp;<span class="string" id="6341976">&#34;\t&#34;</span>&nbsp;<span class="op" id="6341981">+</span>&nbsp;<span class="ident" id="6341983">r</span><span class="op" id="6341984">.</span><span class="ident" id="6341985">MemString</span><span class="op" id="6341994">(</span><span class="op" id="6341995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6342000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6342005">fmt</span><span class="op" id="6342008">.</span><span class="ident" id="6342009">Println</span><span class="op" id="6342016">(</span><span class="ident" id="6342017">results</span><span class="op" id="6342024">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6342029">//&nbsp;Unlike&nbsp;with&nbsp;tests,&nbsp;we&nbsp;ignore&nbsp;the&nbsp;-chatty&nbsp;flag&nbsp;and&nbsp;always&nbsp;print&nbsp;output&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6342109">//&nbsp;benchmarks&nbsp;since&nbsp;the&nbsp;output&nbsp;generation&nbsp;time&nbsp;will&nbsp;skew&nbsp;the&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6342182">if</span>&nbsp;<span class="builtinfunc" id="6342185">len</span><span class="op" id="6342188">(</span><span class="ident" id="6342189">b</span><span class="op" id="6342190">.</span><span class="ident" id="6342191">output</span><span class="op" id="6342197">)</span>&nbsp;<span class="op" id="6342199">&gt;</span>&nbsp;<span class="num" id="6342201">0</span>&nbsp;<span class="op" id="6342203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6342209">b</span><span class="op" id="6342210">.</span><span class="ident" id="6342211">trimOutput</span><span class="op" id="6342221">(</span><span class="op" id="6342222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6342228">fmt</span><span class="op" id="6342231">.</span><span class="ident" id="6342232">Printf</span><span class="op" id="6342238">(</span><span class="string" id="6342239">&#34;---&nbsp;BENCH:&nbsp;%s\n%s&#34;</span><span class="op" id="6342258">,</span>&nbsp;<span class="ident" id="6342260">benchName</span><span class="op" id="6342269">,</span>&nbsp;<span class="ident" id="6342271">b</span><span class="op" id="6342272">.</span><span class="ident" id="6342273">output</span><span class="op" id="6342279">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6342284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6342289">if</span>&nbsp;<span class="ident" id="6342292">p</span>&nbsp;<span class="op" id="6342294">:=</span>&nbsp;<span class="ident" id="6342297">runtime</span><span class="op" id="6342304">.</span><span class="ident" id="6342305">GOMAXPROCS</span><span class="op" id="6342315">(</span><span class="op" id="6342316">-</span><span class="num" id="6342317">1</span><span class="op" id="6342318">)</span><span class="op" id="6342319">;</span>&nbsp;<span class="ident" id="6342321">p</span>&nbsp;<span class="op" id="6342323">!=</span>&nbsp;<span class="ident" id="6342326">procs</span>&nbsp;<span class="op" id="6342332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6342338">fmt</span><span class="op" id="6342341">.</span><span class="ident" id="6342342">Fprintf</span><span class="op" id="6342349">(</span><span class="ident" id="6342350">os</span><span class="op" id="6342352">.</span><span class="ident" id="6342353">Stderr</span><span class="op" id="6342359">,</span>&nbsp;<span class="string" id="6342361">&#34;testing:&nbsp;%s&nbsp;left&nbsp;GOMAXPROCS&nbsp;set&nbsp;to&nbsp;%d\n&#34;</span><span class="op" id="6342402">,</span>&nbsp;<span class="ident" id="6342404">benchName</span><span class="op" id="6342413">,</span>&nbsp;<span class="ident" id="6342415">p</span><span class="op" id="6342416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6342421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6342425">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6342428">}</span><br>
<span class="lineno"></span><span class="op" id="6342430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6342433">//&nbsp;trimOutput&nbsp;shortens&nbsp;the&nbsp;output&nbsp;from&nbsp;a&nbsp;benchmark,&nbsp;which&nbsp;can&nbsp;be&nbsp;very&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="6342509">func</span>&nbsp;<span class="op" id="6342514">(</span><span class="ident" id="6342515">b</span>&nbsp;<span class="op" id="6342517">*</span><span class="ident" id="6342518">B</span><span class="op" id="6342519">)</span>&nbsp;<span class="ident" id="6342521">trimOutput</span><span class="op" id="6342531">(</span><span class="op" id="6342532">)</span>&nbsp;<span class="op" id="6342534">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6342537">//&nbsp;The&nbsp;output&nbsp;is&nbsp;likely&nbsp;to&nbsp;appear&nbsp;multiple&nbsp;times&nbsp;because&nbsp;the&nbsp;benchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6342609">//&nbsp;is&nbsp;run&nbsp;multiple&nbsp;times,&nbsp;but&nbsp;at&nbsp;least&nbsp;it&nbsp;will&nbsp;be&nbsp;seen.&nbsp;This&nbsp;is&nbsp;not&nbsp;a&nbsp;big&nbsp;deal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6342689">//&nbsp;because&nbsp;benchmarks&nbsp;rarely&nbsp;print,&nbsp;but&nbsp;just&nbsp;in&nbsp;case,&nbsp;we&nbsp;trim&nbsp;it&nbsp;if&nbsp;it&#39;s&nbsp;too&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6342773">const</span>&nbsp;<span class="ident" id="6342779">maxNewlines</span>&nbsp;<span class="op" id="6342791">=</span>&nbsp;<span class="num" id="6342793">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6342797">for</span>&nbsp;<span class="ident" id="6342801">nlCount</span><span class="op" id="6342808">,</span>&nbsp;<span class="ident" id="6342810">j</span>&nbsp;<span class="op" id="6342812">:=</span>&nbsp;<span class="num" id="6342815">0</span><span class="op" id="6342816">,</span>&nbsp;<span class="num" id="6342818">0</span><span class="op" id="6342819">;</span>&nbsp;<span class="ident" id="6342821">j</span>&nbsp;<span class="op" id="6342823">&lt;</span>&nbsp;<span class="builtinfunc" id="6342825">len</span><span class="op" id="6342828">(</span><span class="ident" id="6342829">b</span><span class="op" id="6342830">.</span><span class="ident" id="6342831">output</span><span class="op" id="6342837">)</span><span class="op" id="6342838">;</span>&nbsp;<span class="ident" id="6342840">j</span><span class="op" id="6342841">++</span>&nbsp;<span class="op" id="6342844">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6342848">if</span>&nbsp;<span class="ident" id="6342851">b</span><span class="op" id="6342852">.</span><span class="ident" id="6342853">output</span><span class="op" id="6342859">[</span><span class="ident" id="6342860">j</span><span class="op" id="6342861">]</span>&nbsp;<span class="op" id="6342863">==</span>&nbsp;<span class="string" id="6342866">&#39;\n&#39;</span>&nbsp;<span class="op" id="6342871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6342876">nlCount</span><span class="op" id="6342883">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6342889">if</span>&nbsp;<span class="ident" id="6342892">nlCount</span>&nbsp;<span class="op" id="6342900">&gt;=</span>&nbsp;<span class="ident" id="6342903">maxNewlines</span>&nbsp;<span class="op" id="6342915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6342921">b</span><span class="op" id="6342922">.</span><span class="ident" id="6342923">output</span>&nbsp;<span class="op" id="6342930">=</span>&nbsp;<span class="builtinfunc" id="6342932">append</span><span class="op" id="6342938">(</span><span class="ident" id="6342939">b</span><span class="op" id="6342940">.</span><span class="ident" id="6342941">output</span><span class="op" id="6342947">[</span><span class="op" id="6342948">:</span><span class="ident" id="6342949">j</span><span class="op" id="6342950">]</span><span class="op" id="6342951">,</span>&nbsp;<span class="string" id="6342953">&#34;\n\t...&nbsp;[output&nbsp;truncated]\n&#34;</span><span class="op" id="6342983">...</span><span class="op" id="6342986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6342992">break</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6343001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6343005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6343008">}</span><br>
<span class="lineno"></span><span class="op" id="6343010">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="6343013">//&nbsp;A&nbsp;PB&nbsp;is&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;for&nbsp;running&nbsp;parallel&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="keyword" id="6343077">type</span>&nbsp;<span class="ident" id="6343082">PB</span>&nbsp;<span class="keyword" id="6343085">struct</span>&nbsp;<span class="op" id="6343092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6343095">globalN</span>&nbsp;<span class="op" id="6343103">*</span><span class="ident" id="6343104">uint64</span>&nbsp;<span class="comment" id="6343111">//&nbsp;shared&nbsp;between&nbsp;all&nbsp;worker&nbsp;goroutines&nbsp;iteration&nbsp;counter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6343170">grain</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6343178">uint64</span>&nbsp;&nbsp;<span class="comment" id="6343186">//&nbsp;acquire&nbsp;that&nbsp;many&nbsp;iterations&nbsp;from&nbsp;globalN&nbsp;at&nbsp;once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6343240">cache</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6343248">uint64</span>&nbsp;&nbsp;<span class="comment" id="6343256">//&nbsp;local&nbsp;cache&nbsp;of&nbsp;acquired&nbsp;iterations</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6343295">bN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6343303">uint64</span>&nbsp;&nbsp;<span class="comment" id="6343311">//&nbsp;total&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;execute&nbsp;(b.N)</span><br>
<span class="lineno"></span><span class="op" id="6343358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6343361">//&nbsp;Next&nbsp;reports&nbsp;whether&nbsp;there&nbsp;are&nbsp;more&nbsp;iterations&nbsp;to&nbsp;execute.</span><br>
<span class="lineno"></span><span class="keyword" id="6343423">func</span>&nbsp;<span class="op" id="6343428">(</span><span class="ident" id="6343429">pb</span>&nbsp;<span class="op" id="6343432">*</span><span class="ident" id="6343433">PB</span><span class="op" id="6343435">)</span>&nbsp;<span class="ident" id="6343437">Next</span><span class="op" id="6343441">(</span><span class="op" id="6343442">)</span>&nbsp;<span class="builtintype" id="6343444">bool</span>&nbsp;<span class="op" id="6343449">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6343452">if</span>&nbsp;<span class="ident" id="6343455">pb</span><span class="op" id="6343457">.</span><span class="ident" id="6343458">cache</span>&nbsp;<span class="op" id="6343464">==</span>&nbsp;<span class="num" id="6343467">0</span>&nbsp;<span class="op" id="6343469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6343473">n</span>&nbsp;<span class="op" id="6343475">:=</span>&nbsp;<span class="ident" id="6343478">atomic</span><span class="op" id="6343484">.</span><span class="ident" id="6343485">AddUint64</span><span class="op" id="6343494">(</span><span class="ident" id="6343495">pb</span><span class="op" id="6343497">.</span><span class="ident" id="6343498">globalN</span><span class="op" id="6343505">,</span>&nbsp;<span class="ident" id="6343507">pb</span><span class="op" id="6343509">.</span><span class="ident" id="6343510">grain</span><span class="op" id="6343515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6343519">if</span>&nbsp;<span class="ident" id="6343522">n</span>&nbsp;<span class="op" id="6343524">&lt;=</span>&nbsp;<span class="ident" id="6343527">pb</span><span class="op" id="6343529">.</span><span class="ident" id="6343530">bN</span>&nbsp;<span class="op" id="6343533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6343538">pb</span><span class="op" id="6343540">.</span><span class="ident" id="6343541">cache</span>&nbsp;<span class="op" id="6343547">=</span>&nbsp;<span class="ident" id="6343549">pb</span><span class="op" id="6343551">.</span><span class="ident" id="6343552">grain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6343560">}</span>&nbsp;<span class="keyword" id="6343562">else</span>&nbsp;<span class="keyword" id="6343567">if</span>&nbsp;<span class="ident" id="6343570">n</span>&nbsp;<span class="op" id="6343572">&lt;</span>&nbsp;<span class="ident" id="6343574">pb</span><span class="op" id="6343576">.</span><span class="ident" id="6343577">bN</span><span class="op" id="6343579">+</span><span class="ident" id="6343580">pb</span><span class="op" id="6343582">.</span><span class="ident" id="6343583">grain</span>&nbsp;<span class="op" id="6343589">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6343594">pb</span><span class="op" id="6343596">.</span><span class="ident" id="6343597">cache</span>&nbsp;<span class="op" id="6343603">=</span>&nbsp;<span class="ident" id="6343605">pb</span><span class="op" id="6343607">.</span><span class="ident" id="6343608">bN</span>&nbsp;<span class="op" id="6343611">+</span>&nbsp;<span class="ident" id="6343613">pb</span><span class="op" id="6343615">.</span><span class="ident" id="6343616">grain</span>&nbsp;<span class="op" id="6343622">-</span>&nbsp;<span class="ident" id="6343624">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6343628">}</span>&nbsp;<span class="keyword" id="6343630">else</span>&nbsp;<span class="op" id="6343635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6343640">return</span>&nbsp;<span class="builtintype" id="6343647">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6343655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6343658">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6343661">pb</span><span class="op" id="6343663">.</span><span class="ident" id="6343664">cache</span><span class="op" id="6343669">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6343673">return</span>&nbsp;<span class="builtintype" id="6343680">true</span><br>
<span class="lineno"></span><span class="op" id="6343685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6343688">//&nbsp;RunParallel&nbsp;runs&nbsp;a&nbsp;benchmark&nbsp;in&nbsp;parallel.</span><br>
<span class="lineno">380</span><span class="comment" id="6343733">//&nbsp;It&nbsp;creates&nbsp;multiple&nbsp;goroutines&nbsp;and&nbsp;distributes&nbsp;b.N&nbsp;iterations&nbsp;among&nbsp;them.</span><br>
<span class="lineno"></span><span class="comment" id="6343810">//&nbsp;The&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;defaults&nbsp;to&nbsp;GOMAXPROCS.&nbsp;To&nbsp;increase&nbsp;parallelism&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6343890">//&nbsp;non-CPU-bound&nbsp;benchmarks,&nbsp;call&nbsp;SetParallelism&nbsp;before&nbsp;RunParallel.</span><br>
<span class="lineno"></span><span class="comment" id="6343959">//&nbsp;RunParallel&nbsp;is&nbsp;usually&nbsp;used&nbsp;with&nbsp;the&nbsp;go&nbsp;test&nbsp;-cpu&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="6344018">//</span><br>
<span class="lineno">385</span><span class="comment" id="6344021">//&nbsp;The&nbsp;body&nbsp;function&nbsp;will&nbsp;be&nbsp;run&nbsp;in&nbsp;each&nbsp;goroutine.&nbsp;It&nbsp;should&nbsp;set&nbsp;up&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="6344094">//&nbsp;goroutine-local&nbsp;state&nbsp;and&nbsp;then&nbsp;iterate&nbsp;until&nbsp;pb.Next&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="6344165">//&nbsp;It&nbsp;should&nbsp;not&nbsp;use&nbsp;the&nbsp;StartTimer,&nbsp;StopTimer,&nbsp;or&nbsp;ResetTimer&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="6344238">//&nbsp;because&nbsp;they&nbsp;have&nbsp;global&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="6344274">func</span>&nbsp;<span class="op" id="6344279">(</span><span class="ident" id="6344280">b</span>&nbsp;<span class="op" id="6344282">*</span><span class="ident" id="6344283">B</span><span class="op" id="6344284">)</span>&nbsp;<span class="ident" id="6344286">RunParallel</span><span class="op" id="6344297">(</span><span class="ident" id="6344298">body</span>&nbsp;<span class="keyword" id="6344303">func</span><span class="op" id="6344307">(</span><span class="op" id="6344308">*</span><span class="ident" id="6344309">PB</span><span class="op" id="6344311">)</span><span class="op" id="6344312">)</span>&nbsp;<span class="op" id="6344314">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6344317">//&nbsp;Calculate&nbsp;grain&nbsp;size&nbsp;as&nbsp;number&nbsp;of&nbsp;iterations&nbsp;that&nbsp;take&nbsp;~100s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6344385">//&nbsp;100s&nbsp;is&nbsp;enough&nbsp;to&nbsp;amortize&nbsp;the&nbsp;overhead&nbsp;and&nbsp;provide&nbsp;sufficient</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6344454">//&nbsp;dynamic&nbsp;load&nbsp;balancing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6344482">grain</span>&nbsp;<span class="op" id="6344488">:=</span>&nbsp;<span class="ident" id="6344491">uint64</span><span class="op" id="6344497">(</span><span class="num" id="6344498">0</span><span class="op" id="6344499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6344502">if</span>&nbsp;<span class="ident" id="6344505">b</span><span class="op" id="6344506">.</span><span class="ident" id="6344507">previousN</span>&nbsp;<span class="op" id="6344517">&gt;</span>&nbsp;<span class="num" id="6344519">0</span>&nbsp;<span class="op" id="6344521">&amp;&amp;</span>&nbsp;<span class="ident" id="6344524">b</span><span class="op" id="6344525">.</span><span class="ident" id="6344526">previousDuration</span>&nbsp;<span class="op" id="6344543">&gt;</span>&nbsp;<span class="num" id="6344545">0</span>&nbsp;<span class="op" id="6344547">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6344551">grain</span>&nbsp;<span class="op" id="6344557">=</span>&nbsp;<span class="num" id="6344559">1e5</span>&nbsp;<span class="op" id="6344563">*</span>&nbsp;<span class="ident" id="6344565">uint64</span><span class="op" id="6344571">(</span><span class="ident" id="6344572">b</span><span class="op" id="6344573">.</span><span class="ident" id="6344574">previousN</span><span class="op" id="6344583">)</span>&nbsp;<span class="op" id="6344585">/</span>&nbsp;<span class="ident" id="6344587">uint64</span><span class="op" id="6344593">(</span><span class="ident" id="6344594">b</span><span class="op" id="6344595">.</span><span class="ident" id="6344596">previousDuration</span><span class="op" id="6344612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6344615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6344618">if</span>&nbsp;<span class="ident" id="6344621">grain</span>&nbsp;<span class="op" id="6344627">&lt;</span>&nbsp;<span class="num" id="6344629">1</span>&nbsp;<span class="op" id="6344631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6344635">grain</span>&nbsp;<span class="op" id="6344641">=</span>&nbsp;<span class="num" id="6344643">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6344646">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6344649">//&nbsp;We&nbsp;expect&nbsp;the&nbsp;inner&nbsp;loop&nbsp;and&nbsp;function&nbsp;call&nbsp;to&nbsp;take&nbsp;at&nbsp;least&nbsp;10ns,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6344719">//&nbsp;so&nbsp;do&nbsp;not&nbsp;do&nbsp;more&nbsp;than&nbsp;100s/10ns=1e4&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6344774">if</span>&nbsp;<span class="ident" id="6344777">grain</span>&nbsp;<span class="op" id="6344783">&gt;</span>&nbsp;<span class="num" id="6344785">1e4</span>&nbsp;<span class="op" id="6344789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6344793">grain</span>&nbsp;<span class="op" id="6344799">=</span>&nbsp;<span class="num" id="6344801">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6344806">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6344810">n</span>&nbsp;<span class="op" id="6344812">:=</span>&nbsp;<span class="ident" id="6344815">uint64</span><span class="op" id="6344821">(</span><span class="num" id="6344822">0</span><span class="op" id="6344823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6344826">numProcs</span>&nbsp;<span class="op" id="6344835">:=</span>&nbsp;<span class="ident" id="6344838">b</span><span class="op" id="6344839">.</span><span class="ident" id="6344840">parallelism</span>&nbsp;<span class="op" id="6344852">*</span>&nbsp;<span class="ident" id="6344854">runtime</span><span class="op" id="6344861">.</span><span class="ident" id="6344862">GOMAXPROCS</span><span class="op" id="6344872">(</span><span class="num" id="6344873">0</span><span class="op" id="6344874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6344877">var</span>&nbsp;<span class="ident" id="6344881">wg</span>&nbsp;<span class="ident" id="6344884">sync</span><span class="op" id="6344888">.</span><span class="ident" id="6344889">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6344900">wg</span><span class="op" id="6344902">.</span><span class="ident" id="6344903">Add</span><span class="op" id="6344906">(</span><span class="ident" id="6344907">numProcs</span><span class="op" id="6344915">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6344918">for</span>&nbsp;<span class="ident" id="6344922">p</span>&nbsp;<span class="op" id="6344924">:=</span>&nbsp;<span class="num" id="6344927">0</span><span class="op" id="6344928">;</span>&nbsp;<span class="ident" id="6344930">p</span>&nbsp;<span class="op" id="6344932">&lt;</span>&nbsp;<span class="ident" id="6344934">numProcs</span><span class="op" id="6344942">;</span>&nbsp;<span class="ident" id="6344944">p</span><span class="op" id="6344945">++</span>&nbsp;<span class="op" id="6344948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6344952">go</span>&nbsp;<span class="keyword" id="6344955">func</span><span class="op" id="6344959">(</span><span class="op" id="6344960">)</span>&nbsp;<span class="op" id="6344962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6344967">defer</span>&nbsp;<span class="ident" id="6344973">wg</span><span class="op" id="6344975">.</span><span class="ident" id="6344976">Done</span><span class="op" id="6344980">(</span><span class="op" id="6344981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6344986">pb</span>&nbsp;<span class="op" id="6344989">:=</span>&nbsp;<span class="op" id="6344992">&amp;</span><span class="ident" id="6344993">PB</span><span class="op" id="6344995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6345001">globalN</span><span class="op" id="6345008">:</span>&nbsp;<span class="op" id="6345010">&amp;</span><span class="ident" id="6345011">n</span><span class="op" id="6345012">,</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6345018">grain</span><span class="op" id="6345023">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6345027">grain</span><span class="op" id="6345032">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6345038">bN</span><span class="op" id="6345040">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6345047">uint64</span><span class="op" id="6345053">(</span><span class="ident" id="6345054">b</span><span class="op" id="6345055">.</span><span class="ident" id="6345056">N</span><span class="op" id="6345057">)</span><span class="op" id="6345058">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6345063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6345068">body</span><span class="op" id="6345072">(</span><span class="ident" id="6345073">pb</span><span class="op" id="6345075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6345079">}</span><span class="op" id="6345080">(</span><span class="op" id="6345081">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6345084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6345087">wg</span><span class="op" id="6345089">.</span><span class="ident" id="6345090">Wait</span><span class="op" id="6345094">(</span><span class="op" id="6345095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6345098">if</span>&nbsp;<span class="ident" id="6345101">n</span>&nbsp;<span class="op" id="6345103">&lt;=</span>&nbsp;<span class="ident" id="6345106">uint64</span><span class="op" id="6345112">(</span><span class="ident" id="6345113">b</span><span class="op" id="6345114">.</span><span class="ident" id="6345115">N</span><span class="op" id="6345116">)</span>&nbsp;<span class="op" id="6345118">&amp;&amp;</span>&nbsp;<span class="op" id="6345121">!</span><span class="ident" id="6345122">b</span><span class="op" id="6345123">.</span><span class="ident" id="6345124">Failed</span><span class="op" id="6345130">(</span><span class="op" id="6345131">)</span>&nbsp;<span class="op" id="6345133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6345137">b</span><span class="op" id="6345138">.</span><span class="ident" id="6345139">Fatal</span><span class="op" id="6345144">(</span><span class="string" id="6345145">&#34;RunParallel:&nbsp;body&nbsp;exited&nbsp;without&nbsp;pb.Next()&nbsp;==&nbsp;false&#34;</span><span class="op" id="6345198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6345201">}</span><br>
<span class="lineno">425</span><span class="op" id="6345203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6345206">//&nbsp;SetParallelism&nbsp;sets&nbsp;the&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;to&nbsp;p*GOMAXPROCS.</span><br>
<span class="lineno"></span><span class="comment" id="6345291">//&nbsp;There&nbsp;is&nbsp;usually&nbsp;no&nbsp;need&nbsp;to&nbsp;call&nbsp;SetParallelism&nbsp;for&nbsp;CPU-bound&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="comment" id="6345368">//&nbsp;If&nbsp;p&nbsp;is&nbsp;less&nbsp;than&nbsp;1,&nbsp;this&nbsp;call&nbsp;will&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">430</span><span class="keyword" id="6345423">func</span>&nbsp;<span class="op" id="6345428">(</span><span class="ident" id="6345429">b</span>&nbsp;<span class="op" id="6345431">*</span><span class="ident" id="6345432">B</span><span class="op" id="6345433">)</span>&nbsp;<span class="ident" id="6345435">SetParallelism</span><span class="op" id="6345449">(</span><span class="ident" id="6345450">p</span>&nbsp;<span class="builtintype" id="6345452">int</span><span class="op" id="6345455">)</span>&nbsp;<span class="op" id="6345457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6345460">if</span>&nbsp;<span class="ident" id="6345463">p</span>&nbsp;<span class="op" id="6345465">&gt;=</span>&nbsp;<span class="num" id="6345468">1</span>&nbsp;<span class="op" id="6345470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6345474">b</span><span class="op" id="6345475">.</span><span class="ident" id="6345476">parallelism</span>&nbsp;<span class="op" id="6345488">=</span>&nbsp;<span class="ident" id="6345490">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6345493">}</span><br>
<span class="lineno"></span><span class="op" id="6345495">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="6345498">//&nbsp;Benchmark&nbsp;benchmarks&nbsp;a&nbsp;single&nbsp;function.&nbsp;Useful&nbsp;for&nbsp;creating</span><br>
<span class="lineno"></span><span class="comment" id="6345561">//&nbsp;custom&nbsp;benchmarks&nbsp;that&nbsp;do&nbsp;not&nbsp;use&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6345621">func</span>&nbsp;<span class="ident" id="6345626">Benchmark</span><span class="op" id="6345635">(</span><span class="ident" id="6345636">f</span>&nbsp;<span class="keyword" id="6345638">func</span><span class="op" id="6345642">(</span><span class="ident" id="6345643">b</span>&nbsp;<span class="op" id="6345645">*</span><span class="ident" id="6345646">B</span><span class="op" id="6345647">)</span><span class="op" id="6345648">)</span>&nbsp;<span class="ident" id="6345650">BenchmarkResult</span>&nbsp;<span class="op" id="6345666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6345669">b</span>&nbsp;<span class="op" id="6345671">:=</span>&nbsp;<span class="op" id="6345674">&amp;</span><span class="ident" id="6345675">B</span><span class="op" id="6345676">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6345680">common</span><span class="op" id="6345686">:</span>&nbsp;<span class="ident" id="6345688">common</span><span class="op" id="6345694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6345699">signal</span><span class="op" id="6345705">:</span>&nbsp;<span class="builtinfunc" id="6345707">make</span><span class="op" id="6345711">(</span><span class="keyword" id="6345712">chan</span>&nbsp;<span class="keyword" id="6345717">interface</span><span class="op" id="6345726">{</span><span class="op" id="6345727">}</span><span class="op" id="6345728">)</span><span class="op" id="6345729">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6345733">}</span><span class="op" id="6345734">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6345738">benchmark</span><span class="op" id="6345747">:</span>&nbsp;<span class="ident" id="6345749">InternalBenchmark</span><span class="op" id="6345766">{</span><span class="string" id="6345767">&#34;&#34;</span><span class="op" id="6345769">,</span>&nbsp;<span class="ident" id="6345771">f</span><span class="op" id="6345772">}</span><span class="op" id="6345773">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6345776">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6345779">return</span>&nbsp;<span class="ident" id="6345786">b</span><span class="op" id="6345787">.</span><span class="ident" id="6345788">run</span><span class="op" id="6345791">(</span><span class="op" id="6345792">)</span><br>
<span class="lineno"></span><span class="op" id="6345794">}</span>
</div>
</body>
</html>
