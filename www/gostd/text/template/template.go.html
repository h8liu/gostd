<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>text/template</h2>
<ul>
<li><a href="/gostd/text/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/text/template/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/text/template/examplefiles_test.go.html">examplefiles_test.go</a></li>
<li><a href="/gostd/text/template/examplefunc_test.go.html">examplefunc_test.go</a></li>
<li><a href="/gostd/text/template/exec.go.html">exec.go</a></li>
<li><a href="/gostd/text/template/exec_test.go.html">exec_test.go</a></li>
<li><a href="/gostd/text/template/funcs.go.html">funcs.go</a></li>
<li><a href="/gostd/text/template/helper.go.html">helper.go</a></li>
<li><a href="/gostd/text/template/multi_test.go.html">multi_test.go</a></li>
<li><a href="/gostd/text/template/template.go.html">template.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3162220">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3162275">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3162329">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3162380">package</span>&nbsp;<span class="ident" id="3162388">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3162398">import</span>&nbsp;<span class="op" id="3162405">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3162408">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3162415">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3162426">&#34;text/template/parse&#34;</span><br>
<span class="lineno"></span><span class="op" id="3162448">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3162451">//&nbsp;common&nbsp;holds&nbsp;the&nbsp;information&nbsp;shared&nbsp;by&nbsp;related&nbsp;templates.</span><br>
<span class="lineno"></span><span class="keyword" id="3162512">type</span>&nbsp;<span class="ident" id="3162517">common</span>&nbsp;<span class="keyword" id="3162524">struct</span>&nbsp;<span class="op" id="3162531">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162534">tmpl</span>&nbsp;<span class="keyword" id="3162539">map</span><span class="op" id="3162542">[</span><span class="builtintype" id="3162543">string</span><span class="op" id="3162549">]</span><span class="op" id="3162550">*</span><span class="ident" id="3162551">Template</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3162561">//&nbsp;We&nbsp;use&nbsp;two&nbsp;maps,&nbsp;one&nbsp;for&nbsp;parsing&nbsp;and&nbsp;one&nbsp;for&nbsp;execution.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3162621">//&nbsp;This&nbsp;separation&nbsp;makes&nbsp;the&nbsp;API&nbsp;cleaner&nbsp;since&nbsp;it&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3162680">//&nbsp;expose&nbsp;reflection&nbsp;to&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162717">parseFuncs</span>&nbsp;<span class="ident" id="3162728">FuncMap</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162737">execFuncs</span>&nbsp;&nbsp;<span class="keyword" id="3162748">map</span><span class="op" id="3162751">[</span><span class="builtintype" id="3162752">string</span><span class="op" id="3162758">]</span><span class="ident" id="3162759">reflect</span><span class="op" id="3162766">.</span><span class="ident" id="3162767">Value</span><br>
<span class="lineno"></span><span class="op" id="3162773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3162776">//&nbsp;Template&nbsp;is&nbsp;the&nbsp;representation&nbsp;of&nbsp;a&nbsp;parsed&nbsp;template.&nbsp;The&nbsp;*parse.Tree</span><br>
<span class="lineno"></span><span class="comment" id="3162848">//&nbsp;field&nbsp;is&nbsp;exported&nbsp;only&nbsp;for&nbsp;use&nbsp;by&nbsp;html/template&nbsp;and&nbsp;should&nbsp;be&nbsp;treated</span><br>
<span class="lineno">25</span><span class="comment" id="3162921">//&nbsp;as&nbsp;unexported&nbsp;by&nbsp;all&nbsp;other&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="3162960">type</span>&nbsp;<span class="ident" id="3162965">Template</span>&nbsp;<span class="keyword" id="3162974">struct</span>&nbsp;<span class="op" id="3162981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3162984">name</span>&nbsp;<span class="builtintype" id="3162989">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3162997">*</span><span class="ident" id="3162998">parse</span><span class="op" id="3163003">.</span><span class="ident" id="3163004">Tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163010">*</span><span class="ident" id="3163011">common</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163019">leftDelim</span>&nbsp;&nbsp;<span class="builtintype" id="3163030">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163038">rightDelim</span>&nbsp;<span class="builtintype" id="3163049">string</span><br>
<span class="lineno"></span><span class="op" id="3163056">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3163059">//&nbsp;New&nbsp;allocates&nbsp;a&nbsp;new&nbsp;template&nbsp;with&nbsp;the&nbsp;given&nbsp;name.</span><br>
<span class="lineno">35</span><span class="keyword" id="3163112">func</span>&nbsp;<span class="ident" id="3163117">New</span><span class="op" id="3163120">(</span><span class="ident" id="3163121">name</span>&nbsp;<span class="builtintype" id="3163126">string</span><span class="op" id="3163132">)</span>&nbsp;<span class="op" id="3163134">*</span><span class="ident" id="3163135">Template</span>&nbsp;<span class="op" id="3163144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163147">return</span>&nbsp;<span class="op" id="3163154">&amp;</span><span class="ident" id="3163155">Template</span><span class="op" id="3163163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163167">name</span><span class="op" id="3163171">:</span>&nbsp;<span class="ident" id="3163173">name</span><span class="op" id="3163177">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163180">}</span><br>
<span class="lineno"></span><span class="op" id="3163182">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="3163185">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;template.</span><br>
<span class="lineno"></span><span class="keyword" id="3163227">func</span>&nbsp;<span class="op" id="3163232">(</span><span class="ident" id="3163233">t</span>&nbsp;<span class="op" id="3163235">*</span><span class="ident" id="3163236">Template</span><span class="op" id="3163244">)</span>&nbsp;<span class="ident" id="3163246">Name</span><span class="op" id="3163250">(</span><span class="op" id="3163251">)</span>&nbsp;<span class="builtintype" id="3163253">string</span>&nbsp;<span class="op" id="3163260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163263">return</span>&nbsp;<span class="ident" id="3163270">t</span><span class="op" id="3163271">.</span><span class="ident" id="3163272">name</span><br>
<span class="lineno"></span><span class="op" id="3163277">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="3163280">//&nbsp;New&nbsp;allocates&nbsp;a&nbsp;new&nbsp;template&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;one&nbsp;and&nbsp;with&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="3163360">//&nbsp;delimiters.&nbsp;The&nbsp;association,&nbsp;which&nbsp;is&nbsp;transitive,&nbsp;allows&nbsp;one&nbsp;template&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3163436">//&nbsp;invoke&nbsp;another&nbsp;with&nbsp;a&nbsp;{{template}}&nbsp;action.</span><br>
<span class="lineno"></span><span class="keyword" id="3163482">func</span>&nbsp;<span class="op" id="3163487">(</span><span class="ident" id="3163488">t</span>&nbsp;<span class="op" id="3163490">*</span><span class="ident" id="3163491">Template</span><span class="op" id="3163499">)</span>&nbsp;<span class="ident" id="3163501">New</span><span class="op" id="3163504">(</span><span class="ident" id="3163505">name</span>&nbsp;<span class="builtintype" id="3163510">string</span><span class="op" id="3163516">)</span>&nbsp;<span class="op" id="3163518">*</span><span class="ident" id="3163519">Template</span>&nbsp;<span class="op" id="3163528">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163531">t</span><span class="op" id="3163532">.</span><span class="ident" id="3163533">init</span><span class="op" id="3163537">(</span><span class="op" id="3163538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163541">return</span>&nbsp;<span class="op" id="3163548">&amp;</span><span class="ident" id="3163549">Template</span><span class="op" id="3163557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163561">name</span><span class="op" id="3163565">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3163573">name</span><span class="op" id="3163577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163581">common</span><span class="op" id="3163587">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3163593">t</span><span class="op" id="3163594">.</span><span class="ident" id="3163595">common</span><span class="op" id="3163601">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163605">leftDelim</span><span class="op" id="3163614">:</span>&nbsp;&nbsp;<span class="ident" id="3163617">t</span><span class="op" id="3163618">.</span><span class="ident" id="3163619">leftDelim</span><span class="op" id="3163628">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163632">rightDelim</span><span class="op" id="3163642">:</span>&nbsp;<span class="ident" id="3163644">t</span><span class="op" id="3163645">.</span><span class="ident" id="3163646">rightDelim</span><span class="op" id="3163656">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163659">}</span><br>
<span class="lineno"></span><span class="op" id="3163661">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3163664">func</span>&nbsp;<span class="op" id="3163669">(</span><span class="ident" id="3163670">t</span>&nbsp;<span class="op" id="3163672">*</span><span class="ident" id="3163673">Template</span><span class="op" id="3163681">)</span>&nbsp;<span class="ident" id="3163683">init</span><span class="op" id="3163687">(</span><span class="op" id="3163688">)</span>&nbsp;<span class="op" id="3163690">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3163693">if</span>&nbsp;<span class="ident" id="3163696">t</span><span class="op" id="3163697">.</span><span class="ident" id="3163698">common</span>&nbsp;<span class="op" id="3163705">==</span>&nbsp;<span class="ident" id="3163708">nil</span>&nbsp;<span class="op" id="3163712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163716">t</span><span class="op" id="3163717">.</span><span class="ident" id="3163718">common</span>&nbsp;<span class="op" id="3163725">=</span>&nbsp;<span class="builtinfunc" id="3163727">new</span><span class="op" id="3163730">(</span><span class="ident" id="3163731">common</span><span class="op" id="3163737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163741">t</span><span class="op" id="3163742">.</span><span class="ident" id="3163743">tmpl</span>&nbsp;<span class="op" id="3163748">=</span>&nbsp;<span class="builtinfunc" id="3163750">make</span><span class="op" id="3163754">(</span><span class="keyword" id="3163755">map</span><span class="op" id="3163758">[</span><span class="builtintype" id="3163759">string</span><span class="op" id="3163765">]</span><span class="op" id="3163766">*</span><span class="ident" id="3163767">Template</span><span class="op" id="3163775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163779">t</span><span class="op" id="3163780">.</span><span class="ident" id="3163781">parseFuncs</span>&nbsp;<span class="op" id="3163792">=</span>&nbsp;<span class="builtinfunc" id="3163794">make</span><span class="op" id="3163798">(</span><span class="ident" id="3163799">FuncMap</span><span class="op" id="3163806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3163810">t</span><span class="op" id="3163811">.</span><span class="ident" id="3163812">execFuncs</span>&nbsp;<span class="op" id="3163822">=</span>&nbsp;<span class="builtinfunc" id="3163824">make</span><span class="op" id="3163828">(</span><span class="keyword" id="3163829">map</span><span class="op" id="3163832">[</span><span class="builtintype" id="3163833">string</span><span class="op" id="3163839">]</span><span class="ident" id="3163840">reflect</span><span class="op" id="3163847">.</span><span class="ident" id="3163848">Value</span><span class="op" id="3163853">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3163856">}</span><br>
<span class="lineno"></span><span class="op" id="3163858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3163861">//&nbsp;Clone&nbsp;returns&nbsp;a&nbsp;duplicate&nbsp;of&nbsp;the&nbsp;template,&nbsp;including&nbsp;all&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="3163932">//&nbsp;templates.&nbsp;The&nbsp;actual&nbsp;representation&nbsp;is&nbsp;not&nbsp;copied,&nbsp;but&nbsp;the&nbsp;name&nbsp;space&nbsp;of</span><br>
<span class="lineno">70</span><span class="comment" id="3164009">//&nbsp;associated&nbsp;templates&nbsp;is,&nbsp;so&nbsp;further&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;in&nbsp;the&nbsp;copy&nbsp;will&nbsp;add</span><br>
<span class="lineno"></span><span class="comment" id="3164084">//&nbsp;templates&nbsp;to&nbsp;the&nbsp;copy&nbsp;but&nbsp;not&nbsp;to&nbsp;the&nbsp;original.&nbsp;Clone&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;prepare</span><br>
<span class="lineno"></span><span class="comment" id="3164163">//&nbsp;common&nbsp;templates&nbsp;and&nbsp;use&nbsp;them&nbsp;with&nbsp;variant&nbsp;definitions&nbsp;for&nbsp;other&nbsp;templates</span><br>
<span class="lineno"></span><span class="comment" id="3164241">//&nbsp;by&nbsp;adding&nbsp;the&nbsp;variants&nbsp;after&nbsp;the&nbsp;clone&nbsp;is&nbsp;made.</span><br>
<span class="lineno"></span><span class="keyword" id="3164292">func</span>&nbsp;<span class="op" id="3164297">(</span><span class="ident" id="3164298">t</span>&nbsp;<span class="op" id="3164300">*</span><span class="ident" id="3164301">Template</span><span class="op" id="3164309">)</span>&nbsp;<span class="ident" id="3164311">Clone</span><span class="op" id="3164316">(</span><span class="op" id="3164317">)</span>&nbsp;<span class="op" id="3164319">(</span><span class="op" id="3164320">*</span><span class="ident" id="3164321">Template</span><span class="op" id="3164329">,</span>&nbsp;<span class="builtintype" id="3164331">error</span><span class="op" id="3164336">)</span>&nbsp;<span class="op" id="3164338">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164341">nt</span>&nbsp;<span class="op" id="3164344">:=</span>&nbsp;<span class="ident" id="3164347">t</span><span class="op" id="3164348">.</span><span class="builtinfunc" id="3164349">copy</span><span class="op" id="3164353">(</span><span class="ident" id="3164354">nil</span><span class="op" id="3164357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164360">nt</span><span class="op" id="3164362">.</span><span class="ident" id="3164363">init</span><span class="op" id="3164367">(</span><span class="op" id="3164368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164371">nt</span><span class="op" id="3164373">.</span><span class="ident" id="3164374">tmpl</span><span class="op" id="3164378">[</span><span class="ident" id="3164379">t</span><span class="op" id="3164380">.</span><span class="ident" id="3164381">name</span><span class="op" id="3164385">]</span>&nbsp;<span class="op" id="3164387">=</span>&nbsp;<span class="ident" id="3164389">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164393">for</span>&nbsp;<span class="ident" id="3164397">k</span><span class="op" id="3164398">,</span>&nbsp;<span class="ident" id="3164400">v</span>&nbsp;<span class="op" id="3164402">:=</span>&nbsp;<span class="keyword" id="3164405">range</span>&nbsp;<span class="ident" id="3164411">t</span><span class="op" id="3164412">.</span><span class="ident" id="3164413">tmpl</span>&nbsp;<span class="op" id="3164418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164422">if</span>&nbsp;<span class="ident" id="3164425">k</span>&nbsp;<span class="op" id="3164427">==</span>&nbsp;<span class="ident" id="3164430">t</span><span class="op" id="3164431">.</span><span class="ident" id="3164432">name</span>&nbsp;<span class="op" id="3164437">{</span>&nbsp;<span class="comment" id="3164439">//&nbsp;Already&nbsp;installed.</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164464">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3164475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3164479">//&nbsp;The&nbsp;associated&nbsp;templates&nbsp;share&nbsp;nt&#39;s&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164538">tmpl</span>&nbsp;<span class="op" id="3164543">:=</span>&nbsp;<span class="ident" id="3164546">v</span><span class="op" id="3164547">.</span><span class="builtinfunc" id="3164548">copy</span><span class="op" id="3164552">(</span><span class="ident" id="3164553">nt</span><span class="op" id="3164555">.</span><span class="ident" id="3164556">common</span><span class="op" id="3164562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164566">nt</span><span class="op" id="3164568">.</span><span class="ident" id="3164569">tmpl</span><span class="op" id="3164573">[</span><span class="ident" id="3164574">k</span><span class="op" id="3164575">]</span>&nbsp;<span class="op" id="3164577">=</span>&nbsp;<span class="ident" id="3164579">tmpl</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3164585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164588">for</span>&nbsp;<span class="ident" id="3164592">k</span><span class="op" id="3164593">,</span>&nbsp;<span class="ident" id="3164595">v</span>&nbsp;<span class="op" id="3164597">:=</span>&nbsp;<span class="keyword" id="3164600">range</span>&nbsp;<span class="ident" id="3164606">t</span><span class="op" id="3164607">.</span><span class="ident" id="3164608">parseFuncs</span>&nbsp;<span class="op" id="3164619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164623">nt</span><span class="op" id="3164625">.</span><span class="ident" id="3164626">parseFuncs</span><span class="op" id="3164636">[</span><span class="ident" id="3164637">k</span><span class="op" id="3164638">]</span>&nbsp;<span class="op" id="3164640">=</span>&nbsp;<span class="ident" id="3164642">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3164645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164648">for</span>&nbsp;<span class="ident" id="3164652">k</span><span class="op" id="3164653">,</span>&nbsp;<span class="ident" id="3164655">v</span>&nbsp;<span class="op" id="3164657">:=</span>&nbsp;<span class="keyword" id="3164660">range</span>&nbsp;<span class="ident" id="3164666">t</span><span class="op" id="3164667">.</span><span class="ident" id="3164668">execFuncs</span>&nbsp;<span class="op" id="3164678">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164682">nt</span><span class="op" id="3164684">.</span><span class="ident" id="3164685">execFuncs</span><span class="op" id="3164694">[</span><span class="ident" id="3164695">k</span><span class="op" id="3164696">]</span>&nbsp;<span class="op" id="3164698">=</span>&nbsp;<span class="ident" id="3164700">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3164703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164706">return</span>&nbsp;<span class="ident" id="3164713">nt</span><span class="op" id="3164715">,</span>&nbsp;<span class="ident" id="3164717">nil</span><br>
<span class="lineno"></span><span class="op" id="3164721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="3164724">//&nbsp;copy&nbsp;returns&nbsp;a&nbsp;shallow&nbsp;copy&nbsp;of&nbsp;t,&nbsp;with&nbsp;common&nbsp;set&nbsp;to&nbsp;the&nbsp;argument.</span><br>
<span class="lineno"></span><span class="keyword" id="3164794">func</span>&nbsp;<span class="op" id="3164799">(</span><span class="ident" id="3164800">t</span>&nbsp;<span class="op" id="3164802">*</span><span class="ident" id="3164803">Template</span><span class="op" id="3164811">)</span>&nbsp;<span class="builtinfunc" id="3164813">copy</span><span class="op" id="3164817">(</span><span class="ident" id="3164818">c</span>&nbsp;<span class="op" id="3164820">*</span><span class="ident" id="3164821">common</span><span class="op" id="3164827">)</span>&nbsp;<span class="op" id="3164829">*</span><span class="ident" id="3164830">Template</span>&nbsp;<span class="op" id="3164839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164842">nt</span>&nbsp;<span class="op" id="3164845">:=</span>&nbsp;<span class="ident" id="3164848">New</span><span class="op" id="3164851">(</span><span class="ident" id="3164852">t</span><span class="op" id="3164853">.</span><span class="ident" id="3164854">name</span><span class="op" id="3164858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164861">nt</span><span class="op" id="3164863">.</span><span class="ident" id="3164864">Tree</span>&nbsp;<span class="op" id="3164869">=</span>&nbsp;<span class="ident" id="3164871">t</span><span class="op" id="3164872">.</span><span class="ident" id="3164873">Tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164879">nt</span><span class="op" id="3164881">.</span><span class="ident" id="3164882">common</span>&nbsp;<span class="op" id="3164889">=</span>&nbsp;<span class="ident" id="3164891">c</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164894">nt</span><span class="op" id="3164896">.</span><span class="ident" id="3164897">leftDelim</span>&nbsp;<span class="op" id="3164907">=</span>&nbsp;<span class="ident" id="3164909">t</span><span class="op" id="3164910">.</span><span class="ident" id="3164911">leftDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3164922">nt</span><span class="op" id="3164924">.</span><span class="ident" id="3164925">rightDelim</span>&nbsp;<span class="op" id="3164936">=</span>&nbsp;<span class="ident" id="3164938">t</span><span class="op" id="3164939">.</span><span class="ident" id="3164940">rightDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3164952">return</span>&nbsp;<span class="ident" id="3164959">nt</span><br>
<span class="lineno"></span><span class="op" id="3164962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="3164965">//&nbsp;AddParseTree&nbsp;creates&nbsp;a&nbsp;new&nbsp;template&nbsp;with&nbsp;the&nbsp;name&nbsp;and&nbsp;parse&nbsp;tree</span><br>
<span class="lineno"></span><span class="comment" id="3165033">//&nbsp;and&nbsp;associates&nbsp;it&nbsp;with&nbsp;t.</span><br>
<span class="lineno"></span><span class="keyword" id="3165062">func</span>&nbsp;<span class="op" id="3165067">(</span><span class="ident" id="3165068">t</span>&nbsp;<span class="op" id="3165070">*</span><span class="ident" id="3165071">Template</span><span class="op" id="3165079">)</span>&nbsp;<span class="ident" id="3165081">AddParseTree</span><span class="op" id="3165093">(</span><span class="ident" id="3165094">name</span>&nbsp;<span class="builtintype" id="3165099">string</span><span class="op" id="3165105">,</span>&nbsp;<span class="ident" id="3165107">tree</span>&nbsp;<span class="op" id="3165112">*</span><span class="ident" id="3165113">parse</span><span class="op" id="3165118">.</span><span class="ident" id="3165119">Tree</span><span class="op" id="3165123">)</span>&nbsp;<span class="op" id="3165125">(</span><span class="op" id="3165126">*</span><span class="ident" id="3165127">Template</span><span class="op" id="3165135">,</span>&nbsp;<span class="builtintype" id="3165137">error</span><span class="op" id="3165142">)</span>&nbsp;<span class="op" id="3165144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165147">if</span>&nbsp;<span class="ident" id="3165150">t</span><span class="op" id="3165151">.</span><span class="ident" id="3165152">common</span>&nbsp;<span class="op" id="3165159">!=</span>&nbsp;<span class="ident" id="3165162">nil</span>&nbsp;<span class="op" id="3165166">&amp;&amp;</span>&nbsp;<span class="ident" id="3165169">t</span><span class="op" id="3165170">.</span><span class="ident" id="3165171">tmpl</span><span class="op" id="3165175">[</span><span class="ident" id="3165176">name</span><span class="op" id="3165180">]</span>&nbsp;<span class="op" id="3165182">!=</span>&nbsp;<span class="ident" id="3165185">nil</span>&nbsp;<span class="op" id="3165189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165193">return</span>&nbsp;<span class="ident" id="3165200">nil</span><span class="op" id="3165203">,</span>&nbsp;<span class="ident" id="3165205">fmt</span><span class="op" id="3165208">.</span><span class="ident" id="3165209">Errorf</span><span class="op" id="3165215">(</span><span class="string" id="3165216">&#34;template:&nbsp;redefinition&nbsp;of&nbsp;template&nbsp;%q&#34;</span><span class="op" id="3165255">,</span>&nbsp;<span class="ident" id="3165257">name</span><span class="op" id="3165261">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3165264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165267">nt</span>&nbsp;<span class="op" id="3165270">:=</span>&nbsp;<span class="ident" id="3165273">t</span><span class="op" id="3165274">.</span><span class="ident" id="3165275">New</span><span class="op" id="3165278">(</span><span class="ident" id="3165279">name</span><span class="op" id="3165283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165286">nt</span><span class="op" id="3165288">.</span><span class="ident" id="3165289">Tree</span>&nbsp;<span class="op" id="3165294">=</span>&nbsp;<span class="ident" id="3165296">tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165302">t</span><span class="op" id="3165303">.</span><span class="ident" id="3165304">tmpl</span><span class="op" id="3165308">[</span><span class="ident" id="3165309">name</span><span class="op" id="3165313">]</span>&nbsp;<span class="op" id="3165315">=</span>&nbsp;<span class="ident" id="3165317">nt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165321">return</span>&nbsp;<span class="ident" id="3165328">nt</span><span class="op" id="3165330">,</span>&nbsp;<span class="ident" id="3165332">nil</span><br>
<span class="lineno">115</span><span class="op" id="3165336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3165339">//&nbsp;Templates&nbsp;returns&nbsp;a&nbsp;slice&nbsp;of&nbsp;the&nbsp;templates&nbsp;associated&nbsp;with&nbsp;t,&nbsp;including&nbsp;t</span><br>
<span class="lineno"></span><span class="comment" id="3165416">//&nbsp;itself.</span><br>
<span class="lineno"></span><span class="keyword" id="3165427">func</span>&nbsp;<span class="op" id="3165432">(</span><span class="ident" id="3165433">t</span>&nbsp;<span class="op" id="3165435">*</span><span class="ident" id="3165436">Template</span><span class="op" id="3165444">)</span>&nbsp;<span class="ident" id="3165446">Templates</span><span class="op" id="3165455">(</span><span class="op" id="3165456">)</span>&nbsp;<span class="op" id="3165458">[</span><span class="op" id="3165459">]</span><span class="op" id="3165460">*</span><span class="ident" id="3165461">Template</span>&nbsp;<span class="op" id="3165470">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165473">if</span>&nbsp;<span class="ident" id="3165476">t</span><span class="op" id="3165477">.</span><span class="ident" id="3165478">common</span>&nbsp;<span class="op" id="3165485">==</span>&nbsp;<span class="ident" id="3165488">nil</span>&nbsp;<span class="op" id="3165492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165496">return</span>&nbsp;<span class="ident" id="3165503">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3165508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3165511">//&nbsp;Return&nbsp;a&nbsp;slice&nbsp;so&nbsp;we&nbsp;don&#39;t&nbsp;expose&nbsp;the&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165558">m</span>&nbsp;<span class="op" id="3165560">:=</span>&nbsp;<span class="builtinfunc" id="3165563">make</span><span class="op" id="3165567">(</span><span class="op" id="3165568">[</span><span class="op" id="3165569">]</span><span class="op" id="3165570">*</span><span class="ident" id="3165571">Template</span><span class="op" id="3165579">,</span>&nbsp;<span class="num" id="3165581">0</span><span class="op" id="3165582">,</span>&nbsp;<span class="builtinfunc" id="3165584">len</span><span class="op" id="3165587">(</span><span class="ident" id="3165588">t</span><span class="op" id="3165589">.</span><span class="ident" id="3165590">tmpl</span><span class="op" id="3165594">)</span><span class="op" id="3165595">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165598">for</span>&nbsp;<span class="ident" id="3165602">_</span><span class="op" id="3165603">,</span>&nbsp;<span class="ident" id="3165605">v</span>&nbsp;<span class="op" id="3165607">:=</span>&nbsp;<span class="keyword" id="3165610">range</span>&nbsp;<span class="ident" id="3165616">t</span><span class="op" id="3165617">.</span><span class="ident" id="3165618">tmpl</span>&nbsp;<span class="op" id="3165623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3165627">m</span>&nbsp;<span class="op" id="3165629">=</span>&nbsp;<span class="builtinfunc" id="3165631">append</span><span class="op" id="3165637">(</span><span class="ident" id="3165638">m</span><span class="op" id="3165639">,</span>&nbsp;<span class="ident" id="3165641">v</span><span class="op" id="3165642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3165645">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3165648">return</span>&nbsp;<span class="ident" id="3165655">m</span><br>
<span class="lineno"></span><span class="op" id="3165657">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="3165660">//&nbsp;Delims&nbsp;sets&nbsp;the&nbsp;action&nbsp;delimiters&nbsp;to&nbsp;the&nbsp;specified&nbsp;strings,&nbsp;to&nbsp;be&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3165737">//&nbsp;subsequent&nbsp;calls&nbsp;to&nbsp;Parse,&nbsp;ParseFiles,&nbsp;or&nbsp;ParseGlob.&nbsp;Nested&nbsp;template</span><br>
<span class="lineno"></span><span class="comment" id="3165809">//&nbsp;definitions&nbsp;will&nbsp;inherit&nbsp;the&nbsp;settings.&nbsp;An&nbsp;empty&nbsp;delimiter&nbsp;stands&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3165885">//&nbsp;corresponding&nbsp;default:&nbsp;{{&nbsp;or&nbsp;}}.</span><br>
<span class="lineno">135</span><span class="comment" id="3165921">//&nbsp;The&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;template,&nbsp;so&nbsp;calls&nbsp;can&nbsp;be&nbsp;chained.</span><br>
<span class="lineno"></span><span class="keyword" id="3165983">func</span>&nbsp;<span class="op" id="3165988">(</span><span class="ident" id="3165989">t</span>&nbsp;<span class="op" id="3165991">*</span><span class="ident" id="3165992">Template</span><span class="op" id="3166000">)</span>&nbsp;<span class="ident" id="3166002">Delims</span><span class="op" id="3166008">(</span><span class="ident" id="3166009">left</span><span class="op" id="3166013">,</span>&nbsp;<span class="ident" id="3166015">right</span>&nbsp;<span class="builtintype" id="3166021">string</span><span class="op" id="3166027">)</span>&nbsp;<span class="op" id="3166029">*</span><span class="ident" id="3166030">Template</span>&nbsp;<span class="op" id="3166039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166042">t</span><span class="op" id="3166043">.</span><span class="ident" id="3166044">leftDelim</span>&nbsp;<span class="op" id="3166054">=</span>&nbsp;<span class="ident" id="3166056">left</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166062">t</span><span class="op" id="3166063">.</span><span class="ident" id="3166064">rightDelim</span>&nbsp;<span class="op" id="3166075">=</span>&nbsp;<span class="ident" id="3166077">right</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166084">return</span>&nbsp;<span class="ident" id="3166091">t</span><br>
<span class="lineno">140</span><span class="op" id="3166093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3166096">//&nbsp;Funcs&nbsp;adds&nbsp;the&nbsp;elements&nbsp;of&nbsp;the&nbsp;argument&nbsp;map&nbsp;to&nbsp;the&nbsp;template&#39;s&nbsp;function&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="3166175">//&nbsp;It&nbsp;panics&nbsp;if&nbsp;a&nbsp;value&nbsp;in&nbsp;the&nbsp;map&nbsp;is&nbsp;not&nbsp;a&nbsp;function&nbsp;with&nbsp;appropriate&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="3166252">//&nbsp;type.&nbsp;However,&nbsp;it&nbsp;is&nbsp;legal&nbsp;to&nbsp;overwrite&nbsp;elements&nbsp;of&nbsp;the&nbsp;map.&nbsp;The&nbsp;return</span><br>
<span class="lineno">145</span><span class="comment" id="3166327">//&nbsp;value&nbsp;is&nbsp;the&nbsp;template,&nbsp;so&nbsp;calls&nbsp;can&nbsp;be&nbsp;chained.</span><br>
<span class="lineno"></span><span class="keyword" id="3166378">func</span>&nbsp;<span class="op" id="3166383">(</span><span class="ident" id="3166384">t</span>&nbsp;<span class="op" id="3166386">*</span><span class="ident" id="3166387">Template</span><span class="op" id="3166395">)</span>&nbsp;<span class="ident" id="3166397">Funcs</span><span class="op" id="3166402">(</span><span class="ident" id="3166403">funcMap</span>&nbsp;<span class="ident" id="3166411">FuncMap</span><span class="op" id="3166418">)</span>&nbsp;<span class="op" id="3166420">*</span><span class="ident" id="3166421">Template</span>&nbsp;<span class="op" id="3166430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166433">t</span><span class="op" id="3166434">.</span><span class="ident" id="3166435">init</span><span class="op" id="3166439">(</span><span class="op" id="3166440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166443">addValueFuncs</span><span class="op" id="3166456">(</span><span class="ident" id="3166457">t</span><span class="op" id="3166458">.</span><span class="ident" id="3166459">execFuncs</span><span class="op" id="3166468">,</span>&nbsp;<span class="ident" id="3166470">funcMap</span><span class="op" id="3166477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3166480">addFuncs</span><span class="op" id="3166488">(</span><span class="ident" id="3166489">t</span><span class="op" id="3166490">.</span><span class="ident" id="3166491">parseFuncs</span><span class="op" id="3166501">,</span>&nbsp;<span class="ident" id="3166503">funcMap</span><span class="op" id="3166510">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166513">return</span>&nbsp;<span class="ident" id="3166520">t</span><br>
<span class="lineno"></span><span class="op" id="3166522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3166525">//&nbsp;Lookup&nbsp;returns&nbsp;the&nbsp;template&nbsp;with&nbsp;the&nbsp;given&nbsp;name&nbsp;that&nbsp;is&nbsp;associated&nbsp;with&nbsp;t,</span><br>
<span class="lineno"></span><span class="comment" id="3166603">//&nbsp;or&nbsp;nil&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;such&nbsp;template.</span><br>
<span class="lineno">155</span><span class="keyword" id="3166643">func</span>&nbsp;<span class="op" id="3166648">(</span><span class="ident" id="3166649">t</span>&nbsp;<span class="op" id="3166651">*</span><span class="ident" id="3166652">Template</span><span class="op" id="3166660">)</span>&nbsp;<span class="ident" id="3166662">Lookup</span><span class="op" id="3166668">(</span><span class="ident" id="3166669">name</span>&nbsp;<span class="builtintype" id="3166674">string</span><span class="op" id="3166680">)</span>&nbsp;<span class="op" id="3166682">*</span><span class="ident" id="3166683">Template</span>&nbsp;<span class="op" id="3166692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166695">if</span>&nbsp;<span class="ident" id="3166698">t</span><span class="op" id="3166699">.</span><span class="ident" id="3166700">common</span>&nbsp;<span class="op" id="3166707">==</span>&nbsp;<span class="ident" id="3166710">nil</span>&nbsp;<span class="op" id="3166714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166718">return</span>&nbsp;<span class="ident" id="3166725">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3166730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3166733">return</span>&nbsp;<span class="ident" id="3166740">t</span><span class="op" id="3166741">.</span><span class="ident" id="3166742">tmpl</span><span class="op" id="3166746">[</span><span class="ident" id="3166747">name</span><span class="op" id="3166751">]</span><br>
<span class="lineno">160</span><span class="op" id="3166753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3166756">//&nbsp;Parse&nbsp;parses&nbsp;a&nbsp;string&nbsp;into&nbsp;a&nbsp;template.&nbsp;Nested&nbsp;template&nbsp;definitions&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3166834">//&nbsp;associated&nbsp;with&nbsp;the&nbsp;top-level&nbsp;template&nbsp;t.&nbsp;Parse&nbsp;may&nbsp;be&nbsp;called&nbsp;multiple&nbsp;times</span><br>
<span class="lineno"></span><span class="comment" id="3166914">//&nbsp;to&nbsp;parse&nbsp;definitions&nbsp;of&nbsp;templates&nbsp;to&nbsp;associate&nbsp;with&nbsp;t.&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;if&nbsp;a</span><br>
<span class="lineno">165</span><span class="comment" id="3166992">//&nbsp;resulting&nbsp;template&nbsp;is&nbsp;non-empty&nbsp;(contains&nbsp;content&nbsp;other&nbsp;than&nbsp;template</span><br>
<span class="lineno"></span><span class="comment" id="3167065">//&nbsp;definitions)&nbsp;and&nbsp;would&nbsp;replace&nbsp;a&nbsp;non-empty&nbsp;template&nbsp;with&nbsp;the&nbsp;same&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="3167140">//&nbsp;(In&nbsp;multiple&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;with&nbsp;the&nbsp;same&nbsp;receiver&nbsp;template,&nbsp;only&nbsp;one&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="3167218">//&nbsp;can&nbsp;contain&nbsp;text&nbsp;other&nbsp;than&nbsp;space,&nbsp;comments,&nbsp;and&nbsp;template&nbsp;definitions.)</span><br>
<span class="lineno"></span><span class="keyword" id="3167293">func</span>&nbsp;<span class="op" id="3167298">(</span><span class="ident" id="3167299">t</span>&nbsp;<span class="op" id="3167301">*</span><span class="ident" id="3167302">Template</span><span class="op" id="3167310">)</span>&nbsp;<span class="ident" id="3167312">Parse</span><span class="op" id="3167317">(</span><span class="ident" id="3167318">text</span>&nbsp;<span class="builtintype" id="3167323">string</span><span class="op" id="3167329">)</span>&nbsp;<span class="op" id="3167331">(</span><span class="op" id="3167332">*</span><span class="ident" id="3167333">Template</span><span class="op" id="3167341">,</span>&nbsp;<span class="builtintype" id="3167343">error</span><span class="op" id="3167348">)</span>&nbsp;<span class="op" id="3167350">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3167353">t</span><span class="op" id="3167354">.</span><span class="ident" id="3167355">init</span><span class="op" id="3167359">(</span><span class="op" id="3167360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3167363">trees</span><span class="op" id="3167368">,</span>&nbsp;<span class="ident" id="3167370">err</span>&nbsp;<span class="op" id="3167374">:=</span>&nbsp;<span class="ident" id="3167377">parse</span><span class="op" id="3167382">.</span><span class="ident" id="3167383">Parse</span><span class="op" id="3167388">(</span><span class="ident" id="3167389">t</span><span class="op" id="3167390">.</span><span class="ident" id="3167391">name</span><span class="op" id="3167395">,</span>&nbsp;<span class="ident" id="3167397">text</span><span class="op" id="3167401">,</span>&nbsp;<span class="ident" id="3167403">t</span><span class="op" id="3167404">.</span><span class="ident" id="3167405">leftDelim</span><span class="op" id="3167414">,</span>&nbsp;<span class="ident" id="3167416">t</span><span class="op" id="3167417">.</span><span class="ident" id="3167418">rightDelim</span><span class="op" id="3167428">,</span>&nbsp;<span class="ident" id="3167430">t</span><span class="op" id="3167431">.</span><span class="ident" id="3167432">parseFuncs</span><span class="op" id="3167442">,</span>&nbsp;<span class="ident" id="3167444">builtins</span><span class="op" id="3167452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167455">if</span>&nbsp;<span class="ident" id="3167458">err</span>&nbsp;<span class="op" id="3167462">!=</span>&nbsp;<span class="ident" id="3167465">nil</span>&nbsp;<span class="op" id="3167469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167473">return</span>&nbsp;<span class="ident" id="3167480">nil</span><span class="op" id="3167483">,</span>&nbsp;<span class="ident" id="3167485">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3167490">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3167493">//&nbsp;Add&nbsp;the&nbsp;newly&nbsp;parsed&nbsp;trees,&nbsp;including&nbsp;the&nbsp;one&nbsp;for&nbsp;t,&nbsp;into&nbsp;our&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167577">for</span>&nbsp;<span class="ident" id="3167581">name</span><span class="op" id="3167585">,</span>&nbsp;<span class="ident" id="3167587">tree</span>&nbsp;<span class="op" id="3167592">:=</span>&nbsp;<span class="keyword" id="3167595">range</span>&nbsp;<span class="ident" id="3167601">trees</span>&nbsp;<span class="op" id="3167607">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3167611">//&nbsp;If&nbsp;the&nbsp;name&nbsp;we&nbsp;parsed&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;this&nbsp;template,&nbsp;overwrite&nbsp;this&nbsp;template.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3167693">//&nbsp;The&nbsp;associate&nbsp;method&nbsp;checks&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;redefinition.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3167751">tmpl</span>&nbsp;<span class="op" id="3167756">:=</span>&nbsp;<span class="ident" id="3167759">t</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167763">if</span>&nbsp;<span class="ident" id="3167766">name</span>&nbsp;<span class="op" id="3167771">!=</span>&nbsp;<span class="ident" id="3167774">t</span><span class="op" id="3167775">.</span><span class="ident" id="3167776">name</span>&nbsp;<span class="op" id="3167781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3167786">tmpl</span>&nbsp;<span class="op" id="3167791">=</span>&nbsp;<span class="ident" id="3167793">t</span><span class="op" id="3167794">.</span><span class="ident" id="3167795">New</span><span class="op" id="3167798">(</span><span class="ident" id="3167799">name</span><span class="op" id="3167803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3167807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3167811">//&nbsp;Even&nbsp;if&nbsp;t&nbsp;==&nbsp;tmpl,&nbsp;we&nbsp;need&nbsp;to&nbsp;install&nbsp;it&nbsp;in&nbsp;the&nbsp;common.tmpl&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167881">if</span>&nbsp;<span class="ident" id="3167884">replace</span><span class="op" id="3167891">,</span>&nbsp;<span class="ident" id="3167893">err</span>&nbsp;<span class="op" id="3167897">:=</span>&nbsp;<span class="ident" id="3167900">t</span><span class="op" id="3167901">.</span><span class="ident" id="3167902">associate</span><span class="op" id="3167911">(</span><span class="ident" id="3167912">tmpl</span><span class="op" id="3167916">,</span>&nbsp;<span class="ident" id="3167918">tree</span><span class="op" id="3167922">)</span><span class="op" id="3167923">;</span>&nbsp;<span class="ident" id="3167925">err</span>&nbsp;<span class="op" id="3167929">!=</span>&nbsp;<span class="ident" id="3167932">nil</span>&nbsp;<span class="op" id="3167936">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3167941">return</span>&nbsp;<span class="ident" id="3167948">nil</span><span class="op" id="3167951">,</span>&nbsp;<span class="ident" id="3167953">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3167959">}</span>&nbsp;<span class="keyword" id="3167961">else</span>&nbsp;<span class="keyword" id="3167966">if</span>&nbsp;<span class="ident" id="3167969">replace</span>&nbsp;<span class="op" id="3167977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3167982">tmpl</span><span class="op" id="3167986">.</span><span class="ident" id="3167987">Tree</span>&nbsp;<span class="op" id="3167992">=</span>&nbsp;<span class="ident" id="3167994">tree</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3168001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168005">tmpl</span><span class="op" id="3168009">.</span><span class="ident" id="3168010">leftDelim</span>&nbsp;<span class="op" id="3168020">=</span>&nbsp;<span class="ident" id="3168022">t</span><span class="op" id="3168023">.</span><span class="ident" id="3168024">leftDelim</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168036">tmpl</span><span class="op" id="3168040">.</span><span class="ident" id="3168041">rightDelim</span>&nbsp;<span class="op" id="3168052">=</span>&nbsp;<span class="ident" id="3168054">t</span><span class="op" id="3168055">.</span><span class="ident" id="3168056">rightDelim</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3168068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168071">return</span>&nbsp;<span class="ident" id="3168078">t</span><span class="op" id="3168079">,</span>&nbsp;<span class="ident" id="3168081">nil</span><br>
<span class="lineno"></span><span class="op" id="3168085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="comment" id="3168088">//&nbsp;associate&nbsp;installs&nbsp;the&nbsp;new&nbsp;template&nbsp;into&nbsp;the&nbsp;group&nbsp;of&nbsp;templates&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="3168166">//&nbsp;with&nbsp;t.&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;reuse&nbsp;a&nbsp;name&nbsp;except&nbsp;to&nbsp;overwrite&nbsp;an&nbsp;empty</span><br>
<span class="lineno"></span><span class="comment" id="3168237">//&nbsp;template.&nbsp;The&nbsp;two&nbsp;are&nbsp;already&nbsp;known&nbsp;to&nbsp;share&nbsp;the&nbsp;common&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="3168307">//&nbsp;The&nbsp;boolean&nbsp;return&nbsp;value&nbsp;reports&nbsp;wither&nbsp;to&nbsp;store&nbsp;this&nbsp;tree&nbsp;as&nbsp;t.Tree.</span><br>
<span class="lineno"></span><span class="keyword" id="3168380">func</span>&nbsp;<span class="op" id="3168385">(</span><span class="ident" id="3168386">t</span>&nbsp;<span class="op" id="3168388">*</span><span class="ident" id="3168389">Template</span><span class="op" id="3168397">)</span>&nbsp;<span class="ident" id="3168399">associate</span><span class="op" id="3168408">(</span><span class="builtinfunc" id="3168409">new</span>&nbsp;<span class="op" id="3168413">*</span><span class="ident" id="3168414">Template</span><span class="op" id="3168422">,</span>&nbsp;<span class="ident" id="3168424">tree</span>&nbsp;<span class="op" id="3168429">*</span><span class="ident" id="3168430">parse</span><span class="op" id="3168435">.</span><span class="ident" id="3168436">Tree</span><span class="op" id="3168440">)</span>&nbsp;<span class="op" id="3168442">(</span><span class="builtintype" id="3168443">bool</span><span class="op" id="3168447">,</span>&nbsp;<span class="builtintype" id="3168449">error</span><span class="op" id="3168454">)</span>&nbsp;<span class="op" id="3168456">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168459">if</span>&nbsp;<span class="builtinfunc" id="3168462">new</span><span class="op" id="3168465">.</span><span class="ident" id="3168466">common</span>&nbsp;<span class="op" id="3168473">!=</span>&nbsp;<span class="ident" id="3168476">t</span><span class="op" id="3168477">.</span><span class="ident" id="3168478">common</span>&nbsp;<span class="op" id="3168485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3168489">panic</span><span class="op" id="3168494">(</span><span class="string" id="3168495">&#34;internal&nbsp;error:&nbsp;associate&nbsp;not&nbsp;common&#34;</span><span class="op" id="3168533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3168536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168539">name</span>&nbsp;<span class="op" id="3168544">:=</span>&nbsp;<span class="builtinfunc" id="3168547">new</span><span class="op" id="3168550">.</span><span class="ident" id="3168551">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168557">if</span>&nbsp;<span class="ident" id="3168560">old</span>&nbsp;<span class="op" id="3168564">:=</span>&nbsp;<span class="ident" id="3168567">t</span><span class="op" id="3168568">.</span><span class="ident" id="3168569">tmpl</span><span class="op" id="3168573">[</span><span class="ident" id="3168574">name</span><span class="op" id="3168578">]</span><span class="op" id="3168579">;</span>&nbsp;<span class="ident" id="3168581">old</span>&nbsp;<span class="op" id="3168585">!=</span>&nbsp;<span class="ident" id="3168588">nil</span>&nbsp;<span class="op" id="3168592">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168596">oldIsEmpty</span>&nbsp;<span class="op" id="3168607">:=</span>&nbsp;<span class="ident" id="3168610">parse</span><span class="op" id="3168615">.</span><span class="ident" id="3168616">IsEmptyTree</span><span class="op" id="3168627">(</span><span class="ident" id="3168628">old</span><span class="op" id="3168631">.</span><span class="ident" id="3168632">Root</span><span class="op" id="3168636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168640">newIsEmpty</span>&nbsp;<span class="op" id="3168651">:=</span>&nbsp;<span class="ident" id="3168654">parse</span><span class="op" id="3168659">.</span><span class="ident" id="3168660">IsEmptyTree</span><span class="op" id="3168671">(</span><span class="ident" id="3168672">tree</span><span class="op" id="3168676">.</span><span class="ident" id="3168677">Root</span><span class="op" id="3168681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168685">if</span>&nbsp;<span class="ident" id="3168688">newIsEmpty</span>&nbsp;<span class="op" id="3168699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3168704">//&nbsp;Whether&nbsp;old&nbsp;is&nbsp;empty&nbsp;or&nbsp;not,&nbsp;new&nbsp;is&nbsp;empty;&nbsp;no&nbsp;reason&nbsp;to&nbsp;replace&nbsp;old.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168779">return</span>&nbsp;<span class="builtintype" id="3168786">false</span><span class="op" id="3168791">,</span>&nbsp;<span class="ident" id="3168793">nil</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3168799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168803">if</span>&nbsp;<span class="op" id="3168806">!</span><span class="ident" id="3168807">oldIsEmpty</span>&nbsp;<span class="op" id="3168818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168823">return</span>&nbsp;<span class="builtintype" id="3168830">false</span><span class="op" id="3168835">,</span>&nbsp;<span class="ident" id="3168837">fmt</span><span class="op" id="3168840">.</span><span class="ident" id="3168841">Errorf</span><span class="op" id="3168847">(</span><span class="string" id="3168848">&#34;template:&nbsp;redefinition&nbsp;of&nbsp;template&nbsp;%q&#34;</span><span class="op" id="3168887">,</span>&nbsp;<span class="ident" id="3168889">name</span><span class="op" id="3168893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3168897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3168900">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3168903">t</span><span class="op" id="3168904">.</span><span class="ident" id="3168905">tmpl</span><span class="op" id="3168909">[</span><span class="ident" id="3168910">name</span><span class="op" id="3168914">]</span>&nbsp;<span class="op" id="3168916">=</span>&nbsp;<span class="builtinfunc" id="3168918">new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3168923">return</span>&nbsp;<span class="builtintype" id="3168930">true</span><span class="op" id="3168934">,</span>&nbsp;<span class="ident" id="3168936">nil</span><br>
<span class="lineno"></span><span class="op" id="3168940">}</span>
</div>
</body>
</html>
